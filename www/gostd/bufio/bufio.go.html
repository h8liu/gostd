<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html" class="current">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2842736">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2842791">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2842845">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2842896">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="2842974">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="2843049">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="2843120">package</span>&nbsp;<span class="ident" id="2843128">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2843135">import</span>&nbsp;<span class="op" id="2843142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2843145">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2843154">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2843164">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2843170">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2843185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2843188">const</span>&nbsp;<span class="op" id="2843194">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843197">defaultBufSize</span>&nbsp;<span class="op" id="2843212">=</span>&nbsp;<span class="num" id="2843214">4096</span><br>
<span class="lineno"></span><span class="op" id="2843219">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2843222">var</span>&nbsp;<span class="op" id="2843226">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843229">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="2843250">=</span>&nbsp;<span class="ident" id="2843252">errors</span><span class="op" id="2843258">.</span><span class="ident" id="2843259">New</span><span class="op" id="2843262">(</span><span class="string" id="2843263">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="2843297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843300">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="2843321">=</span>&nbsp;<span class="ident" id="2843323">errors</span><span class="op" id="2843329">.</span><span class="ident" id="2843330">New</span><span class="op" id="2843333">(</span><span class="string" id="2843334">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="2843368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843371">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843392">=</span>&nbsp;<span class="ident" id="2843394">errors</span><span class="op" id="2843400">.</span><span class="ident" id="2843401">New</span><span class="op" id="2843404">(</span><span class="string" id="2843405">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="2843425">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843428">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843449">=</span>&nbsp;<span class="ident" id="2843451">errors</span><span class="op" id="2843457">.</span><span class="ident" id="2843458">New</span><span class="op" id="2843461">(</span><span class="string" id="2843462">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2843485">)</span><br>
<span class="lineno"></span><span class="op" id="2843487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2843490">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2843510">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="2843566">type</span>&nbsp;<span class="ident" id="2843571">Reader</span>&nbsp;<span class="keyword" id="2843578">struct</span>&nbsp;<span class="op" id="2843585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843588">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843601">[</span><span class="op" id="2843602">]</span><span class="builtintype" id="2843603">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843609">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843622">io</span><span class="op" id="2843624">.</span><span class="ident" id="2843625">Reader</span>&nbsp;<span class="comment" id="2843632">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843666">r</span><span class="op" id="2843667">,</span>&nbsp;<span class="ident" id="2843669">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2843679">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2843689">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843722">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2843735">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843742">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2843755">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843760">lastRuneSize</span>&nbsp;<span class="builtintype" id="2843773">int</span><br>
<span class="lineno"></span><span class="op" id="2843777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2843780">const</span>&nbsp;<span class="ident" id="2843786">minReadBufferSize</span>&nbsp;<span class="op" id="2843804">=</span>&nbsp;<span class="num" id="2843806">16</span><br>
<span class="lineno"></span><span class="keyword" id="2843809">const</span>&nbsp;<span class="ident" id="2843815">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2843840">=</span>&nbsp;<span class="num" id="2843842">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2843847">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="2843925">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="2843998">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="2844041">func</span>&nbsp;<span class="ident" id="2844046">NewReaderSize</span><span class="op" id="2844059">(</span><span class="ident" id="2844060">rd</span>&nbsp;<span class="ident" id="2844063">io</span><span class="op" id="2844065">.</span><span class="ident" id="2844066">Reader</span><span class="op" id="2844072">,</span>&nbsp;<span class="ident" id="2844074">size</span>&nbsp;<span class="builtintype" id="2844079">int</span><span class="op" id="2844082">)</span>&nbsp;<span class="op" id="2844084">*</span><span class="ident" id="2844085">Reader</span>&nbsp;<span class="op" id="2844092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2844095">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844123">b</span><span class="op" id="2844124">,</span>&nbsp;<span class="ident" id="2844126">ok</span>&nbsp;<span class="op" id="2844129">:=</span>&nbsp;<span class="ident" id="2844132">rd</span><span class="op" id="2844134">.</span><span class="op" id="2844135">(</span><span class="op" id="2844136">*</span><span class="ident" id="2844137">Reader</span><span class="op" id="2844143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844146">if</span>&nbsp;<span class="ident" id="2844149">ok</span>&nbsp;<span class="op" id="2844152">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2844155">len</span><span class="op" id="2844158">(</span><span class="ident" id="2844159">b</span><span class="op" id="2844160">.</span><span class="ident" id="2844161">buf</span><span class="op" id="2844164">)</span>&nbsp;<span class="op" id="2844166">&gt;=</span>&nbsp;<span class="ident" id="2844169">size</span>&nbsp;<span class="op" id="2844174">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844178">return</span>&nbsp;<span class="ident" id="2844185">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2844188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844191">if</span>&nbsp;<span class="ident" id="2844194">size</span>&nbsp;<span class="op" id="2844199">&lt;</span>&nbsp;<span class="ident" id="2844201">minReadBufferSize</span>&nbsp;<span class="op" id="2844219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844223">size</span>&nbsp;<span class="op" id="2844228">=</span>&nbsp;<span class="ident" id="2844230">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2844249">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844252">r</span>&nbsp;<span class="op" id="2844254">:=</span>&nbsp;<span class="builtinfunc" id="2844257">new</span><span class="op" id="2844260">(</span><span class="ident" id="2844261">Reader</span><span class="op" id="2844267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844270">r</span><span class="op" id="2844271">.</span><span class="ident" id="2844272">reset</span><span class="op" id="2844277">(</span><span class="builtinfunc" id="2844278">make</span><span class="op" id="2844282">(</span><span class="op" id="2844283">[</span><span class="op" id="2844284">]</span><span class="builtintype" id="2844285">byte</span><span class="op" id="2844289">,</span>&nbsp;<span class="ident" id="2844291">size</span><span class="op" id="2844295">)</span><span class="op" id="2844296">,</span>&nbsp;<span class="ident" id="2844298">rd</span><span class="op" id="2844300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844303">return</span>&nbsp;<span class="ident" id="2844310">r</span><br>
<span class="lineno"></span><span class="op" id="2844312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2844315">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="2844384">func</span>&nbsp;<span class="ident" id="2844389">NewReader</span><span class="op" id="2844398">(</span><span class="ident" id="2844399">rd</span>&nbsp;<span class="ident" id="2844402">io</span><span class="op" id="2844404">.</span><span class="ident" id="2844405">Reader</span><span class="op" id="2844411">)</span>&nbsp;<span class="op" id="2844413">*</span><span class="ident" id="2844414">Reader</span>&nbsp;<span class="op" id="2844421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844424">return</span>&nbsp;<span class="ident" id="2844431">NewReaderSize</span><span class="op" id="2844444">(</span><span class="ident" id="2844445">rd</span><span class="op" id="2844447">,</span>&nbsp;<span class="ident" id="2844449">defaultBufSize</span><span class="op" id="2844463">)</span><br>
<span class="lineno"></span><span class="op" id="2844465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2844468">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="2844536">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2844575">func</span>&nbsp;<span class="op" id="2844580">(</span><span class="ident" id="2844581">b</span>&nbsp;<span class="op" id="2844583">*</span><span class="ident" id="2844584">Reader</span><span class="op" id="2844590">)</span>&nbsp;<span class="ident" id="2844592">Reset</span><span class="op" id="2844597">(</span><span class="ident" id="2844598">r</span>&nbsp;<span class="ident" id="2844600">io</span><span class="op" id="2844602">.</span><span class="ident" id="2844603">Reader</span><span class="op" id="2844609">)</span>&nbsp;<span class="op" id="2844611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844614">b</span><span class="op" id="2844615">.</span><span class="ident" id="2844616">reset</span><span class="op" id="2844621">(</span><span class="ident" id="2844622">b</span><span class="op" id="2844623">.</span><span class="ident" id="2844624">buf</span><span class="op" id="2844627">,</span>&nbsp;<span class="ident" id="2844629">r</span><span class="op" id="2844630">)</span><br>
<span class="lineno"></span><span class="op" id="2844632">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2844635">func</span>&nbsp;<span class="op" id="2844640">(</span><span class="ident" id="2844641">b</span>&nbsp;<span class="op" id="2844643">*</span><span class="ident" id="2844644">Reader</span><span class="op" id="2844650">)</span>&nbsp;<span class="ident" id="2844652">reset</span><span class="op" id="2844657">(</span><span class="ident" id="2844658">buf</span>&nbsp;<span class="op" id="2844662">[</span><span class="op" id="2844663">]</span><span class="builtintype" id="2844664">byte</span><span class="op" id="2844668">,</span>&nbsp;<span class="ident" id="2844670">r</span>&nbsp;<span class="ident" id="2844672">io</span><span class="op" id="2844674">.</span><span class="ident" id="2844675">Reader</span><span class="op" id="2844681">)</span>&nbsp;<span class="op" id="2844683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2844686">*</span><span class="ident" id="2844687">b</span>&nbsp;<span class="op" id="2844689">=</span>&nbsp;<span class="ident" id="2844691">Reader</span><span class="op" id="2844697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844701">buf</span><span class="op" id="2844704">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844715">buf</span><span class="op" id="2844718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844722">rd</span><span class="op" id="2844724">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844736">r</span><span class="op" id="2844737">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844741">lastByte</span><span class="op" id="2844749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2844755">-</span><span class="num" id="2844756">1</span><span class="op" id="2844757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2844761">lastRuneSize</span><span class="op" id="2844773">:</span>&nbsp;<span class="op" id="2844775">-</span><span class="num" id="2844776">1</span><span class="op" id="2844777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2844780">}</span><br>
<span class="lineno"></span><span class="op" id="2844782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="2844785">var</span>&nbsp;<span class="ident" id="2844789">errNegativeRead</span>&nbsp;<span class="op" id="2844805">=</span>&nbsp;<span class="ident" id="2844807">errors</span><span class="op" id="2844813">.</span><span class="ident" id="2844814">New</span><span class="op" id="2844817">(</span><span class="string" id="2844818">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="2844867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2844870">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2844913">func</span>&nbsp;<span class="op" id="2844918">(</span><span class="ident" id="2844919">b</span>&nbsp;<span class="op" id="2844921">*</span><span class="ident" id="2844922">Reader</span><span class="op" id="2844928">)</span>&nbsp;<span class="ident" id="2844930">fill</span><span class="op" id="2844934">(</span><span class="op" id="2844935">)</span>&nbsp;<span class="op" id="2844937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2844940">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2844978">if</span>&nbsp;<span class="ident" id="2844981">b</span><span class="op" id="2844982">.</span><span class="ident" id="2844983">r</span>&nbsp;<span class="op" id="2844985">&gt;</span>&nbsp;<span class="num" id="2844987">0</span>&nbsp;<span class="op" id="2844989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2844993">copy</span><span class="op" id="2844997">(</span><span class="ident" id="2844998">b</span><span class="op" id="2844999">.</span><span class="ident" id="2845000">buf</span><span class="op" id="2845003">,</span>&nbsp;<span class="ident" id="2845005">b</span><span class="op" id="2845006">.</span><span class="ident" id="2845007">buf</span><span class="op" id="2845010">[</span><span class="ident" id="2845011">b</span><span class="op" id="2845012">.</span><span class="ident" id="2845013">r</span><span class="op" id="2845014">:</span><span class="ident" id="2845015">b</span><span class="op" id="2845016">.</span><span class="ident" id="2845017">w</span><span class="op" id="2845018">]</span><span class="op" id="2845019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845023">b</span><span class="op" id="2845024">.</span><span class="ident" id="2845025">w</span>&nbsp;<span class="op" id="2845027">-=</span>&nbsp;<span class="ident" id="2845030">b</span><span class="op" id="2845031">.</span><span class="ident" id="2845032">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845036">b</span><span class="op" id="2845037">.</span><span class="ident" id="2845038">r</span>&nbsp;<span class="op" id="2845040">=</span>&nbsp;<span class="num" id="2845042">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845045">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845049">if</span>&nbsp;<span class="ident" id="2845052">b</span><span class="op" id="2845053">.</span><span class="ident" id="2845054">w</span>&nbsp;<span class="op" id="2845056">&gt;=</span>&nbsp;<span class="builtinfunc" id="2845059">len</span><span class="op" id="2845062">(</span><span class="ident" id="2845063">b</span><span class="op" id="2845064">.</span><span class="ident" id="2845065">buf</span><span class="op" id="2845068">)</span>&nbsp;<span class="op" id="2845070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2845074">panic</span><span class="op" id="2845079">(</span><span class="string" id="2845080">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="2845114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2845121">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845171">for</span>&nbsp;<span class="ident" id="2845175">i</span>&nbsp;<span class="op" id="2845177">:=</span>&nbsp;<span class="ident" id="2845180">maxConsecutiveEmptyReads</span><span class="op" id="2845204">;</span>&nbsp;<span class="ident" id="2845206">i</span>&nbsp;<span class="op" id="2845208">&gt;</span>&nbsp;<span class="num" id="2845210">0</span><span class="op" id="2845211">;</span>&nbsp;<span class="ident" id="2845213">i</span><span class="op" id="2845214">--</span>&nbsp;<span class="op" id="2845217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845221">n</span><span class="op" id="2845222">,</span>&nbsp;<span class="ident" id="2845224">err</span>&nbsp;<span class="op" id="2845228">:=</span>&nbsp;<span class="ident" id="2845231">b</span><span class="op" id="2845232">.</span><span class="ident" id="2845233">rd</span><span class="op" id="2845235">.</span><span class="ident" id="2845236">Read</span><span class="op" id="2845240">(</span><span class="ident" id="2845241">b</span><span class="op" id="2845242">.</span><span class="ident" id="2845243">buf</span><span class="op" id="2845246">[</span><span class="ident" id="2845247">b</span><span class="op" id="2845248">.</span><span class="ident" id="2845249">w</span><span class="op" id="2845250">:</span><span class="op" id="2845251">]</span><span class="op" id="2845252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845256">if</span>&nbsp;<span class="ident" id="2845259">n</span>&nbsp;<span class="op" id="2845261">&lt;</span>&nbsp;<span class="num" id="2845263">0</span>&nbsp;<span class="op" id="2845265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2845270">panic</span><span class="op" id="2845275">(</span><span class="ident" id="2845276">errNegativeRead</span><span class="op" id="2845291">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845299">b</span><span class="op" id="2845300">.</span><span class="ident" id="2845301">w</span>&nbsp;<span class="op" id="2845303">+=</span>&nbsp;<span class="ident" id="2845306">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845310">if</span>&nbsp;<span class="ident" id="2845313">err</span>&nbsp;<span class="op" id="2845317">!=</span>&nbsp;<span class="ident" id="2845320">nil</span>&nbsp;<span class="op" id="2845324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845329">b</span><span class="op" id="2845330">.</span><span class="ident" id="2845331">err</span>&nbsp;<span class="op" id="2845335">=</span>&nbsp;<span class="ident" id="2845337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845344">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845357">if</span>&nbsp;<span class="ident" id="2845360">n</span>&nbsp;<span class="op" id="2845362">&gt;</span>&nbsp;<span class="num" id="2845364">0</span>&nbsp;<span class="op" id="2845366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845383">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845386">b</span><span class="op" id="2845387">.</span><span class="ident" id="2845388">err</span>&nbsp;<span class="op" id="2845392">=</span>&nbsp;<span class="ident" id="2845394">io</span><span class="op" id="2845396">.</span><span class="ident" id="2845397">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="2845411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2845414">func</span>&nbsp;<span class="op" id="2845419">(</span><span class="ident" id="2845420">b</span>&nbsp;<span class="op" id="2845422">*</span><span class="ident" id="2845423">Reader</span><span class="op" id="2845429">)</span>&nbsp;<span class="ident" id="2845431">readErr</span><span class="op" id="2845438">(</span><span class="op" id="2845439">)</span>&nbsp;<span class="builtintype" id="2845441">error</span>&nbsp;<span class="op" id="2845447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845450">err</span>&nbsp;<span class="op" id="2845454">:=</span>&nbsp;<span class="ident" id="2845457">b</span><span class="op" id="2845458">.</span><span class="ident" id="2845459">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845464">b</span><span class="op" id="2845465">.</span><span class="ident" id="2845466">err</span>&nbsp;<span class="op" id="2845470">=</span>&nbsp;<span class="ident" id="2845472">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845477">return</span>&nbsp;<span class="ident" id="2845484">err</span><br>
<span class="lineno"></span><span class="op" id="2845488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2845491">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="2845569">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2845646">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2845718">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="2845772">func</span>&nbsp;<span class="op" id="2845777">(</span><span class="ident" id="2845778">b</span>&nbsp;<span class="op" id="2845780">*</span><span class="ident" id="2845781">Reader</span><span class="op" id="2845787">)</span>&nbsp;<span class="ident" id="2845789">Peek</span><span class="op" id="2845793">(</span><span class="ident" id="2845794">n</span>&nbsp;<span class="builtintype" id="2845796">int</span><span class="op" id="2845799">)</span>&nbsp;<span class="op" id="2845801">(</span><span class="op" id="2845802">[</span><span class="op" id="2845803">]</span><span class="builtintype" id="2845804">byte</span><span class="op" id="2845808">,</span>&nbsp;<span class="builtintype" id="2845810">error</span><span class="op" id="2845815">)</span>&nbsp;<span class="op" id="2845817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845820">if</span>&nbsp;<span class="ident" id="2845823">n</span>&nbsp;<span class="op" id="2845825">&lt;</span>&nbsp;<span class="num" id="2845827">0</span>&nbsp;<span class="op" id="2845829">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845833">return</span>&nbsp;<span class="ident" id="2845840">nil</span><span class="op" id="2845843">,</span>&nbsp;<span class="ident" id="2845845">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845866">if</span>&nbsp;<span class="ident" id="2845869">n</span>&nbsp;<span class="op" id="2845871">&gt;</span>&nbsp;<span class="builtinfunc" id="2845873">len</span><span class="op" id="2845876">(</span><span class="ident" id="2845877">b</span><span class="op" id="2845878">.</span><span class="ident" id="2845879">buf</span><span class="op" id="2845882">)</span>&nbsp;<span class="op" id="2845884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845888">return</span>&nbsp;<span class="ident" id="2845895">nil</span><span class="op" id="2845898">,</span>&nbsp;<span class="ident" id="2845900">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2845915">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2845918">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2845943">for</span>&nbsp;<span class="ident" id="2845947">b</span><span class="op" id="2845948">.</span><span class="ident" id="2845949">w</span><span class="op" id="2845950">-</span><span class="ident" id="2845951">b</span><span class="op" id="2845952">.</span><span class="ident" id="2845953">r</span>&nbsp;<span class="op" id="2845955">&lt;</span>&nbsp;<span class="ident" id="2845957">n</span>&nbsp;<span class="op" id="2845959">&amp;&amp;</span>&nbsp;<span class="ident" id="2845962">b</span><span class="op" id="2845963">.</span><span class="ident" id="2845964">err</span>&nbsp;<span class="op" id="2845968">==</span>&nbsp;<span class="ident" id="2845971">nil</span>&nbsp;<span class="op" id="2845975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2845979">b</span><span class="op" id="2845980">.</span><span class="ident" id="2845981">fill</span><span class="op" id="2845985">(</span><span class="op" id="2845986">)</span>&nbsp;<span class="comment" id="2845988">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846039">var</span>&nbsp;<span class="ident" id="2846043">err</span>&nbsp;<span class="builtintype" id="2846047">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846054">if</span>&nbsp;<span class="ident" id="2846057">avail</span>&nbsp;<span class="op" id="2846063">:=</span>&nbsp;<span class="ident" id="2846066">b</span><span class="op" id="2846067">.</span><span class="ident" id="2846068">w</span>&nbsp;<span class="op" id="2846070">-</span>&nbsp;<span class="ident" id="2846072">b</span><span class="op" id="2846073">.</span><span class="ident" id="2846074">r</span><span class="op" id="2846075">;</span>&nbsp;<span class="ident" id="2846077">avail</span>&nbsp;<span class="op" id="2846083">&lt;</span>&nbsp;<span class="ident" id="2846085">n</span>&nbsp;<span class="op" id="2846087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2846091">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846122">n</span>&nbsp;<span class="op" id="2846124">=</span>&nbsp;<span class="ident" id="2846126">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846134">err</span>&nbsp;<span class="op" id="2846138">=</span>&nbsp;<span class="ident" id="2846140">b</span><span class="op" id="2846141">.</span><span class="ident" id="2846142">readErr</span><span class="op" id="2846149">(</span><span class="op" id="2846150">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846154">if</span>&nbsp;<span class="ident" id="2846157">err</span>&nbsp;<span class="op" id="2846161">==</span>&nbsp;<span class="ident" id="2846164">nil</span>&nbsp;<span class="op" id="2846168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846173">err</span>&nbsp;<span class="op" id="2846177">=</span>&nbsp;<span class="ident" id="2846179">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846201">return</span>&nbsp;<span class="ident" id="2846208">b</span><span class="op" id="2846209">.</span><span class="ident" id="2846210">buf</span><span class="op" id="2846213">[</span><span class="ident" id="2846214">b</span><span class="op" id="2846215">.</span><span class="ident" id="2846216">r</span>&nbsp;<span class="op" id="2846218">:</span>&nbsp;<span class="ident" id="2846220">b</span><span class="op" id="2846221">.</span><span class="ident" id="2846222">r</span><span class="op" id="2846223">+</span><span class="ident" id="2846224">n</span><span class="op" id="2846225">]</span><span class="op" id="2846226">,</span>&nbsp;<span class="ident" id="2846228">err</span><br>
<span class="lineno">145</span><span class="op" id="2846232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2846235">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2846262">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2846309">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="2846365">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="2846401">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2846459">func</span>&nbsp;<span class="op" id="2846464">(</span><span class="ident" id="2846465">b</span>&nbsp;<span class="op" id="2846467">*</span><span class="ident" id="2846468">Reader</span><span class="op" id="2846474">)</span>&nbsp;<span class="ident" id="2846476">Read</span><span class="op" id="2846480">(</span><span class="ident" id="2846481">p</span>&nbsp;<span class="op" id="2846483">[</span><span class="op" id="2846484">]</span><span class="builtintype" id="2846485">byte</span><span class="op" id="2846489">)</span>&nbsp;<span class="op" id="2846491">(</span><span class="ident" id="2846492">n</span>&nbsp;<span class="builtintype" id="2846494">int</span><span class="op" id="2846497">,</span>&nbsp;<span class="ident" id="2846499">err</span>&nbsp;<span class="builtintype" id="2846503">error</span><span class="op" id="2846508">)</span>&nbsp;<span class="op" id="2846510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846513">n</span>&nbsp;<span class="op" id="2846515">=</span>&nbsp;<span class="builtinfunc" id="2846517">len</span><span class="op" id="2846520">(</span><span class="ident" id="2846521">p</span><span class="op" id="2846522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846525">if</span>&nbsp;<span class="ident" id="2846528">n</span>&nbsp;<span class="op" id="2846530">==</span>&nbsp;<span class="num" id="2846533">0</span>&nbsp;<span class="op" id="2846535">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846539">return</span>&nbsp;<span class="num" id="2846546">0</span><span class="op" id="2846547">,</span>&nbsp;<span class="ident" id="2846549">b</span><span class="op" id="2846550">.</span><span class="ident" id="2846551">readErr</span><span class="op" id="2846558">(</span><span class="op" id="2846559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846565">if</span>&nbsp;<span class="ident" id="2846568">b</span><span class="op" id="2846569">.</span><span class="ident" id="2846570">r</span>&nbsp;<span class="op" id="2846572">==</span>&nbsp;<span class="ident" id="2846575">b</span><span class="op" id="2846576">.</span><span class="ident" id="2846577">w</span>&nbsp;<span class="op" id="2846579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846583">if</span>&nbsp;<span class="ident" id="2846586">b</span><span class="op" id="2846587">.</span><span class="ident" id="2846588">err</span>&nbsp;<span class="op" id="2846592">!=</span>&nbsp;<span class="ident" id="2846595">nil</span>&nbsp;<span class="op" id="2846599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846604">return</span>&nbsp;<span class="num" id="2846611">0</span><span class="op" id="2846612">,</span>&nbsp;<span class="ident" id="2846614">b</span><span class="op" id="2846615">.</span><span class="ident" id="2846616">readErr</span><span class="op" id="2846623">(</span><span class="op" id="2846624">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846632">if</span>&nbsp;<span class="builtinfunc" id="2846635">len</span><span class="op" id="2846638">(</span><span class="ident" id="2846639">p</span><span class="op" id="2846640">)</span>&nbsp;<span class="op" id="2846642">&gt;=</span>&nbsp;<span class="builtinfunc" id="2846645">len</span><span class="op" id="2846648">(</span><span class="ident" id="2846649">b</span><span class="op" id="2846650">.</span><span class="ident" id="2846651">buf</span><span class="op" id="2846654">)</span>&nbsp;<span class="op" id="2846656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2846661">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2846693">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846735">n</span><span class="op" id="2846736">,</span>&nbsp;<span class="ident" id="2846738">b</span><span class="op" id="2846739">.</span><span class="ident" id="2846740">err</span>&nbsp;<span class="op" id="2846744">=</span>&nbsp;<span class="ident" id="2846746">b</span><span class="op" id="2846747">.</span><span class="ident" id="2846748">rd</span><span class="op" id="2846750">.</span><span class="ident" id="2846751">Read</span><span class="op" id="2846755">(</span><span class="ident" id="2846756">p</span><span class="op" id="2846757">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846762">if</span>&nbsp;<span class="ident" id="2846765">n</span>&nbsp;<span class="op" id="2846767">&lt;</span>&nbsp;<span class="num" id="2846769">0</span>&nbsp;<span class="op" id="2846771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2846777">panic</span><span class="op" id="2846782">(</span><span class="ident" id="2846783">errNegativeRead</span><span class="op" id="2846798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846808">if</span>&nbsp;<span class="ident" id="2846811">n</span>&nbsp;<span class="op" id="2846813">&gt;</span>&nbsp;<span class="num" id="2846815">0</span>&nbsp;<span class="op" id="2846817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846823">b</span><span class="op" id="2846824">.</span><span class="ident" id="2846825">lastByte</span>&nbsp;<span class="op" id="2846834">=</span>&nbsp;<span class="builtintype" id="2846836">int</span><span class="op" id="2846839">(</span><span class="ident" id="2846840">p</span><span class="op" id="2846841">[</span><span class="ident" id="2846842">n</span><span class="op" id="2846843">-</span><span class="num" id="2846844">1</span><span class="op" id="2846845">]</span><span class="op" id="2846846">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846852">b</span><span class="op" id="2846853">.</span><span class="ident" id="2846854">lastRuneSize</span>&nbsp;<span class="op" id="2846867">=</span>&nbsp;<span class="op" id="2846869">-</span><span class="num" id="2846870">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846880">return</span>&nbsp;<span class="ident" id="2846887">n</span><span class="op" id="2846888">,</span>&nbsp;<span class="ident" id="2846890">b</span><span class="op" id="2846891">.</span><span class="ident" id="2846892">readErr</span><span class="op" id="2846899">(</span><span class="op" id="2846900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2846908">b</span><span class="op" id="2846909">.</span><span class="ident" id="2846910">fill</span><span class="op" id="2846914">(</span><span class="op" id="2846915">)</span>&nbsp;<span class="comment" id="2846917">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846938">if</span>&nbsp;<span class="ident" id="2846941">b</span><span class="op" id="2846942">.</span><span class="ident" id="2846943">r</span>&nbsp;<span class="op" id="2846945">==</span>&nbsp;<span class="ident" id="2846948">b</span><span class="op" id="2846949">.</span><span class="ident" id="2846950">w</span>&nbsp;<span class="op" id="2846952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2846957">return</span>&nbsp;<span class="num" id="2846964">0</span><span class="op" id="2846965">,</span>&nbsp;<span class="ident" id="2846967">b</span><span class="op" id="2846968">.</span><span class="ident" id="2846969">readErr</span><span class="op" id="2846976">(</span><span class="op" id="2846977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2846984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2846988">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847015">n</span>&nbsp;<span class="op" id="2847017">=</span>&nbsp;<span class="builtinfunc" id="2847019">copy</span><span class="op" id="2847023">(</span><span class="ident" id="2847024">p</span><span class="op" id="2847025">,</span>&nbsp;<span class="ident" id="2847027">b</span><span class="op" id="2847028">.</span><span class="ident" id="2847029">buf</span><span class="op" id="2847032">[</span><span class="ident" id="2847033">b</span><span class="op" id="2847034">.</span><span class="ident" id="2847035">r</span><span class="op" id="2847036">:</span><span class="ident" id="2847037">b</span><span class="op" id="2847038">.</span><span class="ident" id="2847039">w</span><span class="op" id="2847040">]</span><span class="op" id="2847041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847044">b</span><span class="op" id="2847045">.</span><span class="ident" id="2847046">r</span>&nbsp;<span class="op" id="2847048">+=</span>&nbsp;<span class="ident" id="2847051">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847054">b</span><span class="op" id="2847055">.</span><span class="ident" id="2847056">lastByte</span>&nbsp;<span class="op" id="2847065">=</span>&nbsp;<span class="builtintype" id="2847067">int</span><span class="op" id="2847070">(</span><span class="ident" id="2847071">b</span><span class="op" id="2847072">.</span><span class="ident" id="2847073">buf</span><span class="op" id="2847076">[</span><span class="ident" id="2847077">b</span><span class="op" id="2847078">.</span><span class="ident" id="2847079">r</span><span class="op" id="2847080">-</span><span class="num" id="2847081">1</span><span class="op" id="2847082">]</span><span class="op" id="2847083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847086">b</span><span class="op" id="2847087">.</span><span class="ident" id="2847088">lastRuneSize</span>&nbsp;<span class="op" id="2847101">=</span>&nbsp;<span class="op" id="2847103">-</span><span class="num" id="2847104">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847107">return</span>&nbsp;<span class="ident" id="2847114">n</span><span class="op" id="2847115">,</span>&nbsp;<span class="ident" id="2847117">nil</span><br>
<span class="lineno"></span><span class="op" id="2847121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2847124">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="2847169">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="2847215">func</span>&nbsp;<span class="op" id="2847220">(</span><span class="ident" id="2847221">b</span>&nbsp;<span class="op" id="2847223">*</span><span class="ident" id="2847224">Reader</span><span class="op" id="2847230">)</span>&nbsp;<span class="ident" id="2847232">ReadByte</span><span class="op" id="2847240">(</span><span class="op" id="2847241">)</span>&nbsp;<span class="op" id="2847243">(</span><span class="ident" id="2847244">c</span>&nbsp;<span class="builtintype" id="2847246">byte</span><span class="op" id="2847250">,</span>&nbsp;<span class="ident" id="2847252">err</span>&nbsp;<span class="builtintype" id="2847256">error</span><span class="op" id="2847261">)</span>&nbsp;<span class="op" id="2847263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847266">b</span><span class="op" id="2847267">.</span><span class="ident" id="2847268">lastRuneSize</span>&nbsp;<span class="op" id="2847281">=</span>&nbsp;<span class="op" id="2847283">-</span><span class="num" id="2847284">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847287">for</span>&nbsp;<span class="ident" id="2847291">b</span><span class="op" id="2847292">.</span><span class="ident" id="2847293">r</span>&nbsp;<span class="op" id="2847295">==</span>&nbsp;<span class="ident" id="2847298">b</span><span class="op" id="2847299">.</span><span class="ident" id="2847300">w</span>&nbsp;<span class="op" id="2847302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847306">if</span>&nbsp;<span class="ident" id="2847309">b</span><span class="op" id="2847310">.</span><span class="ident" id="2847311">err</span>&nbsp;<span class="op" id="2847315">!=</span>&nbsp;<span class="ident" id="2847318">nil</span>&nbsp;<span class="op" id="2847322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847327">return</span>&nbsp;<span class="num" id="2847334">0</span><span class="op" id="2847335">,</span>&nbsp;<span class="ident" id="2847337">b</span><span class="op" id="2847338">.</span><span class="ident" id="2847339">readErr</span><span class="op" id="2847346">(</span><span class="op" id="2847347">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2847351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847355">b</span><span class="op" id="2847356">.</span><span class="ident" id="2847357">fill</span><span class="op" id="2847361">(</span><span class="op" id="2847362">)</span>&nbsp;<span class="comment" id="2847364">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2847384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847387">c</span>&nbsp;<span class="op" id="2847389">=</span>&nbsp;<span class="ident" id="2847391">b</span><span class="op" id="2847392">.</span><span class="ident" id="2847393">buf</span><span class="op" id="2847396">[</span><span class="ident" id="2847397">b</span><span class="op" id="2847398">.</span><span class="ident" id="2847399">r</span><span class="op" id="2847400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847403">b</span><span class="op" id="2847404">.</span><span class="ident" id="2847405">r</span><span class="op" id="2847406">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847410">b</span><span class="op" id="2847411">.</span><span class="ident" id="2847412">lastByte</span>&nbsp;<span class="op" id="2847421">=</span>&nbsp;<span class="builtintype" id="2847423">int</span><span class="op" id="2847426">(</span><span class="ident" id="2847427">c</span><span class="op" id="2847428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847431">return</span>&nbsp;<span class="ident" id="2847438">c</span><span class="op" id="2847439">,</span>&nbsp;<span class="ident" id="2847441">nil</span><br>
<span class="lineno"></span><span class="op" id="2847445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2847448">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="2847534">func</span>&nbsp;<span class="op" id="2847539">(</span><span class="ident" id="2847540">b</span>&nbsp;<span class="op" id="2847542">*</span><span class="ident" id="2847543">Reader</span><span class="op" id="2847549">)</span>&nbsp;<span class="ident" id="2847551">UnreadByte</span><span class="op" id="2847561">(</span><span class="op" id="2847562">)</span>&nbsp;<span class="builtintype" id="2847564">error</span>&nbsp;<span class="op" id="2847570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847573">if</span>&nbsp;<span class="ident" id="2847576">b</span><span class="op" id="2847577">.</span><span class="ident" id="2847578">lastByte</span>&nbsp;<span class="op" id="2847587">&lt;</span>&nbsp;<span class="num" id="2847589">0</span>&nbsp;<span class="op" id="2847591">||</span>&nbsp;<span class="ident" id="2847594">b</span><span class="op" id="2847595">.</span><span class="ident" id="2847596">r</span>&nbsp;<span class="op" id="2847598">==</span>&nbsp;<span class="num" id="2847601">0</span>&nbsp;<span class="op" id="2847603">&amp;&amp;</span>&nbsp;<span class="ident" id="2847606">b</span><span class="op" id="2847607">.</span><span class="ident" id="2847608">w</span>&nbsp;<span class="op" id="2847610">&gt;</span>&nbsp;<span class="num" id="2847612">0</span>&nbsp;<span class="op" id="2847614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847618">return</span>&nbsp;<span class="ident" id="2847625">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2847647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2847650">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847674">if</span>&nbsp;<span class="ident" id="2847677">b</span><span class="op" id="2847678">.</span><span class="ident" id="2847679">r</span>&nbsp;<span class="op" id="2847681">&gt;</span>&nbsp;<span class="num" id="2847683">0</span>&nbsp;<span class="op" id="2847685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847689">b</span><span class="op" id="2847690">.</span><span class="ident" id="2847691">r</span><span class="op" id="2847692">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2847696">}</span>&nbsp;<span class="keyword" id="2847698">else</span>&nbsp;<span class="op" id="2847703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2847707">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847733">b</span><span class="op" id="2847734">.</span><span class="ident" id="2847735">w</span>&nbsp;<span class="op" id="2847737">=</span>&nbsp;<span class="num" id="2847739">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2847742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847745">b</span><span class="op" id="2847746">.</span><span class="ident" id="2847747">buf</span><span class="op" id="2847750">[</span><span class="ident" id="2847751">b</span><span class="op" id="2847752">.</span><span class="ident" id="2847753">r</span><span class="op" id="2847754">]</span>&nbsp;<span class="op" id="2847756">=</span>&nbsp;<span class="builtintype" id="2847758">byte</span><span class="op" id="2847762">(</span><span class="ident" id="2847763">b</span><span class="op" id="2847764">.</span><span class="ident" id="2847765">lastByte</span><span class="op" id="2847773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847776">b</span><span class="op" id="2847777">.</span><span class="ident" id="2847778">lastByte</span>&nbsp;<span class="op" id="2847787">=</span>&nbsp;<span class="op" id="2847789">-</span><span class="num" id="2847790">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2847793">b</span><span class="op" id="2847794">.</span><span class="ident" id="2847795">lastRuneSize</span>&nbsp;<span class="op" id="2847808">=</span>&nbsp;<span class="op" id="2847810">-</span><span class="num" id="2847811">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2847814">return</span>&nbsp;<span class="ident" id="2847821">nil</span><br>
<span class="lineno">220</span><span class="op" id="2847825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2847828">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2847903">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2847987">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="2848053">func</span>&nbsp;<span class="op" id="2848058">(</span><span class="ident" id="2848059">b</span>&nbsp;<span class="op" id="2848061">*</span><span class="ident" id="2848062">Reader</span><span class="op" id="2848068">)</span>&nbsp;<span class="ident" id="2848070">ReadRune</span><span class="op" id="2848078">(</span><span class="op" id="2848079">)</span>&nbsp;<span class="op" id="2848081">(</span><span class="ident" id="2848082">r</span>&nbsp;<span class="builtintype" id="2848084">rune</span><span class="op" id="2848088">,</span>&nbsp;<span class="ident" id="2848090">size</span>&nbsp;<span class="builtintype" id="2848095">int</span><span class="op" id="2848098">,</span>&nbsp;<span class="ident" id="2848100">err</span>&nbsp;<span class="builtintype" id="2848104">error</span><span class="op" id="2848109">)</span>&nbsp;<span class="op" id="2848111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848114">for</span>&nbsp;<span class="ident" id="2848118">b</span><span class="op" id="2848119">.</span><span class="ident" id="2848120">r</span><span class="op" id="2848121">+</span><span class="ident" id="2848122">utf8</span><span class="op" id="2848126">.</span><span class="ident" id="2848127">UTFMax</span>&nbsp;<span class="op" id="2848134">&gt;</span>&nbsp;<span class="ident" id="2848136">b</span><span class="op" id="2848137">.</span><span class="ident" id="2848138">w</span>&nbsp;<span class="op" id="2848140">&amp;&amp;</span>&nbsp;<span class="op" id="2848143">!</span><span class="ident" id="2848144">utf8</span><span class="op" id="2848148">.</span><span class="ident" id="2848149">FullRune</span><span class="op" id="2848157">(</span><span class="ident" id="2848158">b</span><span class="op" id="2848159">.</span><span class="ident" id="2848160">buf</span><span class="op" id="2848163">[</span><span class="ident" id="2848164">b</span><span class="op" id="2848165">.</span><span class="ident" id="2848166">r</span><span class="op" id="2848167">:</span><span class="ident" id="2848168">b</span><span class="op" id="2848169">.</span><span class="ident" id="2848170">w</span><span class="op" id="2848171">]</span><span class="op" id="2848172">)</span>&nbsp;<span class="op" id="2848174">&amp;&amp;</span>&nbsp;<span class="ident" id="2848177">b</span><span class="op" id="2848178">.</span><span class="ident" id="2848179">err</span>&nbsp;<span class="op" id="2848183">==</span>&nbsp;<span class="ident" id="2848186">nil</span>&nbsp;<span class="op" id="2848190">&amp;&amp;</span>&nbsp;<span class="ident" id="2848193">b</span><span class="op" id="2848194">.</span><span class="ident" id="2848195">w</span><span class="op" id="2848196">-</span><span class="ident" id="2848197">b</span><span class="op" id="2848198">.</span><span class="ident" id="2848199">r</span>&nbsp;<span class="op" id="2848201">&lt;</span>&nbsp;<span class="builtinfunc" id="2848203">len</span><span class="op" id="2848206">(</span><span class="ident" id="2848207">b</span><span class="op" id="2848208">.</span><span class="ident" id="2848209">buf</span><span class="op" id="2848212">)</span>&nbsp;<span class="op" id="2848214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848218">b</span><span class="op" id="2848219">.</span><span class="ident" id="2848220">fill</span><span class="op" id="2848224">(</span><span class="op" id="2848225">)</span>&nbsp;<span class="comment" id="2848227">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2848272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848275">b</span><span class="op" id="2848276">.</span><span class="ident" id="2848277">lastRuneSize</span>&nbsp;<span class="op" id="2848290">=</span>&nbsp;<span class="op" id="2848292">-</span><span class="num" id="2848293">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848296">if</span>&nbsp;<span class="ident" id="2848299">b</span><span class="op" id="2848300">.</span><span class="ident" id="2848301">r</span>&nbsp;<span class="op" id="2848303">==</span>&nbsp;<span class="ident" id="2848306">b</span><span class="op" id="2848307">.</span><span class="ident" id="2848308">w</span>&nbsp;<span class="op" id="2848310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848314">return</span>&nbsp;<span class="num" id="2848321">0</span><span class="op" id="2848322">,</span>&nbsp;<span class="num" id="2848324">0</span><span class="op" id="2848325">,</span>&nbsp;<span class="ident" id="2848327">b</span><span class="op" id="2848328">.</span><span class="ident" id="2848329">readErr</span><span class="op" id="2848336">(</span><span class="op" id="2848337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2848340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848343">r</span><span class="op" id="2848344">,</span>&nbsp;<span class="ident" id="2848346">size</span>&nbsp;<span class="op" id="2848351">=</span>&nbsp;<span class="builtintype" id="2848353">rune</span><span class="op" id="2848357">(</span><span class="ident" id="2848358">b</span><span class="op" id="2848359">.</span><span class="ident" id="2848360">buf</span><span class="op" id="2848363">[</span><span class="ident" id="2848364">b</span><span class="op" id="2848365">.</span><span class="ident" id="2848366">r</span><span class="op" id="2848367">]</span><span class="op" id="2848368">)</span><span class="op" id="2848369">,</span>&nbsp;<span class="num" id="2848371">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848374">if</span>&nbsp;<span class="ident" id="2848377">r</span>&nbsp;<span class="op" id="2848379">&gt;=</span>&nbsp;<span class="num" id="2848382">0x80</span>&nbsp;<span class="op" id="2848387">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848391">r</span><span class="op" id="2848392">,</span>&nbsp;<span class="ident" id="2848394">size</span>&nbsp;<span class="op" id="2848399">=</span>&nbsp;<span class="ident" id="2848401">utf8</span><span class="op" id="2848405">.</span><span class="ident" id="2848406">DecodeRune</span><span class="op" id="2848416">(</span><span class="ident" id="2848417">b</span><span class="op" id="2848418">.</span><span class="ident" id="2848419">buf</span><span class="op" id="2848422">[</span><span class="ident" id="2848423">b</span><span class="op" id="2848424">.</span><span class="ident" id="2848425">r</span><span class="op" id="2848426">:</span><span class="ident" id="2848427">b</span><span class="op" id="2848428">.</span><span class="ident" id="2848429">w</span><span class="op" id="2848430">]</span><span class="op" id="2848431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2848434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848437">b</span><span class="op" id="2848438">.</span><span class="ident" id="2848439">r</span>&nbsp;<span class="op" id="2848441">+=</span>&nbsp;<span class="ident" id="2848444">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848450">b</span><span class="op" id="2848451">.</span><span class="ident" id="2848452">lastByte</span>&nbsp;<span class="op" id="2848461">=</span>&nbsp;<span class="builtintype" id="2848463">int</span><span class="op" id="2848466">(</span><span class="ident" id="2848467">b</span><span class="op" id="2848468">.</span><span class="ident" id="2848469">buf</span><span class="op" id="2848472">[</span><span class="ident" id="2848473">b</span><span class="op" id="2848474">.</span><span class="ident" id="2848475">r</span><span class="op" id="2848476">-</span><span class="num" id="2848477">1</span><span class="op" id="2848478">]</span><span class="op" id="2848479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848482">b</span><span class="op" id="2848483">.</span><span class="ident" id="2848484">lastRuneSize</span>&nbsp;<span class="op" id="2848497">=</span>&nbsp;<span class="ident" id="2848499">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848505">return</span>&nbsp;<span class="ident" id="2848512">r</span><span class="op" id="2848513">,</span>&nbsp;<span class="ident" id="2848515">size</span><span class="op" id="2848519">,</span>&nbsp;<span class="ident" id="2848521">nil</span><br>
<span class="lineno"></span><span class="op" id="2848525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2848528">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2848603">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="2848676">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2848750">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="2848779">func</span>&nbsp;<span class="op" id="2848784">(</span><span class="ident" id="2848785">b</span>&nbsp;<span class="op" id="2848787">*</span><span class="ident" id="2848788">Reader</span><span class="op" id="2848794">)</span>&nbsp;<span class="ident" id="2848796">UnreadRune</span><span class="op" id="2848806">(</span><span class="op" id="2848807">)</span>&nbsp;<span class="builtintype" id="2848809">error</span>&nbsp;<span class="op" id="2848815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848818">if</span>&nbsp;<span class="ident" id="2848821">b</span><span class="op" id="2848822">.</span><span class="ident" id="2848823">lastRuneSize</span>&nbsp;<span class="op" id="2848836">&lt;</span>&nbsp;<span class="num" id="2848838">0</span>&nbsp;<span class="op" id="2848840">||</span>&nbsp;<span class="ident" id="2848843">b</span><span class="op" id="2848844">.</span><span class="ident" id="2848845">r</span>&nbsp;<span class="op" id="2848847">&lt;</span>&nbsp;<span class="ident" id="2848849">b</span><span class="op" id="2848850">.</span><span class="ident" id="2848851">lastRuneSize</span>&nbsp;<span class="op" id="2848864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848868">return</span>&nbsp;<span class="ident" id="2848875">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2848897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848900">b</span><span class="op" id="2848901">.</span><span class="ident" id="2848902">r</span>&nbsp;<span class="op" id="2848904">-=</span>&nbsp;<span class="ident" id="2848907">b</span><span class="op" id="2848908">.</span><span class="ident" id="2848909">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848923">b</span><span class="op" id="2848924">.</span><span class="ident" id="2848925">lastByte</span>&nbsp;<span class="op" id="2848934">=</span>&nbsp;<span class="op" id="2848936">-</span><span class="num" id="2848937">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2848940">b</span><span class="op" id="2848941">.</span><span class="ident" id="2848942">lastRuneSize</span>&nbsp;<span class="op" id="2848955">=</span>&nbsp;<span class="op" id="2848957">-</span><span class="num" id="2848958">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2848961">return</span>&nbsp;<span class="ident" id="2848968">nil</span><br>
<span class="lineno">255</span><span class="op" id="2848972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2848975">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2849057">func</span>&nbsp;<span class="op" id="2849062">(</span><span class="ident" id="2849063">b</span>&nbsp;<span class="op" id="2849065">*</span><span class="ident" id="2849066">Reader</span><span class="op" id="2849072">)</span>&nbsp;<span class="ident" id="2849074">Buffered</span><span class="op" id="2849082">(</span><span class="op" id="2849083">)</span>&nbsp;<span class="builtintype" id="2849085">int</span>&nbsp;<span class="op" id="2849089">{</span>&nbsp;<span class="keyword" id="2849091">return</span>&nbsp;<span class="ident" id="2849098">b</span><span class="op" id="2849099">.</span><span class="ident" id="2849100">w</span>&nbsp;<span class="op" id="2849102">-</span>&nbsp;<span class="ident" id="2849104">b</span><span class="op" id="2849105">.</span><span class="ident" id="2849106">r</span>&nbsp;<span class="op" id="2849108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="2849111">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2849180">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2849238">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="2849286">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2849350">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="2849428">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2849509">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="2849573">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2849627">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2849663">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="2849738">func</span>&nbsp;<span class="op" id="2849743">(</span><span class="ident" id="2849744">b</span>&nbsp;<span class="op" id="2849746">*</span><span class="ident" id="2849747">Reader</span><span class="op" id="2849753">)</span>&nbsp;<span class="ident" id="2849755">ReadSlice</span><span class="op" id="2849764">(</span><span class="ident" id="2849765">delim</span>&nbsp;<span class="builtintype" id="2849771">byte</span><span class="op" id="2849775">)</span>&nbsp;<span class="op" id="2849777">(</span><span class="ident" id="2849778">line</span>&nbsp;<span class="op" id="2849783">[</span><span class="op" id="2849784">]</span><span class="builtintype" id="2849785">byte</span><span class="op" id="2849789">,</span>&nbsp;<span class="ident" id="2849791">err</span>&nbsp;<span class="builtintype" id="2849795">error</span><span class="op" id="2849800">)</span>&nbsp;<span class="op" id="2849802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2849805">for</span>&nbsp;<span class="op" id="2849809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2849813">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2849833">if</span>&nbsp;<span class="ident" id="2849836">i</span>&nbsp;<span class="op" id="2849838">:=</span>&nbsp;<span class="ident" id="2849841">bytes</span><span class="op" id="2849846">.</span><span class="ident" id="2849847">IndexByte</span><span class="op" id="2849856">(</span><span class="ident" id="2849857">b</span><span class="op" id="2849858">.</span><span class="ident" id="2849859">buf</span><span class="op" id="2849862">[</span><span class="ident" id="2849863">b</span><span class="op" id="2849864">.</span><span class="ident" id="2849865">r</span><span class="op" id="2849866">:</span><span class="ident" id="2849867">b</span><span class="op" id="2849868">.</span><span class="ident" id="2849869">w</span><span class="op" id="2849870">]</span><span class="op" id="2849871">,</span>&nbsp;<span class="ident" id="2849873">delim</span><span class="op" id="2849878">)</span><span class="op" id="2849879">;</span>&nbsp;<span class="ident" id="2849881">i</span>&nbsp;<span class="op" id="2849883">&gt;=</span>&nbsp;<span class="num" id="2849886">0</span>&nbsp;<span class="op" id="2849888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2849893">line</span>&nbsp;<span class="op" id="2849898">=</span>&nbsp;<span class="ident" id="2849900">b</span><span class="op" id="2849901">.</span><span class="ident" id="2849902">buf</span><span class="op" id="2849905">[</span><span class="ident" id="2849906">b</span><span class="op" id="2849907">.</span><span class="ident" id="2849908">r</span>&nbsp;<span class="op" id="2849910">:</span>&nbsp;<span class="ident" id="2849912">b</span><span class="op" id="2849913">.</span><span class="ident" id="2849914">r</span><span class="op" id="2849915">+</span><span class="ident" id="2849916">i</span><span class="op" id="2849917">+</span><span class="num" id="2849918">1</span><span class="op" id="2849919">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2849924">b</span><span class="op" id="2849925">.</span><span class="ident" id="2849926">r</span>&nbsp;<span class="op" id="2849928">+=</span>&nbsp;<span class="ident" id="2849931">i</span>&nbsp;<span class="op" id="2849933">+</span>&nbsp;<span class="num" id="2849935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2849940">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2849948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2849953">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2849973">if</span>&nbsp;<span class="ident" id="2849976">b</span><span class="op" id="2849977">.</span><span class="ident" id="2849978">err</span>&nbsp;<span class="op" id="2849982">!=</span>&nbsp;<span class="ident" id="2849985">nil</span>&nbsp;<span class="op" id="2849989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2849994">line</span>&nbsp;<span class="op" id="2849999">=</span>&nbsp;<span class="ident" id="2850001">b</span><span class="op" id="2850002">.</span><span class="ident" id="2850003">buf</span><span class="op" id="2850006">[</span><span class="ident" id="2850007">b</span><span class="op" id="2850008">.</span><span class="ident" id="2850009">r</span><span class="op" id="2850010">:</span><span class="ident" id="2850011">b</span><span class="op" id="2850012">.</span><span class="ident" id="2850013">w</span><span class="op" id="2850014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850019">b</span><span class="op" id="2850020">.</span><span class="ident" id="2850021">r</span>&nbsp;<span class="op" id="2850023">=</span>&nbsp;<span class="ident" id="2850025">b</span><span class="op" id="2850026">.</span><span class="ident" id="2850027">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850032">err</span>&nbsp;<span class="op" id="2850036">=</span>&nbsp;<span class="ident" id="2850038">b</span><span class="op" id="2850039">.</span><span class="ident" id="2850040">readErr</span><span class="op" id="2850047">(</span><span class="op" id="2850048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2850053">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2850061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2850066">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2850084">if</span>&nbsp;<span class="ident" id="2850087">b</span><span class="op" id="2850088">.</span><span class="ident" id="2850089">Buffered</span><span class="op" id="2850097">(</span><span class="op" id="2850098">)</span>&nbsp;<span class="op" id="2850100">&gt;=</span>&nbsp;<span class="builtinfunc" id="2850103">len</span><span class="op" id="2850106">(</span><span class="ident" id="2850107">b</span><span class="op" id="2850108">.</span><span class="ident" id="2850109">buf</span><span class="op" id="2850112">)</span>&nbsp;<span class="op" id="2850114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850119">b</span><span class="op" id="2850120">.</span><span class="ident" id="2850121">r</span>&nbsp;<span class="op" id="2850123">=</span>&nbsp;<span class="ident" id="2850125">b</span><span class="op" id="2850126">.</span><span class="ident" id="2850127">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850132">line</span>&nbsp;<span class="op" id="2850137">=</span>&nbsp;<span class="ident" id="2850139">b</span><span class="op" id="2850140">.</span><span class="ident" id="2850141">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850148">err</span>&nbsp;<span class="op" id="2850152">=</span>&nbsp;<span class="ident" id="2850154">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2850171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2850179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850184">b</span><span class="op" id="2850185">.</span><span class="ident" id="2850186">fill</span><span class="op" id="2850190">(</span><span class="op" id="2850191">)</span>&nbsp;<span class="comment" id="2850193">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2850216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2850220">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2850250">if</span>&nbsp;<span class="ident" id="2850253">i</span>&nbsp;<span class="op" id="2850255">:=</span>&nbsp;<span class="builtinfunc" id="2850258">len</span><span class="op" id="2850261">(</span><span class="ident" id="2850262">line</span><span class="op" id="2850266">)</span>&nbsp;<span class="op" id="2850268">-</span>&nbsp;<span class="num" id="2850270">1</span><span class="op" id="2850271">;</span>&nbsp;<span class="ident" id="2850273">i</span>&nbsp;<span class="op" id="2850275">&gt;=</span>&nbsp;<span class="num" id="2850278">0</span>&nbsp;<span class="op" id="2850280">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850284">b</span><span class="op" id="2850285">.</span><span class="ident" id="2850286">lastByte</span>&nbsp;<span class="op" id="2850295">=</span>&nbsp;<span class="builtintype" id="2850297">int</span><span class="op" id="2850300">(</span><span class="ident" id="2850301">line</span><span class="op" id="2850305">[</span><span class="ident" id="2850306">i</span><span class="op" id="2850307">]</span><span class="op" id="2850308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2850312">b</span><span class="op" id="2850313">.</span><span class="ident" id="2850314">lastRuneSize</span>&nbsp;<span class="op" id="2850327">=</span>&nbsp;<span class="op" id="2850329">-</span><span class="num" id="2850330">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2850333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2850337">return</span><br>
<span class="lineno">305</span><span class="op" id="2850344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2850347">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2850422">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="2850487">//</span><br>
<span class="lineno">310</span><span class="comment" id="2850490">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2850570">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2850642">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="2850718">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="2850796">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="2850869">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="2850945">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="2850960">//</span><br>
<span class="lineno"></span><span class="comment" id="2850963">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="2851046">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="2851125">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2851200">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2851277">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="2851319">func</span>&nbsp;<span class="op" id="2851324">(</span><span class="ident" id="2851325">b</span>&nbsp;<span class="op" id="2851327">*</span><span class="ident" id="2851328">Reader</span><span class="op" id="2851334">)</span>&nbsp;<span class="ident" id="2851336">ReadLine</span><span class="op" id="2851344">(</span><span class="op" id="2851345">)</span>&nbsp;<span class="op" id="2851347">(</span><span class="ident" id="2851348">line</span>&nbsp;<span class="op" id="2851353">[</span><span class="op" id="2851354">]</span><span class="builtintype" id="2851355">byte</span><span class="op" id="2851359">,</span>&nbsp;<span class="ident" id="2851361">isPrefix</span>&nbsp;<span class="builtintype" id="2851370">bool</span><span class="op" id="2851374">,</span>&nbsp;<span class="ident" id="2851376">err</span>&nbsp;<span class="builtintype" id="2851380">error</span><span class="op" id="2851385">)</span>&nbsp;<span class="op" id="2851387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851390">line</span><span class="op" id="2851394">,</span>&nbsp;<span class="ident" id="2851396">err</span>&nbsp;<span class="op" id="2851400">=</span>&nbsp;<span class="ident" id="2851402">b</span><span class="op" id="2851403">.</span><span class="ident" id="2851404">ReadSlice</span><span class="op" id="2851413">(</span><span class="string" id="2851414">&#39;\n&#39;</span><span class="op" id="2851418">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851421">if</span>&nbsp;<span class="ident" id="2851424">err</span>&nbsp;<span class="op" id="2851428">==</span>&nbsp;<span class="ident" id="2851431">ErrBufferFull</span>&nbsp;<span class="op" id="2851445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2851449">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851505">if</span>&nbsp;<span class="builtinfunc" id="2851508">len</span><span class="op" id="2851511">(</span><span class="ident" id="2851512">line</span><span class="op" id="2851516">)</span>&nbsp;<span class="op" id="2851518">&gt;</span>&nbsp;<span class="num" id="2851520">0</span>&nbsp;<span class="op" id="2851522">&amp;&amp;</span>&nbsp;<span class="ident" id="2851525">line</span><span class="op" id="2851529">[</span><span class="builtinfunc" id="2851530">len</span><span class="op" id="2851533">(</span><span class="ident" id="2851534">line</span><span class="op" id="2851538">)</span><span class="op" id="2851539">-</span><span class="num" id="2851540">1</span><span class="op" id="2851541">]</span>&nbsp;<span class="op" id="2851543">==</span>&nbsp;<span class="string" id="2851546">&#39;\r&#39;</span>&nbsp;<span class="op" id="2851551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2851556">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2851610">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851664">if</span>&nbsp;<span class="ident" id="2851667">b</span><span class="op" id="2851668">.</span><span class="ident" id="2851669">r</span>&nbsp;<span class="op" id="2851671">==</span>&nbsp;<span class="num" id="2851674">0</span>&nbsp;<span class="op" id="2851676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2851682">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2851711">panic</span><span class="op" id="2851716">(</span><span class="string" id="2851717">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="2851762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2851767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851772">b</span><span class="op" id="2851773">.</span><span class="ident" id="2851774">r</span><span class="op" id="2851775">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851781">line</span>&nbsp;<span class="op" id="2851786">=</span>&nbsp;<span class="ident" id="2851788">line</span><span class="op" id="2851792">[</span><span class="op" id="2851793">:</span><span class="builtinfunc" id="2851794">len</span><span class="op" id="2851797">(</span><span class="ident" id="2851798">line</span><span class="op" id="2851802">)</span><span class="op" id="2851803">-</span><span class="num" id="2851804">1</span><span class="op" id="2851805">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2851809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851813">return</span>&nbsp;<span class="ident" id="2851820">line</span><span class="op" id="2851824">,</span>&nbsp;<span class="builtintype" id="2851826">true</span><span class="op" id="2851830">,</span>&nbsp;<span class="ident" id="2851832">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2851837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851841">if</span>&nbsp;<span class="builtinfunc" id="2851844">len</span><span class="op" id="2851847">(</span><span class="ident" id="2851848">line</span><span class="op" id="2851852">)</span>&nbsp;<span class="op" id="2851854">==</span>&nbsp;<span class="num" id="2851857">0</span>&nbsp;<span class="op" id="2851859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851863">if</span>&nbsp;<span class="ident" id="2851866">err</span>&nbsp;<span class="op" id="2851870">!=</span>&nbsp;<span class="ident" id="2851873">nil</span>&nbsp;<span class="op" id="2851877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851882">line</span>&nbsp;<span class="op" id="2851887">=</span>&nbsp;<span class="ident" id="2851889">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2851895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851899">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2851907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851910">err</span>&nbsp;<span class="op" id="2851914">=</span>&nbsp;<span class="ident" id="2851916">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851922">if</span>&nbsp;<span class="ident" id="2851925">line</span><span class="op" id="2851929">[</span><span class="builtinfunc" id="2851930">len</span><span class="op" id="2851933">(</span><span class="ident" id="2851934">line</span><span class="op" id="2851938">)</span><span class="op" id="2851939">-</span><span class="num" id="2851940">1</span><span class="op" id="2851941">]</span>&nbsp;<span class="op" id="2851943">==</span>&nbsp;<span class="string" id="2851946">&#39;\n&#39;</span>&nbsp;<span class="op" id="2851951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2851955">drop</span>&nbsp;<span class="op" id="2851960">:=</span>&nbsp;<span class="num" id="2851963">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2851967">if</span>&nbsp;<span class="builtinfunc" id="2851970">len</span><span class="op" id="2851973">(</span><span class="ident" id="2851974">line</span><span class="op" id="2851978">)</span>&nbsp;<span class="op" id="2851980">&gt;</span>&nbsp;<span class="num" id="2851982">1</span>&nbsp;<span class="op" id="2851984">&amp;&amp;</span>&nbsp;<span class="ident" id="2851987">line</span><span class="op" id="2851991">[</span><span class="builtinfunc" id="2851992">len</span><span class="op" id="2851995">(</span><span class="ident" id="2851996">line</span><span class="op" id="2852000">)</span><span class="op" id="2852001">-</span><span class="num" id="2852002">2</span><span class="op" id="2852003">]</span>&nbsp;<span class="op" id="2852005">==</span>&nbsp;<span class="string" id="2852008">&#39;\r&#39;</span>&nbsp;<span class="op" id="2852013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852018">drop</span>&nbsp;<span class="op" id="2852023">=</span>&nbsp;<span class="num" id="2852025">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2852029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852033">line</span>&nbsp;<span class="op" id="2852038">=</span>&nbsp;<span class="ident" id="2852040">line</span><span class="op" id="2852044">[</span><span class="op" id="2852045">:</span><span class="builtinfunc" id="2852046">len</span><span class="op" id="2852049">(</span><span class="ident" id="2852050">line</span><span class="op" id="2852054">)</span><span class="op" id="2852055">-</span><span class="ident" id="2852056">drop</span><span class="op" id="2852060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2852063">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852066">return</span><br>
<span class="lineno"></span><span class="op" id="2852073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2852076">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2852145">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="2852221">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2852285">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="2852367">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2852448">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2852458">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="2852512">func</span>&nbsp;<span class="op" id="2852517">(</span><span class="ident" id="2852518">b</span>&nbsp;<span class="op" id="2852520">*</span><span class="ident" id="2852521">Reader</span><span class="op" id="2852527">)</span>&nbsp;<span class="ident" id="2852529">ReadBytes</span><span class="op" id="2852538">(</span><span class="ident" id="2852539">delim</span>&nbsp;<span class="builtintype" id="2852545">byte</span><span class="op" id="2852549">)</span>&nbsp;<span class="op" id="2852551">(</span><span class="ident" id="2852552">line</span>&nbsp;<span class="op" id="2852557">[</span><span class="op" id="2852558">]</span><span class="builtintype" id="2852559">byte</span><span class="op" id="2852563">,</span>&nbsp;<span class="ident" id="2852565">err</span>&nbsp;<span class="builtintype" id="2852569">error</span><span class="op" id="2852574">)</span>&nbsp;<span class="op" id="2852576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2852579">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2852616">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852647">var</span>&nbsp;<span class="ident" id="2852651">frag</span>&nbsp;<span class="op" id="2852656">[</span><span class="op" id="2852657">]</span><span class="builtintype" id="2852658">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852664">var</span>&nbsp;<span class="ident" id="2852668">full</span>&nbsp;<span class="op" id="2852673">[</span><span class="op" id="2852674">]</span><span class="op" id="2852675">[</span><span class="op" id="2852676">]</span><span class="builtintype" id="2852677">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852683">err</span>&nbsp;<span class="op" id="2852687">=</span>&nbsp;<span class="ident" id="2852689">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852695">for</span>&nbsp;<span class="op" id="2852699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852703">var</span>&nbsp;<span class="ident" id="2852707">e</span>&nbsp;<span class="builtintype" id="2852709">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852717">frag</span><span class="op" id="2852721">,</span>&nbsp;<span class="ident" id="2852723">e</span>&nbsp;<span class="op" id="2852725">=</span>&nbsp;<span class="ident" id="2852727">b</span><span class="op" id="2852728">.</span><span class="ident" id="2852729">ReadSlice</span><span class="op" id="2852738">(</span><span class="ident" id="2852739">delim</span><span class="op" id="2852744">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852748">if</span>&nbsp;<span class="ident" id="2852751">e</span>&nbsp;<span class="op" id="2852753">==</span>&nbsp;<span class="ident" id="2852756">nil</span>&nbsp;<span class="op" id="2852760">{</span>&nbsp;<span class="comment" id="2852762">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852787">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2852795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852799">if</span>&nbsp;<span class="ident" id="2852802">e</span>&nbsp;<span class="op" id="2852804">!=</span>&nbsp;<span class="ident" id="2852807">ErrBufferFull</span>&nbsp;<span class="op" id="2852821">{</span>&nbsp;<span class="comment" id="2852823">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852846">err</span>&nbsp;<span class="op" id="2852850">=</span>&nbsp;<span class="ident" id="2852852">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2852857">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2852865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2852870">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852902">buf</span>&nbsp;<span class="op" id="2852906">:=</span>&nbsp;<span class="builtinfunc" id="2852909">make</span><span class="op" id="2852913">(</span><span class="op" id="2852914">[</span><span class="op" id="2852915">]</span><span class="builtintype" id="2852916">byte</span><span class="op" id="2852920">,</span>&nbsp;<span class="builtinfunc" id="2852922">len</span><span class="op" id="2852925">(</span><span class="ident" id="2852926">frag</span><span class="op" id="2852930">)</span><span class="op" id="2852931">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2852935">copy</span><span class="op" id="2852939">(</span><span class="ident" id="2852940">buf</span><span class="op" id="2852943">,</span>&nbsp;<span class="ident" id="2852945">frag</span><span class="op" id="2852949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2852953">full</span>&nbsp;<span class="op" id="2852958">=</span>&nbsp;<span class="builtinfunc" id="2852960">append</span><span class="op" id="2852966">(</span><span class="ident" id="2852967">full</span><span class="op" id="2852971">,</span>&nbsp;<span class="ident" id="2852973">buf</span><span class="op" id="2852976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2852979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2852983">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853049">n</span>&nbsp;<span class="op" id="2853051">:=</span>&nbsp;<span class="num" id="2853054">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2853057">for</span>&nbsp;<span class="ident" id="2853061">i</span>&nbsp;<span class="op" id="2853063">:=</span>&nbsp;<span class="keyword" id="2853066">range</span>&nbsp;<span class="ident" id="2853072">full</span>&nbsp;<span class="op" id="2853077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853081">n</span>&nbsp;<span class="op" id="2853083">+=</span>&nbsp;<span class="builtinfunc" id="2853086">len</span><span class="op" id="2853089">(</span><span class="ident" id="2853090">full</span><span class="op" id="2853094">[</span><span class="ident" id="2853095">i</span><span class="op" id="2853096">]</span><span class="op" id="2853097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2853100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853103">n</span>&nbsp;<span class="op" id="2853105">+=</span>&nbsp;<span class="builtinfunc" id="2853108">len</span><span class="op" id="2853111">(</span><span class="ident" id="2853112">frag</span><span class="op" id="2853116">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2853120">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853158">buf</span>&nbsp;<span class="op" id="2853162">:=</span>&nbsp;<span class="builtinfunc" id="2853165">make</span><span class="op" id="2853169">(</span><span class="op" id="2853170">[</span><span class="op" id="2853171">]</span><span class="builtintype" id="2853172">byte</span><span class="op" id="2853176">,</span>&nbsp;<span class="ident" id="2853178">n</span><span class="op" id="2853179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853182">n</span>&nbsp;<span class="op" id="2853184">=</span>&nbsp;<span class="num" id="2853186">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2853189">for</span>&nbsp;<span class="ident" id="2853193">i</span>&nbsp;<span class="op" id="2853195">:=</span>&nbsp;<span class="keyword" id="2853198">range</span>&nbsp;<span class="ident" id="2853204">full</span>&nbsp;<span class="op" id="2853209">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853213">n</span>&nbsp;<span class="op" id="2853215">+=</span>&nbsp;<span class="builtinfunc" id="2853218">copy</span><span class="op" id="2853222">(</span><span class="ident" id="2853223">buf</span><span class="op" id="2853226">[</span><span class="ident" id="2853227">n</span><span class="op" id="2853228">:</span><span class="op" id="2853229">]</span><span class="op" id="2853230">,</span>&nbsp;<span class="ident" id="2853232">full</span><span class="op" id="2853236">[</span><span class="ident" id="2853237">i</span><span class="op" id="2853238">]</span><span class="op" id="2853239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2853242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2853245">copy</span><span class="op" id="2853249">(</span><span class="ident" id="2853250">buf</span><span class="op" id="2853253">[</span><span class="ident" id="2853254">n</span><span class="op" id="2853255">:</span><span class="op" id="2853256">]</span><span class="op" id="2853257">,</span>&nbsp;<span class="ident" id="2853259">frag</span><span class="op" id="2853263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2853266">return</span>&nbsp;<span class="ident" id="2853273">buf</span><span class="op" id="2853276">,</span>&nbsp;<span class="ident" id="2853278">err</span><br>
<span class="lineno"></span><span class="op" id="2853282">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="2853285">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2853355">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2853432">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2853497">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="2853579">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2853661">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2853671">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="2853725">func</span>&nbsp;<span class="op" id="2853730">(</span><span class="ident" id="2853731">b</span>&nbsp;<span class="op" id="2853733">*</span><span class="ident" id="2853734">Reader</span><span class="op" id="2853740">)</span>&nbsp;<span class="ident" id="2853742">ReadString</span><span class="op" id="2853752">(</span><span class="ident" id="2853753">delim</span>&nbsp;<span class="builtintype" id="2853759">byte</span><span class="op" id="2853763">)</span>&nbsp;<span class="op" id="2853765">(</span><span class="ident" id="2853766">line</span>&nbsp;<span class="builtintype" id="2853771">string</span><span class="op" id="2853777">,</span>&nbsp;<span class="ident" id="2853779">err</span>&nbsp;<span class="builtintype" id="2853783">error</span><span class="op" id="2853788">)</span>&nbsp;<span class="op" id="2853790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853793">bytes</span><span class="op" id="2853798">,</span>&nbsp;<span class="ident" id="2853800">err</span>&nbsp;<span class="op" id="2853804">:=</span>&nbsp;<span class="ident" id="2853807">b</span><span class="op" id="2853808">.</span><span class="ident" id="2853809">ReadBytes</span><span class="op" id="2853818">(</span><span class="ident" id="2853819">delim</span><span class="op" id="2853824">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853827">line</span>&nbsp;<span class="op" id="2853832">=</span>&nbsp;<span class="builtintype" id="2853834">string</span><span class="op" id="2853840">(</span><span class="ident" id="2853841">bytes</span><span class="op" id="2853846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2853849">return</span>&nbsp;<span class="ident" id="2853856">line</span><span class="op" id="2853860">,</span>&nbsp;<span class="ident" id="2853862">err</span><br>
<span class="lineno"></span><span class="op" id="2853866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2853869">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="2853904">func</span>&nbsp;<span class="op" id="2853909">(</span><span class="ident" id="2853910">b</span>&nbsp;<span class="op" id="2853912">*</span><span class="ident" id="2853913">Reader</span><span class="op" id="2853919">)</span>&nbsp;<span class="ident" id="2853921">WriteTo</span><span class="op" id="2853928">(</span><span class="ident" id="2853929">w</span>&nbsp;<span class="ident" id="2853931">io</span><span class="op" id="2853933">.</span><span class="ident" id="2853934">Writer</span><span class="op" id="2853940">)</span>&nbsp;<span class="op" id="2853942">(</span><span class="ident" id="2853943">n</span>&nbsp;<span class="ident" id="2853945">int64</span><span class="op" id="2853950">,</span>&nbsp;<span class="ident" id="2853952">err</span>&nbsp;<span class="builtintype" id="2853956">error</span><span class="op" id="2853961">)</span>&nbsp;<span class="op" id="2853963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2853966">n</span><span class="op" id="2853967">,</span>&nbsp;<span class="ident" id="2853969">err</span>&nbsp;<span class="op" id="2853973">=</span>&nbsp;<span class="ident" id="2853975">b</span><span class="op" id="2853976">.</span><span class="ident" id="2853977">writeBuf</span><span class="op" id="2853985">(</span><span class="ident" id="2853986">w</span><span class="op" id="2853987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2853990">if</span>&nbsp;<span class="ident" id="2853993">err</span>&nbsp;<span class="op" id="2853997">!=</span>&nbsp;<span class="ident" id="2854000">nil</span>&nbsp;<span class="op" id="2854004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854008">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854016">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854020">if</span>&nbsp;<span class="ident" id="2854023">r</span><span class="op" id="2854024">,</span>&nbsp;<span class="ident" id="2854026">ok</span>&nbsp;<span class="op" id="2854029">:=</span>&nbsp;<span class="ident" id="2854032">b</span><span class="op" id="2854033">.</span><span class="ident" id="2854034">rd</span><span class="op" id="2854036">.</span><span class="op" id="2854037">(</span><span class="ident" id="2854038">io</span><span class="op" id="2854040">.</span><span class="ident" id="2854041">WriterTo</span><span class="op" id="2854049">)</span><span class="op" id="2854050">;</span>&nbsp;<span class="ident" id="2854052">ok</span>&nbsp;<span class="op" id="2854055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854059">m</span><span class="op" id="2854060">,</span>&nbsp;<span class="ident" id="2854062">err</span>&nbsp;<span class="op" id="2854066">:=</span>&nbsp;<span class="ident" id="2854069">r</span><span class="op" id="2854070">.</span><span class="ident" id="2854071">WriteTo</span><span class="op" id="2854078">(</span><span class="ident" id="2854079">w</span><span class="op" id="2854080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854084">n</span>&nbsp;<span class="op" id="2854086">+=</span>&nbsp;<span class="ident" id="2854089">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854093">return</span>&nbsp;<span class="ident" id="2854100">n</span><span class="op" id="2854101">,</span>&nbsp;<span class="ident" id="2854103">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854112">if</span>&nbsp;<span class="ident" id="2854115">w</span><span class="op" id="2854116">,</span>&nbsp;<span class="ident" id="2854118">ok</span>&nbsp;<span class="op" id="2854121">:=</span>&nbsp;<span class="ident" id="2854124">w</span><span class="op" id="2854125">.</span><span class="op" id="2854126">(</span><span class="ident" id="2854127">io</span><span class="op" id="2854129">.</span><span class="ident" id="2854130">ReaderFrom</span><span class="op" id="2854140">)</span><span class="op" id="2854141">;</span>&nbsp;<span class="ident" id="2854143">ok</span>&nbsp;<span class="op" id="2854146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854150">m</span><span class="op" id="2854151">,</span>&nbsp;<span class="ident" id="2854153">err</span>&nbsp;<span class="op" id="2854157">:=</span>&nbsp;<span class="ident" id="2854160">w</span><span class="op" id="2854161">.</span><span class="ident" id="2854162">ReadFrom</span><span class="op" id="2854170">(</span><span class="ident" id="2854171">b</span><span class="op" id="2854172">.</span><span class="ident" id="2854173">rd</span><span class="op" id="2854175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854179">n</span>&nbsp;<span class="op" id="2854181">+=</span>&nbsp;<span class="ident" id="2854184">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854188">return</span>&nbsp;<span class="ident" id="2854195">n</span><span class="op" id="2854196">,</span>&nbsp;<span class="ident" id="2854198">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854207">if</span>&nbsp;<span class="ident" id="2854210">b</span><span class="op" id="2854211">.</span><span class="ident" id="2854212">w</span><span class="op" id="2854213">-</span><span class="ident" id="2854214">b</span><span class="op" id="2854215">.</span><span class="ident" id="2854216">r</span>&nbsp;<span class="op" id="2854218">&lt;</span>&nbsp;<span class="builtinfunc" id="2854220">len</span><span class="op" id="2854223">(</span><span class="ident" id="2854224">b</span><span class="op" id="2854225">.</span><span class="ident" id="2854226">buf</span><span class="op" id="2854229">)</span>&nbsp;<span class="op" id="2854231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854235">b</span><span class="op" id="2854236">.</span><span class="ident" id="2854237">fill</span><span class="op" id="2854241">(</span><span class="op" id="2854242">)</span>&nbsp;<span class="comment" id="2854244">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854268">for</span>&nbsp;<span class="ident" id="2854272">b</span><span class="op" id="2854273">.</span><span class="ident" id="2854274">r</span>&nbsp;<span class="op" id="2854276">&lt;</span>&nbsp;<span class="ident" id="2854278">b</span><span class="op" id="2854279">.</span><span class="ident" id="2854280">w</span>&nbsp;<span class="op" id="2854282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2854286">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854324">m</span><span class="op" id="2854325">,</span>&nbsp;<span class="ident" id="2854327">err</span>&nbsp;<span class="op" id="2854331">:=</span>&nbsp;<span class="ident" id="2854334">b</span><span class="op" id="2854335">.</span><span class="ident" id="2854336">writeBuf</span><span class="op" id="2854344">(</span><span class="ident" id="2854345">w</span><span class="op" id="2854346">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854350">n</span>&nbsp;<span class="op" id="2854352">+=</span>&nbsp;<span class="ident" id="2854355">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854359">if</span>&nbsp;<span class="ident" id="2854362">err</span>&nbsp;<span class="op" id="2854366">!=</span>&nbsp;<span class="ident" id="2854369">nil</span>&nbsp;<span class="op" id="2854373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854378">return</span>&nbsp;<span class="ident" id="2854385">n</span><span class="op" id="2854386">,</span>&nbsp;<span class="ident" id="2854388">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854398">b</span><span class="op" id="2854399">.</span><span class="ident" id="2854400">fill</span><span class="op" id="2854404">(</span><span class="op" id="2854405">)</span>&nbsp;<span class="comment" id="2854407">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854431">if</span>&nbsp;<span class="ident" id="2854434">b</span><span class="op" id="2854435">.</span><span class="ident" id="2854436">err</span>&nbsp;<span class="op" id="2854440">==</span>&nbsp;<span class="ident" id="2854443">io</span><span class="op" id="2854445">.</span><span class="ident" id="2854446">EOF</span>&nbsp;<span class="op" id="2854450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854454">b</span><span class="op" id="2854455">.</span><span class="ident" id="2854456">err</span>&nbsp;<span class="op" id="2854460">=</span>&nbsp;<span class="ident" id="2854462">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854467">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854471">return</span>&nbsp;<span class="ident" id="2854478">n</span><span class="op" id="2854479">,</span>&nbsp;<span class="ident" id="2854481">b</span><span class="op" id="2854482">.</span><span class="ident" id="2854483">readErr</span><span class="op" id="2854490">(</span><span class="op" id="2854491">)</span><br>
<span class="lineno"></span><span class="op" id="2854493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2854496">var</span>&nbsp;<span class="ident" id="2854500">errNegativeWrite</span>&nbsp;<span class="op" id="2854517">=</span>&nbsp;<span class="ident" id="2854519">errors</span><span class="op" id="2854525">.</span><span class="ident" id="2854526">New</span><span class="op" id="2854529">(</span><span class="string" id="2854530">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="2854580">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="2854583">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2854637">func</span>&nbsp;<span class="op" id="2854642">(</span><span class="ident" id="2854643">b</span>&nbsp;<span class="op" id="2854645">*</span><span class="ident" id="2854646">Reader</span><span class="op" id="2854652">)</span>&nbsp;<span class="ident" id="2854654">writeBuf</span><span class="op" id="2854662">(</span><span class="ident" id="2854663">w</span>&nbsp;<span class="ident" id="2854665">io</span><span class="op" id="2854667">.</span><span class="ident" id="2854668">Writer</span><span class="op" id="2854674">)</span>&nbsp;<span class="op" id="2854676">(</span><span class="ident" id="2854677">int64</span><span class="op" id="2854682">,</span>&nbsp;<span class="builtintype" id="2854684">error</span><span class="op" id="2854689">)</span>&nbsp;<span class="op" id="2854691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854694">n</span><span class="op" id="2854695">,</span>&nbsp;<span class="ident" id="2854697">err</span>&nbsp;<span class="op" id="2854701">:=</span>&nbsp;<span class="ident" id="2854704">w</span><span class="op" id="2854705">.</span><span class="ident" id="2854706">Write</span><span class="op" id="2854711">(</span><span class="ident" id="2854712">b</span><span class="op" id="2854713">.</span><span class="ident" id="2854714">buf</span><span class="op" id="2854717">[</span><span class="ident" id="2854718">b</span><span class="op" id="2854719">.</span><span class="ident" id="2854720">r</span><span class="op" id="2854721">:</span><span class="ident" id="2854722">b</span><span class="op" id="2854723">.</span><span class="ident" id="2854724">w</span><span class="op" id="2854725">]</span><span class="op" id="2854726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854729">if</span>&nbsp;<span class="ident" id="2854732">n</span>&nbsp;<span class="op" id="2854734">&lt;</span>&nbsp;<span class="num" id="2854736">0</span>&nbsp;<span class="op" id="2854738">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2854742">panic</span><span class="op" id="2854747">(</span><span class="ident" id="2854748">errNegativeWrite</span><span class="op" id="2854764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2854767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2854770">b</span><span class="op" id="2854771">.</span><span class="ident" id="2854772">r</span>&nbsp;<span class="op" id="2854774">+=</span>&nbsp;<span class="ident" id="2854777">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2854780">return</span>&nbsp;<span class="ident" id="2854787">int64</span><span class="op" id="2854792">(</span><span class="ident" id="2854793">n</span><span class="op" id="2854794">)</span><span class="op" id="2854795">,</span>&nbsp;<span class="ident" id="2854797">err</span><br>
<span class="lineno"></span><span class="op" id="2854801">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="2854804">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2854824">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="2854880">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="2854944">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2855005">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2855068">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2855128">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2855157">type</span>&nbsp;<span class="ident" id="2855162">Writer</span>&nbsp;<span class="keyword" id="2855169">struct</span>&nbsp;<span class="op" id="2855176">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855179">err</span>&nbsp;<span class="builtintype" id="2855183">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855190">buf</span>&nbsp;<span class="op" id="2855194">[</span><span class="op" id="2855195">]</span><span class="builtintype" id="2855196">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855202">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2855206">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855211">wr</span>&nbsp;&nbsp;<span class="ident" id="2855215">io</span><span class="op" id="2855217">.</span><span class="ident" id="2855218">Writer</span><br>
<span class="lineno"></span><span class="op" id="2855225">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="2855228">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="2855306">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2855379">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2855422">func</span>&nbsp;<span class="ident" id="2855427">NewWriterSize</span><span class="op" id="2855440">(</span><span class="ident" id="2855441">w</span>&nbsp;<span class="ident" id="2855443">io</span><span class="op" id="2855445">.</span><span class="ident" id="2855446">Writer</span><span class="op" id="2855452">,</span>&nbsp;<span class="ident" id="2855454">size</span>&nbsp;<span class="builtintype" id="2855459">int</span><span class="op" id="2855462">)</span>&nbsp;<span class="op" id="2855464">*</span><span class="ident" id="2855465">Writer</span>&nbsp;<span class="op" id="2855472">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2855475">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855503">b</span><span class="op" id="2855504">,</span>&nbsp;<span class="ident" id="2855506">ok</span>&nbsp;<span class="op" id="2855509">:=</span>&nbsp;<span class="ident" id="2855512">w</span><span class="op" id="2855513">.</span><span class="op" id="2855514">(</span><span class="op" id="2855515">*</span><span class="ident" id="2855516">Writer</span><span class="op" id="2855522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2855525">if</span>&nbsp;<span class="ident" id="2855528">ok</span>&nbsp;<span class="op" id="2855531">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2855534">len</span><span class="op" id="2855537">(</span><span class="ident" id="2855538">b</span><span class="op" id="2855539">.</span><span class="ident" id="2855540">buf</span><span class="op" id="2855543">)</span>&nbsp;<span class="op" id="2855545">&gt;=</span>&nbsp;<span class="ident" id="2855548">size</span>&nbsp;<span class="op" id="2855553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2855557">return</span>&nbsp;<span class="ident" id="2855564">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2855567">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2855570">if</span>&nbsp;<span class="ident" id="2855573">size</span>&nbsp;<span class="op" id="2855578">&lt;=</span>&nbsp;<span class="num" id="2855581">0</span>&nbsp;<span class="op" id="2855583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855587">size</span>&nbsp;<span class="op" id="2855592">=</span>&nbsp;<span class="ident" id="2855594">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2855610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2855613">return</span>&nbsp;<span class="op" id="2855620">&amp;</span><span class="ident" id="2855621">Writer</span><span class="op" id="2855627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855631">buf</span><span class="op" id="2855634">:</span>&nbsp;<span class="builtinfunc" id="2855636">make</span><span class="op" id="2855640">(</span><span class="op" id="2855641">[</span><span class="op" id="2855642">]</span><span class="builtintype" id="2855643">byte</span><span class="op" id="2855647">,</span>&nbsp;<span class="ident" id="2855649">size</span><span class="op" id="2855653">)</span><span class="op" id="2855654">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855658">wr</span><span class="op" id="2855660">:</span>&nbsp;&nbsp;<span class="ident" id="2855663">w</span><span class="op" id="2855664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2855667">}</span><br>
<span class="lineno"></span><span class="op" id="2855669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2855672">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="2855741">func</span>&nbsp;<span class="ident" id="2855746">NewWriter</span><span class="op" id="2855755">(</span><span class="ident" id="2855756">w</span>&nbsp;<span class="ident" id="2855758">io</span><span class="op" id="2855760">.</span><span class="ident" id="2855761">Writer</span><span class="op" id="2855767">)</span>&nbsp;<span class="op" id="2855769">*</span><span class="ident" id="2855770">Writer</span>&nbsp;<span class="op" id="2855777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2855780">return</span>&nbsp;<span class="ident" id="2855787">NewWriterSize</span><span class="op" id="2855800">(</span><span class="ident" id="2855801">w</span><span class="op" id="2855802">,</span>&nbsp;<span class="ident" id="2855804">defaultBufSize</span><span class="op" id="2855818">)</span><br>
<span class="lineno"></span><span class="op" id="2855820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2855823">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="2855892">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2855930">func</span>&nbsp;<span class="op" id="2855935">(</span><span class="ident" id="2855936">b</span>&nbsp;<span class="op" id="2855938">*</span><span class="ident" id="2855939">Writer</span><span class="op" id="2855945">)</span>&nbsp;<span class="ident" id="2855947">Reset</span><span class="op" id="2855952">(</span><span class="ident" id="2855953">w</span>&nbsp;<span class="ident" id="2855955">io</span><span class="op" id="2855957">.</span><span class="ident" id="2855958">Writer</span><span class="op" id="2855964">)</span>&nbsp;<span class="op" id="2855966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855969">b</span><span class="op" id="2855970">.</span><span class="ident" id="2855971">err</span>&nbsp;<span class="op" id="2855975">=</span>&nbsp;<span class="ident" id="2855977">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855982">b</span><span class="op" id="2855983">.</span><span class="ident" id="2855984">n</span>&nbsp;<span class="op" id="2855986">=</span>&nbsp;<span class="num" id="2855988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2855991">b</span><span class="op" id="2855992">.</span><span class="ident" id="2855993">wr</span>&nbsp;<span class="op" id="2855996">=</span>&nbsp;<span class="ident" id="2855998">w</span><br>
<span class="lineno">515</span><span class="op" id="2856000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2856003">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2856066">func</span>&nbsp;<span class="op" id="2856071">(</span><span class="ident" id="2856072">b</span>&nbsp;<span class="op" id="2856074">*</span><span class="ident" id="2856075">Writer</span><span class="op" id="2856081">)</span>&nbsp;<span class="ident" id="2856083">Flush</span><span class="op" id="2856088">(</span><span class="op" id="2856089">)</span>&nbsp;<span class="builtintype" id="2856091">error</span>&nbsp;<span class="op" id="2856097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856100">err</span>&nbsp;<span class="op" id="2856104">:=</span>&nbsp;<span class="ident" id="2856107">b</span><span class="op" id="2856108">.</span><span class="ident" id="2856109">flush</span><span class="op" id="2856114">(</span><span class="op" id="2856115">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856118">return</span>&nbsp;<span class="ident" id="2856125">err</span><br>
<span class="lineno"></span><span class="op" id="2856129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2856132">func</span>&nbsp;<span class="op" id="2856137">(</span><span class="ident" id="2856138">b</span>&nbsp;<span class="op" id="2856140">*</span><span class="ident" id="2856141">Writer</span><span class="op" id="2856147">)</span>&nbsp;<span class="ident" id="2856149">flush</span><span class="op" id="2856154">(</span><span class="op" id="2856155">)</span>&nbsp;<span class="builtintype" id="2856157">error</span>&nbsp;<span class="op" id="2856163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856166">if</span>&nbsp;<span class="ident" id="2856169">b</span><span class="op" id="2856170">.</span><span class="ident" id="2856171">err</span>&nbsp;<span class="op" id="2856175">!=</span>&nbsp;<span class="ident" id="2856178">nil</span>&nbsp;<span class="op" id="2856182">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856186">return</span>&nbsp;<span class="ident" id="2856193">b</span><span class="op" id="2856194">.</span><span class="ident" id="2856195">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2856200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856203">if</span>&nbsp;<span class="ident" id="2856206">b</span><span class="op" id="2856207">.</span><span class="ident" id="2856208">n</span>&nbsp;<span class="op" id="2856210">==</span>&nbsp;<span class="num" id="2856213">0</span>&nbsp;<span class="op" id="2856215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856219">return</span>&nbsp;<span class="ident" id="2856226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2856231">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856234">n</span><span class="op" id="2856235">,</span>&nbsp;<span class="ident" id="2856237">err</span>&nbsp;<span class="op" id="2856241">:=</span>&nbsp;<span class="ident" id="2856244">b</span><span class="op" id="2856245">.</span><span class="ident" id="2856246">wr</span><span class="op" id="2856248">.</span><span class="ident" id="2856249">Write</span><span class="op" id="2856254">(</span><span class="ident" id="2856255">b</span><span class="op" id="2856256">.</span><span class="ident" id="2856257">buf</span><span class="op" id="2856260">[</span><span class="num" id="2856261">0</span><span class="op" id="2856262">:</span><span class="ident" id="2856263">b</span><span class="op" id="2856264">.</span><span class="ident" id="2856265">n</span><span class="op" id="2856266">]</span><span class="op" id="2856267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856270">if</span>&nbsp;<span class="ident" id="2856273">n</span>&nbsp;<span class="op" id="2856275">&lt;</span>&nbsp;<span class="ident" id="2856277">b</span><span class="op" id="2856278">.</span><span class="ident" id="2856279">n</span>&nbsp;<span class="op" id="2856281">&amp;&amp;</span>&nbsp;<span class="ident" id="2856284">err</span>&nbsp;<span class="op" id="2856288">==</span>&nbsp;<span class="ident" id="2856291">nil</span>&nbsp;<span class="op" id="2856295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856299">err</span>&nbsp;<span class="op" id="2856303">=</span>&nbsp;<span class="ident" id="2856305">io</span><span class="op" id="2856307">.</span><span class="ident" id="2856308">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2856323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856326">if</span>&nbsp;<span class="ident" id="2856329">err</span>&nbsp;<span class="op" id="2856333">!=</span>&nbsp;<span class="ident" id="2856336">nil</span>&nbsp;<span class="op" id="2856340">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856344">if</span>&nbsp;<span class="ident" id="2856347">n</span>&nbsp;<span class="op" id="2856349">&gt;</span>&nbsp;<span class="num" id="2856351">0</span>&nbsp;<span class="op" id="2856353">&amp;&amp;</span>&nbsp;<span class="ident" id="2856356">n</span>&nbsp;<span class="op" id="2856358">&lt;</span>&nbsp;<span class="ident" id="2856360">b</span><span class="op" id="2856361">.</span><span class="ident" id="2856362">n</span>&nbsp;<span class="op" id="2856364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2856369">copy</span><span class="op" id="2856373">(</span><span class="ident" id="2856374">b</span><span class="op" id="2856375">.</span><span class="ident" id="2856376">buf</span><span class="op" id="2856379">[</span><span class="num" id="2856380">0</span><span class="op" id="2856381">:</span><span class="ident" id="2856382">b</span><span class="op" id="2856383">.</span><span class="ident" id="2856384">n</span><span class="op" id="2856385">-</span><span class="ident" id="2856386">n</span><span class="op" id="2856387">]</span><span class="op" id="2856388">,</span>&nbsp;<span class="ident" id="2856390">b</span><span class="op" id="2856391">.</span><span class="ident" id="2856392">buf</span><span class="op" id="2856395">[</span><span class="ident" id="2856396">n</span><span class="op" id="2856397">:</span><span class="ident" id="2856398">b</span><span class="op" id="2856399">.</span><span class="ident" id="2856400">n</span><span class="op" id="2856401">]</span><span class="op" id="2856402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2856406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856410">b</span><span class="op" id="2856411">.</span><span class="ident" id="2856412">n</span>&nbsp;<span class="op" id="2856414">-=</span>&nbsp;<span class="ident" id="2856417">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856421">b</span><span class="op" id="2856422">.</span><span class="ident" id="2856423">err</span>&nbsp;<span class="op" id="2856427">=</span>&nbsp;<span class="ident" id="2856429">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856435">return</span>&nbsp;<span class="ident" id="2856442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2856447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2856450">b</span><span class="op" id="2856451">.</span><span class="ident" id="2856452">n</span>&nbsp;<span class="op" id="2856454">=</span>&nbsp;<span class="num" id="2856456">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856459">return</span>&nbsp;<span class="ident" id="2856466">nil</span><br>
<span class="lineno"></span><span class="op" id="2856470">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="2856473">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2856535">func</span>&nbsp;<span class="op" id="2856540">(</span><span class="ident" id="2856541">b</span>&nbsp;<span class="op" id="2856543">*</span><span class="ident" id="2856544">Writer</span><span class="op" id="2856550">)</span>&nbsp;<span class="ident" id="2856552">Available</span><span class="op" id="2856561">(</span><span class="op" id="2856562">)</span>&nbsp;<span class="builtintype" id="2856564">int</span>&nbsp;<span class="op" id="2856568">{</span>&nbsp;<span class="keyword" id="2856570">return</span>&nbsp;<span class="builtinfunc" id="2856577">len</span><span class="op" id="2856580">(</span><span class="ident" id="2856581">b</span><span class="op" id="2856582">.</span><span class="ident" id="2856583">buf</span><span class="op" id="2856586">)</span>&nbsp;<span class="op" id="2856588">-</span>&nbsp;<span class="ident" id="2856590">b</span><span class="op" id="2856591">.</span><span class="ident" id="2856592">n</span>&nbsp;<span class="op" id="2856594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2856597">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="2856685">func</span>&nbsp;<span class="op" id="2856690">(</span><span class="ident" id="2856691">b</span>&nbsp;<span class="op" id="2856693">*</span><span class="ident" id="2856694">Writer</span><span class="op" id="2856700">)</span>&nbsp;<span class="ident" id="2856702">Buffered</span><span class="op" id="2856710">(</span><span class="op" id="2856711">)</span>&nbsp;<span class="builtintype" id="2856713">int</span>&nbsp;<span class="op" id="2856717">{</span>&nbsp;<span class="keyword" id="2856719">return</span>&nbsp;<span class="ident" id="2856726">b</span><span class="op" id="2856727">.</span><span class="ident" id="2856728">n</span>&nbsp;<span class="op" id="2856730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2856733">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2856784">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2856827">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="2856882">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="2856909">func</span>&nbsp;<span class="op" id="2856914">(</span><span class="ident" id="2856915">b</span>&nbsp;<span class="op" id="2856917">*</span><span class="ident" id="2856918">Writer</span><span class="op" id="2856924">)</span>&nbsp;<span class="ident" id="2856926">Write</span><span class="op" id="2856931">(</span><span class="ident" id="2856932">p</span>&nbsp;<span class="op" id="2856934">[</span><span class="op" id="2856935">]</span><span class="builtintype" id="2856936">byte</span><span class="op" id="2856940">)</span>&nbsp;<span class="op" id="2856942">(</span><span class="ident" id="2856943">nn</span>&nbsp;<span class="builtintype" id="2856946">int</span><span class="op" id="2856949">,</span>&nbsp;<span class="ident" id="2856951">err</span>&nbsp;<span class="builtintype" id="2856955">error</span><span class="op" id="2856960">)</span>&nbsp;<span class="op" id="2856962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2856965">for</span>&nbsp;<span class="builtinfunc" id="2856969">len</span><span class="op" id="2856972">(</span><span class="ident" id="2856973">p</span><span class="op" id="2856974">)</span>&nbsp;<span class="op" id="2856976">&gt;</span>&nbsp;<span class="ident" id="2856978">b</span><span class="op" id="2856979">.</span><span class="ident" id="2856980">Available</span><span class="op" id="2856989">(</span><span class="op" id="2856990">)</span>&nbsp;<span class="op" id="2856992">&amp;&amp;</span>&nbsp;<span class="ident" id="2856995">b</span><span class="op" id="2856996">.</span><span class="ident" id="2856997">err</span>&nbsp;<span class="op" id="2857001">==</span>&nbsp;<span class="ident" id="2857004">nil</span>&nbsp;<span class="op" id="2857008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857012">var</span>&nbsp;<span class="ident" id="2857016">n</span>&nbsp;<span class="builtintype" id="2857018">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857024">if</span>&nbsp;<span class="ident" id="2857027">b</span><span class="op" id="2857028">.</span><span class="ident" id="2857029">Buffered</span><span class="op" id="2857037">(</span><span class="op" id="2857038">)</span>&nbsp;<span class="op" id="2857040">==</span>&nbsp;<span class="num" id="2857043">0</span>&nbsp;<span class="op" id="2857045">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2857050">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2857083">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857126">n</span><span class="op" id="2857127">,</span>&nbsp;<span class="ident" id="2857129">b</span><span class="op" id="2857130">.</span><span class="ident" id="2857131">err</span>&nbsp;<span class="op" id="2857135">=</span>&nbsp;<span class="ident" id="2857137">b</span><span class="op" id="2857138">.</span><span class="ident" id="2857139">wr</span><span class="op" id="2857141">.</span><span class="ident" id="2857142">Write</span><span class="op" id="2857147">(</span><span class="ident" id="2857148">p</span><span class="op" id="2857149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857153">}</span>&nbsp;<span class="keyword" id="2857155">else</span>&nbsp;<span class="op" id="2857160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857165">n</span>&nbsp;<span class="op" id="2857167">=</span>&nbsp;<span class="builtinfunc" id="2857169">copy</span><span class="op" id="2857173">(</span><span class="ident" id="2857174">b</span><span class="op" id="2857175">.</span><span class="ident" id="2857176">buf</span><span class="op" id="2857179">[</span><span class="ident" id="2857180">b</span><span class="op" id="2857181">.</span><span class="ident" id="2857182">n</span><span class="op" id="2857183">:</span><span class="op" id="2857184">]</span><span class="op" id="2857185">,</span>&nbsp;<span class="ident" id="2857187">p</span><span class="op" id="2857188">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857193">b</span><span class="op" id="2857194">.</span><span class="ident" id="2857195">n</span>&nbsp;<span class="op" id="2857197">+=</span>&nbsp;<span class="ident" id="2857200">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857205">b</span><span class="op" id="2857206">.</span><span class="ident" id="2857207">flush</span><span class="op" id="2857212">(</span><span class="op" id="2857213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857221">nn</span>&nbsp;<span class="op" id="2857224">+=</span>&nbsp;<span class="ident" id="2857227">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857231">p</span>&nbsp;<span class="op" id="2857233">=</span>&nbsp;<span class="ident" id="2857235">p</span><span class="op" id="2857236">[</span><span class="ident" id="2857237">n</span><span class="op" id="2857238">:</span><span class="op" id="2857239">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857245">if</span>&nbsp;<span class="ident" id="2857248">b</span><span class="op" id="2857249">.</span><span class="ident" id="2857250">err</span>&nbsp;<span class="op" id="2857254">!=</span>&nbsp;<span class="ident" id="2857257">nil</span>&nbsp;<span class="op" id="2857261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857265">return</span>&nbsp;<span class="ident" id="2857272">nn</span><span class="op" id="2857274">,</span>&nbsp;<span class="ident" id="2857276">b</span><span class="op" id="2857277">.</span><span class="ident" id="2857278">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857286">n</span>&nbsp;<span class="op" id="2857288">:=</span>&nbsp;<span class="builtinfunc" id="2857291">copy</span><span class="op" id="2857295">(</span><span class="ident" id="2857296">b</span><span class="op" id="2857297">.</span><span class="ident" id="2857298">buf</span><span class="op" id="2857301">[</span><span class="ident" id="2857302">b</span><span class="op" id="2857303">.</span><span class="ident" id="2857304">n</span><span class="op" id="2857305">:</span><span class="op" id="2857306">]</span><span class="op" id="2857307">,</span>&nbsp;<span class="ident" id="2857309">p</span><span class="op" id="2857310">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857313">b</span><span class="op" id="2857314">.</span><span class="ident" id="2857315">n</span>&nbsp;<span class="op" id="2857317">+=</span>&nbsp;<span class="ident" id="2857320">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857323">nn</span>&nbsp;<span class="op" id="2857326">+=</span>&nbsp;<span class="ident" id="2857329">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857332">return</span>&nbsp;<span class="ident" id="2857339">nn</span><span class="op" id="2857341">,</span>&nbsp;<span class="ident" id="2857343">nil</span><br>
<span class="lineno"></span><span class="op" id="2857347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="2857350">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2857385">func</span>&nbsp;<span class="op" id="2857390">(</span><span class="ident" id="2857391">b</span>&nbsp;<span class="op" id="2857393">*</span><span class="ident" id="2857394">Writer</span><span class="op" id="2857400">)</span>&nbsp;<span class="ident" id="2857402">WriteByte</span><span class="op" id="2857411">(</span><span class="ident" id="2857412">c</span>&nbsp;<span class="builtintype" id="2857414">byte</span><span class="op" id="2857418">)</span>&nbsp;<span class="builtintype" id="2857420">error</span>&nbsp;<span class="op" id="2857426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857429">if</span>&nbsp;<span class="ident" id="2857432">b</span><span class="op" id="2857433">.</span><span class="ident" id="2857434">err</span>&nbsp;<span class="op" id="2857438">!=</span>&nbsp;<span class="ident" id="2857441">nil</span>&nbsp;<span class="op" id="2857445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857449">return</span>&nbsp;<span class="ident" id="2857456">b</span><span class="op" id="2857457">.</span><span class="ident" id="2857458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857463">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857466">if</span>&nbsp;<span class="ident" id="2857469">b</span><span class="op" id="2857470">.</span><span class="ident" id="2857471">Available</span><span class="op" id="2857480">(</span><span class="op" id="2857481">)</span>&nbsp;<span class="op" id="2857483">&lt;=</span>&nbsp;<span class="num" id="2857486">0</span>&nbsp;<span class="op" id="2857488">&amp;&amp;</span>&nbsp;<span class="ident" id="2857491">b</span><span class="op" id="2857492">.</span><span class="ident" id="2857493">flush</span><span class="op" id="2857498">(</span><span class="op" id="2857499">)</span>&nbsp;<span class="op" id="2857501">!=</span>&nbsp;<span class="ident" id="2857504">nil</span>&nbsp;<span class="op" id="2857508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857512">return</span>&nbsp;<span class="ident" id="2857519">b</span><span class="op" id="2857520">.</span><span class="ident" id="2857521">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857529">b</span><span class="op" id="2857530">.</span><span class="ident" id="2857531">buf</span><span class="op" id="2857534">[</span><span class="ident" id="2857535">b</span><span class="op" id="2857536">.</span><span class="ident" id="2857537">n</span><span class="op" id="2857538">]</span>&nbsp;<span class="op" id="2857540">=</span>&nbsp;<span class="ident" id="2857542">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857545">b</span><span class="op" id="2857546">.</span><span class="ident" id="2857547">n</span><span class="op" id="2857548">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857552">return</span>&nbsp;<span class="ident" id="2857559">nil</span><br>
<span class="lineno"></span><span class="op" id="2857563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2857566">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="2857625">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="2857671">func</span>&nbsp;<span class="op" id="2857676">(</span><span class="ident" id="2857677">b</span>&nbsp;<span class="op" id="2857679">*</span><span class="ident" id="2857680">Writer</span><span class="op" id="2857686">)</span>&nbsp;<span class="ident" id="2857688">WriteRune</span><span class="op" id="2857697">(</span><span class="ident" id="2857698">r</span>&nbsp;<span class="builtintype" id="2857700">rune</span><span class="op" id="2857704">)</span>&nbsp;<span class="op" id="2857706">(</span><span class="ident" id="2857707">size</span>&nbsp;<span class="builtintype" id="2857712">int</span><span class="op" id="2857715">,</span>&nbsp;<span class="ident" id="2857717">err</span>&nbsp;<span class="builtintype" id="2857721">error</span><span class="op" id="2857726">)</span>&nbsp;<span class="op" id="2857728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857731">if</span>&nbsp;<span class="ident" id="2857734">r</span>&nbsp;<span class="op" id="2857736">&lt;</span>&nbsp;<span class="ident" id="2857738">utf8</span><span class="op" id="2857742">.</span><span class="ident" id="2857743">RuneSelf</span>&nbsp;<span class="op" id="2857752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857756">err</span>&nbsp;<span class="op" id="2857760">=</span>&nbsp;<span class="ident" id="2857762">b</span><span class="op" id="2857763">.</span><span class="ident" id="2857764">WriteByte</span><span class="op" id="2857773">(</span><span class="builtintype" id="2857774">byte</span><span class="op" id="2857778">(</span><span class="ident" id="2857779">r</span><span class="op" id="2857780">)</span><span class="op" id="2857781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857785">if</span>&nbsp;<span class="ident" id="2857788">err</span>&nbsp;<span class="op" id="2857792">!=</span>&nbsp;<span class="ident" id="2857795">nil</span>&nbsp;<span class="op" id="2857799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857804">return</span>&nbsp;<span class="num" id="2857811">0</span><span class="op" id="2857812">,</span>&nbsp;<span class="ident" id="2857814">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857824">return</span>&nbsp;<span class="num" id="2857831">1</span><span class="op" id="2857832">,</span>&nbsp;<span class="ident" id="2857834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857842">if</span>&nbsp;<span class="ident" id="2857845">b</span><span class="op" id="2857846">.</span><span class="ident" id="2857847">err</span>&nbsp;<span class="op" id="2857851">!=</span>&nbsp;<span class="ident" id="2857854">nil</span>&nbsp;<span class="op" id="2857858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857862">return</span>&nbsp;<span class="num" id="2857869">0</span><span class="op" id="2857870">,</span>&nbsp;<span class="ident" id="2857872">b</span><span class="op" id="2857873">.</span><span class="ident" id="2857874">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857882">n</span>&nbsp;<span class="op" id="2857884">:=</span>&nbsp;<span class="ident" id="2857887">b</span><span class="op" id="2857888">.</span><span class="ident" id="2857889">Available</span><span class="op" id="2857898">(</span><span class="op" id="2857899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857902">if</span>&nbsp;<span class="ident" id="2857905">n</span>&nbsp;<span class="op" id="2857907">&lt;</span>&nbsp;<span class="ident" id="2857909">utf8</span><span class="op" id="2857913">.</span><span class="ident" id="2857914">UTFMax</span>&nbsp;<span class="op" id="2857921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857925">if</span>&nbsp;<span class="ident" id="2857928">b</span><span class="op" id="2857929">.</span><span class="ident" id="2857930">flush</span><span class="op" id="2857935">(</span><span class="op" id="2857936">)</span><span class="op" id="2857937">;</span>&nbsp;<span class="ident" id="2857939">b</span><span class="op" id="2857940">.</span><span class="ident" id="2857941">err</span>&nbsp;<span class="op" id="2857945">!=</span>&nbsp;<span class="ident" id="2857948">nil</span>&nbsp;<span class="op" id="2857952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857957">return</span>&nbsp;<span class="num" id="2857964">0</span><span class="op" id="2857965">,</span>&nbsp;<span class="ident" id="2857967">b</span><span class="op" id="2857968">.</span><span class="ident" id="2857969">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2857975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2857979">n</span>&nbsp;<span class="op" id="2857981">=</span>&nbsp;<span class="ident" id="2857983">b</span><span class="op" id="2857984">.</span><span class="ident" id="2857985">Available</span><span class="op" id="2857994">(</span><span class="op" id="2857995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2857999">if</span>&nbsp;<span class="ident" id="2858002">n</span>&nbsp;<span class="op" id="2858004">&lt;</span>&nbsp;<span class="ident" id="2858006">utf8</span><span class="op" id="2858010">.</span><span class="ident" id="2858011">UTFMax</span>&nbsp;<span class="op" id="2858018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2858023">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858071">return</span>&nbsp;<span class="ident" id="2858078">b</span><span class="op" id="2858079">.</span><span class="ident" id="2858080">WriteString</span><span class="op" id="2858091">(</span><span class="builtintype" id="2858092">string</span><span class="op" id="2858098">(</span><span class="ident" id="2858099">r</span><span class="op" id="2858100">)</span><span class="op" id="2858101">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858111">size</span>&nbsp;<span class="op" id="2858116">=</span>&nbsp;<span class="ident" id="2858118">utf8</span><span class="op" id="2858122">.</span><span class="ident" id="2858123">EncodeRune</span><span class="op" id="2858133">(</span><span class="ident" id="2858134">b</span><span class="op" id="2858135">.</span><span class="ident" id="2858136">buf</span><span class="op" id="2858139">[</span><span class="ident" id="2858140">b</span><span class="op" id="2858141">.</span><span class="ident" id="2858142">n</span><span class="op" id="2858143">:</span><span class="op" id="2858144">]</span><span class="op" id="2858145">,</span>&nbsp;<span class="ident" id="2858147">r</span><span class="op" id="2858148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858151">b</span><span class="op" id="2858152">.</span><span class="ident" id="2858153">n</span>&nbsp;<span class="op" id="2858155">+=</span>&nbsp;<span class="ident" id="2858158">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858164">return</span>&nbsp;<span class="ident" id="2858171">size</span><span class="op" id="2858175">,</span>&nbsp;<span class="ident" id="2858177">nil</span><br>
<span class="lineno">620</span><span class="op" id="2858181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2858184">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2858216">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2858259">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="2858332">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="2858359">func</span>&nbsp;<span class="op" id="2858364">(</span><span class="ident" id="2858365">b</span>&nbsp;<span class="op" id="2858367">*</span><span class="ident" id="2858368">Writer</span><span class="op" id="2858374">)</span>&nbsp;<span class="ident" id="2858376">WriteString</span><span class="op" id="2858387">(</span><span class="ident" id="2858388">s</span>&nbsp;<span class="builtintype" id="2858390">string</span><span class="op" id="2858396">)</span>&nbsp;<span class="op" id="2858398">(</span><span class="builtintype" id="2858399">int</span><span class="op" id="2858402">,</span>&nbsp;<span class="builtintype" id="2858404">error</span><span class="op" id="2858409">)</span>&nbsp;<span class="op" id="2858411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858414">nn</span>&nbsp;<span class="op" id="2858417">:=</span>&nbsp;<span class="num" id="2858420">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858423">for</span>&nbsp;<span class="builtinfunc" id="2858427">len</span><span class="op" id="2858430">(</span><span class="ident" id="2858431">s</span><span class="op" id="2858432">)</span>&nbsp;<span class="op" id="2858434">&gt;</span>&nbsp;<span class="ident" id="2858436">b</span><span class="op" id="2858437">.</span><span class="ident" id="2858438">Available</span><span class="op" id="2858447">(</span><span class="op" id="2858448">)</span>&nbsp;<span class="op" id="2858450">&amp;&amp;</span>&nbsp;<span class="ident" id="2858453">b</span><span class="op" id="2858454">.</span><span class="ident" id="2858455">err</span>&nbsp;<span class="op" id="2858459">==</span>&nbsp;<span class="ident" id="2858462">nil</span>&nbsp;<span class="op" id="2858466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858470">n</span>&nbsp;<span class="op" id="2858472">:=</span>&nbsp;<span class="builtinfunc" id="2858475">copy</span><span class="op" id="2858479">(</span><span class="ident" id="2858480">b</span><span class="op" id="2858481">.</span><span class="ident" id="2858482">buf</span><span class="op" id="2858485">[</span><span class="ident" id="2858486">b</span><span class="op" id="2858487">.</span><span class="ident" id="2858488">n</span><span class="op" id="2858489">:</span><span class="op" id="2858490">]</span><span class="op" id="2858491">,</span>&nbsp;<span class="ident" id="2858493">s</span><span class="op" id="2858494">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858498">b</span><span class="op" id="2858499">.</span><span class="ident" id="2858500">n</span>&nbsp;<span class="op" id="2858502">+=</span>&nbsp;<span class="ident" id="2858505">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858509">nn</span>&nbsp;<span class="op" id="2858512">+=</span>&nbsp;<span class="ident" id="2858515">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858519">s</span>&nbsp;<span class="op" id="2858521">=</span>&nbsp;<span class="ident" id="2858523">s</span><span class="op" id="2858524">[</span><span class="ident" id="2858525">n</span><span class="op" id="2858526">:</span><span class="op" id="2858527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858531">b</span><span class="op" id="2858532">.</span><span class="ident" id="2858533">flush</span><span class="op" id="2858538">(</span><span class="op" id="2858539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858542">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858545">if</span>&nbsp;<span class="ident" id="2858548">b</span><span class="op" id="2858549">.</span><span class="ident" id="2858550">err</span>&nbsp;<span class="op" id="2858554">!=</span>&nbsp;<span class="ident" id="2858557">nil</span>&nbsp;<span class="op" id="2858561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858565">return</span>&nbsp;<span class="ident" id="2858572">nn</span><span class="op" id="2858574">,</span>&nbsp;<span class="ident" id="2858576">b</span><span class="op" id="2858577">.</span><span class="ident" id="2858578">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858586">n</span>&nbsp;<span class="op" id="2858588">:=</span>&nbsp;<span class="builtinfunc" id="2858591">copy</span><span class="op" id="2858595">(</span><span class="ident" id="2858596">b</span><span class="op" id="2858597">.</span><span class="ident" id="2858598">buf</span><span class="op" id="2858601">[</span><span class="ident" id="2858602">b</span><span class="op" id="2858603">.</span><span class="ident" id="2858604">n</span><span class="op" id="2858605">:</span><span class="op" id="2858606">]</span><span class="op" id="2858607">,</span>&nbsp;<span class="ident" id="2858609">s</span><span class="op" id="2858610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858613">b</span><span class="op" id="2858614">.</span><span class="ident" id="2858615">n</span>&nbsp;<span class="op" id="2858617">+=</span>&nbsp;<span class="ident" id="2858620">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858623">nn</span>&nbsp;<span class="op" id="2858626">+=</span>&nbsp;<span class="ident" id="2858629">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858632">return</span>&nbsp;<span class="ident" id="2858639">nn</span><span class="op" id="2858641">,</span>&nbsp;<span class="ident" id="2858643">nil</span><br>
<span class="lineno"></span><span class="op" id="2858647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2858650">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="2858688">func</span>&nbsp;<span class="op" id="2858693">(</span><span class="ident" id="2858694">b</span>&nbsp;<span class="op" id="2858696">*</span><span class="ident" id="2858697">Writer</span><span class="op" id="2858703">)</span>&nbsp;<span class="ident" id="2858705">ReadFrom</span><span class="op" id="2858713">(</span><span class="ident" id="2858714">r</span>&nbsp;<span class="ident" id="2858716">io</span><span class="op" id="2858718">.</span><span class="ident" id="2858719">Reader</span><span class="op" id="2858725">)</span>&nbsp;<span class="op" id="2858727">(</span><span class="ident" id="2858728">n</span>&nbsp;<span class="ident" id="2858730">int64</span><span class="op" id="2858735">,</span>&nbsp;<span class="ident" id="2858737">err</span>&nbsp;<span class="builtintype" id="2858741">error</span><span class="op" id="2858746">)</span>&nbsp;<span class="op" id="2858748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858751">if</span>&nbsp;<span class="ident" id="2858754">b</span><span class="op" id="2858755">.</span><span class="ident" id="2858756">Buffered</span><span class="op" id="2858764">(</span><span class="op" id="2858765">)</span>&nbsp;<span class="op" id="2858767">==</span>&nbsp;<span class="num" id="2858770">0</span>&nbsp;<span class="op" id="2858772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858776">if</span>&nbsp;<span class="ident" id="2858779">w</span><span class="op" id="2858780">,</span>&nbsp;<span class="ident" id="2858782">ok</span>&nbsp;<span class="op" id="2858785">:=</span>&nbsp;<span class="ident" id="2858788">b</span><span class="op" id="2858789">.</span><span class="ident" id="2858790">wr</span><span class="op" id="2858792">.</span><span class="op" id="2858793">(</span><span class="ident" id="2858794">io</span><span class="op" id="2858796">.</span><span class="ident" id="2858797">ReaderFrom</span><span class="op" id="2858807">)</span><span class="op" id="2858808">;</span>&nbsp;<span class="ident" id="2858810">ok</span>&nbsp;<span class="op" id="2858813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858818">return</span>&nbsp;<span class="ident" id="2858825">w</span><span class="op" id="2858826">.</span><span class="ident" id="2858827">ReadFrom</span><span class="op" id="2858835">(</span><span class="ident" id="2858836">r</span><span class="op" id="2858837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858841">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858847">var</span>&nbsp;<span class="ident" id="2858851">m</span>&nbsp;<span class="builtintype" id="2858853">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858858">for</span>&nbsp;<span class="op" id="2858862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858866">if</span>&nbsp;<span class="ident" id="2858869">b</span><span class="op" id="2858870">.</span><span class="ident" id="2858871">Available</span><span class="op" id="2858880">(</span><span class="op" id="2858881">)</span>&nbsp;<span class="op" id="2858883">==</span>&nbsp;<span class="num" id="2858886">0</span>&nbsp;<span class="op" id="2858888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858893">if</span>&nbsp;<span class="ident" id="2858896">err1</span>&nbsp;<span class="op" id="2858901">:=</span>&nbsp;<span class="ident" id="2858904">b</span><span class="op" id="2858905">.</span><span class="ident" id="2858906">flush</span><span class="op" id="2858911">(</span><span class="op" id="2858912">)</span><span class="op" id="2858913">;</span>&nbsp;<span class="ident" id="2858915">err1</span>&nbsp;<span class="op" id="2858920">!=</span>&nbsp;<span class="ident" id="2858923">nil</span>&nbsp;<span class="op" id="2858927">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858933">return</span>&nbsp;<span class="ident" id="2858940">n</span><span class="op" id="2858941">,</span>&nbsp;<span class="ident" id="2858943">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2858955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2858959">nr</span>&nbsp;<span class="op" id="2858962">:=</span>&nbsp;<span class="num" id="2858965">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2858969">for</span>&nbsp;<span class="ident" id="2858973">nr</span>&nbsp;<span class="op" id="2858976">&lt;</span>&nbsp;<span class="ident" id="2858978">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2859003">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859008">m</span><span class="op" id="2859009">,</span>&nbsp;<span class="ident" id="2859011">err</span>&nbsp;<span class="op" id="2859015">=</span>&nbsp;<span class="ident" id="2859017">r</span><span class="op" id="2859018">.</span><span class="ident" id="2859019">Read</span><span class="op" id="2859023">(</span><span class="ident" id="2859024">b</span><span class="op" id="2859025">.</span><span class="ident" id="2859026">buf</span><span class="op" id="2859029">[</span><span class="ident" id="2859030">b</span><span class="op" id="2859031">.</span><span class="ident" id="2859032">n</span><span class="op" id="2859033">:</span><span class="op" id="2859034">]</span><span class="op" id="2859035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859040">if</span>&nbsp;<span class="ident" id="2859043">m</span>&nbsp;<span class="op" id="2859045">!=</span>&nbsp;<span class="num" id="2859048">0</span>&nbsp;<span class="op" id="2859050">||</span>&nbsp;<span class="ident" id="2859053">err</span>&nbsp;<span class="op" id="2859057">!=</span>&nbsp;<span class="ident" id="2859060">nil</span>&nbsp;<span class="op" id="2859064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859070">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859084">nr</span><span class="op" id="2859086">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859095">if</span>&nbsp;<span class="ident" id="2859098">nr</span>&nbsp;<span class="op" id="2859101">==</span>&nbsp;<span class="ident" id="2859104">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2859129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859134">return</span>&nbsp;<span class="ident" id="2859141">n</span><span class="op" id="2859142">,</span>&nbsp;<span class="ident" id="2859144">io</span><span class="op" id="2859146">.</span><span class="ident" id="2859147">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859167">b</span><span class="op" id="2859168">.</span><span class="ident" id="2859169">n</span>&nbsp;<span class="op" id="2859171">+=</span>&nbsp;<span class="ident" id="2859174">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859178">n</span>&nbsp;<span class="op" id="2859180">+=</span>&nbsp;<span class="ident" id="2859183">int64</span><span class="op" id="2859188">(</span><span class="ident" id="2859189">m</span><span class="op" id="2859190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859194">if</span>&nbsp;<span class="ident" id="2859197">err</span>&nbsp;<span class="op" id="2859201">!=</span>&nbsp;<span class="ident" id="2859204">nil</span>&nbsp;<span class="op" id="2859208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859213">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859224">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859227">if</span>&nbsp;<span class="ident" id="2859230">err</span>&nbsp;<span class="op" id="2859234">==</span>&nbsp;<span class="ident" id="2859237">io</span><span class="op" id="2859239">.</span><span class="ident" id="2859240">EOF</span>&nbsp;<span class="op" id="2859244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2859248">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859307">if</span>&nbsp;<span class="ident" id="2859310">b</span><span class="op" id="2859311">.</span><span class="ident" id="2859312">Available</span><span class="op" id="2859321">(</span><span class="op" id="2859322">)</span>&nbsp;<span class="op" id="2859324">==</span>&nbsp;<span class="num" id="2859327">0</span>&nbsp;<span class="op" id="2859329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859334">err</span>&nbsp;<span class="op" id="2859338">=</span>&nbsp;<span class="ident" id="2859340">b</span><span class="op" id="2859341">.</span><span class="ident" id="2859342">flush</span><span class="op" id="2859347">(</span><span class="op" id="2859348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859352">}</span>&nbsp;<span class="keyword" id="2859354">else</span>&nbsp;<span class="op" id="2859359">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2859364">err</span>&nbsp;<span class="op" id="2859368">=</span>&nbsp;<span class="ident" id="2859370">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859382">return</span>&nbsp;<span class="ident" id="2859389">n</span><span class="op" id="2859390">,</span>&nbsp;<span class="ident" id="2859392">err</span><br>
<span class="lineno"></span><span class="op" id="2859396">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="2859399">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2859429">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="2859485">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="2859517">type</span>&nbsp;<span class="ident" id="2859522">ReadWriter</span>&nbsp;<span class="keyword" id="2859533">struct</span>&nbsp;<span class="op" id="2859540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859543">*</span><span class="ident" id="2859544">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2859552">*</span><span class="ident" id="2859553">Writer</span><br>
<span class="lineno"></span><span class="op" id="2859560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="2859563">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2859635">func</span>&nbsp;<span class="ident" id="2859640">NewReadWriter</span><span class="op" id="2859653">(</span><span class="ident" id="2859654">r</span>&nbsp;<span class="op" id="2859656">*</span><span class="ident" id="2859657">Reader</span><span class="op" id="2859663">,</span>&nbsp;<span class="ident" id="2859665">w</span>&nbsp;<span class="op" id="2859667">*</span><span class="ident" id="2859668">Writer</span><span class="op" id="2859674">)</span>&nbsp;<span class="op" id="2859676">*</span><span class="ident" id="2859677">ReadWriter</span>&nbsp;<span class="op" id="2859688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2859691">return</span>&nbsp;<span class="op" id="2859698">&amp;</span><span class="ident" id="2859699">ReadWriter</span><span class="op" id="2859709">{</span><span class="ident" id="2859710">r</span><span class="op" id="2859711">,</span>&nbsp;<span class="ident" id="2859713">w</span><span class="op" id="2859714">}</span><br>
<span class="lineno"></span><span class="op" id="2859716">}</span>
</div>
</body>
</html>
