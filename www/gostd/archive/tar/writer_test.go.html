<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7205971">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7206026">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7206080">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7206131">package</span>&nbsp;<span class="ident" id="7206139">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7206144">import</span>&nbsp;<span class="op" id="7206151">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206154">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206163">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206170">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206176">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206189">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206195">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206206">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206217">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206228">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7206246">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7206253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7206256">type</span>&nbsp;<span class="ident" id="7206261">writerTestEntry</span>&nbsp;<span class="keyword" id="7206277">struct</span>&nbsp;<span class="op" id="7206284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206287">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7206296">*</span><span class="ident" id="7206297">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206305">contents</span>&nbsp;<span class="builtintype" id="7206314">string</span><br>
<span class="lineno"></span><span class="op" id="7206321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7206324">type</span>&nbsp;<span class="ident" id="7206329">writerTest</span>&nbsp;<span class="keyword" id="7206340">struct</span>&nbsp;<span class="op" id="7206347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206350">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7206358">string</span>&nbsp;<span class="comment" id="7206365">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206397">entries</span>&nbsp;<span class="op" id="7206405">[</span><span class="op" id="7206406">]</span><span class="op" id="7206407">*</span><span class="ident" id="7206408">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7206424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7206427">var</span>&nbsp;<span class="ident" id="7206431">writerTests</span>&nbsp;<span class="op" id="7206443">=</span>&nbsp;<span class="op" id="7206445">[</span><span class="op" id="7206446">]</span><span class="op" id="7206447">*</span><span class="ident" id="7206448">writerTest</span><span class="op" id="7206458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7206461">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7206518">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7206541">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7206572">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206653">file</span><span class="op" id="7206657">:</span>&nbsp;<span class="string" id="7206659">&#34;testdata/writer.tar&#34;</span><span class="op" id="7206680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206684">entries</span><span class="op" id="7206691">:</span>&nbsp;<span class="op" id="7206693">[</span><span class="op" id="7206694">]</span><span class="op" id="7206695">*</span><span class="ident" id="7206696">writerTestEntry</span><span class="op" id="7206711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206722">header</span><span class="op" id="7206728">:</span>&nbsp;<span class="op" id="7206730">&amp;</span><span class="ident" id="7206731">Header</span><span class="op" id="7206737">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206744">Name</span><span class="op" id="7206748">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206754">&#34;small.txt&#34;</span><span class="op" id="7206765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206772">Mode</span><span class="op" id="7206776">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206782">0640</span><span class="op" id="7206786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206793">Uid</span><span class="op" id="7206796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206803">73025</span><span class="op" id="7206808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206815">Gid</span><span class="op" id="7206818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206825">5000</span><span class="op" id="7206829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206836">Size</span><span class="op" id="7206840">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206846">5</span><span class="op" id="7206847">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206854">ModTime</span><span class="op" id="7206861">:</span>&nbsp;&nbsp;<span class="ident" id="7206864">time</span><span class="op" id="7206868">.</span><span class="ident" id="7206869">Unix</span><span class="op" id="7206873">(</span><span class="num" id="7206874">1246508266</span><span class="op" id="7206884">,</span>&nbsp;<span class="num" id="7206886">0</span><span class="op" id="7206887">)</span><span class="op" id="7206888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206895">Typeflag</span><span class="op" id="7206903">:</span>&nbsp;<span class="string" id="7206905">&#39;0&#39;</span><span class="op" id="7206908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206915">Uname</span><span class="op" id="7206920">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206925">&#34;dsymonds&#34;</span><span class="op" id="7206935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206942">Gname</span><span class="op" id="7206947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206952">&#34;eng&#34;</span><span class="op" id="7206957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206963">}</span><span class="op" id="7206964">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206970">contents</span><span class="op" id="7206978">:</span>&nbsp;<span class="string" id="7206980">&#34;Kilts&#34;</span><span class="op" id="7206987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206992">}</span><span class="op" id="7206993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207004">header</span><span class="op" id="7207010">:</span>&nbsp;<span class="op" id="7207012">&amp;</span><span class="ident" id="7207013">Header</span><span class="op" id="7207019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207026">Name</span><span class="op" id="7207030">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207036">&#34;small2.txt&#34;</span><span class="op" id="7207048">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207055">Mode</span><span class="op" id="7207059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207065">0640</span><span class="op" id="7207069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207076">Uid</span><span class="op" id="7207079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207086">73025</span><span class="op" id="7207091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207098">Gid</span><span class="op" id="7207101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207108">5000</span><span class="op" id="7207112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207119">Size</span><span class="op" id="7207123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207129">11</span><span class="op" id="7207131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207138">ModTime</span><span class="op" id="7207145">:</span>&nbsp;&nbsp;<span class="ident" id="7207148">time</span><span class="op" id="7207152">.</span><span class="ident" id="7207153">Unix</span><span class="op" id="7207157">(</span><span class="num" id="7207158">1245217492</span><span class="op" id="7207168">,</span>&nbsp;<span class="num" id="7207170">0</span><span class="op" id="7207171">)</span><span class="op" id="7207172">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207179">Typeflag</span><span class="op" id="7207187">:</span>&nbsp;<span class="string" id="7207189">&#39;0&#39;</span><span class="op" id="7207192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207199">Uname</span><span class="op" id="7207204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207209">&#34;dsymonds&#34;</span><span class="op" id="7207219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207226">Gname</span><span class="op" id="7207231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207236">&#34;eng&#34;</span><span class="op" id="7207241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207247">}</span><span class="op" id="7207248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207254">contents</span><span class="op" id="7207262">:</span>&nbsp;<span class="string" id="7207264">&#34;Google.com\n&#34;</span><span class="op" id="7207278">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207283">}</span><span class="op" id="7207284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207295">header</span><span class="op" id="7207301">:</span>&nbsp;<span class="op" id="7207303">&amp;</span><span class="ident" id="7207304">Header</span><span class="op" id="7207310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207317">Name</span><span class="op" id="7207321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207327">&#34;link.txt&#34;</span><span class="op" id="7207337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207344">Mode</span><span class="op" id="7207348">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207354">0777</span><span class="op" id="7207358">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207365">Uid</span><span class="op" id="7207368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207375">1000</span><span class="op" id="7207379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207386">Gid</span><span class="op" id="7207389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207396">1000</span><span class="op" id="7207400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207407">Size</span><span class="op" id="7207411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207417">0</span><span class="op" id="7207418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207425">ModTime</span><span class="op" id="7207432">:</span>&nbsp;&nbsp;<span class="ident" id="7207435">time</span><span class="op" id="7207439">.</span><span class="ident" id="7207440">Unix</span><span class="op" id="7207444">(</span><span class="num" id="7207445">1314603082</span><span class="op" id="7207455">,</span>&nbsp;<span class="num" id="7207457">0</span><span class="op" id="7207458">)</span><span class="op" id="7207459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207466">Typeflag</span><span class="op" id="7207474">:</span>&nbsp;<span class="string" id="7207476">&#39;2&#39;</span><span class="op" id="7207479">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207486">Linkname</span><span class="op" id="7207494">:</span>&nbsp;<span class="string" id="7207496">&#34;small.txt&#34;</span><span class="op" id="7207507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207514">Uname</span><span class="op" id="7207519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207524">&#34;strings&#34;</span><span class="op" id="7207533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207540">Gname</span><span class="op" id="7207545">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207550">&#34;strings&#34;</span><span class="op" id="7207559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207565">}</span><span class="op" id="7207566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7207572">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207590">}</span><span class="op" id="7207591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207595">}</span><span class="op" id="7207596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207599">}</span><span class="op" id="7207600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7207603">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7207666">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7207728">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207806">file</span><span class="op" id="7207810">:</span>&nbsp;<span class="string" id="7207812">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7207837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207841">entries</span><span class="op" id="7207848">:</span>&nbsp;<span class="op" id="7207850">[</span><span class="op" id="7207851">]</span><span class="op" id="7207852">*</span><span class="ident" id="7207853">writerTestEntry</span><span class="op" id="7207868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207873">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207879">header</span><span class="op" id="7207885">:</span>&nbsp;<span class="op" id="7207887">&amp;</span><span class="ident" id="7207888">Header</span><span class="op" id="7207894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207901">Name</span><span class="op" id="7207905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207911">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7207926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207933">Mode</span><span class="op" id="7207937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207943">0640</span><span class="op" id="7207947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207954">Uid</span><span class="op" id="7207957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207964">73025</span><span class="op" id="7207969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207976">Gid</span><span class="op" id="7207979">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7207986">5000</span><span class="op" id="7207990">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207997">Size</span><span class="op" id="7208001">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7208007">16</span>&nbsp;<span class="op" id="7208010">&lt;&lt;</span>&nbsp;<span class="num" id="7208013">30</span><span class="op" id="7208015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208022">ModTime</span><span class="op" id="7208029">:</span>&nbsp;&nbsp;<span class="ident" id="7208032">time</span><span class="op" id="7208036">.</span><span class="ident" id="7208037">Unix</span><span class="op" id="7208041">(</span><span class="num" id="7208042">1254699560</span><span class="op" id="7208052">,</span>&nbsp;<span class="num" id="7208054">0</span><span class="op" id="7208055">)</span><span class="op" id="7208056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208063">Typeflag</span><span class="op" id="7208071">:</span>&nbsp;<span class="string" id="7208073">&#39;0&#39;</span><span class="op" id="7208076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208083">Uname</span><span class="op" id="7208088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7208093">&#34;dsymonds&#34;</span><span class="op" id="7208103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208110">Gname</span><span class="op" id="7208115">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7208120">&#34;eng&#34;</span><span class="op" id="7208125">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208131">}</span><span class="op" id="7208132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208138">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208159">contents</span><span class="op" id="7208167">:</span>&nbsp;<span class="ident" id="7208169">strings</span><span class="op" id="7208176">.</span><span class="ident" id="7208177">Repeat</span><span class="op" id="7208183">(</span><span class="string" id="7208184">&#34;\x00&#34;</span><span class="op" id="7208190">,</span>&nbsp;<span class="num" id="7208192">4</span><span class="op" id="7208193">&lt;&lt;</span><span class="num" id="7208195">10</span><span class="op" id="7208197">)</span><span class="op" id="7208198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208203">}</span><span class="op" id="7208204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208208">}</span><span class="op" id="7208209">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208212">}</span><span class="op" id="7208213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208216">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208279">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208352">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208442">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208446">file</span><span class="op" id="7208450">:</span>&nbsp;<span class="string" id="7208452">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7208482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208486">entries</span><span class="op" id="7208493">:</span>&nbsp;<span class="op" id="7208495">[</span><span class="op" id="7208496">]</span><span class="op" id="7208497">*</span><span class="ident" id="7208498">writerTestEntry</span><span class="op" id="7208513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208524">header</span><span class="op" id="7208530">:</span>&nbsp;<span class="op" id="7208532">&amp;</span><span class="ident" id="7208533">Header</span><span class="op" id="7208539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208546">Name</span><span class="op" id="7208550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208556">strings</span><span class="op" id="7208563">.</span><span class="ident" id="7208564">Repeat</span><span class="op" id="7208570">(</span><span class="string" id="7208571">&#34;longname/&#34;</span><span class="op" id="7208582">,</span>&nbsp;<span class="num" id="7208584">15</span><span class="op" id="7208586">)</span>&nbsp;<span class="op" id="7208588">+</span>&nbsp;<span class="string" id="7208590">&#34;16gig.txt&#34;</span><span class="op" id="7208601">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208608">Mode</span><span class="op" id="7208612">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7208618">0644</span><span class="op" id="7208622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208629">Uid</span><span class="op" id="7208632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7208639">1000</span><span class="op" id="7208643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208650">Gid</span><span class="op" id="7208653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7208660">1000</span><span class="op" id="7208664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208671">Size</span><span class="op" id="7208675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7208681">16</span>&nbsp;<span class="op" id="7208684">&lt;&lt;</span>&nbsp;<span class="num" id="7208687">30</span><span class="op" id="7208689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208696">ModTime</span><span class="op" id="7208703">:</span>&nbsp;&nbsp;<span class="ident" id="7208706">time</span><span class="op" id="7208710">.</span><span class="ident" id="7208711">Unix</span><span class="op" id="7208715">(</span><span class="num" id="7208716">1399583047</span><span class="op" id="7208726">,</span>&nbsp;<span class="num" id="7208728">0</span><span class="op" id="7208729">)</span><span class="op" id="7208730">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208737">Typeflag</span><span class="op" id="7208745">:</span>&nbsp;<span class="string" id="7208747">&#39;0&#39;</span><span class="op" id="7208750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208757">Uname</span><span class="op" id="7208762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7208767">&#34;guillaume&#34;</span><span class="op" id="7208778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208785">Gname</span><span class="op" id="7208790">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7208795">&#34;guillaume&#34;</span><span class="op" id="7208806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208812">}</span><span class="op" id="7208813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208819">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208840">contents</span><span class="op" id="7208848">:</span>&nbsp;<span class="ident" id="7208850">strings</span><span class="op" id="7208857">.</span><span class="ident" id="7208858">Repeat</span><span class="op" id="7208864">(</span><span class="string" id="7208865">&#34;\x00&#34;</span><span class="op" id="7208871">,</span>&nbsp;<span class="num" id="7208873">4</span><span class="op" id="7208874">&lt;&lt;</span><span class="num" id="7208876">10</span><span class="op" id="7208878">)</span><span class="op" id="7208879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208884">}</span><span class="op" id="7208885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208889">}</span><span class="op" id="7208890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208893">}</span><span class="op" id="7208894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208897">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7208943">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209005">file</span><span class="op" id="7209009">:</span>&nbsp;<span class="string" id="7209011">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7209031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209035">entries</span><span class="op" id="7209042">:</span>&nbsp;<span class="op" id="7209044">[</span><span class="op" id="7209045">]</span><span class="op" id="7209046">*</span><span class="ident" id="7209047">writerTestEntry</span><span class="op" id="7209062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209067">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209073">header</span><span class="op" id="7209079">:</span>&nbsp;<span class="op" id="7209081">&amp;</span><span class="ident" id="7209082">Header</span><span class="op" id="7209088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209095">Name</span><span class="op" id="7209099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209105">strings</span><span class="op" id="7209112">.</span><span class="ident" id="7209113">Repeat</span><span class="op" id="7209119">(</span><span class="string" id="7209120">&#34;longname/&#34;</span><span class="op" id="7209131">,</span>&nbsp;<span class="num" id="7209133">15</span><span class="op" id="7209135">)</span>&nbsp;<span class="op" id="7209137">+</span>&nbsp;<span class="string" id="7209139">&#34;file.txt&#34;</span><span class="op" id="7209149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209156">Mode</span><span class="op" id="7209160">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7209166">0644</span><span class="op" id="7209170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209177">Uid</span><span class="op" id="7209180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7209187">0765</span><span class="op" id="7209191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209198">Gid</span><span class="op" id="7209201">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7209208">024</span><span class="op" id="7209211">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209218">Size</span><span class="op" id="7209222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7209228">06</span><span class="op" id="7209230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209237">ModTime</span><span class="op" id="7209244">:</span>&nbsp;&nbsp;<span class="ident" id="7209247">time</span><span class="op" id="7209251">.</span><span class="ident" id="7209252">Unix</span><span class="op" id="7209256">(</span><span class="num" id="7209257">1360135598</span><span class="op" id="7209267">,</span>&nbsp;<span class="num" id="7209269">0</span><span class="op" id="7209270">)</span><span class="op" id="7209271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209278">Typeflag</span><span class="op" id="7209286">:</span>&nbsp;<span class="string" id="7209288">&#39;0&#39;</span><span class="op" id="7209291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209298">Uname</span><span class="op" id="7209303">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7209308">&#34;shane&#34;</span><span class="op" id="7209315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209322">Gname</span><span class="op" id="7209327">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7209332">&#34;staff&#34;</span><span class="op" id="7209339">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209345">}</span><span class="op" id="7209346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209352">contents</span><span class="op" id="7209360">:</span>&nbsp;<span class="string" id="7209362">&#34;hello\n&#34;</span><span class="op" id="7209371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209376">}</span><span class="op" id="7209377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209381">}</span><span class="op" id="7209382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209385">}</span><span class="op" id="7209386">,</span><br>
<span class="lineno">150</span><span class="op" id="7209388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7209391">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7209486">func</span>&nbsp;<span class="ident" id="7209491">bytestr</span><span class="op" id="7209498">(</span><span class="ident" id="7209499">offset</span>&nbsp;<span class="builtintype" id="7209506">int</span><span class="op" id="7209509">,</span>&nbsp;<span class="ident" id="7209511">b</span>&nbsp;<span class="op" id="7209513">[</span><span class="op" id="7209514">]</span><span class="builtintype" id="7209515">byte</span><span class="op" id="7209519">)</span>&nbsp;<span class="builtintype" id="7209521">string</span>&nbsp;<span class="op" id="7209528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209531">const</span>&nbsp;<span class="ident" id="7209537">rowLen</span>&nbsp;<span class="op" id="7209544">=</span>&nbsp;<span class="num" id="7209546">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209550">s</span>&nbsp;<span class="op" id="7209552">:=</span>&nbsp;<span class="ident" id="7209555">fmt</span><span class="op" id="7209558">.</span><span class="ident" id="7209559">Sprintf</span><span class="op" id="7209566">(</span><span class="string" id="7209567">&#34;%04x&nbsp;&#34;</span><span class="op" id="7209574">,</span>&nbsp;<span class="ident" id="7209576">offset</span><span class="op" id="7209582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209585">for</span>&nbsp;<span class="ident" id="7209589">_</span><span class="op" id="7209590">,</span>&nbsp;<span class="ident" id="7209592">ch</span>&nbsp;<span class="op" id="7209595">:=</span>&nbsp;<span class="keyword" id="7209598">range</span>&nbsp;<span class="ident" id="7209604">b</span>&nbsp;<span class="op" id="7209606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209610">switch</span>&nbsp;<span class="op" id="7209617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209621">case</span>&nbsp;<span class="string" id="7209626">&#39;0&#39;</span>&nbsp;<span class="op" id="7209630">&lt;=</span>&nbsp;<span class="ident" id="7209633">ch</span>&nbsp;<span class="op" id="7209636">&amp;&amp;</span>&nbsp;<span class="ident" id="7209639">ch</span>&nbsp;<span class="op" id="7209642">&lt;=</span>&nbsp;<span class="string" id="7209645">&#39;9&#39;</span><span class="op" id="7209648">,</span>&nbsp;<span class="string" id="7209650">&#39;A&#39;</span>&nbsp;<span class="op" id="7209654">&lt;=</span>&nbsp;<span class="ident" id="7209657">ch</span>&nbsp;<span class="op" id="7209660">&amp;&amp;</span>&nbsp;<span class="ident" id="7209663">ch</span>&nbsp;<span class="op" id="7209666">&lt;=</span>&nbsp;<span class="string" id="7209669">&#39;Z&#39;</span><span class="op" id="7209672">,</span>&nbsp;<span class="string" id="7209674">&#39;a&#39;</span>&nbsp;<span class="op" id="7209678">&lt;=</span>&nbsp;<span class="ident" id="7209681">ch</span>&nbsp;<span class="op" id="7209684">&amp;&amp;</span>&nbsp;<span class="ident" id="7209687">ch</span>&nbsp;<span class="op" id="7209690">&lt;=</span>&nbsp;<span class="string" id="7209693">&#39;z&#39;</span><span class="op" id="7209696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209701">s</span>&nbsp;<span class="op" id="7209703">+=</span>&nbsp;<span class="ident" id="7209706">fmt</span><span class="op" id="7209709">.</span><span class="ident" id="7209710">Sprintf</span><span class="op" id="7209717">(</span><span class="string" id="7209718">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7209724">,</span>&nbsp;<span class="ident" id="7209726">ch</span><span class="op" id="7209728">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209732">default</span><span class="op" id="7209739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209744">s</span>&nbsp;<span class="op" id="7209746">+=</span>&nbsp;<span class="ident" id="7209749">fmt</span><span class="op" id="7209752">.</span><span class="ident" id="7209753">Sprintf</span><span class="op" id="7209760">(</span><span class="string" id="7209761">&#34;&nbsp;%02x&#34;</span><span class="op" id="7209768">,</span>&nbsp;<span class="ident" id="7209770">ch</span><span class="op" id="7209772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209782">return</span>&nbsp;<span class="ident" id="7209789">s</span><br>
<span class="lineno">165</span><span class="op" id="7209791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7209794">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7209847">func</span>&nbsp;<span class="ident" id="7209852">bytediff</span><span class="op" id="7209860">(</span><span class="ident" id="7209861">a</span>&nbsp;<span class="op" id="7209863">[</span><span class="op" id="7209864">]</span><span class="builtintype" id="7209865">byte</span><span class="op" id="7209869">,</span>&nbsp;<span class="ident" id="7209871">b</span>&nbsp;<span class="op" id="7209873">[</span><span class="op" id="7209874">]</span><span class="builtintype" id="7209875">byte</span><span class="op" id="7209879">)</span>&nbsp;<span class="builtintype" id="7209881">string</span>&nbsp;<span class="op" id="7209888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209891">const</span>&nbsp;<span class="ident" id="7209897">rowLen</span>&nbsp;<span class="op" id="7209904">=</span>&nbsp;<span class="num" id="7209906">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209910">s</span>&nbsp;<span class="op" id="7209912">:=</span>&nbsp;<span class="ident" id="7209915">fmt</span><span class="op" id="7209918">.</span><span class="ident" id="7209919">Sprintf</span><span class="op" id="7209926">(</span><span class="string" id="7209927">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7209954">,</span>&nbsp;<span class="builtinfunc" id="7209956">len</span><span class="op" id="7209959">(</span><span class="ident" id="7209960">a</span><span class="op" id="7209961">)</span><span class="op" id="7209962">,</span>&nbsp;<span class="builtinfunc" id="7209964">len</span><span class="op" id="7209967">(</span><span class="ident" id="7209968">b</span><span class="op" id="7209969">)</span><span class="op" id="7209970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209973">for</span>&nbsp;<span class="ident" id="7209977">offset</span>&nbsp;<span class="op" id="7209984">:=</span>&nbsp;<span class="num" id="7209987">0</span><span class="op" id="7209988">;</span>&nbsp;<span class="builtinfunc" id="7209990">len</span><span class="op" id="7209993">(</span><span class="ident" id="7209994">a</span><span class="op" id="7209995">)</span><span class="op" id="7209996">+</span><span class="builtinfunc" id="7209997">len</span><span class="op" id="7210000">(</span><span class="ident" id="7210001">b</span><span class="op" id="7210002">)</span>&nbsp;<span class="op" id="7210004">&gt;</span>&nbsp;<span class="num" id="7210006">0</span><span class="op" id="7210007">;</span>&nbsp;<span class="ident" id="7210009">offset</span>&nbsp;<span class="op" id="7210016">+=</span>&nbsp;<span class="ident" id="7210019">rowLen</span>&nbsp;<span class="op" id="7210026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210030">na</span><span class="op" id="7210032">,</span>&nbsp;<span class="ident" id="7210034">nb</span>&nbsp;<span class="op" id="7210037">:=</span>&nbsp;<span class="ident" id="7210040">rowLen</span><span class="op" id="7210046">,</span>&nbsp;<span class="ident" id="7210048">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210057">if</span>&nbsp;<span class="ident" id="7210060">na</span>&nbsp;<span class="op" id="7210063">&gt;</span>&nbsp;<span class="builtinfunc" id="7210065">len</span><span class="op" id="7210068">(</span><span class="ident" id="7210069">a</span><span class="op" id="7210070">)</span>&nbsp;<span class="op" id="7210072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210077">na</span>&nbsp;<span class="op" id="7210080">=</span>&nbsp;<span class="builtinfunc" id="7210082">len</span><span class="op" id="7210085">(</span><span class="ident" id="7210086">a</span><span class="op" id="7210087">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210095">if</span>&nbsp;<span class="ident" id="7210098">nb</span>&nbsp;<span class="op" id="7210101">&gt;</span>&nbsp;<span class="builtinfunc" id="7210103">len</span><span class="op" id="7210106">(</span><span class="ident" id="7210107">b</span><span class="op" id="7210108">)</span>&nbsp;<span class="op" id="7210110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210115">nb</span>&nbsp;<span class="op" id="7210118">=</span>&nbsp;<span class="builtinfunc" id="7210120">len</span><span class="op" id="7210123">(</span><span class="ident" id="7210124">b</span><span class="op" id="7210125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210133">sa</span>&nbsp;<span class="op" id="7210136">:=</span>&nbsp;<span class="ident" id="7210139">bytestr</span><span class="op" id="7210146">(</span><span class="ident" id="7210147">offset</span><span class="op" id="7210153">,</span>&nbsp;<span class="ident" id="7210155">a</span><span class="op" id="7210156">[</span><span class="num" id="7210157">0</span><span class="op" id="7210158">:</span><span class="ident" id="7210159">na</span><span class="op" id="7210161">]</span><span class="op" id="7210162">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210166">sb</span>&nbsp;<span class="op" id="7210169">:=</span>&nbsp;<span class="ident" id="7210172">bytestr</span><span class="op" id="7210179">(</span><span class="ident" id="7210180">offset</span><span class="op" id="7210186">,</span>&nbsp;<span class="ident" id="7210188">b</span><span class="op" id="7210189">[</span><span class="num" id="7210190">0</span><span class="op" id="7210191">:</span><span class="ident" id="7210192">nb</span><span class="op" id="7210194">]</span><span class="op" id="7210195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210199">if</span>&nbsp;<span class="ident" id="7210202">sa</span>&nbsp;<span class="op" id="7210205">!=</span>&nbsp;<span class="ident" id="7210208">sb</span>&nbsp;<span class="op" id="7210211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210216">s</span>&nbsp;<span class="op" id="7210218">+=</span>&nbsp;<span class="ident" id="7210221">fmt</span><span class="op" id="7210224">.</span><span class="ident" id="7210225">Sprintf</span><span class="op" id="7210232">(</span><span class="string" id="7210233">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7210245">,</span>&nbsp;<span class="ident" id="7210247">sa</span><span class="op" id="7210249">,</span>&nbsp;<span class="ident" id="7210251">sb</span><span class="op" id="7210253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210261">a</span>&nbsp;<span class="op" id="7210263">=</span>&nbsp;<span class="ident" id="7210265">a</span><span class="op" id="7210266">[</span><span class="ident" id="7210267">na</span><span class="op" id="7210269">:</span><span class="op" id="7210270">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210274">b</span>&nbsp;<span class="op" id="7210276">=</span>&nbsp;<span class="ident" id="7210278">b</span><span class="op" id="7210279">[</span><span class="ident" id="7210280">nb</span><span class="op" id="7210282">:</span><span class="op" id="7210283">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210289">return</span>&nbsp;<span class="ident" id="7210296">s</span><br>
<span class="lineno"></span><span class="op" id="7210298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7210301">func</span>&nbsp;<span class="ident" id="7210306">TestWriter</span><span class="op" id="7210316">(</span><span class="ident" id="7210317">t</span>&nbsp;<span class="op" id="7210319">*</span><span class="ident" id="7210320">testing</span><span class="op" id="7210327">.</span><span class="ident" id="7210328">T</span><span class="op" id="7210329">)</span>&nbsp;<span class="op" id="7210331">{</span><br>
<span class="lineno"></span><span class="ident" id="7210333">testLoop</span><span class="op" id="7210341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210344">for</span>&nbsp;<span class="ident" id="7210348">i</span><span class="op" id="7210349">,</span>&nbsp;<span class="ident" id="7210351">test</span>&nbsp;<span class="op" id="7210356">:=</span>&nbsp;<span class="keyword" id="7210359">range</span>&nbsp;<span class="ident" id="7210365">writerTests</span>&nbsp;<span class="op" id="7210377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210381">expected</span><span class="op" id="7210389">,</span>&nbsp;<span class="ident" id="7210391">err</span>&nbsp;<span class="op" id="7210395">:=</span>&nbsp;<span class="ident" id="7210398">ioutil</span><span class="op" id="7210404">.</span><span class="ident" id="7210405">ReadFile</span><span class="op" id="7210413">(</span><span class="ident" id="7210414">test</span><span class="op" id="7210418">.</span><span class="ident" id="7210419">file</span><span class="op" id="7210423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210427">if</span>&nbsp;<span class="ident" id="7210430">err</span>&nbsp;<span class="op" id="7210434">!=</span>&nbsp;<span class="ident" id="7210437">nil</span>&nbsp;<span class="op" id="7210441">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210446">t</span><span class="op" id="7210447">.</span><span class="ident" id="7210448">Errorf</span><span class="op" id="7210454">(</span><span class="string" id="7210455">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7210486">,</span>&nbsp;<span class="ident" id="7210488">i</span><span class="op" id="7210489">,</span>&nbsp;<span class="ident" id="7210491">err</span><span class="op" id="7210494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210499">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210515">buf</span>&nbsp;<span class="op" id="7210519">:=</span>&nbsp;<span class="builtinfunc" id="7210522">new</span><span class="op" id="7210525">(</span><span class="ident" id="7210526">bytes</span><span class="op" id="7210531">.</span><span class="ident" id="7210532">Buffer</span><span class="op" id="7210538">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210542">tw</span>&nbsp;<span class="op" id="7210545">:=</span>&nbsp;<span class="ident" id="7210548">NewWriter</span><span class="op" id="7210557">(</span><span class="ident" id="7210558">iotest</span><span class="op" id="7210564">.</span><span class="ident" id="7210565">TruncateWriter</span><span class="op" id="7210579">(</span><span class="ident" id="7210580">buf</span><span class="op" id="7210583">,</span>&nbsp;<span class="num" id="7210585">4</span><span class="op" id="7210586">&lt;&lt;</span><span class="num" id="7210588">10</span><span class="op" id="7210590">)</span><span class="op" id="7210591">)</span>&nbsp;<span class="comment" id="7210593">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210624">big</span>&nbsp;<span class="op" id="7210628">:=</span>&nbsp;<span class="builtintype" id="7210631">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210639">for</span>&nbsp;<span class="ident" id="7210643">j</span><span class="op" id="7210644">,</span>&nbsp;<span class="ident" id="7210646">entry</span>&nbsp;<span class="op" id="7210652">:=</span>&nbsp;<span class="keyword" id="7210655">range</span>&nbsp;<span class="ident" id="7210661">test</span><span class="op" id="7210665">.</span><span class="ident" id="7210666">entries</span>&nbsp;<span class="op" id="7210674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210679">big</span>&nbsp;<span class="op" id="7210683">=</span>&nbsp;<span class="ident" id="7210685">big</span>&nbsp;<span class="op" id="7210689">||</span>&nbsp;<span class="ident" id="7210692">entry</span><span class="op" id="7210697">.</span><span class="ident" id="7210698">header</span><span class="op" id="7210704">.</span><span class="ident" id="7210705">Size</span>&nbsp;<span class="op" id="7210710">&gt;</span>&nbsp;<span class="num" id="7210712">1</span><span class="op" id="7210713">&lt;&lt;</span><span class="num" id="7210715">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210721">if</span>&nbsp;<span class="ident" id="7210724">err</span>&nbsp;<span class="op" id="7210728">:=</span>&nbsp;<span class="ident" id="7210731">tw</span><span class="op" id="7210733">.</span><span class="ident" id="7210734">WriteHeader</span><span class="op" id="7210745">(</span><span class="ident" id="7210746">entry</span><span class="op" id="7210751">.</span><span class="ident" id="7210752">header</span><span class="op" id="7210758">)</span><span class="op" id="7210759">;</span>&nbsp;<span class="ident" id="7210761">err</span>&nbsp;<span class="op" id="7210765">!=</span>&nbsp;<span class="ident" id="7210768">nil</span>&nbsp;<span class="op" id="7210772">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210778">t</span><span class="op" id="7210779">.</span><span class="ident" id="7210780">Errorf</span><span class="op" id="7210786">(</span><span class="string" id="7210787">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7210833">,</span>&nbsp;<span class="ident" id="7210835">i</span><span class="op" id="7210836">,</span>&nbsp;<span class="ident" id="7210838">j</span><span class="op" id="7210839">,</span>&nbsp;<span class="ident" id="7210841">err</span><span class="op" id="7210844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210850">continue</span>&nbsp;<span class="ident" id="7210859">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210876">if</span>&nbsp;<span class="ident" id="7210879">_</span><span class="op" id="7210880">,</span>&nbsp;<span class="ident" id="7210882">err</span>&nbsp;<span class="op" id="7210886">:=</span>&nbsp;<span class="ident" id="7210889">io</span><span class="op" id="7210891">.</span><span class="ident" id="7210892">WriteString</span><span class="op" id="7210903">(</span><span class="ident" id="7210904">tw</span><span class="op" id="7210906">,</span>&nbsp;<span class="ident" id="7210908">entry</span><span class="op" id="7210913">.</span><span class="ident" id="7210914">contents</span><span class="op" id="7210922">)</span><span class="op" id="7210923">;</span>&nbsp;<span class="ident" id="7210925">err</span>&nbsp;<span class="op" id="7210929">!=</span>&nbsp;<span class="ident" id="7210932">nil</span>&nbsp;<span class="op" id="7210936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210942">t</span><span class="op" id="7210943">.</span><span class="ident" id="7210944">Errorf</span><span class="op" id="7210950">(</span><span class="string" id="7210951">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7210999">,</span>&nbsp;<span class="ident" id="7211001">i</span><span class="op" id="7211002">,</span>&nbsp;<span class="ident" id="7211004">j</span><span class="op" id="7211005">,</span>&nbsp;<span class="ident" id="7211007">err</span><span class="op" id="7211010">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211016">continue</span>&nbsp;<span class="ident" id="7211025">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7211045">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211105">if</span>&nbsp;<span class="ident" id="7211108">err</span>&nbsp;<span class="op" id="7211112">:=</span>&nbsp;<span class="ident" id="7211115">tw</span><span class="op" id="7211117">.</span><span class="ident" id="7211118">Close</span><span class="op" id="7211123">(</span><span class="op" id="7211124">)</span><span class="op" id="7211125">;</span>&nbsp;<span class="ident" id="7211127">err</span>&nbsp;<span class="op" id="7211131">!=</span>&nbsp;<span class="ident" id="7211134">nil</span>&nbsp;<span class="op" id="7211138">&amp;&amp;</span>&nbsp;<span class="op" id="7211141">!</span><span class="ident" id="7211142">big</span>&nbsp;<span class="op" id="7211146">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211151">t</span><span class="op" id="7211152">.</span><span class="ident" id="7211153">Errorf</span><span class="op" id="7211159">(</span><span class="string" id="7211160">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7211197">,</span>&nbsp;<span class="ident" id="7211199">i</span><span class="op" id="7211200">,</span>&nbsp;<span class="ident" id="7211202">err</span><span class="op" id="7211205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211210">continue</span>&nbsp;<span class="ident" id="7211219">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211235">actual</span>&nbsp;<span class="op" id="7211242">:=</span>&nbsp;<span class="ident" id="7211245">buf</span><span class="op" id="7211248">.</span><span class="ident" id="7211249">Bytes</span><span class="op" id="7211254">(</span><span class="op" id="7211255">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211259">if</span>&nbsp;<span class="op" id="7211262">!</span><span class="ident" id="7211263">bytes</span><span class="op" id="7211268">.</span><span class="ident" id="7211269">Equal</span><span class="op" id="7211274">(</span><span class="ident" id="7211275">expected</span><span class="op" id="7211283">,</span>&nbsp;<span class="ident" id="7211285">actual</span><span class="op" id="7211291">)</span>&nbsp;<span class="op" id="7211293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211298">t</span><span class="op" id="7211299">.</span><span class="ident" id="7211300">Errorf</span><span class="op" id="7211306">(</span><span class="string" id="7211307">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7211362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211368">i</span><span class="op" id="7211369">,</span>&nbsp;<span class="ident" id="7211371">bytediff</span><span class="op" id="7211379">(</span><span class="ident" id="7211380">expected</span><span class="op" id="7211388">,</span>&nbsp;<span class="ident" id="7211390">actual</span><span class="op" id="7211396">)</span><span class="op" id="7211397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211405">if</span>&nbsp;<span class="ident" id="7211408">testing</span><span class="op" id="7211415">.</span><span class="ident" id="7211416">Short</span><span class="op" id="7211421">(</span><span class="op" id="7211422">)</span>&nbsp;<span class="op" id="7211424">{</span>&nbsp;<span class="comment" id="7211426">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211462">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211473">}</span><br>
<span class="lineno"></span><span class="op" id="7211475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7211478">func</span>&nbsp;<span class="ident" id="7211483">TestPax</span><span class="op" id="7211490">(</span><span class="ident" id="7211491">t</span>&nbsp;<span class="op" id="7211493">*</span><span class="ident" id="7211494">testing</span><span class="op" id="7211501">.</span><span class="ident" id="7211502">T</span><span class="op" id="7211503">)</span>&nbsp;<span class="op" id="7211505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7211508">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211548">fileinfo</span><span class="op" id="7211556">,</span>&nbsp;<span class="ident" id="7211558">err</span>&nbsp;<span class="op" id="7211562">:=</span>&nbsp;<span class="ident" id="7211565">os</span><span class="op" id="7211567">.</span><span class="ident" id="7211568">Stat</span><span class="op" id="7211572">(</span><span class="string" id="7211573">&#34;testdata/small.txt&#34;</span><span class="op" id="7211593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211596">if</span>&nbsp;<span class="ident" id="7211599">err</span>&nbsp;<span class="op" id="7211603">!=</span>&nbsp;<span class="ident" id="7211606">nil</span>&nbsp;<span class="op" id="7211610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211614">t</span><span class="op" id="7211615">.</span><span class="ident" id="7211616">Fatal</span><span class="op" id="7211621">(</span><span class="ident" id="7211622">err</span><span class="op" id="7211625">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211631">hdr</span><span class="op" id="7211634">,</span>&nbsp;<span class="ident" id="7211636">err</span>&nbsp;<span class="op" id="7211640">:=</span>&nbsp;<span class="ident" id="7211643">FileInfoHeader</span><span class="op" id="7211657">(</span><span class="ident" id="7211658">fileinfo</span><span class="op" id="7211666">,</span>&nbsp;<span class="string" id="7211668">&#34;&#34;</span><span class="op" id="7211670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211673">if</span>&nbsp;<span class="ident" id="7211676">err</span>&nbsp;<span class="op" id="7211680">!=</span>&nbsp;<span class="ident" id="7211683">nil</span>&nbsp;<span class="op" id="7211687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211691">t</span><span class="op" id="7211692">.</span><span class="ident" id="7211693">Fatalf</span><span class="op" id="7211699">(</span><span class="string" id="7211700">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7211713">,</span>&nbsp;<span class="ident" id="7211715">err</span><span class="op" id="7211718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211721">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7211724">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211764">longName</span>&nbsp;<span class="op" id="7211773">:=</span>&nbsp;<span class="ident" id="7211776">strings</span><span class="op" id="7211783">.</span><span class="ident" id="7211784">Repeat</span><span class="op" id="7211790">(</span><span class="string" id="7211791">&#34;ab&#34;</span><span class="op" id="7211795">,</span>&nbsp;<span class="num" id="7211797">100</span><span class="op" id="7211800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211803">contents</span>&nbsp;<span class="op" id="7211812">:=</span>&nbsp;<span class="ident" id="7211815">strings</span><span class="op" id="7211822">.</span><span class="ident" id="7211823">Repeat</span><span class="op" id="7211829">(</span><span class="string" id="7211830">&#34;&nbsp;&#34;</span><span class="op" id="7211833">,</span>&nbsp;<span class="builtintype" id="7211835">int</span><span class="op" id="7211838">(</span><span class="ident" id="7211839">hdr</span><span class="op" id="7211842">.</span><span class="ident" id="7211843">Size</span><span class="op" id="7211847">)</span><span class="op" id="7211848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211851">hdr</span><span class="op" id="7211854">.</span><span class="ident" id="7211855">Name</span>&nbsp;<span class="op" id="7211860">=</span>&nbsp;<span class="ident" id="7211862">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211872">var</span>&nbsp;<span class="ident" id="7211876">buf</span>&nbsp;<span class="ident" id="7211880">bytes</span><span class="op" id="7211885">.</span><span class="ident" id="7211886">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211894">writer</span>&nbsp;<span class="op" id="7211901">:=</span>&nbsp;<span class="ident" id="7211904">NewWriter</span><span class="op" id="7211913">(</span><span class="op" id="7211914">&amp;</span><span class="ident" id="7211915">buf</span><span class="op" id="7211918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211921">if</span>&nbsp;<span class="ident" id="7211924">err</span>&nbsp;<span class="op" id="7211928">:=</span>&nbsp;<span class="ident" id="7211931">writer</span><span class="op" id="7211937">.</span><span class="ident" id="7211938">WriteHeader</span><span class="op" id="7211949">(</span><span class="ident" id="7211950">hdr</span><span class="op" id="7211953">)</span><span class="op" id="7211954">;</span>&nbsp;<span class="ident" id="7211956">err</span>&nbsp;<span class="op" id="7211960">!=</span>&nbsp;<span class="ident" id="7211963">nil</span>&nbsp;<span class="op" id="7211967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7211971">t</span><span class="op" id="7211972">.</span><span class="ident" id="7211973">Fatal</span><span class="op" id="7211978">(</span><span class="ident" id="7211979">err</span><span class="op" id="7211982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7211985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7211988">if</span>&nbsp;<span class="ident" id="7211991">_</span><span class="op" id="7211992">,</span>&nbsp;<span class="ident" id="7211994">err</span>&nbsp;<span class="op" id="7211998">=</span>&nbsp;<span class="ident" id="7212000">writer</span><span class="op" id="7212006">.</span><span class="ident" id="7212007">Write</span><span class="op" id="7212012">(</span><span class="op" id="7212013">[</span><span class="op" id="7212014">]</span><span class="builtintype" id="7212015">byte</span><span class="op" id="7212019">(</span><span class="ident" id="7212020">contents</span><span class="op" id="7212028">)</span><span class="op" id="7212029">)</span><span class="op" id="7212030">;</span>&nbsp;<span class="ident" id="7212032">err</span>&nbsp;<span class="op" id="7212036">!=</span>&nbsp;<span class="ident" id="7212039">nil</span>&nbsp;<span class="op" id="7212043">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212047">t</span><span class="op" id="7212048">.</span><span class="ident" id="7212049">Fatal</span><span class="op" id="7212054">(</span><span class="ident" id="7212055">err</span><span class="op" id="7212058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212064">if</span>&nbsp;<span class="ident" id="7212067">err</span>&nbsp;<span class="op" id="7212071">:=</span>&nbsp;<span class="ident" id="7212074">writer</span><span class="op" id="7212080">.</span><span class="ident" id="7212081">Close</span><span class="op" id="7212086">(</span><span class="op" id="7212087">)</span><span class="op" id="7212088">;</span>&nbsp;<span class="ident" id="7212090">err</span>&nbsp;<span class="op" id="7212094">!=</span>&nbsp;<span class="ident" id="7212097">nil</span>&nbsp;<span class="op" id="7212101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212105">t</span><span class="op" id="7212106">.</span><span class="ident" id="7212107">Fatal</span><span class="op" id="7212112">(</span><span class="ident" id="7212113">err</span><span class="op" id="7212116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212119">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7212122">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212180">if</span>&nbsp;<span class="op" id="7212183">!</span><span class="ident" id="7212184">bytes</span><span class="op" id="7212189">.</span><span class="ident" id="7212190">Contains</span><span class="op" id="7212198">(</span><span class="ident" id="7212199">buf</span><span class="op" id="7212202">.</span><span class="ident" id="7212203">Bytes</span><span class="op" id="7212208">(</span><span class="op" id="7212209">)</span><span class="op" id="7212210">,</span>&nbsp;<span class="op" id="7212212">[</span><span class="op" id="7212213">]</span><span class="builtintype" id="7212214">byte</span><span class="op" id="7212218">(</span><span class="string" id="7212219">&#34;PaxHeaders.&#34;</span><span class="op" id="7212232">)</span><span class="op" id="7212233">)</span>&nbsp;<span class="op" id="7212235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212239">t</span><span class="op" id="7212240">.</span><span class="ident" id="7212241">Fatal</span><span class="op" id="7212246">(</span><span class="string" id="7212247">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7212296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7212302">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212364">reader</span>&nbsp;<span class="op" id="7212371">:=</span>&nbsp;<span class="ident" id="7212374">NewReader</span><span class="op" id="7212383">(</span><span class="op" id="7212384">&amp;</span><span class="ident" id="7212385">buf</span><span class="op" id="7212388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212391">hdr</span><span class="op" id="7212394">,</span>&nbsp;<span class="ident" id="7212396">err</span>&nbsp;<span class="op" id="7212400">=</span>&nbsp;<span class="ident" id="7212402">reader</span><span class="op" id="7212408">.</span><span class="ident" id="7212409">Next</span><span class="op" id="7212413">(</span><span class="op" id="7212414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212417">if</span>&nbsp;<span class="ident" id="7212420">err</span>&nbsp;<span class="op" id="7212424">!=</span>&nbsp;<span class="ident" id="7212427">nil</span>&nbsp;<span class="op" id="7212431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212435">t</span><span class="op" id="7212436">.</span><span class="ident" id="7212437">Fatal</span><span class="op" id="7212442">(</span><span class="ident" id="7212443">err</span><span class="op" id="7212446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212449">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212452">if</span>&nbsp;<span class="ident" id="7212455">hdr</span><span class="op" id="7212458">.</span><span class="ident" id="7212459">Name</span>&nbsp;<span class="op" id="7212464">!=</span>&nbsp;<span class="ident" id="7212467">longName</span>&nbsp;<span class="op" id="7212476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212480">t</span><span class="op" id="7212481">.</span><span class="ident" id="7212482">Fatal</span><span class="op" id="7212487">(</span><span class="string" id="7212488">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7212521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212524">}</span><br>
<span class="lineno"></span><span class="op" id="7212526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7212529">func</span>&nbsp;<span class="ident" id="7212534">TestPaxSymlink</span><span class="op" id="7212548">(</span><span class="ident" id="7212549">t</span>&nbsp;<span class="op" id="7212551">*</span><span class="ident" id="7212552">testing</span><span class="op" id="7212559">.</span><span class="ident" id="7212560">T</span><span class="op" id="7212561">)</span>&nbsp;<span class="op" id="7212563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7212566">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212610">fileinfo</span><span class="op" id="7212618">,</span>&nbsp;<span class="ident" id="7212620">err</span>&nbsp;<span class="op" id="7212624">:=</span>&nbsp;<span class="ident" id="7212627">os</span><span class="op" id="7212629">.</span><span class="ident" id="7212630">Stat</span><span class="op" id="7212634">(</span><span class="string" id="7212635">&#34;testdata/small.txt&#34;</span><span class="op" id="7212655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212658">if</span>&nbsp;<span class="ident" id="7212661">err</span>&nbsp;<span class="op" id="7212665">!=</span>&nbsp;<span class="ident" id="7212668">nil</span>&nbsp;<span class="op" id="7212672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212676">t</span><span class="op" id="7212677">.</span><span class="ident" id="7212678">Fatal</span><span class="op" id="7212683">(</span><span class="ident" id="7212684">err</span><span class="op" id="7212687">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212693">hdr</span><span class="op" id="7212696">,</span>&nbsp;<span class="ident" id="7212698">err</span>&nbsp;<span class="op" id="7212702">:=</span>&nbsp;<span class="ident" id="7212705">FileInfoHeader</span><span class="op" id="7212719">(</span><span class="ident" id="7212720">fileinfo</span><span class="op" id="7212728">,</span>&nbsp;<span class="string" id="7212730">&#34;&#34;</span><span class="op" id="7212732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212735">hdr</span><span class="op" id="7212738">.</span><span class="ident" id="7212739">Typeflag</span>&nbsp;<span class="op" id="7212748">=</span>&nbsp;<span class="ident" id="7212750">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212763">if</span>&nbsp;<span class="ident" id="7212766">err</span>&nbsp;<span class="op" id="7212770">!=</span>&nbsp;<span class="ident" id="7212773">nil</span>&nbsp;<span class="op" id="7212777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212781">t</span><span class="op" id="7212782">.</span><span class="ident" id="7212783">Fatalf</span><span class="op" id="7212789">(</span><span class="string" id="7212790">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7212804">,</span>&nbsp;<span class="ident" id="7212806">err</span><span class="op" id="7212809">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7212812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7212815">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212859">longLinkname</span>&nbsp;<span class="op" id="7212872">:=</span>&nbsp;<span class="ident" id="7212875">strings</span><span class="op" id="7212882">.</span><span class="ident" id="7212883">Repeat</span><span class="op" id="7212889">(</span><span class="string" id="7212890">&#34;1234567890/1234567890&#34;</span><span class="op" id="7212913">,</span>&nbsp;<span class="num" id="7212915">10</span><span class="op" id="7212917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212920">hdr</span><span class="op" id="7212923">.</span><span class="ident" id="7212924">Linkname</span>&nbsp;<span class="op" id="7212933">=</span>&nbsp;<span class="ident" id="7212935">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212950">hdr</span><span class="op" id="7212953">.</span><span class="ident" id="7212954">Size</span>&nbsp;<span class="op" id="7212959">=</span>&nbsp;<span class="num" id="7212961">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7212964">var</span>&nbsp;<span class="ident" id="7212968">buf</span>&nbsp;<span class="ident" id="7212972">bytes</span><span class="op" id="7212977">.</span><span class="ident" id="7212978">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7212986">writer</span>&nbsp;<span class="op" id="7212993">:=</span>&nbsp;<span class="ident" id="7212996">NewWriter</span><span class="op" id="7213005">(</span><span class="op" id="7213006">&amp;</span><span class="ident" id="7213007">buf</span><span class="op" id="7213010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213013">if</span>&nbsp;<span class="ident" id="7213016">err</span>&nbsp;<span class="op" id="7213020">:=</span>&nbsp;<span class="ident" id="7213023">writer</span><span class="op" id="7213029">.</span><span class="ident" id="7213030">WriteHeader</span><span class="op" id="7213041">(</span><span class="ident" id="7213042">hdr</span><span class="op" id="7213045">)</span><span class="op" id="7213046">;</span>&nbsp;<span class="ident" id="7213048">err</span>&nbsp;<span class="op" id="7213052">!=</span>&nbsp;<span class="ident" id="7213055">nil</span>&nbsp;<span class="op" id="7213059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213063">t</span><span class="op" id="7213064">.</span><span class="ident" id="7213065">Fatal</span><span class="op" id="7213070">(</span><span class="ident" id="7213071">err</span><span class="op" id="7213074">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213080">if</span>&nbsp;<span class="ident" id="7213083">err</span>&nbsp;<span class="op" id="7213087">:=</span>&nbsp;<span class="ident" id="7213090">writer</span><span class="op" id="7213096">.</span><span class="ident" id="7213097">Close</span><span class="op" id="7213102">(</span><span class="op" id="7213103">)</span><span class="op" id="7213104">;</span>&nbsp;<span class="ident" id="7213106">err</span>&nbsp;<span class="op" id="7213110">!=</span>&nbsp;<span class="ident" id="7213113">nil</span>&nbsp;<span class="op" id="7213117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213121">t</span><span class="op" id="7213122">.</span><span class="ident" id="7213123">Fatal</span><span class="op" id="7213128">(</span><span class="ident" id="7213129">err</span><span class="op" id="7213132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7213138">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213196">if</span>&nbsp;<span class="op" id="7213199">!</span><span class="ident" id="7213200">bytes</span><span class="op" id="7213205">.</span><span class="ident" id="7213206">Contains</span><span class="op" id="7213214">(</span><span class="ident" id="7213215">buf</span><span class="op" id="7213218">.</span><span class="ident" id="7213219">Bytes</span><span class="op" id="7213224">(</span><span class="op" id="7213225">)</span><span class="op" id="7213226">,</span>&nbsp;<span class="op" id="7213228">[</span><span class="op" id="7213229">]</span><span class="builtintype" id="7213230">byte</span><span class="op" id="7213234">(</span><span class="string" id="7213235">&#34;PaxHeaders.&#34;</span><span class="op" id="7213248">)</span><span class="op" id="7213249">)</span>&nbsp;<span class="op" id="7213251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213255">t</span><span class="op" id="7213256">.</span><span class="ident" id="7213257">Fatal</span><span class="op" id="7213262">(</span><span class="string" id="7213263">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7213312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7213318">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213380">reader</span>&nbsp;<span class="op" id="7213387">:=</span>&nbsp;<span class="ident" id="7213390">NewReader</span><span class="op" id="7213399">(</span><span class="op" id="7213400">&amp;</span><span class="ident" id="7213401">buf</span><span class="op" id="7213404">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213407">hdr</span><span class="op" id="7213410">,</span>&nbsp;<span class="ident" id="7213412">err</span>&nbsp;<span class="op" id="7213416">=</span>&nbsp;<span class="ident" id="7213418">reader</span><span class="op" id="7213424">.</span><span class="ident" id="7213425">Next</span><span class="op" id="7213429">(</span><span class="op" id="7213430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213433">if</span>&nbsp;<span class="ident" id="7213436">err</span>&nbsp;<span class="op" id="7213440">!=</span>&nbsp;<span class="ident" id="7213443">nil</span>&nbsp;<span class="op" id="7213447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213451">t</span><span class="op" id="7213452">.</span><span class="ident" id="7213453">Fatal</span><span class="op" id="7213458">(</span><span class="ident" id="7213459">err</span><span class="op" id="7213462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213468">if</span>&nbsp;<span class="ident" id="7213471">hdr</span><span class="op" id="7213474">.</span><span class="ident" id="7213475">Linkname</span>&nbsp;<span class="op" id="7213484">!=</span>&nbsp;<span class="ident" id="7213487">longLinkname</span>&nbsp;<span class="op" id="7213500">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213504">t</span><span class="op" id="7213505">.</span><span class="ident" id="7213506">Fatal</span><span class="op" id="7213511">(</span><span class="string" id="7213512">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7213545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213548">}</span><br>
<span class="lineno"></span><span class="op" id="7213550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213553">func</span>&nbsp;<span class="ident" id="7213558">TestPaxNonAscii</span><span class="op" id="7213573">(</span><span class="ident" id="7213574">t</span>&nbsp;<span class="op" id="7213576">*</span><span class="ident" id="7213577">testing</span><span class="op" id="7213584">.</span><span class="ident" id="7213585">T</span><span class="op" id="7213586">)</span>&nbsp;<span class="op" id="7213588">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7213591">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7213663">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213718">fileinfo</span><span class="op" id="7213726">,</span>&nbsp;<span class="ident" id="7213728">err</span>&nbsp;<span class="op" id="7213732">:=</span>&nbsp;<span class="ident" id="7213735">os</span><span class="op" id="7213737">.</span><span class="ident" id="7213738">Stat</span><span class="op" id="7213742">(</span><span class="string" id="7213743">&#34;testdata/small.txt&#34;</span><span class="op" id="7213763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213766">if</span>&nbsp;<span class="ident" id="7213769">err</span>&nbsp;<span class="op" id="7213773">!=</span>&nbsp;<span class="ident" id="7213776">nil</span>&nbsp;<span class="op" id="7213780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213784">t</span><span class="op" id="7213785">.</span><span class="ident" id="7213786">Fatal</span><span class="op" id="7213791">(</span><span class="ident" id="7213792">err</span><span class="op" id="7213795">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213802">hdr</span><span class="op" id="7213805">,</span>&nbsp;<span class="ident" id="7213807">err</span>&nbsp;<span class="op" id="7213811">:=</span>&nbsp;<span class="ident" id="7213814">FileInfoHeader</span><span class="op" id="7213828">(</span><span class="ident" id="7213829">fileinfo</span><span class="op" id="7213837">,</span>&nbsp;<span class="string" id="7213839">&#34;&#34;</span><span class="op" id="7213841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7213844">if</span>&nbsp;<span class="ident" id="7213847">err</span>&nbsp;<span class="op" id="7213851">!=</span>&nbsp;<span class="ident" id="7213854">nil</span>&nbsp;<span class="op" id="7213858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213862">t</span><span class="op" id="7213863">.</span><span class="ident" id="7213864">Fatalf</span><span class="op" id="7213870">(</span><span class="string" id="7213871">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7213885">,</span>&nbsp;<span class="ident" id="7213887">err</span><span class="op" id="7213890">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7213893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7213897">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213918">chineseFilename</span>&nbsp;<span class="op" id="7213934">:=</span>&nbsp;<span class="string" id="7213937">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213950">chineseGroupname</span>&nbsp;<span class="op" id="7213967">:=</span>&nbsp;<span class="string" id="7213970">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7213977">chineseUsername</span>&nbsp;<span class="op" id="7213993">:=</span>&nbsp;<span class="string" id="7213996">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214010">hdr</span><span class="op" id="7214013">.</span><span class="ident" id="7214014">Name</span>&nbsp;<span class="op" id="7214019">=</span>&nbsp;<span class="ident" id="7214021">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214038">hdr</span><span class="op" id="7214041">.</span><span class="ident" id="7214042">Gname</span>&nbsp;<span class="op" id="7214048">=</span>&nbsp;<span class="ident" id="7214050">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214068">hdr</span><span class="op" id="7214071">.</span><span class="ident" id="7214072">Uname</span>&nbsp;<span class="op" id="7214078">=</span>&nbsp;<span class="ident" id="7214080">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214098">contents</span>&nbsp;<span class="op" id="7214107">:=</span>&nbsp;<span class="ident" id="7214110">strings</span><span class="op" id="7214117">.</span><span class="ident" id="7214118">Repeat</span><span class="op" id="7214124">(</span><span class="string" id="7214125">&#34;&nbsp;&#34;</span><span class="op" id="7214128">,</span>&nbsp;<span class="builtintype" id="7214130">int</span><span class="op" id="7214133">(</span><span class="ident" id="7214134">hdr</span><span class="op" id="7214137">.</span><span class="ident" id="7214138">Size</span><span class="op" id="7214142">)</span><span class="op" id="7214143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214147">var</span>&nbsp;<span class="ident" id="7214151">buf</span>&nbsp;<span class="ident" id="7214155">bytes</span><span class="op" id="7214160">.</span><span class="ident" id="7214161">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214169">writer</span>&nbsp;<span class="op" id="7214176">:=</span>&nbsp;<span class="ident" id="7214179">NewWriter</span><span class="op" id="7214188">(</span><span class="op" id="7214189">&amp;</span><span class="ident" id="7214190">buf</span><span class="op" id="7214193">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214196">if</span>&nbsp;<span class="ident" id="7214199">err</span>&nbsp;<span class="op" id="7214203">:=</span>&nbsp;<span class="ident" id="7214206">writer</span><span class="op" id="7214212">.</span><span class="ident" id="7214213">WriteHeader</span><span class="op" id="7214224">(</span><span class="ident" id="7214225">hdr</span><span class="op" id="7214228">)</span><span class="op" id="7214229">;</span>&nbsp;<span class="ident" id="7214231">err</span>&nbsp;<span class="op" id="7214235">!=</span>&nbsp;<span class="ident" id="7214238">nil</span>&nbsp;<span class="op" id="7214242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214246">t</span><span class="op" id="7214247">.</span><span class="ident" id="7214248">Fatal</span><span class="op" id="7214253">(</span><span class="ident" id="7214254">err</span><span class="op" id="7214257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214263">if</span>&nbsp;<span class="ident" id="7214266">_</span><span class="op" id="7214267">,</span>&nbsp;<span class="ident" id="7214269">err</span>&nbsp;<span class="op" id="7214273">=</span>&nbsp;<span class="ident" id="7214275">writer</span><span class="op" id="7214281">.</span><span class="ident" id="7214282">Write</span><span class="op" id="7214287">(</span><span class="op" id="7214288">[</span><span class="op" id="7214289">]</span><span class="builtintype" id="7214290">byte</span><span class="op" id="7214294">(</span><span class="ident" id="7214295">contents</span><span class="op" id="7214303">)</span><span class="op" id="7214304">)</span><span class="op" id="7214305">;</span>&nbsp;<span class="ident" id="7214307">err</span>&nbsp;<span class="op" id="7214311">!=</span>&nbsp;<span class="ident" id="7214314">nil</span>&nbsp;<span class="op" id="7214318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214322">t</span><span class="op" id="7214323">.</span><span class="ident" id="7214324">Fatal</span><span class="op" id="7214329">(</span><span class="ident" id="7214330">err</span><span class="op" id="7214333">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214339">if</span>&nbsp;<span class="ident" id="7214342">err</span>&nbsp;<span class="op" id="7214346">:=</span>&nbsp;<span class="ident" id="7214349">writer</span><span class="op" id="7214355">.</span><span class="ident" id="7214356">Close</span><span class="op" id="7214361">(</span><span class="op" id="7214362">)</span><span class="op" id="7214363">;</span>&nbsp;<span class="ident" id="7214365">err</span>&nbsp;<span class="op" id="7214369">!=</span>&nbsp;<span class="ident" id="7214372">nil</span>&nbsp;<span class="op" id="7214376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214380">t</span><span class="op" id="7214381">.</span><span class="ident" id="7214382">Fatal</span><span class="op" id="7214387">(</span><span class="ident" id="7214388">err</span><span class="op" id="7214391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7214397">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214455">if</span>&nbsp;<span class="op" id="7214458">!</span><span class="ident" id="7214459">bytes</span><span class="op" id="7214464">.</span><span class="ident" id="7214465">Contains</span><span class="op" id="7214473">(</span><span class="ident" id="7214474">buf</span><span class="op" id="7214477">.</span><span class="ident" id="7214478">Bytes</span><span class="op" id="7214483">(</span><span class="op" id="7214484">)</span><span class="op" id="7214485">,</span>&nbsp;<span class="op" id="7214487">[</span><span class="op" id="7214488">]</span><span class="builtintype" id="7214489">byte</span><span class="op" id="7214493">(</span><span class="string" id="7214494">&#34;PaxHeaders.&#34;</span><span class="op" id="7214507">)</span><span class="op" id="7214508">)</span>&nbsp;<span class="op" id="7214510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214514">t</span><span class="op" id="7214515">.</span><span class="ident" id="7214516">Fatal</span><span class="op" id="7214521">(</span><span class="string" id="7214522">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7214571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7214577">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214639">reader</span>&nbsp;<span class="op" id="7214646">:=</span>&nbsp;<span class="ident" id="7214649">NewReader</span><span class="op" id="7214658">(</span><span class="op" id="7214659">&amp;</span><span class="ident" id="7214660">buf</span><span class="op" id="7214663">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214666">hdr</span><span class="op" id="7214669">,</span>&nbsp;<span class="ident" id="7214671">err</span>&nbsp;<span class="op" id="7214675">=</span>&nbsp;<span class="ident" id="7214677">reader</span><span class="op" id="7214683">.</span><span class="ident" id="7214684">Next</span><span class="op" id="7214688">(</span><span class="op" id="7214689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214692">if</span>&nbsp;<span class="ident" id="7214695">err</span>&nbsp;<span class="op" id="7214699">!=</span>&nbsp;<span class="ident" id="7214702">nil</span>&nbsp;<span class="op" id="7214706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214710">t</span><span class="op" id="7214711">.</span><span class="ident" id="7214712">Fatal</span><span class="op" id="7214717">(</span><span class="ident" id="7214718">err</span><span class="op" id="7214721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214727">if</span>&nbsp;<span class="ident" id="7214730">hdr</span><span class="op" id="7214733">.</span><span class="ident" id="7214734">Name</span>&nbsp;<span class="op" id="7214739">!=</span>&nbsp;<span class="ident" id="7214742">chineseFilename</span>&nbsp;<span class="op" id="7214758">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214762">t</span><span class="op" id="7214763">.</span><span class="ident" id="7214764">Fatal</span><span class="op" id="7214769">(</span><span class="string" id="7214770">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7214801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214807">if</span>&nbsp;<span class="ident" id="7214810">hdr</span><span class="op" id="7214813">.</span><span class="ident" id="7214814">Gname</span>&nbsp;<span class="op" id="7214820">!=</span>&nbsp;<span class="ident" id="7214823">chineseGroupname</span>&nbsp;<span class="op" id="7214840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214844">t</span><span class="op" id="7214845">.</span><span class="ident" id="7214846">Fatal</span><span class="op" id="7214851">(</span><span class="string" id="7214852">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7214884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214887">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214890">if</span>&nbsp;<span class="ident" id="7214893">hdr</span><span class="op" id="7214896">.</span><span class="ident" id="7214897">Uname</span>&nbsp;<span class="op" id="7214903">!=</span>&nbsp;<span class="ident" id="7214906">chineseUsername</span>&nbsp;<span class="op" id="7214922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214926">t</span><span class="op" id="7214927">.</span><span class="ident" id="7214928">Fatal</span><span class="op" id="7214933">(</span><span class="string" id="7214934">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7214965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214968">}</span><br>
<span class="lineno"></span><span class="op" id="7214970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7214973">func</span>&nbsp;<span class="ident" id="7214978">TestPaxXattrs</span><span class="op" id="7214991">(</span><span class="ident" id="7214992">t</span>&nbsp;<span class="op" id="7214994">*</span><span class="ident" id="7214995">testing</span><span class="op" id="7215002">.</span><span class="ident" id="7215003">T</span><span class="op" id="7215004">)</span>&nbsp;<span class="op" id="7215006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215009">xattrs</span>&nbsp;<span class="op" id="7215016">:=</span>&nbsp;<span class="keyword" id="7215019">map</span><span class="op" id="7215022">[</span><span class="builtintype" id="7215023">string</span><span class="op" id="7215029">]</span><span class="builtintype" id="7215030">string</span><span class="op" id="7215036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7215040">&#34;user.key&#34;</span><span class="op" id="7215050">:</span>&nbsp;<span class="string" id="7215052">&#34;value&#34;</span><span class="op" id="7215059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7215066">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215102">fileinfo</span><span class="op" id="7215110">,</span>&nbsp;<span class="ident" id="7215112">err</span>&nbsp;<span class="op" id="7215116">:=</span>&nbsp;<span class="ident" id="7215119">os</span><span class="op" id="7215121">.</span><span class="ident" id="7215122">Stat</span><span class="op" id="7215126">(</span><span class="string" id="7215127">&#34;testdata/small.txt&#34;</span><span class="op" id="7215147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215150">if</span>&nbsp;<span class="ident" id="7215153">err</span>&nbsp;<span class="op" id="7215157">!=</span>&nbsp;<span class="ident" id="7215160">nil</span>&nbsp;<span class="op" id="7215164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215168">t</span><span class="op" id="7215169">.</span><span class="ident" id="7215170">Fatal</span><span class="op" id="7215175">(</span><span class="ident" id="7215176">err</span><span class="op" id="7215179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215182">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215185">hdr</span><span class="op" id="7215188">,</span>&nbsp;<span class="ident" id="7215190">err</span>&nbsp;<span class="op" id="7215194">:=</span>&nbsp;<span class="ident" id="7215197">FileInfoHeader</span><span class="op" id="7215211">(</span><span class="ident" id="7215212">fileinfo</span><span class="op" id="7215220">,</span>&nbsp;<span class="string" id="7215222">&#34;&#34;</span><span class="op" id="7215224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215227">if</span>&nbsp;<span class="ident" id="7215230">err</span>&nbsp;<span class="op" id="7215234">!=</span>&nbsp;<span class="ident" id="7215237">nil</span>&nbsp;<span class="op" id="7215241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215245">t</span><span class="op" id="7215246">.</span><span class="ident" id="7215247">Fatalf</span><span class="op" id="7215253">(</span><span class="string" id="7215254">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7215267">,</span>&nbsp;<span class="ident" id="7215269">err</span><span class="op" id="7215272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215278">contents</span>&nbsp;<span class="op" id="7215287">:=</span>&nbsp;<span class="string" id="7215290">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215299">hdr</span><span class="op" id="7215302">.</span><span class="ident" id="7215303">Xattrs</span>&nbsp;<span class="op" id="7215310">=</span>&nbsp;<span class="ident" id="7215312">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215320">var</span>&nbsp;<span class="ident" id="7215324">buf</span>&nbsp;<span class="ident" id="7215328">bytes</span><span class="op" id="7215333">.</span><span class="ident" id="7215334">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215342">writer</span>&nbsp;<span class="op" id="7215349">:=</span>&nbsp;<span class="ident" id="7215352">NewWriter</span><span class="op" id="7215361">(</span><span class="op" id="7215362">&amp;</span><span class="ident" id="7215363">buf</span><span class="op" id="7215366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215369">if</span>&nbsp;<span class="ident" id="7215372">err</span>&nbsp;<span class="op" id="7215376">:=</span>&nbsp;<span class="ident" id="7215379">writer</span><span class="op" id="7215385">.</span><span class="ident" id="7215386">WriteHeader</span><span class="op" id="7215397">(</span><span class="ident" id="7215398">hdr</span><span class="op" id="7215401">)</span><span class="op" id="7215402">;</span>&nbsp;<span class="ident" id="7215404">err</span>&nbsp;<span class="op" id="7215408">!=</span>&nbsp;<span class="ident" id="7215411">nil</span>&nbsp;<span class="op" id="7215415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215419">t</span><span class="op" id="7215420">.</span><span class="ident" id="7215421">Fatal</span><span class="op" id="7215426">(</span><span class="ident" id="7215427">err</span><span class="op" id="7215430">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215436">if</span>&nbsp;<span class="ident" id="7215439">_</span><span class="op" id="7215440">,</span>&nbsp;<span class="ident" id="7215442">err</span>&nbsp;<span class="op" id="7215446">=</span>&nbsp;<span class="ident" id="7215448">writer</span><span class="op" id="7215454">.</span><span class="ident" id="7215455">Write</span><span class="op" id="7215460">(</span><span class="op" id="7215461">[</span><span class="op" id="7215462">]</span><span class="builtintype" id="7215463">byte</span><span class="op" id="7215467">(</span><span class="ident" id="7215468">contents</span><span class="op" id="7215476">)</span><span class="op" id="7215477">)</span><span class="op" id="7215478">;</span>&nbsp;<span class="ident" id="7215480">err</span>&nbsp;<span class="op" id="7215484">!=</span>&nbsp;<span class="ident" id="7215487">nil</span>&nbsp;<span class="op" id="7215491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215495">t</span><span class="op" id="7215496">.</span><span class="ident" id="7215497">Fatal</span><span class="op" id="7215502">(</span><span class="ident" id="7215503">err</span><span class="op" id="7215506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215512">if</span>&nbsp;<span class="ident" id="7215515">err</span>&nbsp;<span class="op" id="7215519">:=</span>&nbsp;<span class="ident" id="7215522">writer</span><span class="op" id="7215528">.</span><span class="ident" id="7215529">Close</span><span class="op" id="7215534">(</span><span class="op" id="7215535">)</span><span class="op" id="7215536">;</span>&nbsp;<span class="ident" id="7215538">err</span>&nbsp;<span class="op" id="7215542">!=</span>&nbsp;<span class="ident" id="7215545">nil</span>&nbsp;<span class="op" id="7215549">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215553">t</span><span class="op" id="7215554">.</span><span class="ident" id="7215555">Fatal</span><span class="op" id="7215560">(</span><span class="ident" id="7215561">err</span><span class="op" id="7215564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7215570">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215631">reader</span>&nbsp;<span class="op" id="7215638">:=</span>&nbsp;<span class="ident" id="7215641">NewReader</span><span class="op" id="7215650">(</span><span class="op" id="7215651">&amp;</span><span class="ident" id="7215652">buf</span><span class="op" id="7215655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215658">hdr</span><span class="op" id="7215661">,</span>&nbsp;<span class="ident" id="7215663">err</span>&nbsp;<span class="op" id="7215667">=</span>&nbsp;<span class="ident" id="7215669">reader</span><span class="op" id="7215675">.</span><span class="ident" id="7215676">Next</span><span class="op" id="7215680">(</span><span class="op" id="7215681">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215684">if</span>&nbsp;<span class="ident" id="7215687">err</span>&nbsp;<span class="op" id="7215691">!=</span>&nbsp;<span class="ident" id="7215694">nil</span>&nbsp;<span class="op" id="7215698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215702">t</span><span class="op" id="7215703">.</span><span class="ident" id="7215704">Fatal</span><span class="op" id="7215709">(</span><span class="ident" id="7215710">err</span><span class="op" id="7215713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215719">if</span>&nbsp;<span class="op" id="7215722">!</span><span class="ident" id="7215723">reflect</span><span class="op" id="7215730">.</span><span class="ident" id="7215731">DeepEqual</span><span class="op" id="7215740">(</span><span class="ident" id="7215741">hdr</span><span class="op" id="7215744">.</span><span class="ident" id="7215745">Xattrs</span><span class="op" id="7215751">,</span>&nbsp;<span class="ident" id="7215753">xattrs</span><span class="op" id="7215759">)</span>&nbsp;<span class="op" id="7215761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215765">t</span><span class="op" id="7215766">.</span><span class="ident" id="7215767">Fatalf</span><span class="op" id="7215773">(</span><span class="string" id="7215774">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7215828">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215833">hdr</span><span class="op" id="7215836">.</span><span class="ident" id="7215837">Xattrs</span><span class="op" id="7215843">,</span>&nbsp;<span class="ident" id="7215845">xattrs</span><span class="op" id="7215851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215854">}</span><br>
<span class="lineno"></span><span class="op" id="7215856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7215859">func</span>&nbsp;<span class="ident" id="7215864">TestPAXHeader</span><span class="op" id="7215877">(</span><span class="ident" id="7215878">t</span>&nbsp;<span class="op" id="7215880">*</span><span class="ident" id="7215881">testing</span><span class="op" id="7215888">.</span><span class="ident" id="7215889">T</span><span class="op" id="7215890">)</span>&nbsp;<span class="op" id="7215892">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215895">medName</span>&nbsp;<span class="op" id="7215903">:=</span>&nbsp;<span class="ident" id="7215906">strings</span><span class="op" id="7215913">.</span><span class="ident" id="7215914">Repeat</span><span class="op" id="7215920">(</span><span class="string" id="7215921">&#34;CD&#34;</span><span class="op" id="7215925">,</span>&nbsp;<span class="num" id="7215927">50</span><span class="op" id="7215929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215932">longName</span>&nbsp;<span class="op" id="7215941">:=</span>&nbsp;<span class="ident" id="7215944">strings</span><span class="op" id="7215951">.</span><span class="ident" id="7215952">Repeat</span><span class="op" id="7215958">(</span><span class="string" id="7215959">&#34;AB&#34;</span><span class="op" id="7215963">,</span>&nbsp;<span class="num" id="7215965">100</span><span class="op" id="7215968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215971">paxTests</span>&nbsp;<span class="op" id="7215980">:=</span>&nbsp;<span class="op" id="7215983">[</span><span class="op" id="7215984">]</span><span class="op" id="7215985">[</span><span class="num" id="7215986">2</span><span class="op" id="7215987">]</span><span class="builtintype" id="7215988">string</span><span class="op" id="7215994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215998">{</span><span class="ident" id="7215999">paxPath</span>&nbsp;<span class="op" id="7216007">+</span>&nbsp;<span class="string" id="7216009">&#34;=/etc/hosts&#34;</span><span class="op" id="7216022">,</span>&nbsp;<span class="string" id="7216024">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7216046">}</span><span class="op" id="7216047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216051">{</span><span class="string" id="7216052">&#34;a=b&#34;</span><span class="op" id="7216057">,</span>&nbsp;<span class="string" id="7216059">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7216068">}</span><span class="op" id="7216069">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7216080">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216105">{</span><span class="string" id="7216106">&#34;a=names&#34;</span><span class="op" id="7216115">,</span>&nbsp;<span class="string" id="7216117">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7216131">}</span><span class="op" id="7216132">,</span>&nbsp;<span class="comment" id="7216134">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216167">{</span><span class="ident" id="7216168">paxPath</span>&nbsp;<span class="op" id="7216176">+</span>&nbsp;<span class="string" id="7216178">&#34;=&#34;</span>&nbsp;<span class="op" id="7216182">+</span>&nbsp;<span class="ident" id="7216184">longName</span><span class="op" id="7216192">,</span>&nbsp;<span class="ident" id="7216194">fmt</span><span class="op" id="7216197">.</span><span class="ident" id="7216198">Sprintf</span><span class="op" id="7216205">(</span><span class="string" id="7216206">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7216221">,</span>&nbsp;<span class="ident" id="7216223">longName</span><span class="op" id="7216231">)</span><span class="op" id="7216232">}</span><span class="op" id="7216233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216237">{</span><span class="ident" id="7216238">paxPath</span>&nbsp;<span class="op" id="7216246">+</span>&nbsp;<span class="string" id="7216248">&#34;=&#34;</span>&nbsp;<span class="op" id="7216252">+</span>&nbsp;<span class="ident" id="7216254">medName</span><span class="op" id="7216261">,</span>&nbsp;<span class="ident" id="7216263">fmt</span><span class="op" id="7216266">.</span><span class="ident" id="7216267">Sprintf</span><span class="op" id="7216274">(</span><span class="string" id="7216275">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7216290">,</span>&nbsp;<span class="ident" id="7216292">medName</span><span class="op" id="7216299">)</span><span class="op" id="7216300">}</span><span class="op" id="7216301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7216305">for</span>&nbsp;<span class="ident" id="7216309">_</span><span class="op" id="7216310">,</span>&nbsp;<span class="ident" id="7216312">test</span>&nbsp;<span class="op" id="7216317">:=</span>&nbsp;<span class="keyword" id="7216320">range</span>&nbsp;<span class="ident" id="7216326">paxTests</span>&nbsp;<span class="op" id="7216335">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216339">key</span><span class="op" id="7216342">,</span>&nbsp;<span class="ident" id="7216344">expected</span>&nbsp;<span class="op" id="7216353">:=</span>&nbsp;<span class="ident" id="7216356">test</span><span class="op" id="7216360">[</span><span class="num" id="7216361">0</span><span class="op" id="7216362">]</span><span class="op" id="7216363">,</span>&nbsp;<span class="ident" id="7216365">test</span><span class="op" id="7216369">[</span><span class="num" id="7216370">1</span><span class="op" id="7216371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7216375">if</span>&nbsp;<span class="ident" id="7216378">result</span>&nbsp;<span class="op" id="7216385">:=</span>&nbsp;<span class="ident" id="7216388">paxHeader</span><span class="op" id="7216397">(</span><span class="ident" id="7216398">key</span><span class="op" id="7216401">)</span><span class="op" id="7216402">;</span>&nbsp;<span class="ident" id="7216404">result</span>&nbsp;<span class="op" id="7216411">!=</span>&nbsp;<span class="ident" id="7216414">expected</span>&nbsp;<span class="op" id="7216423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216428">t</span><span class="op" id="7216429">.</span><span class="ident" id="7216430">Fatalf</span><span class="op" id="7216436">(</span><span class="string" id="7216437">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7216469">,</span>&nbsp;<span class="ident" id="7216471">result</span><span class="op" id="7216477">,</span>&nbsp;<span class="ident" id="7216479">expected</span><span class="op" id="7216487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216494">}</span><br>
<span class="lineno">420</span><span class="op" id="7216496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7216499">func</span>&nbsp;<span class="ident" id="7216504">TestUSTARLongName</span><span class="op" id="7216521">(</span><span class="ident" id="7216522">t</span>&nbsp;<span class="op" id="7216524">*</span><span class="ident" id="7216525">testing</span><span class="op" id="7216532">.</span><span class="ident" id="7216533">T</span><span class="op" id="7216534">)</span>&nbsp;<span class="op" id="7216536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7216539">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216637">fileinfo</span><span class="op" id="7216645">,</span>&nbsp;<span class="ident" id="7216647">err</span>&nbsp;<span class="op" id="7216651">:=</span>&nbsp;<span class="ident" id="7216654">os</span><span class="op" id="7216656">.</span><span class="ident" id="7216657">Stat</span><span class="op" id="7216661">(</span><span class="string" id="7216662">&#34;testdata/small.txt&#34;</span><span class="op" id="7216682">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7216685">if</span>&nbsp;<span class="ident" id="7216688">err</span>&nbsp;<span class="op" id="7216692">!=</span>&nbsp;<span class="ident" id="7216695">nil</span>&nbsp;<span class="op" id="7216699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216703">t</span><span class="op" id="7216704">.</span><span class="ident" id="7216705">Fatal</span><span class="op" id="7216710">(</span><span class="ident" id="7216711">err</span><span class="op" id="7216714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216720">hdr</span><span class="op" id="7216723">,</span>&nbsp;<span class="ident" id="7216725">err</span>&nbsp;<span class="op" id="7216729">:=</span>&nbsp;<span class="ident" id="7216732">FileInfoHeader</span><span class="op" id="7216746">(</span><span class="ident" id="7216747">fileinfo</span><span class="op" id="7216755">,</span>&nbsp;<span class="string" id="7216757">&#34;&#34;</span><span class="op" id="7216759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216762">hdr</span><span class="op" id="7216765">.</span><span class="ident" id="7216766">Typeflag</span>&nbsp;<span class="op" id="7216775">=</span>&nbsp;<span class="ident" id="7216777">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7216786">if</span>&nbsp;<span class="ident" id="7216789">err</span>&nbsp;<span class="op" id="7216793">!=</span>&nbsp;<span class="ident" id="7216796">nil</span>&nbsp;<span class="op" id="7216800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7216804">t</span><span class="op" id="7216805">.</span><span class="ident" id="7216806">Fatalf</span><span class="op" id="7216812">(</span><span class="string" id="7216813">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7216827">,</span>&nbsp;<span class="ident" id="7216829">err</span><span class="op" id="7216832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7216835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7216838">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7216923">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217002">longName</span>&nbsp;<span class="op" id="7217011">:=</span>&nbsp;<span class="string" id="7217014">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217273">hdr</span><span class="op" id="7217276">.</span><span class="ident" id="7217277">Name</span>&nbsp;<span class="op" id="7217282">=</span>&nbsp;<span class="ident" id="7217284">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217295">hdr</span><span class="op" id="7217298">.</span><span class="ident" id="7217299">Size</span>&nbsp;<span class="op" id="7217304">=</span>&nbsp;<span class="num" id="7217306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217309">var</span>&nbsp;<span class="ident" id="7217313">buf</span>&nbsp;<span class="ident" id="7217317">bytes</span><span class="op" id="7217322">.</span><span class="ident" id="7217323">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217331">writer</span>&nbsp;<span class="op" id="7217338">:=</span>&nbsp;<span class="ident" id="7217341">NewWriter</span><span class="op" id="7217350">(</span><span class="op" id="7217351">&amp;</span><span class="ident" id="7217352">buf</span><span class="op" id="7217355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217358">if</span>&nbsp;<span class="ident" id="7217361">err</span>&nbsp;<span class="op" id="7217365">:=</span>&nbsp;<span class="ident" id="7217368">writer</span><span class="op" id="7217374">.</span><span class="ident" id="7217375">WriteHeader</span><span class="op" id="7217386">(</span><span class="ident" id="7217387">hdr</span><span class="op" id="7217390">)</span><span class="op" id="7217391">;</span>&nbsp;<span class="ident" id="7217393">err</span>&nbsp;<span class="op" id="7217397">!=</span>&nbsp;<span class="ident" id="7217400">nil</span>&nbsp;<span class="op" id="7217404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217408">t</span><span class="op" id="7217409">.</span><span class="ident" id="7217410">Fatal</span><span class="op" id="7217415">(</span><span class="ident" id="7217416">err</span><span class="op" id="7217419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7217422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217425">if</span>&nbsp;<span class="ident" id="7217428">err</span>&nbsp;<span class="op" id="7217432">:=</span>&nbsp;<span class="ident" id="7217435">writer</span><span class="op" id="7217441">.</span><span class="ident" id="7217442">Close</span><span class="op" id="7217447">(</span><span class="op" id="7217448">)</span><span class="op" id="7217449">;</span>&nbsp;<span class="ident" id="7217451">err</span>&nbsp;<span class="op" id="7217455">!=</span>&nbsp;<span class="ident" id="7217458">nil</span>&nbsp;<span class="op" id="7217462">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217466">t</span><span class="op" id="7217467">.</span><span class="ident" id="7217468">Fatal</span><span class="op" id="7217473">(</span><span class="ident" id="7217474">err</span><span class="op" id="7217477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7217480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7217483">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217545">reader</span>&nbsp;<span class="op" id="7217552">:=</span>&nbsp;<span class="ident" id="7217555">NewReader</span><span class="op" id="7217564">(</span><span class="op" id="7217565">&amp;</span><span class="ident" id="7217566">buf</span><span class="op" id="7217569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217572">hdr</span><span class="op" id="7217575">,</span>&nbsp;<span class="ident" id="7217577">err</span>&nbsp;<span class="op" id="7217581">=</span>&nbsp;<span class="ident" id="7217583">reader</span><span class="op" id="7217589">.</span><span class="ident" id="7217590">Next</span><span class="op" id="7217594">(</span><span class="op" id="7217595">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217598">if</span>&nbsp;<span class="ident" id="7217601">err</span>&nbsp;<span class="op" id="7217605">!=</span>&nbsp;<span class="ident" id="7217608">nil</span>&nbsp;<span class="op" id="7217612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217616">t</span><span class="op" id="7217617">.</span><span class="ident" id="7217618">Fatal</span><span class="op" id="7217623">(</span><span class="ident" id="7217624">err</span><span class="op" id="7217627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7217630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217633">if</span>&nbsp;<span class="ident" id="7217636">hdr</span><span class="op" id="7217639">.</span><span class="ident" id="7217640">Name</span>&nbsp;<span class="op" id="7217645">!=</span>&nbsp;<span class="ident" id="7217648">longName</span>&nbsp;<span class="op" id="7217657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217661">t</span><span class="op" id="7217662">.</span><span class="ident" id="7217663">Fatal</span><span class="op" id="7217668">(</span><span class="string" id="7217669">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7217697">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7217700">}</span><br>
<span class="lineno"></span><span class="op" id="7217702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7217705">func</span>&nbsp;<span class="ident" id="7217710">TestValidTypeflagWithPAXHeader</span><span class="op" id="7217740">(</span><span class="ident" id="7217741">t</span>&nbsp;<span class="op" id="7217743">*</span><span class="ident" id="7217744">testing</span><span class="op" id="7217751">.</span><span class="ident" id="7217752">T</span><span class="op" id="7217753">)</span>&nbsp;<span class="op" id="7217755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217758">var</span>&nbsp;<span class="ident" id="7217762">buffer</span>&nbsp;<span class="ident" id="7217769">bytes</span><span class="op" id="7217774">.</span><span class="ident" id="7217775">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217783">tw</span>&nbsp;<span class="op" id="7217786">:=</span>&nbsp;<span class="ident" id="7217789">NewWriter</span><span class="op" id="7217798">(</span><span class="op" id="7217799">&amp;</span><span class="ident" id="7217800">buffer</span><span class="op" id="7217806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217810">fileName</span>&nbsp;<span class="op" id="7217819">:=</span>&nbsp;<span class="ident" id="7217822">strings</span><span class="op" id="7217829">.</span><span class="ident" id="7217830">Repeat</span><span class="op" id="7217836">(</span><span class="string" id="7217837">&#34;ab&#34;</span><span class="op" id="7217841">,</span>&nbsp;<span class="num" id="7217843">100</span><span class="op" id="7217846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217850">hdr</span>&nbsp;<span class="op" id="7217854">:=</span>&nbsp;<span class="op" id="7217857">&amp;</span><span class="ident" id="7217858">Header</span><span class="op" id="7217864">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217868">Name</span><span class="op" id="7217872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7217878">fileName</span><span class="op" id="7217886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217890">Size</span><span class="op" id="7217894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7217900">4</span><span class="op" id="7217901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217905">Typeflag</span><span class="op" id="7217913">:</span>&nbsp;<span class="num" id="7217915">0</span><span class="op" id="7217916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7217919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7217922">if</span>&nbsp;<span class="ident" id="7217925">err</span>&nbsp;<span class="op" id="7217929">:=</span>&nbsp;<span class="ident" id="7217932">tw</span><span class="op" id="7217934">.</span><span class="ident" id="7217935">WriteHeader</span><span class="op" id="7217946">(</span><span class="ident" id="7217947">hdr</span><span class="op" id="7217950">)</span><span class="op" id="7217951">;</span>&nbsp;<span class="ident" id="7217953">err</span>&nbsp;<span class="op" id="7217957">!=</span>&nbsp;<span class="ident" id="7217960">nil</span>&nbsp;<span class="op" id="7217964">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7217968">t</span><span class="op" id="7217969">.</span><span class="ident" id="7217970">Fatalf</span><span class="op" id="7217976">(</span><span class="string" id="7217977">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7218005">,</span>&nbsp;<span class="ident" id="7218007">err</span><span class="op" id="7218010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218016">if</span>&nbsp;<span class="ident" id="7218019">_</span><span class="op" id="7218020">,</span>&nbsp;<span class="ident" id="7218022">err</span>&nbsp;<span class="op" id="7218026">:=</span>&nbsp;<span class="ident" id="7218029">tw</span><span class="op" id="7218031">.</span><span class="ident" id="7218032">Write</span><span class="op" id="7218037">(</span><span class="op" id="7218038">[</span><span class="op" id="7218039">]</span><span class="builtintype" id="7218040">byte</span><span class="op" id="7218044">(</span><span class="string" id="7218045">&#34;fooo&#34;</span><span class="op" id="7218051">)</span><span class="op" id="7218052">)</span><span class="op" id="7218053">;</span>&nbsp;<span class="ident" id="7218055">err</span>&nbsp;<span class="op" id="7218059">!=</span>&nbsp;<span class="ident" id="7218062">nil</span>&nbsp;<span class="op" id="7218066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218070">t</span><span class="op" id="7218071">.</span><span class="ident" id="7218072">Fatalf</span><span class="op" id="7218078">(</span><span class="string" id="7218079">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7218116">,</span>&nbsp;<span class="ident" id="7218118">err</span><span class="op" id="7218121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218124">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218127">tw</span><span class="op" id="7218129">.</span><span class="ident" id="7218130">Close</span><span class="op" id="7218135">(</span><span class="op" id="7218136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218140">tr</span>&nbsp;<span class="op" id="7218143">:=</span>&nbsp;<span class="ident" id="7218146">NewReader</span><span class="op" id="7218155">(</span><span class="op" id="7218156">&amp;</span><span class="ident" id="7218157">buffer</span><span class="op" id="7218163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218167">for</span>&nbsp;<span class="op" id="7218171">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218175">header</span><span class="op" id="7218181">,</span>&nbsp;<span class="ident" id="7218183">err</span>&nbsp;<span class="op" id="7218187">:=</span>&nbsp;<span class="ident" id="7218190">tr</span><span class="op" id="7218192">.</span><span class="ident" id="7218193">Next</span><span class="op" id="7218197">(</span><span class="op" id="7218198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218202">if</span>&nbsp;<span class="ident" id="7218205">err</span>&nbsp;<span class="op" id="7218209">==</span>&nbsp;<span class="ident" id="7218212">io</span><span class="op" id="7218214">.</span><span class="ident" id="7218215">EOF</span>&nbsp;<span class="op" id="7218219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218224">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218236">if</span>&nbsp;<span class="ident" id="7218239">err</span>&nbsp;<span class="op" id="7218243">!=</span>&nbsp;<span class="ident" id="7218246">nil</span>&nbsp;<span class="op" id="7218250">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218255">t</span><span class="op" id="7218256">.</span><span class="ident" id="7218257">Fatalf</span><span class="op" id="7218263">(</span><span class="string" id="7218264">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7218291">,</span>&nbsp;<span class="ident" id="7218293">err</span><span class="op" id="7218296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7218304">if</span>&nbsp;<span class="ident" id="7218307">header</span><span class="op" id="7218313">.</span><span class="ident" id="7218314">Typeflag</span>&nbsp;<span class="op" id="7218323">!=</span>&nbsp;<span class="num" id="7218326">0</span>&nbsp;<span class="op" id="7218328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7218333">t</span><span class="op" id="7218334">.</span><span class="ident" id="7218335">Fatalf</span><span class="op" id="7218341">(</span><span class="string" id="7218342">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7218379">,</span>&nbsp;<span class="ident" id="7218381">header</span><span class="op" id="7218387">.</span><span class="ident" id="7218388">Typeflag</span><span class="op" id="7218396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218400">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7218403">}</span><br>
<span class="lineno"></span><span class="op" id="7218405">}</span>
</div>
</body>
</html>
