<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5297747">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5297803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5297857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5297908">package</span>&nbsp;<span class="ident" id="5297916">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5297924">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5298002">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5298082">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5298159">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5298230">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5298304">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5298371">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5298439">func</span>&nbsp;<span class="op" id="5298444">(</span><span class="ident" id="5298445">re</span>&nbsp;<span class="op" id="5298448">*</span><span class="ident" id="5298449">Regexp</span><span class="op" id="5298455">)</span>&nbsp;<span class="ident" id="5298457">Simplify</span><span class="op" id="5298465">(</span><span class="op" id="5298466">)</span>&nbsp;<span class="op" id="5298468">*</span><span class="ident" id="5298469">Regexp</span>&nbsp;<span class="op" id="5298476">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298479">if</span>&nbsp;<span class="ident" id="5298482">re</span>&nbsp;<span class="op" id="5298485">==</span>&nbsp;<span class="ident" id="5298488">nil</span>&nbsp;<span class="op" id="5298492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298496">return</span>&nbsp;<span class="ident" id="5298503">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5298508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298511">switch</span>&nbsp;<span class="ident" id="5298518">re</span><span class="op" id="5298520">.</span><span class="ident" id="5298521">Op</span>&nbsp;<span class="op" id="5298524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298527">case</span>&nbsp;<span class="ident" id="5298532">OpCapture</span><span class="op" id="5298541">,</span>&nbsp;<span class="ident" id="5298543">OpConcat</span><span class="op" id="5298551">,</span>&nbsp;<span class="ident" id="5298553">OpAlternate</span><span class="op" id="5298564">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5298568">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298632">nre</span>&nbsp;<span class="op" id="5298636">:=</span>&nbsp;<span class="ident" id="5298639">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298644">for</span>&nbsp;<span class="ident" id="5298648">i</span><span class="op" id="5298649">,</span>&nbsp;<span class="ident" id="5298651">sub</span>&nbsp;<span class="op" id="5298655">:=</span>&nbsp;<span class="keyword" id="5298658">range</span>&nbsp;<span class="ident" id="5298664">re</span><span class="op" id="5298666">.</span><span class="ident" id="5298667">Sub</span>&nbsp;<span class="op" id="5298671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298676">nsub</span>&nbsp;<span class="op" id="5298681">:=</span>&nbsp;<span class="ident" id="5298684">sub</span><span class="op" id="5298687">.</span><span class="ident" id="5298688">Simplify</span><span class="op" id="5298696">(</span><span class="op" id="5298697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298702">if</span>&nbsp;<span class="ident" id="5298705">nre</span>&nbsp;<span class="op" id="5298709">==</span>&nbsp;<span class="ident" id="5298712">re</span>&nbsp;<span class="op" id="5298715">&amp;&amp;</span>&nbsp;<span class="ident" id="5298718">nsub</span>&nbsp;<span class="op" id="5298723">!=</span>&nbsp;<span class="ident" id="5298726">sub</span>&nbsp;<span class="op" id="5298730">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5298736">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298757">nre</span>&nbsp;<span class="op" id="5298761">=</span>&nbsp;<span class="builtinfunc" id="5298763">new</span><span class="op" id="5298766">(</span><span class="ident" id="5298767">Regexp</span><span class="op" id="5298773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5298779">*</span><span class="ident" id="5298780">nre</span>&nbsp;<span class="op" id="5298784">=</span>&nbsp;<span class="op" id="5298786">*</span><span class="ident" id="5298787">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298794">nre</span><span class="op" id="5298797">.</span><span class="ident" id="5298798">Rune</span>&nbsp;<span class="op" id="5298803">=</span>&nbsp;<span class="ident" id="5298805">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298813">nre</span><span class="op" id="5298816">.</span><span class="ident" id="5298817">Sub</span>&nbsp;<span class="op" id="5298821">=</span>&nbsp;<span class="builtinfunc" id="5298823">append</span><span class="op" id="5298829">(</span><span class="ident" id="5298830">nre</span><span class="op" id="5298833">.</span><span class="ident" id="5298834">Sub0</span><span class="op" id="5298838">[</span><span class="op" id="5298839">:</span><span class="num" id="5298840">0</span><span class="op" id="5298841">]</span><span class="op" id="5298842">,</span>&nbsp;<span class="ident" id="5298844">re</span><span class="op" id="5298846">.</span><span class="ident" id="5298847">Sub</span><span class="op" id="5298850">[</span><span class="op" id="5298851">:</span><span class="ident" id="5298852">i</span><span class="op" id="5298853">]</span><span class="op" id="5298854">...</span><span class="op" id="5298857">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5298862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298867">if</span>&nbsp;<span class="ident" id="5298870">nre</span>&nbsp;<span class="op" id="5298874">!=</span>&nbsp;<span class="ident" id="5298877">re</span>&nbsp;<span class="op" id="5298880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298886">nre</span><span class="op" id="5298889">.</span><span class="ident" id="5298890">Sub</span>&nbsp;<span class="op" id="5298894">=</span>&nbsp;<span class="builtinfunc" id="5298896">append</span><span class="op" id="5298902">(</span><span class="ident" id="5298903">nre</span><span class="op" id="5298906">.</span><span class="ident" id="5298907">Sub</span><span class="op" id="5298910">,</span>&nbsp;<span class="ident" id="5298912">nsub</span><span class="op" id="5298916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5298921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5298925">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298929">return</span>&nbsp;<span class="ident" id="5298936">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298942">case</span>&nbsp;<span class="ident" id="5298947">OpStar</span><span class="op" id="5298953">,</span>&nbsp;<span class="ident" id="5298955">OpPlus</span><span class="op" id="5298961">,</span>&nbsp;<span class="ident" id="5298963">OpQuest</span><span class="op" id="5298970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298974">sub</span>&nbsp;<span class="op" id="5298978">:=</span>&nbsp;<span class="ident" id="5298981">re</span><span class="op" id="5298983">.</span><span class="ident" id="5298984">Sub</span><span class="op" id="5298987">[</span><span class="num" id="5298988">0</span><span class="op" id="5298989">]</span><span class="op" id="5298990">.</span><span class="ident" id="5298991">Simplify</span><span class="op" id="5298999">(</span><span class="op" id="5299000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299004">return</span>&nbsp;<span class="ident" id="5299011">simplify1</span><span class="op" id="5299020">(</span><span class="ident" id="5299021">re</span><span class="op" id="5299023">.</span><span class="ident" id="5299024">Op</span><span class="op" id="5299026">,</span>&nbsp;<span class="ident" id="5299028">re</span><span class="op" id="5299030">.</span><span class="ident" id="5299031">Flags</span><span class="op" id="5299036">,</span>&nbsp;<span class="ident" id="5299038">sub</span><span class="op" id="5299041">,</span>&nbsp;<span class="ident" id="5299043">re</span><span class="op" id="5299045">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299049">case</span>&nbsp;<span class="ident" id="5299054">OpRepeat</span><span class="op" id="5299062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299066">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299123">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299165">if</span>&nbsp;<span class="ident" id="5299168">re</span><span class="op" id="5299170">.</span><span class="ident" id="5299171">Min</span>&nbsp;<span class="op" id="5299175">==</span>&nbsp;<span class="num" id="5299178">0</span>&nbsp;<span class="op" id="5299180">&amp;&amp;</span>&nbsp;<span class="ident" id="5299183">re</span><span class="op" id="5299185">.</span><span class="ident" id="5299186">Max</span>&nbsp;<span class="op" id="5299190">==</span>&nbsp;<span class="num" id="5299193">0</span>&nbsp;<span class="op" id="5299195">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299200">return</span>&nbsp;<span class="op" id="5299207">&amp;</span><span class="ident" id="5299208">Regexp</span><span class="op" id="5299214">{</span><span class="ident" id="5299215">Op</span><span class="op" id="5299217">:</span>&nbsp;<span class="ident" id="5299219">OpEmptyMatch</span><span class="op" id="5299231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299240">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299261">sub</span>&nbsp;<span class="op" id="5299265">:=</span>&nbsp;<span class="ident" id="5299268">re</span><span class="op" id="5299270">.</span><span class="ident" id="5299271">Sub</span><span class="op" id="5299274">[</span><span class="num" id="5299275">0</span><span class="op" id="5299276">]</span><span class="op" id="5299277">.</span><span class="ident" id="5299278">Simplify</span><span class="op" id="5299286">(</span><span class="op" id="5299287">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299292">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299334">if</span>&nbsp;<span class="ident" id="5299337">re</span><span class="op" id="5299339">.</span><span class="ident" id="5299340">Max</span>&nbsp;<span class="op" id="5299344">==</span>&nbsp;<span class="op" id="5299347">-</span><span class="num" id="5299348">1</span>&nbsp;<span class="op" id="5299350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299355">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299388">if</span>&nbsp;<span class="ident" id="5299391">re</span><span class="op" id="5299393">.</span><span class="ident" id="5299394">Min</span>&nbsp;<span class="op" id="5299398">==</span>&nbsp;<span class="num" id="5299401">0</span>&nbsp;<span class="op" id="5299403">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299409">return</span>&nbsp;<span class="ident" id="5299416">simplify1</span><span class="op" id="5299425">(</span><span class="ident" id="5299426">OpStar</span><span class="op" id="5299432">,</span>&nbsp;<span class="ident" id="5299434">re</span><span class="op" id="5299436">.</span><span class="ident" id="5299437">Flags</span><span class="op" id="5299442">,</span>&nbsp;<span class="ident" id="5299444">sub</span><span class="op" id="5299447">,</span>&nbsp;<span class="ident" id="5299449">nil</span><span class="op" id="5299452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299463">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299496">if</span>&nbsp;<span class="ident" id="5299499">re</span><span class="op" id="5299501">.</span><span class="ident" id="5299502">Min</span>&nbsp;<span class="op" id="5299506">==</span>&nbsp;<span class="num" id="5299509">1</span>&nbsp;<span class="op" id="5299511">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299517">return</span>&nbsp;<span class="ident" id="5299524">simplify1</span><span class="op" id="5299533">(</span><span class="ident" id="5299534">OpPlus</span><span class="op" id="5299540">,</span>&nbsp;<span class="ident" id="5299542">re</span><span class="op" id="5299544">.</span><span class="ident" id="5299545">Flags</span><span class="op" id="5299550">,</span>&nbsp;<span class="ident" id="5299552">sub</span><span class="op" id="5299555">,</span>&nbsp;<span class="ident" id="5299557">nil</span><span class="op" id="5299560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299571">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299607">nre</span>&nbsp;<span class="op" id="5299611">:=</span>&nbsp;<span class="op" id="5299614">&amp;</span><span class="ident" id="5299615">Regexp</span><span class="op" id="5299621">{</span><span class="ident" id="5299622">Op</span><span class="op" id="5299624">:</span>&nbsp;<span class="ident" id="5299626">OpConcat</span><span class="op" id="5299634">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299639">nre</span><span class="op" id="5299642">.</span><span class="ident" id="5299643">Sub</span>&nbsp;<span class="op" id="5299647">=</span>&nbsp;<span class="ident" id="5299649">nre</span><span class="op" id="5299652">.</span><span class="ident" id="5299653">Sub0</span><span class="op" id="5299657">[</span><span class="op" id="5299658">:</span><span class="num" id="5299659">0</span><span class="op" id="5299660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299665">for</span>&nbsp;<span class="ident" id="5299669">i</span>&nbsp;<span class="op" id="5299671">:=</span>&nbsp;<span class="num" id="5299674">0</span><span class="op" id="5299675">;</span>&nbsp;<span class="ident" id="5299677">i</span>&nbsp;<span class="op" id="5299679">&lt;</span>&nbsp;<span class="ident" id="5299681">re</span><span class="op" id="5299683">.</span><span class="ident" id="5299684">Min</span><span class="op" id="5299687">-</span><span class="num" id="5299688">1</span><span class="op" id="5299689">;</span>&nbsp;<span class="ident" id="5299691">i</span><span class="op" id="5299692">++</span>&nbsp;<span class="op" id="5299695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299701">nre</span><span class="op" id="5299704">.</span><span class="ident" id="5299705">Sub</span>&nbsp;<span class="op" id="5299709">=</span>&nbsp;<span class="builtinfunc" id="5299711">append</span><span class="op" id="5299717">(</span><span class="ident" id="5299718">nre</span><span class="op" id="5299721">.</span><span class="ident" id="5299722">Sub</span><span class="op" id="5299725">,</span>&nbsp;<span class="ident" id="5299727">sub</span><span class="op" id="5299730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299740">nre</span><span class="op" id="5299743">.</span><span class="ident" id="5299744">Sub</span>&nbsp;<span class="op" id="5299748">=</span>&nbsp;<span class="builtinfunc" id="5299750">append</span><span class="op" id="5299756">(</span><span class="ident" id="5299757">nre</span><span class="op" id="5299760">.</span><span class="ident" id="5299761">Sub</span><span class="op" id="5299764">,</span>&nbsp;<span class="ident" id="5299766">simplify1</span><span class="op" id="5299775">(</span><span class="ident" id="5299776">OpPlus</span><span class="op" id="5299782">,</span>&nbsp;<span class="ident" id="5299784">re</span><span class="op" id="5299786">.</span><span class="ident" id="5299787">Flags</span><span class="op" id="5299792">,</span>&nbsp;<span class="ident" id="5299794">sub</span><span class="op" id="5299797">,</span>&nbsp;<span class="ident" id="5299799">nil</span><span class="op" id="5299802">)</span><span class="op" id="5299803">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299808">return</span>&nbsp;<span class="ident" id="5299815">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299826">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299865">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299900">if</span>&nbsp;<span class="ident" id="5299903">re</span><span class="op" id="5299905">.</span><span class="ident" id="5299906">Min</span>&nbsp;<span class="op" id="5299910">==</span>&nbsp;<span class="num" id="5299913">1</span>&nbsp;<span class="op" id="5299915">&amp;&amp;</span>&nbsp;<span class="ident" id="5299918">re</span><span class="op" id="5299920">.</span><span class="ident" id="5299921">Max</span>&nbsp;<span class="op" id="5299925">==</span>&nbsp;<span class="num" id="5299928">1</span>&nbsp;<span class="op" id="5299930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5299935">return</span>&nbsp;<span class="ident" id="5299942">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5299948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5299953">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300018">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300084">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300122">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300153">var</span>&nbsp;<span class="ident" id="5300157">prefix</span>&nbsp;<span class="op" id="5300164">*</span><span class="ident" id="5300165">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300174">if</span>&nbsp;<span class="ident" id="5300177">re</span><span class="op" id="5300179">.</span><span class="ident" id="5300180">Min</span>&nbsp;<span class="op" id="5300184">&gt;</span>&nbsp;<span class="num" id="5300186">0</span>&nbsp;<span class="op" id="5300188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300193">prefix</span>&nbsp;<span class="op" id="5300200">=</span>&nbsp;<span class="op" id="5300202">&amp;</span><span class="ident" id="5300203">Regexp</span><span class="op" id="5300209">{</span><span class="ident" id="5300210">Op</span><span class="op" id="5300212">:</span>&nbsp;<span class="ident" id="5300214">OpConcat</span><span class="op" id="5300222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300227">prefix</span><span class="op" id="5300233">.</span><span class="ident" id="5300234">Sub</span>&nbsp;<span class="op" id="5300238">=</span>&nbsp;<span class="ident" id="5300240">prefix</span><span class="op" id="5300246">.</span><span class="ident" id="5300247">Sub0</span><span class="op" id="5300251">[</span><span class="op" id="5300252">:</span><span class="num" id="5300253">0</span><span class="op" id="5300254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300259">for</span>&nbsp;<span class="ident" id="5300263">i</span>&nbsp;<span class="op" id="5300265">:=</span>&nbsp;<span class="num" id="5300268">0</span><span class="op" id="5300269">;</span>&nbsp;<span class="ident" id="5300271">i</span>&nbsp;<span class="op" id="5300273">&lt;</span>&nbsp;<span class="ident" id="5300275">re</span><span class="op" id="5300277">.</span><span class="ident" id="5300278">Min</span><span class="op" id="5300281">;</span>&nbsp;<span class="ident" id="5300283">i</span><span class="op" id="5300284">++</span>&nbsp;<span class="op" id="5300287">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300293">prefix</span><span class="op" id="5300299">.</span><span class="ident" id="5300300">Sub</span>&nbsp;<span class="op" id="5300304">=</span>&nbsp;<span class="builtinfunc" id="5300306">append</span><span class="op" id="5300312">(</span><span class="ident" id="5300313">prefix</span><span class="op" id="5300319">.</span><span class="ident" id="5300320">Sub</span><span class="op" id="5300323">,</span>&nbsp;<span class="ident" id="5300325">sub</span><span class="op" id="5300328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300342">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300385">if</span>&nbsp;<span class="ident" id="5300388">re</span><span class="op" id="5300390">.</span><span class="ident" id="5300391">Max</span>&nbsp;<span class="op" id="5300395">&gt;</span>&nbsp;<span class="ident" id="5300397">re</span><span class="op" id="5300399">.</span><span class="ident" id="5300400">Min</span>&nbsp;<span class="op" id="5300404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300409">suffix</span>&nbsp;<span class="op" id="5300416">:=</span>&nbsp;<span class="ident" id="5300419">simplify1</span><span class="op" id="5300428">(</span><span class="ident" id="5300429">OpQuest</span><span class="op" id="5300436">,</span>&nbsp;<span class="ident" id="5300438">re</span><span class="op" id="5300440">.</span><span class="ident" id="5300441">Flags</span><span class="op" id="5300446">,</span>&nbsp;<span class="ident" id="5300448">sub</span><span class="op" id="5300451">,</span>&nbsp;<span class="ident" id="5300453">nil</span><span class="op" id="5300456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300461">for</span>&nbsp;<span class="ident" id="5300465">i</span>&nbsp;<span class="op" id="5300467">:=</span>&nbsp;<span class="ident" id="5300470">re</span><span class="op" id="5300472">.</span><span class="ident" id="5300473">Min</span>&nbsp;<span class="op" id="5300477">+</span>&nbsp;<span class="num" id="5300479">1</span><span class="op" id="5300480">;</span>&nbsp;<span class="ident" id="5300482">i</span>&nbsp;<span class="op" id="5300484">&lt;</span>&nbsp;<span class="ident" id="5300486">re</span><span class="op" id="5300488">.</span><span class="ident" id="5300489">Max</span><span class="op" id="5300492">;</span>&nbsp;<span class="ident" id="5300494">i</span><span class="op" id="5300495">++</span>&nbsp;<span class="op" id="5300498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300504">nre2</span>&nbsp;<span class="op" id="5300509">:=</span>&nbsp;<span class="op" id="5300512">&amp;</span><span class="ident" id="5300513">Regexp</span><span class="op" id="5300519">{</span><span class="ident" id="5300520">Op</span><span class="op" id="5300522">:</span>&nbsp;<span class="ident" id="5300524">OpConcat</span><span class="op" id="5300532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300538">nre2</span><span class="op" id="5300542">.</span><span class="ident" id="5300543">Sub</span>&nbsp;<span class="op" id="5300547">=</span>&nbsp;<span class="builtinfunc" id="5300549">append</span><span class="op" id="5300555">(</span><span class="ident" id="5300556">nre2</span><span class="op" id="5300560">.</span><span class="ident" id="5300561">Sub0</span><span class="op" id="5300565">[</span><span class="op" id="5300566">:</span><span class="num" id="5300567">0</span><span class="op" id="5300568">]</span><span class="op" id="5300569">,</span>&nbsp;<span class="ident" id="5300571">sub</span><span class="op" id="5300574">,</span>&nbsp;<span class="ident" id="5300576">suffix</span><span class="op" id="5300582">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300588">suffix</span>&nbsp;<span class="op" id="5300595">=</span>&nbsp;<span class="ident" id="5300597">simplify1</span><span class="op" id="5300606">(</span><span class="ident" id="5300607">OpQuest</span><span class="op" id="5300614">,</span>&nbsp;<span class="ident" id="5300616">re</span><span class="op" id="5300618">.</span><span class="ident" id="5300619">Flags</span><span class="op" id="5300624">,</span>&nbsp;<span class="ident" id="5300626">nre2</span><span class="op" id="5300630">,</span>&nbsp;<span class="ident" id="5300632">nil</span><span class="op" id="5300635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300645">if</span>&nbsp;<span class="ident" id="5300648">prefix</span>&nbsp;<span class="op" id="5300655">==</span>&nbsp;<span class="ident" id="5300658">nil</span>&nbsp;<span class="op" id="5300662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300668">return</span>&nbsp;<span class="ident" id="5300675">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300685">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300690">prefix</span><span class="op" id="5300696">.</span><span class="ident" id="5300697">Sub</span>&nbsp;<span class="op" id="5300701">=</span>&nbsp;<span class="builtinfunc" id="5300703">append</span><span class="op" id="5300709">(</span><span class="ident" id="5300710">prefix</span><span class="op" id="5300716">.</span><span class="ident" id="5300717">Sub</span><span class="op" id="5300720">,</span>&nbsp;<span class="ident" id="5300722">suffix</span><span class="op" id="5300728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300736">if</span>&nbsp;<span class="ident" id="5300739">prefix</span>&nbsp;<span class="op" id="5300746">!=</span>&nbsp;<span class="ident" id="5300749">nil</span>&nbsp;<span class="op" id="5300753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300758">return</span>&nbsp;<span class="ident" id="5300765">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300774">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300779">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300838">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300871">return</span>&nbsp;<span class="op" id="5300878">&amp;</span><span class="ident" id="5300879">Regexp</span><span class="op" id="5300885">{</span><span class="ident" id="5300886">Op</span><span class="op" id="5300888">:</span>&nbsp;<span class="ident" id="5300890">OpNoMatch</span><span class="op" id="5300899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300902">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300906">return</span>&nbsp;<span class="ident" id="5300913">re</span><br>
<span class="lineno"></span><span class="op" id="5300916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5300919">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5300974">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5301038">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5301055">//</span><br>
<span class="lineno"></span><span class="comment" id="5301058">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5301102">//</span><br>
<span class="lineno">125</span><span class="comment" id="5301105">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5301161">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5301220">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5301282">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5301305">//</span><br>
<span class="lineno">130</span><span class="comment" id="5301308">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5301376">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5301434">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5301497">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5301521">func</span>&nbsp;<span class="ident" id="5301526">simplify1</span><span class="op" id="5301535">(</span><span class="ident" id="5301536">op</span>&nbsp;<span class="ident" id="5301539">Op</span><span class="op" id="5301541">,</span>&nbsp;<span class="ident" id="5301543">flags</span>&nbsp;<span class="ident" id="5301549">Flags</span><span class="op" id="5301554">,</span>&nbsp;<span class="ident" id="5301556">sub</span><span class="op" id="5301559">,</span>&nbsp;<span class="ident" id="5301561">re</span>&nbsp;<span class="op" id="5301564">*</span><span class="ident" id="5301565">Regexp</span><span class="op" id="5301571">)</span>&nbsp;<span class="op" id="5301573">*</span><span class="ident" id="5301574">Regexp</span>&nbsp;<span class="op" id="5301581">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301584">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301637">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301684">if</span>&nbsp;<span class="ident" id="5301687">sub</span><span class="op" id="5301690">.</span><span class="ident" id="5301691">Op</span>&nbsp;<span class="op" id="5301694">==</span>&nbsp;<span class="ident" id="5301697">OpEmptyMatch</span>&nbsp;<span class="op" id="5301710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301714">return</span>&nbsp;<span class="ident" id="5301721">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301726">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301729">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301782">if</span>&nbsp;<span class="ident" id="5301785">op</span>&nbsp;<span class="op" id="5301788">==</span>&nbsp;<span class="ident" id="5301791">sub</span><span class="op" id="5301794">.</span><span class="ident" id="5301795">Op</span>&nbsp;<span class="op" id="5301798">&amp;&amp;</span>&nbsp;<span class="ident" id="5301801">flags</span><span class="op" id="5301806">&amp;</span><span class="ident" id="5301807">NonGreedy</span>&nbsp;<span class="op" id="5301817">==</span>&nbsp;<span class="ident" id="5301820">sub</span><span class="op" id="5301823">.</span><span class="ident" id="5301824">Flags</span><span class="op" id="5301829">&amp;</span><span class="ident" id="5301830">NonGreedy</span>&nbsp;<span class="op" id="5301840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301844">return</span>&nbsp;<span class="ident" id="5301851">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301859">if</span>&nbsp;<span class="ident" id="5301862">re</span>&nbsp;<span class="op" id="5301865">!=</span>&nbsp;<span class="ident" id="5301868">nil</span>&nbsp;<span class="op" id="5301872">&amp;&amp;</span>&nbsp;<span class="ident" id="5301875">re</span><span class="op" id="5301877">.</span><span class="ident" id="5301878">Op</span>&nbsp;<span class="op" id="5301881">==</span>&nbsp;<span class="ident" id="5301884">op</span>&nbsp;<span class="op" id="5301887">&amp;&amp;</span>&nbsp;<span class="ident" id="5301890">re</span><span class="op" id="5301892">.</span><span class="ident" id="5301893">Flags</span><span class="op" id="5301898">&amp;</span><span class="ident" id="5301899">NonGreedy</span>&nbsp;<span class="op" id="5301909">==</span>&nbsp;<span class="ident" id="5301912">flags</span><span class="op" id="5301917">&amp;</span><span class="ident" id="5301918">NonGreedy</span>&nbsp;<span class="op" id="5301928">&amp;&amp;</span>&nbsp;<span class="ident" id="5301931">sub</span>&nbsp;<span class="op" id="5301935">==</span>&nbsp;<span class="ident" id="5301938">re</span><span class="op" id="5301940">.</span><span class="ident" id="5301941">Sub</span><span class="op" id="5301944">[</span><span class="num" id="5301945">0</span><span class="op" id="5301946">]</span>&nbsp;<span class="op" id="5301948">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301952">return</span>&nbsp;<span class="ident" id="5301959">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301967">re</span>&nbsp;<span class="op" id="5301970">=</span>&nbsp;<span class="op" id="5301972">&amp;</span><span class="ident" id="5301973">Regexp</span><span class="op" id="5301979">{</span><span class="ident" id="5301980">Op</span><span class="op" id="5301982">:</span>&nbsp;<span class="ident" id="5301984">op</span><span class="op" id="5301986">,</span>&nbsp;<span class="ident" id="5301988">Flags</span><span class="op" id="5301993">:</span>&nbsp;<span class="ident" id="5301995">flags</span><span class="op" id="5302000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302003">re</span><span class="op" id="5302005">.</span><span class="ident" id="5302006">Sub</span>&nbsp;<span class="op" id="5302010">=</span>&nbsp;<span class="builtinfunc" id="5302012">append</span><span class="op" id="5302018">(</span><span class="ident" id="5302019">re</span><span class="op" id="5302021">.</span><span class="ident" id="5302022">Sub0</span><span class="op" id="5302026">[</span><span class="op" id="5302027">:</span><span class="num" id="5302028">0</span><span class="op" id="5302029">]</span><span class="op" id="5302030">,</span>&nbsp;<span class="ident" id="5302032">sub</span><span class="op" id="5302035">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302038">return</span>&nbsp;<span class="ident" id="5302045">re</span><br>
<span class="lineno"></span><span class="op" id="5302048">}</span>
</div>
</body>
</html>
