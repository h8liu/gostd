<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6296068">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6296123">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6296177">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6296228">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296261">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6296325">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6296390">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6296421">//</span><br>
<span class="lineno"></span><span class="comment" id="6296424">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6296482">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6296543">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6296563">package</span>&nbsp;<span class="ident" id="6296571">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6296579">import</span>&nbsp;<span class="op" id="6296586">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296589">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296599">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296606">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296613">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296620">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296626">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296637">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6296645">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6296652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296655">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6296715">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6296785">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6296854">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6296891">type</span>&nbsp;<span class="ident" id="6296896">Priority</span>&nbsp;<span class="builtintype" id="6296905">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296910">const</span>&nbsp;<span class="ident" id="6296916">severityMask</span>&nbsp;<span class="op" id="6296929">=</span>&nbsp;<span class="num" id="6296931">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6296936">const</span>&nbsp;<span class="ident" id="6296942">facilityMask</span>&nbsp;<span class="op" id="6296955">=</span>&nbsp;<span class="num" id="6296957">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6296963">const</span>&nbsp;<span class="op" id="6296969">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296972">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296987">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297023">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297071">LOG_EMERG</span>&nbsp;<span class="ident" id="6297081">Priority</span>&nbsp;<span class="op" id="6297090">=</span>&nbsp;<span class="ident" id="6297092">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297098">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297109">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297119">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297128">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297141">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297153">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297163">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6297173">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6297176">const</span>&nbsp;<span class="op" id="6297182">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297185">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297200">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297236">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297298">LOG_KERN</span>&nbsp;<span class="ident" id="6297307">Priority</span>&nbsp;<span class="op" id="6297316">=</span>&nbsp;<span class="ident" id="6297318">iota</span>&nbsp;<span class="op" id="6297323">&lt;&lt;</span>&nbsp;<span class="num" id="6297326">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297329">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297339">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297349">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297361">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297371">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297383">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297392">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297402">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297412">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297422">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297436">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297445">_</span>&nbsp;<span class="comment" id="6297447">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297458">_</span>&nbsp;<span class="comment" id="6297460">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297471">_</span>&nbsp;<span class="comment" id="6297473">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297484">_</span>&nbsp;<span class="comment" id="6297486">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297497">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297509">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297521">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297533">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297545">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297557">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297569">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297581">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6297592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297595">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6297643">type</span>&nbsp;<span class="ident" id="6297648">Writer</span>&nbsp;<span class="keyword" id="6297655">struct</span>&nbsp;<span class="op" id="6297662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297665">priority</span>&nbsp;<span class="ident" id="6297674">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297684">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6297693">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297701">hostname</span>&nbsp;<span class="builtintype" id="6297710">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297718">network</span>&nbsp;&nbsp;<span class="builtintype" id="6297727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297735">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6297744">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297753">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6297758">sync</span><span class="op" id="6297762">.</span><span class="ident" id="6297763">Mutex</span>&nbsp;<span class="comment" id="6297769">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297785">conn</span>&nbsp;<span class="ident" id="6297790">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6297801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297804">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6297869">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6297937">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6298002">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6298073">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6298143">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6298171">type</span>&nbsp;<span class="ident" id="6298176">serverConn</span>&nbsp;<span class="keyword" id="6298187">interface</span>&nbsp;<span class="op" id="6298197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298200">writeString</span><span class="op" id="6298211">(</span><span class="ident" id="6298212">p</span>&nbsp;<span class="ident" id="6298214">Priority</span><span class="op" id="6298222">,</span>&nbsp;<span class="ident" id="6298224">hostname</span><span class="op" id="6298232">,</span>&nbsp;<span class="ident" id="6298234">tag</span><span class="op" id="6298237">,</span>&nbsp;<span class="ident" id="6298239">s</span><span class="op" id="6298240">,</span>&nbsp;<span class="ident" id="6298242">nl</span>&nbsp;<span class="builtintype" id="6298245">string</span><span class="op" id="6298251">)</span>&nbsp;<span class="builtintype" id="6298253">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6298260">close</span><span class="op" id="6298265">(</span><span class="op" id="6298266">)</span>&nbsp;<span class="builtintype" id="6298268">error</span><br>
<span class="lineno"></span><span class="op" id="6298274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6298277">type</span>&nbsp;<span class="ident" id="6298282">netConn</span>&nbsp;<span class="keyword" id="6298290">struct</span>&nbsp;<span class="op" id="6298297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298300">local</span>&nbsp;<span class="builtintype" id="6298306">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298312">conn</span>&nbsp;&nbsp;<span class="ident" id="6298318">net</span><span class="op" id="6298321">.</span><span class="ident" id="6298322">Conn</span><br>
<span class="lineno"></span><span class="op" id="6298327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6298330">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6298398">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6298465">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6298489">func</span>&nbsp;<span class="ident" id="6298494">New</span><span class="op" id="6298497">(</span><span class="ident" id="6298498">priority</span>&nbsp;<span class="ident" id="6298507">Priority</span><span class="op" id="6298515">,</span>&nbsp;<span class="ident" id="6298517">tag</span>&nbsp;<span class="builtintype" id="6298521">string</span><span class="op" id="6298527">)</span>&nbsp;<span class="op" id="6298529">(</span><span class="ident" id="6298530">w</span>&nbsp;<span class="op" id="6298532">*</span><span class="ident" id="6298533">Writer</span><span class="op" id="6298539">,</span>&nbsp;<span class="ident" id="6298541">err</span>&nbsp;<span class="builtintype" id="6298545">error</span><span class="op" id="6298550">)</span>&nbsp;<span class="op" id="6298552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298555">return</span>&nbsp;<span class="ident" id="6298562">Dial</span><span class="op" id="6298566">(</span><span class="string" id="6298567">&#34;&#34;</span><span class="op" id="6298569">,</span>&nbsp;<span class="string" id="6298571">&#34;&#34;</span><span class="op" id="6298573">,</span>&nbsp;<span class="ident" id="6298575">priority</span><span class="op" id="6298583">,</span>&nbsp;<span class="ident" id="6298585">tag</span><span class="op" id="6298588">)</span><br>
<span class="lineno">115</span><span class="op" id="6298590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298593">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6298659">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6298730">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6298798">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6298806">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6298876">func</span>&nbsp;<span class="ident" id="6298881">Dial</span><span class="op" id="6298885">(</span><span class="ident" id="6298886">network</span><span class="op" id="6298893">,</span>&nbsp;<span class="ident" id="6298895">raddr</span>&nbsp;<span class="builtintype" id="6298901">string</span><span class="op" id="6298907">,</span>&nbsp;<span class="ident" id="6298909">priority</span>&nbsp;<span class="ident" id="6298918">Priority</span><span class="op" id="6298926">,</span>&nbsp;<span class="ident" id="6298928">tag</span>&nbsp;<span class="builtintype" id="6298932">string</span><span class="op" id="6298938">)</span>&nbsp;<span class="op" id="6298940">(</span><span class="op" id="6298941">*</span><span class="ident" id="6298942">Writer</span><span class="op" id="6298948">,</span>&nbsp;<span class="builtintype" id="6298950">error</span><span class="op" id="6298955">)</span>&nbsp;<span class="op" id="6298957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298960">if</span>&nbsp;<span class="ident" id="6298963">priority</span>&nbsp;<span class="op" id="6298972">&lt;</span>&nbsp;<span class="num" id="6298974">0</span>&nbsp;<span class="op" id="6298976">||</span>&nbsp;<span class="ident" id="6298979">priority</span>&nbsp;<span class="op" id="6298988">&gt;</span>&nbsp;<span class="ident" id="6298990">LOG_LOCAL7</span><span class="op" id="6299000">|</span><span class="ident" id="6299001">LOG_DEBUG</span>&nbsp;<span class="op" id="6299011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299015">return</span>&nbsp;<span class="ident" id="6299022">nil</span><span class="op" id="6299025">,</span>&nbsp;<span class="ident" id="6299027">errors</span><span class="op" id="6299033">.</span><span class="ident" id="6299034">New</span><span class="op" id="6299037">(</span><span class="string" id="6299038">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6299068">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299075">if</span>&nbsp;<span class="ident" id="6299078">tag</span>&nbsp;<span class="op" id="6299082">==</span>&nbsp;<span class="string" id="6299085">&#34;&#34;</span>&nbsp;<span class="op" id="6299088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299092">tag</span>&nbsp;<span class="op" id="6299096">=</span>&nbsp;<span class="ident" id="6299098">os</span><span class="op" id="6299100">.</span><span class="ident" id="6299101">Args</span><span class="op" id="6299105">[</span><span class="num" id="6299106">0</span><span class="op" id="6299107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299110">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299113">hostname</span><span class="op" id="6299121">,</span>&nbsp;<span class="ident" id="6299123">_</span>&nbsp;<span class="op" id="6299125">:=</span>&nbsp;<span class="ident" id="6299128">os</span><span class="op" id="6299130">.</span><span class="ident" id="6299131">Hostname</span><span class="op" id="6299139">(</span><span class="op" id="6299140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299144">w</span>&nbsp;<span class="op" id="6299146">:=</span>&nbsp;<span class="op" id="6299149">&amp;</span><span class="ident" id="6299150">Writer</span><span class="op" id="6299156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299160">priority</span><span class="op" id="6299168">:</span>&nbsp;<span class="ident" id="6299170">priority</span><span class="op" id="6299178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299182">tag</span><span class="op" id="6299185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299192">tag</span><span class="op" id="6299195">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299199">hostname</span><span class="op" id="6299207">:</span>&nbsp;<span class="ident" id="6299209">hostname</span><span class="op" id="6299217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299221">network</span><span class="op" id="6299228">:</span>&nbsp;&nbsp;<span class="ident" id="6299231">network</span><span class="op" id="6299238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299242">raddr</span><span class="op" id="6299247">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299252">raddr</span><span class="op" id="6299257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299264">w</span><span class="op" id="6299265">.</span><span class="ident" id="6299266">mu</span><span class="op" id="6299268">.</span><span class="ident" id="6299269">Lock</span><span class="op" id="6299273">(</span><span class="op" id="6299274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299277">defer</span>&nbsp;<span class="ident" id="6299283">w</span><span class="op" id="6299284">.</span><span class="ident" id="6299285">mu</span><span class="op" id="6299287">.</span><span class="ident" id="6299288">Unlock</span><span class="op" id="6299294">(</span><span class="op" id="6299295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299299">err</span>&nbsp;<span class="op" id="6299303">:=</span>&nbsp;<span class="ident" id="6299306">w</span><span class="op" id="6299307">.</span><span class="ident" id="6299308">connect</span><span class="op" id="6299315">(</span><span class="op" id="6299316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299319">if</span>&nbsp;<span class="ident" id="6299322">err</span>&nbsp;<span class="op" id="6299326">!=</span>&nbsp;<span class="ident" id="6299329">nil</span>&nbsp;<span class="op" id="6299333">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299337">return</span>&nbsp;<span class="ident" id="6299344">nil</span><span class="op" id="6299347">,</span>&nbsp;<span class="ident" id="6299349">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299357">return</span>&nbsp;<span class="ident" id="6299364">w</span><span class="op" id="6299365">,</span>&nbsp;<span class="ident" id="6299367">err</span><br>
<span class="lineno"></span><span class="op" id="6299371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6299374">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6299426">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6299463">func</span>&nbsp;<span class="op" id="6299468">(</span><span class="ident" id="6299469">w</span>&nbsp;<span class="op" id="6299471">*</span><span class="ident" id="6299472">Writer</span><span class="op" id="6299478">)</span>&nbsp;<span class="ident" id="6299480">connect</span><span class="op" id="6299487">(</span><span class="op" id="6299488">)</span>&nbsp;<span class="op" id="6299490">(</span><span class="ident" id="6299491">err</span>&nbsp;<span class="builtintype" id="6299495">error</span><span class="op" id="6299500">)</span>&nbsp;<span class="op" id="6299502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299505">if</span>&nbsp;<span class="ident" id="6299508">w</span><span class="op" id="6299509">.</span><span class="ident" id="6299510">conn</span>&nbsp;<span class="op" id="6299515">!=</span>&nbsp;<span class="ident" id="6299518">nil</span>&nbsp;<span class="op" id="6299522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6299526">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299588">w</span><span class="op" id="6299589">.</span><span class="ident" id="6299590">conn</span><span class="op" id="6299594">.</span><span class="builtinfunc" id="6299595">close</span><span class="op" id="6299600">(</span><span class="op" id="6299601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299605">w</span><span class="op" id="6299606">.</span><span class="ident" id="6299607">conn</span>&nbsp;<span class="op" id="6299612">=</span>&nbsp;<span class="ident" id="6299614">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299623">if</span>&nbsp;<span class="ident" id="6299626">w</span><span class="op" id="6299627">.</span><span class="ident" id="6299628">network</span>&nbsp;<span class="op" id="6299636">==</span>&nbsp;<span class="string" id="6299639">&#34;&#34;</span>&nbsp;<span class="op" id="6299642">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299646">w</span><span class="op" id="6299647">.</span><span class="ident" id="6299648">conn</span><span class="op" id="6299652">,</span>&nbsp;<span class="ident" id="6299654">err</span>&nbsp;<span class="op" id="6299658">=</span>&nbsp;<span class="ident" id="6299660">unixSyslog</span><span class="op" id="6299670">(</span><span class="op" id="6299671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299675">if</span>&nbsp;<span class="ident" id="6299678">w</span><span class="op" id="6299679">.</span><span class="ident" id="6299680">hostname</span>&nbsp;<span class="op" id="6299689">==</span>&nbsp;<span class="string" id="6299692">&#34;&#34;</span>&nbsp;<span class="op" id="6299695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299700">w</span><span class="op" id="6299701">.</span><span class="ident" id="6299702">hostname</span>&nbsp;<span class="op" id="6299711">=</span>&nbsp;<span class="string" id="6299713">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299730">}</span>&nbsp;<span class="keyword" id="6299732">else</span>&nbsp;<span class="op" id="6299737">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299741">var</span>&nbsp;<span class="ident" id="6299745">c</span>&nbsp;<span class="ident" id="6299747">net</span><span class="op" id="6299750">.</span><span class="ident" id="6299751">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299758">c</span><span class="op" id="6299759">,</span>&nbsp;<span class="ident" id="6299761">err</span>&nbsp;<span class="op" id="6299765">=</span>&nbsp;<span class="ident" id="6299767">net</span><span class="op" id="6299770">.</span><span class="ident" id="6299771">Dial</span><span class="op" id="6299775">(</span><span class="ident" id="6299776">w</span><span class="op" id="6299777">.</span><span class="ident" id="6299778">network</span><span class="op" id="6299785">,</span>&nbsp;<span class="ident" id="6299787">w</span><span class="op" id="6299788">.</span><span class="ident" id="6299789">raddr</span><span class="op" id="6299794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299798">if</span>&nbsp;<span class="ident" id="6299801">err</span>&nbsp;<span class="op" id="6299805">==</span>&nbsp;<span class="ident" id="6299808">nil</span>&nbsp;<span class="op" id="6299812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299817">w</span><span class="op" id="6299818">.</span><span class="ident" id="6299819">conn</span>&nbsp;<span class="op" id="6299824">=</span>&nbsp;<span class="op" id="6299826">&amp;</span><span class="ident" id="6299827">netConn</span><span class="op" id="6299834">{</span><span class="ident" id="6299835">conn</span><span class="op" id="6299839">:</span>&nbsp;<span class="ident" id="6299841">c</span><span class="op" id="6299842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299847">if</span>&nbsp;<span class="ident" id="6299850">w</span><span class="op" id="6299851">.</span><span class="ident" id="6299852">hostname</span>&nbsp;<span class="op" id="6299861">==</span>&nbsp;<span class="string" id="6299864">&#34;&#34;</span>&nbsp;<span class="op" id="6299867">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299873">w</span><span class="op" id="6299874">.</span><span class="ident" id="6299875">hostname</span>&nbsp;<span class="op" id="6299884">=</span>&nbsp;<span class="ident" id="6299886">c</span><span class="op" id="6299887">.</span><span class="ident" id="6299888">LocalAddr</span><span class="op" id="6299897">(</span><span class="op" id="6299898">)</span><span class="op" id="6299899">.</span><span class="ident" id="6299900">String</span><span class="op" id="6299906">(</span><span class="op" id="6299907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299922">return</span><br>
<span class="lineno">175</span><span class="op" id="6299929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299932">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6299983">func</span>&nbsp;<span class="op" id="6299988">(</span><span class="ident" id="6299989">w</span>&nbsp;<span class="op" id="6299991">*</span><span class="ident" id="6299992">Writer</span><span class="op" id="6299998">)</span>&nbsp;<span class="ident" id="6300000">Write</span><span class="op" id="6300005">(</span><span class="ident" id="6300006">b</span>&nbsp;<span class="op" id="6300008">[</span><span class="op" id="6300009">]</span><span class="builtintype" id="6300010">byte</span><span class="op" id="6300014">)</span>&nbsp;<span class="op" id="6300016">(</span><span class="builtintype" id="6300017">int</span><span class="op" id="6300020">,</span>&nbsp;<span class="builtintype" id="6300022">error</span><span class="op" id="6300027">)</span>&nbsp;<span class="op" id="6300029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300032">return</span>&nbsp;<span class="ident" id="6300039">w</span><span class="op" id="6300040">.</span><span class="ident" id="6300041">writeAndRetry</span><span class="op" id="6300054">(</span><span class="ident" id="6300055">w</span><span class="op" id="6300056">.</span><span class="ident" id="6300057">priority</span><span class="op" id="6300065">,</span>&nbsp;<span class="builtintype" id="6300067">string</span><span class="op" id="6300073">(</span><span class="ident" id="6300074">b</span><span class="op" id="6300075">)</span><span class="op" id="6300076">)</span><br>
<span class="lineno">180</span><span class="op" id="6300078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300081">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6300132">func</span>&nbsp;<span class="op" id="6300137">(</span><span class="ident" id="6300138">w</span>&nbsp;<span class="op" id="6300140">*</span><span class="ident" id="6300141">Writer</span><span class="op" id="6300147">)</span>&nbsp;<span class="ident" id="6300149">Close</span><span class="op" id="6300154">(</span><span class="op" id="6300155">)</span>&nbsp;<span class="builtintype" id="6300157">error</span>&nbsp;<span class="op" id="6300163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300166">w</span><span class="op" id="6300167">.</span><span class="ident" id="6300168">mu</span><span class="op" id="6300170">.</span><span class="ident" id="6300171">Lock</span><span class="op" id="6300175">(</span><span class="op" id="6300176">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300179">defer</span>&nbsp;<span class="ident" id="6300185">w</span><span class="op" id="6300186">.</span><span class="ident" id="6300187">mu</span><span class="op" id="6300189">.</span><span class="ident" id="6300190">Unlock</span><span class="op" id="6300196">(</span><span class="op" id="6300197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300201">if</span>&nbsp;<span class="ident" id="6300204">w</span><span class="op" id="6300205">.</span><span class="ident" id="6300206">conn</span>&nbsp;<span class="op" id="6300211">!=</span>&nbsp;<span class="ident" id="6300214">nil</span>&nbsp;<span class="op" id="6300218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300222">err</span>&nbsp;<span class="op" id="6300226">:=</span>&nbsp;<span class="ident" id="6300229">w</span><span class="op" id="6300230">.</span><span class="ident" id="6300231">conn</span><span class="op" id="6300235">.</span><span class="builtinfunc" id="6300236">close</span><span class="op" id="6300241">(</span><span class="op" id="6300242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300246">w</span><span class="op" id="6300247">.</span><span class="ident" id="6300248">conn</span>&nbsp;<span class="op" id="6300253">=</span>&nbsp;<span class="ident" id="6300255">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300261">return</span>&nbsp;<span class="ident" id="6300268">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300276">return</span>&nbsp;<span class="ident" id="6300283">nil</span><br>
<span class="lineno"></span><span class="op" id="6300287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6300290">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6300361">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6300379">func</span>&nbsp;<span class="op" id="6300384">(</span><span class="ident" id="6300385">w</span>&nbsp;<span class="op" id="6300387">*</span><span class="ident" id="6300388">Writer</span><span class="op" id="6300394">)</span>&nbsp;<span class="ident" id="6300396">Emerg</span><span class="op" id="6300401">(</span><span class="ident" id="6300402">m</span>&nbsp;<span class="builtintype" id="6300404">string</span><span class="op" id="6300410">)</span>&nbsp;<span class="op" id="6300412">(</span><span class="ident" id="6300413">err</span>&nbsp;<span class="builtintype" id="6300417">error</span><span class="op" id="6300422">)</span>&nbsp;<span class="op" id="6300424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300427">_</span><span class="op" id="6300428">,</span>&nbsp;<span class="ident" id="6300430">err</span>&nbsp;<span class="op" id="6300434">=</span>&nbsp;<span class="ident" id="6300436">w</span><span class="op" id="6300437">.</span><span class="ident" id="6300438">writeAndRetry</span><span class="op" id="6300451">(</span><span class="ident" id="6300452">LOG_EMERG</span><span class="op" id="6300461">,</span>&nbsp;<span class="ident" id="6300463">m</span><span class="op" id="6300464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300467">return</span>&nbsp;<span class="ident" id="6300474">err</span><br>
<span class="lineno">200</span><span class="op" id="6300478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300481">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6300552">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6300570">func</span>&nbsp;<span class="op" id="6300575">(</span><span class="ident" id="6300576">w</span>&nbsp;<span class="op" id="6300578">*</span><span class="ident" id="6300579">Writer</span><span class="op" id="6300585">)</span>&nbsp;<span class="ident" id="6300587">Alert</span><span class="op" id="6300592">(</span><span class="ident" id="6300593">m</span>&nbsp;<span class="builtintype" id="6300595">string</span><span class="op" id="6300601">)</span>&nbsp;<span class="op" id="6300603">(</span><span class="ident" id="6300604">err</span>&nbsp;<span class="builtintype" id="6300608">error</span><span class="op" id="6300613">)</span>&nbsp;<span class="op" id="6300615">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300618">_</span><span class="op" id="6300619">,</span>&nbsp;<span class="ident" id="6300621">err</span>&nbsp;<span class="op" id="6300625">=</span>&nbsp;<span class="ident" id="6300627">w</span><span class="op" id="6300628">.</span><span class="ident" id="6300629">writeAndRetry</span><span class="op" id="6300642">(</span><span class="ident" id="6300643">LOG_ALERT</span><span class="op" id="6300652">,</span>&nbsp;<span class="ident" id="6300654">m</span><span class="op" id="6300655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300658">return</span>&nbsp;<span class="ident" id="6300665">err</span><br>
<span class="lineno"></span><span class="op" id="6300669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300672">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6300741">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6300759">func</span>&nbsp;<span class="op" id="6300764">(</span><span class="ident" id="6300765">w</span>&nbsp;<span class="op" id="6300767">*</span><span class="ident" id="6300768">Writer</span><span class="op" id="6300774">)</span>&nbsp;<span class="ident" id="6300776">Crit</span><span class="op" id="6300780">(</span><span class="ident" id="6300781">m</span>&nbsp;<span class="builtintype" id="6300783">string</span><span class="op" id="6300789">)</span>&nbsp;<span class="op" id="6300791">(</span><span class="ident" id="6300792">err</span>&nbsp;<span class="builtintype" id="6300796">error</span><span class="op" id="6300801">)</span>&nbsp;<span class="op" id="6300803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300806">_</span><span class="op" id="6300807">,</span>&nbsp;<span class="ident" id="6300809">err</span>&nbsp;<span class="op" id="6300813">=</span>&nbsp;<span class="ident" id="6300815">w</span><span class="op" id="6300816">.</span><span class="ident" id="6300817">writeAndRetry</span><span class="op" id="6300830">(</span><span class="ident" id="6300831">LOG_CRIT</span><span class="op" id="6300839">,</span>&nbsp;<span class="ident" id="6300841">m</span><span class="op" id="6300842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300845">return</span>&nbsp;<span class="ident" id="6300852">err</span><br>
<span class="lineno"></span><span class="op" id="6300856">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6300859">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6300926">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6300944">func</span>&nbsp;<span class="op" id="6300949">(</span><span class="ident" id="6300950">w</span>&nbsp;<span class="op" id="6300952">*</span><span class="ident" id="6300953">Writer</span><span class="op" id="6300959">)</span>&nbsp;<span class="ident" id="6300961">Err</span><span class="op" id="6300964">(</span><span class="ident" id="6300965">m</span>&nbsp;<span class="builtintype" id="6300967">string</span><span class="op" id="6300973">)</span>&nbsp;<span class="op" id="6300975">(</span><span class="ident" id="6300976">err</span>&nbsp;<span class="builtintype" id="6300980">error</span><span class="op" id="6300985">)</span>&nbsp;<span class="op" id="6300987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300990">_</span><span class="op" id="6300991">,</span>&nbsp;<span class="ident" id="6300993">err</span>&nbsp;<span class="op" id="6300997">=</span>&nbsp;<span class="ident" id="6300999">w</span><span class="op" id="6301000">.</span><span class="ident" id="6301001">writeAndRetry</span><span class="op" id="6301014">(</span><span class="ident" id="6301015">LOG_ERR</span><span class="op" id="6301022">,</span>&nbsp;<span class="ident" id="6301024">m</span><span class="op" id="6301025">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301028">return</span>&nbsp;<span class="ident" id="6301035">err</span><br>
<span class="lineno"></span><span class="op" id="6301039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301042">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6301108">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6301135">func</span>&nbsp;<span class="op" id="6301140">(</span><span class="ident" id="6301141">w</span>&nbsp;<span class="op" id="6301143">*</span><span class="ident" id="6301144">Writer</span><span class="op" id="6301150">)</span>&nbsp;<span class="ident" id="6301152">Warning</span><span class="op" id="6301159">(</span><span class="ident" id="6301160">m</span>&nbsp;<span class="builtintype" id="6301162">string</span><span class="op" id="6301168">)</span>&nbsp;<span class="op" id="6301170">(</span><span class="ident" id="6301171">err</span>&nbsp;<span class="builtintype" id="6301175">error</span><span class="op" id="6301180">)</span>&nbsp;<span class="op" id="6301182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301185">_</span><span class="op" id="6301186">,</span>&nbsp;<span class="ident" id="6301188">err</span>&nbsp;<span class="op" id="6301192">=</span>&nbsp;<span class="ident" id="6301194">w</span><span class="op" id="6301195">.</span><span class="ident" id="6301196">writeAndRetry</span><span class="op" id="6301209">(</span><span class="ident" id="6301210">LOG_WARNING</span><span class="op" id="6301221">,</span>&nbsp;<span class="ident" id="6301223">m</span><span class="op" id="6301224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301227">return</span>&nbsp;<span class="ident" id="6301234">err</span><br>
<span class="lineno"></span><span class="op" id="6301238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6301241">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6301305">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6301332">func</span>&nbsp;<span class="op" id="6301337">(</span><span class="ident" id="6301338">w</span>&nbsp;<span class="op" id="6301340">*</span><span class="ident" id="6301341">Writer</span><span class="op" id="6301347">)</span>&nbsp;<span class="ident" id="6301349">Notice</span><span class="op" id="6301355">(</span><span class="ident" id="6301356">m</span>&nbsp;<span class="builtintype" id="6301358">string</span><span class="op" id="6301364">)</span>&nbsp;<span class="op" id="6301366">(</span><span class="ident" id="6301367">err</span>&nbsp;<span class="builtintype" id="6301371">error</span><span class="op" id="6301376">)</span>&nbsp;<span class="op" id="6301378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301381">_</span><span class="op" id="6301382">,</span>&nbsp;<span class="ident" id="6301384">err</span>&nbsp;<span class="op" id="6301388">=</span>&nbsp;<span class="ident" id="6301390">w</span><span class="op" id="6301391">.</span><span class="ident" id="6301392">writeAndRetry</span><span class="op" id="6301405">(</span><span class="ident" id="6301406">LOG_NOTICE</span><span class="op" id="6301416">,</span>&nbsp;<span class="ident" id="6301418">m</span><span class="op" id="6301419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301422">return</span>&nbsp;<span class="ident" id="6301429">err</span><br>
<span class="lineno">235</span><span class="op" id="6301433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301436">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6301505">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6301523">func</span>&nbsp;<span class="op" id="6301528">(</span><span class="ident" id="6301529">w</span>&nbsp;<span class="op" id="6301531">*</span><span class="ident" id="6301532">Writer</span><span class="op" id="6301538">)</span>&nbsp;<span class="ident" id="6301540">Info</span><span class="op" id="6301544">(</span><span class="ident" id="6301545">m</span>&nbsp;<span class="builtintype" id="6301547">string</span><span class="op" id="6301553">)</span>&nbsp;<span class="op" id="6301555">(</span><span class="ident" id="6301556">err</span>&nbsp;<span class="builtintype" id="6301560">error</span><span class="op" id="6301565">)</span>&nbsp;<span class="op" id="6301567">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301570">_</span><span class="op" id="6301571">,</span>&nbsp;<span class="ident" id="6301573">err</span>&nbsp;<span class="op" id="6301577">=</span>&nbsp;<span class="ident" id="6301579">w</span><span class="op" id="6301580">.</span><span class="ident" id="6301581">writeAndRetry</span><span class="op" id="6301594">(</span><span class="ident" id="6301595">LOG_INFO</span><span class="op" id="6301603">,</span>&nbsp;<span class="ident" id="6301605">m</span><span class="op" id="6301606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301609">return</span>&nbsp;<span class="ident" id="6301616">err</span><br>
<span class="lineno"></span><span class="op" id="6301620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301623">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6301694">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6301712">func</span>&nbsp;<span class="op" id="6301717">(</span><span class="ident" id="6301718">w</span>&nbsp;<span class="op" id="6301720">*</span><span class="ident" id="6301721">Writer</span><span class="op" id="6301727">)</span>&nbsp;<span class="ident" id="6301729">Debug</span><span class="op" id="6301734">(</span><span class="ident" id="6301735">m</span>&nbsp;<span class="builtintype" id="6301737">string</span><span class="op" id="6301743">)</span>&nbsp;<span class="op" id="6301745">(</span><span class="ident" id="6301746">err</span>&nbsp;<span class="builtintype" id="6301750">error</span><span class="op" id="6301755">)</span>&nbsp;<span class="op" id="6301757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301760">_</span><span class="op" id="6301761">,</span>&nbsp;<span class="ident" id="6301763">err</span>&nbsp;<span class="op" id="6301767">=</span>&nbsp;<span class="ident" id="6301769">w</span><span class="op" id="6301770">.</span><span class="ident" id="6301771">writeAndRetry</span><span class="op" id="6301784">(</span><span class="ident" id="6301785">LOG_DEBUG</span><span class="op" id="6301794">,</span>&nbsp;<span class="ident" id="6301796">m</span><span class="op" id="6301797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301800">return</span>&nbsp;<span class="ident" id="6301807">err</span><br>
<span class="lineno"></span><span class="op" id="6301811">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6301814">func</span>&nbsp;<span class="op" id="6301819">(</span><span class="ident" id="6301820">w</span>&nbsp;<span class="op" id="6301822">*</span><span class="ident" id="6301823">Writer</span><span class="op" id="6301829">)</span>&nbsp;<span class="ident" id="6301831">writeAndRetry</span><span class="op" id="6301844">(</span><span class="ident" id="6301845">p</span>&nbsp;<span class="ident" id="6301847">Priority</span><span class="op" id="6301855">,</span>&nbsp;<span class="ident" id="6301857">s</span>&nbsp;<span class="builtintype" id="6301859">string</span><span class="op" id="6301865">)</span>&nbsp;<span class="op" id="6301867">(</span><span class="builtintype" id="6301868">int</span><span class="op" id="6301871">,</span>&nbsp;<span class="builtintype" id="6301873">error</span><span class="op" id="6301878">)</span>&nbsp;<span class="op" id="6301880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301883">pr</span>&nbsp;<span class="op" id="6301886">:=</span>&nbsp;<span class="op" id="6301889">(</span><span class="ident" id="6301890">w</span><span class="op" id="6301891">.</span><span class="ident" id="6301892">priority</span>&nbsp;<span class="op" id="6301901">&amp;</span>&nbsp;<span class="ident" id="6301903">facilityMask</span><span class="op" id="6301915">)</span>&nbsp;<span class="op" id="6301917">|</span>&nbsp;<span class="op" id="6301919">(</span><span class="ident" id="6301920">p</span>&nbsp;<span class="op" id="6301922">&amp;</span>&nbsp;<span class="ident" id="6301924">severityMask</span><span class="op" id="6301936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301940">w</span><span class="op" id="6301941">.</span><span class="ident" id="6301942">mu</span><span class="op" id="6301944">.</span><span class="ident" id="6301945">Lock</span><span class="op" id="6301949">(</span><span class="op" id="6301950">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301953">defer</span>&nbsp;<span class="ident" id="6301959">w</span><span class="op" id="6301960">.</span><span class="ident" id="6301961">mu</span><span class="op" id="6301963">.</span><span class="ident" id="6301964">Unlock</span><span class="op" id="6301970">(</span><span class="op" id="6301971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301975">if</span>&nbsp;<span class="ident" id="6301978">w</span><span class="op" id="6301979">.</span><span class="ident" id="6301980">conn</span>&nbsp;<span class="op" id="6301985">!=</span>&nbsp;<span class="ident" id="6301988">nil</span>&nbsp;<span class="op" id="6301992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301996">if</span>&nbsp;<span class="ident" id="6301999">n</span><span class="op" id="6302000">,</span>&nbsp;<span class="ident" id="6302002">err</span>&nbsp;<span class="op" id="6302006">:=</span>&nbsp;<span class="ident" id="6302009">w</span><span class="op" id="6302010">.</span><span class="ident" id="6302011">write</span><span class="op" id="6302016">(</span><span class="ident" id="6302017">pr</span><span class="op" id="6302019">,</span>&nbsp;<span class="ident" id="6302021">s</span><span class="op" id="6302022">)</span><span class="op" id="6302023">;</span>&nbsp;<span class="ident" id="6302025">err</span>&nbsp;<span class="op" id="6302029">==</span>&nbsp;<span class="ident" id="6302032">nil</span>&nbsp;<span class="op" id="6302036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302041">return</span>&nbsp;<span class="ident" id="6302048">n</span><span class="op" id="6302049">,</span>&nbsp;<span class="ident" id="6302051">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302063">if</span>&nbsp;<span class="ident" id="6302066">err</span>&nbsp;<span class="op" id="6302070">:=</span>&nbsp;<span class="ident" id="6302073">w</span><span class="op" id="6302074">.</span><span class="ident" id="6302075">connect</span><span class="op" id="6302082">(</span><span class="op" id="6302083">)</span><span class="op" id="6302084">;</span>&nbsp;<span class="ident" id="6302086">err</span>&nbsp;<span class="op" id="6302090">!=</span>&nbsp;<span class="ident" id="6302093">nil</span>&nbsp;<span class="op" id="6302097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302101">return</span>&nbsp;<span class="num" id="6302108">0</span><span class="op" id="6302109">,</span>&nbsp;<span class="ident" id="6302111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302116">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302119">return</span>&nbsp;<span class="ident" id="6302126">w</span><span class="op" id="6302127">.</span><span class="ident" id="6302128">write</span><span class="op" id="6302133">(</span><span class="ident" id="6302134">pr</span><span class="op" id="6302136">,</span>&nbsp;<span class="ident" id="6302138">s</span><span class="op" id="6302139">)</span><br>
<span class="lineno"></span><span class="op" id="6302141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302144">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6302205">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6302268">func</span>&nbsp;<span class="op" id="6302273">(</span><span class="ident" id="6302274">w</span>&nbsp;<span class="op" id="6302276">*</span><span class="ident" id="6302277">Writer</span><span class="op" id="6302283">)</span>&nbsp;<span class="ident" id="6302285">write</span><span class="op" id="6302290">(</span><span class="ident" id="6302291">p</span>&nbsp;<span class="ident" id="6302293">Priority</span><span class="op" id="6302301">,</span>&nbsp;<span class="ident" id="6302303">msg</span>&nbsp;<span class="builtintype" id="6302307">string</span><span class="op" id="6302313">)</span>&nbsp;<span class="op" id="6302315">(</span><span class="builtintype" id="6302316">int</span><span class="op" id="6302319">,</span>&nbsp;<span class="builtintype" id="6302321">error</span><span class="op" id="6302326">)</span>&nbsp;<span class="op" id="6302328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302331">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302358">nl</span>&nbsp;<span class="op" id="6302361">:=</span>&nbsp;<span class="string" id="6302364">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302368">if</span>&nbsp;<span class="op" id="6302371">!</span><span class="ident" id="6302372">strings</span><span class="op" id="6302379">.</span><span class="ident" id="6302380">HasSuffix</span><span class="op" id="6302389">(</span><span class="ident" id="6302390">msg</span><span class="op" id="6302393">,</span>&nbsp;<span class="string" id="6302395">&#34;\n&#34;</span><span class="op" id="6302399">)</span>&nbsp;<span class="op" id="6302401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302405">nl</span>&nbsp;<span class="op" id="6302408">=</span>&nbsp;<span class="string" id="6302410">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302420">err</span>&nbsp;<span class="op" id="6302424">:=</span>&nbsp;<span class="ident" id="6302427">w</span><span class="op" id="6302428">.</span><span class="ident" id="6302429">conn</span><span class="op" id="6302433">.</span><span class="ident" id="6302434">writeString</span><span class="op" id="6302445">(</span><span class="ident" id="6302446">p</span><span class="op" id="6302447">,</span>&nbsp;<span class="ident" id="6302449">w</span><span class="op" id="6302450">.</span><span class="ident" id="6302451">hostname</span><span class="op" id="6302459">,</span>&nbsp;<span class="ident" id="6302461">w</span><span class="op" id="6302462">.</span><span class="ident" id="6302463">tag</span><span class="op" id="6302466">,</span>&nbsp;<span class="ident" id="6302468">msg</span><span class="op" id="6302471">,</span>&nbsp;<span class="ident" id="6302473">nl</span><span class="op" id="6302475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302478">if</span>&nbsp;<span class="ident" id="6302481">err</span>&nbsp;<span class="op" id="6302485">!=</span>&nbsp;<span class="ident" id="6302488">nil</span>&nbsp;<span class="op" id="6302492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302496">return</span>&nbsp;<span class="num" id="6302503">0</span><span class="op" id="6302504">,</span>&nbsp;<span class="ident" id="6302506">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302514">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302574">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302634">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302652">return</span>&nbsp;<span class="builtinfunc" id="6302659">len</span><span class="op" id="6302662">(</span><span class="ident" id="6302663">msg</span><span class="op" id="6302666">)</span><span class="op" id="6302667">,</span>&nbsp;<span class="ident" id="6302669">nil</span><br>
<span class="lineno">285</span><span class="op" id="6302673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6302676">func</span>&nbsp;<span class="op" id="6302681">(</span><span class="ident" id="6302682">n</span>&nbsp;<span class="op" id="6302684">*</span><span class="ident" id="6302685">netConn</span><span class="op" id="6302692">)</span>&nbsp;<span class="ident" id="6302694">writeString</span><span class="op" id="6302705">(</span><span class="ident" id="6302706">p</span>&nbsp;<span class="ident" id="6302708">Priority</span><span class="op" id="6302716">,</span>&nbsp;<span class="ident" id="6302718">hostname</span><span class="op" id="6302726">,</span>&nbsp;<span class="ident" id="6302728">tag</span><span class="op" id="6302731">,</span>&nbsp;<span class="ident" id="6302733">msg</span><span class="op" id="6302736">,</span>&nbsp;<span class="ident" id="6302738">nl</span>&nbsp;<span class="builtintype" id="6302741">string</span><span class="op" id="6302747">)</span>&nbsp;<span class="builtintype" id="6302749">error</span>&nbsp;<span class="op" id="6302755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302758">if</span>&nbsp;<span class="ident" id="6302761">n</span><span class="op" id="6302762">.</span><span class="ident" id="6302763">local</span>&nbsp;<span class="op" id="6302769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302773">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302831">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302879">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302929">timestamp</span>&nbsp;<span class="op" id="6302939">:=</span>&nbsp;<span class="ident" id="6302942">time</span><span class="op" id="6302946">.</span><span class="ident" id="6302947">Now</span><span class="op" id="6302950">(</span><span class="op" id="6302951">)</span><span class="op" id="6302952">.</span><span class="ident" id="6302953">Format</span><span class="op" id="6302959">(</span><span class="ident" id="6302960">time</span><span class="op" id="6302964">.</span><span class="ident" id="6302965">Stamp</span><span class="op" id="6302970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302974">_</span><span class="op" id="6302975">,</span>&nbsp;<span class="ident" id="6302977">err</span>&nbsp;<span class="op" id="6302981">:=</span>&nbsp;<span class="ident" id="6302984">fmt</span><span class="op" id="6302987">.</span><span class="ident" id="6302988">Fprintf</span><span class="op" id="6302995">(</span><span class="ident" id="6302996">n</span><span class="op" id="6302997">.</span><span class="ident" id="6302998">conn</span><span class="op" id="6303002">,</span>&nbsp;<span class="string" id="6303004">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6303025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303030">p</span><span class="op" id="6303031">,</span>&nbsp;<span class="ident" id="6303033">timestamp</span><span class="op" id="6303042">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303047">tag</span><span class="op" id="6303050">,</span>&nbsp;<span class="ident" id="6303052">os</span><span class="op" id="6303054">.</span><span class="ident" id="6303055">Getpid</span><span class="op" id="6303061">(</span><span class="op" id="6303062">)</span><span class="op" id="6303063">,</span>&nbsp;<span class="ident" id="6303065">msg</span><span class="op" id="6303068">,</span>&nbsp;<span class="ident" id="6303070">nl</span><span class="op" id="6303072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303076">return</span>&nbsp;<span class="ident" id="6303083">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303091">timestamp</span>&nbsp;<span class="op" id="6303101">:=</span>&nbsp;<span class="ident" id="6303104">time</span><span class="op" id="6303108">.</span><span class="ident" id="6303109">Now</span><span class="op" id="6303112">(</span><span class="op" id="6303113">)</span><span class="op" id="6303114">.</span><span class="ident" id="6303115">Format</span><span class="op" id="6303121">(</span><span class="ident" id="6303122">time</span><span class="op" id="6303126">.</span><span class="ident" id="6303127">RFC3339</span><span class="op" id="6303134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303137">_</span><span class="op" id="6303138">,</span>&nbsp;<span class="ident" id="6303140">err</span>&nbsp;<span class="op" id="6303144">:=</span>&nbsp;<span class="ident" id="6303147">fmt</span><span class="op" id="6303150">.</span><span class="ident" id="6303151">Fprintf</span><span class="op" id="6303158">(</span><span class="ident" id="6303159">n</span><span class="op" id="6303160">.</span><span class="ident" id="6303161">conn</span><span class="op" id="6303165">,</span>&nbsp;<span class="string" id="6303167">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6303191">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303195">p</span><span class="op" id="6303196">,</span>&nbsp;<span class="ident" id="6303198">timestamp</span><span class="op" id="6303207">,</span>&nbsp;<span class="ident" id="6303209">hostname</span><span class="op" id="6303217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303221">tag</span><span class="op" id="6303224">,</span>&nbsp;<span class="ident" id="6303226">os</span><span class="op" id="6303228">.</span><span class="ident" id="6303229">Getpid</span><span class="op" id="6303235">(</span><span class="op" id="6303236">)</span><span class="op" id="6303237">,</span>&nbsp;<span class="ident" id="6303239">msg</span><span class="op" id="6303242">,</span>&nbsp;<span class="ident" id="6303244">nl</span><span class="op" id="6303246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303249">return</span>&nbsp;<span class="ident" id="6303256">err</span><br>
<span class="lineno"></span><span class="op" id="6303260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6303263">func</span>&nbsp;<span class="op" id="6303268">(</span><span class="ident" id="6303269">n</span>&nbsp;<span class="op" id="6303271">*</span><span class="ident" id="6303272">netConn</span><span class="op" id="6303279">)</span>&nbsp;<span class="builtinfunc" id="6303281">close</span><span class="op" id="6303286">(</span><span class="op" id="6303287">)</span>&nbsp;<span class="builtintype" id="6303289">error</span>&nbsp;<span class="op" id="6303295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303298">return</span>&nbsp;<span class="ident" id="6303305">n</span><span class="op" id="6303306">.</span><span class="ident" id="6303307">conn</span><span class="op" id="6303311">.</span><span class="ident" id="6303312">Close</span><span class="op" id="6303317">(</span><span class="op" id="6303318">)</span><br>
<span class="lineno"></span><span class="op" id="6303320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6303323">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6303384">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6303451">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6303515">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6303530">func</span>&nbsp;<span class="ident" id="6303535">NewLogger</span><span class="op" id="6303544">(</span><span class="ident" id="6303545">p</span>&nbsp;<span class="ident" id="6303547">Priority</span><span class="op" id="6303555">,</span>&nbsp;<span class="ident" id="6303557">logFlag</span>&nbsp;<span class="builtintype" id="6303565">int</span><span class="op" id="6303568">)</span>&nbsp;<span class="op" id="6303570">(</span><span class="op" id="6303571">*</span><span class="ident" id="6303572">log</span><span class="op" id="6303575">.</span><span class="ident" id="6303576">Logger</span><span class="op" id="6303582">,</span>&nbsp;<span class="builtintype" id="6303584">error</span><span class="op" id="6303589">)</span>&nbsp;<span class="op" id="6303591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303594">s</span><span class="op" id="6303595">,</span>&nbsp;<span class="ident" id="6303597">err</span>&nbsp;<span class="op" id="6303601">:=</span>&nbsp;<span class="ident" id="6303604">New</span><span class="op" id="6303607">(</span><span class="ident" id="6303608">p</span><span class="op" id="6303609">,</span>&nbsp;<span class="string" id="6303611">&#34;&#34;</span><span class="op" id="6303613">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303616">if</span>&nbsp;<span class="ident" id="6303619">err</span>&nbsp;<span class="op" id="6303623">!=</span>&nbsp;<span class="ident" id="6303626">nil</span>&nbsp;<span class="op" id="6303630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303634">return</span>&nbsp;<span class="ident" id="6303641">nil</span><span class="op" id="6303644">,</span>&nbsp;<span class="ident" id="6303646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303654">return</span>&nbsp;<span class="ident" id="6303661">log</span><span class="op" id="6303664">.</span><span class="ident" id="6303665">New</span><span class="op" id="6303668">(</span><span class="ident" id="6303669">s</span><span class="op" id="6303670">,</span>&nbsp;<span class="string" id="6303672">&#34;&#34;</span><span class="op" id="6303674">,</span>&nbsp;<span class="ident" id="6303676">logFlag</span><span class="op" id="6303683">)</span><span class="op" id="6303684">,</span>&nbsp;<span class="ident" id="6303686">nil</span><br>
<span class="lineno"></span><span class="op" id="6303690">}</span>
</div>
</body>
</html>
