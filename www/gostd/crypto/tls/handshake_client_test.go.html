<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6663905">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6663960">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6664014">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6664065">package</span>&nbsp;<span class="ident" id="6664073">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6664078">import</span>&nbsp;<span class="op" id="6664085">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664088">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664097">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664113">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664127">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664142">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664158">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664165">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664171">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664178">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664184">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664195">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664212">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664223">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6664234">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6664241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6664244">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="6664319">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6664335">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6664412">type</span>&nbsp;<span class="ident" id="6664417">blockingSource</span>&nbsp;<span class="keyword" id="6664432">chan</span>&nbsp;<span class="builtintype" id="6664437">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6664443">func</span>&nbsp;<span class="op" id="6664448">(</span><span class="ident" id="6664449">b</span>&nbsp;<span class="ident" id="6664451">blockingSource</span><span class="op" id="6664465">)</span>&nbsp;<span class="ident" id="6664467">Read</span><span class="op" id="6664471">(</span><span class="op" id="6664472">[</span><span class="op" id="6664473">]</span><span class="builtintype" id="6664474">byte</span><span class="op" id="6664478">)</span>&nbsp;<span class="op" id="6664480">(</span><span class="ident" id="6664481">n</span>&nbsp;<span class="builtintype" id="6664483">int</span><span class="op" id="6664486">,</span>&nbsp;<span class="ident" id="6664488">err</span>&nbsp;<span class="builtintype" id="6664492">error</span><span class="op" id="6664497">)</span>&nbsp;<span class="op" id="6664499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664502">&lt;-</span><span class="ident" id="6664504">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664507">return</span>&nbsp;<span class="num" id="6664514">0</span><span class="op" id="6664515">,</span>&nbsp;<span class="ident" id="6664517">io</span><span class="op" id="6664519">.</span><span class="ident" id="6664520">EOF</span><br>
<span class="lineno"></span><span class="op" id="6664524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6664527">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6664607">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6664626">type</span>&nbsp;<span class="ident" id="6664631">clientTest</span>&nbsp;<span class="keyword" id="6664642">struct</span>&nbsp;<span class="op" id="6664649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664652">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664725">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664766">name</span>&nbsp;<span class="builtintype" id="6664771">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664779">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664845">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664890">command</span>&nbsp;<span class="op" id="6664898">[</span><span class="op" id="6664899">]</span><span class="builtintype" id="6664900">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664908">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664979">config</span>&nbsp;<span class="op" id="6664986">*</span><span class="ident" id="6664987">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664995">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665062">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665084">cert</span>&nbsp;<span class="op" id="6665089">[</span><span class="op" id="6665090">]</span><span class="builtintype" id="6665091">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665097">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665155">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665228">key</span>&nbsp;<span class="keyword" id="6665232">interface</span><span class="op" id="6665241">{</span><span class="op" id="6665242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665245">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665314">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665384">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665434">validate</span>&nbsp;<span class="keyword" id="6665443">func</span><span class="op" id="6665447">(</span><span class="ident" id="6665448">ConnectionState</span><span class="op" id="6665463">)</span>&nbsp;<span class="builtintype" id="6665465">error</span><br>
<span class="lineno"></span><span class="op" id="6665471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6665474">var</span>&nbsp;<span class="ident" id="6665478">defaultServerCommand</span>&nbsp;<span class="op" id="6665499">=</span>&nbsp;<span class="op" id="6665501">[</span><span class="op" id="6665502">]</span><span class="builtintype" id="6665503">string</span><span class="op" id="6665509">{</span><span class="string" id="6665510">&#34;openssl&#34;</span><span class="op" id="6665519">,</span>&nbsp;<span class="string" id="6665521">&#34;s_server&#34;</span><span class="op" id="6665531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6665534">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6665609">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6665684">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6665763">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="6665785">func</span>&nbsp;<span class="op" id="6665790">(</span><span class="ident" id="6665791">test</span>&nbsp;<span class="op" id="6665796">*</span><span class="ident" id="6665797">clientTest</span><span class="op" id="6665807">)</span>&nbsp;<span class="ident" id="6665809">connFromCommand</span><span class="op" id="6665824">(</span><span class="op" id="6665825">)</span>&nbsp;<span class="op" id="6665827">(</span><span class="ident" id="6665828">conn</span>&nbsp;<span class="op" id="6665833">*</span><span class="ident" id="6665834">recordingConn</span><span class="op" id="6665847">,</span>&nbsp;<span class="ident" id="6665849">child</span>&nbsp;<span class="op" id="6665855">*</span><span class="ident" id="6665856">exec</span><span class="op" id="6665860">.</span><span class="ident" id="6665861">Cmd</span><span class="op" id="6665864">,</span>&nbsp;<span class="ident" id="6665866">stdin</span>&nbsp;<span class="ident" id="6665872">blockingSource</span><span class="op" id="6665886">,</span>&nbsp;<span class="ident" id="6665888">err</span>&nbsp;<span class="builtintype" id="6665892">error</span><span class="op" id="6665897">)</span>&nbsp;<span class="op" id="6665899">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665902">cert</span>&nbsp;<span class="op" id="6665907">:=</span>&nbsp;<span class="ident" id="6665910">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665930">if</span>&nbsp;<span class="builtinfunc" id="6665933">len</span><span class="op" id="6665936">(</span><span class="ident" id="6665937">test</span><span class="op" id="6665941">.</span><span class="ident" id="6665942">cert</span><span class="op" id="6665946">)</span>&nbsp;<span class="op" id="6665948">&gt;</span>&nbsp;<span class="num" id="6665950">0</span>&nbsp;<span class="op" id="6665952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665956">cert</span>&nbsp;<span class="op" id="6665961">=</span>&nbsp;<span class="ident" id="6665963">test</span><span class="op" id="6665967">.</span><span class="ident" id="6665968">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665977">certPath</span>&nbsp;<span class="op" id="6665986">:=</span>&nbsp;<span class="ident" id="6665989">tempFile</span><span class="op" id="6665997">(</span><span class="builtintype" id="6665998">string</span><span class="op" id="6666004">(</span><span class="ident" id="6666005">cert</span><span class="op" id="6666009">)</span><span class="op" id="6666010">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666013">defer</span>&nbsp;<span class="ident" id="6666019">os</span><span class="op" id="6666021">.</span><span class="ident" id="6666022">Remove</span><span class="op" id="6666028">(</span><span class="ident" id="6666029">certPath</span><span class="op" id="6666037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666041">var</span>&nbsp;<span class="ident" id="6666045">key</span>&nbsp;<span class="keyword" id="6666049">interface</span><span class="op" id="6666058">{</span><span class="op" id="6666059">}</span>&nbsp;<span class="op" id="6666061">=</span>&nbsp;<span class="ident" id="6666063">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666082">if</span>&nbsp;<span class="ident" id="6666085">test</span><span class="op" id="6666089">.</span><span class="ident" id="6666090">key</span>&nbsp;<span class="op" id="6666094">!=</span>&nbsp;<span class="ident" id="6666097">nil</span>&nbsp;<span class="op" id="6666101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666105">key</span>&nbsp;<span class="op" id="6666109">=</span>&nbsp;<span class="ident" id="6666111">test</span><span class="op" id="6666115">.</span><span class="ident" id="6666116">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666124">var</span>&nbsp;<span class="ident" id="6666128">pemType</span>&nbsp;<span class="builtintype" id="6666136">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666144">var</span>&nbsp;<span class="ident" id="6666148">derBytes</span>&nbsp;<span class="op" id="6666157">[</span><span class="op" id="6666158">]</span><span class="builtintype" id="6666159">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666165">switch</span>&nbsp;<span class="ident" id="6666172">key</span>&nbsp;<span class="op" id="6666176">:=</span>&nbsp;<span class="ident" id="6666179">key</span><span class="op" id="6666182">.</span><span class="op" id="6666183">(</span><span class="keyword" id="6666184">type</span><span class="op" id="6666188">)</span>&nbsp;<span class="op" id="6666190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666193">case</span>&nbsp;<span class="op" id="6666198">*</span><span class="ident" id="6666199">rsa</span><span class="op" id="6666202">.</span><span class="ident" id="6666203">PrivateKey</span><span class="op" id="6666213">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666217">pemType</span>&nbsp;<span class="op" id="6666225">=</span>&nbsp;<span class="string" id="6666227">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666235">derBytes</span>&nbsp;<span class="op" id="6666244">=</span>&nbsp;<span class="ident" id="6666246">x509</span><span class="op" id="6666250">.</span><span class="ident" id="6666251">MarshalPKCS1PrivateKey</span><span class="op" id="6666273">(</span><span class="ident" id="6666274">key</span><span class="op" id="6666277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666280">case</span>&nbsp;<span class="op" id="6666285">*</span><span class="ident" id="6666286">ecdsa</span><span class="op" id="6666291">.</span><span class="ident" id="6666292">PrivateKey</span><span class="op" id="6666302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666306">pemType</span>&nbsp;<span class="op" id="6666314">=</span>&nbsp;<span class="string" id="6666316">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666323">var</span>&nbsp;<span class="ident" id="6666327">err</span>&nbsp;<span class="builtintype" id="6666331">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666339">derBytes</span><span class="op" id="6666347">,</span>&nbsp;<span class="ident" id="6666349">err</span>&nbsp;<span class="op" id="6666353">=</span>&nbsp;<span class="ident" id="6666355">x509</span><span class="op" id="6666359">.</span><span class="ident" id="6666360">MarshalECPrivateKey</span><span class="op" id="6666379">(</span><span class="ident" id="6666380">key</span><span class="op" id="6666383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666387">if</span>&nbsp;<span class="ident" id="6666390">err</span>&nbsp;<span class="op" id="6666394">!=</span>&nbsp;<span class="ident" id="6666397">nil</span>&nbsp;<span class="op" id="6666401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6666406">panic</span><span class="op" id="6666411">(</span><span class="ident" id="6666412">err</span><span class="op" id="6666415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666422">default</span><span class="op" id="6666429">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6666433">panic</span><span class="op" id="6666438">(</span><span class="string" id="6666439">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="6666457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666464">var</span>&nbsp;<span class="ident" id="6666468">pemOut</span>&nbsp;<span class="ident" id="6666475">bytes</span><span class="op" id="6666480">.</span><span class="ident" id="6666481">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666489">pem</span><span class="op" id="6666492">.</span><span class="ident" id="6666493">Encode</span><span class="op" id="6666499">(</span><span class="op" id="6666500">&amp;</span><span class="ident" id="6666501">pemOut</span><span class="op" id="6666507">,</span>&nbsp;<span class="op" id="6666509">&amp;</span><span class="ident" id="6666510">pem</span><span class="op" id="6666513">.</span><span class="ident" id="6666514">Block</span><span class="op" id="6666519">{</span><span class="ident" id="6666520">Type</span><span class="op" id="6666524">:</span>&nbsp;<span class="ident" id="6666526">pemType</span>&nbsp;<span class="op" id="6666534">+</span>&nbsp;<span class="string" id="6666536">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="6666550">,</span>&nbsp;<span class="ident" id="6666552">Bytes</span><span class="op" id="6666557">:</span>&nbsp;<span class="ident" id="6666559">derBytes</span><span class="op" id="6666567">}</span><span class="op" id="6666568">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666572">keyPath</span>&nbsp;<span class="op" id="6666580">:=</span>&nbsp;<span class="ident" id="6666583">tempFile</span><span class="op" id="6666591">(</span><span class="builtintype" id="6666592">string</span><span class="op" id="6666598">(</span><span class="ident" id="6666599">pemOut</span><span class="op" id="6666605">.</span><span class="ident" id="6666606">Bytes</span><span class="op" id="6666611">(</span><span class="op" id="6666612">)</span><span class="op" id="6666613">)</span><span class="op" id="6666614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666617">defer</span>&nbsp;<span class="ident" id="6666623">os</span><span class="op" id="6666625">.</span><span class="ident" id="6666626">Remove</span><span class="op" id="6666632">(</span><span class="ident" id="6666633">keyPath</span><span class="op" id="6666640">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666644">var</span>&nbsp;<span class="ident" id="6666648">command</span>&nbsp;<span class="op" id="6666656">[</span><span class="op" id="6666657">]</span><span class="builtintype" id="6666658">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666666">if</span>&nbsp;<span class="builtinfunc" id="6666669">len</span><span class="op" id="6666672">(</span><span class="ident" id="6666673">test</span><span class="op" id="6666677">.</span><span class="ident" id="6666678">command</span><span class="op" id="6666685">)</span>&nbsp;<span class="op" id="6666687">&gt;</span>&nbsp;<span class="num" id="6666689">0</span>&nbsp;<span class="op" id="6666691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666695">command</span>&nbsp;<span class="op" id="6666703">=</span>&nbsp;<span class="builtinfunc" id="6666705">append</span><span class="op" id="6666711">(</span><span class="ident" id="6666712">command</span><span class="op" id="6666719">,</span>&nbsp;<span class="ident" id="6666721">test</span><span class="op" id="6666725">.</span><span class="ident" id="6666726">command</span><span class="op" id="6666733">...</span><span class="op" id="6666736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666739">}</span>&nbsp;<span class="keyword" id="6666741">else</span>&nbsp;<span class="op" id="6666746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666750">command</span>&nbsp;<span class="op" id="6666758">=</span>&nbsp;<span class="builtinfunc" id="6666760">append</span><span class="op" id="6666766">(</span><span class="ident" id="6666767">command</span><span class="op" id="6666774">,</span>&nbsp;<span class="ident" id="6666776">defaultServerCommand</span><span class="op" id="6666796">...</span><span class="op" id="6666799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666802">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666805">command</span>&nbsp;<span class="op" id="6666813">=</span>&nbsp;<span class="builtinfunc" id="6666815">append</span><span class="op" id="6666821">(</span><span class="ident" id="6666822">command</span><span class="op" id="6666829">,</span>&nbsp;<span class="string" id="6666831">&#34;-cert&#34;</span><span class="op" id="6666838">,</span>&nbsp;<span class="ident" id="6666840">certPath</span><span class="op" id="6666848">,</span>&nbsp;<span class="string" id="6666850">&#34;-certform&#34;</span><span class="op" id="6666861">,</span>&nbsp;<span class="string" id="6666863">&#34;DER&#34;</span><span class="op" id="6666868">,</span>&nbsp;<span class="string" id="6666870">&#34;-key&#34;</span><span class="op" id="6666876">,</span>&nbsp;<span class="ident" id="6666878">keyPath</span><span class="op" id="6666885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666888">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666958">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667029">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667098">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667167">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667197">const</span>&nbsp;<span class="ident" id="6667203">serverPort</span>&nbsp;<span class="op" id="6667214">=</span>&nbsp;<span class="num" id="6667216">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667223">command</span>&nbsp;<span class="op" id="6667231">=</span>&nbsp;<span class="builtinfunc" id="6667233">append</span><span class="op" id="6667239">(</span><span class="ident" id="6667240">command</span><span class="op" id="6667247">,</span>&nbsp;<span class="string" id="6667249">&#34;-accept&#34;</span><span class="op" id="6667258">,</span>&nbsp;<span class="ident" id="6667260">strconv</span><span class="op" id="6667267">.</span><span class="ident" id="6667268">Itoa</span><span class="op" id="6667272">(</span><span class="ident" id="6667273">serverPort</span><span class="op" id="6667283">)</span><span class="op" id="6667284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667288">cmd</span>&nbsp;<span class="op" id="6667292">:=</span>&nbsp;<span class="ident" id="6667295">exec</span><span class="op" id="6667299">.</span><span class="ident" id="6667300">Command</span><span class="op" id="6667307">(</span><span class="ident" id="6667308">command</span><span class="op" id="6667315">[</span><span class="num" id="6667316">0</span><span class="op" id="6667317">]</span><span class="op" id="6667318">,</span>&nbsp;<span class="ident" id="6667320">command</span><span class="op" id="6667327">[</span><span class="num" id="6667328">1</span><span class="op" id="6667329">:</span><span class="op" id="6667330">]</span><span class="op" id="6667331">...</span><span class="op" id="6667334">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667337">stdin</span>&nbsp;<span class="op" id="6667343">=</span>&nbsp;<span class="ident" id="6667345">blockingSource</span><span class="op" id="6667359">(</span><span class="builtinfunc" id="6667360">make</span><span class="op" id="6667364">(</span><span class="keyword" id="6667365">chan</span>&nbsp;<span class="builtintype" id="6667370">bool</span><span class="op" id="6667374">)</span><span class="op" id="6667375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667378">cmd</span><span class="op" id="6667381">.</span><span class="ident" id="6667382">Stdin</span>&nbsp;<span class="op" id="6667388">=</span>&nbsp;<span class="ident" id="6667390">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667397">var</span>&nbsp;<span class="ident" id="6667401">out</span>&nbsp;<span class="ident" id="6667405">bytes</span><span class="op" id="6667410">.</span><span class="ident" id="6667411">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667419">cmd</span><span class="op" id="6667422">.</span><span class="ident" id="6667423">Stdout</span>&nbsp;<span class="op" id="6667430">=</span>&nbsp;<span class="op" id="6667432">&amp;</span><span class="ident" id="6667433">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667438">cmd</span><span class="op" id="6667441">.</span><span class="ident" id="6667442">Stderr</span>&nbsp;<span class="op" id="6667449">=</span>&nbsp;<span class="op" id="6667451">&amp;</span><span class="ident" id="6667452">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667457">if</span>&nbsp;<span class="ident" id="6667460">err</span>&nbsp;<span class="op" id="6667464">:=</span>&nbsp;<span class="ident" id="6667467">cmd</span><span class="op" id="6667470">.</span><span class="ident" id="6667471">Start</span><span class="op" id="6667476">(</span><span class="op" id="6667477">)</span><span class="op" id="6667478">;</span>&nbsp;<span class="ident" id="6667480">err</span>&nbsp;<span class="op" id="6667484">!=</span>&nbsp;<span class="ident" id="6667487">nil</span>&nbsp;<span class="op" id="6667491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667495">return</span>&nbsp;<span class="ident" id="6667502">nil</span><span class="op" id="6667505">,</span>&nbsp;<span class="ident" id="6667507">nil</span><span class="op" id="6667510">,</span>&nbsp;<span class="ident" id="6667512">nil</span><span class="op" id="6667515">,</span>&nbsp;<span class="ident" id="6667517">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667526">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667593">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667665">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667734">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667750">var</span>&nbsp;<span class="ident" id="6667754">tcpConn</span>&nbsp;<span class="ident" id="6667762">net</span><span class="op" id="6667765">.</span><span class="ident" id="6667766">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667772">for</span>&nbsp;<span class="ident" id="6667776">i</span>&nbsp;<span class="op" id="6667778">:=</span>&nbsp;<span class="builtintype" id="6667781">uint</span><span class="op" id="6667785">(</span><span class="num" id="6667786">0</span><span class="op" id="6667787">)</span><span class="op" id="6667788">;</span>&nbsp;<span class="ident" id="6667790">i</span>&nbsp;<span class="op" id="6667792">&lt;</span>&nbsp;<span class="num" id="6667794">5</span><span class="op" id="6667795">;</span>&nbsp;<span class="ident" id="6667797">i</span><span class="op" id="6667798">++</span>&nbsp;<span class="op" id="6667801">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667805">var</span>&nbsp;<span class="ident" id="6667809">err</span>&nbsp;<span class="builtintype" id="6667813">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667821">tcpConn</span><span class="op" id="6667828">,</span>&nbsp;<span class="ident" id="6667830">err</span>&nbsp;<span class="op" id="6667834">=</span>&nbsp;<span class="ident" id="6667836">net</span><span class="op" id="6667839">.</span><span class="ident" id="6667840">DialTCP</span><span class="op" id="6667847">(</span><span class="string" id="6667848">&#34;tcp&#34;</span><span class="op" id="6667853">,</span>&nbsp;<span class="ident" id="6667855">nil</span><span class="op" id="6667858">,</span>&nbsp;<span class="op" id="6667860">&amp;</span><span class="ident" id="6667861">net</span><span class="op" id="6667864">.</span><span class="ident" id="6667865">TCPAddr</span><span class="op" id="6667872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667877">IP</span><span class="op" id="6667879">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6667883">net</span><span class="op" id="6667886">.</span><span class="ident" id="6667887">IPv4</span><span class="op" id="6667891">(</span><span class="num" id="6667892">127</span><span class="op" id="6667895">,</span>&nbsp;<span class="num" id="6667897">0</span><span class="op" id="6667898">,</span>&nbsp;<span class="num" id="6667900">0</span><span class="op" id="6667901">,</span>&nbsp;<span class="num" id="6667903">1</span><span class="op" id="6667904">)</span><span class="op" id="6667905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667910">Port</span><span class="op" id="6667914">:</span>&nbsp;<span class="ident" id="6667916">serverPort</span><span class="op" id="6667926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667930">}</span><span class="op" id="6667931">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667935">if</span>&nbsp;<span class="ident" id="6667938">err</span>&nbsp;<span class="op" id="6667942">==</span>&nbsp;<span class="ident" id="6667945">nil</span>&nbsp;<span class="op" id="6667949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667954">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667966">time</span><span class="op" id="6667970">.</span><span class="ident" id="6667971">Sleep</span><span class="op" id="6667976">(</span><span class="op" id="6667977">(</span><span class="num" id="6667978">1</span>&nbsp;<span class="op" id="6667980">&lt;&lt;</span>&nbsp;<span class="ident" id="6667983">i</span><span class="op" id="6667984">)</span>&nbsp;<span class="op" id="6667986">*</span>&nbsp;<span class="num" id="6667988">5</span>&nbsp;<span class="op" id="6667990">*</span>&nbsp;<span class="ident" id="6667992">time</span><span class="op" id="6667996">.</span><span class="ident" id="6667997">Millisecond</span><span class="op" id="6668008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668011">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668014">if</span>&nbsp;<span class="ident" id="6668017">tcpConn</span>&nbsp;<span class="op" id="6668025">==</span>&nbsp;<span class="ident" id="6668028">nil</span>&nbsp;<span class="op" id="6668032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6668036">close</span><span class="op" id="6668041">(</span><span class="ident" id="6668042">stdin</span><span class="op" id="6668047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668051">out</span><span class="op" id="6668054">.</span><span class="ident" id="6668055">WriteTo</span><span class="op" id="6668062">(</span><span class="ident" id="6668063">os</span><span class="op" id="6668065">.</span><span class="ident" id="6668066">Stdout</span><span class="op" id="6668072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668076">cmd</span><span class="op" id="6668079">.</span><span class="ident" id="6668080">Process</span><span class="op" id="6668087">.</span><span class="ident" id="6668088">Kill</span><span class="op" id="6668092">(</span><span class="op" id="6668093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668097">return</span>&nbsp;<span class="ident" id="6668104">nil</span><span class="op" id="6668107">,</span>&nbsp;<span class="ident" id="6668109">nil</span><span class="op" id="6668112">,</span>&nbsp;<span class="ident" id="6668114">nil</span><span class="op" id="6668117">,</span>&nbsp;<span class="ident" id="6668119">cmd</span><span class="op" id="6668122">.</span><span class="ident" id="6668123">Wait</span><span class="op" id="6668127">(</span><span class="op" id="6668128">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668135">record</span>&nbsp;<span class="op" id="6668142">:=</span>&nbsp;<span class="op" id="6668145">&amp;</span><span class="ident" id="6668146">recordingConn</span><span class="op" id="6668159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668163">Conn</span><span class="op" id="6668167">:</span>&nbsp;<span class="ident" id="6668169">tcpConn</span><span class="op" id="6668176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668179">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668183">return</span>&nbsp;<span class="ident" id="6668190">record</span><span class="op" id="6668196">,</span>&nbsp;<span class="ident" id="6668198">cmd</span><span class="op" id="6668201">,</span>&nbsp;<span class="ident" id="6668203">stdin</span><span class="op" id="6668208">,</span>&nbsp;<span class="ident" id="6668210">nil</span><br>
<span class="lineno"></span><span class="op" id="6668214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6668217">func</span>&nbsp;<span class="op" id="6668222">(</span><span class="ident" id="6668223">test</span>&nbsp;<span class="op" id="6668228">*</span><span class="ident" id="6668229">clientTest</span><span class="op" id="6668239">)</span>&nbsp;<span class="ident" id="6668241">dataPath</span><span class="op" id="6668249">(</span><span class="op" id="6668250">)</span>&nbsp;<span class="builtintype" id="6668252">string</span>&nbsp;<span class="op" id="6668259">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668262">return</span>&nbsp;<span class="ident" id="6668269">filepath</span><span class="op" id="6668277">.</span><span class="ident" id="6668278">Join</span><span class="op" id="6668282">(</span><span class="string" id="6668283">&#34;testdata&#34;</span><span class="op" id="6668293">,</span>&nbsp;<span class="string" id="6668295">&#34;Client-&#34;</span><span class="op" id="6668304">+</span><span class="ident" id="6668305">test</span><span class="op" id="6668309">.</span><span class="ident" id="6668310">name</span><span class="op" id="6668314">)</span><br>
<span class="lineno"></span><span class="op" id="6668316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6668319">func</span>&nbsp;<span class="op" id="6668324">(</span><span class="ident" id="6668325">test</span>&nbsp;<span class="op" id="6668330">*</span><span class="ident" id="6668331">clientTest</span><span class="op" id="6668341">)</span>&nbsp;<span class="ident" id="6668343">loadData</span><span class="op" id="6668351">(</span><span class="op" id="6668352">)</span>&nbsp;<span class="op" id="6668354">(</span><span class="ident" id="6668355">flows</span>&nbsp;<span class="op" id="6668361">[</span><span class="op" id="6668362">]</span><span class="op" id="6668363">[</span><span class="op" id="6668364">]</span><span class="builtintype" id="6668365">byte</span><span class="op" id="6668369">,</span>&nbsp;<span class="ident" id="6668371">err</span>&nbsp;<span class="builtintype" id="6668375">error</span><span class="op" id="6668380">)</span>&nbsp;<span class="op" id="6668382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668385">in</span><span class="op" id="6668387">,</span>&nbsp;<span class="ident" id="6668389">err</span>&nbsp;<span class="op" id="6668393">:=</span>&nbsp;<span class="ident" id="6668396">os</span><span class="op" id="6668398">.</span><span class="ident" id="6668399">Open</span><span class="op" id="6668403">(</span><span class="ident" id="6668404">test</span><span class="op" id="6668408">.</span><span class="ident" id="6668409">dataPath</span><span class="op" id="6668417">(</span><span class="op" id="6668418">)</span><span class="op" id="6668419">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668422">if</span>&nbsp;<span class="ident" id="6668425">err</span>&nbsp;<span class="op" id="6668429">!=</span>&nbsp;<span class="ident" id="6668432">nil</span>&nbsp;<span class="op" id="6668436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668440">return</span>&nbsp;<span class="ident" id="6668447">nil</span><span class="op" id="6668450">,</span>&nbsp;<span class="ident" id="6668452">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668460">defer</span>&nbsp;<span class="ident" id="6668466">in</span><span class="op" id="6668468">.</span><span class="ident" id="6668469">Close</span><span class="op" id="6668474">(</span><span class="op" id="6668475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668478">return</span>&nbsp;<span class="ident" id="6668485">parseTestData</span><span class="op" id="6668498">(</span><span class="ident" id="6668499">in</span><span class="op" id="6668501">)</span><br>
<span class="lineno">165</span><span class="op" id="6668503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6668506">func</span>&nbsp;<span class="op" id="6668511">(</span><span class="ident" id="6668512">test</span>&nbsp;<span class="op" id="6668517">*</span><span class="ident" id="6668518">clientTest</span><span class="op" id="6668528">)</span>&nbsp;<span class="ident" id="6668530">run</span><span class="op" id="6668533">(</span><span class="ident" id="6668534">t</span>&nbsp;<span class="op" id="6668536">*</span><span class="ident" id="6668537">testing</span><span class="op" id="6668544">.</span><span class="ident" id="6668545">T</span><span class="op" id="6668546">,</span>&nbsp;<span class="ident" id="6668548">write</span>&nbsp;<span class="builtintype" id="6668554">bool</span><span class="op" id="6668558">)</span>&nbsp;<span class="op" id="6668560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668563">var</span>&nbsp;<span class="ident" id="6668567">clientConn</span><span class="op" id="6668577">,</span>&nbsp;<span class="ident" id="6668579">serverConn</span>&nbsp;<span class="ident" id="6668590">net</span><span class="op" id="6668593">.</span><span class="ident" id="6668594">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668600">var</span>&nbsp;<span class="ident" id="6668604">recordingConn</span>&nbsp;<span class="op" id="6668618">*</span><span class="ident" id="6668619">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668634">var</span>&nbsp;<span class="ident" id="6668638">childProcess</span>&nbsp;<span class="op" id="6668651">*</span><span class="ident" id="6668652">exec</span><span class="op" id="6668656">.</span><span class="ident" id="6668657">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668662">var</span>&nbsp;<span class="ident" id="6668666">stdin</span>&nbsp;<span class="ident" id="6668672">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668689">if</span>&nbsp;<span class="ident" id="6668692">write</span>&nbsp;<span class="op" id="6668698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668702">var</span>&nbsp;<span class="ident" id="6668706">err</span>&nbsp;<span class="builtintype" id="6668710">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668718">recordingConn</span><span class="op" id="6668731">,</span>&nbsp;<span class="ident" id="6668733">childProcess</span><span class="op" id="6668745">,</span>&nbsp;<span class="ident" id="6668747">stdin</span><span class="op" id="6668752">,</span>&nbsp;<span class="ident" id="6668754">err</span>&nbsp;<span class="op" id="6668758">=</span>&nbsp;<span class="ident" id="6668760">test</span><span class="op" id="6668764">.</span><span class="ident" id="6668765">connFromCommand</span><span class="op" id="6668780">(</span><span class="op" id="6668781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668785">if</span>&nbsp;<span class="ident" id="6668788">err</span>&nbsp;<span class="op" id="6668792">!=</span>&nbsp;<span class="ident" id="6668795">nil</span>&nbsp;<span class="op" id="6668799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668804">t</span><span class="op" id="6668805">.</span><span class="ident" id="6668806">Fatalf</span><span class="op" id="6668812">(</span><span class="string" id="6668813">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6668845">,</span>&nbsp;<span class="ident" id="6668847">err</span><span class="op" id="6668850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668858">clientConn</span>&nbsp;<span class="op" id="6668869">=</span>&nbsp;<span class="ident" id="6668871">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668886">}</span>&nbsp;<span class="keyword" id="6668888">else</span>&nbsp;<span class="op" id="6668893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668897">clientConn</span><span class="op" id="6668907">,</span>&nbsp;<span class="ident" id="6668909">serverConn</span>&nbsp;<span class="op" id="6668920">=</span>&nbsp;<span class="ident" id="6668922">net</span><span class="op" id="6668925">.</span><span class="ident" id="6668926">Pipe</span><span class="op" id="6668930">(</span><span class="op" id="6668931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668938">config</span>&nbsp;<span class="op" id="6668945">:=</span>&nbsp;<span class="ident" id="6668948">test</span><span class="op" id="6668952">.</span><span class="ident" id="6668953">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668961">if</span>&nbsp;<span class="ident" id="6668964">config</span>&nbsp;<span class="op" id="6668971">==</span>&nbsp;<span class="ident" id="6668974">nil</span>&nbsp;<span class="op" id="6668978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668982">config</span>&nbsp;<span class="op" id="6668989">=</span>&nbsp;<span class="ident" id="6668991">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669006">client</span>&nbsp;<span class="op" id="6669013">:=</span>&nbsp;<span class="ident" id="6669016">Client</span><span class="op" id="6669022">(</span><span class="ident" id="6669023">clientConn</span><span class="op" id="6669033">,</span>&nbsp;<span class="ident" id="6669035">config</span><span class="op" id="6669041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669045">doneChan</span>&nbsp;<span class="op" id="6669054">:=</span>&nbsp;<span class="builtinfunc" id="6669057">make</span><span class="op" id="6669061">(</span><span class="keyword" id="6669062">chan</span>&nbsp;<span class="builtintype" id="6669067">bool</span><span class="op" id="6669071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669074">go</span>&nbsp;<span class="keyword" id="6669077">func</span><span class="op" id="6669081">(</span><span class="op" id="6669082">)</span>&nbsp;<span class="op" id="6669084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669088">if</span>&nbsp;<span class="ident" id="6669091">_</span><span class="op" id="6669092">,</span>&nbsp;<span class="ident" id="6669094">err</span>&nbsp;<span class="op" id="6669098">:=</span>&nbsp;<span class="ident" id="6669101">client</span><span class="op" id="6669107">.</span><span class="ident" id="6669108">Write</span><span class="op" id="6669113">(</span><span class="op" id="6669114">[</span><span class="op" id="6669115">]</span><span class="builtintype" id="6669116">byte</span><span class="op" id="6669120">(</span><span class="string" id="6669121">&#34;hello\n&#34;</span><span class="op" id="6669130">)</span><span class="op" id="6669131">)</span><span class="op" id="6669132">;</span>&nbsp;<span class="ident" id="6669134">err</span>&nbsp;<span class="op" id="6669138">!=</span>&nbsp;<span class="ident" id="6669141">nil</span>&nbsp;<span class="op" id="6669145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669150">t</span><span class="op" id="6669151">.</span><span class="ident" id="6669152">Logf</span><span class="op" id="6669156">(</span><span class="string" id="6669157">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6669182">,</span>&nbsp;<span class="ident" id="6669184">err</span><span class="op" id="6669187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669191">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669195">if</span>&nbsp;<span class="ident" id="6669198">test</span><span class="op" id="6669202">.</span><span class="ident" id="6669203">validate</span>&nbsp;<span class="op" id="6669212">!=</span>&nbsp;<span class="ident" id="6669215">nil</span>&nbsp;<span class="op" id="6669219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669224">if</span>&nbsp;<span class="ident" id="6669227">err</span>&nbsp;<span class="op" id="6669231">:=</span>&nbsp;<span class="ident" id="6669234">test</span><span class="op" id="6669238">.</span><span class="ident" id="6669239">validate</span><span class="op" id="6669247">(</span><span class="ident" id="6669248">client</span><span class="op" id="6669254">.</span><span class="ident" id="6669255">ConnectionState</span><span class="op" id="6669270">(</span><span class="op" id="6669271">)</span><span class="op" id="6669272">)</span><span class="op" id="6669273">;</span>&nbsp;<span class="ident" id="6669275">err</span>&nbsp;<span class="op" id="6669279">!=</span>&nbsp;<span class="ident" id="6669282">nil</span>&nbsp;<span class="op" id="6669286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669292">t</span><span class="op" id="6669293">.</span><span class="ident" id="6669294">Logf</span><span class="op" id="6669298">(</span><span class="string" id="6669299">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6669337">,</span>&nbsp;<span class="ident" id="6669339">err</span><span class="op" id="6669342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669351">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669355">client</span><span class="op" id="6669361">.</span><span class="ident" id="6669362">Close</span><span class="op" id="6669367">(</span><span class="op" id="6669368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669372">clientConn</span><span class="op" id="6669382">.</span><span class="ident" id="6669383">Close</span><span class="op" id="6669388">(</span><span class="op" id="6669389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669393">doneChan</span>&nbsp;<span class="op" id="6669402">&lt;-</span>&nbsp;<span class="builtintype" id="6669405">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669411">}</span><span class="op" id="6669412">(</span><span class="op" id="6669413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669417">if</span>&nbsp;<span class="op" id="6669420">!</span><span class="ident" id="6669421">write</span>&nbsp;<span class="op" id="6669427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669431">flows</span><span class="op" id="6669436">,</span>&nbsp;<span class="ident" id="6669438">err</span>&nbsp;<span class="op" id="6669442">:=</span>&nbsp;<span class="ident" id="6669445">test</span><span class="op" id="6669449">.</span><span class="ident" id="6669450">loadData</span><span class="op" id="6669458">(</span><span class="op" id="6669459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669463">if</span>&nbsp;<span class="ident" id="6669466">err</span>&nbsp;<span class="op" id="6669470">!=</span>&nbsp;<span class="ident" id="6669473">nil</span>&nbsp;<span class="op" id="6669477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669482">t</span><span class="op" id="6669483">.</span><span class="ident" id="6669484">Fatalf</span><span class="op" id="6669490">(</span><span class="string" id="6669491">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6669528">,</span>&nbsp;<span class="ident" id="6669530">test</span><span class="op" id="6669534">.</span><span class="ident" id="6669535">name</span><span class="op" id="6669539">,</span>&nbsp;<span class="ident" id="6669541">test</span><span class="op" id="6669545">.</span><span class="ident" id="6669546">dataPath</span><span class="op" id="6669554">(</span><span class="op" id="6669555">)</span><span class="op" id="6669556">,</span>&nbsp;<span class="ident" id="6669558">err</span><span class="op" id="6669561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669565">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669569">for</span>&nbsp;<span class="ident" id="6669573">i</span><span class="op" id="6669574">,</span>&nbsp;<span class="ident" id="6669576">b</span>&nbsp;<span class="op" id="6669578">:=</span>&nbsp;<span class="keyword" id="6669581">range</span>&nbsp;<span class="ident" id="6669587">flows</span>&nbsp;<span class="op" id="6669593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669598">if</span>&nbsp;<span class="ident" id="6669601">i</span><span class="op" id="6669602">%</span><span class="num" id="6669603">2</span>&nbsp;<span class="op" id="6669605">==</span>&nbsp;<span class="num" id="6669608">1</span>&nbsp;<span class="op" id="6669610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669616">serverConn</span><span class="op" id="6669626">.</span><span class="ident" id="6669627">Write</span><span class="op" id="6669632">(</span><span class="ident" id="6669633">b</span><span class="op" id="6669634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669640">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669652">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669657">bb</span>&nbsp;<span class="op" id="6669660">:=</span>&nbsp;<span class="builtinfunc" id="6669663">make</span><span class="op" id="6669667">(</span><span class="op" id="6669668">[</span><span class="op" id="6669669">]</span><span class="builtintype" id="6669670">byte</span><span class="op" id="6669674">,</span>&nbsp;<span class="builtinfunc" id="6669676">len</span><span class="op" id="6669679">(</span><span class="ident" id="6669680">b</span><span class="op" id="6669681">)</span><span class="op" id="6669682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669687">_</span><span class="op" id="6669688">,</span>&nbsp;<span class="ident" id="6669690">err</span>&nbsp;<span class="op" id="6669694">:=</span>&nbsp;<span class="ident" id="6669697">io</span><span class="op" id="6669699">.</span><span class="ident" id="6669700">ReadFull</span><span class="op" id="6669708">(</span><span class="ident" id="6669709">serverConn</span><span class="op" id="6669719">,</span>&nbsp;<span class="ident" id="6669721">bb</span><span class="op" id="6669723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669728">if</span>&nbsp;<span class="ident" id="6669731">err</span>&nbsp;<span class="op" id="6669735">!=</span>&nbsp;<span class="ident" id="6669738">nil</span>&nbsp;<span class="op" id="6669742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669748">t</span><span class="op" id="6669749">.</span><span class="ident" id="6669750">Fatalf</span><span class="op" id="6669756">(</span><span class="string" id="6669757">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="6669769">,</span>&nbsp;<span class="ident" id="6669771">test</span><span class="op" id="6669775">.</span><span class="ident" id="6669776">name</span><span class="op" id="6669780">,</span>&nbsp;<span class="ident" id="6669782">i</span><span class="op" id="6669783">,</span>&nbsp;<span class="ident" id="6669785">err</span><span class="op" id="6669788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669793">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669798">if</span>&nbsp;<span class="op" id="6669801">!</span><span class="ident" id="6669802">bytes</span><span class="op" id="6669807">.</span><span class="ident" id="6669808">Equal</span><span class="op" id="6669813">(</span><span class="ident" id="6669814">b</span><span class="op" id="6669815">,</span>&nbsp;<span class="ident" id="6669817">bb</span><span class="op" id="6669819">)</span>&nbsp;<span class="op" id="6669821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669827">t</span><span class="op" id="6669828">.</span><span class="ident" id="6669829">Fatalf</span><span class="op" id="6669835">(</span><span class="string" id="6669836">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6669878">,</span>&nbsp;<span class="ident" id="6669880">test</span><span class="op" id="6669884">.</span><span class="ident" id="6669885">name</span><span class="op" id="6669889">,</span>&nbsp;<span class="ident" id="6669891">i</span><span class="op" id="6669892">,</span>&nbsp;<span class="ident" id="6669894">bb</span><span class="op" id="6669896">,</span>&nbsp;<span class="ident" id="6669898">b</span><span class="op" id="6669899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669912">serverConn</span><span class="op" id="6669922">.</span><span class="ident" id="6669923">Close</span><span class="op" id="6669928">(</span><span class="op" id="6669929">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6669936">&lt;-</span><span class="ident" id="6669938">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6669949">if</span>&nbsp;<span class="ident" id="6669952">write</span>&nbsp;<span class="op" id="6669958">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669962">path</span>&nbsp;<span class="op" id="6669967">:=</span>&nbsp;<span class="ident" id="6669970">test</span><span class="op" id="6669974">.</span><span class="ident" id="6669975">dataPath</span><span class="op" id="6669983">(</span><span class="op" id="6669984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6669988">out</span><span class="op" id="6669991">,</span>&nbsp;<span class="ident" id="6669993">err</span>&nbsp;<span class="op" id="6669997">:=</span>&nbsp;<span class="ident" id="6670000">os</span><span class="op" id="6670002">.</span><span class="ident" id="6670003">OpenFile</span><span class="op" id="6670011">(</span><span class="ident" id="6670012">path</span><span class="op" id="6670016">,</span>&nbsp;<span class="ident" id="6670018">os</span><span class="op" id="6670020">.</span><span class="ident" id="6670021">O_WRONLY</span><span class="op" id="6670029">|</span><span class="ident" id="6670030">os</span><span class="op" id="6670032">.</span><span class="ident" id="6670033">O_CREATE</span><span class="op" id="6670041">|</span><span class="ident" id="6670042">os</span><span class="op" id="6670044">.</span><span class="ident" id="6670045">O_TRUNC</span><span class="op" id="6670052">,</span>&nbsp;<span class="num" id="6670054">0644</span><span class="op" id="6670058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6670062">if</span>&nbsp;<span class="ident" id="6670065">err</span>&nbsp;<span class="op" id="6670069">!=</span>&nbsp;<span class="ident" id="6670072">nil</span>&nbsp;<span class="op" id="6670076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670081">t</span><span class="op" id="6670082">.</span><span class="ident" id="6670083">Fatalf</span><span class="op" id="6670089">(</span><span class="string" id="6670090">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6670124">,</span>&nbsp;<span class="ident" id="6670126">err</span><span class="op" id="6670129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6670133">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6670137">defer</span>&nbsp;<span class="ident" id="6670143">out</span><span class="op" id="6670146">.</span><span class="ident" id="6670147">Close</span><span class="op" id="6670152">(</span><span class="op" id="6670153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670157">recordingConn</span><span class="op" id="6670170">.</span><span class="ident" id="6670171">Close</span><span class="op" id="6670176">(</span><span class="op" id="6670177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6670181">close</span><span class="op" id="6670186">(</span><span class="ident" id="6670187">stdin</span><span class="op" id="6670192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670196">childProcess</span><span class="op" id="6670208">.</span><span class="ident" id="6670209">Process</span><span class="op" id="6670216">.</span><span class="ident" id="6670217">Kill</span><span class="op" id="6670221">(</span><span class="op" id="6670222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670226">childProcess</span><span class="op" id="6670238">.</span><span class="ident" id="6670239">Wait</span><span class="op" id="6670243">(</span><span class="op" id="6670244">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6670248">if</span>&nbsp;<span class="builtinfunc" id="6670251">len</span><span class="op" id="6670254">(</span><span class="ident" id="6670255">recordingConn</span><span class="op" id="6670268">.</span><span class="ident" id="6670269">flows</span><span class="op" id="6670274">)</span>&nbsp;<span class="op" id="6670276">&lt;</span>&nbsp;<span class="num" id="6670278">3</span>&nbsp;<span class="op" id="6670280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670285">childProcess</span><span class="op" id="6670297">.</span><span class="ident" id="6670298">Stdout</span><span class="op" id="6670304">.</span><span class="op" id="6670305">(</span><span class="op" id="6670306">*</span><span class="ident" id="6670307">bytes</span><span class="op" id="6670312">.</span><span class="ident" id="6670313">Buffer</span><span class="op" id="6670319">)</span><span class="op" id="6670320">.</span><span class="ident" id="6670321">WriteTo</span><span class="op" id="6670328">(</span><span class="ident" id="6670329">os</span><span class="op" id="6670331">.</span><span class="ident" id="6670332">Stdout</span><span class="op" id="6670338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670343">t</span><span class="op" id="6670344">.</span><span class="ident" id="6670345">Fatalf</span><span class="op" id="6670351">(</span><span class="string" id="6670352">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="6670383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6670387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670391">recordingConn</span><span class="op" id="6670404">.</span><span class="ident" id="6670405">WriteTo</span><span class="op" id="6670412">(</span><span class="ident" id="6670413">out</span><span class="op" id="6670416">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670420">fmt</span><span class="op" id="6670423">.</span><span class="ident" id="6670424">Printf</span><span class="op" id="6670430">(</span><span class="string" id="6670431">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6670443">,</span>&nbsp;<span class="ident" id="6670445">path</span><span class="op" id="6670449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6670452">}</span><br>
<span class="lineno"></span><span class="op" id="6670454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6670457">func</span>&nbsp;<span class="ident" id="6670462">runClientTestForVersion</span><span class="op" id="6670485">(</span><span class="ident" id="6670486">t</span>&nbsp;<span class="op" id="6670488">*</span><span class="ident" id="6670489">testing</span><span class="op" id="6670496">.</span><span class="ident" id="6670497">T</span><span class="op" id="6670498">,</span>&nbsp;<span class="ident" id="6670500">template</span>&nbsp;<span class="op" id="6670509">*</span><span class="ident" id="6670510">clientTest</span><span class="op" id="6670520">,</span>&nbsp;<span class="ident" id="6670522">prefix</span><span class="op" id="6670528">,</span>&nbsp;<span class="ident" id="6670530">option</span>&nbsp;<span class="builtintype" id="6670537">string</span><span class="op" id="6670543">)</span>&nbsp;<span class="op" id="6670545">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670548">test</span>&nbsp;<span class="op" id="6670553">:=</span>&nbsp;<span class="op" id="6670556">*</span><span class="ident" id="6670557">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670567">test</span><span class="op" id="6670571">.</span><span class="ident" id="6670572">name</span>&nbsp;<span class="op" id="6670577">=</span>&nbsp;<span class="ident" id="6670579">prefix</span>&nbsp;<span class="op" id="6670586">+</span>&nbsp;<span class="ident" id="6670588">test</span><span class="op" id="6670592">.</span><span class="ident" id="6670593">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6670599">if</span>&nbsp;<span class="builtinfunc" id="6670602">len</span><span class="op" id="6670605">(</span><span class="ident" id="6670606">test</span><span class="op" id="6670610">.</span><span class="ident" id="6670611">command</span><span class="op" id="6670618">)</span>&nbsp;<span class="op" id="6670620">==</span>&nbsp;<span class="num" id="6670623">0</span>&nbsp;<span class="op" id="6670625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670629">test</span><span class="op" id="6670633">.</span><span class="ident" id="6670634">command</span>&nbsp;<span class="op" id="6670642">=</span>&nbsp;<span class="ident" id="6670644">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6670666">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670669">test</span><span class="op" id="6670673">.</span><span class="ident" id="6670674">command</span>&nbsp;<span class="op" id="6670682">=</span>&nbsp;<span class="builtinfunc" id="6670684">append</span><span class="op" id="6670690">(</span><span class="op" id="6670691">[</span><span class="op" id="6670692">]</span><span class="builtintype" id="6670693">string</span><span class="op" id="6670699">(</span><span class="ident" id="6670700">nil</span><span class="op" id="6670703">)</span><span class="op" id="6670704">,</span>&nbsp;<span class="ident" id="6670706">test</span><span class="op" id="6670710">.</span><span class="ident" id="6670711">command</span><span class="op" id="6670718">...</span><span class="op" id="6670721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670724">test</span><span class="op" id="6670728">.</span><span class="ident" id="6670729">command</span>&nbsp;<span class="op" id="6670737">=</span>&nbsp;<span class="builtinfunc" id="6670739">append</span><span class="op" id="6670745">(</span><span class="ident" id="6670746">test</span><span class="op" id="6670750">.</span><span class="ident" id="6670751">command</span><span class="op" id="6670758">,</span>&nbsp;<span class="ident" id="6670760">option</span><span class="op" id="6670766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670769">test</span><span class="op" id="6670773">.</span><span class="ident" id="6670774">run</span><span class="op" id="6670777">(</span><span class="ident" id="6670778">t</span><span class="op" id="6670779">,</span>&nbsp;<span class="op" id="6670781">*</span><span class="ident" id="6670782">update</span><span class="op" id="6670788">)</span><br>
<span class="lineno"></span><span class="op" id="6670790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="6670793">func</span>&nbsp;<span class="ident" id="6670798">runClientTestTLS10</span><span class="op" id="6670816">(</span><span class="ident" id="6670817">t</span>&nbsp;<span class="op" id="6670819">*</span><span class="ident" id="6670820">testing</span><span class="op" id="6670827">.</span><span class="ident" id="6670828">T</span><span class="op" id="6670829">,</span>&nbsp;<span class="ident" id="6670831">template</span>&nbsp;<span class="op" id="6670840">*</span><span class="ident" id="6670841">clientTest</span><span class="op" id="6670851">)</span>&nbsp;<span class="op" id="6670853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670856">runClientTestForVersion</span><span class="op" id="6670879">(</span><span class="ident" id="6670880">t</span><span class="op" id="6670881">,</span>&nbsp;<span class="ident" id="6670883">template</span><span class="op" id="6670891">,</span>&nbsp;<span class="string" id="6670893">&#34;TLSv10-&#34;</span><span class="op" id="6670902">,</span>&nbsp;<span class="string" id="6670904">&#34;-tls1&#34;</span><span class="op" id="6670911">)</span><br>
<span class="lineno"></span><span class="op" id="6670913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6670916">func</span>&nbsp;<span class="ident" id="6670921">runClientTestTLS11</span><span class="op" id="6670939">(</span><span class="ident" id="6670940">t</span>&nbsp;<span class="op" id="6670942">*</span><span class="ident" id="6670943">testing</span><span class="op" id="6670950">.</span><span class="ident" id="6670951">T</span><span class="op" id="6670952">,</span>&nbsp;<span class="ident" id="6670954">template</span>&nbsp;<span class="op" id="6670963">*</span><span class="ident" id="6670964">clientTest</span><span class="op" id="6670974">)</span>&nbsp;<span class="op" id="6670976">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6670979">runClientTestForVersion</span><span class="op" id="6671002">(</span><span class="ident" id="6671003">t</span><span class="op" id="6671004">,</span>&nbsp;<span class="ident" id="6671006">template</span><span class="op" id="6671014">,</span>&nbsp;<span class="string" id="6671016">&#34;TLSv11-&#34;</span><span class="op" id="6671025">,</span>&nbsp;<span class="string" id="6671027">&#34;-tls1_1&#34;</span><span class="op" id="6671036">)</span><br>
<span class="lineno"></span><span class="op" id="6671038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6671041">func</span>&nbsp;<span class="ident" id="6671046">runClientTestTLS12</span><span class="op" id="6671064">(</span><span class="ident" id="6671065">t</span>&nbsp;<span class="op" id="6671067">*</span><span class="ident" id="6671068">testing</span><span class="op" id="6671075">.</span><span class="ident" id="6671076">T</span><span class="op" id="6671077">,</span>&nbsp;<span class="ident" id="6671079">template</span>&nbsp;<span class="op" id="6671088">*</span><span class="ident" id="6671089">clientTest</span><span class="op" id="6671099">)</span>&nbsp;<span class="op" id="6671101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671104">runClientTestForVersion</span><span class="op" id="6671127">(</span><span class="ident" id="6671128">t</span><span class="op" id="6671129">,</span>&nbsp;<span class="ident" id="6671131">template</span><span class="op" id="6671139">,</span>&nbsp;<span class="string" id="6671141">&#34;TLSv12-&#34;</span><span class="op" id="6671150">,</span>&nbsp;<span class="string" id="6671152">&#34;-tls1_2&#34;</span><span class="op" id="6671161">)</span><br>
<span class="lineno">270</span><span class="op" id="6671163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6671166">func</span>&nbsp;<span class="ident" id="6671171">TestHandshakeClientRSARC4</span><span class="op" id="6671196">(</span><span class="ident" id="6671197">t</span>&nbsp;<span class="op" id="6671199">*</span><span class="ident" id="6671200">testing</span><span class="op" id="6671207">.</span><span class="ident" id="6671208">T</span><span class="op" id="6671209">)</span>&nbsp;<span class="op" id="6671211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671214">test</span>&nbsp;<span class="op" id="6671219">:=</span>&nbsp;<span class="op" id="6671222">&amp;</span><span class="ident" id="6671223">clientTest</span><span class="op" id="6671233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671237">name</span><span class="op" id="6671241">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6671246">&#34;RSA-RC4&#34;</span><span class="op" id="6671255">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671259">command</span><span class="op" id="6671266">:</span>&nbsp;<span class="op" id="6671268">[</span><span class="op" id="6671269">]</span><span class="builtintype" id="6671270">string</span><span class="op" id="6671276">{</span><span class="string" id="6671277">&#34;openssl&#34;</span><span class="op" id="6671286">,</span>&nbsp;<span class="string" id="6671288">&#34;s_server&#34;</span><span class="op" id="6671298">,</span>&nbsp;<span class="string" id="6671300">&#34;-cipher&#34;</span><span class="op" id="6671309">,</span>&nbsp;<span class="string" id="6671311">&#34;RC4-SHA&#34;</span><span class="op" id="6671320">}</span><span class="op" id="6671321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6671324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671327">runClientTestTLS10</span><span class="op" id="6671345">(</span><span class="ident" id="6671346">t</span><span class="op" id="6671347">,</span>&nbsp;<span class="ident" id="6671349">test</span><span class="op" id="6671353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671356">runClientTestTLS11</span><span class="op" id="6671374">(</span><span class="ident" id="6671375">t</span><span class="op" id="6671376">,</span>&nbsp;<span class="ident" id="6671378">test</span><span class="op" id="6671382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671385">runClientTestTLS12</span><span class="op" id="6671403">(</span><span class="ident" id="6671404">t</span><span class="op" id="6671405">,</span>&nbsp;<span class="ident" id="6671407">test</span><span class="op" id="6671411">)</span><br>
<span class="lineno">280</span><span class="op" id="6671413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6671416">func</span>&nbsp;<span class="ident" id="6671421">TestHandshakeClientECDHERSAAES</span><span class="op" id="6671451">(</span><span class="ident" id="6671452">t</span>&nbsp;<span class="op" id="6671454">*</span><span class="ident" id="6671455">testing</span><span class="op" id="6671462">.</span><span class="ident" id="6671463">T</span><span class="op" id="6671464">)</span>&nbsp;<span class="op" id="6671466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671469">test</span>&nbsp;<span class="op" id="6671474">:=</span>&nbsp;<span class="op" id="6671477">&amp;</span><span class="ident" id="6671478">clientTest</span><span class="op" id="6671488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671492">name</span><span class="op" id="6671496">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6671501">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="6671516">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671520">command</span><span class="op" id="6671527">:</span>&nbsp;<span class="op" id="6671529">[</span><span class="op" id="6671530">]</span><span class="builtintype" id="6671531">string</span><span class="op" id="6671537">{</span><span class="string" id="6671538">&#34;openssl&#34;</span><span class="op" id="6671547">,</span>&nbsp;<span class="string" id="6671549">&#34;s_server&#34;</span><span class="op" id="6671559">,</span>&nbsp;<span class="string" id="6671561">&#34;-cipher&#34;</span><span class="op" id="6671570">,</span>&nbsp;<span class="string" id="6671572">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="6671594">}</span><span class="op" id="6671595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6671598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671601">runClientTestTLS10</span><span class="op" id="6671619">(</span><span class="ident" id="6671620">t</span><span class="op" id="6671621">,</span>&nbsp;<span class="ident" id="6671623">test</span><span class="op" id="6671627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671630">runClientTestTLS11</span><span class="op" id="6671648">(</span><span class="ident" id="6671649">t</span><span class="op" id="6671650">,</span>&nbsp;<span class="ident" id="6671652">test</span><span class="op" id="6671656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671659">runClientTestTLS12</span><span class="op" id="6671677">(</span><span class="ident" id="6671678">t</span><span class="op" id="6671679">,</span>&nbsp;<span class="ident" id="6671681">test</span><span class="op" id="6671685">)</span><br>
<span class="lineno">290</span><span class="op" id="6671687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6671690">func</span>&nbsp;<span class="ident" id="6671695">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="6671727">(</span><span class="ident" id="6671728">t</span>&nbsp;<span class="op" id="6671730">*</span><span class="ident" id="6671731">testing</span><span class="op" id="6671738">.</span><span class="ident" id="6671739">T</span><span class="op" id="6671740">)</span>&nbsp;<span class="op" id="6671742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671745">test</span>&nbsp;<span class="op" id="6671750">:=</span>&nbsp;<span class="op" id="6671753">&amp;</span><span class="ident" id="6671754">clientTest</span><span class="op" id="6671764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671768">name</span><span class="op" id="6671772">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6671777">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6671794">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671798">command</span><span class="op" id="6671805">:</span>&nbsp;<span class="op" id="6671807">[</span><span class="op" id="6671808">]</span><span class="builtintype" id="6671809">string</span><span class="op" id="6671815">{</span><span class="string" id="6671816">&#34;openssl&#34;</span><span class="op" id="6671825">,</span>&nbsp;<span class="string" id="6671827">&#34;s_server&#34;</span><span class="op" id="6671837">,</span>&nbsp;<span class="string" id="6671839">&#34;-cipher&#34;</span><span class="op" id="6671848">,</span>&nbsp;<span class="string" id="6671850">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6671874">}</span><span class="op" id="6671875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671879">cert</span><span class="op" id="6671883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6671888">testECDSACertificate</span><span class="op" id="6671908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671912">key</span><span class="op" id="6671915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6671921">testECDSAPrivateKey</span><span class="op" id="6671940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6671943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671946">runClientTestTLS10</span><span class="op" id="6671964">(</span><span class="ident" id="6671965">t</span><span class="op" id="6671966">,</span>&nbsp;<span class="ident" id="6671968">test</span><span class="op" id="6671972">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6671975">runClientTestTLS11</span><span class="op" id="6671993">(</span><span class="ident" id="6671994">t</span><span class="op" id="6671995">,</span>&nbsp;<span class="ident" id="6671997">test</span><span class="op" id="6672001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672004">runClientTestTLS12</span><span class="op" id="6672022">(</span><span class="ident" id="6672023">t</span><span class="op" id="6672024">,</span>&nbsp;<span class="ident" id="6672026">test</span><span class="op" id="6672030">)</span><br>
<span class="lineno"></span><span class="op" id="6672032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6672035">func</span>&nbsp;<span class="ident" id="6672040">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="6672075">(</span><span class="ident" id="6672076">t</span>&nbsp;<span class="op" id="6672078">*</span><span class="ident" id="6672079">testing</span><span class="op" id="6672086">.</span><span class="ident" id="6672087">T</span><span class="op" id="6672088">)</span>&nbsp;<span class="op" id="6672090">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672093">test</span>&nbsp;<span class="op" id="6672098">:=</span>&nbsp;<span class="op" id="6672101">&amp;</span><span class="ident" id="6672102">clientTest</span><span class="op" id="6672112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672116">name</span><span class="op" id="6672120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6672125">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="6672146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672150">command</span><span class="op" id="6672157">:</span>&nbsp;<span class="op" id="6672159">[</span><span class="op" id="6672160">]</span><span class="builtintype" id="6672161">string</span><span class="op" id="6672167">{</span><span class="string" id="6672168">&#34;openssl&#34;</span><span class="op" id="6672177">,</span>&nbsp;<span class="string" id="6672179">&#34;s_server&#34;</span><span class="op" id="6672189">,</span>&nbsp;<span class="string" id="6672191">&#34;-cipher&#34;</span><span class="op" id="6672200">,</span>&nbsp;<span class="string" id="6672202">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6672233">}</span><span class="op" id="6672234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672238">cert</span><span class="op" id="6672242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6672247">testECDSACertificate</span><span class="op" id="6672267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672271">key</span><span class="op" id="6672274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6672280">testECDSAPrivateKey</span><span class="op" id="6672299">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6672302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672305">runClientTestTLS12</span><span class="op" id="6672323">(</span><span class="ident" id="6672324">t</span><span class="op" id="6672325">,</span>&nbsp;<span class="ident" id="6672327">test</span><span class="op" id="6672331">)</span><br>
<span class="lineno"></span><span class="op" id="6672333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6672336">func</span>&nbsp;<span class="ident" id="6672341">TestHandshakeClientCertRSA</span><span class="op" id="6672367">(</span><span class="ident" id="6672368">t</span>&nbsp;<span class="op" id="6672370">*</span><span class="ident" id="6672371">testing</span><span class="op" id="6672378">.</span><span class="ident" id="6672379">T</span><span class="op" id="6672380">)</span>&nbsp;<span class="op" id="6672382">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672385">config</span>&nbsp;<span class="op" id="6672392">:=</span>&nbsp;<span class="op" id="6672395">*</span><span class="ident" id="6672396">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672408">cert</span><span class="op" id="6672412">,</span>&nbsp;<span class="ident" id="6672414">_</span>&nbsp;<span class="op" id="6672416">:=</span>&nbsp;<span class="ident" id="6672419">X509KeyPair</span><span class="op" id="6672430">(</span><span class="op" id="6672431">[</span><span class="op" id="6672432">]</span><span class="builtintype" id="6672433">byte</span><span class="op" id="6672437">(</span><span class="ident" id="6672438">clientCertificatePEM</span><span class="op" id="6672458">)</span><span class="op" id="6672459">,</span>&nbsp;<span class="op" id="6672461">[</span><span class="op" id="6672462">]</span><span class="builtintype" id="6672463">byte</span><span class="op" id="6672467">(</span><span class="ident" id="6672468">clientKeyPEM</span><span class="op" id="6672480">)</span><span class="op" id="6672481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672484">config</span><span class="op" id="6672490">.</span><span class="ident" id="6672491">Certificates</span>&nbsp;<span class="op" id="6672504">=</span>&nbsp;<span class="op" id="6672506">[</span><span class="op" id="6672507">]</span><span class="ident" id="6672508">Certificate</span><span class="op" id="6672519">{</span><span class="ident" id="6672520">cert</span><span class="op" id="6672524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672528">test</span>&nbsp;<span class="op" id="6672533">:=</span>&nbsp;<span class="op" id="6672536">&amp;</span><span class="ident" id="6672537">clientTest</span><span class="op" id="6672547">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672551">name</span><span class="op" id="6672555">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6672560">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="6672580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672584">command</span><span class="op" id="6672591">:</span>&nbsp;<span class="op" id="6672593">[</span><span class="op" id="6672594">]</span><span class="builtintype" id="6672595">string</span><span class="op" id="6672601">{</span><span class="string" id="6672602">&#34;openssl&#34;</span><span class="op" id="6672611">,</span>&nbsp;<span class="string" id="6672613">&#34;s_server&#34;</span><span class="op" id="6672623">,</span>&nbsp;<span class="string" id="6672625">&#34;-cipher&#34;</span><span class="op" id="6672634">,</span>&nbsp;<span class="string" id="6672636">&#34;RC4-SHA&#34;</span><span class="op" id="6672645">,</span>&nbsp;<span class="string" id="6672647">&#34;-verify&#34;</span><span class="op" id="6672656">,</span>&nbsp;<span class="string" id="6672658">&#34;1&#34;</span><span class="op" id="6672661">}</span><span class="op" id="6672662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672666">config</span><span class="op" id="6672672">:</span>&nbsp;&nbsp;<span class="op" id="6672675">&amp;</span><span class="ident" id="6672676">config</span><span class="op" id="6672682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6672685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672689">runClientTestTLS10</span><span class="op" id="6672707">(</span><span class="ident" id="6672708">t</span><span class="op" id="6672709">,</span>&nbsp;<span class="ident" id="6672711">test</span><span class="op" id="6672715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672718">runClientTestTLS12</span><span class="op" id="6672736">(</span><span class="ident" id="6672737">t</span><span class="op" id="6672738">,</span>&nbsp;<span class="ident" id="6672740">test</span><span class="op" id="6672744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672748">test</span>&nbsp;<span class="op" id="6672753">=</span>&nbsp;<span class="op" id="6672755">&amp;</span><span class="ident" id="6672756">clientTest</span><span class="op" id="6672766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672770">name</span><span class="op" id="6672774">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6672779">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="6672801">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672805">command</span><span class="op" id="6672812">:</span>&nbsp;<span class="op" id="6672814">[</span><span class="op" id="6672815">]</span><span class="builtintype" id="6672816">string</span><span class="op" id="6672822">{</span><span class="string" id="6672823">&#34;openssl&#34;</span><span class="op" id="6672832">,</span>&nbsp;<span class="string" id="6672834">&#34;s_server&#34;</span><span class="op" id="6672844">,</span>&nbsp;<span class="string" id="6672846">&#34;-cipher&#34;</span><span class="op" id="6672855">,</span>&nbsp;<span class="string" id="6672857">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6672881">,</span>&nbsp;<span class="string" id="6672883">&#34;-verify&#34;</span><span class="op" id="6672892">,</span>&nbsp;<span class="string" id="6672894">&#34;1&#34;</span><span class="op" id="6672897">}</span><span class="op" id="6672898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672902">config</span><span class="op" id="6672908">:</span>&nbsp;&nbsp;<span class="op" id="6672911">&amp;</span><span class="ident" id="6672912">config</span><span class="op" id="6672918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672922">cert</span><span class="op" id="6672926">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6672931">testECDSACertificate</span><span class="op" id="6672951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672955">key</span><span class="op" id="6672958">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6672964">testECDSAPrivateKey</span><span class="op" id="6672983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6672986">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6672990">runClientTestTLS10</span><span class="op" id="6673008">(</span><span class="ident" id="6673009">t</span><span class="op" id="6673010">,</span>&nbsp;<span class="ident" id="6673012">test</span><span class="op" id="6673016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673019">runClientTestTLS12</span><span class="op" id="6673037">(</span><span class="ident" id="6673038">t</span><span class="op" id="6673039">,</span>&nbsp;<span class="ident" id="6673041">test</span><span class="op" id="6673045">)</span><br>
<span class="lineno"></span><span class="op" id="6673047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6673050">func</span>&nbsp;<span class="ident" id="6673055">TestHandshakeClientCertECDSA</span><span class="op" id="6673083">(</span><span class="ident" id="6673084">t</span>&nbsp;<span class="op" id="6673086">*</span><span class="ident" id="6673087">testing</span><span class="op" id="6673094">.</span><span class="ident" id="6673095">T</span><span class="op" id="6673096">)</span>&nbsp;<span class="op" id="6673098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673101">config</span>&nbsp;<span class="op" id="6673108">:=</span>&nbsp;<span class="op" id="6673111">*</span><span class="ident" id="6673112">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673124">cert</span><span class="op" id="6673128">,</span>&nbsp;<span class="ident" id="6673130">_</span>&nbsp;<span class="op" id="6673132">:=</span>&nbsp;<span class="ident" id="6673135">X509KeyPair</span><span class="op" id="6673146">(</span><span class="op" id="6673147">[</span><span class="op" id="6673148">]</span><span class="builtintype" id="6673149">byte</span><span class="op" id="6673153">(</span><span class="ident" id="6673154">clientECDSACertificatePEM</span><span class="op" id="6673179">)</span><span class="op" id="6673180">,</span>&nbsp;<span class="op" id="6673182">[</span><span class="op" id="6673183">]</span><span class="builtintype" id="6673184">byte</span><span class="op" id="6673188">(</span><span class="ident" id="6673189">clientECDSAKeyPEM</span><span class="op" id="6673206">)</span><span class="op" id="6673207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673210">config</span><span class="op" id="6673216">.</span><span class="ident" id="6673217">Certificates</span>&nbsp;<span class="op" id="6673230">=</span>&nbsp;<span class="op" id="6673232">[</span><span class="op" id="6673233">]</span><span class="ident" id="6673234">Certificate</span><span class="op" id="6673245">{</span><span class="ident" id="6673246">cert</span><span class="op" id="6673250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673254">test</span>&nbsp;<span class="op" id="6673259">:=</span>&nbsp;<span class="op" id="6673262">&amp;</span><span class="ident" id="6673263">clientTest</span><span class="op" id="6673273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673277">name</span><span class="op" id="6673281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673286">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="6673308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673312">command</span><span class="op" id="6673319">:</span>&nbsp;<span class="op" id="6673321">[</span><span class="op" id="6673322">]</span><span class="builtintype" id="6673323">string</span><span class="op" id="6673329">{</span><span class="string" id="6673330">&#34;openssl&#34;</span><span class="op" id="6673339">,</span>&nbsp;<span class="string" id="6673341">&#34;s_server&#34;</span><span class="op" id="6673351">,</span>&nbsp;<span class="string" id="6673353">&#34;-cipher&#34;</span><span class="op" id="6673362">,</span>&nbsp;<span class="string" id="6673364">&#34;RC4-SHA&#34;</span><span class="op" id="6673373">,</span>&nbsp;<span class="string" id="6673375">&#34;-verify&#34;</span><span class="op" id="6673384">,</span>&nbsp;<span class="string" id="6673386">&#34;1&#34;</span><span class="op" id="6673389">}</span><span class="op" id="6673390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673394">config</span><span class="op" id="6673400">:</span>&nbsp;&nbsp;<span class="op" id="6673403">&amp;</span><span class="ident" id="6673404">config</span><span class="op" id="6673410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6673413">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673417">runClientTestTLS10</span><span class="op" id="6673435">(</span><span class="ident" id="6673436">t</span><span class="op" id="6673437">,</span>&nbsp;<span class="ident" id="6673439">test</span><span class="op" id="6673443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673446">runClientTestTLS12</span><span class="op" id="6673464">(</span><span class="ident" id="6673465">t</span><span class="op" id="6673466">,</span>&nbsp;<span class="ident" id="6673468">test</span><span class="op" id="6673472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673476">test</span>&nbsp;<span class="op" id="6673481">=</span>&nbsp;<span class="op" id="6673483">&amp;</span><span class="ident" id="6673484">clientTest</span><span class="op" id="6673494">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673498">name</span><span class="op" id="6673502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673507">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="6673531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673535">command</span><span class="op" id="6673542">:</span>&nbsp;<span class="op" id="6673544">[</span><span class="op" id="6673545">]</span><span class="builtintype" id="6673546">string</span><span class="op" id="6673552">{</span><span class="string" id="6673553">&#34;openssl&#34;</span><span class="op" id="6673562">,</span>&nbsp;<span class="string" id="6673564">&#34;s_server&#34;</span><span class="op" id="6673574">,</span>&nbsp;<span class="string" id="6673576">&#34;-cipher&#34;</span><span class="op" id="6673585">,</span>&nbsp;<span class="string" id="6673587">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6673611">,</span>&nbsp;<span class="string" id="6673613">&#34;-verify&#34;</span><span class="op" id="6673622">,</span>&nbsp;<span class="string" id="6673624">&#34;1&#34;</span><span class="op" id="6673627">}</span><span class="op" id="6673628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673632">config</span><span class="op" id="6673638">:</span>&nbsp;&nbsp;<span class="op" id="6673641">&amp;</span><span class="ident" id="6673642">config</span><span class="op" id="6673648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673652">cert</span><span class="op" id="6673656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673661">testECDSACertificate</span><span class="op" id="6673681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673685">key</span><span class="op" id="6673688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673694">testECDSAPrivateKey</span><span class="op" id="6673713">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6673716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673720">runClientTestTLS10</span><span class="op" id="6673738">(</span><span class="ident" id="6673739">t</span><span class="op" id="6673740">,</span>&nbsp;<span class="ident" id="6673742">test</span><span class="op" id="6673746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673749">runClientTestTLS12</span><span class="op" id="6673767">(</span><span class="ident" id="6673768">t</span><span class="op" id="6673769">,</span>&nbsp;<span class="ident" id="6673771">test</span><span class="op" id="6673775">)</span><br>
<span class="lineno"></span><span class="op" id="6673777">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6673780">func</span>&nbsp;<span class="ident" id="6673785">TestClientResumption</span><span class="op" id="6673805">(</span><span class="ident" id="6673806">t</span>&nbsp;<span class="op" id="6673808">*</span><span class="ident" id="6673809">testing</span><span class="op" id="6673816">.</span><span class="ident" id="6673817">T</span><span class="op" id="6673818">)</span>&nbsp;<span class="op" id="6673820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673823">serverConfig</span>&nbsp;<span class="op" id="6673836">:=</span>&nbsp;<span class="op" id="6673839">&amp;</span><span class="ident" id="6673840">Config</span><span class="op" id="6673846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673850">CipherSuites</span><span class="op" id="6673862">:</span>&nbsp;<span class="op" id="6673864">[</span><span class="op" id="6673865">]</span><span class="builtintype" id="6673866">uint16</span><span class="op" id="6673872">{</span><span class="ident" id="6673873">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6673897">,</span>&nbsp;<span class="ident" id="6673899">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6673929">}</span><span class="op" id="6673930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673934">Certificates</span><span class="op" id="6673946">:</span>&nbsp;<span class="ident" id="6673948">testConfig</span><span class="op" id="6673958">.</span><span class="ident" id="6673959">Certificates</span><span class="op" id="6673971">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6673974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6673977">clientConfig</span>&nbsp;<span class="op" id="6673990">:=</span>&nbsp;<span class="op" id="6673993">&amp;</span><span class="ident" id="6673994">Config</span><span class="op" id="6674000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674004">CipherSuites</span><span class="op" id="6674016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674024">[</span><span class="op" id="6674025">]</span><span class="builtintype" id="6674026">uint16</span><span class="op" id="6674032">{</span><span class="ident" id="6674033">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6674057">}</span><span class="op" id="6674058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674062">InsecureSkipVerify</span><span class="op" id="6674080">:</span>&nbsp;<span class="builtintype" id="6674082">true</span><span class="op" id="6674086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674090">ClientSessionCache</span><span class="op" id="6674108">:</span>&nbsp;<span class="ident" id="6674110">NewLRUClientSessionCache</span><span class="op" id="6674134">(</span><span class="num" id="6674135">32</span><span class="op" id="6674137">)</span><span class="op" id="6674138">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674145">testResumeState</span>&nbsp;<span class="op" id="6674161">:=</span>&nbsp;<span class="keyword" id="6674164">func</span><span class="op" id="6674168">(</span><span class="ident" id="6674169">test</span>&nbsp;<span class="builtintype" id="6674174">string</span><span class="op" id="6674180">,</span>&nbsp;<span class="ident" id="6674182">didResume</span>&nbsp;<span class="builtintype" id="6674192">bool</span><span class="op" id="6674196">)</span>&nbsp;<span class="op" id="6674198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674202">hs</span><span class="op" id="6674204">,</span>&nbsp;<span class="ident" id="6674206">err</span>&nbsp;<span class="op" id="6674210">:=</span>&nbsp;<span class="ident" id="6674213">testHandshake</span><span class="op" id="6674226">(</span><span class="ident" id="6674227">clientConfig</span><span class="op" id="6674239">,</span>&nbsp;<span class="ident" id="6674241">serverConfig</span><span class="op" id="6674253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674257">if</span>&nbsp;<span class="ident" id="6674260">err</span>&nbsp;<span class="op" id="6674264">!=</span>&nbsp;<span class="ident" id="6674267">nil</span>&nbsp;<span class="op" id="6674271">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674276">t</span><span class="op" id="6674277">.</span><span class="ident" id="6674278">Fatalf</span><span class="op" id="6674284">(</span><span class="string" id="6674285">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6674311">,</span>&nbsp;<span class="ident" id="6674313">test</span><span class="op" id="6674317">,</span>&nbsp;<span class="ident" id="6674319">err</span><span class="op" id="6674322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674330">if</span>&nbsp;<span class="ident" id="6674333">hs</span><span class="op" id="6674335">.</span><span class="ident" id="6674336">DidResume</span>&nbsp;<span class="op" id="6674346">!=</span>&nbsp;<span class="ident" id="6674349">didResume</span>&nbsp;<span class="op" id="6674359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674364">t</span><span class="op" id="6674365">.</span><span class="ident" id="6674366">Fatalf</span><span class="op" id="6674372">(</span><span class="string" id="6674373">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="6674403">,</span>&nbsp;<span class="ident" id="6674405">test</span><span class="op" id="6674409">,</span>&nbsp;<span class="ident" id="6674411">hs</span><span class="op" id="6674413">.</span><span class="ident" id="6674414">DidResume</span><span class="op" id="6674423">,</span>&nbsp;<span class="ident" id="6674425">didResume</span><span class="op" id="6674434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674438">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674445">testResumeState</span><span class="op" id="6674460">(</span><span class="string" id="6674461">&#34;Handshake&#34;</span><span class="op" id="6674472">,</span>&nbsp;<span class="builtintype" id="6674474">false</span><span class="op" id="6674479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674482">testResumeState</span><span class="op" id="6674497">(</span><span class="string" id="6674498">&#34;Resume&#34;</span><span class="op" id="6674506">,</span>&nbsp;<span class="builtintype" id="6674508">true</span><span class="op" id="6674512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674516">if</span>&nbsp;<span class="ident" id="6674519">_</span><span class="op" id="6674520">,</span>&nbsp;<span class="ident" id="6674522">err</span>&nbsp;<span class="op" id="6674526">:=</span>&nbsp;<span class="ident" id="6674529">io</span><span class="op" id="6674531">.</span><span class="ident" id="6674532">ReadFull</span><span class="op" id="6674540">(</span><span class="ident" id="6674541">serverConfig</span><span class="op" id="6674553">.</span><span class="ident" id="6674554">rand</span><span class="op" id="6674558">(</span><span class="op" id="6674559">)</span><span class="op" id="6674560">,</span>&nbsp;<span class="ident" id="6674562">serverConfig</span><span class="op" id="6674574">.</span><span class="ident" id="6674575">SessionTicketKey</span><span class="op" id="6674591">[</span><span class="op" id="6674592">:</span><span class="op" id="6674593">]</span><span class="op" id="6674594">)</span><span class="op" id="6674595">;</span>&nbsp;<span class="ident" id="6674597">err</span>&nbsp;<span class="op" id="6674601">!=</span>&nbsp;<span class="ident" id="6674604">nil</span>&nbsp;<span class="op" id="6674608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674612">t</span><span class="op" id="6674613">.</span><span class="ident" id="6674614">Fatalf</span><span class="op" id="6674620">(</span><span class="string" id="6674621">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="6674660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674666">testResumeState</span><span class="op" id="6674681">(</span><span class="string" id="6674682">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="6674707">,</span>&nbsp;<span class="builtintype" id="6674709">false</span><span class="op" id="6674714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674717">testResumeState</span><span class="op" id="6674732">(</span><span class="string" id="6674733">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="6674769">,</span>&nbsp;<span class="builtintype" id="6674771">true</span><span class="op" id="6674775">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674779">clientConfig</span><span class="op" id="6674791">.</span><span class="ident" id="6674792">CipherSuites</span>&nbsp;<span class="op" id="6674805">=</span>&nbsp;<span class="op" id="6674807">[</span><span class="op" id="6674808">]</span><span class="builtintype" id="6674809">uint16</span><span class="op" id="6674815">{</span><span class="ident" id="6674816">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6674846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674849">testResumeState</span><span class="op" id="6674864">(</span><span class="string" id="6674865">&#34;DifferentCipherSuite&#34;</span><span class="op" id="6674887">,</span>&nbsp;<span class="builtintype" id="6674889">false</span><span class="op" id="6674894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674897">testResumeState</span><span class="op" id="6674912">(</span><span class="string" id="6674913">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="6674943">,</span>&nbsp;<span class="builtintype" id="6674945">true</span><span class="op" id="6674949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674953">clientConfig</span><span class="op" id="6674965">.</span><span class="ident" id="6674966">ClientSessionCache</span>&nbsp;<span class="op" id="6674985">=</span>&nbsp;<span class="ident" id="6674987">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674992">testResumeState</span><span class="op" id="6675007">(</span><span class="string" id="6675008">&#34;WithoutSessionCache&#34;</span><span class="op" id="6675029">,</span>&nbsp;<span class="builtintype" id="6675031">false</span><span class="op" id="6675036">)</span><br>
<span class="lineno"></span><span class="op" id="6675038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6675041">func</span>&nbsp;<span class="ident" id="6675046">TestLRUClientSessionCache</span><span class="op" id="6675071">(</span><span class="ident" id="6675072">t</span>&nbsp;<span class="op" id="6675074">*</span><span class="ident" id="6675075">testing</span><span class="op" id="6675082">.</span><span class="ident" id="6675083">T</span><span class="op" id="6675084">)</span>&nbsp;<span class="op" id="6675086">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675089">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675125">cache</span>&nbsp;<span class="op" id="6675131">:=</span>&nbsp;<span class="ident" id="6675134">NewLRUClientSessionCache</span><span class="op" id="6675158">(</span><span class="num" id="6675159">4</span><span class="op" id="6675160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675163">cs</span>&nbsp;<span class="op" id="6675166">:=</span>&nbsp;<span class="builtinfunc" id="6675169">make</span><span class="op" id="6675173">(</span><span class="op" id="6675174">[</span><span class="op" id="6675175">]</span><span class="ident" id="6675176">ClientSessionState</span><span class="op" id="6675194">,</span>&nbsp;<span class="num" id="6675196">6</span><span class="op" id="6675197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675200">keys</span>&nbsp;<span class="op" id="6675205">:=</span>&nbsp;<span class="op" id="6675208">[</span><span class="op" id="6675209">]</span><span class="builtintype" id="6675210">string</span><span class="op" id="6675216">{</span><span class="string" id="6675217">&#34;0&#34;</span><span class="op" id="6675220">,</span>&nbsp;<span class="string" id="6675222">&#34;1&#34;</span><span class="op" id="6675225">,</span>&nbsp;<span class="string" id="6675227">&#34;2&#34;</span><span class="op" id="6675230">,</span>&nbsp;<span class="string" id="6675232">&#34;3&#34;</span><span class="op" id="6675235">,</span>&nbsp;<span class="string" id="6675237">&#34;4&#34;</span><span class="op" id="6675240">,</span>&nbsp;<span class="string" id="6675242">&#34;5&#34;</span><span class="op" id="6675245">,</span>&nbsp;<span class="string" id="6675247">&#34;6&#34;</span><span class="op" id="6675250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675254">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675303">for</span>&nbsp;<span class="ident" id="6675307">i</span>&nbsp;<span class="op" id="6675309">:=</span>&nbsp;<span class="num" id="6675312">0</span><span class="op" id="6675313">;</span>&nbsp;<span class="ident" id="6675315">i</span>&nbsp;<span class="op" id="6675317">&lt;</span>&nbsp;<span class="num" id="6675319">4</span><span class="op" id="6675320">;</span>&nbsp;<span class="ident" id="6675322">i</span><span class="op" id="6675323">++</span>&nbsp;<span class="op" id="6675326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675330">cache</span><span class="op" id="6675335">.</span><span class="ident" id="6675336">Put</span><span class="op" id="6675339">(</span><span class="ident" id="6675340">keys</span><span class="op" id="6675344">[</span><span class="ident" id="6675345">i</span><span class="op" id="6675346">]</span><span class="op" id="6675347">,</span>&nbsp;<span class="op" id="6675349">&amp;</span><span class="ident" id="6675350">cs</span><span class="op" id="6675352">[</span><span class="ident" id="6675353">i</span><span class="op" id="6675354">]</span><span class="op" id="6675355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675361">for</span>&nbsp;<span class="ident" id="6675365">i</span>&nbsp;<span class="op" id="6675367">:=</span>&nbsp;<span class="num" id="6675370">0</span><span class="op" id="6675371">;</span>&nbsp;<span class="ident" id="6675373">i</span>&nbsp;<span class="op" id="6675375">&lt;</span>&nbsp;<span class="num" id="6675377">4</span><span class="op" id="6675378">;</span>&nbsp;<span class="ident" id="6675380">i</span><span class="op" id="6675381">++</span>&nbsp;<span class="op" id="6675384">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675388">if</span>&nbsp;<span class="ident" id="6675391">s</span><span class="op" id="6675392">,</span>&nbsp;<span class="ident" id="6675394">ok</span>&nbsp;<span class="op" id="6675397">:=</span>&nbsp;<span class="ident" id="6675400">cache</span><span class="op" id="6675405">.</span><span class="ident" id="6675406">Get</span><span class="op" id="6675409">(</span><span class="ident" id="6675410">keys</span><span class="op" id="6675414">[</span><span class="ident" id="6675415">i</span><span class="op" id="6675416">]</span><span class="op" id="6675417">)</span><span class="op" id="6675418">;</span>&nbsp;<span class="op" id="6675420">!</span><span class="ident" id="6675421">ok</span>&nbsp;<span class="op" id="6675424">||</span>&nbsp;<span class="ident" id="6675427">s</span>&nbsp;<span class="op" id="6675429">!=</span>&nbsp;<span class="op" id="6675432">&amp;</span><span class="ident" id="6675433">cs</span><span class="op" id="6675435">[</span><span class="ident" id="6675436">i</span><span class="op" id="6675437">]</span>&nbsp;<span class="op" id="6675439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675444">t</span><span class="op" id="6675445">.</span><span class="ident" id="6675446">Fatalf</span><span class="op" id="6675452">(</span><span class="string" id="6675453">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6675500">,</span>&nbsp;<span class="ident" id="6675502">keys</span><span class="op" id="6675506">[</span><span class="ident" id="6675507">i</span><span class="op" id="6675508">]</span><span class="op" id="6675509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675520">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675584">for</span>&nbsp;<span class="ident" id="6675588">i</span>&nbsp;<span class="op" id="6675590">:=</span>&nbsp;<span class="num" id="6675593">4</span><span class="op" id="6675594">;</span>&nbsp;<span class="ident" id="6675596">i</span>&nbsp;<span class="op" id="6675598">&lt;</span>&nbsp;<span class="num" id="6675600">6</span><span class="op" id="6675601">;</span>&nbsp;<span class="ident" id="6675603">i</span><span class="op" id="6675604">++</span>&nbsp;<span class="op" id="6675607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675611">cache</span><span class="op" id="6675616">.</span><span class="ident" id="6675617">Put</span><span class="op" id="6675620">(</span><span class="ident" id="6675621">keys</span><span class="op" id="6675625">[</span><span class="ident" id="6675626">i</span><span class="op" id="6675627">]</span><span class="op" id="6675628">,</span>&nbsp;<span class="op" id="6675630">&amp;</span><span class="ident" id="6675631">cs</span><span class="op" id="6675633">[</span><span class="ident" id="6675634">i</span><span class="op" id="6675635">]</span><span class="op" id="6675636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675642">for</span>&nbsp;<span class="ident" id="6675646">i</span>&nbsp;<span class="op" id="6675648">:=</span>&nbsp;<span class="num" id="6675651">0</span><span class="op" id="6675652">;</span>&nbsp;<span class="ident" id="6675654">i</span>&nbsp;<span class="op" id="6675656">&lt;</span>&nbsp;<span class="num" id="6675658">2</span><span class="op" id="6675659">;</span>&nbsp;<span class="ident" id="6675661">i</span><span class="op" id="6675662">++</span>&nbsp;<span class="op" id="6675665">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675669">if</span>&nbsp;<span class="ident" id="6675672">s</span><span class="op" id="6675673">,</span>&nbsp;<span class="ident" id="6675675">ok</span>&nbsp;<span class="op" id="6675678">:=</span>&nbsp;<span class="ident" id="6675681">cache</span><span class="op" id="6675686">.</span><span class="ident" id="6675687">Get</span><span class="op" id="6675690">(</span><span class="ident" id="6675691">keys</span><span class="op" id="6675695">[</span><span class="ident" id="6675696">i</span><span class="op" id="6675697">]</span><span class="op" id="6675698">)</span><span class="op" id="6675699">;</span>&nbsp;<span class="ident" id="6675701">ok</span>&nbsp;<span class="op" id="6675704">||</span>&nbsp;<span class="ident" id="6675707">s</span>&nbsp;<span class="op" id="6675709">!=</span>&nbsp;<span class="ident" id="6675712">nil</span>&nbsp;<span class="op" id="6675716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675721">t</span><span class="op" id="6675722">.</span><span class="ident" id="6675723">Fatalf</span><span class="op" id="6675729">(</span><span class="string" id="6675730">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6675773">,</span>&nbsp;<span class="ident" id="6675775">keys</span><span class="op" id="6675779">[</span><span class="ident" id="6675780">i</span><span class="op" id="6675781">]</span><span class="op" id="6675782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675793">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675837">cache</span><span class="op" id="6675842">.</span><span class="ident" id="6675843">Get</span><span class="op" id="6675846">(</span><span class="ident" id="6675847">keys</span><span class="op" id="6675851">[</span><span class="num" id="6675852">2</span><span class="op" id="6675853">]</span><span class="op" id="6675854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675857">cache</span><span class="op" id="6675862">.</span><span class="ident" id="6675863">Put</span><span class="op" id="6675866">(</span><span class="ident" id="6675867">keys</span><span class="op" id="6675871">[</span><span class="num" id="6675872">0</span><span class="op" id="6675873">]</span><span class="op" id="6675874">,</span>&nbsp;<span class="op" id="6675876">&amp;</span><span class="ident" id="6675877">cs</span><span class="op" id="6675879">[</span><span class="num" id="6675880">0</span><span class="op" id="6675881">]</span><span class="op" id="6675882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675885">if</span>&nbsp;<span class="ident" id="6675888">s</span><span class="op" id="6675889">,</span>&nbsp;<span class="ident" id="6675891">ok</span>&nbsp;<span class="op" id="6675894">:=</span>&nbsp;<span class="ident" id="6675897">cache</span><span class="op" id="6675902">.</span><span class="ident" id="6675903">Get</span><span class="op" id="6675906">(</span><span class="ident" id="6675907">keys</span><span class="op" id="6675911">[</span><span class="num" id="6675912">3</span><span class="op" id="6675913">]</span><span class="op" id="6675914">)</span><span class="op" id="6675915">;</span>&nbsp;<span class="ident" id="6675917">ok</span>&nbsp;<span class="op" id="6675920">||</span>&nbsp;<span class="ident" id="6675923">s</span>&nbsp;<span class="op" id="6675925">!=</span>&nbsp;<span class="ident" id="6675928">nil</span>&nbsp;<span class="op" id="6675932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675936">t</span><span class="op" id="6675937">.</span><span class="ident" id="6675938">Fatalf</span><span class="op" id="6675944">(</span><span class="string" id="6675945">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="6675986">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675993">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676022">cache</span><span class="op" id="6676027">.</span><span class="ident" id="6676028">Put</span><span class="op" id="6676031">(</span><span class="ident" id="6676032">keys</span><span class="op" id="6676036">[</span><span class="num" id="6676037">0</span><span class="op" id="6676038">]</span><span class="op" id="6676039">,</span>&nbsp;<span class="op" id="6676041">&amp;</span><span class="ident" id="6676042">cs</span><span class="op" id="6676044">[</span><span class="num" id="6676045">3</span><span class="op" id="6676046">]</span><span class="op" id="6676047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676050">if</span>&nbsp;<span class="ident" id="6676053">s</span><span class="op" id="6676054">,</span>&nbsp;<span class="ident" id="6676056">ok</span>&nbsp;<span class="op" id="6676059">:=</span>&nbsp;<span class="ident" id="6676062">cache</span><span class="op" id="6676067">.</span><span class="ident" id="6676068">Get</span><span class="op" id="6676071">(</span><span class="ident" id="6676072">keys</span><span class="op" id="6676076">[</span><span class="num" id="6676077">0</span><span class="op" id="6676078">]</span><span class="op" id="6676079">)</span><span class="op" id="6676080">;</span>&nbsp;<span class="op" id="6676082">!</span><span class="ident" id="6676083">ok</span>&nbsp;<span class="op" id="6676086">||</span>&nbsp;<span class="ident" id="6676089">s</span>&nbsp;<span class="op" id="6676091">!=</span>&nbsp;<span class="op" id="6676094">&amp;</span><span class="ident" id="6676095">cs</span><span class="op" id="6676097">[</span><span class="num" id="6676098">3</span><span class="op" id="6676099">]</span>&nbsp;<span class="op" id="6676101">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676105">t</span><span class="op" id="6676106">.</span><span class="ident" id="6676107">Fatalf</span><span class="op" id="6676113">(</span><span class="string" id="6676114">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="6676153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6676160">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676193">cache</span><span class="op" id="6676198">.</span><span class="ident" id="6676199">Put</span><span class="op" id="6676202">(</span><span class="ident" id="6676203">keys</span><span class="op" id="6676207">[</span><span class="num" id="6676208">0</span><span class="op" id="6676209">]</span><span class="op" id="6676210">,</span>&nbsp;<span class="ident" id="6676212">nil</span><span class="op" id="6676215">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676218">if</span>&nbsp;<span class="ident" id="6676221">s</span><span class="op" id="6676222">,</span>&nbsp;<span class="ident" id="6676224">ok</span>&nbsp;<span class="op" id="6676227">:=</span>&nbsp;<span class="ident" id="6676230">cache</span><span class="op" id="6676235">.</span><span class="ident" id="6676236">Get</span><span class="op" id="6676239">(</span><span class="ident" id="6676240">keys</span><span class="op" id="6676244">[</span><span class="num" id="6676245">0</span><span class="op" id="6676246">]</span><span class="op" id="6676247">)</span><span class="op" id="6676248">;</span>&nbsp;<span class="op" id="6676250">!</span><span class="ident" id="6676251">ok</span>&nbsp;<span class="op" id="6676254">||</span>&nbsp;<span class="ident" id="6676257">s</span>&nbsp;<span class="op" id="6676259">!=</span>&nbsp;<span class="ident" id="6676262">nil</span>&nbsp;<span class="op" id="6676266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676270">t</span><span class="op" id="6676271">.</span><span class="ident" id="6676272">Fatalf</span><span class="op" id="6676278">(</span><span class="string" id="6676279">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="6676313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676316">}</span><br>
<span class="lineno"></span><span class="op" id="6676318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="6676321">func</span>&nbsp;<span class="ident" id="6676326">TestHandshakeClientALPNMatch</span><span class="op" id="6676354">(</span><span class="ident" id="6676355">t</span>&nbsp;<span class="op" id="6676357">*</span><span class="ident" id="6676358">testing</span><span class="op" id="6676365">.</span><span class="ident" id="6676366">T</span><span class="op" id="6676367">)</span>&nbsp;<span class="op" id="6676369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676372">config</span>&nbsp;<span class="op" id="6676379">:=</span>&nbsp;<span class="op" id="6676382">*</span><span class="ident" id="6676383">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676395">config</span><span class="op" id="6676401">.</span><span class="ident" id="6676402">NextProtos</span>&nbsp;<span class="op" id="6676413">=</span>&nbsp;<span class="op" id="6676415">[</span><span class="op" id="6676416">]</span><span class="builtintype" id="6676417">string</span><span class="op" id="6676423">{</span><span class="string" id="6676424">&#34;proto2&#34;</span><span class="op" id="6676432">,</span>&nbsp;<span class="string" id="6676434">&#34;proto1&#34;</span><span class="op" id="6676442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676446">test</span>&nbsp;<span class="op" id="6676451">:=</span>&nbsp;<span class="op" id="6676454">&amp;</span><span class="ident" id="6676455">clientTest</span><span class="op" id="6676465">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676469">name</span><span class="op" id="6676473">:</span>&nbsp;<span class="string" id="6676475">&#34;ALPN&#34;</span><span class="op" id="6676481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6676485">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6676551">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676594">command</span><span class="op" id="6676601">:</span>&nbsp;<span class="op" id="6676603">[</span><span class="op" id="6676604">]</span><span class="builtintype" id="6676605">string</span><span class="op" id="6676611">{</span><span class="string" id="6676612">&#34;openssl&#34;</span><span class="op" id="6676621">,</span>&nbsp;<span class="string" id="6676623">&#34;s_server&#34;</span><span class="op" id="6676633">,</span>&nbsp;<span class="string" id="6676635">&#34;-alpn&#34;</span><span class="op" id="6676642">,</span>&nbsp;<span class="string" id="6676644">&#34;proto1,proto2&#34;</span><span class="op" id="6676659">}</span><span class="op" id="6676660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676664">config</span><span class="op" id="6676670">:</span>&nbsp;&nbsp;<span class="op" id="6676673">&amp;</span><span class="ident" id="6676674">config</span><span class="op" id="6676680">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676684">validate</span><span class="op" id="6676692">:</span>&nbsp;<span class="keyword" id="6676694">func</span><span class="op" id="6676698">(</span><span class="ident" id="6676699">state</span>&nbsp;<span class="ident" id="6676705">ConnectionState</span><span class="op" id="6676720">)</span>&nbsp;<span class="builtintype" id="6676722">error</span>&nbsp;<span class="op" id="6676728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6676733">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676792">if</span>&nbsp;<span class="ident" id="6676795">state</span><span class="op" id="6676800">.</span><span class="ident" id="6676801">NegotiatedProtocol</span>&nbsp;<span class="op" id="6676820">!=</span>&nbsp;<span class="string" id="6676823">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6676832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676838">return</span>&nbsp;<span class="ident" id="6676845">fmt</span><span class="op" id="6676848">.</span><span class="ident" id="6676849">Errorf</span><span class="op" id="6676855">(</span><span class="string" id="6676856">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6676888">,</span>&nbsp;<span class="ident" id="6676890">state</span><span class="op" id="6676895">.</span><span class="ident" id="6676896">NegotiatedProtocol</span><span class="op" id="6676914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676919">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676924">return</span>&nbsp;<span class="ident" id="6676931">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676937">}</span><span class="op" id="6676938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676944">runClientTestTLS12</span><span class="op" id="6676962">(</span><span class="ident" id="6676963">t</span><span class="op" id="6676964">,</span>&nbsp;<span class="ident" id="6676966">test</span><span class="op" id="6676970">)</span><br>
<span class="lineno"></span><span class="op" id="6676972">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="6676975">func</span>&nbsp;<span class="ident" id="6676980">TestHandshakeClientALPNNoMatch</span><span class="op" id="6677010">(</span><span class="ident" id="6677011">t</span>&nbsp;<span class="op" id="6677013">*</span><span class="ident" id="6677014">testing</span><span class="op" id="6677021">.</span><span class="ident" id="6677022">T</span><span class="op" id="6677023">)</span>&nbsp;<span class="op" id="6677025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677028">config</span>&nbsp;<span class="op" id="6677035">:=</span>&nbsp;<span class="op" id="6677038">*</span><span class="ident" id="6677039">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677051">config</span><span class="op" id="6677057">.</span><span class="ident" id="6677058">NextProtos</span>&nbsp;<span class="op" id="6677069">=</span>&nbsp;<span class="op" id="6677071">[</span><span class="op" id="6677072">]</span><span class="builtintype" id="6677073">string</span><span class="op" id="6677079">{</span><span class="string" id="6677080">&#34;proto3&#34;</span><span class="op" id="6677088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677092">test</span>&nbsp;<span class="op" id="6677097">:=</span>&nbsp;<span class="op" id="6677100">&amp;</span><span class="ident" id="6677101">clientTest</span><span class="op" id="6677111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677115">name</span><span class="op" id="6677119">:</span>&nbsp;<span class="string" id="6677121">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6677135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6677139">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6677205">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677248">command</span><span class="op" id="6677255">:</span>&nbsp;<span class="op" id="6677257">[</span><span class="op" id="6677258">]</span><span class="builtintype" id="6677259">string</span><span class="op" id="6677265">{</span><span class="string" id="6677266">&#34;openssl&#34;</span><span class="op" id="6677275">,</span>&nbsp;<span class="string" id="6677277">&#34;s_server&#34;</span><span class="op" id="6677287">,</span>&nbsp;<span class="string" id="6677289">&#34;-alpn&#34;</span><span class="op" id="6677296">,</span>&nbsp;<span class="string" id="6677298">&#34;proto1,proto2&#34;</span><span class="op" id="6677313">}</span><span class="op" id="6677314">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677318">config</span><span class="op" id="6677324">:</span>&nbsp;&nbsp;<span class="op" id="6677327">&amp;</span><span class="ident" id="6677328">config</span><span class="op" id="6677334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677338">validate</span><span class="op" id="6677346">:</span>&nbsp;<span class="keyword" id="6677348">func</span><span class="op" id="6677352">(</span><span class="ident" id="6677353">state</span>&nbsp;<span class="ident" id="6677359">ConnectionState</span><span class="op" id="6677374">)</span>&nbsp;<span class="builtintype" id="6677376">error</span>&nbsp;<span class="op" id="6677382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6677387">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677451">if</span>&nbsp;<span class="ident" id="6677454">state</span><span class="op" id="6677459">.</span><span class="ident" id="6677460">NegotiatedProtocol</span>&nbsp;<span class="op" id="6677479">!=</span>&nbsp;<span class="string" id="6677482">&#34;&#34;</span>&nbsp;<span class="op" id="6677485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677491">return</span>&nbsp;<span class="ident" id="6677498">fmt</span><span class="op" id="6677501">.</span><span class="ident" id="6677502">Errorf</span><span class="op" id="6677508">(</span><span class="string" id="6677509">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6677537">,</span>&nbsp;<span class="ident" id="6677539">state</span><span class="op" id="6677544">.</span><span class="ident" id="6677545">NegotiatedProtocol</span><span class="op" id="6677563">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677573">return</span>&nbsp;<span class="ident" id="6677580">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677586">}</span><span class="op" id="6677587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677593">runClientTestTLS12</span><span class="op" id="6677611">(</span><span class="ident" id="6677612">t</span><span class="op" id="6677613">,</span>&nbsp;<span class="ident" id="6677615">test</span><span class="op" id="6677619">)</span><br>
<span class="lineno">490</span><span class="op" id="6677621">}</span>
</div>
</body>
</html>
