<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5748100">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5748155">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5748209">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5748260">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5748313">package</span>&nbsp;<span class="ident" id="5748321">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748330">import</span>&nbsp;<span class="op" id="5748337">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748340">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748347">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748357">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748369">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748375">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748381">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748392">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748403">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5748421">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5748431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5748434">const</span>&nbsp;<span class="op" id="5748440">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748443">maxNewlines</span>&nbsp;<span class="op" id="5748455">=</span>&nbsp;<span class="num" id="5748457">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748463">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748511">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748523">=</span>&nbsp;<span class="ident" id="5748525">false</span>&nbsp;<span class="comment" id="5748531">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748556">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748568">=</span>&nbsp;<span class="num" id="5748570">1</span>&nbsp;<span class="op" id="5748572">&lt;&lt;</span>&nbsp;<span class="num" id="5748575">30</span><br>
<span class="lineno"></span><span class="op" id="5748578">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5748581">type</span>&nbsp;<span class="ident" id="5748586">whiteSpace</span>&nbsp;<span class="builtintype" id="5748597">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748603">const</span>&nbsp;<span class="op" id="5748609">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748612">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5748621">=</span>&nbsp;<span class="ident" id="5748623">whiteSpace</span><span class="op" id="5748633">(</span><span class="num" id="5748634">0</span><span class="op" id="5748635">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748638">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748647">=</span>&nbsp;<span class="ident" id="5748649">whiteSpace</span><span class="op" id="5748659">(</span><span class="string" id="5748660">&#39;&nbsp;&#39;</span><span class="op" id="5748663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748666">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748675">=</span>&nbsp;<span class="ident" id="5748677">whiteSpace</span><span class="op" id="5748687">(</span><span class="string" id="5748688">&#39;\v&#39;</span><span class="op" id="5748692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748695">newline</span>&nbsp;&nbsp;<span class="op" id="5748704">=</span>&nbsp;<span class="ident" id="5748706">whiteSpace</span><span class="op" id="5748716">(</span><span class="string" id="5748717">&#39;\n&#39;</span><span class="op" id="5748721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748724">formfeed</span>&nbsp;<span class="op" id="5748733">=</span>&nbsp;<span class="ident" id="5748735">whiteSpace</span><span class="op" id="5748745">(</span><span class="string" id="5748746">&#39;\f&#39;</span><span class="op" id="5748750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748753">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5748762">=</span>&nbsp;<span class="ident" id="5748764">whiteSpace</span><span class="op" id="5748774">(</span><span class="string" id="5748775">&#39;&gt;&#39;</span><span class="op" id="5748778">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748781">unindent</span>&nbsp;<span class="op" id="5748790">=</span>&nbsp;<span class="ident" id="5748792">whiteSpace</span><span class="op" id="5748802">(</span><span class="string" id="5748803">&#39;&lt;&#39;</span><span class="op" id="5748806">)</span><br>
<span class="lineno"></span><span class="op" id="5748808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5748811">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5748865">type</span>&nbsp;<span class="ident" id="5748870">pmode</span>&nbsp;<span class="builtintype" id="5748876">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5748881">const</span>&nbsp;<span class="op" id="5748887">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748890">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748907">pmode</span>&nbsp;<span class="op" id="5748913">=</span>&nbsp;<span class="num" id="5748915">1</span>&nbsp;<span class="op" id="5748917">&lt;&lt;</span>&nbsp;<span class="ident" id="5748920">iota</span>&nbsp;<span class="comment" id="5748925">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748973">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749008">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5749060">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5749063">type</span>&nbsp;<span class="ident" id="5749068">commentInfo</span>&nbsp;<span class="keyword" id="5749080">struct</span>&nbsp;<span class="op" id="5749087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749090">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5749105">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749123">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749149">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749164">*</span><span class="ident" id="5749165">ast</span><span class="op" id="5749168">.</span><span class="ident" id="5749169">CommentGroup</span>&nbsp;<span class="comment" id="5749182">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749221">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5749236">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749254">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749335">commentNewline</span>&nbsp;<span class="builtintype" id="5749350">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749368">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5749415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749418">type</span>&nbsp;<span class="ident" id="5749423">printer</span>&nbsp;<span class="keyword" id="5749431">struct</span>&nbsp;<span class="op" id="5749438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749441">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749498">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749506">fset</span>&nbsp;<span class="op" id="5749511">*</span><span class="ident" id="5749512">token</span><span class="op" id="5749517">.</span><span class="ident" id="5749518">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749528">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749546">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749558">[</span><span class="op" id="5749559">]</span><span class="builtintype" id="5749560">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749571">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749594">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5749606">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749619">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749643">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5749655">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749668">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749693">impliedSemi</span>&nbsp;<span class="builtintype" id="5749705">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749718">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749762">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5749774">token</span><span class="op" id="5749779">.</span><span class="ident" id="5749780">Token</span>&nbsp;&nbsp;<span class="comment" id="5749787">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749845">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5749857">token</span><span class="op" id="5749862">.</span><span class="ident" id="5749863">Token</span>&nbsp;&nbsp;<span class="comment" id="5749870">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749929">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749941">[</span><span class="op" id="5749942">]</span><span class="ident" id="5749943">whiteSpace</span>&nbsp;<span class="comment" id="5749954">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749979">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749993">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750060">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750128">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750194">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750260">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750304">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750312">token</span><span class="op" id="5750317">.</span><span class="ident" id="5750318">Position</span>&nbsp;<span class="comment" id="5750327">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750370">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750378">token</span><span class="op" id="5750383">.</span><span class="ident" id="5750384">Position</span>&nbsp;<span class="comment" id="5750393">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750430">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750438">token</span><span class="op" id="5750443">.</span><span class="ident" id="5750444">Position</span>&nbsp;<span class="comment" id="5750453">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750496">linePtr</span>&nbsp;<span class="op" id="5750504">*</span><span class="builtintype" id="5750505">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5750519">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750579">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750640">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5750656">[</span><span class="op" id="5750657">]</span><span class="op" id="5750658">*</span><span class="ident" id="5750659">ast</span><span class="op" id="5750662">.</span><span class="ident" id="5750663">CommentGroup</span>&nbsp;<span class="comment" id="5750676">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750691">useNodeComments</span>&nbsp;<span class="builtintype" id="5750707">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5750727">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750783">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750850">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750864">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750906">nodeSizes</span>&nbsp;<span class="keyword" id="5750916">map</span><span class="op" id="5750919">[</span><span class="ident" id="5750920">ast</span><span class="op" id="5750923">.</span><span class="ident" id="5750924">Node</span><span class="op" id="5750928">]</span><span class="builtintype" id="5750929">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750935">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750986">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5750997">token</span><span class="op" id="5751002">.</span><span class="ident" id="5751003">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751008">cachedLine</span>&nbsp;<span class="builtintype" id="5751019">int</span>&nbsp;<span class="comment" id="5751023">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5751058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751061">func</span>&nbsp;<span class="op" id="5751066">(</span><span class="ident" id="5751067">p</span>&nbsp;<span class="op" id="5751069">*</span><span class="ident" id="5751070">printer</span><span class="op" id="5751077">)</span>&nbsp;<span class="ident" id="5751079">init</span><span class="op" id="5751083">(</span><span class="ident" id="5751084">cfg</span>&nbsp;<span class="op" id="5751088">*</span><span class="ident" id="5751089">Config</span><span class="op" id="5751095">,</span>&nbsp;<span class="ident" id="5751097">fset</span>&nbsp;<span class="op" id="5751102">*</span><span class="ident" id="5751103">token</span><span class="op" id="5751108">.</span><span class="ident" id="5751109">FileSet</span><span class="op" id="5751116">,</span>&nbsp;<span class="ident" id="5751118">nodeSizes</span>&nbsp;<span class="keyword" id="5751128">map</span><span class="op" id="5751131">[</span><span class="ident" id="5751132">ast</span><span class="op" id="5751135">.</span><span class="ident" id="5751136">Node</span><span class="op" id="5751140">]</span><span class="builtintype" id="5751141">int</span><span class="op" id="5751144">)</span>&nbsp;<span class="op" id="5751146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751149">p</span><span class="op" id="5751150">.</span><span class="ident" id="5751151">Config</span>&nbsp;<span class="op" id="5751158">=</span>&nbsp;<span class="op" id="5751160">*</span><span class="ident" id="5751161">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751166">p</span><span class="op" id="5751167">.</span><span class="ident" id="5751168">fset</span>&nbsp;<span class="op" id="5751173">=</span>&nbsp;<span class="ident" id="5751175">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751181">p</span><span class="op" id="5751182">.</span><span class="ident" id="5751183">pos</span>&nbsp;<span class="op" id="5751187">=</span>&nbsp;<span class="ident" id="5751189">token</span><span class="op" id="5751194">.</span><span class="ident" id="5751195">Position</span><span class="op" id="5751203">{</span><span class="ident" id="5751204">Line</span><span class="op" id="5751208">:</span>&nbsp;<span class="num" id="5751210">1</span><span class="op" id="5751211">,</span>&nbsp;<span class="ident" id="5751213">Column</span><span class="op" id="5751219">:</span>&nbsp;<span class="num" id="5751221">1</span><span class="op" id="5751222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751225">p</span><span class="op" id="5751226">.</span><span class="ident" id="5751227">out</span>&nbsp;<span class="op" id="5751231">=</span>&nbsp;<span class="ident" id="5751233">token</span><span class="op" id="5751238">.</span><span class="ident" id="5751239">Position</span><span class="op" id="5751247">{</span><span class="ident" id="5751248">Line</span><span class="op" id="5751252">:</span>&nbsp;<span class="num" id="5751254">1</span><span class="op" id="5751255">,</span>&nbsp;<span class="ident" id="5751257">Column</span><span class="op" id="5751263">:</span>&nbsp;<span class="num" id="5751265">1</span><span class="op" id="5751266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751269">p</span><span class="op" id="5751270">.</span><span class="ident" id="5751271">wsbuf</span>&nbsp;<span class="op" id="5751277">=</span>&nbsp;<span class="builtinfunc" id="5751279">make</span><span class="op" id="5751283">(</span><span class="op" id="5751284">[</span><span class="op" id="5751285">]</span><span class="ident" id="5751286">whiteSpace</span><span class="op" id="5751296">,</span>&nbsp;<span class="num" id="5751298">0</span><span class="op" id="5751299">,</span>&nbsp;<span class="num" id="5751301">16</span><span class="op" id="5751303">)</span>&nbsp;<span class="comment" id="5751305">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751340">p</span><span class="op" id="5751341">.</span><span class="ident" id="5751342">nodeSizes</span>&nbsp;<span class="op" id="5751352">=</span>&nbsp;<span class="ident" id="5751354">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751365">p</span><span class="op" id="5751366">.</span><span class="ident" id="5751367">cachedPos</span>&nbsp;<span class="op" id="5751377">=</span>&nbsp;<span class="op" id="5751379">-</span><span class="num" id="5751380">1</span><br>
<span class="lineno"></span><span class="op" id="5751382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751385">func</span>&nbsp;<span class="op" id="5751390">(</span><span class="ident" id="5751391">p</span>&nbsp;<span class="op" id="5751393">*</span><span class="ident" id="5751394">printer</span><span class="op" id="5751401">)</span>&nbsp;<span class="ident" id="5751403">internalError</span><span class="op" id="5751416">(</span><span class="ident" id="5751417">msg</span>&nbsp;<span class="op" id="5751421">...</span><span class="keyword" id="5751424">interface</span><span class="op" id="5751433">{</span><span class="op" id="5751434">}</span><span class="op" id="5751435">)</span>&nbsp;<span class="op" id="5751437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751440">if</span>&nbsp;<span class="ident" id="5751443">debug</span>&nbsp;<span class="op" id="5751449">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751453">fmt</span><span class="op" id="5751456">.</span><span class="ident" id="5751457">Print</span><span class="op" id="5751462">(</span><span class="ident" id="5751463">p</span><span class="op" id="5751464">.</span><span class="ident" id="5751465">pos</span><span class="op" id="5751468">.</span><span class="ident" id="5751469">String</span><span class="op" id="5751475">(</span><span class="op" id="5751476">)</span>&nbsp;<span class="op" id="5751478">+</span>&nbsp;<span class="string" id="5751480">&#34;:&nbsp;&#34;</span><span class="op" id="5751484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751488">fmt</span><span class="op" id="5751491">.</span><span class="ident" id="5751492">Println</span><span class="op" id="5751499">(</span><span class="ident" id="5751500">msg</span><span class="op" id="5751503">...</span><span class="op" id="5751506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5751510">panic</span><span class="op" id="5751515">(</span><span class="string" id="5751516">&#34;go/printer&#34;</span><span class="op" id="5751528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751531">}</span><br>
<span class="lineno"></span><span class="op" id="5751533">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5751536">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5751607">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5751683">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5751756">func</span>&nbsp;<span class="op" id="5751761">(</span><span class="ident" id="5751762">p</span>&nbsp;<span class="op" id="5751764">*</span><span class="ident" id="5751765">printer</span><span class="op" id="5751772">)</span>&nbsp;<span class="ident" id="5751774">commentsHaveNewline</span><span class="op" id="5751793">(</span><span class="ident" id="5751794">list</span>&nbsp;<span class="op" id="5751799">[</span><span class="op" id="5751800">]</span><span class="op" id="5751801">*</span><span class="ident" id="5751802">ast</span><span class="op" id="5751805">.</span><span class="ident" id="5751806">Comment</span><span class="op" id="5751813">)</span>&nbsp;<span class="builtintype" id="5751815">bool</span>&nbsp;<span class="op" id="5751820">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751823">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751841">line</span>&nbsp;<span class="op" id="5751846">:=</span>&nbsp;<span class="ident" id="5751849">p</span><span class="op" id="5751850">.</span><span class="ident" id="5751851">lineFor</span><span class="op" id="5751858">(</span><span class="ident" id="5751859">list</span><span class="op" id="5751863">[</span><span class="num" id="5751864">0</span><span class="op" id="5751865">]</span><span class="op" id="5751866">.</span><span class="ident" id="5751867">Pos</span><span class="op" id="5751870">(</span><span class="op" id="5751871">)</span><span class="op" id="5751872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751875">for</span>&nbsp;<span class="ident" id="5751879">i</span><span class="op" id="5751880">,</span>&nbsp;<span class="ident" id="5751882">c</span>&nbsp;<span class="op" id="5751884">:=</span>&nbsp;<span class="keyword" id="5751887">range</span>&nbsp;<span class="ident" id="5751893">list</span>&nbsp;<span class="op" id="5751898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751902">if</span>&nbsp;<span class="ident" id="5751905">i</span>&nbsp;<span class="op" id="5751907">&gt;</span>&nbsp;<span class="num" id="5751909">0</span>&nbsp;<span class="op" id="5751911">&amp;&amp;</span>&nbsp;<span class="ident" id="5751914">p</span><span class="op" id="5751915">.</span><span class="ident" id="5751916">lineFor</span><span class="op" id="5751923">(</span><span class="ident" id="5751924">list</span><span class="op" id="5751928">[</span><span class="ident" id="5751929">i</span><span class="op" id="5751930">]</span><span class="op" id="5751931">.</span><span class="ident" id="5751932">Pos</span><span class="op" id="5751935">(</span><span class="op" id="5751936">)</span><span class="op" id="5751937">)</span>&nbsp;<span class="op" id="5751939">!=</span>&nbsp;<span class="ident" id="5751942">line</span>&nbsp;<span class="op" id="5751947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751952">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751992">return</span>&nbsp;<span class="ident" id="5751999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752010">if</span>&nbsp;<span class="ident" id="5752013">t</span>&nbsp;<span class="op" id="5752015">:=</span>&nbsp;<span class="ident" id="5752018">c</span><span class="op" id="5752019">.</span><span class="ident" id="5752020">Text</span><span class="op" id="5752024">;</span>&nbsp;<span class="builtinfunc" id="5752026">len</span><span class="op" id="5752029">(</span><span class="ident" id="5752030">t</span><span class="op" id="5752031">)</span>&nbsp;<span class="op" id="5752033">&gt;=</span>&nbsp;<span class="num" id="5752036">2</span>&nbsp;<span class="op" id="5752038">&amp;&amp;</span>&nbsp;<span class="op" id="5752041">(</span><span class="ident" id="5752042">t</span><span class="op" id="5752043">[</span><span class="num" id="5752044">1</span><span class="op" id="5752045">]</span>&nbsp;<span class="op" id="5752047">==</span>&nbsp;<span class="string" id="5752050">&#39;/&#39;</span>&nbsp;<span class="op" id="5752054">||</span>&nbsp;<span class="ident" id="5752057">strings</span><span class="op" id="5752064">.</span><span class="ident" id="5752065">Contains</span><span class="op" id="5752073">(</span><span class="ident" id="5752074">t</span><span class="op" id="5752075">,</span>&nbsp;<span class="string" id="5752077">&#34;\n&#34;</span><span class="op" id="5752081">)</span><span class="op" id="5752082">)</span>&nbsp;<span class="op" id="5752084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752089">return</span>&nbsp;<span class="ident" id="5752096">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752103">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752109">_</span>&nbsp;<span class="op" id="5752111">=</span>&nbsp;<span class="ident" id="5752113">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752119">return</span>&nbsp;<span class="ident" id="5752126">false</span><br>
<span class="lineno"></span><span class="op" id="5752132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5752135">func</span>&nbsp;<span class="op" id="5752140">(</span><span class="ident" id="5752141">p</span>&nbsp;<span class="op" id="5752143">*</span><span class="ident" id="5752144">printer</span><span class="op" id="5752151">)</span>&nbsp;<span class="ident" id="5752153">nextComment</span><span class="op" id="5752164">(</span><span class="op" id="5752165">)</span>&nbsp;<span class="op" id="5752167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752170">for</span>&nbsp;<span class="ident" id="5752174">p</span><span class="op" id="5752175">.</span><span class="ident" id="5752176">cindex</span>&nbsp;<span class="op" id="5752183">&lt;</span>&nbsp;<span class="builtinfunc" id="5752185">len</span><span class="op" id="5752188">(</span><span class="ident" id="5752189">p</span><span class="op" id="5752190">.</span><span class="ident" id="5752191">comments</span><span class="op" id="5752199">)</span>&nbsp;<span class="op" id="5752201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752205">c</span>&nbsp;<span class="op" id="5752207">:=</span>&nbsp;<span class="ident" id="5752210">p</span><span class="op" id="5752211">.</span><span class="ident" id="5752212">comments</span><span class="op" id="5752220">[</span><span class="ident" id="5752221">p</span><span class="op" id="5752222">.</span><span class="ident" id="5752223">cindex</span><span class="op" id="5752229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752233">p</span><span class="op" id="5752234">.</span><span class="ident" id="5752235">cindex</span><span class="op" id="5752241">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752246">if</span>&nbsp;<span class="ident" id="5752249">list</span>&nbsp;<span class="op" id="5752254">:=</span>&nbsp;<span class="ident" id="5752257">c</span><span class="op" id="5752258">.</span><span class="ident" id="5752259">List</span><span class="op" id="5752263">;</span>&nbsp;<span class="builtinfunc" id="5752265">len</span><span class="op" id="5752268">(</span><span class="ident" id="5752269">list</span><span class="op" id="5752273">)</span>&nbsp;<span class="op" id="5752275">&gt;</span>&nbsp;<span class="num" id="5752277">0</span>&nbsp;<span class="op" id="5752279">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752284">p</span><span class="op" id="5752285">.</span><span class="ident" id="5752286">comment</span>&nbsp;<span class="op" id="5752294">=</span>&nbsp;<span class="ident" id="5752296">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752301">p</span><span class="op" id="5752302">.</span><span class="ident" id="5752303">commentOffset</span>&nbsp;<span class="op" id="5752317">=</span>&nbsp;<span class="ident" id="5752319">p</span><span class="op" id="5752320">.</span><span class="ident" id="5752321">posFor</span><span class="op" id="5752327">(</span><span class="ident" id="5752328">list</span><span class="op" id="5752332">[</span><span class="num" id="5752333">0</span><span class="op" id="5752334">]</span><span class="op" id="5752335">.</span><span class="ident" id="5752336">Pos</span><span class="op" id="5752339">(</span><span class="op" id="5752340">)</span><span class="op" id="5752341">)</span><span class="op" id="5752342">.</span><span class="ident" id="5752343">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752353">p</span><span class="op" id="5752354">.</span><span class="ident" id="5752355">commentNewline</span>&nbsp;<span class="op" id="5752370">=</span>&nbsp;<span class="ident" id="5752372">p</span><span class="op" id="5752373">.</span><span class="ident" id="5752374">commentsHaveNewline</span><span class="op" id="5752393">(</span><span class="ident" id="5752394">list</span><span class="op" id="5752398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752403">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752412">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752416">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752477">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752543">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752564">p</span><span class="op" id="5752565">.</span><span class="ident" id="5752566">commentOffset</span>&nbsp;<span class="op" id="5752580">=</span>&nbsp;<span class="ident" id="5752582">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5752591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5752594">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5752661">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5752729">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5752767">//</span><br>
<span class="lineno"></span><span class="keyword" id="5752770">func</span>&nbsp;<span class="op" id="5752775">(</span><span class="ident" id="5752776">p</span>&nbsp;<span class="op" id="5752778">*</span><span class="ident" id="5752779">printer</span><span class="op" id="5752786">)</span>&nbsp;<span class="ident" id="5752788">commentBefore</span><span class="op" id="5752801">(</span><span class="ident" id="5752802">next</span>&nbsp;<span class="ident" id="5752807">token</span><span class="op" id="5752812">.</span><span class="ident" id="5752813">Position</span><span class="op" id="5752821">)</span>&nbsp;<span class="builtintype" id="5752823">bool</span>&nbsp;<span class="op" id="5752828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752831">return</span>&nbsp;<span class="ident" id="5752838">p</span><span class="op" id="5752839">.</span><span class="ident" id="5752840">commentOffset</span>&nbsp;<span class="op" id="5752854">&lt;</span>&nbsp;<span class="ident" id="5752856">next</span><span class="op" id="5752860">.</span><span class="ident" id="5752861">Offset</span>&nbsp;<span class="op" id="5752868">&amp;&amp;</span>&nbsp;<span class="op" id="5752871">(</span><span class="op" id="5752872">!</span><span class="ident" id="5752873">p</span><span class="op" id="5752874">.</span><span class="ident" id="5752875">impliedSemi</span>&nbsp;<span class="op" id="5752887">||</span>&nbsp;<span class="op" id="5752890">!</span><span class="ident" id="5752891">p</span><span class="op" id="5752892">.</span><span class="ident" id="5752893">commentNewline</span><span class="op" id="5752907">)</span><br>
<span class="lineno"></span><span class="op" id="5752909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5752912">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5752967">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5753022">//</span><br>
<span class="lineno"></span><span class="keyword" id="5753025">func</span>&nbsp;<span class="op" id="5753030">(</span><span class="ident" id="5753031">p</span>&nbsp;<span class="op" id="5753033">*</span><span class="ident" id="5753034">printer</span><span class="op" id="5753041">)</span>&nbsp;<span class="ident" id="5753043">commentSizeBefore</span><span class="op" id="5753060">(</span><span class="ident" id="5753061">next</span>&nbsp;<span class="ident" id="5753066">token</span><span class="op" id="5753071">.</span><span class="ident" id="5753072">Position</span><span class="op" id="5753080">)</span>&nbsp;<span class="builtintype" id="5753082">int</span>&nbsp;<span class="op" id="5753086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753089">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753158">defer</span>&nbsp;<span class="keyword" id="5753164">func</span><span class="op" id="5753168">(</span><span class="ident" id="5753169">info</span>&nbsp;<span class="ident" id="5753174">commentInfo</span><span class="op" id="5753185">)</span>&nbsp;<span class="op" id="5753187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753191">p</span><span class="op" id="5753192">.</span><span class="ident" id="5753193">commentInfo</span>&nbsp;<span class="op" id="5753205">=</span>&nbsp;<span class="ident" id="5753207">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753213">}</span><span class="op" id="5753214">(</span><span class="ident" id="5753215">p</span><span class="op" id="5753216">.</span><span class="ident" id="5753217">commentInfo</span><span class="op" id="5753228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753232">size</span>&nbsp;<span class="op" id="5753237">:=</span>&nbsp;<span class="num" id="5753240">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753243">for</span>&nbsp;<span class="ident" id="5753247">p</span><span class="op" id="5753248">.</span><span class="ident" id="5753249">commentBefore</span><span class="op" id="5753262">(</span><span class="ident" id="5753263">next</span><span class="op" id="5753267">)</span>&nbsp;<span class="op" id="5753269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753273">for</span>&nbsp;<span class="ident" id="5753277">_</span><span class="op" id="5753278">,</span>&nbsp;<span class="ident" id="5753280">c</span>&nbsp;<span class="op" id="5753282">:=</span>&nbsp;<span class="keyword" id="5753285">range</span>&nbsp;<span class="ident" id="5753291">p</span><span class="op" id="5753292">.</span><span class="ident" id="5753293">comment</span><span class="op" id="5753300">.</span><span class="ident" id="5753301">List</span>&nbsp;<span class="op" id="5753306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753311">size</span>&nbsp;<span class="op" id="5753316">+=</span>&nbsp;<span class="builtinfunc" id="5753319">len</span><span class="op" id="5753322">(</span><span class="ident" id="5753323">c</span><span class="op" id="5753324">.</span><span class="ident" id="5753325">Text</span><span class="op" id="5753329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753337">p</span><span class="op" id="5753338">.</span><span class="ident" id="5753339">nextComment</span><span class="op" id="5753350">(</span><span class="op" id="5753351">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753357">return</span>&nbsp;<span class="ident" id="5753364">size</span><br>
<span class="lineno"></span><span class="op" id="5753369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753372">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5753445">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5753519">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5753595">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5753611">//</span><br>
<span class="lineno"></span><span class="keyword" id="5753614">func</span>&nbsp;<span class="op" id="5753619">(</span><span class="ident" id="5753620">p</span>&nbsp;<span class="op" id="5753622">*</span><span class="ident" id="5753623">printer</span><span class="op" id="5753630">)</span>&nbsp;<span class="ident" id="5753632">recordLine</span><span class="op" id="5753642">(</span><span class="ident" id="5753643">linePtr</span>&nbsp;<span class="op" id="5753651">*</span><span class="builtintype" id="5753652">int</span><span class="op" id="5753655">)</span>&nbsp;<span class="op" id="5753657">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753660">p</span><span class="op" id="5753661">.</span><span class="ident" id="5753662">linePtr</span>&nbsp;<span class="op" id="5753670">=</span>&nbsp;<span class="ident" id="5753672">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5753680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753683">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5753751">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5753819">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5753889">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5753945">//</span><br>
<span class="lineno"></span><span class="keyword" id="5753948">func</span>&nbsp;<span class="op" id="5753953">(</span><span class="ident" id="5753954">p</span>&nbsp;<span class="op" id="5753956">*</span><span class="ident" id="5753957">printer</span><span class="op" id="5753964">)</span>&nbsp;<span class="ident" id="5753966">linesFrom</span><span class="op" id="5753975">(</span><span class="ident" id="5753976">line</span>&nbsp;<span class="builtintype" id="5753981">int</span><span class="op" id="5753984">)</span>&nbsp;<span class="builtintype" id="5753986">int</span>&nbsp;<span class="op" id="5753990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753993">return</span>&nbsp;<span class="ident" id="5754000">p</span><span class="op" id="5754001">.</span><span class="ident" id="5754002">out</span><span class="op" id="5754005">.</span><span class="ident" id="5754006">Line</span>&nbsp;<span class="op" id="5754011">-</span>&nbsp;<span class="ident" id="5754013">line</span><br>
<span class="lineno">190</span><span class="op" id="5754018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5754021">func</span>&nbsp;<span class="op" id="5754026">(</span><span class="ident" id="5754027">p</span>&nbsp;<span class="op" id="5754029">*</span><span class="ident" id="5754030">printer</span><span class="op" id="5754037">)</span>&nbsp;<span class="ident" id="5754039">posFor</span><span class="op" id="5754045">(</span><span class="ident" id="5754046">pos</span>&nbsp;<span class="ident" id="5754050">token</span><span class="op" id="5754055">.</span><span class="ident" id="5754056">Pos</span><span class="op" id="5754059">)</span>&nbsp;<span class="ident" id="5754061">token</span><span class="op" id="5754066">.</span><span class="ident" id="5754067">Position</span>&nbsp;<span class="op" id="5754076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754079">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754141">return</span>&nbsp;<span class="ident" id="5754148">p</span><span class="op" id="5754149">.</span><span class="ident" id="5754150">fset</span><span class="op" id="5754154">.</span><span class="ident" id="5754155">Position</span><span class="op" id="5754163">(</span><span class="ident" id="5754164">pos</span><span class="op" id="5754167">)</span><br>
<span class="lineno">195</span><span class="op" id="5754169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5754172">func</span>&nbsp;<span class="op" id="5754177">(</span><span class="ident" id="5754178">p</span>&nbsp;<span class="op" id="5754180">*</span><span class="ident" id="5754181">printer</span><span class="op" id="5754188">)</span>&nbsp;<span class="ident" id="5754190">lineFor</span><span class="op" id="5754197">(</span><span class="ident" id="5754198">pos</span>&nbsp;<span class="ident" id="5754202">token</span><span class="op" id="5754207">.</span><span class="ident" id="5754208">Pos</span><span class="op" id="5754211">)</span>&nbsp;<span class="builtintype" id="5754213">int</span>&nbsp;<span class="op" id="5754217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754220">if</span>&nbsp;<span class="ident" id="5754223">pos</span>&nbsp;<span class="op" id="5754227">!=</span>&nbsp;<span class="ident" id="5754230">p</span><span class="op" id="5754231">.</span><span class="ident" id="5754232">cachedPos</span>&nbsp;<span class="op" id="5754242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754246">p</span><span class="op" id="5754247">.</span><span class="ident" id="5754248">cachedPos</span>&nbsp;<span class="op" id="5754258">=</span>&nbsp;<span class="ident" id="5754260">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754266">p</span><span class="op" id="5754267">.</span><span class="ident" id="5754268">cachedLine</span>&nbsp;<span class="op" id="5754279">=</span>&nbsp;<span class="ident" id="5754281">p</span><span class="op" id="5754282">.</span><span class="ident" id="5754283">fset</span><span class="op" id="5754287">.</span><span class="ident" id="5754288">Position</span><span class="op" id="5754296">(</span><span class="ident" id="5754297">pos</span><span class="op" id="5754300">)</span><span class="op" id="5754301">.</span><span class="ident" id="5754302">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754311">return</span>&nbsp;<span class="ident" id="5754318">p</span><span class="op" id="5754319">.</span><span class="ident" id="5754320">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5754331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5754334">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5754409">func</span>&nbsp;<span class="op" id="5754414">(</span><span class="ident" id="5754415">p</span>&nbsp;<span class="op" id="5754417">*</span><span class="ident" id="5754418">printer</span><span class="op" id="5754425">)</span>&nbsp;<span class="ident" id="5754427">atLineBegin</span><span class="op" id="5754438">(</span><span class="ident" id="5754439">pos</span>&nbsp;<span class="ident" id="5754443">token</span><span class="op" id="5754448">.</span><span class="ident" id="5754449">Position</span><span class="op" id="5754457">)</span>&nbsp;<span class="op" id="5754459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754462">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754502">if</span>&nbsp;<span class="ident" id="5754505">p</span><span class="op" id="5754506">.</span><span class="ident" id="5754507">Config</span><span class="op" id="5754513">.</span><span class="ident" id="5754514">Mode</span><span class="op" id="5754518">&amp;</span><span class="ident" id="5754519">SourcePos</span>&nbsp;<span class="op" id="5754529">!=</span>&nbsp;<span class="num" id="5754532">0</span>&nbsp;<span class="op" id="5754534">&amp;&amp;</span>&nbsp;<span class="ident" id="5754537">pos</span><span class="op" id="5754540">.</span><span class="ident" id="5754541">IsValid</span><span class="op" id="5754548">(</span><span class="op" id="5754549">)</span>&nbsp;<span class="op" id="5754551">&amp;&amp;</span>&nbsp;<span class="op" id="5754554">(</span><span class="ident" id="5754555">p</span><span class="op" id="5754556">.</span><span class="ident" id="5754557">out</span><span class="op" id="5754560">.</span><span class="ident" id="5754561">Line</span>&nbsp;<span class="op" id="5754566">!=</span>&nbsp;<span class="ident" id="5754569">pos</span><span class="op" id="5754572">.</span><span class="ident" id="5754573">Line</span>&nbsp;<span class="op" id="5754578">||</span>&nbsp;<span class="ident" id="5754581">p</span><span class="op" id="5754582">.</span><span class="ident" id="5754583">out</span><span class="op" id="5754586">.</span><span class="ident" id="5754587">Filename</span>&nbsp;<span class="op" id="5754596">!=</span>&nbsp;<span class="ident" id="5754599">pos</span><span class="op" id="5754602">.</span><span class="ident" id="5754603">Filename</span><span class="op" id="5754611">)</span>&nbsp;<span class="op" id="5754613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754617">p</span><span class="op" id="5754618">.</span><span class="ident" id="5754619">output</span>&nbsp;<span class="op" id="5754626">=</span>&nbsp;<span class="builtinfunc" id="5754628">append</span><span class="op" id="5754634">(</span><span class="ident" id="5754635">p</span><span class="op" id="5754636">.</span><span class="ident" id="5754637">output</span><span class="op" id="5754643">,</span>&nbsp;<span class="ident" id="5754645">tabwriter</span><span class="op" id="5754654">.</span><span class="ident" id="5754655">Escape</span><span class="op" id="5754661">)</span>&nbsp;<span class="comment" id="5754663">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754721">p</span><span class="op" id="5754722">.</span><span class="ident" id="5754723">output</span>&nbsp;<span class="op" id="5754730">=</span>&nbsp;<span class="builtinfunc" id="5754732">append</span><span class="op" id="5754738">(</span><span class="ident" id="5754739">p</span><span class="op" id="5754740">.</span><span class="ident" id="5754741">output</span><span class="op" id="5754747">,</span>&nbsp;<span class="ident" id="5754749">fmt</span><span class="op" id="5754752">.</span><span class="ident" id="5754753">Sprintf</span><span class="op" id="5754760">(</span><span class="string" id="5754761">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5754777">,</span>&nbsp;<span class="ident" id="5754779">pos</span><span class="op" id="5754782">.</span><span class="ident" id="5754783">Filename</span><span class="op" id="5754791">,</span>&nbsp;<span class="ident" id="5754793">pos</span><span class="op" id="5754796">.</span><span class="ident" id="5754797">Line</span><span class="op" id="5754801">)</span><span class="op" id="5754802">...</span><span class="op" id="5754805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754809">p</span><span class="op" id="5754810">.</span><span class="ident" id="5754811">output</span>&nbsp;<span class="op" id="5754818">=</span>&nbsp;<span class="builtinfunc" id="5754820">append</span><span class="op" id="5754826">(</span><span class="ident" id="5754827">p</span><span class="op" id="5754828">.</span><span class="ident" id="5754829">output</span><span class="op" id="5754835">,</span>&nbsp;<span class="ident" id="5754837">tabwriter</span><span class="op" id="5754846">.</span><span class="ident" id="5754847">Escape</span><span class="op" id="5754853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754857">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754898">p</span><span class="op" id="5754899">.</span><span class="ident" id="5754900">out</span><span class="op" id="5754903">.</span><span class="ident" id="5754904">Filename</span>&nbsp;<span class="op" id="5754913">=</span>&nbsp;<span class="ident" id="5754915">pos</span><span class="op" id="5754918">.</span><span class="ident" id="5754919">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754930">p</span><span class="op" id="5754931">.</span><span class="ident" id="5754932">out</span><span class="op" id="5754935">.</span><span class="ident" id="5754936">Line</span>&nbsp;<span class="op" id="5754941">=</span>&nbsp;<span class="ident" id="5754943">pos</span><span class="op" id="5754946">.</span><span class="ident" id="5754947">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754957">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754979">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755022">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755065">n</span>&nbsp;<span class="op" id="5755067">:=</span>&nbsp;<span class="ident" id="5755070">p</span><span class="op" id="5755071">.</span><span class="ident" id="5755072">Config</span><span class="op" id="5755078">.</span><span class="ident" id="5755079">Indent</span>&nbsp;<span class="op" id="5755086">+</span>&nbsp;<span class="ident" id="5755088">p</span><span class="op" id="5755089">.</span><span class="ident" id="5755090">indent</span>&nbsp;<span class="comment" id="5755097">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755126">for</span>&nbsp;<span class="ident" id="5755130">i</span>&nbsp;<span class="op" id="5755132">:=</span>&nbsp;<span class="num" id="5755135">0</span><span class="op" id="5755136">;</span>&nbsp;<span class="ident" id="5755138">i</span>&nbsp;<span class="op" id="5755140">&lt;</span>&nbsp;<span class="ident" id="5755142">n</span><span class="op" id="5755143">;</span>&nbsp;<span class="ident" id="5755145">i</span><span class="op" id="5755146">++</span>&nbsp;<span class="op" id="5755149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755153">p</span><span class="op" id="5755154">.</span><span class="ident" id="5755155">output</span>&nbsp;<span class="op" id="5755162">=</span>&nbsp;<span class="builtinfunc" id="5755164">append</span><span class="op" id="5755170">(</span><span class="ident" id="5755171">p</span><span class="op" id="5755172">.</span><span class="ident" id="5755173">output</span><span class="op" id="5755179">,</span>&nbsp;<span class="string" id="5755181">&#39;\t&#39;</span><span class="op" id="5755185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755192">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755213">p</span><span class="op" id="5755214">.</span><span class="ident" id="5755215">pos</span><span class="op" id="5755218">.</span><span class="ident" id="5755219">Offset</span>&nbsp;<span class="op" id="5755226">+=</span>&nbsp;<span class="ident" id="5755229">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755232">p</span><span class="op" id="5755233">.</span><span class="ident" id="5755234">pos</span><span class="op" id="5755237">.</span><span class="ident" id="5755238">Column</span>&nbsp;<span class="op" id="5755245">+=</span>&nbsp;<span class="ident" id="5755248">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755251">p</span><span class="op" id="5755252">.</span><span class="ident" id="5755253">out</span><span class="op" id="5755256">.</span><span class="ident" id="5755257">Column</span>&nbsp;<span class="op" id="5755264">+=</span>&nbsp;<span class="ident" id="5755267">n</span><br>
<span class="lineno"></span><span class="op" id="5755269">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5755272">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5755334">func</span>&nbsp;<span class="op" id="5755339">(</span><span class="ident" id="5755340">p</span>&nbsp;<span class="op" id="5755342">*</span><span class="ident" id="5755343">printer</span><span class="op" id="5755350">)</span>&nbsp;<span class="ident" id="5755352">writeByte</span><span class="op" id="5755361">(</span><span class="ident" id="5755362">ch</span>&nbsp;<span class="builtintype" id="5755365">byte</span><span class="op" id="5755369">,</span>&nbsp;<span class="ident" id="5755371">n</span>&nbsp;<span class="builtintype" id="5755373">int</span><span class="op" id="5755376">)</span>&nbsp;<span class="op" id="5755378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755381">if</span>&nbsp;<span class="ident" id="5755384">p</span><span class="op" id="5755385">.</span><span class="ident" id="5755386">out</span><span class="op" id="5755389">.</span><span class="ident" id="5755390">Column</span>&nbsp;<span class="op" id="5755397">==</span>&nbsp;<span class="num" id="5755400">1</span>&nbsp;<span class="op" id="5755402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755406">p</span><span class="op" id="5755407">.</span><span class="ident" id="5755408">atLineBegin</span><span class="op" id="5755419">(</span><span class="ident" id="5755420">p</span><span class="op" id="5755421">.</span><span class="ident" id="5755422">pos</span><span class="op" id="5755425">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755432">for</span>&nbsp;<span class="ident" id="5755436">i</span>&nbsp;<span class="op" id="5755438">:=</span>&nbsp;<span class="num" id="5755441">0</span><span class="op" id="5755442">;</span>&nbsp;<span class="ident" id="5755444">i</span>&nbsp;<span class="op" id="5755446">&lt;</span>&nbsp;<span class="ident" id="5755448">n</span><span class="op" id="5755449">;</span>&nbsp;<span class="ident" id="5755451">i</span><span class="op" id="5755452">++</span>&nbsp;<span class="op" id="5755455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755459">p</span><span class="op" id="5755460">.</span><span class="ident" id="5755461">output</span>&nbsp;<span class="op" id="5755468">=</span>&nbsp;<span class="builtinfunc" id="5755470">append</span><span class="op" id="5755476">(</span><span class="ident" id="5755477">p</span><span class="op" id="5755478">.</span><span class="ident" id="5755479">output</span><span class="op" id="5755485">,</span>&nbsp;<span class="ident" id="5755487">ch</span><span class="op" id="5755489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755492">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755496">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755517">p</span><span class="op" id="5755518">.</span><span class="ident" id="5755519">pos</span><span class="op" id="5755522">.</span><span class="ident" id="5755523">Offset</span>&nbsp;<span class="op" id="5755530">+=</span>&nbsp;<span class="ident" id="5755533">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755536">if</span>&nbsp;<span class="ident" id="5755539">ch</span>&nbsp;<span class="op" id="5755542">==</span>&nbsp;<span class="string" id="5755545">&#39;\n&#39;</span>&nbsp;<span class="op" id="5755550">||</span>&nbsp;<span class="ident" id="5755553">ch</span>&nbsp;<span class="op" id="5755556">==</span>&nbsp;<span class="string" id="5755559">&#39;\f&#39;</span>&nbsp;<span class="op" id="5755564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755568">p</span><span class="op" id="5755569">.</span><span class="ident" id="5755570">pos</span><span class="op" id="5755573">.</span><span class="ident" id="5755574">Line</span>&nbsp;<span class="op" id="5755579">+=</span>&nbsp;<span class="ident" id="5755582">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755586">p</span><span class="op" id="5755587">.</span><span class="ident" id="5755588">out</span><span class="op" id="5755591">.</span><span class="ident" id="5755592">Line</span>&nbsp;<span class="op" id="5755597">+=</span>&nbsp;<span class="ident" id="5755600">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755604">p</span><span class="op" id="5755605">.</span><span class="ident" id="5755606">pos</span><span class="op" id="5755609">.</span><span class="ident" id="5755610">Column</span>&nbsp;<span class="op" id="5755617">=</span>&nbsp;<span class="num" id="5755619">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755623">p</span><span class="op" id="5755624">.</span><span class="ident" id="5755625">out</span><span class="op" id="5755628">.</span><span class="ident" id="5755629">Column</span>&nbsp;<span class="op" id="5755636">=</span>&nbsp;<span class="num" id="5755638">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755642">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755650">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755653">p</span><span class="op" id="5755654">.</span><span class="ident" id="5755655">pos</span><span class="op" id="5755658">.</span><span class="ident" id="5755659">Column</span>&nbsp;<span class="op" id="5755666">+=</span>&nbsp;<span class="ident" id="5755669">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755672">p</span><span class="op" id="5755673">.</span><span class="ident" id="5755674">out</span><span class="op" id="5755677">.</span><span class="ident" id="5755678">Column</span>&nbsp;<span class="op" id="5755685">+=</span>&nbsp;<span class="ident" id="5755688">n</span><br>
<span class="lineno"></span><span class="op" id="5755690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5755693">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5755766">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5755842">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5755899">//</span><br>
<span class="lineno"></span><span class="comment" id="5755902">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5755970">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5756043">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5756115">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5756191">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5756264">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5756299">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5756302">func</span>&nbsp;<span class="op" id="5756307">(</span><span class="ident" id="5756308">p</span>&nbsp;<span class="op" id="5756310">*</span><span class="ident" id="5756311">printer</span><span class="op" id="5756318">)</span>&nbsp;<span class="ident" id="5756320">writeString</span><span class="op" id="5756331">(</span><span class="ident" id="5756332">pos</span>&nbsp;<span class="ident" id="5756336">token</span><span class="op" id="5756341">.</span><span class="ident" id="5756342">Position</span><span class="op" id="5756350">,</span>&nbsp;<span class="ident" id="5756352">s</span>&nbsp;<span class="builtintype" id="5756354">string</span><span class="op" id="5756360">,</span>&nbsp;<span class="ident" id="5756362">isLit</span>&nbsp;<span class="builtintype" id="5756368">bool</span><span class="op" id="5756372">)</span>&nbsp;<span class="op" id="5756374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756377">if</span>&nbsp;<span class="ident" id="5756380">p</span><span class="op" id="5756381">.</span><span class="ident" id="5756382">out</span><span class="op" id="5756385">.</span><span class="ident" id="5756386">Column</span>&nbsp;<span class="op" id="5756393">==</span>&nbsp;<span class="num" id="5756396">1</span>&nbsp;<span class="op" id="5756398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756402">p</span><span class="op" id="5756403">.</span><span class="ident" id="5756404">atLineBegin</span><span class="op" id="5756415">(</span><span class="ident" id="5756416">pos</span><span class="op" id="5756419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756426">if</span>&nbsp;<span class="ident" id="5756429">pos</span><span class="op" id="5756432">.</span><span class="ident" id="5756433">IsValid</span><span class="op" id="5756440">(</span><span class="op" id="5756441">)</span>&nbsp;<span class="op" id="5756443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756447">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756515">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756578">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756643">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756670">p</span><span class="op" id="5756671">.</span><span class="ident" id="5756672">pos</span>&nbsp;<span class="op" id="5756676">=</span>&nbsp;<span class="ident" id="5756678">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756687">if</span>&nbsp;<span class="ident" id="5756690">isLit</span>&nbsp;<span class="op" id="5756696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756700">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756757">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756816">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756878">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756900">p</span><span class="op" id="5756901">.</span><span class="ident" id="5756902">output</span>&nbsp;<span class="op" id="5756909">=</span>&nbsp;<span class="builtinfunc" id="5756911">append</span><span class="op" id="5756917">(</span><span class="ident" id="5756918">p</span><span class="op" id="5756919">.</span><span class="ident" id="5756920">output</span><span class="op" id="5756926">,</span>&nbsp;<span class="ident" id="5756928">tabwriter</span><span class="op" id="5756937">.</span><span class="ident" id="5756938">Escape</span><span class="op" id="5756944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756947">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756951">if</span>&nbsp;<span class="ident" id="5756954">debug</span>&nbsp;<span class="op" id="5756960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756964">p</span><span class="op" id="5756965">.</span><span class="ident" id="5756966">output</span>&nbsp;<span class="op" id="5756973">=</span>&nbsp;<span class="builtinfunc" id="5756975">append</span><span class="op" id="5756981">(</span><span class="ident" id="5756982">p</span><span class="op" id="5756983">.</span><span class="ident" id="5756984">output</span><span class="op" id="5756990">,</span>&nbsp;<span class="ident" id="5756992">fmt</span><span class="op" id="5756995">.</span><span class="ident" id="5756996">Sprintf</span><span class="op" id="5757003">(</span><span class="string" id="5757004">&#34;/*%s*/&#34;</span><span class="op" id="5757012">,</span>&nbsp;<span class="ident" id="5757014">pos</span><span class="op" id="5757017">)</span><span class="op" id="5757018">...</span><span class="op" id="5757021">)</span>&nbsp;<span class="comment" id="5757023">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757051">p</span><span class="op" id="5757052">.</span><span class="ident" id="5757053">output</span>&nbsp;<span class="op" id="5757060">=</span>&nbsp;<span class="builtinfunc" id="5757062">append</span><span class="op" id="5757068">(</span><span class="ident" id="5757069">p</span><span class="op" id="5757070">.</span><span class="ident" id="5757071">output</span><span class="op" id="5757077">,</span>&nbsp;<span class="ident" id="5757079">s</span><span class="op" id="5757080">...</span><span class="op" id="5757083">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757087">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757108">nlines</span>&nbsp;<span class="op" id="5757115">:=</span>&nbsp;<span class="num" id="5757118">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757121">var</span>&nbsp;<span class="ident" id="5757125">li</span>&nbsp;<span class="builtintype" id="5757128">int</span>&nbsp;<span class="comment" id="5757132">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757179">for</span>&nbsp;<span class="ident" id="5757183">i</span>&nbsp;<span class="op" id="5757185">:=</span>&nbsp;<span class="num" id="5757188">0</span><span class="op" id="5757189">;</span>&nbsp;<span class="ident" id="5757191">i</span>&nbsp;<span class="op" id="5757193">&lt;</span>&nbsp;<span class="builtinfunc" id="5757195">len</span><span class="op" id="5757198">(</span><span class="ident" id="5757199">s</span><span class="op" id="5757200">)</span><span class="op" id="5757201">;</span>&nbsp;<span class="ident" id="5757203">i</span><span class="op" id="5757204">++</span>&nbsp;<span class="op" id="5757207">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757211">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757271">if</span>&nbsp;<span class="ident" id="5757274">s</span><span class="op" id="5757275">[</span><span class="ident" id="5757276">i</span><span class="op" id="5757277">]</span>&nbsp;<span class="op" id="5757279">==</span>&nbsp;<span class="string" id="5757282">&#39;\n&#39;</span>&nbsp;<span class="op" id="5757287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757292">nlines</span><span class="op" id="5757298">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757304">li</span>&nbsp;<span class="op" id="5757307">=</span>&nbsp;<span class="ident" id="5757309">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757313">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757319">p</span><span class="op" id="5757320">.</span><span class="ident" id="5757321">pos</span><span class="op" id="5757324">.</span><span class="ident" id="5757325">Offset</span>&nbsp;<span class="op" id="5757332">+=</span>&nbsp;<span class="builtinfunc" id="5757335">len</span><span class="op" id="5757338">(</span><span class="ident" id="5757339">s</span><span class="op" id="5757340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757343">if</span>&nbsp;<span class="ident" id="5757346">nlines</span>&nbsp;<span class="op" id="5757353">&gt;</span>&nbsp;<span class="num" id="5757355">0</span>&nbsp;<span class="op" id="5757357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757361">p</span><span class="op" id="5757362">.</span><span class="ident" id="5757363">pos</span><span class="op" id="5757366">.</span><span class="ident" id="5757367">Line</span>&nbsp;<span class="op" id="5757372">+=</span>&nbsp;<span class="ident" id="5757375">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757384">p</span><span class="op" id="5757385">.</span><span class="ident" id="5757386">out</span><span class="op" id="5757389">.</span><span class="ident" id="5757390">Line</span>&nbsp;<span class="op" id="5757395">+=</span>&nbsp;<span class="ident" id="5757398">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757407">c</span>&nbsp;<span class="op" id="5757409">:=</span>&nbsp;<span class="builtinfunc" id="5757412">len</span><span class="op" id="5757415">(</span><span class="ident" id="5757416">s</span><span class="op" id="5757417">)</span>&nbsp;<span class="op" id="5757419">-</span>&nbsp;<span class="ident" id="5757421">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757426">p</span><span class="op" id="5757427">.</span><span class="ident" id="5757428">pos</span><span class="op" id="5757431">.</span><span class="ident" id="5757432">Column</span>&nbsp;<span class="op" id="5757439">=</span>&nbsp;<span class="ident" id="5757441">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757445">p</span><span class="op" id="5757446">.</span><span class="ident" id="5757447">out</span><span class="op" id="5757450">.</span><span class="ident" id="5757451">Column</span>&nbsp;<span class="op" id="5757458">=</span>&nbsp;<span class="ident" id="5757460">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757463">}</span>&nbsp;<span class="keyword" id="5757465">else</span>&nbsp;<span class="op" id="5757470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757474">p</span><span class="op" id="5757475">.</span><span class="ident" id="5757476">pos</span><span class="op" id="5757479">.</span><span class="ident" id="5757480">Column</span>&nbsp;<span class="op" id="5757487">+=</span>&nbsp;<span class="builtinfunc" id="5757490">len</span><span class="op" id="5757493">(</span><span class="ident" id="5757494">s</span><span class="op" id="5757495">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757499">p</span><span class="op" id="5757500">.</span><span class="ident" id="5757501">out</span><span class="op" id="5757504">.</span><span class="ident" id="5757505">Column</span>&nbsp;<span class="op" id="5757512">+=</span>&nbsp;<span class="builtinfunc" id="5757515">len</span><span class="op" id="5757518">(</span><span class="ident" id="5757519">s</span><span class="op" id="5757520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757527">if</span>&nbsp;<span class="ident" id="5757530">isLit</span>&nbsp;<span class="op" id="5757536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757540">p</span><span class="op" id="5757541">.</span><span class="ident" id="5757542">output</span>&nbsp;<span class="op" id="5757549">=</span>&nbsp;<span class="builtinfunc" id="5757551">append</span><span class="op" id="5757557">(</span><span class="ident" id="5757558">p</span><span class="op" id="5757559">.</span><span class="ident" id="5757560">output</span><span class="op" id="5757566">,</span>&nbsp;<span class="ident" id="5757568">tabwriter</span><span class="op" id="5757577">.</span><span class="ident" id="5757578">Escape</span><span class="op" id="5757584">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757591">p</span><span class="op" id="5757592">.</span><span class="ident" id="5757593">last</span>&nbsp;<span class="op" id="5757598">=</span>&nbsp;<span class="ident" id="5757600">p</span><span class="op" id="5757601">.</span><span class="ident" id="5757602">pos</span><br>
<span class="lineno"></span><span class="op" id="5757606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5757609">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5757671">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5757733">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5757789">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5757851">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5757914">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5757974">//</span><br>
<span class="lineno"></span><span class="keyword" id="5757977">func</span>&nbsp;<span class="op" id="5757982">(</span><span class="ident" id="5757983">p</span>&nbsp;<span class="op" id="5757985">*</span><span class="ident" id="5757986">printer</span><span class="op" id="5757993">)</span>&nbsp;<span class="ident" id="5757995">writeCommentPrefix</span><span class="op" id="5758013">(</span><span class="ident" id="5758014">pos</span><span class="op" id="5758017">,</span>&nbsp;<span class="ident" id="5758019">next</span>&nbsp;<span class="ident" id="5758024">token</span><span class="op" id="5758029">.</span><span class="ident" id="5758030">Position</span><span class="op" id="5758038">,</span>&nbsp;<span class="ident" id="5758040">prev</span><span class="op" id="5758044">,</span>&nbsp;<span class="ident" id="5758046">comment</span>&nbsp;<span class="op" id="5758054">*</span><span class="ident" id="5758055">ast</span><span class="op" id="5758058">.</span><span class="ident" id="5758059">Comment</span><span class="op" id="5758066">,</span>&nbsp;<span class="ident" id="5758068">tok</span>&nbsp;<span class="ident" id="5758072">token</span><span class="op" id="5758077">.</span><span class="ident" id="5758078">Token</span><span class="op" id="5758083">)</span>&nbsp;<span class="op" id="5758085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758088">if</span>&nbsp;<span class="builtinfunc" id="5758091">len</span><span class="op" id="5758094">(</span><span class="ident" id="5758095">p</span><span class="op" id="5758096">.</span><span class="ident" id="5758097">output</span><span class="op" id="5758103">)</span>&nbsp;<span class="op" id="5758105">==</span>&nbsp;<span class="num" id="5758108">0</span>&nbsp;<span class="op" id="5758110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758114">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758192">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758204">if</span>&nbsp;<span class="ident" id="5758207">pos</span><span class="op" id="5758210">.</span><span class="ident" id="5758211">IsValid</span><span class="op" id="5758218">(</span><span class="op" id="5758219">)</span>&nbsp;<span class="op" id="5758221">&amp;&amp;</span>&nbsp;<span class="ident" id="5758224">pos</span><span class="op" id="5758227">.</span><span class="ident" id="5758228">Filename</span>&nbsp;<span class="op" id="5758237">!=</span>&nbsp;<span class="ident" id="5758240">p</span><span class="op" id="5758241">.</span><span class="ident" id="5758242">last</span><span class="op" id="5758246">.</span><span class="ident" id="5758247">Filename</span>&nbsp;<span class="op" id="5758256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758260">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758318">p</span><span class="op" id="5758319">.</span><span class="ident" id="5758320">writeByte</span><span class="op" id="5758329">(</span><span class="string" id="5758330">&#39;\f&#39;</span><span class="op" id="5758334">,</span>&nbsp;<span class="ident" id="5758336">maxNewlines</span><span class="op" id="5758347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758351">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758363">if</span>&nbsp;<span class="ident" id="5758366">pos</span><span class="op" id="5758369">.</span><span class="ident" id="5758370">Line</span>&nbsp;<span class="op" id="5758375">==</span>&nbsp;<span class="ident" id="5758378">p</span><span class="op" id="5758379">.</span><span class="ident" id="5758380">last</span><span class="op" id="5758384">.</span><span class="ident" id="5758385">Line</span>&nbsp;<span class="op" id="5758390">&amp;&amp;</span>&nbsp;<span class="op" id="5758393">(</span><span class="ident" id="5758394">prev</span>&nbsp;<span class="op" id="5758399">==</span>&nbsp;<span class="ident" id="5758402">nil</span>&nbsp;<span class="op" id="5758406">||</span>&nbsp;<span class="ident" id="5758409">prev</span><span class="op" id="5758413">.</span><span class="ident" id="5758414">Text</span><span class="op" id="5758418">[</span><span class="num" id="5758419">1</span><span class="op" id="5758420">]</span>&nbsp;<span class="op" id="5758422">!=</span>&nbsp;<span class="string" id="5758425">&#39;/&#39;</span><span class="op" id="5758428">)</span>&nbsp;<span class="op" id="5758430">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758434">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758478">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758520">hasSep</span>&nbsp;<span class="op" id="5758527">:=</span>&nbsp;<span class="ident" id="5758530">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758538">if</span>&nbsp;<span class="ident" id="5758541">prev</span>&nbsp;<span class="op" id="5758546">==</span>&nbsp;<span class="ident" id="5758549">nil</span>&nbsp;<span class="op" id="5758553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758558">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758597">j</span>&nbsp;<span class="op" id="5758599">:=</span>&nbsp;<span class="num" id="5758602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758607">for</span>&nbsp;<span class="ident" id="5758611">i</span><span class="op" id="5758612">,</span>&nbsp;<span class="ident" id="5758614">ch</span>&nbsp;<span class="op" id="5758617">:=</span>&nbsp;<span class="keyword" id="5758620">range</span>&nbsp;<span class="ident" id="5758626">p</span><span class="op" id="5758627">.</span><span class="ident" id="5758628">wsbuf</span>&nbsp;<span class="op" id="5758634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758640">switch</span>&nbsp;<span class="ident" id="5758647">ch</span>&nbsp;<span class="op" id="5758650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758656">case</span>&nbsp;<span class="ident" id="5758661">blank</span><span class="op" id="5758666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758673">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758716">p</span><span class="op" id="5758717">.</span><span class="ident" id="5758718">wsbuf</span><span class="op" id="5758723">[</span><span class="ident" id="5758724">i</span><span class="op" id="5758725">]</span>&nbsp;<span class="op" id="5758727">=</span>&nbsp;<span class="ident" id="5758729">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758741">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758754">case</span>&nbsp;<span class="ident" id="5758759">vtab</span><span class="op" id="5758763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758770">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758812">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758863">hasSep</span>&nbsp;<span class="op" id="5758870">=</span>&nbsp;<span class="ident" id="5758872">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758882">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758895">case</span>&nbsp;<span class="ident" id="5758900">indent</span><span class="op" id="5758906">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758913">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758947">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758966">j</span>&nbsp;<span class="op" id="5758968">=</span>&nbsp;<span class="ident" id="5758970">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758976">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758990">p</span><span class="op" id="5758991">.</span><span class="ident" id="5758992">writeWhitespace</span><span class="op" id="5759007">(</span><span class="ident" id="5759008">j</span><span class="op" id="5759009">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759017">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759064">if</span>&nbsp;<span class="op" id="5759067">!</span><span class="ident" id="5759068">hasSep</span>&nbsp;<span class="op" id="5759075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759080">sep</span>&nbsp;<span class="op" id="5759084">:=</span>&nbsp;<span class="builtintype" id="5759087">byte</span><span class="op" id="5759091">(</span><span class="string" id="5759092">&#39;\t&#39;</span><span class="op" id="5759096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759101">if</span>&nbsp;<span class="ident" id="5759104">pos</span><span class="op" id="5759107">.</span><span class="ident" id="5759108">Line</span>&nbsp;<span class="op" id="5759113">==</span>&nbsp;<span class="ident" id="5759116">next</span><span class="op" id="5759120">.</span><span class="ident" id="5759121">Line</span>&nbsp;<span class="op" id="5759126">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759132">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759184">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759236">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759273">sep</span>&nbsp;<span class="op" id="5759277">=</span>&nbsp;<span class="string" id="5759279">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759286">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759291">p</span><span class="op" id="5759292">.</span><span class="ident" id="5759293">writeByte</span><span class="op" id="5759302">(</span><span class="ident" id="5759303">sep</span><span class="op" id="5759306">,</span>&nbsp;<span class="num" id="5759308">1</span><span class="op" id="5759309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759317">}</span>&nbsp;<span class="keyword" id="5759319">else</span>&nbsp;<span class="op" id="5759324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759328">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759362">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759405">droppedLinebreak</span>&nbsp;<span class="op" id="5759422">:=</span>&nbsp;<span class="ident" id="5759425">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759433">j</span>&nbsp;<span class="op" id="5759435">:=</span>&nbsp;<span class="num" id="5759438">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759442">for</span>&nbsp;<span class="ident" id="5759446">i</span><span class="op" id="5759447">,</span>&nbsp;<span class="ident" id="5759449">ch</span>&nbsp;<span class="op" id="5759452">:=</span>&nbsp;<span class="keyword" id="5759455">range</span>&nbsp;<span class="ident" id="5759461">p</span><span class="op" id="5759462">.</span><span class="ident" id="5759463">wsbuf</span>&nbsp;<span class="op" id="5759469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759474">switch</span>&nbsp;<span class="ident" id="5759481">ch</span>&nbsp;<span class="op" id="5759484">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759489">case</span>&nbsp;<span class="ident" id="5759494">blank</span><span class="op" id="5759499">,</span>&nbsp;<span class="ident" id="5759501">vtab</span><span class="op" id="5759505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759511">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759570">p</span><span class="op" id="5759571">.</span><span class="ident" id="5759572">wsbuf</span><span class="op" id="5759577">[</span><span class="ident" id="5759578">i</span><span class="op" id="5759579">]</span>&nbsp;<span class="op" id="5759581">=</span>&nbsp;<span class="ident" id="5759583">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759594">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759606">case</span>&nbsp;<span class="ident" id="5759611">indent</span><span class="op" id="5759617">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759623">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759668">case</span>&nbsp;<span class="ident" id="5759673">unindent</span><span class="op" id="5759681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759687">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759737">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759784">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759838">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759880">if</span>&nbsp;<span class="ident" id="5759883">i</span><span class="op" id="5759884">+</span><span class="num" id="5759885">1</span>&nbsp;<span class="op" id="5759887">&lt;</span>&nbsp;<span class="builtinfunc" id="5759889">len</span><span class="op" id="5759892">(</span><span class="ident" id="5759893">p</span><span class="op" id="5759894">.</span><span class="ident" id="5759895">wsbuf</span><span class="op" id="5759900">)</span>&nbsp;<span class="op" id="5759902">&amp;&amp;</span>&nbsp;<span class="ident" id="5759905">p</span><span class="op" id="5759906">.</span><span class="ident" id="5759907">wsbuf</span><span class="op" id="5759912">[</span><span class="ident" id="5759913">i</span><span class="op" id="5759914">+</span><span class="num" id="5759915">1</span><span class="op" id="5759916">]</span>&nbsp;<span class="op" id="5759918">==</span>&nbsp;<span class="ident" id="5759921">unindent</span>&nbsp;<span class="op" id="5759930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759937">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759950">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759956">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760020">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760078">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760135">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760193">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760248">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760306">if</span>&nbsp;<span class="ident" id="5760309">tok</span>&nbsp;<span class="op" id="5760313">!=</span>&nbsp;<span class="ident" id="5760316">token</span><span class="op" id="5760321">.</span><span class="ident" id="5760322">RBRACE</span>&nbsp;<span class="op" id="5760329">&amp;&amp;</span>&nbsp;<span class="ident" id="5760332">pos</span><span class="op" id="5760335">.</span><span class="ident" id="5760336">Column</span>&nbsp;<span class="op" id="5760343">==</span>&nbsp;<span class="ident" id="5760346">next</span><span class="op" id="5760350">.</span><span class="ident" id="5760351">Column</span>&nbsp;<span class="op" id="5760358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760365">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760383">case</span>&nbsp;<span class="ident" id="5760388">newline</span><span class="op" id="5760395">,</span>&nbsp;<span class="ident" id="5760397">formfeed</span><span class="op" id="5760405">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760411">p</span><span class="op" id="5760412">.</span><span class="ident" id="5760413">wsbuf</span><span class="op" id="5760418">[</span><span class="ident" id="5760419">i</span><span class="op" id="5760420">]</span>&nbsp;<span class="op" id="5760422">=</span>&nbsp;<span class="ident" id="5760424">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760435">droppedLinebreak</span>&nbsp;<span class="op" id="5760452">=</span>&nbsp;<span class="ident" id="5760454">prev</span>&nbsp;<span class="op" id="5760459">==</span>&nbsp;<span class="ident" id="5760462">nil</span>&nbsp;<span class="comment" id="5760466">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760517">j</span>&nbsp;<span class="op" id="5760519">=</span>&nbsp;<span class="ident" id="5760521">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760526">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760538">p</span><span class="op" id="5760539">.</span><span class="ident" id="5760540">writeWhitespace</span><span class="op" id="5760555">(</span><span class="ident" id="5760556">j</span><span class="op" id="5760557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760562">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760617">n</span>&nbsp;<span class="op" id="5760619">:=</span>&nbsp;<span class="num" id="5760622">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760626">if</span>&nbsp;<span class="ident" id="5760629">pos</span><span class="op" id="5760632">.</span><span class="ident" id="5760633">IsValid</span><span class="op" id="5760640">(</span><span class="op" id="5760641">)</span>&nbsp;<span class="op" id="5760643">&amp;&amp;</span>&nbsp;<span class="ident" id="5760646">p</span><span class="op" id="5760647">.</span><span class="ident" id="5760648">last</span><span class="op" id="5760652">.</span><span class="ident" id="5760653">IsValid</span><span class="op" id="5760660">(</span><span class="op" id="5760661">)</span>&nbsp;<span class="op" id="5760663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760668">n</span>&nbsp;<span class="op" id="5760670">=</span>&nbsp;<span class="ident" id="5760672">pos</span><span class="op" id="5760675">.</span><span class="ident" id="5760676">Line</span>&nbsp;<span class="op" id="5760681">-</span>&nbsp;<span class="ident" id="5760683">p</span><span class="op" id="5760684">.</span><span class="ident" id="5760685">last</span><span class="op" id="5760689">.</span><span class="ident" id="5760690">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760698">if</span>&nbsp;<span class="ident" id="5760701">n</span>&nbsp;<span class="op" id="5760703">&lt;</span>&nbsp;<span class="num" id="5760705">0</span>&nbsp;<span class="op" id="5760707">{</span>&nbsp;<span class="comment" id="5760709">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760736">n</span>&nbsp;<span class="op" id="5760738">=</span>&nbsp;<span class="num" id="5760740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760745">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760754">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760808">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760860">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760914">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760968">if</span>&nbsp;<span class="ident" id="5760971">p</span><span class="op" id="5760972">.</span><span class="ident" id="5760973">indent</span>&nbsp;<span class="op" id="5760980">==</span>&nbsp;<span class="num" id="5760983">0</span>&nbsp;<span class="op" id="5760985">&amp;&amp;</span>&nbsp;<span class="ident" id="5760988">droppedLinebreak</span>&nbsp;<span class="op" id="5761005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761010">n</span><span class="op" id="5761011">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761021">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761069">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761117">if</span>&nbsp;<span class="ident" id="5761120">n</span>&nbsp;<span class="op" id="5761122">==</span>&nbsp;<span class="num" id="5761125">0</span>&nbsp;<span class="op" id="5761127">&amp;&amp;</span>&nbsp;<span class="ident" id="5761130">prev</span>&nbsp;<span class="op" id="5761135">!=</span>&nbsp;<span class="ident" id="5761138">nil</span>&nbsp;<span class="op" id="5761142">&amp;&amp;</span>&nbsp;<span class="ident" id="5761145">prev</span><span class="op" id="5761149">.</span><span class="ident" id="5761150">Text</span><span class="op" id="5761154">[</span><span class="num" id="5761155">1</span><span class="op" id="5761156">]</span>&nbsp;<span class="op" id="5761158">==</span>&nbsp;<span class="string" id="5761161">&#39;/&#39;</span>&nbsp;<span class="op" id="5761165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761170">n</span>&nbsp;<span class="op" id="5761172">=</span>&nbsp;<span class="num" id="5761174">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761178">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761183">if</span>&nbsp;<span class="ident" id="5761186">n</span>&nbsp;<span class="op" id="5761188">&gt;</span>&nbsp;<span class="num" id="5761190">0</span>&nbsp;<span class="op" id="5761192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761197">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761252">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761307">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761351">p</span><span class="op" id="5761352">.</span><span class="ident" id="5761353">writeByte</span><span class="op" id="5761362">(</span><span class="string" id="5761363">&#39;\f&#39;</span><span class="op" id="5761367">,</span>&nbsp;<span class="ident" id="5761369">nlimit</span><span class="op" id="5761375">(</span><span class="ident" id="5761376">n</span><span class="op" id="5761377">)</span><span class="op" id="5761378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761385">}</span><br>
<span class="lineno"></span><span class="op" id="5761387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5761390">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5761437">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5761500">//</span><br>
<span class="lineno"></span><span class="keyword" id="5761503">func</span>&nbsp;<span class="ident" id="5761508">isBlank</span><span class="op" id="5761515">(</span><span class="ident" id="5761516">s</span>&nbsp;<span class="builtintype" id="5761518">string</span><span class="op" id="5761524">)</span>&nbsp;<span class="builtintype" id="5761526">bool</span>&nbsp;<span class="op" id="5761531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761534">for</span>&nbsp;<span class="ident" id="5761538">i</span>&nbsp;<span class="op" id="5761540">:=</span>&nbsp;<span class="num" id="5761543">0</span><span class="op" id="5761544">;</span>&nbsp;<span class="ident" id="5761546">i</span>&nbsp;<span class="op" id="5761548">&lt;</span>&nbsp;<span class="builtinfunc" id="5761550">len</span><span class="op" id="5761553">(</span><span class="ident" id="5761554">s</span><span class="op" id="5761555">)</span><span class="op" id="5761556">;</span>&nbsp;<span class="ident" id="5761558">i</span><span class="op" id="5761559">++</span>&nbsp;<span class="op" id="5761562">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761566">if</span>&nbsp;<span class="ident" id="5761569">s</span><span class="op" id="5761570">[</span><span class="ident" id="5761571">i</span><span class="op" id="5761572">]</span>&nbsp;<span class="op" id="5761574">&gt;</span>&nbsp;<span class="string" id="5761576">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5761580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761585">return</span>&nbsp;<span class="ident" id="5761592">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761606">return</span>&nbsp;<span class="ident" id="5761613">true</span><br>
<span class="lineno">460</span><span class="op" id="5761618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761621">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5761675">func</span>&nbsp;<span class="ident" id="5761680">commonPrefix</span><span class="op" id="5761692">(</span><span class="ident" id="5761693">a</span><span class="op" id="5761694">,</span>&nbsp;<span class="ident" id="5761696">b</span>&nbsp;<span class="builtintype" id="5761698">string</span><span class="op" id="5761704">)</span>&nbsp;<span class="builtintype" id="5761706">string</span>&nbsp;<span class="op" id="5761713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761716">i</span>&nbsp;<span class="op" id="5761718">:=</span>&nbsp;<span class="num" id="5761721">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761724">for</span>&nbsp;<span class="ident" id="5761728">i</span>&nbsp;<span class="op" id="5761730">&lt;</span>&nbsp;<span class="builtinfunc" id="5761732">len</span><span class="op" id="5761735">(</span><span class="ident" id="5761736">a</span><span class="op" id="5761737">)</span>&nbsp;<span class="op" id="5761739">&amp;&amp;</span>&nbsp;<span class="ident" id="5761742">i</span>&nbsp;<span class="op" id="5761744">&lt;</span>&nbsp;<span class="builtinfunc" id="5761746">len</span><span class="op" id="5761749">(</span><span class="ident" id="5761750">b</span><span class="op" id="5761751">)</span>&nbsp;<span class="op" id="5761753">&amp;&amp;</span>&nbsp;<span class="ident" id="5761756">a</span><span class="op" id="5761757">[</span><span class="ident" id="5761758">i</span><span class="op" id="5761759">]</span>&nbsp;<span class="op" id="5761761">==</span>&nbsp;<span class="ident" id="5761764">b</span><span class="op" id="5761765">[</span><span class="ident" id="5761766">i</span><span class="op" id="5761767">]</span>&nbsp;<span class="op" id="5761769">&amp;&amp;</span>&nbsp;<span class="op" id="5761772">(</span><span class="ident" id="5761773">a</span><span class="op" id="5761774">[</span><span class="ident" id="5761775">i</span><span class="op" id="5761776">]</span>&nbsp;<span class="op" id="5761778">&lt;=</span>&nbsp;<span class="string" id="5761781">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5761785">||</span>&nbsp;<span class="ident" id="5761788">a</span><span class="op" id="5761789">[</span><span class="ident" id="5761790">i</span><span class="op" id="5761791">]</span>&nbsp;<span class="op" id="5761793">==</span>&nbsp;<span class="string" id="5761796">&#39;*&#39;</span><span class="op" id="5761799">)</span>&nbsp;<span class="op" id="5761801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761805">i</span><span class="op" id="5761806">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761813">return</span>&nbsp;<span class="ident" id="5761820">a</span><span class="op" id="5761821">[</span><span class="num" id="5761822">0</span><span class="op" id="5761823">:</span><span class="ident" id="5761824">i</span><span class="op" id="5761825">]</span><br>
<span class="lineno"></span><span class="op" id="5761827">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5761830">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5761887">func</span>&nbsp;<span class="ident" id="5761892">trimRight</span><span class="op" id="5761901">(</span><span class="ident" id="5761902">s</span>&nbsp;<span class="builtintype" id="5761904">string</span><span class="op" id="5761910">)</span>&nbsp;<span class="builtintype" id="5761912">string</span>&nbsp;<span class="op" id="5761919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761922">return</span>&nbsp;<span class="ident" id="5761929">strings</span><span class="op" id="5761936">.</span><span class="ident" id="5761937">TrimRightFunc</span><span class="op" id="5761950">(</span><span class="ident" id="5761951">s</span><span class="op" id="5761952">,</span>&nbsp;<span class="ident" id="5761954">unicode</span><span class="op" id="5761961">.</span><span class="ident" id="5761962">IsSpace</span><span class="op" id="5761969">)</span><br>
<span class="lineno"></span><span class="op" id="5761971">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5761974">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5762058">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5762143">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5762223">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5762303">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5762327">//</span><br>
<span class="lineno"></span><span class="keyword" id="5762330">func</span>&nbsp;<span class="ident" id="5762335">stripCommonPrefix</span><span class="op" id="5762352">(</span><span class="ident" id="5762353">lines</span>&nbsp;<span class="op" id="5762359">[</span><span class="op" id="5762360">]</span><span class="builtintype" id="5762361">string</span><span class="op" id="5762367">)</span>&nbsp;<span class="op" id="5762369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762372">if</span>&nbsp;<span class="builtinfunc" id="5762375">len</span><span class="op" id="5762378">(</span><span class="ident" id="5762379">lines</span><span class="op" id="5762384">)</span>&nbsp;<span class="op" id="5762386">&lt;=</span>&nbsp;<span class="num" id="5762389">1</span>&nbsp;<span class="op" id="5762391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762395">return</span>&nbsp;<span class="comment" id="5762402">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762442">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762462">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762519">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762576">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762630">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762688">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762746">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762804">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762845">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762907">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762969">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763030">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763091">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763151">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763165">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763169">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763229">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763289">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763343">var</span>&nbsp;<span class="ident" id="5763347">prefix</span>&nbsp;<span class="builtintype" id="5763354">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763362">if</span>&nbsp;<span class="builtinfunc" id="5763365">len</span><span class="op" id="5763368">(</span><span class="ident" id="5763369">lines</span><span class="op" id="5763374">)</span>&nbsp;<span class="op" id="5763376">&gt;</span>&nbsp;<span class="num" id="5763378">2</span>&nbsp;<span class="op" id="5763380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763384">first</span>&nbsp;<span class="op" id="5763390">:=</span>&nbsp;<span class="ident" id="5763393">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763400">for</span>&nbsp;<span class="ident" id="5763404">i</span><span class="op" id="5763405">,</span>&nbsp;<span class="ident" id="5763407">line</span>&nbsp;<span class="op" id="5763412">:=</span>&nbsp;<span class="keyword" id="5763415">range</span>&nbsp;<span class="ident" id="5763421">lines</span><span class="op" id="5763426">[</span><span class="num" id="5763427">1</span>&nbsp;<span class="op" id="5763429">:</span>&nbsp;<span class="builtinfunc" id="5763431">len</span><span class="op" id="5763434">(</span><span class="ident" id="5763435">lines</span><span class="op" id="5763440">)</span><span class="op" id="5763441">-</span><span class="num" id="5763442">1</span><span class="op" id="5763443">]</span>&nbsp;<span class="op" id="5763445">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763450">switch</span>&nbsp;<span class="op" id="5763457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763462">case</span>&nbsp;<span class="ident" id="5763467">isBlank</span><span class="op" id="5763474">(</span><span class="ident" id="5763475">line</span><span class="op" id="5763479">)</span><span class="op" id="5763480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763486">lines</span><span class="op" id="5763491">[</span><span class="num" id="5763492">1</span><span class="op" id="5763493">+</span><span class="ident" id="5763494">i</span><span class="op" id="5763495">]</span>&nbsp;<span class="op" id="5763497">=</span>&nbsp;<span class="string" id="5763499">&#34;&#34;</span>&nbsp;<span class="comment" id="5763502">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763535">case</span>&nbsp;<span class="ident" id="5763540">first</span><span class="op" id="5763545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763551">prefix</span>&nbsp;<span class="op" id="5763558">=</span>&nbsp;<span class="ident" id="5763560">commonPrefix</span><span class="op" id="5763572">(</span><span class="ident" id="5763573">line</span><span class="op" id="5763577">,</span>&nbsp;<span class="ident" id="5763579">line</span><span class="op" id="5763583">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763589">first</span>&nbsp;<span class="op" id="5763595">=</span>&nbsp;<span class="ident" id="5763597">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763606">default</span><span class="op" id="5763613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763619">prefix</span>&nbsp;<span class="op" id="5763626">=</span>&nbsp;<span class="ident" id="5763628">commonPrefix</span><span class="op" id="5763640">(</span><span class="ident" id="5763641">prefix</span><span class="op" id="5763647">,</span>&nbsp;<span class="ident" id="5763649">line</span><span class="op" id="5763653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763662">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763665">}</span>&nbsp;<span class="keyword" id="5763667">else</span>&nbsp;<span class="op" id="5763672">{</span>&nbsp;<span class="comment" id="5763674">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763738">line</span>&nbsp;<span class="op" id="5763743">:=</span>&nbsp;<span class="ident" id="5763746">lines</span><span class="op" id="5763751">[</span><span class="num" id="5763752">1</span><span class="op" id="5763753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763757">prefix</span>&nbsp;<span class="op" id="5763764">=</span>&nbsp;<span class="ident" id="5763766">commonPrefix</span><span class="op" id="5763778">(</span><span class="ident" id="5763779">line</span><span class="op" id="5763783">,</span>&nbsp;<span class="ident" id="5763785">line</span><span class="op" id="5763789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763796">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763876">lineOfStars</span>&nbsp;<span class="op" id="5763888">:=</span>&nbsp;<span class="ident" id="5763891">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763898">if</span>&nbsp;<span class="ident" id="5763901">i</span>&nbsp;<span class="op" id="5763903">:=</span>&nbsp;<span class="ident" id="5763906">strings</span><span class="op" id="5763913">.</span><span class="ident" id="5763914">Index</span><span class="op" id="5763919">(</span><span class="ident" id="5763920">prefix</span><span class="op" id="5763926">,</span>&nbsp;<span class="string" id="5763928">&#34;*&#34;</span><span class="op" id="5763931">)</span><span class="op" id="5763932">;</span>&nbsp;<span class="ident" id="5763934">i</span>&nbsp;<span class="op" id="5763936">&gt;=</span>&nbsp;<span class="num" id="5763939">0</span>&nbsp;<span class="op" id="5763941">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763945">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763973">if</span>&nbsp;<span class="ident" id="5763976">i</span>&nbsp;<span class="op" id="5763978">&gt;</span>&nbsp;<span class="num" id="5763980">0</span>&nbsp;<span class="op" id="5763982">&amp;&amp;</span>&nbsp;<span class="ident" id="5763985">prefix</span><span class="op" id="5763991">[</span><span class="ident" id="5763992">i</span><span class="op" id="5763993">-</span><span class="num" id="5763994">1</span><span class="op" id="5763995">]</span>&nbsp;<span class="op" id="5763997">==</span>&nbsp;<span class="string" id="5764000">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5764004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764009">i</span><span class="op" id="5764010">--</span>&nbsp;<span class="comment" id="5764013">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764080">prefix</span>&nbsp;<span class="op" id="5764087">=</span>&nbsp;<span class="ident" id="5764089">prefix</span><span class="op" id="5764095">[</span><span class="num" id="5764096">0</span><span class="op" id="5764097">:</span><span class="ident" id="5764098">i</span><span class="op" id="5764099">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764103">lineOfStars</span>&nbsp;<span class="op" id="5764115">=</span>&nbsp;<span class="ident" id="5764117">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764123">}</span>&nbsp;<span class="keyword" id="5764125">else</span>&nbsp;<span class="op" id="5764130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764134">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764165">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764227">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764289">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764352">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764413">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764475">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764536">first</span>&nbsp;<span class="op" id="5764542">:=</span>&nbsp;<span class="ident" id="5764545">lines</span><span class="op" id="5764550">[</span><span class="num" id="5764551">0</span><span class="op" id="5764552">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764556">if</span>&nbsp;<span class="ident" id="5764559">isBlank</span><span class="op" id="5764566">(</span><span class="ident" id="5764567">first</span><span class="op" id="5764572">[</span><span class="num" id="5764573">2</span><span class="op" id="5764574">:</span><span class="op" id="5764575">]</span><span class="op" id="5764576">)</span>&nbsp;<span class="op" id="5764578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764583">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764624">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764671">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764723">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764776">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764801">i</span>&nbsp;<span class="op" id="5764803">:=</span>&nbsp;<span class="builtinfunc" id="5764806">len</span><span class="op" id="5764809">(</span><span class="ident" id="5764810">prefix</span><span class="op" id="5764816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764821">for</span>&nbsp;<span class="ident" id="5764825">n</span>&nbsp;<span class="op" id="5764827">:=</span>&nbsp;<span class="num" id="5764830">0</span><span class="op" id="5764831">;</span>&nbsp;<span class="ident" id="5764833">n</span>&nbsp;<span class="op" id="5764835">&lt;</span>&nbsp;<span class="num" id="5764837">3</span>&nbsp;<span class="op" id="5764839">&amp;&amp;</span>&nbsp;<span class="ident" id="5764842">i</span>&nbsp;<span class="op" id="5764844">&gt;</span>&nbsp;<span class="num" id="5764846">0</span>&nbsp;<span class="op" id="5764848">&amp;&amp;</span>&nbsp;<span class="ident" id="5764851">prefix</span><span class="op" id="5764857">[</span><span class="ident" id="5764858">i</span><span class="op" id="5764859">-</span><span class="num" id="5764860">1</span><span class="op" id="5764861">]</span>&nbsp;<span class="op" id="5764863">==</span>&nbsp;<span class="string" id="5764866">&#39;&nbsp;&#39;</span><span class="op" id="5764869">;</span>&nbsp;<span class="ident" id="5764871">n</span><span class="op" id="5764872">++</span>&nbsp;<span class="op" id="5764875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764881">i</span><span class="op" id="5764882">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764888">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764893">if</span>&nbsp;<span class="ident" id="5764896">i</span>&nbsp;<span class="op" id="5764898">==</span>&nbsp;<span class="builtinfunc" id="5764901">len</span><span class="op" id="5764904">(</span><span class="ident" id="5764905">prefix</span><span class="op" id="5764911">)</span>&nbsp;<span class="op" id="5764913">&amp;&amp;</span>&nbsp;<span class="ident" id="5764916">i</span>&nbsp;<span class="op" id="5764918">&gt;</span>&nbsp;<span class="num" id="5764920">0</span>&nbsp;<span class="op" id="5764922">&amp;&amp;</span>&nbsp;<span class="ident" id="5764925">prefix</span><span class="op" id="5764931">[</span><span class="ident" id="5764932">i</span><span class="op" id="5764933">-</span><span class="num" id="5764934">1</span><span class="op" id="5764935">]</span>&nbsp;<span class="op" id="5764937">==</span>&nbsp;<span class="string" id="5764940">&#39;\t&#39;</span>&nbsp;<span class="op" id="5764945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764951">i</span><span class="op" id="5764952">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764963">prefix</span>&nbsp;<span class="op" id="5764970">=</span>&nbsp;<span class="ident" id="5764972">prefix</span><span class="op" id="5764978">[</span><span class="num" id="5764979">0</span><span class="op" id="5764980">:</span><span class="ident" id="5764981">i</span><span class="op" id="5764982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764986">}</span>&nbsp;<span class="keyword" id="5764988">else</span>&nbsp;<span class="op" id="5764993">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764998">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765035">suffix</span>&nbsp;<span class="op" id="5765042">:=</span>&nbsp;<span class="builtinfunc" id="5765045">make</span><span class="op" id="5765049">(</span><span class="op" id="5765050">[</span><span class="op" id="5765051">]</span><span class="builtintype" id="5765052">byte</span><span class="op" id="5765056">,</span>&nbsp;<span class="builtinfunc" id="5765058">len</span><span class="op" id="5765061">(</span><span class="ident" id="5765062">first</span><span class="op" id="5765067">)</span><span class="op" id="5765068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765073">n</span>&nbsp;<span class="op" id="5765075">:=</span>&nbsp;<span class="num" id="5765078">2</span>&nbsp;<span class="comment" id="5765080">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765109">for</span>&nbsp;<span class="ident" id="5765113">n</span>&nbsp;<span class="op" id="5765115">&lt;</span>&nbsp;<span class="builtinfunc" id="5765117">len</span><span class="op" id="5765120">(</span><span class="ident" id="5765121">first</span><span class="op" id="5765126">)</span>&nbsp;<span class="op" id="5765128">&amp;&amp;</span>&nbsp;<span class="ident" id="5765131">first</span><span class="op" id="5765136">[</span><span class="ident" id="5765137">n</span><span class="op" id="5765138">]</span>&nbsp;<span class="op" id="5765140">&lt;=</span>&nbsp;<span class="string" id="5765143">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5765147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765153">suffix</span><span class="op" id="5765159">[</span><span class="ident" id="5765160">n</span><span class="op" id="5765161">]</span>&nbsp;<span class="op" id="5765163">=</span>&nbsp;<span class="ident" id="5765165">first</span><span class="op" id="5765170">[</span><span class="ident" id="5765171">n</span><span class="op" id="5765172">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765178">n</span><span class="op" id="5765179">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765190">if</span>&nbsp;<span class="ident" id="5765193">n</span>&nbsp;<span class="op" id="5765195">&gt;</span>&nbsp;<span class="num" id="5765197">2</span>&nbsp;<span class="op" id="5765199">&amp;&amp;</span>&nbsp;<span class="ident" id="5765202">suffix</span><span class="op" id="5765208">[</span><span class="num" id="5765209">2</span><span class="op" id="5765210">]</span>&nbsp;<span class="op" id="5765212">==</span>&nbsp;<span class="string" id="5765215">&#39;\t&#39;</span>&nbsp;<span class="op" id="5765220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765226">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765272">suffix</span>&nbsp;<span class="op" id="5765279">=</span>&nbsp;<span class="ident" id="5765281">suffix</span><span class="op" id="5765287">[</span><span class="num" id="5765288">2</span><span class="op" id="5765289">:</span><span class="ident" id="5765290">n</span><span class="op" id="5765291">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765296">}</span>&nbsp;<span class="keyword" id="5765298">else</span>&nbsp;<span class="op" id="5765303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765309">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765344">suffix</span><span class="op" id="5765350">[</span><span class="num" id="5765351">0</span><span class="op" id="5765352">]</span><span class="op" id="5765353">,</span>&nbsp;<span class="ident" id="5765355">suffix</span><span class="op" id="5765361">[</span><span class="num" id="5765362">1</span><span class="op" id="5765363">]</span>&nbsp;<span class="op" id="5765365">=</span>&nbsp;<span class="string" id="5765367">&#39;&nbsp;&#39;</span><span class="op" id="5765370">,</span>&nbsp;<span class="string" id="5765372">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765380">suffix</span>&nbsp;<span class="op" id="5765387">=</span>&nbsp;<span class="ident" id="5765389">suffix</span><span class="op" id="5765395">[</span><span class="num" id="5765396">0</span><span class="op" id="5765397">:</span><span class="ident" id="5765398">n</span><span class="op" id="5765399">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765404">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765409">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765467">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765521">prefix</span>&nbsp;<span class="op" id="5765528">=</span>&nbsp;<span class="ident" id="5765530">strings</span><span class="op" id="5765537">.</span><span class="ident" id="5765538">TrimSuffix</span><span class="op" id="5765548">(</span><span class="ident" id="5765549">prefix</span><span class="op" id="5765555">,</span>&nbsp;<span class="builtintype" id="5765557">string</span><span class="op" id="5765563">(</span><span class="ident" id="5765564">suffix</span><span class="op" id="5765570">)</span><span class="op" id="5765571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765578">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765582">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765647">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765712">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765723">last</span>&nbsp;<span class="op" id="5765728">:=</span>&nbsp;<span class="ident" id="5765731">lines</span><span class="op" id="5765736">[</span><span class="builtinfunc" id="5765737">len</span><span class="op" id="5765740">(</span><span class="ident" id="5765741">lines</span><span class="op" id="5765746">)</span><span class="op" id="5765747">-</span><span class="num" id="5765748">1</span><span class="op" id="5765749">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765752">closing</span>&nbsp;<span class="op" id="5765760">:=</span>&nbsp;<span class="string" id="5765763">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765769">i</span>&nbsp;<span class="op" id="5765771">:=</span>&nbsp;<span class="ident" id="5765774">strings</span><span class="op" id="5765781">.</span><span class="ident" id="5765782">Index</span><span class="op" id="5765787">(</span><span class="ident" id="5765788">last</span><span class="op" id="5765792">,</span>&nbsp;<span class="ident" id="5765794">closing</span><span class="op" id="5765801">)</span>&nbsp;<span class="comment" id="5765803">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765842">if</span>&nbsp;<span class="ident" id="5765845">isBlank</span><span class="op" id="5765852">(</span><span class="ident" id="5765853">last</span><span class="op" id="5765857">[</span><span class="num" id="5765858">0</span><span class="op" id="5765859">:</span><span class="ident" id="5765860">i</span><span class="op" id="5765861">]</span><span class="op" id="5765862">)</span>&nbsp;<span class="op" id="5765864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765868">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765908">if</span>&nbsp;<span class="ident" id="5765911">lineOfStars</span>&nbsp;<span class="op" id="5765923">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765928">closing</span>&nbsp;<span class="op" id="5765936">=</span>&nbsp;<span class="string" id="5765938">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5765944">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765983">lines</span><span class="op" id="5765988">[</span><span class="builtinfunc" id="5765989">len</span><span class="op" id="5765992">(</span><span class="ident" id="5765993">lines</span><span class="op" id="5765998">)</span><span class="op" id="5765999">-</span><span class="num" id="5766000">1</span><span class="op" id="5766001">]</span>&nbsp;<span class="op" id="5766003">=</span>&nbsp;<span class="ident" id="5766005">prefix</span>&nbsp;<span class="op" id="5766012">+</span>&nbsp;<span class="ident" id="5766014">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766023">}</span>&nbsp;<span class="keyword" id="5766025">else</span>&nbsp;<span class="op" id="5766030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766034">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766085">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766137">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766164">prefix</span>&nbsp;<span class="op" id="5766171">=</span>&nbsp;<span class="ident" id="5766173">commonPrefix</span><span class="op" id="5766185">(</span><span class="ident" id="5766186">prefix</span><span class="op" id="5766192">,</span>&nbsp;<span class="ident" id="5766194">last</span><span class="op" id="5766198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766205">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766274">for</span>&nbsp;<span class="ident" id="5766278">i</span><span class="op" id="5766279">,</span>&nbsp;<span class="ident" id="5766281">line</span>&nbsp;<span class="op" id="5766286">:=</span>&nbsp;<span class="keyword" id="5766289">range</span>&nbsp;<span class="ident" id="5766295">lines</span>&nbsp;<span class="op" id="5766301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766305">if</span>&nbsp;<span class="ident" id="5766308">i</span>&nbsp;<span class="op" id="5766310">&gt;</span>&nbsp;<span class="num" id="5766312">0</span>&nbsp;<span class="op" id="5766314">&amp;&amp;</span>&nbsp;<span class="ident" id="5766317">line</span>&nbsp;<span class="op" id="5766322">!=</span>&nbsp;<span class="string" id="5766325">&#34;&#34;</span>&nbsp;<span class="op" id="5766328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766333">lines</span><span class="op" id="5766338">[</span><span class="ident" id="5766339">i</span><span class="op" id="5766340">]</span>&nbsp;<span class="op" id="5766342">=</span>&nbsp;<span class="ident" id="5766344">line</span><span class="op" id="5766348">[</span><span class="builtinfunc" id="5766349">len</span><span class="op" id="5766352">(</span><span class="ident" id="5766353">prefix</span><span class="op" id="5766359">)</span><span class="op" id="5766360">:</span><span class="op" id="5766361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766365">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766368">}</span><br>
<span class="lineno"></span><span class="op" id="5766370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5766373">func</span>&nbsp;<span class="op" id="5766378">(</span><span class="ident" id="5766379">p</span>&nbsp;<span class="op" id="5766381">*</span><span class="ident" id="5766382">printer</span><span class="op" id="5766389">)</span>&nbsp;<span class="ident" id="5766391">writeComment</span><span class="op" id="5766403">(</span><span class="ident" id="5766404">comment</span>&nbsp;<span class="op" id="5766412">*</span><span class="ident" id="5766413">ast</span><span class="op" id="5766416">.</span><span class="ident" id="5766417">Comment</span><span class="op" id="5766424">)</span>&nbsp;<span class="op" id="5766426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766429">text</span>&nbsp;<span class="op" id="5766434">:=</span>&nbsp;<span class="ident" id="5766437">comment</span><span class="op" id="5766444">.</span><span class="ident" id="5766445">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766451">pos</span>&nbsp;<span class="op" id="5766455">:=</span>&nbsp;<span class="ident" id="5766458">p</span><span class="op" id="5766459">.</span><span class="ident" id="5766460">posFor</span><span class="op" id="5766466">(</span><span class="ident" id="5766467">comment</span><span class="op" id="5766474">.</span><span class="ident" id="5766475">Pos</span><span class="op" id="5766478">(</span><span class="op" id="5766479">)</span><span class="op" id="5766480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766484">const</span>&nbsp;<span class="ident" id="5766490">linePrefix</span>&nbsp;<span class="op" id="5766501">=</span>&nbsp;<span class="string" id="5766503">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766514">if</span>&nbsp;<span class="ident" id="5766517">strings</span><span class="op" id="5766524">.</span><span class="ident" id="5766525">HasPrefix</span><span class="op" id="5766534">(</span><span class="ident" id="5766535">text</span><span class="op" id="5766539">,</span>&nbsp;<span class="ident" id="5766541">linePrefix</span><span class="op" id="5766551">)</span>&nbsp;<span class="op" id="5766553">&amp;&amp;</span>&nbsp;<span class="op" id="5766556">(</span><span class="op" id="5766557">!</span><span class="ident" id="5766558">pos</span><span class="op" id="5766561">.</span><span class="ident" id="5766562">IsValid</span><span class="op" id="5766569">(</span><span class="op" id="5766570">)</span>&nbsp;<span class="op" id="5766572">||</span>&nbsp;<span class="ident" id="5766575">pos</span><span class="op" id="5766578">.</span><span class="ident" id="5766579">Column</span>&nbsp;<span class="op" id="5766586">==</span>&nbsp;<span class="num" id="5766589">1</span><span class="op" id="5766590">)</span>&nbsp;<span class="op" id="5766592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766596">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766627">ldir</span>&nbsp;<span class="op" id="5766632">:=</span>&nbsp;<span class="ident" id="5766635">strings</span><span class="op" id="5766642">.</span><span class="ident" id="5766643">TrimSpace</span><span class="op" id="5766652">(</span><span class="ident" id="5766653">text</span><span class="op" id="5766657">[</span><span class="builtinfunc" id="5766658">len</span><span class="op" id="5766661">(</span><span class="ident" id="5766662">linePrefix</span><span class="op" id="5766672">)</span><span class="op" id="5766673">:</span><span class="op" id="5766674">]</span><span class="op" id="5766675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766679">if</span>&nbsp;<span class="ident" id="5766682">i</span>&nbsp;<span class="op" id="5766684">:=</span>&nbsp;<span class="ident" id="5766687">strings</span><span class="op" id="5766694">.</span><span class="ident" id="5766695">LastIndex</span><span class="op" id="5766704">(</span><span class="ident" id="5766705">ldir</span><span class="op" id="5766709">,</span>&nbsp;<span class="string" id="5766711">&#34;:&#34;</span><span class="op" id="5766714">)</span><span class="op" id="5766715">;</span>&nbsp;<span class="ident" id="5766717">i</span>&nbsp;<span class="op" id="5766719">&gt;=</span>&nbsp;<span class="num" id="5766722">0</span>&nbsp;<span class="op" id="5766724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766729">if</span>&nbsp;<span class="ident" id="5766732">line</span><span class="op" id="5766736">,</span>&nbsp;<span class="ident" id="5766738">err</span>&nbsp;<span class="op" id="5766742">:=</span>&nbsp;<span class="ident" id="5766745">strconv</span><span class="op" id="5766752">.</span><span class="ident" id="5766753">Atoi</span><span class="op" id="5766757">(</span><span class="ident" id="5766758">ldir</span><span class="op" id="5766762">[</span><span class="ident" id="5766763">i</span><span class="op" id="5766764">+</span><span class="num" id="5766765">1</span><span class="op" id="5766766">:</span><span class="op" id="5766767">]</span><span class="op" id="5766768">)</span><span class="op" id="5766769">;</span>&nbsp;<span class="ident" id="5766771">err</span>&nbsp;<span class="op" id="5766775">==</span>&nbsp;<span class="ident" id="5766778">nil</span>&nbsp;<span class="op" id="5766782">&amp;&amp;</span>&nbsp;<span class="ident" id="5766785">line</span>&nbsp;<span class="op" id="5766790">&gt;</span>&nbsp;<span class="num" id="5766792">0</span>&nbsp;<span class="op" id="5766794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766800">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766856">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766912">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766968">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767024">indent</span>&nbsp;<span class="op" id="5767031">:=</span>&nbsp;<span class="ident" id="5767034">p</span><span class="op" id="5767035">.</span><span class="ident" id="5767036">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767047">p</span><span class="op" id="5767048">.</span><span class="ident" id="5767049">indent</span>&nbsp;<span class="op" id="5767056">=</span>&nbsp;<span class="num" id="5767058">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767064">defer</span>&nbsp;<span class="keyword" id="5767070">func</span><span class="op" id="5767074">(</span><span class="op" id="5767075">)</span>&nbsp;<span class="op" id="5767077">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767084">p</span><span class="op" id="5767085">.</span><span class="ident" id="5767086">pos</span><span class="op" id="5767089">.</span><span class="ident" id="5767090">Filename</span>&nbsp;<span class="op" id="5767099">=</span>&nbsp;<span class="ident" id="5767101">ldir</span><span class="op" id="5767105">[</span><span class="op" id="5767106">:</span><span class="ident" id="5767107">i</span><span class="op" id="5767108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767115">p</span><span class="op" id="5767116">.</span><span class="ident" id="5767117">pos</span><span class="op" id="5767120">.</span><span class="ident" id="5767121">Line</span>&nbsp;<span class="op" id="5767126">=</span>&nbsp;<span class="ident" id="5767128">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767138">p</span><span class="op" id="5767139">.</span><span class="ident" id="5767140">pos</span><span class="op" id="5767143">.</span><span class="ident" id="5767144">Column</span>&nbsp;<span class="op" id="5767151">=</span>&nbsp;<span class="num" id="5767153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767160">p</span><span class="op" id="5767161">.</span><span class="ident" id="5767162">indent</span>&nbsp;<span class="op" id="5767169">=</span>&nbsp;<span class="ident" id="5767171">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767182">}</span><span class="op" id="5767183">(</span><span class="op" id="5767184">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767200">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767246">if</span>&nbsp;<span class="ident" id="5767249">text</span><span class="op" id="5767253">[</span><span class="num" id="5767254">1</span><span class="op" id="5767255">]</span>&nbsp;<span class="op" id="5767257">==</span>&nbsp;<span class="string" id="5767260">&#39;/&#39;</span>&nbsp;<span class="op" id="5767264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767268">p</span><span class="op" id="5767269">.</span><span class="ident" id="5767270">writeString</span><span class="op" id="5767281">(</span><span class="ident" id="5767282">pos</span><span class="op" id="5767285">,</span>&nbsp;<span class="ident" id="5767287">trimRight</span><span class="op" id="5767296">(</span><span class="ident" id="5767297">text</span><span class="op" id="5767301">)</span><span class="op" id="5767302">,</span>&nbsp;<span class="ident" id="5767304">true</span><span class="op" id="5767308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767324">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767382">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767437">lines</span>&nbsp;<span class="op" id="5767443">:=</span>&nbsp;<span class="ident" id="5767446">strings</span><span class="op" id="5767453">.</span><span class="ident" id="5767454">Split</span><span class="op" id="5767459">(</span><span class="ident" id="5767460">text</span><span class="op" id="5767464">,</span>&nbsp;<span class="string" id="5767466">&#34;\n&#34;</span><span class="op" id="5767470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767474">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767531">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767593">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767654">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767717">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767777">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767807">if</span>&nbsp;<span class="ident" id="5767810">pos</span><span class="op" id="5767813">.</span><span class="ident" id="5767814">IsValid</span><span class="op" id="5767821">(</span><span class="op" id="5767822">)</span>&nbsp;<span class="op" id="5767824">&amp;&amp;</span>&nbsp;<span class="ident" id="5767827">pos</span><span class="op" id="5767830">.</span><span class="ident" id="5767831">Column</span>&nbsp;<span class="op" id="5767838">==</span>&nbsp;<span class="num" id="5767841">1</span>&nbsp;<span class="op" id="5767843">&amp;&amp;</span>&nbsp;<span class="ident" id="5767846">p</span><span class="op" id="5767847">.</span><span class="ident" id="5767848">indent</span>&nbsp;<span class="op" id="5767855">&gt;</span>&nbsp;<span class="num" id="5767857">0</span>&nbsp;<span class="op" id="5767859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767863">for</span>&nbsp;<span class="ident" id="5767867">i</span><span class="op" id="5767868">,</span>&nbsp;<span class="ident" id="5767870">line</span>&nbsp;<span class="op" id="5767875">:=</span>&nbsp;<span class="keyword" id="5767878">range</span>&nbsp;<span class="ident" id="5767884">lines</span><span class="op" id="5767889">[</span><span class="num" id="5767890">1</span><span class="op" id="5767891">:</span><span class="op" id="5767892">]</span>&nbsp;<span class="op" id="5767894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767899">lines</span><span class="op" id="5767904">[</span><span class="num" id="5767905">1</span><span class="op" id="5767906">+</span><span class="ident" id="5767907">i</span><span class="op" id="5767908">]</span>&nbsp;<span class="op" id="5767910">=</span>&nbsp;<span class="string" id="5767912">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5767918">+</span>&nbsp;<span class="ident" id="5767920">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767930">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767934">stripCommonPrefix</span><span class="op" id="5767951">(</span><span class="ident" id="5767952">lines</span><span class="op" id="5767957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767961">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768009">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768054">for</span>&nbsp;<span class="ident" id="5768058">i</span><span class="op" id="5768059">,</span>&nbsp;<span class="ident" id="5768061">line</span>&nbsp;<span class="op" id="5768066">:=</span>&nbsp;<span class="keyword" id="5768069">range</span>&nbsp;<span class="ident" id="5768075">lines</span>&nbsp;<span class="op" id="5768081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768085">if</span>&nbsp;<span class="ident" id="5768088">i</span>&nbsp;<span class="op" id="5768090">&gt;</span>&nbsp;<span class="num" id="5768092">0</span>&nbsp;<span class="op" id="5768094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768099">p</span><span class="op" id="5768100">.</span><span class="ident" id="5768101">writeByte</span><span class="op" id="5768110">(</span><span class="string" id="5768111">&#39;\f&#39;</span><span class="op" id="5768115">,</span>&nbsp;<span class="num" id="5768117">1</span><span class="op" id="5768118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768123">pos</span>&nbsp;<span class="op" id="5768127">=</span>&nbsp;<span class="ident" id="5768129">p</span><span class="op" id="5768130">.</span><span class="ident" id="5768131">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768137">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768141">if</span>&nbsp;<span class="builtinfunc" id="5768144">len</span><span class="op" id="5768147">(</span><span class="ident" id="5768148">line</span><span class="op" id="5768152">)</span>&nbsp;<span class="op" id="5768154">&gt;</span>&nbsp;<span class="num" id="5768156">0</span>&nbsp;<span class="op" id="5768158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768163">p</span><span class="op" id="5768164">.</span><span class="ident" id="5768165">writeString</span><span class="op" id="5768176">(</span><span class="ident" id="5768177">pos</span><span class="op" id="5768180">,</span>&nbsp;<span class="ident" id="5768182">trimRight</span><span class="op" id="5768191">(</span><span class="ident" id="5768192">line</span><span class="op" id="5768196">)</span><span class="op" id="5768197">,</span>&nbsp;<span class="ident" id="5768199">true</span><span class="op" id="5768203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768210">}</span><br>
<span class="lineno"></span><span class="op" id="5768212">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5768215">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5768286">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5768357">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5768426">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5768494">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5768566">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5768577">//</span><br>
<span class="lineno"></span><span class="keyword" id="5768580">func</span>&nbsp;<span class="op" id="5768585">(</span><span class="ident" id="5768586">p</span>&nbsp;<span class="op" id="5768588">*</span><span class="ident" id="5768589">printer</span><span class="op" id="5768596">)</span>&nbsp;<span class="ident" id="5768598">writeCommentSuffix</span><span class="op" id="5768616">(</span><span class="ident" id="5768617">needsLinebreak</span>&nbsp;<span class="builtintype" id="5768632">bool</span><span class="op" id="5768636">)</span>&nbsp;<span class="op" id="5768638">(</span><span class="ident" id="5768639">wroteNewline</span><span class="op" id="5768651">,</span>&nbsp;<span class="ident" id="5768653">droppedFF</span>&nbsp;<span class="builtintype" id="5768663">bool</span><span class="op" id="5768667">)</span>&nbsp;<span class="op" id="5768669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768672">for</span>&nbsp;<span class="ident" id="5768676">i</span><span class="op" id="5768677">,</span>&nbsp;<span class="ident" id="5768679">ch</span>&nbsp;<span class="op" id="5768682">:=</span>&nbsp;<span class="keyword" id="5768685">range</span>&nbsp;<span class="ident" id="5768691">p</span><span class="op" id="5768692">.</span><span class="ident" id="5768693">wsbuf</span>&nbsp;<span class="op" id="5768699">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768703">switch</span>&nbsp;<span class="ident" id="5768710">ch</span>&nbsp;<span class="op" id="5768713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768717">case</span>&nbsp;<span class="ident" id="5768722">blank</span><span class="op" id="5768727">,</span>&nbsp;<span class="ident" id="5768729">vtab</span><span class="op" id="5768733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768738">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768771">p</span><span class="op" id="5768772">.</span><span class="ident" id="5768773">wsbuf</span><span class="op" id="5768778">[</span><span class="ident" id="5768779">i</span><span class="op" id="5768780">]</span>&nbsp;<span class="op" id="5768782">=</span>&nbsp;<span class="ident" id="5768784">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768793">case</span>&nbsp;<span class="ident" id="5768798">indent</span><span class="op" id="5768804">,</span>&nbsp;<span class="ident" id="5768806">unindent</span><span class="op" id="5768814">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768819">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768859">case</span>&nbsp;<span class="ident" id="5768864">newline</span><span class="op" id="5768871">,</span>&nbsp;<span class="ident" id="5768873">formfeed</span><span class="op" id="5768881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768886">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768934">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768981">if</span>&nbsp;<span class="ident" id="5768984">needsLinebreak</span>&nbsp;<span class="op" id="5768999">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769005">needsLinebreak</span>&nbsp;<span class="op" id="5769020">=</span>&nbsp;<span class="ident" id="5769022">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769032">wroteNewline</span>&nbsp;<span class="op" id="5769045">=</span>&nbsp;<span class="ident" id="5769047">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769055">}</span>&nbsp;<span class="keyword" id="5769057">else</span>&nbsp;<span class="op" id="5769062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769068">if</span>&nbsp;<span class="ident" id="5769071">ch</span>&nbsp;<span class="op" id="5769074">==</span>&nbsp;<span class="ident" id="5769077">formfeed</span>&nbsp;<span class="op" id="5769086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769093">droppedFF</span>&nbsp;<span class="op" id="5769103">=</span>&nbsp;<span class="ident" id="5769105">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769120">p</span><span class="op" id="5769121">.</span><span class="ident" id="5769122">wsbuf</span><span class="op" id="5769127">[</span><span class="ident" id="5769128">i</span><span class="op" id="5769129">]</span>&nbsp;<span class="op" id="5769131">=</span>&nbsp;<span class="ident" id="5769133">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769150">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769153">p</span><span class="op" id="5769154">.</span><span class="ident" id="5769155">writeWhitespace</span><span class="op" id="5769170">(</span><span class="builtinfunc" id="5769171">len</span><span class="op" id="5769174">(</span><span class="ident" id="5769175">p</span><span class="op" id="5769176">.</span><span class="ident" id="5769177">wsbuf</span><span class="op" id="5769182">)</span><span class="op" id="5769183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5769187">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769222">if</span>&nbsp;<span class="ident" id="5769225">needsLinebreak</span>&nbsp;<span class="op" id="5769240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769244">p</span><span class="op" id="5769245">.</span><span class="ident" id="5769246">writeByte</span><span class="op" id="5769255">(</span><span class="string" id="5769256">&#39;\n&#39;</span><span class="op" id="5769260">,</span>&nbsp;<span class="num" id="5769262">1</span><span class="op" id="5769263">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769267">wroteNewline</span>&nbsp;<span class="op" id="5769280">=</span>&nbsp;<span class="ident" id="5769282">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769292">return</span><br>
<span class="lineno"></span><span class="op" id="5769299">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5769302">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5769381">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5769462">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5769541">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5769619">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5769699">//</span><br>
<span class="lineno"></span><span class="keyword" id="5769702">func</span>&nbsp;<span class="op" id="5769707">(</span><span class="ident" id="5769708">p</span>&nbsp;<span class="op" id="5769710">*</span><span class="ident" id="5769711">printer</span><span class="op" id="5769718">)</span>&nbsp;<span class="ident" id="5769720">intersperseComments</span><span class="op" id="5769739">(</span><span class="ident" id="5769740">next</span>&nbsp;<span class="ident" id="5769745">token</span><span class="op" id="5769750">.</span><span class="ident" id="5769751">Position</span><span class="op" id="5769759">,</span>&nbsp;<span class="ident" id="5769761">tok</span>&nbsp;<span class="ident" id="5769765">token</span><span class="op" id="5769770">.</span><span class="ident" id="5769771">Token</span><span class="op" id="5769776">)</span>&nbsp;<span class="op" id="5769778">(</span><span class="ident" id="5769779">wroteNewline</span><span class="op" id="5769791">,</span>&nbsp;<span class="ident" id="5769793">droppedFF</span>&nbsp;<span class="builtintype" id="5769803">bool</span><span class="op" id="5769807">)</span>&nbsp;<span class="op" id="5769809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769812">var</span>&nbsp;<span class="ident" id="5769816">last</span>&nbsp;<span class="op" id="5769821">*</span><span class="ident" id="5769822">ast</span><span class="op" id="5769825">.</span><span class="ident" id="5769826">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769835">for</span>&nbsp;<span class="ident" id="5769839">p</span><span class="op" id="5769840">.</span><span class="ident" id="5769841">commentBefore</span><span class="op" id="5769854">(</span><span class="ident" id="5769855">next</span><span class="op" id="5769859">)</span>&nbsp;<span class="op" id="5769861">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769865">for</span>&nbsp;<span class="ident" id="5769869">_</span><span class="op" id="5769870">,</span>&nbsp;<span class="ident" id="5769872">c</span>&nbsp;<span class="op" id="5769874">:=</span>&nbsp;<span class="keyword" id="5769877">range</span>&nbsp;<span class="ident" id="5769883">p</span><span class="op" id="5769884">.</span><span class="ident" id="5769885">comment</span><span class="op" id="5769892">.</span><span class="ident" id="5769893">List</span>&nbsp;<span class="op" id="5769898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769903">p</span><span class="op" id="5769904">.</span><span class="ident" id="5769905">writeCommentPrefix</span><span class="op" id="5769923">(</span><span class="ident" id="5769924">p</span><span class="op" id="5769925">.</span><span class="ident" id="5769926">posFor</span><span class="op" id="5769932">(</span><span class="ident" id="5769933">c</span><span class="op" id="5769934">.</span><span class="ident" id="5769935">Pos</span><span class="op" id="5769938">(</span><span class="op" id="5769939">)</span><span class="op" id="5769940">)</span><span class="op" id="5769941">,</span>&nbsp;<span class="ident" id="5769943">next</span><span class="op" id="5769947">,</span>&nbsp;<span class="ident" id="5769949">last</span><span class="op" id="5769953">,</span>&nbsp;<span class="ident" id="5769955">c</span><span class="op" id="5769956">,</span>&nbsp;<span class="ident" id="5769958">tok</span><span class="op" id="5769961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769966">p</span><span class="op" id="5769967">.</span><span class="ident" id="5769968">writeComment</span><span class="op" id="5769980">(</span><span class="ident" id="5769981">c</span><span class="op" id="5769982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769987">last</span>&nbsp;<span class="op" id="5769992">=</span>&nbsp;<span class="ident" id="5769994">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769998">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770002">p</span><span class="op" id="5770003">.</span><span class="ident" id="5770004">nextComment</span><span class="op" id="5770015">(</span><span class="op" id="5770016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770023">if</span>&nbsp;<span class="ident" id="5770026">last</span>&nbsp;<span class="op" id="5770031">!=</span>&nbsp;<span class="ident" id="5770034">nil</span>&nbsp;<span class="op" id="5770038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770042">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770107">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770177">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770245">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770311">if</span>&nbsp;<span class="ident" id="5770314">p</span><span class="op" id="5770315">.</span><span class="ident" id="5770316">mode</span><span class="op" id="5770320">&amp;</span><span class="ident" id="5770321">noExtraBlank</span>&nbsp;<span class="op" id="5770334">==</span>&nbsp;<span class="num" id="5770337">0</span>&nbsp;<span class="op" id="5770339">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770345">last</span><span class="op" id="5770349">.</span><span class="ident" id="5770350">Text</span><span class="op" id="5770354">[</span><span class="num" id="5770355">1</span><span class="op" id="5770356">]</span>&nbsp;<span class="op" id="5770358">==</span>&nbsp;<span class="string" id="5770361">&#39;*&#39;</span>&nbsp;<span class="op" id="5770365">&amp;&amp;</span>&nbsp;<span class="ident" id="5770368">p</span><span class="op" id="5770369">.</span><span class="ident" id="5770370">lineFor</span><span class="op" id="5770377">(</span><span class="ident" id="5770378">last</span><span class="op" id="5770382">.</span><span class="ident" id="5770383">Pos</span><span class="op" id="5770386">(</span><span class="op" id="5770387">)</span><span class="op" id="5770388">)</span>&nbsp;<span class="op" id="5770390">==</span>&nbsp;<span class="ident" id="5770393">next</span><span class="op" id="5770397">.</span><span class="ident" id="5770398">Line</span>&nbsp;<span class="op" id="5770403">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770409">tok</span>&nbsp;<span class="op" id="5770413">!=</span>&nbsp;<span class="ident" id="5770416">token</span><span class="op" id="5770421">.</span><span class="ident" id="5770422">COMMA</span>&nbsp;<span class="op" id="5770428">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770434">(</span><span class="ident" id="5770435">tok</span>&nbsp;<span class="op" id="5770439">!=</span>&nbsp;<span class="ident" id="5770442">token</span><span class="op" id="5770447">.</span><span class="ident" id="5770448">RPAREN</span>&nbsp;<span class="op" id="5770455">||</span>&nbsp;<span class="ident" id="5770458">p</span><span class="op" id="5770459">.</span><span class="ident" id="5770460">prevOpen</span>&nbsp;<span class="op" id="5770469">==</span>&nbsp;<span class="ident" id="5770472">token</span><span class="op" id="5770477">.</span><span class="ident" id="5770478">LPAREN</span><span class="op" id="5770484">)</span>&nbsp;<span class="op" id="5770486">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770492">(</span><span class="ident" id="5770493">tok</span>&nbsp;<span class="op" id="5770497">!=</span>&nbsp;<span class="ident" id="5770500">token</span><span class="op" id="5770505">.</span><span class="ident" id="5770506">RBRACK</span>&nbsp;<span class="op" id="5770513">||</span>&nbsp;<span class="ident" id="5770516">p</span><span class="op" id="5770517">.</span><span class="ident" id="5770518">prevOpen</span>&nbsp;<span class="op" id="5770527">==</span>&nbsp;<span class="ident" id="5770530">token</span><span class="op" id="5770535">.</span><span class="ident" id="5770536">LBRACK</span><span class="op" id="5770542">)</span>&nbsp;<span class="op" id="5770544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770549">p</span><span class="op" id="5770550">.</span><span class="ident" id="5770551">writeByte</span><span class="op" id="5770560">(</span><span class="string" id="5770561">&#39;&nbsp;&#39;</span><span class="op" id="5770564">,</span>&nbsp;<span class="num" id="5770566">1</span><span class="op" id="5770567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770571">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770575">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770640">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770704">needsLinebreak</span>&nbsp;<span class="op" id="5770719">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770725">last</span><span class="op" id="5770729">.</span><span class="ident" id="5770730">Text</span><span class="op" id="5770734">[</span><span class="num" id="5770735">1</span><span class="op" id="5770736">]</span>&nbsp;<span class="op" id="5770738">==</span>&nbsp;<span class="string" id="5770741">&#39;/&#39;</span>&nbsp;<span class="op" id="5770745">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770752">tok</span>&nbsp;<span class="op" id="5770756">==</span>&nbsp;<span class="ident" id="5770759">token</span><span class="op" id="5770764">.</span><span class="ident" id="5770765">RBRACE</span>&nbsp;<span class="op" id="5770772">&amp;&amp;</span>&nbsp;<span class="ident" id="5770775">p</span><span class="op" id="5770776">.</span><span class="ident" id="5770777">mode</span><span class="op" id="5770781">&amp;</span><span class="ident" id="5770782">noExtraLinebreak</span>&nbsp;<span class="op" id="5770799">==</span>&nbsp;<span class="num" id="5770802">0</span>&nbsp;<span class="op" id="5770804">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770811">tok</span>&nbsp;<span class="op" id="5770815">==</span>&nbsp;<span class="ident" id="5770818">token</span><span class="op" id="5770823">.</span><span class="ident" id="5770824">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770830">return</span>&nbsp;<span class="ident" id="5770837">p</span><span class="op" id="5770838">.</span><span class="ident" id="5770839">writeCommentSuffix</span><span class="op" id="5770857">(</span><span class="ident" id="5770858">needsLinebreak</span><span class="op" id="5770872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770879">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770941">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770999">p</span><span class="op" id="5771000">.</span><span class="ident" id="5771001">internalError</span><span class="op" id="5771014">(</span><span class="string" id="5771015">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5771068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771071">return</span><br>
<span class="lineno"></span><span class="op" id="5771078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5771081">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5771139">func</span>&nbsp;<span class="op" id="5771144">(</span><span class="ident" id="5771145">p</span>&nbsp;<span class="op" id="5771147">*</span><span class="ident" id="5771148">printer</span><span class="op" id="5771155">)</span>&nbsp;<span class="ident" id="5771157">writeWhitespace</span><span class="op" id="5771172">(</span><span class="ident" id="5771173">n</span>&nbsp;<span class="builtintype" id="5771175">int</span><span class="op" id="5771178">)</span>&nbsp;<span class="op" id="5771180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771183">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771201">for</span>&nbsp;<span class="ident" id="5771205">i</span>&nbsp;<span class="op" id="5771207">:=</span>&nbsp;<span class="num" id="5771210">0</span><span class="op" id="5771211">;</span>&nbsp;<span class="ident" id="5771213">i</span>&nbsp;<span class="op" id="5771215">&lt;</span>&nbsp;<span class="ident" id="5771217">n</span><span class="op" id="5771218">;</span>&nbsp;<span class="ident" id="5771220">i</span><span class="op" id="5771221">++</span>&nbsp;<span class="op" id="5771224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771228">switch</span>&nbsp;<span class="ident" id="5771235">ch</span>&nbsp;<span class="op" id="5771238">:=</span>&nbsp;<span class="ident" id="5771241">p</span><span class="op" id="5771242">.</span><span class="ident" id="5771243">wsbuf</span><span class="op" id="5771248">[</span><span class="ident" id="5771249">i</span><span class="op" id="5771250">]</span><span class="op" id="5771251">;</span>&nbsp;<span class="ident" id="5771253">ch</span>&nbsp;<span class="op" id="5771256">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771260">case</span>&nbsp;<span class="ident" id="5771265">ignore</span><span class="op" id="5771271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771276">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771289">case</span>&nbsp;<span class="ident" id="5771294">indent</span><span class="op" id="5771300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771305">p</span><span class="op" id="5771306">.</span><span class="ident" id="5771307">indent</span><span class="op" id="5771313">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771318">case</span>&nbsp;<span class="ident" id="5771323">unindent</span><span class="op" id="5771331">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771336">p</span><span class="op" id="5771337">.</span><span class="ident" id="5771338">indent</span><span class="op" id="5771344">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771350">if</span>&nbsp;<span class="ident" id="5771353">p</span><span class="op" id="5771354">.</span><span class="ident" id="5771355">indent</span>&nbsp;<span class="op" id="5771362">&lt;</span>&nbsp;<span class="num" id="5771364">0</span>&nbsp;<span class="op" id="5771366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771372">p</span><span class="op" id="5771373">.</span><span class="ident" id="5771374">internalError</span><span class="op" id="5771387">(</span><span class="string" id="5771388">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5771411">,</span>&nbsp;<span class="ident" id="5771413">p</span><span class="op" id="5771414">.</span><span class="ident" id="5771415">indent</span><span class="op" id="5771421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771427">p</span><span class="op" id="5771428">.</span><span class="ident" id="5771429">indent</span>&nbsp;<span class="op" id="5771436">=</span>&nbsp;<span class="num" id="5771438">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771443">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771447">case</span>&nbsp;<span class="ident" id="5771452">newline</span><span class="op" id="5771459">,</span>&nbsp;<span class="ident" id="5771461">formfeed</span><span class="op" id="5771469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771474">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771532">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771591">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771647">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771703">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771763">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771808">if</span>&nbsp;<span class="ident" id="5771811">i</span><span class="op" id="5771812">+</span><span class="num" id="5771813">1</span>&nbsp;<span class="op" id="5771815">&lt;</span>&nbsp;<span class="ident" id="5771817">n</span>&nbsp;<span class="op" id="5771819">&amp;&amp;</span>&nbsp;<span class="ident" id="5771822">p</span><span class="op" id="5771823">.</span><span class="ident" id="5771824">wsbuf</span><span class="op" id="5771829">[</span><span class="ident" id="5771830">i</span><span class="op" id="5771831">+</span><span class="num" id="5771832">1</span><span class="op" id="5771833">]</span>&nbsp;<span class="op" id="5771835">==</span>&nbsp;<span class="ident" id="5771838">unindent</span>&nbsp;<span class="op" id="5771847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771853">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771909">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771970">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772030">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772093">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772113">p</span><span class="op" id="5772114">.</span><span class="ident" id="5772115">wsbuf</span><span class="op" id="5772120">[</span><span class="ident" id="5772121">i</span><span class="op" id="5772122">]</span><span class="op" id="5772123">,</span>&nbsp;<span class="ident" id="5772125">p</span><span class="op" id="5772126">.</span><span class="ident" id="5772127">wsbuf</span><span class="op" id="5772132">[</span><span class="ident" id="5772133">i</span><span class="op" id="5772134">+</span><span class="num" id="5772135">1</span><span class="op" id="5772136">]</span>&nbsp;<span class="op" id="5772138">=</span>&nbsp;<span class="ident" id="5772140">unindent</span><span class="op" id="5772148">,</span>&nbsp;<span class="ident" id="5772150">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772163">i</span><span class="op" id="5772164">--</span>&nbsp;<span class="comment" id="5772167">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772186">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772203">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772217">default</span><span class="op" id="5772224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772229">p</span><span class="op" id="5772230">.</span><span class="ident" id="5772231">writeByte</span><span class="op" id="5772240">(</span><span class="builtintype" id="5772241">byte</span><span class="op" id="5772245">(</span><span class="ident" id="5772246">ch</span><span class="op" id="5772248">)</span><span class="op" id="5772249">,</span>&nbsp;<span class="num" id="5772251">1</span><span class="op" id="5772252">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772263">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772296">l</span>&nbsp;<span class="op" id="5772298">:=</span>&nbsp;<span class="builtinfunc" id="5772301">copy</span><span class="op" id="5772305">(</span><span class="ident" id="5772306">p</span><span class="op" id="5772307">.</span><span class="ident" id="5772308">wsbuf</span><span class="op" id="5772313">,</span>&nbsp;<span class="ident" id="5772315">p</span><span class="op" id="5772316">.</span><span class="ident" id="5772317">wsbuf</span><span class="op" id="5772322">[</span><span class="ident" id="5772323">n</span><span class="op" id="5772324">:</span><span class="op" id="5772325">]</span><span class="op" id="5772326">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772329">p</span><span class="op" id="5772330">.</span><span class="ident" id="5772331">wsbuf</span>&nbsp;<span class="op" id="5772337">=</span>&nbsp;<span class="ident" id="5772339">p</span><span class="op" id="5772340">.</span><span class="ident" id="5772341">wsbuf</span><span class="op" id="5772346">[</span><span class="op" id="5772347">:</span><span class="ident" id="5772348">l</span><span class="op" id="5772349">]</span><br>
<span class="lineno"></span><span class="op" id="5772351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5772354">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5772434">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5772457">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5772492">func</span>&nbsp;<span class="ident" id="5772497">nlimit</span><span class="op" id="5772503">(</span><span class="ident" id="5772504">n</span>&nbsp;<span class="builtintype" id="5772506">int</span><span class="op" id="5772509">)</span>&nbsp;<span class="builtintype" id="5772511">int</span>&nbsp;<span class="op" id="5772515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772518">if</span>&nbsp;<span class="ident" id="5772521">n</span>&nbsp;<span class="op" id="5772523">&gt;</span>&nbsp;<span class="ident" id="5772525">maxNewlines</span>&nbsp;<span class="op" id="5772537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772541">n</span>&nbsp;<span class="op" id="5772543">=</span>&nbsp;<span class="ident" id="5772545">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772561">return</span>&nbsp;<span class="ident" id="5772568">n</span><br>
<span class="lineno"></span><span class="op" id="5772570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772573">func</span>&nbsp;<span class="ident" id="5772578">mayCombine</span><span class="op" id="5772588">(</span><span class="ident" id="5772589">prev</span>&nbsp;<span class="ident" id="5772594">token</span><span class="op" id="5772599">.</span><span class="ident" id="5772600">Token</span><span class="op" id="5772605">,</span>&nbsp;<span class="ident" id="5772607">next</span>&nbsp;<span class="builtintype" id="5772612">byte</span><span class="op" id="5772616">)</span>&nbsp;<span class="op" id="5772618">(</span><span class="ident" id="5772619">b</span>&nbsp;<span class="builtintype" id="5772621">bool</span><span class="op" id="5772625">)</span>&nbsp;<span class="op" id="5772627">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772630">switch</span>&nbsp;<span class="ident" id="5772637">prev</span>&nbsp;<span class="op" id="5772642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772645">case</span>&nbsp;<span class="ident" id="5772650">token</span><span class="op" id="5772655">.</span><span class="ident" id="5772656">INT</span><span class="op" id="5772659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772663">b</span>&nbsp;<span class="op" id="5772665">=</span>&nbsp;<span class="ident" id="5772667">next</span>&nbsp;<span class="op" id="5772672">==</span>&nbsp;<span class="string" id="5772675">&#39;.&#39;</span>&nbsp;<span class="comment" id="5772679">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772686">case</span>&nbsp;<span class="ident" id="5772691">token</span><span class="op" id="5772696">.</span><span class="ident" id="5772697">ADD</span><span class="op" id="5772700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772704">b</span>&nbsp;<span class="op" id="5772706">=</span>&nbsp;<span class="ident" id="5772708">next</span>&nbsp;<span class="op" id="5772713">==</span>&nbsp;<span class="string" id="5772716">&#39;+&#39;</span>&nbsp;<span class="comment" id="5772720">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772727">case</span>&nbsp;<span class="ident" id="5772732">token</span><span class="op" id="5772737">.</span><span class="ident" id="5772738">SUB</span><span class="op" id="5772741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772745">b</span>&nbsp;<span class="op" id="5772747">=</span>&nbsp;<span class="ident" id="5772749">next</span>&nbsp;<span class="op" id="5772754">==</span>&nbsp;<span class="string" id="5772757">&#39;-&#39;</span>&nbsp;<span class="comment" id="5772761">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772768">case</span>&nbsp;<span class="ident" id="5772773">token</span><span class="op" id="5772778">.</span><span class="ident" id="5772779">QUO</span><span class="op" id="5772782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772786">b</span>&nbsp;<span class="op" id="5772788">=</span>&nbsp;<span class="ident" id="5772790">next</span>&nbsp;<span class="op" id="5772795">==</span>&nbsp;<span class="string" id="5772798">&#39;*&#39;</span>&nbsp;<span class="comment" id="5772802">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772809">case</span>&nbsp;<span class="ident" id="5772814">token</span><span class="op" id="5772819">.</span><span class="ident" id="5772820">LSS</span><span class="op" id="5772823">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772827">b</span>&nbsp;<span class="op" id="5772829">=</span>&nbsp;<span class="ident" id="5772831">next</span>&nbsp;<span class="op" id="5772836">==</span>&nbsp;<span class="string" id="5772839">&#39;-&#39;</span>&nbsp;<span class="op" id="5772843">||</span>&nbsp;<span class="ident" id="5772846">next</span>&nbsp;<span class="op" id="5772851">==</span>&nbsp;<span class="string" id="5772854">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5772858">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772871">case</span>&nbsp;<span class="ident" id="5772876">token</span><span class="op" id="5772881">.</span><span class="ident" id="5772882">AND</span><span class="op" id="5772885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772889">b</span>&nbsp;<span class="op" id="5772891">=</span>&nbsp;<span class="ident" id="5772893">next</span>&nbsp;<span class="op" id="5772898">==</span>&nbsp;<span class="string" id="5772901">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5772905">||</span>&nbsp;<span class="ident" id="5772908">next</span>&nbsp;<span class="op" id="5772913">==</span>&nbsp;<span class="string" id="5772916">&#39;^&#39;</span>&nbsp;<span class="comment" id="5772920">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772936">return</span><br>
<span class="lineno">825</span><span class="op" id="5772943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5772946">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5773016">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5773086">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5773155">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5773205">//</span><br>
<span class="lineno"></span><span class="comment" id="5773208">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5773279">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5773348">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5773418">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5773488">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5773530">//</span><br>
<span class="lineno"></span><span class="keyword" id="5773533">func</span>&nbsp;<span class="op" id="5773538">(</span><span class="ident" id="5773539">p</span>&nbsp;<span class="op" id="5773541">*</span><span class="ident" id="5773542">printer</span><span class="op" id="5773549">)</span>&nbsp;<span class="builtinfunc" id="5773551">print</span><span class="op" id="5773556">(</span><span class="ident" id="5773557">args</span>&nbsp;<span class="op" id="5773562">...</span><span class="keyword" id="5773565">interface</span><span class="op" id="5773574">{</span><span class="op" id="5773575">}</span><span class="op" id="5773576">)</span>&nbsp;<span class="op" id="5773578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773581">for</span>&nbsp;<span class="ident" id="5773585">_</span><span class="op" id="5773586">,</span>&nbsp;<span class="ident" id="5773588">arg</span>&nbsp;<span class="op" id="5773592">:=</span>&nbsp;<span class="keyword" id="5773595">range</span>&nbsp;<span class="ident" id="5773601">args</span>&nbsp;<span class="op" id="5773606">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773610">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773649">var</span>&nbsp;<span class="ident" id="5773653">data</span>&nbsp;<span class="builtintype" id="5773658">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773667">var</span>&nbsp;<span class="ident" id="5773671">isLit</span>&nbsp;<span class="builtintype" id="5773677">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773684">var</span>&nbsp;<span class="ident" id="5773688">impliedSemi</span>&nbsp;<span class="builtintype" id="5773700">bool</span>&nbsp;<span class="comment" id="5773705">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773750">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773793">switch</span>&nbsp;<span class="ident" id="5773800">p</span><span class="op" id="5773801">.</span><span class="ident" id="5773802">lastTok</span>&nbsp;<span class="op" id="5773810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773814">case</span>&nbsp;<span class="ident" id="5773819">token</span><span class="op" id="5773824">.</span><span class="ident" id="5773825">ILLEGAL</span><span class="op" id="5773832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773837">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773863">case</span>&nbsp;<span class="ident" id="5773868">token</span><span class="op" id="5773873">.</span><span class="ident" id="5773874">LPAREN</span><span class="op" id="5773880">,</span>&nbsp;<span class="ident" id="5773882">token</span><span class="op" id="5773887">.</span><span class="ident" id="5773888">LBRACK</span><span class="op" id="5773894">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773899">p</span><span class="op" id="5773900">.</span><span class="ident" id="5773901">prevOpen</span>&nbsp;<span class="op" id="5773910">=</span>&nbsp;<span class="ident" id="5773912">p</span><span class="op" id="5773913">.</span><span class="ident" id="5773914">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773924">default</span><span class="op" id="5773931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773936">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773982">p</span><span class="op" id="5773983">.</span><span class="ident" id="5773984">prevOpen</span>&nbsp;<span class="op" id="5773993">=</span>&nbsp;<span class="ident" id="5773995">token</span><span class="op" id="5774000">.</span><span class="ident" id="5774001">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774011">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774016">switch</span>&nbsp;<span class="ident" id="5774023">x</span>&nbsp;<span class="op" id="5774025">:=</span>&nbsp;<span class="ident" id="5774028">arg</span><span class="op" id="5774031">.</span><span class="op" id="5774032">(</span><span class="keyword" id="5774033">type</span><span class="op" id="5774037">)</span>&nbsp;<span class="op" id="5774039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774043">case</span>&nbsp;<span class="ident" id="5774048">pmode</span><span class="op" id="5774053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774058">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774084">p</span><span class="op" id="5774085">.</span><span class="ident" id="5774086">mode</span>&nbsp;<span class="op" id="5774091">^=</span>&nbsp;<span class="ident" id="5774094">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774099">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774111">case</span>&nbsp;<span class="ident" id="5774116">whiteSpace</span><span class="op" id="5774126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774131">if</span>&nbsp;<span class="ident" id="5774134">x</span>&nbsp;<span class="op" id="5774136">==</span>&nbsp;<span class="ident" id="5774139">ignore</span>&nbsp;<span class="op" id="5774146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774152">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774198">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774246">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774266">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774283">i</span>&nbsp;<span class="op" id="5774285">:=</span>&nbsp;<span class="builtinfunc" id="5774288">len</span><span class="op" id="5774291">(</span><span class="ident" id="5774292">p</span><span class="op" id="5774293">.</span><span class="ident" id="5774294">wsbuf</span><span class="op" id="5774299">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774304">if</span>&nbsp;<span class="ident" id="5774307">i</span>&nbsp;<span class="op" id="5774309">==</span>&nbsp;<span class="builtinfunc" id="5774312">cap</span><span class="op" id="5774315">(</span><span class="ident" id="5774316">p</span><span class="op" id="5774317">.</span><span class="ident" id="5774318">wsbuf</span><span class="op" id="5774323">)</span>&nbsp;<span class="op" id="5774325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774331">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774389">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774447">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774496">p</span><span class="op" id="5774497">.</span><span class="ident" id="5774498">writeWhitespace</span><span class="op" id="5774513">(</span><span class="ident" id="5774514">i</span><span class="op" id="5774515">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774521">i</span>&nbsp;<span class="op" id="5774523">=</span>&nbsp;<span class="num" id="5774525">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774535">p</span><span class="op" id="5774536">.</span><span class="ident" id="5774537">wsbuf</span>&nbsp;<span class="op" id="5774543">=</span>&nbsp;<span class="ident" id="5774545">p</span><span class="op" id="5774546">.</span><span class="ident" id="5774547">wsbuf</span><span class="op" id="5774552">[</span><span class="num" id="5774553">0</span>&nbsp;<span class="op" id="5774555">:</span>&nbsp;<span class="ident" id="5774557">i</span><span class="op" id="5774558">+</span><span class="num" id="5774559">1</span><span class="op" id="5774560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774565">p</span><span class="op" id="5774566">.</span><span class="ident" id="5774567">wsbuf</span><span class="op" id="5774572">[</span><span class="ident" id="5774573">i</span><span class="op" id="5774574">]</span>&nbsp;<span class="op" id="5774576">=</span>&nbsp;<span class="ident" id="5774578">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774583">if</span>&nbsp;<span class="ident" id="5774586">x</span>&nbsp;<span class="op" id="5774588">==</span>&nbsp;<span class="ident" id="5774591">newline</span>&nbsp;<span class="op" id="5774599">||</span>&nbsp;<span class="ident" id="5774602">x</span>&nbsp;<span class="op" id="5774604">==</span>&nbsp;<span class="ident" id="5774607">formfeed</span>&nbsp;<span class="op" id="5774616">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774622">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774679">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774737">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774796">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774816">p</span><span class="op" id="5774817">.</span><span class="ident" id="5774818">impliedSemi</span>&nbsp;<span class="op" id="5774830">=</span>&nbsp;<span class="ident" id="5774832">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774846">p</span><span class="op" id="5774847">.</span><span class="ident" id="5774848">lastTok</span>&nbsp;<span class="op" id="5774856">=</span>&nbsp;<span class="ident" id="5774858">token</span><span class="op" id="5774863">.</span><span class="ident" id="5774864">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774875">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774887">case</span>&nbsp;<span class="op" id="5774892">*</span><span class="ident" id="5774893">ast</span><span class="op" id="5774896">.</span><span class="ident" id="5774897">Ident</span><span class="op" id="5774902">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774907">data</span>&nbsp;<span class="op" id="5774912">=</span>&nbsp;<span class="ident" id="5774914">x</span><span class="op" id="5774915">.</span><span class="ident" id="5774916">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774924">impliedSemi</span>&nbsp;<span class="op" id="5774936">=</span>&nbsp;<span class="ident" id="5774938">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774946">p</span><span class="op" id="5774947">.</span><span class="ident" id="5774948">lastTok</span>&nbsp;<span class="op" id="5774956">=</span>&nbsp;<span class="ident" id="5774958">token</span><span class="op" id="5774963">.</span><span class="ident" id="5774964">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774973">case</span>&nbsp;<span class="op" id="5774978">*</span><span class="ident" id="5774979">ast</span><span class="op" id="5774982">.</span><span class="ident" id="5774983">BasicLit</span><span class="op" id="5774991">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774996">data</span>&nbsp;<span class="op" id="5775001">=</span>&nbsp;<span class="ident" id="5775003">x</span><span class="op" id="5775004">.</span><span class="ident" id="5775005">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775014">isLit</span>&nbsp;<span class="op" id="5775020">=</span>&nbsp;<span class="ident" id="5775022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775030">impliedSemi</span>&nbsp;<span class="op" id="5775042">=</span>&nbsp;<span class="ident" id="5775044">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775052">p</span><span class="op" id="5775053">.</span><span class="ident" id="5775054">lastTok</span>&nbsp;<span class="op" id="5775062">=</span>&nbsp;<span class="ident" id="5775064">x</span><span class="op" id="5775065">.</span><span class="ident" id="5775066">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775074">case</span>&nbsp;<span class="ident" id="5775079">token</span><span class="op" id="5775084">.</span><span class="ident" id="5775085">Token</span><span class="op" id="5775090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775095">s</span>&nbsp;<span class="op" id="5775097">:=</span>&nbsp;<span class="ident" id="5775100">x</span><span class="op" id="5775101">.</span><span class="ident" id="5775102">String</span><span class="op" id="5775108">(</span><span class="op" id="5775109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775114">if</span>&nbsp;<span class="ident" id="5775117">mayCombine</span><span class="op" id="5775127">(</span><span class="ident" id="5775128">p</span><span class="op" id="5775129">.</span><span class="ident" id="5775130">lastTok</span><span class="op" id="5775137">,</span>&nbsp;<span class="ident" id="5775139">s</span><span class="op" id="5775140">[</span><span class="num" id="5775141">0</span><span class="op" id="5775142">]</span><span class="op" id="5775143">)</span>&nbsp;<span class="op" id="5775145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775151">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775201">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775252">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775301">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775353">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775405">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775449">if</span>&nbsp;<span class="builtinfunc" id="5775452">len</span><span class="op" id="5775455">(</span><span class="ident" id="5775456">p</span><span class="op" id="5775457">.</span><span class="ident" id="5775458">wsbuf</span><span class="op" id="5775463">)</span>&nbsp;<span class="op" id="5775465">!=</span>&nbsp;<span class="num" id="5775468">0</span>&nbsp;<span class="op" id="5775470">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775477">p</span><span class="op" id="5775478">.</span><span class="ident" id="5775479">internalError</span><span class="op" id="5775492">(</span><span class="string" id="5775493">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5775522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775534">p</span><span class="op" id="5775535">.</span><span class="ident" id="5775536">wsbuf</span>&nbsp;<span class="op" id="5775542">=</span>&nbsp;<span class="ident" id="5775544">p</span><span class="op" id="5775545">.</span><span class="ident" id="5775546">wsbuf</span><span class="op" id="5775551">[</span><span class="num" id="5775552">0</span><span class="op" id="5775553">:</span><span class="num" id="5775554">1</span><span class="op" id="5775555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775561">p</span><span class="op" id="5775562">.</span><span class="ident" id="5775563">wsbuf</span><span class="op" id="5775568">[</span><span class="num" id="5775569">0</span><span class="op" id="5775570">]</span>&nbsp;<span class="op" id="5775572">=</span>&nbsp;<span class="string" id="5775574">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775581">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775586">data</span>&nbsp;<span class="op" id="5775591">=</span>&nbsp;<span class="ident" id="5775593">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775598">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775658">switch</span>&nbsp;<span class="ident" id="5775665">x</span>&nbsp;<span class="op" id="5775667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775672">case</span>&nbsp;<span class="ident" id="5775677">token</span><span class="op" id="5775682">.</span><span class="ident" id="5775683">BREAK</span><span class="op" id="5775688">,</span>&nbsp;<span class="ident" id="5775690">token</span><span class="op" id="5775695">.</span><span class="ident" id="5775696">CONTINUE</span><span class="op" id="5775704">,</span>&nbsp;<span class="ident" id="5775706">token</span><span class="op" id="5775711">.</span><span class="ident" id="5775712">FALLTHROUGH</span><span class="op" id="5775723">,</span>&nbsp;<span class="ident" id="5775725">token</span><span class="op" id="5775730">.</span><span class="ident" id="5775731">RETURN</span><span class="op" id="5775737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775743">token</span><span class="op" id="5775748">.</span><span class="ident" id="5775749">INC</span><span class="op" id="5775752">,</span>&nbsp;<span class="ident" id="5775754">token</span><span class="op" id="5775759">.</span><span class="ident" id="5775760">DEC</span><span class="op" id="5775763">,</span>&nbsp;<span class="ident" id="5775765">token</span><span class="op" id="5775770">.</span><span class="ident" id="5775771">RPAREN</span><span class="op" id="5775777">,</span>&nbsp;<span class="ident" id="5775779">token</span><span class="op" id="5775784">.</span><span class="ident" id="5775785">RBRACK</span><span class="op" id="5775791">,</span>&nbsp;<span class="ident" id="5775793">token</span><span class="op" id="5775798">.</span><span class="ident" id="5775799">RBRACE</span><span class="op" id="5775805">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775811">impliedSemi</span>&nbsp;<span class="op" id="5775823">=</span>&nbsp;<span class="ident" id="5775825">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775838">p</span><span class="op" id="5775839">.</span><span class="ident" id="5775840">lastTok</span>&nbsp;<span class="op" id="5775848">=</span>&nbsp;<span class="ident" id="5775850">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775855">case</span>&nbsp;<span class="ident" id="5775860">token</span><span class="op" id="5775865">.</span><span class="ident" id="5775866">Pos</span><span class="op" id="5775869">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775874">if</span>&nbsp;<span class="ident" id="5775877">x</span><span class="op" id="5775878">.</span><span class="ident" id="5775879">IsValid</span><span class="op" id="5775886">(</span><span class="op" id="5775887">)</span>&nbsp;<span class="op" id="5775889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775895">p</span><span class="op" id="5775896">.</span><span class="ident" id="5775897">pos</span>&nbsp;<span class="op" id="5775901">=</span>&nbsp;<span class="ident" id="5775903">p</span><span class="op" id="5775904">.</span><span class="ident" id="5775905">posFor</span><span class="op" id="5775911">(</span><span class="ident" id="5775912">x</span><span class="op" id="5775913">)</span>&nbsp;<span class="comment" id="5775915">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775957">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775969">case</span>&nbsp;<span class="builtintype" id="5775974">string</span><span class="op" id="5775980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775985">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776027">data</span>&nbsp;<span class="op" id="5776032">=</span>&nbsp;<span class="ident" id="5776034">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776039">isLit</span>&nbsp;<span class="op" id="5776045">=</span>&nbsp;<span class="ident" id="5776047">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776055">impliedSemi</span>&nbsp;<span class="op" id="5776067">=</span>&nbsp;<span class="ident" id="5776069">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776077">p</span><span class="op" id="5776078">.</span><span class="ident" id="5776079">lastTok</span>&nbsp;<span class="op" id="5776087">=</span>&nbsp;<span class="ident" id="5776089">token</span><span class="op" id="5776094">.</span><span class="ident" id="5776095">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776105">default</span><span class="op" id="5776112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776117">fmt</span><span class="op" id="5776120">.</span><span class="ident" id="5776121">Fprintf</span><span class="op" id="5776128">(</span><span class="ident" id="5776129">os</span><span class="op" id="5776131">.</span><span class="ident" id="5776132">Stderr</span><span class="op" id="5776138">,</span>&nbsp;<span class="string" id="5776140">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5776179">,</span>&nbsp;<span class="ident" id="5776181">arg</span><span class="op" id="5776184">,</span>&nbsp;<span class="ident" id="5776186">arg</span><span class="op" id="5776189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5776194">panic</span><span class="op" id="5776199">(</span><span class="string" id="5776200">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5776217">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776225">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776242">next</span>&nbsp;<span class="op" id="5776247">:=</span>&nbsp;<span class="ident" id="5776250">p</span><span class="op" id="5776251">.</span><span class="ident" id="5776252">pos</span>&nbsp;<span class="comment" id="5776256">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776302">wroteNewline</span><span class="op" id="5776314">,</span>&nbsp;<span class="ident" id="5776316">droppedFF</span>&nbsp;<span class="op" id="5776326">:=</span>&nbsp;<span class="ident" id="5776329">p</span><span class="op" id="5776330">.</span><span class="ident" id="5776331">flush</span><span class="op" id="5776336">(</span><span class="ident" id="5776337">next</span><span class="op" id="5776341">,</span>&nbsp;<span class="ident" id="5776343">p</span><span class="op" id="5776344">.</span><span class="ident" id="5776345">lastTok</span><span class="op" id="5776352">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776357">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776418">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776478">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776543">if</span>&nbsp;<span class="op" id="5776546">!</span><span class="ident" id="5776547">p</span><span class="op" id="5776548">.</span><span class="ident" id="5776549">impliedSemi</span>&nbsp;<span class="op" id="5776561">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776566">n</span>&nbsp;<span class="op" id="5776568">:=</span>&nbsp;<span class="ident" id="5776571">nlimit</span><span class="op" id="5776577">(</span><span class="ident" id="5776578">next</span><span class="op" id="5776582">.</span><span class="ident" id="5776583">Line</span>&nbsp;<span class="op" id="5776588">-</span>&nbsp;<span class="ident" id="5776590">p</span><span class="op" id="5776591">.</span><span class="ident" id="5776592">pos</span><span class="op" id="5776595">.</span><span class="ident" id="5776596">Line</span><span class="op" id="5776600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776605">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776660">if</span>&nbsp;<span class="ident" id="5776663">wroteNewline</span>&nbsp;<span class="op" id="5776676">&amp;&amp;</span>&nbsp;<span class="ident" id="5776679">n</span>&nbsp;<span class="op" id="5776681">==</span>&nbsp;<span class="ident" id="5776684">maxNewlines</span>&nbsp;<span class="op" id="5776696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776702">n</span>&nbsp;<span class="op" id="5776704">=</span>&nbsp;<span class="ident" id="5776706">maxNewlines</span>&nbsp;<span class="op" id="5776718">-</span>&nbsp;<span class="num" id="5776720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776725">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776730">if</span>&nbsp;<span class="ident" id="5776733">n</span>&nbsp;<span class="op" id="5776735">&gt;</span>&nbsp;<span class="num" id="5776737">0</span>&nbsp;<span class="op" id="5776739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776745">ch</span>&nbsp;<span class="op" id="5776748">:=</span>&nbsp;<span class="builtintype" id="5776751">byte</span><span class="op" id="5776755">(</span><span class="string" id="5776756">&#39;\n&#39;</span><span class="op" id="5776760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776766">if</span>&nbsp;<span class="ident" id="5776769">droppedFF</span>&nbsp;<span class="op" id="5776779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776786">ch</span>&nbsp;<span class="op" id="5776789">=</span>&nbsp;<span class="string" id="5776791">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5776796">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776844">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776850">p</span><span class="op" id="5776851">.</span><span class="ident" id="5776852">writeByte</span><span class="op" id="5776861">(</span><span class="ident" id="5776862">ch</span><span class="op" id="5776864">,</span>&nbsp;<span class="ident" id="5776866">n</span><span class="op" id="5776867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776873">impliedSemi</span>&nbsp;<span class="op" id="5776885">=</span>&nbsp;<span class="ident" id="5776887">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776905">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776974">if</span>&nbsp;<span class="ident" id="5776977">p</span><span class="op" id="5776978">.</span><span class="ident" id="5776979">linePtr</span>&nbsp;<span class="op" id="5776987">!=</span>&nbsp;<span class="ident" id="5776990">nil</span>&nbsp;<span class="op" id="5776994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776999">*</span><span class="ident" id="5777000">p</span><span class="op" id="5777001">.</span><span class="ident" id="5777002">linePtr</span>&nbsp;<span class="op" id="5777010">=</span>&nbsp;<span class="ident" id="5777012">p</span><span class="op" id="5777013">.</span><span class="ident" id="5777014">out</span><span class="op" id="5777017">.</span><span class="ident" id="5777018">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777026">p</span><span class="op" id="5777027">.</span><span class="ident" id="5777028">linePtr</span>&nbsp;<span class="op" id="5777036">=</span>&nbsp;<span class="ident" id="5777038">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777044">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777049">p</span><span class="op" id="5777050">.</span><span class="ident" id="5777051">writeString</span><span class="op" id="5777062">(</span><span class="ident" id="5777063">next</span><span class="op" id="5777067">,</span>&nbsp;<span class="ident" id="5777069">data</span><span class="op" id="5777073">,</span>&nbsp;<span class="ident" id="5777075">isLit</span><span class="op" id="5777080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777084">p</span><span class="op" id="5777085">.</span><span class="ident" id="5777086">impliedSemi</span>&nbsp;<span class="op" id="5777098">=</span>&nbsp;<span class="ident" id="5777100">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777113">}</span><br>
<span class="lineno"></span><span class="op" id="5777115">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5777118">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5777190">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5777263">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5777340">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5777351">//</span><br>
<span class="lineno"></span><span class="keyword" id="5777354">func</span>&nbsp;<span class="op" id="5777359">(</span><span class="ident" id="5777360">p</span>&nbsp;<span class="op" id="5777362">*</span><span class="ident" id="5777363">printer</span><span class="op" id="5777370">)</span>&nbsp;<span class="ident" id="5777372">flush</span><span class="op" id="5777377">(</span><span class="ident" id="5777378">next</span>&nbsp;<span class="ident" id="5777383">token</span><span class="op" id="5777388">.</span><span class="ident" id="5777389">Position</span><span class="op" id="5777397">,</span>&nbsp;<span class="ident" id="5777399">tok</span>&nbsp;<span class="ident" id="5777403">token</span><span class="op" id="5777408">.</span><span class="ident" id="5777409">Token</span><span class="op" id="5777414">)</span>&nbsp;<span class="op" id="5777416">(</span><span class="ident" id="5777417">wroteNewline</span><span class="op" id="5777429">,</span>&nbsp;<span class="ident" id="5777431">droppedFF</span>&nbsp;<span class="builtintype" id="5777441">bool</span><span class="op" id="5777445">)</span>&nbsp;<span class="op" id="5777447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777450">if</span>&nbsp;<span class="ident" id="5777453">p</span><span class="op" id="5777454">.</span><span class="ident" id="5777455">commentBefore</span><span class="op" id="5777468">(</span><span class="ident" id="5777469">next</span><span class="op" id="5777473">)</span>&nbsp;<span class="op" id="5777475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777479">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777545">wroteNewline</span><span class="op" id="5777557">,</span>&nbsp;<span class="ident" id="5777559">droppedFF</span>&nbsp;<span class="op" id="5777569">=</span>&nbsp;<span class="ident" id="5777571">p</span><span class="op" id="5777572">.</span><span class="ident" id="5777573">intersperseComments</span><span class="op" id="5777592">(</span><span class="ident" id="5777593">next</span><span class="op" id="5777597">,</span>&nbsp;<span class="ident" id="5777599">tok</span><span class="op" id="5777602">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777605">}</span>&nbsp;<span class="keyword" id="5777607">else</span>&nbsp;<span class="op" id="5777612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777616">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777662">p</span><span class="op" id="5777663">.</span><span class="ident" id="5777664">writeWhitespace</span><span class="op" id="5777679">(</span><span class="builtinfunc" id="5777680">len</span><span class="op" id="5777683">(</span><span class="ident" id="5777684">p</span><span class="op" id="5777685">.</span><span class="ident" id="5777686">wsbuf</span><span class="op" id="5777691">)</span><span class="op" id="5777692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777698">return</span><br>
<span class="lineno">990</span><span class="op" id="5777705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5777708">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5777775">func</span>&nbsp;<span class="ident" id="5777780">getDoc</span><span class="op" id="5777786">(</span><span class="ident" id="5777787">n</span>&nbsp;<span class="ident" id="5777789">ast</span><span class="op" id="5777792">.</span><span class="ident" id="5777793">Node</span><span class="op" id="5777797">)</span>&nbsp;<span class="op" id="5777799">*</span><span class="ident" id="5777800">ast</span><span class="op" id="5777803">.</span><span class="ident" id="5777804">CommentGroup</span>&nbsp;<span class="op" id="5777817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777820">switch</span>&nbsp;<span class="ident" id="5777827">n</span>&nbsp;<span class="op" id="5777829">:=</span>&nbsp;<span class="ident" id="5777832">n</span><span class="op" id="5777833">.</span><span class="op" id="5777834">(</span><span class="keyword" id="5777835">type</span><span class="op" id="5777839">)</span>&nbsp;<span class="op" id="5777841">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777844">case</span>&nbsp;<span class="op" id="5777849">*</span><span class="ident" id="5777850">ast</span><span class="op" id="5777853">.</span><span class="ident" id="5777854">Field</span><span class="op" id="5777859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777863">return</span>&nbsp;<span class="ident" id="5777870">n</span><span class="op" id="5777871">.</span><span class="ident" id="5777872">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777877">case</span>&nbsp;<span class="op" id="5777882">*</span><span class="ident" id="5777883">ast</span><span class="op" id="5777886">.</span><span class="ident" id="5777887">ImportSpec</span><span class="op" id="5777897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777901">return</span>&nbsp;<span class="ident" id="5777908">n</span><span class="op" id="5777909">.</span><span class="ident" id="5777910">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777915">case</span>&nbsp;<span class="op" id="5777920">*</span><span class="ident" id="5777921">ast</span><span class="op" id="5777924">.</span><span class="ident" id="5777925">ValueSpec</span><span class="op" id="5777934">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777938">return</span>&nbsp;<span class="ident" id="5777945">n</span><span class="op" id="5777946">.</span><span class="ident" id="5777947">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777952">case</span>&nbsp;<span class="op" id="5777957">*</span><span class="ident" id="5777958">ast</span><span class="op" id="5777961">.</span><span class="ident" id="5777962">TypeSpec</span><span class="op" id="5777970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777974">return</span>&nbsp;<span class="ident" id="5777981">n</span><span class="op" id="5777982">.</span><span class="ident" id="5777983">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777988">case</span>&nbsp;<span class="op" id="5777993">*</span><span class="ident" id="5777994">ast</span><span class="op" id="5777997">.</span><span class="ident" id="5777998">GenDecl</span><span class="op" id="5778005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778009">return</span>&nbsp;<span class="ident" id="5778016">n</span><span class="op" id="5778017">.</span><span class="ident" id="5778018">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778023">case</span>&nbsp;<span class="op" id="5778028">*</span><span class="ident" id="5778029">ast</span><span class="op" id="5778032">.</span><span class="ident" id="5778033">FuncDecl</span><span class="op" id="5778041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778045">return</span>&nbsp;<span class="ident" id="5778052">n</span><span class="op" id="5778053">.</span><span class="ident" id="5778054">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778059">case</span>&nbsp;<span class="op" id="5778064">*</span><span class="ident" id="5778065">ast</span><span class="op" id="5778068">.</span><span class="ident" id="5778069">File</span><span class="op" id="5778073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778077">return</span>&nbsp;<span class="ident" id="5778084">n</span><span class="op" id="5778085">.</span><span class="ident" id="5778086">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778091">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778094">return</span>&nbsp;<span class="ident" id="5778101">nil</span><br>
<span class="lineno"></span><span class="op" id="5778105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5778108">func</span>&nbsp;<span class="op" id="5778113">(</span><span class="ident" id="5778114">p</span>&nbsp;<span class="op" id="5778116">*</span><span class="ident" id="5778117">printer</span><span class="op" id="5778124">)</span>&nbsp;<span class="ident" id="5778126">printNode</span><span class="op" id="5778135">(</span><span class="ident" id="5778136">node</span>&nbsp;<span class="keyword" id="5778141">interface</span><span class="op" id="5778150">{</span><span class="op" id="5778151">}</span><span class="op" id="5778152">)</span>&nbsp;<span class="builtintype" id="5778154">error</span>&nbsp;<span class="op" id="5778160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778163">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778197">var</span>&nbsp;<span class="ident" id="5778201">comments</span>&nbsp;<span class="op" id="5778210">[</span><span class="op" id="5778211">]</span><span class="op" id="5778212">*</span><span class="ident" id="5778213">ast</span><span class="op" id="5778216">.</span><span class="ident" id="5778217">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778231">if</span>&nbsp;<span class="ident" id="5778234">cnode</span><span class="op" id="5778239">,</span>&nbsp;<span class="ident" id="5778241">ok</span>&nbsp;<span class="op" id="5778244">:=</span>&nbsp;<span class="ident" id="5778247">node</span><span class="op" id="5778251">.</span><span class="op" id="5778252">(</span><span class="op" id="5778253">*</span><span class="ident" id="5778254">CommentedNode</span><span class="op" id="5778267">)</span><span class="op" id="5778268">;</span>&nbsp;<span class="ident" id="5778270">ok</span>&nbsp;<span class="op" id="5778273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778277">node</span>&nbsp;<span class="op" id="5778282">=</span>&nbsp;<span class="ident" id="5778284">cnode</span><span class="op" id="5778289">.</span><span class="ident" id="5778290">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778297">comments</span>&nbsp;<span class="op" id="5778306">=</span>&nbsp;<span class="ident" id="5778308">cnode</span><span class="op" id="5778313">.</span><span class="ident" id="5778314">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778324">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778328">if</span>&nbsp;<span class="ident" id="5778331">comments</span>&nbsp;<span class="op" id="5778340">!=</span>&nbsp;<span class="ident" id="5778343">nil</span>&nbsp;<span class="op" id="5778347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778351">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778413">n</span><span class="op" id="5778414">,</span>&nbsp;<span class="ident" id="5778416">ok</span>&nbsp;<span class="op" id="5778419">:=</span>&nbsp;<span class="ident" id="5778422">node</span><span class="op" id="5778426">.</span><span class="op" id="5778427">(</span><span class="ident" id="5778428">ast</span><span class="op" id="5778431">.</span><span class="ident" id="5778432">Node</span><span class="op" id="5778436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778440">if</span>&nbsp;<span class="op" id="5778443">!</span><span class="ident" id="5778444">ok</span>&nbsp;<span class="op" id="5778447">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778452">goto</span>&nbsp;<span class="ident" id="5778457">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778475">beg</span>&nbsp;<span class="op" id="5778479">:=</span>&nbsp;<span class="ident" id="5778482">n</span><span class="op" id="5778483">.</span><span class="ident" id="5778484">Pos</span><span class="op" id="5778487">(</span><span class="op" id="5778488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778492">end</span>&nbsp;<span class="op" id="5778496">:=</span>&nbsp;<span class="ident" id="5778499">n</span><span class="op" id="5778500">.</span><span class="ident" id="5778501">End</span><span class="op" id="5778504">(</span><span class="op" id="5778505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778509">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778556">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778600">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778646">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778697">if</span>&nbsp;<span class="ident" id="5778700">doc</span>&nbsp;<span class="op" id="5778704">:=</span>&nbsp;<span class="ident" id="5778707">getDoc</span><span class="op" id="5778713">(</span><span class="ident" id="5778714">n</span><span class="op" id="5778715">)</span><span class="op" id="5778716">;</span>&nbsp;<span class="ident" id="5778718">doc</span>&nbsp;<span class="op" id="5778722">!=</span>&nbsp;<span class="ident" id="5778725">nil</span>&nbsp;<span class="op" id="5778729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778734">beg</span>&nbsp;<span class="op" id="5778738">=</span>&nbsp;<span class="ident" id="5778740">doc</span><span class="op" id="5778743">.</span><span class="ident" id="5778744">Pos</span><span class="op" id="5778747">(</span><span class="op" id="5778748">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778756">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778805">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778832">i</span>&nbsp;<span class="op" id="5778834">:=</span>&nbsp;<span class="num" id="5778837">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778841">for</span>&nbsp;<span class="ident" id="5778845">i</span>&nbsp;<span class="op" id="5778847">&lt;</span>&nbsp;<span class="builtinfunc" id="5778849">len</span><span class="op" id="5778852">(</span><span class="ident" id="5778853">comments</span><span class="op" id="5778861">)</span>&nbsp;<span class="op" id="5778863">&amp;&amp;</span>&nbsp;<span class="ident" id="5778866">comments</span><span class="op" id="5778874">[</span><span class="ident" id="5778875">i</span><span class="op" id="5778876">]</span><span class="op" id="5778877">.</span><span class="ident" id="5778878">End</span><span class="op" id="5778881">(</span><span class="op" id="5778882">)</span>&nbsp;<span class="op" id="5778884">&lt;</span>&nbsp;<span class="ident" id="5778886">beg</span>&nbsp;<span class="op" id="5778890">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778895">i</span><span class="op" id="5778896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778905">j</span>&nbsp;<span class="op" id="5778907">:=</span>&nbsp;<span class="ident" id="5778910">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778914">for</span>&nbsp;<span class="ident" id="5778918">j</span>&nbsp;<span class="op" id="5778920">&lt;</span>&nbsp;<span class="builtinfunc" id="5778922">len</span><span class="op" id="5778925">(</span><span class="ident" id="5778926">comments</span><span class="op" id="5778934">)</span>&nbsp;<span class="op" id="5778936">&amp;&amp;</span>&nbsp;<span class="ident" id="5778939">comments</span><span class="op" id="5778947">[</span><span class="ident" id="5778948">j</span><span class="op" id="5778949">]</span><span class="op" id="5778950">.</span><span class="ident" id="5778951">Pos</span><span class="op" id="5778954">(</span><span class="op" id="5778955">)</span>&nbsp;<span class="op" id="5778957">&lt;</span>&nbsp;<span class="ident" id="5778959">end</span>&nbsp;<span class="op" id="5778963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778968">j</span><span class="op" id="5778969">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778978">if</span>&nbsp;<span class="ident" id="5778981">i</span>&nbsp;<span class="op" id="5778983">&lt;</span>&nbsp;<span class="ident" id="5778985">j</span>&nbsp;<span class="op" id="5778987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778992">p</span><span class="op" id="5778993">.</span><span class="ident" id="5778994">comments</span>&nbsp;<span class="op" id="5779003">=</span>&nbsp;<span class="ident" id="5779005">comments</span><span class="op" id="5779013">[</span><span class="ident" id="5779014">i</span><span class="op" id="5779015">:</span><span class="ident" id="5779016">j</span><span class="op" id="5779017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779024">}</span>&nbsp;<span class="keyword" id="5779026">else</span>&nbsp;<span class="keyword" id="5779031">if</span>&nbsp;<span class="ident" id="5779034">n</span><span class="op" id="5779035">,</span>&nbsp;<span class="ident" id="5779037">ok</span>&nbsp;<span class="op" id="5779040">:=</span>&nbsp;<span class="ident" id="5779043">node</span><span class="op" id="5779047">.</span><span class="op" id="5779048">(</span><span class="op" id="5779049">*</span><span class="ident" id="5779050">ast</span><span class="op" id="5779053">.</span><span class="ident" id="5779054">File</span><span class="op" id="5779058">)</span><span class="op" id="5779059">;</span>&nbsp;<span class="ident" id="5779061">ok</span>&nbsp;<span class="op" id="5779064">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779068">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779103">p</span><span class="op" id="5779104">.</span><span class="ident" id="5779105">comments</span>&nbsp;<span class="op" id="5779114">=</span>&nbsp;<span class="ident" id="5779116">n</span><span class="op" id="5779117">.</span><span class="ident" id="5779118">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779132">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779180">p</span><span class="op" id="5779181">.</span><span class="ident" id="5779182">useNodeComments</span>&nbsp;<span class="op" id="5779198">=</span>&nbsp;<span class="ident" id="5779200">p</span><span class="op" id="5779201">.</span><span class="ident" id="5779202">comments</span>&nbsp;<span class="op" id="5779211">==</span>&nbsp;<span class="ident" id="5779214">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779220">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779251">p</span><span class="op" id="5779252">.</span><span class="ident" id="5779253">nextComment</span><span class="op" id="5779264">(</span><span class="op" id="5779265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779269">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779285">switch</span>&nbsp;<span class="ident" id="5779292">n</span>&nbsp;<span class="op" id="5779294">:=</span>&nbsp;<span class="ident" id="5779297">node</span><span class="op" id="5779301">.</span><span class="op" id="5779302">(</span><span class="keyword" id="5779303">type</span><span class="op" id="5779307">)</span>&nbsp;<span class="op" id="5779309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779312">case</span>&nbsp;<span class="ident" id="5779317">ast</span><span class="op" id="5779320">.</span><span class="ident" id="5779321">Expr</span><span class="op" id="5779325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779329">p</span><span class="op" id="5779330">.</span><span class="ident" id="5779331">expr</span><span class="op" id="5779335">(</span><span class="ident" id="5779336">n</span><span class="op" id="5779337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779340">case</span>&nbsp;<span class="ident" id="5779345">ast</span><span class="op" id="5779348">.</span><span class="ident" id="5779349">Stmt</span><span class="op" id="5779353">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779357">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779420">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779479">if</span>&nbsp;<span class="ident" id="5779482">_</span><span class="op" id="5779483">,</span>&nbsp;<span class="ident" id="5779485">ok</span>&nbsp;<span class="op" id="5779488">:=</span>&nbsp;<span class="ident" id="5779491">n</span><span class="op" id="5779492">.</span><span class="op" id="5779493">(</span><span class="op" id="5779494">*</span><span class="ident" id="5779495">ast</span><span class="op" id="5779498">.</span><span class="ident" id="5779499">LabeledStmt</span><span class="op" id="5779510">)</span><span class="op" id="5779511">;</span>&nbsp;<span class="ident" id="5779513">ok</span>&nbsp;<span class="op" id="5779516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779521">p</span><span class="op" id="5779522">.</span><span class="ident" id="5779523">indent</span>&nbsp;<span class="op" id="5779530">=</span>&nbsp;<span class="num" id="5779532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779536">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779540">p</span><span class="op" id="5779541">.</span><span class="ident" id="5779542">stmt</span><span class="op" id="5779546">(</span><span class="ident" id="5779547">n</span><span class="op" id="5779548">,</span>&nbsp;<span class="ident" id="5779550">false</span><span class="op" id="5779555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779558">case</span>&nbsp;<span class="ident" id="5779563">ast</span><span class="op" id="5779566">.</span><span class="ident" id="5779567">Decl</span><span class="op" id="5779571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779575">p</span><span class="op" id="5779576">.</span><span class="ident" id="5779577">decl</span><span class="op" id="5779581">(</span><span class="ident" id="5779582">n</span><span class="op" id="5779583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779586">case</span>&nbsp;<span class="ident" id="5779591">ast</span><span class="op" id="5779594">.</span><span class="ident" id="5779595">Spec</span><span class="op" id="5779599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779603">p</span><span class="op" id="5779604">.</span><span class="ident" id="5779605">spec</span><span class="op" id="5779609">(</span><span class="ident" id="5779610">n</span><span class="op" id="5779611">,</span>&nbsp;<span class="num" id="5779613">1</span><span class="op" id="5779614">,</span>&nbsp;<span class="ident" id="5779616">false</span><span class="op" id="5779621">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779624">case</span>&nbsp;<span class="op" id="5779629">[</span><span class="op" id="5779630">]</span><span class="ident" id="5779631">ast</span><span class="op" id="5779634">.</span><span class="ident" id="5779635">Stmt</span><span class="op" id="5779639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779643">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779706">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779765">for</span>&nbsp;<span class="ident" id="5779769">_</span><span class="op" id="5779770">,</span>&nbsp;<span class="ident" id="5779772">s</span>&nbsp;<span class="op" id="5779774">:=</span>&nbsp;<span class="keyword" id="5779777">range</span>&nbsp;<span class="ident" id="5779783">n</span>&nbsp;<span class="op" id="5779785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779790">if</span>&nbsp;<span class="ident" id="5779793">_</span><span class="op" id="5779794">,</span>&nbsp;<span class="ident" id="5779796">ok</span>&nbsp;<span class="op" id="5779799">:=</span>&nbsp;<span class="ident" id="5779802">s</span><span class="op" id="5779803">.</span><span class="op" id="5779804">(</span><span class="op" id="5779805">*</span><span class="ident" id="5779806">ast</span><span class="op" id="5779809">.</span><span class="ident" id="5779810">LabeledStmt</span><span class="op" id="5779821">)</span><span class="op" id="5779822">;</span>&nbsp;<span class="ident" id="5779824">ok</span>&nbsp;<span class="op" id="5779827">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779833">p</span><span class="op" id="5779834">.</span><span class="ident" id="5779835">indent</span>&nbsp;<span class="op" id="5779842">=</span>&nbsp;<span class="num" id="5779844">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779857">p</span><span class="op" id="5779858">.</span><span class="ident" id="5779859">stmtList</span><span class="op" id="5779867">(</span><span class="ident" id="5779868">n</span><span class="op" id="5779869">,</span>&nbsp;<span class="num" id="5779871">0</span><span class="op" id="5779872">,</span>&nbsp;<span class="ident" id="5779874">false</span><span class="op" id="5779879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779882">case</span>&nbsp;<span class="op" id="5779887">[</span><span class="op" id="5779888">]</span><span class="ident" id="5779889">ast</span><span class="op" id="5779892">.</span><span class="ident" id="5779893">Decl</span><span class="op" id="5779897">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779901">p</span><span class="op" id="5779902">.</span><span class="ident" id="5779903">declList</span><span class="op" id="5779911">(</span><span class="ident" id="5779912">n</span><span class="op" id="5779913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779916">case</span>&nbsp;<span class="op" id="5779921">*</span><span class="ident" id="5779922">ast</span><span class="op" id="5779925">.</span><span class="ident" id="5779926">File</span><span class="op" id="5779930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779934">p</span><span class="op" id="5779935">.</span><span class="ident" id="5779936">file</span><span class="op" id="5779940">(</span><span class="ident" id="5779941">n</span><span class="op" id="5779942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779945">default</span><span class="op" id="5779952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779956">goto</span>&nbsp;<span class="ident" id="5779961">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779978">return</span>&nbsp;<span class="ident" id="5779985">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5779990">unsupported</span><span class="op" id="5780001">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780004">return</span>&nbsp;<span class="ident" id="5780011">fmt</span><span class="op" id="5780014">.</span><span class="ident" id="5780015">Errorf</span><span class="op" id="5780021">(</span><span class="string" id="5780022">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5780060">,</span>&nbsp;<span class="ident" id="5780062">node</span><span class="op" id="5780066">)</span><br>
<span class="lineno"></span><span class="op" id="5780068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5780071">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5780151">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5780163">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5780230">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5780299">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5780368">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5780437">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5780459">//</span><br>
<span class="lineno"></span><span class="keyword" id="5780462">type</span>&nbsp;<span class="ident" id="5780467">trimmer</span>&nbsp;<span class="keyword" id="5780475">struct</span>&nbsp;<span class="op" id="5780482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780485">output</span>&nbsp;<span class="ident" id="5780492">io</span><span class="op" id="5780494">.</span><span class="ident" id="5780495">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780503">state</span>&nbsp;&nbsp;<span class="builtintype" id="5780510">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780515">space</span>&nbsp;&nbsp;<span class="op" id="5780522">[</span><span class="op" id="5780523">]</span><span class="builtintype" id="5780524">byte</span><br>
<span class="lineno"></span><span class="op" id="5780529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5780532">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5780578">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5780623">const</span>&nbsp;<span class="op" id="5780629">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780632">inSpace</span>&nbsp;&nbsp;<span class="op" id="5780641">=</span>&nbsp;<span class="ident" id="5780643">iota</span>&nbsp;<span class="comment" id="5780648">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780665">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5780681">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780728">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5780744">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5780759">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5780762">func</span>&nbsp;<span class="op" id="5780767">(</span><span class="ident" id="5780768">p</span>&nbsp;<span class="op" id="5780770">*</span><span class="ident" id="5780771">trimmer</span><span class="op" id="5780778">)</span>&nbsp;<span class="ident" id="5780780">resetSpace</span><span class="op" id="5780790">(</span><span class="op" id="5780791">)</span>&nbsp;<span class="op" id="5780793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780796">p</span><span class="op" id="5780797">.</span><span class="ident" id="5780798">state</span>&nbsp;<span class="op" id="5780804">=</span>&nbsp;<span class="ident" id="5780806">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780815">p</span><span class="op" id="5780816">.</span><span class="ident" id="5780817">space</span>&nbsp;<span class="op" id="5780823">=</span>&nbsp;<span class="ident" id="5780825">p</span><span class="op" id="5780826">.</span><span class="ident" id="5780827">space</span><span class="op" id="5780832">[</span><span class="num" id="5780833">0</span><span class="op" id="5780834">:</span><span class="num" id="5780835">0</span><span class="op" id="5780836">]</span><br>
<span class="lineno"></span><span class="op" id="5780838">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5780841">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5780911">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5780981">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5781049">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5781116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5781148">var</span>&nbsp;<span class="ident" id="5781152">aNewline</span>&nbsp;<span class="op" id="5781161">=</span>&nbsp;<span class="op" id="5781163">[</span><span class="op" id="5781164">]</span><span class="builtintype" id="5781165">byte</span><span class="op" id="5781169">(</span><span class="string" id="5781170">&#34;\n&#34;</span><span class="op" id="5781174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5781177">func</span>&nbsp;<span class="op" id="5781182">(</span><span class="ident" id="5781183">p</span>&nbsp;<span class="op" id="5781185">*</span><span class="ident" id="5781186">trimmer</span><span class="op" id="5781193">)</span>&nbsp;<span class="ident" id="5781195">Write</span><span class="op" id="5781200">(</span><span class="ident" id="5781201">data</span>&nbsp;<span class="op" id="5781206">[</span><span class="op" id="5781207">]</span><span class="builtintype" id="5781208">byte</span><span class="op" id="5781212">)</span>&nbsp;<span class="op" id="5781214">(</span><span class="ident" id="5781215">n</span>&nbsp;<span class="builtintype" id="5781217">int</span><span class="op" id="5781220">,</span>&nbsp;<span class="ident" id="5781222">err</span>&nbsp;<span class="builtintype" id="5781226">error</span><span class="op" id="5781231">)</span>&nbsp;<span class="op" id="5781233">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781236">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781252">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781276">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781301">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781334">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781361">m</span>&nbsp;<span class="op" id="5781363">:=</span>&nbsp;<span class="num" id="5781366">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781369">var</span>&nbsp;<span class="ident" id="5781373">b</span>&nbsp;<span class="builtintype" id="5781375">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781381">for</span>&nbsp;<span class="ident" id="5781385">n</span><span class="op" id="5781386">,</span>&nbsp;<span class="ident" id="5781388">b</span>&nbsp;<span class="op" id="5781390">=</span>&nbsp;<span class="keyword" id="5781392">range</span>&nbsp;<span class="ident" id="5781398">data</span>&nbsp;<span class="op" id="5781403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781407">if</span>&nbsp;<span class="ident" id="5781410">b</span>&nbsp;<span class="op" id="5781412">==</span>&nbsp;<span class="string" id="5781415">&#39;\v&#39;</span>&nbsp;<span class="op" id="5781420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781425">b</span>&nbsp;<span class="op" id="5781427">=</span>&nbsp;<span class="string" id="5781429">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5781434">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781459">switch</span>&nbsp;<span class="ident" id="5781466">p</span><span class="op" id="5781467">.</span><span class="ident" id="5781468">state</span>&nbsp;<span class="op" id="5781474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781478">case</span>&nbsp;<span class="ident" id="5781483">inSpace</span><span class="op" id="5781490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781495">switch</span>&nbsp;<span class="ident" id="5781502">b</span>&nbsp;<span class="op" id="5781504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781509">case</span>&nbsp;<span class="string" id="5781514">&#39;\t&#39;</span><span class="op" id="5781518">,</span>&nbsp;<span class="string" id="5781520">&#39;&nbsp;&#39;</span><span class="op" id="5781523">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781529">p</span><span class="op" id="5781530">.</span><span class="ident" id="5781531">space</span>&nbsp;<span class="op" id="5781537">=</span>&nbsp;<span class="builtinfunc" id="5781539">append</span><span class="op" id="5781545">(</span><span class="ident" id="5781546">p</span><span class="op" id="5781547">.</span><span class="ident" id="5781548">space</span><span class="op" id="5781553">,</span>&nbsp;<span class="ident" id="5781555">b</span><span class="op" id="5781556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781561">case</span>&nbsp;<span class="string" id="5781566">&#39;\n&#39;</span><span class="op" id="5781570">,</span>&nbsp;<span class="string" id="5781572">&#39;\f&#39;</span><span class="op" id="5781576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781582">p</span><span class="op" id="5781583">.</span><span class="ident" id="5781584">resetSpace</span><span class="op" id="5781594">(</span><span class="op" id="5781595">)</span>&nbsp;<span class="comment" id="5781597">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781627">_</span><span class="op" id="5781628">,</span>&nbsp;<span class="ident" id="5781630">err</span>&nbsp;<span class="op" id="5781634">=</span>&nbsp;<span class="ident" id="5781636">p</span><span class="op" id="5781637">.</span><span class="ident" id="5781638">output</span><span class="op" id="5781644">.</span><span class="ident" id="5781645">Write</span><span class="op" id="5781650">(</span><span class="ident" id="5781651">aNewline</span><span class="op" id="5781659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781664">case</span>&nbsp;<span class="ident" id="5781669">tabwriter</span><span class="op" id="5781678">.</span><span class="ident" id="5781679">Escape</span><span class="op" id="5781685">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781691">_</span><span class="op" id="5781692">,</span>&nbsp;<span class="ident" id="5781694">err</span>&nbsp;<span class="op" id="5781698">=</span>&nbsp;<span class="ident" id="5781700">p</span><span class="op" id="5781701">.</span><span class="ident" id="5781702">output</span><span class="op" id="5781708">.</span><span class="ident" id="5781709">Write</span><span class="op" id="5781714">(</span><span class="ident" id="5781715">p</span><span class="op" id="5781716">.</span><span class="ident" id="5781717">space</span><span class="op" id="5781722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781728">p</span><span class="op" id="5781729">.</span><span class="ident" id="5781730">state</span>&nbsp;<span class="op" id="5781736">=</span>&nbsp;<span class="ident" id="5781738">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781751">m</span>&nbsp;<span class="op" id="5781753">=</span>&nbsp;<span class="ident" id="5781755">n</span>&nbsp;<span class="op" id="5781757">+</span>&nbsp;<span class="num" id="5781759">1</span>&nbsp;<span class="comment" id="5781761">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781793">default</span><span class="op" id="5781800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781806">_</span><span class="op" id="5781807">,</span>&nbsp;<span class="ident" id="5781809">err</span>&nbsp;<span class="op" id="5781813">=</span>&nbsp;<span class="ident" id="5781815">p</span><span class="op" id="5781816">.</span><span class="ident" id="5781817">output</span><span class="op" id="5781823">.</span><span class="ident" id="5781824">Write</span><span class="op" id="5781829">(</span><span class="ident" id="5781830">p</span><span class="op" id="5781831">.</span><span class="ident" id="5781832">space</span><span class="op" id="5781837">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781843">p</span><span class="op" id="5781844">.</span><span class="ident" id="5781845">state</span>&nbsp;<span class="op" id="5781851">=</span>&nbsp;<span class="ident" id="5781853">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781864">m</span>&nbsp;<span class="op" id="5781866">=</span>&nbsp;<span class="ident" id="5781868">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781877">case</span>&nbsp;<span class="ident" id="5781882">inEscape</span><span class="op" id="5781890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781895">if</span>&nbsp;<span class="ident" id="5781898">b</span>&nbsp;<span class="op" id="5781900">==</span>&nbsp;<span class="ident" id="5781903">tabwriter</span><span class="op" id="5781912">.</span><span class="ident" id="5781913">Escape</span>&nbsp;<span class="op" id="5781920">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781926">_</span><span class="op" id="5781927">,</span>&nbsp;<span class="ident" id="5781929">err</span>&nbsp;<span class="op" id="5781933">=</span>&nbsp;<span class="ident" id="5781935">p</span><span class="op" id="5781936">.</span><span class="ident" id="5781937">output</span><span class="op" id="5781943">.</span><span class="ident" id="5781944">Write</span><span class="op" id="5781949">(</span><span class="ident" id="5781950">data</span><span class="op" id="5781954">[</span><span class="ident" id="5781955">m</span><span class="op" id="5781956">:</span><span class="ident" id="5781957">n</span><span class="op" id="5781958">]</span><span class="op" id="5781959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781965">p</span><span class="op" id="5781966">.</span><span class="ident" id="5781967">resetSpace</span><span class="op" id="5781977">(</span><span class="op" id="5781978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781987">case</span>&nbsp;<span class="ident" id="5781992">inText</span><span class="op" id="5781998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782003">switch</span>&nbsp;<span class="ident" id="5782010">b</span>&nbsp;<span class="op" id="5782012">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782017">case</span>&nbsp;<span class="string" id="5782022">&#39;\t&#39;</span><span class="op" id="5782026">,</span>&nbsp;<span class="string" id="5782028">&#39;&nbsp;&#39;</span><span class="op" id="5782031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782037">_</span><span class="op" id="5782038">,</span>&nbsp;<span class="ident" id="5782040">err</span>&nbsp;<span class="op" id="5782044">=</span>&nbsp;<span class="ident" id="5782046">p</span><span class="op" id="5782047">.</span><span class="ident" id="5782048">output</span><span class="op" id="5782054">.</span><span class="ident" id="5782055">Write</span><span class="op" id="5782060">(</span><span class="ident" id="5782061">data</span><span class="op" id="5782065">[</span><span class="ident" id="5782066">m</span><span class="op" id="5782067">:</span><span class="ident" id="5782068">n</span><span class="op" id="5782069">]</span><span class="op" id="5782070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782076">p</span><span class="op" id="5782077">.</span><span class="ident" id="5782078">resetSpace</span><span class="op" id="5782088">(</span><span class="op" id="5782089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782095">p</span><span class="op" id="5782096">.</span><span class="ident" id="5782097">space</span>&nbsp;<span class="op" id="5782103">=</span>&nbsp;<span class="builtinfunc" id="5782105">append</span><span class="op" id="5782111">(</span><span class="ident" id="5782112">p</span><span class="op" id="5782113">.</span><span class="ident" id="5782114">space</span><span class="op" id="5782119">,</span>&nbsp;<span class="ident" id="5782121">b</span><span class="op" id="5782122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782127">case</span>&nbsp;<span class="string" id="5782132">&#39;\n&#39;</span><span class="op" id="5782136">,</span>&nbsp;<span class="string" id="5782138">&#39;\f&#39;</span><span class="op" id="5782142">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782148">_</span><span class="op" id="5782149">,</span>&nbsp;<span class="ident" id="5782151">err</span>&nbsp;<span class="op" id="5782155">=</span>&nbsp;<span class="ident" id="5782157">p</span><span class="op" id="5782158">.</span><span class="ident" id="5782159">output</span><span class="op" id="5782165">.</span><span class="ident" id="5782166">Write</span><span class="op" id="5782171">(</span><span class="ident" id="5782172">data</span><span class="op" id="5782176">[</span><span class="ident" id="5782177">m</span><span class="op" id="5782178">:</span><span class="ident" id="5782179">n</span><span class="op" id="5782180">]</span><span class="op" id="5782181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782187">p</span><span class="op" id="5782188">.</span><span class="ident" id="5782189">resetSpace</span><span class="op" id="5782199">(</span><span class="op" id="5782200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782206">_</span><span class="op" id="5782207">,</span>&nbsp;<span class="ident" id="5782209">err</span>&nbsp;<span class="op" id="5782213">=</span>&nbsp;<span class="ident" id="5782215">p</span><span class="op" id="5782216">.</span><span class="ident" id="5782217">output</span><span class="op" id="5782223">.</span><span class="ident" id="5782224">Write</span><span class="op" id="5782229">(</span><span class="ident" id="5782230">aNewline</span><span class="op" id="5782238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782243">case</span>&nbsp;<span class="ident" id="5782248">tabwriter</span><span class="op" id="5782257">.</span><span class="ident" id="5782258">Escape</span><span class="op" id="5782264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782270">_</span><span class="op" id="5782271">,</span>&nbsp;<span class="ident" id="5782273">err</span>&nbsp;<span class="op" id="5782277">=</span>&nbsp;<span class="ident" id="5782279">p</span><span class="op" id="5782280">.</span><span class="ident" id="5782281">output</span><span class="op" id="5782287">.</span><span class="ident" id="5782288">Write</span><span class="op" id="5782293">(</span><span class="ident" id="5782294">data</span><span class="op" id="5782298">[</span><span class="ident" id="5782299">m</span><span class="op" id="5782300">:</span><span class="ident" id="5782301">n</span><span class="op" id="5782302">]</span><span class="op" id="5782303">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782309">p</span><span class="op" id="5782310">.</span><span class="ident" id="5782311">state</span>&nbsp;<span class="op" id="5782317">=</span>&nbsp;<span class="ident" id="5782319">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782332">m</span>&nbsp;<span class="op" id="5782334">=</span>&nbsp;<span class="ident" id="5782336">n</span>&nbsp;<span class="op" id="5782338">+</span>&nbsp;<span class="num" id="5782340">1</span>&nbsp;<span class="comment" id="5782342">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782378">default</span><span class="op" id="5782385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5782390">panic</span><span class="op" id="5782395">(</span><span class="string" id="5782396">&#34;unreachable&#34;</span><span class="op" id="5782409">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782417">if</span>&nbsp;<span class="ident" id="5782420">err</span>&nbsp;<span class="op" id="5782424">!=</span>&nbsp;<span class="ident" id="5782427">nil</span>&nbsp;<span class="op" id="5782431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782436">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782448">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782451">n</span>&nbsp;<span class="op" id="5782453">=</span>&nbsp;<span class="builtinfunc" id="5782455">len</span><span class="op" id="5782458">(</span><span class="ident" id="5782459">data</span><span class="op" id="5782463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782467">switch</span>&nbsp;<span class="ident" id="5782474">p</span><span class="op" id="5782475">.</span><span class="ident" id="5782476">state</span>&nbsp;<span class="op" id="5782482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782485">case</span>&nbsp;<span class="ident" id="5782490">inEscape</span><span class="op" id="5782498">,</span>&nbsp;<span class="ident" id="5782500">inText</span><span class="op" id="5782506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782510">_</span><span class="op" id="5782511">,</span>&nbsp;<span class="ident" id="5782513">err</span>&nbsp;<span class="op" id="5782517">=</span>&nbsp;<span class="ident" id="5782519">p</span><span class="op" id="5782520">.</span><span class="ident" id="5782521">output</span><span class="op" id="5782527">.</span><span class="ident" id="5782528">Write</span><span class="op" id="5782533">(</span><span class="ident" id="5782534">data</span><span class="op" id="5782538">[</span><span class="ident" id="5782539">m</span><span class="op" id="5782540">:</span><span class="ident" id="5782541">n</span><span class="op" id="5782542">]</span><span class="op" id="5782543">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782547">p</span><span class="op" id="5782548">.</span><span class="ident" id="5782549">resetSpace</span><span class="op" id="5782559">(</span><span class="op" id="5782560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782567">return</span><br>
<span class="lineno"></span><span class="op" id="5782574">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5782577">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5782657">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5782678">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5782743">type</span>&nbsp;<span class="ident" id="5782748">Mode</span>&nbsp;<span class="builtintype" id="5782753">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5782759">const</span>&nbsp;<span class="op" id="5782765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782768">RawFormat</span>&nbsp;<span class="ident" id="5782778">Mode</span>&nbsp;<span class="op" id="5782783">=</span>&nbsp;<span class="num" id="5782785">1</span>&nbsp;<span class="op" id="5782787">&lt;&lt;</span>&nbsp;<span class="ident" id="5782790">iota</span>&nbsp;<span class="comment" id="5782795">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782852">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5782879">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782933">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5782960">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783005">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5783032">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5783094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5783097">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5783145">type</span>&nbsp;<span class="ident" id="5783150">Config</span>&nbsp;<span class="keyword" id="5783157">struct</span>&nbsp;<span class="op" id="5783164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783167">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783176">Mode</span>&nbsp;<span class="comment" id="5783181">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783196">Tabwidth</span>&nbsp;<span class="builtintype" id="5783205">int</span>&nbsp;&nbsp;<span class="comment" id="5783210">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783225">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5783234">int</span>&nbsp;&nbsp;<span class="comment" id="5783239">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5783298">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5783301">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5783390">func</span>&nbsp;<span class="op" id="5783395">(</span><span class="ident" id="5783396">cfg</span>&nbsp;<span class="op" id="5783400">*</span><span class="ident" id="5783401">Config</span><span class="op" id="5783407">)</span>&nbsp;<span class="ident" id="5783409">fprint</span><span class="op" id="5783415">(</span><span class="ident" id="5783416">output</span>&nbsp;<span class="ident" id="5783423">io</span><span class="op" id="5783425">.</span><span class="ident" id="5783426">Writer</span><span class="op" id="5783432">,</span>&nbsp;<span class="ident" id="5783434">fset</span>&nbsp;<span class="op" id="5783439">*</span><span class="ident" id="5783440">token</span><span class="op" id="5783445">.</span><span class="ident" id="5783446">FileSet</span><span class="op" id="5783453">,</span>&nbsp;<span class="ident" id="5783455">node</span>&nbsp;<span class="keyword" id="5783460">interface</span><span class="op" id="5783469">{</span><span class="op" id="5783470">}</span><span class="op" id="5783471">,</span>&nbsp;<span class="ident" id="5783473">nodeSizes</span>&nbsp;<span class="keyword" id="5783483">map</span><span class="op" id="5783486">[</span><span class="ident" id="5783487">ast</span><span class="op" id="5783490">.</span><span class="ident" id="5783491">Node</span><span class="op" id="5783495">]</span><span class="builtintype" id="5783496">int</span><span class="op" id="5783499">)</span>&nbsp;<span class="op" id="5783501">(</span><span class="ident" id="5783502">err</span>&nbsp;<span class="builtintype" id="5783506">error</span><span class="op" id="5783511">)</span>&nbsp;<span class="op" id="5783513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783516">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783531">var</span>&nbsp;<span class="ident" id="5783535">p</span>&nbsp;<span class="ident" id="5783537">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783546">p</span><span class="op" id="5783547">.</span><span class="ident" id="5783548">init</span><span class="op" id="5783552">(</span><span class="ident" id="5783553">cfg</span><span class="op" id="5783556">,</span>&nbsp;<span class="ident" id="5783558">fset</span><span class="op" id="5783562">,</span>&nbsp;<span class="ident" id="5783564">nodeSizes</span><span class="op" id="5783573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783576">if</span>&nbsp;<span class="ident" id="5783579">err</span>&nbsp;<span class="op" id="5783583">=</span>&nbsp;<span class="ident" id="5783585">p</span><span class="op" id="5783586">.</span><span class="ident" id="5783587">printNode</span><span class="op" id="5783596">(</span><span class="ident" id="5783597">node</span><span class="op" id="5783601">)</span><span class="op" id="5783602">;</span>&nbsp;<span class="ident" id="5783604">err</span>&nbsp;<span class="op" id="5783608">!=</span>&nbsp;<span class="ident" id="5783611">nil</span>&nbsp;<span class="op" id="5783615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783619">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783630">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783661">p</span><span class="op" id="5783662">.</span><span class="ident" id="5783663">impliedSemi</span>&nbsp;<span class="op" id="5783675">=</span>&nbsp;<span class="ident" id="5783677">false</span>&nbsp;<span class="comment" id="5783683">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783711">p</span><span class="op" id="5783712">.</span><span class="ident" id="5783713">flush</span><span class="op" id="5783718">(</span><span class="ident" id="5783719">token</span><span class="op" id="5783724">.</span><span class="ident" id="5783725">Position</span><span class="op" id="5783733">{</span><span class="ident" id="5783734">Offset</span><span class="op" id="5783740">:</span>&nbsp;<span class="ident" id="5783742">infinity</span><span class="op" id="5783750">,</span>&nbsp;<span class="ident" id="5783752">Line</span><span class="op" id="5783756">:</span>&nbsp;<span class="ident" id="5783758">infinity</span><span class="op" id="5783766">}</span><span class="op" id="5783767">,</span>&nbsp;<span class="ident" id="5783769">token</span><span class="op" id="5783774">.</span><span class="ident" id="5783775">EOF</span><span class="op" id="5783778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783782">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783853">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783925">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783990">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784057">output</span>&nbsp;<span class="op" id="5784064">=</span>&nbsp;<span class="op" id="5784066">&amp;</span><span class="ident" id="5784067">trimmer</span><span class="op" id="5784074">{</span><span class="ident" id="5784075">output</span><span class="op" id="5784081">:</span>&nbsp;<span class="ident" id="5784083">output</span><span class="op" id="5784089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784093">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784146">if</span>&nbsp;<span class="ident" id="5784149">cfg</span><span class="op" id="5784152">.</span><span class="ident" id="5784153">Mode</span><span class="op" id="5784157">&amp;</span><span class="ident" id="5784158">RawFormat</span>&nbsp;<span class="op" id="5784168">==</span>&nbsp;<span class="num" id="5784171">0</span>&nbsp;<span class="op" id="5784173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784177">minwidth</span>&nbsp;<span class="op" id="5784186">:=</span>&nbsp;<span class="ident" id="5784189">cfg</span><span class="op" id="5784192">.</span><span class="ident" id="5784193">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784205">padchar</span>&nbsp;<span class="op" id="5784213">:=</span>&nbsp;<span class="builtintype" id="5784216">byte</span><span class="op" id="5784220">(</span><span class="string" id="5784221">&#39;\t&#39;</span><span class="op" id="5784225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784229">if</span>&nbsp;<span class="ident" id="5784232">cfg</span><span class="op" id="5784235">.</span><span class="ident" id="5784236">Mode</span><span class="op" id="5784240">&amp;</span><span class="ident" id="5784241">UseSpaces</span>&nbsp;<span class="op" id="5784251">!=</span>&nbsp;<span class="num" id="5784254">0</span>&nbsp;<span class="op" id="5784256">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784261">padchar</span>&nbsp;<span class="op" id="5784269">=</span>&nbsp;<span class="string" id="5784271">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784282">twmode</span>&nbsp;<span class="op" id="5784289">:=</span>&nbsp;<span class="ident" id="5784292">tabwriter</span><span class="op" id="5784301">.</span><span class="ident" id="5784302">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784324">if</span>&nbsp;<span class="ident" id="5784327">cfg</span><span class="op" id="5784330">.</span><span class="ident" id="5784331">Mode</span><span class="op" id="5784335">&amp;</span><span class="ident" id="5784336">TabIndent</span>&nbsp;<span class="op" id="5784346">!=</span>&nbsp;<span class="num" id="5784349">0</span>&nbsp;<span class="op" id="5784351">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784356">minwidth</span>&nbsp;<span class="op" id="5784365">=</span>&nbsp;<span class="num" id="5784367">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784372">twmode</span>&nbsp;<span class="op" id="5784379">|=</span>&nbsp;<span class="ident" id="5784382">tabwriter</span><span class="op" id="5784391">.</span><span class="ident" id="5784392">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784409">output</span>&nbsp;<span class="op" id="5784416">=</span>&nbsp;<span class="ident" id="5784418">tabwriter</span><span class="op" id="5784427">.</span><span class="ident" id="5784428">NewWriter</span><span class="op" id="5784437">(</span><span class="ident" id="5784438">output</span><span class="op" id="5784444">,</span>&nbsp;<span class="ident" id="5784446">minwidth</span><span class="op" id="5784454">,</span>&nbsp;<span class="ident" id="5784456">cfg</span><span class="op" id="5784459">.</span><span class="ident" id="5784460">Tabwidth</span><span class="op" id="5784468">,</span>&nbsp;<span class="num" id="5784470">1</span><span class="op" id="5784471">,</span>&nbsp;<span class="ident" id="5784473">padchar</span><span class="op" id="5784480">,</span>&nbsp;<span class="ident" id="5784482">twmode</span><span class="op" id="5784488">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784495">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784552">if</span>&nbsp;<span class="ident" id="5784555">_</span><span class="op" id="5784556">,</span>&nbsp;<span class="ident" id="5784558">err</span>&nbsp;<span class="op" id="5784562">=</span>&nbsp;<span class="ident" id="5784564">output</span><span class="op" id="5784570">.</span><span class="ident" id="5784571">Write</span><span class="op" id="5784576">(</span><span class="ident" id="5784577">p</span><span class="op" id="5784578">.</span><span class="ident" id="5784579">output</span><span class="op" id="5784585">)</span><span class="op" id="5784586">;</span>&nbsp;<span class="ident" id="5784588">err</span>&nbsp;<span class="op" id="5784592">!=</span>&nbsp;<span class="ident" id="5784595">nil</span>&nbsp;<span class="op" id="5784599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784603">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784615">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784643">if</span>&nbsp;<span class="ident" id="5784646">tw</span><span class="op" id="5784648">,</span>&nbsp;<span class="ident" id="5784650">_</span>&nbsp;<span class="op" id="5784652">:=</span>&nbsp;<span class="ident" id="5784655">output</span><span class="op" id="5784661">.</span><span class="op" id="5784662">(</span><span class="op" id="5784663">*</span><span class="ident" id="5784664">tabwriter</span><span class="op" id="5784673">.</span><span class="ident" id="5784674">Writer</span><span class="op" id="5784680">)</span><span class="op" id="5784681">;</span>&nbsp;<span class="ident" id="5784683">tw</span>&nbsp;<span class="op" id="5784686">!=</span>&nbsp;<span class="ident" id="5784689">nil</span>&nbsp;<span class="op" id="5784693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784697">err</span>&nbsp;<span class="op" id="5784701">=</span>&nbsp;<span class="ident" id="5784703">tw</span><span class="op" id="5784705">.</span><span class="ident" id="5784706">Flush</span><span class="op" id="5784711">(</span><span class="op" id="5784712">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784719">return</span><br>
<span class="lineno"></span><span class="op" id="5784726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5784729">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5784796">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5784862">//</span><br>
<span class="lineno"></span><span class="keyword" id="5784865">type</span>&nbsp;<span class="ident" id="5784870">CommentedNode</span>&nbsp;<span class="keyword" id="5784884">struct</span>&nbsp;<span class="op" id="5784891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784894">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5784903">interface</span><span class="op" id="5784912">{</span><span class="op" id="5784913">}</span>&nbsp;<span class="comment" id="5784915">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784975">Comments</span>&nbsp;<span class="op" id="5784984">[</span><span class="op" id="5784985">]</span><span class="op" id="5784986">*</span><span class="ident" id="5784987">ast</span><span class="op" id="5784990">.</span><span class="ident" id="5784991">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5785004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785007">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5785086">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5785156">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5785232">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5785306">//</span><br>
<span class="lineno"></span><span class="keyword" id="5785309">func</span>&nbsp;<span class="op" id="5785314">(</span><span class="ident" id="5785315">cfg</span>&nbsp;<span class="op" id="5785319">*</span><span class="ident" id="5785320">Config</span><span class="op" id="5785326">)</span>&nbsp;<span class="ident" id="5785328">Fprint</span><span class="op" id="5785334">(</span><span class="ident" id="5785335">output</span>&nbsp;<span class="ident" id="5785342">io</span><span class="op" id="5785344">.</span><span class="ident" id="5785345">Writer</span><span class="op" id="5785351">,</span>&nbsp;<span class="ident" id="5785353">fset</span>&nbsp;<span class="op" id="5785358">*</span><span class="ident" id="5785359">token</span><span class="op" id="5785364">.</span><span class="ident" id="5785365">FileSet</span><span class="op" id="5785372">,</span>&nbsp;<span class="ident" id="5785374">node</span>&nbsp;<span class="keyword" id="5785379">interface</span><span class="op" id="5785388">{</span><span class="op" id="5785389">}</span><span class="op" id="5785390">)</span>&nbsp;<span class="builtintype" id="5785392">error</span>&nbsp;<span class="op" id="5785398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785401">return</span>&nbsp;<span class="ident" id="5785408">cfg</span><span class="op" id="5785411">.</span><span class="ident" id="5785412">fprint</span><span class="op" id="5785418">(</span><span class="ident" id="5785419">output</span><span class="op" id="5785425">,</span>&nbsp;<span class="ident" id="5785427">fset</span><span class="op" id="5785431">,</span>&nbsp;<span class="ident" id="5785433">node</span><span class="op" id="5785437">,</span>&nbsp;<span class="builtinfunc" id="5785439">make</span><span class="op" id="5785443">(</span><span class="keyword" id="5785444">map</span><span class="op" id="5785447">[</span><span class="ident" id="5785448">ast</span><span class="op" id="5785451">.</span><span class="ident" id="5785452">Node</span><span class="op" id="5785456">]</span><span class="builtintype" id="5785457">int</span><span class="op" id="5785460">)</span><span class="op" id="5785461">)</span><br>
<span class="lineno">1285</span><span class="op" id="5785463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785466">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5785515">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5785564">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5785567">func</span>&nbsp;<span class="ident" id="5785572">Fprint</span><span class="op" id="5785578">(</span><span class="ident" id="5785579">output</span>&nbsp;<span class="ident" id="5785586">io</span><span class="op" id="5785588">.</span><span class="ident" id="5785589">Writer</span><span class="op" id="5785595">,</span>&nbsp;<span class="ident" id="5785597">fset</span>&nbsp;<span class="op" id="5785602">*</span><span class="ident" id="5785603">token</span><span class="op" id="5785608">.</span><span class="ident" id="5785609">FileSet</span><span class="op" id="5785616">,</span>&nbsp;<span class="ident" id="5785618">node</span>&nbsp;<span class="keyword" id="5785623">interface</span><span class="op" id="5785632">{</span><span class="op" id="5785633">}</span><span class="op" id="5785634">)</span>&nbsp;<span class="builtintype" id="5785636">error</span>&nbsp;<span class="op" id="5785642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785645">return</span>&nbsp;<span class="op" id="5785652">(</span><span class="op" id="5785653">&amp;</span><span class="ident" id="5785654">Config</span><span class="op" id="5785660">{</span><span class="ident" id="5785661">Tabwidth</span><span class="op" id="5785669">:</span>&nbsp;<span class="num" id="5785671">8</span><span class="op" id="5785672">}</span><span class="op" id="5785673">)</span><span class="op" id="5785674">.</span><span class="ident" id="5785675">Fprint</span><span class="op" id="5785681">(</span><span class="ident" id="5785682">output</span><span class="op" id="5785688">,</span>&nbsp;<span class="ident" id="5785690">fset</span><span class="op" id="5785694">,</span>&nbsp;<span class="ident" id="5785696">node</span><span class="op" id="5785700">)</span><br>
<span class="lineno"></span><span class="op" id="5785702">}</span>
</div>
</body>
</html>
