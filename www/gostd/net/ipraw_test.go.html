<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6630566">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6630622">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6630676">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6630727">package</span>&nbsp;<span class="ident" id="6630735">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6630740">import</span>&nbsp;<span class="op" id="6630747">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630750">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630759">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630766">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630772">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630783">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630794">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6630805">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6630812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6630815">type</span>&nbsp;<span class="ident" id="6630820">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="6630838">struct</span>&nbsp;<span class="op" id="6630845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6630848">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6630862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6630870">litAddrOrName</span>&nbsp;<span class="builtintype" id="6630884">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6630892">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630906">*</span><span class="ident" id="6630907">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6630915">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6630929">error</span><br>
<span class="lineno"></span><span class="op" id="6630935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6630938">var</span>&nbsp;<span class="ident" id="6630942">resolveIPAddrTests</span>&nbsp;<span class="op" id="6630961">=</span>&nbsp;<span class="op" id="6630963">[</span><span class="op" id="6630964">]</span><span class="ident" id="6630965">resolveIPAddrTest</span><span class="op" id="6630982">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6630985">{</span><span class="string" id="6630986">&#34;ip&#34;</span><span class="op" id="6630990">,</span>&nbsp;<span class="string" id="6630992">&#34;127.0.0.1&#34;</span><span class="op" id="6631003">,</span>&nbsp;<span class="op" id="6631005">&amp;</span><span class="ident" id="6631006">IPAddr</span><span class="op" id="6631012">{</span><span class="ident" id="6631013">IP</span><span class="op" id="6631015">:</span>&nbsp;<span class="ident" id="6631017">IPv4</span><span class="op" id="6631021">(</span><span class="num" id="6631022">127</span><span class="op" id="6631025">,</span>&nbsp;<span class="num" id="6631027">0</span><span class="op" id="6631028">,</span>&nbsp;<span class="num" id="6631030">0</span><span class="op" id="6631031">,</span>&nbsp;<span class="num" id="6631033">1</span><span class="op" id="6631034">)</span><span class="op" id="6631035">}</span><span class="op" id="6631036">,</span>&nbsp;<span class="ident" id="6631038">nil</span><span class="op" id="6631041">}</span><span class="op" id="6631042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631045">{</span><span class="string" id="6631046">&#34;ip4&#34;</span><span class="op" id="6631051">,</span>&nbsp;<span class="string" id="6631053">&#34;127.0.0.1&#34;</span><span class="op" id="6631064">,</span>&nbsp;<span class="op" id="6631066">&amp;</span><span class="ident" id="6631067">IPAddr</span><span class="op" id="6631073">{</span><span class="ident" id="6631074">IP</span><span class="op" id="6631076">:</span>&nbsp;<span class="ident" id="6631078">IPv4</span><span class="op" id="6631082">(</span><span class="num" id="6631083">127</span><span class="op" id="6631086">,</span>&nbsp;<span class="num" id="6631088">0</span><span class="op" id="6631089">,</span>&nbsp;<span class="num" id="6631091">0</span><span class="op" id="6631092">,</span>&nbsp;<span class="num" id="6631094">1</span><span class="op" id="6631095">)</span><span class="op" id="6631096">}</span><span class="op" id="6631097">,</span>&nbsp;<span class="ident" id="6631099">nil</span><span class="op" id="6631102">}</span><span class="op" id="6631103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631106">{</span><span class="string" id="6631107">&#34;ip4:icmp&#34;</span><span class="op" id="6631117">,</span>&nbsp;<span class="string" id="6631119">&#34;127.0.0.1&#34;</span><span class="op" id="6631130">,</span>&nbsp;<span class="op" id="6631132">&amp;</span><span class="ident" id="6631133">IPAddr</span><span class="op" id="6631139">{</span><span class="ident" id="6631140">IP</span><span class="op" id="6631142">:</span>&nbsp;<span class="ident" id="6631144">IPv4</span><span class="op" id="6631148">(</span><span class="num" id="6631149">127</span><span class="op" id="6631152">,</span>&nbsp;<span class="num" id="6631154">0</span><span class="op" id="6631155">,</span>&nbsp;<span class="num" id="6631157">0</span><span class="op" id="6631158">,</span>&nbsp;<span class="num" id="6631160">1</span><span class="op" id="6631161">)</span><span class="op" id="6631162">}</span><span class="op" id="6631163">,</span>&nbsp;<span class="ident" id="6631165">nil</span><span class="op" id="6631168">}</span><span class="op" id="6631169">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631173">{</span><span class="string" id="6631174">&#34;ip&#34;</span><span class="op" id="6631178">,</span>&nbsp;<span class="string" id="6631180">&#34;::1&#34;</span><span class="op" id="6631185">,</span>&nbsp;<span class="op" id="6631187">&amp;</span><span class="ident" id="6631188">IPAddr</span><span class="op" id="6631194">{</span><span class="ident" id="6631195">IP</span><span class="op" id="6631197">:</span>&nbsp;<span class="ident" id="6631199">ParseIP</span><span class="op" id="6631206">(</span><span class="string" id="6631207">&#34;::1&#34;</span><span class="op" id="6631212">)</span><span class="op" id="6631213">}</span><span class="op" id="6631214">,</span>&nbsp;<span class="ident" id="6631216">nil</span><span class="op" id="6631219">}</span><span class="op" id="6631220">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631223">{</span><span class="string" id="6631224">&#34;ip6&#34;</span><span class="op" id="6631229">,</span>&nbsp;<span class="string" id="6631231">&#34;::1&#34;</span><span class="op" id="6631236">,</span>&nbsp;<span class="op" id="6631238">&amp;</span><span class="ident" id="6631239">IPAddr</span><span class="op" id="6631245">{</span><span class="ident" id="6631246">IP</span><span class="op" id="6631248">:</span>&nbsp;<span class="ident" id="6631250">ParseIP</span><span class="op" id="6631257">(</span><span class="string" id="6631258">&#34;::1&#34;</span><span class="op" id="6631263">)</span><span class="op" id="6631264">}</span><span class="op" id="6631265">,</span>&nbsp;<span class="ident" id="6631267">nil</span><span class="op" id="6631270">}</span><span class="op" id="6631271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631274">{</span><span class="string" id="6631275">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6631290">,</span>&nbsp;<span class="string" id="6631292">&#34;::1&#34;</span><span class="op" id="6631297">,</span>&nbsp;<span class="op" id="6631299">&amp;</span><span class="ident" id="6631300">IPAddr</span><span class="op" id="6631306">{</span><span class="ident" id="6631307">IP</span><span class="op" id="6631309">:</span>&nbsp;<span class="ident" id="6631311">ParseIP</span><span class="op" id="6631318">(</span><span class="string" id="6631319">&#34;::1&#34;</span><span class="op" id="6631324">)</span><span class="op" id="6631325">}</span><span class="op" id="6631326">,</span>&nbsp;<span class="ident" id="6631328">nil</span><span class="op" id="6631331">}</span><span class="op" id="6631332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631335">{</span><span class="string" id="6631336">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="6631351">,</span>&nbsp;<span class="string" id="6631353">&#34;::1&#34;</span><span class="op" id="6631358">,</span>&nbsp;<span class="op" id="6631360">&amp;</span><span class="ident" id="6631361">IPAddr</span><span class="op" id="6631367">{</span><span class="ident" id="6631368">IP</span><span class="op" id="6631370">:</span>&nbsp;<span class="ident" id="6631372">ParseIP</span><span class="op" id="6631379">(</span><span class="string" id="6631380">&#34;::1&#34;</span><span class="op" id="6631385">)</span><span class="op" id="6631386">}</span><span class="op" id="6631387">,</span>&nbsp;<span class="ident" id="6631389">nil</span><span class="op" id="6631392">}</span><span class="op" id="6631393">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631397">{</span><span class="string" id="6631398">&#34;ip&#34;</span><span class="op" id="6631402">,</span>&nbsp;<span class="string" id="6631404">&#34;::1%en0&#34;</span><span class="op" id="6631413">,</span>&nbsp;<span class="op" id="6631415">&amp;</span><span class="ident" id="6631416">IPAddr</span><span class="op" id="6631422">{</span><span class="ident" id="6631423">IP</span><span class="op" id="6631425">:</span>&nbsp;<span class="ident" id="6631427">ParseIP</span><span class="op" id="6631434">(</span><span class="string" id="6631435">&#34;::1&#34;</span><span class="op" id="6631440">)</span><span class="op" id="6631441">,</span>&nbsp;<span class="ident" id="6631443">Zone</span><span class="op" id="6631447">:</span>&nbsp;<span class="string" id="6631449">&#34;en0&#34;</span><span class="op" id="6631454">}</span><span class="op" id="6631455">,</span>&nbsp;<span class="ident" id="6631457">nil</span><span class="op" id="6631460">}</span><span class="op" id="6631461">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631464">{</span><span class="string" id="6631465">&#34;ip6&#34;</span><span class="op" id="6631470">,</span>&nbsp;<span class="string" id="6631472">&#34;::1%911&#34;</span><span class="op" id="6631481">,</span>&nbsp;<span class="op" id="6631483">&amp;</span><span class="ident" id="6631484">IPAddr</span><span class="op" id="6631490">{</span><span class="ident" id="6631491">IP</span><span class="op" id="6631493">:</span>&nbsp;<span class="ident" id="6631495">ParseIP</span><span class="op" id="6631502">(</span><span class="string" id="6631503">&#34;::1&#34;</span><span class="op" id="6631508">)</span><span class="op" id="6631509">,</span>&nbsp;<span class="ident" id="6631511">Zone</span><span class="op" id="6631515">:</span>&nbsp;<span class="string" id="6631517">&#34;911&#34;</span><span class="op" id="6631522">}</span><span class="op" id="6631523">,</span>&nbsp;<span class="ident" id="6631525">nil</span><span class="op" id="6631528">}</span><span class="op" id="6631529">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631533">{</span><span class="string" id="6631534">&#34;&#34;</span><span class="op" id="6631536">,</span>&nbsp;<span class="string" id="6631538">&#34;127.0.0.1&#34;</span><span class="op" id="6631549">,</span>&nbsp;<span class="op" id="6631551">&amp;</span><span class="ident" id="6631552">IPAddr</span><span class="op" id="6631558">{</span><span class="ident" id="6631559">IP</span><span class="op" id="6631561">:</span>&nbsp;<span class="ident" id="6631563">IPv4</span><span class="op" id="6631567">(</span><span class="num" id="6631568">127</span><span class="op" id="6631571">,</span>&nbsp;<span class="num" id="6631573">0</span><span class="op" id="6631574">,</span>&nbsp;<span class="num" id="6631576">0</span><span class="op" id="6631577">,</span>&nbsp;<span class="num" id="6631579">1</span><span class="op" id="6631580">)</span><span class="op" id="6631581">}</span><span class="op" id="6631582">,</span>&nbsp;<span class="ident" id="6631584">nil</span><span class="op" id="6631587">}</span><span class="op" id="6631588">,</span>&nbsp;<span class="comment" id="6631590">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631610">{</span><span class="string" id="6631611">&#34;&#34;</span><span class="op" id="6631613">,</span>&nbsp;<span class="string" id="6631615">&#34;::1&#34;</span><span class="op" id="6631620">,</span>&nbsp;<span class="op" id="6631622">&amp;</span><span class="ident" id="6631623">IPAddr</span><span class="op" id="6631629">{</span><span class="ident" id="6631630">IP</span><span class="op" id="6631632">:</span>&nbsp;<span class="ident" id="6631634">ParseIP</span><span class="op" id="6631641">(</span><span class="string" id="6631642">&#34;::1&#34;</span><span class="op" id="6631647">)</span><span class="op" id="6631648">}</span><span class="op" id="6631649">,</span>&nbsp;<span class="ident" id="6631651">nil</span><span class="op" id="6631654">}</span><span class="op" id="6631655">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6631667">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631688">{</span><span class="string" id="6631689">&#34;l2tp&#34;</span><span class="op" id="6631695">,</span>&nbsp;<span class="string" id="6631697">&#34;127.0.0.1&#34;</span><span class="op" id="6631708">,</span>&nbsp;<span class="ident" id="6631710">nil</span><span class="op" id="6631713">,</span>&nbsp;<span class="ident" id="6631715">UnknownNetworkError</span><span class="op" id="6631734">(</span><span class="string" id="6631735">&#34;l2tp&#34;</span><span class="op" id="6631741">)</span><span class="op" id="6631742">}</span><span class="op" id="6631743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631746">{</span><span class="string" id="6631747">&#34;l2tp:gre&#34;</span><span class="op" id="6631757">,</span>&nbsp;<span class="string" id="6631759">&#34;127.0.0.1&#34;</span><span class="op" id="6631770">,</span>&nbsp;<span class="ident" id="6631772">nil</span><span class="op" id="6631775">,</span>&nbsp;<span class="ident" id="6631777">UnknownNetworkError</span><span class="op" id="6631796">(</span><span class="string" id="6631797">&#34;l2tp:gre&#34;</span><span class="op" id="6631807">)</span><span class="op" id="6631808">}</span><span class="op" id="6631809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6631812">{</span><span class="string" id="6631813">&#34;tcp&#34;</span><span class="op" id="6631818">,</span>&nbsp;<span class="string" id="6631820">&#34;1.2.3.4:123&#34;</span><span class="op" id="6631833">,</span>&nbsp;<span class="ident" id="6631835">nil</span><span class="op" id="6631838">,</span>&nbsp;<span class="ident" id="6631840">UnknownNetworkError</span><span class="op" id="6631859">(</span><span class="string" id="6631860">&#34;tcp&#34;</span><span class="op" id="6631865">)</span><span class="op" id="6631866">}</span><span class="op" id="6631867">,</span><br>
<span class="lineno"></span><span class="op" id="6631869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6631872">func</span>&nbsp;<span class="ident" id="6631877">init</span><span class="op" id="6631881">(</span><span class="op" id="6631882">)</span>&nbsp;<span class="op" id="6631884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6631887">if</span>&nbsp;<span class="ident" id="6631890">ifi</span>&nbsp;<span class="op" id="6631894">:=</span>&nbsp;<span class="ident" id="6631897">loopbackInterface</span><span class="op" id="6631914">(</span><span class="op" id="6631915">)</span><span class="op" id="6631916">;</span>&nbsp;<span class="ident" id="6631918">ifi</span>&nbsp;<span class="op" id="6631922">!=</span>&nbsp;<span class="ident" id="6631925">nil</span>&nbsp;<span class="op" id="6631929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6631933">index</span>&nbsp;<span class="op" id="6631939">:=</span>&nbsp;<span class="ident" id="6631942">fmt</span><span class="op" id="6631945">.</span><span class="ident" id="6631946">Sprintf</span><span class="op" id="6631953">(</span><span class="string" id="6631954">&#34;%v&#34;</span><span class="op" id="6631958">,</span>&nbsp;<span class="ident" id="6631960">ifi</span><span class="op" id="6631963">.</span><span class="ident" id="6631964">Index</span><span class="op" id="6631969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6631973">resolveIPAddrTests</span>&nbsp;<span class="op" id="6631992">=</span>&nbsp;<span class="builtinfunc" id="6631994">append</span><span class="op" id="6632000">(</span><span class="ident" id="6632001">resolveIPAddrTests</span><span class="op" id="6632019">,</span>&nbsp;<span class="op" id="6632021">[</span><span class="op" id="6632022">]</span><span class="ident" id="6632023">resolveIPAddrTest</span><span class="op" id="6632040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632045">{</span><span class="string" id="6632046">&#34;ip6&#34;</span><span class="op" id="6632051">,</span>&nbsp;<span class="string" id="6632053">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6632064">+</span>&nbsp;<span class="ident" id="6632066">ifi</span><span class="op" id="6632069">.</span><span class="ident" id="6632070">Name</span><span class="op" id="6632074">,</span>&nbsp;<span class="op" id="6632076">&amp;</span><span class="ident" id="6632077">IPAddr</span><span class="op" id="6632083">{</span><span class="ident" id="6632084">IP</span><span class="op" id="6632086">:</span>&nbsp;<span class="ident" id="6632088">ParseIP</span><span class="op" id="6632095">(</span><span class="string" id="6632096">&#34;fe80::1&#34;</span><span class="op" id="6632105">)</span><span class="op" id="6632106">,</span>&nbsp;<span class="ident" id="6632108">Zone</span><span class="op" id="6632112">:</span>&nbsp;<span class="ident" id="6632114">zoneToString</span><span class="op" id="6632126">(</span><span class="ident" id="6632127">ifi</span><span class="op" id="6632130">.</span><span class="ident" id="6632131">Index</span><span class="op" id="6632136">)</span><span class="op" id="6632137">}</span><span class="op" id="6632138">,</span>&nbsp;<span class="ident" id="6632140">nil</span><span class="op" id="6632143">}</span><span class="op" id="6632144">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632149">{</span><span class="string" id="6632150">&#34;ip6&#34;</span><span class="op" id="6632155">,</span>&nbsp;<span class="string" id="6632157">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6632168">+</span>&nbsp;<span class="ident" id="6632170">index</span><span class="op" id="6632175">,</span>&nbsp;<span class="op" id="6632177">&amp;</span><span class="ident" id="6632178">IPAddr</span><span class="op" id="6632184">{</span><span class="ident" id="6632185">IP</span><span class="op" id="6632187">:</span>&nbsp;<span class="ident" id="6632189">ParseIP</span><span class="op" id="6632196">(</span><span class="string" id="6632197">&#34;fe80::1&#34;</span><span class="op" id="6632206">)</span><span class="op" id="6632207">,</span>&nbsp;<span class="ident" id="6632209">Zone</span><span class="op" id="6632213">:</span>&nbsp;<span class="ident" id="6632215">index</span><span class="op" id="6632220">}</span><span class="op" id="6632221">,</span>&nbsp;<span class="ident" id="6632223">nil</span><span class="op" id="6632226">}</span><span class="op" id="6632227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632231">}</span><span class="op" id="6632232">...</span><span class="op" id="6632235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632241">if</span>&nbsp;<span class="ident" id="6632244">ips</span><span class="op" id="6632247">,</span>&nbsp;<span class="ident" id="6632249">err</span>&nbsp;<span class="op" id="6632253">:=</span>&nbsp;<span class="ident" id="6632256">LookupIP</span><span class="op" id="6632264">(</span><span class="string" id="6632265">&#34;localhost&#34;</span><span class="op" id="6632276">)</span><span class="op" id="6632277">;</span>&nbsp;<span class="ident" id="6632279">err</span>&nbsp;<span class="op" id="6632283">==</span>&nbsp;<span class="ident" id="6632286">nil</span>&nbsp;<span class="op" id="6632290">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6632293">len</span><span class="op" id="6632296">(</span><span class="ident" id="6632297">ips</span><span class="op" id="6632300">)</span>&nbsp;<span class="op" id="6632302">&gt;</span>&nbsp;<span class="num" id="6632304">1</span>&nbsp;<span class="op" id="6632306">&amp;&amp;</span>&nbsp;<span class="ident" id="6632309">supportsIPv4</span>&nbsp;<span class="op" id="6632322">&amp;&amp;</span>&nbsp;<span class="ident" id="6632325">supportsIPv6</span>&nbsp;<span class="op" id="6632338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6632342">resolveIPAddrTests</span>&nbsp;<span class="op" id="6632361">=</span>&nbsp;<span class="builtinfunc" id="6632363">append</span><span class="op" id="6632369">(</span><span class="ident" id="6632370">resolveIPAddrTests</span><span class="op" id="6632388">,</span>&nbsp;<span class="op" id="6632390">[</span><span class="op" id="6632391">]</span><span class="ident" id="6632392">resolveIPAddrTest</span><span class="op" id="6632409">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632414">{</span><span class="string" id="6632415">&#34;ip&#34;</span><span class="op" id="6632419">,</span>&nbsp;<span class="string" id="6632421">&#34;localhost&#34;</span><span class="op" id="6632432">,</span>&nbsp;<span class="op" id="6632434">&amp;</span><span class="ident" id="6632435">IPAddr</span><span class="op" id="6632441">{</span><span class="ident" id="6632442">IP</span><span class="op" id="6632444">:</span>&nbsp;<span class="ident" id="6632446">IPv4</span><span class="op" id="6632450">(</span><span class="num" id="6632451">127</span><span class="op" id="6632454">,</span>&nbsp;<span class="num" id="6632456">0</span><span class="op" id="6632457">,</span>&nbsp;<span class="num" id="6632459">0</span><span class="op" id="6632460">,</span>&nbsp;<span class="num" id="6632462">1</span><span class="op" id="6632463">)</span><span class="op" id="6632464">}</span><span class="op" id="6632465">,</span>&nbsp;<span class="ident" id="6632467">nil</span><span class="op" id="6632470">}</span><span class="op" id="6632471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632476">{</span><span class="string" id="6632477">&#34;ip4&#34;</span><span class="op" id="6632482">,</span>&nbsp;<span class="string" id="6632484">&#34;localhost&#34;</span><span class="op" id="6632495">,</span>&nbsp;<span class="op" id="6632497">&amp;</span><span class="ident" id="6632498">IPAddr</span><span class="op" id="6632504">{</span><span class="ident" id="6632505">IP</span><span class="op" id="6632507">:</span>&nbsp;<span class="ident" id="6632509">IPv4</span><span class="op" id="6632513">(</span><span class="num" id="6632514">127</span><span class="op" id="6632517">,</span>&nbsp;<span class="num" id="6632519">0</span><span class="op" id="6632520">,</span>&nbsp;<span class="num" id="6632522">0</span><span class="op" id="6632523">,</span>&nbsp;<span class="num" id="6632525">1</span><span class="op" id="6632526">)</span><span class="op" id="6632527">}</span><span class="op" id="6632528">,</span>&nbsp;<span class="ident" id="6632530">nil</span><span class="op" id="6632533">}</span><span class="op" id="6632534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632539">{</span><span class="string" id="6632540">&#34;ip6&#34;</span><span class="op" id="6632545">,</span>&nbsp;<span class="string" id="6632547">&#34;localhost&#34;</span><span class="op" id="6632558">,</span>&nbsp;<span class="op" id="6632560">&amp;</span><span class="ident" id="6632561">IPAddr</span><span class="op" id="6632567">{</span><span class="ident" id="6632568">IP</span><span class="op" id="6632570">:</span>&nbsp;<span class="ident" id="6632572">IPv6loopback</span><span class="op" id="6632584">}</span><span class="op" id="6632585">,</span>&nbsp;<span class="ident" id="6632587">nil</span><span class="op" id="6632590">}</span><span class="op" id="6632591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632595">}</span><span class="op" id="6632596">...</span><span class="op" id="6632599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632602">}</span><br>
<span class="lineno">60</span><span class="op" id="6632604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6632607">func</span>&nbsp;<span class="ident" id="6632612">skipRawSocketTest</span><span class="op" id="6632629">(</span><span class="ident" id="6632630">t</span>&nbsp;<span class="op" id="6632632">*</span><span class="ident" id="6632633">testing</span><span class="op" id="6632640">.</span><span class="ident" id="6632641">T</span><span class="op" id="6632642">)</span>&nbsp;<span class="op" id="6632644">(</span><span class="ident" id="6632645">skip</span>&nbsp;<span class="builtintype" id="6632650">bool</span><span class="op" id="6632654">,</span>&nbsp;<span class="ident" id="6632656">skipmsg</span>&nbsp;<span class="builtintype" id="6632664">string</span><span class="op" id="6632670">)</span>&nbsp;<span class="op" id="6632672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6632675">skip</span><span class="op" id="6632679">,</span>&nbsp;<span class="ident" id="6632681">skipmsg</span><span class="op" id="6632688">,</span>&nbsp;<span class="ident" id="6632690">err</span>&nbsp;<span class="op" id="6632694">:=</span>&nbsp;<span class="ident" id="6632697">skipRawSocketTests</span><span class="op" id="6632715">(</span><span class="op" id="6632716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632719">if</span>&nbsp;<span class="ident" id="6632722">err</span>&nbsp;<span class="op" id="6632726">!=</span>&nbsp;<span class="ident" id="6632729">nil</span>&nbsp;<span class="op" id="6632733">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6632737">t</span><span class="op" id="6632738">.</span><span class="ident" id="6632739">Fatal</span><span class="op" id="6632744">(</span><span class="ident" id="6632745">err</span><span class="op" id="6632748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632754">return</span>&nbsp;<span class="ident" id="6632761">skip</span><span class="op" id="6632765">,</span>&nbsp;<span class="ident" id="6632767">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="6632775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6632778">func</span>&nbsp;<span class="ident" id="6632783">TestResolveIPAddr</span><span class="op" id="6632800">(</span><span class="ident" id="6632801">t</span>&nbsp;<span class="op" id="6632803">*</span><span class="ident" id="6632804">testing</span><span class="op" id="6632811">.</span><span class="ident" id="6632812">T</span><span class="op" id="6632813">)</span>&nbsp;<span class="op" id="6632815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632818">switch</span>&nbsp;<span class="ident" id="6632825">runtime</span><span class="op" id="6632832">.</span><span class="ident" id="6632833">GOOS</span>&nbsp;<span class="op" id="6632838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632841">case</span>&nbsp;<span class="string" id="6632846">&#34;nacl&#34;</span><span class="op" id="6632852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6632856">t</span><span class="op" id="6632857">.</span><span class="ident" id="6632858">Skipf</span><span class="op" id="6632863">(</span><span class="string" id="6632864">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6632885">,</span>&nbsp;<span class="ident" id="6632887">runtime</span><span class="op" id="6632894">.</span><span class="ident" id="6632895">GOOS</span><span class="op" id="6632899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6632902">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6632906">for</span>&nbsp;<span class="ident" id="6632910">_</span><span class="op" id="6632911">,</span>&nbsp;<span class="ident" id="6632913">tt</span>&nbsp;<span class="op" id="6632916">:=</span>&nbsp;<span class="keyword" id="6632919">range</span>&nbsp;<span class="ident" id="6632925">resolveIPAddrTests</span>&nbsp;<span class="op" id="6632944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6632948">addr</span><span class="op" id="6632952">,</span>&nbsp;<span class="ident" id="6632954">err</span>&nbsp;<span class="op" id="6632958">:=</span>&nbsp;<span class="ident" id="6632961">ResolveIPAddr</span><span class="op" id="6632974">(</span><span class="ident" id="6632975">tt</span><span class="op" id="6632977">.</span><span class="ident" id="6632978">net</span><span class="op" id="6632981">,</span>&nbsp;<span class="ident" id="6632983">tt</span><span class="op" id="6632985">.</span><span class="ident" id="6632986">litAddrOrName</span><span class="op" id="6632999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633003">if</span>&nbsp;<span class="ident" id="6633006">err</span>&nbsp;<span class="op" id="6633010">!=</span>&nbsp;<span class="ident" id="6633013">tt</span><span class="op" id="6633015">.</span><span class="ident" id="6633016">err</span>&nbsp;<span class="op" id="6633020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633025">t</span><span class="op" id="6633026">.</span><span class="ident" id="6633027">Fatalf</span><span class="op" id="6633033">(</span><span class="string" id="6633034">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633068">,</span>&nbsp;<span class="ident" id="6633070">tt</span><span class="op" id="6633072">.</span><span class="ident" id="6633073">net</span><span class="op" id="6633076">,</span>&nbsp;<span class="ident" id="6633078">tt</span><span class="op" id="6633080">.</span><span class="ident" id="6633081">litAddrOrName</span><span class="op" id="6633094">,</span>&nbsp;<span class="ident" id="6633096">err</span><span class="op" id="6633099">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633103">}</span>&nbsp;<span class="keyword" id="6633105">else</span>&nbsp;<span class="keyword" id="6633110">if</span>&nbsp;<span class="op" id="6633113">!</span><span class="ident" id="6633114">reflect</span><span class="op" id="6633121">.</span><span class="ident" id="6633122">DeepEqual</span><span class="op" id="6633131">(</span><span class="ident" id="6633132">addr</span><span class="op" id="6633136">,</span>&nbsp;<span class="ident" id="6633138">tt</span><span class="op" id="6633140">.</span><span class="ident" id="6633141">addr</span><span class="op" id="6633145">)</span>&nbsp;<span class="op" id="6633147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633152">t</span><span class="op" id="6633153">.</span><span class="ident" id="6633154">Fatalf</span><span class="op" id="6633160">(</span><span class="string" id="6633161">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6633184">,</span>&nbsp;<span class="ident" id="6633186">addr</span><span class="op" id="6633190">,</span>&nbsp;<span class="ident" id="6633192">tt</span><span class="op" id="6633194">.</span><span class="ident" id="6633195">addr</span><span class="op" id="6633199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633206">}</span><br>
<span class="lineno"></span><span class="op" id="6633208">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6633211">var</span>&nbsp;<span class="ident" id="6633215">icmpEchoTests</span>&nbsp;<span class="op" id="6633229">=</span>&nbsp;<span class="op" id="6633231">[</span><span class="op" id="6633232">]</span><span class="keyword" id="6633233">struct</span>&nbsp;<span class="op" id="6633240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633243">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6633249">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633257">laddr</span>&nbsp;<span class="builtintype" id="6633263">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633271">raddr</span>&nbsp;<span class="builtintype" id="6633277">string</span><br>
<span class="lineno">90</span><span class="op" id="6633284">}</span><span class="op" id="6633285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633288">{</span><span class="string" id="6633289">&#34;ip4:icmp&#34;</span><span class="op" id="6633299">,</span>&nbsp;<span class="string" id="6633301">&#34;0.0.0.0&#34;</span><span class="op" id="6633310">,</span>&nbsp;<span class="string" id="6633312">&#34;127.0.0.1&#34;</span><span class="op" id="6633323">}</span><span class="op" id="6633324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633327">{</span><span class="string" id="6633328">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6633343">,</span>&nbsp;<span class="string" id="6633345">&#34;::&#34;</span><span class="op" id="6633349">,</span>&nbsp;<span class="string" id="6633351">&#34;::1&#34;</span><span class="op" id="6633356">}</span><span class="op" id="6633357">,</span><br>
<span class="lineno"></span><span class="op" id="6633359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6633362">func</span>&nbsp;<span class="ident" id="6633367">TestConnICMPEcho</span><span class="op" id="6633383">(</span><span class="ident" id="6633384">t</span>&nbsp;<span class="op" id="6633386">*</span><span class="ident" id="6633387">testing</span><span class="op" id="6633394">.</span><span class="ident" id="6633395">T</span><span class="op" id="6633396">)</span>&nbsp;<span class="op" id="6633398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633401">if</span>&nbsp;<span class="ident" id="6633404">skip</span><span class="op" id="6633408">,</span>&nbsp;<span class="ident" id="6633410">skipmsg</span>&nbsp;<span class="op" id="6633418">:=</span>&nbsp;<span class="ident" id="6633421">skipRawSocketTest</span><span class="op" id="6633438">(</span><span class="ident" id="6633439">t</span><span class="op" id="6633440">)</span><span class="op" id="6633441">;</span>&nbsp;<span class="ident" id="6633443">skip</span>&nbsp;<span class="op" id="6633448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633452">t</span><span class="op" id="6633453">.</span><span class="ident" id="6633454">Skip</span><span class="op" id="6633458">(</span><span class="ident" id="6633459">skipmsg</span><span class="op" id="6633466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633473">for</span>&nbsp;<span class="ident" id="6633477">i</span><span class="op" id="6633478">,</span>&nbsp;<span class="ident" id="6633480">tt</span>&nbsp;<span class="op" id="6633483">:=</span>&nbsp;<span class="keyword" id="6633486">range</span>&nbsp;<span class="ident" id="6633492">icmpEchoTests</span>&nbsp;<span class="op" id="6633506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633510">net</span><span class="op" id="6633513">,</span>&nbsp;<span class="ident" id="6633515">_</span><span class="op" id="6633516">,</span>&nbsp;<span class="ident" id="6633518">err</span>&nbsp;<span class="op" id="6633522">:=</span>&nbsp;<span class="ident" id="6633525">parseNetwork</span><span class="op" id="6633537">(</span><span class="ident" id="6633538">tt</span><span class="op" id="6633540">.</span><span class="ident" id="6633541">net</span><span class="op" id="6633544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633548">if</span>&nbsp;<span class="ident" id="6633551">err</span>&nbsp;<span class="op" id="6633555">!=</span>&nbsp;<span class="ident" id="6633558">nil</span>&nbsp;<span class="op" id="6633562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633567">t</span><span class="op" id="6633568">.</span><span class="ident" id="6633569">Fatalf</span><span class="op" id="6633575">(</span><span class="string" id="6633576">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633601">,</span>&nbsp;<span class="ident" id="6633603">err</span><span class="op" id="6633606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633610">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633614">if</span>&nbsp;<span class="ident" id="6633617">net</span>&nbsp;<span class="op" id="6633621">==</span>&nbsp;<span class="string" id="6633624">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6633630">&amp;&amp;</span>&nbsp;<span class="op" id="6633633">!</span><span class="ident" id="6633634">supportsIPv6</span>&nbsp;<span class="op" id="6633647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633652">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633668">c</span><span class="op" id="6633669">,</span>&nbsp;<span class="ident" id="6633671">err</span>&nbsp;<span class="op" id="6633675">:=</span>&nbsp;<span class="ident" id="6633678">Dial</span><span class="op" id="6633682">(</span><span class="ident" id="6633683">tt</span><span class="op" id="6633685">.</span><span class="ident" id="6633686">net</span><span class="op" id="6633689">,</span>&nbsp;<span class="ident" id="6633691">tt</span><span class="op" id="6633693">.</span><span class="ident" id="6633694">raddr</span><span class="op" id="6633699">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633703">if</span>&nbsp;<span class="ident" id="6633706">err</span>&nbsp;<span class="op" id="6633710">!=</span>&nbsp;<span class="ident" id="6633713">nil</span>&nbsp;<span class="op" id="6633717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633722">t</span><span class="op" id="6633723">.</span><span class="ident" id="6633724">Fatalf</span><span class="op" id="6633730">(</span><span class="string" id="6633731">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633748">,</span>&nbsp;<span class="ident" id="6633750">err</span><span class="op" id="6633753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633761">c</span><span class="op" id="6633762">.</span><span class="ident" id="6633763">SetDeadline</span><span class="op" id="6633774">(</span><span class="ident" id="6633775">time</span><span class="op" id="6633779">.</span><span class="ident" id="6633780">Now</span><span class="op" id="6633783">(</span><span class="op" id="6633784">)</span><span class="op" id="6633785">.</span><span class="ident" id="6633786">Add</span><span class="op" id="6633789">(</span><span class="num" id="6633790">100</span>&nbsp;<span class="op" id="6633794">*</span>&nbsp;<span class="ident" id="6633796">time</span><span class="op" id="6633800">.</span><span class="ident" id="6633801">Millisecond</span><span class="op" id="6633812">)</span><span class="op" id="6633813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633817">defer</span>&nbsp;<span class="ident" id="6633823">c</span><span class="op" id="6633824">.</span><span class="ident" id="6633825">Close</span><span class="op" id="6633830">(</span><span class="op" id="6633831">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633836">typ</span>&nbsp;<span class="op" id="6633840">:=</span>&nbsp;<span class="ident" id="6633843">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6633863">if</span>&nbsp;<span class="ident" id="6633866">net</span>&nbsp;<span class="op" id="6633870">==</span>&nbsp;<span class="string" id="6633873">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6633879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633884">typ</span>&nbsp;<span class="op" id="6633888">=</span>&nbsp;<span class="ident" id="6633890">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6633910">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633914">xid</span><span class="op" id="6633917">,</span>&nbsp;<span class="ident" id="6633919">xseq</span>&nbsp;<span class="op" id="6633924">:=</span>&nbsp;<span class="ident" id="6633927">os</span><span class="op" id="6633929">.</span><span class="ident" id="6633930">Getpid</span><span class="op" id="6633936">(</span><span class="op" id="6633937">)</span><span class="op" id="6633938">&amp;</span><span class="num" id="6633939">0xffff</span><span class="op" id="6633945">,</span>&nbsp;<span class="ident" id="6633947">i</span><span class="op" id="6633948">+</span><span class="num" id="6633949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633953">wb</span><span class="op" id="6633955">,</span>&nbsp;<span class="ident" id="6633957">err</span>&nbsp;<span class="op" id="6633961">:=</span>&nbsp;<span class="op" id="6633964">(</span><span class="op" id="6633965">&amp;</span><span class="ident" id="6633966">icmpMessage</span><span class="op" id="6633977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6633982">Type</span><span class="op" id="6633986">:</span>&nbsp;<span class="ident" id="6633988">typ</span><span class="op" id="6633991">,</span>&nbsp;<span class="ident" id="6633993">Code</span><span class="op" id="6633997">:</span>&nbsp;<span class="num" id="6633999">0</span><span class="op" id="6634000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634005">Body</span><span class="op" id="6634009">:</span>&nbsp;<span class="op" id="6634011">&amp;</span><span class="ident" id="6634012">icmpEcho</span><span class="op" id="6634020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634026">ID</span><span class="op" id="6634028">:</span>&nbsp;<span class="ident" id="6634030">xid</span><span class="op" id="6634033">,</span>&nbsp;<span class="ident" id="6634035">Seq</span><span class="op" id="6634038">:</span>&nbsp;<span class="ident" id="6634040">xseq</span><span class="op" id="6634044">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634050">Data</span><span class="op" id="6634054">:</span>&nbsp;<span class="ident" id="6634056">bytes</span><span class="op" id="6634061">.</span><span class="ident" id="6634062">Repeat</span><span class="op" id="6634068">(</span><span class="op" id="6634069">[</span><span class="op" id="6634070">]</span><span class="builtintype" id="6634071">byte</span><span class="op" id="6634075">(</span><span class="string" id="6634076">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6634098">)</span><span class="op" id="6634099">,</span>&nbsp;<span class="num" id="6634101">3</span><span class="op" id="6634102">)</span><span class="op" id="6634103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634108">}</span><span class="op" id="6634109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634113">}</span><span class="op" id="6634114">)</span><span class="op" id="6634115">.</span><span class="ident" id="6634116">Marshal</span><span class="op" id="6634123">(</span><span class="op" id="6634124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634128">if</span>&nbsp;<span class="ident" id="6634131">err</span>&nbsp;<span class="op" id="6634135">!=</span>&nbsp;<span class="ident" id="6634138">nil</span>&nbsp;<span class="op" id="6634142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634147">t</span><span class="op" id="6634148">.</span><span class="ident" id="6634149">Fatalf</span><span class="op" id="6634155">(</span><span class="string" id="6634156">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6634188">,</span>&nbsp;<span class="ident" id="6634190">err</span><span class="op" id="6634193">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634201">if</span>&nbsp;<span class="ident" id="6634204">_</span><span class="op" id="6634205">,</span>&nbsp;<span class="ident" id="6634207">err</span>&nbsp;<span class="op" id="6634211">:=</span>&nbsp;<span class="ident" id="6634214">c</span><span class="op" id="6634215">.</span><span class="ident" id="6634216">Write</span><span class="op" id="6634221">(</span><span class="ident" id="6634222">wb</span><span class="op" id="6634224">)</span><span class="op" id="6634225">;</span>&nbsp;<span class="ident" id="6634227">err</span>&nbsp;<span class="op" id="6634231">!=</span>&nbsp;<span class="ident" id="6634234">nil</span>&nbsp;<span class="op" id="6634238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634243">t</span><span class="op" id="6634244">.</span><span class="ident" id="6634245">Fatalf</span><span class="op" id="6634251">(</span><span class="string" id="6634252">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6634275">,</span>&nbsp;<span class="ident" id="6634277">err</span><span class="op" id="6634280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634288">var</span>&nbsp;<span class="ident" id="6634292">m</span>&nbsp;<span class="op" id="6634294">*</span><span class="ident" id="6634295">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634309">rb</span>&nbsp;<span class="op" id="6634312">:=</span>&nbsp;<span class="builtinfunc" id="6634315">make</span><span class="op" id="6634319">(</span><span class="op" id="6634320">[</span><span class="op" id="6634321">]</span><span class="builtintype" id="6634322">byte</span><span class="op" id="6634326">,</span>&nbsp;<span class="num" id="6634328">20</span><span class="op" id="6634330">+</span><span class="builtinfunc" id="6634331">len</span><span class="op" id="6634334">(</span><span class="ident" id="6634335">wb</span><span class="op" id="6634337">)</span><span class="op" id="6634338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634342">for</span>&nbsp;<span class="op" id="6634346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634351">if</span>&nbsp;<span class="ident" id="6634354">_</span><span class="op" id="6634355">,</span>&nbsp;<span class="ident" id="6634357">err</span>&nbsp;<span class="op" id="6634361">:=</span>&nbsp;<span class="ident" id="6634364">c</span><span class="op" id="6634365">.</span><span class="ident" id="6634366">Read</span><span class="op" id="6634370">(</span><span class="ident" id="6634371">rb</span><span class="op" id="6634373">)</span><span class="op" id="6634374">;</span>&nbsp;<span class="ident" id="6634376">err</span>&nbsp;<span class="op" id="6634380">!=</span>&nbsp;<span class="ident" id="6634383">nil</span>&nbsp;<span class="op" id="6634387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634393">t</span><span class="op" id="6634394">.</span><span class="ident" id="6634395">Fatalf</span><span class="op" id="6634401">(</span><span class="string" id="6634402">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6634424">,</span>&nbsp;<span class="ident" id="6634426">err</span><span class="op" id="6634429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634434">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634439">if</span>&nbsp;<span class="ident" id="6634442">net</span>&nbsp;<span class="op" id="6634446">==</span>&nbsp;<span class="string" id="6634449">&#34;ip4&#34;</span>&nbsp;<span class="op" id="6634455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634461">rb</span>&nbsp;<span class="op" id="6634464">=</span>&nbsp;<span class="ident" id="6634466">ipv4Payload</span><span class="op" id="6634477">(</span><span class="ident" id="6634478">rb</span><span class="op" id="6634480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634490">if</span>&nbsp;<span class="ident" id="6634493">m</span><span class="op" id="6634494">,</span>&nbsp;<span class="ident" id="6634496">err</span>&nbsp;<span class="op" id="6634500">=</span>&nbsp;<span class="ident" id="6634502">parseICMPMessage</span><span class="op" id="6634518">(</span><span class="ident" id="6634519">rb</span><span class="op" id="6634521">)</span><span class="op" id="6634522">;</span>&nbsp;<span class="ident" id="6634524">err</span>&nbsp;<span class="op" id="6634528">!=</span>&nbsp;<span class="ident" id="6634531">nil</span>&nbsp;<span class="op" id="6634535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634541">t</span><span class="op" id="6634542">.</span><span class="ident" id="6634543">Fatalf</span><span class="op" id="6634549">(</span><span class="string" id="6634550">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6634579">,</span>&nbsp;<span class="ident" id="6634581">err</span><span class="op" id="6634584">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634594">switch</span>&nbsp;<span class="ident" id="6634601">m</span><span class="op" id="6634602">.</span><span class="ident" id="6634603">Type</span>&nbsp;<span class="op" id="6634608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634613">case</span>&nbsp;<span class="ident" id="6634618">icmpv4EchoRequest</span><span class="op" id="6634635">,</span>&nbsp;<span class="ident" id="6634637">icmpv6EchoRequest</span><span class="op" id="6634654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634672">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634689">switch</span>&nbsp;<span class="ident" id="6634696">p</span>&nbsp;<span class="op" id="6634698">:=</span>&nbsp;<span class="ident" id="6634701">m</span><span class="op" id="6634702">.</span><span class="ident" id="6634703">Body</span><span class="op" id="6634707">.</span><span class="op" id="6634708">(</span><span class="keyword" id="6634709">type</span><span class="op" id="6634713">)</span>&nbsp;<span class="op" id="6634715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634719">case</span>&nbsp;<span class="op" id="6634724">*</span><span class="ident" id="6634725">icmpEcho</span><span class="op" id="6634733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634738">if</span>&nbsp;<span class="ident" id="6634741">p</span><span class="op" id="6634742">.</span><span class="ident" id="6634743">ID</span>&nbsp;<span class="op" id="6634746">!=</span>&nbsp;<span class="ident" id="6634749">xid</span>&nbsp;<span class="op" id="6634753">||</span>&nbsp;<span class="ident" id="6634756">p</span><span class="op" id="6634757">.</span><span class="ident" id="6634758">Seq</span>&nbsp;<span class="op" id="6634762">!=</span>&nbsp;<span class="ident" id="6634765">xseq</span>&nbsp;<span class="op" id="6634770">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634776">t</span><span class="op" id="6634777">.</span><span class="ident" id="6634778">Fatalf</span><span class="op" id="6634784">(</span><span class="string" id="6634785">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6634834">,</span>&nbsp;<span class="ident" id="6634836">p</span><span class="op" id="6634837">.</span><span class="ident" id="6634838">ID</span><span class="op" id="6634840">,</span>&nbsp;<span class="ident" id="6634842">p</span><span class="op" id="6634843">.</span><span class="ident" id="6634844">Seq</span><span class="op" id="6634847">,</span>&nbsp;<span class="ident" id="6634849">xid</span><span class="op" id="6634852">,</span>&nbsp;<span class="ident" id="6634854">xseq</span><span class="op" id="6634858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6634867">default</span><span class="op" id="6634874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6634879">t</span><span class="op" id="6634880">.</span><span class="ident" id="6634881">Fatalf</span><span class="op" id="6634887">(</span><span class="string" id="6634888">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6634937">,</span>&nbsp;<span class="ident" id="6634939">m</span><span class="op" id="6634940">.</span><span class="ident" id="6634941">Type</span><span class="op" id="6634945">,</span>&nbsp;<span class="ident" id="6634947">m</span><span class="op" id="6634948">.</span><span class="ident" id="6634949">Code</span><span class="op" id="6634953">,</span>&nbsp;<span class="ident" id="6634955">typ</span><span class="op" id="6634958">,</span>&nbsp;<span class="num" id="6634960">0</span><span class="op" id="6634961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634965">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6634968">}</span><br>
<span class="lineno"></span><span class="op" id="6634970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6634973">func</span>&nbsp;<span class="ident" id="6634978">TestPacketConnICMPEcho</span><span class="op" id="6635000">(</span><span class="ident" id="6635001">t</span>&nbsp;<span class="op" id="6635003">*</span><span class="ident" id="6635004">testing</span><span class="op" id="6635011">.</span><span class="ident" id="6635012">T</span><span class="op" id="6635013">)</span>&nbsp;<span class="op" id="6635015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635018">if</span>&nbsp;<span class="ident" id="6635021">skip</span><span class="op" id="6635025">,</span>&nbsp;<span class="ident" id="6635027">skipmsg</span>&nbsp;<span class="op" id="6635035">:=</span>&nbsp;<span class="ident" id="6635038">skipRawSocketTest</span><span class="op" id="6635055">(</span><span class="ident" id="6635056">t</span><span class="op" id="6635057">)</span><span class="op" id="6635058">;</span>&nbsp;<span class="ident" id="6635060">skip</span>&nbsp;<span class="op" id="6635065">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635069">t</span><span class="op" id="6635070">.</span><span class="ident" id="6635071">Skip</span><span class="op" id="6635075">(</span><span class="ident" id="6635076">skipmsg</span><span class="op" id="6635083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635090">for</span>&nbsp;<span class="ident" id="6635094">i</span><span class="op" id="6635095">,</span>&nbsp;<span class="ident" id="6635097">tt</span>&nbsp;<span class="op" id="6635100">:=</span>&nbsp;<span class="keyword" id="6635103">range</span>&nbsp;<span class="ident" id="6635109">icmpEchoTests</span>&nbsp;<span class="op" id="6635123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635127">net</span><span class="op" id="6635130">,</span>&nbsp;<span class="ident" id="6635132">_</span><span class="op" id="6635133">,</span>&nbsp;<span class="ident" id="6635135">err</span>&nbsp;<span class="op" id="6635139">:=</span>&nbsp;<span class="ident" id="6635142">parseNetwork</span><span class="op" id="6635154">(</span><span class="ident" id="6635155">tt</span><span class="op" id="6635157">.</span><span class="ident" id="6635158">net</span><span class="op" id="6635161">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635165">if</span>&nbsp;<span class="ident" id="6635168">err</span>&nbsp;<span class="op" id="6635172">!=</span>&nbsp;<span class="ident" id="6635175">nil</span>&nbsp;<span class="op" id="6635179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635184">t</span><span class="op" id="6635185">.</span><span class="ident" id="6635186">Fatalf</span><span class="op" id="6635192">(</span><span class="string" id="6635193">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6635218">,</span>&nbsp;<span class="ident" id="6635220">err</span><span class="op" id="6635223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635231">if</span>&nbsp;<span class="ident" id="6635234">net</span>&nbsp;<span class="op" id="6635238">==</span>&nbsp;<span class="string" id="6635241">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6635247">&amp;&amp;</span>&nbsp;<span class="op" id="6635250">!</span><span class="ident" id="6635251">supportsIPv6</span>&nbsp;<span class="op" id="6635264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635269">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635285">c</span><span class="op" id="6635286">,</span>&nbsp;<span class="ident" id="6635288">err</span>&nbsp;<span class="op" id="6635292">:=</span>&nbsp;<span class="ident" id="6635295">ListenPacket</span><span class="op" id="6635307">(</span><span class="ident" id="6635308">tt</span><span class="op" id="6635310">.</span><span class="ident" id="6635311">net</span><span class="op" id="6635314">,</span>&nbsp;<span class="ident" id="6635316">tt</span><span class="op" id="6635318">.</span><span class="ident" id="6635319">laddr</span><span class="op" id="6635324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635328">if</span>&nbsp;<span class="ident" id="6635331">err</span>&nbsp;<span class="op" id="6635335">!=</span>&nbsp;<span class="ident" id="6635338">nil</span>&nbsp;<span class="op" id="6635342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635347">t</span><span class="op" id="6635348">.</span><span class="ident" id="6635349">Fatalf</span><span class="op" id="6635355">(</span><span class="string" id="6635356">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6635381">,</span>&nbsp;<span class="ident" id="6635383">err</span><span class="op" id="6635386">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635394">c</span><span class="op" id="6635395">.</span><span class="ident" id="6635396">SetDeadline</span><span class="op" id="6635407">(</span><span class="ident" id="6635408">time</span><span class="op" id="6635412">.</span><span class="ident" id="6635413">Now</span><span class="op" id="6635416">(</span><span class="op" id="6635417">)</span><span class="op" id="6635418">.</span><span class="ident" id="6635419">Add</span><span class="op" id="6635422">(</span><span class="num" id="6635423">100</span>&nbsp;<span class="op" id="6635427">*</span>&nbsp;<span class="ident" id="6635429">time</span><span class="op" id="6635433">.</span><span class="ident" id="6635434">Millisecond</span><span class="op" id="6635445">)</span><span class="op" id="6635446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635450">defer</span>&nbsp;<span class="ident" id="6635456">c</span><span class="op" id="6635457">.</span><span class="ident" id="6635458">Close</span><span class="op" id="6635463">(</span><span class="op" id="6635464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635469">ra</span><span class="op" id="6635471">,</span>&nbsp;<span class="ident" id="6635473">err</span>&nbsp;<span class="op" id="6635477">:=</span>&nbsp;<span class="ident" id="6635480">ResolveIPAddr</span><span class="op" id="6635493">(</span><span class="ident" id="6635494">tt</span><span class="op" id="6635496">.</span><span class="ident" id="6635497">net</span><span class="op" id="6635500">,</span>&nbsp;<span class="ident" id="6635502">tt</span><span class="op" id="6635504">.</span><span class="ident" id="6635505">raddr</span><span class="op" id="6635510">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635514">if</span>&nbsp;<span class="ident" id="6635517">err</span>&nbsp;<span class="op" id="6635521">!=</span>&nbsp;<span class="ident" id="6635524">nil</span>&nbsp;<span class="op" id="6635528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635533">t</span><span class="op" id="6635534">.</span><span class="ident" id="6635535">Fatalf</span><span class="op" id="6635541">(</span><span class="string" id="6635542">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6635568">,</span>&nbsp;<span class="ident" id="6635570">err</span><span class="op" id="6635573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635581">typ</span>&nbsp;<span class="op" id="6635585">:=</span>&nbsp;<span class="ident" id="6635588">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635608">if</span>&nbsp;<span class="ident" id="6635611">net</span>&nbsp;<span class="op" id="6635615">==</span>&nbsp;<span class="string" id="6635618">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6635624">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635629">typ</span>&nbsp;<span class="op" id="6635633">=</span>&nbsp;<span class="ident" id="6635635">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635659">xid</span><span class="op" id="6635662">,</span>&nbsp;<span class="ident" id="6635664">xseq</span>&nbsp;<span class="op" id="6635669">:=</span>&nbsp;<span class="ident" id="6635672">os</span><span class="op" id="6635674">.</span><span class="ident" id="6635675">Getpid</span><span class="op" id="6635681">(</span><span class="op" id="6635682">)</span><span class="op" id="6635683">&amp;</span><span class="num" id="6635684">0xffff</span><span class="op" id="6635690">,</span>&nbsp;<span class="ident" id="6635692">i</span><span class="op" id="6635693">+</span><span class="num" id="6635694">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635698">wb</span><span class="op" id="6635700">,</span>&nbsp;<span class="ident" id="6635702">err</span>&nbsp;<span class="op" id="6635706">:=</span>&nbsp;<span class="op" id="6635709">(</span><span class="op" id="6635710">&amp;</span><span class="ident" id="6635711">icmpMessage</span><span class="op" id="6635722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635727">Type</span><span class="op" id="6635731">:</span>&nbsp;<span class="ident" id="6635733">typ</span><span class="op" id="6635736">,</span>&nbsp;<span class="ident" id="6635738">Code</span><span class="op" id="6635742">:</span>&nbsp;<span class="num" id="6635744">0</span><span class="op" id="6635745">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635750">Body</span><span class="op" id="6635754">:</span>&nbsp;<span class="op" id="6635756">&amp;</span><span class="ident" id="6635757">icmpEcho</span><span class="op" id="6635765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635771">ID</span><span class="op" id="6635773">:</span>&nbsp;<span class="ident" id="6635775">xid</span><span class="op" id="6635778">,</span>&nbsp;<span class="ident" id="6635780">Seq</span><span class="op" id="6635783">:</span>&nbsp;<span class="ident" id="6635785">xseq</span><span class="op" id="6635789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635795">Data</span><span class="op" id="6635799">:</span>&nbsp;<span class="ident" id="6635801">bytes</span><span class="op" id="6635806">.</span><span class="ident" id="6635807">Repeat</span><span class="op" id="6635813">(</span><span class="op" id="6635814">[</span><span class="op" id="6635815">]</span><span class="builtintype" id="6635816">byte</span><span class="op" id="6635820">(</span><span class="string" id="6635821">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6635843">)</span><span class="op" id="6635844">,</span>&nbsp;<span class="num" id="6635846">3</span><span class="op" id="6635847">)</span><span class="op" id="6635848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635853">}</span><span class="op" id="6635854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635858">}</span><span class="op" id="6635859">)</span><span class="op" id="6635860">.</span><span class="ident" id="6635861">Marshal</span><span class="op" id="6635868">(</span><span class="op" id="6635869">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635873">if</span>&nbsp;<span class="ident" id="6635876">err</span>&nbsp;<span class="op" id="6635880">!=</span>&nbsp;<span class="ident" id="6635883">nil</span>&nbsp;<span class="op" id="6635887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635892">t</span><span class="op" id="6635893">.</span><span class="ident" id="6635894">Fatalf</span><span class="op" id="6635900">(</span><span class="string" id="6635901">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6635933">,</span>&nbsp;<span class="ident" id="6635935">err</span><span class="op" id="6635938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6635942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6635946">if</span>&nbsp;<span class="ident" id="6635949">_</span><span class="op" id="6635950">,</span>&nbsp;<span class="ident" id="6635952">err</span>&nbsp;<span class="op" id="6635956">:=</span>&nbsp;<span class="ident" id="6635959">c</span><span class="op" id="6635960">.</span><span class="ident" id="6635961">WriteTo</span><span class="op" id="6635968">(</span><span class="ident" id="6635969">wb</span><span class="op" id="6635971">,</span>&nbsp;<span class="ident" id="6635973">ra</span><span class="op" id="6635975">)</span><span class="op" id="6635976">;</span>&nbsp;<span class="ident" id="6635978">err</span>&nbsp;<span class="op" id="6635982">!=</span>&nbsp;<span class="ident" id="6635985">nil</span>&nbsp;<span class="op" id="6635989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6635994">t</span><span class="op" id="6635995">.</span><span class="ident" id="6635996">Fatalf</span><span class="op" id="6636002">(</span><span class="string" id="6636003">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6636034">,</span>&nbsp;<span class="ident" id="6636036">err</span><span class="op" id="6636039">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636047">var</span>&nbsp;<span class="ident" id="6636051">m</span>&nbsp;<span class="op" id="6636053">*</span><span class="ident" id="6636054">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636068">rb</span>&nbsp;<span class="op" id="6636071">:=</span>&nbsp;<span class="builtinfunc" id="6636074">make</span><span class="op" id="6636078">(</span><span class="op" id="6636079">[</span><span class="op" id="6636080">]</span><span class="builtintype" id="6636081">byte</span><span class="op" id="6636085">,</span>&nbsp;<span class="num" id="6636087">20</span><span class="op" id="6636089">+</span><span class="builtinfunc" id="6636090">len</span><span class="op" id="6636093">(</span><span class="ident" id="6636094">wb</span><span class="op" id="6636096">)</span><span class="op" id="6636097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636101">for</span>&nbsp;<span class="op" id="6636105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636110">if</span>&nbsp;<span class="ident" id="6636113">_</span><span class="op" id="6636114">,</span>&nbsp;<span class="ident" id="6636116">_</span><span class="op" id="6636117">,</span>&nbsp;<span class="ident" id="6636119">err</span>&nbsp;<span class="op" id="6636123">:=</span>&nbsp;<span class="ident" id="6636126">c</span><span class="op" id="6636127">.</span><span class="ident" id="6636128">ReadFrom</span><span class="op" id="6636136">(</span><span class="ident" id="6636137">rb</span><span class="op" id="6636139">)</span><span class="op" id="6636140">;</span>&nbsp;<span class="ident" id="6636142">err</span>&nbsp;<span class="op" id="6636146">!=</span>&nbsp;<span class="ident" id="6636149">nil</span>&nbsp;<span class="op" id="6636153">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636159">t</span><span class="op" id="6636160">.</span><span class="ident" id="6636161">Fatalf</span><span class="op" id="6636167">(</span><span class="string" id="6636168">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6636200">,</span>&nbsp;<span class="ident" id="6636202">err</span><span class="op" id="6636205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6636215">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6636238">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6636261">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6636288">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636295">if</span>&nbsp;<span class="ident" id="6636298">m</span><span class="op" id="6636299">,</span>&nbsp;<span class="ident" id="6636301">err</span>&nbsp;<span class="op" id="6636305">=</span>&nbsp;<span class="ident" id="6636307">parseICMPMessage</span><span class="op" id="6636323">(</span><span class="ident" id="6636324">rb</span><span class="op" id="6636326">)</span><span class="op" id="6636327">;</span>&nbsp;<span class="ident" id="6636329">err</span>&nbsp;<span class="op" id="6636333">!=</span>&nbsp;<span class="ident" id="6636336">nil</span>&nbsp;<span class="op" id="6636340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636346">t</span><span class="op" id="6636347">.</span><span class="ident" id="6636348">Fatalf</span><span class="op" id="6636354">(</span><span class="string" id="6636355">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6636384">,</span>&nbsp;<span class="ident" id="6636386">err</span><span class="op" id="6636389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636399">switch</span>&nbsp;<span class="ident" id="6636406">m</span><span class="op" id="6636407">.</span><span class="ident" id="6636408">Type</span>&nbsp;<span class="op" id="6636413">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636418">case</span>&nbsp;<span class="ident" id="6636423">icmpv4EchoRequest</span><span class="op" id="6636440">,</span>&nbsp;<span class="ident" id="6636442">icmpv6EchoRequest</span><span class="op" id="6636459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636465">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636490">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636494">switch</span>&nbsp;<span class="ident" id="6636501">p</span>&nbsp;<span class="op" id="6636503">:=</span>&nbsp;<span class="ident" id="6636506">m</span><span class="op" id="6636507">.</span><span class="ident" id="6636508">Body</span><span class="op" id="6636512">.</span><span class="op" id="6636513">(</span><span class="keyword" id="6636514">type</span><span class="op" id="6636518">)</span>&nbsp;<span class="op" id="6636520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636524">case</span>&nbsp;<span class="op" id="6636529">*</span><span class="ident" id="6636530">icmpEcho</span><span class="op" id="6636538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636543">if</span>&nbsp;<span class="ident" id="6636546">p</span><span class="op" id="6636547">.</span><span class="ident" id="6636548">ID</span>&nbsp;<span class="op" id="6636551">!=</span>&nbsp;<span class="ident" id="6636554">xid</span>&nbsp;<span class="op" id="6636558">||</span>&nbsp;<span class="ident" id="6636561">p</span><span class="op" id="6636562">.</span><span class="ident" id="6636563">Seq</span>&nbsp;<span class="op" id="6636567">!=</span>&nbsp;<span class="ident" id="6636570">xseq</span>&nbsp;<span class="op" id="6636575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636581">t</span><span class="op" id="6636582">.</span><span class="ident" id="6636583">Fatalf</span><span class="op" id="6636589">(</span><span class="string" id="6636590">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6636639">,</span>&nbsp;<span class="ident" id="6636641">p</span><span class="op" id="6636642">.</span><span class="ident" id="6636643">ID</span><span class="op" id="6636645">,</span>&nbsp;<span class="ident" id="6636647">p</span><span class="op" id="6636648">.</span><span class="ident" id="6636649">Seq</span><span class="op" id="6636652">,</span>&nbsp;<span class="ident" id="6636654">xid</span><span class="op" id="6636657">,</span>&nbsp;<span class="ident" id="6636659">xseq</span><span class="op" id="6636663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636668">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636672">default</span><span class="op" id="6636679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636684">t</span><span class="op" id="6636685">.</span><span class="ident" id="6636686">Fatalf</span><span class="op" id="6636692">(</span><span class="string" id="6636693">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6636742">,</span>&nbsp;<span class="ident" id="6636744">m</span><span class="op" id="6636745">.</span><span class="ident" id="6636746">Type</span><span class="op" id="6636750">,</span>&nbsp;<span class="ident" id="6636752">m</span><span class="op" id="6636753">.</span><span class="ident" id="6636754">Code</span><span class="op" id="6636758">,</span>&nbsp;<span class="ident" id="6636760">typ</span><span class="op" id="6636763">,</span>&nbsp;<span class="num" id="6636765">0</span><span class="op" id="6636766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636773">}</span><br>
<span class="lineno"></span><span class="op" id="6636775">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="6636778">func</span>&nbsp;<span class="ident" id="6636783">ipv4Payload</span><span class="op" id="6636794">(</span><span class="ident" id="6636795">b</span>&nbsp;<span class="op" id="6636797">[</span><span class="op" id="6636798">]</span><span class="builtintype" id="6636799">byte</span><span class="op" id="6636803">)</span>&nbsp;<span class="op" id="6636805">[</span><span class="op" id="6636806">]</span><span class="builtintype" id="6636807">byte</span>&nbsp;<span class="op" id="6636812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636815">if</span>&nbsp;<span class="builtinfunc" id="6636818">len</span><span class="op" id="6636821">(</span><span class="ident" id="6636822">b</span><span class="op" id="6636823">)</span>&nbsp;<span class="op" id="6636825">&lt;</span>&nbsp;<span class="num" id="6636827">20</span>&nbsp;<span class="op" id="6636830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636834">return</span>&nbsp;<span class="ident" id="6636841">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636844">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636847">hdrlen</span>&nbsp;<span class="op" id="6636854">:=</span>&nbsp;<span class="builtintype" id="6636857">int</span><span class="op" id="6636860">(</span><span class="ident" id="6636861">b</span><span class="op" id="6636862">[</span><span class="num" id="6636863">0</span><span class="op" id="6636864">]</span><span class="op" id="6636865">&amp;</span><span class="num" id="6636866">0x0f</span><span class="op" id="6636870">)</span>&nbsp;<span class="op" id="6636872">&lt;&lt;</span>&nbsp;<span class="num" id="6636875">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6636878">return</span>&nbsp;<span class="ident" id="6636885">b</span><span class="op" id="6636886">[</span><span class="ident" id="6636887">hdrlen</span><span class="op" id="6636893">:</span><span class="op" id="6636894">]</span><br>
<span class="lineno"></span><span class="op" id="6636896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6636899">var</span>&nbsp;<span class="ident" id="6636903">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6636924">=</span>&nbsp;<span class="op" id="6636926">[</span><span class="op" id="6636927">]</span><span class="keyword" id="6636928">struct</span>&nbsp;<span class="op" id="6636935">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636938">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6636944">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6636952">laddr</span>&nbsp;<span class="op" id="6636958">*</span><span class="ident" id="6636959">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="6636966">}</span><span class="op" id="6636967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6636970">{</span><span class="string" id="6636971">&#34;ip4:icmp&#34;</span><span class="op" id="6636981">,</span>&nbsp;<span class="op" id="6636983">&amp;</span><span class="ident" id="6636984">IPAddr</span><span class="op" id="6636990">{</span><span class="ident" id="6636991">IP</span><span class="op" id="6636993">:</span>&nbsp;<span class="ident" id="6636995">IPv4</span><span class="op" id="6636999">(</span><span class="num" id="6637000">127</span><span class="op" id="6637003">,</span>&nbsp;<span class="num" id="6637005">0</span><span class="op" id="6637006">,</span>&nbsp;<span class="num" id="6637008">0</span><span class="op" id="6637009">,</span>&nbsp;<span class="num" id="6637011">1</span><span class="op" id="6637012">)</span><span class="op" id="6637013">}</span><span class="op" id="6637014">}</span><span class="op" id="6637015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637018">{</span><span class="string" id="6637019">&#34;ip4:icmp&#34;</span><span class="op" id="6637029">,</span>&nbsp;<span class="op" id="6637031">&amp;</span><span class="ident" id="6637032">IPAddr</span><span class="op" id="6637038">{</span><span class="op" id="6637039">}</span><span class="op" id="6637040">}</span><span class="op" id="6637041">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637044">{</span><span class="string" id="6637045">&#34;ip4:icmp&#34;</span><span class="op" id="6637055">,</span>&nbsp;<span class="ident" id="6637057">nil</span><span class="op" id="6637060">}</span><span class="op" id="6637061">,</span><br>
<span class="lineno"></span><span class="op" id="6637063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6637066">func</span>&nbsp;<span class="ident" id="6637071">TestIPConnLocalName</span><span class="op" id="6637090">(</span><span class="ident" id="6637091">t</span>&nbsp;<span class="op" id="6637093">*</span><span class="ident" id="6637094">testing</span><span class="op" id="6637101">.</span><span class="ident" id="6637102">T</span><span class="op" id="6637103">)</span>&nbsp;<span class="op" id="6637105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637108">switch</span>&nbsp;<span class="ident" id="6637115">runtime</span><span class="op" id="6637122">.</span><span class="ident" id="6637123">GOOS</span>&nbsp;<span class="op" id="6637128">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637131">case</span>&nbsp;<span class="string" id="6637136">&#34;nacl&#34;</span><span class="op" id="6637142">,</span>&nbsp;<span class="string" id="6637144">&#34;plan9&#34;</span><span class="op" id="6637151">,</span>&nbsp;<span class="string" id="6637153">&#34;windows&#34;</span><span class="op" id="6637162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637166">t</span><span class="op" id="6637167">.</span><span class="ident" id="6637168">Skipf</span><span class="op" id="6637173">(</span><span class="string" id="6637174">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6637195">,</span>&nbsp;<span class="ident" id="6637197">runtime</span><span class="op" id="6637204">.</span><span class="ident" id="6637205">GOOS</span><span class="op" id="6637209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637212">default</span><span class="op" id="6637219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637223">if</span>&nbsp;<span class="ident" id="6637226">os</span><span class="op" id="6637228">.</span><span class="ident" id="6637229">Getuid</span><span class="op" id="6637235">(</span><span class="op" id="6637236">)</span>&nbsp;<span class="op" id="6637238">!=</span>&nbsp;<span class="num" id="6637241">0</span>&nbsp;<span class="op" id="6637243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637248">t</span><span class="op" id="6637249">.</span><span class="ident" id="6637250">Skip</span><span class="op" id="6637254">(</span><span class="string" id="6637255">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6637284">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637295">for</span>&nbsp;<span class="ident" id="6637299">_</span><span class="op" id="6637300">,</span>&nbsp;<span class="ident" id="6637302">tt</span>&nbsp;<span class="op" id="6637305">:=</span>&nbsp;<span class="keyword" id="6637308">range</span>&nbsp;<span class="ident" id="6637314">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6637335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637339">c</span><span class="op" id="6637340">,</span>&nbsp;<span class="ident" id="6637342">err</span>&nbsp;<span class="op" id="6637346">:=</span>&nbsp;<span class="ident" id="6637349">ListenIP</span><span class="op" id="6637357">(</span><span class="ident" id="6637358">tt</span><span class="op" id="6637360">.</span><span class="ident" id="6637361">net</span><span class="op" id="6637364">,</span>&nbsp;<span class="ident" id="6637366">tt</span><span class="op" id="6637368">.</span><span class="ident" id="6637369">laddr</span><span class="op" id="6637374">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637378">if</span>&nbsp;<span class="ident" id="6637381">err</span>&nbsp;<span class="op" id="6637385">!=</span>&nbsp;<span class="ident" id="6637388">nil</span>&nbsp;<span class="op" id="6637392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637397">t</span><span class="op" id="6637398">.</span><span class="ident" id="6637399">Fatalf</span><span class="op" id="6637405">(</span><span class="string" id="6637406">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6637427">,</span>&nbsp;<span class="ident" id="6637429">err</span><span class="op" id="6637432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637440">defer</span>&nbsp;<span class="ident" id="6637446">c</span><span class="op" id="6637447">.</span><span class="ident" id="6637448">Close</span><span class="op" id="6637453">(</span><span class="op" id="6637454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637458">if</span>&nbsp;<span class="ident" id="6637461">la</span>&nbsp;<span class="op" id="6637464">:=</span>&nbsp;<span class="ident" id="6637467">c</span><span class="op" id="6637468">.</span><span class="ident" id="6637469">LocalAddr</span><span class="op" id="6637478">(</span><span class="op" id="6637479">)</span><span class="op" id="6637480">;</span>&nbsp;<span class="ident" id="6637482">la</span>&nbsp;<span class="op" id="6637485">==</span>&nbsp;<span class="ident" id="6637488">nil</span>&nbsp;<span class="op" id="6637492">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637497">t</span><span class="op" id="6637498">.</span><span class="ident" id="6637499">Fatal</span><span class="op" id="6637504">(</span><span class="string" id="6637505">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="6637530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637537">}</span><br>
<span class="lineno"></span><span class="op" id="6637539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6637542">func</span>&nbsp;<span class="ident" id="6637547">TestIPConnRemoteName</span><span class="op" id="6637567">(</span><span class="ident" id="6637568">t</span>&nbsp;<span class="op" id="6637570">*</span><span class="ident" id="6637571">testing</span><span class="op" id="6637578">.</span><span class="ident" id="6637579">T</span><span class="op" id="6637580">)</span>&nbsp;<span class="op" id="6637582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637585">switch</span>&nbsp;<span class="ident" id="6637592">runtime</span><span class="op" id="6637599">.</span><span class="ident" id="6637600">GOOS</span>&nbsp;<span class="op" id="6637605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637608">case</span>&nbsp;<span class="string" id="6637613">&#34;plan9&#34;</span><span class="op" id="6637620">,</span>&nbsp;<span class="string" id="6637622">&#34;windows&#34;</span><span class="op" id="6637631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637635">t</span><span class="op" id="6637636">.</span><span class="ident" id="6637637">Skipf</span><span class="op" id="6637642">(</span><span class="string" id="6637643">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6637664">,</span>&nbsp;<span class="ident" id="6637666">runtime</span><span class="op" id="6637673">.</span><span class="ident" id="6637674">GOOS</span><span class="op" id="6637678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637681">default</span><span class="op" id="6637688">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637692">if</span>&nbsp;<span class="ident" id="6637695">os</span><span class="op" id="6637697">.</span><span class="ident" id="6637698">Getuid</span><span class="op" id="6637704">(</span><span class="op" id="6637705">)</span>&nbsp;<span class="op" id="6637707">!=</span>&nbsp;<span class="num" id="6637710">0</span>&nbsp;<span class="op" id="6637712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637717">t</span><span class="op" id="6637718">.</span><span class="ident" id="6637719">Skip</span><span class="op" id="6637723">(</span><span class="string" id="6637724">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6637753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637764">raddr</span>&nbsp;<span class="op" id="6637770">:=</span>&nbsp;<span class="op" id="6637773">&amp;</span><span class="ident" id="6637774">IPAddr</span><span class="op" id="6637780">{</span><span class="ident" id="6637781">IP</span><span class="op" id="6637783">:</span>&nbsp;<span class="ident" id="6637785">IPv4</span><span class="op" id="6637789">(</span><span class="num" id="6637790">127</span><span class="op" id="6637793">,</span>&nbsp;<span class="num" id="6637795">0</span><span class="op" id="6637796">,</span>&nbsp;<span class="num" id="6637798">0</span><span class="op" id="6637799">,</span>&nbsp;<span class="num" id="6637801">1</span><span class="op" id="6637802">)</span><span class="op" id="6637803">.</span><span class="ident" id="6637804">To4</span><span class="op" id="6637807">(</span><span class="op" id="6637808">)</span><span class="op" id="6637809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637812">c</span><span class="op" id="6637813">,</span>&nbsp;<span class="ident" id="6637815">err</span>&nbsp;<span class="op" id="6637819">:=</span>&nbsp;<span class="ident" id="6637822">DialIP</span><span class="op" id="6637828">(</span><span class="string" id="6637829">&#34;ip:tcp&#34;</span><span class="op" id="6637837">,</span>&nbsp;<span class="op" id="6637839">&amp;</span><span class="ident" id="6637840">IPAddr</span><span class="op" id="6637846">{</span><span class="ident" id="6637847">IP</span><span class="op" id="6637849">:</span>&nbsp;<span class="ident" id="6637851">IPv4</span><span class="op" id="6637855">(</span><span class="num" id="6637856">127</span><span class="op" id="6637859">,</span>&nbsp;<span class="num" id="6637861">0</span><span class="op" id="6637862">,</span>&nbsp;<span class="num" id="6637864">0</span><span class="op" id="6637865">,</span>&nbsp;<span class="num" id="6637867">1</span><span class="op" id="6637868">)</span><span class="op" id="6637869">}</span><span class="op" id="6637870">,</span>&nbsp;<span class="ident" id="6637872">raddr</span><span class="op" id="6637877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637880">if</span>&nbsp;<span class="ident" id="6637883">err</span>&nbsp;<span class="op" id="6637887">!=</span>&nbsp;<span class="ident" id="6637890">nil</span>&nbsp;<span class="op" id="6637894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6637898">t</span><span class="op" id="6637899">.</span><span class="ident" id="6637900">Fatalf</span><span class="op" id="6637906">(</span><span class="string" id="6637907">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6637926">,</span>&nbsp;<span class="ident" id="6637928">err</span><span class="op" id="6637931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6637934">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637937">defer</span>&nbsp;<span class="ident" id="6637943">c</span><span class="op" id="6637944">.</span><span class="ident" id="6637945">Close</span><span class="op" id="6637950">(</span><span class="op" id="6637951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6637954">if</span>&nbsp;<span class="op" id="6637957">!</span><span class="ident" id="6637958">reflect</span><span class="op" id="6637965">.</span><span class="ident" id="6637966">DeepEqual</span><span class="op" id="6637975">(</span><span class="ident" id="6637976">raddr</span><span class="op" id="6637981">,</span>&nbsp;<span class="ident" id="6637983">c</span><span class="op" id="6637984">.</span><span class="ident" id="6637985">RemoteAddr</span><span class="op" id="6637995">(</span><span class="op" id="6637996">)</span><span class="op" id="6637997">)</span>&nbsp;<span class="op" id="6637999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638003">t</span><span class="op" id="6638004">.</span><span class="ident" id="6638005">Fatalf</span><span class="op" id="6638011">(</span><span class="string" id="6638012">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6638035">,</span>&nbsp;<span class="ident" id="6638037">c</span><span class="op" id="6638038">.</span><span class="ident" id="6638039">RemoteAddr</span><span class="op" id="6638049">(</span><span class="op" id="6638050">)</span><span class="op" id="6638051">,</span>&nbsp;<span class="ident" id="6638053">raddr</span><span class="op" id="6638058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638061">}</span><br>
<span class="lineno"></span><span class="op" id="6638063">}</span>
</div>
</body>
</html>
