<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5984699">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5984754">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5984808">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5984859">package</span>&nbsp;<span class="ident" id="5984867">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984872">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5984891">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5984914">import</span>&nbsp;<span class="op" id="5984921">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984924">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984933">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984943">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984949">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984962">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984968">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984979">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984990">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5984997">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5985000">var</span>&nbsp;<span class="op" id="5985004">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985007">ErrHeader</span>&nbsp;<span class="op" id="5985017">=</span>&nbsp;<span class="ident" id="5985019">errors</span><span class="op" id="5985025">.</span><span class="ident" id="5985026">New</span><span class="op" id="5985029">(</span><span class="string" id="5985030">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5985063">)</span><br>
<span class="lineno"></span><span class="op" id="5985065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5985068">const</span>&nbsp;<span class="ident" id="5985074">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5985095">=</span>&nbsp;<span class="num" id="5985097">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985100">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5985173">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5985223">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5985306">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5985379">type</span>&nbsp;<span class="ident" id="5985384">Reader</span>&nbsp;<span class="keyword" id="5985391">struct</span>&nbsp;<span class="op" id="5985398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985401">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985409">io</span><span class="op" id="5985411">.</span><span class="ident" id="5985412">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985420">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985428">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985435">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985443">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985459">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985516">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985524">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5985540">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985574">hdrBuff</span>&nbsp;<span class="op" id="5985582">[</span><span class="ident" id="5985583">blockSize</span><span class="op" id="5985592">]</span><span class="builtintype" id="5985593">byte</span>&nbsp;<span class="comment" id="5985598">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5985629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985632">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5985713">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5985767">type</span>&nbsp;<span class="ident" id="5985772">numBytesReader</span>&nbsp;<span class="keyword" id="5985787">interface</span>&nbsp;<span class="op" id="5985797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985800">io</span><span class="op" id="5985802">.</span><span class="ident" id="5985803">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985811">numBytes</span><span class="op" id="5985819">(</span><span class="op" id="5985820">)</span>&nbsp;<span class="ident" id="5985822">int64</span><br>
<span class="lineno"></span><span class="op" id="5985828">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5985831">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5985912">type</span>&nbsp;<span class="ident" id="5985917">regFileReader</span>&nbsp;<span class="keyword" id="5985931">struct</span>&nbsp;<span class="op" id="5985938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985941">r</span>&nbsp;&nbsp;<span class="ident" id="5985944">io</span><span class="op" id="5985946">.</span><span class="ident" id="5985947">Reader</span>&nbsp;<span class="comment" id="5985954">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985976">nb</span>&nbsp;<span class="ident" id="5985979">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985989">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5986038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5986041">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5986132">type</span>&nbsp;<span class="ident" id="5986137">sparseFileReader</span>&nbsp;<span class="keyword" id="5986154">struct</span>&nbsp;<span class="op" id="5986161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986164">rfr</span>&nbsp;<span class="op" id="5986168">*</span><span class="ident" id="5986169">regFileReader</span>&nbsp;<span class="comment" id="5986183">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986222">sp</span>&nbsp;&nbsp;<span class="op" id="5986226">[</span><span class="op" id="5986227">]</span><span class="ident" id="5986228">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5986241">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986273">pos</span>&nbsp;<span class="ident" id="5986277">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986292">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986325">tot</span>&nbsp;<span class="ident" id="5986329">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986344">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5986370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5986373">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5986431">const</span>&nbsp;<span class="op" id="5986437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986440">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5986462">=</span>&nbsp;<span class="string" id="5986464">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986488">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986510">=</span>&nbsp;<span class="string" id="5986512">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986533">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5986555">=</span>&nbsp;<span class="string" id="5986557">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986580">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986602">=</span>&nbsp;<span class="string" id="5986604">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986622">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986644">=</span>&nbsp;<span class="string" id="5986646">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986665">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986687">=</span>&nbsp;<span class="string" id="5986689">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986709">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986731">=</span>&nbsp;<span class="string" id="5986733">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986753">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986775">=</span>&nbsp;<span class="string" id="5986777">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986796">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5986818">=</span>&nbsp;<span class="string" id="5986820">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5986842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5986845">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5986884">const</span>&nbsp;<span class="op" id="5986890">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986893">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986936">=</span>&nbsp;<span class="num" id="5986938">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986943">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986986">=</span>&nbsp;<span class="num" id="5986988">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986993">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987036">=</span>&nbsp;<span class="num" id="5987038">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987041">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5987084">=</span>&nbsp;<span class="num" id="5987086">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987091">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987134">=</span>&nbsp;<span class="num" id="5987136">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987140">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987183">=</span>&nbsp;<span class="num" id="5987185">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987189">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987232">=</span>&nbsp;<span class="num" id="5987234">12</span><br>
<span class="lineno"></span><span class="op" id="5987237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987240">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5987290">func</span>&nbsp;<span class="ident" id="5987295">NewReader</span><span class="op" id="5987304">(</span><span class="ident" id="5987305">r</span>&nbsp;<span class="ident" id="5987307">io</span><span class="op" id="5987309">.</span><span class="ident" id="5987310">Reader</span><span class="op" id="5987316">)</span>&nbsp;<span class="op" id="5987318">*</span><span class="ident" id="5987319">Reader</span>&nbsp;<span class="op" id="5987326">{</span>&nbsp;<span class="keyword" id="5987328">return</span>&nbsp;<span class="op" id="5987335">&amp;</span><span class="ident" id="5987336">Reader</span><span class="op" id="5987342">{</span><span class="ident" id="5987343">r</span><span class="op" id="5987344">:</span>&nbsp;<span class="ident" id="5987346">r</span><span class="op" id="5987347">}</span>&nbsp;<span class="op" id="5987349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987352">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5987407">func</span>&nbsp;<span class="op" id="5987412">(</span><span class="ident" id="5987413">tr</span>&nbsp;<span class="op" id="5987416">*</span><span class="ident" id="5987417">Reader</span><span class="op" id="5987423">)</span>&nbsp;<span class="ident" id="5987425">Next</span><span class="op" id="5987429">(</span><span class="op" id="5987430">)</span>&nbsp;<span class="op" id="5987432">(</span><span class="op" id="5987433">*</span><span class="ident" id="5987434">Header</span><span class="op" id="5987440">,</span>&nbsp;<span class="builtintype" id="5987442">error</span><span class="op" id="5987447">)</span>&nbsp;<span class="op" id="5987449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987452">var</span>&nbsp;<span class="ident" id="5987456">hdr</span>&nbsp;<span class="op" id="5987460">*</span><span class="ident" id="5987461">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987469">if</span>&nbsp;<span class="ident" id="5987472">tr</span><span class="op" id="5987474">.</span><span class="ident" id="5987475">err</span>&nbsp;<span class="op" id="5987479">==</span>&nbsp;<span class="ident" id="5987482">nil</span>&nbsp;<span class="op" id="5987486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987490">tr</span><span class="op" id="5987492">.</span><span class="ident" id="5987493">skipUnread</span><span class="op" id="5987503">(</span><span class="op" id="5987504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987510">if</span>&nbsp;<span class="ident" id="5987513">tr</span><span class="op" id="5987515">.</span><span class="ident" id="5987516">err</span>&nbsp;<span class="op" id="5987520">!=</span>&nbsp;<span class="ident" id="5987523">nil</span>&nbsp;<span class="op" id="5987527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987531">return</span>&nbsp;<span class="ident" id="5987538">hdr</span><span class="op" id="5987541">,</span>&nbsp;<span class="ident" id="5987543">tr</span><span class="op" id="5987545">.</span><span class="ident" id="5987546">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987554">hdr</span>&nbsp;<span class="op" id="5987558">=</span>&nbsp;<span class="ident" id="5987560">tr</span><span class="op" id="5987562">.</span><span class="ident" id="5987563">readHeader</span><span class="op" id="5987573">(</span><span class="op" id="5987574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987577">if</span>&nbsp;<span class="ident" id="5987580">hdr</span>&nbsp;<span class="op" id="5987584">==</span>&nbsp;<span class="ident" id="5987587">nil</span>&nbsp;<span class="op" id="5987591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987595">return</span>&nbsp;<span class="ident" id="5987602">hdr</span><span class="op" id="5987605">,</span>&nbsp;<span class="ident" id="5987607">tr</span><span class="op" id="5987609">.</span><span class="ident" id="5987610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987615">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987618">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987648">switch</span>&nbsp;<span class="ident" id="5987655">hdr</span><span class="op" id="5987658">.</span><span class="ident" id="5987659">Typeflag</span>&nbsp;<span class="op" id="5987668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987671">case</span>&nbsp;<span class="ident" id="5987676">TypeXHeader</span><span class="op" id="5987687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987691">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987717">headers</span><span class="op" id="5987724">,</span>&nbsp;<span class="ident" id="5987726">err</span>&nbsp;<span class="op" id="5987730">:=</span>&nbsp;<span class="ident" id="5987733">parsePAX</span><span class="op" id="5987741">(</span><span class="ident" id="5987742">tr</span><span class="op" id="5987744">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987748">if</span>&nbsp;<span class="ident" id="5987751">err</span>&nbsp;<span class="op" id="5987755">!=</span>&nbsp;<span class="ident" id="5987758">nil</span>&nbsp;<span class="op" id="5987762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987767">return</span>&nbsp;<span class="ident" id="5987774">nil</span><span class="op" id="5987777">,</span>&nbsp;<span class="ident" id="5987779">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987789">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987827">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987865">tr</span><span class="op" id="5987867">.</span><span class="ident" id="5987868">skipUnread</span><span class="op" id="5987878">(</span><span class="op" id="5987879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987883">hdr</span>&nbsp;<span class="op" id="5987887">=</span>&nbsp;<span class="ident" id="5987889">tr</span><span class="op" id="5987891">.</span><span class="ident" id="5987892">readHeader</span><span class="op" id="5987902">(</span><span class="op" id="5987903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987907">mergePAX</span><span class="op" id="5987915">(</span><span class="ident" id="5987916">hdr</span><span class="op" id="5987919">,</span>&nbsp;<span class="ident" id="5987921">headers</span><span class="op" id="5987928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987933">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987973">sp</span><span class="op" id="5987975">,</span>&nbsp;<span class="ident" id="5987977">err</span>&nbsp;<span class="op" id="5987981">:=</span>&nbsp;<span class="ident" id="5987984">tr</span><span class="op" id="5987986">.</span><span class="ident" id="5987987">checkForGNUSparsePAXHeaders</span><span class="op" id="5988014">(</span><span class="ident" id="5988015">hdr</span><span class="op" id="5988018">,</span>&nbsp;<span class="ident" id="5988020">headers</span><span class="op" id="5988027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988031">if</span>&nbsp;<span class="ident" id="5988034">err</span>&nbsp;<span class="op" id="5988038">!=</span>&nbsp;<span class="ident" id="5988041">nil</span>&nbsp;<span class="op" id="5988045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988050">tr</span><span class="op" id="5988052">.</span><span class="ident" id="5988053">err</span>&nbsp;<span class="op" id="5988057">=</span>&nbsp;<span class="ident" id="5988059">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988066">return</span>&nbsp;<span class="ident" id="5988073">nil</span><span class="op" id="5988076">,</span>&nbsp;<span class="ident" id="5988078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988084">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988088">if</span>&nbsp;<span class="ident" id="5988091">sp</span>&nbsp;<span class="op" id="5988094">!=</span>&nbsp;<span class="ident" id="5988097">nil</span>&nbsp;<span class="op" id="5988101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988106">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988158">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988217">tr</span><span class="op" id="5988219">.</span><span class="ident" id="5988220">curr</span>&nbsp;<span class="op" id="5988225">=</span>&nbsp;<span class="op" id="5988227">&amp;</span><span class="ident" id="5988228">sparseFileReader</span><span class="op" id="5988244">{</span><span class="ident" id="5988245">rfr</span><span class="op" id="5988248">:</span>&nbsp;<span class="ident" id="5988250">tr</span><span class="op" id="5988252">.</span><span class="ident" id="5988253">curr</span><span class="op" id="5988257">.</span><span class="op" id="5988258">(</span><span class="op" id="5988259">*</span><span class="ident" id="5988260">regFileReader</span><span class="op" id="5988273">)</span><span class="op" id="5988274">,</span>&nbsp;<span class="ident" id="5988276">sp</span><span class="op" id="5988278">:</span>&nbsp;<span class="ident" id="5988280">sp</span><span class="op" id="5988282">,</span>&nbsp;<span class="ident" id="5988284">tot</span><span class="op" id="5988287">:</span>&nbsp;<span class="ident" id="5988289">hdr</span><span class="op" id="5988292">.</span><span class="ident" id="5988293">Size</span><span class="op" id="5988297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988301">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988305">return</span>&nbsp;<span class="ident" id="5988312">hdr</span><span class="op" id="5988315">,</span>&nbsp;<span class="ident" id="5988317">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988322">case</span>&nbsp;<span class="ident" id="5988327">TypeGNULongName</span><span class="op" id="5988342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988346">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988420">realname</span><span class="op" id="5988428">,</span>&nbsp;<span class="ident" id="5988430">err</span>&nbsp;<span class="op" id="5988434">:=</span>&nbsp;<span class="ident" id="5988437">ioutil</span><span class="op" id="5988443">.</span><span class="ident" id="5988444">ReadAll</span><span class="op" id="5988451">(</span><span class="ident" id="5988452">tr</span><span class="op" id="5988454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988458">if</span>&nbsp;<span class="ident" id="5988461">err</span>&nbsp;<span class="op" id="5988465">!=</span>&nbsp;<span class="ident" id="5988468">nil</span>&nbsp;<span class="op" id="5988472">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988477">return</span>&nbsp;<span class="ident" id="5988484">nil</span><span class="op" id="5988487">,</span>&nbsp;<span class="ident" id="5988489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988499">hdr</span><span class="op" id="5988502">,</span>&nbsp;<span class="ident" id="5988504">err</span>&nbsp;<span class="op" id="5988508">:=</span>&nbsp;<span class="ident" id="5988511">tr</span><span class="op" id="5988513">.</span><span class="ident" id="5988514">Next</span><span class="op" id="5988518">(</span><span class="op" id="5988519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988523">hdr</span><span class="op" id="5988526">.</span><span class="ident" id="5988527">Name</span>&nbsp;<span class="op" id="5988532">=</span>&nbsp;<span class="ident" id="5988534">cString</span><span class="op" id="5988541">(</span><span class="ident" id="5988542">realname</span><span class="op" id="5988550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988554">return</span>&nbsp;<span class="ident" id="5988561">hdr</span><span class="op" id="5988564">,</span>&nbsp;<span class="ident" id="5988566">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988571">case</span>&nbsp;<span class="ident" id="5988576">TypeGNULongLink</span><span class="op" id="5988591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988595">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988632">realname</span><span class="op" id="5988640">,</span>&nbsp;<span class="ident" id="5988642">err</span>&nbsp;<span class="op" id="5988646">:=</span>&nbsp;<span class="ident" id="5988649">ioutil</span><span class="op" id="5988655">.</span><span class="ident" id="5988656">ReadAll</span><span class="op" id="5988663">(</span><span class="ident" id="5988664">tr</span><span class="op" id="5988666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988670">if</span>&nbsp;<span class="ident" id="5988673">err</span>&nbsp;<span class="op" id="5988677">!=</span>&nbsp;<span class="ident" id="5988680">nil</span>&nbsp;<span class="op" id="5988684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988689">return</span>&nbsp;<span class="ident" id="5988696">nil</span><span class="op" id="5988699">,</span>&nbsp;<span class="ident" id="5988701">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988711">hdr</span><span class="op" id="5988714">,</span>&nbsp;<span class="ident" id="5988716">err</span>&nbsp;<span class="op" id="5988720">:=</span>&nbsp;<span class="ident" id="5988723">tr</span><span class="op" id="5988725">.</span><span class="ident" id="5988726">Next</span><span class="op" id="5988730">(</span><span class="op" id="5988731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988735">hdr</span><span class="op" id="5988738">.</span><span class="ident" id="5988739">Linkname</span>&nbsp;<span class="op" id="5988748">=</span>&nbsp;<span class="ident" id="5988750">cString</span><span class="op" id="5988757">(</span><span class="ident" id="5988758">realname</span><span class="op" id="5988766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988770">return</span>&nbsp;<span class="ident" id="5988777">hdr</span><span class="op" id="5988780">,</span>&nbsp;<span class="ident" id="5988782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988787">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988790">return</span>&nbsp;<span class="ident" id="5988797">hdr</span><span class="op" id="5988800">,</span>&nbsp;<span class="ident" id="5988802">tr</span><span class="op" id="5988804">.</span><span class="ident" id="5988805">err</span><br>
<span class="lineno"></span><span class="op" id="5988809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988812">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5988914">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5989024">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5989057">func</span>&nbsp;<span class="op" id="5989062">(</span><span class="ident" id="5989063">tr</span>&nbsp;<span class="op" id="5989066">*</span><span class="ident" id="5989067">Reader</span><span class="op" id="5989073">)</span>&nbsp;<span class="ident" id="5989075">checkForGNUSparsePAXHeaders</span><span class="op" id="5989102">(</span><span class="ident" id="5989103">hdr</span>&nbsp;<span class="op" id="5989107">*</span><span class="ident" id="5989108">Header</span><span class="op" id="5989114">,</span>&nbsp;<span class="ident" id="5989116">headers</span>&nbsp;<span class="keyword" id="5989124">map</span><span class="op" id="5989127">[</span><span class="builtintype" id="5989128">string</span><span class="op" id="5989134">]</span><span class="builtintype" id="5989135">string</span><span class="op" id="5989141">)</span>&nbsp;<span class="op" id="5989143">(</span><span class="op" id="5989144">[</span><span class="op" id="5989145">]</span><span class="ident" id="5989146">sparseEntry</span><span class="op" id="5989157">,</span>&nbsp;<span class="builtintype" id="5989159">error</span><span class="op" id="5989164">)</span>&nbsp;<span class="op" id="5989166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989169">var</span>&nbsp;<span class="ident" id="5989173">sparseFormat</span>&nbsp;<span class="builtintype" id="5989186">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989195">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989234">major</span><span class="op" id="5989239">,</span>&nbsp;<span class="ident" id="5989241">majorOk</span>&nbsp;<span class="op" id="5989249">:=</span>&nbsp;<span class="ident" id="5989252">headers</span><span class="op" id="5989259">[</span><span class="ident" id="5989260">paxGNUSparseMajor</span><span class="op" id="5989277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989280">minor</span><span class="op" id="5989285">,</span>&nbsp;<span class="ident" id="5989287">minorOk</span>&nbsp;<span class="op" id="5989295">:=</span>&nbsp;<span class="ident" id="5989298">headers</span><span class="op" id="5989305">[</span><span class="ident" id="5989306">paxGNUSparseMinor</span><span class="op" id="5989323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989326">sparseName</span><span class="op" id="5989336">,</span>&nbsp;<span class="ident" id="5989338">sparseNameOk</span>&nbsp;<span class="op" id="5989351">:=</span>&nbsp;<span class="ident" id="5989354">headers</span><span class="op" id="5989361">[</span><span class="ident" id="5989362">paxGNUSparseName</span><span class="op" id="5989378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989381">_</span><span class="op" id="5989382">,</span>&nbsp;<span class="ident" id="5989384">sparseMapOk</span>&nbsp;<span class="op" id="5989396">:=</span>&nbsp;<span class="ident" id="5989399">headers</span><span class="op" id="5989406">[</span><span class="ident" id="5989407">paxGNUSparseMap</span><span class="op" id="5989422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989425">sparseSize</span><span class="op" id="5989435">,</span>&nbsp;<span class="ident" id="5989437">sparseSizeOk</span>&nbsp;<span class="op" id="5989450">:=</span>&nbsp;<span class="ident" id="5989453">headers</span><span class="op" id="5989460">[</span><span class="ident" id="5989461">paxGNUSparseSize</span><span class="op" id="5989477">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989480">sparseRealSize</span><span class="op" id="5989494">,</span>&nbsp;<span class="ident" id="5989496">sparseRealSizeOk</span>&nbsp;<span class="op" id="5989513">:=</span>&nbsp;<span class="ident" id="5989516">headers</span><span class="op" id="5989523">[</span><span class="ident" id="5989524">paxGNUSparseRealSize</span><span class="op" id="5989544">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989548">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989629">if</span>&nbsp;<span class="ident" id="5989632">majorOk</span>&nbsp;<span class="op" id="5989640">&amp;&amp;</span>&nbsp;<span class="ident" id="5989643">minorOk</span>&nbsp;<span class="op" id="5989651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989655">sparseFormat</span>&nbsp;<span class="op" id="5989668">=</span>&nbsp;<span class="ident" id="5989670">major</span>&nbsp;<span class="op" id="5989676">+</span>&nbsp;<span class="string" id="5989678">&#34;.&#34;</span>&nbsp;<span class="op" id="5989682">+</span>&nbsp;<span class="ident" id="5989684">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989691">}</span>&nbsp;<span class="keyword" id="5989693">else</span>&nbsp;<span class="keyword" id="5989698">if</span>&nbsp;<span class="ident" id="5989701">sparseNameOk</span>&nbsp;<span class="op" id="5989714">&amp;&amp;</span>&nbsp;<span class="ident" id="5989717">sparseMapOk</span>&nbsp;<span class="op" id="5989729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989733">sparseFormat</span>&nbsp;<span class="op" id="5989746">=</span>&nbsp;<span class="string" id="5989748">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989755">}</span>&nbsp;<span class="keyword" id="5989757">else</span>&nbsp;<span class="keyword" id="5989762">if</span>&nbsp;<span class="ident" id="5989765">sparseSizeOk</span>&nbsp;<span class="op" id="5989778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989782">sparseFormat</span>&nbsp;<span class="op" id="5989795">=</span>&nbsp;<span class="string" id="5989797">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989804">}</span>&nbsp;<span class="keyword" id="5989806">else</span>&nbsp;<span class="op" id="5989811">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989815">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989854">return</span>&nbsp;<span class="ident" id="5989861">nil</span><span class="op" id="5989864">,</span>&nbsp;<span class="ident" id="5989866">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989875">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989911">if</span>&nbsp;<span class="ident" id="5989914">sparseFormat</span>&nbsp;<span class="op" id="5989927">!=</span>&nbsp;<span class="string" id="5989930">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5989936">&amp;&amp;</span>&nbsp;<span class="ident" id="5989939">sparseFormat</span>&nbsp;<span class="op" id="5989952">!=</span>&nbsp;<span class="string" id="5989955">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5989961">&amp;&amp;</span>&nbsp;<span class="ident" id="5989964">sparseFormat</span>&nbsp;<span class="op" id="5989977">!=</span>&nbsp;<span class="string" id="5989980">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5989986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989990">return</span>&nbsp;<span class="ident" id="5989997">nil</span><span class="op" id="5990000">,</span>&nbsp;<span class="ident" id="5990002">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990011">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990054">if</span>&nbsp;<span class="ident" id="5990057">sparseNameOk</span>&nbsp;<span class="op" id="5990070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990074">hdr</span><span class="op" id="5990077">.</span><span class="ident" id="5990078">Name</span>&nbsp;<span class="op" id="5990083">=</span>&nbsp;<span class="ident" id="5990085">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990100">if</span>&nbsp;<span class="ident" id="5990103">sparseSizeOk</span>&nbsp;<span class="op" id="5990116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990120">realSize</span><span class="op" id="5990128">,</span>&nbsp;<span class="ident" id="5990130">err</span>&nbsp;<span class="op" id="5990134">:=</span>&nbsp;<span class="ident" id="5990137">strconv</span><span class="op" id="5990144">.</span><span class="ident" id="5990145">ParseInt</span><span class="op" id="5990153">(</span><span class="ident" id="5990154">sparseSize</span><span class="op" id="5990164">,</span>&nbsp;<span class="num" id="5990166">10</span><span class="op" id="5990168">,</span>&nbsp;<span class="num" id="5990170">0</span><span class="op" id="5990171">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990175">if</span>&nbsp;<span class="ident" id="5990178">err</span>&nbsp;<span class="op" id="5990182">!=</span>&nbsp;<span class="ident" id="5990185">nil</span>&nbsp;<span class="op" id="5990189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990194">return</span>&nbsp;<span class="ident" id="5990201">nil</span><span class="op" id="5990204">,</span>&nbsp;<span class="ident" id="5990206">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990222">hdr</span><span class="op" id="5990225">.</span><span class="ident" id="5990226">Size</span>&nbsp;<span class="op" id="5990231">=</span>&nbsp;<span class="ident" id="5990233">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990243">}</span>&nbsp;<span class="keyword" id="5990245">else</span>&nbsp;<span class="keyword" id="5990250">if</span>&nbsp;<span class="ident" id="5990253">sparseRealSizeOk</span>&nbsp;<span class="op" id="5990270">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990274">realSize</span><span class="op" id="5990282">,</span>&nbsp;<span class="ident" id="5990284">err</span>&nbsp;<span class="op" id="5990288">:=</span>&nbsp;<span class="ident" id="5990291">strconv</span><span class="op" id="5990298">.</span><span class="ident" id="5990299">ParseInt</span><span class="op" id="5990307">(</span><span class="ident" id="5990308">sparseRealSize</span><span class="op" id="5990322">,</span>&nbsp;<span class="num" id="5990324">10</span><span class="op" id="5990326">,</span>&nbsp;<span class="num" id="5990328">0</span><span class="op" id="5990329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990333">if</span>&nbsp;<span class="ident" id="5990336">err</span>&nbsp;<span class="op" id="5990340">!=</span>&nbsp;<span class="ident" id="5990343">nil</span>&nbsp;<span class="op" id="5990347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990352">return</span>&nbsp;<span class="ident" id="5990359">nil</span><span class="op" id="5990362">,</span>&nbsp;<span class="ident" id="5990364">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990380">hdr</span><span class="op" id="5990383">.</span><span class="ident" id="5990384">Size</span>&nbsp;<span class="op" id="5990389">=</span>&nbsp;<span class="ident" id="5990391">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990405">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990481">var</span>&nbsp;<span class="ident" id="5990485">sp</span>&nbsp;<span class="op" id="5990488">[</span><span class="op" id="5990489">]</span><span class="ident" id="5990490">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990503">var</span>&nbsp;<span class="ident" id="5990507">err</span>&nbsp;<span class="builtintype" id="5990511">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990518">switch</span>&nbsp;<span class="ident" id="5990525">sparseFormat</span>&nbsp;<span class="op" id="5990538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990541">case</span>&nbsp;<span class="string" id="5990546">&#34;0.0&#34;</span><span class="op" id="5990551">,</span>&nbsp;<span class="string" id="5990553">&#34;0.1&#34;</span><span class="op" id="5990558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990562">sp</span><span class="op" id="5990564">,</span>&nbsp;<span class="ident" id="5990566">err</span>&nbsp;<span class="op" id="5990570">=</span>&nbsp;<span class="ident" id="5990572">readGNUSparseMap0x1</span><span class="op" id="5990591">(</span><span class="ident" id="5990592">headers</span><span class="op" id="5990599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990602">case</span>&nbsp;<span class="string" id="5990607">&#34;1.0&#34;</span><span class="op" id="5990612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990616">sp</span><span class="op" id="5990618">,</span>&nbsp;<span class="ident" id="5990620">err</span>&nbsp;<span class="op" id="5990624">=</span>&nbsp;<span class="ident" id="5990626">readGNUSparseMap1x0</span><span class="op" id="5990645">(</span><span class="ident" id="5990646">tr</span><span class="op" id="5990648">.</span><span class="ident" id="5990649">curr</span><span class="op" id="5990653">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990659">return</span>&nbsp;<span class="ident" id="5990666">sp</span><span class="op" id="5990668">,</span>&nbsp;<span class="ident" id="5990670">err</span><br>
<span class="lineno"></span><span class="op" id="5990674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5990677">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5990742">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5990798">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5990858">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5990920">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5990953">func</span>&nbsp;<span class="ident" id="5990958">mergePAX</span><span class="op" id="5990966">(</span><span class="ident" id="5990967">hdr</span>&nbsp;<span class="op" id="5990971">*</span><span class="ident" id="5990972">Header</span><span class="op" id="5990978">,</span>&nbsp;<span class="ident" id="5990980">headers</span>&nbsp;<span class="keyword" id="5990988">map</span><span class="op" id="5990991">[</span><span class="builtintype" id="5990992">string</span><span class="op" id="5990998">]</span><span class="builtintype" id="5990999">string</span><span class="op" id="5991005">)</span>&nbsp;<span class="builtintype" id="5991007">error</span>&nbsp;<span class="op" id="5991013">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991016">for</span>&nbsp;<span class="ident" id="5991020">k</span><span class="op" id="5991021">,</span>&nbsp;<span class="ident" id="5991023">v</span>&nbsp;<span class="op" id="5991025">:=</span>&nbsp;<span class="keyword" id="5991028">range</span>&nbsp;<span class="ident" id="5991034">headers</span>&nbsp;<span class="op" id="5991042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991046">switch</span>&nbsp;<span class="ident" id="5991053">k</span>&nbsp;<span class="op" id="5991055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991059">case</span>&nbsp;<span class="ident" id="5991064">paxPath</span><span class="op" id="5991071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991076">hdr</span><span class="op" id="5991079">.</span><span class="ident" id="5991080">Name</span>&nbsp;<span class="op" id="5991085">=</span>&nbsp;<span class="ident" id="5991087">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991091">case</span>&nbsp;<span class="ident" id="5991096">paxLinkpath</span><span class="op" id="5991107">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991112">hdr</span><span class="op" id="5991115">.</span><span class="ident" id="5991116">Linkname</span>&nbsp;<span class="op" id="5991125">=</span>&nbsp;<span class="ident" id="5991127">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991131">case</span>&nbsp;<span class="ident" id="5991136">paxGname</span><span class="op" id="5991144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991149">hdr</span><span class="op" id="5991152">.</span><span class="ident" id="5991153">Gname</span>&nbsp;<span class="op" id="5991159">=</span>&nbsp;<span class="ident" id="5991161">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991165">case</span>&nbsp;<span class="ident" id="5991170">paxUname</span><span class="op" id="5991178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991183">hdr</span><span class="op" id="5991186">.</span><span class="ident" id="5991187">Uname</span>&nbsp;<span class="op" id="5991193">=</span>&nbsp;<span class="ident" id="5991195">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991199">case</span>&nbsp;<span class="ident" id="5991204">paxUid</span><span class="op" id="5991210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991215">uid</span><span class="op" id="5991218">,</span>&nbsp;<span class="ident" id="5991220">err</span>&nbsp;<span class="op" id="5991224">:=</span>&nbsp;<span class="ident" id="5991227">strconv</span><span class="op" id="5991234">.</span><span class="ident" id="5991235">ParseInt</span><span class="op" id="5991243">(</span><span class="ident" id="5991244">v</span><span class="op" id="5991245">,</span>&nbsp;<span class="num" id="5991247">10</span><span class="op" id="5991249">,</span>&nbsp;<span class="num" id="5991251">0</span><span class="op" id="5991252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991257">if</span>&nbsp;<span class="ident" id="5991260">err</span>&nbsp;<span class="op" id="5991264">!=</span>&nbsp;<span class="ident" id="5991267">nil</span>&nbsp;<span class="op" id="5991271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991277">return</span>&nbsp;<span class="ident" id="5991284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991291">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991296">hdr</span><span class="op" id="5991299">.</span><span class="ident" id="5991300">Uid</span>&nbsp;<span class="op" id="5991304">=</span>&nbsp;<span class="builtintype" id="5991306">int</span><span class="op" id="5991309">(</span><span class="ident" id="5991310">uid</span><span class="op" id="5991313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991317">case</span>&nbsp;<span class="ident" id="5991322">paxGid</span><span class="op" id="5991328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991333">gid</span><span class="op" id="5991336">,</span>&nbsp;<span class="ident" id="5991338">err</span>&nbsp;<span class="op" id="5991342">:=</span>&nbsp;<span class="ident" id="5991345">strconv</span><span class="op" id="5991352">.</span><span class="ident" id="5991353">ParseInt</span><span class="op" id="5991361">(</span><span class="ident" id="5991362">v</span><span class="op" id="5991363">,</span>&nbsp;<span class="num" id="5991365">10</span><span class="op" id="5991367">,</span>&nbsp;<span class="num" id="5991369">0</span><span class="op" id="5991370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991375">if</span>&nbsp;<span class="ident" id="5991378">err</span>&nbsp;<span class="op" id="5991382">!=</span>&nbsp;<span class="ident" id="5991385">nil</span>&nbsp;<span class="op" id="5991389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991395">return</span>&nbsp;<span class="ident" id="5991402">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991414">hdr</span><span class="op" id="5991417">.</span><span class="ident" id="5991418">Gid</span>&nbsp;<span class="op" id="5991422">=</span>&nbsp;<span class="builtintype" id="5991424">int</span><span class="op" id="5991427">(</span><span class="ident" id="5991428">gid</span><span class="op" id="5991431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991435">case</span>&nbsp;<span class="ident" id="5991440">paxAtime</span><span class="op" id="5991448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991453">t</span><span class="op" id="5991454">,</span>&nbsp;<span class="ident" id="5991456">err</span>&nbsp;<span class="op" id="5991460">:=</span>&nbsp;<span class="ident" id="5991463">parsePAXTime</span><span class="op" id="5991475">(</span><span class="ident" id="5991476">v</span><span class="op" id="5991477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991482">if</span>&nbsp;<span class="ident" id="5991485">err</span>&nbsp;<span class="op" id="5991489">!=</span>&nbsp;<span class="ident" id="5991492">nil</span>&nbsp;<span class="op" id="5991496">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991502">return</span>&nbsp;<span class="ident" id="5991509">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991521">hdr</span><span class="op" id="5991524">.</span><span class="ident" id="5991525">AccessTime</span>&nbsp;<span class="op" id="5991536">=</span>&nbsp;<span class="ident" id="5991538">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991542">case</span>&nbsp;<span class="ident" id="5991547">paxMtime</span><span class="op" id="5991555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991560">t</span><span class="op" id="5991561">,</span>&nbsp;<span class="ident" id="5991563">err</span>&nbsp;<span class="op" id="5991567">:=</span>&nbsp;<span class="ident" id="5991570">parsePAXTime</span><span class="op" id="5991582">(</span><span class="ident" id="5991583">v</span><span class="op" id="5991584">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991589">if</span>&nbsp;<span class="ident" id="5991592">err</span>&nbsp;<span class="op" id="5991596">!=</span>&nbsp;<span class="ident" id="5991599">nil</span>&nbsp;<span class="op" id="5991603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991609">return</span>&nbsp;<span class="ident" id="5991616">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991628">hdr</span><span class="op" id="5991631">.</span><span class="ident" id="5991632">ModTime</span>&nbsp;<span class="op" id="5991640">=</span>&nbsp;<span class="ident" id="5991642">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991646">case</span>&nbsp;<span class="ident" id="5991651">paxCtime</span><span class="op" id="5991659">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991664">t</span><span class="op" id="5991665">,</span>&nbsp;<span class="ident" id="5991667">err</span>&nbsp;<span class="op" id="5991671">:=</span>&nbsp;<span class="ident" id="5991674">parsePAXTime</span><span class="op" id="5991686">(</span><span class="ident" id="5991687">v</span><span class="op" id="5991688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991693">if</span>&nbsp;<span class="ident" id="5991696">err</span>&nbsp;<span class="op" id="5991700">!=</span>&nbsp;<span class="ident" id="5991703">nil</span>&nbsp;<span class="op" id="5991707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991713">return</span>&nbsp;<span class="ident" id="5991720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991732">hdr</span><span class="op" id="5991735">.</span><span class="ident" id="5991736">ChangeTime</span>&nbsp;<span class="op" id="5991747">=</span>&nbsp;<span class="ident" id="5991749">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991753">case</span>&nbsp;<span class="ident" id="5991758">paxSize</span><span class="op" id="5991765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991770">size</span><span class="op" id="5991774">,</span>&nbsp;<span class="ident" id="5991776">err</span>&nbsp;<span class="op" id="5991780">:=</span>&nbsp;<span class="ident" id="5991783">strconv</span><span class="op" id="5991790">.</span><span class="ident" id="5991791">ParseInt</span><span class="op" id="5991799">(</span><span class="ident" id="5991800">v</span><span class="op" id="5991801">,</span>&nbsp;<span class="num" id="5991803">10</span><span class="op" id="5991805">,</span>&nbsp;<span class="num" id="5991807">0</span><span class="op" id="5991808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991813">if</span>&nbsp;<span class="ident" id="5991816">err</span>&nbsp;<span class="op" id="5991820">!=</span>&nbsp;<span class="ident" id="5991823">nil</span>&nbsp;<span class="op" id="5991827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991833">return</span>&nbsp;<span class="ident" id="5991840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991847">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991852">hdr</span><span class="op" id="5991855">.</span><span class="ident" id="5991856">Size</span>&nbsp;<span class="op" id="5991861">=</span>&nbsp;<span class="ident" id="5991863">int64</span><span class="op" id="5991868">(</span><span class="ident" id="5991869">size</span><span class="op" id="5991873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991877">default</span><span class="op" id="5991884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991889">if</span>&nbsp;<span class="ident" id="5991892">strings</span><span class="op" id="5991899">.</span><span class="ident" id="5991900">HasPrefix</span><span class="op" id="5991909">(</span><span class="ident" id="5991910">k</span><span class="op" id="5991911">,</span>&nbsp;<span class="ident" id="5991913">paxXattr</span><span class="op" id="5991921">)</span>&nbsp;<span class="op" id="5991923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991929">if</span>&nbsp;<span class="ident" id="5991932">hdr</span><span class="op" id="5991935">.</span><span class="ident" id="5991936">Xattrs</span>&nbsp;<span class="op" id="5991943">==</span>&nbsp;<span class="ident" id="5991946">nil</span>&nbsp;<span class="op" id="5991950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991957">hdr</span><span class="op" id="5991960">.</span><span class="ident" id="5991961">Xattrs</span>&nbsp;<span class="op" id="5991968">=</span>&nbsp;<span class="builtinfunc" id="5991970">make</span><span class="op" id="5991974">(</span><span class="keyword" id="5991975">map</span><span class="op" id="5991978">[</span><span class="builtintype" id="5991979">string</span><span class="op" id="5991985">]</span><span class="builtintype" id="5991986">string</span><span class="op" id="5991992">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992004">hdr</span><span class="op" id="5992007">.</span><span class="ident" id="5992008">Xattrs</span><span class="op" id="5992014">[</span><span class="ident" id="5992015">k</span><span class="op" id="5992016">[</span><span class="builtinfunc" id="5992017">len</span><span class="op" id="5992020">(</span><span class="ident" id="5992021">paxXattr</span><span class="op" id="5992029">)</span><span class="op" id="5992030">:</span><span class="op" id="5992031">]</span><span class="op" id="5992032">]</span>&nbsp;<span class="op" id="5992034">=</span>&nbsp;<span class="ident" id="5992036">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992048">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992051">return</span>&nbsp;<span class="ident" id="5992058">nil</span><br>
<span class="lineno"></span><span class="op" id="5992062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992065">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5992130">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5992156">func</span>&nbsp;<span class="ident" id="5992161">parsePAXTime</span><span class="op" id="5992173">(</span><span class="ident" id="5992174">t</span>&nbsp;<span class="builtintype" id="5992176">string</span><span class="op" id="5992182">)</span>&nbsp;<span class="op" id="5992184">(</span><span class="ident" id="5992185">time</span><span class="op" id="5992189">.</span><span class="ident" id="5992190">Time</span><span class="op" id="5992194">,</span>&nbsp;<span class="builtintype" id="5992196">error</span><span class="op" id="5992201">)</span>&nbsp;<span class="op" id="5992203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992206">buf</span>&nbsp;<span class="op" id="5992210">:=</span>&nbsp;<span class="op" id="5992213">[</span><span class="op" id="5992214">]</span><span class="builtintype" id="5992215">byte</span><span class="op" id="5992219">(</span><span class="ident" id="5992220">t</span><span class="op" id="5992221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992224">pos</span>&nbsp;<span class="op" id="5992228">:=</span>&nbsp;<span class="ident" id="5992231">bytes</span><span class="op" id="5992236">.</span><span class="ident" id="5992237">IndexByte</span><span class="op" id="5992246">(</span><span class="ident" id="5992247">buf</span><span class="op" id="5992250">,</span>&nbsp;<span class="string" id="5992252">&#39;.&#39;</span><span class="op" id="5992255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992258">var</span>&nbsp;<span class="ident" id="5992262">seconds</span><span class="op" id="5992269">,</span>&nbsp;<span class="ident" id="5992271">nanoseconds</span>&nbsp;<span class="ident" id="5992283">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992290">var</span>&nbsp;<span class="ident" id="5992294">err</span>&nbsp;<span class="builtintype" id="5992298">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992305">if</span>&nbsp;<span class="ident" id="5992308">pos</span>&nbsp;<span class="op" id="5992312">==</span>&nbsp;<span class="op" id="5992315">-</span><span class="num" id="5992316">1</span>&nbsp;<span class="op" id="5992318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992322">seconds</span><span class="op" id="5992329">,</span>&nbsp;<span class="ident" id="5992331">err</span>&nbsp;<span class="op" id="5992335">=</span>&nbsp;<span class="ident" id="5992337">strconv</span><span class="op" id="5992344">.</span><span class="ident" id="5992345">ParseInt</span><span class="op" id="5992353">(</span><span class="ident" id="5992354">t</span><span class="op" id="5992355">,</span>&nbsp;<span class="num" id="5992357">10</span><span class="op" id="5992359">,</span>&nbsp;<span class="num" id="5992361">0</span><span class="op" id="5992362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992366">if</span>&nbsp;<span class="ident" id="5992369">err</span>&nbsp;<span class="op" id="5992373">!=</span>&nbsp;<span class="ident" id="5992376">nil</span>&nbsp;<span class="op" id="5992380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992385">return</span>&nbsp;<span class="ident" id="5992392">time</span><span class="op" id="5992396">.</span><span class="ident" id="5992397">Time</span><span class="op" id="5992401">{</span><span class="op" id="5992402">}</span><span class="op" id="5992403">,</span>&nbsp;<span class="ident" id="5992405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992411">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992414">}</span>&nbsp;<span class="keyword" id="5992416">else</span>&nbsp;<span class="op" id="5992421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992425">seconds</span><span class="op" id="5992432">,</span>&nbsp;<span class="ident" id="5992434">err</span>&nbsp;<span class="op" id="5992438">=</span>&nbsp;<span class="ident" id="5992440">strconv</span><span class="op" id="5992447">.</span><span class="ident" id="5992448">ParseInt</span><span class="op" id="5992456">(</span><span class="builtintype" id="5992457">string</span><span class="op" id="5992463">(</span><span class="ident" id="5992464">buf</span><span class="op" id="5992467">[</span><span class="op" id="5992468">:</span><span class="ident" id="5992469">pos</span><span class="op" id="5992472">]</span><span class="op" id="5992473">)</span><span class="op" id="5992474">,</span>&nbsp;<span class="num" id="5992476">10</span><span class="op" id="5992478">,</span>&nbsp;<span class="num" id="5992480">0</span><span class="op" id="5992481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992485">if</span>&nbsp;<span class="ident" id="5992488">err</span>&nbsp;<span class="op" id="5992492">!=</span>&nbsp;<span class="ident" id="5992495">nil</span>&nbsp;<span class="op" id="5992499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992504">return</span>&nbsp;<span class="ident" id="5992511">time</span><span class="op" id="5992515">.</span><span class="ident" id="5992516">Time</span><span class="op" id="5992520">{</span><span class="op" id="5992521">}</span><span class="op" id="5992522">,</span>&nbsp;<span class="ident" id="5992524">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992530">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992534">nano_buf</span>&nbsp;<span class="op" id="5992543">:=</span>&nbsp;<span class="builtintype" id="5992546">string</span><span class="op" id="5992552">(</span><span class="ident" id="5992553">buf</span><span class="op" id="5992556">[</span><span class="ident" id="5992557">pos</span><span class="op" id="5992560">+</span><span class="num" id="5992561">1</span><span class="op" id="5992562">:</span><span class="op" id="5992563">]</span><span class="op" id="5992564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992568">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992619">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992679">if</span>&nbsp;<span class="builtinfunc" id="5992682">len</span><span class="op" id="5992685">(</span><span class="ident" id="5992686">nano_buf</span><span class="op" id="5992694">)</span>&nbsp;<span class="op" id="5992696">&lt;</span>&nbsp;<span class="ident" id="5992698">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5992719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992724">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992740">nano_buf</span>&nbsp;<span class="op" id="5992749">+=</span>&nbsp;<span class="ident" id="5992752">strings</span><span class="op" id="5992759">.</span><span class="ident" id="5992760">Repeat</span><span class="op" id="5992766">(</span><span class="string" id="5992767">&#34;0&#34;</span><span class="op" id="5992770">,</span>&nbsp;<span class="ident" id="5992772">maxNanoSecondIntSize</span><span class="op" id="5992792">-</span><span class="builtinfunc" id="5992793">len</span><span class="op" id="5992796">(</span><span class="ident" id="5992797">nano_buf</span><span class="op" id="5992805">)</span><span class="op" id="5992806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992810">}</span>&nbsp;<span class="keyword" id="5992812">else</span>&nbsp;<span class="keyword" id="5992817">if</span>&nbsp;<span class="builtinfunc" id="5992820">len</span><span class="op" id="5992823">(</span><span class="ident" id="5992824">nano_buf</span><span class="op" id="5992832">)</span>&nbsp;<span class="op" id="5992834">&gt;</span>&nbsp;<span class="ident" id="5992836">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5992857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992862">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992883">nano_buf</span>&nbsp;<span class="op" id="5992892">=</span>&nbsp;<span class="ident" id="5992894">nano_buf</span><span class="op" id="5992902">[</span><span class="op" id="5992903">:</span><span class="ident" id="5992904">maxNanoSecondIntSize</span><span class="op" id="5992924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992928">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992932">nanoseconds</span><span class="op" id="5992943">,</span>&nbsp;<span class="ident" id="5992945">err</span>&nbsp;<span class="op" id="5992949">=</span>&nbsp;<span class="ident" id="5992951">strconv</span><span class="op" id="5992958">.</span><span class="ident" id="5992959">ParseInt</span><span class="op" id="5992967">(</span><span class="builtintype" id="5992968">string</span><span class="op" id="5992974">(</span><span class="ident" id="5992975">nano_buf</span><span class="op" id="5992983">)</span><span class="op" id="5992984">,</span>&nbsp;<span class="num" id="5992986">10</span><span class="op" id="5992988">,</span>&nbsp;<span class="num" id="5992990">0</span><span class="op" id="5992991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992995">if</span>&nbsp;<span class="ident" id="5992998">err</span>&nbsp;<span class="op" id="5993002">!=</span>&nbsp;<span class="ident" id="5993005">nil</span>&nbsp;<span class="op" id="5993009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993014">return</span>&nbsp;<span class="ident" id="5993021">time</span><span class="op" id="5993025">.</span><span class="ident" id="5993026">Time</span><span class="op" id="5993030">{</span><span class="op" id="5993031">}</span><span class="op" id="5993032">,</span>&nbsp;<span class="ident" id="5993034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993043">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993046">ts</span>&nbsp;<span class="op" id="5993049">:=</span>&nbsp;<span class="ident" id="5993052">time</span><span class="op" id="5993056">.</span><span class="ident" id="5993057">Unix</span><span class="op" id="5993061">(</span><span class="ident" id="5993062">seconds</span><span class="op" id="5993069">,</span>&nbsp;<span class="ident" id="5993071">nanoseconds</span><span class="op" id="5993082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993085">return</span>&nbsp;<span class="ident" id="5993092">ts</span><span class="op" id="5993094">,</span>&nbsp;<span class="ident" id="5993096">nil</span><br>
<span class="lineno"></span><span class="op" id="5993100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5993103">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5993135">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5993205">func</span>&nbsp;<span class="ident" id="5993210">parsePAX</span><span class="op" id="5993218">(</span><span class="ident" id="5993219">r</span>&nbsp;<span class="ident" id="5993221">io</span><span class="op" id="5993223">.</span><span class="ident" id="5993224">Reader</span><span class="op" id="5993230">)</span>&nbsp;<span class="op" id="5993232">(</span><span class="keyword" id="5993233">map</span><span class="op" id="5993236">[</span><span class="builtintype" id="5993237">string</span><span class="op" id="5993243">]</span><span class="builtintype" id="5993244">string</span><span class="op" id="5993250">,</span>&nbsp;<span class="builtintype" id="5993252">error</span><span class="op" id="5993257">)</span>&nbsp;<span class="op" id="5993259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993262">buf</span><span class="op" id="5993265">,</span>&nbsp;<span class="ident" id="5993267">err</span>&nbsp;<span class="op" id="5993271">:=</span>&nbsp;<span class="ident" id="5993274">ioutil</span><span class="op" id="5993280">.</span><span class="ident" id="5993281">ReadAll</span><span class="op" id="5993288">(</span><span class="ident" id="5993289">r</span><span class="op" id="5993290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993293">if</span>&nbsp;<span class="ident" id="5993296">err</span>&nbsp;<span class="op" id="5993300">!=</span>&nbsp;<span class="ident" id="5993303">nil</span>&nbsp;<span class="op" id="5993307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993311">return</span>&nbsp;<span class="ident" id="5993318">nil</span><span class="op" id="5993321">,</span>&nbsp;<span class="ident" id="5993323">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993332">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993375">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993466">var</span>&nbsp;<span class="ident" id="5993470">sparseMap</span>&nbsp;<span class="ident" id="5993480">bytes</span><span class="op" id="5993485">.</span><span class="ident" id="5993486">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993495">headers</span>&nbsp;<span class="op" id="5993503">:=</span>&nbsp;<span class="builtinfunc" id="5993506">make</span><span class="op" id="5993510">(</span><span class="keyword" id="5993511">map</span><span class="op" id="5993514">[</span><span class="builtintype" id="5993515">string</span><span class="op" id="5993521">]</span><span class="builtintype" id="5993522">string</span><span class="op" id="5993528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993531">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993565">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993610">for</span>&nbsp;<span class="builtinfunc" id="5993614">len</span><span class="op" id="5993617">(</span><span class="ident" id="5993618">buf</span><span class="op" id="5993621">)</span>&nbsp;<span class="op" id="5993623">&gt;</span>&nbsp;<span class="num" id="5993625">0</span>&nbsp;<span class="op" id="5993627">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993631">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993675">var</span>&nbsp;<span class="ident" id="5993679">sp</span>&nbsp;<span class="builtintype" id="5993682">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993688">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993733">sp</span>&nbsp;<span class="op" id="5993736">=</span>&nbsp;<span class="ident" id="5993738">bytes</span><span class="op" id="5993743">.</span><span class="ident" id="5993744">IndexByte</span><span class="op" id="5993753">(</span><span class="ident" id="5993754">buf</span><span class="op" id="5993757">,</span>&nbsp;<span class="string" id="5993759">&#39;&nbsp;&#39;</span><span class="op" id="5993762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993766">if</span>&nbsp;<span class="ident" id="5993769">sp</span>&nbsp;<span class="op" id="5993772">==</span>&nbsp;<span class="op" id="5993775">-</span><span class="num" id="5993776">1</span>&nbsp;<span class="op" id="5993778">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993783">return</span>&nbsp;<span class="ident" id="5993790">nil</span><span class="op" id="5993793">,</span>&nbsp;<span class="ident" id="5993795">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993811">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993860">n</span><span class="op" id="5993861">,</span>&nbsp;<span class="ident" id="5993863">err</span>&nbsp;<span class="op" id="5993867">:=</span>&nbsp;<span class="ident" id="5993870">strconv</span><span class="op" id="5993877">.</span><span class="ident" id="5993878">ParseInt</span><span class="op" id="5993886">(</span><span class="builtintype" id="5993887">string</span><span class="op" id="5993893">(</span><span class="ident" id="5993894">buf</span><span class="op" id="5993897">[</span><span class="op" id="5993898">:</span><span class="ident" id="5993899">sp</span><span class="op" id="5993901">]</span><span class="op" id="5993902">)</span><span class="op" id="5993903">,</span>&nbsp;<span class="num" id="5993905">10</span><span class="op" id="5993907">,</span>&nbsp;<span class="num" id="5993909">0</span><span class="op" id="5993910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993914">if</span>&nbsp;<span class="ident" id="5993917">err</span>&nbsp;<span class="op" id="5993921">!=</span>&nbsp;<span class="ident" id="5993924">nil</span>&nbsp;<span class="op" id="5993928">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993933">return</span>&nbsp;<span class="ident" id="5993940">nil</span><span class="op" id="5993943">,</span>&nbsp;<span class="ident" id="5993945">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5993957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5993961">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994025">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994091">var</span>&nbsp;<span class="ident" id="5994095">record</span>&nbsp;<span class="op" id="5994102">[</span><span class="op" id="5994103">]</span><span class="builtintype" id="5994104">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994111">record</span><span class="op" id="5994117">,</span>&nbsp;<span class="ident" id="5994119">buf</span>&nbsp;<span class="op" id="5994123">=</span>&nbsp;<span class="ident" id="5994125">buf</span><span class="op" id="5994128">[</span><span class="ident" id="5994129">sp</span><span class="op" id="5994131">+</span><span class="num" id="5994132">1</span><span class="op" id="5994133">:</span><span class="ident" id="5994134">n</span><span class="op" id="5994135">-</span><span class="num" id="5994136">1</span><span class="op" id="5994137">]</span><span class="op" id="5994138">,</span>&nbsp;<span class="ident" id="5994140">buf</span><span class="op" id="5994143">[</span><span class="ident" id="5994144">n</span><span class="op" id="5994145">:</span><span class="op" id="5994146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994150">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994214">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994245">eq</span>&nbsp;<span class="op" id="5994248">:=</span>&nbsp;<span class="ident" id="5994251">bytes</span><span class="op" id="5994256">.</span><span class="ident" id="5994257">IndexByte</span><span class="op" id="5994266">(</span><span class="ident" id="5994267">record</span><span class="op" id="5994273">,</span>&nbsp;<span class="string" id="5994275">&#39;=&#39;</span><span class="op" id="5994278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994282">if</span>&nbsp;<span class="ident" id="5994285">eq</span>&nbsp;<span class="op" id="5994288">==</span>&nbsp;<span class="op" id="5994291">-</span><span class="num" id="5994292">1</span>&nbsp;<span class="op" id="5994294">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994299">return</span>&nbsp;<span class="ident" id="5994306">nil</span><span class="op" id="5994309">,</span>&nbsp;<span class="ident" id="5994311">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994327">key</span><span class="op" id="5994330">,</span>&nbsp;<span class="ident" id="5994332">value</span>&nbsp;<span class="op" id="5994338">:=</span>&nbsp;<span class="ident" id="5994341">record</span><span class="op" id="5994347">[</span><span class="op" id="5994348">:</span><span class="ident" id="5994349">eq</span><span class="op" id="5994351">]</span><span class="op" id="5994352">,</span>&nbsp;<span class="ident" id="5994354">record</span><span class="op" id="5994360">[</span><span class="ident" id="5994361">eq</span><span class="op" id="5994363">+</span><span class="num" id="5994364">1</span><span class="op" id="5994365">:</span><span class="op" id="5994366">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994371">keyStr</span>&nbsp;<span class="op" id="5994378">:=</span>&nbsp;<span class="builtintype" id="5994381">string</span><span class="op" id="5994387">(</span><span class="ident" id="5994388">key</span><span class="op" id="5994391">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994395">if</span>&nbsp;<span class="ident" id="5994398">keyStr</span>&nbsp;<span class="op" id="5994405">==</span>&nbsp;<span class="ident" id="5994408">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5994427">||</span>&nbsp;<span class="ident" id="5994430">keyStr</span>&nbsp;<span class="op" id="5994437">==</span>&nbsp;<span class="ident" id="5994440">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5994461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994466">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994560">sparseMap</span><span class="op" id="5994569">.</span><span class="ident" id="5994570">Write</span><span class="op" id="5994575">(</span><span class="ident" id="5994576">value</span><span class="op" id="5994581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994586">sparseMap</span><span class="op" id="5994595">.</span><span class="ident" id="5994596">Write</span><span class="op" id="5994601">(</span><span class="op" id="5994602">[</span><span class="op" id="5994603">]</span><span class="builtintype" id="5994604">byte</span><span class="op" id="5994608">{</span><span class="string" id="5994609">&#39;,&#39;</span><span class="op" id="5994612">}</span><span class="op" id="5994613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994617">}</span>&nbsp;<span class="keyword" id="5994619">else</span>&nbsp;<span class="op" id="5994624">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994629">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994681">headers</span><span class="op" id="5994688">[</span><span class="ident" id="5994689">keyStr</span><span class="op" id="5994695">]</span>&nbsp;<span class="op" id="5994697">=</span>&nbsp;<span class="builtintype" id="5994699">string</span><span class="op" id="5994705">(</span><span class="ident" id="5994706">value</span><span class="op" id="5994711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994721">if</span>&nbsp;<span class="ident" id="5994724">sparseMap</span><span class="op" id="5994733">.</span><span class="ident" id="5994734">Len</span><span class="op" id="5994737">(</span><span class="op" id="5994738">)</span>&nbsp;<span class="op" id="5994740">!=</span>&nbsp;<span class="num" id="5994743">0</span>&nbsp;<span class="op" id="5994745">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994749">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994811">sparseMap</span><span class="op" id="5994820">.</span><span class="ident" id="5994821">Truncate</span><span class="op" id="5994829">(</span><span class="ident" id="5994830">sparseMap</span><span class="op" id="5994839">.</span><span class="ident" id="5994840">Len</span><span class="op" id="5994843">(</span><span class="op" id="5994844">)</span>&nbsp;<span class="op" id="5994846">-</span>&nbsp;<span class="num" id="5994848">1</span><span class="op" id="5994849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994853">headers</span><span class="op" id="5994860">[</span><span class="ident" id="5994861">paxGNUSparseMap</span><span class="op" id="5994876">]</span>&nbsp;<span class="op" id="5994878">=</span>&nbsp;<span class="ident" id="5994880">sparseMap</span><span class="op" id="5994889">.</span><span class="ident" id="5994890">String</span><span class="op" id="5994896">(</span><span class="op" id="5994897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994903">return</span>&nbsp;<span class="ident" id="5994910">headers</span><span class="op" id="5994917">,</span>&nbsp;<span class="ident" id="5994919">nil</span><br>
<span class="lineno">365</span><span class="op" id="5994923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994926">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5994986">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5995062">func</span>&nbsp;<span class="ident" id="5995067">cString</span><span class="op" id="5995074">(</span><span class="ident" id="5995075">b</span>&nbsp;<span class="op" id="5995077">[</span><span class="op" id="5995078">]</span><span class="builtintype" id="5995079">byte</span><span class="op" id="5995083">)</span>&nbsp;<span class="builtintype" id="5995085">string</span>&nbsp;<span class="op" id="5995092">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995095">n</span>&nbsp;<span class="op" id="5995097">:=</span>&nbsp;<span class="num" id="5995100">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995103">for</span>&nbsp;<span class="ident" id="5995107">n</span>&nbsp;<span class="op" id="5995109">&lt;</span>&nbsp;<span class="builtinfunc" id="5995111">len</span><span class="op" id="5995114">(</span><span class="ident" id="5995115">b</span><span class="op" id="5995116">)</span>&nbsp;<span class="op" id="5995118">&amp;&amp;</span>&nbsp;<span class="ident" id="5995121">b</span><span class="op" id="5995122">[</span><span class="ident" id="5995123">n</span><span class="op" id="5995124">]</span>&nbsp;<span class="op" id="5995126">!=</span>&nbsp;<span class="num" id="5995129">0</span>&nbsp;<span class="op" id="5995131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995135">n</span><span class="op" id="5995136">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995143">return</span>&nbsp;<span class="builtintype" id="5995150">string</span><span class="op" id="5995156">(</span><span class="ident" id="5995157">b</span><span class="op" id="5995158">[</span><span class="num" id="5995159">0</span><span class="op" id="5995160">:</span><span class="ident" id="5995161">n</span><span class="op" id="5995162">]</span><span class="op" id="5995163">)</span><br>
<span class="lineno">375</span><span class="op" id="5995165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5995168">func</span>&nbsp;<span class="op" id="5995173">(</span><span class="ident" id="5995174">tr</span>&nbsp;<span class="op" id="5995177">*</span><span class="ident" id="5995178">Reader</span><span class="op" id="5995184">)</span>&nbsp;<span class="ident" id="5995186">octal</span><span class="op" id="5995191">(</span><span class="ident" id="5995192">b</span>&nbsp;<span class="op" id="5995194">[</span><span class="op" id="5995195">]</span><span class="builtintype" id="5995196">byte</span><span class="op" id="5995200">)</span>&nbsp;<span class="ident" id="5995202">int64</span>&nbsp;<span class="op" id="5995208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995211">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995246">if</span>&nbsp;<span class="builtinfunc" id="5995249">len</span><span class="op" id="5995252">(</span><span class="ident" id="5995253">b</span><span class="op" id="5995254">)</span>&nbsp;<span class="op" id="5995256">&gt;</span>&nbsp;<span class="num" id="5995258">0</span>&nbsp;<span class="op" id="5995260">&amp;&amp;</span>&nbsp;<span class="ident" id="5995263">b</span><span class="op" id="5995264">[</span><span class="num" id="5995265">0</span><span class="op" id="5995266">]</span><span class="op" id="5995267">&amp;</span><span class="num" id="5995268">0x80</span>&nbsp;<span class="op" id="5995273">!=</span>&nbsp;<span class="num" id="5995276">0</span>&nbsp;<span class="op" id="5995278">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995282">var</span>&nbsp;<span class="ident" id="5995286">x</span>&nbsp;<span class="ident" id="5995288">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995296">for</span>&nbsp;<span class="ident" id="5995300">i</span><span class="op" id="5995301">,</span>&nbsp;<span class="ident" id="5995303">c</span>&nbsp;<span class="op" id="5995305">:=</span>&nbsp;<span class="keyword" id="5995308">range</span>&nbsp;<span class="ident" id="5995314">b</span>&nbsp;<span class="op" id="5995316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995321">if</span>&nbsp;<span class="ident" id="5995324">i</span>&nbsp;<span class="op" id="5995326">==</span>&nbsp;<span class="num" id="5995329">0</span>&nbsp;<span class="op" id="5995331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995337">c</span>&nbsp;<span class="op" id="5995339">&amp;=</span>&nbsp;<span class="num" id="5995342">0x7f</span>&nbsp;<span class="comment" id="5995347">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995385">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995390">x</span>&nbsp;<span class="op" id="5995392">=</span>&nbsp;<span class="ident" id="5995394">x</span><span class="op" id="5995395">&lt;&lt;</span><span class="num" id="5995397">8</span>&nbsp;<span class="op" id="5995399">|</span>&nbsp;<span class="ident" id="5995401">int64</span><span class="op" id="5995406">(</span><span class="ident" id="5995407">c</span><span class="op" id="5995408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995416">return</span>&nbsp;<span class="ident" id="5995423">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995430">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995486">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995543">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995563">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995620">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995633">b</span>&nbsp;<span class="op" id="5995635">=</span>&nbsp;<span class="ident" id="5995637">bytes</span><span class="op" id="5995642">.</span><span class="ident" id="5995643">Trim</span><span class="op" id="5995647">(</span><span class="ident" id="5995648">b</span><span class="op" id="5995649">,</span>&nbsp;<span class="string" id="5995651">&#34;&nbsp;\x00&#34;</span><span class="op" id="5995658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995662">if</span>&nbsp;<span class="builtinfunc" id="5995665">len</span><span class="op" id="5995668">(</span><span class="ident" id="5995669">b</span><span class="op" id="5995670">)</span>&nbsp;<span class="op" id="5995672">==</span>&nbsp;<span class="num" id="5995675">0</span>&nbsp;<span class="op" id="5995677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995681">return</span>&nbsp;<span class="num" id="5995688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995691">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995694">x</span><span class="op" id="5995695">,</span>&nbsp;<span class="ident" id="5995697">err</span>&nbsp;<span class="op" id="5995701">:=</span>&nbsp;<span class="ident" id="5995704">strconv</span><span class="op" id="5995711">.</span><span class="ident" id="5995712">ParseUint</span><span class="op" id="5995721">(</span><span class="ident" id="5995722">cString</span><span class="op" id="5995729">(</span><span class="ident" id="5995730">b</span><span class="op" id="5995731">)</span><span class="op" id="5995732">,</span>&nbsp;<span class="num" id="5995734">8</span><span class="op" id="5995735">,</span>&nbsp;<span class="num" id="5995737">64</span><span class="op" id="5995739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995742">if</span>&nbsp;<span class="ident" id="5995745">err</span>&nbsp;<span class="op" id="5995749">!=</span>&nbsp;<span class="ident" id="5995752">nil</span>&nbsp;<span class="op" id="5995756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995760">tr</span><span class="op" id="5995762">.</span><span class="ident" id="5995763">err</span>&nbsp;<span class="op" id="5995767">=</span>&nbsp;<span class="ident" id="5995769">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995777">return</span>&nbsp;<span class="ident" id="5995784">int64</span><span class="op" id="5995789">(</span><span class="ident" id="5995790">x</span><span class="op" id="5995791">)</span><br>
<span class="lineno">405</span><span class="op" id="5995793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5995796">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5995895">func</span>&nbsp;<span class="op" id="5995900">(</span><span class="ident" id="5995901">tr</span>&nbsp;<span class="op" id="5995904">*</span><span class="ident" id="5995905">Reader</span><span class="op" id="5995911">)</span>&nbsp;<span class="ident" id="5995913">skipUnread</span><span class="op" id="5995923">(</span><span class="op" id="5995924">)</span>&nbsp;<span class="op" id="5995926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995929">nr</span>&nbsp;<span class="op" id="5995932">:=</span>&nbsp;<span class="ident" id="5995935">tr</span><span class="op" id="5995937">.</span><span class="ident" id="5995938">numBytes</span><span class="op" id="5995946">(</span><span class="op" id="5995947">)</span>&nbsp;<span class="op" id="5995949">+</span>&nbsp;<span class="ident" id="5995951">tr</span><span class="op" id="5995953">.</span><span class="ident" id="5995954">pad</span>&nbsp;<span class="comment" id="5995958">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995986">tr</span><span class="op" id="5995988">.</span><span class="ident" id="5995989">curr</span><span class="op" id="5995993">,</span>&nbsp;<span class="ident" id="5995995">tr</span><span class="op" id="5995997">.</span><span class="ident" id="5995998">pad</span>&nbsp;<span class="op" id="5996002">=</span>&nbsp;<span class="ident" id="5996004">nil</span><span class="op" id="5996007">,</span>&nbsp;<span class="num" id="5996009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996012">if</span>&nbsp;<span class="ident" id="5996015">sr</span><span class="op" id="5996017">,</span>&nbsp;<span class="ident" id="5996019">ok</span>&nbsp;<span class="op" id="5996022">:=</span>&nbsp;<span class="ident" id="5996025">tr</span><span class="op" id="5996027">.</span><span class="ident" id="5996028">r</span><span class="op" id="5996029">.</span><span class="op" id="5996030">(</span><span class="ident" id="5996031">io</span><span class="op" id="5996033">.</span><span class="ident" id="5996034">Seeker</span><span class="op" id="5996040">)</span><span class="op" id="5996041">;</span>&nbsp;<span class="ident" id="5996043">ok</span>&nbsp;<span class="op" id="5996046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996050">if</span>&nbsp;<span class="ident" id="5996053">_</span><span class="op" id="5996054">,</span>&nbsp;<span class="ident" id="5996056">err</span>&nbsp;<span class="op" id="5996060">:=</span>&nbsp;<span class="ident" id="5996063">sr</span><span class="op" id="5996065">.</span><span class="ident" id="5996066">Seek</span><span class="op" id="5996070">(</span><span class="ident" id="5996071">nr</span><span class="op" id="5996073">,</span>&nbsp;<span class="ident" id="5996075">os</span><span class="op" id="5996077">.</span><span class="ident" id="5996078">SEEK_CUR</span><span class="op" id="5996086">)</span><span class="op" id="5996087">;</span>&nbsp;<span class="ident" id="5996089">err</span>&nbsp;<span class="op" id="5996093">==</span>&nbsp;<span class="ident" id="5996096">nil</span>&nbsp;<span class="op" id="5996100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996105">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996114">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996120">_</span><span class="op" id="5996121">,</span>&nbsp;<span class="ident" id="5996123">tr</span><span class="op" id="5996125">.</span><span class="ident" id="5996126">err</span>&nbsp;<span class="op" id="5996130">=</span>&nbsp;<span class="ident" id="5996132">io</span><span class="op" id="5996134">.</span><span class="ident" id="5996135">CopyN</span><span class="op" id="5996140">(</span><span class="ident" id="5996141">ioutil</span><span class="op" id="5996147">.</span><span class="ident" id="5996148">Discard</span><span class="op" id="5996155">,</span>&nbsp;<span class="ident" id="5996157">tr</span><span class="op" id="5996159">.</span><span class="ident" id="5996160">r</span><span class="op" id="5996161">,</span>&nbsp;<span class="ident" id="5996163">nr</span><span class="op" id="5996165">)</span><br>
<span class="lineno"></span><span class="op" id="5996167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5996170">func</span>&nbsp;<span class="op" id="5996175">(</span><span class="ident" id="5996176">tr</span>&nbsp;<span class="op" id="5996179">*</span><span class="ident" id="5996180">Reader</span><span class="op" id="5996186">)</span>&nbsp;<span class="ident" id="5996188">verifyChecksum</span><span class="op" id="5996202">(</span><span class="ident" id="5996203">header</span>&nbsp;<span class="op" id="5996210">[</span><span class="op" id="5996211">]</span><span class="builtintype" id="5996212">byte</span><span class="op" id="5996216">)</span>&nbsp;<span class="builtintype" id="5996218">bool</span>&nbsp;<span class="op" id="5996223">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996226">if</span>&nbsp;<span class="ident" id="5996229">tr</span><span class="op" id="5996231">.</span><span class="ident" id="5996232">err</span>&nbsp;<span class="op" id="5996236">!=</span>&nbsp;<span class="ident" id="5996239">nil</span>&nbsp;<span class="op" id="5996243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996247">return</span>&nbsp;<span class="builtintype" id="5996254">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996265">given</span>&nbsp;<span class="op" id="5996271">:=</span>&nbsp;<span class="ident" id="5996274">tr</span><span class="op" id="5996276">.</span><span class="ident" id="5996277">octal</span><span class="op" id="5996282">(</span><span class="ident" id="5996283">header</span><span class="op" id="5996289">[</span><span class="num" id="5996290">148</span><span class="op" id="5996293">:</span><span class="num" id="5996294">156</span><span class="op" id="5996297">]</span><span class="op" id="5996298">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996301">unsigned</span><span class="op" id="5996309">,</span>&nbsp;<span class="ident" id="5996311">signed</span>&nbsp;<span class="op" id="5996318">:=</span>&nbsp;<span class="ident" id="5996321">checksum</span><span class="op" id="5996329">(</span><span class="ident" id="5996330">header</span><span class="op" id="5996336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996339">return</span>&nbsp;<span class="ident" id="5996346">given</span>&nbsp;<span class="op" id="5996352">==</span>&nbsp;<span class="ident" id="5996355">unsigned</span>&nbsp;<span class="op" id="5996364">||</span>&nbsp;<span class="ident" id="5996367">given</span>&nbsp;<span class="op" id="5996373">==</span>&nbsp;<span class="ident" id="5996376">signed</span><br>
<span class="lineno"></span><span class="op" id="5996383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5996386">func</span>&nbsp;<span class="op" id="5996391">(</span><span class="ident" id="5996392">tr</span>&nbsp;<span class="op" id="5996395">*</span><span class="ident" id="5996396">Reader</span><span class="op" id="5996402">)</span>&nbsp;<span class="ident" id="5996404">readHeader</span><span class="op" id="5996414">(</span><span class="op" id="5996415">)</span>&nbsp;<span class="op" id="5996417">*</span><span class="ident" id="5996418">Header</span>&nbsp;<span class="op" id="5996425">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996428">header</span>&nbsp;<span class="op" id="5996435">:=</span>&nbsp;<span class="ident" id="5996438">tr</span><span class="op" id="5996440">.</span><span class="ident" id="5996441">hdrBuff</span><span class="op" id="5996448">[</span><span class="op" id="5996449">:</span><span class="op" id="5996450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5996453">copy</span><span class="op" id="5996457">(</span><span class="ident" id="5996458">header</span><span class="op" id="5996464">,</span>&nbsp;<span class="ident" id="5996466">zeroBlock</span><span class="op" id="5996475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996479">if</span>&nbsp;<span class="ident" id="5996482">_</span><span class="op" id="5996483">,</span>&nbsp;<span class="ident" id="5996485">tr</span><span class="op" id="5996487">.</span><span class="ident" id="5996488">err</span>&nbsp;<span class="op" id="5996492">=</span>&nbsp;<span class="ident" id="5996494">io</span><span class="op" id="5996496">.</span><span class="ident" id="5996497">ReadFull</span><span class="op" id="5996505">(</span><span class="ident" id="5996506">tr</span><span class="op" id="5996508">.</span><span class="ident" id="5996509">r</span><span class="op" id="5996510">,</span>&nbsp;<span class="ident" id="5996512">header</span><span class="op" id="5996518">)</span><span class="op" id="5996519">;</span>&nbsp;<span class="ident" id="5996521">tr</span><span class="op" id="5996523">.</span><span class="ident" id="5996524">err</span>&nbsp;<span class="op" id="5996528">!=</span>&nbsp;<span class="ident" id="5996531">nil</span>&nbsp;<span class="op" id="5996535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996539">return</span>&nbsp;<span class="ident" id="5996546">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996555">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996614">if</span>&nbsp;<span class="ident" id="5996617">bytes</span><span class="op" id="5996622">.</span><span class="ident" id="5996623">Equal</span><span class="op" id="5996628">(</span><span class="ident" id="5996629">header</span><span class="op" id="5996635">,</span>&nbsp;<span class="ident" id="5996637">zeroBlock</span><span class="op" id="5996646">[</span><span class="num" id="5996647">0</span><span class="op" id="5996648">:</span><span class="ident" id="5996649">blockSize</span><span class="op" id="5996658">]</span><span class="op" id="5996659">)</span>&nbsp;<span class="op" id="5996661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996665">if</span>&nbsp;<span class="ident" id="5996668">_</span><span class="op" id="5996669">,</span>&nbsp;<span class="ident" id="5996671">tr</span><span class="op" id="5996673">.</span><span class="ident" id="5996674">err</span>&nbsp;<span class="op" id="5996678">=</span>&nbsp;<span class="ident" id="5996680">io</span><span class="op" id="5996682">.</span><span class="ident" id="5996683">ReadFull</span><span class="op" id="5996691">(</span><span class="ident" id="5996692">tr</span><span class="op" id="5996694">.</span><span class="ident" id="5996695">r</span><span class="op" id="5996696">,</span>&nbsp;<span class="ident" id="5996698">header</span><span class="op" id="5996704">)</span><span class="op" id="5996705">;</span>&nbsp;<span class="ident" id="5996707">tr</span><span class="op" id="5996709">.</span><span class="ident" id="5996710">err</span>&nbsp;<span class="op" id="5996714">!=</span>&nbsp;<span class="ident" id="5996717">nil</span>&nbsp;<span class="op" id="5996721">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996726">return</span>&nbsp;<span class="ident" id="5996733">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996743">if</span>&nbsp;<span class="ident" id="5996746">bytes</span><span class="op" id="5996751">.</span><span class="ident" id="5996752">Equal</span><span class="op" id="5996757">(</span><span class="ident" id="5996758">header</span><span class="op" id="5996764">,</span>&nbsp;<span class="ident" id="5996766">zeroBlock</span><span class="op" id="5996775">[</span><span class="num" id="5996776">0</span><span class="op" id="5996777">:</span><span class="ident" id="5996778">blockSize</span><span class="op" id="5996787">]</span><span class="op" id="5996788">)</span>&nbsp;<span class="op" id="5996790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996795">tr</span><span class="op" id="5996797">.</span><span class="ident" id="5996798">err</span>&nbsp;<span class="op" id="5996802">=</span>&nbsp;<span class="ident" id="5996804">io</span><span class="op" id="5996806">.</span><span class="ident" id="5996807">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996813">}</span>&nbsp;<span class="keyword" id="5996815">else</span>&nbsp;<span class="op" id="5996820">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996825">tr</span><span class="op" id="5996827">.</span><span class="ident" id="5996828">err</span>&nbsp;<span class="op" id="5996832">=</span>&nbsp;<span class="ident" id="5996834">ErrHeader</span>&nbsp;<span class="comment" id="5996844">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996888">return</span>&nbsp;<span class="ident" id="5996895">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996904">if</span>&nbsp;<span class="op" id="5996907">!</span><span class="ident" id="5996908">tr</span><span class="op" id="5996910">.</span><span class="ident" id="5996911">verifyChecksum</span><span class="op" id="5996925">(</span><span class="ident" id="5996926">header</span><span class="op" id="5996932">)</span>&nbsp;<span class="op" id="5996934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996938">tr</span><span class="op" id="5996940">.</span><span class="ident" id="5996941">err</span>&nbsp;<span class="op" id="5996945">=</span>&nbsp;<span class="ident" id="5996947">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996959">return</span>&nbsp;<span class="ident" id="5996966">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996975">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996986">hdr</span>&nbsp;<span class="op" id="5996990">:=</span>&nbsp;<span class="builtinfunc" id="5996993">new</span><span class="op" id="5996996">(</span><span class="ident" id="5996997">Header</span><span class="op" id="5997003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997006">s</span>&nbsp;<span class="op" id="5997008">:=</span>&nbsp;<span class="ident" id="5997011">slicer</span><span class="op" id="5997017">(</span><span class="ident" id="5997018">header</span><span class="op" id="5997024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997028">hdr</span><span class="op" id="5997031">.</span><span class="ident" id="5997032">Name</span>&nbsp;<span class="op" id="5997037">=</span>&nbsp;<span class="ident" id="5997039">cString</span><span class="op" id="5997046">(</span><span class="ident" id="5997047">s</span><span class="op" id="5997048">.</span><span class="ident" id="5997049">next</span><span class="op" id="5997053">(</span><span class="num" id="5997054">100</span><span class="op" id="5997057">)</span><span class="op" id="5997058">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997061">hdr</span><span class="op" id="5997064">.</span><span class="ident" id="5997065">Mode</span>&nbsp;<span class="op" id="5997070">=</span>&nbsp;<span class="ident" id="5997072">tr</span><span class="op" id="5997074">.</span><span class="ident" id="5997075">octal</span><span class="op" id="5997080">(</span><span class="ident" id="5997081">s</span><span class="op" id="5997082">.</span><span class="ident" id="5997083">next</span><span class="op" id="5997087">(</span><span class="num" id="5997088">8</span><span class="op" id="5997089">)</span><span class="op" id="5997090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997093">hdr</span><span class="op" id="5997096">.</span><span class="ident" id="5997097">Uid</span>&nbsp;<span class="op" id="5997101">=</span>&nbsp;<span class="builtintype" id="5997103">int</span><span class="op" id="5997106">(</span><span class="ident" id="5997107">tr</span><span class="op" id="5997109">.</span><span class="ident" id="5997110">octal</span><span class="op" id="5997115">(</span><span class="ident" id="5997116">s</span><span class="op" id="5997117">.</span><span class="ident" id="5997118">next</span><span class="op" id="5997122">(</span><span class="num" id="5997123">8</span><span class="op" id="5997124">)</span><span class="op" id="5997125">)</span><span class="op" id="5997126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997129">hdr</span><span class="op" id="5997132">.</span><span class="ident" id="5997133">Gid</span>&nbsp;<span class="op" id="5997137">=</span>&nbsp;<span class="builtintype" id="5997139">int</span><span class="op" id="5997142">(</span><span class="ident" id="5997143">tr</span><span class="op" id="5997145">.</span><span class="ident" id="5997146">octal</span><span class="op" id="5997151">(</span><span class="ident" id="5997152">s</span><span class="op" id="5997153">.</span><span class="ident" id="5997154">next</span><span class="op" id="5997158">(</span><span class="num" id="5997159">8</span><span class="op" id="5997160">)</span><span class="op" id="5997161">)</span><span class="op" id="5997162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997165">hdr</span><span class="op" id="5997168">.</span><span class="ident" id="5997169">Size</span>&nbsp;<span class="op" id="5997174">=</span>&nbsp;<span class="ident" id="5997176">tr</span><span class="op" id="5997178">.</span><span class="ident" id="5997179">octal</span><span class="op" id="5997184">(</span><span class="ident" id="5997185">s</span><span class="op" id="5997186">.</span><span class="ident" id="5997187">next</span><span class="op" id="5997191">(</span><span class="num" id="5997192">12</span><span class="op" id="5997194">)</span><span class="op" id="5997195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997198">hdr</span><span class="op" id="5997201">.</span><span class="ident" id="5997202">ModTime</span>&nbsp;<span class="op" id="5997210">=</span>&nbsp;<span class="ident" id="5997212">time</span><span class="op" id="5997216">.</span><span class="ident" id="5997217">Unix</span><span class="op" id="5997221">(</span><span class="ident" id="5997222">tr</span><span class="op" id="5997224">.</span><span class="ident" id="5997225">octal</span><span class="op" id="5997230">(</span><span class="ident" id="5997231">s</span><span class="op" id="5997232">.</span><span class="ident" id="5997233">next</span><span class="op" id="5997237">(</span><span class="num" id="5997238">12</span><span class="op" id="5997240">)</span><span class="op" id="5997241">)</span><span class="op" id="5997242">,</span>&nbsp;<span class="num" id="5997244">0</span><span class="op" id="5997245">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997248">s</span><span class="op" id="5997249">.</span><span class="ident" id="5997250">next</span><span class="op" id="5997254">(</span><span class="num" id="5997255">8</span><span class="op" id="5997256">)</span>&nbsp;<span class="comment" id="5997258">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997269">hdr</span><span class="op" id="5997272">.</span><span class="ident" id="5997273">Typeflag</span>&nbsp;<span class="op" id="5997282">=</span>&nbsp;<span class="ident" id="5997284">s</span><span class="op" id="5997285">.</span><span class="ident" id="5997286">next</span><span class="op" id="5997290">(</span><span class="num" id="5997291">1</span><span class="op" id="5997292">)</span><span class="op" id="5997293">[</span><span class="num" id="5997294">0</span><span class="op" id="5997295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997298">hdr</span><span class="op" id="5997301">.</span><span class="ident" id="5997302">Linkname</span>&nbsp;<span class="op" id="5997311">=</span>&nbsp;<span class="ident" id="5997313">cString</span><span class="op" id="5997320">(</span><span class="ident" id="5997321">s</span><span class="op" id="5997322">.</span><span class="ident" id="5997323">next</span><span class="op" id="5997327">(</span><span class="num" id="5997328">100</span><span class="op" id="5997331">)</span><span class="op" id="5997332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997336">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997399">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997465">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997527">magic</span>&nbsp;<span class="op" id="5997533">:=</span>&nbsp;<span class="builtintype" id="5997536">string</span><span class="op" id="5997542">(</span><span class="ident" id="5997543">s</span><span class="op" id="5997544">.</span><span class="ident" id="5997545">next</span><span class="op" id="5997549">(</span><span class="num" id="5997550">8</span><span class="op" id="5997551">)</span><span class="op" id="5997552">)</span>&nbsp;<span class="comment" id="5997554">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997590">var</span>&nbsp;<span class="ident" id="5997594">format</span>&nbsp;<span class="builtintype" id="5997601">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997609">switch</span>&nbsp;<span class="op" id="5997616">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997619">case</span>&nbsp;<span class="ident" id="5997624">magic</span><span class="op" id="5997629">[</span><span class="op" id="5997630">:</span><span class="num" id="5997631">6</span><span class="op" id="5997632">]</span>&nbsp;<span class="op" id="5997634">==</span>&nbsp;<span class="string" id="5997637">&#34;ustar\x00&#34;</span><span class="op" id="5997648">:</span>&nbsp;<span class="comment" id="5997650">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997679">if</span>&nbsp;<span class="builtintype" id="5997682">string</span><span class="op" id="5997688">(</span><span class="ident" id="5997689">header</span><span class="op" id="5997695">[</span><span class="num" id="5997696">508</span><span class="op" id="5997699">:</span><span class="num" id="5997700">512</span><span class="op" id="5997703">]</span><span class="op" id="5997704">)</span>&nbsp;<span class="op" id="5997706">==</span>&nbsp;<span class="string" id="5997709">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5997719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997724">format</span>&nbsp;<span class="op" id="5997731">=</span>&nbsp;<span class="string" id="5997733">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997742">}</span>&nbsp;<span class="keyword" id="5997744">else</span>&nbsp;<span class="op" id="5997749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997754">format</span>&nbsp;<span class="op" id="5997761">=</span>&nbsp;<span class="string" id="5997763">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997776">case</span>&nbsp;<span class="ident" id="5997781">magic</span>&nbsp;<span class="op" id="5997787">==</span>&nbsp;<span class="string" id="5997790">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5997803">:</span>&nbsp;<span class="comment" id="5997805">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997822">format</span>&nbsp;<span class="op" id="5997829">=</span>&nbsp;<span class="string" id="5997831">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997842">switch</span>&nbsp;<span class="ident" id="5997849">format</span>&nbsp;<span class="op" id="5997856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997859">case</span>&nbsp;<span class="string" id="5997864">&#34;posix&#34;</span><span class="op" id="5997871">,</span>&nbsp;<span class="string" id="5997873">&#34;gnu&#34;</span><span class="op" id="5997878">,</span>&nbsp;<span class="string" id="5997880">&#34;star&#34;</span><span class="op" id="5997886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997890">hdr</span><span class="op" id="5997893">.</span><span class="ident" id="5997894">Uname</span>&nbsp;<span class="op" id="5997900">=</span>&nbsp;<span class="ident" id="5997902">cString</span><span class="op" id="5997909">(</span><span class="ident" id="5997910">s</span><span class="op" id="5997911">.</span><span class="ident" id="5997912">next</span><span class="op" id="5997916">(</span><span class="num" id="5997917">32</span><span class="op" id="5997919">)</span><span class="op" id="5997920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997924">hdr</span><span class="op" id="5997927">.</span><span class="ident" id="5997928">Gname</span>&nbsp;<span class="op" id="5997934">=</span>&nbsp;<span class="ident" id="5997936">cString</span><span class="op" id="5997943">(</span><span class="ident" id="5997944">s</span><span class="op" id="5997945">.</span><span class="ident" id="5997946">next</span><span class="op" id="5997950">(</span><span class="num" id="5997951">32</span><span class="op" id="5997953">)</span><span class="op" id="5997954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997958">devmajor</span>&nbsp;<span class="op" id="5997967">:=</span>&nbsp;<span class="ident" id="5997970">s</span><span class="op" id="5997971">.</span><span class="ident" id="5997972">next</span><span class="op" id="5997976">(</span><span class="num" id="5997977">8</span><span class="op" id="5997978">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997982">devminor</span>&nbsp;<span class="op" id="5997991">:=</span>&nbsp;<span class="ident" id="5997994">s</span><span class="op" id="5997995">.</span><span class="ident" id="5997996">next</span><span class="op" id="5998000">(</span><span class="num" id="5998001">8</span><span class="op" id="5998002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998006">if</span>&nbsp;<span class="ident" id="5998009">hdr</span><span class="op" id="5998012">.</span><span class="ident" id="5998013">Typeflag</span>&nbsp;<span class="op" id="5998022">==</span>&nbsp;<span class="ident" id="5998025">TypeChar</span>&nbsp;<span class="op" id="5998034">||</span>&nbsp;<span class="ident" id="5998037">hdr</span><span class="op" id="5998040">.</span><span class="ident" id="5998041">Typeflag</span>&nbsp;<span class="op" id="5998050">==</span>&nbsp;<span class="ident" id="5998053">TypeBlock</span>&nbsp;<span class="op" id="5998063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998068">hdr</span><span class="op" id="5998071">.</span><span class="ident" id="5998072">Devmajor</span>&nbsp;<span class="op" id="5998081">=</span>&nbsp;<span class="ident" id="5998083">tr</span><span class="op" id="5998085">.</span><span class="ident" id="5998086">octal</span><span class="op" id="5998091">(</span><span class="ident" id="5998092">devmajor</span><span class="op" id="5998100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998105">hdr</span><span class="op" id="5998108">.</span><span class="ident" id="5998109">Devminor</span>&nbsp;<span class="op" id="5998118">=</span>&nbsp;<span class="ident" id="5998120">tr</span><span class="op" id="5998122">.</span><span class="ident" id="5998123">octal</span><span class="op" id="5998128">(</span><span class="ident" id="5998129">devminor</span><span class="op" id="5998137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998141">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998145">var</span>&nbsp;<span class="ident" id="5998149">prefix</span>&nbsp;<span class="builtintype" id="5998156">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998165">switch</span>&nbsp;<span class="ident" id="5998172">format</span>&nbsp;<span class="op" id="5998179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998183">case</span>&nbsp;<span class="string" id="5998188">&#34;posix&#34;</span><span class="op" id="5998195">,</span>&nbsp;<span class="string" id="5998197">&#34;gnu&#34;</span><span class="op" id="5998202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998207">prefix</span>&nbsp;<span class="op" id="5998214">=</span>&nbsp;<span class="ident" id="5998216">cString</span><span class="op" id="5998223">(</span><span class="ident" id="5998224">s</span><span class="op" id="5998225">.</span><span class="ident" id="5998226">next</span><span class="op" id="5998230">(</span><span class="num" id="5998231">155</span><span class="op" id="5998234">)</span><span class="op" id="5998235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998239">case</span>&nbsp;<span class="string" id="5998244">&#34;star&#34;</span><span class="op" id="5998250">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998255">prefix</span>&nbsp;<span class="op" id="5998262">=</span>&nbsp;<span class="ident" id="5998264">cString</span><span class="op" id="5998271">(</span><span class="ident" id="5998272">s</span><span class="op" id="5998273">.</span><span class="ident" id="5998274">next</span><span class="op" id="5998278">(</span><span class="num" id="5998279">131</span><span class="op" id="5998282">)</span><span class="op" id="5998283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998288">hdr</span><span class="op" id="5998291">.</span><span class="ident" id="5998292">AccessTime</span>&nbsp;<span class="op" id="5998303">=</span>&nbsp;<span class="ident" id="5998305">time</span><span class="op" id="5998309">.</span><span class="ident" id="5998310">Unix</span><span class="op" id="5998314">(</span><span class="ident" id="5998315">tr</span><span class="op" id="5998317">.</span><span class="ident" id="5998318">octal</span><span class="op" id="5998323">(</span><span class="ident" id="5998324">s</span><span class="op" id="5998325">.</span><span class="ident" id="5998326">next</span><span class="op" id="5998330">(</span><span class="num" id="5998331">12</span><span class="op" id="5998333">)</span><span class="op" id="5998334">)</span><span class="op" id="5998335">,</span>&nbsp;<span class="num" id="5998337">0</span><span class="op" id="5998338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998343">hdr</span><span class="op" id="5998346">.</span><span class="ident" id="5998347">ChangeTime</span>&nbsp;<span class="op" id="5998358">=</span>&nbsp;<span class="ident" id="5998360">time</span><span class="op" id="5998364">.</span><span class="ident" id="5998365">Unix</span><span class="op" id="5998369">(</span><span class="ident" id="5998370">tr</span><span class="op" id="5998372">.</span><span class="ident" id="5998373">octal</span><span class="op" id="5998378">(</span><span class="ident" id="5998379">s</span><span class="op" id="5998380">.</span><span class="ident" id="5998381">next</span><span class="op" id="5998385">(</span><span class="num" id="5998386">12</span><span class="op" id="5998388">)</span><span class="op" id="5998389">)</span><span class="op" id="5998390">,</span>&nbsp;<span class="num" id="5998392">0</span><span class="op" id="5998393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998401">if</span>&nbsp;<span class="builtinfunc" id="5998404">len</span><span class="op" id="5998407">(</span><span class="ident" id="5998408">prefix</span><span class="op" id="5998414">)</span>&nbsp;<span class="op" id="5998416">&gt;</span>&nbsp;<span class="num" id="5998418">0</span>&nbsp;<span class="op" id="5998420">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998425">hdr</span><span class="op" id="5998428">.</span><span class="ident" id="5998429">Name</span>&nbsp;<span class="op" id="5998434">=</span>&nbsp;<span class="ident" id="5998436">prefix</span>&nbsp;<span class="op" id="5998443">+</span>&nbsp;<span class="string" id="5998445">&#34;/&#34;</span>&nbsp;<span class="op" id="5998449">+</span>&nbsp;<span class="ident" id="5998451">hdr</span><span class="op" id="5998454">.</span><span class="ident" id="5998455">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998469">if</span>&nbsp;<span class="ident" id="5998472">tr</span><span class="op" id="5998474">.</span><span class="ident" id="5998475">err</span>&nbsp;<span class="op" id="5998479">!=</span>&nbsp;<span class="ident" id="5998482">nil</span>&nbsp;<span class="op" id="5998486">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998490">tr</span><span class="op" id="5998492">.</span><span class="ident" id="5998493">err</span>&nbsp;<span class="op" id="5998497">=</span>&nbsp;<span class="ident" id="5998499">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998511">return</span>&nbsp;<span class="ident" id="5998518">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998527">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998585">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998630">nb</span>&nbsp;<span class="op" id="5998633">:=</span>&nbsp;<span class="ident" id="5998636">int64</span><span class="op" id="5998641">(</span><span class="ident" id="5998642">hdr</span><span class="op" id="5998645">.</span><span class="ident" id="5998646">Size</span><span class="op" id="5998650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998653">tr</span><span class="op" id="5998655">.</span><span class="ident" id="5998656">pad</span>&nbsp;<span class="op" id="5998660">=</span>&nbsp;<span class="op" id="5998662">-</span><span class="ident" id="5998663">nb</span>&nbsp;<span class="op" id="5998666">&amp;</span>&nbsp;<span class="op" id="5998668">(</span><span class="ident" id="5998669">blockSize</span>&nbsp;<span class="op" id="5998679">-</span>&nbsp;<span class="num" id="5998681">1</span><span class="op" id="5998682">)</span>&nbsp;<span class="comment" id="5998684">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998717">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998750">tr</span><span class="op" id="5998752">.</span><span class="ident" id="5998753">curr</span>&nbsp;<span class="op" id="5998758">=</span>&nbsp;<span class="op" id="5998760">&amp;</span><span class="ident" id="5998761">regFileReader</span><span class="op" id="5998774">{</span><span class="ident" id="5998775">r</span><span class="op" id="5998776">:</span>&nbsp;<span class="ident" id="5998778">tr</span><span class="op" id="5998780">.</span><span class="ident" id="5998781">r</span><span class="op" id="5998782">,</span>&nbsp;<span class="ident" id="5998784">nb</span><span class="op" id="5998786">:</span>&nbsp;<span class="ident" id="5998788">nb</span><span class="op" id="5998790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998794">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998837">if</span>&nbsp;<span class="ident" id="5998840">hdr</span><span class="op" id="5998843">.</span><span class="ident" id="5998844">Typeflag</span>&nbsp;<span class="op" id="5998853">==</span>&nbsp;<span class="ident" id="5998856">TypeGNUSparse</span>&nbsp;<span class="op" id="5998870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998874">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998910">hdr</span><span class="op" id="5998913">.</span><span class="ident" id="5998914">Size</span>&nbsp;<span class="op" id="5998919">=</span>&nbsp;<span class="ident" id="5998921">tr</span><span class="op" id="5998923">.</span><span class="ident" id="5998924">octal</span><span class="op" id="5998929">(</span><span class="ident" id="5998930">header</span><span class="op" id="5998936">[</span><span class="num" id="5998937">483</span><span class="op" id="5998940">:</span><span class="num" id="5998941">495</span><span class="op" id="5998944">]</span><span class="op" id="5998945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998950">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998976">sp</span>&nbsp;<span class="op" id="5998979">:=</span>&nbsp;<span class="ident" id="5998982">tr</span><span class="op" id="5998984">.</span><span class="ident" id="5998985">readOldGNUSparseMap</span><span class="op" id="5999004">(</span><span class="ident" id="5999005">header</span><span class="op" id="5999011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999015">if</span>&nbsp;<span class="ident" id="5999018">tr</span><span class="op" id="5999020">.</span><span class="ident" id="5999021">err</span>&nbsp;<span class="op" id="5999025">!=</span>&nbsp;<span class="ident" id="5999028">nil</span>&nbsp;<span class="op" id="5999032">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999037">return</span>&nbsp;<span class="ident" id="5999044">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999054">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999126">tr</span><span class="op" id="5999128">.</span><span class="ident" id="5999129">curr</span>&nbsp;<span class="op" id="5999134">=</span>&nbsp;<span class="op" id="5999136">&amp;</span><span class="ident" id="5999137">sparseFileReader</span><span class="op" id="5999153">{</span><span class="ident" id="5999154">rfr</span><span class="op" id="5999157">:</span>&nbsp;<span class="ident" id="5999159">tr</span><span class="op" id="5999161">.</span><span class="ident" id="5999162">curr</span><span class="op" id="5999166">.</span><span class="op" id="5999167">(</span><span class="op" id="5999168">*</span><span class="ident" id="5999169">regFileReader</span><span class="op" id="5999182">)</span><span class="op" id="5999183">,</span>&nbsp;<span class="ident" id="5999185">sp</span><span class="op" id="5999187">:</span>&nbsp;<span class="ident" id="5999189">sp</span><span class="op" id="5999191">,</span>&nbsp;<span class="ident" id="5999193">tot</span><span class="op" id="5999196">:</span>&nbsp;<span class="ident" id="5999198">hdr</span><span class="op" id="5999201">.</span><span class="ident" id="5999202">Size</span><span class="op" id="5999206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999209">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999213">return</span>&nbsp;<span class="ident" id="5999220">hdr</span><br>
<span class="lineno"></span><span class="op" id="5999224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5999227">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5999296">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5999366">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5999384">type</span>&nbsp;<span class="ident" id="5999389">sparseEntry</span>&nbsp;<span class="keyword" id="5999401">struct</span>&nbsp;<span class="op" id="5999408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999411">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5999420">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999427">numBytes</span>&nbsp;<span class="ident" id="5999436">int64</span><br>
<span class="lineno">545</span><span class="op" id="5999442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5999445">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5999529">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5999631">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5999715">func</span>&nbsp;<span class="op" id="5999720">(</span><span class="ident" id="5999721">tr</span>&nbsp;<span class="op" id="5999724">*</span><span class="ident" id="5999725">Reader</span><span class="op" id="5999731">)</span>&nbsp;<span class="ident" id="5999733">readOldGNUSparseMap</span><span class="op" id="5999752">(</span><span class="ident" id="5999753">header</span>&nbsp;<span class="op" id="5999760">[</span><span class="op" id="5999761">]</span><span class="builtintype" id="5999762">byte</span><span class="op" id="5999766">)</span>&nbsp;<span class="op" id="5999768">[</span><span class="op" id="5999769">]</span><span class="ident" id="5999770">sparseEntry</span>&nbsp;<span class="op" id="5999782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999785">isExtended</span>&nbsp;<span class="op" id="5999796">:=</span>&nbsp;<span class="ident" id="5999799">header</span><span class="op" id="5999805">[</span><span class="ident" id="5999806">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5999844">]</span>&nbsp;<span class="op" id="5999846">!=</span>&nbsp;<span class="num" id="5999849">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999852">spCap</span>&nbsp;<span class="op" id="5999858">:=</span>&nbsp;<span class="ident" id="5999861">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999895">if</span>&nbsp;<span class="ident" id="5999898">isExtended</span>&nbsp;<span class="op" id="5999909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999913">spCap</span>&nbsp;<span class="op" id="5999919">+=</span>&nbsp;<span class="ident" id="5999922">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999963">sp</span>&nbsp;<span class="op" id="5999966">:=</span>&nbsp;<span class="builtinfunc" id="5999969">make</span><span class="op" id="5999973">(</span><span class="op" id="5999974">[</span><span class="op" id="5999975">]</span><span class="ident" id="5999976">sparseEntry</span><span class="op" id="5999987">,</span>&nbsp;<span class="num" id="5999989">0</span><span class="op" id="5999990">,</span>&nbsp;<span class="ident" id="5999992">spCap</span><span class="op" id="5999997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000000">s</span>&nbsp;<span class="op" id="6000002">:=</span>&nbsp;<span class="ident" id="6000005">slicer</span><span class="op" id="6000011">(</span><span class="ident" id="6000012">header</span><span class="op" id="6000018">[</span><span class="ident" id="6000019">oldGNUSparseMainHeaderOffset</span><span class="op" id="6000047">:</span><span class="op" id="6000048">]</span><span class="op" id="6000049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000053">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000104">for</span>&nbsp;<span class="ident" id="6000108">i</span>&nbsp;<span class="op" id="6000110">:=</span>&nbsp;<span class="num" id="6000113">0</span><span class="op" id="6000114">;</span>&nbsp;<span class="ident" id="6000116">i</span>&nbsp;<span class="op" id="6000118">&lt;</span>&nbsp;<span class="ident" id="6000120">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6000152">;</span>&nbsp;<span class="ident" id="6000154">i</span><span class="op" id="6000155">++</span>&nbsp;<span class="op" id="6000158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000162">offset</span>&nbsp;<span class="op" id="6000169">:=</span>&nbsp;<span class="ident" id="6000172">tr</span><span class="op" id="6000174">.</span><span class="ident" id="6000175">octal</span><span class="op" id="6000180">(</span><span class="ident" id="6000181">s</span><span class="op" id="6000182">.</span><span class="ident" id="6000183">next</span><span class="op" id="6000187">(</span><span class="ident" id="6000188">oldGNUSparseOffsetSize</span><span class="op" id="6000210">)</span><span class="op" id="6000211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000215">numBytes</span>&nbsp;<span class="op" id="6000224">:=</span>&nbsp;<span class="ident" id="6000227">tr</span><span class="op" id="6000229">.</span><span class="ident" id="6000230">octal</span><span class="op" id="6000235">(</span><span class="ident" id="6000236">s</span><span class="op" id="6000237">.</span><span class="ident" id="6000238">next</span><span class="op" id="6000242">(</span><span class="ident" id="6000243">oldGNUSparseNumBytesSize</span><span class="op" id="6000267">)</span><span class="op" id="6000268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000272">if</span>&nbsp;<span class="ident" id="6000275">tr</span><span class="op" id="6000277">.</span><span class="ident" id="6000278">err</span>&nbsp;<span class="op" id="6000282">!=</span>&nbsp;<span class="ident" id="6000285">nil</span>&nbsp;<span class="op" id="6000289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000294">tr</span><span class="op" id="6000296">.</span><span class="ident" id="6000297">err</span>&nbsp;<span class="op" id="6000301">=</span>&nbsp;<span class="ident" id="6000303">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000316">return</span>&nbsp;<span class="ident" id="6000323">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000333">if</span>&nbsp;<span class="ident" id="6000336">offset</span>&nbsp;<span class="op" id="6000343">==</span>&nbsp;<span class="num" id="6000346">0</span>&nbsp;<span class="op" id="6000348">&amp;&amp;</span>&nbsp;<span class="ident" id="6000351">numBytes</span>&nbsp;<span class="op" id="6000360">==</span>&nbsp;<span class="num" id="6000363">0</span>&nbsp;<span class="op" id="6000365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000370">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000378">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000382">sp</span>&nbsp;<span class="op" id="6000385">=</span>&nbsp;<span class="builtinfunc" id="6000387">append</span><span class="op" id="6000393">(</span><span class="ident" id="6000394">sp</span><span class="op" id="6000396">,</span>&nbsp;<span class="ident" id="6000398">sparseEntry</span><span class="op" id="6000409">{</span><span class="ident" id="6000410">offset</span><span class="op" id="6000416">:</span>&nbsp;<span class="ident" id="6000418">offset</span><span class="op" id="6000424">,</span>&nbsp;<span class="ident" id="6000426">numBytes</span><span class="op" id="6000434">:</span>&nbsp;<span class="ident" id="6000436">numBytes</span><span class="op" id="6000444">}</span><span class="op" id="6000445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000452">for</span>&nbsp;<span class="ident" id="6000456">isExtended</span>&nbsp;<span class="op" id="6000467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000471">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000548">sparseHeader</span>&nbsp;<span class="op" id="6000561">:=</span>&nbsp;<span class="builtinfunc" id="6000564">make</span><span class="op" id="6000568">(</span><span class="op" id="6000569">[</span><span class="op" id="6000570">]</span><span class="builtintype" id="6000571">byte</span><span class="op" id="6000575">,</span>&nbsp;<span class="ident" id="6000577">blockSize</span><span class="op" id="6000586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000590">if</span>&nbsp;<span class="ident" id="6000593">_</span><span class="op" id="6000594">,</span>&nbsp;<span class="ident" id="6000596">tr</span><span class="op" id="6000598">.</span><span class="ident" id="6000599">err</span>&nbsp;<span class="op" id="6000603">=</span>&nbsp;<span class="ident" id="6000605">io</span><span class="op" id="6000607">.</span><span class="ident" id="6000608">ReadFull</span><span class="op" id="6000616">(</span><span class="ident" id="6000617">tr</span><span class="op" id="6000619">.</span><span class="ident" id="6000620">r</span><span class="op" id="6000621">,</span>&nbsp;<span class="ident" id="6000623">sparseHeader</span><span class="op" id="6000635">)</span><span class="op" id="6000636">;</span>&nbsp;<span class="ident" id="6000638">tr</span><span class="op" id="6000640">.</span><span class="ident" id="6000641">err</span>&nbsp;<span class="op" id="6000645">!=</span>&nbsp;<span class="ident" id="6000648">nil</span>&nbsp;<span class="op" id="6000652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000657">return</span>&nbsp;<span class="ident" id="6000664">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000674">isExtended</span>&nbsp;<span class="op" id="6000685">=</span>&nbsp;<span class="ident" id="6000687">sparseHeader</span><span class="op" id="6000699">[</span><span class="ident" id="6000700">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6000742">]</span>&nbsp;<span class="op" id="6000744">!=</span>&nbsp;<span class="num" id="6000747">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000751">s</span>&nbsp;<span class="op" id="6000753">=</span>&nbsp;<span class="ident" id="6000755">slicer</span><span class="op" id="6000761">(</span><span class="ident" id="6000762">sparseHeader</span><span class="op" id="6000774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000778">for</span>&nbsp;<span class="ident" id="6000782">i</span>&nbsp;<span class="op" id="6000784">:=</span>&nbsp;<span class="num" id="6000787">0</span><span class="op" id="6000788">;</span>&nbsp;<span class="ident" id="6000790">i</span>&nbsp;<span class="op" id="6000792">&lt;</span>&nbsp;<span class="ident" id="6000794">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6000830">;</span>&nbsp;<span class="ident" id="6000832">i</span><span class="op" id="6000833">++</span>&nbsp;<span class="op" id="6000836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000841">offset</span>&nbsp;<span class="op" id="6000848">:=</span>&nbsp;<span class="ident" id="6000851">tr</span><span class="op" id="6000853">.</span><span class="ident" id="6000854">octal</span><span class="op" id="6000859">(</span><span class="ident" id="6000860">s</span><span class="op" id="6000861">.</span><span class="ident" id="6000862">next</span><span class="op" id="6000866">(</span><span class="ident" id="6000867">oldGNUSparseOffsetSize</span><span class="op" id="6000889">)</span><span class="op" id="6000890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000895">numBytes</span>&nbsp;<span class="op" id="6000904">:=</span>&nbsp;<span class="ident" id="6000907">tr</span><span class="op" id="6000909">.</span><span class="ident" id="6000910">octal</span><span class="op" id="6000915">(</span><span class="ident" id="6000916">s</span><span class="op" id="6000917">.</span><span class="ident" id="6000918">next</span><span class="op" id="6000922">(</span><span class="ident" id="6000923">oldGNUSparseNumBytesSize</span><span class="op" id="6000947">)</span><span class="op" id="6000948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000953">if</span>&nbsp;<span class="ident" id="6000956">tr</span><span class="op" id="6000958">.</span><span class="ident" id="6000959">err</span>&nbsp;<span class="op" id="6000963">!=</span>&nbsp;<span class="ident" id="6000966">nil</span>&nbsp;<span class="op" id="6000970">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000976">tr</span><span class="op" id="6000978">.</span><span class="ident" id="6000979">err</span>&nbsp;<span class="op" id="6000983">=</span>&nbsp;<span class="ident" id="6000985">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000999">return</span>&nbsp;<span class="ident" id="6001006">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001018">if</span>&nbsp;<span class="ident" id="6001021">offset</span>&nbsp;<span class="op" id="6001028">==</span>&nbsp;<span class="num" id="6001031">0</span>&nbsp;<span class="op" id="6001033">&amp;&amp;</span>&nbsp;<span class="ident" id="6001036">numBytes</span>&nbsp;<span class="op" id="6001045">==</span>&nbsp;<span class="num" id="6001048">0</span>&nbsp;<span class="op" id="6001050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001056">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001070">sp</span>&nbsp;<span class="op" id="6001073">=</span>&nbsp;<span class="builtinfunc" id="6001075">append</span><span class="op" id="6001081">(</span><span class="ident" id="6001082">sp</span><span class="op" id="6001084">,</span>&nbsp;<span class="ident" id="6001086">sparseEntry</span><span class="op" id="6001097">{</span><span class="ident" id="6001098">offset</span><span class="op" id="6001104">:</span>&nbsp;<span class="ident" id="6001106">offset</span><span class="op" id="6001112">,</span>&nbsp;<span class="ident" id="6001114">numBytes</span><span class="op" id="6001122">:</span>&nbsp;<span class="ident" id="6001124">numBytes</span><span class="op" id="6001132">}</span><span class="op" id="6001133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001143">return</span>&nbsp;<span class="ident" id="6001150">sp</span><br>
<span class="lineno">595</span><span class="op" id="6001153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6001156">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6001250">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6001350">func</span>&nbsp;<span class="ident" id="6001355">readGNUSparseMap1x0</span><span class="op" id="6001374">(</span><span class="ident" id="6001375">r</span>&nbsp;<span class="ident" id="6001377">io</span><span class="op" id="6001379">.</span><span class="ident" id="6001380">Reader</span><span class="op" id="6001386">)</span>&nbsp;<span class="op" id="6001388">(</span><span class="op" id="6001389">[</span><span class="op" id="6001390">]</span><span class="ident" id="6001391">sparseEntry</span><span class="op" id="6001402">,</span>&nbsp;<span class="builtintype" id="6001404">error</span><span class="op" id="6001409">)</span>&nbsp;<span class="op" id="6001411">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001414">buf</span>&nbsp;<span class="op" id="6001418">:=</span>&nbsp;<span class="builtinfunc" id="6001421">make</span><span class="op" id="6001425">(</span><span class="op" id="6001426">[</span><span class="op" id="6001427">]</span><span class="builtintype" id="6001428">byte</span><span class="op" id="6001432">,</span>&nbsp;<span class="num" id="6001434">2</span><span class="op" id="6001435">*</span><span class="ident" id="6001436">blockSize</span><span class="op" id="6001445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001448">sparseHeader</span>&nbsp;<span class="op" id="6001461">:=</span>&nbsp;<span class="ident" id="6001464">buf</span><span class="op" id="6001467">[</span><span class="op" id="6001468">:</span><span class="ident" id="6001469">blockSize</span><span class="op" id="6001478">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001482">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001565">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001637">readDecimal</span>&nbsp;<span class="op" id="6001649">:=</span>&nbsp;<span class="keyword" id="6001652">func</span><span class="op" id="6001656">(</span><span class="op" id="6001657">)</span>&nbsp;<span class="op" id="6001659">(</span><span class="ident" id="6001660">int64</span><span class="op" id="6001665">,</span>&nbsp;<span class="builtintype" id="6001667">error</span><span class="op" id="6001672">)</span>&nbsp;<span class="op" id="6001674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001678">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001700">nl</span>&nbsp;<span class="op" id="6001703">:=</span>&nbsp;<span class="ident" id="6001706">bytes</span><span class="op" id="6001711">.</span><span class="ident" id="6001712">IndexByte</span><span class="op" id="6001721">(</span><span class="ident" id="6001722">sparseHeader</span><span class="op" id="6001734">,</span>&nbsp;<span class="string" id="6001736">&#39;\n&#39;</span><span class="op" id="6001740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001744">if</span>&nbsp;<span class="ident" id="6001747">nl</span>&nbsp;<span class="op" id="6001750">==</span>&nbsp;<span class="op" id="6001753">-</span><span class="num" id="6001754">1</span>&nbsp;<span class="op" id="6001756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001761">if</span>&nbsp;<span class="builtinfunc" id="6001764">len</span><span class="op" id="6001767">(</span><span class="ident" id="6001768">sparseHeader</span><span class="op" id="6001780">)</span>&nbsp;<span class="op" id="6001782">&gt;=</span>&nbsp;<span class="ident" id="6001785">blockSize</span>&nbsp;<span class="op" id="6001795">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001801">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001825">return</span>&nbsp;<span class="num" id="6001832">0</span><span class="op" id="6001833">,</span>&nbsp;<span class="ident" id="6001835">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001853">oldLen</span>&nbsp;<span class="op" id="6001860">:=</span>&nbsp;<span class="builtinfunc" id="6001863">len</span><span class="op" id="6001866">(</span><span class="ident" id="6001867">sparseHeader</span><span class="op" id="6001879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001884">newLen</span>&nbsp;<span class="op" id="6001891">:=</span>&nbsp;<span class="ident" id="6001894">oldLen</span>&nbsp;<span class="op" id="6001901">+</span>&nbsp;<span class="ident" id="6001903">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001916">if</span>&nbsp;<span class="builtinfunc" id="6001919">cap</span><span class="op" id="6001922">(</span><span class="ident" id="6001923">sparseHeader</span><span class="op" id="6001935">)</span>&nbsp;<span class="op" id="6001937">&lt;</span>&nbsp;<span class="ident" id="6001939">newLen</span>&nbsp;<span class="op" id="6001946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001952">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6002024">copy</span><span class="op" id="6002028">(</span><span class="ident" id="6002029">buf</span><span class="op" id="6002032">,</span>&nbsp;<span class="ident" id="6002034">sparseHeader</span><span class="op" id="6002046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002052">sparseHeader</span>&nbsp;<span class="op" id="6002065">=</span>&nbsp;<span class="ident" id="6002067">buf</span><span class="op" id="6002070">[</span><span class="op" id="6002071">:</span><span class="ident" id="6002072">newLen</span><span class="op" id="6002078">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002083">}</span>&nbsp;<span class="keyword" id="6002085">else</span>&nbsp;<span class="op" id="6002090">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002096">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002148">sparseHeader</span>&nbsp;<span class="op" id="6002161">=</span>&nbsp;<span class="ident" id="6002163">sparseHeader</span><span class="op" id="6002175">[</span><span class="op" id="6002176">:</span><span class="ident" id="6002177">newLen</span><span class="op" id="6002183">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002194">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002255">if</span>&nbsp;<span class="ident" id="6002258">_</span><span class="op" id="6002259">,</span>&nbsp;<span class="ident" id="6002261">err</span>&nbsp;<span class="op" id="6002265">:=</span>&nbsp;<span class="ident" id="6002268">io</span><span class="op" id="6002270">.</span><span class="ident" id="6002271">ReadFull</span><span class="op" id="6002279">(</span><span class="ident" id="6002280">r</span><span class="op" id="6002281">,</span>&nbsp;<span class="ident" id="6002283">sparseHeader</span><span class="op" id="6002295">[</span><span class="ident" id="6002296">oldLen</span><span class="op" id="6002302">:</span><span class="ident" id="6002303">newLen</span><span class="op" id="6002309">]</span><span class="op" id="6002310">)</span><span class="op" id="6002311">;</span>&nbsp;<span class="ident" id="6002313">err</span>&nbsp;<span class="op" id="6002317">!=</span>&nbsp;<span class="ident" id="6002320">nil</span>&nbsp;<span class="op" id="6002324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002330">return</span>&nbsp;<span class="num" id="6002337">0</span><span class="op" id="6002338">,</span>&nbsp;<span class="ident" id="6002340">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002353">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002394">nl</span>&nbsp;<span class="op" id="6002397">=</span>&nbsp;<span class="ident" id="6002399">bytes</span><span class="op" id="6002404">.</span><span class="ident" id="6002405">IndexByte</span><span class="op" id="6002414">(</span><span class="ident" id="6002415">sparseHeader</span><span class="op" id="6002427">[</span><span class="ident" id="6002428">oldLen</span><span class="op" id="6002434">:</span><span class="ident" id="6002435">newLen</span><span class="op" id="6002441">]</span><span class="op" id="6002442">,</span>&nbsp;<span class="string" id="6002444">&#39;\n&#39;</span><span class="op" id="6002448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002453">if</span>&nbsp;<span class="ident" id="6002456">nl</span>&nbsp;<span class="op" id="6002459">==</span>&nbsp;<span class="op" id="6002462">-</span><span class="num" id="6002463">1</span>&nbsp;<span class="op" id="6002465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002471">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002495">return</span>&nbsp;<span class="num" id="6002502">0</span><span class="op" id="6002503">,</span>&nbsp;<span class="ident" id="6002505">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002518">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002523">nl</span>&nbsp;<span class="op" id="6002526">+=</span>&nbsp;<span class="ident" id="6002529">oldLen</span>&nbsp;<span class="comment" id="6002536">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002585">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002636">n</span><span class="op" id="6002637">,</span>&nbsp;<span class="ident" id="6002639">err</span>&nbsp;<span class="op" id="6002643">:=</span>&nbsp;<span class="ident" id="6002646">strconv</span><span class="op" id="6002653">.</span><span class="ident" id="6002654">ParseInt</span><span class="op" id="6002662">(</span><span class="builtintype" id="6002663">string</span><span class="op" id="6002669">(</span><span class="ident" id="6002670">sparseHeader</span><span class="op" id="6002682">[</span><span class="op" id="6002683">:</span><span class="ident" id="6002684">nl</span><span class="op" id="6002686">]</span><span class="op" id="6002687">)</span><span class="op" id="6002688">,</span>&nbsp;<span class="num" id="6002690">10</span><span class="op" id="6002692">,</span>&nbsp;<span class="num" id="6002694">0</span><span class="op" id="6002695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002699">if</span>&nbsp;<span class="ident" id="6002702">err</span>&nbsp;<span class="op" id="6002706">!=</span>&nbsp;<span class="ident" id="6002709">nil</span>&nbsp;<span class="op" id="6002713">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002718">return</span>&nbsp;<span class="num" id="6002725">0</span><span class="op" id="6002726">,</span>&nbsp;<span class="ident" id="6002728">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002745">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002793">sparseHeader</span>&nbsp;<span class="op" id="6002806">=</span>&nbsp;<span class="ident" id="6002808">sparseHeader</span><span class="op" id="6002820">[</span><span class="ident" id="6002821">nl</span><span class="op" id="6002823">+</span><span class="num" id="6002824">1</span><span class="op" id="6002825">:</span><span class="op" id="6002826">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002830">return</span>&nbsp;<span class="ident" id="6002837">n</span><span class="op" id="6002838">,</span>&nbsp;<span class="ident" id="6002840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002849">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002874">if</span>&nbsp;<span class="ident" id="6002877">_</span><span class="op" id="6002878">,</span>&nbsp;<span class="ident" id="6002880">err</span>&nbsp;<span class="op" id="6002884">:=</span>&nbsp;<span class="ident" id="6002887">io</span><span class="op" id="6002889">.</span><span class="ident" id="6002890">ReadFull</span><span class="op" id="6002898">(</span><span class="ident" id="6002899">r</span><span class="op" id="6002900">,</span>&nbsp;<span class="ident" id="6002902">sparseHeader</span><span class="op" id="6002914">)</span><span class="op" id="6002915">;</span>&nbsp;<span class="ident" id="6002917">err</span>&nbsp;<span class="op" id="6002921">!=</span>&nbsp;<span class="ident" id="6002924">nil</span>&nbsp;<span class="op" id="6002928">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002932">return</span>&nbsp;<span class="ident" id="6002939">nil</span><span class="op" id="6002942">,</span>&nbsp;<span class="ident" id="6002944">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002953">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003003">numEntries</span><span class="op" id="6003013">,</span>&nbsp;<span class="ident" id="6003015">err</span>&nbsp;<span class="op" id="6003019">:=</span>&nbsp;<span class="ident" id="6003022">readDecimal</span><span class="op" id="6003033">(</span><span class="op" id="6003034">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003037">if</span>&nbsp;<span class="ident" id="6003040">err</span>&nbsp;<span class="op" id="6003044">!=</span>&nbsp;<span class="ident" id="6003047">nil</span>&nbsp;<span class="op" id="6003051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003055">return</span>&nbsp;<span class="ident" id="6003062">nil</span><span class="op" id="6003065">,</span>&nbsp;<span class="ident" id="6003067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003076">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003101">sp</span>&nbsp;<span class="op" id="6003104">:=</span>&nbsp;<span class="builtinfunc" id="6003107">make</span><span class="op" id="6003111">(</span><span class="op" id="6003112">[</span><span class="op" id="6003113">]</span><span class="ident" id="6003114">sparseEntry</span><span class="op" id="6003125">,</span>&nbsp;<span class="num" id="6003127">0</span><span class="op" id="6003128">,</span>&nbsp;<span class="ident" id="6003130">numEntries</span><span class="op" id="6003140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003143">for</span>&nbsp;<span class="ident" id="6003147">i</span>&nbsp;<span class="op" id="6003149">:=</span>&nbsp;<span class="ident" id="6003152">int64</span><span class="op" id="6003157">(</span><span class="num" id="6003158">0</span><span class="op" id="6003159">)</span><span class="op" id="6003160">;</span>&nbsp;<span class="ident" id="6003162">i</span>&nbsp;<span class="op" id="6003164">&lt;</span>&nbsp;<span class="ident" id="6003166">numEntries</span><span class="op" id="6003176">;</span>&nbsp;<span class="ident" id="6003178">i</span><span class="op" id="6003179">++</span>&nbsp;<span class="op" id="6003182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003186">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003207">offset</span><span class="op" id="6003213">,</span>&nbsp;<span class="ident" id="6003215">err</span>&nbsp;<span class="op" id="6003219">:=</span>&nbsp;<span class="ident" id="6003222">readDecimal</span><span class="op" id="6003233">(</span><span class="op" id="6003234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003238">if</span>&nbsp;<span class="ident" id="6003241">err</span>&nbsp;<span class="op" id="6003245">!=</span>&nbsp;<span class="ident" id="6003248">nil</span>&nbsp;<span class="op" id="6003252">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003257">return</span>&nbsp;<span class="ident" id="6003264">nil</span><span class="op" id="6003267">,</span>&nbsp;<span class="ident" id="6003269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003279">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003298">numBytes</span><span class="op" id="6003306">,</span>&nbsp;<span class="ident" id="6003308">err</span>&nbsp;<span class="op" id="6003312">:=</span>&nbsp;<span class="ident" id="6003315">readDecimal</span><span class="op" id="6003326">(</span><span class="op" id="6003327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003331">if</span>&nbsp;<span class="ident" id="6003334">err</span>&nbsp;<span class="op" id="6003338">!=</span>&nbsp;<span class="ident" id="6003341">nil</span>&nbsp;<span class="op" id="6003345">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003350">return</span>&nbsp;<span class="ident" id="6003357">nil</span><span class="op" id="6003360">,</span>&nbsp;<span class="ident" id="6003362">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003373">sp</span>&nbsp;<span class="op" id="6003376">=</span>&nbsp;<span class="builtinfunc" id="6003378">append</span><span class="op" id="6003384">(</span><span class="ident" id="6003385">sp</span><span class="op" id="6003387">,</span>&nbsp;<span class="ident" id="6003389">sparseEntry</span><span class="op" id="6003400">{</span><span class="ident" id="6003401">offset</span><span class="op" id="6003407">:</span>&nbsp;<span class="ident" id="6003409">offset</span><span class="op" id="6003415">,</span>&nbsp;<span class="ident" id="6003417">numBytes</span><span class="op" id="6003425">:</span>&nbsp;<span class="ident" id="6003427">numBytes</span><span class="op" id="6003435">}</span><span class="op" id="6003436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003439">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003443">return</span>&nbsp;<span class="ident" id="6003450">sp</span><span class="op" id="6003452">,</span>&nbsp;<span class="ident" id="6003454">nil</span><br>
<span class="lineno"></span><span class="op" id="6003458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6003461">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6003555">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6003603">func</span>&nbsp;<span class="ident" id="6003608">readGNUSparseMap0x1</span><span class="op" id="6003627">(</span><span class="ident" id="6003628">headers</span>&nbsp;<span class="keyword" id="6003636">map</span><span class="op" id="6003639">[</span><span class="builtintype" id="6003640">string</span><span class="op" id="6003646">]</span><span class="builtintype" id="6003647">string</span><span class="op" id="6003653">)</span>&nbsp;<span class="op" id="6003655">(</span><span class="op" id="6003656">[</span><span class="op" id="6003657">]</span><span class="ident" id="6003658">sparseEntry</span><span class="op" id="6003669">,</span>&nbsp;<span class="builtintype" id="6003671">error</span><span class="op" id="6003676">)</span>&nbsp;<span class="op" id="6003678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003681">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003707">numEntriesStr</span><span class="op" id="6003720">,</span>&nbsp;<span class="ident" id="6003722">ok</span>&nbsp;<span class="op" id="6003725">:=</span>&nbsp;<span class="ident" id="6003728">headers</span><span class="op" id="6003735">[</span><span class="ident" id="6003736">paxGNUSparseNumBlocks</span><span class="op" id="6003757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003760">if</span>&nbsp;<span class="op" id="6003763">!</span><span class="ident" id="6003764">ok</span>&nbsp;<span class="op" id="6003767">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003771">return</span>&nbsp;<span class="ident" id="6003778">nil</span><span class="op" id="6003781">,</span>&nbsp;<span class="ident" id="6003783">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003797">numEntries</span><span class="op" id="6003807">,</span>&nbsp;<span class="ident" id="6003809">err</span>&nbsp;<span class="op" id="6003813">:=</span>&nbsp;<span class="ident" id="6003816">strconv</span><span class="op" id="6003823">.</span><span class="ident" id="6003824">ParseInt</span><span class="op" id="6003832">(</span><span class="ident" id="6003833">numEntriesStr</span><span class="op" id="6003846">,</span>&nbsp;<span class="num" id="6003848">10</span><span class="op" id="6003850">,</span>&nbsp;<span class="num" id="6003852">0</span><span class="op" id="6003853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003856">if</span>&nbsp;<span class="ident" id="6003859">err</span>&nbsp;<span class="op" id="6003863">!=</span>&nbsp;<span class="ident" id="6003866">nil</span>&nbsp;<span class="op" id="6003870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003874">return</span>&nbsp;<span class="ident" id="6003881">nil</span><span class="op" id="6003884">,</span>&nbsp;<span class="ident" id="6003886">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003901">sparseMap</span>&nbsp;<span class="op" id="6003911">:=</span>&nbsp;<span class="ident" id="6003914">strings</span><span class="op" id="6003921">.</span><span class="ident" id="6003922">Split</span><span class="op" id="6003927">(</span><span class="ident" id="6003928">headers</span><span class="op" id="6003935">[</span><span class="ident" id="6003936">paxGNUSparseMap</span><span class="op" id="6003951">]</span><span class="op" id="6003952">,</span>&nbsp;<span class="string" id="6003954">&#34;,&#34;</span><span class="op" id="6003957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003961">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004021">if</span>&nbsp;<span class="ident" id="6004024">int64</span><span class="op" id="6004029">(</span><span class="builtinfunc" id="6004030">len</span><span class="op" id="6004033">(</span><span class="ident" id="6004034">sparseMap</span><span class="op" id="6004043">)</span><span class="op" id="6004044">)</span>&nbsp;<span class="op" id="6004046">!=</span>&nbsp;<span class="num" id="6004049">2</span><span class="op" id="6004050">*</span><span class="ident" id="6004051">numEntries</span>&nbsp;<span class="op" id="6004062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004066">return</span>&nbsp;<span class="ident" id="6004073">nil</span><span class="op" id="6004076">,</span>&nbsp;<span class="ident" id="6004078">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004093">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004140">sp</span>&nbsp;<span class="op" id="6004143">:=</span>&nbsp;<span class="builtinfunc" id="6004146">make</span><span class="op" id="6004150">(</span><span class="op" id="6004151">[</span><span class="op" id="6004152">]</span><span class="ident" id="6004153">sparseEntry</span><span class="op" id="6004164">,</span>&nbsp;<span class="num" id="6004166">0</span><span class="op" id="6004167">,</span>&nbsp;<span class="ident" id="6004169">numEntries</span><span class="op" id="6004179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004182">for</span>&nbsp;<span class="ident" id="6004186">i</span>&nbsp;<span class="op" id="6004188">:=</span>&nbsp;<span class="ident" id="6004191">int64</span><span class="op" id="6004196">(</span><span class="num" id="6004197">0</span><span class="op" id="6004198">)</span><span class="op" id="6004199">;</span>&nbsp;<span class="ident" id="6004201">i</span>&nbsp;<span class="op" id="6004203">&lt;</span>&nbsp;<span class="ident" id="6004205">numEntries</span><span class="op" id="6004215">;</span>&nbsp;<span class="ident" id="6004217">i</span><span class="op" id="6004218">++</span>&nbsp;<span class="op" id="6004221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004225">offset</span><span class="op" id="6004231">,</span>&nbsp;<span class="ident" id="6004233">err</span>&nbsp;<span class="op" id="6004237">:=</span>&nbsp;<span class="ident" id="6004240">strconv</span><span class="op" id="6004247">.</span><span class="ident" id="6004248">ParseInt</span><span class="op" id="6004256">(</span><span class="ident" id="6004257">sparseMap</span><span class="op" id="6004266">[</span><span class="num" id="6004267">2</span><span class="op" id="6004268">*</span><span class="ident" id="6004269">i</span><span class="op" id="6004270">]</span><span class="op" id="6004271">,</span>&nbsp;<span class="num" id="6004273">10</span><span class="op" id="6004275">,</span>&nbsp;<span class="num" id="6004277">0</span><span class="op" id="6004278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004282">if</span>&nbsp;<span class="ident" id="6004285">err</span>&nbsp;<span class="op" id="6004289">!=</span>&nbsp;<span class="ident" id="6004292">nil</span>&nbsp;<span class="op" id="6004296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004301">return</span>&nbsp;<span class="ident" id="6004308">nil</span><span class="op" id="6004311">,</span>&nbsp;<span class="ident" id="6004313">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004329">numBytes</span><span class="op" id="6004337">,</span>&nbsp;<span class="ident" id="6004339">err</span>&nbsp;<span class="op" id="6004343">:=</span>&nbsp;<span class="ident" id="6004346">strconv</span><span class="op" id="6004353">.</span><span class="ident" id="6004354">ParseInt</span><span class="op" id="6004362">(</span><span class="ident" id="6004363">sparseMap</span><span class="op" id="6004372">[</span><span class="num" id="6004373">2</span><span class="op" id="6004374">*</span><span class="ident" id="6004375">i</span><span class="op" id="6004376">+</span><span class="num" id="6004377">1</span><span class="op" id="6004378">]</span><span class="op" id="6004379">,</span>&nbsp;<span class="num" id="6004381">10</span><span class="op" id="6004383">,</span>&nbsp;<span class="num" id="6004385">0</span><span class="op" id="6004386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004390">if</span>&nbsp;<span class="ident" id="6004393">err</span>&nbsp;<span class="op" id="6004397">!=</span>&nbsp;<span class="ident" id="6004400">nil</span>&nbsp;<span class="op" id="6004404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004409">return</span>&nbsp;<span class="ident" id="6004416">nil</span><span class="op" id="6004419">,</span>&nbsp;<span class="ident" id="6004421">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004433">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004437">sp</span>&nbsp;<span class="op" id="6004440">=</span>&nbsp;<span class="builtinfunc" id="6004442">append</span><span class="op" id="6004448">(</span><span class="ident" id="6004449">sp</span><span class="op" id="6004451">,</span>&nbsp;<span class="ident" id="6004453">sparseEntry</span><span class="op" id="6004464">{</span><span class="ident" id="6004465">offset</span><span class="op" id="6004471">:</span>&nbsp;<span class="ident" id="6004473">offset</span><span class="op" id="6004479">,</span>&nbsp;<span class="ident" id="6004481">numBytes</span><span class="op" id="6004489">:</span>&nbsp;<span class="ident" id="6004491">numBytes</span><span class="op" id="6004499">}</span><span class="op" id="6004500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004507">return</span>&nbsp;<span class="ident" id="6004514">sp</span><span class="op" id="6004516">,</span>&nbsp;<span class="ident" id="6004518">nil</span><br>
<span class="lineno"></span><span class="op" id="6004522">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6004525">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6004606">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6004663">func</span>&nbsp;<span class="op" id="6004668">(</span><span class="ident" id="6004669">tr</span>&nbsp;<span class="op" id="6004672">*</span><span class="ident" id="6004673">Reader</span><span class="op" id="6004679">)</span>&nbsp;<span class="ident" id="6004681">numBytes</span><span class="op" id="6004689">(</span><span class="op" id="6004690">)</span>&nbsp;<span class="ident" id="6004692">int64</span>&nbsp;<span class="op" id="6004698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004701">if</span>&nbsp;<span class="ident" id="6004704">tr</span><span class="op" id="6004706">.</span><span class="ident" id="6004707">curr</span>&nbsp;<span class="op" id="6004712">==</span>&nbsp;<span class="ident" id="6004715">nil</span>&nbsp;<span class="op" id="6004719">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004723">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004757">return</span>&nbsp;<span class="num" id="6004764">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004770">return</span>&nbsp;<span class="ident" id="6004777">tr</span><span class="op" id="6004779">.</span><span class="ident" id="6004780">curr</span><span class="op" id="6004784">.</span><span class="ident" id="6004785">numBytes</span><span class="op" id="6004793">(</span><span class="op" id="6004794">)</span><br>
<span class="lineno"></span><span class="op" id="6004796">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6004799">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6004856">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6004919">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6004973">func</span>&nbsp;<span class="op" id="6004978">(</span><span class="ident" id="6004979">tr</span>&nbsp;<span class="op" id="6004982">*</span><span class="ident" id="6004983">Reader</span><span class="op" id="6004989">)</span>&nbsp;<span class="ident" id="6004991">Read</span><span class="op" id="6004995">(</span><span class="ident" id="6004996">b</span>&nbsp;<span class="op" id="6004998">[</span><span class="op" id="6004999">]</span><span class="builtintype" id="6005000">byte</span><span class="op" id="6005004">)</span>&nbsp;<span class="op" id="6005006">(</span><span class="ident" id="6005007">n</span>&nbsp;<span class="builtintype" id="6005009">int</span><span class="op" id="6005012">,</span>&nbsp;<span class="ident" id="6005014">err</span>&nbsp;<span class="builtintype" id="6005018">error</span><span class="op" id="6005023">)</span>&nbsp;<span class="op" id="6005025">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005028">if</span>&nbsp;<span class="ident" id="6005031">tr</span><span class="op" id="6005033">.</span><span class="ident" id="6005034">curr</span>&nbsp;<span class="op" id="6005039">==</span>&nbsp;<span class="ident" id="6005042">nil</span>&nbsp;<span class="op" id="6005046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005050">return</span>&nbsp;<span class="num" id="6005057">0</span><span class="op" id="6005058">,</span>&nbsp;<span class="ident" id="6005060">io</span><span class="op" id="6005062">.</span><span class="ident" id="6005063">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005071">n</span><span class="op" id="6005072">,</span>&nbsp;<span class="ident" id="6005074">err</span>&nbsp;<span class="op" id="6005078">=</span>&nbsp;<span class="ident" id="6005080">tr</span><span class="op" id="6005082">.</span><span class="ident" id="6005083">curr</span><span class="op" id="6005087">.</span><span class="ident" id="6005088">Read</span><span class="op" id="6005092">(</span><span class="ident" id="6005093">b</span><span class="op" id="6005094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005097">if</span>&nbsp;<span class="ident" id="6005100">err</span>&nbsp;<span class="op" id="6005104">!=</span>&nbsp;<span class="ident" id="6005107">nil</span>&nbsp;<span class="op" id="6005111">&amp;&amp;</span>&nbsp;<span class="ident" id="6005114">err</span>&nbsp;<span class="op" id="6005118">!=</span>&nbsp;<span class="ident" id="6005121">io</span><span class="op" id="6005123">.</span><span class="ident" id="6005124">EOF</span>&nbsp;<span class="op" id="6005128">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005132">tr</span><span class="op" id="6005134">.</span><span class="ident" id="6005135">err</span>&nbsp;<span class="op" id="6005139">=</span>&nbsp;<span class="ident" id="6005141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005149">return</span><br>
<span class="lineno"></span><span class="op" id="6005156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6005159">func</span>&nbsp;<span class="op" id="6005164">(</span><span class="ident" id="6005165">rfr</span>&nbsp;<span class="op" id="6005169">*</span><span class="ident" id="6005170">regFileReader</span><span class="op" id="6005183">)</span>&nbsp;<span class="ident" id="6005185">Read</span><span class="op" id="6005189">(</span><span class="ident" id="6005190">b</span>&nbsp;<span class="op" id="6005192">[</span><span class="op" id="6005193">]</span><span class="builtintype" id="6005194">byte</span><span class="op" id="6005198">)</span>&nbsp;<span class="op" id="6005200">(</span><span class="ident" id="6005201">n</span>&nbsp;<span class="builtintype" id="6005203">int</span><span class="op" id="6005206">,</span>&nbsp;<span class="ident" id="6005208">err</span>&nbsp;<span class="builtintype" id="6005212">error</span><span class="op" id="6005217">)</span>&nbsp;<span class="op" id="6005219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005222">if</span>&nbsp;<span class="ident" id="6005225">rfr</span><span class="op" id="6005228">.</span><span class="ident" id="6005229">nb</span>&nbsp;<span class="op" id="6005232">==</span>&nbsp;<span class="num" id="6005235">0</span>&nbsp;<span class="op" id="6005237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005241">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005260">return</span>&nbsp;<span class="num" id="6005267">0</span><span class="op" id="6005268">,</span>&nbsp;<span class="ident" id="6005270">io</span><span class="op" id="6005272">.</span><span class="ident" id="6005273">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005278">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005281">if</span>&nbsp;<span class="ident" id="6005284">int64</span><span class="op" id="6005289">(</span><span class="builtinfunc" id="6005290">len</span><span class="op" id="6005293">(</span><span class="ident" id="6005294">b</span><span class="op" id="6005295">)</span><span class="op" id="6005296">)</span>&nbsp;<span class="op" id="6005298">&gt;</span>&nbsp;<span class="ident" id="6005300">rfr</span><span class="op" id="6005303">.</span><span class="ident" id="6005304">nb</span>&nbsp;<span class="op" id="6005307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005311">b</span>&nbsp;<span class="op" id="6005313">=</span>&nbsp;<span class="ident" id="6005315">b</span><span class="op" id="6005316">[</span><span class="num" id="6005317">0</span><span class="op" id="6005318">:</span><span class="ident" id="6005319">rfr</span><span class="op" id="6005322">.</span><span class="ident" id="6005323">nb</span><span class="op" id="6005325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005331">n</span><span class="op" id="6005332">,</span>&nbsp;<span class="ident" id="6005334">err</span>&nbsp;<span class="op" id="6005338">=</span>&nbsp;<span class="ident" id="6005340">rfr</span><span class="op" id="6005343">.</span><span class="ident" id="6005344">r</span><span class="op" id="6005345">.</span><span class="ident" id="6005346">Read</span><span class="op" id="6005350">(</span><span class="ident" id="6005351">b</span><span class="op" id="6005352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005355">rfr</span><span class="op" id="6005358">.</span><span class="ident" id="6005359">nb</span>&nbsp;<span class="op" id="6005362">-=</span>&nbsp;<span class="ident" id="6005365">int64</span><span class="op" id="6005370">(</span><span class="ident" id="6005371">n</span><span class="op" id="6005372">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005376">if</span>&nbsp;<span class="ident" id="6005379">err</span>&nbsp;<span class="op" id="6005383">==</span>&nbsp;<span class="ident" id="6005386">io</span><span class="op" id="6005388">.</span><span class="ident" id="6005389">EOF</span>&nbsp;<span class="op" id="6005393">&amp;&amp;</span>&nbsp;<span class="ident" id="6005396">rfr</span><span class="op" id="6005399">.</span><span class="ident" id="6005400">nb</span>&nbsp;<span class="op" id="6005403">&gt;</span>&nbsp;<span class="num" id="6005405">0</span>&nbsp;<span class="op" id="6005407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005411">err</span>&nbsp;<span class="op" id="6005415">=</span>&nbsp;<span class="ident" id="6005417">io</span><span class="op" id="6005419">.</span><span class="ident" id="6005420">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005441">return</span><br>
<span class="lineno">755</span><span class="op" id="6005448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6005451">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6005543">func</span>&nbsp;<span class="op" id="6005548">(</span><span class="ident" id="6005549">rfr</span>&nbsp;<span class="op" id="6005553">*</span><span class="ident" id="6005554">regFileReader</span><span class="op" id="6005567">)</span>&nbsp;<span class="ident" id="6005569">numBytes</span><span class="op" id="6005577">(</span><span class="op" id="6005578">)</span>&nbsp;<span class="ident" id="6005580">int64</span>&nbsp;<span class="op" id="6005586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005589">return</span>&nbsp;<span class="ident" id="6005596">rfr</span><span class="op" id="6005599">.</span><span class="ident" id="6005600">nb</span><br>
<span class="lineno">760</span><span class="op" id="6005603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6005606">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6005669">func</span>&nbsp;<span class="op" id="6005674">(</span><span class="ident" id="6005675">sfr</span>&nbsp;<span class="op" id="6005679">*</span><span class="ident" id="6005680">sparseFileReader</span><span class="op" id="6005696">)</span>&nbsp;<span class="ident" id="6005698">readHole</span><span class="op" id="6005706">(</span><span class="ident" id="6005707">b</span>&nbsp;<span class="op" id="6005709">[</span><span class="op" id="6005710">]</span><span class="builtintype" id="6005711">byte</span><span class="op" id="6005715">,</span>&nbsp;<span class="ident" id="6005717">toOffset</span>&nbsp;<span class="ident" id="6005726">int64</span><span class="op" id="6005731">)</span>&nbsp;<span class="builtintype" id="6005733">int</span>&nbsp;<span class="op" id="6005737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005740">n64</span>&nbsp;<span class="op" id="6005744">:=</span>&nbsp;<span class="ident" id="6005747">toOffset</span>&nbsp;<span class="op" id="6005756">-</span>&nbsp;<span class="ident" id="6005758">sfr</span><span class="op" id="6005761">.</span><span class="ident" id="6005762">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005767">if</span>&nbsp;<span class="ident" id="6005770">n64</span>&nbsp;<span class="op" id="6005774">&gt;</span>&nbsp;<span class="ident" id="6005776">int64</span><span class="op" id="6005781">(</span><span class="builtinfunc" id="6005782">len</span><span class="op" id="6005785">(</span><span class="ident" id="6005786">b</span><span class="op" id="6005787">)</span><span class="op" id="6005788">)</span>&nbsp;<span class="op" id="6005790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005794">n64</span>&nbsp;<span class="op" id="6005798">=</span>&nbsp;<span class="ident" id="6005800">int64</span><span class="op" id="6005805">(</span><span class="builtinfunc" id="6005806">len</span><span class="op" id="6005809">(</span><span class="ident" id="6005810">b</span><span class="op" id="6005811">)</span><span class="op" id="6005812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005818">n</span>&nbsp;<span class="op" id="6005820">:=</span>&nbsp;<span class="builtintype" id="6005823">int</span><span class="op" id="6005826">(</span><span class="ident" id="6005827">n64</span><span class="op" id="6005830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005833">for</span>&nbsp;<span class="ident" id="6005837">i</span>&nbsp;<span class="op" id="6005839">:=</span>&nbsp;<span class="num" id="6005842">0</span><span class="op" id="6005843">;</span>&nbsp;<span class="ident" id="6005845">i</span>&nbsp;<span class="op" id="6005847">&lt;</span>&nbsp;<span class="ident" id="6005849">n</span><span class="op" id="6005850">;</span>&nbsp;<span class="ident" id="6005852">i</span><span class="op" id="6005853">++</span>&nbsp;<span class="op" id="6005856">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005860">b</span><span class="op" id="6005861">[</span><span class="ident" id="6005862">i</span><span class="op" id="6005863">]</span>&nbsp;<span class="op" id="6005865">=</span>&nbsp;<span class="num" id="6005867">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005873">sfr</span><span class="op" id="6005876">.</span><span class="ident" id="6005877">pos</span>&nbsp;<span class="op" id="6005881">+=</span>&nbsp;<span class="ident" id="6005884">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005889">return</span>&nbsp;<span class="ident" id="6005896">n</span><br>
<span class="lineno"></span><span class="op" id="6005898">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6005901">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6005954">func</span>&nbsp;<span class="op" id="6005959">(</span><span class="ident" id="6005960">sfr</span>&nbsp;<span class="op" id="6005964">*</span><span class="ident" id="6005965">sparseFileReader</span><span class="op" id="6005981">)</span>&nbsp;<span class="ident" id="6005983">Read</span><span class="op" id="6005987">(</span><span class="ident" id="6005988">b</span>&nbsp;<span class="op" id="6005990">[</span><span class="op" id="6005991">]</span><span class="builtintype" id="6005992">byte</span><span class="op" id="6005996">)</span>&nbsp;<span class="op" id="6005998">(</span><span class="ident" id="6005999">n</span>&nbsp;<span class="builtintype" id="6006001">int</span><span class="op" id="6006004">,</span>&nbsp;<span class="ident" id="6006006">err</span>&nbsp;<span class="builtintype" id="6006010">error</span><span class="op" id="6006015">)</span>&nbsp;<span class="op" id="6006017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006020">if</span>&nbsp;<span class="builtinfunc" id="6006023">len</span><span class="op" id="6006026">(</span><span class="ident" id="6006027">sfr</span><span class="op" id="6006030">.</span><span class="ident" id="6006031">sp</span><span class="op" id="6006033">)</span>&nbsp;<span class="op" id="6006035">==</span>&nbsp;<span class="num" id="6006038">0</span>&nbsp;<span class="op" id="6006040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006044">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006086">if</span>&nbsp;<span class="ident" id="6006089">sfr</span><span class="op" id="6006092">.</span><span class="ident" id="6006093">pos</span>&nbsp;<span class="op" id="6006097">&lt;</span>&nbsp;<span class="ident" id="6006099">sfr</span><span class="op" id="6006102">.</span><span class="ident" id="6006103">tot</span>&nbsp;<span class="op" id="6006107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006112">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006141">n</span>&nbsp;<span class="op" id="6006143">=</span>&nbsp;<span class="ident" id="6006145">sfr</span><span class="op" id="6006148">.</span><span class="ident" id="6006149">readHole</span><span class="op" id="6006157">(</span><span class="ident" id="6006158">b</span><span class="op" id="6006159">,</span>&nbsp;<span class="ident" id="6006161">sfr</span><span class="op" id="6006164">.</span><span class="ident" id="6006165">tot</span><span class="op" id="6006168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006182">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006186">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006231">return</span>&nbsp;<span class="num" id="6006238">0</span><span class="op" id="6006239">,</span>&nbsp;<span class="ident" id="6006241">io</span><span class="op" id="6006243">.</span><span class="ident" id="6006244">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006252">if</span>&nbsp;<span class="ident" id="6006255">sfr</span><span class="op" id="6006258">.</span><span class="ident" id="6006259">pos</span>&nbsp;<span class="op" id="6006263">&lt;</span>&nbsp;<span class="ident" id="6006265">sfr</span><span class="op" id="6006268">.</span><span class="ident" id="6006269">sp</span><span class="op" id="6006271">[</span><span class="num" id="6006272">0</span><span class="op" id="6006273">]</span><span class="op" id="6006274">.</span><span class="ident" id="6006275">offset</span>&nbsp;<span class="op" id="6006282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006286">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006307">n</span>&nbsp;<span class="op" id="6006309">=</span>&nbsp;<span class="ident" id="6006311">sfr</span><span class="op" id="6006314">.</span><span class="ident" id="6006315">readHole</span><span class="op" id="6006323">(</span><span class="ident" id="6006324">b</span><span class="op" id="6006325">,</span>&nbsp;<span class="ident" id="6006327">sfr</span><span class="op" id="6006330">.</span><span class="ident" id="6006331">sp</span><span class="op" id="6006333">[</span><span class="num" id="6006334">0</span><span class="op" id="6006335">]</span><span class="op" id="6006336">.</span><span class="ident" id="6006337">offset</span><span class="op" id="6006343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006347">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006359">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006426">posInFragment</span>&nbsp;<span class="op" id="6006440">:=</span>&nbsp;<span class="ident" id="6006443">sfr</span><span class="op" id="6006446">.</span><span class="ident" id="6006447">pos</span>&nbsp;<span class="op" id="6006451">-</span>&nbsp;<span class="ident" id="6006453">sfr</span><span class="op" id="6006456">.</span><span class="ident" id="6006457">sp</span><span class="op" id="6006459">[</span><span class="num" id="6006460">0</span><span class="op" id="6006461">]</span><span class="op" id="6006462">.</span><span class="ident" id="6006463">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006471">bytesLeft</span>&nbsp;<span class="op" id="6006481">:=</span>&nbsp;<span class="ident" id="6006484">sfr</span><span class="op" id="6006487">.</span><span class="ident" id="6006488">sp</span><span class="op" id="6006490">[</span><span class="num" id="6006491">0</span><span class="op" id="6006492">]</span><span class="op" id="6006493">.</span><span class="ident" id="6006494">numBytes</span>&nbsp;<span class="op" id="6006503">-</span>&nbsp;<span class="ident" id="6006505">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006520">if</span>&nbsp;<span class="ident" id="6006523">int64</span><span class="op" id="6006528">(</span><span class="builtinfunc" id="6006529">len</span><span class="op" id="6006532">(</span><span class="ident" id="6006533">b</span><span class="op" id="6006534">)</span><span class="op" id="6006535">)</span>&nbsp;<span class="op" id="6006537">&gt;</span>&nbsp;<span class="ident" id="6006539">bytesLeft</span>&nbsp;<span class="op" id="6006549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006553">b</span>&nbsp;<span class="op" id="6006555">=</span>&nbsp;<span class="ident" id="6006557">b</span><span class="op" id="6006558">[</span><span class="num" id="6006559">0</span><span class="op" id="6006560">:</span><span class="ident" id="6006561">bytesLeft</span><span class="op" id="6006570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006573">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006577">n</span><span class="op" id="6006578">,</span>&nbsp;<span class="ident" id="6006580">err</span>&nbsp;<span class="op" id="6006584">=</span>&nbsp;<span class="ident" id="6006586">sfr</span><span class="op" id="6006589">.</span><span class="ident" id="6006590">rfr</span><span class="op" id="6006593">.</span><span class="ident" id="6006594">Read</span><span class="op" id="6006598">(</span><span class="ident" id="6006599">b</span><span class="op" id="6006600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006603">sfr</span><span class="op" id="6006606">.</span><span class="ident" id="6006607">pos</span>&nbsp;<span class="op" id="6006611">+=</span>&nbsp;<span class="ident" id="6006614">int64</span><span class="op" id="6006619">(</span><span class="ident" id="6006620">n</span><span class="op" id="6006621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006625">if</span>&nbsp;<span class="ident" id="6006628">int64</span><span class="op" id="6006633">(</span><span class="ident" id="6006634">n</span><span class="op" id="6006635">)</span>&nbsp;<span class="op" id="6006637">==</span>&nbsp;<span class="ident" id="6006640">bytesLeft</span>&nbsp;<span class="op" id="6006650">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006654">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006689">sfr</span><span class="op" id="6006692">.</span><span class="ident" id="6006693">sp</span>&nbsp;<span class="op" id="6006696">=</span>&nbsp;<span class="ident" id="6006698">sfr</span><span class="op" id="6006701">.</span><span class="ident" id="6006702">sp</span><span class="op" id="6006704">[</span><span class="num" id="6006705">1</span><span class="op" id="6006706">:</span><span class="op" id="6006707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006714">if</span>&nbsp;<span class="ident" id="6006717">err</span>&nbsp;<span class="op" id="6006721">==</span>&nbsp;<span class="ident" id="6006724">io</span><span class="op" id="6006726">.</span><span class="ident" id="6006727">EOF</span>&nbsp;<span class="op" id="6006731">&amp;&amp;</span>&nbsp;<span class="ident" id="6006734">sfr</span><span class="op" id="6006737">.</span><span class="ident" id="6006738">pos</span>&nbsp;<span class="op" id="6006742">&lt;</span>&nbsp;<span class="ident" id="6006744">sfr</span><span class="op" id="6006747">.</span><span class="ident" id="6006748">tot</span>&nbsp;<span class="op" id="6006752">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006756">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006834">err</span>&nbsp;<span class="op" id="6006838">=</span>&nbsp;<span class="ident" id="6006840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006848">return</span><br>
<span class="lineno"></span><span class="op" id="6006855">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6006858">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6006932">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6006975">func</span>&nbsp;<span class="op" id="6006980">(</span><span class="ident" id="6006981">sfr</span>&nbsp;<span class="op" id="6006985">*</span><span class="ident" id="6006986">sparseFileReader</span><span class="op" id="6007002">)</span>&nbsp;<span class="ident" id="6007004">numBytes</span><span class="op" id="6007012">(</span><span class="op" id="6007013">)</span>&nbsp;<span class="ident" id="6007015">int64</span>&nbsp;<span class="op" id="6007021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007024">return</span>&nbsp;<span class="ident" id="6007031">sfr</span><span class="op" id="6007034">.</span><span class="ident" id="6007035">rfr</span><span class="op" id="6007038">.</span><span class="ident" id="6007039">nb</span><br>
<span class="lineno">820</span><span class="op" id="6007042">}</span>
</div>
</body>
</html>
