<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7239192">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7239247">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7239301">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7239352">package</span>&nbsp;<span class="ident" id="7239360">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7239365">import</span>&nbsp;<span class="op" id="7239372">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239375">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239384">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239400">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239414">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239429">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239445">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239452">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239458">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239465">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239471">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239482">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239499">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239510">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7239521">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7239528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7239531">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7239606">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7239622">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7239699">type</span>&nbsp;<span class="ident" id="7239704">blockingSource</span>&nbsp;<span class="keyword" id="7239719">chan</span>&nbsp;<span class="builtintype" id="7239724">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7239730">func</span>&nbsp;<span class="op" id="7239735">(</span><span class="ident" id="7239736">b</span>&nbsp;<span class="ident" id="7239738">blockingSource</span><span class="op" id="7239752">)</span>&nbsp;<span class="ident" id="7239754">Read</span><span class="op" id="7239758">(</span><span class="op" id="7239759">[</span><span class="op" id="7239760">]</span><span class="builtintype" id="7239761">byte</span><span class="op" id="7239765">)</span>&nbsp;<span class="op" id="7239767">(</span><span class="ident" id="7239768">n</span>&nbsp;<span class="builtintype" id="7239770">int</span><span class="op" id="7239773">,</span>&nbsp;<span class="ident" id="7239775">err</span>&nbsp;<span class="builtintype" id="7239779">error</span><span class="op" id="7239784">)</span>&nbsp;<span class="op" id="7239786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7239789">&lt;-</span><span class="ident" id="7239791">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7239794">return</span>&nbsp;<span class="num" id="7239801">0</span><span class="op" id="7239802">,</span>&nbsp;<span class="ident" id="7239804">io</span><span class="op" id="7239806">.</span><span class="ident" id="7239807">EOF</span><br>
<span class="lineno"></span><span class="op" id="7239811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7239814">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7239894">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7239913">type</span>&nbsp;<span class="ident" id="7239918">clientTest</span>&nbsp;<span class="keyword" id="7239929">struct</span>&nbsp;<span class="op" id="7239936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7239939">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240012">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240053">name</span>&nbsp;<span class="builtintype" id="7240058">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240066">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240132">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240177">command</span>&nbsp;<span class="op" id="7240185">[</span><span class="op" id="7240186">]</span><span class="builtintype" id="7240187">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240195">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240266">config</span>&nbsp;<span class="op" id="7240273">*</span><span class="ident" id="7240274">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240282">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240349">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240371">cert</span>&nbsp;<span class="op" id="7240376">[</span><span class="op" id="7240377">]</span><span class="builtintype" id="7240378">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240384">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240442">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240515">key</span>&nbsp;<span class="keyword" id="7240519">interface</span><span class="op" id="7240528">{</span><span class="op" id="7240529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240532">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240601">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7240671">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7240721">validate</span>&nbsp;<span class="keyword" id="7240730">func</span><span class="op" id="7240734">(</span><span class="ident" id="7240735">ConnectionState</span><span class="op" id="7240750">)</span>&nbsp;<span class="builtintype" id="7240752">error</span><br>
<span class="lineno"></span><span class="op" id="7240758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7240761">var</span>&nbsp;<span class="ident" id="7240765">defaultServerCommand</span>&nbsp;<span class="op" id="7240786">=</span>&nbsp;<span class="op" id="7240788">[</span><span class="op" id="7240789">]</span><span class="builtintype" id="7240790">string</span><span class="op" id="7240796">{</span><span class="string" id="7240797">&#34;openssl&#34;</span><span class="op" id="7240806">,</span>&nbsp;<span class="string" id="7240808">&#34;s_server&#34;</span><span class="op" id="7240818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7240821">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7240896">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7240971">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7241050">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7241072">func</span>&nbsp;<span class="op" id="7241077">(</span><span class="ident" id="7241078">test</span>&nbsp;<span class="op" id="7241083">*</span><span class="ident" id="7241084">clientTest</span><span class="op" id="7241094">)</span>&nbsp;<span class="ident" id="7241096">connFromCommand</span><span class="op" id="7241111">(</span><span class="op" id="7241112">)</span>&nbsp;<span class="op" id="7241114">(</span><span class="ident" id="7241115">conn</span>&nbsp;<span class="op" id="7241120">*</span><span class="ident" id="7241121">recordingConn</span><span class="op" id="7241134">,</span>&nbsp;<span class="ident" id="7241136">child</span>&nbsp;<span class="op" id="7241142">*</span><span class="ident" id="7241143">exec</span><span class="op" id="7241147">.</span><span class="ident" id="7241148">Cmd</span><span class="op" id="7241151">,</span>&nbsp;<span class="ident" id="7241153">stdin</span>&nbsp;<span class="ident" id="7241159">blockingSource</span><span class="op" id="7241173">,</span>&nbsp;<span class="ident" id="7241175">err</span>&nbsp;<span class="builtintype" id="7241179">error</span><span class="op" id="7241184">)</span>&nbsp;<span class="op" id="7241186">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241189">cert</span>&nbsp;<span class="op" id="7241194">:=</span>&nbsp;<span class="ident" id="7241197">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241217">if</span>&nbsp;<span class="builtinfunc" id="7241220">len</span><span class="op" id="7241223">(</span><span class="ident" id="7241224">test</span><span class="op" id="7241228">.</span><span class="ident" id="7241229">cert</span><span class="op" id="7241233">)</span>&nbsp;<span class="op" id="7241235">&gt;</span>&nbsp;<span class="num" id="7241237">0</span>&nbsp;<span class="op" id="7241239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241243">cert</span>&nbsp;<span class="op" id="7241248">=</span>&nbsp;<span class="ident" id="7241250">test</span><span class="op" id="7241254">.</span><span class="ident" id="7241255">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7241261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241264">certPath</span>&nbsp;<span class="op" id="7241273">:=</span>&nbsp;<span class="ident" id="7241276">tempFile</span><span class="op" id="7241284">(</span><span class="builtintype" id="7241285">string</span><span class="op" id="7241291">(</span><span class="ident" id="7241292">cert</span><span class="op" id="7241296">)</span><span class="op" id="7241297">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241300">defer</span>&nbsp;<span class="ident" id="7241306">os</span><span class="op" id="7241308">.</span><span class="ident" id="7241309">Remove</span><span class="op" id="7241315">(</span><span class="ident" id="7241316">certPath</span><span class="op" id="7241324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241328">var</span>&nbsp;<span class="ident" id="7241332">key</span>&nbsp;<span class="keyword" id="7241336">interface</span><span class="op" id="7241345">{</span><span class="op" id="7241346">}</span>&nbsp;<span class="op" id="7241348">=</span>&nbsp;<span class="ident" id="7241350">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241369">if</span>&nbsp;<span class="ident" id="7241372">test</span><span class="op" id="7241376">.</span><span class="ident" id="7241377">key</span>&nbsp;<span class="op" id="7241381">!=</span>&nbsp;<span class="ident" id="7241384">nil</span>&nbsp;<span class="op" id="7241388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241392">key</span>&nbsp;<span class="op" id="7241396">=</span>&nbsp;<span class="ident" id="7241398">test</span><span class="op" id="7241402">.</span><span class="ident" id="7241403">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7241408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241411">var</span>&nbsp;<span class="ident" id="7241415">pemType</span>&nbsp;<span class="builtintype" id="7241423">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241431">var</span>&nbsp;<span class="ident" id="7241435">derBytes</span>&nbsp;<span class="op" id="7241444">[</span><span class="op" id="7241445">]</span><span class="builtintype" id="7241446">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241452">switch</span>&nbsp;<span class="ident" id="7241459">key</span>&nbsp;<span class="op" id="7241463">:=</span>&nbsp;<span class="ident" id="7241466">key</span><span class="op" id="7241469">.</span><span class="op" id="7241470">(</span><span class="keyword" id="7241471">type</span><span class="op" id="7241475">)</span>&nbsp;<span class="op" id="7241477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241480">case</span>&nbsp;<span class="op" id="7241485">*</span><span class="ident" id="7241486">rsa</span><span class="op" id="7241489">.</span><span class="ident" id="7241490">PrivateKey</span><span class="op" id="7241500">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241504">pemType</span>&nbsp;<span class="op" id="7241512">=</span>&nbsp;<span class="string" id="7241514">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241522">derBytes</span>&nbsp;<span class="op" id="7241531">=</span>&nbsp;<span class="ident" id="7241533">x509</span><span class="op" id="7241537">.</span><span class="ident" id="7241538">MarshalPKCS1PrivateKey</span><span class="op" id="7241560">(</span><span class="ident" id="7241561">key</span><span class="op" id="7241564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241567">case</span>&nbsp;<span class="op" id="7241572">*</span><span class="ident" id="7241573">ecdsa</span><span class="op" id="7241578">.</span><span class="ident" id="7241579">PrivateKey</span><span class="op" id="7241589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241593">pemType</span>&nbsp;<span class="op" id="7241601">=</span>&nbsp;<span class="string" id="7241603">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241610">var</span>&nbsp;<span class="ident" id="7241614">err</span>&nbsp;<span class="builtintype" id="7241618">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241626">derBytes</span><span class="op" id="7241634">,</span>&nbsp;<span class="ident" id="7241636">err</span>&nbsp;<span class="op" id="7241640">=</span>&nbsp;<span class="ident" id="7241642">x509</span><span class="op" id="7241646">.</span><span class="ident" id="7241647">MarshalECPrivateKey</span><span class="op" id="7241666">(</span><span class="ident" id="7241667">key</span><span class="op" id="7241670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241674">if</span>&nbsp;<span class="ident" id="7241677">err</span>&nbsp;<span class="op" id="7241681">!=</span>&nbsp;<span class="ident" id="7241684">nil</span>&nbsp;<span class="op" id="7241688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7241693">panic</span><span class="op" id="7241698">(</span><span class="ident" id="7241699">err</span><span class="op" id="7241702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7241706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241709">default</span><span class="op" id="7241716">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7241720">panic</span><span class="op" id="7241725">(</span><span class="string" id="7241726">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7241744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7241747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241751">var</span>&nbsp;<span class="ident" id="7241755">pemOut</span>&nbsp;<span class="ident" id="7241762">bytes</span><span class="op" id="7241767">.</span><span class="ident" id="7241768">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241776">pem</span><span class="op" id="7241779">.</span><span class="ident" id="7241780">Encode</span><span class="op" id="7241786">(</span><span class="op" id="7241787">&amp;</span><span class="ident" id="7241788">pemOut</span><span class="op" id="7241794">,</span>&nbsp;<span class="op" id="7241796">&amp;</span><span class="ident" id="7241797">pem</span><span class="op" id="7241800">.</span><span class="ident" id="7241801">Block</span><span class="op" id="7241806">{</span><span class="ident" id="7241807">Type</span><span class="op" id="7241811">:</span>&nbsp;<span class="ident" id="7241813">pemType</span>&nbsp;<span class="op" id="7241821">+</span>&nbsp;<span class="string" id="7241823">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7241837">,</span>&nbsp;<span class="ident" id="7241839">Bytes</span><span class="op" id="7241844">:</span>&nbsp;<span class="ident" id="7241846">derBytes</span><span class="op" id="7241854">}</span><span class="op" id="7241855">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241859">keyPath</span>&nbsp;<span class="op" id="7241867">:=</span>&nbsp;<span class="ident" id="7241870">tempFile</span><span class="op" id="7241878">(</span><span class="builtintype" id="7241879">string</span><span class="op" id="7241885">(</span><span class="ident" id="7241886">pemOut</span><span class="op" id="7241892">.</span><span class="ident" id="7241893">Bytes</span><span class="op" id="7241898">(</span><span class="op" id="7241899">)</span><span class="op" id="7241900">)</span><span class="op" id="7241901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241904">defer</span>&nbsp;<span class="ident" id="7241910">os</span><span class="op" id="7241912">.</span><span class="ident" id="7241913">Remove</span><span class="op" id="7241919">(</span><span class="ident" id="7241920">keyPath</span><span class="op" id="7241927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241931">var</span>&nbsp;<span class="ident" id="7241935">command</span>&nbsp;<span class="op" id="7241943">[</span><span class="op" id="7241944">]</span><span class="builtintype" id="7241945">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7241953">if</span>&nbsp;<span class="builtinfunc" id="7241956">len</span><span class="op" id="7241959">(</span><span class="ident" id="7241960">test</span><span class="op" id="7241964">.</span><span class="ident" id="7241965">command</span><span class="op" id="7241972">)</span>&nbsp;<span class="op" id="7241974">&gt;</span>&nbsp;<span class="num" id="7241976">0</span>&nbsp;<span class="op" id="7241978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7241982">command</span>&nbsp;<span class="op" id="7241990">=</span>&nbsp;<span class="builtinfunc" id="7241992">append</span><span class="op" id="7241998">(</span><span class="ident" id="7241999">command</span><span class="op" id="7242006">,</span>&nbsp;<span class="ident" id="7242008">test</span><span class="op" id="7242012">.</span><span class="ident" id="7242013">command</span><span class="op" id="7242020">...</span><span class="op" id="7242023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7242026">}</span>&nbsp;<span class="keyword" id="7242028">else</span>&nbsp;<span class="op" id="7242033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242037">command</span>&nbsp;<span class="op" id="7242045">=</span>&nbsp;<span class="builtinfunc" id="7242047">append</span><span class="op" id="7242053">(</span><span class="ident" id="7242054">command</span><span class="op" id="7242061">,</span>&nbsp;<span class="ident" id="7242063">defaultServerCommand</span><span class="op" id="7242083">...</span><span class="op" id="7242086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7242089">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242092">command</span>&nbsp;<span class="op" id="7242100">=</span>&nbsp;<span class="builtinfunc" id="7242102">append</span><span class="op" id="7242108">(</span><span class="ident" id="7242109">command</span><span class="op" id="7242116">,</span>&nbsp;<span class="string" id="7242118">&#34;-cert&#34;</span><span class="op" id="7242125">,</span>&nbsp;<span class="ident" id="7242127">certPath</span><span class="op" id="7242135">,</span>&nbsp;<span class="string" id="7242137">&#34;-certform&#34;</span><span class="op" id="7242148">,</span>&nbsp;<span class="string" id="7242150">&#34;DER&#34;</span><span class="op" id="7242155">,</span>&nbsp;<span class="string" id="7242157">&#34;-key&#34;</span><span class="op" id="7242163">,</span>&nbsp;<span class="ident" id="7242165">keyPath</span><span class="op" id="7242172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242175">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242245">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242316">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242385">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242454">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7242484">const</span>&nbsp;<span class="ident" id="7242490">serverPort</span>&nbsp;<span class="op" id="7242501">=</span>&nbsp;<span class="num" id="7242503">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242510">command</span>&nbsp;<span class="op" id="7242518">=</span>&nbsp;<span class="builtinfunc" id="7242520">append</span><span class="op" id="7242526">(</span><span class="ident" id="7242527">command</span><span class="op" id="7242534">,</span>&nbsp;<span class="string" id="7242536">&#34;-accept&#34;</span><span class="op" id="7242545">,</span>&nbsp;<span class="ident" id="7242547">strconv</span><span class="op" id="7242554">.</span><span class="ident" id="7242555">Itoa</span><span class="op" id="7242559">(</span><span class="ident" id="7242560">serverPort</span><span class="op" id="7242570">)</span><span class="op" id="7242571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242575">cmd</span>&nbsp;<span class="op" id="7242579">:=</span>&nbsp;<span class="ident" id="7242582">exec</span><span class="op" id="7242586">.</span><span class="ident" id="7242587">Command</span><span class="op" id="7242594">(</span><span class="ident" id="7242595">command</span><span class="op" id="7242602">[</span><span class="num" id="7242603">0</span><span class="op" id="7242604">]</span><span class="op" id="7242605">,</span>&nbsp;<span class="ident" id="7242607">command</span><span class="op" id="7242614">[</span><span class="num" id="7242615">1</span><span class="op" id="7242616">:</span><span class="op" id="7242617">]</span><span class="op" id="7242618">...</span><span class="op" id="7242621">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242624">stdin</span>&nbsp;<span class="op" id="7242630">=</span>&nbsp;<span class="ident" id="7242632">blockingSource</span><span class="op" id="7242646">(</span><span class="builtinfunc" id="7242647">make</span><span class="op" id="7242651">(</span><span class="keyword" id="7242652">chan</span>&nbsp;<span class="builtintype" id="7242657">bool</span><span class="op" id="7242661">)</span><span class="op" id="7242662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242665">cmd</span><span class="op" id="7242668">.</span><span class="ident" id="7242669">Stdin</span>&nbsp;<span class="op" id="7242675">=</span>&nbsp;<span class="ident" id="7242677">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7242684">var</span>&nbsp;<span class="ident" id="7242688">out</span>&nbsp;<span class="ident" id="7242692">bytes</span><span class="op" id="7242697">.</span><span class="ident" id="7242698">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242706">cmd</span><span class="op" id="7242709">.</span><span class="ident" id="7242710">Stdout</span>&nbsp;<span class="op" id="7242717">=</span>&nbsp;<span class="op" id="7242719">&amp;</span><span class="ident" id="7242720">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7242725">cmd</span><span class="op" id="7242728">.</span><span class="ident" id="7242729">Stderr</span>&nbsp;<span class="op" id="7242736">=</span>&nbsp;<span class="op" id="7242738">&amp;</span><span class="ident" id="7242739">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7242744">if</span>&nbsp;<span class="ident" id="7242747">err</span>&nbsp;<span class="op" id="7242751">:=</span>&nbsp;<span class="ident" id="7242754">cmd</span><span class="op" id="7242757">.</span><span class="ident" id="7242758">Start</span><span class="op" id="7242763">(</span><span class="op" id="7242764">)</span><span class="op" id="7242765">;</span>&nbsp;<span class="ident" id="7242767">err</span>&nbsp;<span class="op" id="7242771">!=</span>&nbsp;<span class="ident" id="7242774">nil</span>&nbsp;<span class="op" id="7242778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7242782">return</span>&nbsp;<span class="ident" id="7242789">nil</span><span class="op" id="7242792">,</span>&nbsp;<span class="ident" id="7242794">nil</span><span class="op" id="7242797">,</span>&nbsp;<span class="ident" id="7242799">nil</span><span class="op" id="7242802">,</span>&nbsp;<span class="ident" id="7242804">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7242809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242813">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242880">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7242952">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7243021">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243037">var</span>&nbsp;<span class="ident" id="7243041">tcpConn</span>&nbsp;<span class="ident" id="7243049">net</span><span class="op" id="7243052">.</span><span class="ident" id="7243053">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243059">for</span>&nbsp;<span class="ident" id="7243063">i</span>&nbsp;<span class="op" id="7243065">:=</span>&nbsp;<span class="builtintype" id="7243068">uint</span><span class="op" id="7243072">(</span><span class="num" id="7243073">0</span><span class="op" id="7243074">)</span><span class="op" id="7243075">;</span>&nbsp;<span class="ident" id="7243077">i</span>&nbsp;<span class="op" id="7243079">&lt;</span>&nbsp;<span class="num" id="7243081">5</span><span class="op" id="7243082">;</span>&nbsp;<span class="ident" id="7243084">i</span><span class="op" id="7243085">++</span>&nbsp;<span class="op" id="7243088">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243092">var</span>&nbsp;<span class="ident" id="7243096">err</span>&nbsp;<span class="builtintype" id="7243100">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243108">tcpConn</span><span class="op" id="7243115">,</span>&nbsp;<span class="ident" id="7243117">err</span>&nbsp;<span class="op" id="7243121">=</span>&nbsp;<span class="ident" id="7243123">net</span><span class="op" id="7243126">.</span><span class="ident" id="7243127">DialTCP</span><span class="op" id="7243134">(</span><span class="string" id="7243135">&#34;tcp&#34;</span><span class="op" id="7243140">,</span>&nbsp;<span class="ident" id="7243142">nil</span><span class="op" id="7243145">,</span>&nbsp;<span class="op" id="7243147">&amp;</span><span class="ident" id="7243148">net</span><span class="op" id="7243151">.</span><span class="ident" id="7243152">TCPAddr</span><span class="op" id="7243159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243164">IP</span><span class="op" id="7243166">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7243170">net</span><span class="op" id="7243173">.</span><span class="ident" id="7243174">IPv4</span><span class="op" id="7243178">(</span><span class="num" id="7243179">127</span><span class="op" id="7243182">,</span>&nbsp;<span class="num" id="7243184">0</span><span class="op" id="7243185">,</span>&nbsp;<span class="num" id="7243187">0</span><span class="op" id="7243188">,</span>&nbsp;<span class="num" id="7243190">1</span><span class="op" id="7243191">)</span><span class="op" id="7243192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243197">Port</span><span class="op" id="7243201">:</span>&nbsp;<span class="ident" id="7243203">serverPort</span><span class="op" id="7243213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243217">}</span><span class="op" id="7243218">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243222">if</span>&nbsp;<span class="ident" id="7243225">err</span>&nbsp;<span class="op" id="7243229">==</span>&nbsp;<span class="ident" id="7243232">nil</span>&nbsp;<span class="op" id="7243236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243241">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243253">time</span><span class="op" id="7243257">.</span><span class="ident" id="7243258">Sleep</span><span class="op" id="7243263">(</span><span class="op" id="7243264">(</span><span class="num" id="7243265">1</span>&nbsp;<span class="op" id="7243267">&lt;&lt;</span>&nbsp;<span class="ident" id="7243270">i</span><span class="op" id="7243271">)</span>&nbsp;<span class="op" id="7243273">*</span>&nbsp;<span class="num" id="7243275">5</span>&nbsp;<span class="op" id="7243277">*</span>&nbsp;<span class="ident" id="7243279">time</span><span class="op" id="7243283">.</span><span class="ident" id="7243284">Millisecond</span><span class="op" id="7243295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243298">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243301">if</span>&nbsp;<span class="ident" id="7243304">tcpConn</span>&nbsp;<span class="op" id="7243312">==</span>&nbsp;<span class="ident" id="7243315">nil</span>&nbsp;<span class="op" id="7243319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7243323">close</span><span class="op" id="7243328">(</span><span class="ident" id="7243329">stdin</span><span class="op" id="7243334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243338">out</span><span class="op" id="7243341">.</span><span class="ident" id="7243342">WriteTo</span><span class="op" id="7243349">(</span><span class="ident" id="7243350">os</span><span class="op" id="7243352">.</span><span class="ident" id="7243353">Stdout</span><span class="op" id="7243359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243363">cmd</span><span class="op" id="7243366">.</span><span class="ident" id="7243367">Process</span><span class="op" id="7243374">.</span><span class="ident" id="7243375">Kill</span><span class="op" id="7243379">(</span><span class="op" id="7243380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243384">return</span>&nbsp;<span class="ident" id="7243391">nil</span><span class="op" id="7243394">,</span>&nbsp;<span class="ident" id="7243396">nil</span><span class="op" id="7243399">,</span>&nbsp;<span class="ident" id="7243401">nil</span><span class="op" id="7243404">,</span>&nbsp;<span class="ident" id="7243406">cmd</span><span class="op" id="7243409">.</span><span class="ident" id="7243410">Wait</span><span class="op" id="7243414">(</span><span class="op" id="7243415">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243422">record</span>&nbsp;<span class="op" id="7243429">:=</span>&nbsp;<span class="op" id="7243432">&amp;</span><span class="ident" id="7243433">recordingConn</span><span class="op" id="7243446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243450">Conn</span><span class="op" id="7243454">:</span>&nbsp;<span class="ident" id="7243456">tcpConn</span><span class="op" id="7243463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243466">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243470">return</span>&nbsp;<span class="ident" id="7243477">record</span><span class="op" id="7243483">,</span>&nbsp;<span class="ident" id="7243485">cmd</span><span class="op" id="7243488">,</span>&nbsp;<span class="ident" id="7243490">stdin</span><span class="op" id="7243495">,</span>&nbsp;<span class="ident" id="7243497">nil</span><br>
<span class="lineno"></span><span class="op" id="7243501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243504">func</span>&nbsp;<span class="op" id="7243509">(</span><span class="ident" id="7243510">test</span>&nbsp;<span class="op" id="7243515">*</span><span class="ident" id="7243516">clientTest</span><span class="op" id="7243526">)</span>&nbsp;<span class="ident" id="7243528">dataPath</span><span class="op" id="7243536">(</span><span class="op" id="7243537">)</span>&nbsp;<span class="builtintype" id="7243539">string</span>&nbsp;<span class="op" id="7243546">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243549">return</span>&nbsp;<span class="ident" id="7243556">filepath</span><span class="op" id="7243564">.</span><span class="ident" id="7243565">Join</span><span class="op" id="7243569">(</span><span class="string" id="7243570">&#34;testdata&#34;</span><span class="op" id="7243580">,</span>&nbsp;<span class="string" id="7243582">&#34;Client-&#34;</span><span class="op" id="7243591">+</span><span class="ident" id="7243592">test</span><span class="op" id="7243596">.</span><span class="ident" id="7243597">name</span><span class="op" id="7243601">)</span><br>
<span class="lineno"></span><span class="op" id="7243603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243606">func</span>&nbsp;<span class="op" id="7243611">(</span><span class="ident" id="7243612">test</span>&nbsp;<span class="op" id="7243617">*</span><span class="ident" id="7243618">clientTest</span><span class="op" id="7243628">)</span>&nbsp;<span class="ident" id="7243630">loadData</span><span class="op" id="7243638">(</span><span class="op" id="7243639">)</span>&nbsp;<span class="op" id="7243641">(</span><span class="ident" id="7243642">flows</span>&nbsp;<span class="op" id="7243648">[</span><span class="op" id="7243649">]</span><span class="op" id="7243650">[</span><span class="op" id="7243651">]</span><span class="builtintype" id="7243652">byte</span><span class="op" id="7243656">,</span>&nbsp;<span class="ident" id="7243658">err</span>&nbsp;<span class="builtintype" id="7243662">error</span><span class="op" id="7243667">)</span>&nbsp;<span class="op" id="7243669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7243672">in</span><span class="op" id="7243674">,</span>&nbsp;<span class="ident" id="7243676">err</span>&nbsp;<span class="op" id="7243680">:=</span>&nbsp;<span class="ident" id="7243683">os</span><span class="op" id="7243685">.</span><span class="ident" id="7243686">Open</span><span class="op" id="7243690">(</span><span class="ident" id="7243691">test</span><span class="op" id="7243695">.</span><span class="ident" id="7243696">dataPath</span><span class="op" id="7243704">(</span><span class="op" id="7243705">)</span><span class="op" id="7243706">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243709">if</span>&nbsp;<span class="ident" id="7243712">err</span>&nbsp;<span class="op" id="7243716">!=</span>&nbsp;<span class="ident" id="7243719">nil</span>&nbsp;<span class="op" id="7243723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243727">return</span>&nbsp;<span class="ident" id="7243734">nil</span><span class="op" id="7243737">,</span>&nbsp;<span class="ident" id="7243739">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7243744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243747">defer</span>&nbsp;<span class="ident" id="7243753">in</span><span class="op" id="7243755">.</span><span class="ident" id="7243756">Close</span><span class="op" id="7243761">(</span><span class="op" id="7243762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243765">return</span>&nbsp;<span class="ident" id="7243772">parseTestData</span><span class="op" id="7243785">(</span><span class="ident" id="7243786">in</span><span class="op" id="7243788">)</span><br>
<span class="lineno">165</span><span class="op" id="7243790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243793">func</span>&nbsp;<span class="op" id="7243798">(</span><span class="ident" id="7243799">test</span>&nbsp;<span class="op" id="7243804">*</span><span class="ident" id="7243805">clientTest</span><span class="op" id="7243815">)</span>&nbsp;<span class="ident" id="7243817">run</span><span class="op" id="7243820">(</span><span class="ident" id="7243821">t</span>&nbsp;<span class="op" id="7243823">*</span><span class="ident" id="7243824">testing</span><span class="op" id="7243831">.</span><span class="ident" id="7243832">T</span><span class="op" id="7243833">,</span>&nbsp;<span class="ident" id="7243835">write</span>&nbsp;<span class="builtintype" id="7243841">bool</span><span class="op" id="7243845">)</span>&nbsp;<span class="op" id="7243847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243850">var</span>&nbsp;<span class="ident" id="7243854">clientConn</span><span class="op" id="7243864">,</span>&nbsp;<span class="ident" id="7243866">serverConn</span>&nbsp;<span class="ident" id="7243877">net</span><span class="op" id="7243880">.</span><span class="ident" id="7243881">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243887">var</span>&nbsp;<span class="ident" id="7243891">recordingConn</span>&nbsp;<span class="op" id="7243905">*</span><span class="ident" id="7243906">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243921">var</span>&nbsp;<span class="ident" id="7243925">childProcess</span>&nbsp;<span class="op" id="7243938">*</span><span class="ident" id="7243939">exec</span><span class="op" id="7243943">.</span><span class="ident" id="7243944">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243949">var</span>&nbsp;<span class="ident" id="7243953">stdin</span>&nbsp;<span class="ident" id="7243959">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243976">if</span>&nbsp;<span class="ident" id="7243979">write</span>&nbsp;<span class="op" id="7243985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7243989">var</span>&nbsp;<span class="ident" id="7243993">err</span>&nbsp;<span class="builtintype" id="7243997">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244005">recordingConn</span><span class="op" id="7244018">,</span>&nbsp;<span class="ident" id="7244020">childProcess</span><span class="op" id="7244032">,</span>&nbsp;<span class="ident" id="7244034">stdin</span><span class="op" id="7244039">,</span>&nbsp;<span class="ident" id="7244041">err</span>&nbsp;<span class="op" id="7244045">=</span>&nbsp;<span class="ident" id="7244047">test</span><span class="op" id="7244051">.</span><span class="ident" id="7244052">connFromCommand</span><span class="op" id="7244067">(</span><span class="op" id="7244068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244072">if</span>&nbsp;<span class="ident" id="7244075">err</span>&nbsp;<span class="op" id="7244079">!=</span>&nbsp;<span class="ident" id="7244082">nil</span>&nbsp;<span class="op" id="7244086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244091">t</span><span class="op" id="7244092">.</span><span class="ident" id="7244093">Fatalf</span><span class="op" id="7244099">(</span><span class="string" id="7244100">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7244132">,</span>&nbsp;<span class="ident" id="7244134">err</span><span class="op" id="7244137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244145">clientConn</span>&nbsp;<span class="op" id="7244156">=</span>&nbsp;<span class="ident" id="7244158">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244173">}</span>&nbsp;<span class="keyword" id="7244175">else</span>&nbsp;<span class="op" id="7244180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244184">clientConn</span><span class="op" id="7244194">,</span>&nbsp;<span class="ident" id="7244196">serverConn</span>&nbsp;<span class="op" id="7244207">=</span>&nbsp;<span class="ident" id="7244209">net</span><span class="op" id="7244212">.</span><span class="ident" id="7244213">Pipe</span><span class="op" id="7244217">(</span><span class="op" id="7244218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244225">config</span>&nbsp;<span class="op" id="7244232">:=</span>&nbsp;<span class="ident" id="7244235">test</span><span class="op" id="7244239">.</span><span class="ident" id="7244240">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244248">if</span>&nbsp;<span class="ident" id="7244251">config</span>&nbsp;<span class="op" id="7244258">==</span>&nbsp;<span class="ident" id="7244261">nil</span>&nbsp;<span class="op" id="7244265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244269">config</span>&nbsp;<span class="op" id="7244276">=</span>&nbsp;<span class="ident" id="7244278">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244293">client</span>&nbsp;<span class="op" id="7244300">:=</span>&nbsp;<span class="ident" id="7244303">Client</span><span class="op" id="7244309">(</span><span class="ident" id="7244310">clientConn</span><span class="op" id="7244320">,</span>&nbsp;<span class="ident" id="7244322">config</span><span class="op" id="7244328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244332">doneChan</span>&nbsp;<span class="op" id="7244341">:=</span>&nbsp;<span class="builtinfunc" id="7244344">make</span><span class="op" id="7244348">(</span><span class="keyword" id="7244349">chan</span>&nbsp;<span class="builtintype" id="7244354">bool</span><span class="op" id="7244358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244361">go</span>&nbsp;<span class="keyword" id="7244364">func</span><span class="op" id="7244368">(</span><span class="op" id="7244369">)</span>&nbsp;<span class="op" id="7244371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244375">if</span>&nbsp;<span class="ident" id="7244378">_</span><span class="op" id="7244379">,</span>&nbsp;<span class="ident" id="7244381">err</span>&nbsp;<span class="op" id="7244385">:=</span>&nbsp;<span class="ident" id="7244388">client</span><span class="op" id="7244394">.</span><span class="ident" id="7244395">Write</span><span class="op" id="7244400">(</span><span class="op" id="7244401">[</span><span class="op" id="7244402">]</span><span class="builtintype" id="7244403">byte</span><span class="op" id="7244407">(</span><span class="string" id="7244408">&#34;hello\n&#34;</span><span class="op" id="7244417">)</span><span class="op" id="7244418">)</span><span class="op" id="7244419">;</span>&nbsp;<span class="ident" id="7244421">err</span>&nbsp;<span class="op" id="7244425">!=</span>&nbsp;<span class="ident" id="7244428">nil</span>&nbsp;<span class="op" id="7244432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244437">t</span><span class="op" id="7244438">.</span><span class="ident" id="7244439">Logf</span><span class="op" id="7244443">(</span><span class="string" id="7244444">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7244469">,</span>&nbsp;<span class="ident" id="7244471">err</span><span class="op" id="7244474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244478">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244482">if</span>&nbsp;<span class="ident" id="7244485">test</span><span class="op" id="7244489">.</span><span class="ident" id="7244490">validate</span>&nbsp;<span class="op" id="7244499">!=</span>&nbsp;<span class="ident" id="7244502">nil</span>&nbsp;<span class="op" id="7244506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244511">if</span>&nbsp;<span class="ident" id="7244514">err</span>&nbsp;<span class="op" id="7244518">:=</span>&nbsp;<span class="ident" id="7244521">test</span><span class="op" id="7244525">.</span><span class="ident" id="7244526">validate</span><span class="op" id="7244534">(</span><span class="ident" id="7244535">client</span><span class="op" id="7244541">.</span><span class="ident" id="7244542">ConnectionState</span><span class="op" id="7244557">(</span><span class="op" id="7244558">)</span><span class="op" id="7244559">)</span><span class="op" id="7244560">;</span>&nbsp;<span class="ident" id="7244562">err</span>&nbsp;<span class="op" id="7244566">!=</span>&nbsp;<span class="ident" id="7244569">nil</span>&nbsp;<span class="op" id="7244573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244579">t</span><span class="op" id="7244580">.</span><span class="ident" id="7244581">Logf</span><span class="op" id="7244585">(</span><span class="string" id="7244586">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7244624">,</span>&nbsp;<span class="ident" id="7244626">err</span><span class="op" id="7244629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244638">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244642">client</span><span class="op" id="7244648">.</span><span class="ident" id="7244649">Close</span><span class="op" id="7244654">(</span><span class="op" id="7244655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244659">clientConn</span><span class="op" id="7244669">.</span><span class="ident" id="7244670">Close</span><span class="op" id="7244675">(</span><span class="op" id="7244676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244680">doneChan</span>&nbsp;<span class="op" id="7244689">&lt;-</span>&nbsp;<span class="builtintype" id="7244692">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244698">}</span><span class="op" id="7244699">(</span><span class="op" id="7244700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244704">if</span>&nbsp;<span class="op" id="7244707">!</span><span class="ident" id="7244708">write</span>&nbsp;<span class="op" id="7244714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244718">flows</span><span class="op" id="7244723">,</span>&nbsp;<span class="ident" id="7244725">err</span>&nbsp;<span class="op" id="7244729">:=</span>&nbsp;<span class="ident" id="7244732">test</span><span class="op" id="7244736">.</span><span class="ident" id="7244737">loadData</span><span class="op" id="7244745">(</span><span class="op" id="7244746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244750">if</span>&nbsp;<span class="ident" id="7244753">err</span>&nbsp;<span class="op" id="7244757">!=</span>&nbsp;<span class="ident" id="7244760">nil</span>&nbsp;<span class="op" id="7244764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244769">t</span><span class="op" id="7244770">.</span><span class="ident" id="7244771">Fatalf</span><span class="op" id="7244777">(</span><span class="string" id="7244778">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7244815">,</span>&nbsp;<span class="ident" id="7244817">test</span><span class="op" id="7244821">.</span><span class="ident" id="7244822">name</span><span class="op" id="7244826">,</span>&nbsp;<span class="ident" id="7244828">test</span><span class="op" id="7244832">.</span><span class="ident" id="7244833">dataPath</span><span class="op" id="7244841">(</span><span class="op" id="7244842">)</span><span class="op" id="7244843">,</span>&nbsp;<span class="ident" id="7244845">err</span><span class="op" id="7244848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244852">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244856">for</span>&nbsp;<span class="ident" id="7244860">i</span><span class="op" id="7244861">,</span>&nbsp;<span class="ident" id="7244863">b</span>&nbsp;<span class="op" id="7244865">:=</span>&nbsp;<span class="keyword" id="7244868">range</span>&nbsp;<span class="ident" id="7244874">flows</span>&nbsp;<span class="op" id="7244880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244885">if</span>&nbsp;<span class="ident" id="7244888">i</span><span class="op" id="7244889">%</span><span class="num" id="7244890">2</span>&nbsp;<span class="op" id="7244892">==</span>&nbsp;<span class="num" id="7244895">1</span>&nbsp;<span class="op" id="7244897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244903">serverConn</span><span class="op" id="7244913">.</span><span class="ident" id="7244914">Write</span><span class="op" id="7244919">(</span><span class="ident" id="7244920">b</span><span class="op" id="7244921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7244927">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7244939">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244944">bb</span>&nbsp;<span class="op" id="7244947">:=</span>&nbsp;<span class="builtinfunc" id="7244950">make</span><span class="op" id="7244954">(</span><span class="op" id="7244955">[</span><span class="op" id="7244956">]</span><span class="builtintype" id="7244957">byte</span><span class="op" id="7244961">,</span>&nbsp;<span class="builtinfunc" id="7244963">len</span><span class="op" id="7244966">(</span><span class="ident" id="7244967">b</span><span class="op" id="7244968">)</span><span class="op" id="7244969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7244974">_</span><span class="op" id="7244975">,</span>&nbsp;<span class="ident" id="7244977">err</span>&nbsp;<span class="op" id="7244981">:=</span>&nbsp;<span class="ident" id="7244984">io</span><span class="op" id="7244986">.</span><span class="ident" id="7244987">ReadFull</span><span class="op" id="7244995">(</span><span class="ident" id="7244996">serverConn</span><span class="op" id="7245006">,</span>&nbsp;<span class="ident" id="7245008">bb</span><span class="op" id="7245010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245015">if</span>&nbsp;<span class="ident" id="7245018">err</span>&nbsp;<span class="op" id="7245022">!=</span>&nbsp;<span class="ident" id="7245025">nil</span>&nbsp;<span class="op" id="7245029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245035">t</span><span class="op" id="7245036">.</span><span class="ident" id="7245037">Fatalf</span><span class="op" id="7245043">(</span><span class="string" id="7245044">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7245056">,</span>&nbsp;<span class="ident" id="7245058">test</span><span class="op" id="7245062">.</span><span class="ident" id="7245063">name</span><span class="op" id="7245067">,</span>&nbsp;<span class="ident" id="7245069">i</span><span class="op" id="7245070">,</span>&nbsp;<span class="ident" id="7245072">err</span><span class="op" id="7245075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245080">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245085">if</span>&nbsp;<span class="op" id="7245088">!</span><span class="ident" id="7245089">bytes</span><span class="op" id="7245094">.</span><span class="ident" id="7245095">Equal</span><span class="op" id="7245100">(</span><span class="ident" id="7245101">b</span><span class="op" id="7245102">,</span>&nbsp;<span class="ident" id="7245104">bb</span><span class="op" id="7245106">)</span>&nbsp;<span class="op" id="7245108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245114">t</span><span class="op" id="7245115">.</span><span class="ident" id="7245116">Fatalf</span><span class="op" id="7245122">(</span><span class="string" id="7245123">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7245165">,</span>&nbsp;<span class="ident" id="7245167">test</span><span class="op" id="7245171">.</span><span class="ident" id="7245172">name</span><span class="op" id="7245176">,</span>&nbsp;<span class="ident" id="7245178">i</span><span class="op" id="7245179">,</span>&nbsp;<span class="ident" id="7245181">bb</span><span class="op" id="7245183">,</span>&nbsp;<span class="ident" id="7245185">b</span><span class="op" id="7245186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245199">serverConn</span><span class="op" id="7245209">.</span><span class="ident" id="7245210">Close</span><span class="op" id="7245215">(</span><span class="op" id="7245216">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245223">&lt;-</span><span class="ident" id="7245225">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245236">if</span>&nbsp;<span class="ident" id="7245239">write</span>&nbsp;<span class="op" id="7245245">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245249">path</span>&nbsp;<span class="op" id="7245254">:=</span>&nbsp;<span class="ident" id="7245257">test</span><span class="op" id="7245261">.</span><span class="ident" id="7245262">dataPath</span><span class="op" id="7245270">(</span><span class="op" id="7245271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245275">out</span><span class="op" id="7245278">,</span>&nbsp;<span class="ident" id="7245280">err</span>&nbsp;<span class="op" id="7245284">:=</span>&nbsp;<span class="ident" id="7245287">os</span><span class="op" id="7245289">.</span><span class="ident" id="7245290">OpenFile</span><span class="op" id="7245298">(</span><span class="ident" id="7245299">path</span><span class="op" id="7245303">,</span>&nbsp;<span class="ident" id="7245305">os</span><span class="op" id="7245307">.</span><span class="ident" id="7245308">O_WRONLY</span><span class="op" id="7245316">|</span><span class="ident" id="7245317">os</span><span class="op" id="7245319">.</span><span class="ident" id="7245320">O_CREATE</span><span class="op" id="7245328">|</span><span class="ident" id="7245329">os</span><span class="op" id="7245331">.</span><span class="ident" id="7245332">O_TRUNC</span><span class="op" id="7245339">,</span>&nbsp;<span class="num" id="7245341">0644</span><span class="op" id="7245345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245349">if</span>&nbsp;<span class="ident" id="7245352">err</span>&nbsp;<span class="op" id="7245356">!=</span>&nbsp;<span class="ident" id="7245359">nil</span>&nbsp;<span class="op" id="7245363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245368">t</span><span class="op" id="7245369">.</span><span class="ident" id="7245370">Fatalf</span><span class="op" id="7245376">(</span><span class="string" id="7245377">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7245411">,</span>&nbsp;<span class="ident" id="7245413">err</span><span class="op" id="7245416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245420">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245424">defer</span>&nbsp;<span class="ident" id="7245430">out</span><span class="op" id="7245433">.</span><span class="ident" id="7245434">Close</span><span class="op" id="7245439">(</span><span class="op" id="7245440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245444">recordingConn</span><span class="op" id="7245457">.</span><span class="ident" id="7245458">Close</span><span class="op" id="7245463">(</span><span class="op" id="7245464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7245468">close</span><span class="op" id="7245473">(</span><span class="ident" id="7245474">stdin</span><span class="op" id="7245479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245483">childProcess</span><span class="op" id="7245495">.</span><span class="ident" id="7245496">Process</span><span class="op" id="7245503">.</span><span class="ident" id="7245504">Kill</span><span class="op" id="7245508">(</span><span class="op" id="7245509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245513">childProcess</span><span class="op" id="7245525">.</span><span class="ident" id="7245526">Wait</span><span class="op" id="7245530">(</span><span class="op" id="7245531">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245535">if</span>&nbsp;<span class="builtinfunc" id="7245538">len</span><span class="op" id="7245541">(</span><span class="ident" id="7245542">recordingConn</span><span class="op" id="7245555">.</span><span class="ident" id="7245556">flows</span><span class="op" id="7245561">)</span>&nbsp;<span class="op" id="7245563">&lt;</span>&nbsp;<span class="num" id="7245565">3</span>&nbsp;<span class="op" id="7245567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245572">childProcess</span><span class="op" id="7245584">.</span><span class="ident" id="7245585">Stdout</span><span class="op" id="7245591">.</span><span class="op" id="7245592">(</span><span class="op" id="7245593">*</span><span class="ident" id="7245594">bytes</span><span class="op" id="7245599">.</span><span class="ident" id="7245600">Buffer</span><span class="op" id="7245606">)</span><span class="op" id="7245607">.</span><span class="ident" id="7245608">WriteTo</span><span class="op" id="7245615">(</span><span class="ident" id="7245616">os</span><span class="op" id="7245618">.</span><span class="ident" id="7245619">Stdout</span><span class="op" id="7245625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245630">t</span><span class="op" id="7245631">.</span><span class="ident" id="7245632">Fatalf</span><span class="op" id="7245638">(</span><span class="string" id="7245639">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7245670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245678">recordingConn</span><span class="op" id="7245691">.</span><span class="ident" id="7245692">WriteTo</span><span class="op" id="7245699">(</span><span class="ident" id="7245700">out</span><span class="op" id="7245703">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245707">fmt</span><span class="op" id="7245710">.</span><span class="ident" id="7245711">Printf</span><span class="op" id="7245717">(</span><span class="string" id="7245718">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7245730">,</span>&nbsp;<span class="ident" id="7245732">path</span><span class="op" id="7245736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245739">}</span><br>
<span class="lineno"></span><span class="op" id="7245741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7245744">func</span>&nbsp;<span class="ident" id="7245749">runClientTestForVersion</span><span class="op" id="7245772">(</span><span class="ident" id="7245773">t</span>&nbsp;<span class="op" id="7245775">*</span><span class="ident" id="7245776">testing</span><span class="op" id="7245783">.</span><span class="ident" id="7245784">T</span><span class="op" id="7245785">,</span>&nbsp;<span class="ident" id="7245787">template</span>&nbsp;<span class="op" id="7245796">*</span><span class="ident" id="7245797">clientTest</span><span class="op" id="7245807">,</span>&nbsp;<span class="ident" id="7245809">prefix</span><span class="op" id="7245815">,</span>&nbsp;<span class="ident" id="7245817">option</span>&nbsp;<span class="builtintype" id="7245824">string</span><span class="op" id="7245830">)</span>&nbsp;<span class="op" id="7245832">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245835">test</span>&nbsp;<span class="op" id="7245840">:=</span>&nbsp;<span class="op" id="7245843">*</span><span class="ident" id="7245844">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245854">test</span><span class="op" id="7245858">.</span><span class="ident" id="7245859">name</span>&nbsp;<span class="op" id="7245864">=</span>&nbsp;<span class="ident" id="7245866">prefix</span>&nbsp;<span class="op" id="7245873">+</span>&nbsp;<span class="ident" id="7245875">test</span><span class="op" id="7245879">.</span><span class="ident" id="7245880">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7245886">if</span>&nbsp;<span class="builtinfunc" id="7245889">len</span><span class="op" id="7245892">(</span><span class="ident" id="7245893">test</span><span class="op" id="7245897">.</span><span class="ident" id="7245898">command</span><span class="op" id="7245905">)</span>&nbsp;<span class="op" id="7245907">==</span>&nbsp;<span class="num" id="7245910">0</span>&nbsp;<span class="op" id="7245912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245916">test</span><span class="op" id="7245920">.</span><span class="ident" id="7245921">command</span>&nbsp;<span class="op" id="7245929">=</span>&nbsp;<span class="ident" id="7245931">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7245953">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7245956">test</span><span class="op" id="7245960">.</span><span class="ident" id="7245961">command</span>&nbsp;<span class="op" id="7245969">=</span>&nbsp;<span class="builtinfunc" id="7245971">append</span><span class="op" id="7245977">(</span><span class="op" id="7245978">[</span><span class="op" id="7245979">]</span><span class="builtintype" id="7245980">string</span><span class="op" id="7245986">(</span><span class="ident" id="7245987">nil</span><span class="op" id="7245990">)</span><span class="op" id="7245991">,</span>&nbsp;<span class="ident" id="7245993">test</span><span class="op" id="7245997">.</span><span class="ident" id="7245998">command</span><span class="op" id="7246005">...</span><span class="op" id="7246008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246011">test</span><span class="op" id="7246015">.</span><span class="ident" id="7246016">command</span>&nbsp;<span class="op" id="7246024">=</span>&nbsp;<span class="builtinfunc" id="7246026">append</span><span class="op" id="7246032">(</span><span class="ident" id="7246033">test</span><span class="op" id="7246037">.</span><span class="ident" id="7246038">command</span><span class="op" id="7246045">,</span>&nbsp;<span class="ident" id="7246047">option</span><span class="op" id="7246053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246056">test</span><span class="op" id="7246060">.</span><span class="ident" id="7246061">run</span><span class="op" id="7246064">(</span><span class="ident" id="7246065">t</span><span class="op" id="7246066">,</span>&nbsp;<span class="op" id="7246068">*</span><span class="ident" id="7246069">update</span><span class="op" id="7246075">)</span><br>
<span class="lineno"></span><span class="op" id="7246077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7246080">func</span>&nbsp;<span class="ident" id="7246085">runClientTestTLS10</span><span class="op" id="7246103">(</span><span class="ident" id="7246104">t</span>&nbsp;<span class="op" id="7246106">*</span><span class="ident" id="7246107">testing</span><span class="op" id="7246114">.</span><span class="ident" id="7246115">T</span><span class="op" id="7246116">,</span>&nbsp;<span class="ident" id="7246118">template</span>&nbsp;<span class="op" id="7246127">*</span><span class="ident" id="7246128">clientTest</span><span class="op" id="7246138">)</span>&nbsp;<span class="op" id="7246140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246143">runClientTestForVersion</span><span class="op" id="7246166">(</span><span class="ident" id="7246167">t</span><span class="op" id="7246168">,</span>&nbsp;<span class="ident" id="7246170">template</span><span class="op" id="7246178">,</span>&nbsp;<span class="string" id="7246180">&#34;TLSv10-&#34;</span><span class="op" id="7246189">,</span>&nbsp;<span class="string" id="7246191">&#34;-tls1&#34;</span><span class="op" id="7246198">)</span><br>
<span class="lineno"></span><span class="op" id="7246200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246203">func</span>&nbsp;<span class="ident" id="7246208">runClientTestTLS11</span><span class="op" id="7246226">(</span><span class="ident" id="7246227">t</span>&nbsp;<span class="op" id="7246229">*</span><span class="ident" id="7246230">testing</span><span class="op" id="7246237">.</span><span class="ident" id="7246238">T</span><span class="op" id="7246239">,</span>&nbsp;<span class="ident" id="7246241">template</span>&nbsp;<span class="op" id="7246250">*</span><span class="ident" id="7246251">clientTest</span><span class="op" id="7246261">)</span>&nbsp;<span class="op" id="7246263">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246266">runClientTestForVersion</span><span class="op" id="7246289">(</span><span class="ident" id="7246290">t</span><span class="op" id="7246291">,</span>&nbsp;<span class="ident" id="7246293">template</span><span class="op" id="7246301">,</span>&nbsp;<span class="string" id="7246303">&#34;TLSv11-&#34;</span><span class="op" id="7246312">,</span>&nbsp;<span class="string" id="7246314">&#34;-tls1_1&#34;</span><span class="op" id="7246323">)</span><br>
<span class="lineno"></span><span class="op" id="7246325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246328">func</span>&nbsp;<span class="ident" id="7246333">runClientTestTLS12</span><span class="op" id="7246351">(</span><span class="ident" id="7246352">t</span>&nbsp;<span class="op" id="7246354">*</span><span class="ident" id="7246355">testing</span><span class="op" id="7246362">.</span><span class="ident" id="7246363">T</span><span class="op" id="7246364">,</span>&nbsp;<span class="ident" id="7246366">template</span>&nbsp;<span class="op" id="7246375">*</span><span class="ident" id="7246376">clientTest</span><span class="op" id="7246386">)</span>&nbsp;<span class="op" id="7246388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246391">runClientTestForVersion</span><span class="op" id="7246414">(</span><span class="ident" id="7246415">t</span><span class="op" id="7246416">,</span>&nbsp;<span class="ident" id="7246418">template</span><span class="op" id="7246426">,</span>&nbsp;<span class="string" id="7246428">&#34;TLSv12-&#34;</span><span class="op" id="7246437">,</span>&nbsp;<span class="string" id="7246439">&#34;-tls1_2&#34;</span><span class="op" id="7246448">)</span><br>
<span class="lineno">270</span><span class="op" id="7246450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246453">func</span>&nbsp;<span class="ident" id="7246458">TestHandshakeClientRSARC4</span><span class="op" id="7246483">(</span><span class="ident" id="7246484">t</span>&nbsp;<span class="op" id="7246486">*</span><span class="ident" id="7246487">testing</span><span class="op" id="7246494">.</span><span class="ident" id="7246495">T</span><span class="op" id="7246496">)</span>&nbsp;<span class="op" id="7246498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246501">test</span>&nbsp;<span class="op" id="7246506">:=</span>&nbsp;<span class="op" id="7246509">&amp;</span><span class="ident" id="7246510">clientTest</span><span class="op" id="7246520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246524">name</span><span class="op" id="7246528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7246533">&#34;RSA-RC4&#34;</span><span class="op" id="7246542">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246546">command</span><span class="op" id="7246553">:</span>&nbsp;<span class="op" id="7246555">[</span><span class="op" id="7246556">]</span><span class="builtintype" id="7246557">string</span><span class="op" id="7246563">{</span><span class="string" id="7246564">&#34;openssl&#34;</span><span class="op" id="7246573">,</span>&nbsp;<span class="string" id="7246575">&#34;s_server&#34;</span><span class="op" id="7246585">,</span>&nbsp;<span class="string" id="7246587">&#34;-cipher&#34;</span><span class="op" id="7246596">,</span>&nbsp;<span class="string" id="7246598">&#34;RC4-SHA&#34;</span><span class="op" id="7246607">}</span><span class="op" id="7246608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246614">runClientTestTLS10</span><span class="op" id="7246632">(</span><span class="ident" id="7246633">t</span><span class="op" id="7246634">,</span>&nbsp;<span class="ident" id="7246636">test</span><span class="op" id="7246640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246643">runClientTestTLS11</span><span class="op" id="7246661">(</span><span class="ident" id="7246662">t</span><span class="op" id="7246663">,</span>&nbsp;<span class="ident" id="7246665">test</span><span class="op" id="7246669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246672">runClientTestTLS12</span><span class="op" id="7246690">(</span><span class="ident" id="7246691">t</span><span class="op" id="7246692">,</span>&nbsp;<span class="ident" id="7246694">test</span><span class="op" id="7246698">)</span><br>
<span class="lineno">280</span><span class="op" id="7246700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246703">func</span>&nbsp;<span class="ident" id="7246708">TestHandshakeClientECDHERSAAES</span><span class="op" id="7246738">(</span><span class="ident" id="7246739">t</span>&nbsp;<span class="op" id="7246741">*</span><span class="ident" id="7246742">testing</span><span class="op" id="7246749">.</span><span class="ident" id="7246750">T</span><span class="op" id="7246751">)</span>&nbsp;<span class="op" id="7246753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246756">test</span>&nbsp;<span class="op" id="7246761">:=</span>&nbsp;<span class="op" id="7246764">&amp;</span><span class="ident" id="7246765">clientTest</span><span class="op" id="7246775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246779">name</span><span class="op" id="7246783">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7246788">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7246803">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246807">command</span><span class="op" id="7246814">:</span>&nbsp;<span class="op" id="7246816">[</span><span class="op" id="7246817">]</span><span class="builtintype" id="7246818">string</span><span class="op" id="7246824">{</span><span class="string" id="7246825">&#34;openssl&#34;</span><span class="op" id="7246834">,</span>&nbsp;<span class="string" id="7246836">&#34;s_server&#34;</span><span class="op" id="7246846">,</span>&nbsp;<span class="string" id="7246848">&#34;-cipher&#34;</span><span class="op" id="7246857">,</span>&nbsp;<span class="string" id="7246859">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7246881">}</span><span class="op" id="7246882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246888">runClientTestTLS10</span><span class="op" id="7246906">(</span><span class="ident" id="7246907">t</span><span class="op" id="7246908">,</span>&nbsp;<span class="ident" id="7246910">test</span><span class="op" id="7246914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246917">runClientTestTLS11</span><span class="op" id="7246935">(</span><span class="ident" id="7246936">t</span><span class="op" id="7246937">,</span>&nbsp;<span class="ident" id="7246939">test</span><span class="op" id="7246943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246946">runClientTestTLS12</span><span class="op" id="7246964">(</span><span class="ident" id="7246965">t</span><span class="op" id="7246966">,</span>&nbsp;<span class="ident" id="7246968">test</span><span class="op" id="7246972">)</span><br>
<span class="lineno">290</span><span class="op" id="7246974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246977">func</span>&nbsp;<span class="ident" id="7246982">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7247014">(</span><span class="ident" id="7247015">t</span>&nbsp;<span class="op" id="7247017">*</span><span class="ident" id="7247018">testing</span><span class="op" id="7247025">.</span><span class="ident" id="7247026">T</span><span class="op" id="7247027">)</span>&nbsp;<span class="op" id="7247029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247032">test</span>&nbsp;<span class="op" id="7247037">:=</span>&nbsp;<span class="op" id="7247040">&amp;</span><span class="ident" id="7247041">clientTest</span><span class="op" id="7247051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247055">name</span><span class="op" id="7247059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7247064">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7247081">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247085">command</span><span class="op" id="7247092">:</span>&nbsp;<span class="op" id="7247094">[</span><span class="op" id="7247095">]</span><span class="builtintype" id="7247096">string</span><span class="op" id="7247102">{</span><span class="string" id="7247103">&#34;openssl&#34;</span><span class="op" id="7247112">,</span>&nbsp;<span class="string" id="7247114">&#34;s_server&#34;</span><span class="op" id="7247124">,</span>&nbsp;<span class="string" id="7247126">&#34;-cipher&#34;</span><span class="op" id="7247135">,</span>&nbsp;<span class="string" id="7247137">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7247161">}</span><span class="op" id="7247162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247166">cert</span><span class="op" id="7247170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7247175">testECDSACertificate</span><span class="op" id="7247195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247199">key</span><span class="op" id="7247202">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7247208">testECDSAPrivateKey</span><span class="op" id="7247227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247233">runClientTestTLS10</span><span class="op" id="7247251">(</span><span class="ident" id="7247252">t</span><span class="op" id="7247253">,</span>&nbsp;<span class="ident" id="7247255">test</span><span class="op" id="7247259">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247262">runClientTestTLS11</span><span class="op" id="7247280">(</span><span class="ident" id="7247281">t</span><span class="op" id="7247282">,</span>&nbsp;<span class="ident" id="7247284">test</span><span class="op" id="7247288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247291">runClientTestTLS12</span><span class="op" id="7247309">(</span><span class="ident" id="7247310">t</span><span class="op" id="7247311">,</span>&nbsp;<span class="ident" id="7247313">test</span><span class="op" id="7247317">)</span><br>
<span class="lineno"></span><span class="op" id="7247319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7247322">func</span>&nbsp;<span class="ident" id="7247327">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7247362">(</span><span class="ident" id="7247363">t</span>&nbsp;<span class="op" id="7247365">*</span><span class="ident" id="7247366">testing</span><span class="op" id="7247373">.</span><span class="ident" id="7247374">T</span><span class="op" id="7247375">)</span>&nbsp;<span class="op" id="7247377">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247380">test</span>&nbsp;<span class="op" id="7247385">:=</span>&nbsp;<span class="op" id="7247388">&amp;</span><span class="ident" id="7247389">clientTest</span><span class="op" id="7247399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247403">name</span><span class="op" id="7247407">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7247412">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7247433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247437">command</span><span class="op" id="7247444">:</span>&nbsp;<span class="op" id="7247446">[</span><span class="op" id="7247447">]</span><span class="builtintype" id="7247448">string</span><span class="op" id="7247454">{</span><span class="string" id="7247455">&#34;openssl&#34;</span><span class="op" id="7247464">,</span>&nbsp;<span class="string" id="7247466">&#34;s_server&#34;</span><span class="op" id="7247476">,</span>&nbsp;<span class="string" id="7247478">&#34;-cipher&#34;</span><span class="op" id="7247487">,</span>&nbsp;<span class="string" id="7247489">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7247520">}</span><span class="op" id="7247521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247525">cert</span><span class="op" id="7247529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7247534">testECDSACertificate</span><span class="op" id="7247554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247558">key</span><span class="op" id="7247561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7247567">testECDSAPrivateKey</span><span class="op" id="7247586">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247592">runClientTestTLS12</span><span class="op" id="7247610">(</span><span class="ident" id="7247611">t</span><span class="op" id="7247612">,</span>&nbsp;<span class="ident" id="7247614">test</span><span class="op" id="7247618">)</span><br>
<span class="lineno"></span><span class="op" id="7247620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7247623">func</span>&nbsp;<span class="ident" id="7247628">TestHandshakeClientCertRSA</span><span class="op" id="7247654">(</span><span class="ident" id="7247655">t</span>&nbsp;<span class="op" id="7247657">*</span><span class="ident" id="7247658">testing</span><span class="op" id="7247665">.</span><span class="ident" id="7247666">T</span><span class="op" id="7247667">)</span>&nbsp;<span class="op" id="7247669">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247672">config</span>&nbsp;<span class="op" id="7247679">:=</span>&nbsp;<span class="op" id="7247682">*</span><span class="ident" id="7247683">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247695">cert</span><span class="op" id="7247699">,</span>&nbsp;<span class="ident" id="7247701">_</span>&nbsp;<span class="op" id="7247703">:=</span>&nbsp;<span class="ident" id="7247706">X509KeyPair</span><span class="op" id="7247717">(</span><span class="op" id="7247718">[</span><span class="op" id="7247719">]</span><span class="builtintype" id="7247720">byte</span><span class="op" id="7247724">(</span><span class="ident" id="7247725">clientCertificatePEM</span><span class="op" id="7247745">)</span><span class="op" id="7247746">,</span>&nbsp;<span class="op" id="7247748">[</span><span class="op" id="7247749">]</span><span class="builtintype" id="7247750">byte</span><span class="op" id="7247754">(</span><span class="ident" id="7247755">clientKeyPEM</span><span class="op" id="7247767">)</span><span class="op" id="7247768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247771">config</span><span class="op" id="7247777">.</span><span class="ident" id="7247778">Certificates</span>&nbsp;<span class="op" id="7247791">=</span>&nbsp;<span class="op" id="7247793">[</span><span class="op" id="7247794">]</span><span class="ident" id="7247795">Certificate</span><span class="op" id="7247806">{</span><span class="ident" id="7247807">cert</span><span class="op" id="7247811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247815">test</span>&nbsp;<span class="op" id="7247820">:=</span>&nbsp;<span class="op" id="7247823">&amp;</span><span class="ident" id="7247824">clientTest</span><span class="op" id="7247834">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247838">name</span><span class="op" id="7247842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7247847">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7247867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247871">command</span><span class="op" id="7247878">:</span>&nbsp;<span class="op" id="7247880">[</span><span class="op" id="7247881">]</span><span class="builtintype" id="7247882">string</span><span class="op" id="7247888">{</span><span class="string" id="7247889">&#34;openssl&#34;</span><span class="op" id="7247898">,</span>&nbsp;<span class="string" id="7247900">&#34;s_server&#34;</span><span class="op" id="7247910">,</span>&nbsp;<span class="string" id="7247912">&#34;-cipher&#34;</span><span class="op" id="7247921">,</span>&nbsp;<span class="string" id="7247923">&#34;RC4-SHA&#34;</span><span class="op" id="7247932">,</span>&nbsp;<span class="string" id="7247934">&#34;-verify&#34;</span><span class="op" id="7247943">,</span>&nbsp;<span class="string" id="7247945">&#34;1&#34;</span><span class="op" id="7247948">}</span><span class="op" id="7247949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247953">config</span><span class="op" id="7247959">:</span>&nbsp;&nbsp;<span class="op" id="7247962">&amp;</span><span class="ident" id="7247963">config</span><span class="op" id="7247969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247976">runClientTestTLS10</span><span class="op" id="7247994">(</span><span class="ident" id="7247995">t</span><span class="op" id="7247996">,</span>&nbsp;<span class="ident" id="7247998">test</span><span class="op" id="7248002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248005">runClientTestTLS12</span><span class="op" id="7248023">(</span><span class="ident" id="7248024">t</span><span class="op" id="7248025">,</span>&nbsp;<span class="ident" id="7248027">test</span><span class="op" id="7248031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248035">test</span>&nbsp;<span class="op" id="7248040">=</span>&nbsp;<span class="op" id="7248042">&amp;</span><span class="ident" id="7248043">clientTest</span><span class="op" id="7248053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248057">name</span><span class="op" id="7248061">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7248066">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7248088">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248092">command</span><span class="op" id="7248099">:</span>&nbsp;<span class="op" id="7248101">[</span><span class="op" id="7248102">]</span><span class="builtintype" id="7248103">string</span><span class="op" id="7248109">{</span><span class="string" id="7248110">&#34;openssl&#34;</span><span class="op" id="7248119">,</span>&nbsp;<span class="string" id="7248121">&#34;s_server&#34;</span><span class="op" id="7248131">,</span>&nbsp;<span class="string" id="7248133">&#34;-cipher&#34;</span><span class="op" id="7248142">,</span>&nbsp;<span class="string" id="7248144">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7248168">,</span>&nbsp;<span class="string" id="7248170">&#34;-verify&#34;</span><span class="op" id="7248179">,</span>&nbsp;<span class="string" id="7248181">&#34;1&#34;</span><span class="op" id="7248184">}</span><span class="op" id="7248185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248189">config</span><span class="op" id="7248195">:</span>&nbsp;&nbsp;<span class="op" id="7248198">&amp;</span><span class="ident" id="7248199">config</span><span class="op" id="7248205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248209">cert</span><span class="op" id="7248213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7248218">testECDSACertificate</span><span class="op" id="7248238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248242">key</span><span class="op" id="7248245">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7248251">testECDSAPrivateKey</span><span class="op" id="7248270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248273">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248277">runClientTestTLS10</span><span class="op" id="7248295">(</span><span class="ident" id="7248296">t</span><span class="op" id="7248297">,</span>&nbsp;<span class="ident" id="7248299">test</span><span class="op" id="7248303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248306">runClientTestTLS12</span><span class="op" id="7248324">(</span><span class="ident" id="7248325">t</span><span class="op" id="7248326">,</span>&nbsp;<span class="ident" id="7248328">test</span><span class="op" id="7248332">)</span><br>
<span class="lineno"></span><span class="op" id="7248334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7248337">func</span>&nbsp;<span class="ident" id="7248342">TestHandshakeClientCertECDSA</span><span class="op" id="7248370">(</span><span class="ident" id="7248371">t</span>&nbsp;<span class="op" id="7248373">*</span><span class="ident" id="7248374">testing</span><span class="op" id="7248381">.</span><span class="ident" id="7248382">T</span><span class="op" id="7248383">)</span>&nbsp;<span class="op" id="7248385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248388">config</span>&nbsp;<span class="op" id="7248395">:=</span>&nbsp;<span class="op" id="7248398">*</span><span class="ident" id="7248399">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248411">cert</span><span class="op" id="7248415">,</span>&nbsp;<span class="ident" id="7248417">_</span>&nbsp;<span class="op" id="7248419">:=</span>&nbsp;<span class="ident" id="7248422">X509KeyPair</span><span class="op" id="7248433">(</span><span class="op" id="7248434">[</span><span class="op" id="7248435">]</span><span class="builtintype" id="7248436">byte</span><span class="op" id="7248440">(</span><span class="ident" id="7248441">clientECDSACertificatePEM</span><span class="op" id="7248466">)</span><span class="op" id="7248467">,</span>&nbsp;<span class="op" id="7248469">[</span><span class="op" id="7248470">]</span><span class="builtintype" id="7248471">byte</span><span class="op" id="7248475">(</span><span class="ident" id="7248476">clientECDSAKeyPEM</span><span class="op" id="7248493">)</span><span class="op" id="7248494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248497">config</span><span class="op" id="7248503">.</span><span class="ident" id="7248504">Certificates</span>&nbsp;<span class="op" id="7248517">=</span>&nbsp;<span class="op" id="7248519">[</span><span class="op" id="7248520">]</span><span class="ident" id="7248521">Certificate</span><span class="op" id="7248532">{</span><span class="ident" id="7248533">cert</span><span class="op" id="7248537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248541">test</span>&nbsp;<span class="op" id="7248546">:=</span>&nbsp;<span class="op" id="7248549">&amp;</span><span class="ident" id="7248550">clientTest</span><span class="op" id="7248560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248564">name</span><span class="op" id="7248568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7248573">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7248595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248599">command</span><span class="op" id="7248606">:</span>&nbsp;<span class="op" id="7248608">[</span><span class="op" id="7248609">]</span><span class="builtintype" id="7248610">string</span><span class="op" id="7248616">{</span><span class="string" id="7248617">&#34;openssl&#34;</span><span class="op" id="7248626">,</span>&nbsp;<span class="string" id="7248628">&#34;s_server&#34;</span><span class="op" id="7248638">,</span>&nbsp;<span class="string" id="7248640">&#34;-cipher&#34;</span><span class="op" id="7248649">,</span>&nbsp;<span class="string" id="7248651">&#34;RC4-SHA&#34;</span><span class="op" id="7248660">,</span>&nbsp;<span class="string" id="7248662">&#34;-verify&#34;</span><span class="op" id="7248671">,</span>&nbsp;<span class="string" id="7248673">&#34;1&#34;</span><span class="op" id="7248676">}</span><span class="op" id="7248677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248681">config</span><span class="op" id="7248687">:</span>&nbsp;&nbsp;<span class="op" id="7248690">&amp;</span><span class="ident" id="7248691">config</span><span class="op" id="7248697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248700">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248704">runClientTestTLS10</span><span class="op" id="7248722">(</span><span class="ident" id="7248723">t</span><span class="op" id="7248724">,</span>&nbsp;<span class="ident" id="7248726">test</span><span class="op" id="7248730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248733">runClientTestTLS12</span><span class="op" id="7248751">(</span><span class="ident" id="7248752">t</span><span class="op" id="7248753">,</span>&nbsp;<span class="ident" id="7248755">test</span><span class="op" id="7248759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248763">test</span>&nbsp;<span class="op" id="7248768">=</span>&nbsp;<span class="op" id="7248770">&amp;</span><span class="ident" id="7248771">clientTest</span><span class="op" id="7248781">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248785">name</span><span class="op" id="7248789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7248794">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7248818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248822">command</span><span class="op" id="7248829">:</span>&nbsp;<span class="op" id="7248831">[</span><span class="op" id="7248832">]</span><span class="builtintype" id="7248833">string</span><span class="op" id="7248839">{</span><span class="string" id="7248840">&#34;openssl&#34;</span><span class="op" id="7248849">,</span>&nbsp;<span class="string" id="7248851">&#34;s_server&#34;</span><span class="op" id="7248861">,</span>&nbsp;<span class="string" id="7248863">&#34;-cipher&#34;</span><span class="op" id="7248872">,</span>&nbsp;<span class="string" id="7248874">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7248898">,</span>&nbsp;<span class="string" id="7248900">&#34;-verify&#34;</span><span class="op" id="7248909">,</span>&nbsp;<span class="string" id="7248911">&#34;1&#34;</span><span class="op" id="7248914">}</span><span class="op" id="7248915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248919">config</span><span class="op" id="7248925">:</span>&nbsp;&nbsp;<span class="op" id="7248928">&amp;</span><span class="ident" id="7248929">config</span><span class="op" id="7248935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248939">cert</span><span class="op" id="7248943">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7248948">testECDSACertificate</span><span class="op" id="7248968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248972">key</span><span class="op" id="7248975">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7248981">testECDSAPrivateKey</span><span class="op" id="7249000">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249007">runClientTestTLS10</span><span class="op" id="7249025">(</span><span class="ident" id="7249026">t</span><span class="op" id="7249027">,</span>&nbsp;<span class="ident" id="7249029">test</span><span class="op" id="7249033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249036">runClientTestTLS12</span><span class="op" id="7249054">(</span><span class="ident" id="7249055">t</span><span class="op" id="7249056">,</span>&nbsp;<span class="ident" id="7249058">test</span><span class="op" id="7249062">)</span><br>
<span class="lineno"></span><span class="op" id="7249064">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7249067">func</span>&nbsp;<span class="ident" id="7249072">TestClientResumption</span><span class="op" id="7249092">(</span><span class="ident" id="7249093">t</span>&nbsp;<span class="op" id="7249095">*</span><span class="ident" id="7249096">testing</span><span class="op" id="7249103">.</span><span class="ident" id="7249104">T</span><span class="op" id="7249105">)</span>&nbsp;<span class="op" id="7249107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249110">serverConfig</span>&nbsp;<span class="op" id="7249123">:=</span>&nbsp;<span class="op" id="7249126">&amp;</span><span class="ident" id="7249127">Config</span><span class="op" id="7249133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249137">CipherSuites</span><span class="op" id="7249149">:</span>&nbsp;<span class="op" id="7249151">[</span><span class="op" id="7249152">]</span><span class="builtintype" id="7249153">uint16</span><span class="op" id="7249159">{</span><span class="ident" id="7249160">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7249184">,</span>&nbsp;<span class="ident" id="7249186">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7249216">}</span><span class="op" id="7249217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249221">Certificates</span><span class="op" id="7249233">:</span>&nbsp;<span class="ident" id="7249235">testConfig</span><span class="op" id="7249245">.</span><span class="ident" id="7249246">Certificates</span><span class="op" id="7249258">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249264">clientConfig</span>&nbsp;<span class="op" id="7249277">:=</span>&nbsp;<span class="op" id="7249280">&amp;</span><span class="ident" id="7249281">Config</span><span class="op" id="7249287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249291">CipherSuites</span><span class="op" id="7249303">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7249311">[</span><span class="op" id="7249312">]</span><span class="builtintype" id="7249313">uint16</span><span class="op" id="7249319">{</span><span class="ident" id="7249320">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7249344">}</span><span class="op" id="7249345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249349">InsecureSkipVerify</span><span class="op" id="7249367">:</span>&nbsp;<span class="builtintype" id="7249369">true</span><span class="op" id="7249373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249377">ClientSessionCache</span><span class="op" id="7249395">:</span>&nbsp;<span class="ident" id="7249397">NewLRUClientSessionCache</span><span class="op" id="7249421">(</span><span class="num" id="7249422">32</span><span class="op" id="7249424">)</span><span class="op" id="7249425">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249432">testResumeState</span>&nbsp;<span class="op" id="7249448">:=</span>&nbsp;<span class="keyword" id="7249451">func</span><span class="op" id="7249455">(</span><span class="ident" id="7249456">test</span>&nbsp;<span class="builtintype" id="7249461">string</span><span class="op" id="7249467">,</span>&nbsp;<span class="ident" id="7249469">didResume</span>&nbsp;<span class="builtintype" id="7249479">bool</span><span class="op" id="7249483">)</span>&nbsp;<span class="op" id="7249485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249489">hs</span><span class="op" id="7249491">,</span>&nbsp;<span class="ident" id="7249493">err</span>&nbsp;<span class="op" id="7249497">:=</span>&nbsp;<span class="ident" id="7249500">testHandshake</span><span class="op" id="7249513">(</span><span class="ident" id="7249514">clientConfig</span><span class="op" id="7249526">,</span>&nbsp;<span class="ident" id="7249528">serverConfig</span><span class="op" id="7249540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249544">if</span>&nbsp;<span class="ident" id="7249547">err</span>&nbsp;<span class="op" id="7249551">!=</span>&nbsp;<span class="ident" id="7249554">nil</span>&nbsp;<span class="op" id="7249558">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249563">t</span><span class="op" id="7249564">.</span><span class="ident" id="7249565">Fatalf</span><span class="op" id="7249571">(</span><span class="string" id="7249572">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7249598">,</span>&nbsp;<span class="ident" id="7249600">test</span><span class="op" id="7249604">,</span>&nbsp;<span class="ident" id="7249606">err</span><span class="op" id="7249609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249617">if</span>&nbsp;<span class="ident" id="7249620">hs</span><span class="op" id="7249622">.</span><span class="ident" id="7249623">DidResume</span>&nbsp;<span class="op" id="7249633">!=</span>&nbsp;<span class="ident" id="7249636">didResume</span>&nbsp;<span class="op" id="7249646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249651">t</span><span class="op" id="7249652">.</span><span class="ident" id="7249653">Fatalf</span><span class="op" id="7249659">(</span><span class="string" id="7249660">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7249690">,</span>&nbsp;<span class="ident" id="7249692">test</span><span class="op" id="7249696">,</span>&nbsp;<span class="ident" id="7249698">hs</span><span class="op" id="7249700">.</span><span class="ident" id="7249701">DidResume</span><span class="op" id="7249710">,</span>&nbsp;<span class="ident" id="7249712">didResume</span><span class="op" id="7249721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249725">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249732">testResumeState</span><span class="op" id="7249747">(</span><span class="string" id="7249748">&#34;Handshake&#34;</span><span class="op" id="7249759">,</span>&nbsp;<span class="builtintype" id="7249761">false</span><span class="op" id="7249766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249769">testResumeState</span><span class="op" id="7249784">(</span><span class="string" id="7249785">&#34;Resume&#34;</span><span class="op" id="7249793">,</span>&nbsp;<span class="builtintype" id="7249795">true</span><span class="op" id="7249799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249803">if</span>&nbsp;<span class="ident" id="7249806">_</span><span class="op" id="7249807">,</span>&nbsp;<span class="ident" id="7249809">err</span>&nbsp;<span class="op" id="7249813">:=</span>&nbsp;<span class="ident" id="7249816">io</span><span class="op" id="7249818">.</span><span class="ident" id="7249819">ReadFull</span><span class="op" id="7249827">(</span><span class="ident" id="7249828">serverConfig</span><span class="op" id="7249840">.</span><span class="ident" id="7249841">rand</span><span class="op" id="7249845">(</span><span class="op" id="7249846">)</span><span class="op" id="7249847">,</span>&nbsp;<span class="ident" id="7249849">serverConfig</span><span class="op" id="7249861">.</span><span class="ident" id="7249862">SessionTicketKey</span><span class="op" id="7249878">[</span><span class="op" id="7249879">:</span><span class="op" id="7249880">]</span><span class="op" id="7249881">)</span><span class="op" id="7249882">;</span>&nbsp;<span class="ident" id="7249884">err</span>&nbsp;<span class="op" id="7249888">!=</span>&nbsp;<span class="ident" id="7249891">nil</span>&nbsp;<span class="op" id="7249895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249899">t</span><span class="op" id="7249900">.</span><span class="ident" id="7249901">Fatalf</span><span class="op" id="7249907">(</span><span class="string" id="7249908">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7249947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249953">testResumeState</span><span class="op" id="7249968">(</span><span class="string" id="7249969">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7249994">,</span>&nbsp;<span class="builtintype" id="7249996">false</span><span class="op" id="7250001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250004">testResumeState</span><span class="op" id="7250019">(</span><span class="string" id="7250020">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7250056">,</span>&nbsp;<span class="builtintype" id="7250058">true</span><span class="op" id="7250062">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250066">clientConfig</span><span class="op" id="7250078">.</span><span class="ident" id="7250079">CipherSuites</span>&nbsp;<span class="op" id="7250092">=</span>&nbsp;<span class="op" id="7250094">[</span><span class="op" id="7250095">]</span><span class="builtintype" id="7250096">uint16</span><span class="op" id="7250102">{</span><span class="ident" id="7250103">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7250133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250136">testResumeState</span><span class="op" id="7250151">(</span><span class="string" id="7250152">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7250174">,</span>&nbsp;<span class="builtintype" id="7250176">false</span><span class="op" id="7250181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250184">testResumeState</span><span class="op" id="7250199">(</span><span class="string" id="7250200">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7250230">,</span>&nbsp;<span class="builtintype" id="7250232">true</span><span class="op" id="7250236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250240">clientConfig</span><span class="op" id="7250252">.</span><span class="ident" id="7250253">ClientSessionCache</span>&nbsp;<span class="op" id="7250272">=</span>&nbsp;<span class="ident" id="7250274">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250279">testResumeState</span><span class="op" id="7250294">(</span><span class="string" id="7250295">&#34;WithoutSessionCache&#34;</span><span class="op" id="7250316">,</span>&nbsp;<span class="builtintype" id="7250318">false</span><span class="op" id="7250323">)</span><br>
<span class="lineno"></span><span class="op" id="7250325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7250328">func</span>&nbsp;<span class="ident" id="7250333">TestLRUClientSessionCache</span><span class="op" id="7250358">(</span><span class="ident" id="7250359">t</span>&nbsp;<span class="op" id="7250361">*</span><span class="ident" id="7250362">testing</span><span class="op" id="7250369">.</span><span class="ident" id="7250370">T</span><span class="op" id="7250371">)</span>&nbsp;<span class="op" id="7250373">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7250376">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250412">cache</span>&nbsp;<span class="op" id="7250418">:=</span>&nbsp;<span class="ident" id="7250421">NewLRUClientSessionCache</span><span class="op" id="7250445">(</span><span class="num" id="7250446">4</span><span class="op" id="7250447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250450">cs</span>&nbsp;<span class="op" id="7250453">:=</span>&nbsp;<span class="builtinfunc" id="7250456">make</span><span class="op" id="7250460">(</span><span class="op" id="7250461">[</span><span class="op" id="7250462">]</span><span class="ident" id="7250463">ClientSessionState</span><span class="op" id="7250481">,</span>&nbsp;<span class="num" id="7250483">6</span><span class="op" id="7250484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250487">keys</span>&nbsp;<span class="op" id="7250492">:=</span>&nbsp;<span class="op" id="7250495">[</span><span class="op" id="7250496">]</span><span class="builtintype" id="7250497">string</span><span class="op" id="7250503">{</span><span class="string" id="7250504">&#34;0&#34;</span><span class="op" id="7250507">,</span>&nbsp;<span class="string" id="7250509">&#34;1&#34;</span><span class="op" id="7250512">,</span>&nbsp;<span class="string" id="7250514">&#34;2&#34;</span><span class="op" id="7250517">,</span>&nbsp;<span class="string" id="7250519">&#34;3&#34;</span><span class="op" id="7250522">,</span>&nbsp;<span class="string" id="7250524">&#34;4&#34;</span><span class="op" id="7250527">,</span>&nbsp;<span class="string" id="7250529">&#34;5&#34;</span><span class="op" id="7250532">,</span>&nbsp;<span class="string" id="7250534">&#34;6&#34;</span><span class="op" id="7250537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7250541">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250590">for</span>&nbsp;<span class="ident" id="7250594">i</span>&nbsp;<span class="op" id="7250596">:=</span>&nbsp;<span class="num" id="7250599">0</span><span class="op" id="7250600">;</span>&nbsp;<span class="ident" id="7250602">i</span>&nbsp;<span class="op" id="7250604">&lt;</span>&nbsp;<span class="num" id="7250606">4</span><span class="op" id="7250607">;</span>&nbsp;<span class="ident" id="7250609">i</span><span class="op" id="7250610">++</span>&nbsp;<span class="op" id="7250613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250617">cache</span><span class="op" id="7250622">.</span><span class="ident" id="7250623">Put</span><span class="op" id="7250626">(</span><span class="ident" id="7250627">keys</span><span class="op" id="7250631">[</span><span class="ident" id="7250632">i</span><span class="op" id="7250633">]</span><span class="op" id="7250634">,</span>&nbsp;<span class="op" id="7250636">&amp;</span><span class="ident" id="7250637">cs</span><span class="op" id="7250639">[</span><span class="ident" id="7250640">i</span><span class="op" id="7250641">]</span><span class="op" id="7250642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250648">for</span>&nbsp;<span class="ident" id="7250652">i</span>&nbsp;<span class="op" id="7250654">:=</span>&nbsp;<span class="num" id="7250657">0</span><span class="op" id="7250658">;</span>&nbsp;<span class="ident" id="7250660">i</span>&nbsp;<span class="op" id="7250662">&lt;</span>&nbsp;<span class="num" id="7250664">4</span><span class="op" id="7250665">;</span>&nbsp;<span class="ident" id="7250667">i</span><span class="op" id="7250668">++</span>&nbsp;<span class="op" id="7250671">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250675">if</span>&nbsp;<span class="ident" id="7250678">s</span><span class="op" id="7250679">,</span>&nbsp;<span class="ident" id="7250681">ok</span>&nbsp;<span class="op" id="7250684">:=</span>&nbsp;<span class="ident" id="7250687">cache</span><span class="op" id="7250692">.</span><span class="ident" id="7250693">Get</span><span class="op" id="7250696">(</span><span class="ident" id="7250697">keys</span><span class="op" id="7250701">[</span><span class="ident" id="7250702">i</span><span class="op" id="7250703">]</span><span class="op" id="7250704">)</span><span class="op" id="7250705">;</span>&nbsp;<span class="op" id="7250707">!</span><span class="ident" id="7250708">ok</span>&nbsp;<span class="op" id="7250711">||</span>&nbsp;<span class="ident" id="7250714">s</span>&nbsp;<span class="op" id="7250716">!=</span>&nbsp;<span class="op" id="7250719">&amp;</span><span class="ident" id="7250720">cs</span><span class="op" id="7250722">[</span><span class="ident" id="7250723">i</span><span class="op" id="7250724">]</span>&nbsp;<span class="op" id="7250726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250731">t</span><span class="op" id="7250732">.</span><span class="ident" id="7250733">Fatalf</span><span class="op" id="7250739">(</span><span class="string" id="7250740">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7250787">,</span>&nbsp;<span class="ident" id="7250789">keys</span><span class="op" id="7250793">[</span><span class="ident" id="7250794">i</span><span class="op" id="7250795">]</span><span class="op" id="7250796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7250807">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250871">for</span>&nbsp;<span class="ident" id="7250875">i</span>&nbsp;<span class="op" id="7250877">:=</span>&nbsp;<span class="num" id="7250880">4</span><span class="op" id="7250881">;</span>&nbsp;<span class="ident" id="7250883">i</span>&nbsp;<span class="op" id="7250885">&lt;</span>&nbsp;<span class="num" id="7250887">6</span><span class="op" id="7250888">;</span>&nbsp;<span class="ident" id="7250890">i</span><span class="op" id="7250891">++</span>&nbsp;<span class="op" id="7250894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250898">cache</span><span class="op" id="7250903">.</span><span class="ident" id="7250904">Put</span><span class="op" id="7250907">(</span><span class="ident" id="7250908">keys</span><span class="op" id="7250912">[</span><span class="ident" id="7250913">i</span><span class="op" id="7250914">]</span><span class="op" id="7250915">,</span>&nbsp;<span class="op" id="7250917">&amp;</span><span class="ident" id="7250918">cs</span><span class="op" id="7250920">[</span><span class="ident" id="7250921">i</span><span class="op" id="7250922">]</span><span class="op" id="7250923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250929">for</span>&nbsp;<span class="ident" id="7250933">i</span>&nbsp;<span class="op" id="7250935">:=</span>&nbsp;<span class="num" id="7250938">0</span><span class="op" id="7250939">;</span>&nbsp;<span class="ident" id="7250941">i</span>&nbsp;<span class="op" id="7250943">&lt;</span>&nbsp;<span class="num" id="7250945">2</span><span class="op" id="7250946">;</span>&nbsp;<span class="ident" id="7250948">i</span><span class="op" id="7250949">++</span>&nbsp;<span class="op" id="7250952">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250956">if</span>&nbsp;<span class="ident" id="7250959">s</span><span class="op" id="7250960">,</span>&nbsp;<span class="ident" id="7250962">ok</span>&nbsp;<span class="op" id="7250965">:=</span>&nbsp;<span class="ident" id="7250968">cache</span><span class="op" id="7250973">.</span><span class="ident" id="7250974">Get</span><span class="op" id="7250977">(</span><span class="ident" id="7250978">keys</span><span class="op" id="7250982">[</span><span class="ident" id="7250983">i</span><span class="op" id="7250984">]</span><span class="op" id="7250985">)</span><span class="op" id="7250986">;</span>&nbsp;<span class="ident" id="7250988">ok</span>&nbsp;<span class="op" id="7250991">||</span>&nbsp;<span class="ident" id="7250994">s</span>&nbsp;<span class="op" id="7250996">!=</span>&nbsp;<span class="ident" id="7250999">nil</span>&nbsp;<span class="op" id="7251003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251008">t</span><span class="op" id="7251009">.</span><span class="ident" id="7251010">Fatalf</span><span class="op" id="7251016">(</span><span class="string" id="7251017">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7251060">,</span>&nbsp;<span class="ident" id="7251062">keys</span><span class="op" id="7251066">[</span><span class="ident" id="7251067">i</span><span class="op" id="7251068">]</span><span class="op" id="7251069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251080">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251124">cache</span><span class="op" id="7251129">.</span><span class="ident" id="7251130">Get</span><span class="op" id="7251133">(</span><span class="ident" id="7251134">keys</span><span class="op" id="7251138">[</span><span class="num" id="7251139">2</span><span class="op" id="7251140">]</span><span class="op" id="7251141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251144">cache</span><span class="op" id="7251149">.</span><span class="ident" id="7251150">Put</span><span class="op" id="7251153">(</span><span class="ident" id="7251154">keys</span><span class="op" id="7251158">[</span><span class="num" id="7251159">0</span><span class="op" id="7251160">]</span><span class="op" id="7251161">,</span>&nbsp;<span class="op" id="7251163">&amp;</span><span class="ident" id="7251164">cs</span><span class="op" id="7251166">[</span><span class="num" id="7251167">0</span><span class="op" id="7251168">]</span><span class="op" id="7251169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251172">if</span>&nbsp;<span class="ident" id="7251175">s</span><span class="op" id="7251176">,</span>&nbsp;<span class="ident" id="7251178">ok</span>&nbsp;<span class="op" id="7251181">:=</span>&nbsp;<span class="ident" id="7251184">cache</span><span class="op" id="7251189">.</span><span class="ident" id="7251190">Get</span><span class="op" id="7251193">(</span><span class="ident" id="7251194">keys</span><span class="op" id="7251198">[</span><span class="num" id="7251199">3</span><span class="op" id="7251200">]</span><span class="op" id="7251201">)</span><span class="op" id="7251202">;</span>&nbsp;<span class="ident" id="7251204">ok</span>&nbsp;<span class="op" id="7251207">||</span>&nbsp;<span class="ident" id="7251210">s</span>&nbsp;<span class="op" id="7251212">!=</span>&nbsp;<span class="ident" id="7251215">nil</span>&nbsp;<span class="op" id="7251219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251223">t</span><span class="op" id="7251224">.</span><span class="ident" id="7251225">Fatalf</span><span class="op" id="7251231">(</span><span class="string" id="7251232">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7251273">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251280">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251309">cache</span><span class="op" id="7251314">.</span><span class="ident" id="7251315">Put</span><span class="op" id="7251318">(</span><span class="ident" id="7251319">keys</span><span class="op" id="7251323">[</span><span class="num" id="7251324">0</span><span class="op" id="7251325">]</span><span class="op" id="7251326">,</span>&nbsp;<span class="op" id="7251328">&amp;</span><span class="ident" id="7251329">cs</span><span class="op" id="7251331">[</span><span class="num" id="7251332">3</span><span class="op" id="7251333">]</span><span class="op" id="7251334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251337">if</span>&nbsp;<span class="ident" id="7251340">s</span><span class="op" id="7251341">,</span>&nbsp;<span class="ident" id="7251343">ok</span>&nbsp;<span class="op" id="7251346">:=</span>&nbsp;<span class="ident" id="7251349">cache</span><span class="op" id="7251354">.</span><span class="ident" id="7251355">Get</span><span class="op" id="7251358">(</span><span class="ident" id="7251359">keys</span><span class="op" id="7251363">[</span><span class="num" id="7251364">0</span><span class="op" id="7251365">]</span><span class="op" id="7251366">)</span><span class="op" id="7251367">;</span>&nbsp;<span class="op" id="7251369">!</span><span class="ident" id="7251370">ok</span>&nbsp;<span class="op" id="7251373">||</span>&nbsp;<span class="ident" id="7251376">s</span>&nbsp;<span class="op" id="7251378">!=</span>&nbsp;<span class="op" id="7251381">&amp;</span><span class="ident" id="7251382">cs</span><span class="op" id="7251384">[</span><span class="num" id="7251385">3</span><span class="op" id="7251386">]</span>&nbsp;<span class="op" id="7251388">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251392">t</span><span class="op" id="7251393">.</span><span class="ident" id="7251394">Fatalf</span><span class="op" id="7251400">(</span><span class="string" id="7251401">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7251440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251447">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251480">cache</span><span class="op" id="7251485">.</span><span class="ident" id="7251486">Put</span><span class="op" id="7251489">(</span><span class="ident" id="7251490">keys</span><span class="op" id="7251494">[</span><span class="num" id="7251495">0</span><span class="op" id="7251496">]</span><span class="op" id="7251497">,</span>&nbsp;<span class="ident" id="7251499">nil</span><span class="op" id="7251502">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251505">if</span>&nbsp;<span class="ident" id="7251508">s</span><span class="op" id="7251509">,</span>&nbsp;<span class="ident" id="7251511">ok</span>&nbsp;<span class="op" id="7251514">:=</span>&nbsp;<span class="ident" id="7251517">cache</span><span class="op" id="7251522">.</span><span class="ident" id="7251523">Get</span><span class="op" id="7251526">(</span><span class="ident" id="7251527">keys</span><span class="op" id="7251531">[</span><span class="num" id="7251532">0</span><span class="op" id="7251533">]</span><span class="op" id="7251534">)</span><span class="op" id="7251535">;</span>&nbsp;<span class="op" id="7251537">!</span><span class="ident" id="7251538">ok</span>&nbsp;<span class="op" id="7251541">||</span>&nbsp;<span class="ident" id="7251544">s</span>&nbsp;<span class="op" id="7251546">!=</span>&nbsp;<span class="ident" id="7251549">nil</span>&nbsp;<span class="op" id="7251553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251557">t</span><span class="op" id="7251558">.</span><span class="ident" id="7251559">Fatalf</span><span class="op" id="7251565">(</span><span class="string" id="7251566">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7251600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251603">}</span><br>
<span class="lineno"></span><span class="op" id="7251605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7251608">func</span>&nbsp;<span class="ident" id="7251613">TestHandshakeClientALPNMatch</span><span class="op" id="7251641">(</span><span class="ident" id="7251642">t</span>&nbsp;<span class="op" id="7251644">*</span><span class="ident" id="7251645">testing</span><span class="op" id="7251652">.</span><span class="ident" id="7251653">T</span><span class="op" id="7251654">)</span>&nbsp;<span class="op" id="7251656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251659">config</span>&nbsp;<span class="op" id="7251666">:=</span>&nbsp;<span class="op" id="7251669">*</span><span class="ident" id="7251670">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251682">config</span><span class="op" id="7251688">.</span><span class="ident" id="7251689">NextProtos</span>&nbsp;<span class="op" id="7251700">=</span>&nbsp;<span class="op" id="7251702">[</span><span class="op" id="7251703">]</span><span class="builtintype" id="7251704">string</span><span class="op" id="7251710">{</span><span class="string" id="7251711">&#34;proto2&#34;</span><span class="op" id="7251719">,</span>&nbsp;<span class="string" id="7251721">&#34;proto1&#34;</span><span class="op" id="7251729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251733">test</span>&nbsp;<span class="op" id="7251738">:=</span>&nbsp;<span class="op" id="7251741">&amp;</span><span class="ident" id="7251742">clientTest</span><span class="op" id="7251752">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251756">name</span><span class="op" id="7251760">:</span>&nbsp;<span class="string" id="7251762">&#34;ALPN&#34;</span><span class="op" id="7251768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251772">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251838">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251881">command</span><span class="op" id="7251888">:</span>&nbsp;<span class="op" id="7251890">[</span><span class="op" id="7251891">]</span><span class="builtintype" id="7251892">string</span><span class="op" id="7251898">{</span><span class="string" id="7251899">&#34;openssl&#34;</span><span class="op" id="7251908">,</span>&nbsp;<span class="string" id="7251910">&#34;s_server&#34;</span><span class="op" id="7251920">,</span>&nbsp;<span class="string" id="7251922">&#34;-alpn&#34;</span><span class="op" id="7251929">,</span>&nbsp;<span class="string" id="7251931">&#34;proto1,proto2&#34;</span><span class="op" id="7251946">}</span><span class="op" id="7251947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251951">config</span><span class="op" id="7251957">:</span>&nbsp;&nbsp;<span class="op" id="7251960">&amp;</span><span class="ident" id="7251961">config</span><span class="op" id="7251967">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251971">validate</span><span class="op" id="7251979">:</span>&nbsp;<span class="keyword" id="7251981">func</span><span class="op" id="7251985">(</span><span class="ident" id="7251986">state</span>&nbsp;<span class="ident" id="7251992">ConnectionState</span><span class="op" id="7252007">)</span>&nbsp;<span class="builtintype" id="7252009">error</span>&nbsp;<span class="op" id="7252015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7252020">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252079">if</span>&nbsp;<span class="ident" id="7252082">state</span><span class="op" id="7252087">.</span><span class="ident" id="7252088">NegotiatedProtocol</span>&nbsp;<span class="op" id="7252107">!=</span>&nbsp;<span class="string" id="7252110">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7252119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252125">return</span>&nbsp;<span class="ident" id="7252132">fmt</span><span class="op" id="7252135">.</span><span class="ident" id="7252136">Errorf</span><span class="op" id="7252142">(</span><span class="string" id="7252143">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7252175">,</span>&nbsp;<span class="ident" id="7252177">state</span><span class="op" id="7252182">.</span><span class="ident" id="7252183">NegotiatedProtocol</span><span class="op" id="7252201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252206">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252211">return</span>&nbsp;<span class="ident" id="7252218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252224">}</span><span class="op" id="7252225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252231">runClientTestTLS12</span><span class="op" id="7252249">(</span><span class="ident" id="7252250">t</span><span class="op" id="7252251">,</span>&nbsp;<span class="ident" id="7252253">test</span><span class="op" id="7252257">)</span><br>
<span class="lineno"></span><span class="op" id="7252259">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7252262">func</span>&nbsp;<span class="ident" id="7252267">TestHandshakeClientALPNNoMatch</span><span class="op" id="7252297">(</span><span class="ident" id="7252298">t</span>&nbsp;<span class="op" id="7252300">*</span><span class="ident" id="7252301">testing</span><span class="op" id="7252308">.</span><span class="ident" id="7252309">T</span><span class="op" id="7252310">)</span>&nbsp;<span class="op" id="7252312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252315">config</span>&nbsp;<span class="op" id="7252322">:=</span>&nbsp;<span class="op" id="7252325">*</span><span class="ident" id="7252326">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252338">config</span><span class="op" id="7252344">.</span><span class="ident" id="7252345">NextProtos</span>&nbsp;<span class="op" id="7252356">=</span>&nbsp;<span class="op" id="7252358">[</span><span class="op" id="7252359">]</span><span class="builtintype" id="7252360">string</span><span class="op" id="7252366">{</span><span class="string" id="7252367">&#34;proto3&#34;</span><span class="op" id="7252375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252379">test</span>&nbsp;<span class="op" id="7252384">:=</span>&nbsp;<span class="op" id="7252387">&amp;</span><span class="ident" id="7252388">clientTest</span><span class="op" id="7252398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252402">name</span><span class="op" id="7252406">:</span>&nbsp;<span class="string" id="7252408">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7252422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7252426">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7252492">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252535">command</span><span class="op" id="7252542">:</span>&nbsp;<span class="op" id="7252544">[</span><span class="op" id="7252545">]</span><span class="builtintype" id="7252546">string</span><span class="op" id="7252552">{</span><span class="string" id="7252553">&#34;openssl&#34;</span><span class="op" id="7252562">,</span>&nbsp;<span class="string" id="7252564">&#34;s_server&#34;</span><span class="op" id="7252574">,</span>&nbsp;<span class="string" id="7252576">&#34;-alpn&#34;</span><span class="op" id="7252583">,</span>&nbsp;<span class="string" id="7252585">&#34;proto1,proto2&#34;</span><span class="op" id="7252600">}</span><span class="op" id="7252601">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252605">config</span><span class="op" id="7252611">:</span>&nbsp;&nbsp;<span class="op" id="7252614">&amp;</span><span class="ident" id="7252615">config</span><span class="op" id="7252621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252625">validate</span><span class="op" id="7252633">:</span>&nbsp;<span class="keyword" id="7252635">func</span><span class="op" id="7252639">(</span><span class="ident" id="7252640">state</span>&nbsp;<span class="ident" id="7252646">ConnectionState</span><span class="op" id="7252661">)</span>&nbsp;<span class="builtintype" id="7252663">error</span>&nbsp;<span class="op" id="7252669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7252674">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252738">if</span>&nbsp;<span class="ident" id="7252741">state</span><span class="op" id="7252746">.</span><span class="ident" id="7252747">NegotiatedProtocol</span>&nbsp;<span class="op" id="7252766">!=</span>&nbsp;<span class="string" id="7252769">&#34;&#34;</span>&nbsp;<span class="op" id="7252772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252778">return</span>&nbsp;<span class="ident" id="7252785">fmt</span><span class="op" id="7252788">.</span><span class="ident" id="7252789">Errorf</span><span class="op" id="7252795">(</span><span class="string" id="7252796">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7252824">,</span>&nbsp;<span class="ident" id="7252826">state</span><span class="op" id="7252831">.</span><span class="ident" id="7252832">NegotiatedProtocol</span><span class="op" id="7252850">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252860">return</span>&nbsp;<span class="ident" id="7252867">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252873">}</span><span class="op" id="7252874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252880">runClientTestTLS12</span><span class="op" id="7252898">(</span><span class="ident" id="7252899">t</span><span class="op" id="7252900">,</span>&nbsp;<span class="ident" id="7252902">test</span><span class="op" id="7252906">)</span><br>
<span class="lineno">490</span><span class="op" id="7252908">}</span>
</div>
</body>
</html>
