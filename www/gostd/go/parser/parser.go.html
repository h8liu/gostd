<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4101812">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4101867">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4101921">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4101972">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4102044">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4102118">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4102193">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4102251">//</span><br>
<span class="lineno">10</span><span class="keyword" id="4102254">package</span>&nbsp;<span class="ident" id="4102262">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4102270">import</span>&nbsp;<span class="op" id="4102277">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102280">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102287">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102297">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102311">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102323">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102334">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102345">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4102355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4102358">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4102417">type</span>&nbsp;<span class="ident" id="4102422">parser</span>&nbsp;<span class="keyword" id="4102429">struct</span>&nbsp;<span class="op" id="4102436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102439">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102447">*</span><span class="ident" id="4102448">token</span><span class="op" id="4102453">.</span><span class="ident" id="4102454">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102460">errors</span>&nbsp;&nbsp;<span class="ident" id="4102468">scanner</span><span class="op" id="4102475">.</span><span class="ident" id="4102476">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102487">scanner</span>&nbsp;<span class="ident" id="4102495">scanner</span><span class="op" id="4102502">.</span><span class="ident" id="4102503">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102513">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102535">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4102542">Mode</span>&nbsp;<span class="comment" id="4102547">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102564">trace</span>&nbsp;&nbsp;<span class="builtintype" id="4102571">bool</span>&nbsp;<span class="comment" id="4102576">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102603">indent</span>&nbsp;<span class="builtintype" id="4102610">int</span>&nbsp;&nbsp;<span class="comment" id="4102615">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102656">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102669">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102681">[</span><span class="op" id="4102682">]</span><span class="op" id="4102683">*</span><span class="ident" id="4102684">ast</span><span class="op" id="4102687">.</span><span class="ident" id="4102688">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102702">leadComment</span>&nbsp;<span class="op" id="4102714">*</span><span class="ident" id="4102715">ast</span><span class="op" id="4102718">.</span><span class="ident" id="4102719">CommentGroup</span>&nbsp;<span class="comment" id="4102732">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102754">lineComment</span>&nbsp;<span class="op" id="4102766">*</span><span class="ident" id="4102767">ast</span><span class="op" id="4102770">.</span><span class="ident" id="4102771">CommentGroup</span>&nbsp;<span class="comment" id="4102784">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102807">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102822">pos</span>&nbsp;<span class="ident" id="4102826">token</span><span class="op" id="4102831">.</span><span class="ident" id="4102832">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4102838">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102857">tok</span>&nbsp;<span class="ident" id="4102861">token</span><span class="op" id="4102866">.</span><span class="ident" id="4102867">Token</span>&nbsp;<span class="comment" id="4102873">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102898">lit</span>&nbsp;<span class="builtintype" id="4102902">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102914">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102933">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102952">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103012">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103072">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103138">syncPos</span>&nbsp;<span class="ident" id="4103146">token</span><span class="op" id="4103151">.</span><span class="ident" id="4103152">Pos</span>&nbsp;<span class="comment" id="4103156">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103190">syncCnt</span>&nbsp;<span class="builtintype" id="4103198">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103208">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103257">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103290">exprLev</span>&nbsp;<span class="builtintype" id="4103298">int</span>&nbsp;&nbsp;<span class="comment" id="4103303">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103351">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4103359">bool</span>&nbsp;<span class="comment" id="4103364">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103416">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103447">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4103458">*</span><span class="ident" id="4103459">ast</span><span class="op" id="4103462">.</span><span class="ident" id="4103463">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103476">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103502">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4103513">*</span><span class="ident" id="4103514">ast</span><span class="op" id="4103517">.</span><span class="ident" id="4103518">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103531">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103567">unresolved</span>&nbsp;<span class="op" id="4103578">[</span><span class="op" id="4103579">]</span><span class="op" id="4103580">*</span><span class="ident" id="4103581">ast</span><span class="op" id="4103584">.</span><span class="ident" id="4103585">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103596">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103623">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103634">[</span><span class="op" id="4103635">]</span><span class="op" id="4103636">*</span><span class="ident" id="4103637">ast</span><span class="op" id="4103640">.</span><span class="ident" id="4103641">ImportSpec</span>&nbsp;<span class="comment" id="4103652">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103673">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4103690">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103732">labelScope</span>&nbsp;&nbsp;<span class="op" id="4103744">*</span><span class="ident" id="4103745">ast</span><span class="op" id="4103748">.</span><span class="ident" id="4103749">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103759">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103796">targetStack</span>&nbsp;<span class="op" id="4103808">[</span><span class="op" id="4103809">]</span><span class="op" id="4103810">[</span><span class="op" id="4103811">]</span><span class="op" id="4103812">*</span><span class="ident" id="4103813">ast</span><span class="op" id="4103816">.</span><span class="ident" id="4103817">Ident</span>&nbsp;<span class="comment" id="4103823">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="4103853">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4103856">func</span>&nbsp;<span class="op" id="4103861">(</span><span class="ident" id="4103862">p</span>&nbsp;<span class="op" id="4103864">*</span><span class="ident" id="4103865">parser</span><span class="op" id="4103871">)</span>&nbsp;<span class="ident" id="4103873">init</span><span class="op" id="4103877">(</span><span class="ident" id="4103878">fset</span>&nbsp;<span class="op" id="4103883">*</span><span class="ident" id="4103884">token</span><span class="op" id="4103889">.</span><span class="ident" id="4103890">FileSet</span><span class="op" id="4103897">,</span>&nbsp;<span class="ident" id="4103899">filename</span>&nbsp;<span class="builtintype" id="4103908">string</span><span class="op" id="4103914">,</span>&nbsp;<span class="ident" id="4103916">src</span>&nbsp;<span class="op" id="4103920">[</span><span class="op" id="4103921">]</span><span class="builtintype" id="4103922">byte</span><span class="op" id="4103926">,</span>&nbsp;<span class="ident" id="4103928">mode</span>&nbsp;<span class="ident" id="4103933">Mode</span><span class="op" id="4103937">)</span>&nbsp;<span class="op" id="4103939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103942">p</span><span class="op" id="4103943">.</span><span class="ident" id="4103944">file</span>&nbsp;<span class="op" id="4103949">=</span>&nbsp;<span class="ident" id="4103951">fset</span><span class="op" id="4103955">.</span><span class="ident" id="4103956">AddFile</span><span class="op" id="4103963">(</span><span class="ident" id="4103964">filename</span><span class="op" id="4103972">,</span>&nbsp;<span class="op" id="4103974">-</span><span class="num" id="4103975">1</span><span class="op" id="4103976">,</span>&nbsp;<span class="builtinfunc" id="4103978">len</span><span class="op" id="4103981">(</span><span class="ident" id="4103982">src</span><span class="op" id="4103985">)</span><span class="op" id="4103986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103989">var</span>&nbsp;<span class="ident" id="4103993">m</span>&nbsp;<span class="ident" id="4103995">scanner</span><span class="op" id="4104002">.</span><span class="ident" id="4104003">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104009">if</span>&nbsp;<span class="ident" id="4104012">mode</span><span class="op" id="4104016">&amp;</span><span class="ident" id="4104017">ParseComments</span>&nbsp;<span class="op" id="4104031">!=</span>&nbsp;<span class="num" id="4104034">0</span>&nbsp;<span class="op" id="4104036">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104040">m</span>&nbsp;<span class="op" id="4104042">=</span>&nbsp;<span class="ident" id="4104044">scanner</span><span class="op" id="4104051">.</span><span class="ident" id="4104052">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104069">eh</span>&nbsp;<span class="op" id="4104072">:=</span>&nbsp;<span class="keyword" id="4104075">func</span><span class="op" id="4104079">(</span><span class="ident" id="4104080">pos</span>&nbsp;<span class="ident" id="4104084">token</span><span class="op" id="4104089">.</span><span class="ident" id="4104090">Position</span><span class="op" id="4104098">,</span>&nbsp;<span class="ident" id="4104100">msg</span>&nbsp;<span class="builtintype" id="4104104">string</span><span class="op" id="4104110">)</span>&nbsp;<span class="op" id="4104112">{</span>&nbsp;<span class="ident" id="4104114">p</span><span class="op" id="4104115">.</span><span class="ident" id="4104116">errors</span><span class="op" id="4104122">.</span><span class="ident" id="4104123">Add</span><span class="op" id="4104126">(</span><span class="ident" id="4104127">pos</span><span class="op" id="4104130">,</span>&nbsp;<span class="ident" id="4104132">msg</span><span class="op" id="4104135">)</span>&nbsp;<span class="op" id="4104137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104140">p</span><span class="op" id="4104141">.</span><span class="ident" id="4104142">scanner</span><span class="op" id="4104149">.</span><span class="ident" id="4104150">Init</span><span class="op" id="4104154">(</span><span class="ident" id="4104155">p</span><span class="op" id="4104156">.</span><span class="ident" id="4104157">file</span><span class="op" id="4104161">,</span>&nbsp;<span class="ident" id="4104163">src</span><span class="op" id="4104166">,</span>&nbsp;<span class="ident" id="4104168">eh</span><span class="op" id="4104170">,</span>&nbsp;<span class="ident" id="4104172">m</span><span class="op" id="4104173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104177">p</span><span class="op" id="4104178">.</span><span class="ident" id="4104179">mode</span>&nbsp;<span class="op" id="4104184">=</span>&nbsp;<span class="ident" id="4104186">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104192">p</span><span class="op" id="4104193">.</span><span class="ident" id="4104194">trace</span>&nbsp;<span class="op" id="4104200">=</span>&nbsp;<span class="ident" id="4104202">mode</span><span class="op" id="4104206">&amp;</span><span class="ident" id="4104207">Trace</span>&nbsp;<span class="op" id="4104213">!=</span>&nbsp;<span class="num" id="4104216">0</span>&nbsp;<span class="comment" id="4104218">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104268">p</span><span class="op" id="4104269">.</span><span class="ident" id="4104270">next</span><span class="op" id="4104274">(</span><span class="op" id="4104275">)</span><br>
<span class="lineno"></span><span class="op" id="4104277">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4104280">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4104360">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4104380">func</span>&nbsp;<span class="op" id="4104385">(</span><span class="ident" id="4104386">p</span>&nbsp;<span class="op" id="4104388">*</span><span class="ident" id="4104389">parser</span><span class="op" id="4104395">)</span>&nbsp;<span class="ident" id="4104397">openScope</span><span class="op" id="4104406">(</span><span class="op" id="4104407">)</span>&nbsp;<span class="op" id="4104409">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104412">p</span><span class="op" id="4104413">.</span><span class="ident" id="4104414">topScope</span>&nbsp;<span class="op" id="4104423">=</span>&nbsp;<span class="ident" id="4104425">ast</span><span class="op" id="4104428">.</span><span class="ident" id="4104429">NewScope</span><span class="op" id="4104437">(</span><span class="ident" id="4104438">p</span><span class="op" id="4104439">.</span><span class="ident" id="4104440">topScope</span><span class="op" id="4104448">)</span><br>
<span class="lineno"></span><span class="op" id="4104450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4104453">func</span>&nbsp;<span class="op" id="4104458">(</span><span class="ident" id="4104459">p</span>&nbsp;<span class="op" id="4104461">*</span><span class="ident" id="4104462">parser</span><span class="op" id="4104468">)</span>&nbsp;<span class="ident" id="4104470">closeScope</span><span class="op" id="4104480">(</span><span class="op" id="4104481">)</span>&nbsp;<span class="op" id="4104483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104486">p</span><span class="op" id="4104487">.</span><span class="ident" id="4104488">topScope</span>&nbsp;<span class="op" id="4104497">=</span>&nbsp;<span class="ident" id="4104499">p</span><span class="op" id="4104500">.</span><span class="ident" id="4104501">topScope</span><span class="op" id="4104509">.</span><span class="ident" id="4104510">Outer</span><br>
<span class="lineno">90</span><span class="op" id="4104516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4104519">func</span>&nbsp;<span class="op" id="4104524">(</span><span class="ident" id="4104525">p</span>&nbsp;<span class="op" id="4104527">*</span><span class="ident" id="4104528">parser</span><span class="op" id="4104534">)</span>&nbsp;<span class="ident" id="4104536">openLabelScope</span><span class="op" id="4104550">(</span><span class="op" id="4104551">)</span>&nbsp;<span class="op" id="4104553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104556">p</span><span class="op" id="4104557">.</span><span class="ident" id="4104558">labelScope</span>&nbsp;<span class="op" id="4104569">=</span>&nbsp;<span class="ident" id="4104571">ast</span><span class="op" id="4104574">.</span><span class="ident" id="4104575">NewScope</span><span class="op" id="4104583">(</span><span class="ident" id="4104584">p</span><span class="op" id="4104585">.</span><span class="ident" id="4104586">labelScope</span><span class="op" id="4104596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104599">p</span><span class="op" id="4104600">.</span><span class="ident" id="4104601">targetStack</span>&nbsp;<span class="op" id="4104613">=</span>&nbsp;<span class="builtinfunc" id="4104615">append</span><span class="op" id="4104621">(</span><span class="ident" id="4104622">p</span><span class="op" id="4104623">.</span><span class="ident" id="4104624">targetStack</span><span class="op" id="4104635">,</span>&nbsp;<span class="ident" id="4104637">nil</span><span class="op" id="4104640">)</span><br>
<span class="lineno">95</span><span class="op" id="4104642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4104645">func</span>&nbsp;<span class="op" id="4104650">(</span><span class="ident" id="4104651">p</span>&nbsp;<span class="op" id="4104653">*</span><span class="ident" id="4104654">parser</span><span class="op" id="4104660">)</span>&nbsp;<span class="ident" id="4104662">closeLabelScope</span><span class="op" id="4104677">(</span><span class="op" id="4104678">)</span>&nbsp;<span class="op" id="4104680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4104683">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104702">n</span>&nbsp;<span class="op" id="4104704">:=</span>&nbsp;<span class="builtinfunc" id="4104707">len</span><span class="op" id="4104710">(</span><span class="ident" id="4104711">p</span><span class="op" id="4104712">.</span><span class="ident" id="4104713">targetStack</span><span class="op" id="4104724">)</span>&nbsp;<span class="op" id="4104726">-</span>&nbsp;<span class="num" id="4104728">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104731">scope</span>&nbsp;<span class="op" id="4104737">:=</span>&nbsp;<span class="ident" id="4104740">p</span><span class="op" id="4104741">.</span><span class="ident" id="4104742">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104754">for</span>&nbsp;<span class="ident" id="4104758">_</span><span class="op" id="4104759">,</span>&nbsp;<span class="ident" id="4104761">ident</span>&nbsp;<span class="op" id="4104767">:=</span>&nbsp;<span class="keyword" id="4104770">range</span>&nbsp;<span class="ident" id="4104776">p</span><span class="op" id="4104777">.</span><span class="ident" id="4104778">targetStack</span><span class="op" id="4104789">[</span><span class="ident" id="4104790">n</span><span class="op" id="4104791">]</span>&nbsp;<span class="op" id="4104793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104797">ident</span><span class="op" id="4104802">.</span><span class="ident" id="4104803">Obj</span>&nbsp;<span class="op" id="4104807">=</span>&nbsp;<span class="ident" id="4104809">scope</span><span class="op" id="4104814">.</span><span class="ident" id="4104815">Lookup</span><span class="op" id="4104821">(</span><span class="ident" id="4104822">ident</span><span class="op" id="4104827">.</span><span class="ident" id="4104828">Name</span><span class="op" id="4104832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104836">if</span>&nbsp;<span class="ident" id="4104839">ident</span><span class="op" id="4104844">.</span><span class="ident" id="4104845">Obj</span>&nbsp;<span class="op" id="4104849">==</span>&nbsp;<span class="ident" id="4104852">nil</span>&nbsp;<span class="op" id="4104856">&amp;&amp;</span>&nbsp;<span class="ident" id="4104859">p</span><span class="op" id="4104860">.</span><span class="ident" id="4104861">mode</span><span class="op" id="4104865">&amp;</span><span class="ident" id="4104866">DeclarationErrors</span>&nbsp;<span class="op" id="4104884">!=</span>&nbsp;<span class="num" id="4104887">0</span>&nbsp;<span class="op" id="4104889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104894">p</span><span class="op" id="4104895">.</span><span class="builtintype" id="4104896">error</span><span class="op" id="4104901">(</span><span class="ident" id="4104902">ident</span><span class="op" id="4104907">.</span><span class="ident" id="4104908">Pos</span><span class="op" id="4104911">(</span><span class="op" id="4104912">)</span><span class="op" id="4104913">,</span>&nbsp;<span class="ident" id="4104915">fmt</span><span class="op" id="4104918">.</span><span class="ident" id="4104919">Sprintf</span><span class="op" id="4104926">(</span><span class="string" id="4104927">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="4104947">,</span>&nbsp;<span class="ident" id="4104949">ident</span><span class="op" id="4104954">.</span><span class="ident" id="4104955">Name</span><span class="op" id="4104959">)</span><span class="op" id="4104960">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4104970">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104990">p</span><span class="op" id="4104991">.</span><span class="ident" id="4104992">targetStack</span>&nbsp;<span class="op" id="4105004">=</span>&nbsp;<span class="ident" id="4105006">p</span><span class="op" id="4105007">.</span><span class="ident" id="4105008">targetStack</span><span class="op" id="4105019">[</span><span class="num" id="4105020">0</span><span class="op" id="4105021">:</span><span class="ident" id="4105022">n</span><span class="op" id="4105023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105026">p</span><span class="op" id="4105027">.</span><span class="ident" id="4105028">labelScope</span>&nbsp;<span class="op" id="4105039">=</span>&nbsp;<span class="ident" id="4105041">p</span><span class="op" id="4105042">.</span><span class="ident" id="4105043">labelScope</span><span class="op" id="4105053">.</span><span class="ident" id="4105054">Outer</span><br>
<span class="lineno">110</span><span class="op" id="4105060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4105063">func</span>&nbsp;<span class="op" id="4105068">(</span><span class="ident" id="4105069">p</span>&nbsp;<span class="op" id="4105071">*</span><span class="ident" id="4105072">parser</span><span class="op" id="4105078">)</span>&nbsp;<span class="ident" id="4105080">declare</span><span class="op" id="4105087">(</span><span class="ident" id="4105088">decl</span><span class="op" id="4105092">,</span>&nbsp;<span class="ident" id="4105094">data</span>&nbsp;<span class="keyword" id="4105099">interface</span><span class="op" id="4105108">{</span><span class="op" id="4105109">}</span><span class="op" id="4105110">,</span>&nbsp;<span class="ident" id="4105112">scope</span>&nbsp;<span class="op" id="4105118">*</span><span class="ident" id="4105119">ast</span><span class="op" id="4105122">.</span><span class="ident" id="4105123">Scope</span><span class="op" id="4105128">,</span>&nbsp;<span class="ident" id="4105130">kind</span>&nbsp;<span class="ident" id="4105135">ast</span><span class="op" id="4105138">.</span><span class="ident" id="4105139">ObjKind</span><span class="op" id="4105146">,</span>&nbsp;<span class="ident" id="4105148">idents</span>&nbsp;<span class="op" id="4105155">...</span><span class="op" id="4105158">*</span><span class="ident" id="4105159">ast</span><span class="op" id="4105162">.</span><span class="ident" id="4105163">Ident</span><span class="op" id="4105168">)</span>&nbsp;<span class="op" id="4105170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105173">for</span>&nbsp;<span class="ident" id="4105177">_</span><span class="op" id="4105178">,</span>&nbsp;<span class="ident" id="4105180">ident</span>&nbsp;<span class="op" id="4105186">:=</span>&nbsp;<span class="keyword" id="4105189">range</span>&nbsp;<span class="ident" id="4105195">idents</span>&nbsp;<span class="op" id="4105202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105206">assert</span><span class="op" id="4105212">(</span><span class="ident" id="4105213">ident</span><span class="op" id="4105218">.</span><span class="ident" id="4105219">Obj</span>&nbsp;<span class="op" id="4105223">==</span>&nbsp;<span class="ident" id="4105226">nil</span><span class="op" id="4105229">,</span>&nbsp;<span class="string" id="4105231">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4105272">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105276">obj</span>&nbsp;<span class="op" id="4105280">:=</span>&nbsp;<span class="ident" id="4105283">ast</span><span class="op" id="4105286">.</span><span class="ident" id="4105287">NewObj</span><span class="op" id="4105293">(</span><span class="ident" id="4105294">kind</span><span class="op" id="4105298">,</span>&nbsp;<span class="ident" id="4105300">ident</span><span class="op" id="4105305">.</span><span class="ident" id="4105306">Name</span><span class="op" id="4105310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105314">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105376">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105438">obj</span><span class="op" id="4105441">.</span><span class="ident" id="4105442">Decl</span>&nbsp;<span class="op" id="4105447">=</span>&nbsp;<span class="ident" id="4105449">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105456">obj</span><span class="op" id="4105459">.</span><span class="ident" id="4105460">Data</span>&nbsp;<span class="op" id="4105465">=</span>&nbsp;<span class="ident" id="4105467">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105474">ident</span><span class="op" id="4105479">.</span><span class="ident" id="4105480">Obj</span>&nbsp;<span class="op" id="4105484">=</span>&nbsp;<span class="ident" id="4105486">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105492">if</span>&nbsp;<span class="ident" id="4105495">ident</span><span class="op" id="4105500">.</span><span class="ident" id="4105501">Name</span>&nbsp;<span class="op" id="4105506">!=</span>&nbsp;<span class="string" id="4105509">&#34;_&#34;</span>&nbsp;<span class="op" id="4105513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105518">if</span>&nbsp;<span class="ident" id="4105521">alt</span>&nbsp;<span class="op" id="4105525">:=</span>&nbsp;<span class="ident" id="4105528">scope</span><span class="op" id="4105533">.</span><span class="ident" id="4105534">Insert</span><span class="op" id="4105540">(</span><span class="ident" id="4105541">obj</span><span class="op" id="4105544">)</span><span class="op" id="4105545">;</span>&nbsp;<span class="ident" id="4105547">alt</span>&nbsp;<span class="op" id="4105551">!=</span>&nbsp;<span class="ident" id="4105554">nil</span>&nbsp;<span class="op" id="4105558">&amp;&amp;</span>&nbsp;<span class="ident" id="4105561">p</span><span class="op" id="4105562">.</span><span class="ident" id="4105563">mode</span><span class="op" id="4105567">&amp;</span><span class="ident" id="4105568">DeclarationErrors</span>&nbsp;<span class="op" id="4105586">!=</span>&nbsp;<span class="num" id="4105589">0</span>&nbsp;<span class="op" id="4105591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105597">prevDecl</span>&nbsp;<span class="op" id="4105606">:=</span>&nbsp;<span class="string" id="4105609">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105616">if</span>&nbsp;<span class="ident" id="4105619">pos</span>&nbsp;<span class="op" id="4105623">:=</span>&nbsp;<span class="ident" id="4105626">alt</span><span class="op" id="4105629">.</span><span class="ident" id="4105630">Pos</span><span class="op" id="4105633">(</span><span class="op" id="4105634">)</span><span class="op" id="4105635">;</span>&nbsp;<span class="ident" id="4105637">pos</span><span class="op" id="4105640">.</span><span class="ident" id="4105641">IsValid</span><span class="op" id="4105648">(</span><span class="op" id="4105649">)</span>&nbsp;<span class="op" id="4105651">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105658">prevDecl</span>&nbsp;<span class="op" id="4105667">=</span>&nbsp;<span class="ident" id="4105669">fmt</span><span class="op" id="4105672">.</span><span class="ident" id="4105673">Sprintf</span><span class="op" id="4105680">(</span><span class="string" id="4105681">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="4105713">,</span>&nbsp;<span class="ident" id="4105715">p</span><span class="op" id="4105716">.</span><span class="ident" id="4105717">file</span><span class="op" id="4105721">.</span><span class="ident" id="4105722">Position</span><span class="op" id="4105730">(</span><span class="ident" id="4105731">pos</span><span class="op" id="4105734">)</span><span class="op" id="4105735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105747">p</span><span class="op" id="4105748">.</span><span class="builtintype" id="4105749">error</span><span class="op" id="4105754">(</span><span class="ident" id="4105755">ident</span><span class="op" id="4105760">.</span><span class="ident" id="4105761">Pos</span><span class="op" id="4105764">(</span><span class="op" id="4105765">)</span><span class="op" id="4105766">,</span>&nbsp;<span class="ident" id="4105768">fmt</span><span class="op" id="4105771">.</span><span class="ident" id="4105772">Sprintf</span><span class="op" id="4105779">(</span><span class="string" id="4105780">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="4105811">,</span>&nbsp;<span class="ident" id="4105813">ident</span><span class="op" id="4105818">.</span><span class="ident" id="4105819">Name</span><span class="op" id="4105823">,</span>&nbsp;<span class="ident" id="4105825">prevDecl</span><span class="op" id="4105833">)</span><span class="op" id="4105834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105843">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105846">}</span><br>
<span class="lineno"></span><span class="op" id="4105848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4105851">func</span>&nbsp;<span class="op" id="4105856">(</span><span class="ident" id="4105857">p</span>&nbsp;<span class="op" id="4105859">*</span><span class="ident" id="4105860">parser</span><span class="op" id="4105866">)</span>&nbsp;<span class="ident" id="4105868">shortVarDecl</span><span class="op" id="4105880">(</span><span class="ident" id="4105881">decl</span>&nbsp;<span class="op" id="4105886">*</span><span class="ident" id="4105887">ast</span><span class="op" id="4105890">.</span><span class="ident" id="4105891">AssignStmt</span><span class="op" id="4105901">,</span>&nbsp;<span class="ident" id="4105903">list</span>&nbsp;<span class="op" id="4105908">[</span><span class="op" id="4105909">]</span><span class="ident" id="4105910">ast</span><span class="op" id="4105913">.</span><span class="ident" id="4105914">Expr</span><span class="op" id="4105918">)</span>&nbsp;<span class="op" id="4105920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105923">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4105989">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106055">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106126">n</span>&nbsp;<span class="op" id="4106128">:=</span>&nbsp;<span class="num" id="4106131">0</span>&nbsp;<span class="comment" id="4106133">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106161">for</span>&nbsp;<span class="ident" id="4106165">_</span><span class="op" id="4106166">,</span>&nbsp;<span class="ident" id="4106168">x</span>&nbsp;<span class="op" id="4106170">:=</span>&nbsp;<span class="keyword" id="4106173">range</span>&nbsp;<span class="ident" id="4106179">list</span>&nbsp;<span class="op" id="4106184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106188">if</span>&nbsp;<span class="ident" id="4106191">ident</span><span class="op" id="4106196">,</span>&nbsp;<span class="ident" id="4106198">isIdent</span>&nbsp;<span class="op" id="4106206">:=</span>&nbsp;<span class="ident" id="4106209">x</span><span class="op" id="4106210">.</span><span class="op" id="4106211">(</span><span class="op" id="4106212">*</span><span class="ident" id="4106213">ast</span><span class="op" id="4106216">.</span><span class="ident" id="4106217">Ident</span><span class="op" id="4106222">)</span><span class="op" id="4106223">;</span>&nbsp;<span class="ident" id="4106225">isIdent</span>&nbsp;<span class="op" id="4106233">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106238">assert</span><span class="op" id="4106244">(</span><span class="ident" id="4106245">ident</span><span class="op" id="4106250">.</span><span class="ident" id="4106251">Obj</span>&nbsp;<span class="op" id="4106255">==</span>&nbsp;<span class="ident" id="4106258">nil</span><span class="op" id="4106261">,</span>&nbsp;<span class="string" id="4106263">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4106304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106309">obj</span>&nbsp;<span class="op" id="4106313">:=</span>&nbsp;<span class="ident" id="4106316">ast</span><span class="op" id="4106319">.</span><span class="ident" id="4106320">NewObj</span><span class="op" id="4106326">(</span><span class="ident" id="4106327">ast</span><span class="op" id="4106330">.</span><span class="ident" id="4106331">Var</span><span class="op" id="4106334">,</span>&nbsp;<span class="ident" id="4106336">ident</span><span class="op" id="4106341">.</span><span class="ident" id="4106342">Name</span><span class="op" id="4106346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106351">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106407">obj</span><span class="op" id="4106410">.</span><span class="ident" id="4106411">Decl</span>&nbsp;<span class="op" id="4106416">=</span>&nbsp;<span class="ident" id="4106418">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106426">ident</span><span class="op" id="4106431">.</span><span class="ident" id="4106432">Obj</span>&nbsp;<span class="op" id="4106436">=</span>&nbsp;<span class="ident" id="4106438">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106445">if</span>&nbsp;<span class="ident" id="4106448">ident</span><span class="op" id="4106453">.</span><span class="ident" id="4106454">Name</span>&nbsp;<span class="op" id="4106459">!=</span>&nbsp;<span class="string" id="4106462">&#34;_&#34;</span>&nbsp;<span class="op" id="4106466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106472">if</span>&nbsp;<span class="ident" id="4106475">alt</span>&nbsp;<span class="op" id="4106479">:=</span>&nbsp;<span class="ident" id="4106482">p</span><span class="op" id="4106483">.</span><span class="ident" id="4106484">topScope</span><span class="op" id="4106492">.</span><span class="ident" id="4106493">Insert</span><span class="op" id="4106499">(</span><span class="ident" id="4106500">obj</span><span class="op" id="4106503">)</span><span class="op" id="4106504">;</span>&nbsp;<span class="ident" id="4106506">alt</span>&nbsp;<span class="op" id="4106510">!=</span>&nbsp;<span class="ident" id="4106513">nil</span>&nbsp;<span class="op" id="4106517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106524">ident</span><span class="op" id="4106529">.</span><span class="ident" id="4106530">Obj</span>&nbsp;<span class="op" id="4106534">=</span>&nbsp;<span class="ident" id="4106536">alt</span>&nbsp;<span class="comment" id="4106540">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106561">}</span>&nbsp;<span class="keyword" id="4106563">else</span>&nbsp;<span class="op" id="4106568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106575">n</span><span class="op" id="4106576">++</span>&nbsp;<span class="comment" id="4106579">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106611">}</span>&nbsp;<span class="keyword" id="4106613">else</span>&nbsp;<span class="op" id="4106618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106623">p</span><span class="op" id="4106624">.</span><span class="ident" id="4106625">errorExpected</span><span class="op" id="4106638">(</span><span class="ident" id="4106639">x</span><span class="op" id="4106640">.</span><span class="ident" id="4106641">Pos</span><span class="op" id="4106644">(</span><span class="op" id="4106645">)</span><span class="op" id="4106646">,</span>&nbsp;<span class="string" id="4106648">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4106679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106683">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106689">if</span>&nbsp;<span class="ident" id="4106692">n</span>&nbsp;<span class="op" id="4106694">==</span>&nbsp;<span class="num" id="4106697">0</span>&nbsp;<span class="op" id="4106699">&amp;&amp;</span>&nbsp;<span class="ident" id="4106702">p</span><span class="op" id="4106703">.</span><span class="ident" id="4106704">mode</span><span class="op" id="4106708">&amp;</span><span class="ident" id="4106709">DeclarationErrors</span>&nbsp;<span class="op" id="4106727">!=</span>&nbsp;<span class="num" id="4106730">0</span>&nbsp;<span class="op" id="4106732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106736">p</span><span class="op" id="4106737">.</span><span class="builtintype" id="4106738">error</span><span class="op" id="4106743">(</span><span class="ident" id="4106744">list</span><span class="op" id="4106748">[</span><span class="num" id="4106749">0</span><span class="op" id="4106750">]</span><span class="op" id="4106751">.</span><span class="ident" id="4106752">Pos</span><span class="op" id="4106755">(</span><span class="op" id="4106756">)</span><span class="op" id="4106757">,</span>&nbsp;<span class="string" id="4106759">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4106796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106799">}</span><br>
<span class="lineno"></span><span class="op" id="4106801">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="4106804">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4106884">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="4106966">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="4106991">var</span>&nbsp;<span class="ident" id="4106995">unresolved</span>&nbsp;<span class="op" id="4107006">=</span>&nbsp;<span class="builtinfunc" id="4107008">new</span><span class="op" id="4107011">(</span><span class="ident" id="4107012">ast</span><span class="op" id="4107015">.</span><span class="ident" id="4107016">Object</span><span class="op" id="4107022">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4107025">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4107098">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4107171">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="4107245">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="4107261">//</span><br>
<span class="lineno"></span><span class="keyword" id="4107264">func</span>&nbsp;<span class="op" id="4107269">(</span><span class="ident" id="4107270">p</span>&nbsp;<span class="op" id="4107272">*</span><span class="ident" id="4107273">parser</span><span class="op" id="4107279">)</span>&nbsp;<span class="ident" id="4107281">tryResolve</span><span class="op" id="4107291">(</span><span class="ident" id="4107292">x</span>&nbsp;<span class="ident" id="4107294">ast</span><span class="op" id="4107297">.</span><span class="ident" id="4107298">Expr</span><span class="op" id="4107302">,</span>&nbsp;<span class="ident" id="4107304">collectUnresolved</span>&nbsp;<span class="builtintype" id="4107322">bool</span><span class="op" id="4107326">)</span>&nbsp;<span class="op" id="4107328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107331">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107399">ident</span><span class="op" id="4107404">,</span>&nbsp;<span class="ident" id="4107406">_</span>&nbsp;<span class="op" id="4107408">:=</span>&nbsp;<span class="ident" id="4107411">x</span><span class="op" id="4107412">.</span><span class="op" id="4107413">(</span><span class="op" id="4107414">*</span><span class="ident" id="4107415">ast</span><span class="op" id="4107418">.</span><span class="ident" id="4107419">Ident</span><span class="op" id="4107424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107427">if</span>&nbsp;<span class="ident" id="4107430">ident</span>&nbsp;<span class="op" id="4107436">==</span>&nbsp;<span class="ident" id="4107439">nil</span>&nbsp;<span class="op" id="4107443">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107447">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107458">assert</span><span class="op" id="4107464">(</span><span class="ident" id="4107465">ident</span><span class="op" id="4107470">.</span><span class="ident" id="4107471">Obj</span>&nbsp;<span class="op" id="4107475">==</span>&nbsp;<span class="ident" id="4107478">nil</span><span class="op" id="4107481">,</span>&nbsp;<span class="string" id="4107483">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4107524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107527">if</span>&nbsp;<span class="ident" id="4107530">ident</span><span class="op" id="4107535">.</span><span class="ident" id="4107536">Name</span>&nbsp;<span class="op" id="4107541">==</span>&nbsp;<span class="string" id="4107544">&#34;_&#34;</span>&nbsp;<span class="op" id="4107548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107552">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107563">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107597">for</span>&nbsp;<span class="ident" id="4107601">s</span>&nbsp;<span class="op" id="4107603">:=</span>&nbsp;<span class="ident" id="4107606">p</span><span class="op" id="4107607">.</span><span class="ident" id="4107608">topScope</span><span class="op" id="4107616">;</span>&nbsp;<span class="ident" id="4107618">s</span>&nbsp;<span class="op" id="4107620">!=</span>&nbsp;<span class="ident" id="4107623">nil</span><span class="op" id="4107626">;</span>&nbsp;<span class="ident" id="4107628">s</span>&nbsp;<span class="op" id="4107630">=</span>&nbsp;<span class="ident" id="4107632">s</span><span class="op" id="4107633">.</span><span class="ident" id="4107634">Outer</span>&nbsp;<span class="op" id="4107640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107644">if</span>&nbsp;<span class="ident" id="4107647">obj</span>&nbsp;<span class="op" id="4107651">:=</span>&nbsp;<span class="ident" id="4107654">s</span><span class="op" id="4107655">.</span><span class="ident" id="4107656">Lookup</span><span class="op" id="4107662">(</span><span class="ident" id="4107663">ident</span><span class="op" id="4107668">.</span><span class="ident" id="4107669">Name</span><span class="op" id="4107673">)</span><span class="op" id="4107674">;</span>&nbsp;<span class="ident" id="4107676">obj</span>&nbsp;<span class="op" id="4107680">!=</span>&nbsp;<span class="ident" id="4107683">nil</span>&nbsp;<span class="op" id="4107687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107692">ident</span><span class="op" id="4107697">.</span><span class="ident" id="4107698">Obj</span>&nbsp;<span class="op" id="4107702">=</span>&nbsp;<span class="ident" id="4107704">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107726">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107787">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107845">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4107906">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107950">if</span>&nbsp;<span class="ident" id="4107953">collectUnresolved</span>&nbsp;<span class="op" id="4107971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107975">ident</span><span class="op" id="4107980">.</span><span class="ident" id="4107981">Obj</span>&nbsp;<span class="op" id="4107985">=</span>&nbsp;<span class="ident" id="4107987">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108000">p</span><span class="op" id="4108001">.</span><span class="ident" id="4108002">unresolved</span>&nbsp;<span class="op" id="4108013">=</span>&nbsp;<span class="builtinfunc" id="4108015">append</span><span class="op" id="4108021">(</span><span class="ident" id="4108022">p</span><span class="op" id="4108023">.</span><span class="ident" id="4108024">unresolved</span><span class="op" id="4108034">,</span>&nbsp;<span class="ident" id="4108036">ident</span><span class="op" id="4108041">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108044">}</span><br>
<span class="lineno"></span><span class="op" id="4108046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4108049">func</span>&nbsp;<span class="op" id="4108054">(</span><span class="ident" id="4108055">p</span>&nbsp;<span class="op" id="4108057">*</span><span class="ident" id="4108058">parser</span><span class="op" id="4108064">)</span>&nbsp;<span class="ident" id="4108066">resolve</span><span class="op" id="4108073">(</span><span class="ident" id="4108074">x</span>&nbsp;<span class="ident" id="4108076">ast</span><span class="op" id="4108079">.</span><span class="ident" id="4108080">Expr</span><span class="op" id="4108084">)</span>&nbsp;<span class="op" id="4108086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108089">p</span><span class="op" id="4108090">.</span><span class="ident" id="4108091">tryResolve</span><span class="op" id="4108101">(</span><span class="ident" id="4108102">x</span><span class="op" id="4108103">,</span>&nbsp;<span class="builtintype" id="4108105">true</span><span class="op" id="4108109">)</span><br>
<span class="lineno">200</span><span class="op" id="4108111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108114">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4108194">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4108214">func</span>&nbsp;<span class="op" id="4108219">(</span><span class="ident" id="4108220">p</span>&nbsp;<span class="op" id="4108222">*</span><span class="ident" id="4108223">parser</span><span class="op" id="4108229">)</span>&nbsp;<span class="ident" id="4108231">printTrace</span><span class="op" id="4108241">(</span><span class="ident" id="4108242">a</span>&nbsp;<span class="op" id="4108244">...</span><span class="keyword" id="4108247">interface</span><span class="op" id="4108256">{</span><span class="op" id="4108257">}</span><span class="op" id="4108258">)</span>&nbsp;<span class="op" id="4108260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108263">const</span>&nbsp;<span class="ident" id="4108269">dots</span>&nbsp;<span class="op" id="4108274">=</span>&nbsp;<span class="string" id="4108276">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108344">const</span>&nbsp;<span class="ident" id="4108350">n</span>&nbsp;<span class="op" id="4108352">=</span>&nbsp;<span class="builtinfunc" id="4108354">len</span><span class="op" id="4108357">(</span><span class="ident" id="4108358">dots</span><span class="op" id="4108362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108365">pos</span>&nbsp;<span class="op" id="4108369">:=</span>&nbsp;<span class="ident" id="4108372">p</span><span class="op" id="4108373">.</span><span class="ident" id="4108374">file</span><span class="op" id="4108378">.</span><span class="ident" id="4108379">Position</span><span class="op" id="4108387">(</span><span class="ident" id="4108388">p</span><span class="op" id="4108389">.</span><span class="ident" id="4108390">pos</span><span class="op" id="4108393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108396">fmt</span><span class="op" id="4108399">.</span><span class="ident" id="4108400">Printf</span><span class="op" id="4108406">(</span><span class="string" id="4108407">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="4108418">,</span>&nbsp;<span class="ident" id="4108420">pos</span><span class="op" id="4108423">.</span><span class="ident" id="4108424">Line</span><span class="op" id="4108428">,</span>&nbsp;<span class="ident" id="4108430">pos</span><span class="op" id="4108433">.</span><span class="ident" id="4108434">Column</span><span class="op" id="4108440">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108443">i</span>&nbsp;<span class="op" id="4108445">:=</span>&nbsp;<span class="num" id="4108448">2</span>&nbsp;<span class="op" id="4108450">*</span>&nbsp;<span class="ident" id="4108452">p</span><span class="op" id="4108453">.</span><span class="ident" id="4108454">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108462">for</span>&nbsp;<span class="ident" id="4108466">i</span>&nbsp;<span class="op" id="4108468">&gt;</span>&nbsp;<span class="ident" id="4108470">n</span>&nbsp;<span class="op" id="4108472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108476">fmt</span><span class="op" id="4108479">.</span><span class="ident" id="4108480">Print</span><span class="op" id="4108485">(</span><span class="ident" id="4108486">dots</span><span class="op" id="4108490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108494">i</span>&nbsp;<span class="op" id="4108496">-=</span>&nbsp;<span class="ident" id="4108499">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108502">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108505">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108516">fmt</span><span class="op" id="4108519">.</span><span class="ident" id="4108520">Print</span><span class="op" id="4108525">(</span><span class="ident" id="4108526">dots</span><span class="op" id="4108530">[</span><span class="num" id="4108531">0</span><span class="op" id="4108532">:</span><span class="ident" id="4108533">i</span><span class="op" id="4108534">]</span><span class="op" id="4108535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108538">fmt</span><span class="op" id="4108541">.</span><span class="ident" id="4108542">Println</span><span class="op" id="4108549">(</span><span class="ident" id="4108550">a</span><span class="op" id="4108551">...</span><span class="op" id="4108554">)</span><br>
<span class="lineno"></span><span class="op" id="4108556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="4108559">func</span>&nbsp;<span class="ident" id="4108564">trace</span><span class="op" id="4108569">(</span><span class="ident" id="4108570">p</span>&nbsp;<span class="op" id="4108572">*</span><span class="ident" id="4108573">parser</span><span class="op" id="4108579">,</span>&nbsp;<span class="ident" id="4108581">msg</span>&nbsp;<span class="builtintype" id="4108585">string</span><span class="op" id="4108591">)</span>&nbsp;<span class="op" id="4108593">*</span><span class="ident" id="4108594">parser</span>&nbsp;<span class="op" id="4108601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108604">p</span><span class="op" id="4108605">.</span><span class="ident" id="4108606">printTrace</span><span class="op" id="4108616">(</span><span class="ident" id="4108617">msg</span><span class="op" id="4108620">,</span>&nbsp;<span class="string" id="4108622">&#34;(&#34;</span><span class="op" id="4108625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108628">p</span><span class="op" id="4108629">.</span><span class="ident" id="4108630">indent</span><span class="op" id="4108636">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108640">return</span>&nbsp;<span class="ident" id="4108647">p</span><br>
<span class="lineno"></span><span class="op" id="4108649">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4108652">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="4108696">func</span>&nbsp;<span class="ident" id="4108701">un</span><span class="op" id="4108703">(</span><span class="ident" id="4108704">p</span>&nbsp;<span class="op" id="4108706">*</span><span class="ident" id="4108707">parser</span><span class="op" id="4108713">)</span>&nbsp;<span class="op" id="4108715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108718">p</span><span class="op" id="4108719">.</span><span class="ident" id="4108720">indent</span><span class="op" id="4108726">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108730">p</span><span class="op" id="4108731">.</span><span class="ident" id="4108732">printTrace</span><span class="op" id="4108742">(</span><span class="string" id="4108743">&#34;)&#34;</span><span class="op" id="4108746">)</span><br>
<span class="lineno">230</span><span class="op" id="4108748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108751">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="4108781">func</span>&nbsp;<span class="op" id="4108786">(</span><span class="ident" id="4108787">p</span>&nbsp;<span class="op" id="4108789">*</span><span class="ident" id="4108790">parser</span><span class="op" id="4108796">)</span>&nbsp;<span class="ident" id="4108798">next0</span><span class="op" id="4108803">(</span><span class="op" id="4108804">)</span>&nbsp;<span class="op" id="4108806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108809">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108871">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108931">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4108990">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109037">if</span>&nbsp;<span class="ident" id="4109040">p</span><span class="op" id="4109041">.</span><span class="ident" id="4109042">trace</span>&nbsp;<span class="op" id="4109048">&amp;&amp;</span>&nbsp;<span class="ident" id="4109051">p</span><span class="op" id="4109052">.</span><span class="ident" id="4109053">pos</span><span class="op" id="4109056">.</span><span class="ident" id="4109057">IsValid</span><span class="op" id="4109064">(</span><span class="op" id="4109065">)</span>&nbsp;<span class="op" id="4109067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109071">s</span>&nbsp;<span class="op" id="4109073">:=</span>&nbsp;<span class="ident" id="4109076">p</span><span class="op" id="4109077">.</span><span class="ident" id="4109078">tok</span><span class="op" id="4109081">.</span><span class="ident" id="4109082">String</span><span class="op" id="4109088">(</span><span class="op" id="4109089">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109093">switch</span>&nbsp;<span class="op" id="4109100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109104">case</span>&nbsp;<span class="ident" id="4109109">p</span><span class="op" id="4109110">.</span><span class="ident" id="4109111">tok</span><span class="op" id="4109114">.</span><span class="ident" id="4109115">IsLiteral</span><span class="op" id="4109124">(</span><span class="op" id="4109125">)</span><span class="op" id="4109126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109131">p</span><span class="op" id="4109132">.</span><span class="ident" id="4109133">printTrace</span><span class="op" id="4109143">(</span><span class="ident" id="4109144">s</span><span class="op" id="4109145">,</span>&nbsp;<span class="ident" id="4109147">p</span><span class="op" id="4109148">.</span><span class="ident" id="4109149">lit</span><span class="op" id="4109152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109156">case</span>&nbsp;<span class="ident" id="4109161">p</span><span class="op" id="4109162">.</span><span class="ident" id="4109163">tok</span><span class="op" id="4109166">.</span><span class="ident" id="4109167">IsOperator</span><span class="op" id="4109177">(</span><span class="op" id="4109178">)</span><span class="op" id="4109179">,</span>&nbsp;<span class="ident" id="4109181">p</span><span class="op" id="4109182">.</span><span class="ident" id="4109183">tok</span><span class="op" id="4109186">.</span><span class="ident" id="4109187">IsKeyword</span><span class="op" id="4109196">(</span><span class="op" id="4109197">)</span><span class="op" id="4109198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109203">p</span><span class="op" id="4109204">.</span><span class="ident" id="4109205">printTrace</span><span class="op" id="4109215">(</span><span class="string" id="4109216">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="4109221">+</span>&nbsp;<span class="ident" id="4109223">s</span>&nbsp;<span class="op" id="4109225">+</span>&nbsp;<span class="string" id="4109227">&#34;\&#34;&#34;</span><span class="op" id="4109231">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109235">default</span><span class="op" id="4109242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109247">p</span><span class="op" id="4109248">.</span><span class="ident" id="4109249">printTrace</span><span class="op" id="4109259">(</span><span class="ident" id="4109260">s</span><span class="op" id="4109261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109272">p</span><span class="op" id="4109273">.</span><span class="ident" id="4109274">pos</span><span class="op" id="4109277">,</span>&nbsp;<span class="ident" id="4109279">p</span><span class="op" id="4109280">.</span><span class="ident" id="4109281">tok</span><span class="op" id="4109284">,</span>&nbsp;<span class="ident" id="4109286">p</span><span class="op" id="4109287">.</span><span class="ident" id="4109288">lit</span>&nbsp;<span class="op" id="4109292">=</span>&nbsp;<span class="ident" id="4109294">p</span><span class="op" id="4109295">.</span><span class="ident" id="4109296">scanner</span><span class="op" id="4109303">.</span><span class="ident" id="4109304">Scan</span><span class="op" id="4109308">(</span><span class="op" id="4109309">)</span><br>
<span class="lineno"></span><span class="op" id="4109311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4109314">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="4109380">func</span>&nbsp;<span class="op" id="4109385">(</span><span class="ident" id="4109386">p</span>&nbsp;<span class="op" id="4109388">*</span><span class="ident" id="4109389">parser</span><span class="op" id="4109395">)</span>&nbsp;<span class="ident" id="4109397">consumeComment</span><span class="op" id="4109411">(</span><span class="op" id="4109412">)</span>&nbsp;<span class="op" id="4109414">(</span><span class="ident" id="4109415">comment</span>&nbsp;<span class="op" id="4109423">*</span><span class="ident" id="4109424">ast</span><span class="op" id="4109427">.</span><span class="ident" id="4109428">Comment</span><span class="op" id="4109435">,</span>&nbsp;<span class="ident" id="4109437">endline</span>&nbsp;<span class="builtintype" id="4109445">int</span><span class="op" id="4109448">)</span>&nbsp;<span class="op" id="4109450">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4109453">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4109526">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109594">endline</span>&nbsp;<span class="op" id="4109602">=</span>&nbsp;<span class="ident" id="4109604">p</span><span class="op" id="4109605">.</span><span class="ident" id="4109606">file</span><span class="op" id="4109610">.</span><span class="ident" id="4109611">Line</span><span class="op" id="4109615">(</span><span class="ident" id="4109616">p</span><span class="op" id="4109617">.</span><span class="ident" id="4109618">pos</span><span class="op" id="4109621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109624">if</span>&nbsp;<span class="ident" id="4109627">p</span><span class="op" id="4109628">.</span><span class="ident" id="4109629">lit</span><span class="op" id="4109632">[</span><span class="num" id="4109633">1</span><span class="op" id="4109634">]</span>&nbsp;<span class="op" id="4109636">==</span>&nbsp;<span class="string" id="4109639">&#39;*&#39;</span>&nbsp;<span class="op" id="4109643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4109647">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109713">for</span>&nbsp;<span class="ident" id="4109717">i</span>&nbsp;<span class="op" id="4109719">:=</span>&nbsp;<span class="num" id="4109722">0</span><span class="op" id="4109723">;</span>&nbsp;<span class="ident" id="4109725">i</span>&nbsp;<span class="op" id="4109727">&lt;</span>&nbsp;<span class="builtinfunc" id="4109729">len</span><span class="op" id="4109732">(</span><span class="ident" id="4109733">p</span><span class="op" id="4109734">.</span><span class="ident" id="4109735">lit</span><span class="op" id="4109738">)</span><span class="op" id="4109739">;</span>&nbsp;<span class="ident" id="4109741">i</span><span class="op" id="4109742">++</span>&nbsp;<span class="op" id="4109745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109750">if</span>&nbsp;<span class="ident" id="4109753">p</span><span class="op" id="4109754">.</span><span class="ident" id="4109755">lit</span><span class="op" id="4109758">[</span><span class="ident" id="4109759">i</span><span class="op" id="4109760">]</span>&nbsp;<span class="op" id="4109762">==</span>&nbsp;<span class="string" id="4109765">&#39;\n&#39;</span>&nbsp;<span class="op" id="4109770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109776">endline</span><span class="op" id="4109783">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109793">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109800">comment</span>&nbsp;<span class="op" id="4109808">=</span>&nbsp;<span class="op" id="4109810">&amp;</span><span class="ident" id="4109811">ast</span><span class="op" id="4109814">.</span><span class="ident" id="4109815">Comment</span><span class="op" id="4109822">{</span><span class="ident" id="4109823">Slash</span><span class="op" id="4109828">:</span>&nbsp;<span class="ident" id="4109830">p</span><span class="op" id="4109831">.</span><span class="ident" id="4109832">pos</span><span class="op" id="4109835">,</span>&nbsp;<span class="ident" id="4109837">Text</span><span class="op" id="4109841">:</span>&nbsp;<span class="ident" id="4109843">p</span><span class="op" id="4109844">.</span><span class="ident" id="4109845">lit</span><span class="op" id="4109848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109851">p</span><span class="op" id="4109852">.</span><span class="ident" id="4109853">next0</span><span class="op" id="4109858">(</span><span class="op" id="4109859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109863">return</span><br>
<span class="lineno"></span><span class="op" id="4109870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4109873">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4109937">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="4110001">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4110065">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4110107">//</span><br>
<span class="lineno"></span><span class="keyword" id="4110110">func</span>&nbsp;<span class="op" id="4110115">(</span><span class="ident" id="4110116">p</span>&nbsp;<span class="op" id="4110118">*</span><span class="ident" id="4110119">parser</span><span class="op" id="4110125">)</span>&nbsp;<span class="ident" id="4110127">consumeCommentGroup</span><span class="op" id="4110146">(</span><span class="ident" id="4110147">n</span>&nbsp;<span class="builtintype" id="4110149">int</span><span class="op" id="4110152">)</span>&nbsp;<span class="op" id="4110154">(</span><span class="ident" id="4110155">comments</span>&nbsp;<span class="op" id="4110164">*</span><span class="ident" id="4110165">ast</span><span class="op" id="4110168">.</span><span class="ident" id="4110169">CommentGroup</span><span class="op" id="4110181">,</span>&nbsp;<span class="ident" id="4110183">endline</span>&nbsp;<span class="builtintype" id="4110191">int</span><span class="op" id="4110194">)</span>&nbsp;<span class="op" id="4110196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110199">var</span>&nbsp;<span class="ident" id="4110203">list</span>&nbsp;<span class="op" id="4110208">[</span><span class="op" id="4110209">]</span><span class="op" id="4110210">*</span><span class="ident" id="4110211">ast</span><span class="op" id="4110214">.</span><span class="ident" id="4110215">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110224">endline</span>&nbsp;<span class="op" id="4110232">=</span>&nbsp;<span class="ident" id="4110234">p</span><span class="op" id="4110235">.</span><span class="ident" id="4110236">file</span><span class="op" id="4110240">.</span><span class="ident" id="4110241">Line</span><span class="op" id="4110245">(</span><span class="ident" id="4110246">p</span><span class="op" id="4110247">.</span><span class="ident" id="4110248">pos</span><span class="op" id="4110251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110254">for</span>&nbsp;<span class="ident" id="4110258">p</span><span class="op" id="4110259">.</span><span class="ident" id="4110260">tok</span>&nbsp;<span class="op" id="4110264">==</span>&nbsp;<span class="ident" id="4110267">token</span><span class="op" id="4110272">.</span><span class="ident" id="4110273">COMMENT</span>&nbsp;<span class="op" id="4110281">&amp;&amp;</span>&nbsp;<span class="ident" id="4110284">p</span><span class="op" id="4110285">.</span><span class="ident" id="4110286">file</span><span class="op" id="4110290">.</span><span class="ident" id="4110291">Line</span><span class="op" id="4110295">(</span><span class="ident" id="4110296">p</span><span class="op" id="4110297">.</span><span class="ident" id="4110298">pos</span><span class="op" id="4110301">)</span>&nbsp;<span class="op" id="4110303">&lt;=</span>&nbsp;<span class="ident" id="4110306">endline</span><span class="op" id="4110313">+</span><span class="ident" id="4110314">n</span>&nbsp;<span class="op" id="4110316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110320">var</span>&nbsp;<span class="ident" id="4110324">comment</span>&nbsp;<span class="op" id="4110332">*</span><span class="ident" id="4110333">ast</span><span class="op" id="4110336">.</span><span class="ident" id="4110337">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110347">comment</span><span class="op" id="4110354">,</span>&nbsp;<span class="ident" id="4110356">endline</span>&nbsp;<span class="op" id="4110364">=</span>&nbsp;<span class="ident" id="4110366">p</span><span class="op" id="4110367">.</span><span class="ident" id="4110368">consumeComment</span><span class="op" id="4110382">(</span><span class="op" id="4110383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110387">list</span>&nbsp;<span class="op" id="4110392">=</span>&nbsp;<span class="builtinfunc" id="4110394">append</span><span class="op" id="4110400">(</span><span class="ident" id="4110401">list</span><span class="op" id="4110405">,</span>&nbsp;<span class="ident" id="4110407">comment</span><span class="op" id="4110414">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4110421">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110464">comments</span>&nbsp;<span class="op" id="4110473">=</span>&nbsp;<span class="op" id="4110475">&amp;</span><span class="ident" id="4110476">ast</span><span class="op" id="4110479">.</span><span class="ident" id="4110480">CommentGroup</span><span class="op" id="4110492">{</span><span class="ident" id="4110493">List</span><span class="op" id="4110497">:</span>&nbsp;<span class="ident" id="4110499">list</span><span class="op" id="4110503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110506">p</span><span class="op" id="4110507">.</span><span class="ident" id="4110508">comments</span>&nbsp;<span class="op" id="4110517">=</span>&nbsp;<span class="builtinfunc" id="4110519">append</span><span class="op" id="4110525">(</span><span class="ident" id="4110526">p</span><span class="op" id="4110527">.</span><span class="ident" id="4110528">comments</span><span class="op" id="4110536">,</span>&nbsp;<span class="ident" id="4110538">comments</span><span class="op" id="4110546">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110550">return</span><br>
<span class="lineno"></span><span class="op" id="4110557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4110560">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="4110626">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4110692">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4110714">//</span><br>
<span class="lineno"></span><span class="comment" id="4110717">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4110780">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="4110851">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4110909">//</span><br>
<span class="lineno"></span><span class="comment" id="4110912">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="4110976">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4111047">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="4111065">//</span><br>
<span class="lineno"></span><span class="comment" id="4111068">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4111134">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="4111156">//</span><br>
<span class="lineno"></span><span class="keyword" id="4111159">func</span>&nbsp;<span class="op" id="4111164">(</span><span class="ident" id="4111165">p</span>&nbsp;<span class="op" id="4111167">*</span><span class="ident" id="4111168">parser</span><span class="op" id="4111174">)</span>&nbsp;<span class="ident" id="4111176">next</span><span class="op" id="4111180">(</span><span class="op" id="4111181">)</span>&nbsp;<span class="op" id="4111183">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111186">p</span><span class="op" id="4111187">.</span><span class="ident" id="4111188">leadComment</span>&nbsp;<span class="op" id="4111200">=</span>&nbsp;<span class="ident" id="4111202">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111207">p</span><span class="op" id="4111208">.</span><span class="ident" id="4111209">lineComment</span>&nbsp;<span class="op" id="4111221">=</span>&nbsp;<span class="ident" id="4111223">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111228">prev</span>&nbsp;<span class="op" id="4111233">:=</span>&nbsp;<span class="ident" id="4111236">p</span><span class="op" id="4111237">.</span><span class="ident" id="4111238">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111243">p</span><span class="op" id="4111244">.</span><span class="ident" id="4111245">next0</span><span class="op" id="4111250">(</span><span class="op" id="4111251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111255">if</span>&nbsp;<span class="ident" id="4111258">p</span><span class="op" id="4111259">.</span><span class="ident" id="4111260">tok</span>&nbsp;<span class="op" id="4111264">==</span>&nbsp;<span class="ident" id="4111267">token</span><span class="op" id="4111272">.</span><span class="ident" id="4111273">COMMENT</span>&nbsp;<span class="op" id="4111281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111285">var</span>&nbsp;<span class="ident" id="4111289">comment</span>&nbsp;<span class="op" id="4111297">*</span><span class="ident" id="4111298">ast</span><span class="op" id="4111301">.</span><span class="ident" id="4111302">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111317">var</span>&nbsp;<span class="ident" id="4111321">endline</span>&nbsp;<span class="builtintype" id="4111329">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111336">if</span>&nbsp;<span class="ident" id="4111339">p</span><span class="op" id="4111340">.</span><span class="ident" id="4111341">file</span><span class="op" id="4111345">.</span><span class="ident" id="4111346">Line</span><span class="op" id="4111350">(</span><span class="ident" id="4111351">p</span><span class="op" id="4111352">.</span><span class="ident" id="4111353">pos</span><span class="op" id="4111356">)</span>&nbsp;<span class="op" id="4111358">==</span>&nbsp;<span class="ident" id="4111361">p</span><span class="op" id="4111362">.</span><span class="ident" id="4111363">file</span><span class="op" id="4111367">.</span><span class="ident" id="4111368">Line</span><span class="op" id="4111372">(</span><span class="ident" id="4111373">prev</span><span class="op" id="4111377">)</span>&nbsp;<span class="op" id="4111379">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111384">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111444">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111502">comment</span><span class="op" id="4111509">,</span>&nbsp;<span class="ident" id="4111511">endline</span>&nbsp;<span class="op" id="4111519">=</span>&nbsp;<span class="ident" id="4111521">p</span><span class="op" id="4111522">.</span><span class="ident" id="4111523">consumeCommentGroup</span><span class="op" id="4111542">(</span><span class="num" id="4111543">0</span><span class="op" id="4111544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111549">if</span>&nbsp;<span class="ident" id="4111552">p</span><span class="op" id="4111553">.</span><span class="ident" id="4111554">file</span><span class="op" id="4111558">.</span><span class="ident" id="4111559">Line</span><span class="op" id="4111563">(</span><span class="ident" id="4111564">p</span><span class="op" id="4111565">.</span><span class="ident" id="4111566">pos</span><span class="op" id="4111569">)</span>&nbsp;<span class="op" id="4111571">!=</span>&nbsp;<span class="ident" id="4111574">endline</span>&nbsp;<span class="op" id="4111582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111588">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111639">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111688">p</span><span class="op" id="4111689">.</span><span class="ident" id="4111690">lineComment</span>&nbsp;<span class="op" id="4111702">=</span>&nbsp;<span class="ident" id="4111704">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111724">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111764">endline</span>&nbsp;<span class="op" id="4111772">=</span>&nbsp;<span class="op" id="4111774">-</span><span class="num" id="4111775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111779">for</span>&nbsp;<span class="ident" id="4111783">p</span><span class="op" id="4111784">.</span><span class="ident" id="4111785">tok</span>&nbsp;<span class="op" id="4111789">==</span>&nbsp;<span class="ident" id="4111792">token</span><span class="op" id="4111797">.</span><span class="ident" id="4111798">COMMENT</span>&nbsp;<span class="op" id="4111806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111811">comment</span><span class="op" id="4111818">,</span>&nbsp;<span class="ident" id="4111820">endline</span>&nbsp;<span class="op" id="4111828">=</span>&nbsp;<span class="ident" id="4111830">p</span><span class="op" id="4111831">.</span><span class="ident" id="4111832">consumeCommentGroup</span><span class="op" id="4111851">(</span><span class="num" id="4111852">1</span><span class="op" id="4111853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111857">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111862">if</span>&nbsp;<span class="ident" id="4111865">endline</span><span class="op" id="4111872">+</span><span class="num" id="4111873">1</span>&nbsp;<span class="op" id="4111875">==</span>&nbsp;<span class="ident" id="4111878">p</span><span class="op" id="4111879">.</span><span class="ident" id="4111880">file</span><span class="op" id="4111884">.</span><span class="ident" id="4111885">Line</span><span class="op" id="4111889">(</span><span class="ident" id="4111890">p</span><span class="op" id="4111891">.</span><span class="ident" id="4111892">pos</span><span class="op" id="4111895">)</span>&nbsp;<span class="op" id="4111897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111902">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111970">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112038">p</span><span class="op" id="4112039">.</span><span class="ident" id="4112040">leadComment</span>&nbsp;<span class="op" id="4112052">=</span>&nbsp;<span class="ident" id="4112054">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112067">}</span><br>
<span class="lineno"></span><span class="op" id="4112069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4112072">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="4112132">type</span>&nbsp;<span class="ident" id="4112137">bailout</span>&nbsp;<span class="keyword" id="4112145">struct</span><span class="op" id="4112151">{</span><span class="op" id="4112152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4112155">func</span>&nbsp;<span class="op" id="4112160">(</span><span class="ident" id="4112161">p</span>&nbsp;<span class="op" id="4112163">*</span><span class="ident" id="4112164">parser</span><span class="op" id="4112170">)</span>&nbsp;<span class="builtintype" id="4112172">error</span><span class="op" id="4112177">(</span><span class="ident" id="4112178">pos</span>&nbsp;<span class="ident" id="4112182">token</span><span class="op" id="4112187">.</span><span class="ident" id="4112188">Pos</span><span class="op" id="4112191">,</span>&nbsp;<span class="ident" id="4112193">msg</span>&nbsp;<span class="builtintype" id="4112197">string</span><span class="op" id="4112203">)</span>&nbsp;<span class="op" id="4112205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112208">epos</span>&nbsp;<span class="op" id="4112213">:=</span>&nbsp;<span class="ident" id="4112216">p</span><span class="op" id="4112217">.</span><span class="ident" id="4112218">file</span><span class="op" id="4112222">.</span><span class="ident" id="4112223">Position</span><span class="op" id="4112231">(</span><span class="ident" id="4112232">pos</span><span class="op" id="4112235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112239">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112309">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112380">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112395">if</span>&nbsp;<span class="ident" id="4112398">p</span><span class="op" id="4112399">.</span><span class="ident" id="4112400">mode</span><span class="op" id="4112404">&amp;</span><span class="ident" id="4112405">AllErrors</span>&nbsp;<span class="op" id="4112415">==</span>&nbsp;<span class="num" id="4112418">0</span>&nbsp;<span class="op" id="4112420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112424">n</span>&nbsp;<span class="op" id="4112426">:=</span>&nbsp;<span class="builtinfunc" id="4112429">len</span><span class="op" id="4112432">(</span><span class="ident" id="4112433">p</span><span class="op" id="4112434">.</span><span class="ident" id="4112435">errors</span><span class="op" id="4112441">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112445">if</span>&nbsp;<span class="ident" id="4112448">n</span>&nbsp;<span class="op" id="4112450">&gt;</span>&nbsp;<span class="num" id="4112452">0</span>&nbsp;<span class="op" id="4112454">&amp;&amp;</span>&nbsp;<span class="ident" id="4112457">p</span><span class="op" id="4112458">.</span><span class="ident" id="4112459">errors</span><span class="op" id="4112465">[</span><span class="ident" id="4112466">n</span><span class="op" id="4112467">-</span><span class="num" id="4112468">1</span><span class="op" id="4112469">]</span><span class="op" id="4112470">.</span><span class="ident" id="4112471">Pos</span><span class="op" id="4112474">.</span><span class="ident" id="4112475">Line</span>&nbsp;<span class="op" id="4112480">==</span>&nbsp;<span class="ident" id="4112483">epos</span><span class="op" id="4112487">.</span><span class="ident" id="4112488">Line</span>&nbsp;<span class="op" id="4112493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112498">return</span>&nbsp;<span class="comment" id="4112505">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112548">if</span>&nbsp;<span class="ident" id="4112551">n</span>&nbsp;<span class="op" id="4112553">&gt;</span>&nbsp;<span class="num" id="4112555">10</span>&nbsp;<span class="op" id="4112558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4112563">panic</span><span class="op" id="4112568">(</span><span class="ident" id="4112569">bailout</span><span class="op" id="4112576">{</span><span class="op" id="4112577">}</span><span class="op" id="4112578">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112589">p</span><span class="op" id="4112590">.</span><span class="ident" id="4112591">errors</span><span class="op" id="4112597">.</span><span class="ident" id="4112598">Add</span><span class="op" id="4112601">(</span><span class="ident" id="4112602">epos</span><span class="op" id="4112606">,</span>&nbsp;<span class="ident" id="4112608">msg</span><span class="op" id="4112611">)</span><br>
<span class="lineno"></span><span class="op" id="4112613">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4112616">func</span>&nbsp;<span class="op" id="4112621">(</span><span class="ident" id="4112622">p</span>&nbsp;<span class="op" id="4112624">*</span><span class="ident" id="4112625">parser</span><span class="op" id="4112631">)</span>&nbsp;<span class="ident" id="4112633">errorExpected</span><span class="op" id="4112646">(</span><span class="ident" id="4112647">pos</span>&nbsp;<span class="ident" id="4112651">token</span><span class="op" id="4112656">.</span><span class="ident" id="4112657">Pos</span><span class="op" id="4112660">,</span>&nbsp;<span class="ident" id="4112662">msg</span>&nbsp;<span class="builtintype" id="4112666">string</span><span class="op" id="4112672">)</span>&nbsp;<span class="op" id="4112674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112677">msg</span>&nbsp;<span class="op" id="4112681">=</span>&nbsp;<span class="string" id="4112683">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="4112695">+</span>&nbsp;<span class="ident" id="4112697">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112702">if</span>&nbsp;<span class="ident" id="4112705">pos</span>&nbsp;<span class="op" id="4112709">==</span>&nbsp;<span class="ident" id="4112712">p</span><span class="op" id="4112713">.</span><span class="ident" id="4112714">pos</span>&nbsp;<span class="op" id="4112718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112722">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112771">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112813">if</span>&nbsp;<span class="ident" id="4112816">p</span><span class="op" id="4112817">.</span><span class="ident" id="4112818">tok</span>&nbsp;<span class="op" id="4112822">==</span>&nbsp;<span class="ident" id="4112825">token</span><span class="op" id="4112830">.</span><span class="ident" id="4112831">SEMICOLON</span>&nbsp;<span class="op" id="4112841">&amp;&amp;</span>&nbsp;<span class="ident" id="4112844">p</span><span class="op" id="4112845">.</span><span class="ident" id="4112846">lit</span>&nbsp;<span class="op" id="4112850">==</span>&nbsp;<span class="string" id="4112853">&#34;\n&#34;</span>&nbsp;<span class="op" id="4112858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112863">msg</span>&nbsp;<span class="op" id="4112867">+=</span>&nbsp;<span class="string" id="4112870">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112890">}</span>&nbsp;<span class="keyword" id="4112892">else</span>&nbsp;<span class="op" id="4112897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112902">msg</span>&nbsp;<span class="op" id="4112906">+=</span>&nbsp;<span class="string" id="4112909">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="4112921">+</span>&nbsp;<span class="ident" id="4112923">p</span><span class="op" id="4112924">.</span><span class="ident" id="4112925">tok</span><span class="op" id="4112928">.</span><span class="ident" id="4112929">String</span><span class="op" id="4112935">(</span><span class="op" id="4112936">)</span>&nbsp;<span class="op" id="4112938">+</span>&nbsp;<span class="string" id="4112940">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112947">if</span>&nbsp;<span class="ident" id="4112950">p</span><span class="op" id="4112951">.</span><span class="ident" id="4112952">tok</span><span class="op" id="4112955">.</span><span class="ident" id="4112956">IsLiteral</span><span class="op" id="4112965">(</span><span class="op" id="4112966">)</span>&nbsp;<span class="op" id="4112968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112974">msg</span>&nbsp;<span class="op" id="4112978">+=</span>&nbsp;<span class="string" id="4112981">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4112985">+</span>&nbsp;<span class="ident" id="4112987">p</span><span class="op" id="4112988">.</span><span class="ident" id="4112989">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113003">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113006">p</span><span class="op" id="4113007">.</span><span class="builtintype" id="4113008">error</span><span class="op" id="4113013">(</span><span class="ident" id="4113014">pos</span><span class="op" id="4113017">,</span>&nbsp;<span class="ident" id="4113019">msg</span><span class="op" id="4113022">)</span><br>
<span class="lineno"></span><span class="op" id="4113024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4113027">func</span>&nbsp;<span class="op" id="4113032">(</span><span class="ident" id="4113033">p</span>&nbsp;<span class="op" id="4113035">*</span><span class="ident" id="4113036">parser</span><span class="op" id="4113042">)</span>&nbsp;<span class="ident" id="4113044">expect</span><span class="op" id="4113050">(</span><span class="ident" id="4113051">tok</span>&nbsp;<span class="ident" id="4113055">token</span><span class="op" id="4113060">.</span><span class="ident" id="4113061">Token</span><span class="op" id="4113066">)</span>&nbsp;<span class="ident" id="4113068">token</span><span class="op" id="4113073">.</span><span class="ident" id="4113074">Pos</span>&nbsp;<span class="op" id="4113078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113081">pos</span>&nbsp;<span class="op" id="4113085">:=</span>&nbsp;<span class="ident" id="4113088">p</span><span class="op" id="4113089">.</span><span class="ident" id="4113090">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113095">if</span>&nbsp;<span class="ident" id="4113098">p</span><span class="op" id="4113099">.</span><span class="ident" id="4113100">tok</span>&nbsp;<span class="op" id="4113104">!=</span>&nbsp;<span class="ident" id="4113107">tok</span>&nbsp;<span class="op" id="4113111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113115">p</span><span class="op" id="4113116">.</span><span class="ident" id="4113117">errorExpected</span><span class="op" id="4113130">(</span><span class="ident" id="4113131">pos</span><span class="op" id="4113134">,</span>&nbsp;<span class="string" id="4113136">&#34;&#39;&#34;</span><span class="op" id="4113139">+</span><span class="ident" id="4113140">tok</span><span class="op" id="4113143">.</span><span class="ident" id="4113144">String</span><span class="op" id="4113150">(</span><span class="op" id="4113151">)</span><span class="op" id="4113152">+</span><span class="string" id="4113153">&#34;&#39;&#34;</span><span class="op" id="4113156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113162">p</span><span class="op" id="4113163">.</span><span class="ident" id="4113164">next</span><span class="op" id="4113168">(</span><span class="op" id="4113169">)</span>&nbsp;<span class="comment" id="4113171">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113189">return</span>&nbsp;<span class="ident" id="4113196">pos</span><br>
<span class="lineno">390</span><span class="op" id="4113200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113203">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4113271">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="4113331">//</span><br>
<span class="lineno">395</span><span class="keyword" id="4113334">func</span>&nbsp;<span class="op" id="4113339">(</span><span class="ident" id="4113340">p</span>&nbsp;<span class="op" id="4113342">*</span><span class="ident" id="4113343">parser</span><span class="op" id="4113349">)</span>&nbsp;<span class="ident" id="4113351">expectClosing</span><span class="op" id="4113364">(</span><span class="ident" id="4113365">tok</span>&nbsp;<span class="ident" id="4113369">token</span><span class="op" id="4113374">.</span><span class="ident" id="4113375">Token</span><span class="op" id="4113380">,</span>&nbsp;<span class="ident" id="4113382">context</span>&nbsp;<span class="builtintype" id="4113390">string</span><span class="op" id="4113396">)</span>&nbsp;<span class="ident" id="4113398">token</span><span class="op" id="4113403">.</span><span class="ident" id="4113404">Pos</span>&nbsp;<span class="op" id="4113408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113411">if</span>&nbsp;<span class="ident" id="4113414">p</span><span class="op" id="4113415">.</span><span class="ident" id="4113416">tok</span>&nbsp;<span class="op" id="4113420">!=</span>&nbsp;<span class="ident" id="4113423">tok</span>&nbsp;<span class="op" id="4113427">&amp;&amp;</span>&nbsp;<span class="ident" id="4113430">p</span><span class="op" id="4113431">.</span><span class="ident" id="4113432">tok</span>&nbsp;<span class="op" id="4113436">==</span>&nbsp;<span class="ident" id="4113439">token</span><span class="op" id="4113444">.</span><span class="ident" id="4113445">SEMICOLON</span>&nbsp;<span class="op" id="4113455">&amp;&amp;</span>&nbsp;<span class="ident" id="4113458">p</span><span class="op" id="4113459">.</span><span class="ident" id="4113460">lit</span>&nbsp;<span class="op" id="4113464">==</span>&nbsp;<span class="string" id="4113467">&#34;\n&#34;</span>&nbsp;<span class="op" id="4113472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113476">p</span><span class="op" id="4113477">.</span><span class="builtintype" id="4113478">error</span><span class="op" id="4113483">(</span><span class="ident" id="4113484">p</span><span class="op" id="4113485">.</span><span class="ident" id="4113486">pos</span><span class="op" id="4113489">,</span>&nbsp;<span class="string" id="4113491">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4113523">+</span><span class="ident" id="4113524">context</span><span class="op" id="4113531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113535">p</span><span class="op" id="4113536">.</span><span class="ident" id="4113537">next</span><span class="op" id="4113541">(</span><span class="op" id="4113542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113545">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113548">return</span>&nbsp;<span class="ident" id="4113555">p</span><span class="op" id="4113556">.</span><span class="ident" id="4113557">expect</span><span class="op" id="4113563">(</span><span class="ident" id="4113564">tok</span><span class="op" id="4113567">)</span><br>
<span class="lineno"></span><span class="op" id="4113569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4113572">func</span>&nbsp;<span class="op" id="4113577">(</span><span class="ident" id="4113578">p</span>&nbsp;<span class="op" id="4113580">*</span><span class="ident" id="4113581">parser</span><span class="op" id="4113587">)</span>&nbsp;<span class="ident" id="4113589">expectSemi</span><span class="op" id="4113599">(</span><span class="op" id="4113600">)</span>&nbsp;<span class="op" id="4113602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113605">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113659">if</span>&nbsp;<span class="ident" id="4113662">p</span><span class="op" id="4113663">.</span><span class="ident" id="4113664">tok</span>&nbsp;<span class="op" id="4113668">!=</span>&nbsp;<span class="ident" id="4113671">token</span><span class="op" id="4113676">.</span><span class="ident" id="4113677">RPAREN</span>&nbsp;<span class="op" id="4113684">&amp;&amp;</span>&nbsp;<span class="ident" id="4113687">p</span><span class="op" id="4113688">.</span><span class="ident" id="4113689">tok</span>&nbsp;<span class="op" id="4113693">!=</span>&nbsp;<span class="ident" id="4113696">token</span><span class="op" id="4113701">.</span><span class="ident" id="4113702">RBRACE</span>&nbsp;<span class="op" id="4113709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113713">if</span>&nbsp;<span class="ident" id="4113716">p</span><span class="op" id="4113717">.</span><span class="ident" id="4113718">tok</span>&nbsp;<span class="op" id="4113722">==</span>&nbsp;<span class="ident" id="4113725">token</span><span class="op" id="4113730">.</span><span class="ident" id="4113731">SEMICOLON</span>&nbsp;<span class="op" id="4113741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113746">p</span><span class="op" id="4113747">.</span><span class="ident" id="4113748">next</span><span class="op" id="4113752">(</span><span class="op" id="4113753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113757">}</span>&nbsp;<span class="keyword" id="4113759">else</span>&nbsp;<span class="op" id="4113764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113769">p</span><span class="op" id="4113770">.</span><span class="ident" id="4113771">errorExpected</span><span class="op" id="4113784">(</span><span class="ident" id="4113785">p</span><span class="op" id="4113786">.</span><span class="ident" id="4113787">pos</span><span class="op" id="4113790">,</span>&nbsp;<span class="string" id="4113792">&#34;&#39;;&#39;&#34;</span><span class="op" id="4113797">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113802">syncStmt</span><span class="op" id="4113810">(</span><span class="ident" id="4113811">p</span><span class="op" id="4113812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113819">}</span><br>
<span class="lineno"></span><span class="op" id="4113821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="4113824">func</span>&nbsp;<span class="op" id="4113829">(</span><span class="ident" id="4113830">p</span>&nbsp;<span class="op" id="4113832">*</span><span class="ident" id="4113833">parser</span><span class="op" id="4113839">)</span>&nbsp;<span class="ident" id="4113841">atComma</span><span class="op" id="4113848">(</span><span class="ident" id="4113849">context</span>&nbsp;<span class="builtintype" id="4113857">string</span><span class="op" id="4113863">)</span>&nbsp;<span class="builtintype" id="4113865">bool</span>&nbsp;<span class="op" id="4113870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113873">if</span>&nbsp;<span class="ident" id="4113876">p</span><span class="op" id="4113877">.</span><span class="ident" id="4113878">tok</span>&nbsp;<span class="op" id="4113882">==</span>&nbsp;<span class="ident" id="4113885">token</span><span class="op" id="4113890">.</span><span class="ident" id="4113891">COMMA</span>&nbsp;<span class="op" id="4113897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113901">return</span>&nbsp;<span class="builtintype" id="4113908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113917">if</span>&nbsp;<span class="ident" id="4113920">p</span><span class="op" id="4113921">.</span><span class="ident" id="4113922">tok</span>&nbsp;<span class="op" id="4113926">==</span>&nbsp;<span class="ident" id="4113929">token</span><span class="op" id="4113934">.</span><span class="ident" id="4113935">SEMICOLON</span>&nbsp;<span class="op" id="4113945">&amp;&amp;</span>&nbsp;<span class="ident" id="4113948">p</span><span class="op" id="4113949">.</span><span class="ident" id="4113950">lit</span>&nbsp;<span class="op" id="4113954">==</span>&nbsp;<span class="string" id="4113957">&#34;\n&#34;</span>&nbsp;<span class="op" id="4113962">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113966">p</span><span class="op" id="4113967">.</span><span class="builtintype" id="4113968">error</span><span class="op" id="4113973">(</span><span class="ident" id="4113974">p</span><span class="op" id="4113975">.</span><span class="ident" id="4113976">pos</span><span class="op" id="4113979">,</span>&nbsp;<span class="string" id="4113981">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4114013">+</span><span class="ident" id="4114014">context</span><span class="op" id="4114021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114025">return</span>&nbsp;<span class="builtintype" id="4114032">true</span>&nbsp;<span class="comment" id="4114037">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114077">return</span>&nbsp;<span class="builtintype" id="4114084">false</span><br>
<span class="lineno">425</span><span class="op" id="4114090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4114093">func</span>&nbsp;<span class="ident" id="4114098">assert</span><span class="op" id="4114104">(</span><span class="ident" id="4114105">cond</span>&nbsp;<span class="builtintype" id="4114110">bool</span><span class="op" id="4114114">,</span>&nbsp;<span class="ident" id="4114116">msg</span>&nbsp;<span class="builtintype" id="4114120">string</span><span class="op" id="4114126">)</span>&nbsp;<span class="op" id="4114128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114131">if</span>&nbsp;<span class="op" id="4114134">!</span><span class="ident" id="4114135">cond</span>&nbsp;<span class="op" id="4114140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4114144">panic</span><span class="op" id="4114149">(</span><span class="string" id="4114150">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4114179">+</span>&nbsp;<span class="ident" id="4114181">msg</span><span class="op" id="4114184">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114187">}</span><br>
<span class="lineno"></span><span class="op" id="4114189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4114192">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4114236">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="4114280">//</span><br>
<span class="lineno"></span><span class="keyword" id="4114283">func</span>&nbsp;<span class="ident" id="4114288">syncStmt</span><span class="op" id="4114296">(</span><span class="ident" id="4114297">p</span>&nbsp;<span class="op" id="4114299">*</span><span class="ident" id="4114300">parser</span><span class="op" id="4114306">)</span>&nbsp;<span class="op" id="4114308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114311">for</span>&nbsp;<span class="op" id="4114315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114319">switch</span>&nbsp;<span class="ident" id="4114326">p</span><span class="op" id="4114327">.</span><span class="ident" id="4114328">tok</span>&nbsp;<span class="op" id="4114332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114336">case</span>&nbsp;<span class="ident" id="4114341">token</span><span class="op" id="4114346">.</span><span class="ident" id="4114347">BREAK</span><span class="op" id="4114352">,</span>&nbsp;<span class="ident" id="4114354">token</span><span class="op" id="4114359">.</span><span class="ident" id="4114360">CONST</span><span class="op" id="4114365">,</span>&nbsp;<span class="ident" id="4114367">token</span><span class="op" id="4114372">.</span><span class="ident" id="4114373">CONTINUE</span><span class="op" id="4114381">,</span>&nbsp;<span class="ident" id="4114383">token</span><span class="op" id="4114388">.</span><span class="ident" id="4114389">DEFER</span><span class="op" id="4114394">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114399">token</span><span class="op" id="4114404">.</span><span class="ident" id="4114405">FALLTHROUGH</span><span class="op" id="4114416">,</span>&nbsp;<span class="ident" id="4114418">token</span><span class="op" id="4114423">.</span><span class="ident" id="4114424">FOR</span><span class="op" id="4114427">,</span>&nbsp;<span class="ident" id="4114429">token</span><span class="op" id="4114434">.</span><span class="ident" id="4114435">GO</span><span class="op" id="4114437">,</span>&nbsp;<span class="ident" id="4114439">token</span><span class="op" id="4114444">.</span><span class="ident" id="4114445">GOTO</span><span class="op" id="4114449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114454">token</span><span class="op" id="4114459">.</span><span class="ident" id="4114460">IF</span><span class="op" id="4114462">,</span>&nbsp;<span class="ident" id="4114464">token</span><span class="op" id="4114469">.</span><span class="ident" id="4114470">RETURN</span><span class="op" id="4114476">,</span>&nbsp;<span class="ident" id="4114478">token</span><span class="op" id="4114483">.</span><span class="ident" id="4114484">SELECT</span><span class="op" id="4114490">,</span>&nbsp;<span class="ident" id="4114492">token</span><span class="op" id="4114497">.</span><span class="ident" id="4114498">SWITCH</span><span class="op" id="4114504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114509">token</span><span class="op" id="4114514">.</span><span class="ident" id="4114515">TYPE</span><span class="op" id="4114519">,</span>&nbsp;<span class="ident" id="4114521">token</span><span class="op" id="4114526">.</span><span class="ident" id="4114527">VAR</span><span class="op" id="4114530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114535">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114593">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114651">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114707">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114763">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114819">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114873">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114908">if</span>&nbsp;<span class="ident" id="4114911">p</span><span class="op" id="4114912">.</span><span class="ident" id="4114913">pos</span>&nbsp;<span class="op" id="4114917">==</span>&nbsp;<span class="ident" id="4114920">p</span><span class="op" id="4114921">.</span><span class="ident" id="4114922">syncPos</span>&nbsp;<span class="op" id="4114930">&amp;&amp;</span>&nbsp;<span class="ident" id="4114933">p</span><span class="op" id="4114934">.</span><span class="ident" id="4114935">syncCnt</span>&nbsp;<span class="op" id="4114943">&lt;</span>&nbsp;<span class="num" id="4114945">10</span>&nbsp;<span class="op" id="4114948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114954">p</span><span class="op" id="4114955">.</span><span class="ident" id="4114956">syncCnt</span><span class="op" id="4114963">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114970">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114985">if</span>&nbsp;<span class="ident" id="4114988">p</span><span class="op" id="4114989">.</span><span class="ident" id="4114990">pos</span>&nbsp;<span class="op" id="4114994">&gt;</span>&nbsp;<span class="ident" id="4114996">p</span><span class="op" id="4114997">.</span><span class="ident" id="4114998">syncPos</span>&nbsp;<span class="op" id="4115006">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115012">p</span><span class="op" id="4115013">.</span><span class="ident" id="4115014">syncPos</span>&nbsp;<span class="op" id="4115022">=</span>&nbsp;<span class="ident" id="4115024">p</span><span class="op" id="4115025">.</span><span class="ident" id="4115026">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115034">p</span><span class="op" id="4115035">.</span><span class="ident" id="4115036">syncCnt</span>&nbsp;<span class="op" id="4115044">=</span>&nbsp;<span class="num" id="4115046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115052">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115067">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115121">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115178">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115232">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115287">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115322">case</span>&nbsp;<span class="ident" id="4115327">token</span><span class="op" id="4115332">.</span><span class="ident" id="4115333">EOF</span><span class="op" id="4115336">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115341">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115354">p</span><span class="op" id="4115355">.</span><span class="ident" id="4115356">next</span><span class="op" id="4115360">(</span><span class="op" id="4115361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115364">}</span><br>
<span class="lineno"></span><span class="op" id="4115366">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4115369">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="4115415">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4115459">//</span><br>
<span class="lineno"></span><span class="keyword" id="4115462">func</span>&nbsp;<span class="ident" id="4115467">syncDecl</span><span class="op" id="4115475">(</span><span class="ident" id="4115476">p</span>&nbsp;<span class="op" id="4115478">*</span><span class="ident" id="4115479">parser</span><span class="op" id="4115485">)</span>&nbsp;<span class="op" id="4115487">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115490">for</span>&nbsp;<span class="op" id="4115494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115498">switch</span>&nbsp;<span class="ident" id="4115505">p</span><span class="op" id="4115506">.</span><span class="ident" id="4115507">tok</span>&nbsp;<span class="op" id="4115511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115515">case</span>&nbsp;<span class="ident" id="4115520">token</span><span class="op" id="4115525">.</span><span class="ident" id="4115526">CONST</span><span class="op" id="4115531">,</span>&nbsp;<span class="ident" id="4115533">token</span><span class="op" id="4115538">.</span><span class="ident" id="4115539">TYPE</span><span class="op" id="4115543">,</span>&nbsp;<span class="ident" id="4115545">token</span><span class="op" id="4115550">.</span><span class="ident" id="4115551">VAR</span><span class="op" id="4115554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4115559">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115590">if</span>&nbsp;<span class="ident" id="4115593">p</span><span class="op" id="4115594">.</span><span class="ident" id="4115595">pos</span>&nbsp;<span class="op" id="4115599">==</span>&nbsp;<span class="ident" id="4115602">p</span><span class="op" id="4115603">.</span><span class="ident" id="4115604">syncPos</span>&nbsp;<span class="op" id="4115612">&amp;&amp;</span>&nbsp;<span class="ident" id="4115615">p</span><span class="op" id="4115616">.</span><span class="ident" id="4115617">syncCnt</span>&nbsp;<span class="op" id="4115625">&lt;</span>&nbsp;<span class="num" id="4115627">10</span>&nbsp;<span class="op" id="4115630">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115636">p</span><span class="op" id="4115637">.</span><span class="ident" id="4115638">syncCnt</span><span class="op" id="4115645">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115652">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115667">if</span>&nbsp;<span class="ident" id="4115670">p</span><span class="op" id="4115671">.</span><span class="ident" id="4115672">pos</span>&nbsp;<span class="op" id="4115676">&gt;</span>&nbsp;<span class="ident" id="4115678">p</span><span class="op" id="4115679">.</span><span class="ident" id="4115680">syncPos</span>&nbsp;<span class="op" id="4115688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115694">p</span><span class="op" id="4115695">.</span><span class="ident" id="4115696">syncPos</span>&nbsp;<span class="op" id="4115704">=</span>&nbsp;<span class="ident" id="4115706">p</span><span class="op" id="4115707">.</span><span class="ident" id="4115708">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115716">p</span><span class="op" id="4115717">.</span><span class="ident" id="4115718">syncCnt</span>&nbsp;<span class="op" id="4115726">=</span>&nbsp;<span class="num" id="4115728">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115748">case</span>&nbsp;<span class="ident" id="4115753">token</span><span class="op" id="4115758">.</span><span class="ident" id="4115759">EOF</span><span class="op" id="4115762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115767">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115780">p</span><span class="op" id="4115781">.</span><span class="ident" id="4115782">next</span><span class="op" id="4115786">(</span><span class="op" id="4115787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115790">}</span><br>
<span class="lineno"></span><span class="op" id="4115792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="4115795">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4115865">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="4115937">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4115974">//</span><br>
<span class="lineno"></span><span class="comment" id="4115977">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="4116052">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4116126">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4116205">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4116280">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="4116293">//</span><br>
<span class="lineno">505</span><span class="keyword" id="4116296">func</span>&nbsp;<span class="op" id="4116301">(</span><span class="ident" id="4116302">p</span>&nbsp;<span class="op" id="4116304">*</span><span class="ident" id="4116305">parser</span><span class="op" id="4116311">)</span>&nbsp;<span class="ident" id="4116313">safePos</span><span class="op" id="4116320">(</span><span class="ident" id="4116321">pos</span>&nbsp;<span class="ident" id="4116325">token</span><span class="op" id="4116330">.</span><span class="ident" id="4116331">Pos</span><span class="op" id="4116334">)</span>&nbsp;<span class="op" id="4116336">(</span><span class="ident" id="4116337">res</span>&nbsp;<span class="ident" id="4116341">token</span><span class="op" id="4116346">.</span><span class="ident" id="4116347">Pos</span><span class="op" id="4116350">)</span>&nbsp;<span class="op" id="4116352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116355">defer</span>&nbsp;<span class="keyword" id="4116361">func</span><span class="op" id="4116365">(</span><span class="op" id="4116366">)</span>&nbsp;<span class="op" id="4116368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116372">if</span>&nbsp;<span class="builtinfunc" id="4116375">recover</span><span class="op" id="4116382">(</span><span class="op" id="4116383">)</span>&nbsp;<span class="op" id="4116385">!=</span>&nbsp;<span class="ident" id="4116388">nil</span>&nbsp;<span class="op" id="4116392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116397">res</span>&nbsp;<span class="op" id="4116401">=</span>&nbsp;<span class="ident" id="4116403">token</span><span class="op" id="4116408">.</span><span class="ident" id="4116409">Pos</span><span class="op" id="4116412">(</span><span class="ident" id="4116413">p</span><span class="op" id="4116414">.</span><span class="ident" id="4116415">file</span><span class="op" id="4116419">.</span><span class="ident" id="4116420">Base</span><span class="op" id="4116424">(</span><span class="op" id="4116425">)</span>&nbsp;<span class="op" id="4116427">+</span>&nbsp;<span class="ident" id="4116429">p</span><span class="op" id="4116430">.</span><span class="ident" id="4116431">file</span><span class="op" id="4116435">.</span><span class="ident" id="4116436">Size</span><span class="op" id="4116440">(</span><span class="op" id="4116441">)</span><span class="op" id="4116442">)</span>&nbsp;<span class="comment" id="4116444">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116462">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116465">}</span><span class="op" id="4116466">(</span><span class="op" id="4116467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116470">_</span>&nbsp;<span class="op" id="4116472">=</span>&nbsp;<span class="ident" id="4116474">p</span><span class="op" id="4116475">.</span><span class="ident" id="4116476">file</span><span class="op" id="4116480">.</span><span class="ident" id="4116481">Offset</span><span class="op" id="4116487">(</span><span class="ident" id="4116488">pos</span><span class="op" id="4116491">)</span>&nbsp;<span class="comment" id="4116493">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116541">return</span>&nbsp;<span class="ident" id="4116548">pos</span><br>
<span class="lineno"></span><span class="op" id="4116552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="4116555">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4116635">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4116651">func</span>&nbsp;<span class="op" id="4116656">(</span><span class="ident" id="4116657">p</span>&nbsp;<span class="op" id="4116659">*</span><span class="ident" id="4116660">parser</span><span class="op" id="4116666">)</span>&nbsp;<span class="ident" id="4116668">parseIdent</span><span class="op" id="4116678">(</span><span class="op" id="4116679">)</span>&nbsp;<span class="op" id="4116681">*</span><span class="ident" id="4116682">ast</span><span class="op" id="4116685">.</span><span class="ident" id="4116686">Ident</span>&nbsp;<span class="op" id="4116692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116695">pos</span>&nbsp;<span class="op" id="4116699">:=</span>&nbsp;<span class="ident" id="4116702">p</span><span class="op" id="4116703">.</span><span class="ident" id="4116704">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116709">name</span>&nbsp;<span class="op" id="4116714">:=</span>&nbsp;<span class="string" id="4116717">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116722">if</span>&nbsp;<span class="ident" id="4116725">p</span><span class="op" id="4116726">.</span><span class="ident" id="4116727">tok</span>&nbsp;<span class="op" id="4116731">==</span>&nbsp;<span class="ident" id="4116734">token</span><span class="op" id="4116739">.</span><span class="ident" id="4116740">IDENT</span>&nbsp;<span class="op" id="4116746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116750">name</span>&nbsp;<span class="op" id="4116755">=</span>&nbsp;<span class="ident" id="4116757">p</span><span class="op" id="4116758">.</span><span class="ident" id="4116759">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116765">p</span><span class="op" id="4116766">.</span><span class="ident" id="4116767">next</span><span class="op" id="4116771">(</span><span class="op" id="4116772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116775">}</span>&nbsp;<span class="keyword" id="4116777">else</span>&nbsp;<span class="op" id="4116782">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116786">p</span><span class="op" id="4116787">.</span><span class="ident" id="4116788">expect</span><span class="op" id="4116794">(</span><span class="ident" id="4116795">token</span><span class="op" id="4116800">.</span><span class="ident" id="4116801">IDENT</span><span class="op" id="4116806">)</span>&nbsp;<span class="comment" id="4116808">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116843">return</span>&nbsp;<span class="op" id="4116850">&amp;</span><span class="ident" id="4116851">ast</span><span class="op" id="4116854">.</span><span class="ident" id="4116855">Ident</span><span class="op" id="4116860">{</span><span class="ident" id="4116861">NamePos</span><span class="op" id="4116868">:</span>&nbsp;<span class="ident" id="4116870">pos</span><span class="op" id="4116873">,</span>&nbsp;<span class="ident" id="4116875">Name</span><span class="op" id="4116879">:</span>&nbsp;<span class="ident" id="4116881">name</span><span class="op" id="4116885">}</span><br>
<span class="lineno"></span><span class="op" id="4116887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="4116890">func</span>&nbsp;<span class="op" id="4116895">(</span><span class="ident" id="4116896">p</span>&nbsp;<span class="op" id="4116898">*</span><span class="ident" id="4116899">parser</span><span class="op" id="4116905">)</span>&nbsp;<span class="ident" id="4116907">parseIdentList</span><span class="op" id="4116921">(</span><span class="op" id="4116922">)</span>&nbsp;<span class="op" id="4116924">(</span><span class="ident" id="4116925">list</span>&nbsp;<span class="op" id="4116930">[</span><span class="op" id="4116931">]</span><span class="op" id="4116932">*</span><span class="ident" id="4116933">ast</span><span class="op" id="4116936">.</span><span class="ident" id="4116937">Ident</span><span class="op" id="4116942">)</span>&nbsp;<span class="op" id="4116944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116947">if</span>&nbsp;<span class="ident" id="4116950">p</span><span class="op" id="4116951">.</span><span class="ident" id="4116952">trace</span>&nbsp;<span class="op" id="4116958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116962">defer</span>&nbsp;<span class="ident" id="4116968">un</span><span class="op" id="4116970">(</span><span class="ident" id="4116971">trace</span><span class="op" id="4116976">(</span><span class="ident" id="4116977">p</span><span class="op" id="4116978">,</span>&nbsp;<span class="string" id="4116980">&#34;IdentList&#34;</span><span class="op" id="4116991">)</span><span class="op" id="4116992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116999">list</span>&nbsp;<span class="op" id="4117004">=</span>&nbsp;<span class="builtinfunc" id="4117006">append</span><span class="op" id="4117012">(</span><span class="ident" id="4117013">list</span><span class="op" id="4117017">,</span>&nbsp;<span class="ident" id="4117019">p</span><span class="op" id="4117020">.</span><span class="ident" id="4117021">parseIdent</span><span class="op" id="4117031">(</span><span class="op" id="4117032">)</span><span class="op" id="4117033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117036">for</span>&nbsp;<span class="ident" id="4117040">p</span><span class="op" id="4117041">.</span><span class="ident" id="4117042">tok</span>&nbsp;<span class="op" id="4117046">==</span>&nbsp;<span class="ident" id="4117049">token</span><span class="op" id="4117054">.</span><span class="ident" id="4117055">COMMA</span>&nbsp;<span class="op" id="4117061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117065">p</span><span class="op" id="4117066">.</span><span class="ident" id="4117067">next</span><span class="op" id="4117071">(</span><span class="op" id="4117072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117076">list</span>&nbsp;<span class="op" id="4117081">=</span>&nbsp;<span class="builtinfunc" id="4117083">append</span><span class="op" id="4117089">(</span><span class="ident" id="4117090">list</span><span class="op" id="4117094">,</span>&nbsp;<span class="ident" id="4117096">p</span><span class="op" id="4117097">.</span><span class="ident" id="4117098">parseIdent</span><span class="op" id="4117108">(</span><span class="op" id="4117109">)</span><span class="op" id="4117110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117113">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117117">return</span><br>
<span class="lineno"></span><span class="op" id="4117124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4117127">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="4117207">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4117230">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4117309">func</span>&nbsp;<span class="op" id="4117314">(</span><span class="ident" id="4117315">p</span>&nbsp;<span class="op" id="4117317">*</span><span class="ident" id="4117318">parser</span><span class="op" id="4117324">)</span>&nbsp;<span class="ident" id="4117326">parseExprList</span><span class="op" id="4117339">(</span><span class="ident" id="4117340">lhs</span>&nbsp;<span class="builtintype" id="4117344">bool</span><span class="op" id="4117348">)</span>&nbsp;<span class="op" id="4117350">(</span><span class="ident" id="4117351">list</span>&nbsp;<span class="op" id="4117356">[</span><span class="op" id="4117357">]</span><span class="ident" id="4117358">ast</span><span class="op" id="4117361">.</span><span class="ident" id="4117362">Expr</span><span class="op" id="4117366">)</span>&nbsp;<span class="op" id="4117368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117371">if</span>&nbsp;<span class="ident" id="4117374">p</span><span class="op" id="4117375">.</span><span class="ident" id="4117376">trace</span>&nbsp;<span class="op" id="4117382">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117386">defer</span>&nbsp;<span class="ident" id="4117392">un</span><span class="op" id="4117394">(</span><span class="ident" id="4117395">trace</span><span class="op" id="4117400">(</span><span class="ident" id="4117401">p</span><span class="op" id="4117402">,</span>&nbsp;<span class="string" id="4117404">&#34;ExpressionList&#34;</span><span class="op" id="4117420">)</span><span class="op" id="4117421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117428">list</span>&nbsp;<span class="op" id="4117433">=</span>&nbsp;<span class="builtinfunc" id="4117435">append</span><span class="op" id="4117441">(</span><span class="ident" id="4117442">list</span><span class="op" id="4117446">,</span>&nbsp;<span class="ident" id="4117448">p</span><span class="op" id="4117449">.</span><span class="ident" id="4117450">checkExpr</span><span class="op" id="4117459">(</span><span class="ident" id="4117460">p</span><span class="op" id="4117461">.</span><span class="ident" id="4117462">parseExpr</span><span class="op" id="4117471">(</span><span class="ident" id="4117472">lhs</span><span class="op" id="4117475">)</span><span class="op" id="4117476">)</span><span class="op" id="4117477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117480">for</span>&nbsp;<span class="ident" id="4117484">p</span><span class="op" id="4117485">.</span><span class="ident" id="4117486">tok</span>&nbsp;<span class="op" id="4117490">==</span>&nbsp;<span class="ident" id="4117493">token</span><span class="op" id="4117498">.</span><span class="ident" id="4117499">COMMA</span>&nbsp;<span class="op" id="4117505">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117509">p</span><span class="op" id="4117510">.</span><span class="ident" id="4117511">next</span><span class="op" id="4117515">(</span><span class="op" id="4117516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117520">list</span>&nbsp;<span class="op" id="4117525">=</span>&nbsp;<span class="builtinfunc" id="4117527">append</span><span class="op" id="4117533">(</span><span class="ident" id="4117534">list</span><span class="op" id="4117538">,</span>&nbsp;<span class="ident" id="4117540">p</span><span class="op" id="4117541">.</span><span class="ident" id="4117542">checkExpr</span><span class="op" id="4117551">(</span><span class="ident" id="4117552">p</span><span class="op" id="4117553">.</span><span class="ident" id="4117554">parseExpr</span><span class="op" id="4117563">(</span><span class="ident" id="4117564">lhs</span><span class="op" id="4117567">)</span><span class="op" id="4117568">)</span><span class="op" id="4117569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117576">return</span><br>
<span class="lineno">560</span><span class="op" id="4117583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4117586">func</span>&nbsp;<span class="op" id="4117591">(</span><span class="ident" id="4117592">p</span>&nbsp;<span class="op" id="4117594">*</span><span class="ident" id="4117595">parser</span><span class="op" id="4117601">)</span>&nbsp;<span class="ident" id="4117603">parseLhsList</span><span class="op" id="4117615">(</span><span class="op" id="4117616">)</span>&nbsp;<span class="op" id="4117618">[</span><span class="op" id="4117619">]</span><span class="ident" id="4117620">ast</span><span class="op" id="4117623">.</span><span class="ident" id="4117624">Expr</span>&nbsp;<span class="op" id="4117629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117632">old</span>&nbsp;<span class="op" id="4117636">:=</span>&nbsp;<span class="ident" id="4117639">p</span><span class="op" id="4117640">.</span><span class="ident" id="4117641">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117648">p</span><span class="op" id="4117649">.</span><span class="ident" id="4117650">inRhs</span>&nbsp;<span class="op" id="4117656">=</span>&nbsp;<span class="builtintype" id="4117658">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117665">list</span>&nbsp;<span class="op" id="4117670">:=</span>&nbsp;<span class="ident" id="4117673">p</span><span class="op" id="4117674">.</span><span class="ident" id="4117675">parseExprList</span><span class="op" id="4117688">(</span><span class="builtintype" id="4117689">true</span><span class="op" id="4117693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117696">switch</span>&nbsp;<span class="ident" id="4117703">p</span><span class="op" id="4117704">.</span><span class="ident" id="4117705">tok</span>&nbsp;<span class="op" id="4117709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117712">case</span>&nbsp;<span class="ident" id="4117717">token</span><span class="op" id="4117722">.</span><span class="ident" id="4117723">DEFINE</span><span class="op" id="4117729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117733">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117774">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117816">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117876">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117901">case</span>&nbsp;<span class="ident" id="4117906">token</span><span class="op" id="4117911">.</span><span class="ident" id="4117912">COLON</span><span class="op" id="4117917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117921">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117991">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118063">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118092">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118149">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118220">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118289">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118334">default</span><span class="op" id="4118341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118345">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118389">for</span>&nbsp;<span class="ident" id="4118393">_</span><span class="op" id="4118394">,</span>&nbsp;<span class="ident" id="4118396">x</span>&nbsp;<span class="op" id="4118398">:=</span>&nbsp;<span class="keyword" id="4118401">range</span>&nbsp;<span class="ident" id="4118407">list</span>&nbsp;<span class="op" id="4118412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118417">p</span><span class="op" id="4118418">.</span><span class="ident" id="4118419">resolve</span><span class="op" id="4118426">(</span><span class="ident" id="4118427">x</span><span class="op" id="4118428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118432">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118438">p</span><span class="op" id="4118439">.</span><span class="ident" id="4118440">inRhs</span>&nbsp;<span class="op" id="4118446">=</span>&nbsp;<span class="ident" id="4118448">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118453">return</span>&nbsp;<span class="ident" id="4118460">list</span><br>
<span class="lineno"></span><span class="op" id="4118465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4118468">func</span>&nbsp;<span class="op" id="4118473">(</span><span class="ident" id="4118474">p</span>&nbsp;<span class="op" id="4118476">*</span><span class="ident" id="4118477">parser</span><span class="op" id="4118483">)</span>&nbsp;<span class="ident" id="4118485">parseRhsList</span><span class="op" id="4118497">(</span><span class="op" id="4118498">)</span>&nbsp;<span class="op" id="4118500">[</span><span class="op" id="4118501">]</span><span class="ident" id="4118502">ast</span><span class="op" id="4118505">.</span><span class="ident" id="4118506">Expr</span>&nbsp;<span class="op" id="4118511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118514">old</span>&nbsp;<span class="op" id="4118518">:=</span>&nbsp;<span class="ident" id="4118521">p</span><span class="op" id="4118522">.</span><span class="ident" id="4118523">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118530">p</span><span class="op" id="4118531">.</span><span class="ident" id="4118532">inRhs</span>&nbsp;<span class="op" id="4118538">=</span>&nbsp;<span class="builtintype" id="4118540">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118546">list</span>&nbsp;<span class="op" id="4118551">:=</span>&nbsp;<span class="ident" id="4118554">p</span><span class="op" id="4118555">.</span><span class="ident" id="4118556">parseExprList</span><span class="op" id="4118569">(</span><span class="builtintype" id="4118570">false</span><span class="op" id="4118575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118578">p</span><span class="op" id="4118579">.</span><span class="ident" id="4118580">inRhs</span>&nbsp;<span class="op" id="4118586">=</span>&nbsp;<span class="ident" id="4118588">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118593">return</span>&nbsp;<span class="ident" id="4118600">list</span><br>
<span class="lineno"></span><span class="op" id="4118605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4118608">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4118688">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4118698">func</span>&nbsp;<span class="op" id="4118703">(</span><span class="ident" id="4118704">p</span>&nbsp;<span class="op" id="4118706">*</span><span class="ident" id="4118707">parser</span><span class="op" id="4118713">)</span>&nbsp;<span class="ident" id="4118715">parseType</span><span class="op" id="4118724">(</span><span class="op" id="4118725">)</span>&nbsp;<span class="ident" id="4118727">ast</span><span class="op" id="4118730">.</span><span class="ident" id="4118731">Expr</span>&nbsp;<span class="op" id="4118736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118739">if</span>&nbsp;<span class="ident" id="4118742">p</span><span class="op" id="4118743">.</span><span class="ident" id="4118744">trace</span>&nbsp;<span class="op" id="4118750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118754">defer</span>&nbsp;<span class="ident" id="4118760">un</span><span class="op" id="4118762">(</span><span class="ident" id="4118763">trace</span><span class="op" id="4118768">(</span><span class="ident" id="4118769">p</span><span class="op" id="4118770">,</span>&nbsp;<span class="string" id="4118772">&#34;Type&#34;</span><span class="op" id="4118778">)</span><span class="op" id="4118779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118782">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118786">typ</span>&nbsp;<span class="op" id="4118790">:=</span>&nbsp;<span class="ident" id="4118793">p</span><span class="op" id="4118794">.</span><span class="ident" id="4118795">tryType</span><span class="op" id="4118802">(</span><span class="op" id="4118803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118807">if</span>&nbsp;<span class="ident" id="4118810">typ</span>&nbsp;<span class="op" id="4118814">==</span>&nbsp;<span class="ident" id="4118817">nil</span>&nbsp;<span class="op" id="4118821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118825">pos</span>&nbsp;<span class="op" id="4118829">:=</span>&nbsp;<span class="ident" id="4118832">p</span><span class="op" id="4118833">.</span><span class="ident" id="4118834">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118840">p</span><span class="op" id="4118841">.</span><span class="ident" id="4118842">errorExpected</span><span class="op" id="4118855">(</span><span class="ident" id="4118856">pos</span><span class="op" id="4118859">,</span>&nbsp;<span class="string" id="4118861">&#34;type&#34;</span><span class="op" id="4118867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118871">p</span><span class="op" id="4118872">.</span><span class="ident" id="4118873">next</span><span class="op" id="4118877">(</span><span class="op" id="4118878">)</span>&nbsp;<span class="comment" id="4118880">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118899">return</span>&nbsp;<span class="op" id="4118906">&amp;</span><span class="ident" id="4118907">ast</span><span class="op" id="4118910">.</span><span class="ident" id="4118911">BadExpr</span><span class="op" id="4118918">{</span><span class="ident" id="4118919">From</span><span class="op" id="4118923">:</span>&nbsp;<span class="ident" id="4118925">pos</span><span class="op" id="4118928">,</span>&nbsp;<span class="ident" id="4118930">To</span><span class="op" id="4118932">:</span>&nbsp;<span class="ident" id="4118934">p</span><span class="op" id="4118935">.</span><span class="ident" id="4118936">pos</span><span class="op" id="4118939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118946">return</span>&nbsp;<span class="ident" id="4118953">typ</span><br>
<span class="lineno"></span><span class="op" id="4118957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4118960">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4119015">func</span>&nbsp;<span class="op" id="4119020">(</span><span class="ident" id="4119021">p</span>&nbsp;<span class="op" id="4119023">*</span><span class="ident" id="4119024">parser</span><span class="op" id="4119030">)</span>&nbsp;<span class="ident" id="4119032">parseTypeName</span><span class="op" id="4119045">(</span><span class="op" id="4119046">)</span>&nbsp;<span class="ident" id="4119048">ast</span><span class="op" id="4119051">.</span><span class="ident" id="4119052">Expr</span>&nbsp;<span class="op" id="4119057">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119060">if</span>&nbsp;<span class="ident" id="4119063">p</span><span class="op" id="4119064">.</span><span class="ident" id="4119065">trace</span>&nbsp;<span class="op" id="4119071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119075">defer</span>&nbsp;<span class="ident" id="4119081">un</span><span class="op" id="4119083">(</span><span class="ident" id="4119084">trace</span><span class="op" id="4119089">(</span><span class="ident" id="4119090">p</span><span class="op" id="4119091">,</span>&nbsp;<span class="string" id="4119093">&#34;TypeName&#34;</span><span class="op" id="4119103">)</span><span class="op" id="4119104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119111">ident</span>&nbsp;<span class="op" id="4119117">:=</span>&nbsp;<span class="ident" id="4119120">p</span><span class="op" id="4119121">.</span><span class="ident" id="4119122">parseIdent</span><span class="op" id="4119132">(</span><span class="op" id="4119133">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4119136">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119203">if</span>&nbsp;<span class="ident" id="4119206">p</span><span class="op" id="4119207">.</span><span class="ident" id="4119208">tok</span>&nbsp;<span class="op" id="4119212">==</span>&nbsp;<span class="ident" id="4119215">token</span><span class="op" id="4119220">.</span><span class="ident" id="4119221">PERIOD</span>&nbsp;<span class="op" id="4119228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4119232">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119261">p</span><span class="op" id="4119262">.</span><span class="ident" id="4119263">next</span><span class="op" id="4119267">(</span><span class="op" id="4119268">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119272">p</span><span class="op" id="4119273">.</span><span class="ident" id="4119274">resolve</span><span class="op" id="4119281">(</span><span class="ident" id="4119282">ident</span><span class="op" id="4119287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119291">sel</span>&nbsp;<span class="op" id="4119295">:=</span>&nbsp;<span class="ident" id="4119298">p</span><span class="op" id="4119299">.</span><span class="ident" id="4119300">parseIdent</span><span class="op" id="4119310">(</span><span class="op" id="4119311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119315">return</span>&nbsp;<span class="op" id="4119322">&amp;</span><span class="ident" id="4119323">ast</span><span class="op" id="4119326">.</span><span class="ident" id="4119327">SelectorExpr</span><span class="op" id="4119339">{</span><span class="ident" id="4119340">X</span><span class="op" id="4119341">:</span>&nbsp;<span class="ident" id="4119343">ident</span><span class="op" id="4119348">,</span>&nbsp;<span class="ident" id="4119350">Sel</span><span class="op" id="4119353">:</span>&nbsp;<span class="ident" id="4119355">sel</span><span class="op" id="4119358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119365">return</span>&nbsp;<span class="ident" id="4119372">ident</span><br>
<span class="lineno"></span><span class="op" id="4119378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4119381">func</span>&nbsp;<span class="op" id="4119386">(</span><span class="ident" id="4119387">p</span>&nbsp;<span class="op" id="4119389">*</span><span class="ident" id="4119390">parser</span><span class="op" id="4119396">)</span>&nbsp;<span class="ident" id="4119398">parseArrayType</span><span class="op" id="4119412">(</span><span class="op" id="4119413">)</span>&nbsp;<span class="ident" id="4119415">ast</span><span class="op" id="4119418">.</span><span class="ident" id="4119419">Expr</span>&nbsp;<span class="op" id="4119424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119427">if</span>&nbsp;<span class="ident" id="4119430">p</span><span class="op" id="4119431">.</span><span class="ident" id="4119432">trace</span>&nbsp;<span class="op" id="4119438">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119442">defer</span>&nbsp;<span class="ident" id="4119448">un</span><span class="op" id="4119450">(</span><span class="ident" id="4119451">trace</span><span class="op" id="4119456">(</span><span class="ident" id="4119457">p</span><span class="op" id="4119458">,</span>&nbsp;<span class="string" id="4119460">&#34;ArrayType&#34;</span><span class="op" id="4119471">)</span><span class="op" id="4119472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119479">lbrack</span>&nbsp;<span class="op" id="4119486">:=</span>&nbsp;<span class="ident" id="4119489">p</span><span class="op" id="4119490">.</span><span class="ident" id="4119491">expect</span><span class="op" id="4119497">(</span><span class="ident" id="4119498">token</span><span class="op" id="4119503">.</span><span class="ident" id="4119504">LBRACK</span><span class="op" id="4119510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119513">p</span><span class="op" id="4119514">.</span><span class="ident" id="4119515">exprLev</span><span class="op" id="4119522">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119526">var</span>&nbsp;<span class="builtinfunc" id="4119530">len</span>&nbsp;<span class="ident" id="4119534">ast</span><span class="op" id="4119537">.</span><span class="ident" id="4119538">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4119544">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119603">if</span>&nbsp;<span class="ident" id="4119606">p</span><span class="op" id="4119607">.</span><span class="ident" id="4119608">tok</span>&nbsp;<span class="op" id="4119612">==</span>&nbsp;<span class="ident" id="4119615">token</span><span class="op" id="4119620">.</span><span class="ident" id="4119621">ELLIPSIS</span>&nbsp;<span class="op" id="4119630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4119634">len</span>&nbsp;<span class="op" id="4119638">=</span>&nbsp;<span class="op" id="4119640">&amp;</span><span class="ident" id="4119641">ast</span><span class="op" id="4119644">.</span><span class="ident" id="4119645">Ellipsis</span><span class="op" id="4119653">{</span><span class="ident" id="4119654">Ellipsis</span><span class="op" id="4119662">:</span>&nbsp;<span class="ident" id="4119664">p</span><span class="op" id="4119665">.</span><span class="ident" id="4119666">pos</span><span class="op" id="4119669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119673">p</span><span class="op" id="4119674">.</span><span class="ident" id="4119675">next</span><span class="op" id="4119679">(</span><span class="op" id="4119680">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119683">}</span>&nbsp;<span class="keyword" id="4119685">else</span>&nbsp;<span class="keyword" id="4119690">if</span>&nbsp;<span class="ident" id="4119693">p</span><span class="op" id="4119694">.</span><span class="ident" id="4119695">tok</span>&nbsp;<span class="op" id="4119699">!=</span>&nbsp;<span class="ident" id="4119702">token</span><span class="op" id="4119707">.</span><span class="ident" id="4119708">RBRACK</span>&nbsp;<span class="op" id="4119715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4119719">len</span>&nbsp;<span class="op" id="4119723">=</span>&nbsp;<span class="ident" id="4119725">p</span><span class="op" id="4119726">.</span><span class="ident" id="4119727">parseRhs</span><span class="op" id="4119735">(</span><span class="op" id="4119736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119742">p</span><span class="op" id="4119743">.</span><span class="ident" id="4119744">exprLev</span><span class="op" id="4119751">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119755">p</span><span class="op" id="4119756">.</span><span class="ident" id="4119757">expect</span><span class="op" id="4119763">(</span><span class="ident" id="4119764">token</span><span class="op" id="4119769">.</span><span class="ident" id="4119770">RBRACK</span><span class="op" id="4119776">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119779">elt</span>&nbsp;<span class="op" id="4119783">:=</span>&nbsp;<span class="ident" id="4119786">p</span><span class="op" id="4119787">.</span><span class="ident" id="4119788">parseType</span><span class="op" id="4119797">(</span><span class="op" id="4119798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119802">return</span>&nbsp;<span class="op" id="4119809">&amp;</span><span class="ident" id="4119810">ast</span><span class="op" id="4119813">.</span><span class="ident" id="4119814">ArrayType</span><span class="op" id="4119823">{</span><span class="ident" id="4119824">Lbrack</span><span class="op" id="4119830">:</span>&nbsp;<span class="ident" id="4119832">lbrack</span><span class="op" id="4119838">,</span>&nbsp;<span class="ident" id="4119840">Len</span><span class="op" id="4119843">:</span>&nbsp;<span class="builtinfunc" id="4119845">len</span><span class="op" id="4119848">,</span>&nbsp;<span class="ident" id="4119850">Elt</span><span class="op" id="4119853">:</span>&nbsp;<span class="ident" id="4119855">elt</span><span class="op" id="4119858">}</span><br>
<span class="lineno"></span><span class="op" id="4119860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="4119863">func</span>&nbsp;<span class="op" id="4119868">(</span><span class="ident" id="4119869">p</span>&nbsp;<span class="op" id="4119871">*</span><span class="ident" id="4119872">parser</span><span class="op" id="4119878">)</span>&nbsp;<span class="ident" id="4119880">makeIdentList</span><span class="op" id="4119893">(</span><span class="ident" id="4119894">list</span>&nbsp;<span class="op" id="4119899">[</span><span class="op" id="4119900">]</span><span class="ident" id="4119901">ast</span><span class="op" id="4119904">.</span><span class="ident" id="4119905">Expr</span><span class="op" id="4119909">)</span>&nbsp;<span class="op" id="4119911">[</span><span class="op" id="4119912">]</span><span class="op" id="4119913">*</span><span class="ident" id="4119914">ast</span><span class="op" id="4119917">.</span><span class="ident" id="4119918">Ident</span>&nbsp;<span class="op" id="4119924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119927">idents</span>&nbsp;<span class="op" id="4119934">:=</span>&nbsp;<span class="builtinfunc" id="4119937">make</span><span class="op" id="4119941">(</span><span class="op" id="4119942">[</span><span class="op" id="4119943">]</span><span class="op" id="4119944">*</span><span class="ident" id="4119945">ast</span><span class="op" id="4119948">.</span><span class="ident" id="4119949">Ident</span><span class="op" id="4119954">,</span>&nbsp;<span class="builtinfunc" id="4119956">len</span><span class="op" id="4119959">(</span><span class="ident" id="4119960">list</span><span class="op" id="4119964">)</span><span class="op" id="4119965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119968">for</span>&nbsp;<span class="ident" id="4119972">i</span><span class="op" id="4119973">,</span>&nbsp;<span class="ident" id="4119975">x</span>&nbsp;<span class="op" id="4119977">:=</span>&nbsp;<span class="keyword" id="4119980">range</span>&nbsp;<span class="ident" id="4119986">list</span>&nbsp;<span class="op" id="4119991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119995">ident</span><span class="op" id="4120000">,</span>&nbsp;<span class="ident" id="4120002">isIdent</span>&nbsp;<span class="op" id="4120010">:=</span>&nbsp;<span class="ident" id="4120013">x</span><span class="op" id="4120014">.</span><span class="op" id="4120015">(</span><span class="op" id="4120016">*</span><span class="ident" id="4120017">ast</span><span class="op" id="4120020">.</span><span class="ident" id="4120021">Ident</span><span class="op" id="4120026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120030">if</span>&nbsp;<span class="op" id="4120033">!</span><span class="ident" id="4120034">isIdent</span>&nbsp;<span class="op" id="4120042">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120047">if</span>&nbsp;<span class="ident" id="4120050">_</span><span class="op" id="4120051">,</span>&nbsp;<span class="ident" id="4120053">isBad</span>&nbsp;<span class="op" id="4120059">:=</span>&nbsp;<span class="ident" id="4120062">x</span><span class="op" id="4120063">.</span><span class="op" id="4120064">(</span><span class="op" id="4120065">*</span><span class="ident" id="4120066">ast</span><span class="op" id="4120069">.</span><span class="ident" id="4120070">BadExpr</span><span class="op" id="4120077">)</span><span class="op" id="4120078">;</span>&nbsp;<span class="op" id="4120080">!</span><span class="ident" id="4120081">isBad</span>&nbsp;<span class="op" id="4120087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120093">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120136">p</span><span class="op" id="4120137">.</span><span class="ident" id="4120138">errorExpected</span><span class="op" id="4120151">(</span><span class="ident" id="4120152">x</span><span class="op" id="4120153">.</span><span class="ident" id="4120154">Pos</span><span class="op" id="4120157">(</span><span class="op" id="4120158">)</span><span class="op" id="4120159">,</span>&nbsp;<span class="string" id="4120161">&#34;identifier&#34;</span><span class="op" id="4120173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120183">ident</span>&nbsp;<span class="op" id="4120189">=</span>&nbsp;<span class="op" id="4120191">&amp;</span><span class="ident" id="4120192">ast</span><span class="op" id="4120195">.</span><span class="ident" id="4120196">Ident</span><span class="op" id="4120201">{</span><span class="ident" id="4120202">NamePos</span><span class="op" id="4120209">:</span>&nbsp;<span class="ident" id="4120211">x</span><span class="op" id="4120212">.</span><span class="ident" id="4120213">Pos</span><span class="op" id="4120216">(</span><span class="op" id="4120217">)</span><span class="op" id="4120218">,</span>&nbsp;<span class="ident" id="4120220">Name</span><span class="op" id="4120224">:</span>&nbsp;<span class="string" id="4120226">&#34;_&#34;</span><span class="op" id="4120229">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120237">idents</span><span class="op" id="4120243">[</span><span class="ident" id="4120244">i</span><span class="op" id="4120245">]</span>&nbsp;<span class="op" id="4120247">=</span>&nbsp;<span class="ident" id="4120249">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120259">return</span>&nbsp;<span class="ident" id="4120266">idents</span><br>
<span class="lineno"></span><span class="op" id="4120273">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4120276">func</span>&nbsp;<span class="op" id="4120281">(</span><span class="ident" id="4120282">p</span>&nbsp;<span class="op" id="4120284">*</span><span class="ident" id="4120285">parser</span><span class="op" id="4120291">)</span>&nbsp;<span class="ident" id="4120293">parseFieldDecl</span><span class="op" id="4120307">(</span><span class="ident" id="4120308">scope</span>&nbsp;<span class="op" id="4120314">*</span><span class="ident" id="4120315">ast</span><span class="op" id="4120318">.</span><span class="ident" id="4120319">Scope</span><span class="op" id="4120324">)</span>&nbsp;<span class="op" id="4120326">*</span><span class="ident" id="4120327">ast</span><span class="op" id="4120330">.</span><span class="ident" id="4120331">Field</span>&nbsp;<span class="op" id="4120337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120340">if</span>&nbsp;<span class="ident" id="4120343">p</span><span class="op" id="4120344">.</span><span class="ident" id="4120345">trace</span>&nbsp;<span class="op" id="4120351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120355">defer</span>&nbsp;<span class="ident" id="4120361">un</span><span class="op" id="4120363">(</span><span class="ident" id="4120364">trace</span><span class="op" id="4120369">(</span><span class="ident" id="4120370">p</span><span class="op" id="4120371">,</span>&nbsp;<span class="string" id="4120373">&#34;FieldDecl&#34;</span><span class="op" id="4120384">)</span><span class="op" id="4120385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120388">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120392">doc</span>&nbsp;<span class="op" id="4120396">:=</span>&nbsp;<span class="ident" id="4120399">p</span><span class="op" id="4120400">.</span><span class="ident" id="4120401">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120415">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120429">list</span><span class="op" id="4120433">,</span>&nbsp;<span class="ident" id="4120435">typ</span>&nbsp;<span class="op" id="4120439">:=</span>&nbsp;<span class="ident" id="4120442">p</span><span class="op" id="4120443">.</span><span class="ident" id="4120444">parseVarList</span><span class="op" id="4120456">(</span><span class="builtintype" id="4120457">false</span><span class="op" id="4120462">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120466">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120474">var</span>&nbsp;<span class="ident" id="4120478">tag</span>&nbsp;<span class="op" id="4120482">*</span><span class="ident" id="4120483">ast</span><span class="op" id="4120486">.</span><span class="ident" id="4120487">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120497">if</span>&nbsp;<span class="ident" id="4120500">p</span><span class="op" id="4120501">.</span><span class="ident" id="4120502">tok</span>&nbsp;<span class="op" id="4120506">==</span>&nbsp;<span class="ident" id="4120509">token</span><span class="op" id="4120514">.</span><span class="ident" id="4120515">STRING</span>&nbsp;<span class="op" id="4120522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120526">tag</span>&nbsp;<span class="op" id="4120530">=</span>&nbsp;<span class="op" id="4120532">&amp;</span><span class="ident" id="4120533">ast</span><span class="op" id="4120536">.</span><span class="ident" id="4120537">BasicLit</span><span class="op" id="4120545">{</span><span class="ident" id="4120546">ValuePos</span><span class="op" id="4120554">:</span>&nbsp;<span class="ident" id="4120556">p</span><span class="op" id="4120557">.</span><span class="ident" id="4120558">pos</span><span class="op" id="4120561">,</span>&nbsp;<span class="ident" id="4120563">Kind</span><span class="op" id="4120567">:</span>&nbsp;<span class="ident" id="4120569">p</span><span class="op" id="4120570">.</span><span class="ident" id="4120571">tok</span><span class="op" id="4120574">,</span>&nbsp;<span class="ident" id="4120576">Value</span><span class="op" id="4120581">:</span>&nbsp;<span class="ident" id="4120583">p</span><span class="op" id="4120584">.</span><span class="ident" id="4120585">lit</span><span class="op" id="4120588">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120592">p</span><span class="op" id="4120593">.</span><span class="ident" id="4120594">next</span><span class="op" id="4120598">(</span><span class="op" id="4120599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120606">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120623">var</span>&nbsp;<span class="ident" id="4120627">idents</span>&nbsp;<span class="op" id="4120634">[</span><span class="op" id="4120635">]</span><span class="op" id="4120636">*</span><span class="ident" id="4120637">ast</span><span class="op" id="4120640">.</span><span class="ident" id="4120641">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120648">if</span>&nbsp;<span class="ident" id="4120651">typ</span>&nbsp;<span class="op" id="4120655">!=</span>&nbsp;<span class="ident" id="4120658">nil</span>&nbsp;<span class="op" id="4120662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120666">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120691">idents</span>&nbsp;<span class="op" id="4120698">=</span>&nbsp;<span class="ident" id="4120700">p</span><span class="op" id="4120701">.</span><span class="ident" id="4120702">makeIdentList</span><span class="op" id="4120715">(</span><span class="ident" id="4120716">list</span><span class="op" id="4120720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120723">}</span>&nbsp;<span class="keyword" id="4120725">else</span>&nbsp;<span class="op" id="4120730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4120734">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120771">typ</span>&nbsp;<span class="op" id="4120775">=</span>&nbsp;<span class="ident" id="4120777">list</span><span class="op" id="4120781">[</span><span class="num" id="4120782">0</span><span class="op" id="4120783">]</span>&nbsp;<span class="comment" id="4120785">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120826">if</span>&nbsp;<span class="ident" id="4120829">n</span>&nbsp;<span class="op" id="4120831">:=</span>&nbsp;<span class="builtinfunc" id="4120834">len</span><span class="op" id="4120837">(</span><span class="ident" id="4120838">list</span><span class="op" id="4120842">)</span><span class="op" id="4120843">;</span>&nbsp;<span class="ident" id="4120845">n</span>&nbsp;<span class="op" id="4120847">&gt;</span>&nbsp;<span class="num" id="4120849">1</span>&nbsp;<span class="op" id="4120851">||</span>&nbsp;<span class="op" id="4120854">!</span><span class="ident" id="4120855">isTypeName</span><span class="op" id="4120865">(</span><span class="ident" id="4120866">deref</span><span class="op" id="4120871">(</span><span class="ident" id="4120872">typ</span><span class="op" id="4120875">)</span><span class="op" id="4120876">)</span>&nbsp;<span class="op" id="4120878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120883">pos</span>&nbsp;<span class="op" id="4120887">:=</span>&nbsp;<span class="ident" id="4120890">typ</span><span class="op" id="4120893">.</span><span class="ident" id="4120894">Pos</span><span class="op" id="4120897">(</span><span class="op" id="4120898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120903">p</span><span class="op" id="4120904">.</span><span class="ident" id="4120905">errorExpected</span><span class="op" id="4120918">(</span><span class="ident" id="4120919">pos</span><span class="op" id="4120922">,</span>&nbsp;<span class="string" id="4120924">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="4120941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120946">typ</span>&nbsp;<span class="op" id="4120950">=</span>&nbsp;<span class="op" id="4120952">&amp;</span><span class="ident" id="4120953">ast</span><span class="op" id="4120956">.</span><span class="ident" id="4120957">BadExpr</span><span class="op" id="4120964">{</span><span class="ident" id="4120965">From</span><span class="op" id="4120969">:</span>&nbsp;<span class="ident" id="4120971">pos</span><span class="op" id="4120974">,</span>&nbsp;<span class="ident" id="4120976">To</span><span class="op" id="4120978">:</span>&nbsp;<span class="ident" id="4120980">p</span><span class="op" id="4120981">.</span><span class="ident" id="4120982">safePos</span><span class="op" id="4120989">(</span><span class="ident" id="4120990">list</span><span class="op" id="4120994">[</span><span class="ident" id="4120995">n</span><span class="op" id="4120996">-</span><span class="num" id="4120997">1</span><span class="op" id="4120998">]</span><span class="op" id="4120999">.</span><span class="ident" id="4121000">End</span><span class="op" id="4121003">(</span><span class="op" id="4121004">)</span><span class="op" id="4121005">)</span><span class="op" id="4121006">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121017">p</span><span class="op" id="4121018">.</span><span class="ident" id="4121019">expectSemi</span><span class="op" id="4121029">(</span><span class="op" id="4121030">)</span>&nbsp;<span class="comment" id="4121032">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121073">field</span>&nbsp;<span class="op" id="4121079">:=</span>&nbsp;<span class="op" id="4121082">&amp;</span><span class="ident" id="4121083">ast</span><span class="op" id="4121086">.</span><span class="ident" id="4121087">Field</span><span class="op" id="4121092">{</span><span class="ident" id="4121093">Doc</span><span class="op" id="4121096">:</span>&nbsp;<span class="ident" id="4121098">doc</span><span class="op" id="4121101">,</span>&nbsp;<span class="ident" id="4121103">Names</span><span class="op" id="4121108">:</span>&nbsp;<span class="ident" id="4121110">idents</span><span class="op" id="4121116">,</span>&nbsp;<span class="ident" id="4121118">Type</span><span class="op" id="4121122">:</span>&nbsp;<span class="ident" id="4121124">typ</span><span class="op" id="4121127">,</span>&nbsp;<span class="ident" id="4121129">Tag</span><span class="op" id="4121132">:</span>&nbsp;<span class="ident" id="4121134">tag</span><span class="op" id="4121137">,</span>&nbsp;<span class="ident" id="4121139">Comment</span><span class="op" id="4121146">:</span>&nbsp;<span class="ident" id="4121148">p</span><span class="op" id="4121149">.</span><span class="ident" id="4121150">lineComment</span><span class="op" id="4121161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121164">p</span><span class="op" id="4121165">.</span><span class="ident" id="4121166">declare</span><span class="op" id="4121173">(</span><span class="ident" id="4121174">field</span><span class="op" id="4121179">,</span>&nbsp;<span class="ident" id="4121181">nil</span><span class="op" id="4121184">,</span>&nbsp;<span class="ident" id="4121186">scope</span><span class="op" id="4121191">,</span>&nbsp;<span class="ident" id="4121193">ast</span><span class="op" id="4121196">.</span><span class="ident" id="4121197">Var</span><span class="op" id="4121200">,</span>&nbsp;<span class="ident" id="4121202">idents</span><span class="op" id="4121208">...</span><span class="op" id="4121211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121214">p</span><span class="op" id="4121215">.</span><span class="ident" id="4121216">resolve</span><span class="op" id="4121223">(</span><span class="ident" id="4121224">typ</span><span class="op" id="4121227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121231">return</span>&nbsp;<span class="ident" id="4121238">field</span><br>
<span class="lineno">715</span><span class="op" id="4121244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4121247">func</span>&nbsp;<span class="op" id="4121252">(</span><span class="ident" id="4121253">p</span>&nbsp;<span class="op" id="4121255">*</span><span class="ident" id="4121256">parser</span><span class="op" id="4121262">)</span>&nbsp;<span class="ident" id="4121264">parseStructType</span><span class="op" id="4121279">(</span><span class="op" id="4121280">)</span>&nbsp;<span class="op" id="4121282">*</span><span class="ident" id="4121283">ast</span><span class="op" id="4121286">.</span><span class="ident" id="4121287">StructType</span>&nbsp;<span class="op" id="4121298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121301">if</span>&nbsp;<span class="ident" id="4121304">p</span><span class="op" id="4121305">.</span><span class="ident" id="4121306">trace</span>&nbsp;<span class="op" id="4121312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121316">defer</span>&nbsp;<span class="ident" id="4121322">un</span><span class="op" id="4121324">(</span><span class="ident" id="4121325">trace</span><span class="op" id="4121330">(</span><span class="ident" id="4121331">p</span><span class="op" id="4121332">,</span>&nbsp;<span class="string" id="4121334">&#34;StructType&#34;</span><span class="op" id="4121346">)</span><span class="op" id="4121347">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121354">pos</span>&nbsp;<span class="op" id="4121358">:=</span>&nbsp;<span class="ident" id="4121361">p</span><span class="op" id="4121362">.</span><span class="ident" id="4121363">expect</span><span class="op" id="4121369">(</span><span class="ident" id="4121370">token</span><span class="op" id="4121375">.</span><span class="ident" id="4121376">STRUCT</span><span class="op" id="4121382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121385">lbrace</span>&nbsp;<span class="op" id="4121392">:=</span>&nbsp;<span class="ident" id="4121395">p</span><span class="op" id="4121396">.</span><span class="ident" id="4121397">expect</span><span class="op" id="4121403">(</span><span class="ident" id="4121404">token</span><span class="op" id="4121409">.</span><span class="ident" id="4121410">LBRACE</span><span class="op" id="4121416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121419">scope</span>&nbsp;<span class="op" id="4121425">:=</span>&nbsp;<span class="ident" id="4121428">ast</span><span class="op" id="4121431">.</span><span class="ident" id="4121432">NewScope</span><span class="op" id="4121440">(</span><span class="ident" id="4121441">nil</span><span class="op" id="4121444">)</span>&nbsp;<span class="comment" id="4121446">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121463">var</span>&nbsp;<span class="ident" id="4121467">list</span>&nbsp;<span class="op" id="4121472">[</span><span class="op" id="4121473">]</span><span class="op" id="4121474">*</span><span class="ident" id="4121475">ast</span><span class="op" id="4121478">.</span><span class="ident" id="4121479">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121486">for</span>&nbsp;<span class="ident" id="4121490">p</span><span class="op" id="4121491">.</span><span class="ident" id="4121492">tok</span>&nbsp;<span class="op" id="4121496">==</span>&nbsp;<span class="ident" id="4121499">token</span><span class="op" id="4121504">.</span><span class="ident" id="4121505">IDENT</span>&nbsp;<span class="op" id="4121511">||</span>&nbsp;<span class="ident" id="4121514">p</span><span class="op" id="4121515">.</span><span class="ident" id="4121516">tok</span>&nbsp;<span class="op" id="4121520">==</span>&nbsp;<span class="ident" id="4121523">token</span><span class="op" id="4121528">.</span><span class="ident" id="4121529">MUL</span>&nbsp;<span class="op" id="4121533">||</span>&nbsp;<span class="ident" id="4121536">p</span><span class="op" id="4121537">.</span><span class="ident" id="4121538">tok</span>&nbsp;<span class="op" id="4121542">==</span>&nbsp;<span class="ident" id="4121545">token</span><span class="op" id="4121550">.</span><span class="ident" id="4121551">LPAREN</span>&nbsp;<span class="op" id="4121558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4121562">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4121625">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4121688">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121747">list</span>&nbsp;<span class="op" id="4121752">=</span>&nbsp;<span class="builtinfunc" id="4121754">append</span><span class="op" id="4121760">(</span><span class="ident" id="4121761">list</span><span class="op" id="4121765">,</span>&nbsp;<span class="ident" id="4121767">p</span><span class="op" id="4121768">.</span><span class="ident" id="4121769">parseFieldDecl</span><span class="op" id="4121783">(</span><span class="ident" id="4121784">scope</span><span class="op" id="4121789">)</span><span class="op" id="4121790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121796">rbrace</span>&nbsp;<span class="op" id="4121803">:=</span>&nbsp;<span class="ident" id="4121806">p</span><span class="op" id="4121807">.</span><span class="ident" id="4121808">expect</span><span class="op" id="4121814">(</span><span class="ident" id="4121815">token</span><span class="op" id="4121820">.</span><span class="ident" id="4121821">RBRACE</span><span class="op" id="4121827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4121831">return</span>&nbsp;<span class="op" id="4121838">&amp;</span><span class="ident" id="4121839">ast</span><span class="op" id="4121842">.</span><span class="ident" id="4121843">StructType</span><span class="op" id="4121853">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121857">Struct</span><span class="op" id="4121863">:</span>&nbsp;<span class="ident" id="4121865">pos</span><span class="op" id="4121868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121872">Fields</span><span class="op" id="4121878">:</span>&nbsp;<span class="op" id="4121880">&amp;</span><span class="ident" id="4121881">ast</span><span class="op" id="4121884">.</span><span class="ident" id="4121885">FieldList</span><span class="op" id="4121894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121899">Opening</span><span class="op" id="4121906">:</span>&nbsp;<span class="ident" id="4121908">lbrace</span><span class="op" id="4121914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121919">List</span><span class="op" id="4121923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121928">list</span><span class="op" id="4121932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4121937">Closing</span><span class="op" id="4121944">:</span>&nbsp;<span class="ident" id="4121946">rbrace</span><span class="op" id="4121952">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121956">}</span><span class="op" id="4121957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4121960">}</span><br>
<span class="lineno"></span><span class="op" id="4121962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4121965">func</span>&nbsp;<span class="op" id="4121970">(</span><span class="ident" id="4121971">p</span>&nbsp;<span class="op" id="4121973">*</span><span class="ident" id="4121974">parser</span><span class="op" id="4121980">)</span>&nbsp;<span class="ident" id="4121982">parsePointerType</span><span class="op" id="4121998">(</span><span class="op" id="4121999">)</span>&nbsp;<span class="op" id="4122001">*</span><span class="ident" id="4122002">ast</span><span class="op" id="4122005">.</span><span class="ident" id="4122006">StarExpr</span>&nbsp;<span class="op" id="4122015">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122018">if</span>&nbsp;<span class="ident" id="4122021">p</span><span class="op" id="4122022">.</span><span class="ident" id="4122023">trace</span>&nbsp;<span class="op" id="4122029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122033">defer</span>&nbsp;<span class="ident" id="4122039">un</span><span class="op" id="4122041">(</span><span class="ident" id="4122042">trace</span><span class="op" id="4122047">(</span><span class="ident" id="4122048">p</span><span class="op" id="4122049">,</span>&nbsp;<span class="string" id="4122051">&#34;PointerType&#34;</span><span class="op" id="4122064">)</span><span class="op" id="4122065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4122068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122072">star</span>&nbsp;<span class="op" id="4122077">:=</span>&nbsp;<span class="ident" id="4122080">p</span><span class="op" id="4122081">.</span><span class="ident" id="4122082">expect</span><span class="op" id="4122088">(</span><span class="ident" id="4122089">token</span><span class="op" id="4122094">.</span><span class="ident" id="4122095">MUL</span><span class="op" id="4122098">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122101">base</span>&nbsp;<span class="op" id="4122106">:=</span>&nbsp;<span class="ident" id="4122109">p</span><span class="op" id="4122110">.</span><span class="ident" id="4122111">parseType</span><span class="op" id="4122120">(</span><span class="op" id="4122121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122125">return</span>&nbsp;<span class="op" id="4122132">&amp;</span><span class="ident" id="4122133">ast</span><span class="op" id="4122136">.</span><span class="ident" id="4122137">StarExpr</span><span class="op" id="4122145">{</span><span class="ident" id="4122146">Star</span><span class="op" id="4122150">:</span>&nbsp;<span class="ident" id="4122152">star</span><span class="op" id="4122156">,</span>&nbsp;<span class="ident" id="4122158">X</span><span class="op" id="4122159">:</span>&nbsp;<span class="ident" id="4122161">base</span><span class="op" id="4122165">}</span><br>
<span class="lineno"></span><span class="op" id="4122167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4122170">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4122225">func</span>&nbsp;<span class="op" id="4122230">(</span><span class="ident" id="4122231">p</span>&nbsp;<span class="op" id="4122233">*</span><span class="ident" id="4122234">parser</span><span class="op" id="4122240">)</span>&nbsp;<span class="ident" id="4122242">tryVarType</span><span class="op" id="4122252">(</span><span class="ident" id="4122253">isParam</span>&nbsp;<span class="builtintype" id="4122261">bool</span><span class="op" id="4122265">)</span>&nbsp;<span class="ident" id="4122267">ast</span><span class="op" id="4122270">.</span><span class="ident" id="4122271">Expr</span>&nbsp;<span class="op" id="4122276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122279">if</span>&nbsp;<span class="ident" id="4122282">isParam</span>&nbsp;<span class="op" id="4122290">&amp;&amp;</span>&nbsp;<span class="ident" id="4122293">p</span><span class="op" id="4122294">.</span><span class="ident" id="4122295">tok</span>&nbsp;<span class="op" id="4122299">==</span>&nbsp;<span class="ident" id="4122302">token</span><span class="op" id="4122307">.</span><span class="ident" id="4122308">ELLIPSIS</span>&nbsp;<span class="op" id="4122317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122321">pos</span>&nbsp;<span class="op" id="4122325">:=</span>&nbsp;<span class="ident" id="4122328">p</span><span class="op" id="4122329">.</span><span class="ident" id="4122330">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122336">p</span><span class="op" id="4122337">.</span><span class="ident" id="4122338">next</span><span class="op" id="4122342">(</span><span class="op" id="4122343">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122347">typ</span>&nbsp;<span class="op" id="4122351">:=</span>&nbsp;<span class="ident" id="4122354">p</span><span class="op" id="4122355">.</span><span class="ident" id="4122356">tryIdentOrType</span><span class="op" id="4122370">(</span><span class="op" id="4122371">)</span>&nbsp;<span class="comment" id="4122373">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122437">if</span>&nbsp;<span class="ident" id="4122440">typ</span>&nbsp;<span class="op" id="4122444">!=</span>&nbsp;<span class="ident" id="4122447">nil</span>&nbsp;<span class="op" id="4122451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122456">p</span><span class="op" id="4122457">.</span><span class="ident" id="4122458">resolve</span><span class="op" id="4122465">(</span><span class="ident" id="4122466">typ</span><span class="op" id="4122469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4122473">}</span>&nbsp;<span class="keyword" id="4122475">else</span>&nbsp;<span class="op" id="4122480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122485">p</span><span class="op" id="4122486">.</span><span class="builtintype" id="4122487">error</span><span class="op" id="4122492">(</span><span class="ident" id="4122493">pos</span><span class="op" id="4122496">,</span>&nbsp;<span class="string" id="4122498">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="4122531">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122536">typ</span>&nbsp;<span class="op" id="4122540">=</span>&nbsp;<span class="op" id="4122542">&amp;</span><span class="ident" id="4122543">ast</span><span class="op" id="4122546">.</span><span class="ident" id="4122547">BadExpr</span><span class="op" id="4122554">{</span><span class="ident" id="4122555">From</span><span class="op" id="4122559">:</span>&nbsp;<span class="ident" id="4122561">pos</span><span class="op" id="4122564">,</span>&nbsp;<span class="ident" id="4122566">To</span><span class="op" id="4122568">:</span>&nbsp;<span class="ident" id="4122570">p</span><span class="op" id="4122571">.</span><span class="ident" id="4122572">pos</span><span class="op" id="4122575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4122579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122583">return</span>&nbsp;<span class="op" id="4122590">&amp;</span><span class="ident" id="4122591">ast</span><span class="op" id="4122594">.</span><span class="ident" id="4122595">Ellipsis</span><span class="op" id="4122603">{</span><span class="ident" id="4122604">Ellipsis</span><span class="op" id="4122612">:</span>&nbsp;<span class="ident" id="4122614">pos</span><span class="op" id="4122617">,</span>&nbsp;<span class="ident" id="4122619">Elt</span><span class="op" id="4122622">:</span>&nbsp;<span class="ident" id="4122624">typ</span><span class="op" id="4122627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4122630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122633">return</span>&nbsp;<span class="ident" id="4122640">p</span><span class="op" id="4122641">.</span><span class="ident" id="4122642">tryIdentOrType</span><span class="op" id="4122656">(</span><span class="op" id="4122657">)</span><br>
<span class="lineno">770</span><span class="op" id="4122659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122662">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4122717">func</span>&nbsp;<span class="op" id="4122722">(</span><span class="ident" id="4122723">p</span>&nbsp;<span class="op" id="4122725">*</span><span class="ident" id="4122726">parser</span><span class="op" id="4122732">)</span>&nbsp;<span class="ident" id="4122734">parseVarType</span><span class="op" id="4122746">(</span><span class="ident" id="4122747">isParam</span>&nbsp;<span class="builtintype" id="4122755">bool</span><span class="op" id="4122759">)</span>&nbsp;<span class="ident" id="4122761">ast</span><span class="op" id="4122764">.</span><span class="ident" id="4122765">Expr</span>&nbsp;<span class="op" id="4122770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122773">typ</span>&nbsp;<span class="op" id="4122777">:=</span>&nbsp;<span class="ident" id="4122780">p</span><span class="op" id="4122781">.</span><span class="ident" id="4122782">tryVarType</span><span class="op" id="4122792">(</span><span class="ident" id="4122793">isParam</span><span class="op" id="4122800">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122803">if</span>&nbsp;<span class="ident" id="4122806">typ</span>&nbsp;<span class="op" id="4122810">==</span>&nbsp;<span class="ident" id="4122813">nil</span>&nbsp;<span class="op" id="4122817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122821">pos</span>&nbsp;<span class="op" id="4122825">:=</span>&nbsp;<span class="ident" id="4122828">p</span><span class="op" id="4122829">.</span><span class="ident" id="4122830">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122836">p</span><span class="op" id="4122837">.</span><span class="ident" id="4122838">errorExpected</span><span class="op" id="4122851">(</span><span class="ident" id="4122852">pos</span><span class="op" id="4122855">,</span>&nbsp;<span class="string" id="4122857">&#34;type&#34;</span><span class="op" id="4122863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122867">p</span><span class="op" id="4122868">.</span><span class="ident" id="4122869">next</span><span class="op" id="4122873">(</span><span class="op" id="4122874">)</span>&nbsp;<span class="comment" id="4122876">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4122895">typ</span>&nbsp;<span class="op" id="4122899">=</span>&nbsp;<span class="op" id="4122901">&amp;</span><span class="ident" id="4122902">ast</span><span class="op" id="4122905">.</span><span class="ident" id="4122906">BadExpr</span><span class="op" id="4122913">{</span><span class="ident" id="4122914">From</span><span class="op" id="4122918">:</span>&nbsp;<span class="ident" id="4122920">pos</span><span class="op" id="4122923">,</span>&nbsp;<span class="ident" id="4122925">To</span><span class="op" id="4122927">:</span>&nbsp;<span class="ident" id="4122929">p</span><span class="op" id="4122930">.</span><span class="ident" id="4122931">pos</span><span class="op" id="4122934">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4122937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4122940">return</span>&nbsp;<span class="ident" id="4122947">typ</span><br>
<span class="lineno"></span><span class="op" id="4122951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4122954">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="4123019">func</span>&nbsp;<span class="op" id="4123024">(</span><span class="ident" id="4123025">p</span>&nbsp;<span class="op" id="4123027">*</span><span class="ident" id="4123028">parser</span><span class="op" id="4123034">)</span>&nbsp;<span class="ident" id="4123036">parseVarList</span><span class="op" id="4123048">(</span><span class="ident" id="4123049">isParam</span>&nbsp;<span class="builtintype" id="4123057">bool</span><span class="op" id="4123061">)</span>&nbsp;<span class="op" id="4123063">(</span><span class="ident" id="4123064">list</span>&nbsp;<span class="op" id="4123069">[</span><span class="op" id="4123070">]</span><span class="ident" id="4123071">ast</span><span class="op" id="4123074">.</span><span class="ident" id="4123075">Expr</span><span class="op" id="4123079">,</span>&nbsp;<span class="ident" id="4123081">typ</span>&nbsp;<span class="ident" id="4123085">ast</span><span class="op" id="4123088">.</span><span class="ident" id="4123089">Expr</span><span class="op" id="4123093">)</span>&nbsp;<span class="op" id="4123095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123098">if</span>&nbsp;<span class="ident" id="4123101">p</span><span class="op" id="4123102">.</span><span class="ident" id="4123103">trace</span>&nbsp;<span class="op" id="4123109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123113">defer</span>&nbsp;<span class="ident" id="4123119">un</span><span class="op" id="4123121">(</span><span class="ident" id="4123122">trace</span><span class="op" id="4123127">(</span><span class="ident" id="4123128">p</span><span class="op" id="4123129">,</span>&nbsp;<span class="string" id="4123131">&#34;VarList&#34;</span><span class="op" id="4123140">)</span><span class="op" id="4123141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4123144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123148">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123206">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123210">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123273">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123336">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123399">for</span>&nbsp;<span class="ident" id="4123403">typ</span>&nbsp;<span class="op" id="4123407">:=</span>&nbsp;<span class="ident" id="4123410">p</span><span class="op" id="4123411">.</span><span class="ident" id="4123412">parseVarType</span><span class="op" id="4123424">(</span><span class="ident" id="4123425">isParam</span><span class="op" id="4123432">)</span><span class="op" id="4123433">;</span>&nbsp;<span class="ident" id="4123435">typ</span>&nbsp;<span class="op" id="4123439">!=</span>&nbsp;<span class="ident" id="4123442">nil</span><span class="op" id="4123445">;</span>&nbsp;<span class="op" id="4123447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123451">list</span>&nbsp;<span class="op" id="4123456">=</span>&nbsp;<span class="builtinfunc" id="4123458">append</span><span class="op" id="4123464">(</span><span class="ident" id="4123465">list</span><span class="op" id="4123469">,</span>&nbsp;<span class="ident" id="4123471">typ</span><span class="op" id="4123474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123478">if</span>&nbsp;<span class="ident" id="4123481">p</span><span class="op" id="4123482">.</span><span class="ident" id="4123483">tok</span>&nbsp;<span class="op" id="4123487">!=</span>&nbsp;<span class="ident" id="4123490">token</span><span class="op" id="4123495">.</span><span class="ident" id="4123496">COMMA</span>&nbsp;<span class="op" id="4123502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123507">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4123515">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123519">p</span><span class="op" id="4123520">.</span><span class="ident" id="4123521">next</span><span class="op" id="4123525">(</span><span class="op" id="4123526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123530">typ</span>&nbsp;<span class="op" id="4123534">=</span>&nbsp;<span class="ident" id="4123536">p</span><span class="op" id="4123537">.</span><span class="ident" id="4123538">tryVarType</span><span class="op" id="4123548">(</span><span class="ident" id="4123549">isParam</span><span class="op" id="4123556">)</span>&nbsp;<span class="comment" id="4123558">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4123595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123599">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123666">typ</span>&nbsp;<span class="op" id="4123670">=</span>&nbsp;<span class="ident" id="4123672">p</span><span class="op" id="4123673">.</span><span class="ident" id="4123674">tryVarType</span><span class="op" id="4123684">(</span><span class="ident" id="4123685">isParam</span><span class="op" id="4123692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123696">return</span><br>
<span class="lineno"></span><span class="op" id="4123703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4123706">func</span>&nbsp;<span class="op" id="4123711">(</span><span class="ident" id="4123712">p</span>&nbsp;<span class="op" id="4123714">*</span><span class="ident" id="4123715">parser</span><span class="op" id="4123721">)</span>&nbsp;<span class="ident" id="4123723">parseParameterList</span><span class="op" id="4123741">(</span><span class="ident" id="4123742">scope</span>&nbsp;<span class="op" id="4123748">*</span><span class="ident" id="4123749">ast</span><span class="op" id="4123752">.</span><span class="ident" id="4123753">Scope</span><span class="op" id="4123758">,</span>&nbsp;<span class="ident" id="4123760">ellipsisOk</span>&nbsp;<span class="builtintype" id="4123771">bool</span><span class="op" id="4123775">)</span>&nbsp;<span class="op" id="4123777">(</span><span class="ident" id="4123778">params</span>&nbsp;<span class="op" id="4123785">[</span><span class="op" id="4123786">]</span><span class="op" id="4123787">*</span><span class="ident" id="4123788">ast</span><span class="op" id="4123791">.</span><span class="ident" id="4123792">Field</span><span class="op" id="4123797">)</span>&nbsp;<span class="op" id="4123799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123802">if</span>&nbsp;<span class="ident" id="4123805">p</span><span class="op" id="4123806">.</span><span class="ident" id="4123807">trace</span>&nbsp;<span class="op" id="4123813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123817">defer</span>&nbsp;<span class="ident" id="4123823">un</span><span class="op" id="4123825">(</span><span class="ident" id="4123826">trace</span><span class="op" id="4123831">(</span><span class="ident" id="4123832">p</span><span class="op" id="4123833">,</span>&nbsp;<span class="string" id="4123835">&#34;ParameterList&#34;</span><span class="op" id="4123850">)</span><span class="op" id="4123851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4123854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123858">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123876">list</span><span class="op" id="4123880">,</span>&nbsp;<span class="ident" id="4123882">typ</span>&nbsp;<span class="op" id="4123886">:=</span>&nbsp;<span class="ident" id="4123889">p</span><span class="op" id="4123890">.</span><span class="ident" id="4123891">parseVarList</span><span class="op" id="4123903">(</span><span class="ident" id="4123904">ellipsisOk</span><span class="op" id="4123914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123918">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4123935">if</span>&nbsp;<span class="ident" id="4123938">typ</span>&nbsp;<span class="op" id="4123942">!=</span>&nbsp;<span class="ident" id="4123945">nil</span>&nbsp;<span class="op" id="4123949">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4123953">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4123978">idents</span>&nbsp;<span class="op" id="4123985">:=</span>&nbsp;<span class="ident" id="4123988">p</span><span class="op" id="4123989">.</span><span class="ident" id="4123990">makeIdentList</span><span class="op" id="4124003">(</span><span class="ident" id="4124004">list</span><span class="op" id="4124008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124012">field</span>&nbsp;<span class="op" id="4124018">:=</span>&nbsp;<span class="op" id="4124021">&amp;</span><span class="ident" id="4124022">ast</span><span class="op" id="4124025">.</span><span class="ident" id="4124026">Field</span><span class="op" id="4124031">{</span><span class="ident" id="4124032">Names</span><span class="op" id="4124037">:</span>&nbsp;<span class="ident" id="4124039">idents</span><span class="op" id="4124045">,</span>&nbsp;<span class="ident" id="4124047">Type</span><span class="op" id="4124051">:</span>&nbsp;<span class="ident" id="4124053">typ</span><span class="op" id="4124056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124060">params</span>&nbsp;<span class="op" id="4124067">=</span>&nbsp;<span class="builtinfunc" id="4124069">append</span><span class="op" id="4124075">(</span><span class="ident" id="4124076">params</span><span class="op" id="4124082">,</span>&nbsp;<span class="ident" id="4124084">field</span><span class="op" id="4124089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4124093">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4124154">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124210">p</span><span class="op" id="4124211">.</span><span class="ident" id="4124212">declare</span><span class="op" id="4124219">(</span><span class="ident" id="4124220">field</span><span class="op" id="4124225">,</span>&nbsp;<span class="ident" id="4124227">nil</span><span class="op" id="4124230">,</span>&nbsp;<span class="ident" id="4124232">scope</span><span class="op" id="4124237">,</span>&nbsp;<span class="ident" id="4124239">ast</span><span class="op" id="4124242">.</span><span class="ident" id="4124243">Var</span><span class="op" id="4124246">,</span>&nbsp;<span class="ident" id="4124248">idents</span><span class="op" id="4124254">...</span><span class="op" id="4124257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124261">p</span><span class="op" id="4124262">.</span><span class="ident" id="4124263">resolve</span><span class="op" id="4124270">(</span><span class="ident" id="4124271">typ</span><span class="op" id="4124274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124278">if</span>&nbsp;<span class="op" id="4124281">!</span><span class="ident" id="4124282">p</span><span class="op" id="4124283">.</span><span class="ident" id="4124284">atComma</span><span class="op" id="4124291">(</span><span class="string" id="4124292">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4124308">)</span>&nbsp;<span class="op" id="4124310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124315">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4124324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124328">p</span><span class="op" id="4124329">.</span><span class="ident" id="4124330">next</span><span class="op" id="4124334">(</span><span class="op" id="4124335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124339">for</span>&nbsp;<span class="ident" id="4124343">p</span><span class="op" id="4124344">.</span><span class="ident" id="4124345">tok</span>&nbsp;<span class="op" id="4124349">!=</span>&nbsp;<span class="ident" id="4124352">token</span><span class="op" id="4124357">.</span><span class="ident" id="4124358">RPAREN</span>&nbsp;<span class="op" id="4124365">&amp;&amp;</span>&nbsp;<span class="ident" id="4124368">p</span><span class="op" id="4124369">.</span><span class="ident" id="4124370">tok</span>&nbsp;<span class="op" id="4124374">!=</span>&nbsp;<span class="ident" id="4124377">token</span><span class="op" id="4124382">.</span><span class="ident" id="4124383">EOF</span>&nbsp;<span class="op" id="4124387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124392">idents</span>&nbsp;<span class="op" id="4124399">:=</span>&nbsp;<span class="ident" id="4124402">p</span><span class="op" id="4124403">.</span><span class="ident" id="4124404">parseIdentList</span><span class="op" id="4124418">(</span><span class="op" id="4124419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124424">typ</span>&nbsp;<span class="op" id="4124428">:=</span>&nbsp;<span class="ident" id="4124431">p</span><span class="op" id="4124432">.</span><span class="ident" id="4124433">parseVarType</span><span class="op" id="4124445">(</span><span class="ident" id="4124446">ellipsisOk</span><span class="op" id="4124456">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124461">field</span>&nbsp;<span class="op" id="4124467">:=</span>&nbsp;<span class="op" id="4124470">&amp;</span><span class="ident" id="4124471">ast</span><span class="op" id="4124474">.</span><span class="ident" id="4124475">Field</span><span class="op" id="4124480">{</span><span class="ident" id="4124481">Names</span><span class="op" id="4124486">:</span>&nbsp;<span class="ident" id="4124488">idents</span><span class="op" id="4124494">,</span>&nbsp;<span class="ident" id="4124496">Type</span><span class="op" id="4124500">:</span>&nbsp;<span class="ident" id="4124502">typ</span><span class="op" id="4124505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124510">params</span>&nbsp;<span class="op" id="4124517">=</span>&nbsp;<span class="builtinfunc" id="4124519">append</span><span class="op" id="4124525">(</span><span class="ident" id="4124526">params</span><span class="op" id="4124532">,</span>&nbsp;<span class="ident" id="4124534">field</span><span class="op" id="4124539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4124544">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4124606">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124663">p</span><span class="op" id="4124664">.</span><span class="ident" id="4124665">declare</span><span class="op" id="4124672">(</span><span class="ident" id="4124673">field</span><span class="op" id="4124678">,</span>&nbsp;<span class="ident" id="4124680">nil</span><span class="op" id="4124683">,</span>&nbsp;<span class="ident" id="4124685">scope</span><span class="op" id="4124690">,</span>&nbsp;<span class="ident" id="4124692">ast</span><span class="op" id="4124695">.</span><span class="ident" id="4124696">Var</span><span class="op" id="4124699">,</span>&nbsp;<span class="ident" id="4124701">idents</span><span class="op" id="4124707">...</span><span class="op" id="4124710">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124715">p</span><span class="op" id="4124716">.</span><span class="ident" id="4124717">resolve</span><span class="op" id="4124724">(</span><span class="ident" id="4124725">typ</span><span class="op" id="4124728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124733">if</span>&nbsp;<span class="op" id="4124736">!</span><span class="ident" id="4124737">p</span><span class="op" id="4124738">.</span><span class="ident" id="4124739">atComma</span><span class="op" id="4124746">(</span><span class="string" id="4124747">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4124763">)</span>&nbsp;<span class="op" id="4124765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124771">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4124780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124785">p</span><span class="op" id="4124786">.</span><span class="ident" id="4124787">next</span><span class="op" id="4124791">(</span><span class="op" id="4124792">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4124796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124800">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4124808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4124812">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124857">params</span>&nbsp;<span class="op" id="4124864">=</span>&nbsp;<span class="builtinfunc" id="4124866">make</span><span class="op" id="4124870">(</span><span class="op" id="4124871">[</span><span class="op" id="4124872">]</span><span class="op" id="4124873">*</span><span class="ident" id="4124874">ast</span><span class="op" id="4124877">.</span><span class="ident" id="4124878">Field</span><span class="op" id="4124883">,</span>&nbsp;<span class="builtinfunc" id="4124885">len</span><span class="op" id="4124888">(</span><span class="ident" id="4124889">list</span><span class="op" id="4124893">)</span><span class="op" id="4124894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124897">for</span>&nbsp;<span class="ident" id="4124901">i</span><span class="op" id="4124902">,</span>&nbsp;<span class="ident" id="4124904">typ</span>&nbsp;<span class="op" id="4124908">:=</span>&nbsp;<span class="keyword" id="4124911">range</span>&nbsp;<span class="ident" id="4124917">list</span>&nbsp;<span class="op" id="4124922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124926">p</span><span class="op" id="4124927">.</span><span class="ident" id="4124928">resolve</span><span class="op" id="4124935">(</span><span class="ident" id="4124936">typ</span><span class="op" id="4124939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4124943">params</span><span class="op" id="4124949">[</span><span class="ident" id="4124950">i</span><span class="op" id="4124951">]</span>&nbsp;<span class="op" id="4124953">=</span>&nbsp;<span class="op" id="4124955">&amp;</span><span class="ident" id="4124956">ast</span><span class="op" id="4124959">.</span><span class="ident" id="4124960">Field</span><span class="op" id="4124965">{</span><span class="ident" id="4124966">Type</span><span class="op" id="4124970">:</span>&nbsp;<span class="ident" id="4124972">typ</span><span class="op" id="4124975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4124978">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4124981">return</span><br>
<span class="lineno"></span><span class="op" id="4124988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4124991">func</span>&nbsp;<span class="op" id="4124996">(</span><span class="ident" id="4124997">p</span>&nbsp;<span class="op" id="4124999">*</span><span class="ident" id="4125000">parser</span><span class="op" id="4125006">)</span>&nbsp;<span class="ident" id="4125008">parseParameters</span><span class="op" id="4125023">(</span><span class="ident" id="4125024">scope</span>&nbsp;<span class="op" id="4125030">*</span><span class="ident" id="4125031">ast</span><span class="op" id="4125034">.</span><span class="ident" id="4125035">Scope</span><span class="op" id="4125040">,</span>&nbsp;<span class="ident" id="4125042">ellipsisOk</span>&nbsp;<span class="builtintype" id="4125053">bool</span><span class="op" id="4125057">)</span>&nbsp;<span class="op" id="4125059">*</span><span class="ident" id="4125060">ast</span><span class="op" id="4125063">.</span><span class="ident" id="4125064">FieldList</span>&nbsp;<span class="op" id="4125074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125077">if</span>&nbsp;<span class="ident" id="4125080">p</span><span class="op" id="4125081">.</span><span class="ident" id="4125082">trace</span>&nbsp;<span class="op" id="4125088">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125092">defer</span>&nbsp;<span class="ident" id="4125098">un</span><span class="op" id="4125100">(</span><span class="ident" id="4125101">trace</span><span class="op" id="4125106">(</span><span class="ident" id="4125107">p</span><span class="op" id="4125108">,</span>&nbsp;<span class="string" id="4125110">&#34;Parameters&#34;</span><span class="op" id="4125122">)</span><span class="op" id="4125123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125130">var</span>&nbsp;<span class="ident" id="4125134">params</span>&nbsp;<span class="op" id="4125141">[</span><span class="op" id="4125142">]</span><span class="op" id="4125143">*</span><span class="ident" id="4125144">ast</span><span class="op" id="4125147">.</span><span class="ident" id="4125148">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125155">lparen</span>&nbsp;<span class="op" id="4125162">:=</span>&nbsp;<span class="ident" id="4125165">p</span><span class="op" id="4125166">.</span><span class="ident" id="4125167">expect</span><span class="op" id="4125173">(</span><span class="ident" id="4125174">token</span><span class="op" id="4125179">.</span><span class="ident" id="4125180">LPAREN</span><span class="op" id="4125186">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125189">if</span>&nbsp;<span class="ident" id="4125192">p</span><span class="op" id="4125193">.</span><span class="ident" id="4125194">tok</span>&nbsp;<span class="op" id="4125198">!=</span>&nbsp;<span class="ident" id="4125201">token</span><span class="op" id="4125206">.</span><span class="ident" id="4125207">RPAREN</span>&nbsp;<span class="op" id="4125214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125218">params</span>&nbsp;<span class="op" id="4125225">=</span>&nbsp;<span class="ident" id="4125227">p</span><span class="op" id="4125228">.</span><span class="ident" id="4125229">parseParameterList</span><span class="op" id="4125247">(</span><span class="ident" id="4125248">scope</span><span class="op" id="4125253">,</span>&nbsp;<span class="ident" id="4125255">ellipsisOk</span><span class="op" id="4125265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125271">rparen</span>&nbsp;<span class="op" id="4125278">:=</span>&nbsp;<span class="ident" id="4125281">p</span><span class="op" id="4125282">.</span><span class="ident" id="4125283">expect</span><span class="op" id="4125289">(</span><span class="ident" id="4125290">token</span><span class="op" id="4125295">.</span><span class="ident" id="4125296">RPAREN</span><span class="op" id="4125302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125306">return</span>&nbsp;<span class="op" id="4125313">&amp;</span><span class="ident" id="4125314">ast</span><span class="op" id="4125317">.</span><span class="ident" id="4125318">FieldList</span><span class="op" id="4125327">{</span><span class="ident" id="4125328">Opening</span><span class="op" id="4125335">:</span>&nbsp;<span class="ident" id="4125337">lparen</span><span class="op" id="4125343">,</span>&nbsp;<span class="ident" id="4125345">List</span><span class="op" id="4125349">:</span>&nbsp;<span class="ident" id="4125351">params</span><span class="op" id="4125357">,</span>&nbsp;<span class="ident" id="4125359">Closing</span><span class="op" id="4125366">:</span>&nbsp;<span class="ident" id="4125368">rparen</span><span class="op" id="4125374">}</span><br>
<span class="lineno"></span><span class="op" id="4125376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4125379">func</span>&nbsp;<span class="op" id="4125384">(</span><span class="ident" id="4125385">p</span>&nbsp;<span class="op" id="4125387">*</span><span class="ident" id="4125388">parser</span><span class="op" id="4125394">)</span>&nbsp;<span class="ident" id="4125396">parseResult</span><span class="op" id="4125407">(</span><span class="ident" id="4125408">scope</span>&nbsp;<span class="op" id="4125414">*</span><span class="ident" id="4125415">ast</span><span class="op" id="4125418">.</span><span class="ident" id="4125419">Scope</span><span class="op" id="4125424">)</span>&nbsp;<span class="op" id="4125426">*</span><span class="ident" id="4125427">ast</span><span class="op" id="4125430">.</span><span class="ident" id="4125431">FieldList</span>&nbsp;<span class="op" id="4125441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125444">if</span>&nbsp;<span class="ident" id="4125447">p</span><span class="op" id="4125448">.</span><span class="ident" id="4125449">trace</span>&nbsp;<span class="op" id="4125455">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125459">defer</span>&nbsp;<span class="ident" id="4125465">un</span><span class="op" id="4125467">(</span><span class="ident" id="4125468">trace</span><span class="op" id="4125473">(</span><span class="ident" id="4125474">p</span><span class="op" id="4125475">,</span>&nbsp;<span class="string" id="4125477">&#34;Result&#34;</span><span class="op" id="4125485">)</span><span class="op" id="4125486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125493">if</span>&nbsp;<span class="ident" id="4125496">p</span><span class="op" id="4125497">.</span><span class="ident" id="4125498">tok</span>&nbsp;<span class="op" id="4125502">==</span>&nbsp;<span class="ident" id="4125505">token</span><span class="op" id="4125510">.</span><span class="ident" id="4125511">LPAREN</span>&nbsp;<span class="op" id="4125518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125522">return</span>&nbsp;<span class="ident" id="4125529">p</span><span class="op" id="4125530">.</span><span class="ident" id="4125531">parseParameters</span><span class="op" id="4125546">(</span><span class="ident" id="4125547">scope</span><span class="op" id="4125552">,</span>&nbsp;<span class="builtintype" id="4125554">false</span><span class="op" id="4125559">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125566">typ</span>&nbsp;<span class="op" id="4125570">:=</span>&nbsp;<span class="ident" id="4125573">p</span><span class="op" id="4125574">.</span><span class="ident" id="4125575">tryType</span><span class="op" id="4125582">(</span><span class="op" id="4125583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125586">if</span>&nbsp;<span class="ident" id="4125589">typ</span>&nbsp;<span class="op" id="4125593">!=</span>&nbsp;<span class="ident" id="4125596">nil</span>&nbsp;<span class="op" id="4125600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125604">list</span>&nbsp;<span class="op" id="4125609">:=</span>&nbsp;<span class="builtinfunc" id="4125612">make</span><span class="op" id="4125616">(</span><span class="op" id="4125617">[</span><span class="op" id="4125618">]</span><span class="op" id="4125619">*</span><span class="ident" id="4125620">ast</span><span class="op" id="4125623">.</span><span class="ident" id="4125624">Field</span><span class="op" id="4125629">,</span>&nbsp;<span class="num" id="4125631">1</span><span class="op" id="4125632">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125636">list</span><span class="op" id="4125640">[</span><span class="num" id="4125641">0</span><span class="op" id="4125642">]</span>&nbsp;<span class="op" id="4125644">=</span>&nbsp;<span class="op" id="4125646">&amp;</span><span class="ident" id="4125647">ast</span><span class="op" id="4125650">.</span><span class="ident" id="4125651">Field</span><span class="op" id="4125656">{</span><span class="ident" id="4125657">Type</span><span class="op" id="4125661">:</span>&nbsp;<span class="ident" id="4125663">typ</span><span class="op" id="4125666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125670">return</span>&nbsp;<span class="op" id="4125677">&amp;</span><span class="ident" id="4125678">ast</span><span class="op" id="4125681">.</span><span class="ident" id="4125682">FieldList</span><span class="op" id="4125691">{</span><span class="ident" id="4125692">List</span><span class="op" id="4125696">:</span>&nbsp;<span class="ident" id="4125698">list</span><span class="op" id="4125702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125709">return</span>&nbsp;<span class="ident" id="4125716">nil</span><br>
<span class="lineno">890</span><span class="op" id="4125720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4125723">func</span>&nbsp;<span class="op" id="4125728">(</span><span class="ident" id="4125729">p</span>&nbsp;<span class="op" id="4125731">*</span><span class="ident" id="4125732">parser</span><span class="op" id="4125738">)</span>&nbsp;<span class="ident" id="4125740">parseSignature</span><span class="op" id="4125754">(</span><span class="ident" id="4125755">scope</span>&nbsp;<span class="op" id="4125761">*</span><span class="ident" id="4125762">ast</span><span class="op" id="4125765">.</span><span class="ident" id="4125766">Scope</span><span class="op" id="4125771">)</span>&nbsp;<span class="op" id="4125773">(</span><span class="ident" id="4125774">params</span><span class="op" id="4125780">,</span>&nbsp;<span class="ident" id="4125782">results</span>&nbsp;<span class="op" id="4125790">*</span><span class="ident" id="4125791">ast</span><span class="op" id="4125794">.</span><span class="ident" id="4125795">FieldList</span><span class="op" id="4125804">)</span>&nbsp;<span class="op" id="4125806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125809">if</span>&nbsp;<span class="ident" id="4125812">p</span><span class="op" id="4125813">.</span><span class="ident" id="4125814">trace</span>&nbsp;<span class="op" id="4125820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125824">defer</span>&nbsp;<span class="ident" id="4125830">un</span><span class="op" id="4125832">(</span><span class="ident" id="4125833">trace</span><span class="op" id="4125838">(</span><span class="ident" id="4125839">p</span><span class="op" id="4125840">,</span>&nbsp;<span class="string" id="4125842">&#34;Signature&#34;</span><span class="op" id="4125853">)</span><span class="op" id="4125854">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4125857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125861">params</span>&nbsp;<span class="op" id="4125868">=</span>&nbsp;<span class="ident" id="4125870">p</span><span class="op" id="4125871">.</span><span class="ident" id="4125872">parseParameters</span><span class="op" id="4125887">(</span><span class="ident" id="4125888">scope</span><span class="op" id="4125893">,</span>&nbsp;<span class="builtintype" id="4125895">true</span><span class="op" id="4125899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4125902">results</span>&nbsp;<span class="op" id="4125910">=</span>&nbsp;<span class="ident" id="4125912">p</span><span class="op" id="4125913">.</span><span class="ident" id="4125914">parseResult</span><span class="op" id="4125925">(</span><span class="ident" id="4125926">scope</span><span class="op" id="4125931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4125935">return</span><br>
<span class="lineno"></span><span class="op" id="4125942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4125945">func</span>&nbsp;<span class="op" id="4125950">(</span><span class="ident" id="4125951">p</span>&nbsp;<span class="op" id="4125953">*</span><span class="ident" id="4125954">parser</span><span class="op" id="4125960">)</span>&nbsp;<span class="ident" id="4125962">parseFuncType</span><span class="op" id="4125975">(</span><span class="op" id="4125976">)</span>&nbsp;<span class="op" id="4125978">(</span><span class="op" id="4125979">*</span><span class="ident" id="4125980">ast</span><span class="op" id="4125983">.</span><span class="ident" id="4125984">FuncType</span><span class="op" id="4125992">,</span>&nbsp;<span class="op" id="4125994">*</span><span class="ident" id="4125995">ast</span><span class="op" id="4125998">.</span><span class="ident" id="4125999">Scope</span><span class="op" id="4126004">)</span>&nbsp;<span class="op" id="4126006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126009">if</span>&nbsp;<span class="ident" id="4126012">p</span><span class="op" id="4126013">.</span><span class="ident" id="4126014">trace</span>&nbsp;<span class="op" id="4126020">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126024">defer</span>&nbsp;<span class="ident" id="4126030">un</span><span class="op" id="4126032">(</span><span class="ident" id="4126033">trace</span><span class="op" id="4126038">(</span><span class="ident" id="4126039">p</span><span class="op" id="4126040">,</span>&nbsp;<span class="string" id="4126042">&#34;FuncType&#34;</span><span class="op" id="4126052">)</span><span class="op" id="4126053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4126056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126060">pos</span>&nbsp;<span class="op" id="4126064">:=</span>&nbsp;<span class="ident" id="4126067">p</span><span class="op" id="4126068">.</span><span class="ident" id="4126069">expect</span><span class="op" id="4126075">(</span><span class="ident" id="4126076">token</span><span class="op" id="4126081">.</span><span class="ident" id="4126082">FUNC</span><span class="op" id="4126086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126089">scope</span>&nbsp;<span class="op" id="4126095">:=</span>&nbsp;<span class="ident" id="4126098">ast</span><span class="op" id="4126101">.</span><span class="ident" id="4126102">NewScope</span><span class="op" id="4126110">(</span><span class="ident" id="4126111">p</span><span class="op" id="4126112">.</span><span class="ident" id="4126113">topScope</span><span class="op" id="4126121">)</span>&nbsp;<span class="comment" id="4126123">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126142">params</span><span class="op" id="4126148">,</span>&nbsp;<span class="ident" id="4126150">results</span>&nbsp;<span class="op" id="4126158">:=</span>&nbsp;<span class="ident" id="4126161">p</span><span class="op" id="4126162">.</span><span class="ident" id="4126163">parseSignature</span><span class="op" id="4126177">(</span><span class="ident" id="4126178">scope</span><span class="op" id="4126183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126187">return</span>&nbsp;<span class="op" id="4126194">&amp;</span><span class="ident" id="4126195">ast</span><span class="op" id="4126198">.</span><span class="ident" id="4126199">FuncType</span><span class="op" id="4126207">{</span><span class="ident" id="4126208">Func</span><span class="op" id="4126212">:</span>&nbsp;<span class="ident" id="4126214">pos</span><span class="op" id="4126217">,</span>&nbsp;<span class="ident" id="4126219">Params</span><span class="op" id="4126225">:</span>&nbsp;<span class="ident" id="4126227">params</span><span class="op" id="4126233">,</span>&nbsp;<span class="ident" id="4126235">Results</span><span class="op" id="4126242">:</span>&nbsp;<span class="ident" id="4126244">results</span><span class="op" id="4126251">}</span><span class="op" id="4126252">,</span>&nbsp;<span class="ident" id="4126254">scope</span><br>
<span class="lineno"></span><span class="op" id="4126260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="4126263">func</span>&nbsp;<span class="op" id="4126268">(</span><span class="ident" id="4126269">p</span>&nbsp;<span class="op" id="4126271">*</span><span class="ident" id="4126272">parser</span><span class="op" id="4126278">)</span>&nbsp;<span class="ident" id="4126280">parseMethodSpec</span><span class="op" id="4126295">(</span><span class="ident" id="4126296">scope</span>&nbsp;<span class="op" id="4126302">*</span><span class="ident" id="4126303">ast</span><span class="op" id="4126306">.</span><span class="ident" id="4126307">Scope</span><span class="op" id="4126312">)</span>&nbsp;<span class="op" id="4126314">*</span><span class="ident" id="4126315">ast</span><span class="op" id="4126318">.</span><span class="ident" id="4126319">Field</span>&nbsp;<span class="op" id="4126325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126328">if</span>&nbsp;<span class="ident" id="4126331">p</span><span class="op" id="4126332">.</span><span class="ident" id="4126333">trace</span>&nbsp;<span class="op" id="4126339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126343">defer</span>&nbsp;<span class="ident" id="4126349">un</span><span class="op" id="4126351">(</span><span class="ident" id="4126352">trace</span><span class="op" id="4126357">(</span><span class="ident" id="4126358">p</span><span class="op" id="4126359">,</span>&nbsp;<span class="string" id="4126361">&#34;MethodSpec&#34;</span><span class="op" id="4126373">)</span><span class="op" id="4126374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4126377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126381">doc</span>&nbsp;<span class="op" id="4126385">:=</span>&nbsp;<span class="ident" id="4126388">p</span><span class="op" id="4126389">.</span><span class="ident" id="4126390">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126403">var</span>&nbsp;<span class="ident" id="4126407">idents</span>&nbsp;<span class="op" id="4126414">[</span><span class="op" id="4126415">]</span><span class="op" id="4126416">*</span><span class="ident" id="4126417">ast</span><span class="op" id="4126420">.</span><span class="ident" id="4126421">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126428">var</span>&nbsp;<span class="ident" id="4126432">typ</span>&nbsp;<span class="ident" id="4126436">ast</span><span class="op" id="4126439">.</span><span class="ident" id="4126440">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126446">x</span>&nbsp;<span class="op" id="4126448">:=</span>&nbsp;<span class="ident" id="4126451">p</span><span class="op" id="4126452">.</span><span class="ident" id="4126453">parseTypeName</span><span class="op" id="4126466">(</span><span class="op" id="4126467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4126470">if</span>&nbsp;<span class="ident" id="4126473">ident</span><span class="op" id="4126478">,</span>&nbsp;<span class="ident" id="4126480">isIdent</span>&nbsp;<span class="op" id="4126488">:=</span>&nbsp;<span class="ident" id="4126491">x</span><span class="op" id="4126492">.</span><span class="op" id="4126493">(</span><span class="op" id="4126494">*</span><span class="ident" id="4126495">ast</span><span class="op" id="4126498">.</span><span class="ident" id="4126499">Ident</span><span class="op" id="4126504">)</span><span class="op" id="4126505">;</span>&nbsp;<span class="ident" id="4126507">isIdent</span>&nbsp;<span class="op" id="4126515">&amp;&amp;</span>&nbsp;<span class="ident" id="4126518">p</span><span class="op" id="4126519">.</span><span class="ident" id="4126520">tok</span>&nbsp;<span class="op" id="4126524">==</span>&nbsp;<span class="ident" id="4126527">token</span><span class="op" id="4126532">.</span><span class="ident" id="4126533">LPAREN</span>&nbsp;<span class="op" id="4126540">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4126544">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126556">idents</span>&nbsp;<span class="op" id="4126563">=</span>&nbsp;<span class="op" id="4126565">[</span><span class="op" id="4126566">]</span><span class="op" id="4126567">*</span><span class="ident" id="4126568">ast</span><span class="op" id="4126571">.</span><span class="ident" id="4126572">Ident</span><span class="op" id="4126577">{</span><span class="ident" id="4126578">ident</span><span class="op" id="4126583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126587">scope</span>&nbsp;<span class="op" id="4126593">:=</span>&nbsp;<span class="ident" id="4126596">ast</span><span class="op" id="4126599">.</span><span class="ident" id="4126600">NewScope</span><span class="op" id="4126608">(</span><span class="ident" id="4126609">nil</span><span class="op" id="4126612">)</span>&nbsp;<span class="comment" id="4126614">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126632">params</span><span class="op" id="4126638">,</span>&nbsp;<span class="ident" id="4126640">results</span>&nbsp;<span class="op" id="4126648">:=</span>&nbsp;<span class="ident" id="4126651">p</span><span class="op" id="4126652">.</span><span class="ident" id="4126653">parseSignature</span><span class="op" id="4126667">(</span><span class="ident" id="4126668">scope</span><span class="op" id="4126673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126677">typ</span>&nbsp;<span class="op" id="4126681">=</span>&nbsp;<span class="op" id="4126683">&amp;</span><span class="ident" id="4126684">ast</span><span class="op" id="4126687">.</span><span class="ident" id="4126688">FuncType</span><span class="op" id="4126696">{</span><span class="ident" id="4126697">Func</span><span class="op" id="4126701">:</span>&nbsp;<span class="ident" id="4126703">token</span><span class="op" id="4126708">.</span><span class="ident" id="4126709">NoPos</span><span class="op" id="4126714">,</span>&nbsp;<span class="ident" id="4126716">Params</span><span class="op" id="4126722">:</span>&nbsp;<span class="ident" id="4126724">params</span><span class="op" id="4126730">,</span>&nbsp;<span class="ident" id="4126732">Results</span><span class="op" id="4126739">:</span>&nbsp;<span class="ident" id="4126741">results</span><span class="op" id="4126748">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4126751">}</span>&nbsp;<span class="keyword" id="4126753">else</span>&nbsp;<span class="op" id="4126758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4126762">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126786">typ</span>&nbsp;<span class="op" id="4126790">=</span>&nbsp;<span class="ident" id="4126792">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126796">p</span><span class="op" id="4126797">.</span><span class="ident" id="4126798">resolve</span><span class="op" id="4126805">(</span><span class="ident" id="4126806">typ</span><span class="op" id="4126809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4126812">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126815">p</span><span class="op" id="4126816">.</span><span class="ident" id="4126817">expectSemi</span><span class="op" id="4126827">(</span><span class="op" id="4126828">)</span>&nbsp;<span class="comment" id="4126830">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126871">spec</span>&nbsp;<span class="op" id="4126876">:=</span>&nbsp;<span class="op" id="4126879">&amp;</span><span class="ident" id="4126880">ast</span><span class="op" id="4126883">.</span><span class="ident" id="4126884">Field</span><span class="op" id="4126889">{</span><span class="ident" id="4126890">Doc</span><span class="op" id="4126893">:</span>&nbsp;<span class="ident" id="4126895">doc</span><span class="op" id="4126898">,</span>&nbsp;<span class="ident" id="4126900">Names</span><span class="op" id="4126905">:</span>&nbsp;<span class="ident" id="4126907">idents</span><span class="op" id="4126913">,</span>&nbsp;<span class="ident" id="4126915">Type</span><span class="op" id="4126919">:</span>&nbsp;<span class="ident" id="4126921">typ</span><span class="op" id="4126924">,</span>&nbsp;<span class="ident" id="4126926">Comment</span><span class="op" id="4126933">:</span>&nbsp;<span class="ident" id="4126935">p</span><span class="op" id="4126936">.</span><span class="ident" id="4126937">lineComment</span><span class="op" id="4126948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4126951">p</span><span class="op" id="4126952">.</span><span class="ident" id="4126953">declare</span><span class="op" id="4126960">(</span><span class="ident" id="4126961">spec</span><span class="op" id="4126965">,</span>&nbsp;<span class="ident" id="4126967">nil</span><span class="op" id="4126970">,</span>&nbsp;<span class="ident" id="4126972">scope</span><span class="op" id="4126977">,</span>&nbsp;<span class="ident" id="4126979">ast</span><span class="op" id="4126982">.</span><span class="ident" id="4126983">Fun</span><span class="op" id="4126986">,</span>&nbsp;<span class="ident" id="4126988">idents</span><span class="op" id="4126994">...</span><span class="op" id="4126997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127001">return</span>&nbsp;<span class="ident" id="4127008">spec</span><br>
<span class="lineno"></span><span class="op" id="4127013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4127016">func</span>&nbsp;<span class="op" id="4127021">(</span><span class="ident" id="4127022">p</span>&nbsp;<span class="op" id="4127024">*</span><span class="ident" id="4127025">parser</span><span class="op" id="4127031">)</span>&nbsp;<span class="ident" id="4127033">parseInterfaceType</span><span class="op" id="4127051">(</span><span class="op" id="4127052">)</span>&nbsp;<span class="op" id="4127054">*</span><span class="ident" id="4127055">ast</span><span class="op" id="4127058">.</span><span class="ident" id="4127059">InterfaceType</span>&nbsp;<span class="op" id="4127073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127076">if</span>&nbsp;<span class="ident" id="4127079">p</span><span class="op" id="4127080">.</span><span class="ident" id="4127081">trace</span>&nbsp;<span class="op" id="4127087">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127091">defer</span>&nbsp;<span class="ident" id="4127097">un</span><span class="op" id="4127099">(</span><span class="ident" id="4127100">trace</span><span class="op" id="4127105">(</span><span class="ident" id="4127106">p</span><span class="op" id="4127107">,</span>&nbsp;<span class="string" id="4127109">&#34;InterfaceType&#34;</span><span class="op" id="4127124">)</span><span class="op" id="4127125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127132">pos</span>&nbsp;<span class="op" id="4127136">:=</span>&nbsp;<span class="ident" id="4127139">p</span><span class="op" id="4127140">.</span><span class="ident" id="4127141">expect</span><span class="op" id="4127147">(</span><span class="ident" id="4127148">token</span><span class="op" id="4127153">.</span><span class="ident" id="4127154">INTERFACE</span><span class="op" id="4127163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127166">lbrace</span>&nbsp;<span class="op" id="4127173">:=</span>&nbsp;<span class="ident" id="4127176">p</span><span class="op" id="4127177">.</span><span class="ident" id="4127178">expect</span><span class="op" id="4127184">(</span><span class="ident" id="4127185">token</span><span class="op" id="4127190">.</span><span class="ident" id="4127191">LBRACE</span><span class="op" id="4127197">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127200">scope</span>&nbsp;<span class="op" id="4127206">:=</span>&nbsp;<span class="ident" id="4127209">ast</span><span class="op" id="4127212">.</span><span class="ident" id="4127213">NewScope</span><span class="op" id="4127221">(</span><span class="ident" id="4127222">nil</span><span class="op" id="4127225">)</span>&nbsp;<span class="comment" id="4127227">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127247">var</span>&nbsp;<span class="ident" id="4127251">list</span>&nbsp;<span class="op" id="4127256">[</span><span class="op" id="4127257">]</span><span class="op" id="4127258">*</span><span class="ident" id="4127259">ast</span><span class="op" id="4127262">.</span><span class="ident" id="4127263">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127270">for</span>&nbsp;<span class="ident" id="4127274">p</span><span class="op" id="4127275">.</span><span class="ident" id="4127276">tok</span>&nbsp;<span class="op" id="4127280">==</span>&nbsp;<span class="ident" id="4127283">token</span><span class="op" id="4127288">.</span><span class="ident" id="4127289">IDENT</span>&nbsp;<span class="op" id="4127295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127299">list</span>&nbsp;<span class="op" id="4127304">=</span>&nbsp;<span class="builtinfunc" id="4127306">append</span><span class="op" id="4127312">(</span><span class="ident" id="4127313">list</span><span class="op" id="4127317">,</span>&nbsp;<span class="ident" id="4127319">p</span><span class="op" id="4127320">.</span><span class="ident" id="4127321">parseMethodSpec</span><span class="op" id="4127336">(</span><span class="ident" id="4127337">scope</span><span class="op" id="4127342">)</span><span class="op" id="4127343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127346">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127349">rbrace</span>&nbsp;<span class="op" id="4127356">:=</span>&nbsp;<span class="ident" id="4127359">p</span><span class="op" id="4127360">.</span><span class="ident" id="4127361">expect</span><span class="op" id="4127367">(</span><span class="ident" id="4127368">token</span><span class="op" id="4127373">.</span><span class="ident" id="4127374">RBRACE</span><span class="op" id="4127380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127384">return</span>&nbsp;<span class="op" id="4127391">&amp;</span><span class="ident" id="4127392">ast</span><span class="op" id="4127395">.</span><span class="ident" id="4127396">InterfaceType</span><span class="op" id="4127409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127413">Interface</span><span class="op" id="4127422">:</span>&nbsp;<span class="ident" id="4127424">pos</span><span class="op" id="4127427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127431">Methods</span><span class="op" id="4127438">:</span>&nbsp;<span class="op" id="4127440">&amp;</span><span class="ident" id="4127441">ast</span><span class="op" id="4127444">.</span><span class="ident" id="4127445">FieldList</span><span class="op" id="4127454">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127459">Opening</span><span class="op" id="4127466">:</span>&nbsp;<span class="ident" id="4127468">lbrace</span><span class="op" id="4127474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127479">List</span><span class="op" id="4127483">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127488">list</span><span class="op" id="4127492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127497">Closing</span><span class="op" id="4127504">:</span>&nbsp;<span class="ident" id="4127506">rbrace</span><span class="op" id="4127512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127516">}</span><span class="op" id="4127517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127520">}</span><br>
<span class="lineno">965</span><span class="op" id="4127522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4127525">func</span>&nbsp;<span class="op" id="4127530">(</span><span class="ident" id="4127531">p</span>&nbsp;<span class="op" id="4127533">*</span><span class="ident" id="4127534">parser</span><span class="op" id="4127540">)</span>&nbsp;<span class="ident" id="4127542">parseMapType</span><span class="op" id="4127554">(</span><span class="op" id="4127555">)</span>&nbsp;<span class="op" id="4127557">*</span><span class="ident" id="4127558">ast</span><span class="op" id="4127561">.</span><span class="ident" id="4127562">MapType</span>&nbsp;<span class="op" id="4127570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127573">if</span>&nbsp;<span class="ident" id="4127576">p</span><span class="op" id="4127577">.</span><span class="ident" id="4127578">trace</span>&nbsp;<span class="op" id="4127584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127588">defer</span>&nbsp;<span class="ident" id="4127594">un</span><span class="op" id="4127596">(</span><span class="ident" id="4127597">trace</span><span class="op" id="4127602">(</span><span class="ident" id="4127603">p</span><span class="op" id="4127604">,</span>&nbsp;<span class="string" id="4127606">&#34;MapType&#34;</span><span class="op" id="4127615">)</span><span class="op" id="4127616">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127623">pos</span>&nbsp;<span class="op" id="4127627">:=</span>&nbsp;<span class="ident" id="4127630">p</span><span class="op" id="4127631">.</span><span class="ident" id="4127632">expect</span><span class="op" id="4127638">(</span><span class="ident" id="4127639">token</span><span class="op" id="4127644">.</span><span class="ident" id="4127645">MAP</span><span class="op" id="4127648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127651">p</span><span class="op" id="4127652">.</span><span class="ident" id="4127653">expect</span><span class="op" id="4127659">(</span><span class="ident" id="4127660">token</span><span class="op" id="4127665">.</span><span class="ident" id="4127666">LBRACK</span><span class="op" id="4127672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127675">key</span>&nbsp;<span class="op" id="4127679">:=</span>&nbsp;<span class="ident" id="4127682">p</span><span class="op" id="4127683">.</span><span class="ident" id="4127684">parseType</span><span class="op" id="4127693">(</span><span class="op" id="4127694">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127697">p</span><span class="op" id="4127698">.</span><span class="ident" id="4127699">expect</span><span class="op" id="4127705">(</span><span class="ident" id="4127706">token</span><span class="op" id="4127711">.</span><span class="ident" id="4127712">RBRACK</span><span class="op" id="4127718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127721">value</span>&nbsp;<span class="op" id="4127727">:=</span>&nbsp;<span class="ident" id="4127730">p</span><span class="op" id="4127731">.</span><span class="ident" id="4127732">parseType</span><span class="op" id="4127741">(</span><span class="op" id="4127742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127746">return</span>&nbsp;<span class="op" id="4127753">&amp;</span><span class="ident" id="4127754">ast</span><span class="op" id="4127757">.</span><span class="ident" id="4127758">MapType</span><span class="op" id="4127765">{</span><span class="ident" id="4127766">Map</span><span class="op" id="4127769">:</span>&nbsp;<span class="ident" id="4127771">pos</span><span class="op" id="4127774">,</span>&nbsp;<span class="ident" id="4127776">Key</span><span class="op" id="4127779">:</span>&nbsp;<span class="ident" id="4127781">key</span><span class="op" id="4127784">,</span>&nbsp;<span class="ident" id="4127786">Value</span><span class="op" id="4127791">:</span>&nbsp;<span class="ident" id="4127793">value</span><span class="op" id="4127798">}</span><br>
<span class="lineno"></span><span class="op" id="4127800">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="4127803">func</span>&nbsp;<span class="op" id="4127808">(</span><span class="ident" id="4127809">p</span>&nbsp;<span class="op" id="4127811">*</span><span class="ident" id="4127812">parser</span><span class="op" id="4127818">)</span>&nbsp;<span class="ident" id="4127820">parseChanType</span><span class="op" id="4127833">(</span><span class="op" id="4127834">)</span>&nbsp;<span class="op" id="4127836">*</span><span class="ident" id="4127837">ast</span><span class="op" id="4127840">.</span><span class="ident" id="4127841">ChanType</span>&nbsp;<span class="op" id="4127850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127853">if</span>&nbsp;<span class="ident" id="4127856">p</span><span class="op" id="4127857">.</span><span class="ident" id="4127858">trace</span>&nbsp;<span class="op" id="4127864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127868">defer</span>&nbsp;<span class="ident" id="4127874">un</span><span class="op" id="4127876">(</span><span class="ident" id="4127877">trace</span><span class="op" id="4127882">(</span><span class="ident" id="4127883">p</span><span class="op" id="4127884">,</span>&nbsp;<span class="string" id="4127886">&#34;ChanType&#34;</span><span class="op" id="4127896">)</span><span class="op" id="4127897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4127900">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127904">pos</span>&nbsp;<span class="op" id="4127908">:=</span>&nbsp;<span class="ident" id="4127911">p</span><span class="op" id="4127912">.</span><span class="ident" id="4127913">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127918">dir</span>&nbsp;<span class="op" id="4127922">:=</span>&nbsp;<span class="ident" id="4127925">ast</span><span class="op" id="4127928">.</span><span class="ident" id="4127929">SEND</span>&nbsp;<span class="op" id="4127934">|</span>&nbsp;<span class="ident" id="4127936">ast</span><span class="op" id="4127939">.</span><span class="ident" id="4127940">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127946">var</span>&nbsp;<span class="ident" id="4127950">arrow</span>&nbsp;<span class="ident" id="4127956">token</span><span class="op" id="4127961">.</span><span class="ident" id="4127962">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4127967">if</span>&nbsp;<span class="ident" id="4127970">p</span><span class="op" id="4127971">.</span><span class="ident" id="4127972">tok</span>&nbsp;<span class="op" id="4127976">==</span>&nbsp;<span class="ident" id="4127979">token</span><span class="op" id="4127984">.</span><span class="ident" id="4127985">CHAN</span>&nbsp;<span class="op" id="4127990">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4127994">p</span><span class="op" id="4127995">.</span><span class="ident" id="4127996">next</span><span class="op" id="4128000">(</span><span class="op" id="4128001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128005">if</span>&nbsp;<span class="ident" id="4128008">p</span><span class="op" id="4128009">.</span><span class="ident" id="4128010">tok</span>&nbsp;<span class="op" id="4128014">==</span>&nbsp;<span class="ident" id="4128017">token</span><span class="op" id="4128022">.</span><span class="ident" id="4128023">ARROW</span>&nbsp;<span class="op" id="4128029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128034">arrow</span>&nbsp;<span class="op" id="4128040">=</span>&nbsp;<span class="ident" id="4128042">p</span><span class="op" id="4128043">.</span><span class="ident" id="4128044">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128051">p</span><span class="op" id="4128052">.</span><span class="ident" id="4128053">next</span><span class="op" id="4128057">(</span><span class="op" id="4128058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128063">dir</span>&nbsp;<span class="op" id="4128067">=</span>&nbsp;<span class="ident" id="4128069">ast</span><span class="op" id="4128072">.</span><span class="ident" id="4128073">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128083">}</span>&nbsp;<span class="keyword" id="4128085">else</span>&nbsp;<span class="op" id="4128090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128094">arrow</span>&nbsp;<span class="op" id="4128100">=</span>&nbsp;<span class="ident" id="4128102">p</span><span class="op" id="4128103">.</span><span class="ident" id="4128104">expect</span><span class="op" id="4128110">(</span><span class="ident" id="4128111">token</span><span class="op" id="4128116">.</span><span class="ident" id="4128117">ARROW</span><span class="op" id="4128122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128126">p</span><span class="op" id="4128127">.</span><span class="ident" id="4128128">expect</span><span class="op" id="4128134">(</span><span class="ident" id="4128135">token</span><span class="op" id="4128140">.</span><span class="ident" id="4128141">CHAN</span><span class="op" id="4128145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128149">dir</span>&nbsp;<span class="op" id="4128153">=</span>&nbsp;<span class="ident" id="4128155">ast</span><span class="op" id="4128158">.</span><span class="ident" id="4128159">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128168">value</span>&nbsp;<span class="op" id="4128174">:=</span>&nbsp;<span class="ident" id="4128177">p</span><span class="op" id="4128178">.</span><span class="ident" id="4128179">parseType</span><span class="op" id="4128188">(</span><span class="op" id="4128189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128193">return</span>&nbsp;<span class="op" id="4128200">&amp;</span><span class="ident" id="4128201">ast</span><span class="op" id="4128204">.</span><span class="ident" id="4128205">ChanType</span><span class="op" id="4128213">{</span><span class="ident" id="4128214">Begin</span><span class="op" id="4128219">:</span>&nbsp;<span class="ident" id="4128221">pos</span><span class="op" id="4128224">,</span>&nbsp;<span class="ident" id="4128226">Arrow</span><span class="op" id="4128231">:</span>&nbsp;<span class="ident" id="4128233">arrow</span><span class="op" id="4128238">,</span>&nbsp;<span class="ident" id="4128240">Dir</span><span class="op" id="4128243">:</span>&nbsp;<span class="ident" id="4128245">dir</span><span class="op" id="4128248">,</span>&nbsp;<span class="ident" id="4128250">Value</span><span class="op" id="4128255">:</span>&nbsp;<span class="ident" id="4128257">value</span><span class="op" id="4128262">}</span><br>
<span class="lineno"></span><span class="op" id="4128264">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="4128267">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4128322">func</span>&nbsp;<span class="op" id="4128327">(</span><span class="ident" id="4128328">p</span>&nbsp;<span class="op" id="4128330">*</span><span class="ident" id="4128331">parser</span><span class="op" id="4128337">)</span>&nbsp;<span class="ident" id="4128339">tryIdentOrType</span><span class="op" id="4128353">(</span><span class="op" id="4128354">)</span>&nbsp;<span class="ident" id="4128356">ast</span><span class="op" id="4128359">.</span><span class="ident" id="4128360">Expr</span>&nbsp;<span class="op" id="4128365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128368">switch</span>&nbsp;<span class="ident" id="4128375">p</span><span class="op" id="4128376">.</span><span class="ident" id="4128377">tok</span>&nbsp;<span class="op" id="4128381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128384">case</span>&nbsp;<span class="ident" id="4128389">token</span><span class="op" id="4128394">.</span><span class="ident" id="4128395">IDENT</span><span class="op" id="4128400">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128404">return</span>&nbsp;<span class="ident" id="4128411">p</span><span class="op" id="4128412">.</span><span class="ident" id="4128413">parseTypeName</span><span class="op" id="4128426">(</span><span class="op" id="4128427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128430">case</span>&nbsp;<span class="ident" id="4128435">token</span><span class="op" id="4128440">.</span><span class="ident" id="4128441">LBRACK</span><span class="op" id="4128447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128451">return</span>&nbsp;<span class="ident" id="4128458">p</span><span class="op" id="4128459">.</span><span class="ident" id="4128460">parseArrayType</span><span class="op" id="4128474">(</span><span class="op" id="4128475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128478">case</span>&nbsp;<span class="ident" id="4128483">token</span><span class="op" id="4128488">.</span><span class="ident" id="4128489">STRUCT</span><span class="op" id="4128495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128499">return</span>&nbsp;<span class="ident" id="4128506">p</span><span class="op" id="4128507">.</span><span class="ident" id="4128508">parseStructType</span><span class="op" id="4128523">(</span><span class="op" id="4128524">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128527">case</span>&nbsp;<span class="ident" id="4128532">token</span><span class="op" id="4128537">.</span><span class="ident" id="4128538">MUL</span><span class="op" id="4128541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128545">return</span>&nbsp;<span class="ident" id="4128552">p</span><span class="op" id="4128553">.</span><span class="ident" id="4128554">parsePointerType</span><span class="op" id="4128570">(</span><span class="op" id="4128571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128574">case</span>&nbsp;<span class="ident" id="4128579">token</span><span class="op" id="4128584">.</span><span class="ident" id="4128585">FUNC</span><span class="op" id="4128589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128593">typ</span><span class="op" id="4128596">,</span>&nbsp;<span class="ident" id="4128598">_</span>&nbsp;<span class="op" id="4128600">:=</span>&nbsp;<span class="ident" id="4128603">p</span><span class="op" id="4128604">.</span><span class="ident" id="4128605">parseFuncType</span><span class="op" id="4128618">(</span><span class="op" id="4128619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128623">return</span>&nbsp;<span class="ident" id="4128630">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128635">case</span>&nbsp;<span class="ident" id="4128640">token</span><span class="op" id="4128645">.</span><span class="ident" id="4128646">INTERFACE</span><span class="op" id="4128655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128659">return</span>&nbsp;<span class="ident" id="4128666">p</span><span class="op" id="4128667">.</span><span class="ident" id="4128668">parseInterfaceType</span><span class="op" id="4128686">(</span><span class="op" id="4128687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128690">case</span>&nbsp;<span class="ident" id="4128695">token</span><span class="op" id="4128700">.</span><span class="ident" id="4128701">MAP</span><span class="op" id="4128704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128708">return</span>&nbsp;<span class="ident" id="4128715">p</span><span class="op" id="4128716">.</span><span class="ident" id="4128717">parseMapType</span><span class="op" id="4128729">(</span><span class="op" id="4128730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128733">case</span>&nbsp;<span class="ident" id="4128738">token</span><span class="op" id="4128743">.</span><span class="ident" id="4128744">CHAN</span><span class="op" id="4128748">,</span>&nbsp;<span class="ident" id="4128750">token</span><span class="op" id="4128755">.</span><span class="ident" id="4128756">ARROW</span><span class="op" id="4128761">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128765">return</span>&nbsp;<span class="ident" id="4128772">p</span><span class="op" id="4128773">.</span><span class="ident" id="4128774">parseChanType</span><span class="op" id="4128787">(</span><span class="op" id="4128788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128791">case</span>&nbsp;<span class="ident" id="4128796">token</span><span class="op" id="4128801">.</span><span class="ident" id="4128802">LPAREN</span><span class="op" id="4128808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128812">lparen</span>&nbsp;<span class="op" id="4128819">:=</span>&nbsp;<span class="ident" id="4128822">p</span><span class="op" id="4128823">.</span><span class="ident" id="4128824">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128830">p</span><span class="op" id="4128831">.</span><span class="ident" id="4128832">next</span><span class="op" id="4128836">(</span><span class="op" id="4128837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128841">typ</span>&nbsp;<span class="op" id="4128845">:=</span>&nbsp;<span class="ident" id="4128848">p</span><span class="op" id="4128849">.</span><span class="ident" id="4128850">parseType</span><span class="op" id="4128859">(</span><span class="op" id="4128860">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4128864">rparen</span>&nbsp;<span class="op" id="4128871">:=</span>&nbsp;<span class="ident" id="4128874">p</span><span class="op" id="4128875">.</span><span class="ident" id="4128876">expect</span><span class="op" id="4128882">(</span><span class="ident" id="4128883">token</span><span class="op" id="4128888">.</span><span class="ident" id="4128889">RPAREN</span><span class="op" id="4128895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128899">return</span>&nbsp;<span class="op" id="4128906">&amp;</span><span class="ident" id="4128907">ast</span><span class="op" id="4128910">.</span><span class="ident" id="4128911">ParenExpr</span><span class="op" id="4128920">{</span><span class="ident" id="4128921">Lparen</span><span class="op" id="4128927">:</span>&nbsp;<span class="ident" id="4128929">lparen</span><span class="op" id="4128935">,</span>&nbsp;<span class="ident" id="4128937">X</span><span class="op" id="4128938">:</span>&nbsp;<span class="ident" id="4128940">typ</span><span class="op" id="4128943">,</span>&nbsp;<span class="ident" id="4128945">Rparen</span><span class="op" id="4128951">:</span>&nbsp;<span class="ident" id="4128953">rparen</span><span class="op" id="4128959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4128962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4128966">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4128984">return</span>&nbsp;<span class="ident" id="4128991">nil</span><br>
<span class="lineno"></span><span class="op" id="4128995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4128998">func</span>&nbsp;<span class="op" id="4129003">(</span><span class="ident" id="4129004">p</span>&nbsp;<span class="op" id="4129006">*</span><span class="ident" id="4129007">parser</span><span class="op" id="4129013">)</span>&nbsp;<span class="ident" id="4129015">tryType</span><span class="op" id="4129022">(</span><span class="op" id="4129023">)</span>&nbsp;<span class="ident" id="4129025">ast</span><span class="op" id="4129028">.</span><span class="ident" id="4129029">Expr</span>&nbsp;<span class="op" id="4129034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129037">typ</span>&nbsp;<span class="op" id="4129041">:=</span>&nbsp;<span class="ident" id="4129044">p</span><span class="op" id="4129045">.</span><span class="ident" id="4129046">tryIdentOrType</span><span class="op" id="4129060">(</span><span class="op" id="4129061">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129064">if</span>&nbsp;<span class="ident" id="4129067">typ</span>&nbsp;<span class="op" id="4129071">!=</span>&nbsp;<span class="ident" id="4129074">nil</span>&nbsp;<span class="op" id="4129078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129082">p</span><span class="op" id="4129083">.</span><span class="ident" id="4129084">resolve</span><span class="op" id="4129091">(</span><span class="ident" id="4129092">typ</span><span class="op" id="4129095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129101">return</span>&nbsp;<span class="ident" id="4129108">typ</span><br>
<span class="lineno"></span><span class="op" id="4129112">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="4129115">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4129195">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4129206">func</span>&nbsp;<span class="op" id="4129211">(</span><span class="ident" id="4129212">p</span>&nbsp;<span class="op" id="4129214">*</span><span class="ident" id="4129215">parser</span><span class="op" id="4129221">)</span>&nbsp;<span class="ident" id="4129223">parseStmtList</span><span class="op" id="4129236">(</span><span class="op" id="4129237">)</span>&nbsp;<span class="op" id="4129239">(</span><span class="ident" id="4129240">list</span>&nbsp;<span class="op" id="4129245">[</span><span class="op" id="4129246">]</span><span class="ident" id="4129247">ast</span><span class="op" id="4129250">.</span><span class="ident" id="4129251">Stmt</span><span class="op" id="4129255">)</span>&nbsp;<span class="op" id="4129257">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129260">if</span>&nbsp;<span class="ident" id="4129263">p</span><span class="op" id="4129264">.</span><span class="ident" id="4129265">trace</span>&nbsp;<span class="op" id="4129271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129275">defer</span>&nbsp;<span class="ident" id="4129281">un</span><span class="op" id="4129283">(</span><span class="ident" id="4129284">trace</span><span class="op" id="4129289">(</span><span class="ident" id="4129290">p</span><span class="op" id="4129291">,</span>&nbsp;<span class="string" id="4129293">&#34;StatementList&#34;</span><span class="op" id="4129308">)</span><span class="op" id="4129309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129316">for</span>&nbsp;<span class="ident" id="4129320">p</span><span class="op" id="4129321">.</span><span class="ident" id="4129322">tok</span>&nbsp;<span class="op" id="4129326">!=</span>&nbsp;<span class="ident" id="4129329">token</span><span class="op" id="4129334">.</span><span class="ident" id="4129335">CASE</span>&nbsp;<span class="op" id="4129340">&amp;&amp;</span>&nbsp;<span class="ident" id="4129343">p</span><span class="op" id="4129344">.</span><span class="ident" id="4129345">tok</span>&nbsp;<span class="op" id="4129349">!=</span>&nbsp;<span class="ident" id="4129352">token</span><span class="op" id="4129357">.</span><span class="ident" id="4129358">DEFAULT</span>&nbsp;<span class="op" id="4129366">&amp;&amp;</span>&nbsp;<span class="ident" id="4129369">p</span><span class="op" id="4129370">.</span><span class="ident" id="4129371">tok</span>&nbsp;<span class="op" id="4129375">!=</span>&nbsp;<span class="ident" id="4129378">token</span><span class="op" id="4129383">.</span><span class="ident" id="4129384">RBRACE</span>&nbsp;<span class="op" id="4129391">&amp;&amp;</span>&nbsp;<span class="ident" id="4129394">p</span><span class="op" id="4129395">.</span><span class="ident" id="4129396">tok</span>&nbsp;<span class="op" id="4129400">!=</span>&nbsp;<span class="ident" id="4129403">token</span><span class="op" id="4129408">.</span><span class="ident" id="4129409">EOF</span>&nbsp;<span class="op" id="4129413">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129417">list</span>&nbsp;<span class="op" id="4129422">=</span>&nbsp;<span class="builtinfunc" id="4129424">append</span><span class="op" id="4129430">(</span><span class="ident" id="4129431">list</span><span class="op" id="4129435">,</span>&nbsp;<span class="ident" id="4129437">p</span><span class="op" id="4129438">.</span><span class="ident" id="4129439">parseStmt</span><span class="op" id="4129448">(</span><span class="op" id="4129449">)</span><span class="op" id="4129450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129457">return</span><br>
<span class="lineno"></span><span class="op" id="4129464">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="4129467">func</span>&nbsp;<span class="op" id="4129472">(</span><span class="ident" id="4129473">p</span>&nbsp;<span class="op" id="4129475">*</span><span class="ident" id="4129476">parser</span><span class="op" id="4129482">)</span>&nbsp;<span class="ident" id="4129484">parseBody</span><span class="op" id="4129493">(</span><span class="ident" id="4129494">scope</span>&nbsp;<span class="op" id="4129500">*</span><span class="ident" id="4129501">ast</span><span class="op" id="4129504">.</span><span class="ident" id="4129505">Scope</span><span class="op" id="4129510">)</span>&nbsp;<span class="op" id="4129512">*</span><span class="ident" id="4129513">ast</span><span class="op" id="4129516">.</span><span class="ident" id="4129517">BlockStmt</span>&nbsp;<span class="op" id="4129527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129530">if</span>&nbsp;<span class="ident" id="4129533">p</span><span class="op" id="4129534">.</span><span class="ident" id="4129535">trace</span>&nbsp;<span class="op" id="4129541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129545">defer</span>&nbsp;<span class="ident" id="4129551">un</span><span class="op" id="4129553">(</span><span class="ident" id="4129554">trace</span><span class="op" id="4129559">(</span><span class="ident" id="4129560">p</span><span class="op" id="4129561">,</span>&nbsp;<span class="string" id="4129563">&#34;Body&#34;</span><span class="op" id="4129569">)</span><span class="op" id="4129570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129573">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129577">lbrace</span>&nbsp;<span class="op" id="4129584">:=</span>&nbsp;<span class="ident" id="4129587">p</span><span class="op" id="4129588">.</span><span class="ident" id="4129589">expect</span><span class="op" id="4129595">(</span><span class="ident" id="4129596">token</span><span class="op" id="4129601">.</span><span class="ident" id="4129602">LBRACE</span><span class="op" id="4129608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129611">p</span><span class="op" id="4129612">.</span><span class="ident" id="4129613">topScope</span>&nbsp;<span class="op" id="4129622">=</span>&nbsp;<span class="ident" id="4129624">scope</span>&nbsp;<span class="comment" id="4129630">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129654">p</span><span class="op" id="4129655">.</span><span class="ident" id="4129656">openLabelScope</span><span class="op" id="4129670">(</span><span class="op" id="4129671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129674">list</span>&nbsp;<span class="op" id="4129679">:=</span>&nbsp;<span class="ident" id="4129682">p</span><span class="op" id="4129683">.</span><span class="ident" id="4129684">parseStmtList</span><span class="op" id="4129697">(</span><span class="op" id="4129698">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129701">p</span><span class="op" id="4129702">.</span><span class="ident" id="4129703">closeLabelScope</span><span class="op" id="4129718">(</span><span class="op" id="4129719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129722">p</span><span class="op" id="4129723">.</span><span class="ident" id="4129724">closeScope</span><span class="op" id="4129734">(</span><span class="op" id="4129735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129738">rbrace</span>&nbsp;<span class="op" id="4129745">:=</span>&nbsp;<span class="ident" id="4129748">p</span><span class="op" id="4129749">.</span><span class="ident" id="4129750">expect</span><span class="op" id="4129756">(</span><span class="ident" id="4129757">token</span><span class="op" id="4129762">.</span><span class="ident" id="4129763">RBRACE</span><span class="op" id="4129769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129773">return</span>&nbsp;<span class="op" id="4129780">&amp;</span><span class="ident" id="4129781">ast</span><span class="op" id="4129784">.</span><span class="ident" id="4129785">BlockStmt</span><span class="op" id="4129794">{</span><span class="ident" id="4129795">Lbrace</span><span class="op" id="4129801">:</span>&nbsp;<span class="ident" id="4129803">lbrace</span><span class="op" id="4129809">,</span>&nbsp;<span class="ident" id="4129811">List</span><span class="op" id="4129815">:</span>&nbsp;<span class="ident" id="4129817">list</span><span class="op" id="4129821">,</span>&nbsp;<span class="ident" id="4129823">Rbrace</span><span class="op" id="4129829">:</span>&nbsp;<span class="ident" id="4129831">rbrace</span><span class="op" id="4129837">}</span><br>
<span class="lineno">1075</span><span class="op" id="4129839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4129842">func</span>&nbsp;<span class="op" id="4129847">(</span><span class="ident" id="4129848">p</span>&nbsp;<span class="op" id="4129850">*</span><span class="ident" id="4129851">parser</span><span class="op" id="4129857">)</span>&nbsp;<span class="ident" id="4129859">parseBlockStmt</span><span class="op" id="4129873">(</span><span class="op" id="4129874">)</span>&nbsp;<span class="op" id="4129876">*</span><span class="ident" id="4129877">ast</span><span class="op" id="4129880">.</span><span class="ident" id="4129881">BlockStmt</span>&nbsp;<span class="op" id="4129891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129894">if</span>&nbsp;<span class="ident" id="4129897">p</span><span class="op" id="4129898">.</span><span class="ident" id="4129899">trace</span>&nbsp;<span class="op" id="4129905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4129909">defer</span>&nbsp;<span class="ident" id="4129915">un</span><span class="op" id="4129917">(</span><span class="ident" id="4129918">trace</span><span class="op" id="4129923">(</span><span class="ident" id="4129924">p</span><span class="op" id="4129925">,</span>&nbsp;<span class="string" id="4129927">&#34;BlockStmt&#34;</span><span class="op" id="4129938">)</span><span class="op" id="4129939">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4129942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129946">lbrace</span>&nbsp;<span class="op" id="4129953">:=</span>&nbsp;<span class="ident" id="4129956">p</span><span class="op" id="4129957">.</span><span class="ident" id="4129958">expect</span><span class="op" id="4129964">(</span><span class="ident" id="4129965">token</span><span class="op" id="4129970">.</span><span class="ident" id="4129971">LBRACE</span><span class="op" id="4129977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129980">p</span><span class="op" id="4129981">.</span><span class="ident" id="4129982">openScope</span><span class="op" id="4129991">(</span><span class="op" id="4129992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4129995">list</span>&nbsp;<span class="op" id="4130000">:=</span>&nbsp;<span class="ident" id="4130003">p</span><span class="op" id="4130004">.</span><span class="ident" id="4130005">parseStmtList</span><span class="op" id="4130018">(</span><span class="op" id="4130019">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130022">p</span><span class="op" id="4130023">.</span><span class="ident" id="4130024">closeScope</span><span class="op" id="4130034">(</span><span class="op" id="4130035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130038">rbrace</span>&nbsp;<span class="op" id="4130045">:=</span>&nbsp;<span class="ident" id="4130048">p</span><span class="op" id="4130049">.</span><span class="ident" id="4130050">expect</span><span class="op" id="4130056">(</span><span class="ident" id="4130057">token</span><span class="op" id="4130062">.</span><span class="ident" id="4130063">RBRACE</span><span class="op" id="4130069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130073">return</span>&nbsp;<span class="op" id="4130080">&amp;</span><span class="ident" id="4130081">ast</span><span class="op" id="4130084">.</span><span class="ident" id="4130085">BlockStmt</span><span class="op" id="4130094">{</span><span class="ident" id="4130095">Lbrace</span><span class="op" id="4130101">:</span>&nbsp;<span class="ident" id="4130103">lbrace</span><span class="op" id="4130109">,</span>&nbsp;<span class="ident" id="4130111">List</span><span class="op" id="4130115">:</span>&nbsp;<span class="ident" id="4130117">list</span><span class="op" id="4130121">,</span>&nbsp;<span class="ident" id="4130123">Rbrace</span><span class="op" id="4130129">:</span>&nbsp;<span class="ident" id="4130131">rbrace</span><span class="op" id="4130137">}</span><br>
<span class="lineno"></span><span class="op" id="4130139">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="4130142">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4130222">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4130238">func</span>&nbsp;<span class="op" id="4130243">(</span><span class="ident" id="4130244">p</span>&nbsp;<span class="op" id="4130246">*</span><span class="ident" id="4130247">parser</span><span class="op" id="4130253">)</span>&nbsp;<span class="ident" id="4130255">parseFuncTypeOrLit</span><span class="op" id="4130273">(</span><span class="op" id="4130274">)</span>&nbsp;<span class="ident" id="4130276">ast</span><span class="op" id="4130279">.</span><span class="ident" id="4130280">Expr</span>&nbsp;<span class="op" id="4130285">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130288">if</span>&nbsp;<span class="ident" id="4130291">p</span><span class="op" id="4130292">.</span><span class="ident" id="4130293">trace</span>&nbsp;<span class="op" id="4130299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130303">defer</span>&nbsp;<span class="ident" id="4130309">un</span><span class="op" id="4130311">(</span><span class="ident" id="4130312">trace</span><span class="op" id="4130317">(</span><span class="ident" id="4130318">p</span><span class="op" id="4130319">,</span>&nbsp;<span class="string" id="4130321">&#34;FuncTypeOrLit&#34;</span><span class="op" id="4130336">)</span><span class="op" id="4130337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130344">typ</span><span class="op" id="4130347">,</span>&nbsp;<span class="ident" id="4130349">scope</span>&nbsp;<span class="op" id="4130355">:=</span>&nbsp;<span class="ident" id="4130358">p</span><span class="op" id="4130359">.</span><span class="ident" id="4130360">parseFuncType</span><span class="op" id="4130373">(</span><span class="op" id="4130374">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130377">if</span>&nbsp;<span class="ident" id="4130380">p</span><span class="op" id="4130381">.</span><span class="ident" id="4130382">tok</span>&nbsp;<span class="op" id="4130386">!=</span>&nbsp;<span class="ident" id="4130389">token</span><span class="op" id="4130394">.</span><span class="ident" id="4130395">LBRACE</span>&nbsp;<span class="op" id="4130402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130406">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130430">return</span>&nbsp;<span class="ident" id="4130437">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130446">p</span><span class="op" id="4130447">.</span><span class="ident" id="4130448">exprLev</span><span class="op" id="4130455">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130459">body</span>&nbsp;<span class="op" id="4130464">:=</span>&nbsp;<span class="ident" id="4130467">p</span><span class="op" id="4130468">.</span><span class="ident" id="4130469">parseBody</span><span class="op" id="4130478">(</span><span class="ident" id="4130479">scope</span><span class="op" id="4130484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130487">p</span><span class="op" id="4130488">.</span><span class="ident" id="4130489">exprLev</span><span class="op" id="4130496">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130501">return</span>&nbsp;<span class="op" id="4130508">&amp;</span><span class="ident" id="4130509">ast</span><span class="op" id="4130512">.</span><span class="ident" id="4130513">FuncLit</span><span class="op" id="4130520">{</span><span class="ident" id="4130521">Type</span><span class="op" id="4130525">:</span>&nbsp;<span class="ident" id="4130527">typ</span><span class="op" id="4130530">,</span>&nbsp;<span class="ident" id="4130532">Body</span><span class="op" id="4130536">:</span>&nbsp;<span class="ident" id="4130538">body</span><span class="op" id="4130542">}</span><br>
<span class="lineno">1110</span><span class="op" id="4130544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4130547">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="4130615">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="4130676">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="4130746">//</span><br>
<span class="lineno"></span><span class="keyword" id="4130749">func</span>&nbsp;<span class="op" id="4130754">(</span><span class="ident" id="4130755">p</span>&nbsp;<span class="op" id="4130757">*</span><span class="ident" id="4130758">parser</span><span class="op" id="4130764">)</span>&nbsp;<span class="ident" id="4130766">parseOperand</span><span class="op" id="4130778">(</span><span class="ident" id="4130779">lhs</span>&nbsp;<span class="builtintype" id="4130783">bool</span><span class="op" id="4130787">)</span>&nbsp;<span class="ident" id="4130789">ast</span><span class="op" id="4130792">.</span><span class="ident" id="4130793">Expr</span>&nbsp;<span class="op" id="4130798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130801">if</span>&nbsp;<span class="ident" id="4130804">p</span><span class="op" id="4130805">.</span><span class="ident" id="4130806">trace</span>&nbsp;<span class="op" id="4130812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130816">defer</span>&nbsp;<span class="ident" id="4130822">un</span><span class="op" id="4130824">(</span><span class="ident" id="4130825">trace</span><span class="op" id="4130830">(</span><span class="ident" id="4130831">p</span><span class="op" id="4130832">,</span>&nbsp;<span class="string" id="4130834">&#34;Operand&#34;</span><span class="op" id="4130843">)</span><span class="op" id="4130844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130847">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130851">switch</span>&nbsp;<span class="ident" id="4130858">p</span><span class="op" id="4130859">.</span><span class="ident" id="4130860">tok</span>&nbsp;<span class="op" id="4130864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130867">case</span>&nbsp;<span class="ident" id="4130872">token</span><span class="op" id="4130877">.</span><span class="ident" id="4130878">IDENT</span><span class="op" id="4130883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130887">x</span>&nbsp;<span class="op" id="4130889">:=</span>&nbsp;<span class="ident" id="4130892">p</span><span class="op" id="4130893">.</span><span class="ident" id="4130894">parseIdent</span><span class="op" id="4130904">(</span><span class="op" id="4130905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130909">if</span>&nbsp;<span class="op" id="4130912">!</span><span class="ident" id="4130913">lhs</span>&nbsp;<span class="op" id="4130917">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130922">p</span><span class="op" id="4130923">.</span><span class="ident" id="4130924">resolve</span><span class="op" id="4130931">(</span><span class="ident" id="4130932">x</span><span class="op" id="4130933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4130937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130941">return</span>&nbsp;<span class="ident" id="4130948">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4130952">case</span>&nbsp;<span class="ident" id="4130957">token</span><span class="op" id="4130962">.</span><span class="ident" id="4130963">INT</span><span class="op" id="4130966">,</span>&nbsp;<span class="ident" id="4130968">token</span><span class="op" id="4130973">.</span><span class="ident" id="4130974">FLOAT</span><span class="op" id="4130979">,</span>&nbsp;<span class="ident" id="4130981">token</span><span class="op" id="4130986">.</span><span class="ident" id="4130987">IMAG</span><span class="op" id="4130991">,</span>&nbsp;<span class="ident" id="4130993">token</span><span class="op" id="4130998">.</span><span class="ident" id="4130999">CHAR</span><span class="op" id="4131003">,</span>&nbsp;<span class="ident" id="4131005">token</span><span class="op" id="4131010">.</span><span class="ident" id="4131011">STRING</span><span class="op" id="4131017">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131021">x</span>&nbsp;<span class="op" id="4131023">:=</span>&nbsp;<span class="op" id="4131026">&amp;</span><span class="ident" id="4131027">ast</span><span class="op" id="4131030">.</span><span class="ident" id="4131031">BasicLit</span><span class="op" id="4131039">{</span><span class="ident" id="4131040">ValuePos</span><span class="op" id="4131048">:</span>&nbsp;<span class="ident" id="4131050">p</span><span class="op" id="4131051">.</span><span class="ident" id="4131052">pos</span><span class="op" id="4131055">,</span>&nbsp;<span class="ident" id="4131057">Kind</span><span class="op" id="4131061">:</span>&nbsp;<span class="ident" id="4131063">p</span><span class="op" id="4131064">.</span><span class="ident" id="4131065">tok</span><span class="op" id="4131068">,</span>&nbsp;<span class="ident" id="4131070">Value</span><span class="op" id="4131075">:</span>&nbsp;<span class="ident" id="4131077">p</span><span class="op" id="4131078">.</span><span class="ident" id="4131079">lit</span><span class="op" id="4131082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131086">p</span><span class="op" id="4131087">.</span><span class="ident" id="4131088">next</span><span class="op" id="4131092">(</span><span class="op" id="4131093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131097">return</span>&nbsp;<span class="ident" id="4131104">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131108">case</span>&nbsp;<span class="ident" id="4131113">token</span><span class="op" id="4131118">.</span><span class="ident" id="4131119">LPAREN</span><span class="op" id="4131125">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131129">lparen</span>&nbsp;<span class="op" id="4131136">:=</span>&nbsp;<span class="ident" id="4131139">p</span><span class="op" id="4131140">.</span><span class="ident" id="4131141">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131147">p</span><span class="op" id="4131148">.</span><span class="ident" id="4131149">next</span><span class="op" id="4131153">(</span><span class="op" id="4131154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131158">p</span><span class="op" id="4131159">.</span><span class="ident" id="4131160">exprLev</span><span class="op" id="4131167">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131172">x</span>&nbsp;<span class="op" id="4131174">:=</span>&nbsp;<span class="ident" id="4131177">p</span><span class="op" id="4131178">.</span><span class="ident" id="4131179">parseRhsOrType</span><span class="op" id="4131193">(</span><span class="op" id="4131194">)</span>&nbsp;<span class="comment" id="4131196">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131241">p</span><span class="op" id="4131242">.</span><span class="ident" id="4131243">exprLev</span><span class="op" id="4131250">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131255">rparen</span>&nbsp;<span class="op" id="4131262">:=</span>&nbsp;<span class="ident" id="4131265">p</span><span class="op" id="4131266">.</span><span class="ident" id="4131267">expect</span><span class="op" id="4131273">(</span><span class="ident" id="4131274">token</span><span class="op" id="4131279">.</span><span class="ident" id="4131280">RPAREN</span><span class="op" id="4131286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131290">return</span>&nbsp;<span class="op" id="4131297">&amp;</span><span class="ident" id="4131298">ast</span><span class="op" id="4131301">.</span><span class="ident" id="4131302">ParenExpr</span><span class="op" id="4131311">{</span><span class="ident" id="4131312">Lparen</span><span class="op" id="4131318">:</span>&nbsp;<span class="ident" id="4131320">lparen</span><span class="op" id="4131326">,</span>&nbsp;<span class="ident" id="4131328">X</span><span class="op" id="4131329">:</span>&nbsp;<span class="ident" id="4131331">x</span><span class="op" id="4131332">,</span>&nbsp;<span class="ident" id="4131334">Rparen</span><span class="op" id="4131340">:</span>&nbsp;<span class="ident" id="4131342">rparen</span><span class="op" id="4131348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131352">case</span>&nbsp;<span class="ident" id="4131357">token</span><span class="op" id="4131362">.</span><span class="ident" id="4131363">FUNC</span><span class="op" id="4131367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131371">return</span>&nbsp;<span class="ident" id="4131378">p</span><span class="op" id="4131379">.</span><span class="ident" id="4131380">parseFuncTypeOrLit</span><span class="op" id="4131398">(</span><span class="op" id="4131399">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4131402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131406">if</span>&nbsp;<span class="ident" id="4131409">typ</span>&nbsp;<span class="op" id="4131413">:=</span>&nbsp;<span class="ident" id="4131416">p</span><span class="op" id="4131417">.</span><span class="ident" id="4131418">tryIdentOrType</span><span class="op" id="4131432">(</span><span class="op" id="4131433">)</span><span class="op" id="4131434">;</span>&nbsp;<span class="ident" id="4131436">typ</span>&nbsp;<span class="op" id="4131440">!=</span>&nbsp;<span class="ident" id="4131443">nil</span>&nbsp;<span class="op" id="4131447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131451">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131506">_</span><span class="op" id="4131507">,</span>&nbsp;<span class="ident" id="4131509">isIdent</span>&nbsp;<span class="op" id="4131517">:=</span>&nbsp;<span class="ident" id="4131520">typ</span><span class="op" id="4131523">.</span><span class="op" id="4131524">(</span><span class="op" id="4131525">*</span><span class="ident" id="4131526">ast</span><span class="op" id="4131529">.</span><span class="ident" id="4131530">Ident</span><span class="op" id="4131535">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131539">assert</span><span class="op" id="4131545">(</span><span class="op" id="4131546">!</span><span class="ident" id="4131547">isIdent</span><span class="op" id="4131554">,</span>&nbsp;<span class="string" id="4131556">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="4131583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131587">return</span>&nbsp;<span class="ident" id="4131594">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4131599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131603">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131624">pos</span>&nbsp;<span class="op" id="4131628">:=</span>&nbsp;<span class="ident" id="4131631">p</span><span class="op" id="4131632">.</span><span class="ident" id="4131633">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131638">p</span><span class="op" id="4131639">.</span><span class="ident" id="4131640">errorExpected</span><span class="op" id="4131653">(</span><span class="ident" id="4131654">pos</span><span class="op" id="4131657">,</span>&nbsp;<span class="string" id="4131659">&#34;operand&#34;</span><span class="op" id="4131668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131671">syncStmt</span><span class="op" id="4131679">(</span><span class="ident" id="4131680">p</span><span class="op" id="4131681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131684">return</span>&nbsp;<span class="op" id="4131691">&amp;</span><span class="ident" id="4131692">ast</span><span class="op" id="4131695">.</span><span class="ident" id="4131696">BadExpr</span><span class="op" id="4131703">{</span><span class="ident" id="4131704">From</span><span class="op" id="4131708">:</span>&nbsp;<span class="ident" id="4131710">pos</span><span class="op" id="4131713">,</span>&nbsp;<span class="ident" id="4131715">To</span><span class="op" id="4131717">:</span>&nbsp;<span class="ident" id="4131719">p</span><span class="op" id="4131720">.</span><span class="ident" id="4131721">pos</span><span class="op" id="4131724">}</span><br>
<span class="lineno"></span><span class="op" id="4131726">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="4131729">func</span>&nbsp;<span class="op" id="4131734">(</span><span class="ident" id="4131735">p</span>&nbsp;<span class="op" id="4131737">*</span><span class="ident" id="4131738">parser</span><span class="op" id="4131744">)</span>&nbsp;<span class="ident" id="4131746">parseSelector</span><span class="op" id="4131759">(</span><span class="ident" id="4131760">x</span>&nbsp;<span class="ident" id="4131762">ast</span><span class="op" id="4131765">.</span><span class="ident" id="4131766">Expr</span><span class="op" id="4131770">)</span>&nbsp;<span class="ident" id="4131772">ast</span><span class="op" id="4131775">.</span><span class="ident" id="4131776">Expr</span>&nbsp;<span class="op" id="4131781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131784">if</span>&nbsp;<span class="ident" id="4131787">p</span><span class="op" id="4131788">.</span><span class="ident" id="4131789">trace</span>&nbsp;<span class="op" id="4131795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131799">defer</span>&nbsp;<span class="ident" id="4131805">un</span><span class="op" id="4131807">(</span><span class="ident" id="4131808">trace</span><span class="op" id="4131813">(</span><span class="ident" id="4131814">p</span><span class="op" id="4131815">,</span>&nbsp;<span class="string" id="4131817">&#34;Selector&#34;</span><span class="op" id="4131827">)</span><span class="op" id="4131828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4131831">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131835">sel</span>&nbsp;<span class="op" id="4131839">:=</span>&nbsp;<span class="ident" id="4131842">p</span><span class="op" id="4131843">.</span><span class="ident" id="4131844">parseIdent</span><span class="op" id="4131854">(</span><span class="op" id="4131855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131859">return</span>&nbsp;<span class="op" id="4131866">&amp;</span><span class="ident" id="4131867">ast</span><span class="op" id="4131870">.</span><span class="ident" id="4131871">SelectorExpr</span><span class="op" id="4131883">{</span><span class="ident" id="4131884">X</span><span class="op" id="4131885">:</span>&nbsp;<span class="ident" id="4131887">x</span><span class="op" id="4131888">,</span>&nbsp;<span class="ident" id="4131890">Sel</span><span class="op" id="4131893">:</span>&nbsp;<span class="ident" id="4131895">sel</span><span class="op" id="4131898">}</span><br>
<span class="lineno"></span><span class="op" id="4131900">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="4131903">func</span>&nbsp;<span class="op" id="4131908">(</span><span class="ident" id="4131909">p</span>&nbsp;<span class="op" id="4131911">*</span><span class="ident" id="4131912">parser</span><span class="op" id="4131918">)</span>&nbsp;<span class="ident" id="4131920">parseTypeAssertion</span><span class="op" id="4131938">(</span><span class="ident" id="4131939">x</span>&nbsp;<span class="ident" id="4131941">ast</span><span class="op" id="4131944">.</span><span class="ident" id="4131945">Expr</span><span class="op" id="4131949">)</span>&nbsp;<span class="ident" id="4131951">ast</span><span class="op" id="4131954">.</span><span class="ident" id="4131955">Expr</span>&nbsp;<span class="op" id="4131960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131963">if</span>&nbsp;<span class="ident" id="4131966">p</span><span class="op" id="4131967">.</span><span class="ident" id="4131968">trace</span>&nbsp;<span class="op" id="4131974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4131978">defer</span>&nbsp;<span class="ident" id="4131984">un</span><span class="op" id="4131986">(</span><span class="ident" id="4131987">trace</span><span class="op" id="4131992">(</span><span class="ident" id="4131993">p</span><span class="op" id="4131994">,</span>&nbsp;<span class="string" id="4131996">&#34;TypeAssertion&#34;</span><span class="op" id="4132011">)</span><span class="op" id="4132012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132015">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132019">lparen</span>&nbsp;<span class="op" id="4132026">:=</span>&nbsp;<span class="ident" id="4132029">p</span><span class="op" id="4132030">.</span><span class="ident" id="4132031">expect</span><span class="op" id="4132037">(</span><span class="ident" id="4132038">token</span><span class="op" id="4132043">.</span><span class="ident" id="4132044">LPAREN</span><span class="op" id="4132050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132053">var</span>&nbsp;<span class="ident" id="4132057">typ</span>&nbsp;<span class="ident" id="4132061">ast</span><span class="op" id="4132064">.</span><span class="ident" id="4132065">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132071">if</span>&nbsp;<span class="ident" id="4132074">p</span><span class="op" id="4132075">.</span><span class="ident" id="4132076">tok</span>&nbsp;<span class="op" id="4132080">==</span>&nbsp;<span class="ident" id="4132083">token</span><span class="op" id="4132088">.</span><span class="ident" id="4132089">TYPE</span>&nbsp;<span class="op" id="4132094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132098">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132127">p</span><span class="op" id="4132128">.</span><span class="ident" id="4132129">next</span><span class="op" id="4132133">(</span><span class="op" id="4132134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132137">}</span>&nbsp;<span class="keyword" id="4132139">else</span>&nbsp;<span class="op" id="4132144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132148">typ</span>&nbsp;<span class="op" id="4132152">=</span>&nbsp;<span class="ident" id="4132154">p</span><span class="op" id="4132155">.</span><span class="ident" id="4132156">parseType</span><span class="op" id="4132165">(</span><span class="op" id="4132166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132172">rparen</span>&nbsp;<span class="op" id="4132179">:=</span>&nbsp;<span class="ident" id="4132182">p</span><span class="op" id="4132183">.</span><span class="ident" id="4132184">expect</span><span class="op" id="4132190">(</span><span class="ident" id="4132191">token</span><span class="op" id="4132196">.</span><span class="ident" id="4132197">RPAREN</span><span class="op" id="4132203">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132207">return</span>&nbsp;<span class="op" id="4132214">&amp;</span><span class="ident" id="4132215">ast</span><span class="op" id="4132218">.</span><span class="ident" id="4132219">TypeAssertExpr</span><span class="op" id="4132233">{</span><span class="ident" id="4132234">X</span><span class="op" id="4132235">:</span>&nbsp;<span class="ident" id="4132237">x</span><span class="op" id="4132238">,</span>&nbsp;<span class="ident" id="4132240">Type</span><span class="op" id="4132244">:</span>&nbsp;<span class="ident" id="4132246">typ</span><span class="op" id="4132249">,</span>&nbsp;<span class="ident" id="4132251">Lparen</span><span class="op" id="4132257">:</span>&nbsp;<span class="ident" id="4132259">lparen</span><span class="op" id="4132265">,</span>&nbsp;<span class="ident" id="4132267">Rparen</span><span class="op" id="4132273">:</span>&nbsp;<span class="ident" id="4132275">rparen</span><span class="op" id="4132281">}</span><br>
<span class="lineno"></span><span class="op" id="4132283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4132286">func</span>&nbsp;<span class="op" id="4132291">(</span><span class="ident" id="4132292">p</span>&nbsp;<span class="op" id="4132294">*</span><span class="ident" id="4132295">parser</span><span class="op" id="4132301">)</span>&nbsp;<span class="ident" id="4132303">parseIndexOrSlice</span><span class="op" id="4132320">(</span><span class="ident" id="4132321">x</span>&nbsp;<span class="ident" id="4132323">ast</span><span class="op" id="4132326">.</span><span class="ident" id="4132327">Expr</span><span class="op" id="4132331">)</span>&nbsp;<span class="ident" id="4132333">ast</span><span class="op" id="4132336">.</span><span class="ident" id="4132337">Expr</span>&nbsp;<span class="op" id="4132342">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132345">if</span>&nbsp;<span class="ident" id="4132348">p</span><span class="op" id="4132349">.</span><span class="ident" id="4132350">trace</span>&nbsp;<span class="op" id="4132356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132360">defer</span>&nbsp;<span class="ident" id="4132366">un</span><span class="op" id="4132368">(</span><span class="ident" id="4132369">trace</span><span class="op" id="4132374">(</span><span class="ident" id="4132375">p</span><span class="op" id="4132376">,</span>&nbsp;<span class="string" id="4132378">&#34;IndexOrSlice&#34;</span><span class="op" id="4132392">)</span><span class="op" id="4132393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132400">const</span>&nbsp;<span class="ident" id="4132406">N</span>&nbsp;<span class="op" id="4132408">=</span>&nbsp;<span class="num" id="4132410">3</span>&nbsp;<span class="comment" id="4132412">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132460">lbrack</span>&nbsp;<span class="op" id="4132467">:=</span>&nbsp;<span class="ident" id="4132470">p</span><span class="op" id="4132471">.</span><span class="ident" id="4132472">expect</span><span class="op" id="4132478">(</span><span class="ident" id="4132479">token</span><span class="op" id="4132484">.</span><span class="ident" id="4132485">LBRACK</span><span class="op" id="4132491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132494">p</span><span class="op" id="4132495">.</span><span class="ident" id="4132496">exprLev</span><span class="op" id="4132503">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132507">var</span>&nbsp;<span class="ident" id="4132511">index</span>&nbsp;<span class="op" id="4132517">[</span><span class="ident" id="4132518">N</span><span class="op" id="4132519">]</span><span class="ident" id="4132520">ast</span><span class="op" id="4132523">.</span><span class="ident" id="4132524">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132530">var</span>&nbsp;<span class="ident" id="4132534">colons</span>&nbsp;<span class="op" id="4132541">[</span><span class="ident" id="4132542">N</span>&nbsp;<span class="op" id="4132544">-</span>&nbsp;<span class="num" id="4132546">1</span><span class="op" id="4132547">]</span><span class="ident" id="4132548">token</span><span class="op" id="4132553">.</span><span class="ident" id="4132554">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132559">if</span>&nbsp;<span class="ident" id="4132562">p</span><span class="op" id="4132563">.</span><span class="ident" id="4132564">tok</span>&nbsp;<span class="op" id="4132568">!=</span>&nbsp;<span class="ident" id="4132571">token</span><span class="op" id="4132576">.</span><span class="ident" id="4132577">COLON</span>&nbsp;<span class="op" id="4132583">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132587">index</span><span class="op" id="4132592">[</span><span class="num" id="4132593">0</span><span class="op" id="4132594">]</span>&nbsp;<span class="op" id="4132596">=</span>&nbsp;<span class="ident" id="4132598">p</span><span class="op" id="4132599">.</span><span class="ident" id="4132600">parseRhs</span><span class="op" id="4132608">(</span><span class="op" id="4132609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132615">ncolons</span>&nbsp;<span class="op" id="4132623">:=</span>&nbsp;<span class="num" id="4132626">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132629">for</span>&nbsp;<span class="ident" id="4132633">p</span><span class="op" id="4132634">.</span><span class="ident" id="4132635">tok</span>&nbsp;<span class="op" id="4132639">==</span>&nbsp;<span class="ident" id="4132642">token</span><span class="op" id="4132647">.</span><span class="ident" id="4132648">COLON</span>&nbsp;<span class="op" id="4132654">&amp;&amp;</span>&nbsp;<span class="ident" id="4132657">ncolons</span>&nbsp;<span class="op" id="4132665">&lt;</span>&nbsp;<span class="builtinfunc" id="4132667">len</span><span class="op" id="4132670">(</span><span class="ident" id="4132671">colons</span><span class="op" id="4132677">)</span>&nbsp;<span class="op" id="4132679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132683">colons</span><span class="op" id="4132689">[</span><span class="ident" id="4132690">ncolons</span><span class="op" id="4132697">]</span>&nbsp;<span class="op" id="4132699">=</span>&nbsp;<span class="ident" id="4132701">p</span><span class="op" id="4132702">.</span><span class="ident" id="4132703">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132709">ncolons</span><span class="op" id="4132716">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132721">p</span><span class="op" id="4132722">.</span><span class="ident" id="4132723">next</span><span class="op" id="4132727">(</span><span class="op" id="4132728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132732">if</span>&nbsp;<span class="ident" id="4132735">p</span><span class="op" id="4132736">.</span><span class="ident" id="4132737">tok</span>&nbsp;<span class="op" id="4132741">!=</span>&nbsp;<span class="ident" id="4132744">token</span><span class="op" id="4132749">.</span><span class="ident" id="4132750">COLON</span>&nbsp;<span class="op" id="4132756">&amp;&amp;</span>&nbsp;<span class="ident" id="4132759">p</span><span class="op" id="4132760">.</span><span class="ident" id="4132761">tok</span>&nbsp;<span class="op" id="4132765">!=</span>&nbsp;<span class="ident" id="4132768">token</span><span class="op" id="4132773">.</span><span class="ident" id="4132774">RBRACK</span>&nbsp;<span class="op" id="4132781">&amp;&amp;</span>&nbsp;<span class="ident" id="4132784">p</span><span class="op" id="4132785">.</span><span class="ident" id="4132786">tok</span>&nbsp;<span class="op" id="4132790">!=</span>&nbsp;<span class="ident" id="4132793">token</span><span class="op" id="4132798">.</span><span class="ident" id="4132799">EOF</span>&nbsp;<span class="op" id="4132803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132808">index</span><span class="op" id="4132813">[</span><span class="ident" id="4132814">ncolons</span><span class="op" id="4132821">]</span>&nbsp;<span class="op" id="4132823">=</span>&nbsp;<span class="ident" id="4132825">p</span><span class="op" id="4132826">.</span><span class="ident" id="4132827">parseRhs</span><span class="op" id="4132835">(</span><span class="op" id="4132836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132840">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132846">p</span><span class="op" id="4132847">.</span><span class="ident" id="4132848">exprLev</span><span class="op" id="4132855">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132859">rbrack</span>&nbsp;<span class="op" id="4132866">:=</span>&nbsp;<span class="ident" id="4132869">p</span><span class="op" id="4132870">.</span><span class="ident" id="4132871">expect</span><span class="op" id="4132877">(</span><span class="ident" id="4132878">token</span><span class="op" id="4132883">.</span><span class="ident" id="4132884">RBRACK</span><span class="op" id="4132890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132894">if</span>&nbsp;<span class="ident" id="4132897">ncolons</span>&nbsp;<span class="op" id="4132905">&gt;</span>&nbsp;<span class="num" id="4132907">0</span>&nbsp;<span class="op" id="4132909">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132913">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132935">slice3</span>&nbsp;<span class="op" id="4132942">:=</span>&nbsp;<span class="builtintype" id="4132945">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132953">if</span>&nbsp;<span class="ident" id="4132956">ncolons</span>&nbsp;<span class="op" id="4132964">==</span>&nbsp;<span class="num" id="4132967">2</span>&nbsp;<span class="op" id="4132969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132974">slice3</span>&nbsp;<span class="op" id="4132981">=</span>&nbsp;<span class="builtintype" id="4132983">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4132991">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4133071">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133152">if</span>&nbsp;<span class="ident" id="4133155">index</span><span class="op" id="4133160">[</span><span class="num" id="4133161">1</span><span class="op" id="4133162">]</span>&nbsp;<span class="op" id="4133164">==</span>&nbsp;<span class="ident" id="4133167">nil</span>&nbsp;<span class="op" id="4133171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133177">p</span><span class="op" id="4133178">.</span><span class="builtintype" id="4133179">error</span><span class="op" id="4133184">(</span><span class="ident" id="4133185">colons</span><span class="op" id="4133191">[</span><span class="num" id="4133192">0</span><span class="op" id="4133193">]</span><span class="op" id="4133194">,</span>&nbsp;<span class="string" id="4133196">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4133233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133239">index</span><span class="op" id="4133244">[</span><span class="num" id="4133245">1</span><span class="op" id="4133246">]</span>&nbsp;<span class="op" id="4133248">=</span>&nbsp;<span class="op" id="4133250">&amp;</span><span class="ident" id="4133251">ast</span><span class="op" id="4133254">.</span><span class="ident" id="4133255">BadExpr</span><span class="op" id="4133262">{</span><span class="ident" id="4133263">From</span><span class="op" id="4133267">:</span>&nbsp;<span class="ident" id="4133269">colons</span><span class="op" id="4133275">[</span><span class="num" id="4133276">0</span><span class="op" id="4133277">]</span>&nbsp;<span class="op" id="4133279">+</span>&nbsp;<span class="num" id="4133281">1</span><span class="op" id="4133282">,</span>&nbsp;<span class="ident" id="4133284">To</span><span class="op" id="4133286">:</span>&nbsp;<span class="ident" id="4133288">colons</span><span class="op" id="4133294">[</span><span class="num" id="4133295">1</span><span class="op" id="4133296">]</span><span class="op" id="4133297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133302">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133307">if</span>&nbsp;<span class="ident" id="4133310">index</span><span class="op" id="4133315">[</span><span class="num" id="4133316">2</span><span class="op" id="4133317">]</span>&nbsp;<span class="op" id="4133319">==</span>&nbsp;<span class="ident" id="4133322">nil</span>&nbsp;<span class="op" id="4133326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133332">p</span><span class="op" id="4133333">.</span><span class="builtintype" id="4133334">error</span><span class="op" id="4133339">(</span><span class="ident" id="4133340">colons</span><span class="op" id="4133346">[</span><span class="num" id="4133347">1</span><span class="op" id="4133348">]</span><span class="op" id="4133349">,</span>&nbsp;<span class="string" id="4133351">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4133388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133394">index</span><span class="op" id="4133399">[</span><span class="num" id="4133400">2</span><span class="op" id="4133401">]</span>&nbsp;<span class="op" id="4133403">=</span>&nbsp;<span class="op" id="4133405">&amp;</span><span class="ident" id="4133406">ast</span><span class="op" id="4133409">.</span><span class="ident" id="4133410">BadExpr</span><span class="op" id="4133417">{</span><span class="ident" id="4133418">From</span><span class="op" id="4133422">:</span>&nbsp;<span class="ident" id="4133424">colons</span><span class="op" id="4133430">[</span><span class="num" id="4133431">1</span><span class="op" id="4133432">]</span>&nbsp;<span class="op" id="4133434">+</span>&nbsp;<span class="num" id="4133436">1</span><span class="op" id="4133437">,</span>&nbsp;<span class="ident" id="4133439">To</span><span class="op" id="4133441">:</span>&nbsp;<span class="ident" id="4133443">rbrack</span><span class="op" id="4133449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133458">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133462">return</span>&nbsp;<span class="op" id="4133469">&amp;</span><span class="ident" id="4133470">ast</span><span class="op" id="4133473">.</span><span class="ident" id="4133474">SliceExpr</span><span class="op" id="4133483">{</span><span class="ident" id="4133484">X</span><span class="op" id="4133485">:</span>&nbsp;<span class="ident" id="4133487">x</span><span class="op" id="4133488">,</span>&nbsp;<span class="ident" id="4133490">Lbrack</span><span class="op" id="4133496">:</span>&nbsp;<span class="ident" id="4133498">lbrack</span><span class="op" id="4133504">,</span>&nbsp;<span class="ident" id="4133506">Low</span><span class="op" id="4133509">:</span>&nbsp;<span class="ident" id="4133511">index</span><span class="op" id="4133516">[</span><span class="num" id="4133517">0</span><span class="op" id="4133518">]</span><span class="op" id="4133519">,</span>&nbsp;<span class="ident" id="4133521">High</span><span class="op" id="4133525">:</span>&nbsp;<span class="ident" id="4133527">index</span><span class="op" id="4133532">[</span><span class="num" id="4133533">1</span><span class="op" id="4133534">]</span><span class="op" id="4133535">,</span>&nbsp;<span class="ident" id="4133537">Max</span><span class="op" id="4133540">:</span>&nbsp;<span class="ident" id="4133542">index</span><span class="op" id="4133547">[</span><span class="num" id="4133548">2</span><span class="op" id="4133549">]</span><span class="op" id="4133550">,</span>&nbsp;<span class="ident" id="4133552">Slice3</span><span class="op" id="4133558">:</span>&nbsp;<span class="ident" id="4133560">slice3</span><span class="op" id="4133566">,</span>&nbsp;<span class="ident" id="4133568">Rbrack</span><span class="op" id="4133574">:</span>&nbsp;<span class="ident" id="4133576">rbrack</span><span class="op" id="4133582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133589">return</span>&nbsp;<span class="op" id="4133596">&amp;</span><span class="ident" id="4133597">ast</span><span class="op" id="4133600">.</span><span class="ident" id="4133601">IndexExpr</span><span class="op" id="4133610">{</span><span class="ident" id="4133611">X</span><span class="op" id="4133612">:</span>&nbsp;<span class="ident" id="4133614">x</span><span class="op" id="4133615">,</span>&nbsp;<span class="ident" id="4133617">Lbrack</span><span class="op" id="4133623">:</span>&nbsp;<span class="ident" id="4133625">lbrack</span><span class="op" id="4133631">,</span>&nbsp;<span class="ident" id="4133633">Index</span><span class="op" id="4133638">:</span>&nbsp;<span class="ident" id="4133640">index</span><span class="op" id="4133645">[</span><span class="num" id="4133646">0</span><span class="op" id="4133647">]</span><span class="op" id="4133648">,</span>&nbsp;<span class="ident" id="4133650">Rbrack</span><span class="op" id="4133656">:</span>&nbsp;<span class="ident" id="4133658">rbrack</span><span class="op" id="4133664">}</span><br>
<span class="lineno"></span><span class="op" id="4133666">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="4133669">func</span>&nbsp;<span class="op" id="4133674">(</span><span class="ident" id="4133675">p</span>&nbsp;<span class="op" id="4133677">*</span><span class="ident" id="4133678">parser</span><span class="op" id="4133684">)</span>&nbsp;<span class="ident" id="4133686">parseCallOrConversion</span><span class="op" id="4133707">(</span><span class="ident" id="4133708">fun</span>&nbsp;<span class="ident" id="4133712">ast</span><span class="op" id="4133715">.</span><span class="ident" id="4133716">Expr</span><span class="op" id="4133720">)</span>&nbsp;<span class="op" id="4133722">*</span><span class="ident" id="4133723">ast</span><span class="op" id="4133726">.</span><span class="ident" id="4133727">CallExpr</span>&nbsp;<span class="op" id="4133736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133739">if</span>&nbsp;<span class="ident" id="4133742">p</span><span class="op" id="4133743">.</span><span class="ident" id="4133744">trace</span>&nbsp;<span class="op" id="4133750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133754">defer</span>&nbsp;<span class="ident" id="4133760">un</span><span class="op" id="4133762">(</span><span class="ident" id="4133763">trace</span><span class="op" id="4133768">(</span><span class="ident" id="4133769">p</span><span class="op" id="4133770">,</span>&nbsp;<span class="string" id="4133772">&#34;CallOrConversion&#34;</span><span class="op" id="4133790">)</span><span class="op" id="4133791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133794">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133798">lparen</span>&nbsp;<span class="op" id="4133805">:=</span>&nbsp;<span class="ident" id="4133808">p</span><span class="op" id="4133809">.</span><span class="ident" id="4133810">expect</span><span class="op" id="4133816">(</span><span class="ident" id="4133817">token</span><span class="op" id="4133822">.</span><span class="ident" id="4133823">LPAREN</span><span class="op" id="4133829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133832">p</span><span class="op" id="4133833">.</span><span class="ident" id="4133834">exprLev</span><span class="op" id="4133841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133845">var</span>&nbsp;<span class="ident" id="4133849">list</span>&nbsp;<span class="op" id="4133854">[</span><span class="op" id="4133855">]</span><span class="ident" id="4133856">ast</span><span class="op" id="4133859">.</span><span class="ident" id="4133860">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133866">var</span>&nbsp;<span class="ident" id="4133870">ellipsis</span>&nbsp;<span class="ident" id="4133879">token</span><span class="op" id="4133884">.</span><span class="ident" id="4133885">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133890">for</span>&nbsp;<span class="ident" id="4133894">p</span><span class="op" id="4133895">.</span><span class="ident" id="4133896">tok</span>&nbsp;<span class="op" id="4133900">!=</span>&nbsp;<span class="ident" id="4133903">token</span><span class="op" id="4133908">.</span><span class="ident" id="4133909">RPAREN</span>&nbsp;<span class="op" id="4133916">&amp;&amp;</span>&nbsp;<span class="ident" id="4133919">p</span><span class="op" id="4133920">.</span><span class="ident" id="4133921">tok</span>&nbsp;<span class="op" id="4133925">!=</span>&nbsp;<span class="ident" id="4133928">token</span><span class="op" id="4133933">.</span><span class="ident" id="4133934">EOF</span>&nbsp;<span class="op" id="4133938">&amp;&amp;</span>&nbsp;<span class="op" id="4133941">!</span><span class="ident" id="4133942">ellipsis</span><span class="op" id="4133950">.</span><span class="ident" id="4133951">IsValid</span><span class="op" id="4133958">(</span><span class="op" id="4133959">)</span>&nbsp;<span class="op" id="4133961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133965">list</span>&nbsp;<span class="op" id="4133970">=</span>&nbsp;<span class="builtinfunc" id="4133972">append</span><span class="op" id="4133978">(</span><span class="ident" id="4133979">list</span><span class="op" id="4133983">,</span>&nbsp;<span class="ident" id="4133985">p</span><span class="op" id="4133986">.</span><span class="ident" id="4133987">parseRhsOrType</span><span class="op" id="4134001">(</span><span class="op" id="4134002">)</span><span class="op" id="4134003">)</span>&nbsp;<span class="comment" id="4134005">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134059">if</span>&nbsp;<span class="ident" id="4134062">p</span><span class="op" id="4134063">.</span><span class="ident" id="4134064">tok</span>&nbsp;<span class="op" id="4134068">==</span>&nbsp;<span class="ident" id="4134071">token</span><span class="op" id="4134076">.</span><span class="ident" id="4134077">ELLIPSIS</span>&nbsp;<span class="op" id="4134086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134091">ellipsis</span>&nbsp;<span class="op" id="4134100">=</span>&nbsp;<span class="ident" id="4134102">p</span><span class="op" id="4134103">.</span><span class="ident" id="4134104">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134111">p</span><span class="op" id="4134112">.</span><span class="ident" id="4134113">next</span><span class="op" id="4134117">(</span><span class="op" id="4134118">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134126">if</span>&nbsp;<span class="op" id="4134129">!</span><span class="ident" id="4134130">p</span><span class="op" id="4134131">.</span><span class="ident" id="4134132">atComma</span><span class="op" id="4134139">(</span><span class="string" id="4134140">&#34;argument&nbsp;list&#34;</span><span class="op" id="4134155">)</span>&nbsp;<span class="op" id="4134157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134162">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134174">p</span><span class="op" id="4134175">.</span><span class="ident" id="4134176">next</span><span class="op" id="4134180">(</span><span class="op" id="4134181">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134187">p</span><span class="op" id="4134188">.</span><span class="ident" id="4134189">exprLev</span><span class="op" id="4134196">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134200">rparen</span>&nbsp;<span class="op" id="4134207">:=</span>&nbsp;<span class="ident" id="4134210">p</span><span class="op" id="4134211">.</span><span class="ident" id="4134212">expectClosing</span><span class="op" id="4134225">(</span><span class="ident" id="4134226">token</span><span class="op" id="4134231">.</span><span class="ident" id="4134232">RPAREN</span><span class="op" id="4134238">,</span>&nbsp;<span class="string" id="4134240">&#34;argument&nbsp;list&#34;</span><span class="op" id="4134255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134259">return</span>&nbsp;<span class="op" id="4134266">&amp;</span><span class="ident" id="4134267">ast</span><span class="op" id="4134270">.</span><span class="ident" id="4134271">CallExpr</span><span class="op" id="4134279">{</span><span class="ident" id="4134280">Fun</span><span class="op" id="4134283">:</span>&nbsp;<span class="ident" id="4134285">fun</span><span class="op" id="4134288">,</span>&nbsp;<span class="ident" id="4134290">Lparen</span><span class="op" id="4134296">:</span>&nbsp;<span class="ident" id="4134298">lparen</span><span class="op" id="4134304">,</span>&nbsp;<span class="ident" id="4134306">Args</span><span class="op" id="4134310">:</span>&nbsp;<span class="ident" id="4134312">list</span><span class="op" id="4134316">,</span>&nbsp;<span class="ident" id="4134318">Ellipsis</span><span class="op" id="4134326">:</span>&nbsp;<span class="ident" id="4134328">ellipsis</span><span class="op" id="4134336">,</span>&nbsp;<span class="ident" id="4134338">Rparen</span><span class="op" id="4134344">:</span>&nbsp;<span class="ident" id="4134346">rparen</span><span class="op" id="4134352">}</span><br>
<span class="lineno">1260</span><span class="op" id="4134354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4134357">func</span>&nbsp;<span class="op" id="4134362">(</span><span class="ident" id="4134363">p</span>&nbsp;<span class="op" id="4134365">*</span><span class="ident" id="4134366">parser</span><span class="op" id="4134372">)</span>&nbsp;<span class="ident" id="4134374">parseElement</span><span class="op" id="4134386">(</span><span class="ident" id="4134387">keyOk</span>&nbsp;<span class="builtintype" id="4134393">bool</span><span class="op" id="4134397">)</span>&nbsp;<span class="ident" id="4134399">ast</span><span class="op" id="4134402">.</span><span class="ident" id="4134403">Expr</span>&nbsp;<span class="op" id="4134408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134411">if</span>&nbsp;<span class="ident" id="4134414">p</span><span class="op" id="4134415">.</span><span class="ident" id="4134416">trace</span>&nbsp;<span class="op" id="4134422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134426">defer</span>&nbsp;<span class="ident" id="4134432">un</span><span class="op" id="4134434">(</span><span class="ident" id="4134435">trace</span><span class="op" id="4134440">(</span><span class="ident" id="4134441">p</span><span class="op" id="4134442">,</span>&nbsp;<span class="string" id="4134444">&#34;Element&#34;</span><span class="op" id="4134453">)</span><span class="op" id="4134454">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134461">if</span>&nbsp;<span class="ident" id="4134464">p</span><span class="op" id="4134465">.</span><span class="ident" id="4134466">tok</span>&nbsp;<span class="op" id="4134470">==</span>&nbsp;<span class="ident" id="4134473">token</span><span class="op" id="4134478">.</span><span class="ident" id="4134479">LBRACE</span>&nbsp;<span class="op" id="4134486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134490">return</span>&nbsp;<span class="ident" id="4134497">p</span><span class="op" id="4134498">.</span><span class="ident" id="4134499">parseLiteralValue</span><span class="op" id="4134516">(</span><span class="ident" id="4134517">nil</span><span class="op" id="4134520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134523">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134527">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134601">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134673">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134743">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134757">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134761">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134831">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134900">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4134971">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135039">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135106">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135110">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135176">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135249">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135322">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135395">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135424">x</span>&nbsp;<span class="op" id="4135426">:=</span>&nbsp;<span class="ident" id="4135429">p</span><span class="op" id="4135430">.</span><span class="ident" id="4135431">checkExpr</span><span class="op" id="4135440">(</span><span class="ident" id="4135441">p</span><span class="op" id="4135442">.</span><span class="ident" id="4135443">parseExpr</span><span class="op" id="4135452">(</span><span class="ident" id="4135453">keyOk</span><span class="op" id="4135458">)</span><span class="op" id="4135459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135462">if</span>&nbsp;<span class="ident" id="4135465">keyOk</span>&nbsp;<span class="op" id="4135471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135475">if</span>&nbsp;<span class="ident" id="4135478">p</span><span class="op" id="4135479">.</span><span class="ident" id="4135480">tok</span>&nbsp;<span class="op" id="4135484">==</span>&nbsp;<span class="ident" id="4135487">token</span><span class="op" id="4135492">.</span><span class="ident" id="4135493">COLON</span>&nbsp;<span class="op" id="4135499">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135504">colon</span>&nbsp;<span class="op" id="4135510">:=</span>&nbsp;<span class="ident" id="4135513">p</span><span class="op" id="4135514">.</span><span class="ident" id="4135515">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135522">p</span><span class="op" id="4135523">.</span><span class="ident" id="4135524">next</span><span class="op" id="4135528">(</span><span class="op" id="4135529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135534">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135584">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135635">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135684">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135708">p</span><span class="op" id="4135709">.</span><span class="ident" id="4135710">tryResolve</span><span class="op" id="4135720">(</span><span class="ident" id="4135721">x</span><span class="op" id="4135722">,</span>&nbsp;<span class="builtintype" id="4135724">false</span><span class="op" id="4135729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135734">return</span>&nbsp;<span class="op" id="4135741">&amp;</span><span class="ident" id="4135742">ast</span><span class="op" id="4135745">.</span><span class="ident" id="4135746">KeyValueExpr</span><span class="op" id="4135758">{</span><span class="ident" id="4135759">Key</span><span class="op" id="4135762">:</span>&nbsp;<span class="ident" id="4135764">x</span><span class="op" id="4135765">,</span>&nbsp;<span class="ident" id="4135767">Colon</span><span class="op" id="4135772">:</span>&nbsp;<span class="ident" id="4135774">colon</span><span class="op" id="4135779">,</span>&nbsp;<span class="ident" id="4135781">Value</span><span class="op" id="4135786">:</span>&nbsp;<span class="ident" id="4135788">p</span><span class="op" id="4135789">.</span><span class="ident" id="4135790">parseElement</span><span class="op" id="4135802">(</span><span class="builtintype" id="4135803">false</span><span class="op" id="4135808">)</span><span class="op" id="4135809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135817">p</span><span class="op" id="4135818">.</span><span class="ident" id="4135819">resolve</span><span class="op" id="4135826">(</span><span class="ident" id="4135827">x</span><span class="op" id="4135828">)</span>&nbsp;<span class="comment" id="4135830">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135848">return</span>&nbsp;<span class="ident" id="4135855">x</span><br>
<span class="lineno"></span><span class="op" id="4135857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="4135860">func</span>&nbsp;<span class="op" id="4135865">(</span><span class="ident" id="4135866">p</span>&nbsp;<span class="op" id="4135868">*</span><span class="ident" id="4135869">parser</span><span class="op" id="4135875">)</span>&nbsp;<span class="ident" id="4135877">parseElementList</span><span class="op" id="4135893">(</span><span class="op" id="4135894">)</span>&nbsp;<span class="op" id="4135896">(</span><span class="ident" id="4135897">list</span>&nbsp;<span class="op" id="4135902">[</span><span class="op" id="4135903">]</span><span class="ident" id="4135904">ast</span><span class="op" id="4135907">.</span><span class="ident" id="4135908">Expr</span><span class="op" id="4135912">)</span>&nbsp;<span class="op" id="4135914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135917">if</span>&nbsp;<span class="ident" id="4135920">p</span><span class="op" id="4135921">.</span><span class="ident" id="4135922">trace</span>&nbsp;<span class="op" id="4135928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135932">defer</span>&nbsp;<span class="ident" id="4135938">un</span><span class="op" id="4135940">(</span><span class="ident" id="4135941">trace</span><span class="op" id="4135946">(</span><span class="ident" id="4135947">p</span><span class="op" id="4135948">,</span>&nbsp;<span class="string" id="4135950">&#34;ElementList&#34;</span><span class="op" id="4135963">)</span><span class="op" id="4135964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135971">for</span>&nbsp;<span class="ident" id="4135975">p</span><span class="op" id="4135976">.</span><span class="ident" id="4135977">tok</span>&nbsp;<span class="op" id="4135981">!=</span>&nbsp;<span class="ident" id="4135984">token</span><span class="op" id="4135989">.</span><span class="ident" id="4135990">RBRACE</span>&nbsp;<span class="op" id="4135997">&amp;&amp;</span>&nbsp;<span class="ident" id="4136000">p</span><span class="op" id="4136001">.</span><span class="ident" id="4136002">tok</span>&nbsp;<span class="op" id="4136006">!=</span>&nbsp;<span class="ident" id="4136009">token</span><span class="op" id="4136014">.</span><span class="ident" id="4136015">EOF</span>&nbsp;<span class="op" id="4136019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136023">list</span>&nbsp;<span class="op" id="4136028">=</span>&nbsp;<span class="builtinfunc" id="4136030">append</span><span class="op" id="4136036">(</span><span class="ident" id="4136037">list</span><span class="op" id="4136041">,</span>&nbsp;<span class="ident" id="4136043">p</span><span class="op" id="4136044">.</span><span class="ident" id="4136045">parseElement</span><span class="op" id="4136057">(</span><span class="builtintype" id="4136058">true</span><span class="op" id="4136062">)</span><span class="op" id="4136063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136067">if</span>&nbsp;<span class="op" id="4136070">!</span><span class="ident" id="4136071">p</span><span class="op" id="4136072">.</span><span class="ident" id="4136073">atComma</span><span class="op" id="4136080">(</span><span class="string" id="4136081">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4136100">)</span>&nbsp;<span class="op" id="4136102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136107">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136115">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136119">p</span><span class="op" id="4136120">.</span><span class="ident" id="4136121">next</span><span class="op" id="4136125">(</span><span class="op" id="4136126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136133">return</span><br>
<span class="lineno"></span><span class="op" id="4136140">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="4136143">func</span>&nbsp;<span class="op" id="4136148">(</span><span class="ident" id="4136149">p</span>&nbsp;<span class="op" id="4136151">*</span><span class="ident" id="4136152">parser</span><span class="op" id="4136158">)</span>&nbsp;<span class="ident" id="4136160">parseLiteralValue</span><span class="op" id="4136177">(</span><span class="ident" id="4136178">typ</span>&nbsp;<span class="ident" id="4136182">ast</span><span class="op" id="4136185">.</span><span class="ident" id="4136186">Expr</span><span class="op" id="4136190">)</span>&nbsp;<span class="ident" id="4136192">ast</span><span class="op" id="4136195">.</span><span class="ident" id="4136196">Expr</span>&nbsp;<span class="op" id="4136201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136204">if</span>&nbsp;<span class="ident" id="4136207">p</span><span class="op" id="4136208">.</span><span class="ident" id="4136209">trace</span>&nbsp;<span class="op" id="4136215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136219">defer</span>&nbsp;<span class="ident" id="4136225">un</span><span class="op" id="4136227">(</span><span class="ident" id="4136228">trace</span><span class="op" id="4136233">(</span><span class="ident" id="4136234">p</span><span class="op" id="4136235">,</span>&nbsp;<span class="string" id="4136237">&#34;LiteralValue&#34;</span><span class="op" id="4136251">)</span><span class="op" id="4136252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136255">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136259">lbrace</span>&nbsp;<span class="op" id="4136266">:=</span>&nbsp;<span class="ident" id="4136269">p</span><span class="op" id="4136270">.</span><span class="ident" id="4136271">expect</span><span class="op" id="4136277">(</span><span class="ident" id="4136278">token</span><span class="op" id="4136283">.</span><span class="ident" id="4136284">LBRACE</span><span class="op" id="4136290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136293">var</span>&nbsp;<span class="ident" id="4136297">elts</span>&nbsp;<span class="op" id="4136302">[</span><span class="op" id="4136303">]</span><span class="ident" id="4136304">ast</span><span class="op" id="4136307">.</span><span class="ident" id="4136308">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136314">p</span><span class="op" id="4136315">.</span><span class="ident" id="4136316">exprLev</span><span class="op" id="4136323">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136327">if</span>&nbsp;<span class="ident" id="4136330">p</span><span class="op" id="4136331">.</span><span class="ident" id="4136332">tok</span>&nbsp;<span class="op" id="4136336">!=</span>&nbsp;<span class="ident" id="4136339">token</span><span class="op" id="4136344">.</span><span class="ident" id="4136345">RBRACE</span>&nbsp;<span class="op" id="4136352">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136356">elts</span>&nbsp;<span class="op" id="4136361">=</span>&nbsp;<span class="ident" id="4136363">p</span><span class="op" id="4136364">.</span><span class="ident" id="4136365">parseElementList</span><span class="op" id="4136381">(</span><span class="op" id="4136382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136388">p</span><span class="op" id="4136389">.</span><span class="ident" id="4136390">exprLev</span><span class="op" id="4136397">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136401">rbrace</span>&nbsp;<span class="op" id="4136408">:=</span>&nbsp;<span class="ident" id="4136411">p</span><span class="op" id="4136412">.</span><span class="ident" id="4136413">expectClosing</span><span class="op" id="4136426">(</span><span class="ident" id="4136427">token</span><span class="op" id="4136432">.</span><span class="ident" id="4136433">RBRACE</span><span class="op" id="4136439">,</span>&nbsp;<span class="string" id="4136441">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4136460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136463">return</span>&nbsp;<span class="op" id="4136470">&amp;</span><span class="ident" id="4136471">ast</span><span class="op" id="4136474">.</span><span class="ident" id="4136475">CompositeLit</span><span class="op" id="4136487">{</span><span class="ident" id="4136488">Type</span><span class="op" id="4136492">:</span>&nbsp;<span class="ident" id="4136494">typ</span><span class="op" id="4136497">,</span>&nbsp;<span class="ident" id="4136499">Lbrace</span><span class="op" id="4136505">:</span>&nbsp;<span class="ident" id="4136507">lbrace</span><span class="op" id="4136513">,</span>&nbsp;<span class="ident" id="4136515">Elts</span><span class="op" id="4136519">:</span>&nbsp;<span class="ident" id="4136521">elts</span><span class="op" id="4136525">,</span>&nbsp;<span class="ident" id="4136527">Rbrace</span><span class="op" id="4136533">:</span>&nbsp;<span class="ident" id="4136535">rbrace</span><span class="op" id="4136541">}</span><br>
<span class="lineno">1335</span><span class="op" id="4136543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136546">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="4136608">func</span>&nbsp;<span class="op" id="4136613">(</span><span class="ident" id="4136614">p</span>&nbsp;<span class="op" id="4136616">*</span><span class="ident" id="4136617">parser</span><span class="op" id="4136623">)</span>&nbsp;<span class="ident" id="4136625">checkExpr</span><span class="op" id="4136634">(</span><span class="ident" id="4136635">x</span>&nbsp;<span class="ident" id="4136637">ast</span><span class="op" id="4136640">.</span><span class="ident" id="4136641">Expr</span><span class="op" id="4136645">)</span>&nbsp;<span class="ident" id="4136647">ast</span><span class="op" id="4136650">.</span><span class="ident" id="4136651">Expr</span>&nbsp;<span class="op" id="4136656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136659">switch</span>&nbsp;<span class="ident" id="4136666">unparen</span><span class="op" id="4136673">(</span><span class="ident" id="4136674">x</span><span class="op" id="4136675">)</span><span class="op" id="4136676">.</span><span class="op" id="4136677">(</span><span class="keyword" id="4136678">type</span><span class="op" id="4136682">)</span>&nbsp;<span class="op" id="4136684">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136687">case</span>&nbsp;<span class="op" id="4136692">*</span><span class="ident" id="4136693">ast</span><span class="op" id="4136696">.</span><span class="ident" id="4136697">BadExpr</span><span class="op" id="4136704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136707">case</span>&nbsp;<span class="op" id="4136712">*</span><span class="ident" id="4136713">ast</span><span class="op" id="4136716">.</span><span class="ident" id="4136717">Ident</span><span class="op" id="4136722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136725">case</span>&nbsp;<span class="op" id="4136730">*</span><span class="ident" id="4136731">ast</span><span class="op" id="4136734">.</span><span class="ident" id="4136735">BasicLit</span><span class="op" id="4136743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136746">case</span>&nbsp;<span class="op" id="4136751">*</span><span class="ident" id="4136752">ast</span><span class="op" id="4136755">.</span><span class="ident" id="4136756">FuncLit</span><span class="op" id="4136763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136766">case</span>&nbsp;<span class="op" id="4136771">*</span><span class="ident" id="4136772">ast</span><span class="op" id="4136775">.</span><span class="ident" id="4136776">CompositeLit</span><span class="op" id="4136788">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136791">case</span>&nbsp;<span class="op" id="4136796">*</span><span class="ident" id="4136797">ast</span><span class="op" id="4136800">.</span><span class="ident" id="4136801">ParenExpr</span><span class="op" id="4136810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4136814">panic</span><span class="op" id="4136819">(</span><span class="string" id="4136820">&#34;unreachable&#34;</span><span class="op" id="4136833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136836">case</span>&nbsp;<span class="op" id="4136841">*</span><span class="ident" id="4136842">ast</span><span class="op" id="4136845">.</span><span class="ident" id="4136846">SelectorExpr</span><span class="op" id="4136858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136861">case</span>&nbsp;<span class="op" id="4136866">*</span><span class="ident" id="4136867">ast</span><span class="op" id="4136870">.</span><span class="ident" id="4136871">IndexExpr</span><span class="op" id="4136880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136883">case</span>&nbsp;<span class="op" id="4136888">*</span><span class="ident" id="4136889">ast</span><span class="op" id="4136892">.</span><span class="ident" id="4136893">SliceExpr</span><span class="op" id="4136902">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136905">case</span>&nbsp;<span class="op" id="4136910">*</span><span class="ident" id="4136911">ast</span><span class="op" id="4136914">.</span><span class="ident" id="4136915">TypeAssertExpr</span><span class="op" id="4136929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136933">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136992">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137057">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137122">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137187">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137200">case</span>&nbsp;<span class="op" id="4137205">*</span><span class="ident" id="4137206">ast</span><span class="op" id="4137209">.</span><span class="ident" id="4137210">CallExpr</span><span class="op" id="4137218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137221">case</span>&nbsp;<span class="op" id="4137226">*</span><span class="ident" id="4137227">ast</span><span class="op" id="4137230">.</span><span class="ident" id="4137231">StarExpr</span><span class="op" id="4137239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137242">case</span>&nbsp;<span class="op" id="4137247">*</span><span class="ident" id="4137248">ast</span><span class="op" id="4137251">.</span><span class="ident" id="4137252">UnaryExpr</span><span class="op" id="4137261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137264">case</span>&nbsp;<span class="op" id="4137269">*</span><span class="ident" id="4137270">ast</span><span class="op" id="4137273">.</span><span class="ident" id="4137274">BinaryExpr</span><span class="op" id="4137284">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137287">default</span><span class="op" id="4137294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4137298">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137346">p</span><span class="op" id="4137347">.</span><span class="ident" id="4137348">errorExpected</span><span class="op" id="4137361">(</span><span class="ident" id="4137362">x</span><span class="op" id="4137363">.</span><span class="ident" id="4137364">Pos</span><span class="op" id="4137367">(</span><span class="op" id="4137368">)</span><span class="op" id="4137369">,</span>&nbsp;<span class="string" id="4137371">&#34;expression&#34;</span><span class="op" id="4137383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137387">x</span>&nbsp;<span class="op" id="4137389">=</span>&nbsp;<span class="op" id="4137391">&amp;</span><span class="ident" id="4137392">ast</span><span class="op" id="4137395">.</span><span class="ident" id="4137396">BadExpr</span><span class="op" id="4137403">{</span><span class="ident" id="4137404">From</span><span class="op" id="4137408">:</span>&nbsp;<span class="ident" id="4137410">x</span><span class="op" id="4137411">.</span><span class="ident" id="4137412">Pos</span><span class="op" id="4137415">(</span><span class="op" id="4137416">)</span><span class="op" id="4137417">,</span>&nbsp;<span class="ident" id="4137419">To</span><span class="op" id="4137421">:</span>&nbsp;<span class="ident" id="4137423">p</span><span class="op" id="4137424">.</span><span class="ident" id="4137425">safePos</span><span class="op" id="4137432">(</span><span class="ident" id="4137433">x</span><span class="op" id="4137434">.</span><span class="ident" id="4137435">End</span><span class="op" id="4137438">(</span><span class="op" id="4137439">)</span><span class="op" id="4137440">)</span><span class="op" id="4137441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137444">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137447">return</span>&nbsp;<span class="ident" id="4137454">x</span><br>
<span class="lineno"></span><span class="op" id="4137456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4137459">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="4137519">func</span>&nbsp;<span class="ident" id="4137524">isTypeName</span><span class="op" id="4137534">(</span><span class="ident" id="4137535">x</span>&nbsp;<span class="ident" id="4137537">ast</span><span class="op" id="4137540">.</span><span class="ident" id="4137541">Expr</span><span class="op" id="4137545">)</span>&nbsp;<span class="builtintype" id="4137547">bool</span>&nbsp;<span class="op" id="4137552">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137555">switch</span>&nbsp;<span class="ident" id="4137562">t</span>&nbsp;<span class="op" id="4137564">:=</span>&nbsp;<span class="ident" id="4137567">x</span><span class="op" id="4137568">.</span><span class="op" id="4137569">(</span><span class="keyword" id="4137570">type</span><span class="op" id="4137574">)</span>&nbsp;<span class="op" id="4137576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137579">case</span>&nbsp;<span class="op" id="4137584">*</span><span class="ident" id="4137585">ast</span><span class="op" id="4137588">.</span><span class="ident" id="4137589">BadExpr</span><span class="op" id="4137596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137599">case</span>&nbsp;<span class="op" id="4137604">*</span><span class="ident" id="4137605">ast</span><span class="op" id="4137608">.</span><span class="ident" id="4137609">Ident</span><span class="op" id="4137614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137617">case</span>&nbsp;<span class="op" id="4137622">*</span><span class="ident" id="4137623">ast</span><span class="op" id="4137626">.</span><span class="ident" id="4137627">SelectorExpr</span><span class="op" id="4137639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137643">_</span><span class="op" id="4137644">,</span>&nbsp;<span class="ident" id="4137646">isIdent</span>&nbsp;<span class="op" id="4137654">:=</span>&nbsp;<span class="ident" id="4137657">t</span><span class="op" id="4137658">.</span><span class="ident" id="4137659">X</span><span class="op" id="4137660">.</span><span class="op" id="4137661">(</span><span class="op" id="4137662">*</span><span class="ident" id="4137663">ast</span><span class="op" id="4137666">.</span><span class="ident" id="4137667">Ident</span><span class="op" id="4137672">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137676">return</span>&nbsp;<span class="ident" id="4137683">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137692">default</span><span class="op" id="4137699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137703">return</span>&nbsp;<span class="builtintype" id="4137710">false</span>&nbsp;<span class="comment" id="4137716">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137758">return</span>&nbsp;<span class="builtintype" id="4137765">true</span><br>
<span class="lineno">1380</span><span class="op" id="4137770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4137773">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4137844">func</span>&nbsp;<span class="ident" id="4137849">isLiteralType</span><span class="op" id="4137862">(</span><span class="ident" id="4137863">x</span>&nbsp;<span class="ident" id="4137865">ast</span><span class="op" id="4137868">.</span><span class="ident" id="4137869">Expr</span><span class="op" id="4137873">)</span>&nbsp;<span class="builtintype" id="4137875">bool</span>&nbsp;<span class="op" id="4137880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137883">switch</span>&nbsp;<span class="ident" id="4137890">t</span>&nbsp;<span class="op" id="4137892">:=</span>&nbsp;<span class="ident" id="4137895">x</span><span class="op" id="4137896">.</span><span class="op" id="4137897">(</span><span class="keyword" id="4137898">type</span><span class="op" id="4137902">)</span>&nbsp;<span class="op" id="4137904">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137907">case</span>&nbsp;<span class="op" id="4137912">*</span><span class="ident" id="4137913">ast</span><span class="op" id="4137916">.</span><span class="ident" id="4137917">BadExpr</span><span class="op" id="4137924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137927">case</span>&nbsp;<span class="op" id="4137932">*</span><span class="ident" id="4137933">ast</span><span class="op" id="4137936">.</span><span class="ident" id="4137937">Ident</span><span class="op" id="4137942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137945">case</span>&nbsp;<span class="op" id="4137950">*</span><span class="ident" id="4137951">ast</span><span class="op" id="4137954">.</span><span class="ident" id="4137955">SelectorExpr</span><span class="op" id="4137967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137971">_</span><span class="op" id="4137972">,</span>&nbsp;<span class="ident" id="4137974">isIdent</span>&nbsp;<span class="op" id="4137982">:=</span>&nbsp;<span class="ident" id="4137985">t</span><span class="op" id="4137986">.</span><span class="ident" id="4137987">X</span><span class="op" id="4137988">.</span><span class="op" id="4137989">(</span><span class="op" id="4137990">*</span><span class="ident" id="4137991">ast</span><span class="op" id="4137994">.</span><span class="ident" id="4137995">Ident</span><span class="op" id="4138000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138004">return</span>&nbsp;<span class="ident" id="4138011">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138020">case</span>&nbsp;<span class="op" id="4138025">*</span><span class="ident" id="4138026">ast</span><span class="op" id="4138029">.</span><span class="ident" id="4138030">ArrayType</span><span class="op" id="4138039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138042">case</span>&nbsp;<span class="op" id="4138047">*</span><span class="ident" id="4138048">ast</span><span class="op" id="4138051">.</span><span class="ident" id="4138052">StructType</span><span class="op" id="4138062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138065">case</span>&nbsp;<span class="op" id="4138070">*</span><span class="ident" id="4138071">ast</span><span class="op" id="4138074">.</span><span class="ident" id="4138075">MapType</span><span class="op" id="4138082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138085">default</span><span class="op" id="4138092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138096">return</span>&nbsp;<span class="builtintype" id="4138103">false</span>&nbsp;<span class="comment" id="4138109">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138170">return</span>&nbsp;<span class="builtintype" id="4138177">true</span><br>
<span class="lineno"></span><span class="op" id="4138182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4138185">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="4138253">func</span>&nbsp;<span class="ident" id="4138258">deref</span><span class="op" id="4138263">(</span><span class="ident" id="4138264">x</span>&nbsp;<span class="ident" id="4138266">ast</span><span class="op" id="4138269">.</span><span class="ident" id="4138270">Expr</span><span class="op" id="4138274">)</span>&nbsp;<span class="ident" id="4138276">ast</span><span class="op" id="4138279">.</span><span class="ident" id="4138280">Expr</span>&nbsp;<span class="op" id="4138285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138288">if</span>&nbsp;<span class="ident" id="4138291">p</span><span class="op" id="4138292">,</span>&nbsp;<span class="ident" id="4138294">isPtr</span>&nbsp;<span class="op" id="4138300">:=</span>&nbsp;<span class="ident" id="4138303">x</span><span class="op" id="4138304">.</span><span class="op" id="4138305">(</span><span class="op" id="4138306">*</span><span class="ident" id="4138307">ast</span><span class="op" id="4138310">.</span><span class="ident" id="4138311">StarExpr</span><span class="op" id="4138319">)</span><span class="op" id="4138320">;</span>&nbsp;<span class="ident" id="4138322">isPtr</span>&nbsp;<span class="op" id="4138328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138332">x</span>&nbsp;<span class="op" id="4138334">=</span>&nbsp;<span class="ident" id="4138336">p</span><span class="op" id="4138337">.</span><span class="ident" id="4138338">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138344">return</span>&nbsp;<span class="ident" id="4138351">x</span><br>
<span class="lineno">1405</span><span class="op" id="4138353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4138356">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4138436">func</span>&nbsp;<span class="ident" id="4138441">unparen</span><span class="op" id="4138448">(</span><span class="ident" id="4138449">x</span>&nbsp;<span class="ident" id="4138451">ast</span><span class="op" id="4138454">.</span><span class="ident" id="4138455">Expr</span><span class="op" id="4138459">)</span>&nbsp;<span class="ident" id="4138461">ast</span><span class="op" id="4138464">.</span><span class="ident" id="4138465">Expr</span>&nbsp;<span class="op" id="4138470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138473">if</span>&nbsp;<span class="ident" id="4138476">p</span><span class="op" id="4138477">,</span>&nbsp;<span class="ident" id="4138479">isParen</span>&nbsp;<span class="op" id="4138487">:=</span>&nbsp;<span class="ident" id="4138490">x</span><span class="op" id="4138491">.</span><span class="op" id="4138492">(</span><span class="op" id="4138493">*</span><span class="ident" id="4138494">ast</span><span class="op" id="4138497">.</span><span class="ident" id="4138498">ParenExpr</span><span class="op" id="4138507">)</span><span class="op" id="4138508">;</span>&nbsp;<span class="ident" id="4138510">isParen</span>&nbsp;<span class="op" id="4138518">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138522">x</span>&nbsp;<span class="op" id="4138524">=</span>&nbsp;<span class="ident" id="4138526">unparen</span><span class="op" id="4138533">(</span><span class="ident" id="4138534">p</span><span class="op" id="4138535">.</span><span class="ident" id="4138536">X</span><span class="op" id="4138537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138543">return</span>&nbsp;<span class="ident" id="4138550">x</span><br>
<span class="lineno"></span><span class="op" id="4138552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="4138555">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4138615">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="4138655">//</span><br>
<span class="lineno"></span><span class="keyword" id="4138658">func</span>&nbsp;<span class="op" id="4138663">(</span><span class="ident" id="4138664">p</span>&nbsp;<span class="op" id="4138666">*</span><span class="ident" id="4138667">parser</span><span class="op" id="4138673">)</span>&nbsp;<span class="ident" id="4138675">checkExprOrType</span><span class="op" id="4138690">(</span><span class="ident" id="4138691">x</span>&nbsp;<span class="ident" id="4138693">ast</span><span class="op" id="4138696">.</span><span class="ident" id="4138697">Expr</span><span class="op" id="4138701">)</span>&nbsp;<span class="ident" id="4138703">ast</span><span class="op" id="4138706">.</span><span class="ident" id="4138707">Expr</span>&nbsp;<span class="op" id="4138712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138715">switch</span>&nbsp;<span class="ident" id="4138722">t</span>&nbsp;<span class="op" id="4138724">:=</span>&nbsp;<span class="ident" id="4138727">unparen</span><span class="op" id="4138734">(</span><span class="ident" id="4138735">x</span><span class="op" id="4138736">)</span><span class="op" id="4138737">.</span><span class="op" id="4138738">(</span><span class="keyword" id="4138739">type</span><span class="op" id="4138743">)</span>&nbsp;<span class="op" id="4138745">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138748">case</span>&nbsp;<span class="op" id="4138753">*</span><span class="ident" id="4138754">ast</span><span class="op" id="4138757">.</span><span class="ident" id="4138758">ParenExpr</span><span class="op" id="4138767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4138771">panic</span><span class="op" id="4138776">(</span><span class="string" id="4138777">&#34;unreachable&#34;</span><span class="op" id="4138790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138793">case</span>&nbsp;<span class="op" id="4138798">*</span><span class="ident" id="4138799">ast</span><span class="op" id="4138802">.</span><span class="ident" id="4138803">UnaryExpr</span><span class="op" id="4138812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138815">case</span>&nbsp;<span class="op" id="4138820">*</span><span class="ident" id="4138821">ast</span><span class="op" id="4138824">.</span><span class="ident" id="4138825">ArrayType</span><span class="op" id="4138834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138838">if</span>&nbsp;<span class="builtinfunc" id="4138841">len</span><span class="op" id="4138844">,</span>&nbsp;<span class="ident" id="4138846">isEllipsis</span>&nbsp;<span class="op" id="4138857">:=</span>&nbsp;<span class="ident" id="4138860">t</span><span class="op" id="4138861">.</span><span class="ident" id="4138862">Len</span><span class="op" id="4138865">.</span><span class="op" id="4138866">(</span><span class="op" id="4138867">*</span><span class="ident" id="4138868">ast</span><span class="op" id="4138871">.</span><span class="ident" id="4138872">Ellipsis</span><span class="op" id="4138880">)</span><span class="op" id="4138881">;</span>&nbsp;<span class="ident" id="4138883">isEllipsis</span>&nbsp;<span class="op" id="4138894">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138899">p</span><span class="op" id="4138900">.</span><span class="builtintype" id="4138901">error</span><span class="op" id="4138906">(</span><span class="builtinfunc" id="4138907">len</span><span class="op" id="4138910">.</span><span class="ident" id="4138911">Pos</span><span class="op" id="4138914">(</span><span class="op" id="4138915">)</span><span class="op" id="4138916">,</span>&nbsp;<span class="string" id="4138918">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="4138954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138959">x</span>&nbsp;<span class="op" id="4138961">=</span>&nbsp;<span class="op" id="4138963">&amp;</span><span class="ident" id="4138964">ast</span><span class="op" id="4138967">.</span><span class="ident" id="4138968">BadExpr</span><span class="op" id="4138975">{</span><span class="ident" id="4138976">From</span><span class="op" id="4138980">:</span>&nbsp;<span class="ident" id="4138982">x</span><span class="op" id="4138983">.</span><span class="ident" id="4138984">Pos</span><span class="op" id="4138987">(</span><span class="op" id="4138988">)</span><span class="op" id="4138989">,</span>&nbsp;<span class="ident" id="4138991">To</span><span class="op" id="4138993">:</span>&nbsp;<span class="ident" id="4138995">p</span><span class="op" id="4138996">.</span><span class="ident" id="4138997">safePos</span><span class="op" id="4139004">(</span><span class="ident" id="4139005">x</span><span class="op" id="4139006">.</span><span class="ident" id="4139007">End</span><span class="op" id="4139010">(</span><span class="op" id="4139011">)</span><span class="op" id="4139012">)</span><span class="op" id="4139013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139024">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139069">return</span>&nbsp;<span class="ident" id="4139076">x</span><br>
<span class="lineno"></span><span class="op" id="4139078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4139081">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="4139151">func</span>&nbsp;<span class="op" id="4139156">(</span><span class="ident" id="4139157">p</span>&nbsp;<span class="op" id="4139159">*</span><span class="ident" id="4139160">parser</span><span class="op" id="4139166">)</span>&nbsp;<span class="ident" id="4139168">parsePrimaryExpr</span><span class="op" id="4139184">(</span><span class="ident" id="4139185">lhs</span>&nbsp;<span class="builtintype" id="4139189">bool</span><span class="op" id="4139193">)</span>&nbsp;<span class="ident" id="4139195">ast</span><span class="op" id="4139198">.</span><span class="ident" id="4139199">Expr</span>&nbsp;<span class="op" id="4139204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139207">if</span>&nbsp;<span class="ident" id="4139210">p</span><span class="op" id="4139211">.</span><span class="ident" id="4139212">trace</span>&nbsp;<span class="op" id="4139218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139222">defer</span>&nbsp;<span class="ident" id="4139228">un</span><span class="op" id="4139230">(</span><span class="ident" id="4139231">trace</span><span class="op" id="4139236">(</span><span class="ident" id="4139237">p</span><span class="op" id="4139238">,</span>&nbsp;<span class="string" id="4139240">&#34;PrimaryExpr&#34;</span><span class="op" id="4139253">)</span><span class="op" id="4139254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139261">x</span>&nbsp;<span class="op" id="4139263">:=</span>&nbsp;<span class="ident" id="4139266">p</span><span class="op" id="4139267">.</span><span class="ident" id="4139268">parseOperand</span><span class="op" id="4139280">(</span><span class="ident" id="4139281">lhs</span><span class="op" id="4139284">)</span><br>
<span class="lineno"></span><span class="ident" id="4139286">L</span><span class="op" id="4139287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139290">for</span>&nbsp;<span class="op" id="4139294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139298">switch</span>&nbsp;<span class="ident" id="4139305">p</span><span class="op" id="4139306">.</span><span class="ident" id="4139307">tok</span>&nbsp;<span class="op" id="4139311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139315">case</span>&nbsp;<span class="ident" id="4139320">token</span><span class="op" id="4139325">.</span><span class="ident" id="4139326">PERIOD</span><span class="op" id="4139332">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139337">p</span><span class="op" id="4139338">.</span><span class="ident" id="4139339">next</span><span class="op" id="4139343">(</span><span class="op" id="4139344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139349">if</span>&nbsp;<span class="ident" id="4139352">lhs</span>&nbsp;<span class="op" id="4139356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139362">p</span><span class="op" id="4139363">.</span><span class="ident" id="4139364">resolve</span><span class="op" id="4139371">(</span><span class="ident" id="4139372">x</span><span class="op" id="4139373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139383">switch</span>&nbsp;<span class="ident" id="4139390">p</span><span class="op" id="4139391">.</span><span class="ident" id="4139392">tok</span>&nbsp;<span class="op" id="4139396">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139401">case</span>&nbsp;<span class="ident" id="4139406">token</span><span class="op" id="4139411">.</span><span class="ident" id="4139412">IDENT</span><span class="op" id="4139417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139423">x</span>&nbsp;<span class="op" id="4139425">=</span>&nbsp;<span class="ident" id="4139427">p</span><span class="op" id="4139428">.</span><span class="ident" id="4139429">parseSelector</span><span class="op" id="4139442">(</span><span class="ident" id="4139443">p</span><span class="op" id="4139444">.</span><span class="ident" id="4139445">checkExprOrType</span><span class="op" id="4139460">(</span><span class="ident" id="4139461">x</span><span class="op" id="4139462">)</span><span class="op" id="4139463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139468">case</span>&nbsp;<span class="ident" id="4139473">token</span><span class="op" id="4139478">.</span><span class="ident" id="4139479">LPAREN</span><span class="op" id="4139485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139491">x</span>&nbsp;<span class="op" id="4139493">=</span>&nbsp;<span class="ident" id="4139495">p</span><span class="op" id="4139496">.</span><span class="ident" id="4139497">parseTypeAssertion</span><span class="op" id="4139515">(</span><span class="ident" id="4139516">p</span><span class="op" id="4139517">.</span><span class="ident" id="4139518">checkExpr</span><span class="op" id="4139527">(</span><span class="ident" id="4139528">x</span><span class="op" id="4139529">)</span><span class="op" id="4139530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139535">default</span><span class="op" id="4139542">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139548">pos</span>&nbsp;<span class="op" id="4139552">:=</span>&nbsp;<span class="ident" id="4139555">p</span><span class="op" id="4139556">.</span><span class="ident" id="4139557">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139565">p</span><span class="op" id="4139566">.</span><span class="ident" id="4139567">errorExpected</span><span class="op" id="4139580">(</span><span class="ident" id="4139581">pos</span><span class="op" id="4139584">,</span>&nbsp;<span class="string" id="4139586">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="4139614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139620">p</span><span class="op" id="4139621">.</span><span class="ident" id="4139622">next</span><span class="op" id="4139626">(</span><span class="op" id="4139627">)</span>&nbsp;<span class="comment" id="4139629">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139650">x</span>&nbsp;<span class="op" id="4139652">=</span>&nbsp;<span class="op" id="4139654">&amp;</span><span class="ident" id="4139655">ast</span><span class="op" id="4139658">.</span><span class="ident" id="4139659">BadExpr</span><span class="op" id="4139666">{</span><span class="ident" id="4139667">From</span><span class="op" id="4139671">:</span>&nbsp;<span class="ident" id="4139673">pos</span><span class="op" id="4139676">,</span>&nbsp;<span class="ident" id="4139678">To</span><span class="op" id="4139680">:</span>&nbsp;<span class="ident" id="4139682">p</span><span class="op" id="4139683">.</span><span class="ident" id="4139684">pos</span><span class="op" id="4139687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139692">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139696">case</span>&nbsp;<span class="ident" id="4139701">token</span><span class="op" id="4139706">.</span><span class="ident" id="4139707">LBRACK</span><span class="op" id="4139713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139718">if</span>&nbsp;<span class="ident" id="4139721">lhs</span>&nbsp;<span class="op" id="4139725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139731">p</span><span class="op" id="4139732">.</span><span class="ident" id="4139733">resolve</span><span class="op" id="4139740">(</span><span class="ident" id="4139741">x</span><span class="op" id="4139742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139752">x</span>&nbsp;<span class="op" id="4139754">=</span>&nbsp;<span class="ident" id="4139756">p</span><span class="op" id="4139757">.</span><span class="ident" id="4139758">parseIndexOrSlice</span><span class="op" id="4139775">(</span><span class="ident" id="4139776">p</span><span class="op" id="4139777">.</span><span class="ident" id="4139778">checkExpr</span><span class="op" id="4139787">(</span><span class="ident" id="4139788">x</span><span class="op" id="4139789">)</span><span class="op" id="4139790">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139794">case</span>&nbsp;<span class="ident" id="4139799">token</span><span class="op" id="4139804">.</span><span class="ident" id="4139805">LPAREN</span><span class="op" id="4139811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139816">if</span>&nbsp;<span class="ident" id="4139819">lhs</span>&nbsp;<span class="op" id="4139823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139829">p</span><span class="op" id="4139830">.</span><span class="ident" id="4139831">resolve</span><span class="op" id="4139838">(</span><span class="ident" id="4139839">x</span><span class="op" id="4139840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139850">x</span>&nbsp;<span class="op" id="4139852">=</span>&nbsp;<span class="ident" id="4139854">p</span><span class="op" id="4139855">.</span><span class="ident" id="4139856">parseCallOrConversion</span><span class="op" id="4139877">(</span><span class="ident" id="4139878">p</span><span class="op" id="4139879">.</span><span class="ident" id="4139880">checkExprOrType</span><span class="op" id="4139895">(</span><span class="ident" id="4139896">x</span><span class="op" id="4139897">)</span><span class="op" id="4139898">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139902">case</span>&nbsp;<span class="ident" id="4139907">token</span><span class="op" id="4139912">.</span><span class="ident" id="4139913">LBRACE</span><span class="op" id="4139919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139924">if</span>&nbsp;<span class="ident" id="4139927">isLiteralType</span><span class="op" id="4139940">(</span><span class="ident" id="4139941">x</span><span class="op" id="4139942">)</span>&nbsp;<span class="op" id="4139944">&amp;&amp;</span>&nbsp;<span class="op" id="4139947">(</span><span class="ident" id="4139948">p</span><span class="op" id="4139949">.</span><span class="ident" id="4139950">exprLev</span>&nbsp;<span class="op" id="4139958">&gt;=</span>&nbsp;<span class="num" id="4139961">0</span>&nbsp;<span class="op" id="4139963">||</span>&nbsp;<span class="op" id="4139966">!</span><span class="ident" id="4139967">isTypeName</span><span class="op" id="4139977">(</span><span class="ident" id="4139978">x</span><span class="op" id="4139979">)</span><span class="op" id="4139980">)</span>&nbsp;<span class="op" id="4139982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139988">if</span>&nbsp;<span class="ident" id="4139991">lhs</span>&nbsp;<span class="op" id="4139995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140002">p</span><span class="op" id="4140003">.</span><span class="ident" id="4140004">resolve</span><span class="op" id="4140011">(</span><span class="ident" id="4140012">x</span><span class="op" id="4140013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140019">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140025">x</span>&nbsp;<span class="op" id="4140027">=</span>&nbsp;<span class="ident" id="4140029">p</span><span class="op" id="4140030">.</span><span class="ident" id="4140031">parseLiteralValue</span><span class="op" id="4140048">(</span><span class="ident" id="4140049">x</span><span class="op" id="4140050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140055">}</span>&nbsp;<span class="keyword" id="4140057">else</span>&nbsp;<span class="op" id="4140062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140068">break</span>&nbsp;<span class="ident" id="4140074">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140083">default</span><span class="op" id="4140090">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140095">break</span>&nbsp;<span class="ident" id="4140101">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140109">lhs</span>&nbsp;<span class="op" id="4140113">=</span>&nbsp;<span class="builtintype" id="4140115">false</span>&nbsp;<span class="comment" id="4140121">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140161">return</span>&nbsp;<span class="ident" id="4140168">x</span><br>
<span class="lineno"></span><span class="op" id="4140170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4140173">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4140243">func</span>&nbsp;<span class="op" id="4140248">(</span><span class="ident" id="4140249">p</span>&nbsp;<span class="op" id="4140251">*</span><span class="ident" id="4140252">parser</span><span class="op" id="4140258">)</span>&nbsp;<span class="ident" id="4140260">parseUnaryExpr</span><span class="op" id="4140274">(</span><span class="ident" id="4140275">lhs</span>&nbsp;<span class="builtintype" id="4140279">bool</span><span class="op" id="4140283">)</span>&nbsp;<span class="ident" id="4140285">ast</span><span class="op" id="4140288">.</span><span class="ident" id="4140289">Expr</span>&nbsp;<span class="op" id="4140294">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140297">if</span>&nbsp;<span class="ident" id="4140300">p</span><span class="op" id="4140301">.</span><span class="ident" id="4140302">trace</span>&nbsp;<span class="op" id="4140308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140312">defer</span>&nbsp;<span class="ident" id="4140318">un</span><span class="op" id="4140320">(</span><span class="ident" id="4140321">trace</span><span class="op" id="4140326">(</span><span class="ident" id="4140327">p</span><span class="op" id="4140328">,</span>&nbsp;<span class="string" id="4140330">&#34;UnaryExpr&#34;</span><span class="op" id="4140341">)</span><span class="op" id="4140342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140349">switch</span>&nbsp;<span class="ident" id="4140356">p</span><span class="op" id="4140357">.</span><span class="ident" id="4140358">tok</span>&nbsp;<span class="op" id="4140362">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140365">case</span>&nbsp;<span class="ident" id="4140370">token</span><span class="op" id="4140375">.</span><span class="ident" id="4140376">ADD</span><span class="op" id="4140379">,</span>&nbsp;<span class="ident" id="4140381">token</span><span class="op" id="4140386">.</span><span class="ident" id="4140387">SUB</span><span class="op" id="4140390">,</span>&nbsp;<span class="ident" id="4140392">token</span><span class="op" id="4140397">.</span><span class="ident" id="4140398">NOT</span><span class="op" id="4140401">,</span>&nbsp;<span class="ident" id="4140403">token</span><span class="op" id="4140408">.</span><span class="ident" id="4140409">XOR</span><span class="op" id="4140412">,</span>&nbsp;<span class="ident" id="4140414">token</span><span class="op" id="4140419">.</span><span class="ident" id="4140420">AND</span><span class="op" id="4140423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140427">pos</span><span class="op" id="4140430">,</span>&nbsp;<span class="ident" id="4140432">op</span>&nbsp;<span class="op" id="4140435">:=</span>&nbsp;<span class="ident" id="4140438">p</span><span class="op" id="4140439">.</span><span class="ident" id="4140440">pos</span><span class="op" id="4140443">,</span>&nbsp;<span class="ident" id="4140445">p</span><span class="op" id="4140446">.</span><span class="ident" id="4140447">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140453">p</span><span class="op" id="4140454">.</span><span class="ident" id="4140455">next</span><span class="op" id="4140459">(</span><span class="op" id="4140460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140464">x</span>&nbsp;<span class="op" id="4140466">:=</span>&nbsp;<span class="ident" id="4140469">p</span><span class="op" id="4140470">.</span><span class="ident" id="4140471">parseUnaryExpr</span><span class="op" id="4140485">(</span><span class="builtintype" id="4140486">false</span><span class="op" id="4140491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140495">return</span>&nbsp;<span class="op" id="4140502">&amp;</span><span class="ident" id="4140503">ast</span><span class="op" id="4140506">.</span><span class="ident" id="4140507">UnaryExpr</span><span class="op" id="4140516">{</span><span class="ident" id="4140517">OpPos</span><span class="op" id="4140522">:</span>&nbsp;<span class="ident" id="4140524">pos</span><span class="op" id="4140527">,</span>&nbsp;<span class="ident" id="4140529">Op</span><span class="op" id="4140531">:</span>&nbsp;<span class="ident" id="4140533">op</span><span class="op" id="4140535">,</span>&nbsp;<span class="ident" id="4140537">X</span><span class="op" id="4140538">:</span>&nbsp;<span class="ident" id="4140540">p</span><span class="op" id="4140541">.</span><span class="ident" id="4140542">checkExpr</span><span class="op" id="4140551">(</span><span class="ident" id="4140552">x</span><span class="op" id="4140553">)</span><span class="op" id="4140554">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140558">case</span>&nbsp;<span class="ident" id="4140563">token</span><span class="op" id="4140568">.</span><span class="ident" id="4140569">ARROW</span><span class="op" id="4140574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140578">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140618">arrow</span>&nbsp;<span class="op" id="4140624">:=</span>&nbsp;<span class="ident" id="4140627">p</span><span class="op" id="4140628">.</span><span class="ident" id="4140629">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140635">p</span><span class="op" id="4140636">.</span><span class="ident" id="4140637">next</span><span class="op" id="4140641">(</span><span class="op" id="4140642">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140647">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140710">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140771">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140834">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140854">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140859">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140908">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140968">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140973">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141034">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141072">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141077">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141120">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141168">x</span>&nbsp;<span class="op" id="4141170">:=</span>&nbsp;<span class="ident" id="4141173">p</span><span class="op" id="4141174">.</span><span class="ident" id="4141175">parseUnaryExpr</span><span class="op" id="4141189">(</span><span class="builtintype" id="4141190">false</span><span class="op" id="4141195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141200">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141234">if</span>&nbsp;<span class="ident" id="4141237">typ</span><span class="op" id="4141240">,</span>&nbsp;<span class="ident" id="4141242">ok</span>&nbsp;<span class="op" id="4141245">:=</span>&nbsp;<span class="ident" id="4141248">x</span><span class="op" id="4141249">.</span><span class="op" id="4141250">(</span><span class="op" id="4141251">*</span><span class="ident" id="4141252">ast</span><span class="op" id="4141255">.</span><span class="ident" id="4141256">ChanType</span><span class="op" id="4141264">)</span><span class="op" id="4141265">;</span>&nbsp;<span class="ident" id="4141267">ok</span>&nbsp;<span class="op" id="4141270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141275">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141291">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141331">dir</span>&nbsp;<span class="op" id="4141335">:=</span>&nbsp;<span class="ident" id="4141338">ast</span><span class="op" id="4141341">.</span><span class="ident" id="4141342">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141350">for</span>&nbsp;<span class="ident" id="4141354">ok</span>&nbsp;<span class="op" id="4141357">&amp;&amp;</span>&nbsp;<span class="ident" id="4141360">dir</span>&nbsp;<span class="op" id="4141364">==</span>&nbsp;<span class="ident" id="4141367">ast</span><span class="op" id="4141370">.</span><span class="ident" id="4141371">SEND</span>&nbsp;<span class="op" id="4141376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141382">if</span>&nbsp;<span class="ident" id="4141385">typ</span><span class="op" id="4141388">.</span><span class="ident" id="4141389">Dir</span>&nbsp;<span class="op" id="4141393">==</span>&nbsp;<span class="ident" id="4141396">ast</span><span class="op" id="4141399">.</span><span class="ident" id="4141400">RECV</span>&nbsp;<span class="op" id="4141405">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141412">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141454">p</span><span class="op" id="4141455">.</span><span class="ident" id="4141456">errorExpected</span><span class="op" id="4141469">(</span><span class="ident" id="4141470">typ</span><span class="op" id="4141473">.</span><span class="ident" id="4141474">Arrow</span><span class="op" id="4141479">,</span>&nbsp;<span class="string" id="4141481">&#34;&#39;chan&#39;&#34;</span><span class="op" id="4141489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141501">arrow</span><span class="op" id="4141506">,</span>&nbsp;<span class="ident" id="4141508">typ</span><span class="op" id="4141511">.</span><span class="ident" id="4141512">Begin</span><span class="op" id="4141517">,</span>&nbsp;<span class="ident" id="4141519">typ</span><span class="op" id="4141522">.</span><span class="ident" id="4141523">Arrow</span>&nbsp;<span class="op" id="4141529">=</span>&nbsp;<span class="ident" id="4141531">typ</span><span class="op" id="4141534">.</span><span class="ident" id="4141535">Arrow</span><span class="op" id="4141540">,</span>&nbsp;<span class="ident" id="4141542">arrow</span><span class="op" id="4141547">,</span>&nbsp;<span class="ident" id="4141549">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141559">dir</span><span class="op" id="4141562">,</span>&nbsp;<span class="ident" id="4141564">typ</span><span class="op" id="4141567">.</span><span class="ident" id="4141568">Dir</span>&nbsp;<span class="op" id="4141572">=</span>&nbsp;<span class="ident" id="4141574">typ</span><span class="op" id="4141577">.</span><span class="ident" id="4141578">Dir</span><span class="op" id="4141581">,</span>&nbsp;<span class="ident" id="4141583">ast</span><span class="op" id="4141586">.</span><span class="ident" id="4141587">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141596">typ</span><span class="op" id="4141599">,</span>&nbsp;<span class="ident" id="4141601">ok</span>&nbsp;<span class="op" id="4141604">=</span>&nbsp;<span class="ident" id="4141606">typ</span><span class="op" id="4141609">.</span><span class="ident" id="4141610">Value</span><span class="op" id="4141615">.</span><span class="op" id="4141616">(</span><span class="op" id="4141617">*</span><span class="ident" id="4141618">ast</span><span class="op" id="4141621">.</span><span class="ident" id="4141622">ChanType</span><span class="op" id="4141630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141640">if</span>&nbsp;<span class="ident" id="4141643">dir</span>&nbsp;<span class="op" id="4141647">==</span>&nbsp;<span class="ident" id="4141650">ast</span><span class="op" id="4141653">.</span><span class="ident" id="4141654">SEND</span>&nbsp;<span class="op" id="4141659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141665">p</span><span class="op" id="4141666">.</span><span class="ident" id="4141667">errorExpected</span><span class="op" id="4141680">(</span><span class="ident" id="4141681">arrow</span><span class="op" id="4141686">,</span>&nbsp;<span class="string" id="4141688">&#34;channel&nbsp;type&#34;</span><span class="op" id="4141702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141707">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141713">return</span>&nbsp;<span class="ident" id="4141720">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141729">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141743">return</span>&nbsp;<span class="op" id="4141750">&amp;</span><span class="ident" id="4141751">ast</span><span class="op" id="4141754">.</span><span class="ident" id="4141755">UnaryExpr</span><span class="op" id="4141764">{</span><span class="ident" id="4141765">OpPos</span><span class="op" id="4141770">:</span>&nbsp;<span class="ident" id="4141772">arrow</span><span class="op" id="4141777">,</span>&nbsp;<span class="ident" id="4141779">Op</span><span class="op" id="4141781">:</span>&nbsp;<span class="ident" id="4141783">token</span><span class="op" id="4141788">.</span><span class="ident" id="4141789">ARROW</span><span class="op" id="4141794">,</span>&nbsp;<span class="ident" id="4141796">X</span><span class="op" id="4141797">:</span>&nbsp;<span class="ident" id="4141799">p</span><span class="op" id="4141800">.</span><span class="ident" id="4141801">checkExpr</span><span class="op" id="4141810">(</span><span class="ident" id="4141811">x</span><span class="op" id="4141812">)</span><span class="op" id="4141813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141817">case</span>&nbsp;<span class="ident" id="4141822">token</span><span class="op" id="4141827">.</span><span class="ident" id="4141828">MUL</span><span class="op" id="4141831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141835">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141877">pos</span>&nbsp;<span class="op" id="4141881">:=</span>&nbsp;<span class="ident" id="4141884">p</span><span class="op" id="4141885">.</span><span class="ident" id="4141886">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141892">p</span><span class="op" id="4141893">.</span><span class="ident" id="4141894">next</span><span class="op" id="4141898">(</span><span class="op" id="4141899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141903">x</span>&nbsp;<span class="op" id="4141905">:=</span>&nbsp;<span class="ident" id="4141908">p</span><span class="op" id="4141909">.</span><span class="ident" id="4141910">parseUnaryExpr</span><span class="op" id="4141924">(</span><span class="builtintype" id="4141925">false</span><span class="op" id="4141930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141934">return</span>&nbsp;<span class="op" id="4141941">&amp;</span><span class="ident" id="4141942">ast</span><span class="op" id="4141945">.</span><span class="ident" id="4141946">StarExpr</span><span class="op" id="4141954">{</span><span class="ident" id="4141955">Star</span><span class="op" id="4141959">:</span>&nbsp;<span class="ident" id="4141961">pos</span><span class="op" id="4141964">,</span>&nbsp;<span class="ident" id="4141966">X</span><span class="op" id="4141967">:</span>&nbsp;<span class="ident" id="4141969">p</span><span class="op" id="4141970">.</span><span class="ident" id="4141971">checkExprOrType</span><span class="op" id="4141986">(</span><span class="ident" id="4141987">x</span><span class="op" id="4141988">)</span><span class="op" id="4141989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141996">return</span>&nbsp;<span class="ident" id="4142003">p</span><span class="op" id="4142004">.</span><span class="ident" id="4142005">parsePrimaryExpr</span><span class="op" id="4142021">(</span><span class="ident" id="4142022">lhs</span><span class="op" id="4142025">)</span><br>
<span class="lineno"></span><span class="op" id="4142027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4142030">func</span>&nbsp;<span class="op" id="4142035">(</span><span class="ident" id="4142036">p</span>&nbsp;<span class="op" id="4142038">*</span><span class="ident" id="4142039">parser</span><span class="op" id="4142045">)</span>&nbsp;<span class="ident" id="4142047">tokPrec</span><span class="op" id="4142054">(</span><span class="op" id="4142055">)</span>&nbsp;<span class="op" id="4142057">(</span><span class="ident" id="4142058">token</span><span class="op" id="4142063">.</span><span class="ident" id="4142064">Token</span><span class="op" id="4142069">,</span>&nbsp;<span class="builtintype" id="4142071">int</span><span class="op" id="4142074">)</span>&nbsp;<span class="op" id="4142076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142079">tok</span>&nbsp;<span class="op" id="4142083">:=</span>&nbsp;<span class="ident" id="4142086">p</span><span class="op" id="4142087">.</span><span class="ident" id="4142088">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142093">if</span>&nbsp;<span class="ident" id="4142096">p</span><span class="op" id="4142097">.</span><span class="ident" id="4142098">inRhs</span>&nbsp;<span class="op" id="4142104">&amp;&amp;</span>&nbsp;<span class="ident" id="4142107">tok</span>&nbsp;<span class="op" id="4142111">==</span>&nbsp;<span class="ident" id="4142114">token</span><span class="op" id="4142119">.</span><span class="ident" id="4142120">ASSIGN</span>&nbsp;<span class="op" id="4142127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142131">tok</span>&nbsp;<span class="op" id="4142135">=</span>&nbsp;<span class="ident" id="4142137">token</span><span class="op" id="4142142">.</span><span class="ident" id="4142143">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142151">return</span>&nbsp;<span class="ident" id="4142158">tok</span><span class="op" id="4142161">,</span>&nbsp;<span class="ident" id="4142163">tok</span><span class="op" id="4142166">.</span><span class="ident" id="4142167">Precedence</span><span class="op" id="4142177">(</span><span class="op" id="4142178">)</span><br>
<span class="lineno"></span><span class="op" id="4142180">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="4142183">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4142253">func</span>&nbsp;<span class="op" id="4142258">(</span><span class="ident" id="4142259">p</span>&nbsp;<span class="op" id="4142261">*</span><span class="ident" id="4142262">parser</span><span class="op" id="4142268">)</span>&nbsp;<span class="ident" id="4142270">parseBinaryExpr</span><span class="op" id="4142285">(</span><span class="ident" id="4142286">lhs</span>&nbsp;<span class="builtintype" id="4142290">bool</span><span class="op" id="4142294">,</span>&nbsp;<span class="ident" id="4142296">prec1</span>&nbsp;<span class="builtintype" id="4142302">int</span><span class="op" id="4142305">)</span>&nbsp;<span class="ident" id="4142307">ast</span><span class="op" id="4142310">.</span><span class="ident" id="4142311">Expr</span>&nbsp;<span class="op" id="4142316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142319">if</span>&nbsp;<span class="ident" id="4142322">p</span><span class="op" id="4142323">.</span><span class="ident" id="4142324">trace</span>&nbsp;<span class="op" id="4142330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142334">defer</span>&nbsp;<span class="ident" id="4142340">un</span><span class="op" id="4142342">(</span><span class="ident" id="4142343">trace</span><span class="op" id="4142348">(</span><span class="ident" id="4142349">p</span><span class="op" id="4142350">,</span>&nbsp;<span class="string" id="4142352">&#34;BinaryExpr&#34;</span><span class="op" id="4142364">)</span><span class="op" id="4142365">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142372">x</span>&nbsp;<span class="op" id="4142374">:=</span>&nbsp;<span class="ident" id="4142377">p</span><span class="op" id="4142378">.</span><span class="ident" id="4142379">parseUnaryExpr</span><span class="op" id="4142393">(</span><span class="ident" id="4142394">lhs</span><span class="op" id="4142397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142400">for</span>&nbsp;<span class="ident" id="4142404">_</span><span class="op" id="4142405">,</span>&nbsp;<span class="ident" id="4142407">prec</span>&nbsp;<span class="op" id="4142412">:=</span>&nbsp;<span class="ident" id="4142415">p</span><span class="op" id="4142416">.</span><span class="ident" id="4142417">tokPrec</span><span class="op" id="4142424">(</span><span class="op" id="4142425">)</span><span class="op" id="4142426">;</span>&nbsp;<span class="ident" id="4142428">prec</span>&nbsp;<span class="op" id="4142433">&gt;=</span>&nbsp;<span class="ident" id="4142436">prec1</span><span class="op" id="4142441">;</span>&nbsp;<span class="ident" id="4142443">prec</span><span class="op" id="4142447">--</span>&nbsp;<span class="op" id="4142450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142454">for</span>&nbsp;<span class="op" id="4142458">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142463">op</span><span class="op" id="4142465">,</span>&nbsp;<span class="ident" id="4142467">oprec</span>&nbsp;<span class="op" id="4142473">:=</span>&nbsp;<span class="ident" id="4142476">p</span><span class="op" id="4142477">.</span><span class="ident" id="4142478">tokPrec</span><span class="op" id="4142485">(</span><span class="op" id="4142486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142491">if</span>&nbsp;<span class="ident" id="4142494">oprec</span>&nbsp;<span class="op" id="4142500">!=</span>&nbsp;<span class="ident" id="4142503">prec</span>&nbsp;<span class="op" id="4142508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142514">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142528">pos</span>&nbsp;<span class="op" id="4142532">:=</span>&nbsp;<span class="ident" id="4142535">p</span><span class="op" id="4142536">.</span><span class="ident" id="4142537">expect</span><span class="op" id="4142543">(</span><span class="ident" id="4142544">op</span><span class="op" id="4142546">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142551">if</span>&nbsp;<span class="ident" id="4142554">lhs</span>&nbsp;<span class="op" id="4142558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142564">p</span><span class="op" id="4142565">.</span><span class="ident" id="4142566">resolve</span><span class="op" id="4142573">(</span><span class="ident" id="4142574">x</span><span class="op" id="4142575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142581">lhs</span>&nbsp;<span class="op" id="4142585">=</span>&nbsp;<span class="builtintype" id="4142587">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142601">y</span>&nbsp;<span class="op" id="4142603">:=</span>&nbsp;<span class="ident" id="4142606">p</span><span class="op" id="4142607">.</span><span class="ident" id="4142608">parseBinaryExpr</span><span class="op" id="4142623">(</span><span class="builtintype" id="4142624">false</span><span class="op" id="4142629">,</span>&nbsp;<span class="ident" id="4142631">prec</span><span class="op" id="4142635">+</span><span class="num" id="4142636">1</span><span class="op" id="4142637">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142642">x</span>&nbsp;<span class="op" id="4142644">=</span>&nbsp;<span class="op" id="4142646">&amp;</span><span class="ident" id="4142647">ast</span><span class="op" id="4142650">.</span><span class="ident" id="4142651">BinaryExpr</span><span class="op" id="4142661">{</span><span class="ident" id="4142662">X</span><span class="op" id="4142663">:</span>&nbsp;<span class="ident" id="4142665">p</span><span class="op" id="4142666">.</span><span class="ident" id="4142667">checkExpr</span><span class="op" id="4142676">(</span><span class="ident" id="4142677">x</span><span class="op" id="4142678">)</span><span class="op" id="4142679">,</span>&nbsp;<span class="ident" id="4142681">OpPos</span><span class="op" id="4142686">:</span>&nbsp;<span class="ident" id="4142688">pos</span><span class="op" id="4142691">,</span>&nbsp;<span class="ident" id="4142693">Op</span><span class="op" id="4142695">:</span>&nbsp;<span class="ident" id="4142697">op</span><span class="op" id="4142699">,</span>&nbsp;<span class="ident" id="4142701">Y</span><span class="op" id="4142702">:</span>&nbsp;<span class="ident" id="4142704">p</span><span class="op" id="4142705">.</span><span class="ident" id="4142706">checkExpr</span><span class="op" id="4142715">(</span><span class="ident" id="4142716">y</span><span class="op" id="4142717">)</span><span class="op" id="4142718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142729">return</span>&nbsp;<span class="ident" id="4142736">x</span><br>
<span class="lineno">1590</span><span class="op" id="4142738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4142741">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="4142811">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4142883">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="4142954">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4142966">func</span>&nbsp;<span class="op" id="4142971">(</span><span class="ident" id="4142972">p</span>&nbsp;<span class="op" id="4142974">*</span><span class="ident" id="4142975">parser</span><span class="op" id="4142981">)</span>&nbsp;<span class="ident" id="4142983">parseExpr</span><span class="op" id="4142992">(</span><span class="ident" id="4142993">lhs</span>&nbsp;<span class="builtintype" id="4142997">bool</span><span class="op" id="4143001">)</span>&nbsp;<span class="ident" id="4143003">ast</span><span class="op" id="4143006">.</span><span class="ident" id="4143007">Expr</span>&nbsp;<span class="op" id="4143012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143015">if</span>&nbsp;<span class="ident" id="4143018">p</span><span class="op" id="4143019">.</span><span class="ident" id="4143020">trace</span>&nbsp;<span class="op" id="4143026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143030">defer</span>&nbsp;<span class="ident" id="4143036">un</span><span class="op" id="4143038">(</span><span class="ident" id="4143039">trace</span><span class="op" id="4143044">(</span><span class="ident" id="4143045">p</span><span class="op" id="4143046">,</span>&nbsp;<span class="string" id="4143048">&#34;Expression&#34;</span><span class="op" id="4143060">)</span><span class="op" id="4143061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4143064">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143068">return</span>&nbsp;<span class="ident" id="4143075">p</span><span class="op" id="4143076">.</span><span class="ident" id="4143077">parseBinaryExpr</span><span class="op" id="4143092">(</span><span class="ident" id="4143093">lhs</span><span class="op" id="4143096">,</span>&nbsp;<span class="ident" id="4143098">token</span><span class="op" id="4143103">.</span><span class="ident" id="4143104">LowestPrec</span><span class="op" id="4143114">+</span><span class="num" id="4143115">1</span><span class="op" id="4143116">)</span><br>
<span class="lineno"></span><span class="op" id="4143118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4143121">func</span>&nbsp;<span class="op" id="4143126">(</span><span class="ident" id="4143127">p</span>&nbsp;<span class="op" id="4143129">*</span><span class="ident" id="4143130">parser</span><span class="op" id="4143136">)</span>&nbsp;<span class="ident" id="4143138">parseRhs</span><span class="op" id="4143146">(</span><span class="op" id="4143147">)</span>&nbsp;<span class="ident" id="4143149">ast</span><span class="op" id="4143152">.</span><span class="ident" id="4143153">Expr</span>&nbsp;<span class="op" id="4143158">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143161">old</span>&nbsp;<span class="op" id="4143165">:=</span>&nbsp;<span class="ident" id="4143168">p</span><span class="op" id="4143169">.</span><span class="ident" id="4143170">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143177">p</span><span class="op" id="4143178">.</span><span class="ident" id="4143179">inRhs</span>&nbsp;<span class="op" id="4143185">=</span>&nbsp;<span class="builtintype" id="4143187">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143193">x</span>&nbsp;<span class="op" id="4143195">:=</span>&nbsp;<span class="ident" id="4143198">p</span><span class="op" id="4143199">.</span><span class="ident" id="4143200">checkExpr</span><span class="op" id="4143209">(</span><span class="ident" id="4143210">p</span><span class="op" id="4143211">.</span><span class="ident" id="4143212">parseExpr</span><span class="op" id="4143221">(</span><span class="builtintype" id="4143222">false</span><span class="op" id="4143227">)</span><span class="op" id="4143228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143231">p</span><span class="op" id="4143232">.</span><span class="ident" id="4143233">inRhs</span>&nbsp;<span class="op" id="4143239">=</span>&nbsp;<span class="ident" id="4143241">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143246">return</span>&nbsp;<span class="ident" id="4143253">x</span><br>
<span class="lineno">1610</span><span class="op" id="4143255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4143258">func</span>&nbsp;<span class="op" id="4143263">(</span><span class="ident" id="4143264">p</span>&nbsp;<span class="op" id="4143266">*</span><span class="ident" id="4143267">parser</span><span class="op" id="4143273">)</span>&nbsp;<span class="ident" id="4143275">parseRhsOrType</span><span class="op" id="4143289">(</span><span class="op" id="4143290">)</span>&nbsp;<span class="ident" id="4143292">ast</span><span class="op" id="4143295">.</span><span class="ident" id="4143296">Expr</span>&nbsp;<span class="op" id="4143301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143304">old</span>&nbsp;<span class="op" id="4143308">:=</span>&nbsp;<span class="ident" id="4143311">p</span><span class="op" id="4143312">.</span><span class="ident" id="4143313">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143320">p</span><span class="op" id="4143321">.</span><span class="ident" id="4143322">inRhs</span>&nbsp;<span class="op" id="4143328">=</span>&nbsp;<span class="builtintype" id="4143330">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143336">x</span>&nbsp;<span class="op" id="4143338">:=</span>&nbsp;<span class="ident" id="4143341">p</span><span class="op" id="4143342">.</span><span class="ident" id="4143343">checkExprOrType</span><span class="op" id="4143358">(</span><span class="ident" id="4143359">p</span><span class="op" id="4143360">.</span><span class="ident" id="4143361">parseExpr</span><span class="op" id="4143370">(</span><span class="builtintype" id="4143371">false</span><span class="op" id="4143376">)</span><span class="op" id="4143377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143380">p</span><span class="op" id="4143381">.</span><span class="ident" id="4143382">inRhs</span>&nbsp;<span class="op" id="4143388">=</span>&nbsp;<span class="ident" id="4143390">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143395">return</span>&nbsp;<span class="ident" id="4143402">x</span><br>
<span class="lineno"></span><span class="op" id="4143404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="4143407">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4143487">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4143502">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4143540">const</span>&nbsp;<span class="op" id="4143546">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143549">basic</span>&nbsp;<span class="op" id="4143555">=</span>&nbsp;<span class="ident" id="4143557">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143563">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143572">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="4143580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="4143583">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="4143657">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4143731">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4143805">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="4143876">func</span>&nbsp;<span class="op" id="4143881">(</span><span class="ident" id="4143882">p</span>&nbsp;<span class="op" id="4143884">*</span><span class="ident" id="4143885">parser</span><span class="op" id="4143891">)</span>&nbsp;<span class="ident" id="4143893">parseSimpleStmt</span><span class="op" id="4143908">(</span><span class="ident" id="4143909">mode</span>&nbsp;<span class="builtintype" id="4143914">int</span><span class="op" id="4143917">)</span>&nbsp;<span class="op" id="4143919">(</span><span class="ident" id="4143920">ast</span><span class="op" id="4143923">.</span><span class="ident" id="4143924">Stmt</span><span class="op" id="4143928">,</span>&nbsp;<span class="builtintype" id="4143930">bool</span><span class="op" id="4143934">)</span>&nbsp;<span class="op" id="4143936">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143939">if</span>&nbsp;<span class="ident" id="4143942">p</span><span class="op" id="4143943">.</span><span class="ident" id="4143944">trace</span>&nbsp;<span class="op" id="4143950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143954">defer</span>&nbsp;<span class="ident" id="4143960">un</span><span class="op" id="4143962">(</span><span class="ident" id="4143963">trace</span><span class="op" id="4143968">(</span><span class="ident" id="4143969">p</span><span class="op" id="4143970">,</span>&nbsp;<span class="string" id="4143972">&#34;SimpleStmt&#34;</span><span class="op" id="4143984">)</span><span class="op" id="4143985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4143988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143992">x</span>&nbsp;<span class="op" id="4143994">:=</span>&nbsp;<span class="ident" id="4143997">p</span><span class="op" id="4143998">.</span><span class="ident" id="4143999">parseLhsList</span><span class="op" id="4144011">(</span><span class="op" id="4144012">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144016">switch</span>&nbsp;<span class="ident" id="4144023">p</span><span class="op" id="4144024">.</span><span class="ident" id="4144025">tok</span>&nbsp;<span class="op" id="4144029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144032">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144039">token</span><span class="op" id="4144044">.</span><span class="ident" id="4144045">DEFINE</span><span class="op" id="4144051">,</span>&nbsp;<span class="ident" id="4144053">token</span><span class="op" id="4144058">.</span><span class="ident" id="4144059">ASSIGN</span><span class="op" id="4144065">,</span>&nbsp;<span class="ident" id="4144067">token</span><span class="op" id="4144072">.</span><span class="ident" id="4144073">ADD_ASSIGN</span><span class="op" id="4144083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144087">token</span><span class="op" id="4144092">.</span><span class="ident" id="4144093">SUB_ASSIGN</span><span class="op" id="4144103">,</span>&nbsp;<span class="ident" id="4144105">token</span><span class="op" id="4144110">.</span><span class="ident" id="4144111">MUL_ASSIGN</span><span class="op" id="4144121">,</span>&nbsp;<span class="ident" id="4144123">token</span><span class="op" id="4144128">.</span><span class="ident" id="4144129">QUO_ASSIGN</span><span class="op" id="4144139">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144143">token</span><span class="op" id="4144148">.</span><span class="ident" id="4144149">REM_ASSIGN</span><span class="op" id="4144159">,</span>&nbsp;<span class="ident" id="4144161">token</span><span class="op" id="4144166">.</span><span class="ident" id="4144167">AND_ASSIGN</span><span class="op" id="4144177">,</span>&nbsp;<span class="ident" id="4144179">token</span><span class="op" id="4144184">.</span><span class="ident" id="4144185">OR_ASSIGN</span><span class="op" id="4144194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144198">token</span><span class="op" id="4144203">.</span><span class="ident" id="4144204">XOR_ASSIGN</span><span class="op" id="4144214">,</span>&nbsp;<span class="ident" id="4144216">token</span><span class="op" id="4144221">.</span><span class="ident" id="4144222">SHL_ASSIGN</span><span class="op" id="4144232">,</span>&nbsp;<span class="ident" id="4144234">token</span><span class="op" id="4144239">.</span><span class="ident" id="4144240">SHR_ASSIGN</span><span class="op" id="4144250">,</span>&nbsp;<span class="ident" id="4144252">token</span><span class="op" id="4144257">.</span><span class="ident" id="4144258">AND_NOT_ASSIGN</span><span class="op" id="4144272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144276">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144335">pos</span><span class="op" id="4144338">,</span>&nbsp;<span class="ident" id="4144340">tok</span>&nbsp;<span class="op" id="4144344">:=</span>&nbsp;<span class="ident" id="4144347">p</span><span class="op" id="4144348">.</span><span class="ident" id="4144349">pos</span><span class="op" id="4144352">,</span>&nbsp;<span class="ident" id="4144354">p</span><span class="op" id="4144355">.</span><span class="ident" id="4144356">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144362">p</span><span class="op" id="4144363">.</span><span class="ident" id="4144364">next</span><span class="op" id="4144368">(</span><span class="op" id="4144369">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144373">var</span>&nbsp;<span class="ident" id="4144377">y</span>&nbsp;<span class="op" id="4144379">[</span><span class="op" id="4144380">]</span><span class="ident" id="4144381">ast</span><span class="op" id="4144384">.</span><span class="ident" id="4144385">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144392">isRange</span>&nbsp;<span class="op" id="4144400">:=</span>&nbsp;<span class="builtintype" id="4144403">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144411">if</span>&nbsp;<span class="ident" id="4144414">mode</span>&nbsp;<span class="op" id="4144419">==</span>&nbsp;<span class="ident" id="4144422">rangeOk</span>&nbsp;<span class="op" id="4144430">&amp;&amp;</span>&nbsp;<span class="ident" id="4144433">p</span><span class="op" id="4144434">.</span><span class="ident" id="4144435">tok</span>&nbsp;<span class="op" id="4144439">==</span>&nbsp;<span class="ident" id="4144442">token</span><span class="op" id="4144447">.</span><span class="ident" id="4144448">RANGE</span>&nbsp;<span class="op" id="4144454">&amp;&amp;</span>&nbsp;<span class="op" id="4144457">(</span><span class="ident" id="4144458">tok</span>&nbsp;<span class="op" id="4144462">==</span>&nbsp;<span class="ident" id="4144465">token</span><span class="op" id="4144470">.</span><span class="ident" id="4144471">DEFINE</span>&nbsp;<span class="op" id="4144478">||</span>&nbsp;<span class="ident" id="4144481">tok</span>&nbsp;<span class="op" id="4144485">==</span>&nbsp;<span class="ident" id="4144488">token</span><span class="op" id="4144493">.</span><span class="ident" id="4144494">ASSIGN</span><span class="op" id="4144500">)</span>&nbsp;<span class="op" id="4144502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144507">pos</span>&nbsp;<span class="op" id="4144511">:=</span>&nbsp;<span class="ident" id="4144514">p</span><span class="op" id="4144515">.</span><span class="ident" id="4144516">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144523">p</span><span class="op" id="4144524">.</span><span class="ident" id="4144525">next</span><span class="op" id="4144529">(</span><span class="op" id="4144530">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144535">y</span>&nbsp;<span class="op" id="4144537">=</span>&nbsp;<span class="op" id="4144539">[</span><span class="op" id="4144540">]</span><span class="ident" id="4144541">ast</span><span class="op" id="4144544">.</span><span class="ident" id="4144545">Expr</span><span class="op" id="4144549">{</span><span class="op" id="4144550">&amp;</span><span class="ident" id="4144551">ast</span><span class="op" id="4144554">.</span><span class="ident" id="4144555">UnaryExpr</span><span class="op" id="4144564">{</span><span class="ident" id="4144565">OpPos</span><span class="op" id="4144570">:</span>&nbsp;<span class="ident" id="4144572">pos</span><span class="op" id="4144575">,</span>&nbsp;<span class="ident" id="4144577">Op</span><span class="op" id="4144579">:</span>&nbsp;<span class="ident" id="4144581">token</span><span class="op" id="4144586">.</span><span class="ident" id="4144587">RANGE</span><span class="op" id="4144592">,</span>&nbsp;<span class="ident" id="4144594">X</span><span class="op" id="4144595">:</span>&nbsp;<span class="ident" id="4144597">p</span><span class="op" id="4144598">.</span><span class="ident" id="4144599">parseRhs</span><span class="op" id="4144607">(</span><span class="op" id="4144608">)</span><span class="op" id="4144609">}</span><span class="op" id="4144610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144615">isRange</span>&nbsp;<span class="op" id="4144623">=</span>&nbsp;<span class="builtintype" id="4144625">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144632">}</span>&nbsp;<span class="keyword" id="4144634">else</span>&nbsp;<span class="op" id="4144639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144644">y</span>&nbsp;<span class="op" id="4144646">=</span>&nbsp;<span class="ident" id="4144648">p</span><span class="op" id="4144649">.</span><span class="ident" id="4144650">parseRhsList</span><span class="op" id="4144662">(</span><span class="op" id="4144663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144667">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144671">as</span>&nbsp;<span class="op" id="4144674">:=</span>&nbsp;<span class="op" id="4144677">&amp;</span><span class="ident" id="4144678">ast</span><span class="op" id="4144681">.</span><span class="ident" id="4144682">AssignStmt</span><span class="op" id="4144692">{</span><span class="ident" id="4144693">Lhs</span><span class="op" id="4144696">:</span>&nbsp;<span class="ident" id="4144698">x</span><span class="op" id="4144699">,</span>&nbsp;<span class="ident" id="4144701">TokPos</span><span class="op" id="4144707">:</span>&nbsp;<span class="ident" id="4144709">pos</span><span class="op" id="4144712">,</span>&nbsp;<span class="ident" id="4144714">Tok</span><span class="op" id="4144717">:</span>&nbsp;<span class="ident" id="4144719">tok</span><span class="op" id="4144722">,</span>&nbsp;<span class="ident" id="4144724">Rhs</span><span class="op" id="4144727">:</span>&nbsp;<span class="ident" id="4144729">y</span><span class="op" id="4144730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144734">if</span>&nbsp;<span class="ident" id="4144737">tok</span>&nbsp;<span class="op" id="4144741">==</span>&nbsp;<span class="ident" id="4144744">token</span><span class="op" id="4144749">.</span><span class="ident" id="4144750">DEFINE</span>&nbsp;<span class="op" id="4144757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144762">p</span><span class="op" id="4144763">.</span><span class="ident" id="4144764">shortVarDecl</span><span class="op" id="4144776">(</span><span class="ident" id="4144777">as</span><span class="op" id="4144779">,</span>&nbsp;<span class="ident" id="4144781">x</span><span class="op" id="4144782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144790">return</span>&nbsp;<span class="ident" id="4144797">as</span><span class="op" id="4144799">,</span>&nbsp;<span class="ident" id="4144801">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144814">if</span>&nbsp;<span class="builtinfunc" id="4144817">len</span><span class="op" id="4144820">(</span><span class="ident" id="4144821">x</span><span class="op" id="4144822">)</span>&nbsp;<span class="op" id="4144824">&gt;</span>&nbsp;<span class="num" id="4144826">1</span>&nbsp;<span class="op" id="4144828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144832">p</span><span class="op" id="4144833">.</span><span class="ident" id="4144834">errorExpected</span><span class="op" id="4144847">(</span><span class="ident" id="4144848">x</span><span class="op" id="4144849">[</span><span class="num" id="4144850">0</span><span class="op" id="4144851">]</span><span class="op" id="4144852">.</span><span class="ident" id="4144853">Pos</span><span class="op" id="4144856">(</span><span class="op" id="4144857">)</span><span class="op" id="4144858">,</span>&nbsp;<span class="string" id="4144860">&#34;1&nbsp;expression&#34;</span><span class="op" id="4144874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144878">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144917">switch</span>&nbsp;<span class="ident" id="4144924">p</span><span class="op" id="4144925">.</span><span class="ident" id="4144926">tok</span>&nbsp;<span class="op" id="4144930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144933">case</span>&nbsp;<span class="ident" id="4144938">token</span><span class="op" id="4144943">.</span><span class="ident" id="4144944">COLON</span><span class="op" id="4144949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144953">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144976">colon</span>&nbsp;<span class="op" id="4144982">:=</span>&nbsp;<span class="ident" id="4144985">p</span><span class="op" id="4144986">.</span><span class="ident" id="4144987">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144993">p</span><span class="op" id="4144994">.</span><span class="ident" id="4144995">next</span><span class="op" id="4144999">(</span><span class="op" id="4145000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145004">if</span>&nbsp;<span class="ident" id="4145007">label</span><span class="op" id="4145012">,</span>&nbsp;<span class="ident" id="4145014">isIdent</span>&nbsp;<span class="op" id="4145022">:=</span>&nbsp;<span class="ident" id="4145025">x</span><span class="op" id="4145026">[</span><span class="num" id="4145027">0</span><span class="op" id="4145028">]</span><span class="op" id="4145029">.</span><span class="op" id="4145030">(</span><span class="op" id="4145031">*</span><span class="ident" id="4145032">ast</span><span class="op" id="4145035">.</span><span class="ident" id="4145036">Ident</span><span class="op" id="4145041">)</span><span class="op" id="4145042">;</span>&nbsp;<span class="ident" id="4145044">mode</span>&nbsp;<span class="op" id="4145049">==</span>&nbsp;<span class="ident" id="4145052">labelOk</span>&nbsp;<span class="op" id="4145060">&amp;&amp;</span>&nbsp;<span class="ident" id="4145063">isIdent</span>&nbsp;<span class="op" id="4145071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145076">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145140">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145206">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145222">stmt</span>&nbsp;<span class="op" id="4145227">:=</span>&nbsp;<span class="op" id="4145230">&amp;</span><span class="ident" id="4145231">ast</span><span class="op" id="4145234">.</span><span class="ident" id="4145235">LabeledStmt</span><span class="op" id="4145246">{</span><span class="ident" id="4145247">Label</span><span class="op" id="4145252">:</span>&nbsp;<span class="ident" id="4145254">label</span><span class="op" id="4145259">,</span>&nbsp;<span class="ident" id="4145261">Colon</span><span class="op" id="4145266">:</span>&nbsp;<span class="ident" id="4145268">colon</span><span class="op" id="4145273">,</span>&nbsp;<span class="ident" id="4145275">Stmt</span><span class="op" id="4145279">:</span>&nbsp;<span class="ident" id="4145281">p</span><span class="op" id="4145282">.</span><span class="ident" id="4145283">parseStmt</span><span class="op" id="4145292">(</span><span class="op" id="4145293">)</span><span class="op" id="4145294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145299">p</span><span class="op" id="4145300">.</span><span class="ident" id="4145301">declare</span><span class="op" id="4145308">(</span><span class="ident" id="4145309">stmt</span><span class="op" id="4145313">,</span>&nbsp;<span class="ident" id="4145315">nil</span><span class="op" id="4145318">,</span>&nbsp;<span class="ident" id="4145320">p</span><span class="op" id="4145321">.</span><span class="ident" id="4145322">labelScope</span><span class="op" id="4145332">,</span>&nbsp;<span class="ident" id="4145334">ast</span><span class="op" id="4145337">.</span><span class="ident" id="4145338">Lbl</span><span class="op" id="4145341">,</span>&nbsp;<span class="ident" id="4145343">label</span><span class="op" id="4145348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145353">return</span>&nbsp;<span class="ident" id="4145360">stmt</span><span class="op" id="4145364">,</span>&nbsp;<span class="builtintype" id="4145366">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145374">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145378">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145451">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145525">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145598">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145671">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145745">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145780">p</span><span class="op" id="4145781">.</span><span class="builtintype" id="4145782">error</span><span class="op" id="4145787">(</span><span class="ident" id="4145788">colon</span><span class="op" id="4145793">,</span>&nbsp;<span class="string" id="4145795">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="4145822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145826">return</span>&nbsp;<span class="op" id="4145833">&amp;</span><span class="ident" id="4145834">ast</span><span class="op" id="4145837">.</span><span class="ident" id="4145838">BadStmt</span><span class="op" id="4145845">{</span><span class="ident" id="4145846">From</span><span class="op" id="4145850">:</span>&nbsp;<span class="ident" id="4145852">x</span><span class="op" id="4145853">[</span><span class="num" id="4145854">0</span><span class="op" id="4145855">]</span><span class="op" id="4145856">.</span><span class="ident" id="4145857">Pos</span><span class="op" id="4145860">(</span><span class="op" id="4145861">)</span><span class="op" id="4145862">,</span>&nbsp;<span class="ident" id="4145864">To</span><span class="op" id="4145866">:</span>&nbsp;<span class="ident" id="4145868">colon</span>&nbsp;<span class="op" id="4145874">+</span>&nbsp;<span class="num" id="4145876">1</span><span class="op" id="4145877">}</span><span class="op" id="4145878">,</span>&nbsp;<span class="builtintype" id="4145880">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145888">case</span>&nbsp;<span class="ident" id="4145893">token</span><span class="op" id="4145898">.</span><span class="ident" id="4145899">ARROW</span><span class="op" id="4145904">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145908">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145928">arrow</span>&nbsp;<span class="op" id="4145934">:=</span>&nbsp;<span class="ident" id="4145937">p</span><span class="op" id="4145938">.</span><span class="ident" id="4145939">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145945">p</span><span class="op" id="4145946">.</span><span class="ident" id="4145947">next</span><span class="op" id="4145951">(</span><span class="op" id="4145952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145956">y</span>&nbsp;<span class="op" id="4145958">:=</span>&nbsp;<span class="ident" id="4145961">p</span><span class="op" id="4145962">.</span><span class="ident" id="4145963">parseRhs</span><span class="op" id="4145971">(</span><span class="op" id="4145972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145976">return</span>&nbsp;<span class="op" id="4145983">&amp;</span><span class="ident" id="4145984">ast</span><span class="op" id="4145987">.</span><span class="ident" id="4145988">SendStmt</span><span class="op" id="4145996">{</span><span class="ident" id="4145997">Chan</span><span class="op" id="4146001">:</span>&nbsp;<span class="ident" id="4146003">x</span><span class="op" id="4146004">[</span><span class="num" id="4146005">0</span><span class="op" id="4146006">]</span><span class="op" id="4146007">,</span>&nbsp;<span class="ident" id="4146009">Arrow</span><span class="op" id="4146014">:</span>&nbsp;<span class="ident" id="4146016">arrow</span><span class="op" id="4146021">,</span>&nbsp;<span class="ident" id="4146023">Value</span><span class="op" id="4146028">:</span>&nbsp;<span class="ident" id="4146030">y</span><span class="op" id="4146031">}</span><span class="op" id="4146032">,</span>&nbsp;<span class="builtintype" id="4146034">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146042">case</span>&nbsp;<span class="ident" id="4146047">token</span><span class="op" id="4146052">.</span><span class="ident" id="4146053">INC</span><span class="op" id="4146056">,</span>&nbsp;<span class="ident" id="4146058">token</span><span class="op" id="4146063">.</span><span class="ident" id="4146064">DEC</span><span class="op" id="4146067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146071">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146099">s</span>&nbsp;<span class="op" id="4146101">:=</span>&nbsp;<span class="op" id="4146104">&amp;</span><span class="ident" id="4146105">ast</span><span class="op" id="4146108">.</span><span class="ident" id="4146109">IncDecStmt</span><span class="op" id="4146119">{</span><span class="ident" id="4146120">X</span><span class="op" id="4146121">:</span>&nbsp;<span class="ident" id="4146123">x</span><span class="op" id="4146124">[</span><span class="num" id="4146125">0</span><span class="op" id="4146126">]</span><span class="op" id="4146127">,</span>&nbsp;<span class="ident" id="4146129">TokPos</span><span class="op" id="4146135">:</span>&nbsp;<span class="ident" id="4146137">p</span><span class="op" id="4146138">.</span><span class="ident" id="4146139">pos</span><span class="op" id="4146142">,</span>&nbsp;<span class="ident" id="4146144">Tok</span><span class="op" id="4146147">:</span>&nbsp;<span class="ident" id="4146149">p</span><span class="op" id="4146150">.</span><span class="ident" id="4146151">tok</span><span class="op" id="4146154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146158">p</span><span class="op" id="4146159">.</span><span class="ident" id="4146160">next</span><span class="op" id="4146164">(</span><span class="op" id="4146165">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146169">return</span>&nbsp;<span class="ident" id="4146176">s</span><span class="op" id="4146177">,</span>&nbsp;<span class="builtintype" id="4146179">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146190">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146205">return</span>&nbsp;<span class="op" id="4146212">&amp;</span><span class="ident" id="4146213">ast</span><span class="op" id="4146216">.</span><span class="ident" id="4146217">ExprStmt</span><span class="op" id="4146225">{</span><span class="ident" id="4146226">X</span><span class="op" id="4146227">:</span>&nbsp;<span class="ident" id="4146229">x</span><span class="op" id="4146230">[</span><span class="num" id="4146231">0</span><span class="op" id="4146232">]</span><span class="op" id="4146233">}</span><span class="op" id="4146234">,</span>&nbsp;<span class="builtintype" id="4146236">false</span><br>
<span class="lineno">1710</span><span class="op" id="4146242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146245">func</span>&nbsp;<span class="op" id="4146250">(</span><span class="ident" id="4146251">p</span>&nbsp;<span class="op" id="4146253">*</span><span class="ident" id="4146254">parser</span><span class="op" id="4146260">)</span>&nbsp;<span class="ident" id="4146262">parseCallExpr</span><span class="op" id="4146275">(</span><span class="ident" id="4146276">callType</span>&nbsp;<span class="builtintype" id="4146285">string</span><span class="op" id="4146291">)</span>&nbsp;<span class="op" id="4146293">*</span><span class="ident" id="4146294">ast</span><span class="op" id="4146297">.</span><span class="ident" id="4146298">CallExpr</span>&nbsp;<span class="op" id="4146307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146310">x</span>&nbsp;<span class="op" id="4146312">:=</span>&nbsp;<span class="ident" id="4146315">p</span><span class="op" id="4146316">.</span><span class="ident" id="4146317">parseRhsOrType</span><span class="op" id="4146331">(</span><span class="op" id="4146332">)</span>&nbsp;<span class="comment" id="4146334">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146376">if</span>&nbsp;<span class="ident" id="4146379">call</span><span class="op" id="4146383">,</span>&nbsp;<span class="ident" id="4146385">isCall</span>&nbsp;<span class="op" id="4146392">:=</span>&nbsp;<span class="ident" id="4146395">x</span><span class="op" id="4146396">.</span><span class="op" id="4146397">(</span><span class="op" id="4146398">*</span><span class="ident" id="4146399">ast</span><span class="op" id="4146402">.</span><span class="ident" id="4146403">CallExpr</span><span class="op" id="4146411">)</span><span class="op" id="4146412">;</span>&nbsp;<span class="ident" id="4146414">isCall</span>&nbsp;<span class="op" id="4146421">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146425">return</span>&nbsp;<span class="ident" id="4146432">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146441">if</span>&nbsp;<span class="ident" id="4146444">_</span><span class="op" id="4146445">,</span>&nbsp;<span class="ident" id="4146447">isBad</span>&nbsp;<span class="op" id="4146453">:=</span>&nbsp;<span class="ident" id="4146456">x</span><span class="op" id="4146457">.</span><span class="op" id="4146458">(</span><span class="op" id="4146459">*</span><span class="ident" id="4146460">ast</span><span class="op" id="4146463">.</span><span class="ident" id="4146464">BadExpr</span><span class="op" id="4146471">)</span><span class="op" id="4146472">;</span>&nbsp;<span class="op" id="4146474">!</span><span class="ident" id="4146475">isBad</span>&nbsp;<span class="op" id="4146481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146485">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146526">p</span><span class="op" id="4146527">.</span><span class="builtintype" id="4146528">error</span><span class="op" id="4146533">(</span><span class="ident" id="4146534">p</span><span class="op" id="4146535">.</span><span class="ident" id="4146536">safePos</span><span class="op" id="4146543">(</span><span class="ident" id="4146544">x</span><span class="op" id="4146545">.</span><span class="ident" id="4146546">End</span><span class="op" id="4146549">(</span><span class="op" id="4146550">)</span><span class="op" id="4146551">)</span><span class="op" id="4146552">,</span>&nbsp;<span class="ident" id="4146554">fmt</span><span class="op" id="4146557">.</span><span class="ident" id="4146558">Sprintf</span><span class="op" id="4146565">(</span><span class="string" id="4146566">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="4146608">,</span>&nbsp;<span class="ident" id="4146610">callType</span><span class="op" id="4146618">)</span><span class="op" id="4146619">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146625">return</span>&nbsp;<span class="ident" id="4146632">nil</span><br>
<span class="lineno"></span><span class="op" id="4146636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146639">func</span>&nbsp;<span class="op" id="4146644">(</span><span class="ident" id="4146645">p</span>&nbsp;<span class="op" id="4146647">*</span><span class="ident" id="4146648">parser</span><span class="op" id="4146654">)</span>&nbsp;<span class="ident" id="4146656">parseGoStmt</span><span class="op" id="4146667">(</span><span class="op" id="4146668">)</span>&nbsp;<span class="ident" id="4146670">ast</span><span class="op" id="4146673">.</span><span class="ident" id="4146674">Stmt</span>&nbsp;<span class="op" id="4146679">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146682">if</span>&nbsp;<span class="ident" id="4146685">p</span><span class="op" id="4146686">.</span><span class="ident" id="4146687">trace</span>&nbsp;<span class="op" id="4146693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146697">defer</span>&nbsp;<span class="ident" id="4146703">un</span><span class="op" id="4146705">(</span><span class="ident" id="4146706">trace</span><span class="op" id="4146711">(</span><span class="ident" id="4146712">p</span><span class="op" id="4146713">,</span>&nbsp;<span class="string" id="4146715">&#34;GoStmt&#34;</span><span class="op" id="4146723">)</span><span class="op" id="4146724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146731">pos</span>&nbsp;<span class="op" id="4146735">:=</span>&nbsp;<span class="ident" id="4146738">p</span><span class="op" id="4146739">.</span><span class="ident" id="4146740">expect</span><span class="op" id="4146746">(</span><span class="ident" id="4146747">token</span><span class="op" id="4146752">.</span><span class="ident" id="4146753">GO</span><span class="op" id="4146755">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146758">call</span>&nbsp;<span class="op" id="4146763">:=</span>&nbsp;<span class="ident" id="4146766">p</span><span class="op" id="4146767">.</span><span class="ident" id="4146768">parseCallExpr</span><span class="op" id="4146781">(</span><span class="string" id="4146782">&#34;go&#34;</span><span class="op" id="4146786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146789">p</span><span class="op" id="4146790">.</span><span class="ident" id="4146791">expectSemi</span><span class="op" id="4146801">(</span><span class="op" id="4146802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146805">if</span>&nbsp;<span class="ident" id="4146808">call</span>&nbsp;<span class="op" id="4146813">==</span>&nbsp;<span class="ident" id="4146816">nil</span>&nbsp;<span class="op" id="4146820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146824">return</span>&nbsp;<span class="op" id="4146831">&amp;</span><span class="ident" id="4146832">ast</span><span class="op" id="4146835">.</span><span class="ident" id="4146836">BadStmt</span><span class="op" id="4146843">{</span><span class="ident" id="4146844">From</span><span class="op" id="4146848">:</span>&nbsp;<span class="ident" id="4146850">pos</span><span class="op" id="4146853">,</span>&nbsp;<span class="ident" id="4146855">To</span><span class="op" id="4146857">:</span>&nbsp;<span class="ident" id="4146859">pos</span>&nbsp;<span class="op" id="4146863">+</span>&nbsp;<span class="num" id="4146865">2</span><span class="op" id="4146866">}</span>&nbsp;<span class="comment" id="4146868">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146882">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146886">return</span>&nbsp;<span class="op" id="4146893">&amp;</span><span class="ident" id="4146894">ast</span><span class="op" id="4146897">.</span><span class="ident" id="4146898">GoStmt</span><span class="op" id="4146904">{</span><span class="ident" id="4146905">Go</span><span class="op" id="4146907">:</span>&nbsp;<span class="ident" id="4146909">pos</span><span class="op" id="4146912">,</span>&nbsp;<span class="ident" id="4146914">Call</span><span class="op" id="4146918">:</span>&nbsp;<span class="ident" id="4146920">call</span><span class="op" id="4146924">}</span><br>
<span class="lineno"></span><span class="op" id="4146926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146929">func</span>&nbsp;<span class="op" id="4146934">(</span><span class="ident" id="4146935">p</span>&nbsp;<span class="op" id="4146937">*</span><span class="ident" id="4146938">parser</span><span class="op" id="4146944">)</span>&nbsp;<span class="ident" id="4146946">parseDeferStmt</span><span class="op" id="4146960">(</span><span class="op" id="4146961">)</span>&nbsp;<span class="ident" id="4146963">ast</span><span class="op" id="4146966">.</span><span class="ident" id="4146967">Stmt</span>&nbsp;<span class="op" id="4146972">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146975">if</span>&nbsp;<span class="ident" id="4146978">p</span><span class="op" id="4146979">.</span><span class="ident" id="4146980">trace</span>&nbsp;<span class="op" id="4146986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146990">defer</span>&nbsp;<span class="ident" id="4146996">un</span><span class="op" id="4146998">(</span><span class="ident" id="4146999">trace</span><span class="op" id="4147004">(</span><span class="ident" id="4147005">p</span><span class="op" id="4147006">,</span>&nbsp;<span class="string" id="4147008">&#34;DeferStmt&#34;</span><span class="op" id="4147019">)</span><span class="op" id="4147020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147027">pos</span>&nbsp;<span class="op" id="4147031">:=</span>&nbsp;<span class="ident" id="4147034">p</span><span class="op" id="4147035">.</span><span class="ident" id="4147036">expect</span><span class="op" id="4147042">(</span><span class="ident" id="4147043">token</span><span class="op" id="4147048">.</span><span class="ident" id="4147049">DEFER</span><span class="op" id="4147054">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147057">call</span>&nbsp;<span class="op" id="4147062">:=</span>&nbsp;<span class="ident" id="4147065">p</span><span class="op" id="4147066">.</span><span class="ident" id="4147067">parseCallExpr</span><span class="op" id="4147080">(</span><span class="string" id="4147081">&#34;defer&#34;</span><span class="op" id="4147088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147091">p</span><span class="op" id="4147092">.</span><span class="ident" id="4147093">expectSemi</span><span class="op" id="4147103">(</span><span class="op" id="4147104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147107">if</span>&nbsp;<span class="ident" id="4147110">call</span>&nbsp;<span class="op" id="4147115">==</span>&nbsp;<span class="ident" id="4147118">nil</span>&nbsp;<span class="op" id="4147122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147126">return</span>&nbsp;<span class="op" id="4147133">&amp;</span><span class="ident" id="4147134">ast</span><span class="op" id="4147137">.</span><span class="ident" id="4147138">BadStmt</span><span class="op" id="4147145">{</span><span class="ident" id="4147146">From</span><span class="op" id="4147150">:</span>&nbsp;<span class="ident" id="4147152">pos</span><span class="op" id="4147155">,</span>&nbsp;<span class="ident" id="4147157">To</span><span class="op" id="4147159">:</span>&nbsp;<span class="ident" id="4147161">pos</span>&nbsp;<span class="op" id="4147165">+</span>&nbsp;<span class="num" id="4147167">5</span><span class="op" id="4147168">}</span>&nbsp;<span class="comment" id="4147170">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147187">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147191">return</span>&nbsp;<span class="op" id="4147198">&amp;</span><span class="ident" id="4147199">ast</span><span class="op" id="4147202">.</span><span class="ident" id="4147203">DeferStmt</span><span class="op" id="4147212">{</span><span class="ident" id="4147213">Defer</span><span class="op" id="4147218">:</span>&nbsp;<span class="ident" id="4147220">pos</span><span class="op" id="4147223">,</span>&nbsp;<span class="ident" id="4147225">Call</span><span class="op" id="4147229">:</span>&nbsp;<span class="ident" id="4147231">call</span><span class="op" id="4147235">}</span><br>
<span class="lineno"></span><span class="op" id="4147237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4147240">func</span>&nbsp;<span class="op" id="4147245">(</span><span class="ident" id="4147246">p</span>&nbsp;<span class="op" id="4147248">*</span><span class="ident" id="4147249">parser</span><span class="op" id="4147255">)</span>&nbsp;<span class="ident" id="4147257">parseReturnStmt</span><span class="op" id="4147272">(</span><span class="op" id="4147273">)</span>&nbsp;<span class="op" id="4147275">*</span><span class="ident" id="4147276">ast</span><span class="op" id="4147279">.</span><span class="ident" id="4147280">ReturnStmt</span>&nbsp;<span class="op" id="4147291">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147294">if</span>&nbsp;<span class="ident" id="4147297">p</span><span class="op" id="4147298">.</span><span class="ident" id="4147299">trace</span>&nbsp;<span class="op" id="4147305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147309">defer</span>&nbsp;<span class="ident" id="4147315">un</span><span class="op" id="4147317">(</span><span class="ident" id="4147318">trace</span><span class="op" id="4147323">(</span><span class="ident" id="4147324">p</span><span class="op" id="4147325">,</span>&nbsp;<span class="string" id="4147327">&#34;ReturnStmt&#34;</span><span class="op" id="4147339">)</span><span class="op" id="4147340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147347">pos</span>&nbsp;<span class="op" id="4147351">:=</span>&nbsp;<span class="ident" id="4147354">p</span><span class="op" id="4147355">.</span><span class="ident" id="4147356">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147361">p</span><span class="op" id="4147362">.</span><span class="ident" id="4147363">expect</span><span class="op" id="4147369">(</span><span class="ident" id="4147370">token</span><span class="op" id="4147375">.</span><span class="ident" id="4147376">RETURN</span><span class="op" id="4147382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147385">var</span>&nbsp;<span class="ident" id="4147389">x</span>&nbsp;<span class="op" id="4147391">[</span><span class="op" id="4147392">]</span><span class="ident" id="4147393">ast</span><span class="op" id="4147396">.</span><span class="ident" id="4147397">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147403">if</span>&nbsp;<span class="ident" id="4147406">p</span><span class="op" id="4147407">.</span><span class="ident" id="4147408">tok</span>&nbsp;<span class="op" id="4147412">!=</span>&nbsp;<span class="ident" id="4147415">token</span><span class="op" id="4147420">.</span><span class="ident" id="4147421">SEMICOLON</span>&nbsp;<span class="op" id="4147431">&amp;&amp;</span>&nbsp;<span class="ident" id="4147434">p</span><span class="op" id="4147435">.</span><span class="ident" id="4147436">tok</span>&nbsp;<span class="op" id="4147440">!=</span>&nbsp;<span class="ident" id="4147443">token</span><span class="op" id="4147448">.</span><span class="ident" id="4147449">RBRACE</span>&nbsp;<span class="op" id="4147456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147460">x</span>&nbsp;<span class="op" id="4147462">=</span>&nbsp;<span class="ident" id="4147464">p</span><span class="op" id="4147465">.</span><span class="ident" id="4147466">parseRhsList</span><span class="op" id="4147478">(</span><span class="op" id="4147479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147482">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147485">p</span><span class="op" id="4147486">.</span><span class="ident" id="4147487">expectSemi</span><span class="op" id="4147497">(</span><span class="op" id="4147498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147502">return</span>&nbsp;<span class="op" id="4147509">&amp;</span><span class="ident" id="4147510">ast</span><span class="op" id="4147513">.</span><span class="ident" id="4147514">ReturnStmt</span><span class="op" id="4147524">{</span><span class="ident" id="4147525">Return</span><span class="op" id="4147531">:</span>&nbsp;<span class="ident" id="4147533">pos</span><span class="op" id="4147536">,</span>&nbsp;<span class="ident" id="4147538">Results</span><span class="op" id="4147545">:</span>&nbsp;<span class="ident" id="4147547">x</span><span class="op" id="4147548">}</span><br>
<span class="lineno"></span><span class="op" id="4147550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="4147553">func</span>&nbsp;<span class="op" id="4147558">(</span><span class="ident" id="4147559">p</span>&nbsp;<span class="op" id="4147561">*</span><span class="ident" id="4147562">parser</span><span class="op" id="4147568">)</span>&nbsp;<span class="ident" id="4147570">parseBranchStmt</span><span class="op" id="4147585">(</span><span class="ident" id="4147586">tok</span>&nbsp;<span class="ident" id="4147590">token</span><span class="op" id="4147595">.</span><span class="ident" id="4147596">Token</span><span class="op" id="4147601">)</span>&nbsp;<span class="op" id="4147603">*</span><span class="ident" id="4147604">ast</span><span class="op" id="4147607">.</span><span class="ident" id="4147608">BranchStmt</span>&nbsp;<span class="op" id="4147619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147622">if</span>&nbsp;<span class="ident" id="4147625">p</span><span class="op" id="4147626">.</span><span class="ident" id="4147627">trace</span>&nbsp;<span class="op" id="4147633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147637">defer</span>&nbsp;<span class="ident" id="4147643">un</span><span class="op" id="4147645">(</span><span class="ident" id="4147646">trace</span><span class="op" id="4147651">(</span><span class="ident" id="4147652">p</span><span class="op" id="4147653">,</span>&nbsp;<span class="string" id="4147655">&#34;BranchStmt&#34;</span><span class="op" id="4147667">)</span><span class="op" id="4147668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147675">pos</span>&nbsp;<span class="op" id="4147679">:=</span>&nbsp;<span class="ident" id="4147682">p</span><span class="op" id="4147683">.</span><span class="ident" id="4147684">expect</span><span class="op" id="4147690">(</span><span class="ident" id="4147691">tok</span><span class="op" id="4147694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147697">var</span>&nbsp;<span class="ident" id="4147701">label</span>&nbsp;<span class="op" id="4147707">*</span><span class="ident" id="4147708">ast</span><span class="op" id="4147711">.</span><span class="ident" id="4147712">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147719">if</span>&nbsp;<span class="ident" id="4147722">tok</span>&nbsp;<span class="op" id="4147726">!=</span>&nbsp;<span class="ident" id="4147729">token</span><span class="op" id="4147734">.</span><span class="ident" id="4147735">FALLTHROUGH</span>&nbsp;<span class="op" id="4147747">&amp;&amp;</span>&nbsp;<span class="ident" id="4147750">p</span><span class="op" id="4147751">.</span><span class="ident" id="4147752">tok</span>&nbsp;<span class="op" id="4147756">==</span>&nbsp;<span class="ident" id="4147759">token</span><span class="op" id="4147764">.</span><span class="ident" id="4147765">IDENT</span>&nbsp;<span class="op" id="4147771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147775">label</span>&nbsp;<span class="op" id="4147781">=</span>&nbsp;<span class="ident" id="4147783">p</span><span class="op" id="4147784">.</span><span class="ident" id="4147785">parseIdent</span><span class="op" id="4147795">(</span><span class="op" id="4147796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147800">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147839">n</span>&nbsp;<span class="op" id="4147841">:=</span>&nbsp;<span class="builtinfunc" id="4147844">len</span><span class="op" id="4147847">(</span><span class="ident" id="4147848">p</span><span class="op" id="4147849">.</span><span class="ident" id="4147850">targetStack</span><span class="op" id="4147861">)</span>&nbsp;<span class="op" id="4147863">-</span>&nbsp;<span class="num" id="4147865">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147869">p</span><span class="op" id="4147870">.</span><span class="ident" id="4147871">targetStack</span><span class="op" id="4147882">[</span><span class="ident" id="4147883">n</span><span class="op" id="4147884">]</span>&nbsp;<span class="op" id="4147886">=</span>&nbsp;<span class="builtinfunc" id="4147888">append</span><span class="op" id="4147894">(</span><span class="ident" id="4147895">p</span><span class="op" id="4147896">.</span><span class="ident" id="4147897">targetStack</span><span class="op" id="4147908">[</span><span class="ident" id="4147909">n</span><span class="op" id="4147910">]</span><span class="op" id="4147911">,</span>&nbsp;<span class="ident" id="4147913">label</span><span class="op" id="4147918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147924">p</span><span class="op" id="4147925">.</span><span class="ident" id="4147926">expectSemi</span><span class="op" id="4147936">(</span><span class="op" id="4147937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147941">return</span>&nbsp;<span class="op" id="4147948">&amp;</span><span class="ident" id="4147949">ast</span><span class="op" id="4147952">.</span><span class="ident" id="4147953">BranchStmt</span><span class="op" id="4147963">{</span><span class="ident" id="4147964">TokPos</span><span class="op" id="4147970">:</span>&nbsp;<span class="ident" id="4147972">pos</span><span class="op" id="4147975">,</span>&nbsp;<span class="ident" id="4147977">Tok</span><span class="op" id="4147980">:</span>&nbsp;<span class="ident" id="4147982">tok</span><span class="op" id="4147985">,</span>&nbsp;<span class="ident" id="4147987">Label</span><span class="op" id="4147992">:</span>&nbsp;<span class="ident" id="4147994">label</span><span class="op" id="4147999">}</span><br>
<span class="lineno"></span><span class="op" id="4148001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4148004">func</span>&nbsp;<span class="op" id="4148009">(</span><span class="ident" id="4148010">p</span>&nbsp;<span class="op" id="4148012">*</span><span class="ident" id="4148013">parser</span><span class="op" id="4148019">)</span>&nbsp;<span class="ident" id="4148021">makeExpr</span><span class="op" id="4148029">(</span><span class="ident" id="4148030">s</span>&nbsp;<span class="ident" id="4148032">ast</span><span class="op" id="4148035">.</span><span class="ident" id="4148036">Stmt</span><span class="op" id="4148040">,</span>&nbsp;<span class="ident" id="4148042">kind</span>&nbsp;<span class="builtintype" id="4148047">string</span><span class="op" id="4148053">)</span>&nbsp;<span class="ident" id="4148055">ast</span><span class="op" id="4148058">.</span><span class="ident" id="4148059">Expr</span>&nbsp;<span class="op" id="4148064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148067">if</span>&nbsp;<span class="ident" id="4148070">s</span>&nbsp;<span class="op" id="4148072">==</span>&nbsp;<span class="ident" id="4148075">nil</span>&nbsp;<span class="op" id="4148079">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148083">return</span>&nbsp;<span class="ident" id="4148090">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148098">if</span>&nbsp;<span class="ident" id="4148101">es</span><span class="op" id="4148103">,</span>&nbsp;<span class="ident" id="4148105">isExpr</span>&nbsp;<span class="op" id="4148112">:=</span>&nbsp;<span class="ident" id="4148115">s</span><span class="op" id="4148116">.</span><span class="op" id="4148117">(</span><span class="op" id="4148118">*</span><span class="ident" id="4148119">ast</span><span class="op" id="4148122">.</span><span class="ident" id="4148123">ExprStmt</span><span class="op" id="4148131">)</span><span class="op" id="4148132">;</span>&nbsp;<span class="ident" id="4148134">isExpr</span>&nbsp;<span class="op" id="4148141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148145">return</span>&nbsp;<span class="ident" id="4148152">p</span><span class="op" id="4148153">.</span><span class="ident" id="4148154">checkExpr</span><span class="op" id="4148163">(</span><span class="ident" id="4148164">es</span><span class="op" id="4148166">.</span><span class="ident" id="4148167">X</span><span class="op" id="4148168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148171">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148174">p</span><span class="op" id="4148175">.</span><span class="builtintype" id="4148176">error</span><span class="op" id="4148181">(</span><span class="ident" id="4148182">s</span><span class="op" id="4148183">.</span><span class="ident" id="4148184">Pos</span><span class="op" id="4148187">(</span><span class="op" id="4148188">)</span><span class="op" id="4148189">,</span>&nbsp;<span class="ident" id="4148191">fmt</span><span class="op" id="4148194">.</span><span class="ident" id="4148195">Sprintf</span><span class="op" id="4148202">(</span><span class="string" id="4148203">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="4148288">,</span>&nbsp;<span class="ident" id="4148290">kind</span><span class="op" id="4148294">)</span><span class="op" id="4148295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148298">return</span>&nbsp;<span class="op" id="4148305">&amp;</span><span class="ident" id="4148306">ast</span><span class="op" id="4148309">.</span><span class="ident" id="4148310">BadExpr</span><span class="op" id="4148317">{</span><span class="ident" id="4148318">From</span><span class="op" id="4148322">:</span>&nbsp;<span class="ident" id="4148324">s</span><span class="op" id="4148325">.</span><span class="ident" id="4148326">Pos</span><span class="op" id="4148329">(</span><span class="op" id="4148330">)</span><span class="op" id="4148331">,</span>&nbsp;<span class="ident" id="4148333">To</span><span class="op" id="4148335">:</span>&nbsp;<span class="ident" id="4148337">p</span><span class="op" id="4148338">.</span><span class="ident" id="4148339">safePos</span><span class="op" id="4148346">(</span><span class="ident" id="4148347">s</span><span class="op" id="4148348">.</span><span class="ident" id="4148349">End</span><span class="op" id="4148352">(</span><span class="op" id="4148353">)</span><span class="op" id="4148354">)</span><span class="op" id="4148355">}</span><br>
<span class="lineno"></span><span class="op" id="4148357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4148360">func</span>&nbsp;<span class="op" id="4148365">(</span><span class="ident" id="4148366">p</span>&nbsp;<span class="op" id="4148368">*</span><span class="ident" id="4148369">parser</span><span class="op" id="4148375">)</span>&nbsp;<span class="ident" id="4148377">parseIfStmt</span><span class="op" id="4148388">(</span><span class="op" id="4148389">)</span>&nbsp;<span class="op" id="4148391">*</span><span class="ident" id="4148392">ast</span><span class="op" id="4148395">.</span><span class="ident" id="4148396">IfStmt</span>&nbsp;<span class="op" id="4148403">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148406">if</span>&nbsp;<span class="ident" id="4148409">p</span><span class="op" id="4148410">.</span><span class="ident" id="4148411">trace</span>&nbsp;<span class="op" id="4148417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148421">defer</span>&nbsp;<span class="ident" id="4148427">un</span><span class="op" id="4148429">(</span><span class="ident" id="4148430">trace</span><span class="op" id="4148435">(</span><span class="ident" id="4148436">p</span><span class="op" id="4148437">,</span>&nbsp;<span class="string" id="4148439">&#34;IfStmt&#34;</span><span class="op" id="4148447">)</span><span class="op" id="4148448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148455">pos</span>&nbsp;<span class="op" id="4148459">:=</span>&nbsp;<span class="ident" id="4148462">p</span><span class="op" id="4148463">.</span><span class="ident" id="4148464">expect</span><span class="op" id="4148470">(</span><span class="ident" id="4148471">token</span><span class="op" id="4148476">.</span><span class="ident" id="4148477">IF</span><span class="op" id="4148479">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148482">p</span><span class="op" id="4148483">.</span><span class="ident" id="4148484">openScope</span><span class="op" id="4148493">(</span><span class="op" id="4148494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148497">defer</span>&nbsp;<span class="ident" id="4148503">p</span><span class="op" id="4148504">.</span><span class="ident" id="4148505">closeScope</span><span class="op" id="4148515">(</span><span class="op" id="4148516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148520">var</span>&nbsp;<span class="ident" id="4148524">s</span>&nbsp;<span class="ident" id="4148526">ast</span><span class="op" id="4148529">.</span><span class="ident" id="4148530">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148536">var</span>&nbsp;<span class="ident" id="4148540">x</span>&nbsp;<span class="ident" id="4148542">ast</span><span class="op" id="4148545">.</span><span class="ident" id="4148546">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148556">prevLev</span>&nbsp;<span class="op" id="4148564">:=</span>&nbsp;<span class="ident" id="4148567">p</span><span class="op" id="4148568">.</span><span class="ident" id="4148569">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148579">p</span><span class="op" id="4148580">.</span><span class="ident" id="4148581">exprLev</span>&nbsp;<span class="op" id="4148589">=</span>&nbsp;<span class="op" id="4148591">-</span><span class="num" id="4148592">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148596">if</span>&nbsp;<span class="ident" id="4148599">p</span><span class="op" id="4148600">.</span><span class="ident" id="4148601">tok</span>&nbsp;<span class="op" id="4148605">==</span>&nbsp;<span class="ident" id="4148608">token</span><span class="op" id="4148613">.</span><span class="ident" id="4148614">SEMICOLON</span>&nbsp;<span class="op" id="4148624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148629">p</span><span class="op" id="4148630">.</span><span class="ident" id="4148631">next</span><span class="op" id="4148635">(</span><span class="op" id="4148636">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148641">x</span>&nbsp;<span class="op" id="4148643">=</span>&nbsp;<span class="ident" id="4148645">p</span><span class="op" id="4148646">.</span><span class="ident" id="4148647">parseRhs</span><span class="op" id="4148655">(</span><span class="op" id="4148656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148660">}</span>&nbsp;<span class="keyword" id="4148662">else</span>&nbsp;<span class="op" id="4148667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148672">s</span><span class="op" id="4148673">,</span>&nbsp;<span class="ident" id="4148675">_</span>&nbsp;<span class="op" id="4148677">=</span>&nbsp;<span class="ident" id="4148679">p</span><span class="op" id="4148680">.</span><span class="ident" id="4148681">parseSimpleStmt</span><span class="op" id="4148696">(</span><span class="ident" id="4148697">basic</span><span class="op" id="4148702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148707">if</span>&nbsp;<span class="ident" id="4148710">p</span><span class="op" id="4148711">.</span><span class="ident" id="4148712">tok</span>&nbsp;<span class="op" id="4148716">==</span>&nbsp;<span class="ident" id="4148719">token</span><span class="op" id="4148724">.</span><span class="ident" id="4148725">SEMICOLON</span>&nbsp;<span class="op" id="4148735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148741">p</span><span class="op" id="4148742">.</span><span class="ident" id="4148743">next</span><span class="op" id="4148747">(</span><span class="op" id="4148748">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148754">x</span>&nbsp;<span class="op" id="4148756">=</span>&nbsp;<span class="ident" id="4148758">p</span><span class="op" id="4148759">.</span><span class="ident" id="4148760">parseRhs</span><span class="op" id="4148768">(</span><span class="op" id="4148769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148774">}</span>&nbsp;<span class="keyword" id="4148776">else</span>&nbsp;<span class="op" id="4148781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148787">x</span>&nbsp;<span class="op" id="4148789">=</span>&nbsp;<span class="ident" id="4148791">p</span><span class="op" id="4148792">.</span><span class="ident" id="4148793">makeExpr</span><span class="op" id="4148801">(</span><span class="ident" id="4148802">s</span><span class="op" id="4148803">,</span>&nbsp;<span class="string" id="4148805">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="4148825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148831">s</span>&nbsp;<span class="op" id="4148833">=</span>&nbsp;<span class="ident" id="4148835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148842">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148850">p</span><span class="op" id="4148851">.</span><span class="ident" id="4148852">exprLev</span>&nbsp;<span class="op" id="4148860">=</span>&nbsp;<span class="ident" id="4148862">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148875">body</span>&nbsp;<span class="op" id="4148880">:=</span>&nbsp;<span class="ident" id="4148883">p</span><span class="op" id="4148884">.</span><span class="ident" id="4148885">parseBlockStmt</span><span class="op" id="4148899">(</span><span class="op" id="4148900">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148903">var</span>&nbsp;<span class="ident" id="4148907">else_</span>&nbsp;<span class="ident" id="4148913">ast</span><span class="op" id="4148916">.</span><span class="ident" id="4148917">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148923">if</span>&nbsp;<span class="ident" id="4148926">p</span><span class="op" id="4148927">.</span><span class="ident" id="4148928">tok</span>&nbsp;<span class="op" id="4148932">==</span>&nbsp;<span class="ident" id="4148935">token</span><span class="op" id="4148940">.</span><span class="ident" id="4148941">ELSE</span>&nbsp;<span class="op" id="4148946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148950">p</span><span class="op" id="4148951">.</span><span class="ident" id="4148952">next</span><span class="op" id="4148956">(</span><span class="op" id="4148957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148961">else_</span>&nbsp;<span class="op" id="4148967">=</span>&nbsp;<span class="ident" id="4148969">p</span><span class="op" id="4148970">.</span><span class="ident" id="4148971">parseStmt</span><span class="op" id="4148980">(</span><span class="op" id="4148981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148984">}</span>&nbsp;<span class="keyword" id="4148986">else</span>&nbsp;<span class="op" id="4148991">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148995">p</span><span class="op" id="4148996">.</span><span class="ident" id="4148997">expectSemi</span><span class="op" id="4149007">(</span><span class="op" id="4149008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149015">return</span>&nbsp;<span class="op" id="4149022">&amp;</span><span class="ident" id="4149023">ast</span><span class="op" id="4149026">.</span><span class="ident" id="4149027">IfStmt</span><span class="op" id="4149033">{</span><span class="ident" id="4149034">If</span><span class="op" id="4149036">:</span>&nbsp;<span class="ident" id="4149038">pos</span><span class="op" id="4149041">,</span>&nbsp;<span class="ident" id="4149043">Init</span><span class="op" id="4149047">:</span>&nbsp;<span class="ident" id="4149049">s</span><span class="op" id="4149050">,</span>&nbsp;<span class="ident" id="4149052">Cond</span><span class="op" id="4149056">:</span>&nbsp;<span class="ident" id="4149058">x</span><span class="op" id="4149059">,</span>&nbsp;<span class="ident" id="4149061">Body</span><span class="op" id="4149065">:</span>&nbsp;<span class="ident" id="4149067">body</span><span class="op" id="4149071">,</span>&nbsp;<span class="ident" id="4149073">Else</span><span class="op" id="4149077">:</span>&nbsp;<span class="ident" id="4149079">else_</span><span class="op" id="4149084">}</span><br>
<span class="lineno"></span><span class="op" id="4149086">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="4149089">func</span>&nbsp;<span class="op" id="4149094">(</span><span class="ident" id="4149095">p</span>&nbsp;<span class="op" id="4149097">*</span><span class="ident" id="4149098">parser</span><span class="op" id="4149104">)</span>&nbsp;<span class="ident" id="4149106">parseTypeList</span><span class="op" id="4149119">(</span><span class="op" id="4149120">)</span>&nbsp;<span class="op" id="4149122">(</span><span class="ident" id="4149123">list</span>&nbsp;<span class="op" id="4149128">[</span><span class="op" id="4149129">]</span><span class="ident" id="4149130">ast</span><span class="op" id="4149133">.</span><span class="ident" id="4149134">Expr</span><span class="op" id="4149138">)</span>&nbsp;<span class="op" id="4149140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149143">if</span>&nbsp;<span class="ident" id="4149146">p</span><span class="op" id="4149147">.</span><span class="ident" id="4149148">trace</span>&nbsp;<span class="op" id="4149154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149158">defer</span>&nbsp;<span class="ident" id="4149164">un</span><span class="op" id="4149166">(</span><span class="ident" id="4149167">trace</span><span class="op" id="4149172">(</span><span class="ident" id="4149173">p</span><span class="op" id="4149174">,</span>&nbsp;<span class="string" id="4149176">&#34;TypeList&#34;</span><span class="op" id="4149186">)</span><span class="op" id="4149187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149190">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149194">list</span>&nbsp;<span class="op" id="4149199">=</span>&nbsp;<span class="builtinfunc" id="4149201">append</span><span class="op" id="4149207">(</span><span class="ident" id="4149208">list</span><span class="op" id="4149212">,</span>&nbsp;<span class="ident" id="4149214">p</span><span class="op" id="4149215">.</span><span class="ident" id="4149216">parseType</span><span class="op" id="4149225">(</span><span class="op" id="4149226">)</span><span class="op" id="4149227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149230">for</span>&nbsp;<span class="ident" id="4149234">p</span><span class="op" id="4149235">.</span><span class="ident" id="4149236">tok</span>&nbsp;<span class="op" id="4149240">==</span>&nbsp;<span class="ident" id="4149243">token</span><span class="op" id="4149248">.</span><span class="ident" id="4149249">COMMA</span>&nbsp;<span class="op" id="4149255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149259">p</span><span class="op" id="4149260">.</span><span class="ident" id="4149261">next</span><span class="op" id="4149265">(</span><span class="op" id="4149266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149270">list</span>&nbsp;<span class="op" id="4149275">=</span>&nbsp;<span class="builtinfunc" id="4149277">append</span><span class="op" id="4149283">(</span><span class="ident" id="4149284">list</span><span class="op" id="4149288">,</span>&nbsp;<span class="ident" id="4149290">p</span><span class="op" id="4149291">.</span><span class="ident" id="4149292">parseType</span><span class="op" id="4149301">(</span><span class="op" id="4149302">)</span><span class="op" id="4149303">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149310">return</span><br>
<span class="lineno"></span><span class="op" id="4149317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="4149320">func</span>&nbsp;<span class="op" id="4149325">(</span><span class="ident" id="4149326">p</span>&nbsp;<span class="op" id="4149328">*</span><span class="ident" id="4149329">parser</span><span class="op" id="4149335">)</span>&nbsp;<span class="ident" id="4149337">parseCaseClause</span><span class="op" id="4149352">(</span><span class="ident" id="4149353">typeSwitch</span>&nbsp;<span class="builtintype" id="4149364">bool</span><span class="op" id="4149368">)</span>&nbsp;<span class="op" id="4149370">*</span><span class="ident" id="4149371">ast</span><span class="op" id="4149374">.</span><span class="ident" id="4149375">CaseClause</span>&nbsp;<span class="op" id="4149386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149389">if</span>&nbsp;<span class="ident" id="4149392">p</span><span class="op" id="4149393">.</span><span class="ident" id="4149394">trace</span>&nbsp;<span class="op" id="4149400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149404">defer</span>&nbsp;<span class="ident" id="4149410">un</span><span class="op" id="4149412">(</span><span class="ident" id="4149413">trace</span><span class="op" id="4149418">(</span><span class="ident" id="4149419">p</span><span class="op" id="4149420">,</span>&nbsp;<span class="string" id="4149422">&#34;CaseClause&#34;</span><span class="op" id="4149434">)</span><span class="op" id="4149435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149442">pos</span>&nbsp;<span class="op" id="4149446">:=</span>&nbsp;<span class="ident" id="4149449">p</span><span class="op" id="4149450">.</span><span class="ident" id="4149451">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149456">var</span>&nbsp;<span class="ident" id="4149460">list</span>&nbsp;<span class="op" id="4149465">[</span><span class="op" id="4149466">]</span><span class="ident" id="4149467">ast</span><span class="op" id="4149470">.</span><span class="ident" id="4149471">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149477">if</span>&nbsp;<span class="ident" id="4149480">p</span><span class="op" id="4149481">.</span><span class="ident" id="4149482">tok</span>&nbsp;<span class="op" id="4149486">==</span>&nbsp;<span class="ident" id="4149489">token</span><span class="op" id="4149494">.</span><span class="ident" id="4149495">CASE</span>&nbsp;<span class="op" id="4149500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149504">p</span><span class="op" id="4149505">.</span><span class="ident" id="4149506">next</span><span class="op" id="4149510">(</span><span class="op" id="4149511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149515">if</span>&nbsp;<span class="ident" id="4149518">typeSwitch</span>&nbsp;<span class="op" id="4149529">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149534">list</span>&nbsp;<span class="op" id="4149539">=</span>&nbsp;<span class="ident" id="4149541">p</span><span class="op" id="4149542">.</span><span class="ident" id="4149543">parseTypeList</span><span class="op" id="4149556">(</span><span class="op" id="4149557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149561">}</span>&nbsp;<span class="keyword" id="4149563">else</span>&nbsp;<span class="op" id="4149568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149573">list</span>&nbsp;<span class="op" id="4149578">=</span>&nbsp;<span class="ident" id="4149580">p</span><span class="op" id="4149581">.</span><span class="ident" id="4149582">parseRhsList</span><span class="op" id="4149594">(</span><span class="op" id="4149595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149602">}</span>&nbsp;<span class="keyword" id="4149604">else</span>&nbsp;<span class="op" id="4149609">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149613">p</span><span class="op" id="4149614">.</span><span class="ident" id="4149615">expect</span><span class="op" id="4149621">(</span><span class="ident" id="4149622">token</span><span class="op" id="4149627">.</span><span class="ident" id="4149628">DEFAULT</span><span class="op" id="4149635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149642">colon</span>&nbsp;<span class="op" id="4149648">:=</span>&nbsp;<span class="ident" id="4149651">p</span><span class="op" id="4149652">.</span><span class="ident" id="4149653">expect</span><span class="op" id="4149659">(</span><span class="ident" id="4149660">token</span><span class="op" id="4149665">.</span><span class="ident" id="4149666">COLON</span><span class="op" id="4149671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149674">p</span><span class="op" id="4149675">.</span><span class="ident" id="4149676">openScope</span><span class="op" id="4149685">(</span><span class="op" id="4149686">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149689">body</span>&nbsp;<span class="op" id="4149694">:=</span>&nbsp;<span class="ident" id="4149697">p</span><span class="op" id="4149698">.</span><span class="ident" id="4149699">parseStmtList</span><span class="op" id="4149712">(</span><span class="op" id="4149713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149716">p</span><span class="op" id="4149717">.</span><span class="ident" id="4149718">closeScope</span><span class="op" id="4149728">(</span><span class="op" id="4149729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149733">return</span>&nbsp;<span class="op" id="4149740">&amp;</span><span class="ident" id="4149741">ast</span><span class="op" id="4149744">.</span><span class="ident" id="4149745">CaseClause</span><span class="op" id="4149755">{</span><span class="ident" id="4149756">Case</span><span class="op" id="4149760">:</span>&nbsp;<span class="ident" id="4149762">pos</span><span class="op" id="4149765">,</span>&nbsp;<span class="ident" id="4149767">List</span><span class="op" id="4149771">:</span>&nbsp;<span class="ident" id="4149773">list</span><span class="op" id="4149777">,</span>&nbsp;<span class="ident" id="4149779">Colon</span><span class="op" id="4149784">:</span>&nbsp;<span class="ident" id="4149786">colon</span><span class="op" id="4149791">,</span>&nbsp;<span class="ident" id="4149793">Body</span><span class="op" id="4149797">:</span>&nbsp;<span class="ident" id="4149799">body</span><span class="op" id="4149803">}</span><br>
<span class="lineno"></span><span class="op" id="4149805">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="4149808">func</span>&nbsp;<span class="ident" id="4149813">isTypeSwitchAssert</span><span class="op" id="4149831">(</span><span class="ident" id="4149832">x</span>&nbsp;<span class="ident" id="4149834">ast</span><span class="op" id="4149837">.</span><span class="ident" id="4149838">Expr</span><span class="op" id="4149842">)</span>&nbsp;<span class="builtintype" id="4149844">bool</span>&nbsp;<span class="op" id="4149849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149852">a</span><span class="op" id="4149853">,</span>&nbsp;<span class="ident" id="4149855">ok</span>&nbsp;<span class="op" id="4149858">:=</span>&nbsp;<span class="ident" id="4149861">x</span><span class="op" id="4149862">.</span><span class="op" id="4149863">(</span><span class="op" id="4149864">*</span><span class="ident" id="4149865">ast</span><span class="op" id="4149868">.</span><span class="ident" id="4149869">TypeAssertExpr</span><span class="op" id="4149883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149886">return</span>&nbsp;<span class="ident" id="4149893">ok</span>&nbsp;<span class="op" id="4149896">&amp;&amp;</span>&nbsp;<span class="ident" id="4149899">a</span><span class="op" id="4149900">.</span><span class="ident" id="4149901">Type</span>&nbsp;<span class="op" id="4149906">==</span>&nbsp;<span class="ident" id="4149909">nil</span><br>
<span class="lineno"></span><span class="op" id="4149913">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="4149916">func</span>&nbsp;<span class="ident" id="4149921">isTypeSwitchGuard</span><span class="op" id="4149938">(</span><span class="ident" id="4149939">s</span>&nbsp;<span class="ident" id="4149941">ast</span><span class="op" id="4149944">.</span><span class="ident" id="4149945">Stmt</span><span class="op" id="4149949">)</span>&nbsp;<span class="builtintype" id="4149951">bool</span>&nbsp;<span class="op" id="4149956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149959">switch</span>&nbsp;<span class="ident" id="4149966">t</span>&nbsp;<span class="op" id="4149968">:=</span>&nbsp;<span class="ident" id="4149971">s</span><span class="op" id="4149972">.</span><span class="op" id="4149973">(</span><span class="keyword" id="4149974">type</span><span class="op" id="4149978">)</span>&nbsp;<span class="op" id="4149980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149983">case</span>&nbsp;<span class="op" id="4149988">*</span><span class="ident" id="4149989">ast</span><span class="op" id="4149992">.</span><span class="ident" id="4149993">ExprStmt</span><span class="op" id="4150001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150005">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150018">return</span>&nbsp;<span class="ident" id="4150025">isTypeSwitchAssert</span><span class="op" id="4150043">(</span><span class="ident" id="4150044">t</span><span class="op" id="4150045">.</span><span class="ident" id="4150046">X</span><span class="op" id="4150047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150050">case</span>&nbsp;<span class="op" id="4150055">*</span><span class="ident" id="4150056">ast</span><span class="op" id="4150059">.</span><span class="ident" id="4150060">AssignStmt</span><span class="op" id="4150070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150074">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150092">return</span>&nbsp;<span class="builtinfunc" id="4150099">len</span><span class="op" id="4150102">(</span><span class="ident" id="4150103">t</span><span class="op" id="4150104">.</span><span class="ident" id="4150105">Lhs</span><span class="op" id="4150108">)</span>&nbsp;<span class="op" id="4150110">==</span>&nbsp;<span class="num" id="4150113">1</span>&nbsp;<span class="op" id="4150115">&amp;&amp;</span>&nbsp;<span class="ident" id="4150118">t</span><span class="op" id="4150119">.</span><span class="ident" id="4150120">Tok</span>&nbsp;<span class="op" id="4150124">==</span>&nbsp;<span class="ident" id="4150127">token</span><span class="op" id="4150132">.</span><span class="ident" id="4150133">DEFINE</span>&nbsp;<span class="op" id="4150140">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4150143">len</span><span class="op" id="4150146">(</span><span class="ident" id="4150147">t</span><span class="op" id="4150148">.</span><span class="ident" id="4150149">Rhs</span><span class="op" id="4150152">)</span>&nbsp;<span class="op" id="4150154">==</span>&nbsp;<span class="num" id="4150157">1</span>&nbsp;<span class="op" id="4150159">&amp;&amp;</span>&nbsp;<span class="ident" id="4150162">isTypeSwitchAssert</span><span class="op" id="4150180">(</span><span class="ident" id="4150181">t</span><span class="op" id="4150182">.</span><span class="ident" id="4150183">Rhs</span><span class="op" id="4150186">[</span><span class="num" id="4150187">0</span><span class="op" id="4150188">]</span><span class="op" id="4150189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150192">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150195">return</span>&nbsp;<span class="builtintype" id="4150202">false</span><br>
<span class="lineno"></span><span class="op" id="4150208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4150211">func</span>&nbsp;<span class="op" id="4150216">(</span><span class="ident" id="4150217">p</span>&nbsp;<span class="op" id="4150219">*</span><span class="ident" id="4150220">parser</span><span class="op" id="4150226">)</span>&nbsp;<span class="ident" id="4150228">parseSwitchStmt</span><span class="op" id="4150243">(</span><span class="op" id="4150244">)</span>&nbsp;<span class="ident" id="4150246">ast</span><span class="op" id="4150249">.</span><span class="ident" id="4150250">Stmt</span>&nbsp;<span class="op" id="4150255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150258">if</span>&nbsp;<span class="ident" id="4150261">p</span><span class="op" id="4150262">.</span><span class="ident" id="4150263">trace</span>&nbsp;<span class="op" id="4150269">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150273">defer</span>&nbsp;<span class="ident" id="4150279">un</span><span class="op" id="4150281">(</span><span class="ident" id="4150282">trace</span><span class="op" id="4150287">(</span><span class="ident" id="4150288">p</span><span class="op" id="4150289">,</span>&nbsp;<span class="string" id="4150291">&#34;SwitchStmt&#34;</span><span class="op" id="4150303">)</span><span class="op" id="4150304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150311">pos</span>&nbsp;<span class="op" id="4150315">:=</span>&nbsp;<span class="ident" id="4150318">p</span><span class="op" id="4150319">.</span><span class="ident" id="4150320">expect</span><span class="op" id="4150326">(</span><span class="ident" id="4150327">token</span><span class="op" id="4150332">.</span><span class="ident" id="4150333">SWITCH</span><span class="op" id="4150339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150342">p</span><span class="op" id="4150343">.</span><span class="ident" id="4150344">openScope</span><span class="op" id="4150353">(</span><span class="op" id="4150354">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150357">defer</span>&nbsp;<span class="ident" id="4150363">p</span><span class="op" id="4150364">.</span><span class="ident" id="4150365">closeScope</span><span class="op" id="4150375">(</span><span class="op" id="4150376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150380">var</span>&nbsp;<span class="ident" id="4150384">s1</span><span class="op" id="4150386">,</span>&nbsp;<span class="ident" id="4150388">s2</span>&nbsp;<span class="ident" id="4150391">ast</span><span class="op" id="4150394">.</span><span class="ident" id="4150395">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150401">if</span>&nbsp;<span class="ident" id="4150404">p</span><span class="op" id="4150405">.</span><span class="ident" id="4150406">tok</span>&nbsp;<span class="op" id="4150410">!=</span>&nbsp;<span class="ident" id="4150413">token</span><span class="op" id="4150418">.</span><span class="ident" id="4150419">LBRACE</span>&nbsp;<span class="op" id="4150426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150430">prevLev</span>&nbsp;<span class="op" id="4150438">:=</span>&nbsp;<span class="ident" id="4150441">p</span><span class="op" id="4150442">.</span><span class="ident" id="4150443">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150453">p</span><span class="op" id="4150454">.</span><span class="ident" id="4150455">exprLev</span>&nbsp;<span class="op" id="4150463">=</span>&nbsp;<span class="op" id="4150465">-</span><span class="num" id="4150466">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150470">if</span>&nbsp;<span class="ident" id="4150473">p</span><span class="op" id="4150474">.</span><span class="ident" id="4150475">tok</span>&nbsp;<span class="op" id="4150479">!=</span>&nbsp;<span class="ident" id="4150482">token</span><span class="op" id="4150487">.</span><span class="ident" id="4150488">SEMICOLON</span>&nbsp;<span class="op" id="4150498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150503">s2</span><span class="op" id="4150505">,</span>&nbsp;<span class="ident" id="4150507">_</span>&nbsp;<span class="op" id="4150509">=</span>&nbsp;<span class="ident" id="4150511">p</span><span class="op" id="4150512">.</span><span class="ident" id="4150513">parseSimpleStmt</span><span class="op" id="4150528">(</span><span class="ident" id="4150529">basic</span><span class="op" id="4150534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150542">if</span>&nbsp;<span class="ident" id="4150545">p</span><span class="op" id="4150546">.</span><span class="ident" id="4150547">tok</span>&nbsp;<span class="op" id="4150551">==</span>&nbsp;<span class="ident" id="4150554">token</span><span class="op" id="4150559">.</span><span class="ident" id="4150560">SEMICOLON</span>&nbsp;<span class="op" id="4150570">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150575">p</span><span class="op" id="4150576">.</span><span class="ident" id="4150577">next</span><span class="op" id="4150581">(</span><span class="op" id="4150582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150587">s1</span>&nbsp;<span class="op" id="4150590">=</span>&nbsp;<span class="ident" id="4150592">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150598">s2</span>&nbsp;<span class="op" id="4150601">=</span>&nbsp;<span class="ident" id="4150603">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150610">if</span>&nbsp;<span class="ident" id="4150613">p</span><span class="op" id="4150614">.</span><span class="ident" id="4150615">tok</span>&nbsp;<span class="op" id="4150619">!=</span>&nbsp;<span class="ident" id="4150622">token</span><span class="op" id="4150627">.</span><span class="ident" id="4150628">LBRACE</span>&nbsp;<span class="op" id="4150635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150641">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150701">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150760">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150820">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150827">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150868">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150875">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150929">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150989">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151044">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151051">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151116">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151180">p</span><span class="op" id="4151181">.</span><span class="ident" id="4151182">openScope</span><span class="op" id="4151191">(</span><span class="op" id="4151192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151198">defer</span>&nbsp;<span class="ident" id="4151204">p</span><span class="op" id="4151205">.</span><span class="ident" id="4151206">closeScope</span><span class="op" id="4151216">(</span><span class="op" id="4151217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151223">s2</span><span class="op" id="4151225">,</span>&nbsp;<span class="ident" id="4151227">_</span>&nbsp;<span class="op" id="4151229">=</span>&nbsp;<span class="ident" id="4151231">p</span><span class="op" id="4151232">.</span><span class="ident" id="4151233">parseSimpleStmt</span><span class="op" id="4151248">(</span><span class="ident" id="4151249">basic</span><span class="op" id="4151254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151259">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151267">p</span><span class="op" id="4151268">.</span><span class="ident" id="4151269">exprLev</span>&nbsp;<span class="op" id="4151277">=</span>&nbsp;<span class="ident" id="4151279">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151292">typeSwitch</span>&nbsp;<span class="op" id="4151303">:=</span>&nbsp;<span class="ident" id="4151306">isTypeSwitchGuard</span><span class="op" id="4151323">(</span><span class="ident" id="4151324">s2</span><span class="op" id="4151326">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151329">lbrace</span>&nbsp;<span class="op" id="4151336">:=</span>&nbsp;<span class="ident" id="4151339">p</span><span class="op" id="4151340">.</span><span class="ident" id="4151341">expect</span><span class="op" id="4151347">(</span><span class="ident" id="4151348">token</span><span class="op" id="4151353">.</span><span class="ident" id="4151354">LBRACE</span><span class="op" id="4151360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151363">var</span>&nbsp;<span class="ident" id="4151367">list</span>&nbsp;<span class="op" id="4151372">[</span><span class="op" id="4151373">]</span><span class="ident" id="4151374">ast</span><span class="op" id="4151377">.</span><span class="ident" id="4151378">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151384">for</span>&nbsp;<span class="ident" id="4151388">p</span><span class="op" id="4151389">.</span><span class="ident" id="4151390">tok</span>&nbsp;<span class="op" id="4151394">==</span>&nbsp;<span class="ident" id="4151397">token</span><span class="op" id="4151402">.</span><span class="ident" id="4151403">CASE</span>&nbsp;<span class="op" id="4151408">||</span>&nbsp;<span class="ident" id="4151411">p</span><span class="op" id="4151412">.</span><span class="ident" id="4151413">tok</span>&nbsp;<span class="op" id="4151417">==</span>&nbsp;<span class="ident" id="4151420">token</span><span class="op" id="4151425">.</span><span class="ident" id="4151426">DEFAULT</span>&nbsp;<span class="op" id="4151434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151438">list</span>&nbsp;<span class="op" id="4151443">=</span>&nbsp;<span class="builtinfunc" id="4151445">append</span><span class="op" id="4151451">(</span><span class="ident" id="4151452">list</span><span class="op" id="4151456">,</span>&nbsp;<span class="ident" id="4151458">p</span><span class="op" id="4151459">.</span><span class="ident" id="4151460">parseCaseClause</span><span class="op" id="4151475">(</span><span class="ident" id="4151476">typeSwitch</span><span class="op" id="4151486">)</span><span class="op" id="4151487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151490">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151493">rbrace</span>&nbsp;<span class="op" id="4151500">:=</span>&nbsp;<span class="ident" id="4151503">p</span><span class="op" id="4151504">.</span><span class="ident" id="4151505">expect</span><span class="op" id="4151511">(</span><span class="ident" id="4151512">token</span><span class="op" id="4151517">.</span><span class="ident" id="4151518">RBRACE</span><span class="op" id="4151524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151527">p</span><span class="op" id="4151528">.</span><span class="ident" id="4151529">expectSemi</span><span class="op" id="4151539">(</span><span class="op" id="4151540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151543">body</span>&nbsp;<span class="op" id="4151548">:=</span>&nbsp;<span class="op" id="4151551">&amp;</span><span class="ident" id="4151552">ast</span><span class="op" id="4151555">.</span><span class="ident" id="4151556">BlockStmt</span><span class="op" id="4151565">{</span><span class="ident" id="4151566">Lbrace</span><span class="op" id="4151572">:</span>&nbsp;<span class="ident" id="4151574">lbrace</span><span class="op" id="4151580">,</span>&nbsp;<span class="ident" id="4151582">List</span><span class="op" id="4151586">:</span>&nbsp;<span class="ident" id="4151588">list</span><span class="op" id="4151592">,</span>&nbsp;<span class="ident" id="4151594">Rbrace</span><span class="op" id="4151600">:</span>&nbsp;<span class="ident" id="4151602">rbrace</span><span class="op" id="4151608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151612">if</span>&nbsp;<span class="ident" id="4151615">typeSwitch</span>&nbsp;<span class="op" id="4151626">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151630">return</span>&nbsp;<span class="op" id="4151637">&amp;</span><span class="ident" id="4151638">ast</span><span class="op" id="4151641">.</span><span class="ident" id="4151642">TypeSwitchStmt</span><span class="op" id="4151656">{</span><span class="ident" id="4151657">Switch</span><span class="op" id="4151663">:</span>&nbsp;<span class="ident" id="4151665">pos</span><span class="op" id="4151668">,</span>&nbsp;<span class="ident" id="4151670">Init</span><span class="op" id="4151674">:</span>&nbsp;<span class="ident" id="4151676">s1</span><span class="op" id="4151678">,</span>&nbsp;<span class="ident" id="4151680">Assign</span><span class="op" id="4151686">:</span>&nbsp;<span class="ident" id="4151688">s2</span><span class="op" id="4151690">,</span>&nbsp;<span class="ident" id="4151692">Body</span><span class="op" id="4151696">:</span>&nbsp;<span class="ident" id="4151698">body</span><span class="op" id="4151702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151709">return</span>&nbsp;<span class="op" id="4151716">&amp;</span><span class="ident" id="4151717">ast</span><span class="op" id="4151720">.</span><span class="ident" id="4151721">SwitchStmt</span><span class="op" id="4151731">{</span><span class="ident" id="4151732">Switch</span><span class="op" id="4151738">:</span>&nbsp;<span class="ident" id="4151740">pos</span><span class="op" id="4151743">,</span>&nbsp;<span class="ident" id="4151745">Init</span><span class="op" id="4151749">:</span>&nbsp;<span class="ident" id="4151751">s1</span><span class="op" id="4151753">,</span>&nbsp;<span class="ident" id="4151755">Tag</span><span class="op" id="4151758">:</span>&nbsp;<span class="ident" id="4151760">p</span><span class="op" id="4151761">.</span><span class="ident" id="4151762">makeExpr</span><span class="op" id="4151770">(</span><span class="ident" id="4151771">s2</span><span class="op" id="4151773">,</span>&nbsp;<span class="string" id="4151775">&#34;switch&nbsp;expression&#34;</span><span class="op" id="4151794">)</span><span class="op" id="4151795">,</span>&nbsp;<span class="ident" id="4151797">Body</span><span class="op" id="4151801">:</span>&nbsp;<span class="ident" id="4151803">body</span><span class="op" id="4151807">}</span><br>
<span class="lineno"></span><span class="op" id="4151809">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="4151812">func</span>&nbsp;<span class="op" id="4151817">(</span><span class="ident" id="4151818">p</span>&nbsp;<span class="op" id="4151820">*</span><span class="ident" id="4151821">parser</span><span class="op" id="4151827">)</span>&nbsp;<span class="ident" id="4151829">parseCommClause</span><span class="op" id="4151844">(</span><span class="op" id="4151845">)</span>&nbsp;<span class="op" id="4151847">*</span><span class="ident" id="4151848">ast</span><span class="op" id="4151851">.</span><span class="ident" id="4151852">CommClause</span>&nbsp;<span class="op" id="4151863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151866">if</span>&nbsp;<span class="ident" id="4151869">p</span><span class="op" id="4151870">.</span><span class="ident" id="4151871">trace</span>&nbsp;<span class="op" id="4151877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151881">defer</span>&nbsp;<span class="ident" id="4151887">un</span><span class="op" id="4151889">(</span><span class="ident" id="4151890">trace</span><span class="op" id="4151895">(</span><span class="ident" id="4151896">p</span><span class="op" id="4151897">,</span>&nbsp;<span class="string" id="4151899">&#34;CommClause&#34;</span><span class="op" id="4151911">)</span><span class="op" id="4151912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151915">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151919">p</span><span class="op" id="4151920">.</span><span class="ident" id="4151921">openScope</span><span class="op" id="4151930">(</span><span class="op" id="4151931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151934">pos</span>&nbsp;<span class="op" id="4151938">:=</span>&nbsp;<span class="ident" id="4151941">p</span><span class="op" id="4151942">.</span><span class="ident" id="4151943">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151948">var</span>&nbsp;<span class="ident" id="4151952">comm</span>&nbsp;<span class="ident" id="4151957">ast</span><span class="op" id="4151960">.</span><span class="ident" id="4151961">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151967">if</span>&nbsp;<span class="ident" id="4151970">p</span><span class="op" id="4151971">.</span><span class="ident" id="4151972">tok</span>&nbsp;<span class="op" id="4151976">==</span>&nbsp;<span class="ident" id="4151979">token</span><span class="op" id="4151984">.</span><span class="ident" id="4151985">CASE</span>&nbsp;<span class="op" id="4151990">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151994">p</span><span class="op" id="4151995">.</span><span class="ident" id="4151996">next</span><span class="op" id="4152000">(</span><span class="op" id="4152001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152005">lhs</span>&nbsp;<span class="op" id="4152009">:=</span>&nbsp;<span class="ident" id="4152012">p</span><span class="op" id="4152013">.</span><span class="ident" id="4152014">parseLhsList</span><span class="op" id="4152026">(</span><span class="op" id="4152027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152031">if</span>&nbsp;<span class="ident" id="4152034">p</span><span class="op" id="4152035">.</span><span class="ident" id="4152036">tok</span>&nbsp;<span class="op" id="4152040">==</span>&nbsp;<span class="ident" id="4152043">token</span><span class="op" id="4152048">.</span><span class="ident" id="4152049">ARROW</span>&nbsp;<span class="op" id="4152055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152060">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152075">if</span>&nbsp;<span class="builtinfunc" id="4152078">len</span><span class="op" id="4152081">(</span><span class="ident" id="4152082">lhs</span><span class="op" id="4152085">)</span>&nbsp;<span class="op" id="4152087">&gt;</span>&nbsp;<span class="num" id="4152089">1</span>&nbsp;<span class="op" id="4152091">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152097">p</span><span class="op" id="4152098">.</span><span class="ident" id="4152099">errorExpected</span><span class="op" id="4152112">(</span><span class="ident" id="4152113">lhs</span><span class="op" id="4152116">[</span><span class="num" id="4152117">0</span><span class="op" id="4152118">]</span><span class="op" id="4152119">.</span><span class="ident" id="4152120">Pos</span><span class="op" id="4152123">(</span><span class="op" id="4152124">)</span><span class="op" id="4152125">,</span>&nbsp;<span class="string" id="4152127">&#34;1&nbsp;expression&#34;</span><span class="op" id="4152141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152147">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152189">arrow</span>&nbsp;<span class="op" id="4152195">:=</span>&nbsp;<span class="ident" id="4152198">p</span><span class="op" id="4152199">.</span><span class="ident" id="4152200">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152207">p</span><span class="op" id="4152208">.</span><span class="ident" id="4152209">next</span><span class="op" id="4152213">(</span><span class="op" id="4152214">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152219">rhs</span>&nbsp;<span class="op" id="4152223">:=</span>&nbsp;<span class="ident" id="4152226">p</span><span class="op" id="4152227">.</span><span class="ident" id="4152228">parseRhs</span><span class="op" id="4152236">(</span><span class="op" id="4152237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152242">comm</span>&nbsp;<span class="op" id="4152247">=</span>&nbsp;<span class="op" id="4152249">&amp;</span><span class="ident" id="4152250">ast</span><span class="op" id="4152253">.</span><span class="ident" id="4152254">SendStmt</span><span class="op" id="4152262">{</span><span class="ident" id="4152263">Chan</span><span class="op" id="4152267">:</span>&nbsp;<span class="ident" id="4152269">lhs</span><span class="op" id="4152272">[</span><span class="num" id="4152273">0</span><span class="op" id="4152274">]</span><span class="op" id="4152275">,</span>&nbsp;<span class="ident" id="4152277">Arrow</span><span class="op" id="4152282">:</span>&nbsp;<span class="ident" id="4152284">arrow</span><span class="op" id="4152289">,</span>&nbsp;<span class="ident" id="4152291">Value</span><span class="op" id="4152296">:</span>&nbsp;<span class="ident" id="4152298">rhs</span><span class="op" id="4152301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152305">}</span>&nbsp;<span class="keyword" id="4152307">else</span>&nbsp;<span class="op" id="4152312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152317">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152332">if</span>&nbsp;<span class="ident" id="4152335">tok</span>&nbsp;<span class="op" id="4152339">:=</span>&nbsp;<span class="ident" id="4152342">p</span><span class="op" id="4152343">.</span><span class="ident" id="4152344">tok</span><span class="op" id="4152347">;</span>&nbsp;<span class="ident" id="4152349">tok</span>&nbsp;<span class="op" id="4152353">==</span>&nbsp;<span class="ident" id="4152356">token</span><span class="op" id="4152361">.</span><span class="ident" id="4152362">ASSIGN</span>&nbsp;<span class="op" id="4152369">||</span>&nbsp;<span class="ident" id="4152372">tok</span>&nbsp;<span class="op" id="4152376">==</span>&nbsp;<span class="ident" id="4152379">token</span><span class="op" id="4152384">.</span><span class="ident" id="4152385">DEFINE</span>&nbsp;<span class="op" id="4152392">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152398">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152430">if</span>&nbsp;<span class="builtinfunc" id="4152433">len</span><span class="op" id="4152436">(</span><span class="ident" id="4152437">lhs</span><span class="op" id="4152440">)</span>&nbsp;<span class="op" id="4152442">&gt;</span>&nbsp;<span class="num" id="4152444">2</span>&nbsp;<span class="op" id="4152446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152453">p</span><span class="op" id="4152454">.</span><span class="ident" id="4152455">errorExpected</span><span class="op" id="4152468">(</span><span class="ident" id="4152469">lhs</span><span class="op" id="4152472">[</span><span class="num" id="4152473">0</span><span class="op" id="4152474">]</span><span class="op" id="4152475">.</span><span class="ident" id="4152476">Pos</span><span class="op" id="4152479">(</span><span class="op" id="4152480">)</span><span class="op" id="4152481">,</span>&nbsp;<span class="string" id="4152483">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4152503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152510">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152554">lhs</span>&nbsp;<span class="op" id="4152558">=</span>&nbsp;<span class="ident" id="4152560">lhs</span><span class="op" id="4152563">[</span><span class="num" id="4152564">0</span><span class="op" id="4152565">:</span><span class="num" id="4152566">2</span><span class="op" id="4152567">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152579">pos</span>&nbsp;<span class="op" id="4152583">:=</span>&nbsp;<span class="ident" id="4152586">p</span><span class="op" id="4152587">.</span><span class="ident" id="4152588">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152596">p</span><span class="op" id="4152597">.</span><span class="ident" id="4152598">next</span><span class="op" id="4152602">(</span><span class="op" id="4152603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152609">rhs</span>&nbsp;<span class="op" id="4152613">:=</span>&nbsp;<span class="ident" id="4152616">p</span><span class="op" id="4152617">.</span><span class="ident" id="4152618">parseRhs</span><span class="op" id="4152626">(</span><span class="op" id="4152627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152633">as</span>&nbsp;<span class="op" id="4152636">:=</span>&nbsp;<span class="op" id="4152639">&amp;</span><span class="ident" id="4152640">ast</span><span class="op" id="4152643">.</span><span class="ident" id="4152644">AssignStmt</span><span class="op" id="4152654">{</span><span class="ident" id="4152655">Lhs</span><span class="op" id="4152658">:</span>&nbsp;<span class="ident" id="4152660">lhs</span><span class="op" id="4152663">,</span>&nbsp;<span class="ident" id="4152665">TokPos</span><span class="op" id="4152671">:</span>&nbsp;<span class="ident" id="4152673">pos</span><span class="op" id="4152676">,</span>&nbsp;<span class="ident" id="4152678">Tok</span><span class="op" id="4152681">:</span>&nbsp;<span class="ident" id="4152683">tok</span><span class="op" id="4152686">,</span>&nbsp;<span class="ident" id="4152688">Rhs</span><span class="op" id="4152691">:</span>&nbsp;<span class="op" id="4152693">[</span><span class="op" id="4152694">]</span><span class="ident" id="4152695">ast</span><span class="op" id="4152698">.</span><span class="ident" id="4152699">Expr</span><span class="op" id="4152703">{</span><span class="ident" id="4152704">rhs</span><span class="op" id="4152707">}</span><span class="op" id="4152708">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152714">if</span>&nbsp;<span class="ident" id="4152717">tok</span>&nbsp;<span class="op" id="4152721">==</span>&nbsp;<span class="ident" id="4152724">token</span><span class="op" id="4152729">.</span><span class="ident" id="4152730">DEFINE</span>&nbsp;<span class="op" id="4152737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152744">p</span><span class="op" id="4152745">.</span><span class="ident" id="4152746">shortVarDecl</span><span class="op" id="4152758">(</span><span class="ident" id="4152759">as</span><span class="op" id="4152761">,</span>&nbsp;<span class="ident" id="4152763">lhs</span><span class="op" id="4152766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152778">comm</span>&nbsp;<span class="op" id="4152783">=</span>&nbsp;<span class="ident" id="4152785">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152791">}</span>&nbsp;<span class="keyword" id="4152793">else</span>&nbsp;<span class="op" id="4152798">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152804">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152848">if</span>&nbsp;<span class="builtinfunc" id="4152851">len</span><span class="op" id="4152854">(</span><span class="ident" id="4152855">lhs</span><span class="op" id="4152858">)</span>&nbsp;<span class="op" id="4152860">&gt;</span>&nbsp;<span class="num" id="4152862">1</span>&nbsp;<span class="op" id="4152864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152871">p</span><span class="op" id="4152872">.</span><span class="ident" id="4152873">errorExpected</span><span class="op" id="4152886">(</span><span class="ident" id="4152887">lhs</span><span class="op" id="4152890">[</span><span class="num" id="4152891">0</span><span class="op" id="4152892">]</span><span class="op" id="4152893">.</span><span class="ident" id="4152894">Pos</span><span class="op" id="4152897">(</span><span class="op" id="4152898">)</span><span class="op" id="4152899">,</span>&nbsp;<span class="string" id="4152901">&#34;1&nbsp;expression&#34;</span><span class="op" id="4152915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152922">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152960">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152966">comm</span>&nbsp;<span class="op" id="4152971">=</span>&nbsp;<span class="op" id="4152973">&amp;</span><span class="ident" id="4152974">ast</span><span class="op" id="4152977">.</span><span class="ident" id="4152978">ExprStmt</span><span class="op" id="4152986">{</span><span class="ident" id="4152987">X</span><span class="op" id="4152988">:</span>&nbsp;<span class="ident" id="4152990">lhs</span><span class="op" id="4152993">[</span><span class="num" id="4152994">0</span><span class="op" id="4152995">]</span><span class="op" id="4152996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153008">}</span>&nbsp;<span class="keyword" id="4153010">else</span>&nbsp;<span class="op" id="4153015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153019">p</span><span class="op" id="4153020">.</span><span class="ident" id="4153021">expect</span><span class="op" id="4153027">(</span><span class="ident" id="4153028">token</span><span class="op" id="4153033">.</span><span class="ident" id="4153034">DEFAULT</span><span class="op" id="4153041">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153048">colon</span>&nbsp;<span class="op" id="4153054">:=</span>&nbsp;<span class="ident" id="4153057">p</span><span class="op" id="4153058">.</span><span class="ident" id="4153059">expect</span><span class="op" id="4153065">(</span><span class="ident" id="4153066">token</span><span class="op" id="4153071">.</span><span class="ident" id="4153072">COLON</span><span class="op" id="4153077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153080">body</span>&nbsp;<span class="op" id="4153085">:=</span>&nbsp;<span class="ident" id="4153088">p</span><span class="op" id="4153089">.</span><span class="ident" id="4153090">parseStmtList</span><span class="op" id="4153103">(</span><span class="op" id="4153104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153107">p</span><span class="op" id="4153108">.</span><span class="ident" id="4153109">closeScope</span><span class="op" id="4153119">(</span><span class="op" id="4153120">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153124">return</span>&nbsp;<span class="op" id="4153131">&amp;</span><span class="ident" id="4153132">ast</span><span class="op" id="4153135">.</span><span class="ident" id="4153136">CommClause</span><span class="op" id="4153146">{</span><span class="ident" id="4153147">Case</span><span class="op" id="4153151">:</span>&nbsp;<span class="ident" id="4153153">pos</span><span class="op" id="4153156">,</span>&nbsp;<span class="ident" id="4153158">Comm</span><span class="op" id="4153162">:</span>&nbsp;<span class="ident" id="4153164">comm</span><span class="op" id="4153168">,</span>&nbsp;<span class="ident" id="4153170">Colon</span><span class="op" id="4153175">:</span>&nbsp;<span class="ident" id="4153177">colon</span><span class="op" id="4153182">,</span>&nbsp;<span class="ident" id="4153184">Body</span><span class="op" id="4153188">:</span>&nbsp;<span class="ident" id="4153190">body</span><span class="op" id="4153194">}</span><br>
<span class="lineno"></span><span class="op" id="4153196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153199">func</span>&nbsp;<span class="op" id="4153204">(</span><span class="ident" id="4153205">p</span>&nbsp;<span class="op" id="4153207">*</span><span class="ident" id="4153208">parser</span><span class="op" id="4153214">)</span>&nbsp;<span class="ident" id="4153216">parseSelectStmt</span><span class="op" id="4153231">(</span><span class="op" id="4153232">)</span>&nbsp;<span class="op" id="4153234">*</span><span class="ident" id="4153235">ast</span><span class="op" id="4153238">.</span><span class="ident" id="4153239">SelectStmt</span>&nbsp;<span class="op" id="4153250">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153253">if</span>&nbsp;<span class="ident" id="4153256">p</span><span class="op" id="4153257">.</span><span class="ident" id="4153258">trace</span>&nbsp;<span class="op" id="4153264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153268">defer</span>&nbsp;<span class="ident" id="4153274">un</span><span class="op" id="4153276">(</span><span class="ident" id="4153277">trace</span><span class="op" id="4153282">(</span><span class="ident" id="4153283">p</span><span class="op" id="4153284">,</span>&nbsp;<span class="string" id="4153286">&#34;SelectStmt&#34;</span><span class="op" id="4153298">)</span><span class="op" id="4153299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153306">pos</span>&nbsp;<span class="op" id="4153310">:=</span>&nbsp;<span class="ident" id="4153313">p</span><span class="op" id="4153314">.</span><span class="ident" id="4153315">expect</span><span class="op" id="4153321">(</span><span class="ident" id="4153322">token</span><span class="op" id="4153327">.</span><span class="ident" id="4153328">SELECT</span><span class="op" id="4153334">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153337">lbrace</span>&nbsp;<span class="op" id="4153344">:=</span>&nbsp;<span class="ident" id="4153347">p</span><span class="op" id="4153348">.</span><span class="ident" id="4153349">expect</span><span class="op" id="4153355">(</span><span class="ident" id="4153356">token</span><span class="op" id="4153361">.</span><span class="ident" id="4153362">LBRACE</span><span class="op" id="4153368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153371">var</span>&nbsp;<span class="ident" id="4153375">list</span>&nbsp;<span class="op" id="4153380">[</span><span class="op" id="4153381">]</span><span class="ident" id="4153382">ast</span><span class="op" id="4153385">.</span><span class="ident" id="4153386">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153392">for</span>&nbsp;<span class="ident" id="4153396">p</span><span class="op" id="4153397">.</span><span class="ident" id="4153398">tok</span>&nbsp;<span class="op" id="4153402">==</span>&nbsp;<span class="ident" id="4153405">token</span><span class="op" id="4153410">.</span><span class="ident" id="4153411">CASE</span>&nbsp;<span class="op" id="4153416">||</span>&nbsp;<span class="ident" id="4153419">p</span><span class="op" id="4153420">.</span><span class="ident" id="4153421">tok</span>&nbsp;<span class="op" id="4153425">==</span>&nbsp;<span class="ident" id="4153428">token</span><span class="op" id="4153433">.</span><span class="ident" id="4153434">DEFAULT</span>&nbsp;<span class="op" id="4153442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153446">list</span>&nbsp;<span class="op" id="4153451">=</span>&nbsp;<span class="builtinfunc" id="4153453">append</span><span class="op" id="4153459">(</span><span class="ident" id="4153460">list</span><span class="op" id="4153464">,</span>&nbsp;<span class="ident" id="4153466">p</span><span class="op" id="4153467">.</span><span class="ident" id="4153468">parseCommClause</span><span class="op" id="4153483">(</span><span class="op" id="4153484">)</span><span class="op" id="4153485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153488">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153491">rbrace</span>&nbsp;<span class="op" id="4153498">:=</span>&nbsp;<span class="ident" id="4153501">p</span><span class="op" id="4153502">.</span><span class="ident" id="4153503">expect</span><span class="op" id="4153509">(</span><span class="ident" id="4153510">token</span><span class="op" id="4153515">.</span><span class="ident" id="4153516">RBRACE</span><span class="op" id="4153522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153525">p</span><span class="op" id="4153526">.</span><span class="ident" id="4153527">expectSemi</span><span class="op" id="4153537">(</span><span class="op" id="4153538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153541">body</span>&nbsp;<span class="op" id="4153546">:=</span>&nbsp;<span class="op" id="4153549">&amp;</span><span class="ident" id="4153550">ast</span><span class="op" id="4153553">.</span><span class="ident" id="4153554">BlockStmt</span><span class="op" id="4153563">{</span><span class="ident" id="4153564">Lbrace</span><span class="op" id="4153570">:</span>&nbsp;<span class="ident" id="4153572">lbrace</span><span class="op" id="4153578">,</span>&nbsp;<span class="ident" id="4153580">List</span><span class="op" id="4153584">:</span>&nbsp;<span class="ident" id="4153586">list</span><span class="op" id="4153590">,</span>&nbsp;<span class="ident" id="4153592">Rbrace</span><span class="op" id="4153598">:</span>&nbsp;<span class="ident" id="4153600">rbrace</span><span class="op" id="4153606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153610">return</span>&nbsp;<span class="op" id="4153617">&amp;</span><span class="ident" id="4153618">ast</span><span class="op" id="4153621">.</span><span class="ident" id="4153622">SelectStmt</span><span class="op" id="4153632">{</span><span class="ident" id="4153633">Select</span><span class="op" id="4153639">:</span>&nbsp;<span class="ident" id="4153641">pos</span><span class="op" id="4153644">,</span>&nbsp;<span class="ident" id="4153646">Body</span><span class="op" id="4153650">:</span>&nbsp;<span class="ident" id="4153652">body</span><span class="op" id="4153656">}</span><br>
<span class="lineno">2030</span><span class="op" id="4153658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153661">func</span>&nbsp;<span class="op" id="4153666">(</span><span class="ident" id="4153667">p</span>&nbsp;<span class="op" id="4153669">*</span><span class="ident" id="4153670">parser</span><span class="op" id="4153676">)</span>&nbsp;<span class="ident" id="4153678">parseForStmt</span><span class="op" id="4153690">(</span><span class="op" id="4153691">)</span>&nbsp;<span class="ident" id="4153693">ast</span><span class="op" id="4153696">.</span><span class="ident" id="4153697">Stmt</span>&nbsp;<span class="op" id="4153702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153705">if</span>&nbsp;<span class="ident" id="4153708">p</span><span class="op" id="4153709">.</span><span class="ident" id="4153710">trace</span>&nbsp;<span class="op" id="4153716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153720">defer</span>&nbsp;<span class="ident" id="4153726">un</span><span class="op" id="4153728">(</span><span class="ident" id="4153729">trace</span><span class="op" id="4153734">(</span><span class="ident" id="4153735">p</span><span class="op" id="4153736">,</span>&nbsp;<span class="string" id="4153738">&#34;ForStmt&#34;</span><span class="op" id="4153747">)</span><span class="op" id="4153748">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153755">pos</span>&nbsp;<span class="op" id="4153759">:=</span>&nbsp;<span class="ident" id="4153762">p</span><span class="op" id="4153763">.</span><span class="ident" id="4153764">expect</span><span class="op" id="4153770">(</span><span class="ident" id="4153771">token</span><span class="op" id="4153776">.</span><span class="ident" id="4153777">FOR</span><span class="op" id="4153780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153783">p</span><span class="op" id="4153784">.</span><span class="ident" id="4153785">openScope</span><span class="op" id="4153794">(</span><span class="op" id="4153795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153798">defer</span>&nbsp;<span class="ident" id="4153804">p</span><span class="op" id="4153805">.</span><span class="ident" id="4153806">closeScope</span><span class="op" id="4153816">(</span><span class="op" id="4153817">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153821">var</span>&nbsp;<span class="ident" id="4153825">s1</span><span class="op" id="4153827">,</span>&nbsp;<span class="ident" id="4153829">s2</span><span class="op" id="4153831">,</span>&nbsp;<span class="ident" id="4153833">s3</span>&nbsp;<span class="ident" id="4153836">ast</span><span class="op" id="4153839">.</span><span class="ident" id="4153840">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153846">var</span>&nbsp;<span class="ident" id="4153850">isRange</span>&nbsp;<span class="builtintype" id="4153858">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153864">if</span>&nbsp;<span class="ident" id="4153867">p</span><span class="op" id="4153868">.</span><span class="ident" id="4153869">tok</span>&nbsp;<span class="op" id="4153873">!=</span>&nbsp;<span class="ident" id="4153876">token</span><span class="op" id="4153881">.</span><span class="ident" id="4153882">LBRACE</span>&nbsp;<span class="op" id="4153889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153893">prevLev</span>&nbsp;<span class="op" id="4153901">:=</span>&nbsp;<span class="ident" id="4153904">p</span><span class="op" id="4153905">.</span><span class="ident" id="4153906">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153916">p</span><span class="op" id="4153917">.</span><span class="ident" id="4153918">exprLev</span>&nbsp;<span class="op" id="4153926">=</span>&nbsp;<span class="op" id="4153928">-</span><span class="num" id="4153929">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153933">if</span>&nbsp;<span class="ident" id="4153936">p</span><span class="op" id="4153937">.</span><span class="ident" id="4153938">tok</span>&nbsp;<span class="op" id="4153942">!=</span>&nbsp;<span class="ident" id="4153945">token</span><span class="op" id="4153950">.</span><span class="ident" id="4153951">SEMICOLON</span>&nbsp;<span class="op" id="4153961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153966">if</span>&nbsp;<span class="ident" id="4153969">p</span><span class="op" id="4153970">.</span><span class="ident" id="4153971">tok</span>&nbsp;<span class="op" id="4153975">==</span>&nbsp;<span class="ident" id="4153978">token</span><span class="op" id="4153983">.</span><span class="ident" id="4153984">RANGE</span>&nbsp;<span class="op" id="4153990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153996">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154041">pos</span>&nbsp;<span class="op" id="4154045">:=</span>&nbsp;<span class="ident" id="4154048">p</span><span class="op" id="4154049">.</span><span class="ident" id="4154050">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154058">p</span><span class="op" id="4154059">.</span><span class="ident" id="4154060">next</span><span class="op" id="4154064">(</span><span class="op" id="4154065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154071">y</span>&nbsp;<span class="op" id="4154073">:=</span>&nbsp;<span class="op" id="4154076">[</span><span class="op" id="4154077">]</span><span class="ident" id="4154078">ast</span><span class="op" id="4154081">.</span><span class="ident" id="4154082">Expr</span><span class="op" id="4154086">{</span><span class="op" id="4154087">&amp;</span><span class="ident" id="4154088">ast</span><span class="op" id="4154091">.</span><span class="ident" id="4154092">UnaryExpr</span><span class="op" id="4154101">{</span><span class="ident" id="4154102">OpPos</span><span class="op" id="4154107">:</span>&nbsp;<span class="ident" id="4154109">pos</span><span class="op" id="4154112">,</span>&nbsp;<span class="ident" id="4154114">Op</span><span class="op" id="4154116">:</span>&nbsp;<span class="ident" id="4154118">token</span><span class="op" id="4154123">.</span><span class="ident" id="4154124">RANGE</span><span class="op" id="4154129">,</span>&nbsp;<span class="ident" id="4154131">X</span><span class="op" id="4154132">:</span>&nbsp;<span class="ident" id="4154134">p</span><span class="op" id="4154135">.</span><span class="ident" id="4154136">parseRhs</span><span class="op" id="4154144">(</span><span class="op" id="4154145">)</span><span class="op" id="4154146">}</span><span class="op" id="4154147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154153">s2</span>&nbsp;<span class="op" id="4154156">=</span>&nbsp;<span class="op" id="4154158">&amp;</span><span class="ident" id="4154159">ast</span><span class="op" id="4154162">.</span><span class="ident" id="4154163">AssignStmt</span><span class="op" id="4154173">{</span><span class="ident" id="4154174">Rhs</span><span class="op" id="4154177">:</span>&nbsp;<span class="ident" id="4154179">y</span><span class="op" id="4154180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154186">isRange</span>&nbsp;<span class="op" id="4154194">=</span>&nbsp;<span class="builtintype" id="4154196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154204">}</span>&nbsp;<span class="keyword" id="4154206">else</span>&nbsp;<span class="op" id="4154211">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154217">s2</span><span class="op" id="4154219">,</span>&nbsp;<span class="ident" id="4154221">isRange</span>&nbsp;<span class="op" id="4154229">=</span>&nbsp;<span class="ident" id="4154231">p</span><span class="op" id="4154232">.</span><span class="ident" id="4154233">parseSimpleStmt</span><span class="op" id="4154248">(</span><span class="ident" id="4154249">rangeOk</span><span class="op" id="4154256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154269">if</span>&nbsp;<span class="op" id="4154272">!</span><span class="ident" id="4154273">isRange</span>&nbsp;<span class="op" id="4154281">&amp;&amp;</span>&nbsp;<span class="ident" id="4154284">p</span><span class="op" id="4154285">.</span><span class="ident" id="4154286">tok</span>&nbsp;<span class="op" id="4154290">==</span>&nbsp;<span class="ident" id="4154293">token</span><span class="op" id="4154298">.</span><span class="ident" id="4154299">SEMICOLON</span>&nbsp;<span class="op" id="4154309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154314">p</span><span class="op" id="4154315">.</span><span class="ident" id="4154316">next</span><span class="op" id="4154320">(</span><span class="op" id="4154321">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154326">s1</span>&nbsp;<span class="op" id="4154329">=</span>&nbsp;<span class="ident" id="4154331">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154337">s2</span>&nbsp;<span class="op" id="4154340">=</span>&nbsp;<span class="ident" id="4154342">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154349">if</span>&nbsp;<span class="ident" id="4154352">p</span><span class="op" id="4154353">.</span><span class="ident" id="4154354">tok</span>&nbsp;<span class="op" id="4154358">!=</span>&nbsp;<span class="ident" id="4154361">token</span><span class="op" id="4154366">.</span><span class="ident" id="4154367">SEMICOLON</span>&nbsp;<span class="op" id="4154377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154383">s2</span><span class="op" id="4154385">,</span>&nbsp;<span class="ident" id="4154387">_</span>&nbsp;<span class="op" id="4154389">=</span>&nbsp;<span class="ident" id="4154391">p</span><span class="op" id="4154392">.</span><span class="ident" id="4154393">parseSimpleStmt</span><span class="op" id="4154408">(</span><span class="ident" id="4154409">basic</span><span class="op" id="4154414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154419">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154424">p</span><span class="op" id="4154425">.</span><span class="ident" id="4154426">expectSemi</span><span class="op" id="4154436">(</span><span class="op" id="4154437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154442">if</span>&nbsp;<span class="ident" id="4154445">p</span><span class="op" id="4154446">.</span><span class="ident" id="4154447">tok</span>&nbsp;<span class="op" id="4154451">!=</span>&nbsp;<span class="ident" id="4154454">token</span><span class="op" id="4154459">.</span><span class="ident" id="4154460">LBRACE</span>&nbsp;<span class="op" id="4154467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154473">s3</span><span class="op" id="4154475">,</span>&nbsp;<span class="ident" id="4154477">_</span>&nbsp;<span class="op" id="4154479">=</span>&nbsp;<span class="ident" id="4154481">p</span><span class="op" id="4154482">.</span><span class="ident" id="4154483">parseSimpleStmt</span><span class="op" id="4154498">(</span><span class="ident" id="4154499">basic</span><span class="op" id="4154504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154513">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154517">p</span><span class="op" id="4154518">.</span><span class="ident" id="4154519">exprLev</span>&nbsp;<span class="op" id="4154527">=</span>&nbsp;<span class="ident" id="4154529">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154542">body</span>&nbsp;<span class="op" id="4154547">:=</span>&nbsp;<span class="ident" id="4154550">p</span><span class="op" id="4154551">.</span><span class="ident" id="4154552">parseBlockStmt</span><span class="op" id="4154566">(</span><span class="op" id="4154567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154570">p</span><span class="op" id="4154571">.</span><span class="ident" id="4154572">expectSemi</span><span class="op" id="4154582">(</span><span class="op" id="4154583">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154587">if</span>&nbsp;<span class="ident" id="4154590">isRange</span>&nbsp;<span class="op" id="4154598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154602">as</span>&nbsp;<span class="op" id="4154605">:=</span>&nbsp;<span class="ident" id="4154608">s2</span><span class="op" id="4154610">.</span><span class="op" id="4154611">(</span><span class="op" id="4154612">*</span><span class="ident" id="4154613">ast</span><span class="op" id="4154616">.</span><span class="ident" id="4154617">AssignStmt</span><span class="op" id="4154627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154631">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154646">var</span>&nbsp;<span class="ident" id="4154650">key</span><span class="op" id="4154653">,</span>&nbsp;<span class="ident" id="4154655">value</span>&nbsp;<span class="ident" id="4154661">ast</span><span class="op" id="4154664">.</span><span class="ident" id="4154665">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154672">switch</span>&nbsp;<span class="builtinfunc" id="4154679">len</span><span class="op" id="4154682">(</span><span class="ident" id="4154683">as</span><span class="op" id="4154685">.</span><span class="ident" id="4154686">Lhs</span><span class="op" id="4154689">)</span>&nbsp;<span class="op" id="4154691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154695">case</span>&nbsp;<span class="num" id="4154700">0</span><span class="op" id="4154701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154706">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154725">case</span>&nbsp;<span class="num" id="4154730">1</span><span class="op" id="4154731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154736">key</span>&nbsp;<span class="op" id="4154740">=</span>&nbsp;<span class="ident" id="4154742">as</span><span class="op" id="4154744">.</span><span class="ident" id="4154745">Lhs</span><span class="op" id="4154748">[</span><span class="num" id="4154749">0</span><span class="op" id="4154750">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154754">case</span>&nbsp;<span class="num" id="4154759">2</span><span class="op" id="4154760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154765">key</span><span class="op" id="4154768">,</span>&nbsp;<span class="ident" id="4154770">value</span>&nbsp;<span class="op" id="4154776">=</span>&nbsp;<span class="ident" id="4154778">as</span><span class="op" id="4154780">.</span><span class="ident" id="4154781">Lhs</span><span class="op" id="4154784">[</span><span class="num" id="4154785">0</span><span class="op" id="4154786">]</span><span class="op" id="4154787">,</span>&nbsp;<span class="ident" id="4154789">as</span><span class="op" id="4154791">.</span><span class="ident" id="4154792">Lhs</span><span class="op" id="4154795">[</span><span class="num" id="4154796">1</span><span class="op" id="4154797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154801">default</span><span class="op" id="4154808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154813">p</span><span class="op" id="4154814">.</span><span class="ident" id="4154815">errorExpected</span><span class="op" id="4154828">(</span><span class="ident" id="4154829">as</span><span class="op" id="4154831">.</span><span class="ident" id="4154832">Lhs</span><span class="op" id="4154835">[</span><span class="builtinfunc" id="4154836">len</span><span class="op" id="4154839">(</span><span class="ident" id="4154840">as</span><span class="op" id="4154842">.</span><span class="ident" id="4154843">Lhs</span><span class="op" id="4154846">)</span><span class="op" id="4154847">-</span><span class="num" id="4154848">1</span><span class="op" id="4154849">]</span><span class="op" id="4154850">.</span><span class="ident" id="4154851">Pos</span><span class="op" id="4154854">(</span><span class="op" id="4154855">)</span><span class="op" id="4154856">,</span>&nbsp;<span class="string" id="4154858">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4154881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154886">return</span>&nbsp;<span class="op" id="4154893">&amp;</span><span class="ident" id="4154894">ast</span><span class="op" id="4154897">.</span><span class="ident" id="4154898">BadStmt</span><span class="op" id="4154905">{</span><span class="ident" id="4154906">From</span><span class="op" id="4154910">:</span>&nbsp;<span class="ident" id="4154912">pos</span><span class="op" id="4154915">,</span>&nbsp;<span class="ident" id="4154917">To</span><span class="op" id="4154919">:</span>&nbsp;<span class="ident" id="4154921">p</span><span class="op" id="4154922">.</span><span class="ident" id="4154923">safePos</span><span class="op" id="4154930">(</span><span class="ident" id="4154931">body</span><span class="op" id="4154935">.</span><span class="ident" id="4154936">End</span><span class="op" id="4154939">(</span><span class="op" id="4154940">)</span><span class="op" id="4154941">)</span><span class="op" id="4154942">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154950">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155003">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155059">x</span>&nbsp;<span class="op" id="4155061">:=</span>&nbsp;<span class="ident" id="4155064">as</span><span class="op" id="4155066">.</span><span class="ident" id="4155067">Rhs</span><span class="op" id="4155070">[</span><span class="num" id="4155071">0</span><span class="op" id="4155072">]</span><span class="op" id="4155073">.</span><span class="op" id="4155074">(</span><span class="op" id="4155075">*</span><span class="ident" id="4155076">ast</span><span class="op" id="4155079">.</span><span class="ident" id="4155080">UnaryExpr</span><span class="op" id="4155089">)</span><span class="op" id="4155090">.</span><span class="ident" id="4155091">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155095">return</span>&nbsp;<span class="op" id="4155102">&amp;</span><span class="ident" id="4155103">ast</span><span class="op" id="4155106">.</span><span class="ident" id="4155107">RangeStmt</span><span class="op" id="4155116">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155121">For</span><span class="op" id="4155124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4155129">pos</span><span class="op" id="4155132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155137">Key</span><span class="op" id="4155140">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4155145">key</span><span class="op" id="4155148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155153">Value</span><span class="op" id="4155158">:</span>&nbsp;&nbsp;<span class="ident" id="4155161">value</span><span class="op" id="4155166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155171">TokPos</span><span class="op" id="4155177">:</span>&nbsp;<span class="ident" id="4155179">as</span><span class="op" id="4155181">.</span><span class="ident" id="4155182">TokPos</span><span class="op" id="4155188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155193">Tok</span><span class="op" id="4155196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4155201">as</span><span class="op" id="4155203">.</span><span class="ident" id="4155204">Tok</span><span class="op" id="4155207">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155212">X</span><span class="op" id="4155213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4155220">x</span><span class="op" id="4155221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155226">Body</span><span class="op" id="4155230">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4155234">body</span><span class="op" id="4155238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155249">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155275">return</span>&nbsp;<span class="op" id="4155282">&amp;</span><span class="ident" id="4155283">ast</span><span class="op" id="4155286">.</span><span class="ident" id="4155287">ForStmt</span><span class="op" id="4155294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155298">For</span><span class="op" id="4155301">:</span>&nbsp;&nbsp;<span class="ident" id="4155304">pos</span><span class="op" id="4155307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155311">Init</span><span class="op" id="4155315">:</span>&nbsp;<span class="ident" id="4155317">s1</span><span class="op" id="4155319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155323">Cond</span><span class="op" id="4155327">:</span>&nbsp;<span class="ident" id="4155329">p</span><span class="op" id="4155330">.</span><span class="ident" id="4155331">makeExpr</span><span class="op" id="4155339">(</span><span class="ident" id="4155340">s2</span><span class="op" id="4155342">,</span>&nbsp;<span class="string" id="4155344">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="4155373">)</span><span class="op" id="4155374">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155378">Post</span><span class="op" id="4155382">:</span>&nbsp;<span class="ident" id="4155384">s3</span><span class="op" id="4155386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155390">Body</span><span class="op" id="4155394">:</span>&nbsp;<span class="ident" id="4155396">body</span><span class="op" id="4155400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155403">}</span><br>
<span class="lineno"></span><span class="op" id="4155405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="4155408">func</span>&nbsp;<span class="op" id="4155413">(</span><span class="ident" id="4155414">p</span>&nbsp;<span class="op" id="4155416">*</span><span class="ident" id="4155417">parser</span><span class="op" id="4155423">)</span>&nbsp;<span class="ident" id="4155425">parseStmt</span><span class="op" id="4155434">(</span><span class="op" id="4155435">)</span>&nbsp;<span class="op" id="4155437">(</span><span class="ident" id="4155438">s</span>&nbsp;<span class="ident" id="4155440">ast</span><span class="op" id="4155443">.</span><span class="ident" id="4155444">Stmt</span><span class="op" id="4155448">)</span>&nbsp;<span class="op" id="4155450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155453">if</span>&nbsp;<span class="ident" id="4155456">p</span><span class="op" id="4155457">.</span><span class="ident" id="4155458">trace</span>&nbsp;<span class="op" id="4155464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155468">defer</span>&nbsp;<span class="ident" id="4155474">un</span><span class="op" id="4155476">(</span><span class="ident" id="4155477">trace</span><span class="op" id="4155482">(</span><span class="ident" id="4155483">p</span><span class="op" id="4155484">,</span>&nbsp;<span class="string" id="4155486">&#34;Statement&#34;</span><span class="op" id="4155497">)</span><span class="op" id="4155498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155505">switch</span>&nbsp;<span class="ident" id="4155512">p</span><span class="op" id="4155513">.</span><span class="ident" id="4155514">tok</span>&nbsp;<span class="op" id="4155518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155521">case</span>&nbsp;<span class="ident" id="4155526">token</span><span class="op" id="4155531">.</span><span class="ident" id="4155532">CONST</span><span class="op" id="4155537">,</span>&nbsp;<span class="ident" id="4155539">token</span><span class="op" id="4155544">.</span><span class="ident" id="4155545">TYPE</span><span class="op" id="4155549">,</span>&nbsp;<span class="ident" id="4155551">token</span><span class="op" id="4155556">.</span><span class="ident" id="4155557">VAR</span><span class="op" id="4155560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155564">s</span>&nbsp;<span class="op" id="4155566">=</span>&nbsp;<span class="op" id="4155568">&amp;</span><span class="ident" id="4155569">ast</span><span class="op" id="4155572">.</span><span class="ident" id="4155573">DeclStmt</span><span class="op" id="4155581">{</span><span class="ident" id="4155582">Decl</span><span class="op" id="4155586">:</span>&nbsp;<span class="ident" id="4155588">p</span><span class="op" id="4155589">.</span><span class="ident" id="4155590">parseDecl</span><span class="op" id="4155599">(</span><span class="ident" id="4155600">syncStmt</span><span class="op" id="4155608">)</span><span class="op" id="4155609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155612">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155619">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155660">token</span><span class="op" id="4155665">.</span><span class="ident" id="4155666">IDENT</span><span class="op" id="4155671">,</span>&nbsp;<span class="ident" id="4155673">token</span><span class="op" id="4155678">.</span><span class="ident" id="4155679">INT</span><span class="op" id="4155682">,</span>&nbsp;<span class="ident" id="4155684">token</span><span class="op" id="4155689">.</span><span class="ident" id="4155690">FLOAT</span><span class="op" id="4155695">,</span>&nbsp;<span class="ident" id="4155697">token</span><span class="op" id="4155702">.</span><span class="ident" id="4155703">IMAG</span><span class="op" id="4155707">,</span>&nbsp;<span class="ident" id="4155709">token</span><span class="op" id="4155714">.</span><span class="ident" id="4155715">CHAR</span><span class="op" id="4155719">,</span>&nbsp;<span class="ident" id="4155721">token</span><span class="op" id="4155726">.</span><span class="ident" id="4155727">STRING</span><span class="op" id="4155733">,</span>&nbsp;<span class="ident" id="4155735">token</span><span class="op" id="4155740">.</span><span class="ident" id="4155741">FUNC</span><span class="op" id="4155745">,</span>&nbsp;<span class="ident" id="4155747">token</span><span class="op" id="4155752">.</span><span class="ident" id="4155753">LPAREN</span><span class="op" id="4155759">,</span>&nbsp;<span class="comment" id="4155761">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155775">token</span><span class="op" id="4155780">.</span><span class="ident" id="4155781">LBRACK</span><span class="op" id="4155787">,</span>&nbsp;<span class="ident" id="4155789">token</span><span class="op" id="4155794">.</span><span class="ident" id="4155795">STRUCT</span><span class="op" id="4155801">,</span>&nbsp;<span class="comment" id="4155803">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155824">token</span><span class="op" id="4155829">.</span><span class="ident" id="4155830">ADD</span><span class="op" id="4155833">,</span>&nbsp;<span class="ident" id="4155835">token</span><span class="op" id="4155840">.</span><span class="ident" id="4155841">SUB</span><span class="op" id="4155844">,</span>&nbsp;<span class="ident" id="4155846">token</span><span class="op" id="4155851">.</span><span class="ident" id="4155852">MUL</span><span class="op" id="4155855">,</span>&nbsp;<span class="ident" id="4155857">token</span><span class="op" id="4155862">.</span><span class="ident" id="4155863">AND</span><span class="op" id="4155866">,</span>&nbsp;<span class="ident" id="4155868">token</span><span class="op" id="4155873">.</span><span class="ident" id="4155874">XOR</span><span class="op" id="4155877">,</span>&nbsp;<span class="ident" id="4155879">token</span><span class="op" id="4155884">.</span><span class="ident" id="4155885">ARROW</span><span class="op" id="4155890">,</span>&nbsp;<span class="ident" id="4155892">token</span><span class="op" id="4155897">.</span><span class="ident" id="4155898">NOT</span><span class="op" id="4155901">:</span>&nbsp;<span class="comment" id="4155903">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155924">s</span><span class="op" id="4155925">,</span>&nbsp;<span class="ident" id="4155927">_</span>&nbsp;<span class="op" id="4155929">=</span>&nbsp;<span class="ident" id="4155931">p</span><span class="op" id="4155932">.</span><span class="ident" id="4155933">parseSimpleStmt</span><span class="op" id="4155948">(</span><span class="ident" id="4155949">labelOk</span><span class="op" id="4155956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155960">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156024">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156088">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156098">if</span>&nbsp;<span class="ident" id="4156101">_</span><span class="op" id="4156102">,</span>&nbsp;<span class="ident" id="4156104">isLabeledStmt</span>&nbsp;<span class="op" id="4156118">:=</span>&nbsp;<span class="ident" id="4156121">s</span><span class="op" id="4156122">.</span><span class="op" id="4156123">(</span><span class="op" id="4156124">*</span><span class="ident" id="4156125">ast</span><span class="op" id="4156128">.</span><span class="ident" id="4156129">LabeledStmt</span><span class="op" id="4156140">)</span><span class="op" id="4156141">;</span>&nbsp;<span class="op" id="4156143">!</span><span class="ident" id="4156144">isLabeledStmt</span>&nbsp;<span class="op" id="4156158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156163">p</span><span class="op" id="4156164">.</span><span class="ident" id="4156165">expectSemi</span><span class="op" id="4156175">(</span><span class="op" id="4156176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156180">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156183">case</span>&nbsp;<span class="ident" id="4156188">token</span><span class="op" id="4156193">.</span><span class="ident" id="4156194">GO</span><span class="op" id="4156196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156200">s</span>&nbsp;<span class="op" id="4156202">=</span>&nbsp;<span class="ident" id="4156204">p</span><span class="op" id="4156205">.</span><span class="ident" id="4156206">parseGoStmt</span><span class="op" id="4156217">(</span><span class="op" id="4156218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156221">case</span>&nbsp;<span class="ident" id="4156226">token</span><span class="op" id="4156231">.</span><span class="ident" id="4156232">DEFER</span><span class="op" id="4156237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156241">s</span>&nbsp;<span class="op" id="4156243">=</span>&nbsp;<span class="ident" id="4156245">p</span><span class="op" id="4156246">.</span><span class="ident" id="4156247">parseDeferStmt</span><span class="op" id="4156261">(</span><span class="op" id="4156262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156265">case</span>&nbsp;<span class="ident" id="4156270">token</span><span class="op" id="4156275">.</span><span class="ident" id="4156276">RETURN</span><span class="op" id="4156282">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156286">s</span>&nbsp;<span class="op" id="4156288">=</span>&nbsp;<span class="ident" id="4156290">p</span><span class="op" id="4156291">.</span><span class="ident" id="4156292">parseReturnStmt</span><span class="op" id="4156307">(</span><span class="op" id="4156308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156311">case</span>&nbsp;<span class="ident" id="4156316">token</span><span class="op" id="4156321">.</span><span class="ident" id="4156322">BREAK</span><span class="op" id="4156327">,</span>&nbsp;<span class="ident" id="4156329">token</span><span class="op" id="4156334">.</span><span class="ident" id="4156335">CONTINUE</span><span class="op" id="4156343">,</span>&nbsp;<span class="ident" id="4156345">token</span><span class="op" id="4156350">.</span><span class="ident" id="4156351">GOTO</span><span class="op" id="4156355">,</span>&nbsp;<span class="ident" id="4156357">token</span><span class="op" id="4156362">.</span><span class="ident" id="4156363">FALLTHROUGH</span><span class="op" id="4156374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156378">s</span>&nbsp;<span class="op" id="4156380">=</span>&nbsp;<span class="ident" id="4156382">p</span><span class="op" id="4156383">.</span><span class="ident" id="4156384">parseBranchStmt</span><span class="op" id="4156399">(</span><span class="ident" id="4156400">p</span><span class="op" id="4156401">.</span><span class="ident" id="4156402">tok</span><span class="op" id="4156405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156408">case</span>&nbsp;<span class="ident" id="4156413">token</span><span class="op" id="4156418">.</span><span class="ident" id="4156419">LBRACE</span><span class="op" id="4156425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156429">s</span>&nbsp;<span class="op" id="4156431">=</span>&nbsp;<span class="ident" id="4156433">p</span><span class="op" id="4156434">.</span><span class="ident" id="4156435">parseBlockStmt</span><span class="op" id="4156449">(</span><span class="op" id="4156450">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156454">p</span><span class="op" id="4156455">.</span><span class="ident" id="4156456">expectSemi</span><span class="op" id="4156466">(</span><span class="op" id="4156467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156470">case</span>&nbsp;<span class="ident" id="4156475">token</span><span class="op" id="4156480">.</span><span class="ident" id="4156481">IF</span><span class="op" id="4156483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156487">s</span>&nbsp;<span class="op" id="4156489">=</span>&nbsp;<span class="ident" id="4156491">p</span><span class="op" id="4156492">.</span><span class="ident" id="4156493">parseIfStmt</span><span class="op" id="4156504">(</span><span class="op" id="4156505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156508">case</span>&nbsp;<span class="ident" id="4156513">token</span><span class="op" id="4156518">.</span><span class="ident" id="4156519">SWITCH</span><span class="op" id="4156525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156529">s</span>&nbsp;<span class="op" id="4156531">=</span>&nbsp;<span class="ident" id="4156533">p</span><span class="op" id="4156534">.</span><span class="ident" id="4156535">parseSwitchStmt</span><span class="op" id="4156550">(</span><span class="op" id="4156551">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156554">case</span>&nbsp;<span class="ident" id="4156559">token</span><span class="op" id="4156564">.</span><span class="ident" id="4156565">SELECT</span><span class="op" id="4156571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156575">s</span>&nbsp;<span class="op" id="4156577">=</span>&nbsp;<span class="ident" id="4156579">p</span><span class="op" id="4156580">.</span><span class="ident" id="4156581">parseSelectStmt</span><span class="op" id="4156596">(</span><span class="op" id="4156597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156600">case</span>&nbsp;<span class="ident" id="4156605">token</span><span class="op" id="4156610">.</span><span class="ident" id="4156611">FOR</span><span class="op" id="4156614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156618">s</span>&nbsp;<span class="op" id="4156620">=</span>&nbsp;<span class="ident" id="4156622">p</span><span class="op" id="4156623">.</span><span class="ident" id="4156624">parseForStmt</span><span class="op" id="4156636">(</span><span class="op" id="4156637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156640">case</span>&nbsp;<span class="ident" id="4156645">token</span><span class="op" id="4156650">.</span><span class="ident" id="4156651">SEMICOLON</span><span class="op" id="4156660">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156664">s</span>&nbsp;<span class="op" id="4156666">=</span>&nbsp;<span class="op" id="4156668">&amp;</span><span class="ident" id="4156669">ast</span><span class="op" id="4156672">.</span><span class="ident" id="4156673">EmptyStmt</span><span class="op" id="4156682">{</span><span class="ident" id="4156683">Semicolon</span><span class="op" id="4156692">:</span>&nbsp;<span class="ident" id="4156694">p</span><span class="op" id="4156695">.</span><span class="ident" id="4156696">pos</span><span class="op" id="4156699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156703">p</span><span class="op" id="4156704">.</span><span class="ident" id="4156705">next</span><span class="op" id="4156709">(</span><span class="op" id="4156710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156713">case</span>&nbsp;<span class="ident" id="4156718">token</span><span class="op" id="4156723">.</span><span class="ident" id="4156724">RBRACE</span><span class="op" id="4156730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156734">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156787">s</span>&nbsp;<span class="op" id="4156789">=</span>&nbsp;<span class="op" id="4156791">&amp;</span><span class="ident" id="4156792">ast</span><span class="op" id="4156795">.</span><span class="ident" id="4156796">EmptyStmt</span><span class="op" id="4156805">{</span><span class="ident" id="4156806">Semicolon</span><span class="op" id="4156815">:</span>&nbsp;<span class="ident" id="4156817">p</span><span class="op" id="4156818">.</span><span class="ident" id="4156819">pos</span><span class="op" id="4156822">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156825">default</span><span class="op" id="4156832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4156836">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156860">pos</span>&nbsp;<span class="op" id="4156864">:=</span>&nbsp;<span class="ident" id="4156867">p</span><span class="op" id="4156868">.</span><span class="ident" id="4156869">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156875">p</span><span class="op" id="4156876">.</span><span class="ident" id="4156877">errorExpected</span><span class="op" id="4156890">(</span><span class="ident" id="4156891">pos</span><span class="op" id="4156894">,</span>&nbsp;<span class="string" id="4156896">&#34;statement&#34;</span><span class="op" id="4156907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156911">syncStmt</span><span class="op" id="4156919">(</span><span class="ident" id="4156920">p</span><span class="op" id="4156921">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156925">s</span>&nbsp;<span class="op" id="4156927">=</span>&nbsp;<span class="op" id="4156929">&amp;</span><span class="ident" id="4156930">ast</span><span class="op" id="4156933">.</span><span class="ident" id="4156934">BadStmt</span><span class="op" id="4156941">{</span><span class="ident" id="4156942">From</span><span class="op" id="4156946">:</span>&nbsp;<span class="ident" id="4156948">pos</span><span class="op" id="4156951">,</span>&nbsp;<span class="ident" id="4156953">To</span><span class="op" id="4156955">:</span>&nbsp;<span class="ident" id="4156957">p</span><span class="op" id="4156958">.</span><span class="ident" id="4156959">pos</span><span class="op" id="4156962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156969">return</span><br>
<span class="lineno"></span><span class="op" id="4156976">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="4156979">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4157059">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4157076">type</span>&nbsp;<span class="ident" id="4157081">parseSpecFunction</span>&nbsp;<span class="keyword" id="4157099">func</span><span class="op" id="4157103">(</span><span class="ident" id="4157104">doc</span>&nbsp;<span class="op" id="4157108">*</span><span class="ident" id="4157109">ast</span><span class="op" id="4157112">.</span><span class="ident" id="4157113">CommentGroup</span><span class="op" id="4157125">,</span>&nbsp;<span class="ident" id="4157127">keyword</span>&nbsp;<span class="ident" id="4157135">token</span><span class="op" id="4157140">.</span><span class="ident" id="4157141">Token</span><span class="op" id="4157146">,</span>&nbsp;<span class="ident" id="4157148">iota</span>&nbsp;<span class="builtintype" id="4157153">int</span><span class="op" id="4157156">)</span>&nbsp;<span class="ident" id="4157158">ast</span><span class="op" id="4157161">.</span><span class="ident" id="4157162">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="4157168">func</span>&nbsp;<span class="ident" id="4157173">isValidImport</span><span class="op" id="4157186">(</span><span class="ident" id="4157187">lit</span>&nbsp;<span class="builtintype" id="4157191">string</span><span class="op" id="4157197">)</span>&nbsp;<span class="builtintype" id="4157199">bool</span>&nbsp;<span class="op" id="4157204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157207">const</span>&nbsp;<span class="ident" id="4157213">illegalChars</span>&nbsp;<span class="op" id="4157226">=</span>&nbsp;<span class="string" id="4157228">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="4157255">+</span>&nbsp;<span class="string" id="4157257">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157268">s</span><span class="op" id="4157269">,</span>&nbsp;<span class="ident" id="4157271">_</span>&nbsp;<span class="op" id="4157273">:=</span>&nbsp;<span class="ident" id="4157276">strconv</span><span class="op" id="4157283">.</span><span class="ident" id="4157284">Unquote</span><span class="op" id="4157291">(</span><span class="ident" id="4157292">lit</span><span class="op" id="4157295">)</span>&nbsp;<span class="comment" id="4157297">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157343">for</span>&nbsp;<span class="ident" id="4157347">_</span><span class="op" id="4157348">,</span>&nbsp;<span class="ident" id="4157350">r</span>&nbsp;<span class="op" id="4157352">:=</span>&nbsp;<span class="keyword" id="4157355">range</span>&nbsp;<span class="ident" id="4157361">s</span>&nbsp;<span class="op" id="4157363">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157367">if</span>&nbsp;<span class="op" id="4157370">!</span><span class="ident" id="4157371">unicode</span><span class="op" id="4157378">.</span><span class="ident" id="4157379">IsGraphic</span><span class="op" id="4157388">(</span><span class="ident" id="4157389">r</span><span class="op" id="4157390">)</span>&nbsp;<span class="op" id="4157392">||</span>&nbsp;<span class="ident" id="4157395">unicode</span><span class="op" id="4157402">.</span><span class="ident" id="4157403">IsSpace</span><span class="op" id="4157410">(</span><span class="ident" id="4157411">r</span><span class="op" id="4157412">)</span>&nbsp;<span class="op" id="4157414">||</span>&nbsp;<span class="ident" id="4157417">strings</span><span class="op" id="4157424">.</span><span class="ident" id="4157425">ContainsRune</span><span class="op" id="4157437">(</span><span class="ident" id="4157438">illegalChars</span><span class="op" id="4157450">,</span>&nbsp;<span class="ident" id="4157452">r</span><span class="op" id="4157453">)</span>&nbsp;<span class="op" id="4157455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157460">return</span>&nbsp;<span class="builtintype" id="4157467">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157481">return</span>&nbsp;<span class="ident" id="4157488">s</span>&nbsp;<span class="op" id="4157490">!=</span>&nbsp;<span class="string" id="4157493">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="4157496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4157499">func</span>&nbsp;<span class="op" id="4157504">(</span><span class="ident" id="4157505">p</span>&nbsp;<span class="op" id="4157507">*</span><span class="ident" id="4157508">parser</span><span class="op" id="4157514">)</span>&nbsp;<span class="ident" id="4157516">parseImportSpec</span><span class="op" id="4157531">(</span><span class="ident" id="4157532">doc</span>&nbsp;<span class="op" id="4157536">*</span><span class="ident" id="4157537">ast</span><span class="op" id="4157540">.</span><span class="ident" id="4157541">CommentGroup</span><span class="op" id="4157553">,</span>&nbsp;<span class="ident" id="4157555">_</span>&nbsp;<span class="ident" id="4157557">token</span><span class="op" id="4157562">.</span><span class="ident" id="4157563">Token</span><span class="op" id="4157568">,</span>&nbsp;<span class="ident" id="4157570">_</span>&nbsp;<span class="builtintype" id="4157572">int</span><span class="op" id="4157575">)</span>&nbsp;<span class="ident" id="4157577">ast</span><span class="op" id="4157580">.</span><span class="ident" id="4157581">Spec</span>&nbsp;<span class="op" id="4157586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157589">if</span>&nbsp;<span class="ident" id="4157592">p</span><span class="op" id="4157593">.</span><span class="ident" id="4157594">trace</span>&nbsp;<span class="op" id="4157600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157604">defer</span>&nbsp;<span class="ident" id="4157610">un</span><span class="op" id="4157612">(</span><span class="ident" id="4157613">trace</span><span class="op" id="4157618">(</span><span class="ident" id="4157619">p</span><span class="op" id="4157620">,</span>&nbsp;<span class="string" id="4157622">&#34;ImportSpec&#34;</span><span class="op" id="4157634">)</span><span class="op" id="4157635">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157642">var</span>&nbsp;<span class="ident" id="4157646">ident</span>&nbsp;<span class="op" id="4157652">*</span><span class="ident" id="4157653">ast</span><span class="op" id="4157656">.</span><span class="ident" id="4157657">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157664">switch</span>&nbsp;<span class="ident" id="4157671">p</span><span class="op" id="4157672">.</span><span class="ident" id="4157673">tok</span>&nbsp;<span class="op" id="4157677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157680">case</span>&nbsp;<span class="ident" id="4157685">token</span><span class="op" id="4157690">.</span><span class="ident" id="4157691">PERIOD</span><span class="op" id="4157697">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157701">ident</span>&nbsp;<span class="op" id="4157707">=</span>&nbsp;<span class="op" id="4157709">&amp;</span><span class="ident" id="4157710">ast</span><span class="op" id="4157713">.</span><span class="ident" id="4157714">Ident</span><span class="op" id="4157719">{</span><span class="ident" id="4157720">NamePos</span><span class="op" id="4157727">:</span>&nbsp;<span class="ident" id="4157729">p</span><span class="op" id="4157730">.</span><span class="ident" id="4157731">pos</span><span class="op" id="4157734">,</span>&nbsp;<span class="ident" id="4157736">Name</span><span class="op" id="4157740">:</span>&nbsp;<span class="string" id="4157742">&#34;.&#34;</span><span class="op" id="4157745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157749">p</span><span class="op" id="4157750">.</span><span class="ident" id="4157751">next</span><span class="op" id="4157755">(</span><span class="op" id="4157756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157759">case</span>&nbsp;<span class="ident" id="4157764">token</span><span class="op" id="4157769">.</span><span class="ident" id="4157770">IDENT</span><span class="op" id="4157775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157779">ident</span>&nbsp;<span class="op" id="4157785">=</span>&nbsp;<span class="ident" id="4157787">p</span><span class="op" id="4157788">.</span><span class="ident" id="4157789">parseIdent</span><span class="op" id="4157799">(</span><span class="op" id="4157800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157803">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157807">pos</span>&nbsp;<span class="op" id="4157811">:=</span>&nbsp;<span class="ident" id="4157814">p</span><span class="op" id="4157815">.</span><span class="ident" id="4157816">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157821">var</span>&nbsp;<span class="ident" id="4157825">path</span>&nbsp;<span class="builtintype" id="4157830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157838">if</span>&nbsp;<span class="ident" id="4157841">p</span><span class="op" id="4157842">.</span><span class="ident" id="4157843">tok</span>&nbsp;<span class="op" id="4157847">==</span>&nbsp;<span class="ident" id="4157850">token</span><span class="op" id="4157855">.</span><span class="ident" id="4157856">STRING</span>&nbsp;<span class="op" id="4157863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157867">path</span>&nbsp;<span class="op" id="4157872">=</span>&nbsp;<span class="ident" id="4157874">p</span><span class="op" id="4157875">.</span><span class="ident" id="4157876">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157882">if</span>&nbsp;<span class="op" id="4157885">!</span><span class="ident" id="4157886">isValidImport</span><span class="op" id="4157899">(</span><span class="ident" id="4157900">path</span><span class="op" id="4157904">)</span>&nbsp;<span class="op" id="4157906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157911">p</span><span class="op" id="4157912">.</span><span class="builtintype" id="4157913">error</span><span class="op" id="4157918">(</span><span class="ident" id="4157919">pos</span><span class="op" id="4157922">,</span>&nbsp;<span class="string" id="4157924">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="4157947">+</span><span class="ident" id="4157948">path</span><span class="op" id="4157952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157960">p</span><span class="op" id="4157961">.</span><span class="ident" id="4157962">next</span><span class="op" id="4157966">(</span><span class="op" id="4157967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157970">}</span>&nbsp;<span class="keyword" id="4157972">else</span>&nbsp;<span class="op" id="4157977">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157981">p</span><span class="op" id="4157982">.</span><span class="ident" id="4157983">expect</span><span class="op" id="4157989">(</span><span class="ident" id="4157990">token</span><span class="op" id="4157995">.</span><span class="ident" id="4157996">STRING</span><span class="op" id="4158002">)</span>&nbsp;<span class="comment" id="4158004">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158039">p</span><span class="op" id="4158040">.</span><span class="ident" id="4158041">expectSemi</span><span class="op" id="4158051">(</span><span class="op" id="4158052">)</span>&nbsp;<span class="comment" id="4158054">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158095">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158115">spec</span>&nbsp;<span class="op" id="4158120">:=</span>&nbsp;<span class="op" id="4158123">&amp;</span><span class="ident" id="4158124">ast</span><span class="op" id="4158127">.</span><span class="ident" id="4158128">ImportSpec</span><span class="op" id="4158138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158142">Doc</span><span class="op" id="4158145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4158151">doc</span><span class="op" id="4158154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158158">Name</span><span class="op" id="4158162">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4158167">ident</span><span class="op" id="4158172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158176">Path</span><span class="op" id="4158180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4158185">&amp;</span><span class="ident" id="4158186">ast</span><span class="op" id="4158189">.</span><span class="ident" id="4158190">BasicLit</span><span class="op" id="4158198">{</span><span class="ident" id="4158199">ValuePos</span><span class="op" id="4158207">:</span>&nbsp;<span class="ident" id="4158209">pos</span><span class="op" id="4158212">,</span>&nbsp;<span class="ident" id="4158214">Kind</span><span class="op" id="4158218">:</span>&nbsp;<span class="ident" id="4158220">token</span><span class="op" id="4158225">.</span><span class="ident" id="4158226">STRING</span><span class="op" id="4158232">,</span>&nbsp;<span class="ident" id="4158234">Value</span><span class="op" id="4158239">:</span>&nbsp;<span class="ident" id="4158241">path</span><span class="op" id="4158245">}</span><span class="op" id="4158246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158250">Comment</span><span class="op" id="4158257">:</span>&nbsp;<span class="ident" id="4158259">p</span><span class="op" id="4158260">.</span><span class="ident" id="4158261">lineComment</span><span class="op" id="4158272">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158278">p</span><span class="op" id="4158279">.</span><span class="ident" id="4158280">imports</span>&nbsp;<span class="op" id="4158288">=</span>&nbsp;<span class="builtinfunc" id="4158290">append</span><span class="op" id="4158296">(</span><span class="ident" id="4158297">p</span><span class="op" id="4158298">.</span><span class="ident" id="4158299">imports</span><span class="op" id="4158306">,</span>&nbsp;<span class="ident" id="4158308">spec</span><span class="op" id="4158312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158316">return</span>&nbsp;<span class="ident" id="4158323">spec</span><br>
<span class="lineno"></span><span class="op" id="4158328">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="4158331">func</span>&nbsp;<span class="op" id="4158336">(</span><span class="ident" id="4158337">p</span>&nbsp;<span class="op" id="4158339">*</span><span class="ident" id="4158340">parser</span><span class="op" id="4158346">)</span>&nbsp;<span class="ident" id="4158348">parseValueSpec</span><span class="op" id="4158362">(</span><span class="ident" id="4158363">doc</span>&nbsp;<span class="op" id="4158367">*</span><span class="ident" id="4158368">ast</span><span class="op" id="4158371">.</span><span class="ident" id="4158372">CommentGroup</span><span class="op" id="4158384">,</span>&nbsp;<span class="ident" id="4158386">keyword</span>&nbsp;<span class="ident" id="4158394">token</span><span class="op" id="4158399">.</span><span class="ident" id="4158400">Token</span><span class="op" id="4158405">,</span>&nbsp;<span class="ident" id="4158407">iota</span>&nbsp;<span class="builtintype" id="4158412">int</span><span class="op" id="4158415">)</span>&nbsp;<span class="ident" id="4158417">ast</span><span class="op" id="4158420">.</span><span class="ident" id="4158421">Spec</span>&nbsp;<span class="op" id="4158426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158429">if</span>&nbsp;<span class="ident" id="4158432">p</span><span class="op" id="4158433">.</span><span class="ident" id="4158434">trace</span>&nbsp;<span class="op" id="4158440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158444">defer</span>&nbsp;<span class="ident" id="4158450">un</span><span class="op" id="4158452">(</span><span class="ident" id="4158453">trace</span><span class="op" id="4158458">(</span><span class="ident" id="4158459">p</span><span class="op" id="4158460">,</span>&nbsp;<span class="ident" id="4158462">keyword</span><span class="op" id="4158469">.</span><span class="ident" id="4158470">String</span><span class="op" id="4158476">(</span><span class="op" id="4158477">)</span><span class="op" id="4158478">+</span><span class="string" id="4158479">&#34;Spec&#34;</span><span class="op" id="4158485">)</span><span class="op" id="4158486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158489">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158493">idents</span>&nbsp;<span class="op" id="4158500">:=</span>&nbsp;<span class="ident" id="4158503">p</span><span class="op" id="4158504">.</span><span class="ident" id="4158505">parseIdentList</span><span class="op" id="4158519">(</span><span class="op" id="4158520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158523">typ</span>&nbsp;<span class="op" id="4158527">:=</span>&nbsp;<span class="ident" id="4158530">p</span><span class="op" id="4158531">.</span><span class="ident" id="4158532">tryType</span><span class="op" id="4158539">(</span><span class="op" id="4158540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158543">var</span>&nbsp;<span class="ident" id="4158547">values</span>&nbsp;<span class="op" id="4158554">[</span><span class="op" id="4158555">]</span><span class="ident" id="4158556">ast</span><span class="op" id="4158559">.</span><span class="ident" id="4158560">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158566">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158634">if</span>&nbsp;<span class="ident" id="4158637">p</span><span class="op" id="4158638">.</span><span class="ident" id="4158639">tok</span>&nbsp;<span class="op" id="4158643">==</span>&nbsp;<span class="ident" id="4158646">token</span><span class="op" id="4158651">.</span><span class="ident" id="4158652">ASSIGN</span>&nbsp;<span class="op" id="4158659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158663">p</span><span class="op" id="4158664">.</span><span class="ident" id="4158665">next</span><span class="op" id="4158669">(</span><span class="op" id="4158670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158674">values</span>&nbsp;<span class="op" id="4158681">=</span>&nbsp;<span class="ident" id="4158683">p</span><span class="op" id="4158684">.</span><span class="ident" id="4158685">parseRhsList</span><span class="op" id="4158697">(</span><span class="op" id="4158698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158704">p</span><span class="op" id="4158705">.</span><span class="ident" id="4158706">expectSemi</span><span class="op" id="4158716">(</span><span class="op" id="4158717">)</span>&nbsp;<span class="comment" id="4158719">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158760">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158836">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158909">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158956">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159029">spec</span>&nbsp;<span class="op" id="4159034">:=</span>&nbsp;<span class="op" id="4159037">&amp;</span><span class="ident" id="4159038">ast</span><span class="op" id="4159041">.</span><span class="ident" id="4159042">ValueSpec</span><span class="op" id="4159051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159055">Doc</span><span class="op" id="4159058">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4159064">doc</span><span class="op" id="4159067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159071">Names</span><span class="op" id="4159076">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4159080">idents</span><span class="op" id="4159086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159090">Type</span><span class="op" id="4159094">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4159099">typ</span><span class="op" id="4159102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159106">Values</span><span class="op" id="4159112">:</span>&nbsp;&nbsp;<span class="ident" id="4159115">values</span><span class="op" id="4159121">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159125">Comment</span><span class="op" id="4159132">:</span>&nbsp;<span class="ident" id="4159134">p</span><span class="op" id="4159135">.</span><span class="ident" id="4159136">lineComment</span><span class="op" id="4159147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159153">kind</span>&nbsp;<span class="op" id="4159158">:=</span>&nbsp;<span class="ident" id="4159161">ast</span><span class="op" id="4159164">.</span><span class="ident" id="4159165">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159170">if</span>&nbsp;<span class="ident" id="4159173">keyword</span>&nbsp;<span class="op" id="4159181">==</span>&nbsp;<span class="ident" id="4159184">token</span><span class="op" id="4159189">.</span><span class="ident" id="4159190">VAR</span>&nbsp;<span class="op" id="4159194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159198">kind</span>&nbsp;<span class="op" id="4159203">=</span>&nbsp;<span class="ident" id="4159205">ast</span><span class="op" id="4159208">.</span><span class="ident" id="4159209">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159217">p</span><span class="op" id="4159218">.</span><span class="ident" id="4159219">declare</span><span class="op" id="4159226">(</span><span class="ident" id="4159227">spec</span><span class="op" id="4159231">,</span>&nbsp;<span class="ident" id="4159233">iota</span><span class="op" id="4159237">,</span>&nbsp;<span class="ident" id="4159239">p</span><span class="op" id="4159240">.</span><span class="ident" id="4159241">topScope</span><span class="op" id="4159249">,</span>&nbsp;<span class="ident" id="4159251">kind</span><span class="op" id="4159255">,</span>&nbsp;<span class="ident" id="4159257">idents</span><span class="op" id="4159263">...</span><span class="op" id="4159266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159270">return</span>&nbsp;<span class="ident" id="4159277">spec</span><br>
<span class="lineno"></span><span class="op" id="4159282">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="4159285">func</span>&nbsp;<span class="op" id="4159290">(</span><span class="ident" id="4159291">p</span>&nbsp;<span class="op" id="4159293">*</span><span class="ident" id="4159294">parser</span><span class="op" id="4159300">)</span>&nbsp;<span class="ident" id="4159302">parseTypeSpec</span><span class="op" id="4159315">(</span><span class="ident" id="4159316">doc</span>&nbsp;<span class="op" id="4159320">*</span><span class="ident" id="4159321">ast</span><span class="op" id="4159324">.</span><span class="ident" id="4159325">CommentGroup</span><span class="op" id="4159337">,</span>&nbsp;<span class="ident" id="4159339">_</span>&nbsp;<span class="ident" id="4159341">token</span><span class="op" id="4159346">.</span><span class="ident" id="4159347">Token</span><span class="op" id="4159352">,</span>&nbsp;<span class="ident" id="4159354">_</span>&nbsp;<span class="builtintype" id="4159356">int</span><span class="op" id="4159359">)</span>&nbsp;<span class="ident" id="4159361">ast</span><span class="op" id="4159364">.</span><span class="ident" id="4159365">Spec</span>&nbsp;<span class="op" id="4159370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159373">if</span>&nbsp;<span class="ident" id="4159376">p</span><span class="op" id="4159377">.</span><span class="ident" id="4159378">trace</span>&nbsp;<span class="op" id="4159384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159388">defer</span>&nbsp;<span class="ident" id="4159394">un</span><span class="op" id="4159396">(</span><span class="ident" id="4159397">trace</span><span class="op" id="4159402">(</span><span class="ident" id="4159403">p</span><span class="op" id="4159404">,</span>&nbsp;<span class="string" id="4159406">&#34;TypeSpec&#34;</span><span class="op" id="4159416">)</span><span class="op" id="4159417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159420">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159424">ident</span>&nbsp;<span class="op" id="4159430">:=</span>&nbsp;<span class="ident" id="4159433">p</span><span class="op" id="4159434">.</span><span class="ident" id="4159435">parseIdent</span><span class="op" id="4159445">(</span><span class="op" id="4159446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159450">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159528">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159603">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159625">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159698">spec</span>&nbsp;<span class="op" id="4159703">:=</span>&nbsp;<span class="op" id="4159706">&amp;</span><span class="ident" id="4159707">ast</span><span class="op" id="4159710">.</span><span class="ident" id="4159711">TypeSpec</span><span class="op" id="4159719">{</span><span class="ident" id="4159720">Doc</span><span class="op" id="4159723">:</span>&nbsp;<span class="ident" id="4159725">doc</span><span class="op" id="4159728">,</span>&nbsp;<span class="ident" id="4159730">Name</span><span class="op" id="4159734">:</span>&nbsp;<span class="ident" id="4159736">ident</span><span class="op" id="4159741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159744">p</span><span class="op" id="4159745">.</span><span class="ident" id="4159746">declare</span><span class="op" id="4159753">(</span><span class="ident" id="4159754">spec</span><span class="op" id="4159758">,</span>&nbsp;<span class="ident" id="4159760">nil</span><span class="op" id="4159763">,</span>&nbsp;<span class="ident" id="4159765">p</span><span class="op" id="4159766">.</span><span class="ident" id="4159767">topScope</span><span class="op" id="4159775">,</span>&nbsp;<span class="ident" id="4159777">ast</span><span class="op" id="4159780">.</span><span class="ident" id="4159781">Typ</span><span class="op" id="4159784">,</span>&nbsp;<span class="ident" id="4159786">ident</span><span class="op" id="4159791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159795">spec</span><span class="op" id="4159799">.</span><span class="ident" id="4159800">Type</span>&nbsp;<span class="op" id="4159805">=</span>&nbsp;<span class="ident" id="4159807">p</span><span class="op" id="4159808">.</span><span class="ident" id="4159809">parseType</span><span class="op" id="4159818">(</span><span class="op" id="4159819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159822">p</span><span class="op" id="4159823">.</span><span class="ident" id="4159824">expectSemi</span><span class="op" id="4159834">(</span><span class="op" id="4159835">)</span>&nbsp;<span class="comment" id="4159837">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159877">spec</span><span class="op" id="4159881">.</span><span class="ident" id="4159882">Comment</span>&nbsp;<span class="op" id="4159890">=</span>&nbsp;<span class="ident" id="4159892">p</span><span class="op" id="4159893">.</span><span class="ident" id="4159894">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159908">return</span>&nbsp;<span class="ident" id="4159915">spec</span><br>
<span class="lineno">2280</span><span class="op" id="4159920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4159923">func</span>&nbsp;<span class="op" id="4159928">(</span><span class="ident" id="4159929">p</span>&nbsp;<span class="op" id="4159931">*</span><span class="ident" id="4159932">parser</span><span class="op" id="4159938">)</span>&nbsp;<span class="ident" id="4159940">parseGenDecl</span><span class="op" id="4159952">(</span><span class="ident" id="4159953">keyword</span>&nbsp;<span class="ident" id="4159961">token</span><span class="op" id="4159966">.</span><span class="ident" id="4159967">Token</span><span class="op" id="4159972">,</span>&nbsp;<span class="ident" id="4159974">f</span>&nbsp;<span class="ident" id="4159976">parseSpecFunction</span><span class="op" id="4159993">)</span>&nbsp;<span class="op" id="4159995">*</span><span class="ident" id="4159996">ast</span><span class="op" id="4159999">.</span><span class="ident" id="4160000">GenDecl</span>&nbsp;<span class="op" id="4160008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160011">if</span>&nbsp;<span class="ident" id="4160014">p</span><span class="op" id="4160015">.</span><span class="ident" id="4160016">trace</span>&nbsp;<span class="op" id="4160022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160026">defer</span>&nbsp;<span class="ident" id="4160032">un</span><span class="op" id="4160034">(</span><span class="ident" id="4160035">trace</span><span class="op" id="4160040">(</span><span class="ident" id="4160041">p</span><span class="op" id="4160042">,</span>&nbsp;<span class="string" id="4160044">&#34;GenDecl(&#34;</span><span class="op" id="4160054">+</span><span class="ident" id="4160055">keyword</span><span class="op" id="4160062">.</span><span class="ident" id="4160063">String</span><span class="op" id="4160069">(</span><span class="op" id="4160070">)</span><span class="op" id="4160071">+</span><span class="string" id="4160072">&#34;)&#34;</span><span class="op" id="4160075">)</span><span class="op" id="4160076">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160083">doc</span>&nbsp;<span class="op" id="4160087">:=</span>&nbsp;<span class="ident" id="4160090">p</span><span class="op" id="4160091">.</span><span class="ident" id="4160092">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160105">pos</span>&nbsp;<span class="op" id="4160109">:=</span>&nbsp;<span class="ident" id="4160112">p</span><span class="op" id="4160113">.</span><span class="ident" id="4160114">expect</span><span class="op" id="4160120">(</span><span class="ident" id="4160121">keyword</span><span class="op" id="4160128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160131">var</span>&nbsp;<span class="ident" id="4160135">lparen</span><span class="op" id="4160141">,</span>&nbsp;<span class="ident" id="4160143">rparen</span>&nbsp;<span class="ident" id="4160150">token</span><span class="op" id="4160155">.</span><span class="ident" id="4160156">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160161">var</span>&nbsp;<span class="ident" id="4160165">list</span>&nbsp;<span class="op" id="4160170">[</span><span class="op" id="4160171">]</span><span class="ident" id="4160172">ast</span><span class="op" id="4160175">.</span><span class="ident" id="4160176">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160182">if</span>&nbsp;<span class="ident" id="4160185">p</span><span class="op" id="4160186">.</span><span class="ident" id="4160187">tok</span>&nbsp;<span class="op" id="4160191">==</span>&nbsp;<span class="ident" id="4160194">token</span><span class="op" id="4160199">.</span><span class="ident" id="4160200">LPAREN</span>&nbsp;<span class="op" id="4160207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160211">lparen</span>&nbsp;<span class="op" id="4160218">=</span>&nbsp;<span class="ident" id="4160220">p</span><span class="op" id="4160221">.</span><span class="ident" id="4160222">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160228">p</span><span class="op" id="4160229">.</span><span class="ident" id="4160230">next</span><span class="op" id="4160234">(</span><span class="op" id="4160235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160239">for</span>&nbsp;<span class="ident" id="4160243">iota</span>&nbsp;<span class="op" id="4160248">:=</span>&nbsp;<span class="num" id="4160251">0</span><span class="op" id="4160252">;</span>&nbsp;<span class="ident" id="4160254">p</span><span class="op" id="4160255">.</span><span class="ident" id="4160256">tok</span>&nbsp;<span class="op" id="4160260">!=</span>&nbsp;<span class="ident" id="4160263">token</span><span class="op" id="4160268">.</span><span class="ident" id="4160269">RPAREN</span>&nbsp;<span class="op" id="4160276">&amp;&amp;</span>&nbsp;<span class="ident" id="4160279">p</span><span class="op" id="4160280">.</span><span class="ident" id="4160281">tok</span>&nbsp;<span class="op" id="4160285">!=</span>&nbsp;<span class="ident" id="4160288">token</span><span class="op" id="4160293">.</span><span class="ident" id="4160294">EOF</span><span class="op" id="4160297">;</span>&nbsp;<span class="ident" id="4160299">iota</span><span class="op" id="4160303">++</span>&nbsp;<span class="op" id="4160306">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160311">list</span>&nbsp;<span class="op" id="4160316">=</span>&nbsp;<span class="builtinfunc" id="4160318">append</span><span class="op" id="4160324">(</span><span class="ident" id="4160325">list</span><span class="op" id="4160329">,</span>&nbsp;<span class="ident" id="4160331">f</span><span class="op" id="4160332">(</span><span class="ident" id="4160333">p</span><span class="op" id="4160334">.</span><span class="ident" id="4160335">leadComment</span><span class="op" id="4160346">,</span>&nbsp;<span class="ident" id="4160348">keyword</span><span class="op" id="4160355">,</span>&nbsp;<span class="ident" id="4160357">iota</span><span class="op" id="4160361">)</span><span class="op" id="4160362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160370">rparen</span>&nbsp;<span class="op" id="4160377">=</span>&nbsp;<span class="ident" id="4160379">p</span><span class="op" id="4160380">.</span><span class="ident" id="4160381">expect</span><span class="op" id="4160387">(</span><span class="ident" id="4160388">token</span><span class="op" id="4160393">.</span><span class="ident" id="4160394">RPAREN</span><span class="op" id="4160400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160404">p</span><span class="op" id="4160405">.</span><span class="ident" id="4160406">expectSemi</span><span class="op" id="4160416">(</span><span class="op" id="4160417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160420">}</span>&nbsp;<span class="keyword" id="4160422">else</span>&nbsp;<span class="op" id="4160427">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160431">list</span>&nbsp;<span class="op" id="4160436">=</span>&nbsp;<span class="builtinfunc" id="4160438">append</span><span class="op" id="4160444">(</span><span class="ident" id="4160445">list</span><span class="op" id="4160449">,</span>&nbsp;<span class="ident" id="4160451">f</span><span class="op" id="4160452">(</span><span class="ident" id="4160453">nil</span><span class="op" id="4160456">,</span>&nbsp;<span class="ident" id="4160458">keyword</span><span class="op" id="4160465">,</span>&nbsp;<span class="num" id="4160467">0</span><span class="op" id="4160468">)</span><span class="op" id="4160469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160476">return</span>&nbsp;<span class="op" id="4160483">&amp;</span><span class="ident" id="4160484">ast</span><span class="op" id="4160487">.</span><span class="ident" id="4160488">GenDecl</span><span class="op" id="4160495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160499">Doc</span><span class="op" id="4160502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160507">doc</span><span class="op" id="4160510">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160514">TokPos</span><span class="op" id="4160520">:</span>&nbsp;<span class="ident" id="4160522">pos</span><span class="op" id="4160525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160529">Tok</span><span class="op" id="4160532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160537">keyword</span><span class="op" id="4160544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160548">Lparen</span><span class="op" id="4160554">:</span>&nbsp;<span class="ident" id="4160556">lparen</span><span class="op" id="4160562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160566">Specs</span><span class="op" id="4160571">:</span>&nbsp;&nbsp;<span class="ident" id="4160574">list</span><span class="op" id="4160578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160582">Rparen</span><span class="op" id="4160588">:</span>&nbsp;<span class="ident" id="4160590">rparen</span><span class="op" id="4160596">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160599">}</span><br>
<span class="lineno"></span><span class="op" id="4160601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4160604">func</span>&nbsp;<span class="op" id="4160609">(</span><span class="ident" id="4160610">p</span>&nbsp;<span class="op" id="4160612">*</span><span class="ident" id="4160613">parser</span><span class="op" id="4160619">)</span>&nbsp;<span class="ident" id="4160621">parseFuncDecl</span><span class="op" id="4160634">(</span><span class="op" id="4160635">)</span>&nbsp;<span class="op" id="4160637">*</span><span class="ident" id="4160638">ast</span><span class="op" id="4160641">.</span><span class="ident" id="4160642">FuncDecl</span>&nbsp;<span class="op" id="4160651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160654">if</span>&nbsp;<span class="ident" id="4160657">p</span><span class="op" id="4160658">.</span><span class="ident" id="4160659">trace</span>&nbsp;<span class="op" id="4160665">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160669">defer</span>&nbsp;<span class="ident" id="4160675">un</span><span class="op" id="4160677">(</span><span class="ident" id="4160678">trace</span><span class="op" id="4160683">(</span><span class="ident" id="4160684">p</span><span class="op" id="4160685">,</span>&nbsp;<span class="string" id="4160687">&#34;FunctionDecl&#34;</span><span class="op" id="4160701">)</span><span class="op" id="4160702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160709">doc</span>&nbsp;<span class="op" id="4160713">:=</span>&nbsp;<span class="ident" id="4160716">p</span><span class="op" id="4160717">.</span><span class="ident" id="4160718">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160731">pos</span>&nbsp;<span class="op" id="4160735">:=</span>&nbsp;<span class="ident" id="4160738">p</span><span class="op" id="4160739">.</span><span class="ident" id="4160740">expect</span><span class="op" id="4160746">(</span><span class="ident" id="4160747">token</span><span class="op" id="4160752">.</span><span class="ident" id="4160753">FUNC</span><span class="op" id="4160757">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160760">scope</span>&nbsp;<span class="op" id="4160766">:=</span>&nbsp;<span class="ident" id="4160769">ast</span><span class="op" id="4160772">.</span><span class="ident" id="4160773">NewScope</span><span class="op" id="4160781">(</span><span class="ident" id="4160782">p</span><span class="op" id="4160783">.</span><span class="ident" id="4160784">topScope</span><span class="op" id="4160792">)</span>&nbsp;<span class="comment" id="4160794">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160814">var</span>&nbsp;<span class="ident" id="4160818">recv</span>&nbsp;<span class="op" id="4160823">*</span><span class="ident" id="4160824">ast</span><span class="op" id="4160827">.</span><span class="ident" id="4160828">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160839">if</span>&nbsp;<span class="ident" id="4160842">p</span><span class="op" id="4160843">.</span><span class="ident" id="4160844">tok</span>&nbsp;<span class="op" id="4160848">==</span>&nbsp;<span class="ident" id="4160851">token</span><span class="op" id="4160856">.</span><span class="ident" id="4160857">LPAREN</span>&nbsp;<span class="op" id="4160864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160868">recv</span>&nbsp;<span class="op" id="4160873">=</span>&nbsp;<span class="ident" id="4160875">p</span><span class="op" id="4160876">.</span><span class="ident" id="4160877">parseParameters</span><span class="op" id="4160892">(</span><span class="ident" id="4160893">scope</span><span class="op" id="4160898">,</span>&nbsp;<span class="builtintype" id="4160900">false</span><span class="op" id="4160905">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160912">ident</span>&nbsp;<span class="op" id="4160918">:=</span>&nbsp;<span class="ident" id="4160921">p</span><span class="op" id="4160922">.</span><span class="ident" id="4160923">parseIdent</span><span class="op" id="4160933">(</span><span class="op" id="4160934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160938">params</span><span class="op" id="4160944">,</span>&nbsp;<span class="ident" id="4160946">results</span>&nbsp;<span class="op" id="4160954">:=</span>&nbsp;<span class="ident" id="4160957">p</span><span class="op" id="4160958">.</span><span class="ident" id="4160959">parseSignature</span><span class="op" id="4160973">(</span><span class="ident" id="4160974">scope</span><span class="op" id="4160979">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160983">var</span>&nbsp;<span class="ident" id="4160987">body</span>&nbsp;<span class="op" id="4160992">*</span><span class="ident" id="4160993">ast</span><span class="op" id="4160996">.</span><span class="ident" id="4160997">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161008">if</span>&nbsp;<span class="ident" id="4161011">p</span><span class="op" id="4161012">.</span><span class="ident" id="4161013">tok</span>&nbsp;<span class="op" id="4161017">==</span>&nbsp;<span class="ident" id="4161020">token</span><span class="op" id="4161025">.</span><span class="ident" id="4161026">LBRACE</span>&nbsp;<span class="op" id="4161033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161037">body</span>&nbsp;<span class="op" id="4161042">=</span>&nbsp;<span class="ident" id="4161044">p</span><span class="op" id="4161045">.</span><span class="ident" id="4161046">parseBody</span><span class="op" id="4161055">(</span><span class="ident" id="4161056">scope</span><span class="op" id="4161061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161064">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161067">p</span><span class="op" id="4161068">.</span><span class="ident" id="4161069">expectSemi</span><span class="op" id="4161079">(</span><span class="op" id="4161080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161084">decl</span>&nbsp;<span class="op" id="4161089">:=</span>&nbsp;<span class="op" id="4161092">&amp;</span><span class="ident" id="4161093">ast</span><span class="op" id="4161096">.</span><span class="ident" id="4161097">FuncDecl</span><span class="op" id="4161105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161109">Doc</span><span class="op" id="4161112">:</span>&nbsp;&nbsp;<span class="ident" id="4161115">doc</span><span class="op" id="4161118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161122">Recv</span><span class="op" id="4161126">:</span>&nbsp;<span class="ident" id="4161128">recv</span><span class="op" id="4161132">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161136">Name</span><span class="op" id="4161140">:</span>&nbsp;<span class="ident" id="4161142">ident</span><span class="op" id="4161147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161151">Type</span><span class="op" id="4161155">:</span>&nbsp;<span class="op" id="4161157">&amp;</span><span class="ident" id="4161158">ast</span><span class="op" id="4161161">.</span><span class="ident" id="4161162">FuncType</span><span class="op" id="4161170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161175">Func</span><span class="op" id="4161179">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4161184">pos</span><span class="op" id="4161187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161192">Params</span><span class="op" id="4161198">:</span>&nbsp;&nbsp;<span class="ident" id="4161201">params</span><span class="op" id="4161207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161212">Results</span><span class="op" id="4161219">:</span>&nbsp;<span class="ident" id="4161221">results</span><span class="op" id="4161228">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161232">}</span><span class="op" id="4161233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161237">Body</span><span class="op" id="4161241">:</span>&nbsp;<span class="ident" id="4161243">body</span><span class="op" id="4161247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161253">if</span>&nbsp;<span class="ident" id="4161256">recv</span>&nbsp;<span class="op" id="4161261">==</span>&nbsp;<span class="ident" id="4161264">nil</span>&nbsp;<span class="op" id="4161268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161272">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161340">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161406">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161456">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161461">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161519">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161574">if</span>&nbsp;<span class="ident" id="4161577">ident</span><span class="op" id="4161582">.</span><span class="ident" id="4161583">Name</span>&nbsp;<span class="op" id="4161588">!=</span>&nbsp;<span class="string" id="4161591">&#34;init&#34;</span>&nbsp;<span class="op" id="4161598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161603">p</span><span class="op" id="4161604">.</span><span class="ident" id="4161605">declare</span><span class="op" id="4161612">(</span><span class="ident" id="4161613">decl</span><span class="op" id="4161617">,</span>&nbsp;<span class="ident" id="4161619">nil</span><span class="op" id="4161622">,</span>&nbsp;<span class="ident" id="4161624">p</span><span class="op" id="4161625">.</span><span class="ident" id="4161626">pkgScope</span><span class="op" id="4161634">,</span>&nbsp;<span class="ident" id="4161636">ast</span><span class="op" id="4161639">.</span><span class="ident" id="4161640">Fun</span><span class="op" id="4161643">,</span>&nbsp;<span class="ident" id="4161645">ident</span><span class="op" id="4161650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161661">return</span>&nbsp;<span class="ident" id="4161668">decl</span><br>
<span class="lineno"></span><span class="op" id="4161673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4161676">func</span>&nbsp;<span class="op" id="4161681">(</span><span class="ident" id="4161682">p</span>&nbsp;<span class="op" id="4161684">*</span><span class="ident" id="4161685">parser</span><span class="op" id="4161691">)</span>&nbsp;<span class="ident" id="4161693">parseDecl</span><span class="op" id="4161702">(</span><span class="ident" id="4161703">sync</span>&nbsp;<span class="keyword" id="4161708">func</span><span class="op" id="4161712">(</span><span class="op" id="4161713">*</span><span class="ident" id="4161714">parser</span><span class="op" id="4161720">)</span><span class="op" id="4161721">)</span>&nbsp;<span class="ident" id="4161723">ast</span><span class="op" id="4161726">.</span><span class="ident" id="4161727">Decl</span>&nbsp;<span class="op" id="4161732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161735">if</span>&nbsp;<span class="ident" id="4161738">p</span><span class="op" id="4161739">.</span><span class="ident" id="4161740">trace</span>&nbsp;<span class="op" id="4161746">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161750">defer</span>&nbsp;<span class="ident" id="4161756">un</span><span class="op" id="4161758">(</span><span class="ident" id="4161759">trace</span><span class="op" id="4161764">(</span><span class="ident" id="4161765">p</span><span class="op" id="4161766">,</span>&nbsp;<span class="string" id="4161768">&#34;Declaration&#34;</span><span class="op" id="4161781">)</span><span class="op" id="4161782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161789">var</span>&nbsp;<span class="ident" id="4161793">f</span>&nbsp;<span class="ident" id="4161795">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161814">switch</span>&nbsp;<span class="ident" id="4161821">p</span><span class="op" id="4161822">.</span><span class="ident" id="4161823">tok</span>&nbsp;<span class="op" id="4161827">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161830">case</span>&nbsp;<span class="ident" id="4161835">token</span><span class="op" id="4161840">.</span><span class="ident" id="4161841">CONST</span><span class="op" id="4161846">,</span>&nbsp;<span class="ident" id="4161848">token</span><span class="op" id="4161853">.</span><span class="ident" id="4161854">VAR</span><span class="op" id="4161857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161861">f</span>&nbsp;<span class="op" id="4161863">=</span>&nbsp;<span class="ident" id="4161865">p</span><span class="op" id="4161866">.</span><span class="ident" id="4161867">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161884">case</span>&nbsp;<span class="ident" id="4161889">token</span><span class="op" id="4161894">.</span><span class="ident" id="4161895">TYPE</span><span class="op" id="4161899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161903">f</span>&nbsp;<span class="op" id="4161905">=</span>&nbsp;<span class="ident" id="4161907">p</span><span class="op" id="4161908">.</span><span class="ident" id="4161909">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161925">case</span>&nbsp;<span class="ident" id="4161930">token</span><span class="op" id="4161935">.</span><span class="ident" id="4161936">FUNC</span><span class="op" id="4161940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161944">return</span>&nbsp;<span class="ident" id="4161951">p</span><span class="op" id="4161952">.</span><span class="ident" id="4161953">parseFuncDecl</span><span class="op" id="4161966">(</span><span class="op" id="4161967">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161971">default</span><span class="op" id="4161978">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161982">pos</span>&nbsp;<span class="op" id="4161986">:=</span>&nbsp;<span class="ident" id="4161989">p</span><span class="op" id="4161990">.</span><span class="ident" id="4161991">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161997">p</span><span class="op" id="4161998">.</span><span class="ident" id="4161999">errorExpected</span><span class="op" id="4162012">(</span><span class="ident" id="4162013">pos</span><span class="op" id="4162016">,</span>&nbsp;<span class="string" id="4162018">&#34;declaration&#34;</span><span class="op" id="4162031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162035">sync</span><span class="op" id="4162039">(</span><span class="ident" id="4162040">p</span><span class="op" id="4162041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162045">return</span>&nbsp;<span class="op" id="4162052">&amp;</span><span class="ident" id="4162053">ast</span><span class="op" id="4162056">.</span><span class="ident" id="4162057">BadDecl</span><span class="op" id="4162064">{</span><span class="ident" id="4162065">From</span><span class="op" id="4162069">:</span>&nbsp;<span class="ident" id="4162071">pos</span><span class="op" id="4162074">,</span>&nbsp;<span class="ident" id="4162076">To</span><span class="op" id="4162078">:</span>&nbsp;<span class="ident" id="4162080">p</span><span class="op" id="4162081">.</span><span class="ident" id="4162082">pos</span><span class="op" id="4162085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162088">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162092">return</span>&nbsp;<span class="ident" id="4162099">p</span><span class="op" id="4162100">.</span><span class="ident" id="4162101">parseGenDecl</span><span class="op" id="4162113">(</span><span class="ident" id="4162114">p</span><span class="op" id="4162115">.</span><span class="ident" id="4162116">tok</span><span class="op" id="4162119">,</span>&nbsp;<span class="ident" id="4162121">f</span><span class="op" id="4162122">)</span><br>
<span class="lineno"></span><span class="op" id="4162124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4162127">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="4162207">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4162224">func</span>&nbsp;<span class="op" id="4162229">(</span><span class="ident" id="4162230">p</span>&nbsp;<span class="op" id="4162232">*</span><span class="ident" id="4162233">parser</span><span class="op" id="4162239">)</span>&nbsp;<span class="ident" id="4162241">parseFile</span><span class="op" id="4162250">(</span><span class="op" id="4162251">)</span>&nbsp;<span class="op" id="4162253">*</span><span class="ident" id="4162254">ast</span><span class="op" id="4162257">.</span><span class="ident" id="4162258">File</span>&nbsp;<span class="op" id="4162263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162266">if</span>&nbsp;<span class="ident" id="4162269">p</span><span class="op" id="4162270">.</span><span class="ident" id="4162271">trace</span>&nbsp;<span class="op" id="4162277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162281">defer</span>&nbsp;<span class="ident" id="4162287">un</span><span class="op" id="4162289">(</span><span class="ident" id="4162290">trace</span><span class="op" id="4162295">(</span><span class="ident" id="4162296">p</span><span class="op" id="4162297">,</span>&nbsp;<span class="string" id="4162299">&#34;File&#34;</span><span class="op" id="4162305">)</span><span class="op" id="4162306">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162313">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162390">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162430">if</span>&nbsp;<span class="ident" id="4162433">p</span><span class="op" id="4162434">.</span><span class="ident" id="4162435">errors</span><span class="op" id="4162441">.</span><span class="ident" id="4162442">Len</span><span class="op" id="4162445">(</span><span class="op" id="4162446">)</span>&nbsp;<span class="op" id="4162448">!=</span>&nbsp;<span class="num" id="4162451">0</span>&nbsp;<span class="op" id="4162453">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162457">return</span>&nbsp;<span class="ident" id="4162464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162473">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162492">doc</span>&nbsp;<span class="op" id="4162496">:=</span>&nbsp;<span class="ident" id="4162499">p</span><span class="op" id="4162500">.</span><span class="ident" id="4162501">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162514">pos</span>&nbsp;<span class="op" id="4162518">:=</span>&nbsp;<span class="ident" id="4162521">p</span><span class="op" id="4162522">.</span><span class="ident" id="4162523">expect</span><span class="op" id="4162529">(</span><span class="ident" id="4162530">token</span><span class="op" id="4162535">.</span><span class="ident" id="4162536">PACKAGE</span><span class="op" id="4162543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162546">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162600">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162651">ident</span>&nbsp;<span class="op" id="4162657">:=</span>&nbsp;<span class="ident" id="4162660">p</span><span class="op" id="4162661">.</span><span class="ident" id="4162662">parseIdent</span><span class="op" id="4162672">(</span><span class="op" id="4162673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162676">if</span>&nbsp;<span class="ident" id="4162679">ident</span><span class="op" id="4162684">.</span><span class="ident" id="4162685">Name</span>&nbsp;<span class="op" id="4162690">==</span>&nbsp;<span class="string" id="4162693">&#34;_&#34;</span>&nbsp;<span class="op" id="4162697">&amp;&amp;</span>&nbsp;<span class="ident" id="4162700">p</span><span class="op" id="4162701">.</span><span class="ident" id="4162702">mode</span><span class="op" id="4162706">&amp;</span><span class="ident" id="4162707">DeclarationErrors</span>&nbsp;<span class="op" id="4162725">!=</span>&nbsp;<span class="num" id="4162728">0</span>&nbsp;<span class="op" id="4162730">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162734">p</span><span class="op" id="4162735">.</span><span class="builtintype" id="4162736">error</span><span class="op" id="4162741">(</span><span class="ident" id="4162742">p</span><span class="op" id="4162743">.</span><span class="ident" id="4162744">pos</span><span class="op" id="4162747">,</span>&nbsp;<span class="string" id="4162749">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="4162773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162779">p</span><span class="op" id="4162780">.</span><span class="ident" id="4162781">expectSemi</span><span class="op" id="4162791">(</span><span class="op" id="4162792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162796">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162875">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162915">if</span>&nbsp;<span class="ident" id="4162918">p</span><span class="op" id="4162919">.</span><span class="ident" id="4162920">errors</span><span class="op" id="4162926">.</span><span class="ident" id="4162927">Len</span><span class="op" id="4162930">(</span><span class="op" id="4162931">)</span>&nbsp;<span class="op" id="4162933">!=</span>&nbsp;<span class="num" id="4162936">0</span>&nbsp;<span class="op" id="4162938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162942">return</span>&nbsp;<span class="ident" id="4162949">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162958">p</span><span class="op" id="4162959">.</span><span class="ident" id="4162960">openScope</span><span class="op" id="4162969">(</span><span class="op" id="4162970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162973">p</span><span class="op" id="4162974">.</span><span class="ident" id="4162975">pkgScope</span>&nbsp;<span class="op" id="4162984">=</span>&nbsp;<span class="ident" id="4162986">p</span><span class="op" id="4162987">.</span><span class="ident" id="4162988">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162998">var</span>&nbsp;<span class="ident" id="4163002">decls</span>&nbsp;<span class="op" id="4163008">[</span><span class="op" id="4163009">]</span><span class="ident" id="4163010">ast</span><span class="op" id="4163013">.</span><span class="ident" id="4163014">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163020">if</span>&nbsp;<span class="ident" id="4163023">p</span><span class="op" id="4163024">.</span><span class="ident" id="4163025">mode</span><span class="op" id="4163029">&amp;</span><span class="ident" id="4163030">PackageClauseOnly</span>&nbsp;<span class="op" id="4163048">==</span>&nbsp;<span class="num" id="4163051">0</span>&nbsp;<span class="op" id="4163053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163057">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163075">for</span>&nbsp;<span class="ident" id="4163079">p</span><span class="op" id="4163080">.</span><span class="ident" id="4163081">tok</span>&nbsp;<span class="op" id="4163085">==</span>&nbsp;<span class="ident" id="4163088">token</span><span class="op" id="4163093">.</span><span class="ident" id="4163094">IMPORT</span>&nbsp;<span class="op" id="4163101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163106">decls</span>&nbsp;<span class="op" id="4163112">=</span>&nbsp;<span class="builtinfunc" id="4163114">append</span><span class="op" id="4163120">(</span><span class="ident" id="4163121">decls</span><span class="op" id="4163126">,</span>&nbsp;<span class="ident" id="4163128">p</span><span class="op" id="4163129">.</span><span class="ident" id="4163130">parseGenDecl</span><span class="op" id="4163142">(</span><span class="ident" id="4163143">token</span><span class="op" id="4163148">.</span><span class="ident" id="4163149">IMPORT</span><span class="op" id="4163155">,</span>&nbsp;<span class="ident" id="4163157">p</span><span class="op" id="4163158">.</span><span class="ident" id="4163159">parseImportSpec</span><span class="op" id="4163174">)</span><span class="op" id="4163175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163184">if</span>&nbsp;<span class="ident" id="4163187">p</span><span class="op" id="4163188">.</span><span class="ident" id="4163189">mode</span><span class="op" id="4163193">&amp;</span><span class="ident" id="4163194">ImportsOnly</span>&nbsp;<span class="op" id="4163206">==</span>&nbsp;<span class="num" id="4163209">0</span>&nbsp;<span class="op" id="4163211">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163216">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163243">for</span>&nbsp;<span class="ident" id="4163247">p</span><span class="op" id="4163248">.</span><span class="ident" id="4163249">tok</span>&nbsp;<span class="op" id="4163253">!=</span>&nbsp;<span class="ident" id="4163256">token</span><span class="op" id="4163261">.</span><span class="ident" id="4163262">EOF</span>&nbsp;<span class="op" id="4163266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163272">decls</span>&nbsp;<span class="op" id="4163278">=</span>&nbsp;<span class="builtinfunc" id="4163280">append</span><span class="op" id="4163286">(</span><span class="ident" id="4163287">decls</span><span class="op" id="4163292">,</span>&nbsp;<span class="ident" id="4163294">p</span><span class="op" id="4163295">.</span><span class="ident" id="4163296">parseDecl</span><span class="op" id="4163305">(</span><span class="ident" id="4163306">syncDecl</span><span class="op" id="4163314">)</span><span class="op" id="4163315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163324">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163330">p</span><span class="op" id="4163331">.</span><span class="ident" id="4163332">closeScope</span><span class="op" id="4163342">(</span><span class="op" id="4163343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163346">assert</span><span class="op" id="4163352">(</span><span class="ident" id="4163353">p</span><span class="op" id="4163354">.</span><span class="ident" id="4163355">topScope</span>&nbsp;<span class="op" id="4163364">==</span>&nbsp;<span class="ident" id="4163367">nil</span><span class="op" id="4163370">,</span>&nbsp;<span class="string" id="4163372">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4163391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163394">assert</span><span class="op" id="4163400">(</span><span class="ident" id="4163401">p</span><span class="op" id="4163402">.</span><span class="ident" id="4163403">labelScope</span>&nbsp;<span class="op" id="4163414">==</span>&nbsp;<span class="ident" id="4163417">nil</span><span class="op" id="4163420">,</span>&nbsp;<span class="string" id="4163422">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="4163447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163451">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163503">i</span>&nbsp;<span class="op" id="4163505">:=</span>&nbsp;<span class="num" id="4163508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163511">for</span>&nbsp;<span class="ident" id="4163515">_</span><span class="op" id="4163516">,</span>&nbsp;<span class="ident" id="4163518">ident</span>&nbsp;<span class="op" id="4163524">:=</span>&nbsp;<span class="keyword" id="4163527">range</span>&nbsp;<span class="ident" id="4163533">p</span><span class="op" id="4163534">.</span><span class="ident" id="4163535">unresolved</span>&nbsp;<span class="op" id="4163546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163550">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163584">assert</span><span class="op" id="4163590">(</span><span class="ident" id="4163591">ident</span><span class="op" id="4163596">.</span><span class="ident" id="4163597">Obj</span>&nbsp;<span class="op" id="4163601">==</span>&nbsp;<span class="ident" id="4163604">unresolved</span><span class="op" id="4163614">,</span>&nbsp;<span class="string" id="4163616">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="4163641">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163645">ident</span><span class="op" id="4163650">.</span><span class="ident" id="4163651">Obj</span>&nbsp;<span class="op" id="4163655">=</span>&nbsp;<span class="ident" id="4163657">p</span><span class="op" id="4163658">.</span><span class="ident" id="4163659">pkgScope</span><span class="op" id="4163667">.</span><span class="ident" id="4163668">Lookup</span><span class="op" id="4163674">(</span><span class="ident" id="4163675">ident</span><span class="op" id="4163680">.</span><span class="ident" id="4163681">Name</span><span class="op" id="4163685">)</span>&nbsp;<span class="comment" id="4163687">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163725">if</span>&nbsp;<span class="ident" id="4163728">ident</span><span class="op" id="4163733">.</span><span class="ident" id="4163734">Obj</span>&nbsp;<span class="op" id="4163738">==</span>&nbsp;<span class="ident" id="4163741">nil</span>&nbsp;<span class="op" id="4163745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163750">p</span><span class="op" id="4163751">.</span><span class="ident" id="4163752">unresolved</span><span class="op" id="4163762">[</span><span class="ident" id="4163763">i</span><span class="op" id="4163764">]</span>&nbsp;<span class="op" id="4163766">=</span>&nbsp;<span class="ident" id="4163768">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163777">i</span><span class="op" id="4163778">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163783">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163790">return</span>&nbsp;<span class="op" id="4163797">&amp;</span><span class="ident" id="4163798">ast</span><span class="op" id="4163801">.</span><span class="ident" id="4163802">File</span><span class="op" id="4163806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163810">Doc</span><span class="op" id="4163813">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163822">doc</span><span class="op" id="4163825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163829">Package</span><span class="op" id="4163836">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163841">pos</span><span class="op" id="4163844">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163848">Name</span><span class="op" id="4163852">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163860">ident</span><span class="op" id="4163865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163869">Decls</span><span class="op" id="4163874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163881">decls</span><span class="op" id="4163886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163890">Scope</span><span class="op" id="4163895">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163902">p</span><span class="op" id="4163903">.</span><span class="ident" id="4163904">pkgScope</span><span class="op" id="4163912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163916">Imports</span><span class="op" id="4163923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4163928">p</span><span class="op" id="4163929">.</span><span class="ident" id="4163930">imports</span><span class="op" id="4163937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163941">Unresolved</span><span class="op" id="4163951">:</span>&nbsp;<span class="ident" id="4163953">p</span><span class="op" id="4163954">.</span><span class="ident" id="4163955">unresolved</span><span class="op" id="4163965">[</span><span class="num" id="4163966">0</span><span class="op" id="4163967">:</span><span class="ident" id="4163968">i</span><span class="op" id="4163969">]</span><span class="op" id="4163970">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163974">Comments</span><span class="op" id="4163982">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4163986">p</span><span class="op" id="4163987">.</span><span class="ident" id="4163988">comments</span><span class="op" id="4163996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163999">}</span><br>
<span class="lineno"></span><span class="op" id="4164001">}</span>
</div>
</body>
</html>
