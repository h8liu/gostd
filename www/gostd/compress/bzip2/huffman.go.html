<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5980501">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5980556">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5980610">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5980661">package</span>&nbsp;<span class="ident" id="5980669">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5980676">import</span>&nbsp;<span class="string" id="5980683">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5980691">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5980767">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5980778">type</span>&nbsp;<span class="ident" id="5980783">huffmanTree</span>&nbsp;<span class="keyword" id="5980795">struct</span>&nbsp;<span class="op" id="5980802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980805">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980876">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980949">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981005">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981014">[</span><span class="op" id="5981015">]</span><span class="ident" id="5981016">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981029">nextNode</span>&nbsp;<span class="builtintype" id="5981038">int</span><br>
<span class="lineno"></span><span class="op" id="5981042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981045">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5981125">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5981205">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5981265">//</span><br>
<span class="lineno"></span><span class="comment" id="5981268">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5981345">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5981423">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5981473">type</span>&nbsp;<span class="ident" id="5981478">huffmanNode</span>&nbsp;<span class="keyword" id="5981490">struct</span>&nbsp;<span class="op" id="5981497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981500">left</span><span class="op" id="5981504">,</span>&nbsp;<span class="ident" id="5981506">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5981522">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981530">leftValue</span><span class="op" id="5981539">,</span>&nbsp;<span class="ident" id="5981541">rightValue</span>&nbsp;<span class="builtintype" id="5981552">uint16</span><br>
<span class="lineno"></span><span class="op" id="5981559">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5981562">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5981639">const</span>&nbsp;<span class="ident" id="5981645">invalidNodeValue</span>&nbsp;<span class="op" id="5981662">=</span>&nbsp;<span class="num" id="5981664">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981672">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5981749">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5981769">func</span>&nbsp;<span class="op" id="5981774">(</span><span class="ident" id="5981775">t</span>&nbsp;<span class="op" id="5981777">*</span><span class="ident" id="5981778">huffmanTree</span><span class="op" id="5981789">)</span>&nbsp;<span class="ident" id="5981791">Decode</span><span class="op" id="5981797">(</span><span class="ident" id="5981798">br</span>&nbsp;<span class="op" id="5981801">*</span><span class="ident" id="5981802">bitReader</span><span class="op" id="5981811">)</span>&nbsp;<span class="op" id="5981813">(</span><span class="ident" id="5981814">v</span>&nbsp;<span class="builtintype" id="5981816">uint16</span><span class="op" id="5981822">)</span>&nbsp;<span class="op" id="5981824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981827">nodeIndex</span>&nbsp;<span class="op" id="5981837">:=</span>&nbsp;<span class="builtintype" id="5981840">uint16</span><span class="op" id="5981846">(</span><span class="num" id="5981847">0</span><span class="op" id="5981848">)</span>&nbsp;<span class="comment" id="5981850">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981887">for</span>&nbsp;<span class="op" id="5981891">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981895">node</span>&nbsp;<span class="op" id="5981900">:=</span>&nbsp;<span class="op" id="5981903">&amp;</span><span class="ident" id="5981904">t</span><span class="op" id="5981905">.</span><span class="ident" id="5981906">nodes</span><span class="op" id="5981911">[</span><span class="ident" id="5981912">nodeIndex</span><span class="op" id="5981921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981925">bit</span><span class="op" id="5981928">,</span>&nbsp;<span class="ident" id="5981930">ok</span>&nbsp;<span class="op" id="5981933">:=</span>&nbsp;<span class="ident" id="5981936">br</span><span class="op" id="5981938">.</span><span class="ident" id="5981939">TryReadBit</span><span class="op" id="5981949">(</span><span class="op" id="5981950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981954">if</span>&nbsp;<span class="op" id="5981957">!</span><span class="ident" id="5981958">ok</span>&nbsp;<span class="op" id="5981961">&amp;&amp;</span>&nbsp;<span class="ident" id="5981964">br</span><span class="op" id="5981966">.</span><span class="ident" id="5981967">ReadBit</span><span class="op" id="5981974">(</span><span class="op" id="5981975">)</span>&nbsp;<span class="op" id="5981977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981982">bit</span>&nbsp;<span class="op" id="5981986">=</span>&nbsp;<span class="num" id="5981988">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981992">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981996">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982035">if</span>&nbsp;<span class="ident" id="5982038">bit</span>&nbsp;<span class="op" id="5982042">!=</span>&nbsp;<span class="num" id="5982045">0</span>&nbsp;<span class="op" id="5982047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982052">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982063">if</span>&nbsp;<span class="ident" id="5982066">node</span><span class="op" id="5982070">.</span><span class="ident" id="5982071">left</span>&nbsp;<span class="op" id="5982076">==</span>&nbsp;<span class="ident" id="5982079">invalidNodeValue</span>&nbsp;<span class="op" id="5982096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982102">return</span>&nbsp;<span class="ident" id="5982109">node</span><span class="op" id="5982113">.</span><span class="ident" id="5982114">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982132">nodeIndex</span>&nbsp;<span class="op" id="5982142">=</span>&nbsp;<span class="ident" id="5982144">node</span><span class="op" id="5982148">.</span><span class="ident" id="5982149">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982156">}</span>&nbsp;<span class="keyword" id="5982158">else</span>&nbsp;<span class="op" id="5982163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982168">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982180">if</span>&nbsp;<span class="ident" id="5982183">node</span><span class="op" id="5982187">.</span><span class="ident" id="5982188">right</span>&nbsp;<span class="op" id="5982194">==</span>&nbsp;<span class="ident" id="5982197">invalidNodeValue</span>&nbsp;<span class="op" id="5982214">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982220">return</span>&nbsp;<span class="ident" id="5982227">node</span><span class="op" id="5982231">.</span><span class="ident" id="5982232">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982251">nodeIndex</span>&nbsp;<span class="op" id="5982261">=</span>&nbsp;<span class="ident" id="5982263">node</span><span class="op" id="5982267">.</span><span class="ident" id="5982268">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982279">}</span><br>
<span class="lineno">60</span><span class="op" id="5982281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982284">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5982357">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5982420">func</span>&nbsp;<span class="ident" id="5982425">newHuffmanTree</span><span class="op" id="5982439">(</span><span class="ident" id="5982440">lengths</span>&nbsp;<span class="op" id="5982448">[</span><span class="op" id="5982449">]</span><span class="builtintype" id="5982450">uint8</span><span class="op" id="5982455">)</span>&nbsp;<span class="op" id="5982457">(</span><span class="ident" id="5982458">huffmanTree</span><span class="op" id="5982469">,</span>&nbsp;<span class="builtintype" id="5982471">error</span><span class="op" id="5982476">)</span>&nbsp;<span class="op" id="5982478">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982481">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982551">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982616">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982678">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982746">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982817">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982887">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982926">if</span>&nbsp;<span class="builtinfunc" id="5982929">len</span><span class="op" id="5982932">(</span><span class="ident" id="5982933">lengths</span><span class="op" id="5982940">)</span>&nbsp;<span class="op" id="5982942">&lt;</span>&nbsp;<span class="num" id="5982944">2</span>&nbsp;<span class="op" id="5982946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5982950">panic</span><span class="op" id="5982955">(</span><span class="string" id="5982956">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5982989">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982996">var</span>&nbsp;<span class="ident" id="5983000">t</span>&nbsp;<span class="ident" id="5983002">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983016">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983088">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983130">pairs</span>&nbsp;<span class="op" id="5983136">:=</span>&nbsp;<span class="ident" id="5983139">huffmanSymbolLengthPairs</span><span class="op" id="5983163">(</span><span class="builtinfunc" id="5983164">make</span><span class="op" id="5983168">(</span><span class="op" id="5983169">[</span><span class="op" id="5983170">]</span><span class="ident" id="5983171">huffmanSymbolLengthPair</span><span class="op" id="5983194">,</span>&nbsp;<span class="builtinfunc" id="5983196">len</span><span class="op" id="5983199">(</span><span class="ident" id="5983200">lengths</span><span class="op" id="5983207">)</span><span class="op" id="5983208">)</span><span class="op" id="5983209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983212">for</span>&nbsp;<span class="ident" id="5983216">i</span><span class="op" id="5983217">,</span>&nbsp;<span class="ident" id="5983219">length</span>&nbsp;<span class="op" id="5983226">:=</span>&nbsp;<span class="keyword" id="5983229">range</span>&nbsp;<span class="ident" id="5983235">lengths</span>&nbsp;<span class="op" id="5983243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983247">pairs</span><span class="op" id="5983252">[</span><span class="ident" id="5983253">i</span><span class="op" id="5983254">]</span><span class="op" id="5983255">.</span><span class="ident" id="5983256">value</span>&nbsp;<span class="op" id="5983262">=</span>&nbsp;<span class="builtintype" id="5983264">uint16</span><span class="op" id="5983270">(</span><span class="ident" id="5983271">i</span><span class="op" id="5983272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983276">pairs</span><span class="op" id="5983281">[</span><span class="ident" id="5983282">i</span><span class="op" id="5983283">]</span><span class="op" id="5983284">.</span><span class="ident" id="5983285">length</span>&nbsp;<span class="op" id="5983292">=</span>&nbsp;<span class="ident" id="5983294">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983306">sort</span><span class="op" id="5983310">.</span><span class="ident" id="5983311">Sort</span><span class="op" id="5983315">(</span><span class="ident" id="5983316">pairs</span><span class="op" id="5983321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983325">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983397">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983470">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983542">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983563">code</span>&nbsp;<span class="op" id="5983568">:=</span>&nbsp;<span class="builtintype" id="5983571">uint32</span><span class="op" id="5983577">(</span><span class="num" id="5983578">0</span><span class="op" id="5983579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983582">length</span>&nbsp;<span class="op" id="5983589">:=</span>&nbsp;<span class="builtintype" id="5983592">uint8</span><span class="op" id="5983597">(</span><span class="num" id="5983598">32</span><span class="op" id="5983600">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983604">codes</span>&nbsp;<span class="op" id="5983610">:=</span>&nbsp;<span class="ident" id="5983613">huffmanCodes</span><span class="op" id="5983625">(</span><span class="builtinfunc" id="5983626">make</span><span class="op" id="5983630">(</span><span class="op" id="5983631">[</span><span class="op" id="5983632">]</span><span class="ident" id="5983633">huffmanCode</span><span class="op" id="5983644">,</span>&nbsp;<span class="builtinfunc" id="5983646">len</span><span class="op" id="5983649">(</span><span class="ident" id="5983650">lengths</span><span class="op" id="5983657">)</span><span class="op" id="5983658">)</span><span class="op" id="5983659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983662">for</span>&nbsp;<span class="ident" id="5983666">i</span>&nbsp;<span class="op" id="5983668">:=</span>&nbsp;<span class="builtinfunc" id="5983671">len</span><span class="op" id="5983674">(</span><span class="ident" id="5983675">pairs</span><span class="op" id="5983680">)</span>&nbsp;<span class="op" id="5983682">-</span>&nbsp;<span class="num" id="5983684">1</span><span class="op" id="5983685">;</span>&nbsp;<span class="ident" id="5983687">i</span>&nbsp;<span class="op" id="5983689">&gt;=</span>&nbsp;<span class="num" id="5983692">0</span><span class="op" id="5983693">;</span>&nbsp;<span class="ident" id="5983695">i</span><span class="op" id="5983696">--</span>&nbsp;<span class="op" id="5983699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983703">if</span>&nbsp;<span class="ident" id="5983706">length</span>&nbsp;<span class="op" id="5983713">&gt;</span>&nbsp;<span class="ident" id="5983715">pairs</span><span class="op" id="5983720">[</span><span class="ident" id="5983721">i</span><span class="op" id="5983722">]</span><span class="op" id="5983723">.</span><span class="ident" id="5983724">length</span>&nbsp;<span class="op" id="5983731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983736">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983792">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983840">length</span>&nbsp;<span class="op" id="5983847">&gt;&gt;=</span>&nbsp;<span class="num" id="5983851">32</span>&nbsp;<span class="op" id="5983854">-</span>&nbsp;<span class="ident" id="5983856">pairs</span><span class="op" id="5983861">[</span><span class="ident" id="5983862">i</span><span class="op" id="5983863">]</span><span class="op" id="5983864">.</span><span class="ident" id="5983865">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983875">length</span>&nbsp;<span class="op" id="5983882">&lt;&lt;=</span>&nbsp;<span class="num" id="5983886">32</span>&nbsp;<span class="op" id="5983889">-</span>&nbsp;<span class="ident" id="5983891">pairs</span><span class="op" id="5983896">[</span><span class="ident" id="5983897">i</span><span class="op" id="5983898">]</span><span class="op" id="5983899">.</span><span class="ident" id="5983900">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983910">length</span>&nbsp;<span class="op" id="5983917">=</span>&nbsp;<span class="ident" id="5983919">pairs</span><span class="op" id="5983924">[</span><span class="ident" id="5983925">i</span><span class="op" id="5983926">]</span><span class="op" id="5983927">.</span><span class="ident" id="5983928">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983937">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983941">codes</span><span class="op" id="5983946">[</span><span class="ident" id="5983947">i</span><span class="op" id="5983948">]</span><span class="op" id="5983949">.</span><span class="ident" id="5983950">code</span>&nbsp;<span class="op" id="5983955">=</span>&nbsp;<span class="ident" id="5983957">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983964">codes</span><span class="op" id="5983969">[</span><span class="ident" id="5983970">i</span><span class="op" id="5983971">]</span><span class="op" id="5983972">.</span><span class="ident" id="5983973">codeLen</span>&nbsp;<span class="op" id="5983981">=</span>&nbsp;<span class="ident" id="5983983">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983992">codes</span><span class="op" id="5983997">[</span><span class="ident" id="5983998">i</span><span class="op" id="5983999">]</span><span class="op" id="5984000">.</span><span class="ident" id="5984001">value</span>&nbsp;<span class="op" id="5984007">=</span>&nbsp;<span class="ident" id="5984009">pairs</span><span class="op" id="5984014">[</span><span class="ident" id="5984015">i</span><span class="op" id="5984016">]</span><span class="op" id="5984017">.</span><span class="ident" id="5984018">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984026">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984092">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984125">code</span>&nbsp;<span class="op" id="5984130">+=</span>&nbsp;<span class="num" id="5984133">1</span>&nbsp;<span class="op" id="5984135">&lt;&lt;</span>&nbsp;<span class="op" id="5984138">(</span><span class="num" id="5984139">32</span>&nbsp;<span class="op" id="5984142">-</span>&nbsp;<span class="ident" id="5984144">length</span><span class="op" id="5984150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984157">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984230">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984265">sort</span><span class="op" id="5984269">.</span><span class="ident" id="5984270">Sort</span><span class="op" id="5984274">(</span><span class="ident" id="5984275">codes</span><span class="op" id="5984280">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984284">t</span><span class="op" id="5984285">.</span><span class="ident" id="5984286">nodes</span>&nbsp;<span class="op" id="5984292">=</span>&nbsp;<span class="builtinfunc" id="5984294">make</span><span class="op" id="5984298">(</span><span class="op" id="5984299">[</span><span class="op" id="5984300">]</span><span class="ident" id="5984301">huffmanNode</span><span class="op" id="5984312">,</span>&nbsp;<span class="builtinfunc" id="5984314">len</span><span class="op" id="5984317">(</span><span class="ident" id="5984318">codes</span><span class="op" id="5984323">)</span><span class="op" id="5984324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984327">_</span><span class="op" id="5984328">,</span>&nbsp;<span class="ident" id="5984330">err</span>&nbsp;<span class="op" id="5984334">:=</span>&nbsp;<span class="ident" id="5984337">buildHuffmanNode</span><span class="op" id="5984353">(</span><span class="op" id="5984354">&amp;</span><span class="ident" id="5984355">t</span><span class="op" id="5984356">,</span>&nbsp;<span class="ident" id="5984358">codes</span><span class="op" id="5984363">,</span>&nbsp;<span class="num" id="5984365">0</span><span class="op" id="5984366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984369">return</span>&nbsp;<span class="ident" id="5984376">t</span><span class="op" id="5984377">,</span>&nbsp;<span class="ident" id="5984379">err</span><br>
<span class="lineno">120</span><span class="op" id="5984383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984386">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5984452">type</span>&nbsp;<span class="ident" id="5984457">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5984481">struct</span>&nbsp;<span class="op" id="5984488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984491">value</span>&nbsp;&nbsp;<span class="builtintype" id="5984498">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984506">length</span>&nbsp;<span class="builtintype" id="5984513">uint8</span><br>
<span class="lineno"></span><span class="op" id="5984519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5984522">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5984594">type</span>&nbsp;<span class="ident" id="5984599">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5984624">[</span><span class="op" id="5984625">]</span><span class="ident" id="5984626">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5984651">func</span>&nbsp;<span class="op" id="5984656">(</span><span class="ident" id="5984657">h</span>&nbsp;<span class="ident" id="5984659">huffmanSymbolLengthPairs</span><span class="op" id="5984683">)</span>&nbsp;<span class="ident" id="5984685">Len</span><span class="op" id="5984688">(</span><span class="op" id="5984689">)</span>&nbsp;<span class="builtintype" id="5984691">int</span>&nbsp;<span class="op" id="5984695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984698">return</span>&nbsp;<span class="builtinfunc" id="5984705">len</span><span class="op" id="5984708">(</span><span class="ident" id="5984709">h</span><span class="op" id="5984710">)</span><br>
<span class="lineno"></span><span class="op" id="5984712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5984715">func</span>&nbsp;<span class="op" id="5984720">(</span><span class="ident" id="5984721">h</span>&nbsp;<span class="ident" id="5984723">huffmanSymbolLengthPairs</span><span class="op" id="5984747">)</span>&nbsp;<span class="ident" id="5984749">Less</span><span class="op" id="5984753">(</span><span class="ident" id="5984754">i</span><span class="op" id="5984755">,</span>&nbsp;<span class="ident" id="5984757">j</span>&nbsp;<span class="builtintype" id="5984759">int</span><span class="op" id="5984762">)</span>&nbsp;<span class="builtintype" id="5984764">bool</span>&nbsp;<span class="op" id="5984769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984772">if</span>&nbsp;<span class="ident" id="5984775">h</span><span class="op" id="5984776">[</span><span class="ident" id="5984777">i</span><span class="op" id="5984778">]</span><span class="op" id="5984779">.</span><span class="ident" id="5984780">length</span>&nbsp;<span class="op" id="5984787">&lt;</span>&nbsp;<span class="ident" id="5984789">h</span><span class="op" id="5984790">[</span><span class="ident" id="5984791">j</span><span class="op" id="5984792">]</span><span class="op" id="5984793">.</span><span class="ident" id="5984794">length</span>&nbsp;<span class="op" id="5984801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984805">return</span>&nbsp;<span class="builtintype" id="5984812">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984821">if</span>&nbsp;<span class="ident" id="5984824">h</span><span class="op" id="5984825">[</span><span class="ident" id="5984826">i</span><span class="op" id="5984827">]</span><span class="op" id="5984828">.</span><span class="ident" id="5984829">length</span>&nbsp;<span class="op" id="5984836">&gt;</span>&nbsp;<span class="ident" id="5984838">h</span><span class="op" id="5984839">[</span><span class="ident" id="5984840">j</span><span class="op" id="5984841">]</span><span class="op" id="5984842">.</span><span class="ident" id="5984843">length</span>&nbsp;<span class="op" id="5984850">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984854">return</span>&nbsp;<span class="builtintype" id="5984861">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984871">if</span>&nbsp;<span class="ident" id="5984874">h</span><span class="op" id="5984875">[</span><span class="ident" id="5984876">i</span><span class="op" id="5984877">]</span><span class="op" id="5984878">.</span><span class="ident" id="5984879">value</span>&nbsp;<span class="op" id="5984885">&lt;</span>&nbsp;<span class="ident" id="5984887">h</span><span class="op" id="5984888">[</span><span class="ident" id="5984889">j</span><span class="op" id="5984890">]</span><span class="op" id="5984891">.</span><span class="ident" id="5984892">value</span>&nbsp;<span class="op" id="5984898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984902">return</span>&nbsp;<span class="builtintype" id="5984909">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984915">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984918">return</span>&nbsp;<span class="builtintype" id="5984925">false</span><br>
<span class="lineno"></span><span class="op" id="5984931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984934">func</span>&nbsp;<span class="op" id="5984939">(</span><span class="ident" id="5984940">h</span>&nbsp;<span class="ident" id="5984942">huffmanSymbolLengthPairs</span><span class="op" id="5984966">)</span>&nbsp;<span class="ident" id="5984968">Swap</span><span class="op" id="5984972">(</span><span class="ident" id="5984973">i</span><span class="op" id="5984974">,</span>&nbsp;<span class="ident" id="5984976">j</span>&nbsp;<span class="builtintype" id="5984978">int</span><span class="op" id="5984981">)</span>&nbsp;<span class="op" id="5984983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984986">h</span><span class="op" id="5984987">[</span><span class="ident" id="5984988">i</span><span class="op" id="5984989">]</span><span class="op" id="5984990">,</span>&nbsp;<span class="ident" id="5984992">h</span><span class="op" id="5984993">[</span><span class="ident" id="5984994">j</span><span class="op" id="5984995">]</span>&nbsp;<span class="op" id="5984997">=</span>&nbsp;<span class="ident" id="5984999">h</span><span class="op" id="5985000">[</span><span class="ident" id="5985001">j</span><span class="op" id="5985002">]</span><span class="op" id="5985003">,</span>&nbsp;<span class="ident" id="5985005">h</span><span class="op" id="5985006">[</span><span class="ident" id="5985007">i</span><span class="op" id="5985008">]</span><br>
<span class="lineno">150</span><span class="op" id="5985010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985013">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5985073">type</span>&nbsp;<span class="ident" id="5985078">huffmanCode</span>&nbsp;<span class="keyword" id="5985090">struct</span>&nbsp;<span class="op" id="5985097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985100">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985108">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985116">codeLen</span>&nbsp;<span class="builtintype" id="5985124">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985131">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985139">uint16</span><br>
<span class="lineno"></span><span class="op" id="5985146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985149">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5985210">type</span>&nbsp;<span class="ident" id="5985215">huffmanCodes</span>&nbsp;<span class="op" id="5985228">[</span><span class="op" id="5985229">]</span><span class="ident" id="5985230">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5985243">func</span>&nbsp;<span class="op" id="5985248">(</span><span class="ident" id="5985249">n</span>&nbsp;<span class="ident" id="5985251">huffmanCodes</span><span class="op" id="5985263">)</span>&nbsp;<span class="ident" id="5985265">Len</span><span class="op" id="5985268">(</span><span class="op" id="5985269">)</span>&nbsp;<span class="builtintype" id="5985271">int</span>&nbsp;<span class="op" id="5985275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985278">return</span>&nbsp;<span class="builtinfunc" id="5985285">len</span><span class="op" id="5985288">(</span><span class="ident" id="5985289">n</span><span class="op" id="5985290">)</span><br>
<span class="lineno"></span><span class="op" id="5985292">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5985295">func</span>&nbsp;<span class="op" id="5985300">(</span><span class="ident" id="5985301">n</span>&nbsp;<span class="ident" id="5985303">huffmanCodes</span><span class="op" id="5985315">)</span>&nbsp;<span class="ident" id="5985317">Less</span><span class="op" id="5985321">(</span><span class="ident" id="5985322">i</span><span class="op" id="5985323">,</span>&nbsp;<span class="ident" id="5985325">j</span>&nbsp;<span class="builtintype" id="5985327">int</span><span class="op" id="5985330">)</span>&nbsp;<span class="builtintype" id="5985332">bool</span>&nbsp;<span class="op" id="5985337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985340">return</span>&nbsp;<span class="ident" id="5985347">n</span><span class="op" id="5985348">[</span><span class="ident" id="5985349">i</span><span class="op" id="5985350">]</span><span class="op" id="5985351">.</span><span class="ident" id="5985352">code</span>&nbsp;<span class="op" id="5985357">&lt;</span>&nbsp;<span class="ident" id="5985359">n</span><span class="op" id="5985360">[</span><span class="ident" id="5985361">j</span><span class="op" id="5985362">]</span><span class="op" id="5985363">.</span><span class="ident" id="5985364">code</span><br>
<span class="lineno"></span><span class="op" id="5985369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5985372">func</span>&nbsp;<span class="op" id="5985377">(</span><span class="ident" id="5985378">n</span>&nbsp;<span class="ident" id="5985380">huffmanCodes</span><span class="op" id="5985392">)</span>&nbsp;<span class="ident" id="5985394">Swap</span><span class="op" id="5985398">(</span><span class="ident" id="5985399">i</span><span class="op" id="5985400">,</span>&nbsp;<span class="ident" id="5985402">j</span>&nbsp;<span class="builtintype" id="5985404">int</span><span class="op" id="5985407">)</span>&nbsp;<span class="op" id="5985409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985412">n</span><span class="op" id="5985413">[</span><span class="ident" id="5985414">i</span><span class="op" id="5985415">]</span><span class="op" id="5985416">,</span>&nbsp;<span class="ident" id="5985418">n</span><span class="op" id="5985419">[</span><span class="ident" id="5985420">j</span><span class="op" id="5985421">]</span>&nbsp;<span class="op" id="5985423">=</span>&nbsp;<span class="ident" id="5985425">n</span><span class="op" id="5985426">[</span><span class="ident" id="5985427">j</span><span class="op" id="5985428">]</span><span class="op" id="5985429">,</span>&nbsp;<span class="ident" id="5985431">n</span><span class="op" id="5985432">[</span><span class="ident" id="5985433">i</span><span class="op" id="5985434">]</span><br>
<span class="lineno"></span><span class="op" id="5985436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985439">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5985517">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5985591">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5985612">func</span>&nbsp;<span class="ident" id="5985617">buildHuffmanNode</span><span class="op" id="5985633">(</span><span class="ident" id="5985634">t</span>&nbsp;<span class="op" id="5985636">*</span><span class="ident" id="5985637">huffmanTree</span><span class="op" id="5985648">,</span>&nbsp;<span class="ident" id="5985650">codes</span>&nbsp;<span class="op" id="5985656">[</span><span class="op" id="5985657">]</span><span class="ident" id="5985658">huffmanCode</span><span class="op" id="5985669">,</span>&nbsp;<span class="ident" id="5985671">level</span>&nbsp;<span class="builtintype" id="5985677">uint32</span><span class="op" id="5985683">)</span>&nbsp;<span class="op" id="5985685">(</span><span class="ident" id="5985686">nodeIndex</span>&nbsp;<span class="builtintype" id="5985696">uint16</span><span class="op" id="5985702">,</span>&nbsp;<span class="ident" id="5985704">err</span>&nbsp;<span class="builtintype" id="5985708">error</span><span class="op" id="5985713">)</span>&nbsp;<span class="op" id="5985715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985718">test</span>&nbsp;<span class="op" id="5985723">:=</span>&nbsp;<span class="builtintype" id="5985726">uint32</span><span class="op" id="5985732">(</span><span class="num" id="5985733">1</span><span class="op" id="5985734">)</span>&nbsp;<span class="op" id="5985736">&lt;&lt;</span>&nbsp;<span class="op" id="5985739">(</span><span class="num" id="5985740">31</span>&nbsp;<span class="op" id="5985743">-</span>&nbsp;<span class="ident" id="5985745">level</span><span class="op" id="5985750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985754">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985847">firstRightIndex</span>&nbsp;<span class="op" id="5985863">:=</span>&nbsp;<span class="builtinfunc" id="5985866">len</span><span class="op" id="5985869">(</span><span class="ident" id="5985870">codes</span><span class="op" id="5985875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985878">for</span>&nbsp;<span class="ident" id="5985882">i</span><span class="op" id="5985883">,</span>&nbsp;<span class="ident" id="5985885">code</span>&nbsp;<span class="op" id="5985890">:=</span>&nbsp;<span class="keyword" id="5985893">range</span>&nbsp;<span class="ident" id="5985899">codes</span>&nbsp;<span class="op" id="5985905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985909">if</span>&nbsp;<span class="ident" id="5985912">code</span><span class="op" id="5985916">.</span><span class="ident" id="5985917">code</span><span class="op" id="5985921">&amp;</span><span class="ident" id="5985922">test</span>&nbsp;<span class="op" id="5985927">!=</span>&nbsp;<span class="num" id="5985930">0</span>&nbsp;<span class="op" id="5985932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985937">firstRightIndex</span>&nbsp;<span class="op" id="5985953">=</span>&nbsp;<span class="ident" id="5985955">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985960">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985975">left</span>&nbsp;<span class="op" id="5985980">:=</span>&nbsp;<span class="ident" id="5985983">codes</span><span class="op" id="5985988">[</span><span class="op" id="5985989">:</span><span class="ident" id="5985990">firstRightIndex</span><span class="op" id="5986005">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986008">right</span>&nbsp;<span class="op" id="5986014">:=</span>&nbsp;<span class="ident" id="5986017">codes</span><span class="op" id="5986022">[</span><span class="ident" id="5986023">firstRightIndex</span><span class="op" id="5986038">:</span><span class="op" id="5986039">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986043">if</span>&nbsp;<span class="builtinfunc" id="5986046">len</span><span class="op" id="5986049">(</span><span class="ident" id="5986050">left</span><span class="op" id="5986054">)</span>&nbsp;<span class="op" id="5986056">==</span>&nbsp;<span class="num" id="5986059">0</span>&nbsp;<span class="op" id="5986061">||</span>&nbsp;<span class="builtinfunc" id="5986064">len</span><span class="op" id="5986067">(</span><span class="ident" id="5986068">right</span><span class="op" id="5986073">)</span>&nbsp;<span class="op" id="5986075">==</span>&nbsp;<span class="num" id="5986078">0</span>&nbsp;<span class="op" id="5986080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986084">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986149">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986215">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986247">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986310">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986373">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986421">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986426">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986491">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986557">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986619">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986674">if</span>&nbsp;<span class="builtinfunc" id="5986677">len</span><span class="op" id="5986680">(</span><span class="ident" id="5986681">codes</span><span class="op" id="5986686">)</span>&nbsp;<span class="op" id="5986688">&lt;</span>&nbsp;<span class="num" id="5986690">2</span>&nbsp;<span class="op" id="5986692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986697">return</span>&nbsp;<span class="num" id="5986704">0</span><span class="op" id="5986705">,</span>&nbsp;<span class="ident" id="5986707">StructuralError</span><span class="op" id="5986722">(</span><span class="string" id="5986723">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5986743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986752">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986817">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986876">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986892">if</span>&nbsp;<span class="ident" id="5986895">level</span>&nbsp;<span class="op" id="5986901">==</span>&nbsp;<span class="num" id="5986904">31</span>&nbsp;<span class="op" id="5986907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986912">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986969">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987028">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987079">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987105">return</span>&nbsp;<span class="num" id="5987112">0</span><span class="op" id="5987113">,</span>&nbsp;<span class="ident" id="5987115">StructuralError</span><span class="op" id="5987130">(</span><span class="string" id="5987131">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5987162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987171">if</span>&nbsp;<span class="builtinfunc" id="5987174">len</span><span class="op" id="5987177">(</span><span class="ident" id="5987178">left</span><span class="op" id="5987182">)</span>&nbsp;<span class="op" id="5987184">==</span>&nbsp;<span class="num" id="5987187">0</span>&nbsp;<span class="op" id="5987189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987194">return</span>&nbsp;<span class="ident" id="5987201">buildHuffmanNode</span><span class="op" id="5987217">(</span><span class="ident" id="5987218">t</span><span class="op" id="5987219">,</span>&nbsp;<span class="ident" id="5987221">right</span><span class="op" id="5987226">,</span>&nbsp;<span class="ident" id="5987228">level</span><span class="op" id="5987233">+</span><span class="num" id="5987234">1</span><span class="op" id="5987235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987243">return</span>&nbsp;<span class="ident" id="5987250">buildHuffmanNode</span><span class="op" id="5987266">(</span><span class="ident" id="5987267">t</span><span class="op" id="5987268">,</span>&nbsp;<span class="ident" id="5987270">left</span><span class="op" id="5987274">,</span>&nbsp;<span class="ident" id="5987276">level</span><span class="op" id="5987281">+</span><span class="num" id="5987282">1</span><span class="op" id="5987283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987286">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987290">nodeIndex</span>&nbsp;<span class="op" id="5987300">=</span>&nbsp;<span class="builtintype" id="5987302">uint16</span><span class="op" id="5987308">(</span><span class="ident" id="5987309">t</span><span class="op" id="5987310">.</span><span class="ident" id="5987311">nextNode</span><span class="op" id="5987319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987322">node</span>&nbsp;<span class="op" id="5987327">:=</span>&nbsp;<span class="op" id="5987330">&amp;</span><span class="ident" id="5987331">t</span><span class="op" id="5987332">.</span><span class="ident" id="5987333">nodes</span><span class="op" id="5987338">[</span><span class="ident" id="5987339">t</span><span class="op" id="5987340">.</span><span class="ident" id="5987341">nextNode</span><span class="op" id="5987349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987352">t</span><span class="op" id="5987353">.</span><span class="ident" id="5987354">nextNode</span><span class="op" id="5987362">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987367">if</span>&nbsp;<span class="builtinfunc" id="5987370">len</span><span class="op" id="5987373">(</span><span class="ident" id="5987374">left</span><span class="op" id="5987378">)</span>&nbsp;<span class="op" id="5987380">==</span>&nbsp;<span class="num" id="5987383">1</span>&nbsp;<span class="op" id="5987385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987389">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987404">node</span><span class="op" id="5987408">.</span><span class="ident" id="5987409">left</span>&nbsp;<span class="op" id="5987414">=</span>&nbsp;<span class="ident" id="5987416">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987435">node</span><span class="op" id="5987439">.</span><span class="ident" id="5987440">leftValue</span>&nbsp;<span class="op" id="5987450">=</span>&nbsp;<span class="ident" id="5987452">left</span><span class="op" id="5987456">[</span><span class="num" id="5987457">0</span><span class="op" id="5987458">]</span><span class="op" id="5987459">.</span><span class="ident" id="5987460">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987467">}</span>&nbsp;<span class="keyword" id="5987469">else</span>&nbsp;<span class="op" id="5987474">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987478">node</span><span class="op" id="5987482">.</span><span class="ident" id="5987483">left</span><span class="op" id="5987487">,</span>&nbsp;<span class="ident" id="5987489">err</span>&nbsp;<span class="op" id="5987493">=</span>&nbsp;<span class="ident" id="5987495">buildHuffmanNode</span><span class="op" id="5987511">(</span><span class="ident" id="5987512">t</span><span class="op" id="5987513">,</span>&nbsp;<span class="ident" id="5987515">left</span><span class="op" id="5987519">,</span>&nbsp;<span class="ident" id="5987521">level</span><span class="op" id="5987526">+</span><span class="num" id="5987527">1</span><span class="op" id="5987528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987535">if</span>&nbsp;<span class="ident" id="5987538">err</span>&nbsp;<span class="op" id="5987542">!=</span>&nbsp;<span class="builtintype" id="5987545">nil</span>&nbsp;<span class="op" id="5987549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987553">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987565">if</span>&nbsp;<span class="builtinfunc" id="5987568">len</span><span class="op" id="5987571">(</span><span class="ident" id="5987572">right</span><span class="op" id="5987577">)</span>&nbsp;<span class="op" id="5987579">==</span>&nbsp;<span class="num" id="5987582">1</span>&nbsp;<span class="op" id="5987584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987588">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987603">node</span><span class="op" id="5987607">.</span><span class="ident" id="5987608">right</span>&nbsp;<span class="op" id="5987614">=</span>&nbsp;<span class="ident" id="5987616">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987635">node</span><span class="op" id="5987639">.</span><span class="ident" id="5987640">rightValue</span>&nbsp;<span class="op" id="5987651">=</span>&nbsp;<span class="ident" id="5987653">right</span><span class="op" id="5987658">[</span><span class="num" id="5987659">0</span><span class="op" id="5987660">]</span><span class="op" id="5987661">.</span><span class="ident" id="5987662">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987669">}</span>&nbsp;<span class="keyword" id="5987671">else</span>&nbsp;<span class="op" id="5987676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987680">node</span><span class="op" id="5987684">.</span><span class="ident" id="5987685">right</span><span class="op" id="5987690">,</span>&nbsp;<span class="ident" id="5987692">err</span>&nbsp;<span class="op" id="5987696">=</span>&nbsp;<span class="ident" id="5987698">buildHuffmanNode</span><span class="op" id="5987714">(</span><span class="ident" id="5987715">t</span><span class="op" id="5987716">,</span>&nbsp;<span class="ident" id="5987718">right</span><span class="op" id="5987723">,</span>&nbsp;<span class="ident" id="5987725">level</span><span class="op" id="5987730">+</span><span class="num" id="5987731">1</span><span class="op" id="5987732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987739">return</span><br>
<span class="lineno"></span><span class="op" id="5987746">}</span>
</div>
</body>
</html>
