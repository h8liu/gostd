<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html" class="current">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8541286">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8541341">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8541395">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8541446">package</span>&nbsp;<span class="ident" id="8541454">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541461">import</span>&nbsp;<span class="op" id="8541468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8541471">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8541482">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8541492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541495">type</span>&nbsp;<span class="ident" id="8541500">T</span>&nbsp;<span class="builtintype" id="8541502">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541507">func</span>&nbsp;<span class="op" id="8541512">(</span><span class="ident" id="8541513">t</span>&nbsp;<span class="op" id="8541515">*</span><span class="ident" id="8541516">T</span><span class="op" id="8541517">)</span>&nbsp;<span class="ident" id="8541519">ptrmethod</span><span class="op" id="8541528">(</span><span class="op" id="8541529">)</span>&nbsp;<span class="op" id="8541531">[</span><span class="op" id="8541532">]</span><span class="builtintype" id="8541533">byte</span>&nbsp;<span class="op" id="8541538">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541541">return</span>&nbsp;<span class="ident" id="8541548">Stack</span><span class="op" id="8541553">(</span><span class="op" id="8541554">)</span><br>
<span class="lineno"></span><span class="op" id="8541556">}</span><br>
<span class="lineno"></span><span class="keyword" id="8541558">func</span>&nbsp;<span class="op" id="8541563">(</span><span class="ident" id="8541564">t</span>&nbsp;<span class="ident" id="8541566">T</span><span class="op" id="8541567">)</span>&nbsp;<span class="ident" id="8541569">method</span><span class="op" id="8541575">(</span><span class="op" id="8541576">)</span>&nbsp;<span class="op" id="8541578">[</span><span class="op" id="8541579">]</span><span class="builtintype" id="8541580">byte</span>&nbsp;<span class="op" id="8541585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8541588">return</span>&nbsp;<span class="ident" id="8541595">t</span><span class="op" id="8541596">.</span><span class="ident" id="8541597">ptrmethod</span><span class="op" id="8541606">(</span><span class="op" id="8541607">)</span><br>
<span class="lineno"></span><span class="op" id="8541609">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8541612">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;Don&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8542225">func</span>&nbsp;<span class="ident" id="8542230">TestStack</span><span class="op" id="8542239">(</span><span class="ident" id="8542240">t</span>&nbsp;<span class="op" id="8542242">*</span><span class="ident" id="8542243">testing</span><span class="op" id="8542250">.</span><span class="ident" id="8542251">T</span><span class="op" id="8542252">)</span>&nbsp;<span class="op" id="8542254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542257">b</span>&nbsp;<span class="op" id="8542259">:=</span>&nbsp;<span class="ident" id="8542262">T</span><span class="op" id="8542263">(</span><span class="num" id="8542264">0</span><span class="op" id="8542265">)</span><span class="op" id="8542266">.</span><span class="ident" id="8542267">method</span><span class="op" id="8542273">(</span><span class="op" id="8542274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542277">lines</span>&nbsp;<span class="op" id="8542283">:=</span>&nbsp;<span class="ident" id="8542286">strings</span><span class="op" id="8542293">.</span><span class="ident" id="8542294">Split</span><span class="op" id="8542299">(</span><span class="builtintype" id="8542300">string</span><span class="op" id="8542306">(</span><span class="ident" id="8542307">b</span><span class="op" id="8542308">)</span><span class="op" id="8542309">,</span>&nbsp;<span class="string" id="8542311">&#34;\n&#34;</span><span class="op" id="8542315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8542318">if</span>&nbsp;<span class="builtinfunc" id="8542321">len</span><span class="op" id="8542324">(</span><span class="ident" id="8542325">lines</span><span class="op" id="8542330">)</span>&nbsp;<span class="op" id="8542332">&lt;</span>&nbsp;<span class="num" id="8542334">6</span>&nbsp;<span class="op" id="8542336">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542340">t</span><span class="op" id="8542341">.</span><span class="ident" id="8542342">Fatal</span><span class="op" id="8542347">(</span><span class="string" id="8542348">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8542363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8542366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542369">n</span>&nbsp;<span class="op" id="8542371">:=</span>&nbsp;<span class="num" id="8542374">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542377">frame</span>&nbsp;<span class="op" id="8542383">:=</span>&nbsp;<span class="keyword" id="8542386">func</span><span class="op" id="8542390">(</span><span class="ident" id="8542391">line</span><span class="op" id="8542395">,</span>&nbsp;<span class="ident" id="8542397">code</span>&nbsp;<span class="builtintype" id="8542402">string</span><span class="op" id="8542408">)</span>&nbsp;<span class="op" id="8542410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542414">check</span><span class="op" id="8542419">(</span><span class="ident" id="8542420">t</span><span class="op" id="8542421">,</span>&nbsp;<span class="ident" id="8542423">lines</span><span class="op" id="8542428">[</span><span class="ident" id="8542429">n</span><span class="op" id="8542430">]</span><span class="op" id="8542431">,</span>&nbsp;<span class="ident" id="8542433">line</span><span class="op" id="8542437">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542441">n</span><span class="op" id="8542442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8542447">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8542510">if</span>&nbsp;<span class="ident" id="8542513">strings</span><span class="op" id="8542520">.</span><span class="ident" id="8542521">HasPrefix</span><span class="op" id="8542530">(</span><span class="ident" id="8542531">lines</span><span class="op" id="8542536">[</span><span class="ident" id="8542537">n</span><span class="op" id="8542538">]</span><span class="op" id="8542539">,</span>&nbsp;<span class="string" id="8542541">&#34;\t&#34;</span><span class="op" id="8542545">)</span>&nbsp;<span class="op" id="8542547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542552">check</span><span class="op" id="8542557">(</span><span class="ident" id="8542558">t</span><span class="op" id="8542559">,</span>&nbsp;<span class="ident" id="8542561">lines</span><span class="op" id="8542566">[</span><span class="ident" id="8542567">n</span><span class="op" id="8542568">]</span><span class="op" id="8542569">,</span>&nbsp;<span class="ident" id="8542571">code</span><span class="op" id="8542575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542580">n</span><span class="op" id="8542581">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8542586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8542589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542592">frame</span><span class="op" id="8542597">(</span><span class="string" id="8542598">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8542631">,</span>&nbsp;<span class="string" id="8542633">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8542667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542670">frame</span><span class="op" id="8542675">(</span><span class="string" id="8542676">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8542709">,</span>&nbsp;<span class="string" id="8542711">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8542745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542748">frame</span><span class="op" id="8542753">(</span><span class="string" id="8542754">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8542787">,</span>&nbsp;<span class="string" id="8542789">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8542822">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542825">frame</span><span class="op" id="8542830">(</span><span class="string" id="8542831">&#34;src/testing/testing.go&#34;</span><span class="op" id="8542855">,</span>&nbsp;<span class="string" id="8542857">&#34;&#34;</span><span class="op" id="8542859">)</span><br>
<span class="lineno"></span><span class="op" id="8542861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8542864">func</span>&nbsp;<span class="ident" id="8542869">check</span><span class="op" id="8542874">(</span><span class="ident" id="8542875">t</span>&nbsp;<span class="op" id="8542877">*</span><span class="ident" id="8542878">testing</span><span class="op" id="8542885">.</span><span class="ident" id="8542886">T</span><span class="op" id="8542887">,</span>&nbsp;<span class="ident" id="8542889">line</span><span class="op" id="8542893">,</span>&nbsp;<span class="ident" id="8542895">has</span>&nbsp;<span class="builtintype" id="8542899">string</span><span class="op" id="8542905">)</span>&nbsp;<span class="op" id="8542907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8542910">if</span>&nbsp;<span class="ident" id="8542913">strings</span><span class="op" id="8542920">.</span><span class="ident" id="8542921">Index</span><span class="op" id="8542926">(</span><span class="ident" id="8542927">line</span><span class="op" id="8542931">,</span>&nbsp;<span class="ident" id="8542933">has</span><span class="op" id="8542936">)</span>&nbsp;<span class="op" id="8542938">&lt;</span>&nbsp;<span class="num" id="8542940">0</span>&nbsp;<span class="op" id="8542942">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8542946">t</span><span class="op" id="8542947">.</span><span class="ident" id="8542948">Errorf</span><span class="op" id="8542954">(</span><span class="string" id="8542955">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8542974">,</span>&nbsp;<span class="ident" id="8542976">has</span><span class="op" id="8542979">,</span>&nbsp;<span class="ident" id="8542981">line</span><span class="op" id="8542985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8542988">}</span><br>
<span class="lineno"></span><span class="op" id="8542990">}</span>
</div>
</body>
</html>
