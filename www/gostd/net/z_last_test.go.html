<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6760240">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6760295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6760349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6760400">package</span>&nbsp;<span class="ident" id="6760408">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760413">import</span>&nbsp;<span class="op" id="6760420">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6760423">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6760431">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6760438">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6760449">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6760456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760459">var</span>&nbsp;<span class="ident" id="6760463">testDNSFlood</span>&nbsp;<span class="op" id="6760476">=</span>&nbsp;<span class="ident" id="6760478">flag</span><span class="op" id="6760482">.</span><span class="ident" id="6760483">Bool</span><span class="op" id="6760487">(</span><span class="string" id="6760488">&#34;dnsflood&#34;</span><span class="op" id="6760498">,</span>&nbsp;<span class="builtintype" id="6760500">false</span><span class="op" id="6760505">,</span>&nbsp;<span class="string" id="6760507">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="6760543">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6760546">func</span>&nbsp;<span class="ident" id="6760551">TestDNSThreadLimit</span><span class="op" id="6760569">(</span><span class="ident" id="6760570">t</span>&nbsp;<span class="op" id="6760572">*</span><span class="ident" id="6760573">testing</span><span class="op" id="6760580">.</span><span class="ident" id="6760581">T</span><span class="op" id="6760582">)</span>&nbsp;<span class="op" id="6760584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760587">if</span>&nbsp;<span class="op" id="6760590">!</span><span class="op" id="6760591">*</span><span class="ident" id="6760592">testDNSFlood</span>&nbsp;<span class="op" id="6760605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760609">t</span><span class="op" id="6760610">.</span><span class="ident" id="6760611">Skip</span><span class="op" id="6760615">(</span><span class="string" id="6760616">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6760656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760659">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760663">const</span>&nbsp;<span class="ident" id="6760669">N</span>&nbsp;<span class="op" id="6760671">=</span>&nbsp;<span class="num" id="6760673">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760680">c</span>&nbsp;<span class="op" id="6760682">:=</span>&nbsp;<span class="builtinfunc" id="6760685">make</span><span class="op" id="6760689">(</span><span class="keyword" id="6760690">chan</span>&nbsp;<span class="builtintype" id="6760695">int</span><span class="op" id="6760698">,</span>&nbsp;<span class="ident" id="6760700">N</span><span class="op" id="6760701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760704">for</span>&nbsp;<span class="ident" id="6760708">i</span>&nbsp;<span class="op" id="6760710">:=</span>&nbsp;<span class="num" id="6760713">0</span><span class="op" id="6760714">;</span>&nbsp;<span class="ident" id="6760716">i</span>&nbsp;<span class="op" id="6760718">&lt;</span>&nbsp;<span class="ident" id="6760720">N</span><span class="op" id="6760721">;</span>&nbsp;<span class="ident" id="6760723">i</span><span class="op" id="6760724">++</span>&nbsp;<span class="op" id="6760727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760731">go</span>&nbsp;<span class="keyword" id="6760734">func</span><span class="op" id="6760738">(</span><span class="ident" id="6760739">i</span>&nbsp;<span class="builtintype" id="6760741">int</span><span class="op" id="6760744">)</span>&nbsp;<span class="op" id="6760746">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760751">LookupIP</span><span class="op" id="6760759">(</span><span class="ident" id="6760760">fmt</span><span class="op" id="6760763">.</span><span class="ident" id="6760764">Sprintf</span><span class="op" id="6760771">(</span><span class="string" id="6760772">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6760796">,</span>&nbsp;<span class="ident" id="6760798">i</span><span class="op" id="6760799">)</span><span class="op" id="6760800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760805">c</span>&nbsp;<span class="op" id="6760807">&lt;-</span>&nbsp;<span class="num" id="6760810">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760814">}</span><span class="op" id="6760815">(</span><span class="ident" id="6760816">i</span><span class="op" id="6760817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6760823">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760883">for</span>&nbsp;<span class="ident" id="6760887">i</span>&nbsp;<span class="op" id="6760889">:=</span>&nbsp;<span class="num" id="6760892">0</span><span class="op" id="6760893">;</span>&nbsp;<span class="ident" id="6760895">i</span>&nbsp;<span class="op" id="6760897">&lt;</span>&nbsp;<span class="ident" id="6760899">N</span><span class="op" id="6760900">*</span><span class="num" id="6760901">9</span><span class="op" id="6760902">/</span><span class="num" id="6760903">10</span><span class="op" id="6760905">;</span>&nbsp;<span class="ident" id="6760907">i</span><span class="op" id="6760908">++</span>&nbsp;<span class="op" id="6760911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760915">if</span>&nbsp;<span class="ident" id="6760918">i</span><span class="op" id="6760919">%</span><span class="num" id="6760920">100</span>&nbsp;<span class="op" id="6760924">==</span>&nbsp;<span class="num" id="6760927">0</span>&nbsp;<span class="op" id="6760929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6760934">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760976">&lt;-</span><span class="ident" id="6760978">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6760985">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="6761020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6761023">func</span>&nbsp;<span class="ident" id="6761028">TestLookupIPDeadline</span><span class="op" id="6761048">(</span><span class="ident" id="6761049">t</span>&nbsp;<span class="op" id="6761051">*</span><span class="ident" id="6761052">testing</span><span class="op" id="6761059">.</span><span class="ident" id="6761060">T</span><span class="op" id="6761061">)</span>&nbsp;<span class="op" id="6761063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761066">if</span>&nbsp;<span class="op" id="6761069">!</span><span class="op" id="6761070">*</span><span class="ident" id="6761071">testDNSFlood</span>&nbsp;<span class="op" id="6761084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761088">t</span><span class="op" id="6761089">.</span><span class="ident" id="6761090">Skip</span><span class="op" id="6761094">(</span><span class="string" id="6761095">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6761135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761142">const</span>&nbsp;<span class="ident" id="6761148">N</span>&nbsp;<span class="op" id="6761150">=</span>&nbsp;<span class="num" id="6761152">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761158">const</span>&nbsp;<span class="ident" id="6761164">timeout</span>&nbsp;<span class="op" id="6761172">=</span>&nbsp;<span class="num" id="6761174">3</span>&nbsp;<span class="op" id="6761176">*</span>&nbsp;<span class="ident" id="6761178">time</span><span class="op" id="6761182">.</span><span class="ident" id="6761183">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761191">c</span>&nbsp;<span class="op" id="6761193">:=</span>&nbsp;<span class="builtinfunc" id="6761196">make</span><span class="op" id="6761200">(</span><span class="keyword" id="6761201">chan</span>&nbsp;<span class="builtintype" id="6761206">error</span><span class="op" id="6761211">,</span>&nbsp;<span class="num" id="6761213">2</span><span class="op" id="6761214">*</span><span class="ident" id="6761215">N</span><span class="op" id="6761216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761219">for</span>&nbsp;<span class="ident" id="6761223">i</span>&nbsp;<span class="op" id="6761225">:=</span>&nbsp;<span class="num" id="6761228">0</span><span class="op" id="6761229">;</span>&nbsp;<span class="ident" id="6761231">i</span>&nbsp;<span class="op" id="6761233">&lt;</span>&nbsp;<span class="ident" id="6761235">N</span><span class="op" id="6761236">;</span>&nbsp;<span class="ident" id="6761238">i</span><span class="op" id="6761239">++</span>&nbsp;<span class="op" id="6761242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761246">name</span>&nbsp;<span class="op" id="6761251">:=</span>&nbsp;<span class="ident" id="6761254">fmt</span><span class="op" id="6761257">.</span><span class="ident" id="6761258">Sprintf</span><span class="op" id="6761265">(</span><span class="string" id="6761266">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6761290">,</span>&nbsp;<span class="ident" id="6761292">i</span><span class="op" id="6761293">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761297">go</span>&nbsp;<span class="keyword" id="6761300">func</span><span class="op" id="6761304">(</span><span class="op" id="6761305">)</span>&nbsp;<span class="op" id="6761307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761312">_</span><span class="op" id="6761313">,</span>&nbsp;<span class="ident" id="6761315">err</span>&nbsp;<span class="op" id="6761319">:=</span>&nbsp;<span class="ident" id="6761322">lookupIPDeadline</span><span class="op" id="6761338">(</span><span class="ident" id="6761339">name</span><span class="op" id="6761343">,</span>&nbsp;<span class="ident" id="6761345">time</span><span class="op" id="6761349">.</span><span class="ident" id="6761350">Now</span><span class="op" id="6761353">(</span><span class="op" id="6761354">)</span><span class="op" id="6761355">.</span><span class="ident" id="6761356">Add</span><span class="op" id="6761359">(</span><span class="ident" id="6761360">timeout</span><span class="op" id="6761367">/</span><span class="num" id="6761368">2</span><span class="op" id="6761369">)</span><span class="op" id="6761370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761375">c</span>&nbsp;<span class="op" id="6761377">&lt;-</span>&nbsp;<span class="ident" id="6761380">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761386">}</span><span class="op" id="6761387">(</span><span class="op" id="6761388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761392">go</span>&nbsp;<span class="keyword" id="6761395">func</span><span class="op" id="6761399">(</span><span class="op" id="6761400">)</span>&nbsp;<span class="op" id="6761402">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761407">_</span><span class="op" id="6761408">,</span>&nbsp;<span class="ident" id="6761410">err</span>&nbsp;<span class="op" id="6761414">:=</span>&nbsp;<span class="ident" id="6761417">lookupIPDeadline</span><span class="op" id="6761433">(</span><span class="ident" id="6761434">name</span><span class="op" id="6761438">,</span>&nbsp;<span class="ident" id="6761440">time</span><span class="op" id="6761444">.</span><span class="ident" id="6761445">Now</span><span class="op" id="6761448">(</span><span class="op" id="6761449">)</span><span class="op" id="6761450">.</span><span class="ident" id="6761451">Add</span><span class="op" id="6761454">(</span><span class="ident" id="6761455">timeout</span><span class="op" id="6761462">)</span><span class="op" id="6761463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761468">c</span>&nbsp;<span class="op" id="6761470">&lt;-</span>&nbsp;<span class="ident" id="6761473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761479">}</span><span class="op" id="6761480">(</span><span class="op" id="6761481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761487">qstats</span>&nbsp;<span class="op" id="6761494">:=</span>&nbsp;<span class="keyword" id="6761497">struct</span>&nbsp;<span class="op" id="6761504">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761508">succeeded</span><span class="op" id="6761517">,</span>&nbsp;<span class="ident" id="6761519">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6761534">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761540">timeout</span><span class="op" id="6761547">,</span>&nbsp;<span class="ident" id="6761549">temporary</span><span class="op" id="6761558">,</span>&nbsp;<span class="ident" id="6761560">other</span>&nbsp;<span class="builtintype" id="6761566">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761572">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6761598">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761603">}</span><span class="op" id="6761604">{</span><span class="op" id="6761605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761608">deadline</span>&nbsp;<span class="op" id="6761617">:=</span>&nbsp;<span class="ident" id="6761620">time</span><span class="op" id="6761624">.</span><span class="ident" id="6761625">After</span><span class="op" id="6761630">(</span><span class="ident" id="6761631">timeout</span>&nbsp;<span class="op" id="6761639">+</span>&nbsp;<span class="ident" id="6761641">time</span><span class="op" id="6761645">.</span><span class="ident" id="6761646">Second</span><span class="op" id="6761652">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761655">for</span>&nbsp;<span class="ident" id="6761659">i</span>&nbsp;<span class="op" id="6761661">:=</span>&nbsp;<span class="num" id="6761664">0</span><span class="op" id="6761665">;</span>&nbsp;<span class="ident" id="6761667">i</span>&nbsp;<span class="op" id="6761669">&lt;</span>&nbsp;<span class="num" id="6761671">2</span><span class="op" id="6761672">*</span><span class="ident" id="6761673">N</span><span class="op" id="6761674">;</span>&nbsp;<span class="ident" id="6761676">i</span><span class="op" id="6761677">++</span>&nbsp;<span class="op" id="6761680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761684">select</span>&nbsp;<span class="op" id="6761691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761695">case</span>&nbsp;<span class="op" id="6761700">&lt;-</span><span class="ident" id="6761702">deadline</span><span class="op" id="6761710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761715">t</span><span class="op" id="6761716">.</span><span class="ident" id="6761717">Fatal</span><span class="op" id="6761722">(</span><span class="string" id="6761723">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="6761742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761746">case</span>&nbsp;<span class="ident" id="6761751">err</span>&nbsp;<span class="op" id="6761755">:=</span>&nbsp;<span class="op" id="6761758">&lt;-</span><span class="ident" id="6761760">c</span><span class="op" id="6761761">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761766">switch</span>&nbsp;<span class="ident" id="6761773">err</span>&nbsp;<span class="op" id="6761777">:=</span>&nbsp;<span class="ident" id="6761780">err</span><span class="op" id="6761783">.</span><span class="op" id="6761784">(</span><span class="keyword" id="6761785">type</span><span class="op" id="6761789">)</span>&nbsp;<span class="op" id="6761791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761796">case</span>&nbsp;<span class="ident" id="6761801">nil</span><span class="op" id="6761804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761810">qstats</span><span class="op" id="6761816">.</span><span class="ident" id="6761817">succeeded</span><span class="op" id="6761826">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761832">case</span>&nbsp;<span class="ident" id="6761837">Error</span><span class="op" id="6761842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761848">qstats</span><span class="op" id="6761854">.</span><span class="ident" id="6761855">failed</span><span class="op" id="6761861">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761868">if</span>&nbsp;<span class="ident" id="6761871">err</span><span class="op" id="6761874">.</span><span class="ident" id="6761875">Timeout</span><span class="op" id="6761882">(</span><span class="op" id="6761883">)</span>&nbsp;<span class="op" id="6761885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761892">qstats</span><span class="op" id="6761898">.</span><span class="ident" id="6761899">timeout</span><span class="op" id="6761906">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761919">if</span>&nbsp;<span class="ident" id="6761922">err</span><span class="op" id="6761925">.</span><span class="ident" id="6761926">Temporary</span><span class="op" id="6761935">(</span><span class="op" id="6761936">)</span>&nbsp;<span class="op" id="6761938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761945">qstats</span><span class="op" id="6761951">.</span><span class="ident" id="6761952">temporary</span><span class="op" id="6761961">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761974">if</span>&nbsp;<span class="op" id="6761977">!</span><span class="ident" id="6761978">err</span><span class="op" id="6761981">.</span><span class="ident" id="6761982">Timeout</span><span class="op" id="6761989">(</span><span class="op" id="6761990">)</span>&nbsp;<span class="op" id="6761992">&amp;&amp;</span>&nbsp;<span class="op" id="6761995">!</span><span class="ident" id="6761996">err</span><span class="op" id="6761999">.</span><span class="ident" id="6762000">Temporary</span><span class="op" id="6762009">(</span><span class="op" id="6762010">)</span>&nbsp;<span class="op" id="6762012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762019">qstats</span><span class="op" id="6762025">.</span><span class="ident" id="6762026">other</span><span class="op" id="6762031">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762043">default</span><span class="op" id="6762050">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762056">qstats</span><span class="op" id="6762062">.</span><span class="ident" id="6762063">failed</span><span class="op" id="6762069">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762076">qstats</span><span class="op" id="6762082">.</span><span class="ident" id="6762083">unknown</span><span class="op" id="6762090">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762103">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762107">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762169">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762232">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762290">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762353">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762411">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762474">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762512">t</span><span class="op" id="6762513">.</span><span class="ident" id="6762514">Logf</span><span class="op" id="6762518">(</span><span class="string" id="6762519">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="6762593">,</span>&nbsp;<span class="ident" id="6762595">qstats</span><span class="op" id="6762601">.</span><span class="ident" id="6762602">succeeded</span><span class="op" id="6762611">,</span>&nbsp;<span class="ident" id="6762613">qstats</span><span class="op" id="6762619">.</span><span class="ident" id="6762620">failed</span><span class="op" id="6762626">,</span>&nbsp;<span class="ident" id="6762628">qstats</span><span class="op" id="6762634">.</span><span class="ident" id="6762635">timeout</span><span class="op" id="6762642">,</span>&nbsp;<span class="ident" id="6762644">qstats</span><span class="op" id="6762650">.</span><span class="ident" id="6762651">temporary</span><span class="op" id="6762660">,</span>&nbsp;<span class="ident" id="6762662">qstats</span><span class="op" id="6762668">.</span><span class="ident" id="6762669">other</span><span class="op" id="6762674">,</span>&nbsp;<span class="ident" id="6762676">qstats</span><span class="op" id="6762682">.</span><span class="ident" id="6762683">unknown</span><span class="op" id="6762690">)</span><br>
<span class="lineno"></span><span class="op" id="6762692">}</span>
</div>
</body>
</html>
