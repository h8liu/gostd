<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7987116">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7987171">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7987225">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7987276">package</span>&nbsp;<span class="ident" id="7987284">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987290">import</span>&nbsp;<span class="op" id="7987297">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7987300">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7987313">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7987319">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7987336">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7987346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987349">func</span>&nbsp;<span class="ident" id="7987354">checker</span><span class="op" id="7987361">(</span><span class="ident" id="7987362">t</span>&nbsp;<span class="op" id="7987364">*</span><span class="ident" id="7987365">testing</span><span class="op" id="7987372">.</span><span class="ident" id="7987373">T</span><span class="op" id="7987374">)</span>&nbsp;<span class="keyword" id="7987376">func</span><span class="op" id="7987380">(</span><span class="builtintype" id="7987381">string</span><span class="op" id="7987387">,</span>&nbsp;<span class="builtintype" id="7987389">error</span><span class="op" id="7987394">)</span>&nbsp;<span class="op" id="7987396">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987399">return</span>&nbsp;<span class="keyword" id="7987406">func</span><span class="op" id="7987410">(</span><span class="ident" id="7987411">call</span>&nbsp;<span class="builtintype" id="7987416">string</span><span class="op" id="7987422">,</span>&nbsp;<span class="ident" id="7987424">err</span>&nbsp;<span class="builtintype" id="7987428">error</span><span class="op" id="7987433">)</span>&nbsp;<span class="op" id="7987435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987439">if</span>&nbsp;<span class="ident" id="7987442">err</span>&nbsp;<span class="op" id="7987446">==</span>&nbsp;<span class="ident" id="7987449">nil</span>&nbsp;<span class="op" id="7987453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987471">t</span><span class="op" id="7987472">.</span><span class="ident" id="7987473">Fatalf</span><span class="op" id="7987479">(</span><span class="string" id="7987480">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7987488">,</span>&nbsp;<span class="ident" id="7987490">call</span><span class="op" id="7987494">,</span>&nbsp;<span class="ident" id="7987496">err</span><span class="op" id="7987499">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987502">}</span><br>
<span class="lineno"></span><span class="op" id="7987504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987507">func</span>&nbsp;<span class="ident" id="7987512">TestFileTransport</span><span class="op" id="7987529">(</span><span class="ident" id="7987530">t</span>&nbsp;<span class="op" id="7987532">*</span><span class="ident" id="7987533">testing</span><span class="op" id="7987540">.</span><span class="ident" id="7987541">T</span><span class="op" id="7987542">)</span>&nbsp;<span class="op" id="7987544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987547">check</span>&nbsp;<span class="op" id="7987553">:=</span>&nbsp;<span class="ident" id="7987556">checker</span><span class="op" id="7987563">(</span><span class="ident" id="7987564">t</span><span class="op" id="7987565">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987569">dname</span><span class="op" id="7987574">,</span>&nbsp;<span class="ident" id="7987576">err</span>&nbsp;<span class="op" id="7987580">:=</span>&nbsp;<span class="ident" id="7987583">ioutil</span><span class="op" id="7987589">.</span><span class="ident" id="7987590">TempDir</span><span class="op" id="7987597">(</span><span class="string" id="7987598">&#34;&#34;</span><span class="op" id="7987600">,</span>&nbsp;<span class="string" id="7987602">&#34;&#34;</span><span class="op" id="7987604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987607">check</span><span class="op" id="7987612">(</span><span class="string" id="7987613">&#34;TempDir&#34;</span><span class="op" id="7987622">,</span>&nbsp;<span class="ident" id="7987624">err</span><span class="op" id="7987627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987630">fname</span>&nbsp;<span class="op" id="7987636">:=</span>&nbsp;<span class="ident" id="7987639">filepath</span><span class="op" id="7987647">.</span><span class="ident" id="7987648">Join</span><span class="op" id="7987652">(</span><span class="ident" id="7987653">dname</span><span class="op" id="7987658">,</span>&nbsp;<span class="string" id="7987660">&#34;foo.txt&#34;</span><span class="op" id="7987669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987672">err</span>&nbsp;<span class="op" id="7987676">=</span>&nbsp;<span class="ident" id="7987678">ioutil</span><span class="op" id="7987684">.</span><span class="ident" id="7987685">WriteFile</span><span class="op" id="7987694">(</span><span class="ident" id="7987695">fname</span><span class="op" id="7987700">,</span>&nbsp;<span class="op" id="7987702">[</span><span class="op" id="7987703">]</span><span class="builtintype" id="7987704">byte</span><span class="op" id="7987708">(</span><span class="string" id="7987709">&#34;Bar&#34;</span><span class="op" id="7987714">)</span><span class="op" id="7987715">,</span>&nbsp;<span class="num" id="7987717">0644</span><span class="op" id="7987721">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987724">check</span><span class="op" id="7987729">(</span><span class="string" id="7987730">&#34;WriteFile&#34;</span><span class="op" id="7987741">,</span>&nbsp;<span class="ident" id="7987743">err</span><span class="op" id="7987746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987749">defer</span>&nbsp;<span class="ident" id="7987755">os</span><span class="op" id="7987757">.</span><span class="ident" id="7987758">Remove</span><span class="op" id="7987764">(</span><span class="ident" id="7987765">dname</span><span class="op" id="7987770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987773">defer</span>&nbsp;<span class="ident" id="7987779">os</span><span class="op" id="7987781">.</span><span class="ident" id="7987782">Remove</span><span class="op" id="7987788">(</span><span class="ident" id="7987789">fname</span><span class="op" id="7987794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987798">tr</span>&nbsp;<span class="op" id="7987801">:=</span>&nbsp;<span class="op" id="7987804">&amp;</span><span class="ident" id="7987805">Transport</span><span class="op" id="7987814">{</span><span class="op" id="7987815">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987818">tr</span><span class="op" id="7987820">.</span><span class="ident" id="7987821">RegisterProtocol</span><span class="op" id="7987837">(</span><span class="string" id="7987838">&#34;file&#34;</span><span class="op" id="7987844">,</span>&nbsp;<span class="ident" id="7987846">NewFileTransport</span><span class="op" id="7987862">(</span><span class="ident" id="7987863">Dir</span><span class="op" id="7987866">(</span><span class="ident" id="7987867">dname</span><span class="op" id="7987872">)</span><span class="op" id="7987873">)</span><span class="op" id="7987874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987877">c</span>&nbsp;<span class="op" id="7987879">:=</span>&nbsp;<span class="op" id="7987882">&amp;</span><span class="ident" id="7987883">Client</span><span class="op" id="7987889">{</span><span class="ident" id="7987890">Transport</span><span class="op" id="7987899">:</span>&nbsp;<span class="ident" id="7987901">tr</span><span class="op" id="7987903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987907">fooURLs</span>&nbsp;<span class="op" id="7987915">:=</span>&nbsp;<span class="op" id="7987918">[</span><span class="op" id="7987919">]</span><span class="builtintype" id="7987920">string</span><span class="op" id="7987926">{</span><span class="string" id="7987927">&#34;file:///foo.txt&#34;</span><span class="op" id="7987944">,</span>&nbsp;<span class="string" id="7987946">&#34;file://../foo.txt&#34;</span><span class="op" id="7987965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987968">for</span>&nbsp;<span class="ident" id="7987972">_</span><span class="op" id="7987973">,</span>&nbsp;<span class="ident" id="7987975">urlstr</span>&nbsp;<span class="op" id="7987982">:=</span>&nbsp;<span class="keyword" id="7987985">range</span>&nbsp;<span class="ident" id="7987991">fooURLs</span>&nbsp;<span class="op" id="7987999">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988003">res</span><span class="op" id="7988006">,</span>&nbsp;<span class="ident" id="7988008">err</span>&nbsp;<span class="op" id="7988012">:=</span>&nbsp;<span class="ident" id="7988015">c</span><span class="op" id="7988016">.</span><span class="ident" id="7988017">Get</span><span class="op" id="7988020">(</span><span class="ident" id="7988021">urlstr</span><span class="op" id="7988027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988031">check</span><span class="op" id="7988036">(</span><span class="string" id="7988037">&#34;Get&nbsp;&#34;</span><span class="op" id="7988043">+</span><span class="ident" id="7988044">urlstr</span><span class="op" id="7988050">,</span>&nbsp;<span class="ident" id="7988052">err</span><span class="op" id="7988055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988059">if</span>&nbsp;<span class="ident" id="7988062">res</span><span class="op" id="7988065">.</span><span class="ident" id="7988066">StatusCode</span>&nbsp;<span class="op" id="7988077">!=</span>&nbsp;<span class="num" id="7988080">200</span>&nbsp;<span class="op" id="7988084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988089">t</span><span class="op" id="7988090">.</span><span class="ident" id="7988091">Errorf</span><span class="op" id="7988097">(</span><span class="string" id="7988098">&#34;for&nbsp;%s,&nbsp;StatusCode&nbsp;=&nbsp;%d,&nbsp;want&nbsp;200&#34;</span><span class="op" id="7988133">,</span>&nbsp;<span class="ident" id="7988135">urlstr</span><span class="op" id="7988141">,</span>&nbsp;<span class="ident" id="7988143">res</span><span class="op" id="7988146">.</span><span class="ident" id="7988147">StatusCode</span><span class="op" id="7988157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988161">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988165">if</span>&nbsp;<span class="ident" id="7988168">res</span><span class="op" id="7988171">.</span><span class="ident" id="7988172">ContentLength</span>&nbsp;<span class="op" id="7988186">!=</span>&nbsp;<span class="op" id="7988189">-</span><span class="num" id="7988190">1</span>&nbsp;<span class="op" id="7988192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988197">t</span><span class="op" id="7988198">.</span><span class="ident" id="7988199">Errorf</span><span class="op" id="7988205">(</span><span class="string" id="7988206">&#34;for&nbsp;%s,&nbsp;ContentLength&nbsp;=&nbsp;%d,&nbsp;want&nbsp;-1&#34;</span><span class="op" id="7988243">,</span>&nbsp;<span class="ident" id="7988245">urlstr</span><span class="op" id="7988251">,</span>&nbsp;<span class="ident" id="7988253">res</span><span class="op" id="7988256">.</span><span class="ident" id="7988257">ContentLength</span><span class="op" id="7988270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988278">if</span>&nbsp;<span class="ident" id="7988281">res</span><span class="op" id="7988284">.</span><span class="ident" id="7988285">Body</span>&nbsp;<span class="op" id="7988290">==</span>&nbsp;<span class="ident" id="7988293">nil</span>&nbsp;<span class="op" id="7988297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988302">t</span><span class="op" id="7988303">.</span><span class="ident" id="7988304">Fatalf</span><span class="op" id="7988310">(</span><span class="string" id="7988311">&#34;for&nbsp;%s,&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="7988329">,</span>&nbsp;<span class="ident" id="7988331">urlstr</span><span class="op" id="7988337">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988345">slurp</span><span class="op" id="7988350">,</span>&nbsp;<span class="ident" id="7988352">err</span>&nbsp;<span class="op" id="7988356">:=</span>&nbsp;<span class="ident" id="7988359">ioutil</span><span class="op" id="7988365">.</span><span class="ident" id="7988366">ReadAll</span><span class="op" id="7988373">(</span><span class="ident" id="7988374">res</span><span class="op" id="7988377">.</span><span class="ident" id="7988378">Body</span><span class="op" id="7988382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988386">check</span><span class="op" id="7988391">(</span><span class="string" id="7988392">&#34;ReadAll&nbsp;&#34;</span><span class="op" id="7988402">+</span><span class="ident" id="7988403">urlstr</span><span class="op" id="7988409">,</span>&nbsp;<span class="ident" id="7988411">err</span><span class="op" id="7988414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988418">if</span>&nbsp;<span class="builtintype" id="7988421">string</span><span class="op" id="7988427">(</span><span class="ident" id="7988428">slurp</span><span class="op" id="7988433">)</span>&nbsp;<span class="op" id="7988435">!=</span>&nbsp;<span class="string" id="7988438">&#34;Bar&#34;</span>&nbsp;<span class="op" id="7988444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988449">t</span><span class="op" id="7988450">.</span><span class="ident" id="7988451">Errorf</span><span class="op" id="7988457">(</span><span class="string" id="7988458">&#34;for&nbsp;%s,&nbsp;got&nbsp;content&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7988491">,</span>&nbsp;<span class="ident" id="7988493">urlstr</span><span class="op" id="7988499">,</span>&nbsp;<span class="builtintype" id="7988501">string</span><span class="op" id="7988507">(</span><span class="ident" id="7988508">slurp</span><span class="op" id="7988513">)</span><span class="op" id="7988514">,</span>&nbsp;<span class="string" id="7988516">&#34;Bar&#34;</span><span class="op" id="7988521">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988532">const</span>&nbsp;<span class="ident" id="7988538">badURL</span>&nbsp;<span class="op" id="7988545">=</span>&nbsp;<span class="string" id="7988547">&#34;file://../no-exist.txt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988573">res</span><span class="op" id="7988576">,</span>&nbsp;<span class="ident" id="7988578">err</span>&nbsp;<span class="op" id="7988582">:=</span>&nbsp;<span class="ident" id="7988585">c</span><span class="op" id="7988586">.</span><span class="ident" id="7988587">Get</span><span class="op" id="7988590">(</span><span class="ident" id="7988591">badURL</span><span class="op" id="7988597">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988600">check</span><span class="op" id="7988605">(</span><span class="string" id="7988606">&#34;Get&nbsp;&#34;</span><span class="op" id="7988612">+</span><span class="ident" id="7988613">badURL</span><span class="op" id="7988619">,</span>&nbsp;<span class="ident" id="7988621">err</span><span class="op" id="7988624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988627">if</span>&nbsp;<span class="ident" id="7988630">res</span><span class="op" id="7988633">.</span><span class="ident" id="7988634">StatusCode</span>&nbsp;<span class="op" id="7988645">!=</span>&nbsp;<span class="num" id="7988648">404</span>&nbsp;<span class="op" id="7988652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988656">t</span><span class="op" id="7988657">.</span><span class="ident" id="7988658">Errorf</span><span class="op" id="7988664">(</span><span class="string" id="7988665">&#34;for&nbsp;%s,&nbsp;StatusCode&nbsp;=&nbsp;%d,&nbsp;want&nbsp;404&#34;</span><span class="op" id="7988700">,</span>&nbsp;<span class="ident" id="7988702">badURL</span><span class="op" id="7988708">,</span>&nbsp;<span class="ident" id="7988710">res</span><span class="op" id="7988713">.</span><span class="ident" id="7988714">StatusCode</span><span class="op" id="7988724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988730">res</span><span class="op" id="7988733">.</span><span class="ident" id="7988734">Body</span><span class="op" id="7988738">.</span><span class="ident" id="7988739">Close</span><span class="op" id="7988744">(</span><span class="op" id="7988745">)</span><br>
<span class="lineno">65</span><span class="op" id="7988747">}</span>
</div>
</body>
</html>
