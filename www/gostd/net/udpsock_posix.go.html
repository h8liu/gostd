<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3303531">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3303587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3303641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3303692">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303770">package</span>&nbsp;<span class="ident" id="3303778">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303783">import</span>&nbsp;<span class="op" id="3303790">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303793">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3303804">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3303811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3303814">func</span>&nbsp;<span class="ident" id="3303819">sockaddrToUDP</span><span class="op" id="3303832">(</span><span class="ident" id="3303833">sa</span>&nbsp;<span class="ident" id="3303836">syscall</span><span class="op" id="3303843">.</span><span class="ident" id="3303844">Sockaddr</span><span class="op" id="3303852">)</span>&nbsp;<span class="ident" id="3303854">Addr</span>&nbsp;<span class="op" id="3303859">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303862">switch</span>&nbsp;<span class="ident" id="3303869">sa</span>&nbsp;<span class="op" id="3303872">:=</span>&nbsp;<span class="ident" id="3303875">sa</span><span class="op" id="3303877">.</span><span class="op" id="3303878">(</span><span class="keyword" id="3303879">type</span><span class="op" id="3303883">)</span>&nbsp;<span class="op" id="3303885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303888">case</span>&nbsp;<span class="op" id="3303893">*</span><span class="ident" id="3303894">syscall</span><span class="op" id="3303901">.</span><span class="ident" id="3303902">SockaddrInet4</span><span class="op" id="3303915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303919">return</span>&nbsp;<span class="op" id="3303926">&amp;</span><span class="ident" id="3303927">UDPAddr</span><span class="op" id="3303934">{</span><span class="ident" id="3303935">IP</span><span class="op" id="3303937">:</span>&nbsp;<span class="ident" id="3303939">sa</span><span class="op" id="3303941">.</span><span class="ident" id="3303942">Addr</span><span class="op" id="3303946">[</span><span class="num" id="3303947">0</span><span class="op" id="3303948">:</span><span class="op" id="3303949">]</span><span class="op" id="3303950">,</span>&nbsp;<span class="ident" id="3303952">Port</span><span class="op" id="3303956">:</span>&nbsp;<span class="ident" id="3303958">sa</span><span class="op" id="3303960">.</span><span class="ident" id="3303961">Port</span><span class="op" id="3303965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303968">case</span>&nbsp;<span class="op" id="3303973">*</span><span class="ident" id="3303974">syscall</span><span class="op" id="3303981">.</span><span class="ident" id="3303982">SockaddrInet6</span><span class="op" id="3303995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303999">return</span>&nbsp;<span class="op" id="3304006">&amp;</span><span class="ident" id="3304007">UDPAddr</span><span class="op" id="3304014">{</span><span class="ident" id="3304015">IP</span><span class="op" id="3304017">:</span>&nbsp;<span class="ident" id="3304019">sa</span><span class="op" id="3304021">.</span><span class="ident" id="3304022">Addr</span><span class="op" id="3304026">[</span><span class="num" id="3304027">0</span><span class="op" id="3304028">:</span><span class="op" id="3304029">]</span><span class="op" id="3304030">,</span>&nbsp;<span class="ident" id="3304032">Port</span><span class="op" id="3304036">:</span>&nbsp;<span class="ident" id="3304038">sa</span><span class="op" id="3304040">.</span><span class="ident" id="3304041">Port</span><span class="op" id="3304045">,</span>&nbsp;<span class="ident" id="3304047">Zone</span><span class="op" id="3304051">:</span>&nbsp;<span class="ident" id="3304053">zoneToString</span><span class="op" id="3304065">(</span><span class="builtintype" id="3304066">int</span><span class="op" id="3304069">(</span><span class="ident" id="3304070">sa</span><span class="op" id="3304072">.</span><span class="ident" id="3304073">ZoneId</span><span class="op" id="3304079">)</span><span class="op" id="3304080">)</span><span class="op" id="3304081">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304087">return</span>&nbsp;<span class="ident" id="3304094">nil</span><br>
<span class="lineno"></span><span class="op" id="3304098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304101">func</span>&nbsp;<span class="op" id="3304106">(</span><span class="ident" id="3304107">a</span>&nbsp;<span class="op" id="3304109">*</span><span class="ident" id="3304110">UDPAddr</span><span class="op" id="3304117">)</span>&nbsp;<span class="ident" id="3304119">family</span><span class="op" id="3304125">(</span><span class="op" id="3304126">)</span>&nbsp;<span class="builtintype" id="3304128">int</span>&nbsp;<span class="op" id="3304132">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304135">if</span>&nbsp;<span class="ident" id="3304138">a</span>&nbsp;<span class="op" id="3304140">==</span>&nbsp;<span class="ident" id="3304143">nil</span>&nbsp;<span class="op" id="3304147">||</span>&nbsp;<span class="builtinfunc" id="3304150">len</span><span class="op" id="3304153">(</span><span class="ident" id="3304154">a</span><span class="op" id="3304155">.</span><span class="ident" id="3304156">IP</span><span class="op" id="3304158">)</span>&nbsp;<span class="op" id="3304160">&lt;=</span>&nbsp;<span class="ident" id="3304163">IPv4len</span>&nbsp;<span class="op" id="3304171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304175">return</span>&nbsp;<span class="ident" id="3304182">syscall</span><span class="op" id="3304189">.</span><span class="ident" id="3304190">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304202">if</span>&nbsp;<span class="ident" id="3304205">a</span><span class="op" id="3304206">.</span><span class="ident" id="3304207">IP</span><span class="op" id="3304209">.</span><span class="ident" id="3304210">To4</span><span class="op" id="3304213">(</span><span class="op" id="3304214">)</span>&nbsp;<span class="op" id="3304216">!=</span>&nbsp;<span class="ident" id="3304219">nil</span>&nbsp;<span class="op" id="3304223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304227">return</span>&nbsp;<span class="ident" id="3304234">syscall</span><span class="op" id="3304241">.</span><span class="ident" id="3304242">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304254">return</span>&nbsp;<span class="ident" id="3304261">syscall</span><span class="op" id="3304268">.</span><span class="ident" id="3304269">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3304278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304281">func</span>&nbsp;<span class="op" id="3304286">(</span><span class="ident" id="3304287">a</span>&nbsp;<span class="op" id="3304289">*</span><span class="ident" id="3304290">UDPAddr</span><span class="op" id="3304297">)</span>&nbsp;<span class="ident" id="3304299">isWildcard</span><span class="op" id="3304309">(</span><span class="op" id="3304310">)</span>&nbsp;<span class="builtintype" id="3304312">bool</span>&nbsp;<span class="op" id="3304317">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304320">if</span>&nbsp;<span class="ident" id="3304323">a</span>&nbsp;<span class="op" id="3304325">==</span>&nbsp;<span class="ident" id="3304328">nil</span>&nbsp;<span class="op" id="3304332">||</span>&nbsp;<span class="ident" id="3304335">a</span><span class="op" id="3304336">.</span><span class="ident" id="3304337">IP</span>&nbsp;<span class="op" id="3304340">==</span>&nbsp;<span class="ident" id="3304343">nil</span>&nbsp;<span class="op" id="3304347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304351">return</span>&nbsp;<span class="builtintype" id="3304358">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304367">return</span>&nbsp;<span class="ident" id="3304374">a</span><span class="op" id="3304375">.</span><span class="ident" id="3304376">IP</span><span class="op" id="3304378">.</span><span class="ident" id="3304379">IsUnspecified</span><span class="op" id="3304392">(</span><span class="op" id="3304393">)</span><br>
<span class="lineno"></span><span class="op" id="3304395">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3304398">func</span>&nbsp;<span class="op" id="3304403">(</span><span class="ident" id="3304404">a</span>&nbsp;<span class="op" id="3304406">*</span><span class="ident" id="3304407">UDPAddr</span><span class="op" id="3304414">)</span>&nbsp;<span class="ident" id="3304416">sockaddr</span><span class="op" id="3304424">(</span><span class="ident" id="3304425">family</span>&nbsp;<span class="builtintype" id="3304432">int</span><span class="op" id="3304435">)</span>&nbsp;<span class="op" id="3304437">(</span><span class="ident" id="3304438">syscall</span><span class="op" id="3304445">.</span><span class="ident" id="3304446">Sockaddr</span><span class="op" id="3304454">,</span>&nbsp;<span class="builtintype" id="3304456">error</span><span class="op" id="3304461">)</span>&nbsp;<span class="op" id="3304463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304466">if</span>&nbsp;<span class="ident" id="3304469">a</span>&nbsp;<span class="op" id="3304471">==</span>&nbsp;<span class="ident" id="3304474">nil</span>&nbsp;<span class="op" id="3304478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304482">return</span>&nbsp;<span class="ident" id="3304489">nil</span><span class="op" id="3304492">,</span>&nbsp;<span class="ident" id="3304494">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3304499">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3304502">return</span>&nbsp;<span class="ident" id="3304509">ipToSockaddr</span><span class="op" id="3304521">(</span><span class="ident" id="3304522">family</span><span class="op" id="3304528">,</span>&nbsp;<span class="ident" id="3304530">a</span><span class="op" id="3304531">.</span><span class="ident" id="3304532">IP</span><span class="op" id="3304534">,</span>&nbsp;<span class="ident" id="3304536">a</span><span class="op" id="3304537">.</span><span class="ident" id="3304538">Port</span><span class="op" id="3304542">,</span>&nbsp;<span class="ident" id="3304544">a</span><span class="op" id="3304545">.</span><span class="ident" id="3304546">Zone</span><span class="op" id="3304550">)</span><br>
<span class="lineno"></span><span class="op" id="3304552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3304555">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3304626">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3304658">type</span>&nbsp;<span class="ident" id="3304663">UDPConn</span>&nbsp;<span class="keyword" id="3304671">struct</span>&nbsp;<span class="op" id="3304678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3304681">conn</span><br>
<span class="lineno"></span><span class="op" id="3304686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304689">func</span>&nbsp;<span class="ident" id="3304694">newUDPConn</span><span class="op" id="3304704">(</span><span class="ident" id="3304705">fd</span>&nbsp;<span class="op" id="3304708">*</span><span class="ident" id="3304709">netFD</span><span class="op" id="3304714">)</span>&nbsp;<span class="op" id="3304716">*</span><span class="ident" id="3304717">UDPConn</span>&nbsp;<span class="op" id="3304725">{</span>&nbsp;<span class="keyword" id="3304727">return</span>&nbsp;<span class="op" id="3304734">&amp;</span><span class="ident" id="3304735">UDPConn</span><span class="op" id="3304742">{</span><span class="ident" id="3304743">conn</span><span class="op" id="3304747">{</span><span class="ident" id="3304748">fd</span><span class="op" id="3304750">}</span><span class="op" id="3304751">}</span>&nbsp;<span class="op" id="3304753">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3304756">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3304826">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3304897">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3304924">//</span><br>
<span class="lineno">60</span><span class="comment" id="3304927">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3304991">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3305058">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3305078">func</span>&nbsp;<span class="op" id="3305083">(</span><span class="ident" id="3305084">c</span>&nbsp;<span class="op" id="3305086">*</span><span class="ident" id="3305087">UDPConn</span><span class="op" id="3305094">)</span>&nbsp;<span class="ident" id="3305096">ReadFromUDP</span><span class="op" id="3305107">(</span><span class="ident" id="3305108">b</span>&nbsp;<span class="op" id="3305110">[</span><span class="op" id="3305111">]</span><span class="builtintype" id="3305112">byte</span><span class="op" id="3305116">)</span>&nbsp;<span class="op" id="3305118">(</span><span class="ident" id="3305119">n</span>&nbsp;<span class="builtintype" id="3305121">int</span><span class="op" id="3305124">,</span>&nbsp;<span class="ident" id="3305126">addr</span>&nbsp;<span class="op" id="3305131">*</span><span class="ident" id="3305132">UDPAddr</span><span class="op" id="3305139">,</span>&nbsp;<span class="ident" id="3305141">err</span>&nbsp;<span class="builtintype" id="3305145">error</span><span class="op" id="3305150">)</span>&nbsp;<span class="op" id="3305152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305155">if</span>&nbsp;<span class="op" id="3305158">!</span><span class="ident" id="3305159">c</span><span class="op" id="3305160">.</span><span class="ident" id="3305161">ok</span><span class="op" id="3305163">(</span><span class="op" id="3305164">)</span>&nbsp;<span class="op" id="3305166">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305170">return</span>&nbsp;<span class="num" id="3305177">0</span><span class="op" id="3305178">,</span>&nbsp;<span class="ident" id="3305180">nil</span><span class="op" id="3305183">,</span>&nbsp;<span class="ident" id="3305185">syscall</span><span class="op" id="3305192">.</span><span class="ident" id="3305193">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305204">n</span><span class="op" id="3305205">,</span>&nbsp;<span class="ident" id="3305207">sa</span><span class="op" id="3305209">,</span>&nbsp;<span class="ident" id="3305211">err</span>&nbsp;<span class="op" id="3305215">:=</span>&nbsp;<span class="ident" id="3305218">c</span><span class="op" id="3305219">.</span><span class="ident" id="3305220">fd</span><span class="op" id="3305222">.</span><span class="ident" id="3305223">readFrom</span><span class="op" id="3305231">(</span><span class="ident" id="3305232">b</span><span class="op" id="3305233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305236">switch</span>&nbsp;<span class="ident" id="3305243">sa</span>&nbsp;<span class="op" id="3305246">:=</span>&nbsp;<span class="ident" id="3305249">sa</span><span class="op" id="3305251">.</span><span class="op" id="3305252">(</span><span class="keyword" id="3305253">type</span><span class="op" id="3305257">)</span>&nbsp;<span class="op" id="3305259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305262">case</span>&nbsp;<span class="op" id="3305267">*</span><span class="ident" id="3305268">syscall</span><span class="op" id="3305275">.</span><span class="ident" id="3305276">SockaddrInet4</span><span class="op" id="3305289">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305293">addr</span>&nbsp;<span class="op" id="3305298">=</span>&nbsp;<span class="op" id="3305300">&amp;</span><span class="ident" id="3305301">UDPAddr</span><span class="op" id="3305308">{</span><span class="ident" id="3305309">IP</span><span class="op" id="3305311">:</span>&nbsp;<span class="ident" id="3305313">sa</span><span class="op" id="3305315">.</span><span class="ident" id="3305316">Addr</span><span class="op" id="3305320">[</span><span class="num" id="3305321">0</span><span class="op" id="3305322">:</span><span class="op" id="3305323">]</span><span class="op" id="3305324">,</span>&nbsp;<span class="ident" id="3305326">Port</span><span class="op" id="3305330">:</span>&nbsp;<span class="ident" id="3305332">sa</span><span class="op" id="3305334">.</span><span class="ident" id="3305335">Port</span><span class="op" id="3305339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305342">case</span>&nbsp;<span class="op" id="3305347">*</span><span class="ident" id="3305348">syscall</span><span class="op" id="3305355">.</span><span class="ident" id="3305356">SockaddrInet6</span><span class="op" id="3305369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305373">addr</span>&nbsp;<span class="op" id="3305378">=</span>&nbsp;<span class="op" id="3305380">&amp;</span><span class="ident" id="3305381">UDPAddr</span><span class="op" id="3305388">{</span><span class="ident" id="3305389">IP</span><span class="op" id="3305391">:</span>&nbsp;<span class="ident" id="3305393">sa</span><span class="op" id="3305395">.</span><span class="ident" id="3305396">Addr</span><span class="op" id="3305400">[</span><span class="num" id="3305401">0</span><span class="op" id="3305402">:</span><span class="op" id="3305403">]</span><span class="op" id="3305404">,</span>&nbsp;<span class="ident" id="3305406">Port</span><span class="op" id="3305410">:</span>&nbsp;<span class="ident" id="3305412">sa</span><span class="op" id="3305414">.</span><span class="ident" id="3305415">Port</span><span class="op" id="3305419">,</span>&nbsp;<span class="ident" id="3305421">Zone</span><span class="op" id="3305425">:</span>&nbsp;<span class="ident" id="3305427">zoneToString</span><span class="op" id="3305439">(</span><span class="builtintype" id="3305440">int</span><span class="op" id="3305443">(</span><span class="ident" id="3305444">sa</span><span class="op" id="3305446">.</span><span class="ident" id="3305447">ZoneId</span><span class="op" id="3305453">)</span><span class="op" id="3305454">)</span><span class="op" id="3305455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305461">return</span><br>
<span class="lineno">75</span><span class="op" id="3305468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3305471">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3305526">func</span>&nbsp;<span class="op" id="3305531">(</span><span class="ident" id="3305532">c</span>&nbsp;<span class="op" id="3305534">*</span><span class="ident" id="3305535">UDPConn</span><span class="op" id="3305542">)</span>&nbsp;<span class="ident" id="3305544">ReadFrom</span><span class="op" id="3305552">(</span><span class="ident" id="3305553">b</span>&nbsp;<span class="op" id="3305555">[</span><span class="op" id="3305556">]</span><span class="builtintype" id="3305557">byte</span><span class="op" id="3305561">)</span>&nbsp;<span class="op" id="3305563">(</span><span class="builtintype" id="3305564">int</span><span class="op" id="3305567">,</span>&nbsp;<span class="ident" id="3305569">Addr</span><span class="op" id="3305573">,</span>&nbsp;<span class="builtintype" id="3305575">error</span><span class="op" id="3305580">)</span>&nbsp;<span class="op" id="3305582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305585">if</span>&nbsp;<span class="op" id="3305588">!</span><span class="ident" id="3305589">c</span><span class="op" id="3305590">.</span><span class="ident" id="3305591">ok</span><span class="op" id="3305593">(</span><span class="op" id="3305594">)</span>&nbsp;<span class="op" id="3305596">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305600">return</span>&nbsp;<span class="num" id="3305607">0</span><span class="op" id="3305608">,</span>&nbsp;<span class="ident" id="3305610">nil</span><span class="op" id="3305613">,</span>&nbsp;<span class="ident" id="3305615">syscall</span><span class="op" id="3305622">.</span><span class="ident" id="3305623">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3305631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3305634">n</span><span class="op" id="3305635">,</span>&nbsp;<span class="ident" id="3305637">addr</span><span class="op" id="3305641">,</span>&nbsp;<span class="ident" id="3305643">err</span>&nbsp;<span class="op" id="3305647">:=</span>&nbsp;<span class="ident" id="3305650">c</span><span class="op" id="3305651">.</span><span class="ident" id="3305652">ReadFromUDP</span><span class="op" id="3305663">(</span><span class="ident" id="3305664">b</span><span class="op" id="3305665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3305668">return</span>&nbsp;<span class="ident" id="3305675">n</span><span class="op" id="3305676">,</span>&nbsp;<span class="ident" id="3305678">addr</span><span class="op" id="3305682">.</span><span class="ident" id="3305683">toAddr</span><span class="op" id="3305689">(</span><span class="op" id="3305690">)</span><span class="op" id="3305691">,</span>&nbsp;<span class="ident" id="3305693">err</span><br>
<span class="lineno"></span><span class="op" id="3305697">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3305700">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3305768">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3305836">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3305904">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3305971">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3305982">func</span>&nbsp;<span class="op" id="3305987">(</span><span class="ident" id="3305988">c</span>&nbsp;<span class="op" id="3305990">*</span><span class="ident" id="3305991">UDPConn</span><span class="op" id="3305998">)</span>&nbsp;<span class="ident" id="3306000">ReadMsgUDP</span><span class="op" id="3306010">(</span><span class="ident" id="3306011">b</span><span class="op" id="3306012">,</span>&nbsp;<span class="ident" id="3306014">oob</span>&nbsp;<span class="op" id="3306018">[</span><span class="op" id="3306019">]</span><span class="builtintype" id="3306020">byte</span><span class="op" id="3306024">)</span>&nbsp;<span class="op" id="3306026">(</span><span class="ident" id="3306027">n</span><span class="op" id="3306028">,</span>&nbsp;<span class="ident" id="3306030">oobn</span><span class="op" id="3306034">,</span>&nbsp;<span class="ident" id="3306036">flags</span>&nbsp;<span class="builtintype" id="3306042">int</span><span class="op" id="3306045">,</span>&nbsp;<span class="ident" id="3306047">addr</span>&nbsp;<span class="op" id="3306052">*</span><span class="ident" id="3306053">UDPAddr</span><span class="op" id="3306060">,</span>&nbsp;<span class="ident" id="3306062">err</span>&nbsp;<span class="builtintype" id="3306066">error</span><span class="op" id="3306071">)</span>&nbsp;<span class="op" id="3306073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306076">if</span>&nbsp;<span class="op" id="3306079">!</span><span class="ident" id="3306080">c</span><span class="op" id="3306081">.</span><span class="ident" id="3306082">ok</span><span class="op" id="3306084">(</span><span class="op" id="3306085">)</span>&nbsp;<span class="op" id="3306087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306091">return</span>&nbsp;<span class="num" id="3306098">0</span><span class="op" id="3306099">,</span>&nbsp;<span class="num" id="3306101">0</span><span class="op" id="3306102">,</span>&nbsp;<span class="num" id="3306104">0</span><span class="op" id="3306105">,</span>&nbsp;<span class="ident" id="3306107">nil</span><span class="op" id="3306110">,</span>&nbsp;<span class="ident" id="3306112">syscall</span><span class="op" id="3306119">.</span><span class="ident" id="3306120">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306128">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306131">var</span>&nbsp;<span class="ident" id="3306135">sa</span>&nbsp;<span class="ident" id="3306138">syscall</span><span class="op" id="3306145">.</span><span class="ident" id="3306146">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306156">n</span><span class="op" id="3306157">,</span>&nbsp;<span class="ident" id="3306159">oobn</span><span class="op" id="3306163">,</span>&nbsp;<span class="ident" id="3306165">flags</span><span class="op" id="3306170">,</span>&nbsp;<span class="ident" id="3306172">sa</span><span class="op" id="3306174">,</span>&nbsp;<span class="ident" id="3306176">err</span>&nbsp;<span class="op" id="3306180">=</span>&nbsp;<span class="ident" id="3306182">c</span><span class="op" id="3306183">.</span><span class="ident" id="3306184">fd</span><span class="op" id="3306186">.</span><span class="ident" id="3306187">readMsg</span><span class="op" id="3306194">(</span><span class="ident" id="3306195">b</span><span class="op" id="3306196">,</span>&nbsp;<span class="ident" id="3306198">oob</span><span class="op" id="3306201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306204">switch</span>&nbsp;<span class="ident" id="3306211">sa</span>&nbsp;<span class="op" id="3306214">:=</span>&nbsp;<span class="ident" id="3306217">sa</span><span class="op" id="3306219">.</span><span class="op" id="3306220">(</span><span class="keyword" id="3306221">type</span><span class="op" id="3306225">)</span>&nbsp;<span class="op" id="3306227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306230">case</span>&nbsp;<span class="op" id="3306235">*</span><span class="ident" id="3306236">syscall</span><span class="op" id="3306243">.</span><span class="ident" id="3306244">SockaddrInet4</span><span class="op" id="3306257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306261">addr</span>&nbsp;<span class="op" id="3306266">=</span>&nbsp;<span class="op" id="3306268">&amp;</span><span class="ident" id="3306269">UDPAddr</span><span class="op" id="3306276">{</span><span class="ident" id="3306277">IP</span><span class="op" id="3306279">:</span>&nbsp;<span class="ident" id="3306281">sa</span><span class="op" id="3306283">.</span><span class="ident" id="3306284">Addr</span><span class="op" id="3306288">[</span><span class="num" id="3306289">0</span><span class="op" id="3306290">:</span><span class="op" id="3306291">]</span><span class="op" id="3306292">,</span>&nbsp;<span class="ident" id="3306294">Port</span><span class="op" id="3306298">:</span>&nbsp;<span class="ident" id="3306300">sa</span><span class="op" id="3306302">.</span><span class="ident" id="3306303">Port</span><span class="op" id="3306307">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306310">case</span>&nbsp;<span class="op" id="3306315">*</span><span class="ident" id="3306316">syscall</span><span class="op" id="3306323">.</span><span class="ident" id="3306324">SockaddrInet6</span><span class="op" id="3306337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3306341">addr</span>&nbsp;<span class="op" id="3306346">=</span>&nbsp;<span class="op" id="3306348">&amp;</span><span class="ident" id="3306349">UDPAddr</span><span class="op" id="3306356">{</span><span class="ident" id="3306357">IP</span><span class="op" id="3306359">:</span>&nbsp;<span class="ident" id="3306361">sa</span><span class="op" id="3306363">.</span><span class="ident" id="3306364">Addr</span><span class="op" id="3306368">[</span><span class="num" id="3306369">0</span><span class="op" id="3306370">:</span><span class="op" id="3306371">]</span><span class="op" id="3306372">,</span>&nbsp;<span class="ident" id="3306374">Port</span><span class="op" id="3306378">:</span>&nbsp;<span class="ident" id="3306380">sa</span><span class="op" id="3306382">.</span><span class="ident" id="3306383">Port</span><span class="op" id="3306387">,</span>&nbsp;<span class="ident" id="3306389">Zone</span><span class="op" id="3306393">:</span>&nbsp;<span class="ident" id="3306395">zoneToString</span><span class="op" id="3306407">(</span><span class="builtintype" id="3306408">int</span><span class="op" id="3306411">(</span><span class="ident" id="3306412">sa</span><span class="op" id="3306414">.</span><span class="ident" id="3306415">ZoneId</span><span class="op" id="3306421">)</span><span class="op" id="3306422">)</span><span class="op" id="3306423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306429">return</span><br>
<span class="lineno"></span><span class="op" id="3306436">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3306439">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3306508">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3306519">//</span><br>
<span class="lineno"></span><span class="comment" id="3306522">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3306585">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3306652">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3306721">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3306734">func</span>&nbsp;<span class="op" id="3306739">(</span><span class="ident" id="3306740">c</span>&nbsp;<span class="op" id="3306742">*</span><span class="ident" id="3306743">UDPConn</span><span class="op" id="3306750">)</span>&nbsp;<span class="ident" id="3306752">WriteToUDP</span><span class="op" id="3306762">(</span><span class="ident" id="3306763">b</span>&nbsp;<span class="op" id="3306765">[</span><span class="op" id="3306766">]</span><span class="builtintype" id="3306767">byte</span><span class="op" id="3306771">,</span>&nbsp;<span class="ident" id="3306773">addr</span>&nbsp;<span class="op" id="3306778">*</span><span class="ident" id="3306779">UDPAddr</span><span class="op" id="3306786">)</span>&nbsp;<span class="op" id="3306788">(</span><span class="builtintype" id="3306789">int</span><span class="op" id="3306792">,</span>&nbsp;<span class="builtintype" id="3306794">error</span><span class="op" id="3306799">)</span>&nbsp;<span class="op" id="3306801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306804">if</span>&nbsp;<span class="op" id="3306807">!</span><span class="ident" id="3306808">c</span><span class="op" id="3306809">.</span><span class="ident" id="3306810">ok</span><span class="op" id="3306812">(</span><span class="op" id="3306813">)</span>&nbsp;<span class="op" id="3306815">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306819">return</span>&nbsp;<span class="num" id="3306826">0</span><span class="op" id="3306827">,</span>&nbsp;<span class="ident" id="3306829">syscall</span><span class="op" id="3306836">.</span><span class="ident" id="3306837">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306848">if</span>&nbsp;<span class="ident" id="3306851">c</span><span class="op" id="3306852">.</span><span class="ident" id="3306853">fd</span><span class="op" id="3306855">.</span><span class="ident" id="3306856">isConnected</span>&nbsp;<span class="op" id="3306868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306872">return</span>&nbsp;<span class="num" id="3306879">0</span><span class="op" id="3306880">,</span>&nbsp;<span class="op" id="3306882">&amp;</span><span class="ident" id="3306883">OpError</span><span class="op" id="3306890">{</span><span class="string" id="3306891">&#34;write&#34;</span><span class="op" id="3306898">,</span>&nbsp;<span class="ident" id="3306900">c</span><span class="op" id="3306901">.</span><span class="ident" id="3306902">fd</span><span class="op" id="3306904">.</span><span class="ident" id="3306905">net</span><span class="op" id="3306908">,</span>&nbsp;<span class="ident" id="3306910">addr</span><span class="op" id="3306914">,</span>&nbsp;<span class="ident" id="3306916">ErrWriteToConnected</span><span class="op" id="3306935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3306938">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306941">if</span>&nbsp;<span class="ident" id="3306944">addr</span>&nbsp;<span class="op" id="3306949">==</span>&nbsp;<span class="ident" id="3306952">nil</span>&nbsp;<span class="op" id="3306956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3306960">return</span>&nbsp;<span class="num" id="3306967">0</span><span class="op" id="3306968">,</span>&nbsp;<span class="op" id="3306970">&amp;</span><span class="ident" id="3306971">OpError</span><span class="op" id="3306978">{</span><span class="ident" id="3306979">Op</span><span class="op" id="3306981">:</span>&nbsp;<span class="string" id="3306983">&#34;write&#34;</span><span class="op" id="3306990">,</span>&nbsp;<span class="ident" id="3306992">Net</span><span class="op" id="3306995">:</span>&nbsp;<span class="ident" id="3306997">c</span><span class="op" id="3306998">.</span><span class="ident" id="3306999">fd</span><span class="op" id="3307001">.</span><span class="ident" id="3307002">net</span><span class="op" id="3307005">,</span>&nbsp;<span class="ident" id="3307007">Addr</span><span class="op" id="3307011">:</span>&nbsp;<span class="ident" id="3307013">nil</span><span class="op" id="3307016">,</span>&nbsp;<span class="ident" id="3307018">Err</span><span class="op" id="3307021">:</span>&nbsp;<span class="ident" id="3307023">errMissingAddress</span><span class="op" id="3307040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307046">sa</span><span class="op" id="3307048">,</span>&nbsp;<span class="ident" id="3307050">err</span>&nbsp;<span class="op" id="3307054">:=</span>&nbsp;<span class="ident" id="3307057">addr</span><span class="op" id="3307061">.</span><span class="ident" id="3307062">sockaddr</span><span class="op" id="3307070">(</span><span class="ident" id="3307071">c</span><span class="op" id="3307072">.</span><span class="ident" id="3307073">fd</span><span class="op" id="3307075">.</span><span class="ident" id="3307076">family</span><span class="op" id="3307082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307085">if</span>&nbsp;<span class="ident" id="3307088">err</span>&nbsp;<span class="op" id="3307092">!=</span>&nbsp;<span class="ident" id="3307095">nil</span>&nbsp;<span class="op" id="3307099">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307103">return</span>&nbsp;<span class="num" id="3307110">0</span><span class="op" id="3307111">,</span>&nbsp;<span class="op" id="3307113">&amp;</span><span class="ident" id="3307114">OpError</span><span class="op" id="3307121">{</span><span class="string" id="3307122">&#34;write&#34;</span><span class="op" id="3307129">,</span>&nbsp;<span class="ident" id="3307131">c</span><span class="op" id="3307132">.</span><span class="ident" id="3307133">fd</span><span class="op" id="3307135">.</span><span class="ident" id="3307136">net</span><span class="op" id="3307139">,</span>&nbsp;<span class="ident" id="3307141">addr</span><span class="op" id="3307145">,</span>&nbsp;<span class="ident" id="3307147">err</span><span class="op" id="3307150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307156">return</span>&nbsp;<span class="ident" id="3307163">c</span><span class="op" id="3307164">.</span><span class="ident" id="3307165">fd</span><span class="op" id="3307167">.</span><span class="ident" id="3307168">writeTo</span><span class="op" id="3307175">(</span><span class="ident" id="3307176">b</span><span class="op" id="3307177">,</span>&nbsp;<span class="ident" id="3307179">sa</span><span class="op" id="3307181">)</span><br>
<span class="lineno"></span><span class="op" id="3307183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3307186">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3307239">func</span>&nbsp;<span class="op" id="3307244">(</span><span class="ident" id="3307245">c</span>&nbsp;<span class="op" id="3307247">*</span><span class="ident" id="3307248">UDPConn</span><span class="op" id="3307255">)</span>&nbsp;<span class="ident" id="3307257">WriteTo</span><span class="op" id="3307264">(</span><span class="ident" id="3307265">b</span>&nbsp;<span class="op" id="3307267">[</span><span class="op" id="3307268">]</span><span class="builtintype" id="3307269">byte</span><span class="op" id="3307273">,</span>&nbsp;<span class="ident" id="3307275">addr</span>&nbsp;<span class="ident" id="3307280">Addr</span><span class="op" id="3307284">)</span>&nbsp;<span class="op" id="3307286">(</span><span class="builtintype" id="3307287">int</span><span class="op" id="3307290">,</span>&nbsp;<span class="builtintype" id="3307292">error</span><span class="op" id="3307297">)</span>&nbsp;<span class="op" id="3307299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307302">if</span>&nbsp;<span class="op" id="3307305">!</span><span class="ident" id="3307306">c</span><span class="op" id="3307307">.</span><span class="ident" id="3307308">ok</span><span class="op" id="3307310">(</span><span class="op" id="3307311">)</span>&nbsp;<span class="op" id="3307313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307317">return</span>&nbsp;<span class="num" id="3307324">0</span><span class="op" id="3307325">,</span>&nbsp;<span class="ident" id="3307327">syscall</span><span class="op" id="3307334">.</span><span class="ident" id="3307335">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307343">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3307346">a</span><span class="op" id="3307347">,</span>&nbsp;<span class="ident" id="3307349">ok</span>&nbsp;<span class="op" id="3307352">:=</span>&nbsp;<span class="ident" id="3307355">addr</span><span class="op" id="3307359">.</span><span class="op" id="3307360">(</span><span class="op" id="3307361">*</span><span class="ident" id="3307362">UDPAddr</span><span class="op" id="3307369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307372">if</span>&nbsp;<span class="op" id="3307375">!</span><span class="ident" id="3307376">ok</span>&nbsp;<span class="op" id="3307379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307383">return</span>&nbsp;<span class="num" id="3307390">0</span><span class="op" id="3307391">,</span>&nbsp;<span class="op" id="3307393">&amp;</span><span class="ident" id="3307394">OpError</span><span class="op" id="3307401">{</span><span class="string" id="3307402">&#34;write&#34;</span><span class="op" id="3307409">,</span>&nbsp;<span class="ident" id="3307411">c</span><span class="op" id="3307412">.</span><span class="ident" id="3307413">fd</span><span class="op" id="3307415">.</span><span class="ident" id="3307416">net</span><span class="op" id="3307419">,</span>&nbsp;<span class="ident" id="3307421">addr</span><span class="op" id="3307425">,</span>&nbsp;<span class="ident" id="3307427">syscall</span><span class="op" id="3307434">.</span><span class="ident" id="3307435">EINVAL</span><span class="op" id="3307441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307447">return</span>&nbsp;<span class="ident" id="3307454">c</span><span class="op" id="3307455">.</span><span class="ident" id="3307456">WriteToUDP</span><span class="op" id="3307466">(</span><span class="ident" id="3307467">b</span><span class="op" id="3307468">,</span>&nbsp;<span class="ident" id="3307470">a</span><span class="op" id="3307471">)</span><br>
<span class="lineno">140</span><span class="op" id="3307473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3307476">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3307547">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3307614">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3307666">func</span>&nbsp;<span class="op" id="3307671">(</span><span class="ident" id="3307672">c</span>&nbsp;<span class="op" id="3307674">*</span><span class="ident" id="3307675">UDPConn</span><span class="op" id="3307682">)</span>&nbsp;<span class="ident" id="3307684">WriteMsgUDP</span><span class="op" id="3307695">(</span><span class="ident" id="3307696">b</span><span class="op" id="3307697">,</span>&nbsp;<span class="ident" id="3307699">oob</span>&nbsp;<span class="op" id="3307703">[</span><span class="op" id="3307704">]</span><span class="builtintype" id="3307705">byte</span><span class="op" id="3307709">,</span>&nbsp;<span class="ident" id="3307711">addr</span>&nbsp;<span class="op" id="3307716">*</span><span class="ident" id="3307717">UDPAddr</span><span class="op" id="3307724">)</span>&nbsp;<span class="op" id="3307726">(</span><span class="ident" id="3307727">n</span><span class="op" id="3307728">,</span>&nbsp;<span class="ident" id="3307730">oobn</span>&nbsp;<span class="builtintype" id="3307735">int</span><span class="op" id="3307738">,</span>&nbsp;<span class="ident" id="3307740">err</span>&nbsp;<span class="builtintype" id="3307744">error</span><span class="op" id="3307749">)</span>&nbsp;<span class="op" id="3307751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307754">if</span>&nbsp;<span class="op" id="3307757">!</span><span class="ident" id="3307758">c</span><span class="op" id="3307759">.</span><span class="ident" id="3307760">ok</span><span class="op" id="3307762">(</span><span class="op" id="3307763">)</span>&nbsp;<span class="op" id="3307765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307769">return</span>&nbsp;<span class="num" id="3307776">0</span><span class="op" id="3307777">,</span>&nbsp;<span class="num" id="3307779">0</span><span class="op" id="3307780">,</span>&nbsp;<span class="ident" id="3307782">syscall</span><span class="op" id="3307789">.</span><span class="ident" id="3307790">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307801">if</span>&nbsp;<span class="ident" id="3307804">c</span><span class="op" id="3307805">.</span><span class="ident" id="3307806">fd</span><span class="op" id="3307808">.</span><span class="ident" id="3307809">isConnected</span>&nbsp;<span class="op" id="3307821">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307825">return</span>&nbsp;<span class="num" id="3307832">0</span><span class="op" id="3307833">,</span>&nbsp;<span class="num" id="3307835">0</span><span class="op" id="3307836">,</span>&nbsp;<span class="op" id="3307838">&amp;</span><span class="ident" id="3307839">OpError</span><span class="op" id="3307846">{</span><span class="string" id="3307847">&#34;write&#34;</span><span class="op" id="3307854">,</span>&nbsp;<span class="ident" id="3307856">c</span><span class="op" id="3307857">.</span><span class="ident" id="3307858">fd</span><span class="op" id="3307860">.</span><span class="ident" id="3307861">net</span><span class="op" id="3307864">,</span>&nbsp;<span class="ident" id="3307866">addr</span><span class="op" id="3307870">,</span>&nbsp;<span class="ident" id="3307872">ErrWriteToConnected</span><span class="op" id="3307891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3307894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307897">if</span>&nbsp;<span class="ident" id="3307900">addr</span>&nbsp;<span class="op" id="3307905">==</span>&nbsp;<span class="ident" id="3307908">nil</span>&nbsp;<span class="op" id="3307912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3307916">return</span>&nbsp;<span class="num" id="3307923">0</span><span class="op" id="3307924">,</span>&nbsp;<span class="num" id="3307926">0</span><span class="op" id="3307927">,</span>&nbsp;<span class="op" id="3307929">&amp;</span><span class="ident" id="3307930">OpError</span><span class="op" id="3307937">{</span><span class="ident" id="3307938">Op</span><span class="op" id="3307940">:</span>&nbsp;<span class="string" id="3307942">&#34;write&#34;</span><span class="op" id="3307949">,</span>&nbsp;<span class="ident" id="3307951">Net</span><span class="op" id="3307954">:</span>&nbsp;<span class="ident" id="3307956">c</span><span class="op" id="3307957">.</span><span class="ident" id="3307958">fd</span><span class="op" id="3307960">.</span><span class="ident" id="3307961">net</span><span class="op" id="3307964">,</span>&nbsp;<span class="ident" id="3307966">Addr</span><span class="op" id="3307970">:</span>&nbsp;<span class="ident" id="3307972">nil</span><span class="op" id="3307975">,</span>&nbsp;<span class="ident" id="3307977">Err</span><span class="op" id="3307980">:</span>&nbsp;<span class="ident" id="3307982">errMissingAddress</span><span class="op" id="3307999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308002">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308005">sa</span><span class="op" id="3308007">,</span>&nbsp;<span class="ident" id="3308009">err</span>&nbsp;<span class="op" id="3308013">:=</span>&nbsp;<span class="ident" id="3308016">addr</span><span class="op" id="3308020">.</span><span class="ident" id="3308021">sockaddr</span><span class="op" id="3308029">(</span><span class="ident" id="3308030">c</span><span class="op" id="3308031">.</span><span class="ident" id="3308032">fd</span><span class="op" id="3308034">.</span><span class="ident" id="3308035">family</span><span class="op" id="3308041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308044">if</span>&nbsp;<span class="ident" id="3308047">err</span>&nbsp;<span class="op" id="3308051">!=</span>&nbsp;<span class="ident" id="3308054">nil</span>&nbsp;<span class="op" id="3308058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308062">return</span>&nbsp;<span class="num" id="3308069">0</span><span class="op" id="3308070">,</span>&nbsp;<span class="num" id="3308072">0</span><span class="op" id="3308073">,</span>&nbsp;<span class="op" id="3308075">&amp;</span><span class="ident" id="3308076">OpError</span><span class="op" id="3308083">{</span><span class="string" id="3308084">&#34;write&#34;</span><span class="op" id="3308091">,</span>&nbsp;<span class="ident" id="3308093">c</span><span class="op" id="3308094">.</span><span class="ident" id="3308095">fd</span><span class="op" id="3308097">.</span><span class="ident" id="3308098">net</span><span class="op" id="3308101">,</span>&nbsp;<span class="ident" id="3308103">addr</span><span class="op" id="3308107">,</span>&nbsp;<span class="ident" id="3308109">err</span><span class="op" id="3308112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308118">return</span>&nbsp;<span class="ident" id="3308125">c</span><span class="op" id="3308126">.</span><span class="ident" id="3308127">fd</span><span class="op" id="3308129">.</span><span class="ident" id="3308130">writeMsg</span><span class="op" id="3308138">(</span><span class="ident" id="3308139">b</span><span class="op" id="3308140">,</span>&nbsp;<span class="ident" id="3308142">oob</span><span class="op" id="3308145">,</span>&nbsp;<span class="ident" id="3308147">sa</span><span class="op" id="3308149">)</span><br>
<span class="lineno">160</span><span class="op" id="3308151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3308154">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3308222">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3308293">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3308342">func</span>&nbsp;<span class="ident" id="3308347">DialUDP</span><span class="op" id="3308354">(</span><span class="ident" id="3308355">net</span>&nbsp;<span class="builtintype" id="3308359">string</span><span class="op" id="3308365">,</span>&nbsp;<span class="ident" id="3308367">laddr</span><span class="op" id="3308372">,</span>&nbsp;<span class="ident" id="3308374">raddr</span>&nbsp;<span class="op" id="3308380">*</span><span class="ident" id="3308381">UDPAddr</span><span class="op" id="3308388">)</span>&nbsp;<span class="op" id="3308390">(</span><span class="op" id="3308391">*</span><span class="ident" id="3308392">UDPConn</span><span class="op" id="3308399">,</span>&nbsp;<span class="builtintype" id="3308401">error</span><span class="op" id="3308406">)</span>&nbsp;<span class="op" id="3308408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308411">switch</span>&nbsp;<span class="ident" id="3308418">net</span>&nbsp;<span class="op" id="3308422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308425">case</span>&nbsp;<span class="string" id="3308430">&#34;udp&#34;</span><span class="op" id="3308435">,</span>&nbsp;<span class="string" id="3308437">&#34;udp4&#34;</span><span class="op" id="3308443">,</span>&nbsp;<span class="string" id="3308445">&#34;udp6&#34;</span><span class="op" id="3308451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308454">default</span><span class="op" id="3308461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308465">return</span>&nbsp;<span class="ident" id="3308472">nil</span><span class="op" id="3308475">,</span>&nbsp;<span class="op" id="3308477">&amp;</span><span class="ident" id="3308478">OpError</span><span class="op" id="3308485">{</span><span class="ident" id="3308486">Op</span><span class="op" id="3308488">:</span>&nbsp;<span class="string" id="3308490">&#34;dial&#34;</span><span class="op" id="3308496">,</span>&nbsp;<span class="ident" id="3308498">Net</span><span class="op" id="3308501">:</span>&nbsp;<span class="ident" id="3308503">net</span><span class="op" id="3308506">,</span>&nbsp;<span class="ident" id="3308508">Addr</span><span class="op" id="3308512">:</span>&nbsp;<span class="ident" id="3308514">raddr</span><span class="op" id="3308519">,</span>&nbsp;<span class="ident" id="3308521">Err</span><span class="op" id="3308524">:</span>&nbsp;<span class="ident" id="3308526">UnknownNetworkError</span><span class="op" id="3308545">(</span><span class="ident" id="3308546">net</span><span class="op" id="3308549">)</span><span class="op" id="3308550">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308556">if</span>&nbsp;<span class="ident" id="3308559">raddr</span>&nbsp;<span class="op" id="3308565">==</span>&nbsp;<span class="ident" id="3308568">nil</span>&nbsp;<span class="op" id="3308572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308576">return</span>&nbsp;<span class="ident" id="3308583">nil</span><span class="op" id="3308586">,</span>&nbsp;<span class="op" id="3308588">&amp;</span><span class="ident" id="3308589">OpError</span><span class="op" id="3308596">{</span><span class="ident" id="3308597">Op</span><span class="op" id="3308599">:</span>&nbsp;<span class="string" id="3308601">&#34;dial&#34;</span><span class="op" id="3308607">,</span>&nbsp;<span class="ident" id="3308609">Net</span><span class="op" id="3308612">:</span>&nbsp;<span class="ident" id="3308614">net</span><span class="op" id="3308617">,</span>&nbsp;<span class="ident" id="3308619">Addr</span><span class="op" id="3308623">:</span>&nbsp;<span class="ident" id="3308625">nil</span><span class="op" id="3308628">,</span>&nbsp;<span class="ident" id="3308630">Err</span><span class="op" id="3308633">:</span>&nbsp;<span class="ident" id="3308635">errMissingAddress</span><span class="op" id="3308652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308658">return</span>&nbsp;<span class="ident" id="3308665">dialUDP</span><span class="op" id="3308672">(</span><span class="ident" id="3308673">net</span><span class="op" id="3308676">,</span>&nbsp;<span class="ident" id="3308678">laddr</span><span class="op" id="3308683">,</span>&nbsp;<span class="ident" id="3308685">raddr</span><span class="op" id="3308690">,</span>&nbsp;<span class="ident" id="3308692">noDeadline</span><span class="op" id="3308702">)</span><br>
<span class="lineno">175</span><span class="op" id="3308704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3308707">func</span>&nbsp;<span class="ident" id="3308712">dialUDP</span><span class="op" id="3308719">(</span><span class="ident" id="3308720">net</span>&nbsp;<span class="builtintype" id="3308724">string</span><span class="op" id="3308730">,</span>&nbsp;<span class="ident" id="3308732">laddr</span><span class="op" id="3308737">,</span>&nbsp;<span class="ident" id="3308739">raddr</span>&nbsp;<span class="op" id="3308745">*</span><span class="ident" id="3308746">UDPAddr</span><span class="op" id="3308753">,</span>&nbsp;<span class="ident" id="3308755">deadline</span>&nbsp;<span class="ident" id="3308764">time</span><span class="op" id="3308768">.</span><span class="ident" id="3308769">Time</span><span class="op" id="3308773">)</span>&nbsp;<span class="op" id="3308775">(</span><span class="op" id="3308776">*</span><span class="ident" id="3308777">UDPConn</span><span class="op" id="3308784">,</span>&nbsp;<span class="builtintype" id="3308786">error</span><span class="op" id="3308791">)</span>&nbsp;<span class="op" id="3308793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3308796">fd</span><span class="op" id="3308798">,</span>&nbsp;<span class="ident" id="3308800">err</span>&nbsp;<span class="op" id="3308804">:=</span>&nbsp;<span class="ident" id="3308807">internetSocket</span><span class="op" id="3308821">(</span><span class="ident" id="3308822">net</span><span class="op" id="3308825">,</span>&nbsp;<span class="ident" id="3308827">laddr</span><span class="op" id="3308832">,</span>&nbsp;<span class="ident" id="3308834">raddr</span><span class="op" id="3308839">,</span>&nbsp;<span class="ident" id="3308841">deadline</span><span class="op" id="3308849">,</span>&nbsp;<span class="ident" id="3308851">syscall</span><span class="op" id="3308858">.</span><span class="ident" id="3308859">SOCK_DGRAM</span><span class="op" id="3308869">,</span>&nbsp;<span class="num" id="3308871">0</span><span class="op" id="3308872">,</span>&nbsp;<span class="string" id="3308874">&#34;dial&#34;</span><span class="op" id="3308880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308883">if</span>&nbsp;<span class="ident" id="3308886">err</span>&nbsp;<span class="op" id="3308890">!=</span>&nbsp;<span class="ident" id="3308893">nil</span>&nbsp;<span class="op" id="3308897">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308901">return</span>&nbsp;<span class="ident" id="3308908">nil</span><span class="op" id="3308911">,</span>&nbsp;<span class="op" id="3308913">&amp;</span><span class="ident" id="3308914">OpError</span><span class="op" id="3308921">{</span><span class="ident" id="3308922">Op</span><span class="op" id="3308924">:</span>&nbsp;<span class="string" id="3308926">&#34;dial&#34;</span><span class="op" id="3308932">,</span>&nbsp;<span class="ident" id="3308934">Net</span><span class="op" id="3308937">:</span>&nbsp;<span class="ident" id="3308939">net</span><span class="op" id="3308942">,</span>&nbsp;<span class="ident" id="3308944">Addr</span><span class="op" id="3308948">:</span>&nbsp;<span class="ident" id="3308950">raddr</span><span class="op" id="3308955">,</span>&nbsp;<span class="ident" id="3308957">Err</span><span class="op" id="3308960">:</span>&nbsp;<span class="ident" id="3308962">err</span><span class="op" id="3308965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3308968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3308971">return</span>&nbsp;<span class="ident" id="3308978">newUDPConn</span><span class="op" id="3308988">(</span><span class="ident" id="3308989">fd</span><span class="op" id="3308991">)</span><span class="op" id="3308992">,</span>&nbsp;<span class="ident" id="3308994">nil</span><br>
<span class="lineno"></span><span class="op" id="3308998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3309001">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3309070">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3309141">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3309198">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3309261">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3309331">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3309402">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3309417">func</span>&nbsp;<span class="ident" id="3309422">ListenUDP</span><span class="op" id="3309431">(</span><span class="ident" id="3309432">net</span>&nbsp;<span class="builtintype" id="3309436">string</span><span class="op" id="3309442">,</span>&nbsp;<span class="ident" id="3309444">laddr</span>&nbsp;<span class="op" id="3309450">*</span><span class="ident" id="3309451">UDPAddr</span><span class="op" id="3309458">)</span>&nbsp;<span class="op" id="3309460">(</span><span class="op" id="3309461">*</span><span class="ident" id="3309462">UDPConn</span><span class="op" id="3309469">,</span>&nbsp;<span class="builtintype" id="3309471">error</span><span class="op" id="3309476">)</span>&nbsp;<span class="op" id="3309478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309481">switch</span>&nbsp;<span class="ident" id="3309488">net</span>&nbsp;<span class="op" id="3309492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309495">case</span>&nbsp;<span class="string" id="3309500">&#34;udp&#34;</span><span class="op" id="3309505">,</span>&nbsp;<span class="string" id="3309507">&#34;udp4&#34;</span><span class="op" id="3309513">,</span>&nbsp;<span class="string" id="3309515">&#34;udp6&#34;</span><span class="op" id="3309521">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309524">default</span><span class="op" id="3309531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309535">return</span>&nbsp;<span class="ident" id="3309542">nil</span><span class="op" id="3309545">,</span>&nbsp;<span class="op" id="3309547">&amp;</span><span class="ident" id="3309548">OpError</span><span class="op" id="3309555">{</span><span class="ident" id="3309556">Op</span><span class="op" id="3309558">:</span>&nbsp;<span class="string" id="3309560">&#34;listen&#34;</span><span class="op" id="3309568">,</span>&nbsp;<span class="ident" id="3309570">Net</span><span class="op" id="3309573">:</span>&nbsp;<span class="ident" id="3309575">net</span><span class="op" id="3309578">,</span>&nbsp;<span class="ident" id="3309580">Addr</span><span class="op" id="3309584">:</span>&nbsp;<span class="ident" id="3309586">laddr</span><span class="op" id="3309591">,</span>&nbsp;<span class="ident" id="3309593">Err</span><span class="op" id="3309596">:</span>&nbsp;<span class="ident" id="3309598">UnknownNetworkError</span><span class="op" id="3309617">(</span><span class="ident" id="3309618">net</span><span class="op" id="3309621">)</span><span class="op" id="3309622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309628">if</span>&nbsp;<span class="ident" id="3309631">laddr</span>&nbsp;<span class="op" id="3309637">==</span>&nbsp;<span class="ident" id="3309640">nil</span>&nbsp;<span class="op" id="3309644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309648">laddr</span>&nbsp;<span class="op" id="3309654">=</span>&nbsp;<span class="op" id="3309656">&amp;</span><span class="ident" id="3309657">UDPAddr</span><span class="op" id="3309664">{</span><span class="op" id="3309665">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3309671">fd</span><span class="op" id="3309673">,</span>&nbsp;<span class="ident" id="3309675">err</span>&nbsp;<span class="op" id="3309679">:=</span>&nbsp;<span class="ident" id="3309682">internetSocket</span><span class="op" id="3309696">(</span><span class="ident" id="3309697">net</span><span class="op" id="3309700">,</span>&nbsp;<span class="ident" id="3309702">laddr</span><span class="op" id="3309707">,</span>&nbsp;<span class="ident" id="3309709">nil</span><span class="op" id="3309712">,</span>&nbsp;<span class="ident" id="3309714">noDeadline</span><span class="op" id="3309724">,</span>&nbsp;<span class="ident" id="3309726">syscall</span><span class="op" id="3309733">.</span><span class="ident" id="3309734">SOCK_DGRAM</span><span class="op" id="3309744">,</span>&nbsp;<span class="num" id="3309746">0</span><span class="op" id="3309747">,</span>&nbsp;<span class="string" id="3309749">&#34;listen&#34;</span><span class="op" id="3309757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309760">if</span>&nbsp;<span class="ident" id="3309763">err</span>&nbsp;<span class="op" id="3309767">!=</span>&nbsp;<span class="ident" id="3309770">nil</span>&nbsp;<span class="op" id="3309774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309778">return</span>&nbsp;<span class="ident" id="3309785">nil</span><span class="op" id="3309788">,</span>&nbsp;<span class="op" id="3309790">&amp;</span><span class="ident" id="3309791">OpError</span><span class="op" id="3309798">{</span><span class="ident" id="3309799">Op</span><span class="op" id="3309801">:</span>&nbsp;<span class="string" id="3309803">&#34;listen&#34;</span><span class="op" id="3309811">,</span>&nbsp;<span class="ident" id="3309813">Net</span><span class="op" id="3309816">:</span>&nbsp;<span class="ident" id="3309818">net</span><span class="op" id="3309821">,</span>&nbsp;<span class="ident" id="3309823">Addr</span><span class="op" id="3309827">:</span>&nbsp;<span class="ident" id="3309829">laddr</span><span class="op" id="3309834">,</span>&nbsp;<span class="ident" id="3309836">Err</span><span class="op" id="3309839">:</span>&nbsp;<span class="ident" id="3309841">err</span><span class="op" id="3309844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3309847">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3309850">return</span>&nbsp;<span class="ident" id="3309857">newUDPConn</span><span class="op" id="3309867">(</span><span class="ident" id="3309868">fd</span><span class="op" id="3309870">)</span><span class="op" id="3309871">,</span>&nbsp;<span class="ident" id="3309873">nil</span><br>
<span class="lineno"></span><span class="op" id="3309877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3309880">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3309945">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3310013">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3310078">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3310106">func</span>&nbsp;<span class="ident" id="3310111">ListenMulticastUDP</span><span class="op" id="3310129">(</span><span class="ident" id="3310130">net</span>&nbsp;<span class="builtintype" id="3310134">string</span><span class="op" id="3310140">,</span>&nbsp;<span class="ident" id="3310142">ifi</span>&nbsp;<span class="op" id="3310146">*</span><span class="ident" id="3310147">Interface</span><span class="op" id="3310156">,</span>&nbsp;<span class="ident" id="3310158">gaddr</span>&nbsp;<span class="op" id="3310164">*</span><span class="ident" id="3310165">UDPAddr</span><span class="op" id="3310172">)</span>&nbsp;<span class="op" id="3310174">(</span><span class="op" id="3310175">*</span><span class="ident" id="3310176">UDPConn</span><span class="op" id="3310183">,</span>&nbsp;<span class="builtintype" id="3310185">error</span><span class="op" id="3310190">)</span>&nbsp;<span class="op" id="3310192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310195">switch</span>&nbsp;<span class="ident" id="3310202">net</span>&nbsp;<span class="op" id="3310206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310209">case</span>&nbsp;<span class="string" id="3310214">&#34;udp&#34;</span><span class="op" id="3310219">,</span>&nbsp;<span class="string" id="3310221">&#34;udp4&#34;</span><span class="op" id="3310227">,</span>&nbsp;<span class="string" id="3310229">&#34;udp6&#34;</span><span class="op" id="3310235">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310238">default</span><span class="op" id="3310245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310249">return</span>&nbsp;<span class="ident" id="3310256">nil</span><span class="op" id="3310259">,</span>&nbsp;<span class="op" id="3310261">&amp;</span><span class="ident" id="3310262">OpError</span><span class="op" id="3310269">{</span><span class="ident" id="3310270">Op</span><span class="op" id="3310272">:</span>&nbsp;<span class="string" id="3310274">&#34;listen&#34;</span><span class="op" id="3310282">,</span>&nbsp;<span class="ident" id="3310284">Net</span><span class="op" id="3310287">:</span>&nbsp;<span class="ident" id="3310289">net</span><span class="op" id="3310292">,</span>&nbsp;<span class="ident" id="3310294">Addr</span><span class="op" id="3310298">:</span>&nbsp;<span class="ident" id="3310300">gaddr</span><span class="op" id="3310305">,</span>&nbsp;<span class="ident" id="3310307">Err</span><span class="op" id="3310310">:</span>&nbsp;<span class="ident" id="3310312">UnknownNetworkError</span><span class="op" id="3310331">(</span><span class="ident" id="3310332">net</span><span class="op" id="3310335">)</span><span class="op" id="3310336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310342">if</span>&nbsp;<span class="ident" id="3310345">gaddr</span>&nbsp;<span class="op" id="3310351">==</span>&nbsp;<span class="ident" id="3310354">nil</span>&nbsp;<span class="op" id="3310358">||</span>&nbsp;<span class="ident" id="3310361">gaddr</span><span class="op" id="3310366">.</span><span class="ident" id="3310367">IP</span>&nbsp;<span class="op" id="3310370">==</span>&nbsp;<span class="ident" id="3310373">nil</span>&nbsp;<span class="op" id="3310377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310381">return</span>&nbsp;<span class="ident" id="3310388">nil</span><span class="op" id="3310391">,</span>&nbsp;<span class="op" id="3310393">&amp;</span><span class="ident" id="3310394">OpError</span><span class="op" id="3310401">{</span><span class="ident" id="3310402">Op</span><span class="op" id="3310404">:</span>&nbsp;<span class="string" id="3310406">&#34;listen&#34;</span><span class="op" id="3310414">,</span>&nbsp;<span class="ident" id="3310416">Net</span><span class="op" id="3310419">:</span>&nbsp;<span class="ident" id="3310421">net</span><span class="op" id="3310424">,</span>&nbsp;<span class="ident" id="3310426">Addr</span><span class="op" id="3310430">:</span>&nbsp;<span class="ident" id="3310432">nil</span><span class="op" id="3310435">,</span>&nbsp;<span class="ident" id="3310437">Err</span><span class="op" id="3310440">:</span>&nbsp;<span class="ident" id="3310442">errMissingAddress</span><span class="op" id="3310459">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310465">fd</span><span class="op" id="3310467">,</span>&nbsp;<span class="ident" id="3310469">err</span>&nbsp;<span class="op" id="3310473">:=</span>&nbsp;<span class="ident" id="3310476">internetSocket</span><span class="op" id="3310490">(</span><span class="ident" id="3310491">net</span><span class="op" id="3310494">,</span>&nbsp;<span class="ident" id="3310496">gaddr</span><span class="op" id="3310501">,</span>&nbsp;<span class="ident" id="3310503">nil</span><span class="op" id="3310506">,</span>&nbsp;<span class="ident" id="3310508">noDeadline</span><span class="op" id="3310518">,</span>&nbsp;<span class="ident" id="3310520">syscall</span><span class="op" id="3310527">.</span><span class="ident" id="3310528">SOCK_DGRAM</span><span class="op" id="3310538">,</span>&nbsp;<span class="num" id="3310540">0</span><span class="op" id="3310541">,</span>&nbsp;<span class="string" id="3310543">&#34;listen&#34;</span><span class="op" id="3310551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310554">if</span>&nbsp;<span class="ident" id="3310557">err</span>&nbsp;<span class="op" id="3310561">!=</span>&nbsp;<span class="ident" id="3310564">nil</span>&nbsp;<span class="op" id="3310568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310572">return</span>&nbsp;<span class="ident" id="3310579">nil</span><span class="op" id="3310582">,</span>&nbsp;<span class="op" id="3310584">&amp;</span><span class="ident" id="3310585">OpError</span><span class="op" id="3310592">{</span><span class="ident" id="3310593">Op</span><span class="op" id="3310595">:</span>&nbsp;<span class="string" id="3310597">&#34;listen&#34;</span><span class="op" id="3310605">,</span>&nbsp;<span class="ident" id="3310607">Net</span><span class="op" id="3310610">:</span>&nbsp;<span class="ident" id="3310612">net</span><span class="op" id="3310615">,</span>&nbsp;<span class="ident" id="3310617">Addr</span><span class="op" id="3310621">:</span>&nbsp;<span class="ident" id="3310623">gaddr</span><span class="op" id="3310628">,</span>&nbsp;<span class="ident" id="3310630">Err</span><span class="op" id="3310633">:</span>&nbsp;<span class="ident" id="3310635">err</span><span class="op" id="3310638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310641">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310644">c</span>&nbsp;<span class="op" id="3310646">:=</span>&nbsp;<span class="ident" id="3310649">newUDPConn</span><span class="op" id="3310659">(</span><span class="ident" id="3310660">fd</span><span class="op" id="3310662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310665">if</span>&nbsp;<span class="ident" id="3310668">ip4</span>&nbsp;<span class="op" id="3310672">:=</span>&nbsp;<span class="ident" id="3310675">gaddr</span><span class="op" id="3310680">.</span><span class="ident" id="3310681">IP</span><span class="op" id="3310683">.</span><span class="ident" id="3310684">To4</span><span class="op" id="3310687">(</span><span class="op" id="3310688">)</span><span class="op" id="3310689">;</span>&nbsp;<span class="ident" id="3310691">ip4</span>&nbsp;<span class="op" id="3310695">!=</span>&nbsp;<span class="ident" id="3310698">nil</span>&nbsp;<span class="op" id="3310702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310706">if</span>&nbsp;<span class="ident" id="3310709">err</span>&nbsp;<span class="op" id="3310713">:=</span>&nbsp;<span class="ident" id="3310716">listenIPv4MulticastUDP</span><span class="op" id="3310738">(</span><span class="ident" id="3310739">c</span><span class="op" id="3310740">,</span>&nbsp;<span class="ident" id="3310742">ifi</span><span class="op" id="3310745">,</span>&nbsp;<span class="ident" id="3310747">ip4</span><span class="op" id="3310750">)</span><span class="op" id="3310751">;</span>&nbsp;<span class="ident" id="3310753">err</span>&nbsp;<span class="op" id="3310757">!=</span>&nbsp;<span class="ident" id="3310760">nil</span>&nbsp;<span class="op" id="3310764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310769">c</span><span class="op" id="3310770">.</span><span class="ident" id="3310771">Close</span><span class="op" id="3310776">(</span><span class="op" id="3310777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310782">return</span>&nbsp;<span class="ident" id="3310789">nil</span><span class="op" id="3310792">,</span>&nbsp;<span class="op" id="3310794">&amp;</span><span class="ident" id="3310795">OpError</span><span class="op" id="3310802">{</span><span class="ident" id="3310803">Op</span><span class="op" id="3310805">:</span>&nbsp;<span class="string" id="3310807">&#34;listen&#34;</span><span class="op" id="3310815">,</span>&nbsp;<span class="ident" id="3310817">Net</span><span class="op" id="3310820">:</span>&nbsp;<span class="ident" id="3310822">net</span><span class="op" id="3310825">,</span>&nbsp;<span class="ident" id="3310827">Addr</span><span class="op" id="3310831">:</span>&nbsp;<span class="op" id="3310833">&amp;</span><span class="ident" id="3310834">IPAddr</span><span class="op" id="3310840">{</span><span class="ident" id="3310841">IP</span><span class="op" id="3310843">:</span>&nbsp;<span class="ident" id="3310845">ip4</span><span class="op" id="3310848">}</span><span class="op" id="3310849">,</span>&nbsp;<span class="ident" id="3310851">Err</span><span class="op" id="3310854">:</span>&nbsp;<span class="ident" id="3310856">err</span><span class="op" id="3310859">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3310866">}</span>&nbsp;<span class="keyword" id="3310868">else</span>&nbsp;<span class="op" id="3310873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310877">if</span>&nbsp;<span class="ident" id="3310880">err</span>&nbsp;<span class="op" id="3310884">:=</span>&nbsp;<span class="ident" id="3310887">listenIPv6MulticastUDP</span><span class="op" id="3310909">(</span><span class="ident" id="3310910">c</span><span class="op" id="3310911">,</span>&nbsp;<span class="ident" id="3310913">ifi</span><span class="op" id="3310916">,</span>&nbsp;<span class="ident" id="3310918">gaddr</span><span class="op" id="3310923">.</span><span class="ident" id="3310924">IP</span><span class="op" id="3310926">)</span><span class="op" id="3310927">;</span>&nbsp;<span class="ident" id="3310929">err</span>&nbsp;<span class="op" id="3310933">!=</span>&nbsp;<span class="ident" id="3310936">nil</span>&nbsp;<span class="op" id="3310940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310945">c</span><span class="op" id="3310946">.</span><span class="ident" id="3310947">Close</span><span class="op" id="3310952">(</span><span class="op" id="3310953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3310958">return</span>&nbsp;<span class="ident" id="3310965">nil</span><span class="op" id="3310968">,</span>&nbsp;<span class="op" id="3310970">&amp;</span><span class="ident" id="3310971">OpError</span><span class="op" id="3310978">{</span><span class="ident" id="3310979">Op</span><span class="op" id="3310981">:</span>&nbsp;<span class="string" id="3310983">&#34;listen&#34;</span><span class="op" id="3310991">,</span>&nbsp;<span class="ident" id="3310993">Net</span><span class="op" id="3310996">:</span>&nbsp;<span class="ident" id="3310998">net</span><span class="op" id="3311001">,</span>&nbsp;<span class="ident" id="3311003">Addr</span><span class="op" id="3311007">:</span>&nbsp;<span class="op" id="3311009">&amp;</span><span class="ident" id="3311010">IPAddr</span><span class="op" id="3311016">{</span><span class="ident" id="3311017">IP</span><span class="op" id="3311019">:</span>&nbsp;<span class="ident" id="3311021">gaddr</span><span class="op" id="3311026">.</span><span class="ident" id="3311027">IP</span><span class="op" id="3311029">}</span><span class="op" id="3311030">,</span>&nbsp;<span class="ident" id="3311032">Err</span><span class="op" id="3311035">:</span>&nbsp;<span class="ident" id="3311037">err</span><span class="op" id="3311040">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311050">return</span>&nbsp;<span class="ident" id="3311057">c</span><span class="op" id="3311058">,</span>&nbsp;<span class="ident" id="3311060">nil</span><br>
<span class="lineno"></span><span class="op" id="3311064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3311067">func</span>&nbsp;<span class="ident" id="3311072">listenIPv4MulticastUDP</span><span class="op" id="3311094">(</span><span class="ident" id="3311095">c</span>&nbsp;<span class="op" id="3311097">*</span><span class="ident" id="3311098">UDPConn</span><span class="op" id="3311105">,</span>&nbsp;<span class="ident" id="3311107">ifi</span>&nbsp;<span class="op" id="3311111">*</span><span class="ident" id="3311112">Interface</span><span class="op" id="3311121">,</span>&nbsp;<span class="ident" id="3311123">ip</span>&nbsp;<span class="ident" id="3311126">IP</span><span class="op" id="3311128">)</span>&nbsp;<span class="builtintype" id="3311130">error</span>&nbsp;<span class="op" id="3311136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311139">if</span>&nbsp;<span class="ident" id="3311142">ifi</span>&nbsp;<span class="op" id="3311146">!=</span>&nbsp;<span class="ident" id="3311149">nil</span>&nbsp;<span class="op" id="3311153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311157">if</span>&nbsp;<span class="ident" id="3311160">err</span>&nbsp;<span class="op" id="3311164">:=</span>&nbsp;<span class="ident" id="3311167">setIPv4MulticastInterface</span><span class="op" id="3311192">(</span><span class="ident" id="3311193">c</span><span class="op" id="3311194">.</span><span class="ident" id="3311195">fd</span><span class="op" id="3311197">,</span>&nbsp;<span class="ident" id="3311199">ifi</span><span class="op" id="3311202">)</span><span class="op" id="3311203">;</span>&nbsp;<span class="ident" id="3311205">err</span>&nbsp;<span class="op" id="3311209">!=</span>&nbsp;<span class="ident" id="3311212">nil</span>&nbsp;<span class="op" id="3311216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311221">return</span>&nbsp;<span class="ident" id="3311228">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311234">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311240">if</span>&nbsp;<span class="ident" id="3311243">err</span>&nbsp;<span class="op" id="3311247">:=</span>&nbsp;<span class="ident" id="3311250">setIPv4MulticastLoopback</span><span class="op" id="3311274">(</span><span class="ident" id="3311275">c</span><span class="op" id="3311276">.</span><span class="ident" id="3311277">fd</span><span class="op" id="3311279">,</span>&nbsp;<span class="builtintype" id="3311281">false</span><span class="op" id="3311286">)</span><span class="op" id="3311287">;</span>&nbsp;<span class="ident" id="3311289">err</span>&nbsp;<span class="op" id="3311293">!=</span>&nbsp;<span class="ident" id="3311296">nil</span>&nbsp;<span class="op" id="3311300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311304">return</span>&nbsp;<span class="ident" id="3311311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311319">if</span>&nbsp;<span class="ident" id="3311322">err</span>&nbsp;<span class="op" id="3311326">:=</span>&nbsp;<span class="ident" id="3311329">joinIPv4Group</span><span class="op" id="3311342">(</span><span class="ident" id="3311343">c</span><span class="op" id="3311344">.</span><span class="ident" id="3311345">fd</span><span class="op" id="3311347">,</span>&nbsp;<span class="ident" id="3311349">ifi</span><span class="op" id="3311352">,</span>&nbsp;<span class="ident" id="3311354">ip</span><span class="op" id="3311356">)</span><span class="op" id="3311357">;</span>&nbsp;<span class="ident" id="3311359">err</span>&nbsp;<span class="op" id="3311363">!=</span>&nbsp;<span class="ident" id="3311366">nil</span>&nbsp;<span class="op" id="3311370">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311374">return</span>&nbsp;<span class="ident" id="3311381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311389">return</span>&nbsp;<span class="ident" id="3311396">nil</span><br>
<span class="lineno"></span><span class="op" id="3311400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3311403">func</span>&nbsp;<span class="ident" id="3311408">listenIPv6MulticastUDP</span><span class="op" id="3311430">(</span><span class="ident" id="3311431">c</span>&nbsp;<span class="op" id="3311433">*</span><span class="ident" id="3311434">UDPConn</span><span class="op" id="3311441">,</span>&nbsp;<span class="ident" id="3311443">ifi</span>&nbsp;<span class="op" id="3311447">*</span><span class="ident" id="3311448">Interface</span><span class="op" id="3311457">,</span>&nbsp;<span class="ident" id="3311459">ip</span>&nbsp;<span class="ident" id="3311462">IP</span><span class="op" id="3311464">)</span>&nbsp;<span class="builtintype" id="3311466">error</span>&nbsp;<span class="op" id="3311472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311475">if</span>&nbsp;<span class="ident" id="3311478">ifi</span>&nbsp;<span class="op" id="3311482">!=</span>&nbsp;<span class="ident" id="3311485">nil</span>&nbsp;<span class="op" id="3311489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311493">if</span>&nbsp;<span class="ident" id="3311496">err</span>&nbsp;<span class="op" id="3311500">:=</span>&nbsp;<span class="ident" id="3311503">setIPv6MulticastInterface</span><span class="op" id="3311528">(</span><span class="ident" id="3311529">c</span><span class="op" id="3311530">.</span><span class="ident" id="3311531">fd</span><span class="op" id="3311533">,</span>&nbsp;<span class="ident" id="3311535">ifi</span><span class="op" id="3311538">)</span><span class="op" id="3311539">;</span>&nbsp;<span class="ident" id="3311541">err</span>&nbsp;<span class="op" id="3311545">!=</span>&nbsp;<span class="ident" id="3311548">nil</span>&nbsp;<span class="op" id="3311552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311557">return</span>&nbsp;<span class="ident" id="3311564">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311570">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311576">if</span>&nbsp;<span class="ident" id="3311579">err</span>&nbsp;<span class="op" id="3311583">:=</span>&nbsp;<span class="ident" id="3311586">setIPv6MulticastLoopback</span><span class="op" id="3311610">(</span><span class="ident" id="3311611">c</span><span class="op" id="3311612">.</span><span class="ident" id="3311613">fd</span><span class="op" id="3311615">,</span>&nbsp;<span class="builtintype" id="3311617">false</span><span class="op" id="3311622">)</span><span class="op" id="3311623">;</span>&nbsp;<span class="ident" id="3311625">err</span>&nbsp;<span class="op" id="3311629">!=</span>&nbsp;<span class="ident" id="3311632">nil</span>&nbsp;<span class="op" id="3311636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311640">return</span>&nbsp;<span class="ident" id="3311647">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311655">if</span>&nbsp;<span class="ident" id="3311658">err</span>&nbsp;<span class="op" id="3311662">:=</span>&nbsp;<span class="ident" id="3311665">joinIPv6Group</span><span class="op" id="3311678">(</span><span class="ident" id="3311679">c</span><span class="op" id="3311680">.</span><span class="ident" id="3311681">fd</span><span class="op" id="3311683">,</span>&nbsp;<span class="ident" id="3311685">ifi</span><span class="op" id="3311688">,</span>&nbsp;<span class="ident" id="3311690">ip</span><span class="op" id="3311692">)</span><span class="op" id="3311693">;</span>&nbsp;<span class="ident" id="3311695">err</span>&nbsp;<span class="op" id="3311699">!=</span>&nbsp;<span class="ident" id="3311702">nil</span>&nbsp;<span class="op" id="3311706">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311710">return</span>&nbsp;<span class="ident" id="3311717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311725">return</span>&nbsp;<span class="ident" id="3311732">nil</span><br>
<span class="lineno"></span><span class="op" id="3311736">}</span>
</div>
</body>
</html>
