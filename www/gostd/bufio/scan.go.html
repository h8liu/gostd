<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3466576">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3466631">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3466685">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3466736">package</span>&nbsp;<span class="ident" id="3466744">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3466751">import</span>&nbsp;<span class="op" id="3466758">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3466761">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3466770">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3466780">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3466786">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3466801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466804">//&nbsp;Scanner&nbsp;provides&nbsp;a&nbsp;convenient&nbsp;interface&nbsp;for&nbsp;reading&nbsp;data&nbsp;such&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="3466872">//&nbsp;a&nbsp;file&nbsp;of&nbsp;newline-delimited&nbsp;lines&nbsp;of&nbsp;text.&nbsp;Successive&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3466938">//&nbsp;the&nbsp;Scan&nbsp;method&nbsp;will&nbsp;step&nbsp;through&nbsp;the&nbsp;&#39;tokens&#39;&nbsp;of&nbsp;a&nbsp;file,&nbsp;skipping</span><br>
<span class="lineno"></span><span class="comment" id="3467008">//&nbsp;the&nbsp;bytes&nbsp;between&nbsp;the&nbsp;tokens.&nbsp;The&nbsp;specification&nbsp;of&nbsp;a&nbsp;token&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3467073">//&nbsp;defined&nbsp;by&nbsp;a&nbsp;split&nbsp;function&nbsp;of&nbsp;type&nbsp;SplitFunc;&nbsp;the&nbsp;default&nbsp;split</span><br>
<span class="lineno"></span><span class="comment" id="3467141">//&nbsp;function&nbsp;breaks&nbsp;the&nbsp;input&nbsp;into&nbsp;lines&nbsp;with&nbsp;line&nbsp;termination&nbsp;stripped.&nbsp;Split</span><br>
<span class="lineno">20</span><span class="comment" id="3467219">//&nbsp;functions&nbsp;are&nbsp;defined&nbsp;in&nbsp;this&nbsp;package&nbsp;for&nbsp;scanning&nbsp;a&nbsp;file&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3467285">//&nbsp;lines,&nbsp;bytes,&nbsp;UTF-8-encoded&nbsp;runes,&nbsp;and&nbsp;space-delimited&nbsp;words.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="3467354">//&nbsp;client&nbsp;may&nbsp;instead&nbsp;provide&nbsp;a&nbsp;custom&nbsp;split&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3467409">//</span><br>
<span class="lineno"></span><span class="comment" id="3467412">//&nbsp;Scanning&nbsp;stops&nbsp;unrecoverably&nbsp;at&nbsp;EOF,&nbsp;the&nbsp;first&nbsp;I/O&nbsp;error,&nbsp;or&nbsp;a&nbsp;token&nbsp;too</span><br>
<span class="lineno">25</span><span class="comment" id="3467488">//&nbsp;large&nbsp;to&nbsp;fit&nbsp;in&nbsp;the&nbsp;buffer.&nbsp;When&nbsp;a&nbsp;scan&nbsp;stops,&nbsp;the&nbsp;reader&nbsp;may&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3467558">//&nbsp;advanced&nbsp;arbitrarily&nbsp;far&nbsp;past&nbsp;the&nbsp;last&nbsp;token.&nbsp;Programs&nbsp;that&nbsp;need&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3467631">//&nbsp;control&nbsp;over&nbsp;error&nbsp;handling&nbsp;or&nbsp;large&nbsp;tokens,&nbsp;or&nbsp;must&nbsp;run&nbsp;sequential&nbsp;scans</span><br>
<span class="lineno"></span><span class="comment" id="3467708">//&nbsp;on&nbsp;a&nbsp;reader,&nbsp;should&nbsp;use&nbsp;bufio.Reader&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3467757">//</span><br>
<span class="lineno">30</span><span class="keyword" id="3467760">type</span>&nbsp;<span class="ident" id="3467765">Scanner</span>&nbsp;<span class="keyword" id="3467773">struct</span>&nbsp;<span class="op" id="3467780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467783">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467796">io</span><span class="op" id="3467798">.</span><span class="ident" id="3467799">Reader</span>&nbsp;<span class="comment" id="3467806">//&nbsp;The&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467845">split</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467858">SplitFunc</span>&nbsp;<span class="comment" id="3467868">//&nbsp;The&nbsp;function&nbsp;to&nbsp;split&nbsp;the&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467906">maxTokenSize</span>&nbsp;<span class="builtintype" id="3467919">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3467929">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;a&nbsp;token;&nbsp;modified&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467977">token</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467990">[</span><span class="op" id="3467991">]</span><span class="builtintype" id="3467992">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468000">//&nbsp;Last&nbsp;token&nbsp;returned&nbsp;by&nbsp;split.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468034">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468047">[</span><span class="op" id="3468048">]</span><span class="builtintype" id="3468049">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468057">//&nbsp;Buffer&nbsp;used&nbsp;as&nbsp;argument&nbsp;to&nbsp;split.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468095">start</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3468108">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468118">//&nbsp;First&nbsp;non-processed&nbsp;byte&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468155">end</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3468168">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468178">//&nbsp;End&nbsp;of&nbsp;data&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468202">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3468215">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468225">//&nbsp;Sticky&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468243">empties</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3468256">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468266">//&nbsp;Count&nbsp;of&nbsp;successive&nbsp;empty&nbsp;tokens.</span><br>
<span class="lineno">40</span><span class="op" id="3468303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3468306">//&nbsp;SplitFunc&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;the&nbsp;split&nbsp;function&nbsp;used&nbsp;to&nbsp;tokenize&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3468379">//&nbsp;input.&nbsp;The&nbsp;arguments&nbsp;are&nbsp;an&nbsp;initial&nbsp;substring&nbsp;of&nbsp;the&nbsp;remaining&nbsp;unprocessed</span><br>
<span class="lineno"></span><span class="comment" id="3468457">//&nbsp;data&nbsp;and&nbsp;a&nbsp;flag,&nbsp;atEOF,&nbsp;that&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Reader&nbsp;has&nbsp;no&nbsp;more&nbsp;data</span><br>
<span class="lineno">45</span><span class="comment" id="3468533">//&nbsp;to&nbsp;give.&nbsp;The&nbsp;return&nbsp;values&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;advance&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="3468608">//&nbsp;and&nbsp;the&nbsp;next&nbsp;token&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;user,&nbsp;plus&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3468683">//&nbsp;data&nbsp;does&nbsp;not&nbsp;yet&nbsp;hold&nbsp;a&nbsp;complete&nbsp;token,&nbsp;for&nbsp;instance&nbsp;if&nbsp;it&nbsp;has&nbsp;no&nbsp;newline</span><br>
<span class="lineno"></span><span class="comment" id="3468761">//&nbsp;while&nbsp;scanning&nbsp;lines,&nbsp;SplitFunc&nbsp;can&nbsp;return&nbsp;(0,&nbsp;nil,&nbsp;nil)&nbsp;to&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3468835">//&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;more&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;and&nbsp;try&nbsp;again&nbsp;with&nbsp;a&nbsp;longer&nbsp;slice</span><br>
<span class="lineno">50</span><span class="comment" id="3468913">//&nbsp;starting&nbsp;at&nbsp;the&nbsp;same&nbsp;point&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3468957">//</span><br>
<span class="lineno"></span><span class="comment" id="3468960">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;error&nbsp;is&nbsp;non-nil,&nbsp;scanning&nbsp;stops&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3469026">//&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3469056">//</span><br>
<span class="lineno">55</span><span class="comment" id="3469059">//&nbsp;The&nbsp;function&nbsp;is&nbsp;never&nbsp;called&nbsp;with&nbsp;an&nbsp;empty&nbsp;data&nbsp;slice&nbsp;unless&nbsp;atEOF</span><br>
<span class="lineno"></span><span class="comment" id="3469129">//&nbsp;is&nbsp;true.&nbsp;If&nbsp;atEOF&nbsp;is&nbsp;true,&nbsp;however,&nbsp;data&nbsp;may&nbsp;be&nbsp;non-empty&nbsp;and,</span><br>
<span class="lineno"></span><span class="comment" id="3469195">//&nbsp;as&nbsp;always,&nbsp;holds&nbsp;unprocessed&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3469233">type</span>&nbsp;<span class="ident" id="3469238">SplitFunc</span>&nbsp;<span class="keyword" id="3469248">func</span><span class="op" id="3469252">(</span><span class="ident" id="3469253">data</span>&nbsp;<span class="op" id="3469258">[</span><span class="op" id="3469259">]</span><span class="builtintype" id="3469260">byte</span><span class="op" id="3469264">,</span>&nbsp;<span class="ident" id="3469266">atEOF</span>&nbsp;<span class="builtintype" id="3469272">bool</span><span class="op" id="3469276">)</span>&nbsp;<span class="op" id="3469278">(</span><span class="ident" id="3469279">advance</span>&nbsp;<span class="builtintype" id="3469287">int</span><span class="op" id="3469290">,</span>&nbsp;<span class="ident" id="3469292">token</span>&nbsp;<span class="op" id="3469298">[</span><span class="op" id="3469299">]</span><span class="builtintype" id="3469300">byte</span><span class="op" id="3469304">,</span>&nbsp;<span class="ident" id="3469306">err</span>&nbsp;<span class="builtintype" id="3469310">error</span><span class="op" id="3469315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3469318">//&nbsp;Errors&nbsp;returned&nbsp;by&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="3469349">var</span>&nbsp;<span class="op" id="3469353">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469356">ErrTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469375">=</span>&nbsp;<span class="ident" id="3469377">errors</span><span class="op" id="3469383">.</span><span class="ident" id="3469384">New</span><span class="op" id="3469387">(</span><span class="string" id="3469388">&#34;bufio.Scanner:&nbsp;token&nbsp;too&nbsp;long&#34;</span><span class="op" id="3469419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469422">ErrNegativeAdvance</span>&nbsp;<span class="op" id="3469441">=</span>&nbsp;<span class="ident" id="3469443">errors</span><span class="op" id="3469449">.</span><span class="ident" id="3469450">New</span><span class="op" id="3469453">(</span><span class="string" id="3469454">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;negative&nbsp;advance&nbsp;count&#34;</span><span class="op" id="3469511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469514">ErrAdvanceTooFar</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3469533">=</span>&nbsp;<span class="ident" id="3469535">errors</span><span class="op" id="3469541">.</span><span class="ident" id="3469542">New</span><span class="op" id="3469545">(</span><span class="string" id="3469546">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;advance&nbsp;count&nbsp;beyond&nbsp;input&#34;</span><span class="op" id="3469607">)</span><br>
<span class="lineno">65</span><span class="op" id="3469609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3469612">const</span>&nbsp;<span class="op" id="3469618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3469621">//&nbsp;MaxScanTokenSize&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;used&nbsp;to&nbsp;buffer&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3469686">//&nbsp;The&nbsp;actual&nbsp;maximum&nbsp;token&nbsp;size&nbsp;may&nbsp;be&nbsp;smaller&nbsp;as&nbsp;the&nbsp;buffer</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3469749">//&nbsp;may&nbsp;need&nbsp;to&nbsp;include,&nbsp;for&nbsp;instance,&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469799">MaxScanTokenSize</span>&nbsp;<span class="op" id="3469816">=</span>&nbsp;<span class="num" id="3469818">64</span>&nbsp;<span class="op" id="3469821">*</span>&nbsp;<span class="num" id="3469823">1024</span><br>
<span class="lineno"></span><span class="op" id="3469828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469831">//&nbsp;NewScanner&nbsp;returns&nbsp;a&nbsp;new&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno">75</span><span class="comment" id="3469883">//&nbsp;The&nbsp;split&nbsp;function&nbsp;defaults&nbsp;to&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="3469928">func</span>&nbsp;<span class="ident" id="3469933">NewScanner</span><span class="op" id="3469943">(</span><span class="ident" id="3469944">r</span>&nbsp;<span class="ident" id="3469946">io</span><span class="op" id="3469948">.</span><span class="ident" id="3469949">Reader</span><span class="op" id="3469955">)</span>&nbsp;<span class="op" id="3469957">*</span><span class="ident" id="3469958">Scanner</span>&nbsp;<span class="op" id="3469966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469969">return</span>&nbsp;<span class="op" id="3469976">&amp;</span><span class="ident" id="3469977">Scanner</span><span class="op" id="3469984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469988">r</span><span class="op" id="3469989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470002">r</span><span class="op" id="3470003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470007">split</span><span class="op" id="3470012">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470021">ScanLines</span><span class="op" id="3470030">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470034">maxTokenSize</span><span class="op" id="3470046">:</span>&nbsp;<span class="ident" id="3470048">MaxScanTokenSize</span><span class="op" id="3470064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470068">buf</span><span class="op" id="3470071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3470082">make</span><span class="op" id="3470086">(</span><span class="op" id="3470087">[</span><span class="op" id="3470088">]</span><span class="builtintype" id="3470089">byte</span><span class="op" id="3470093">,</span>&nbsp;<span class="num" id="3470095">4096</span><span class="op" id="3470099">)</span><span class="op" id="3470100">,</span>&nbsp;<span class="comment" id="3470102">//&nbsp;Plausible&nbsp;starting&nbsp;size;&nbsp;needn&#39;t&nbsp;be&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470149">}</span><br>
<span class="lineno"></span><span class="op" id="3470151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="3470154">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;first&nbsp;non-EOF&nbsp;error&nbsp;that&nbsp;was&nbsp;encountered&nbsp;by&nbsp;the&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="3470230">func</span>&nbsp;<span class="op" id="3470235">(</span><span class="ident" id="3470236">s</span>&nbsp;<span class="op" id="3470238">*</span><span class="ident" id="3470239">Scanner</span><span class="op" id="3470246">)</span>&nbsp;<span class="ident" id="3470248">Err</span><span class="op" id="3470251">(</span><span class="op" id="3470252">)</span>&nbsp;<span class="builtintype" id="3470254">error</span>&nbsp;<span class="op" id="3470260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470263">if</span>&nbsp;<span class="ident" id="3470266">s</span><span class="op" id="3470267">.</span><span class="ident" id="3470268">err</span>&nbsp;<span class="op" id="3470272">==</span>&nbsp;<span class="ident" id="3470275">io</span><span class="op" id="3470277">.</span><span class="ident" id="3470278">EOF</span>&nbsp;<span class="op" id="3470282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470286">return</span>&nbsp;<span class="builtintype" id="3470293">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470298">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470301">return</span>&nbsp;<span class="ident" id="3470308">s</span><span class="op" id="3470309">.</span><span class="ident" id="3470310">err</span><br>
<span class="lineno"></span><span class="op" id="3470314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470317">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="comment" id="3470385">//&nbsp;The&nbsp;underlying&nbsp;array&nbsp;may&nbsp;point&nbsp;to&nbsp;data&nbsp;that&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno">95</span><span class="comment" id="3470452">//&nbsp;by&nbsp;a&nbsp;subsequent&nbsp;call&nbsp;to&nbsp;Scan.&nbsp;It&nbsp;does&nbsp;no&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3470508">func</span>&nbsp;<span class="op" id="3470513">(</span><span class="ident" id="3470514">s</span>&nbsp;<span class="op" id="3470516">*</span><span class="ident" id="3470517">Scanner</span><span class="op" id="3470524">)</span>&nbsp;<span class="ident" id="3470526">Bytes</span><span class="op" id="3470531">(</span><span class="op" id="3470532">)</span>&nbsp;<span class="op" id="3470534">[</span><span class="op" id="3470535">]</span><span class="builtintype" id="3470536">byte</span>&nbsp;<span class="op" id="3470541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470544">return</span>&nbsp;<span class="ident" id="3470551">s</span><span class="op" id="3470552">.</span><span class="ident" id="3470553">token</span><br>
<span class="lineno"></span><span class="op" id="3470559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3470562">//&nbsp;Text&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan</span><br>
<span class="lineno"></span><span class="comment" id="3470628">//&nbsp;as&nbsp;a&nbsp;newly&nbsp;allocated&nbsp;string&nbsp;holding&nbsp;its&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3470678">func</span>&nbsp;<span class="op" id="3470683">(</span><span class="ident" id="3470684">s</span>&nbsp;<span class="op" id="3470686">*</span><span class="ident" id="3470687">Scanner</span><span class="op" id="3470694">)</span>&nbsp;<span class="ident" id="3470696">Text</span><span class="op" id="3470700">(</span><span class="op" id="3470701">)</span>&nbsp;<span class="builtintype" id="3470703">string</span>&nbsp;<span class="op" id="3470710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470713">return</span>&nbsp;<span class="builtintype" id="3470720">string</span><span class="op" id="3470726">(</span><span class="ident" id="3470727">s</span><span class="op" id="3470728">.</span><span class="ident" id="3470729">token</span><span class="op" id="3470734">)</span><br>
<span class="lineno"></span><span class="op" id="3470736">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3470739">//&nbsp;Scan&nbsp;advances&nbsp;the&nbsp;Scanner&nbsp;to&nbsp;the&nbsp;next&nbsp;token,&nbsp;which&nbsp;will&nbsp;then&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3470806">//&nbsp;available&nbsp;through&nbsp;the&nbsp;Bytes&nbsp;or&nbsp;Text&nbsp;method.&nbsp;It&nbsp;returns&nbsp;false&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3470879">//&nbsp;scan&nbsp;stops,&nbsp;either&nbsp;by&nbsp;reaching&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;or&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3470947">//&nbsp;After&nbsp;Scan&nbsp;returns&nbsp;false,&nbsp;the&nbsp;Err&nbsp;method&nbsp;will&nbsp;return&nbsp;any&nbsp;error&nbsp;that</span><br>
<span class="lineno">110</span><span class="comment" id="3471018">//&nbsp;occurred&nbsp;during&nbsp;scanning,&nbsp;except&nbsp;that&nbsp;if&nbsp;it&nbsp;was&nbsp;io.EOF,&nbsp;Err</span><br>
<span class="lineno"></span><span class="comment" id="3471081">//&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3471101">//&nbsp;Split&nbsp;panics&nbsp;if&nbsp;the&nbsp;split&nbsp;function&nbsp;returns&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="3471172">//&nbsp;advancing&nbsp;the&nbsp;input.&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;error&nbsp;mode&nbsp;for&nbsp;scanners.</span><br>
<span class="lineno"></span><span class="keyword" id="3471238">func</span>&nbsp;<span class="op" id="3471243">(</span><span class="ident" id="3471244">s</span>&nbsp;<span class="op" id="3471246">*</span><span class="ident" id="3471247">Scanner</span><span class="op" id="3471254">)</span>&nbsp;<span class="ident" id="3471256">Scan</span><span class="op" id="3471260">(</span><span class="op" id="3471261">)</span>&nbsp;<span class="builtintype" id="3471263">bool</span>&nbsp;<span class="op" id="3471268">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471271">//&nbsp;Loop&nbsp;until&nbsp;we&nbsp;have&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471303">for</span>&nbsp;<span class="op" id="3471307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471311">//&nbsp;See&nbsp;if&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;already&nbsp;have.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471369">//&nbsp;If&nbsp;we&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;data&nbsp;but&nbsp;have&nbsp;an&nbsp;error,&nbsp;give&nbsp;the&nbsp;split&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471442">//&nbsp;a&nbsp;chance&nbsp;to&nbsp;recover&nbsp;any&nbsp;remaining,&nbsp;possibly&nbsp;empty&nbsp;token.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471504">if</span>&nbsp;<span class="ident" id="3471507">s</span><span class="op" id="3471508">.</span><span class="ident" id="3471509">end</span>&nbsp;<span class="op" id="3471513">&gt;</span>&nbsp;<span class="ident" id="3471515">s</span><span class="op" id="3471516">.</span><span class="ident" id="3471517">start</span>&nbsp;<span class="op" id="3471523">||</span>&nbsp;<span class="ident" id="3471526">s</span><span class="op" id="3471527">.</span><span class="ident" id="3471528">err</span>&nbsp;<span class="op" id="3471532">!=</span>&nbsp;<span class="builtintype" id="3471535">nil</span>&nbsp;<span class="op" id="3471539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471544">advance</span><span class="op" id="3471551">,</span>&nbsp;<span class="ident" id="3471553">token</span><span class="op" id="3471558">,</span>&nbsp;<span class="ident" id="3471560">err</span>&nbsp;<span class="op" id="3471564">:=</span>&nbsp;<span class="ident" id="3471567">s</span><span class="op" id="3471568">.</span><span class="ident" id="3471569">split</span><span class="op" id="3471574">(</span><span class="ident" id="3471575">s</span><span class="op" id="3471576">.</span><span class="ident" id="3471577">buf</span><span class="op" id="3471580">[</span><span class="ident" id="3471581">s</span><span class="op" id="3471582">.</span><span class="ident" id="3471583">start</span><span class="op" id="3471588">:</span><span class="ident" id="3471589">s</span><span class="op" id="3471590">.</span><span class="ident" id="3471591">end</span><span class="op" id="3471594">]</span><span class="op" id="3471595">,</span>&nbsp;<span class="ident" id="3471597">s</span><span class="op" id="3471598">.</span><span class="ident" id="3471599">err</span>&nbsp;<span class="op" id="3471603">!=</span>&nbsp;<span class="builtintype" id="3471606">nil</span><span class="op" id="3471609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471614">if</span>&nbsp;<span class="ident" id="3471617">err</span>&nbsp;<span class="op" id="3471621">!=</span>&nbsp;<span class="builtintype" id="3471624">nil</span>&nbsp;<span class="op" id="3471628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471634">s</span><span class="op" id="3471635">.</span><span class="ident" id="3471636">setErr</span><span class="op" id="3471642">(</span><span class="ident" id="3471643">err</span><span class="op" id="3471646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471652">return</span>&nbsp;<span class="builtintype" id="3471659">false</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471673">if</span>&nbsp;<span class="op" id="3471676">!</span><span class="ident" id="3471677">s</span><span class="op" id="3471678">.</span><span class="ident" id="3471679">advance</span><span class="op" id="3471686">(</span><span class="ident" id="3471687">advance</span><span class="op" id="3471694">)</span>&nbsp;<span class="op" id="3471696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471702">return</span>&nbsp;<span class="builtintype" id="3471709">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471723">s</span><span class="op" id="3471724">.</span><span class="ident" id="3471725">token</span>&nbsp;<span class="op" id="3471731">=</span>&nbsp;<span class="ident" id="3471733">token</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471742">if</span>&nbsp;<span class="ident" id="3471745">token</span>&nbsp;<span class="op" id="3471751">!=</span>&nbsp;<span class="builtintype" id="3471754">nil</span>&nbsp;<span class="op" id="3471758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471764">if</span>&nbsp;<span class="ident" id="3471767">s</span><span class="op" id="3471768">.</span><span class="ident" id="3471769">err</span>&nbsp;<span class="op" id="3471773">==</span>&nbsp;<span class="builtintype" id="3471776">nil</span>&nbsp;<span class="op" id="3471780">||</span>&nbsp;<span class="ident" id="3471783">advance</span>&nbsp;<span class="op" id="3471791">&gt;</span>&nbsp;<span class="num" id="3471793">0</span>&nbsp;<span class="op" id="3471795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471802">s</span><span class="op" id="3471803">.</span><span class="ident" id="3471804">empties</span>&nbsp;<span class="op" id="3471812">=</span>&nbsp;<span class="num" id="3471814">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471820">}</span>&nbsp;<span class="keyword" id="3471822">else</span>&nbsp;<span class="op" id="3471827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471834">//&nbsp;Returning&nbsp;tokens&nbsp;not&nbsp;advancing&nbsp;input&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471887">s</span><span class="op" id="3471888">.</span><span class="ident" id="3471889">empties</span><span class="op" id="3471896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471904">if</span>&nbsp;<span class="ident" id="3471907">s</span><span class="op" id="3471908">.</span><span class="ident" id="3471909">empties</span>&nbsp;<span class="op" id="3471917">&gt;</span>&nbsp;<span class="num" id="3471919">100</span>&nbsp;<span class="op" id="3471923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3471931">panic</span><span class="op" id="3471936">(</span><span class="string" id="3471937">&#34;bufio.Scan:&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without&nbsp;progressing&#34;</span><span class="op" id="3471987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472000">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472006">return</span>&nbsp;<span class="builtintype" id="3472013">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472029">//&nbsp;We&nbsp;cannot&nbsp;generate&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;are&nbsp;holding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472087">//&nbsp;If&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;EOF&nbsp;or&nbsp;an&nbsp;I/O&nbsp;error,&nbsp;we&nbsp;are&nbsp;done.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472147">if</span>&nbsp;<span class="ident" id="3472150">s</span><span class="op" id="3472151">.</span><span class="ident" id="3472152">err</span>&nbsp;<span class="op" id="3472156">!=</span>&nbsp;<span class="builtintype" id="3472159">nil</span>&nbsp;<span class="op" id="3472163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472168">//&nbsp;Shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472188">s</span><span class="op" id="3472189">.</span><span class="ident" id="3472190">start</span>&nbsp;<span class="op" id="3472196">=</span>&nbsp;<span class="num" id="3472198">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472203">s</span><span class="op" id="3472204">.</span><span class="ident" id="3472205">end</span>&nbsp;<span class="op" id="3472209">=</span>&nbsp;<span class="num" id="3472211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472216">return</span>&nbsp;<span class="builtintype" id="3472223">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472235">//&nbsp;Must&nbsp;read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472261">//&nbsp;First,&nbsp;shift&nbsp;data&nbsp;to&nbsp;beginning&nbsp;of&nbsp;buffer&nbsp;if&nbsp;there&#39;s&nbsp;lots&nbsp;of&nbsp;empty&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472338">//&nbsp;or&nbsp;space&nbsp;is&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472363">if</span>&nbsp;<span class="ident" id="3472366">s</span><span class="op" id="3472367">.</span><span class="ident" id="3472368">start</span>&nbsp;<span class="op" id="3472374">&gt;</span>&nbsp;<span class="num" id="3472376">0</span>&nbsp;<span class="op" id="3472378">&amp;&amp;</span>&nbsp;<span class="op" id="3472381">(</span><span class="ident" id="3472382">s</span><span class="op" id="3472383">.</span><span class="ident" id="3472384">end</span>&nbsp;<span class="op" id="3472388">==</span>&nbsp;<span class="builtinfunc" id="3472391">len</span><span class="op" id="3472394">(</span><span class="ident" id="3472395">s</span><span class="op" id="3472396">.</span><span class="ident" id="3472397">buf</span><span class="op" id="3472400">)</span>&nbsp;<span class="op" id="3472402">||</span>&nbsp;<span class="ident" id="3472405">s</span><span class="op" id="3472406">.</span><span class="ident" id="3472407">start</span>&nbsp;<span class="op" id="3472413">&gt;</span>&nbsp;<span class="builtinfunc" id="3472415">len</span><span class="op" id="3472418">(</span><span class="ident" id="3472419">s</span><span class="op" id="3472420">.</span><span class="ident" id="3472421">buf</span><span class="op" id="3472424">)</span><span class="op" id="3472425">/</span><span class="num" id="3472426">2</span><span class="op" id="3472427">)</span>&nbsp;<span class="op" id="3472429">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3472434">copy</span><span class="op" id="3472438">(</span><span class="ident" id="3472439">s</span><span class="op" id="3472440">.</span><span class="ident" id="3472441">buf</span><span class="op" id="3472444">,</span>&nbsp;<span class="ident" id="3472446">s</span><span class="op" id="3472447">.</span><span class="ident" id="3472448">buf</span><span class="op" id="3472451">[</span><span class="ident" id="3472452">s</span><span class="op" id="3472453">.</span><span class="ident" id="3472454">start</span><span class="op" id="3472459">:</span><span class="ident" id="3472460">s</span><span class="op" id="3472461">.</span><span class="ident" id="3472462">end</span><span class="op" id="3472465">]</span><span class="op" id="3472466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472471">s</span><span class="op" id="3472472">.</span><span class="ident" id="3472473">end</span>&nbsp;<span class="op" id="3472477">-=</span>&nbsp;<span class="ident" id="3472480">s</span><span class="op" id="3472481">.</span><span class="ident" id="3472482">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472491">s</span><span class="op" id="3472492">.</span><span class="ident" id="3472493">start</span>&nbsp;<span class="op" id="3472499">=</span>&nbsp;<span class="num" id="3472501">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472509">//&nbsp;Is&nbsp;the&nbsp;buffer&nbsp;full?&nbsp;If&nbsp;so,&nbsp;resize.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472549">if</span>&nbsp;<span class="ident" id="3472552">s</span><span class="op" id="3472553">.</span><span class="ident" id="3472554">end</span>&nbsp;<span class="op" id="3472558">==</span>&nbsp;<span class="builtinfunc" id="3472561">len</span><span class="op" id="3472564">(</span><span class="ident" id="3472565">s</span><span class="op" id="3472566">.</span><span class="ident" id="3472567">buf</span><span class="op" id="3472570">)</span>&nbsp;<span class="op" id="3472572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472577">if</span>&nbsp;<span class="builtinfunc" id="3472580">len</span><span class="op" id="3472583">(</span><span class="ident" id="3472584">s</span><span class="op" id="3472585">.</span><span class="ident" id="3472586">buf</span><span class="op" id="3472589">)</span>&nbsp;<span class="op" id="3472591">&gt;=</span>&nbsp;<span class="ident" id="3472594">s</span><span class="op" id="3472595">.</span><span class="ident" id="3472596">maxTokenSize</span>&nbsp;<span class="op" id="3472609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472615">s</span><span class="op" id="3472616">.</span><span class="ident" id="3472617">setErr</span><span class="op" id="3472623">(</span><span class="ident" id="3472624">ErrTooLong</span><span class="op" id="3472634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472640">return</span>&nbsp;<span class="builtintype" id="3472647">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472656">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472661">newSize</span>&nbsp;<span class="op" id="3472669">:=</span>&nbsp;<span class="builtinfunc" id="3472672">len</span><span class="op" id="3472675">(</span><span class="ident" id="3472676">s</span><span class="op" id="3472677">.</span><span class="ident" id="3472678">buf</span><span class="op" id="3472681">)</span>&nbsp;<span class="op" id="3472683">*</span>&nbsp;<span class="num" id="3472685">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472690">if</span>&nbsp;<span class="ident" id="3472693">newSize</span>&nbsp;<span class="op" id="3472701">&gt;</span>&nbsp;<span class="ident" id="3472703">s</span><span class="op" id="3472704">.</span><span class="ident" id="3472705">maxTokenSize</span>&nbsp;<span class="op" id="3472718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472724">newSize</span>&nbsp;<span class="op" id="3472732">=</span>&nbsp;<span class="ident" id="3472734">s</span><span class="op" id="3472735">.</span><span class="ident" id="3472736">maxTokenSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472757">newBuf</span>&nbsp;<span class="op" id="3472764">:=</span>&nbsp;<span class="builtinfunc" id="3472767">make</span><span class="op" id="3472771">(</span><span class="op" id="3472772">[</span><span class="op" id="3472773">]</span><span class="builtintype" id="3472774">byte</span><span class="op" id="3472778">,</span>&nbsp;<span class="ident" id="3472780">newSize</span><span class="op" id="3472787">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3472792">copy</span><span class="op" id="3472796">(</span><span class="ident" id="3472797">newBuf</span><span class="op" id="3472803">,</span>&nbsp;<span class="ident" id="3472805">s</span><span class="op" id="3472806">.</span><span class="ident" id="3472807">buf</span><span class="op" id="3472810">[</span><span class="ident" id="3472811">s</span><span class="op" id="3472812">.</span><span class="ident" id="3472813">start</span><span class="op" id="3472818">:</span><span class="ident" id="3472819">s</span><span class="op" id="3472820">.</span><span class="ident" id="3472821">end</span><span class="op" id="3472824">]</span><span class="op" id="3472825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472830">s</span><span class="op" id="3472831">.</span><span class="ident" id="3472832">buf</span>&nbsp;<span class="op" id="3472836">=</span>&nbsp;<span class="ident" id="3472838">newBuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472848">s</span><span class="op" id="3472849">.</span><span class="ident" id="3472850">end</span>&nbsp;<span class="op" id="3472854">-=</span>&nbsp;<span class="ident" id="3472857">s</span><span class="op" id="3472858">.</span><span class="ident" id="3472859">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472868">s</span><span class="op" id="3472869">.</span><span class="ident" id="3472870">start</span>&nbsp;<span class="op" id="3472876">=</span>&nbsp;<span class="num" id="3472878">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472883">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472898">//&nbsp;Finally&nbsp;we&nbsp;can&nbsp;read&nbsp;some&nbsp;input.&nbsp;Make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;stuck&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472969">//&nbsp;a&nbsp;misbehaving&nbsp;Reader.&nbsp;Officially&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;do&nbsp;this,&nbsp;but&nbsp;let&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473043">//&nbsp;be&nbsp;extra&nbsp;careful:&nbsp;Scanner&nbsp;is&nbsp;for&nbsp;safe,&nbsp;simple&nbsp;jobs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473100">for</span>&nbsp;<span class="ident" id="3473104">loop</span>&nbsp;<span class="op" id="3473109">:=</span>&nbsp;<span class="num" id="3473112">0</span><span class="op" id="3473113">;</span>&nbsp;<span class="op" id="3473115">;</span>&nbsp;<span class="op" id="3473117">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473122">n</span><span class="op" id="3473123">,</span>&nbsp;<span class="ident" id="3473125">err</span>&nbsp;<span class="op" id="3473129">:=</span>&nbsp;<span class="ident" id="3473132">s</span><span class="op" id="3473133">.</span><span class="ident" id="3473134">r</span><span class="op" id="3473135">.</span><span class="ident" id="3473136">Read</span><span class="op" id="3473140">(</span><span class="ident" id="3473141">s</span><span class="op" id="3473142">.</span><span class="ident" id="3473143">buf</span><span class="op" id="3473146">[</span><span class="ident" id="3473147">s</span><span class="op" id="3473148">.</span><span class="ident" id="3473149">end</span><span class="op" id="3473152">:</span><span class="builtinfunc" id="3473153">len</span><span class="op" id="3473156">(</span><span class="ident" id="3473157">s</span><span class="op" id="3473158">.</span><span class="ident" id="3473159">buf</span><span class="op" id="3473162">)</span><span class="op" id="3473163">]</span><span class="op" id="3473164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473169">s</span><span class="op" id="3473170">.</span><span class="ident" id="3473171">end</span>&nbsp;<span class="op" id="3473175">+=</span>&nbsp;<span class="ident" id="3473178">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473183">if</span>&nbsp;<span class="ident" id="3473186">err</span>&nbsp;<span class="op" id="3473190">!=</span>&nbsp;<span class="builtintype" id="3473193">nil</span>&nbsp;<span class="op" id="3473197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473203">s</span><span class="op" id="3473204">.</span><span class="ident" id="3473205">setErr</span><span class="op" id="3473211">(</span><span class="ident" id="3473212">err</span><span class="op" id="3473215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473221">break</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473235">if</span>&nbsp;<span class="ident" id="3473238">n</span>&nbsp;<span class="op" id="3473240">&gt;</span>&nbsp;<span class="num" id="3473242">0</span>&nbsp;<span class="op" id="3473244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473250">s</span><span class="op" id="3473251">.</span><span class="ident" id="3473252">empties</span>&nbsp;<span class="op" id="3473260">=</span>&nbsp;<span class="num" id="3473262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473268">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473277">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473282">loop</span><span class="op" id="3473286">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473292">if</span>&nbsp;<span class="ident" id="3473295">loop</span>&nbsp;<span class="op" id="3473300">&gt;</span>&nbsp;<span class="ident" id="3473302">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3473327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473333">s</span><span class="op" id="3473334">.</span><span class="ident" id="3473335">setErr</span><span class="op" id="3473341">(</span><span class="ident" id="3473342">io</span><span class="op" id="3473344">.</span><span class="ident" id="3473345">ErrNoProgress</span><span class="op" id="3473358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473364">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473373">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473380">}</span><br>
<span class="lineno"></span><span class="op" id="3473382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3473385">//&nbsp;advance&nbsp;consumes&nbsp;n&nbsp;bytes&nbsp;of&nbsp;the&nbsp;buffer.&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;advance&nbsp;was&nbsp;legal.</span><br>
<span class="lineno">200</span><span class="keyword" id="3473470">func</span>&nbsp;<span class="op" id="3473475">(</span><span class="ident" id="3473476">s</span>&nbsp;<span class="op" id="3473478">*</span><span class="ident" id="3473479">Scanner</span><span class="op" id="3473486">)</span>&nbsp;<span class="ident" id="3473488">advance</span><span class="op" id="3473495">(</span><span class="ident" id="3473496">n</span>&nbsp;<span class="builtintype" id="3473498">int</span><span class="op" id="3473501">)</span>&nbsp;<span class="builtintype" id="3473503">bool</span>&nbsp;<span class="op" id="3473508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473511">if</span>&nbsp;<span class="ident" id="3473514">n</span>&nbsp;<span class="op" id="3473516">&lt;</span>&nbsp;<span class="num" id="3473518">0</span>&nbsp;<span class="op" id="3473520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473524">s</span><span class="op" id="3473525">.</span><span class="ident" id="3473526">setErr</span><span class="op" id="3473532">(</span><span class="ident" id="3473533">ErrNegativeAdvance</span><span class="op" id="3473551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473555">return</span>&nbsp;<span class="builtintype" id="3473562">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473569">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473572">if</span>&nbsp;<span class="ident" id="3473575">n</span>&nbsp;<span class="op" id="3473577">&gt;</span>&nbsp;<span class="ident" id="3473579">s</span><span class="op" id="3473580">.</span><span class="ident" id="3473581">end</span><span class="op" id="3473584">-</span><span class="ident" id="3473585">s</span><span class="op" id="3473586">.</span><span class="ident" id="3473587">start</span>&nbsp;<span class="op" id="3473593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473597">s</span><span class="op" id="3473598">.</span><span class="ident" id="3473599">setErr</span><span class="op" id="3473605">(</span><span class="ident" id="3473606">ErrAdvanceTooFar</span><span class="op" id="3473622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473626">return</span>&nbsp;<span class="builtintype" id="3473633">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473643">s</span><span class="op" id="3473644">.</span><span class="ident" id="3473645">start</span>&nbsp;<span class="op" id="3473651">+=</span>&nbsp;<span class="ident" id="3473654">n</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473657">return</span>&nbsp;<span class="builtintype" id="3473664">true</span><br>
<span class="lineno"></span><span class="op" id="3473669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3473672">//&nbsp;setErr&nbsp;records&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="3473719">func</span>&nbsp;<span class="op" id="3473724">(</span><span class="ident" id="3473725">s</span>&nbsp;<span class="op" id="3473727">*</span><span class="ident" id="3473728">Scanner</span><span class="op" id="3473735">)</span>&nbsp;<span class="ident" id="3473737">setErr</span><span class="op" id="3473743">(</span><span class="ident" id="3473744">err</span>&nbsp;<span class="builtintype" id="3473748">error</span><span class="op" id="3473753">)</span>&nbsp;<span class="op" id="3473755">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473758">if</span>&nbsp;<span class="ident" id="3473761">s</span><span class="op" id="3473762">.</span><span class="ident" id="3473763">err</span>&nbsp;<span class="op" id="3473767">==</span>&nbsp;<span class="builtintype" id="3473770">nil</span>&nbsp;<span class="op" id="3473774">||</span>&nbsp;<span class="ident" id="3473777">s</span><span class="op" id="3473778">.</span><span class="ident" id="3473779">err</span>&nbsp;<span class="op" id="3473783">==</span>&nbsp;<span class="ident" id="3473786">io</span><span class="op" id="3473788">.</span><span class="ident" id="3473789">EOF</span>&nbsp;<span class="op" id="3473793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473797">s</span><span class="op" id="3473798">.</span><span class="ident" id="3473799">err</span>&nbsp;<span class="op" id="3473803">=</span>&nbsp;<span class="ident" id="3473805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473810">}</span><br>
<span class="lineno"></span><span class="op" id="3473812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3473815">//&nbsp;Split&nbsp;sets&nbsp;the&nbsp;split&nbsp;function&nbsp;for&nbsp;the&nbsp;Scanner.&nbsp;If&nbsp;called,&nbsp;it&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3473887">//&nbsp;called&nbsp;before&nbsp;Scan.&nbsp;The&nbsp;default&nbsp;split&nbsp;function&nbsp;is&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="3473951">func</span>&nbsp;<span class="op" id="3473956">(</span><span class="ident" id="3473957">s</span>&nbsp;<span class="op" id="3473959">*</span><span class="ident" id="3473960">Scanner</span><span class="op" id="3473967">)</span>&nbsp;<span class="ident" id="3473969">Split</span><span class="op" id="3473974">(</span><span class="ident" id="3473975">split</span>&nbsp;<span class="ident" id="3473981">SplitFunc</span><span class="op" id="3473990">)</span>&nbsp;<span class="op" id="3473992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473995">s</span><span class="op" id="3473996">.</span><span class="ident" id="3473997">split</span>&nbsp;<span class="op" id="3474003">=</span>&nbsp;<span class="ident" id="3474005">split</span><br>
<span class="lineno"></span><span class="op" id="3474011">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3474014">//&nbsp;Split&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3474034">//&nbsp;ScanBytes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;byte&nbsp;as&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3474116">func</span>&nbsp;<span class="ident" id="3474121">ScanBytes</span><span class="op" id="3474130">(</span><span class="ident" id="3474131">data</span>&nbsp;<span class="op" id="3474136">[</span><span class="op" id="3474137">]</span><span class="builtintype" id="3474138">byte</span><span class="op" id="3474142">,</span>&nbsp;<span class="ident" id="3474144">atEOF</span>&nbsp;<span class="builtintype" id="3474150">bool</span><span class="op" id="3474154">)</span>&nbsp;<span class="op" id="3474156">(</span><span class="ident" id="3474157">advance</span>&nbsp;<span class="builtintype" id="3474165">int</span><span class="op" id="3474168">,</span>&nbsp;<span class="ident" id="3474170">token</span>&nbsp;<span class="op" id="3474176">[</span><span class="op" id="3474177">]</span><span class="builtintype" id="3474178">byte</span><span class="op" id="3474182">,</span>&nbsp;<span class="ident" id="3474184">err</span>&nbsp;<span class="builtintype" id="3474188">error</span><span class="op" id="3474193">)</span>&nbsp;<span class="op" id="3474195">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474198">if</span>&nbsp;<span class="ident" id="3474201">atEOF</span>&nbsp;<span class="op" id="3474207">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3474210">len</span><span class="op" id="3474213">(</span><span class="ident" id="3474214">data</span><span class="op" id="3474218">)</span>&nbsp;<span class="op" id="3474220">==</span>&nbsp;<span class="num" id="3474223">0</span>&nbsp;<span class="op" id="3474225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474229">return</span>&nbsp;<span class="num" id="3474236">0</span><span class="op" id="3474237">,</span>&nbsp;<span class="builtintype" id="3474239">nil</span><span class="op" id="3474242">,</span>&nbsp;<span class="builtintype" id="3474244">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474252">return</span>&nbsp;<span class="num" id="3474259">1</span><span class="op" id="3474260">,</span>&nbsp;<span class="ident" id="3474262">data</span><span class="op" id="3474266">[</span><span class="num" id="3474267">0</span><span class="op" id="3474268">:</span><span class="num" id="3474269">1</span><span class="op" id="3474270">]</span><span class="op" id="3474271">,</span>&nbsp;<span class="builtintype" id="3474273">nil</span><br>
<span class="lineno"></span><span class="op" id="3474277">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="3474280">var</span>&nbsp;<span class="ident" id="3474284">errorRune</span>&nbsp;<span class="op" id="3474294">=</span>&nbsp;<span class="op" id="3474296">[</span><span class="op" id="3474297">]</span><span class="builtintype" id="3474298">byte</span><span class="op" id="3474302">(</span><span class="builtintype" id="3474303">string</span><span class="op" id="3474309">(</span><span class="ident" id="3474310">utf8</span><span class="op" id="3474314">.</span><span class="ident" id="3474315">RuneError</span><span class="op" id="3474324">)</span><span class="op" id="3474325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3474328">//&nbsp;ScanRunes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="3474393">//&nbsp;UTF-8-encoded&nbsp;rune&nbsp;as&nbsp;a&nbsp;token.&nbsp;The&nbsp;sequence&nbsp;of&nbsp;runes&nbsp;returned&nbsp;is</span><br>
<span class="lineno">240</span><span class="comment" id="3474461">//&nbsp;equivalent&nbsp;to&nbsp;that&nbsp;from&nbsp;a&nbsp;range&nbsp;loop&nbsp;over&nbsp;the&nbsp;input&nbsp;as&nbsp;a&nbsp;string,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="3474535">//&nbsp;means&nbsp;that&nbsp;erroneous&nbsp;UTF-8&nbsp;encodings&nbsp;translate&nbsp;to&nbsp;U+FFFD&nbsp;=&nbsp;&#34;\xef\xbf\xbd&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3474613">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;Scan&nbsp;interface,&nbsp;this&nbsp;makes&nbsp;it&nbsp;impossible&nbsp;for&nbsp;the&nbsp;client&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3474690">//&nbsp;distinguish&nbsp;correctly&nbsp;encoded&nbsp;replacement&nbsp;runes&nbsp;from&nbsp;encoding&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3474763">func</span>&nbsp;<span class="ident" id="3474768">ScanRunes</span><span class="op" id="3474777">(</span><span class="ident" id="3474778">data</span>&nbsp;<span class="op" id="3474783">[</span><span class="op" id="3474784">]</span><span class="builtintype" id="3474785">byte</span><span class="op" id="3474789">,</span>&nbsp;<span class="ident" id="3474791">atEOF</span>&nbsp;<span class="builtintype" id="3474797">bool</span><span class="op" id="3474801">)</span>&nbsp;<span class="op" id="3474803">(</span><span class="ident" id="3474804">advance</span>&nbsp;<span class="builtintype" id="3474812">int</span><span class="op" id="3474815">,</span>&nbsp;<span class="ident" id="3474817">token</span>&nbsp;<span class="op" id="3474823">[</span><span class="op" id="3474824">]</span><span class="builtintype" id="3474825">byte</span><span class="op" id="3474829">,</span>&nbsp;<span class="ident" id="3474831">err</span>&nbsp;<span class="builtintype" id="3474835">error</span><span class="op" id="3474840">)</span>&nbsp;<span class="op" id="3474842">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474845">if</span>&nbsp;<span class="ident" id="3474848">atEOF</span>&nbsp;<span class="op" id="3474854">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3474857">len</span><span class="op" id="3474860">(</span><span class="ident" id="3474861">data</span><span class="op" id="3474865">)</span>&nbsp;<span class="op" id="3474867">==</span>&nbsp;<span class="num" id="3474870">0</span>&nbsp;<span class="op" id="3474872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474876">return</span>&nbsp;<span class="num" id="3474883">0</span><span class="op" id="3474884">,</span>&nbsp;<span class="builtintype" id="3474886">nil</span><span class="op" id="3474889">,</span>&nbsp;<span class="builtintype" id="3474891">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474900">//&nbsp;Fast&nbsp;path&nbsp;1:&nbsp;ASCII.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474924">if</span>&nbsp;<span class="ident" id="3474927">data</span><span class="op" id="3474931">[</span><span class="num" id="3474932">0</span><span class="op" id="3474933">]</span>&nbsp;<span class="op" id="3474935">&lt;</span>&nbsp;<span class="ident" id="3474937">utf8</span><span class="op" id="3474941">.</span><span class="ident" id="3474942">RuneSelf</span>&nbsp;<span class="op" id="3474951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474955">return</span>&nbsp;<span class="num" id="3474962">1</span><span class="op" id="3474963">,</span>&nbsp;<span class="ident" id="3474965">data</span><span class="op" id="3474969">[</span><span class="num" id="3474970">0</span><span class="op" id="3474971">:</span><span class="num" id="3474972">1</span><span class="op" id="3474973">]</span><span class="op" id="3474974">,</span>&nbsp;<span class="builtintype" id="3474976">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474985">//&nbsp;Fast&nbsp;path&nbsp;2:&nbsp;Correct&nbsp;UTF-8&nbsp;decode&nbsp;without&nbsp;error.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475038">_</span><span class="op" id="3475039">,</span>&nbsp;<span class="ident" id="3475041">width</span>&nbsp;<span class="op" id="3475047">:=</span>&nbsp;<span class="ident" id="3475050">utf8</span><span class="op" id="3475054">.</span><span class="ident" id="3475055">DecodeRune</span><span class="op" id="3475065">(</span><span class="ident" id="3475066">data</span><span class="op" id="3475070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475073">if</span>&nbsp;<span class="ident" id="3475076">width</span>&nbsp;<span class="op" id="3475082">&gt;</span>&nbsp;<span class="num" id="3475084">1</span>&nbsp;<span class="op" id="3475086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475090">//&nbsp;It&#39;s&nbsp;a&nbsp;valid&nbsp;encoding.&nbsp;Width&nbsp;cannot&nbsp;be&nbsp;one&nbsp;for&nbsp;a&nbsp;correctly&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475162">//&nbsp;non-ASCII&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475183">return</span>&nbsp;<span class="ident" id="3475190">width</span><span class="op" id="3475195">,</span>&nbsp;<span class="ident" id="3475197">data</span><span class="op" id="3475201">[</span><span class="num" id="3475202">0</span><span class="op" id="3475203">:</span><span class="ident" id="3475204">width</span><span class="op" id="3475209">]</span><span class="op" id="3475210">,</span>&nbsp;<span class="builtintype" id="3475212">nil</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475221">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;an&nbsp;error:&nbsp;we&nbsp;have&nbsp;width==1&nbsp;and&nbsp;implicitly&nbsp;r==utf8.RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475299">//&nbsp;Is&nbsp;the&nbsp;error&nbsp;because&nbsp;there&nbsp;wasn&#39;t&nbsp;a&nbsp;full&nbsp;rune&nbsp;to&nbsp;be&nbsp;decoded?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475364">//&nbsp;FullRune&nbsp;distinguishes&nbsp;correctly&nbsp;between&nbsp;erroneous&nbsp;and&nbsp;incomplete&nbsp;encodings.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475445">if</span>&nbsp;<span class="op" id="3475448">!</span><span class="ident" id="3475449">atEOF</span>&nbsp;<span class="op" id="3475455">&amp;&amp;</span>&nbsp;<span class="op" id="3475458">!</span><span class="ident" id="3475459">utf8</span><span class="op" id="3475463">.</span><span class="ident" id="3475464">FullRune</span><span class="op" id="3475472">(</span><span class="ident" id="3475473">data</span><span class="op" id="3475477">)</span>&nbsp;<span class="op" id="3475479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475483">//&nbsp;Incomplete;&nbsp;get&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475516">return</span>&nbsp;<span class="num" id="3475523">0</span><span class="op" id="3475524">,</span>&nbsp;<span class="builtintype" id="3475526">nil</span><span class="op" id="3475529">,</span>&nbsp;<span class="builtintype" id="3475531">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475540">//&nbsp;We&nbsp;have&nbsp;a&nbsp;real&nbsp;UTF-8&nbsp;encoding&nbsp;error.&nbsp;Return&nbsp;a&nbsp;properly&nbsp;encoded&nbsp;error&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475618">//&nbsp;but&nbsp;advance&nbsp;only&nbsp;one&nbsp;byte.&nbsp;This&nbsp;matches&nbsp;the&nbsp;behavior&nbsp;of&nbsp;a&nbsp;range&nbsp;loop&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475696">//&nbsp;an&nbsp;incorrectly&nbsp;encoded&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475731">return</span>&nbsp;<span class="num" id="3475738">1</span><span class="op" id="3475739">,</span>&nbsp;<span class="ident" id="3475741">errorRune</span><span class="op" id="3475750">,</span>&nbsp;<span class="builtintype" id="3475752">nil</span><br>
<span class="lineno"></span><span class="op" id="3475756">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3475759">//&nbsp;dropCR&nbsp;drops&nbsp;a&nbsp;terminal&nbsp;\r&nbsp;from&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3475804">func</span>&nbsp;<span class="ident" id="3475809">dropCR</span><span class="op" id="3475815">(</span><span class="ident" id="3475816">data</span>&nbsp;<span class="op" id="3475821">[</span><span class="op" id="3475822">]</span><span class="builtintype" id="3475823">byte</span><span class="op" id="3475827">)</span>&nbsp;<span class="op" id="3475829">[</span><span class="op" id="3475830">]</span><span class="builtintype" id="3475831">byte</span>&nbsp;<span class="op" id="3475836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475839">if</span>&nbsp;<span class="builtinfunc" id="3475842">len</span><span class="op" id="3475845">(</span><span class="ident" id="3475846">data</span><span class="op" id="3475850">)</span>&nbsp;<span class="op" id="3475852">&gt;</span>&nbsp;<span class="num" id="3475854">0</span>&nbsp;<span class="op" id="3475856">&amp;&amp;</span>&nbsp;<span class="ident" id="3475859">data</span><span class="op" id="3475863">[</span><span class="builtinfunc" id="3475864">len</span><span class="op" id="3475867">(</span><span class="ident" id="3475868">data</span><span class="op" id="3475872">)</span><span class="op" id="3475873">-</span><span class="num" id="3475874">1</span><span class="op" id="3475875">]</span>&nbsp;<span class="op" id="3475877">==</span>&nbsp;<span class="string" id="3475880">&#39;\r&#39;</span>&nbsp;<span class="op" id="3475885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475889">return</span>&nbsp;<span class="ident" id="3475896">data</span><span class="op" id="3475900">[</span><span class="num" id="3475901">0</span>&nbsp;<span class="op" id="3475903">:</span>&nbsp;<span class="builtinfunc" id="3475905">len</span><span class="op" id="3475908">(</span><span class="ident" id="3475909">data</span><span class="op" id="3475913">)</span><span class="op" id="3475914">-</span><span class="num" id="3475915">1</span><span class="op" id="3475916">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475922">return</span>&nbsp;<span class="ident" id="3475929">data</span><br>
<span class="lineno"></span><span class="op" id="3475934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475937">//&nbsp;ScanLines&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;line&nbsp;of</span><br>
<span class="lineno">285</span><span class="comment" id="3476010">//&nbsp;text,&nbsp;stripped&nbsp;of&nbsp;any&nbsp;trailing&nbsp;end-of-line&nbsp;marker.&nbsp;The&nbsp;returned&nbsp;line&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="3476086">//&nbsp;be&nbsp;empty.&nbsp;The&nbsp;end-of-line&nbsp;marker&nbsp;is&nbsp;one&nbsp;optional&nbsp;carriage&nbsp;return&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3476163">//&nbsp;by&nbsp;one&nbsp;mandatory&nbsp;newline.&nbsp;In&nbsp;regular&nbsp;expression&nbsp;notation,&nbsp;it&nbsp;is&nbsp;`\r?\n`.</span><br>
<span class="lineno"></span><span class="comment" id="3476239">//&nbsp;The&nbsp;last&nbsp;non-empty&nbsp;line&nbsp;of&nbsp;input&nbsp;will&nbsp;be&nbsp;returned&nbsp;even&nbsp;if&nbsp;it&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3476310">//&nbsp;newline.</span><br>
<span class="lineno">290</span><span class="keyword" id="3476322">func</span>&nbsp;<span class="ident" id="3476327">ScanLines</span><span class="op" id="3476336">(</span><span class="ident" id="3476337">data</span>&nbsp;<span class="op" id="3476342">[</span><span class="op" id="3476343">]</span><span class="builtintype" id="3476344">byte</span><span class="op" id="3476348">,</span>&nbsp;<span class="ident" id="3476350">atEOF</span>&nbsp;<span class="builtintype" id="3476356">bool</span><span class="op" id="3476360">)</span>&nbsp;<span class="op" id="3476362">(</span><span class="ident" id="3476363">advance</span>&nbsp;<span class="builtintype" id="3476371">int</span><span class="op" id="3476374">,</span>&nbsp;<span class="ident" id="3476376">token</span>&nbsp;<span class="op" id="3476382">[</span><span class="op" id="3476383">]</span><span class="builtintype" id="3476384">byte</span><span class="op" id="3476388">,</span>&nbsp;<span class="ident" id="3476390">err</span>&nbsp;<span class="builtintype" id="3476394">error</span><span class="op" id="3476399">)</span>&nbsp;<span class="op" id="3476401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476404">if</span>&nbsp;<span class="ident" id="3476407">atEOF</span>&nbsp;<span class="op" id="3476413">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3476416">len</span><span class="op" id="3476419">(</span><span class="ident" id="3476420">data</span><span class="op" id="3476424">)</span>&nbsp;<span class="op" id="3476426">==</span>&nbsp;<span class="num" id="3476429">0</span>&nbsp;<span class="op" id="3476431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476435">return</span>&nbsp;<span class="num" id="3476442">0</span><span class="op" id="3476443">,</span>&nbsp;<span class="builtintype" id="3476445">nil</span><span class="op" id="3476448">,</span>&nbsp;<span class="builtintype" id="3476450">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476458">if</span>&nbsp;<span class="ident" id="3476461">i</span>&nbsp;<span class="op" id="3476463">:=</span>&nbsp;<span class="ident" id="3476466">bytes</span><span class="op" id="3476471">.</span><span class="ident" id="3476472">IndexByte</span><span class="op" id="3476481">(</span><span class="ident" id="3476482">data</span><span class="op" id="3476486">,</span>&nbsp;<span class="string" id="3476488">&#39;\n&#39;</span><span class="op" id="3476492">)</span><span class="op" id="3476493">;</span>&nbsp;<span class="ident" id="3476495">i</span>&nbsp;<span class="op" id="3476497">&gt;=</span>&nbsp;<span class="num" id="3476500">0</span>&nbsp;<span class="op" id="3476502">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476506">//&nbsp;We&nbsp;have&nbsp;a&nbsp;full&nbsp;newline-terminated&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476551">return</span>&nbsp;<span class="ident" id="3476558">i</span>&nbsp;<span class="op" id="3476560">+</span>&nbsp;<span class="num" id="3476562">1</span><span class="op" id="3476563">,</span>&nbsp;<span class="ident" id="3476565">dropCR</span><span class="op" id="3476571">(</span><span class="ident" id="3476572">data</span><span class="op" id="3476576">[</span><span class="num" id="3476577">0</span><span class="op" id="3476578">:</span><span class="ident" id="3476579">i</span><span class="op" id="3476580">]</span><span class="op" id="3476581">)</span><span class="op" id="3476582">,</span>&nbsp;<span class="builtintype" id="3476584">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476592">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-terminated&nbsp;line.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476662">if</span>&nbsp;<span class="ident" id="3476665">atEOF</span>&nbsp;<span class="op" id="3476671">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476675">return</span>&nbsp;<span class="builtinfunc" id="3476682">len</span><span class="op" id="3476685">(</span><span class="ident" id="3476686">data</span><span class="op" id="3476690">)</span><span class="op" id="3476691">,</span>&nbsp;<span class="ident" id="3476693">dropCR</span><span class="op" id="3476699">(</span><span class="ident" id="3476700">data</span><span class="op" id="3476704">)</span><span class="op" id="3476705">,</span>&nbsp;<span class="builtintype" id="3476707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476715">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476738">return</span>&nbsp;<span class="num" id="3476745">0</span><span class="op" id="3476746">,</span>&nbsp;<span class="builtintype" id="3476748">nil</span><span class="op" id="3476751">,</span>&nbsp;<span class="builtintype" id="3476753">nil</span><br>
<span class="lineno"></span><span class="op" id="3476757">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="comment" id="3476760">//&nbsp;isSpace&nbsp;reports&nbsp;whether&nbsp;the&nbsp;character&nbsp;is&nbsp;a&nbsp;Unicode&nbsp;white&nbsp;space&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3476837">//&nbsp;We&nbsp;avoid&nbsp;dependency&nbsp;on&nbsp;the&nbsp;unicode&nbsp;package,&nbsp;but&nbsp;check&nbsp;validity&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="3476925">//&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="3476942">func</span>&nbsp;<span class="ident" id="3476947">isSpace</span><span class="op" id="3476954">(</span><span class="ident" id="3476955">r</span>&nbsp;<span class="builtintype" id="3476957">rune</span><span class="op" id="3476961">)</span>&nbsp;<span class="builtintype" id="3476963">bool</span>&nbsp;<span class="op" id="3476968">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476971">if</span>&nbsp;<span class="ident" id="3476974">r</span>&nbsp;<span class="op" id="3476976">&lt;=</span>&nbsp;<span class="string" id="3476979">&#39;\u00FF&#39;</span>&nbsp;<span class="op" id="3476988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476992">//&nbsp;Obvious&nbsp;ASCII&nbsp;ones:&nbsp;\t&nbsp;through&nbsp;\r&nbsp;plus&nbsp;space.&nbsp;Plus&nbsp;two&nbsp;Latin-1&nbsp;oddballs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477070">switch</span>&nbsp;<span class="ident" id="3477077">r</span>&nbsp;<span class="op" id="3477079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477083">case</span>&nbsp;<span class="string" id="3477088">&#39;&nbsp;&#39;</span><span class="op" id="3477091">,</span>&nbsp;<span class="string" id="3477093">&#39;\t&#39;</span><span class="op" id="3477097">,</span>&nbsp;<span class="string" id="3477099">&#39;\n&#39;</span><span class="op" id="3477103">,</span>&nbsp;<span class="string" id="3477105">&#39;\v&#39;</span><span class="op" id="3477109">,</span>&nbsp;<span class="string" id="3477111">&#39;\f&#39;</span><span class="op" id="3477115">,</span>&nbsp;<span class="string" id="3477117">&#39;\r&#39;</span><span class="op" id="3477121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477126">return</span>&nbsp;<span class="builtintype" id="3477133">true</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477140">case</span>&nbsp;<span class="string" id="3477145">&#39;\u0085&#39;</span><span class="op" id="3477153">,</span>&nbsp;<span class="string" id="3477155">&#39;\u00A0&#39;</span><span class="op" id="3477163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477168">return</span>&nbsp;<span class="builtintype" id="3477175">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477186">return</span>&nbsp;<span class="builtintype" id="3477193">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477200">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477203">//&nbsp;High-valued&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477225">if</span>&nbsp;<span class="string" id="3477228">&#39;\u2000&#39;</span>&nbsp;<span class="op" id="3477237">&lt;=</span>&nbsp;<span class="ident" id="3477240">r</span>&nbsp;<span class="op" id="3477242">&amp;&amp;</span>&nbsp;<span class="ident" id="3477245">r</span>&nbsp;<span class="op" id="3477247">&lt;=</span>&nbsp;<span class="string" id="3477250">&#39;\u200a&#39;</span>&nbsp;<span class="op" id="3477259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477263">return</span>&nbsp;<span class="builtintype" id="3477270">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477279">switch</span>&nbsp;<span class="ident" id="3477286">r</span>&nbsp;<span class="op" id="3477288">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477291">case</span>&nbsp;<span class="string" id="3477296">&#39;\u1680&#39;</span><span class="op" id="3477304">,</span>&nbsp;<span class="string" id="3477306">&#39;\u2028&#39;</span><span class="op" id="3477314">,</span>&nbsp;<span class="string" id="3477316">&#39;\u2029&#39;</span><span class="op" id="3477324">,</span>&nbsp;<span class="string" id="3477326">&#39;\u202f&#39;</span><span class="op" id="3477334">,</span>&nbsp;<span class="string" id="3477336">&#39;\u205f&#39;</span><span class="op" id="3477344">,</span>&nbsp;<span class="string" id="3477346">&#39;\u3000&#39;</span><span class="op" id="3477354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477358">return</span>&nbsp;<span class="builtintype" id="3477365">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477374">return</span>&nbsp;<span class="builtintype" id="3477381">false</span><br>
<span class="lineno"></span><span class="op" id="3477387">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3477390">//&nbsp;ScanWords&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="3477455">//&nbsp;space-separated&nbsp;word&nbsp;of&nbsp;text,&nbsp;with&nbsp;surrounding&nbsp;spaces&nbsp;deleted.&nbsp;It&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3477529">//&nbsp;never&nbsp;return&nbsp;an&nbsp;empty&nbsp;string.&nbsp;The&nbsp;definition&nbsp;of&nbsp;space&nbsp;is&nbsp;set&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3477596">//&nbsp;unicode.IsSpace.</span><br>
<span class="lineno">335</span><span class="keyword" id="3477616">func</span>&nbsp;<span class="ident" id="3477621">ScanWords</span><span class="op" id="3477630">(</span><span class="ident" id="3477631">data</span>&nbsp;<span class="op" id="3477636">[</span><span class="op" id="3477637">]</span><span class="builtintype" id="3477638">byte</span><span class="op" id="3477642">,</span>&nbsp;<span class="ident" id="3477644">atEOF</span>&nbsp;<span class="builtintype" id="3477650">bool</span><span class="op" id="3477654">)</span>&nbsp;<span class="op" id="3477656">(</span><span class="ident" id="3477657">advance</span>&nbsp;<span class="builtintype" id="3477665">int</span><span class="op" id="3477668">,</span>&nbsp;<span class="ident" id="3477670">token</span>&nbsp;<span class="op" id="3477676">[</span><span class="op" id="3477677">]</span><span class="builtintype" id="3477678">byte</span><span class="op" id="3477682">,</span>&nbsp;<span class="ident" id="3477684">err</span>&nbsp;<span class="builtintype" id="3477688">error</span><span class="op" id="3477693">)</span>&nbsp;<span class="op" id="3477695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477698">//&nbsp;Skip&nbsp;leading&nbsp;spaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477723">start</span>&nbsp;<span class="op" id="3477729">:=</span>&nbsp;<span class="num" id="3477732">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477735">for</span>&nbsp;<span class="ident" id="3477739">width</span>&nbsp;<span class="op" id="3477745">:=</span>&nbsp;<span class="num" id="3477748">0</span><span class="op" id="3477749">;</span>&nbsp;<span class="ident" id="3477751">start</span>&nbsp;<span class="op" id="3477757">&lt;</span>&nbsp;<span class="builtinfunc" id="3477759">len</span><span class="op" id="3477762">(</span><span class="ident" id="3477763">data</span><span class="op" id="3477767">)</span><span class="op" id="3477768">;</span>&nbsp;<span class="ident" id="3477770">start</span>&nbsp;<span class="op" id="3477776">+=</span>&nbsp;<span class="ident" id="3477779">width</span>&nbsp;<span class="op" id="3477785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477789">var</span>&nbsp;<span class="ident" id="3477793">r</span>&nbsp;<span class="builtintype" id="3477795">rune</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477802">r</span><span class="op" id="3477803">,</span>&nbsp;<span class="ident" id="3477805">width</span>&nbsp;<span class="op" id="3477811">=</span>&nbsp;<span class="ident" id="3477813">utf8</span><span class="op" id="3477817">.</span><span class="ident" id="3477818">DecodeRune</span><span class="op" id="3477828">(</span><span class="ident" id="3477829">data</span><span class="op" id="3477833">[</span><span class="ident" id="3477834">start</span><span class="op" id="3477839">:</span><span class="op" id="3477840">]</span><span class="op" id="3477841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477845">if</span>&nbsp;<span class="op" id="3477848">!</span><span class="ident" id="3477849">isSpace</span><span class="op" id="3477856">(</span><span class="ident" id="3477857">r</span><span class="op" id="3477858">)</span>&nbsp;<span class="op" id="3477860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477865">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477876">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477879">//&nbsp;Scan&nbsp;until&nbsp;space,&nbsp;marking&nbsp;end&nbsp;of&nbsp;word.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477922">for</span>&nbsp;<span class="ident" id="3477926">width</span><span class="op" id="3477931">,</span>&nbsp;<span class="ident" id="3477933">i</span>&nbsp;<span class="op" id="3477935">:=</span>&nbsp;<span class="num" id="3477938">0</span><span class="op" id="3477939">,</span>&nbsp;<span class="ident" id="3477941">start</span><span class="op" id="3477946">;</span>&nbsp;<span class="ident" id="3477948">i</span>&nbsp;<span class="op" id="3477950">&lt;</span>&nbsp;<span class="builtinfunc" id="3477952">len</span><span class="op" id="3477955">(</span><span class="ident" id="3477956">data</span><span class="op" id="3477960">)</span><span class="op" id="3477961">;</span>&nbsp;<span class="ident" id="3477963">i</span>&nbsp;<span class="op" id="3477965">+=</span>&nbsp;<span class="ident" id="3477968">width</span>&nbsp;<span class="op" id="3477974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477978">var</span>&nbsp;<span class="ident" id="3477982">r</span>&nbsp;<span class="builtintype" id="3477984">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477991">r</span><span class="op" id="3477992">,</span>&nbsp;<span class="ident" id="3477994">width</span>&nbsp;<span class="op" id="3478000">=</span>&nbsp;<span class="ident" id="3478002">utf8</span><span class="op" id="3478006">.</span><span class="ident" id="3478007">DecodeRune</span><span class="op" id="3478017">(</span><span class="ident" id="3478018">data</span><span class="op" id="3478022">[</span><span class="ident" id="3478023">i</span><span class="op" id="3478024">:</span><span class="op" id="3478025">]</span><span class="op" id="3478026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478030">if</span>&nbsp;<span class="ident" id="3478033">isSpace</span><span class="op" id="3478040">(</span><span class="ident" id="3478041">r</span><span class="op" id="3478042">)</span>&nbsp;<span class="op" id="3478044">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478049">return</span>&nbsp;<span class="ident" id="3478056">i</span>&nbsp;<span class="op" id="3478058">+</span>&nbsp;<span class="ident" id="3478060">width</span><span class="op" id="3478065">,</span>&nbsp;<span class="ident" id="3478067">data</span><span class="op" id="3478071">[</span><span class="ident" id="3478072">start</span><span class="op" id="3478077">:</span><span class="ident" id="3478078">i</span><span class="op" id="3478079">]</span><span class="op" id="3478080">,</span>&nbsp;<span class="builtintype" id="3478082">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478094">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-empty,&nbsp;non-terminated&nbsp;word.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478175">if</span>&nbsp;<span class="ident" id="3478178">atEOF</span>&nbsp;<span class="op" id="3478184">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3478187">len</span><span class="op" id="3478190">(</span><span class="ident" id="3478191">data</span><span class="op" id="3478195">)</span>&nbsp;<span class="op" id="3478197">&gt;</span>&nbsp;<span class="ident" id="3478199">start</span>&nbsp;<span class="op" id="3478205">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478209">return</span>&nbsp;<span class="builtinfunc" id="3478216">len</span><span class="op" id="3478219">(</span><span class="ident" id="3478220">data</span><span class="op" id="3478224">)</span><span class="op" id="3478225">,</span>&nbsp;<span class="ident" id="3478227">data</span><span class="op" id="3478231">[</span><span class="ident" id="3478232">start</span><span class="op" id="3478237">:</span><span class="op" id="3478238">]</span><span class="op" id="3478239">,</span>&nbsp;<span class="builtintype" id="3478241">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478249">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478272">return</span>&nbsp;<span class="ident" id="3478279">start</span><span class="op" id="3478284">,</span>&nbsp;<span class="builtintype" id="3478286">nil</span><span class="op" id="3478289">,</span>&nbsp;<span class="builtintype" id="3478291">nil</span><br>
<span class="lineno"></span><span class="op" id="3478295">}</span>
</div>
</body>
</html>
