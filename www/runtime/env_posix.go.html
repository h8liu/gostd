<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1509460">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1509515">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1509569">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1509620">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1509698">package</span>&nbsp;<span class="ident" id="1509706">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1509715">import</span>&nbsp;<span class="string" id="1509722">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1509732">func</span>&nbsp;<span class="ident" id="1509737">environ</span><span class="op" id="1509744">(</span><span class="op" id="1509745">)</span>&nbsp;<span class="op" id="1509747">[</span><span class="op" id="1509748">]</span><span class="builtintype" id="1509749">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1509757">func</span>&nbsp;<span class="ident" id="1509762">getenv</span><span class="op" id="1509768">(</span><span class="ident" id="1509769">s</span>&nbsp;<span class="op" id="1509771">*</span><span class="builtintype" id="1509772">byte</span><span class="op" id="1509776">)</span>&nbsp;<span class="op" id="1509778">*</span><span class="builtintype" id="1509779">byte</span>&nbsp;<span class="op" id="1509784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1509787">val</span>&nbsp;<span class="op" id="1509791">:=</span>&nbsp;<span class="ident" id="1509794">gogetenv</span><span class="op" id="1509802">(</span><span class="ident" id="1509803">gostringnocopy</span><span class="op" id="1509817">(</span><span class="ident" id="1509818">s</span><span class="op" id="1509819">)</span><span class="op" id="1509820">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509823">if</span>&nbsp;<span class="ident" id="1509826">val</span>&nbsp;<span class="op" id="1509830">==</span>&nbsp;<span class="string" id="1509833">&#34;&#34;</span>&nbsp;<span class="op" id="1509836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509840">return</span>&nbsp;<span class="ident" id="1509847">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1509852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1509855">//&nbsp;Strings&nbsp;found&nbsp;in&nbsp;environment&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509908">return</span>&nbsp;<span class="op" id="1509915">&amp;</span><span class="ident" id="1509916">bytes</span><span class="op" id="1509921">(</span><span class="ident" id="1509922">val</span><span class="op" id="1509925">)</span><span class="op" id="1509926">[</span><span class="num" id="1509927">0</span><span class="op" id="1509928">]</span><br>
<span class="lineno">20</span><span class="op" id="1509930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1509933">func</span>&nbsp;<span class="ident" id="1509938">gogetenv</span><span class="op" id="1509946">(</span><span class="ident" id="1509947">key</span>&nbsp;<span class="builtintype" id="1509951">string</span><span class="op" id="1509957">)</span>&nbsp;<span class="builtintype" id="1509959">string</span>&nbsp;<span class="op" id="1509966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1509969">env</span>&nbsp;<span class="op" id="1509973">:=</span>&nbsp;<span class="ident" id="1509976">environ</span><span class="op" id="1509983">(</span><span class="op" id="1509984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509987">if</span>&nbsp;<span class="ident" id="1509990">env</span>&nbsp;<span class="op" id="1509994">==</span>&nbsp;<span class="ident" id="1509997">nil</span>&nbsp;<span class="op" id="1510001">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510005">gothrow</span><span class="op" id="1510012">(</span><span class="string" id="1510013">&#34;getenv&nbsp;before&nbsp;env&nbsp;init&#34;</span><span class="op" id="1510037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1510040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510043">for</span>&nbsp;<span class="ident" id="1510047">_</span><span class="op" id="1510048">,</span>&nbsp;<span class="ident" id="1510050">s</span>&nbsp;<span class="op" id="1510052">:=</span>&nbsp;<span class="keyword" id="1510055">range</span>&nbsp;<span class="ident" id="1510061">environ</span><span class="op" id="1510068">(</span><span class="op" id="1510069">)</span>&nbsp;<span class="op" id="1510071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510075">if</span>&nbsp;<span class="builtinfunc" id="1510078">len</span><span class="op" id="1510081">(</span><span class="ident" id="1510082">s</span><span class="op" id="1510083">)</span>&nbsp;<span class="op" id="1510085">&gt;</span>&nbsp;<span class="builtinfunc" id="1510087">len</span><span class="op" id="1510090">(</span><span class="ident" id="1510091">key</span><span class="op" id="1510094">)</span>&nbsp;<span class="op" id="1510096">&amp;&amp;</span>&nbsp;<span class="ident" id="1510099">s</span><span class="op" id="1510100">[</span><span class="builtinfunc" id="1510101">len</span><span class="op" id="1510104">(</span><span class="ident" id="1510105">key</span><span class="op" id="1510108">)</span><span class="op" id="1510109">]</span>&nbsp;<span class="op" id="1510111">==</span>&nbsp;<span class="string" id="1510114">&#39;=&#39;</span>&nbsp;<span class="op" id="1510118">&amp;&amp;</span>&nbsp;<span class="ident" id="1510121">s</span><span class="op" id="1510122">[</span><span class="op" id="1510123">:</span><span class="builtinfunc" id="1510124">len</span><span class="op" id="1510127">(</span><span class="ident" id="1510128">key</span><span class="op" id="1510131">)</span><span class="op" id="1510132">]</span>&nbsp;<span class="op" id="1510134">==</span>&nbsp;<span class="ident" id="1510137">key</span>&nbsp;<span class="op" id="1510141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510146">return</span>&nbsp;<span class="ident" id="1510153">s</span><span class="op" id="1510154">[</span><span class="builtinfunc" id="1510155">len</span><span class="op" id="1510158">(</span><span class="ident" id="1510159">key</span><span class="op" id="1510162">)</span><span class="op" id="1510163">+</span><span class="num" id="1510164">1</span><span class="op" id="1510165">:</span><span class="op" id="1510166">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1510170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1510173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510176">return</span>&nbsp;<span class="string" id="1510183">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1510186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1510189">var</span>&nbsp;<span class="ident" id="1510193">_cgo_setenv</span>&nbsp;<span class="builtintype" id="1510205">uintptr</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1510215">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="1510240">var</span>&nbsp;<span class="ident" id="1510244">_cgo_unsetenv</span>&nbsp;<span class="builtintype" id="1510258">uintptr</span>&nbsp;<span class="comment" id="1510266">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1510292">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1510338">//&nbsp;Called&nbsp;from&nbsp;syscall.Setenv.</span><br>
<span class="lineno">40</span><span class="keyword" id="1510369">func</span>&nbsp;<span class="ident" id="1510374">syscall_setenv_c</span><span class="op" id="1510390">(</span><span class="ident" id="1510391">k</span>&nbsp;<span class="builtintype" id="1510393">string</span><span class="op" id="1510399">,</span>&nbsp;<span class="ident" id="1510401">v</span>&nbsp;<span class="builtintype" id="1510403">string</span><span class="op" id="1510409">)</span>&nbsp;<span class="op" id="1510411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510414">if</span>&nbsp;<span class="ident" id="1510417">_cgo_setenv</span>&nbsp;<span class="op" id="1510429">==</span>&nbsp;<span class="num" id="1510432">0</span>&nbsp;<span class="op" id="1510434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1510446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510449">arg</span>&nbsp;<span class="op" id="1510453">:=</span>&nbsp;<span class="op" id="1510456">[</span><span class="num" id="1510457">2</span><span class="op" id="1510458">]</span><span class="ident" id="1510459">unsafe</span><span class="op" id="1510465">.</span><span class="ident" id="1510466">Pointer</span><span class="op" id="1510473">{</span><span class="ident" id="1510474">cstring</span><span class="op" id="1510481">(</span><span class="ident" id="1510482">k</span><span class="op" id="1510483">)</span><span class="op" id="1510484">,</span>&nbsp;<span class="ident" id="1510486">cstring</span><span class="op" id="1510493">(</span><span class="ident" id="1510494">v</span><span class="op" id="1510495">)</span><span class="op" id="1510496">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510499">asmcgocall</span><span class="op" id="1510509">(</span><span class="ident" id="1510510">unsafe</span><span class="op" id="1510516">.</span><span class="ident" id="1510517">Pointer</span><span class="op" id="1510524">(</span><span class="ident" id="1510525">_cgo_setenv</span><span class="op" id="1510536">)</span><span class="op" id="1510537">,</span>&nbsp;<span class="ident" id="1510539">unsafe</span><span class="op" id="1510545">.</span><span class="ident" id="1510546">Pointer</span><span class="op" id="1510553">(</span><span class="op" id="1510554">&amp;</span><span class="ident" id="1510555">arg</span><span class="op" id="1510558">)</span><span class="op" id="1510559">)</span><br>
<span class="lineno"></span><span class="op" id="1510561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1510564">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1510610">//&nbsp;Called&nbsp;from&nbsp;syscall.unsetenv.</span><br>
<span class="lineno">50</span><span class="keyword" id="1510643">func</span>&nbsp;<span class="ident" id="1510648">syscall_unsetenv_c</span><span class="op" id="1510666">(</span><span class="ident" id="1510667">k</span>&nbsp;<span class="builtintype" id="1510669">string</span><span class="op" id="1510675">)</span>&nbsp;<span class="op" id="1510677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510680">if</span>&nbsp;<span class="ident" id="1510683">_cgo_unsetenv</span>&nbsp;<span class="op" id="1510697">==</span>&nbsp;<span class="num" id="1510700">0</span>&nbsp;<span class="op" id="1510702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1510706">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1510714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510717">arg</span>&nbsp;<span class="op" id="1510721">:=</span>&nbsp;<span class="op" id="1510724">[</span><span class="num" id="1510725">1</span><span class="op" id="1510726">]</span><span class="ident" id="1510727">unsafe</span><span class="op" id="1510733">.</span><span class="ident" id="1510734">Pointer</span><span class="op" id="1510741">{</span><span class="ident" id="1510742">cstring</span><span class="op" id="1510749">(</span><span class="ident" id="1510750">k</span><span class="op" id="1510751">)</span><span class="op" id="1510752">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510755">asmcgocall</span><span class="op" id="1510765">(</span><span class="ident" id="1510766">unsafe</span><span class="op" id="1510772">.</span><span class="ident" id="1510773">Pointer</span><span class="op" id="1510780">(</span><span class="ident" id="1510781">_cgo_unsetenv</span><span class="op" id="1510794">)</span><span class="op" id="1510795">,</span>&nbsp;<span class="ident" id="1510797">unsafe</span><span class="op" id="1510803">.</span><span class="ident" id="1510804">Pointer</span><span class="op" id="1510811">(</span><span class="op" id="1510812">&amp;</span><span class="ident" id="1510813">arg</span><span class="op" id="1510816">)</span><span class="op" id="1510817">)</span><br>
<span class="lineno"></span><span class="op" id="1510819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1510822">func</span>&nbsp;<span class="ident" id="1510827">cstring</span><span class="op" id="1510834">(</span><span class="ident" id="1510835">s</span>&nbsp;<span class="builtintype" id="1510837">string</span><span class="op" id="1510843">)</span>&nbsp;<span class="ident" id="1510845">unsafe</span><span class="op" id="1510851">.</span><span class="ident" id="1510852">Pointer</span>&nbsp;<span class="op" id="1510860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510863">p</span>&nbsp;<span class="op" id="1510865">:=</span>&nbsp;<span class="builtinfunc" id="1510868">make</span><span class="op" id="1510872">(</span><span class="op" id="1510873">[</span><span class="op" id="1510874">]</span><span class="builtintype" id="1510875">byte</span><span class="op" id="1510879">,</span>&nbsp;<span class="builtinfunc" id="1510881">len</span><span class="op" id="1510884">(</span><span class="ident" id="1510885">s</span><span class="op" id="1510886">)</span><span class="op" id="1510887">+</span><span class="num" id="1510888">1</span><span class="op" id="1510889">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510892">sp</span>&nbsp;<span class="op" id="1510895">:=</span>&nbsp;<span class="op" id="1510898">(</span><span class="op" id="1510899">*</span><span class="ident" id="1510900">_string</span><span class="op" id="1510907">)</span><span class="op" id="1510908">(</span><span class="ident" id="1510909">unsafe</span><span class="op" id="1510915">.</span><span class="ident" id="1510916">Pointer</span><span class="op" id="1510923">(</span><span class="op" id="1510924">&amp;</span><span class="ident" id="1510925">s</span><span class="op" id="1510926">)</span><span class="op" id="1510927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1510930">memmove</span><span class="op" id="1510937">(</span><span class="ident" id="1510938">unsafe</span><span class="op" id="1510944">.</span><span class="ident" id="1510945">Pointer</span><span class="op" id="1510952">(</span><span class="op" id="1510953">&amp;</span><span class="ident" id="1510954">p</span><span class="op" id="1510955">[</span><span class="num" id="1510956">0</span><span class="op" id="1510957">]</span><span class="op" id="1510958">)</span><span class="op" id="1510959">,</span>&nbsp;<span class="ident" id="1510961">unsafe</span><span class="op" id="1510967">.</span><span class="ident" id="1510968">Pointer</span><span class="op" id="1510975">(</span><span class="ident" id="1510976">sp</span><span class="op" id="1510978">.</span><span class="ident" id="1510979">str</span><span class="op" id="1510982">)</span><span class="op" id="1510983">,</span>&nbsp;<span class="builtintype" id="1510985">uintptr</span><span class="op" id="1510992">(</span><span class="builtinfunc" id="1510993">len</span><span class="op" id="1510996">(</span><span class="ident" id="1510997">s</span><span class="op" id="1510998">)</span><span class="op" id="1510999">)</span><span class="op" id="1511000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511003">return</span>&nbsp;<span class="ident" id="1511010">unsafe</span><span class="op" id="1511016">.</span><span class="ident" id="1511017">Pointer</span><span class="op" id="1511024">(</span><span class="op" id="1511025">&amp;</span><span class="ident" id="1511026">p</span><span class="op" id="1511027">[</span><span class="num" id="1511028">0</span><span class="op" id="1511029">]</span><span class="op" id="1511030">)</span><br>
<span class="lineno"></span><span class="op" id="1511032">}</span>
</div>
</body>
</html>
