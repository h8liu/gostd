<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4167935">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4167990">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4168044">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4168095">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4168160">package</span>&nbsp;<span class="ident" id="4168168">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4168173">import</span>&nbsp;<span class="op" id="4168180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168183">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168193">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168208">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168225">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168235">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168243">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4168249">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4168260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4168263">var</span>&nbsp;<span class="ident" id="4168267">bigZero</span>&nbsp;<span class="op" id="4168275">=</span>&nbsp;<span class="ident" id="4168277">big</span><span class="op" id="4168280">.</span><span class="ident" id="4168281">NewInt</span><span class="op" id="4168287">(</span><span class="num" id="4168288">0</span><span class="op" id="4168289">)</span><br>
<span class="lineno"></span><span class="keyword" id="4168291">var</span>&nbsp;<span class="ident" id="4168295">bigOne</span>&nbsp;<span class="op" id="4168302">=</span>&nbsp;<span class="ident" id="4168304">big</span><span class="op" id="4168307">.</span><span class="ident" id="4168308">NewInt</span><span class="op" id="4168314">(</span><span class="num" id="4168315">1</span><span class="op" id="4168316">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4168319">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4168376">type</span>&nbsp;<span class="ident" id="4168381">PublicKey</span>&nbsp;<span class="keyword" id="4168391">struct</span>&nbsp;<span class="op" id="4168398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168401">N</span>&nbsp;<span class="op" id="4168403">*</span><span class="ident" id="4168404">big</span><span class="op" id="4168407">.</span><span class="ident" id="4168408">Int</span>&nbsp;<span class="comment" id="4168412">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168424">E</span>&nbsp;<span class="builtintype" id="4168426">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4168435">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4168454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4168457">var</span>&nbsp;<span class="op" id="4168461">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168464">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4168487">=</span>&nbsp;<span class="ident" id="4168489">errors</span><span class="op" id="4168495">.</span><span class="ident" id="4168496">New</span><span class="op" id="4168499">(</span><span class="string" id="4168500">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4168536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168539">errPublicExponentSmall</span>&nbsp;<span class="op" id="4168562">=</span>&nbsp;<span class="ident" id="4168564">errors</span><span class="op" id="4168570">.</span><span class="ident" id="4168571">New</span><span class="op" id="4168574">(</span><span class="string" id="4168575">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4168614">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4168617">errPublicExponentLarge</span>&nbsp;<span class="op" id="4168640">=</span>&nbsp;<span class="ident" id="4168642">errors</span><span class="op" id="4168648">.</span><span class="ident" id="4168649">New</span><span class="op" id="4168652">(</span><span class="string" id="4168653">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4168692">)</span><br>
<span class="lineno"></span><span class="op" id="4168694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4168697">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4168756">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4168816">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4168871">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4168905">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4168960">func</span>&nbsp;<span class="ident" id="4168965">checkPub</span><span class="op" id="4168973">(</span><span class="ident" id="4168974">pub</span>&nbsp;<span class="op" id="4168978">*</span><span class="ident" id="4168979">PublicKey</span><span class="op" id="4168988">)</span>&nbsp;<span class="builtintype" id="4168990">error</span>&nbsp;<span class="op" id="4168996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4168999">if</span>&nbsp;<span class="ident" id="4169002">pub</span><span class="op" id="4169005">.</span><span class="ident" id="4169006">N</span>&nbsp;<span class="op" id="4169008">==</span>&nbsp;<span class="ident" id="4169011">nil</span>&nbsp;<span class="op" id="4169015">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169019">return</span>&nbsp;<span class="ident" id="4169026">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4169044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169047">if</span>&nbsp;<span class="ident" id="4169050">pub</span><span class="op" id="4169053">.</span><span class="ident" id="4169054">E</span>&nbsp;<span class="op" id="4169056">&lt;</span>&nbsp;<span class="num" id="4169058">2</span>&nbsp;<span class="op" id="4169060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169064">return</span>&nbsp;<span class="ident" id="4169071">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4169095">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169098">if</span>&nbsp;<span class="ident" id="4169101">pub</span><span class="op" id="4169104">.</span><span class="ident" id="4169105">E</span>&nbsp;<span class="op" id="4169107">&gt;</span>&nbsp;<span class="num" id="4169109">1</span><span class="op" id="4169110">&lt;&lt;</span><span class="num" id="4169112">31</span><span class="op" id="4169114">-</span><span class="num" id="4169115">1</span>&nbsp;<span class="op" id="4169117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169121">return</span>&nbsp;<span class="ident" id="4169128">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4169152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169155">return</span>&nbsp;<span class="ident" id="4169162">nil</span><br>
<span class="lineno"></span><span class="op" id="4169166">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4169169">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4169207">type</span>&nbsp;<span class="ident" id="4169212">PrivateKey</span>&nbsp;<span class="keyword" id="4169223">struct</span>&nbsp;<span class="op" id="4169230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4169233">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4169254">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4169271">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4169281">*</span><span class="ident" id="4169282">big</span><span class="op" id="4169285">.</span><span class="ident" id="4169286">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4169292">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4169313">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4169323">[</span><span class="op" id="4169324">]</span><span class="op" id="4169325">*</span><span class="ident" id="4169326">big</span><span class="op" id="4169329">.</span><span class="ident" id="4169330">Int</span>&nbsp;<span class="comment" id="4169334">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4169378">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4169444">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4169474">Precomputed</span>&nbsp;<span class="ident" id="4169486">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4169504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4169507">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4169563">func</span>&nbsp;<span class="op" id="4169568">(</span><span class="ident" id="4169569">priv</span>&nbsp;<span class="op" id="4169574">*</span><span class="ident" id="4169575">PrivateKey</span><span class="op" id="4169585">)</span>&nbsp;<span class="ident" id="4169587">Public</span><span class="op" id="4169593">(</span><span class="op" id="4169594">)</span>&nbsp;<span class="ident" id="4169596">crypto</span><span class="op" id="4169602">.</span><span class="ident" id="4169603">PublicKey</span>&nbsp;<span class="op" id="4169613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4169616">return</span>&nbsp;<span class="op" id="4169623">&amp;</span><span class="ident" id="4169624">priv</span><span class="op" id="4169628">.</span><span class="ident" id="4169629">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4169639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4169642">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4169714">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4169793">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4169871">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4169948">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4169978">func</span>&nbsp;<span class="op" id="4169983">(</span><span class="ident" id="4169984">priv</span>&nbsp;<span class="op" id="4169989">*</span><span class="ident" id="4169990">PrivateKey</span><span class="op" id="4170000">)</span>&nbsp;<span class="ident" id="4170002">Sign</span><span class="op" id="4170006">(</span><span class="ident" id="4170007">rand</span>&nbsp;<span class="ident" id="4170012">io</span><span class="op" id="4170014">.</span><span class="ident" id="4170015">Reader</span><span class="op" id="4170021">,</span>&nbsp;<span class="ident" id="4170023">msg</span>&nbsp;<span class="op" id="4170027">[</span><span class="op" id="4170028">]</span><span class="builtintype" id="4170029">byte</span><span class="op" id="4170033">,</span>&nbsp;<span class="ident" id="4170035">opts</span>&nbsp;<span class="ident" id="4170040">crypto</span><span class="op" id="4170046">.</span><span class="ident" id="4170047">SignerOpts</span><span class="op" id="4170057">)</span>&nbsp;<span class="op" id="4170059">(</span><span class="op" id="4170060">[</span><span class="op" id="4170061">]</span><span class="builtintype" id="4170062">byte</span><span class="op" id="4170066">,</span>&nbsp;<span class="builtintype" id="4170068">error</span><span class="op" id="4170073">)</span>&nbsp;<span class="op" id="4170075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4170078">if</span>&nbsp;<span class="ident" id="4170081">pssOpts</span><span class="op" id="4170088">,</span>&nbsp;<span class="ident" id="4170090">ok</span>&nbsp;<span class="op" id="4170093">:=</span>&nbsp;<span class="ident" id="4170096">opts</span><span class="op" id="4170100">.</span><span class="op" id="4170101">(</span><span class="op" id="4170102">*</span><span class="ident" id="4170103">PSSOptions</span><span class="op" id="4170113">)</span><span class="op" id="4170114">;</span>&nbsp;<span class="ident" id="4170116">ok</span>&nbsp;<span class="op" id="4170119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4170123">return</span>&nbsp;<span class="ident" id="4170130">SignPSS</span><span class="op" id="4170137">(</span><span class="ident" id="4170138">rand</span><span class="op" id="4170142">,</span>&nbsp;<span class="ident" id="4170144">priv</span><span class="op" id="4170148">,</span>&nbsp;<span class="ident" id="4170150">pssOpts</span><span class="op" id="4170157">.</span><span class="ident" id="4170158">Hash</span><span class="op" id="4170162">,</span>&nbsp;<span class="ident" id="4170164">msg</span><span class="op" id="4170167">,</span>&nbsp;<span class="ident" id="4170169">pssOpts</span><span class="op" id="4170176">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4170179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4170183">return</span>&nbsp;<span class="ident" id="4170190">SignPKCS1v15</span><span class="op" id="4170202">(</span><span class="ident" id="4170203">rand</span><span class="op" id="4170207">,</span>&nbsp;<span class="ident" id="4170209">priv</span><span class="op" id="4170213">,</span>&nbsp;<span class="ident" id="4170215">opts</span><span class="op" id="4170219">.</span><span class="ident" id="4170220">HashFunc</span><span class="op" id="4170228">(</span><span class="op" id="4170229">)</span><span class="op" id="4170230">,</span>&nbsp;<span class="ident" id="4170232">msg</span><span class="op" id="4170235">)</span><br>
<span class="lineno"></span><span class="op" id="4170237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4170240">type</span>&nbsp;<span class="ident" id="4170245">PrecomputedValues</span>&nbsp;<span class="keyword" id="4170263">struct</span>&nbsp;<span class="op" id="4170270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170273">Dp</span><span class="op" id="4170275">,</span>&nbsp;<span class="ident" id="4170277">Dq</span>&nbsp;<span class="op" id="4170280">*</span><span class="ident" id="4170281">big</span><span class="op" id="4170284">.</span><span class="ident" id="4170285">Int</span>&nbsp;<span class="comment" id="4170289">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170318">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4170325">*</span><span class="ident" id="4170326">big</span><span class="op" id="4170329">.</span><span class="ident" id="4170330">Int</span>&nbsp;<span class="comment" id="4170334">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4170350">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4170416">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4170485">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4170548">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170583">CRTValues</span>&nbsp;<span class="op" id="4170593">[</span><span class="op" id="4170594">]</span><span class="ident" id="4170595">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4170604">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4170607">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4170678">type</span>&nbsp;<span class="ident" id="4170683">CRTValue</span>&nbsp;<span class="keyword" id="4170692">struct</span>&nbsp;<span class="op" id="4170699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170702">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4170708">*</span><span class="ident" id="4170709">big</span><span class="op" id="4170712">.</span><span class="ident" id="4170713">Int</span>&nbsp;<span class="comment" id="4170717">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170738">Coeff</span>&nbsp;<span class="op" id="4170744">*</span><span class="ident" id="4170745">big</span><span class="op" id="4170748">.</span><span class="ident" id="4170749">Int</span>&nbsp;<span class="comment" id="4170753">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4170783">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4170789">*</span><span class="ident" id="4170790">big</span><span class="op" id="4170793">.</span><span class="ident" id="4170794">Int</span>&nbsp;<span class="comment" id="4170798">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4170848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4170851">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4170904">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4170982">func</span>&nbsp;<span class="op" id="4170987">(</span><span class="ident" id="4170988">priv</span>&nbsp;<span class="op" id="4170993">*</span><span class="ident" id="4170994">PrivateKey</span><span class="op" id="4171004">)</span>&nbsp;<span class="ident" id="4171006">Validate</span><span class="op" id="4171014">(</span><span class="op" id="4171015">)</span>&nbsp;<span class="builtintype" id="4171017">error</span>&nbsp;<span class="op" id="4171023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171026">if</span>&nbsp;<span class="ident" id="4171029">err</span>&nbsp;<span class="op" id="4171033">:=</span>&nbsp;<span class="ident" id="4171036">checkPub</span><span class="op" id="4171044">(</span><span class="op" id="4171045">&amp;</span><span class="ident" id="4171046">priv</span><span class="op" id="4171050">.</span><span class="ident" id="4171051">PublicKey</span><span class="op" id="4171060">)</span><span class="op" id="4171061">;</span>&nbsp;<span class="ident" id="4171063">err</span>&nbsp;<span class="op" id="4171067">!=</span>&nbsp;<span class="ident" id="4171070">nil</span>&nbsp;<span class="op" id="4171074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171078">return</span>&nbsp;<span class="ident" id="4171085">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4171090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171094">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171165">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171227">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171297">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171364">for</span>&nbsp;<span class="ident" id="4171368">_</span><span class="op" id="4171369">,</span>&nbsp;<span class="ident" id="4171371">prime</span>&nbsp;<span class="op" id="4171377">:=</span>&nbsp;<span class="keyword" id="4171380">range</span>&nbsp;<span class="ident" id="4171386">priv</span><span class="op" id="4171390">.</span><span class="ident" id="4171391">Primes</span>&nbsp;<span class="op" id="4171398">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171402">if</span>&nbsp;<span class="op" id="4171405">!</span><span class="ident" id="4171406">prime</span><span class="op" id="4171411">.</span><span class="ident" id="4171412">ProbablyPrime</span><span class="op" id="4171425">(</span><span class="num" id="4171426">20</span><span class="op" id="4171428">)</span>&nbsp;<span class="op" id="4171430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171435">return</span>&nbsp;<span class="ident" id="4171442">errors</span><span class="op" id="4171448">.</span><span class="ident" id="4171449">New</span><span class="op" id="4171452">(</span><span class="string" id="4171453">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4171492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4171496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4171499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171503">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4171533">modulus</span>&nbsp;<span class="op" id="4171541">:=</span>&nbsp;<span class="builtinfunc" id="4171544">new</span><span class="op" id="4171547">(</span><span class="ident" id="4171548">big</span><span class="op" id="4171551">.</span><span class="ident" id="4171552">Int</span><span class="op" id="4171555">)</span><span class="op" id="4171556">.</span><span class="ident" id="4171557">Set</span><span class="op" id="4171560">(</span><span class="ident" id="4171561">bigOne</span><span class="op" id="4171567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171570">for</span>&nbsp;<span class="ident" id="4171574">_</span><span class="op" id="4171575">,</span>&nbsp;<span class="ident" id="4171577">prime</span>&nbsp;<span class="op" id="4171583">:=</span>&nbsp;<span class="keyword" id="4171586">range</span>&nbsp;<span class="ident" id="4171592">priv</span><span class="op" id="4171596">.</span><span class="ident" id="4171597">Primes</span>&nbsp;<span class="op" id="4171604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4171608">modulus</span><span class="op" id="4171615">.</span><span class="ident" id="4171616">Mul</span><span class="op" id="4171619">(</span><span class="ident" id="4171620">modulus</span><span class="op" id="4171627">,</span>&nbsp;<span class="ident" id="4171629">prime</span><span class="op" id="4171634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4171637">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171640">if</span>&nbsp;<span class="ident" id="4171643">modulus</span><span class="op" id="4171650">.</span><span class="ident" id="4171651">Cmp</span><span class="op" id="4171654">(</span><span class="ident" id="4171655">priv</span><span class="op" id="4171659">.</span><span class="ident" id="4171660">N</span><span class="op" id="4171661">)</span>&nbsp;<span class="op" id="4171663">!=</span>&nbsp;<span class="num" id="4171666">0</span>&nbsp;<span class="op" id="4171668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4171672">return</span>&nbsp;<span class="ident" id="4171679">errors</span><span class="op" id="4171685">.</span><span class="ident" id="4171686">New</span><span class="op" id="4171689">(</span><span class="string" id="4171690">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4171719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4171722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171726">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171775">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171848">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171910">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4171989">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172059">congruence</span>&nbsp;<span class="op" id="4172070">:=</span>&nbsp;<span class="builtinfunc" id="4172073">new</span><span class="op" id="4172076">(</span><span class="ident" id="4172077">big</span><span class="op" id="4172080">.</span><span class="ident" id="4172081">Int</span><span class="op" id="4172084">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172087">de</span>&nbsp;<span class="op" id="4172090">:=</span>&nbsp;<span class="builtinfunc" id="4172093">new</span><span class="op" id="4172096">(</span><span class="ident" id="4172097">big</span><span class="op" id="4172100">.</span><span class="ident" id="4172101">Int</span><span class="op" id="4172104">)</span><span class="op" id="4172105">.</span><span class="ident" id="4172106">SetInt64</span><span class="op" id="4172114">(</span><span class="ident" id="4172115">int64</span><span class="op" id="4172120">(</span><span class="ident" id="4172121">priv</span><span class="op" id="4172125">.</span><span class="ident" id="4172126">E</span><span class="op" id="4172127">)</span><span class="op" id="4172128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172131">de</span><span class="op" id="4172133">.</span><span class="ident" id="4172134">Mul</span><span class="op" id="4172137">(</span><span class="ident" id="4172138">de</span><span class="op" id="4172140">,</span>&nbsp;<span class="ident" id="4172142">priv</span><span class="op" id="4172146">.</span><span class="ident" id="4172147">D</span><span class="op" id="4172148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4172151">for</span>&nbsp;<span class="ident" id="4172155">_</span><span class="op" id="4172156">,</span>&nbsp;<span class="ident" id="4172158">prime</span>&nbsp;<span class="op" id="4172164">:=</span>&nbsp;<span class="keyword" id="4172167">range</span>&nbsp;<span class="ident" id="4172173">priv</span><span class="op" id="4172177">.</span><span class="ident" id="4172178">Primes</span>&nbsp;<span class="op" id="4172185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172189">pminus1</span>&nbsp;<span class="op" id="4172197">:=</span>&nbsp;<span class="builtinfunc" id="4172200">new</span><span class="op" id="4172203">(</span><span class="ident" id="4172204">big</span><span class="op" id="4172207">.</span><span class="ident" id="4172208">Int</span><span class="op" id="4172211">)</span><span class="op" id="4172212">.</span><span class="ident" id="4172213">Sub</span><span class="op" id="4172216">(</span><span class="ident" id="4172217">prime</span><span class="op" id="4172222">,</span>&nbsp;<span class="ident" id="4172224">bigOne</span><span class="op" id="4172230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172234">congruence</span><span class="op" id="4172244">.</span><span class="ident" id="4172245">Mod</span><span class="op" id="4172248">(</span><span class="ident" id="4172249">de</span><span class="op" id="4172251">,</span>&nbsp;<span class="ident" id="4172253">pminus1</span><span class="op" id="4172260">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4172264">if</span>&nbsp;<span class="ident" id="4172267">congruence</span><span class="op" id="4172277">.</span><span class="ident" id="4172278">Cmp</span><span class="op" id="4172281">(</span><span class="ident" id="4172282">bigOne</span><span class="op" id="4172288">)</span>&nbsp;<span class="op" id="4172290">!=</span>&nbsp;<span class="num" id="4172293">0</span>&nbsp;<span class="op" id="4172295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4172300">return</span>&nbsp;<span class="ident" id="4172307">errors</span><span class="op" id="4172313">.</span><span class="ident" id="4172314">New</span><span class="op" id="4172317">(</span><span class="string" id="4172318">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4172349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4172353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4172356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4172359">return</span>&nbsp;<span class="ident" id="4172366">nil</span><br>
<span class="lineno">140</span><span class="op" id="4172370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4172373">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4172445">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4172504">func</span>&nbsp;<span class="ident" id="4172509">GenerateKey</span><span class="op" id="4172520">(</span><span class="ident" id="4172521">random</span>&nbsp;<span class="ident" id="4172528">io</span><span class="op" id="4172530">.</span><span class="ident" id="4172531">Reader</span><span class="op" id="4172537">,</span>&nbsp;<span class="ident" id="4172539">bits</span>&nbsp;<span class="builtintype" id="4172544">int</span><span class="op" id="4172547">)</span>&nbsp;<span class="op" id="4172549">(</span><span class="ident" id="4172550">priv</span>&nbsp;<span class="op" id="4172555">*</span><span class="ident" id="4172556">PrivateKey</span><span class="op" id="4172566">,</span>&nbsp;<span class="ident" id="4172568">err</span>&nbsp;<span class="builtintype" id="4172572">error</span><span class="op" id="4172577">)</span>&nbsp;<span class="op" id="4172579">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4172582">return</span>&nbsp;<span class="ident" id="4172589">GenerateMultiPrimeKey</span><span class="op" id="4172610">(</span><span class="ident" id="4172611">random</span><span class="op" id="4172617">,</span>&nbsp;<span class="num" id="4172619">2</span><span class="op" id="4172620">,</span>&nbsp;<span class="ident" id="4172622">bits</span><span class="op" id="4172626">)</span><br>
<span class="lineno"></span><span class="op" id="4172628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4172631">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4172709">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4172787">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4172863">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4172942">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4173019">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4173028">//</span><br>
<span class="lineno">155</span><span class="comment" id="4173031">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4173102">//</span><br>
<span class="lineno"></span><span class="comment" id="4173105">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4173146">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4173220">func</span>&nbsp;<span class="ident" id="4173225">GenerateMultiPrimeKey</span><span class="op" id="4173246">(</span><span class="ident" id="4173247">random</span>&nbsp;<span class="ident" id="4173254">io</span><span class="op" id="4173256">.</span><span class="ident" id="4173257">Reader</span><span class="op" id="4173263">,</span>&nbsp;<span class="ident" id="4173265">nprimes</span>&nbsp;<span class="builtintype" id="4173273">int</span><span class="op" id="4173276">,</span>&nbsp;<span class="ident" id="4173278">bits</span>&nbsp;<span class="builtintype" id="4173283">int</span><span class="op" id="4173286">)</span>&nbsp;<span class="op" id="4173288">(</span><span class="ident" id="4173289">priv</span>&nbsp;<span class="op" id="4173294">*</span><span class="ident" id="4173295">PrivateKey</span><span class="op" id="4173305">,</span>&nbsp;<span class="ident" id="4173307">err</span>&nbsp;<span class="builtintype" id="4173311">error</span><span class="op" id="4173316">)</span>&nbsp;<span class="op" id="4173318">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173321">priv</span>&nbsp;<span class="op" id="4173326">=</span>&nbsp;<span class="builtinfunc" id="4173328">new</span><span class="op" id="4173331">(</span><span class="ident" id="4173332">PrivateKey</span><span class="op" id="4173342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173345">priv</span><span class="op" id="4173349">.</span><span class="ident" id="4173350">E</span>&nbsp;<span class="op" id="4173352">=</span>&nbsp;<span class="num" id="4173354">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4173362">if</span>&nbsp;<span class="ident" id="4173365">nprimes</span>&nbsp;<span class="op" id="4173373">&lt;</span>&nbsp;<span class="num" id="4173375">2</span>&nbsp;<span class="op" id="4173377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4173381">return</span>&nbsp;<span class="ident" id="4173388">nil</span><span class="op" id="4173391">,</span>&nbsp;<span class="ident" id="4173393">errors</span><span class="op" id="4173399">.</span><span class="ident" id="4173400">New</span><span class="op" id="4173403">(</span><span class="string" id="4173404">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4173461">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173468">primes</span>&nbsp;<span class="op" id="4173475">:=</span>&nbsp;<span class="builtinfunc" id="4173478">make</span><span class="op" id="4173482">(</span><span class="op" id="4173483">[</span><span class="op" id="4173484">]</span><span class="op" id="4173485">*</span><span class="ident" id="4173486">big</span><span class="op" id="4173489">.</span><span class="ident" id="4173490">Int</span><span class="op" id="4173493">,</span>&nbsp;<span class="ident" id="4173495">nprimes</span><span class="op" id="4173502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4173505">NextSetOfPrimes</span><span class="op" id="4173520">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4173523">for</span>&nbsp;<span class="op" id="4173527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173531">todo</span>&nbsp;<span class="op" id="4173536">:=</span>&nbsp;<span class="ident" id="4173539">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173546">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173606">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173640">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173691">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173716">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173740">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173808">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173813">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173877">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173948">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4174013">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174042">if</span>&nbsp;<span class="ident" id="4174045">nprimes</span>&nbsp;<span class="op" id="4174053">&gt;=</span>&nbsp;<span class="num" id="4174056">7</span>&nbsp;<span class="op" id="4174058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174063">todo</span>&nbsp;<span class="op" id="4174068">+=</span>&nbsp;<span class="op" id="4174071">(</span><span class="ident" id="4174072">nprimes</span>&nbsp;<span class="op" id="4174080">-</span>&nbsp;<span class="num" id="4174082">2</span><span class="op" id="4174083">)</span>&nbsp;<span class="op" id="4174085">/</span>&nbsp;<span class="num" id="4174087">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174095">for</span>&nbsp;<span class="ident" id="4174099">i</span>&nbsp;<span class="op" id="4174101">:=</span>&nbsp;<span class="num" id="4174104">0</span><span class="op" id="4174105">;</span>&nbsp;<span class="ident" id="4174107">i</span>&nbsp;<span class="op" id="4174109">&lt;</span>&nbsp;<span class="ident" id="4174111">nprimes</span><span class="op" id="4174118">;</span>&nbsp;<span class="ident" id="4174120">i</span><span class="op" id="4174121">++</span>&nbsp;<span class="op" id="4174124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174129">primes</span><span class="op" id="4174135">[</span><span class="ident" id="4174136">i</span><span class="op" id="4174137">]</span><span class="op" id="4174138">,</span>&nbsp;<span class="ident" id="4174140">err</span>&nbsp;<span class="op" id="4174144">=</span>&nbsp;<span class="ident" id="4174146">rand</span><span class="op" id="4174150">.</span><span class="ident" id="4174151">Prime</span><span class="op" id="4174156">(</span><span class="ident" id="4174157">random</span><span class="op" id="4174163">,</span>&nbsp;<span class="ident" id="4174165">todo</span><span class="op" id="4174169">/</span><span class="op" id="4174170">(</span><span class="ident" id="4174171">nprimes</span><span class="op" id="4174178">-</span><span class="ident" id="4174179">i</span><span class="op" id="4174180">)</span><span class="op" id="4174181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174186">if</span>&nbsp;<span class="ident" id="4174189">err</span>&nbsp;<span class="op" id="4174193">!=</span>&nbsp;<span class="ident" id="4174196">nil</span>&nbsp;<span class="op" id="4174200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174206">return</span>&nbsp;<span class="ident" id="4174213">nil</span><span class="op" id="4174216">,</span>&nbsp;<span class="ident" id="4174218">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174230">todo</span>&nbsp;<span class="op" id="4174235">-=</span>&nbsp;<span class="ident" id="4174238">primes</span><span class="op" id="4174244">[</span><span class="ident" id="4174245">i</span><span class="op" id="4174246">]</span><span class="op" id="4174247">.</span><span class="ident" id="4174248">BitLen</span><span class="op" id="4174254">(</span><span class="op" id="4174255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4174264">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174312">for</span>&nbsp;<span class="ident" id="4174316">i</span><span class="op" id="4174317">,</span>&nbsp;<span class="ident" id="4174319">prime</span>&nbsp;<span class="op" id="4174325">:=</span>&nbsp;<span class="keyword" id="4174328">range</span>&nbsp;<span class="ident" id="4174334">primes</span>&nbsp;<span class="op" id="4174341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174346">for</span>&nbsp;<span class="ident" id="4174350">j</span>&nbsp;<span class="op" id="4174352">:=</span>&nbsp;<span class="num" id="4174355">0</span><span class="op" id="4174356">;</span>&nbsp;<span class="ident" id="4174358">j</span>&nbsp;<span class="op" id="4174360">&lt;</span>&nbsp;<span class="ident" id="4174362">i</span><span class="op" id="4174363">;</span>&nbsp;<span class="ident" id="4174365">j</span><span class="op" id="4174366">++</span>&nbsp;<span class="op" id="4174369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174375">if</span>&nbsp;<span class="ident" id="4174378">prime</span><span class="op" id="4174383">.</span><span class="ident" id="4174384">Cmp</span><span class="op" id="4174387">(</span><span class="ident" id="4174388">primes</span><span class="op" id="4174394">[</span><span class="ident" id="4174395">j</span><span class="op" id="4174396">]</span><span class="op" id="4174397">)</span>&nbsp;<span class="op" id="4174399">==</span>&nbsp;<span class="num" id="4174402">0</span>&nbsp;<span class="op" id="4174404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174411">continue</span>&nbsp;<span class="ident" id="4174420">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174440">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174454">n</span>&nbsp;<span class="op" id="4174456">:=</span>&nbsp;<span class="builtinfunc" id="4174459">new</span><span class="op" id="4174462">(</span><span class="ident" id="4174463">big</span><span class="op" id="4174466">.</span><span class="ident" id="4174467">Int</span><span class="op" id="4174470">)</span><span class="op" id="4174471">.</span><span class="ident" id="4174472">Set</span><span class="op" id="4174475">(</span><span class="ident" id="4174476">bigOne</span><span class="op" id="4174482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174486">totient</span>&nbsp;<span class="op" id="4174494">:=</span>&nbsp;<span class="builtinfunc" id="4174497">new</span><span class="op" id="4174500">(</span><span class="ident" id="4174501">big</span><span class="op" id="4174504">.</span><span class="ident" id="4174505">Int</span><span class="op" id="4174508">)</span><span class="op" id="4174509">.</span><span class="ident" id="4174510">Set</span><span class="op" id="4174513">(</span><span class="ident" id="4174514">bigOne</span><span class="op" id="4174520">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174524">pminus1</span>&nbsp;<span class="op" id="4174532">:=</span>&nbsp;<span class="builtinfunc" id="4174535">new</span><span class="op" id="4174538">(</span><span class="ident" id="4174539">big</span><span class="op" id="4174542">.</span><span class="ident" id="4174543">Int</span><span class="op" id="4174546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174550">for</span>&nbsp;<span class="ident" id="4174554">_</span><span class="op" id="4174555">,</span>&nbsp;<span class="ident" id="4174557">prime</span>&nbsp;<span class="op" id="4174563">:=</span>&nbsp;<span class="keyword" id="4174566">range</span>&nbsp;<span class="ident" id="4174572">primes</span>&nbsp;<span class="op" id="4174579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174584">n</span><span class="op" id="4174585">.</span><span class="ident" id="4174586">Mul</span><span class="op" id="4174589">(</span><span class="ident" id="4174590">n</span><span class="op" id="4174591">,</span>&nbsp;<span class="ident" id="4174593">prime</span><span class="op" id="4174598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174603">pminus1</span><span class="op" id="4174610">.</span><span class="ident" id="4174611">Sub</span><span class="op" id="4174614">(</span><span class="ident" id="4174615">prime</span><span class="op" id="4174620">,</span>&nbsp;<span class="ident" id="4174622">bigOne</span><span class="op" id="4174628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174633">totient</span><span class="op" id="4174640">.</span><span class="ident" id="4174641">Mul</span><span class="op" id="4174644">(</span><span class="ident" id="4174645">totient</span><span class="op" id="4174652">,</span>&nbsp;<span class="ident" id="4174654">pminus1</span><span class="op" id="4174661">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174669">if</span>&nbsp;<span class="ident" id="4174672">n</span><span class="op" id="4174673">.</span><span class="ident" id="4174674">BitLen</span><span class="op" id="4174680">(</span><span class="op" id="4174681">)</span>&nbsp;<span class="op" id="4174683">!=</span>&nbsp;<span class="ident" id="4174686">bits</span>&nbsp;<span class="op" id="4174691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4174696">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4174752">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4174813">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4174869">continue</span>&nbsp;<span class="ident" id="4174878">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174901">g</span>&nbsp;<span class="op" id="4174903">:=</span>&nbsp;<span class="builtinfunc" id="4174906">new</span><span class="op" id="4174909">(</span><span class="ident" id="4174910">big</span><span class="op" id="4174913">.</span><span class="ident" id="4174914">Int</span><span class="op" id="4174917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174921">priv</span><span class="op" id="4174925">.</span><span class="ident" id="4174926">D</span>&nbsp;<span class="op" id="4174928">=</span>&nbsp;<span class="builtinfunc" id="4174930">new</span><span class="op" id="4174933">(</span><span class="ident" id="4174934">big</span><span class="op" id="4174937">.</span><span class="ident" id="4174938">Int</span><span class="op" id="4174941">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174945">y</span>&nbsp;<span class="op" id="4174947">:=</span>&nbsp;<span class="builtinfunc" id="4174950">new</span><span class="op" id="4174953">(</span><span class="ident" id="4174954">big</span><span class="op" id="4174957">.</span><span class="ident" id="4174958">Int</span><span class="op" id="4174961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174965">e</span>&nbsp;<span class="op" id="4174967">:=</span>&nbsp;<span class="ident" id="4174970">big</span><span class="op" id="4174973">.</span><span class="ident" id="4174974">NewInt</span><span class="op" id="4174980">(</span><span class="ident" id="4174981">int64</span><span class="op" id="4174986">(</span><span class="ident" id="4174987">priv</span><span class="op" id="4174991">.</span><span class="ident" id="4174992">E</span><span class="op" id="4174993">)</span><span class="op" id="4174994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174998">g</span><span class="op" id="4174999">.</span><span class="ident" id="4175000">GCD</span><span class="op" id="4175003">(</span><span class="ident" id="4175004">priv</span><span class="op" id="4175008">.</span><span class="ident" id="4175009">D</span><span class="op" id="4175010">,</span>&nbsp;<span class="ident" id="4175012">y</span><span class="op" id="4175013">,</span>&nbsp;<span class="ident" id="4175015">e</span><span class="op" id="4175016">,</span>&nbsp;<span class="ident" id="4175018">totient</span><span class="op" id="4175025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175030">if</span>&nbsp;<span class="ident" id="4175033">g</span><span class="op" id="4175034">.</span><span class="ident" id="4175035">Cmp</span><span class="op" id="4175038">(</span><span class="ident" id="4175039">bigOne</span><span class="op" id="4175045">)</span>&nbsp;<span class="op" id="4175047">==</span>&nbsp;<span class="num" id="4175050">0</span>&nbsp;<span class="op" id="4175052">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175057">if</span>&nbsp;<span class="ident" id="4175060">priv</span><span class="op" id="4175064">.</span><span class="ident" id="4175065">D</span><span class="op" id="4175066">.</span><span class="ident" id="4175067">Sign</span><span class="op" id="4175071">(</span><span class="op" id="4175072">)</span>&nbsp;<span class="op" id="4175074">&lt;</span>&nbsp;<span class="num" id="4175076">0</span>&nbsp;<span class="op" id="4175078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175084">priv</span><span class="op" id="4175088">.</span><span class="ident" id="4175089">D</span><span class="op" id="4175090">.</span><span class="ident" id="4175091">Add</span><span class="op" id="4175094">(</span><span class="ident" id="4175095">priv</span><span class="op" id="4175099">.</span><span class="ident" id="4175100">D</span><span class="op" id="4175101">,</span>&nbsp;<span class="ident" id="4175103">totient</span><span class="op" id="4175110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175120">priv</span><span class="op" id="4175124">.</span><span class="ident" id="4175125">Primes</span>&nbsp;<span class="op" id="4175132">=</span>&nbsp;<span class="ident" id="4175134">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175144">priv</span><span class="op" id="4175148">.</span><span class="ident" id="4175149">N</span>&nbsp;<span class="op" id="4175151">=</span>&nbsp;<span class="ident" id="4175153">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175159">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175174">priv</span><span class="op" id="4175178">.</span><span class="ident" id="4175179">Precompute</span><span class="op" id="4175189">(</span><span class="op" id="4175190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175193">return</span><br>
<span class="lineno"></span><span class="op" id="4175200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175203">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4175261">func</span>&nbsp;<span class="ident" id="4175266">incCounter</span><span class="op" id="4175276">(</span><span class="ident" id="4175277">c</span>&nbsp;<span class="op" id="4175279">*</span><span class="op" id="4175280">[</span><span class="num" id="4175281">4</span><span class="op" id="4175282">]</span><span class="builtintype" id="4175283">byte</span><span class="op" id="4175287">)</span>&nbsp;<span class="op" id="4175289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175292">if</span>&nbsp;<span class="ident" id="4175295">c</span><span class="op" id="4175296">[</span><span class="num" id="4175297">3</span><span class="op" id="4175298">]</span><span class="op" id="4175299">++</span><span class="op" id="4175301">;</span>&nbsp;<span class="ident" id="4175303">c</span><span class="op" id="4175304">[</span><span class="num" id="4175305">3</span><span class="op" id="4175306">]</span>&nbsp;<span class="op" id="4175308">!=</span>&nbsp;<span class="num" id="4175311">0</span>&nbsp;<span class="op" id="4175313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175317">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175328">if</span>&nbsp;<span class="ident" id="4175331">c</span><span class="op" id="4175332">[</span><span class="num" id="4175333">2</span><span class="op" id="4175334">]</span><span class="op" id="4175335">++</span><span class="op" id="4175337">;</span>&nbsp;<span class="ident" id="4175339">c</span><span class="op" id="4175340">[</span><span class="num" id="4175341">2</span><span class="op" id="4175342">]</span>&nbsp;<span class="op" id="4175344">!=</span>&nbsp;<span class="num" id="4175347">0</span>&nbsp;<span class="op" id="4175349">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175353">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175364">if</span>&nbsp;<span class="ident" id="4175367">c</span><span class="op" id="4175368">[</span><span class="num" id="4175369">1</span><span class="op" id="4175370">]</span><span class="op" id="4175371">++</span><span class="op" id="4175373">;</span>&nbsp;<span class="ident" id="4175375">c</span><span class="op" id="4175376">[</span><span class="num" id="4175377">1</span><span class="op" id="4175378">]</span>&nbsp;<span class="op" id="4175380">!=</span>&nbsp;<span class="num" id="4175383">0</span>&nbsp;<span class="op" id="4175385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175397">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175400">c</span><span class="op" id="4175401">[</span><span class="num" id="4175402">0</span><span class="op" id="4175403">]</span><span class="op" id="4175404">++</span><br>
<span class="lineno"></span><span class="op" id="4175407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175410">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4175489">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4175518">func</span>&nbsp;<span class="ident" id="4175523">mgf1XOR</span><span class="op" id="4175530">(</span><span class="ident" id="4175531">out</span>&nbsp;<span class="op" id="4175535">[</span><span class="op" id="4175536">]</span><span class="builtintype" id="4175537">byte</span><span class="op" id="4175541">,</span>&nbsp;<span class="ident" id="4175543">hash</span>&nbsp;<span class="ident" id="4175548">hash</span><span class="op" id="4175552">.</span><span class="ident" id="4175553">Hash</span><span class="op" id="4175557">,</span>&nbsp;<span class="ident" id="4175559">seed</span>&nbsp;<span class="op" id="4175564">[</span><span class="op" id="4175565">]</span><span class="builtintype" id="4175566">byte</span><span class="op" id="4175570">)</span>&nbsp;<span class="op" id="4175572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175575">var</span>&nbsp;<span class="ident" id="4175579">counter</span>&nbsp;<span class="op" id="4175587">[</span><span class="num" id="4175588">4</span><span class="op" id="4175589">]</span><span class="builtintype" id="4175590">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175596">var</span>&nbsp;<span class="ident" id="4175600">digest</span>&nbsp;<span class="op" id="4175607">[</span><span class="op" id="4175608">]</span><span class="builtintype" id="4175609">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175616">done</span>&nbsp;<span class="op" id="4175621">:=</span>&nbsp;<span class="num" id="4175624">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175627">for</span>&nbsp;<span class="ident" id="4175631">done</span>&nbsp;<span class="op" id="4175636">&lt;</span>&nbsp;<span class="builtinfunc" id="4175638">len</span><span class="op" id="4175641">(</span><span class="ident" id="4175642">out</span><span class="op" id="4175645">)</span>&nbsp;<span class="op" id="4175647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175651">hash</span><span class="op" id="4175655">.</span><span class="ident" id="4175656">Write</span><span class="op" id="4175661">(</span><span class="ident" id="4175662">seed</span><span class="op" id="4175666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175670">hash</span><span class="op" id="4175674">.</span><span class="ident" id="4175675">Write</span><span class="op" id="4175680">(</span><span class="ident" id="4175681">counter</span><span class="op" id="4175688">[</span><span class="num" id="4175689">0</span><span class="op" id="4175690">:</span><span class="num" id="4175691">4</span><span class="op" id="4175692">]</span><span class="op" id="4175693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175697">digest</span>&nbsp;<span class="op" id="4175704">=</span>&nbsp;<span class="ident" id="4175706">hash</span><span class="op" id="4175710">.</span><span class="ident" id="4175711">Sum</span><span class="op" id="4175714">(</span><span class="ident" id="4175715">digest</span><span class="op" id="4175721">[</span><span class="op" id="4175722">:</span><span class="num" id="4175723">0</span><span class="op" id="4175724">]</span><span class="op" id="4175725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175729">hash</span><span class="op" id="4175733">.</span><span class="ident" id="4175734">Reset</span><span class="op" id="4175739">(</span><span class="op" id="4175740">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4175745">for</span>&nbsp;<span class="ident" id="4175749">i</span>&nbsp;<span class="op" id="4175751">:=</span>&nbsp;<span class="num" id="4175754">0</span><span class="op" id="4175755">;</span>&nbsp;<span class="ident" id="4175757">i</span>&nbsp;<span class="op" id="4175759">&lt;</span>&nbsp;<span class="builtinfunc" id="4175761">len</span><span class="op" id="4175764">(</span><span class="ident" id="4175765">digest</span><span class="op" id="4175771">)</span>&nbsp;<span class="op" id="4175773">&amp;&amp;</span>&nbsp;<span class="ident" id="4175776">done</span>&nbsp;<span class="op" id="4175781">&lt;</span>&nbsp;<span class="builtinfunc" id="4175783">len</span><span class="op" id="4175786">(</span><span class="ident" id="4175787">out</span><span class="op" id="4175790">)</span><span class="op" id="4175791">;</span>&nbsp;<span class="ident" id="4175793">i</span><span class="op" id="4175794">++</span>&nbsp;<span class="op" id="4175797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175802">out</span><span class="op" id="4175805">[</span><span class="ident" id="4175806">done</span><span class="op" id="4175810">]</span>&nbsp;<span class="op" id="4175812">^=</span>&nbsp;<span class="ident" id="4175815">digest</span><span class="op" id="4175821">[</span><span class="ident" id="4175822">i</span><span class="op" id="4175823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175828">done</span><span class="op" id="4175832">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175837">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175841">incCounter</span><span class="op" id="4175851">(</span><span class="op" id="4175852">&amp;</span><span class="ident" id="4175853">counter</span><span class="op" id="4175860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175863">}</span><br>
<span class="lineno"></span><span class="op" id="4175865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175868">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4175947">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4175992">var</span>&nbsp;<span class="ident" id="4175996">ErrMessageTooLong</span>&nbsp;<span class="op" id="4176014">=</span>&nbsp;<span class="ident" id="4176016">errors</span><span class="op" id="4176022">.</span><span class="ident" id="4176023">New</span><span class="op" id="4176026">(</span><span class="string" id="4176027">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4176081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4176084">func</span>&nbsp;<span class="ident" id="4176089">encrypt</span><span class="op" id="4176096">(</span><span class="ident" id="4176097">c</span>&nbsp;<span class="op" id="4176099">*</span><span class="ident" id="4176100">big</span><span class="op" id="4176103">.</span><span class="ident" id="4176104">Int</span><span class="op" id="4176107">,</span>&nbsp;<span class="ident" id="4176109">pub</span>&nbsp;<span class="op" id="4176113">*</span><span class="ident" id="4176114">PublicKey</span><span class="op" id="4176123">,</span>&nbsp;<span class="ident" id="4176125">m</span>&nbsp;<span class="op" id="4176127">*</span><span class="ident" id="4176128">big</span><span class="op" id="4176131">.</span><span class="ident" id="4176132">Int</span><span class="op" id="4176135">)</span>&nbsp;<span class="op" id="4176137">*</span><span class="ident" id="4176138">big</span><span class="op" id="4176141">.</span><span class="ident" id="4176142">Int</span>&nbsp;<span class="op" id="4176146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176149">e</span>&nbsp;<span class="op" id="4176151">:=</span>&nbsp;<span class="ident" id="4176154">big</span><span class="op" id="4176157">.</span><span class="ident" id="4176158">NewInt</span><span class="op" id="4176164">(</span><span class="ident" id="4176165">int64</span><span class="op" id="4176170">(</span><span class="ident" id="4176171">pub</span><span class="op" id="4176174">.</span><span class="ident" id="4176175">E</span><span class="op" id="4176176">)</span><span class="op" id="4176177">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176180">c</span><span class="op" id="4176181">.</span><span class="ident" id="4176182">Exp</span><span class="op" id="4176185">(</span><span class="ident" id="4176186">m</span><span class="op" id="4176187">,</span>&nbsp;<span class="ident" id="4176189">e</span><span class="op" id="4176190">,</span>&nbsp;<span class="ident" id="4176192">pub</span><span class="op" id="4176195">.</span><span class="ident" id="4176196">N</span><span class="op" id="4176197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176200">return</span>&nbsp;<span class="ident" id="4176207">c</span><br>
<span class="lineno"></span><span class="op" id="4176209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176212">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4176269">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4176345">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4176378">func</span>&nbsp;<span class="ident" id="4176383">EncryptOAEP</span><span class="op" id="4176394">(</span><span class="ident" id="4176395">hash</span>&nbsp;<span class="ident" id="4176400">hash</span><span class="op" id="4176404">.</span><span class="ident" id="4176405">Hash</span><span class="op" id="4176409">,</span>&nbsp;<span class="ident" id="4176411">random</span>&nbsp;<span class="ident" id="4176418">io</span><span class="op" id="4176420">.</span><span class="ident" id="4176421">Reader</span><span class="op" id="4176427">,</span>&nbsp;<span class="ident" id="4176429">pub</span>&nbsp;<span class="op" id="4176433">*</span><span class="ident" id="4176434">PublicKey</span><span class="op" id="4176443">,</span>&nbsp;<span class="ident" id="4176445">msg</span>&nbsp;<span class="op" id="4176449">[</span><span class="op" id="4176450">]</span><span class="builtintype" id="4176451">byte</span><span class="op" id="4176455">,</span>&nbsp;<span class="ident" id="4176457">label</span>&nbsp;<span class="op" id="4176463">[</span><span class="op" id="4176464">]</span><span class="builtintype" id="4176465">byte</span><span class="op" id="4176469">)</span>&nbsp;<span class="op" id="4176471">(</span><span class="ident" id="4176472">out</span>&nbsp;<span class="op" id="4176476">[</span><span class="op" id="4176477">]</span><span class="builtintype" id="4176478">byte</span><span class="op" id="4176482">,</span>&nbsp;<span class="ident" id="4176484">err</span>&nbsp;<span class="builtintype" id="4176488">error</span><span class="op" id="4176493">)</span>&nbsp;<span class="op" id="4176495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176498">if</span>&nbsp;<span class="ident" id="4176501">err</span>&nbsp;<span class="op" id="4176505">:=</span>&nbsp;<span class="ident" id="4176508">checkPub</span><span class="op" id="4176516">(</span><span class="ident" id="4176517">pub</span><span class="op" id="4176520">)</span><span class="op" id="4176521">;</span>&nbsp;<span class="ident" id="4176523">err</span>&nbsp;<span class="op" id="4176527">!=</span>&nbsp;<span class="ident" id="4176530">nil</span>&nbsp;<span class="op" id="4176534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176538">return</span>&nbsp;<span class="ident" id="4176545">nil</span><span class="op" id="4176548">,</span>&nbsp;<span class="ident" id="4176550">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176558">hash</span><span class="op" id="4176562">.</span><span class="ident" id="4176563">Reset</span><span class="op" id="4176568">(</span><span class="op" id="4176569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176572">k</span>&nbsp;<span class="op" id="4176574">:=</span>&nbsp;<span class="op" id="4176577">(</span><span class="ident" id="4176578">pub</span><span class="op" id="4176581">.</span><span class="ident" id="4176582">N</span><span class="op" id="4176583">.</span><span class="ident" id="4176584">BitLen</span><span class="op" id="4176590">(</span><span class="op" id="4176591">)</span>&nbsp;<span class="op" id="4176593">+</span>&nbsp;<span class="num" id="4176595">7</span><span class="op" id="4176596">)</span>&nbsp;<span class="op" id="4176598">/</span>&nbsp;<span class="num" id="4176600">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176603">if</span>&nbsp;<span class="builtinfunc" id="4176606">len</span><span class="op" id="4176609">(</span><span class="ident" id="4176610">msg</span><span class="op" id="4176613">)</span>&nbsp;<span class="op" id="4176615">&gt;</span>&nbsp;<span class="ident" id="4176617">k</span><span class="op" id="4176618">-</span><span class="num" id="4176619">2</span><span class="op" id="4176620">*</span><span class="ident" id="4176621">hash</span><span class="op" id="4176625">.</span><span class="ident" id="4176626">Size</span><span class="op" id="4176630">(</span><span class="op" id="4176631">)</span><span class="op" id="4176632">-</span><span class="num" id="4176633">2</span>&nbsp;<span class="op" id="4176635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176639">err</span>&nbsp;<span class="op" id="4176643">=</span>&nbsp;<span class="ident" id="4176645">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176665">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176677">hash</span><span class="op" id="4176681">.</span><span class="ident" id="4176682">Write</span><span class="op" id="4176687">(</span><span class="ident" id="4176688">label</span><span class="op" id="4176693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176696">lHash</span>&nbsp;<span class="op" id="4176702">:=</span>&nbsp;<span class="ident" id="4176705">hash</span><span class="op" id="4176709">.</span><span class="ident" id="4176710">Sum</span><span class="op" id="4176713">(</span><span class="ident" id="4176714">nil</span><span class="op" id="4176717">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176720">hash</span><span class="op" id="4176724">.</span><span class="ident" id="4176725">Reset</span><span class="op" id="4176730">(</span><span class="op" id="4176731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176735">em</span>&nbsp;<span class="op" id="4176738">:=</span>&nbsp;<span class="builtinfunc" id="4176741">make</span><span class="op" id="4176745">(</span><span class="op" id="4176746">[</span><span class="op" id="4176747">]</span><span class="builtintype" id="4176748">byte</span><span class="op" id="4176752">,</span>&nbsp;<span class="ident" id="4176754">k</span><span class="op" id="4176755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176758">seed</span>&nbsp;<span class="op" id="4176763">:=</span>&nbsp;<span class="ident" id="4176766">em</span><span class="op" id="4176768">[</span><span class="num" id="4176769">1</span>&nbsp;<span class="op" id="4176771">:</span>&nbsp;<span class="num" id="4176773">1</span><span class="op" id="4176774">+</span><span class="ident" id="4176775">hash</span><span class="op" id="4176779">.</span><span class="ident" id="4176780">Size</span><span class="op" id="4176784">(</span><span class="op" id="4176785">)</span><span class="op" id="4176786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176789">db</span>&nbsp;<span class="op" id="4176792">:=</span>&nbsp;<span class="ident" id="4176795">em</span><span class="op" id="4176797">[</span><span class="num" id="4176798">1</span><span class="op" id="4176799">+</span><span class="ident" id="4176800">hash</span><span class="op" id="4176804">.</span><span class="ident" id="4176805">Size</span><span class="op" id="4176809">(</span><span class="op" id="4176810">)</span><span class="op" id="4176811">:</span><span class="op" id="4176812">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4176816">copy</span><span class="op" id="4176820">(</span><span class="ident" id="4176821">db</span><span class="op" id="4176823">[</span><span class="num" id="4176824">0</span><span class="op" id="4176825">:</span><span class="ident" id="4176826">hash</span><span class="op" id="4176830">.</span><span class="ident" id="4176831">Size</span><span class="op" id="4176835">(</span><span class="op" id="4176836">)</span><span class="op" id="4176837">]</span><span class="op" id="4176838">,</span>&nbsp;<span class="ident" id="4176840">lHash</span><span class="op" id="4176845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176848">db</span><span class="op" id="4176850">[</span><span class="builtinfunc" id="4176851">len</span><span class="op" id="4176854">(</span><span class="ident" id="4176855">db</span><span class="op" id="4176857">)</span><span class="op" id="4176858">-</span><span class="builtinfunc" id="4176859">len</span><span class="op" id="4176862">(</span><span class="ident" id="4176863">msg</span><span class="op" id="4176866">)</span><span class="op" id="4176867">-</span><span class="num" id="4176868">1</span><span class="op" id="4176869">]</span>&nbsp;<span class="op" id="4176871">=</span>&nbsp;<span class="num" id="4176873">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4176876">copy</span><span class="op" id="4176880">(</span><span class="ident" id="4176881">db</span><span class="op" id="4176883">[</span><span class="builtinfunc" id="4176884">len</span><span class="op" id="4176887">(</span><span class="ident" id="4176888">db</span><span class="op" id="4176890">)</span><span class="op" id="4176891">-</span><span class="builtinfunc" id="4176892">len</span><span class="op" id="4176895">(</span><span class="ident" id="4176896">msg</span><span class="op" id="4176899">)</span><span class="op" id="4176900">:</span><span class="op" id="4176901">]</span><span class="op" id="4176902">,</span>&nbsp;<span class="ident" id="4176904">msg</span><span class="op" id="4176907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176911">_</span><span class="op" id="4176912">,</span>&nbsp;<span class="ident" id="4176914">err</span>&nbsp;<span class="op" id="4176918">=</span>&nbsp;<span class="ident" id="4176920">io</span><span class="op" id="4176922">.</span><span class="ident" id="4176923">ReadFull</span><span class="op" id="4176931">(</span><span class="ident" id="4176932">random</span><span class="op" id="4176938">,</span>&nbsp;<span class="ident" id="4176940">seed</span><span class="op" id="4176944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176947">if</span>&nbsp;<span class="ident" id="4176950">err</span>&nbsp;<span class="op" id="4176954">!=</span>&nbsp;<span class="ident" id="4176957">nil</span>&nbsp;<span class="op" id="4176961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4176965">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176977">mgf1XOR</span><span class="op" id="4176984">(</span><span class="ident" id="4176985">db</span><span class="op" id="4176987">,</span>&nbsp;<span class="ident" id="4176989">hash</span><span class="op" id="4176993">,</span>&nbsp;<span class="ident" id="4176995">seed</span><span class="op" id="4176999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177002">mgf1XOR</span><span class="op" id="4177009">(</span><span class="ident" id="4177010">seed</span><span class="op" id="4177014">,</span>&nbsp;<span class="ident" id="4177016">hash</span><span class="op" id="4177020">,</span>&nbsp;<span class="ident" id="4177022">db</span><span class="op" id="4177024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177028">m</span>&nbsp;<span class="op" id="4177030">:=</span>&nbsp;<span class="builtinfunc" id="4177033">new</span><span class="op" id="4177036">(</span><span class="ident" id="4177037">big</span><span class="op" id="4177040">.</span><span class="ident" id="4177041">Int</span><span class="op" id="4177044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177047">m</span><span class="op" id="4177048">.</span><span class="ident" id="4177049">SetBytes</span><span class="op" id="4177057">(</span><span class="ident" id="4177058">em</span><span class="op" id="4177060">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177063">c</span>&nbsp;<span class="op" id="4177065">:=</span>&nbsp;<span class="ident" id="4177068">encrypt</span><span class="op" id="4177075">(</span><span class="builtinfunc" id="4177076">new</span><span class="op" id="4177079">(</span><span class="ident" id="4177080">big</span><span class="op" id="4177083">.</span><span class="ident" id="4177084">Int</span><span class="op" id="4177087">)</span><span class="op" id="4177088">,</span>&nbsp;<span class="ident" id="4177090">pub</span><span class="op" id="4177093">,</span>&nbsp;<span class="ident" id="4177095">m</span><span class="op" id="4177096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177099">out</span>&nbsp;<span class="op" id="4177103">=</span>&nbsp;<span class="ident" id="4177105">c</span><span class="op" id="4177106">.</span><span class="ident" id="4177107">Bytes</span><span class="op" id="4177112">(</span><span class="op" id="4177113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177117">if</span>&nbsp;<span class="builtinfunc" id="4177120">len</span><span class="op" id="4177123">(</span><span class="ident" id="4177124">out</span><span class="op" id="4177127">)</span>&nbsp;<span class="op" id="4177129">&lt;</span>&nbsp;<span class="ident" id="4177131">k</span>&nbsp;<span class="op" id="4177133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177137">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177202">t</span>&nbsp;<span class="op" id="4177204">:=</span>&nbsp;<span class="builtinfunc" id="4177207">make</span><span class="op" id="4177211">(</span><span class="op" id="4177212">[</span><span class="op" id="4177213">]</span><span class="builtintype" id="4177214">byte</span><span class="op" id="4177218">,</span>&nbsp;<span class="ident" id="4177220">k</span><span class="op" id="4177221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4177225">copy</span><span class="op" id="4177229">(</span><span class="ident" id="4177230">t</span><span class="op" id="4177231">[</span><span class="ident" id="4177232">k</span><span class="op" id="4177233">-</span><span class="builtinfunc" id="4177234">len</span><span class="op" id="4177237">(</span><span class="ident" id="4177238">out</span><span class="op" id="4177241">)</span><span class="op" id="4177242">:</span><span class="op" id="4177243">]</span><span class="op" id="4177244">,</span>&nbsp;<span class="ident" id="4177246">out</span><span class="op" id="4177249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177253">out</span>&nbsp;<span class="op" id="4177257">=</span>&nbsp;<span class="ident" id="4177259">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177266">return</span><br>
<span class="lineno"></span><span class="op" id="4177273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177276">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4177336">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4177391">var</span>&nbsp;<span class="ident" id="4177395">ErrDecryption</span>&nbsp;<span class="op" id="4177409">=</span>&nbsp;<span class="ident" id="4177411">errors</span><span class="op" id="4177417">.</span><span class="ident" id="4177418">New</span><span class="op" id="4177421">(</span><span class="string" id="4177422">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4177452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177455">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4177518">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4177573">var</span>&nbsp;<span class="ident" id="4177577">ErrVerification</span>&nbsp;<span class="op" id="4177593">=</span>&nbsp;<span class="ident" id="4177595">errors</span><span class="op" id="4177601">.</span><span class="ident" id="4177602">New</span><span class="op" id="4177605">(</span><span class="string" id="4177606">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4177638">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4177641">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4177721">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4177797">func</span>&nbsp;<span class="ident" id="4177802">modInverse</span><span class="op" id="4177812">(</span><span class="ident" id="4177813">a</span><span class="op" id="4177814">,</span>&nbsp;<span class="ident" id="4177816">n</span>&nbsp;<span class="op" id="4177818">*</span><span class="ident" id="4177819">big</span><span class="op" id="4177822">.</span><span class="ident" id="4177823">Int</span><span class="op" id="4177826">)</span>&nbsp;<span class="op" id="4177828">(</span><span class="ident" id="4177829">ia</span>&nbsp;<span class="op" id="4177832">*</span><span class="ident" id="4177833">big</span><span class="op" id="4177836">.</span><span class="ident" id="4177837">Int</span><span class="op" id="4177840">,</span>&nbsp;<span class="ident" id="4177842">ok</span>&nbsp;<span class="builtintype" id="4177845">bool</span><span class="op" id="4177849">)</span>&nbsp;<span class="op" id="4177851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177854">g</span>&nbsp;<span class="op" id="4177856">:=</span>&nbsp;<span class="builtinfunc" id="4177859">new</span><span class="op" id="4177862">(</span><span class="ident" id="4177863">big</span><span class="op" id="4177866">.</span><span class="ident" id="4177867">Int</span><span class="op" id="4177870">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177873">x</span>&nbsp;<span class="op" id="4177875">:=</span>&nbsp;<span class="builtinfunc" id="4177878">new</span><span class="op" id="4177881">(</span><span class="ident" id="4177882">big</span><span class="op" id="4177885">.</span><span class="ident" id="4177886">Int</span><span class="op" id="4177889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177892">y</span>&nbsp;<span class="op" id="4177894">:=</span>&nbsp;<span class="builtinfunc" id="4177897">new</span><span class="op" id="4177900">(</span><span class="ident" id="4177901">big</span><span class="op" id="4177904">.</span><span class="ident" id="4177905">Int</span><span class="op" id="4177908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177911">g</span><span class="op" id="4177912">.</span><span class="ident" id="4177913">GCD</span><span class="op" id="4177916">(</span><span class="ident" id="4177917">x</span><span class="op" id="4177918">,</span>&nbsp;<span class="ident" id="4177920">y</span><span class="op" id="4177921">,</span>&nbsp;<span class="ident" id="4177923">a</span><span class="op" id="4177924">,</span>&nbsp;<span class="ident" id="4177926">n</span><span class="op" id="4177927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4177930">if</span>&nbsp;<span class="ident" id="4177933">g</span><span class="op" id="4177934">.</span><span class="ident" id="4177935">Cmp</span><span class="op" id="4177938">(</span><span class="ident" id="4177939">bigOne</span><span class="op" id="4177945">)</span>&nbsp;<span class="op" id="4177947">!=</span>&nbsp;<span class="num" id="4177950">0</span>&nbsp;<span class="op" id="4177952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177956">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178022">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178088">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178151">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4178171">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178175">if</span>&nbsp;<span class="ident" id="4178178">x</span><span class="op" id="4178179">.</span><span class="ident" id="4178180">Cmp</span><span class="op" id="4178183">(</span><span class="ident" id="4178184">bigOne</span><span class="op" id="4178190">)</span>&nbsp;<span class="op" id="4178192">&lt;</span>&nbsp;<span class="num" id="4178194">0</span>&nbsp;<span class="op" id="4178196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178200">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178265">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178295">x</span><span class="op" id="4178296">.</span><span class="ident" id="4178297">Add</span><span class="op" id="4178300">(</span><span class="ident" id="4178301">x</span><span class="op" id="4178302">,</span>&nbsp;<span class="ident" id="4178304">n</span><span class="op" id="4178305">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4178308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178312">return</span>&nbsp;<span class="ident" id="4178319">x</span><span class="op" id="4178320">,</span>&nbsp;<span class="builtintype" id="4178322">true</span><br>
<span class="lineno"></span><span class="op" id="4178327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4178330">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4178408">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4178426">func</span>&nbsp;<span class="op" id="4178431">(</span><span class="ident" id="4178432">priv</span>&nbsp;<span class="op" id="4178437">*</span><span class="ident" id="4178438">PrivateKey</span><span class="op" id="4178448">)</span>&nbsp;<span class="ident" id="4178450">Precompute</span><span class="op" id="4178460">(</span><span class="op" id="4178461">)</span>&nbsp;<span class="op" id="4178463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178466">if</span>&nbsp;<span class="ident" id="4178469">priv</span><span class="op" id="4178473">.</span><span class="ident" id="4178474">Precomputed</span><span class="op" id="4178485">.</span><span class="ident" id="4178486">Dp</span>&nbsp;<span class="op" id="4178489">!=</span>&nbsp;<span class="ident" id="4178492">nil</span>&nbsp;<span class="op" id="4178496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178500">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4178508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178512">priv</span><span class="op" id="4178516">.</span><span class="ident" id="4178517">Precomputed</span><span class="op" id="4178528">.</span><span class="ident" id="4178529">Dp</span>&nbsp;<span class="op" id="4178532">=</span>&nbsp;<span class="builtinfunc" id="4178534">new</span><span class="op" id="4178537">(</span><span class="ident" id="4178538">big</span><span class="op" id="4178541">.</span><span class="ident" id="4178542">Int</span><span class="op" id="4178545">)</span><span class="op" id="4178546">.</span><span class="ident" id="4178547">Sub</span><span class="op" id="4178550">(</span><span class="ident" id="4178551">priv</span><span class="op" id="4178555">.</span><span class="ident" id="4178556">Primes</span><span class="op" id="4178562">[</span><span class="num" id="4178563">0</span><span class="op" id="4178564">]</span><span class="op" id="4178565">,</span>&nbsp;<span class="ident" id="4178567">bigOne</span><span class="op" id="4178573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178576">priv</span><span class="op" id="4178580">.</span><span class="ident" id="4178581">Precomputed</span><span class="op" id="4178592">.</span><span class="ident" id="4178593">Dp</span><span class="op" id="4178595">.</span><span class="ident" id="4178596">Mod</span><span class="op" id="4178599">(</span><span class="ident" id="4178600">priv</span><span class="op" id="4178604">.</span><span class="ident" id="4178605">D</span><span class="op" id="4178606">,</span>&nbsp;<span class="ident" id="4178608">priv</span><span class="op" id="4178612">.</span><span class="ident" id="4178613">Precomputed</span><span class="op" id="4178624">.</span><span class="ident" id="4178625">Dp</span><span class="op" id="4178627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178631">priv</span><span class="op" id="4178635">.</span><span class="ident" id="4178636">Precomputed</span><span class="op" id="4178647">.</span><span class="ident" id="4178648">Dq</span>&nbsp;<span class="op" id="4178651">=</span>&nbsp;<span class="builtinfunc" id="4178653">new</span><span class="op" id="4178656">(</span><span class="ident" id="4178657">big</span><span class="op" id="4178660">.</span><span class="ident" id="4178661">Int</span><span class="op" id="4178664">)</span><span class="op" id="4178665">.</span><span class="ident" id="4178666">Sub</span><span class="op" id="4178669">(</span><span class="ident" id="4178670">priv</span><span class="op" id="4178674">.</span><span class="ident" id="4178675">Primes</span><span class="op" id="4178681">[</span><span class="num" id="4178682">1</span><span class="op" id="4178683">]</span><span class="op" id="4178684">,</span>&nbsp;<span class="ident" id="4178686">bigOne</span><span class="op" id="4178692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178695">priv</span><span class="op" id="4178699">.</span><span class="ident" id="4178700">Precomputed</span><span class="op" id="4178711">.</span><span class="ident" id="4178712">Dq</span><span class="op" id="4178714">.</span><span class="ident" id="4178715">Mod</span><span class="op" id="4178718">(</span><span class="ident" id="4178719">priv</span><span class="op" id="4178723">.</span><span class="ident" id="4178724">D</span><span class="op" id="4178725">,</span>&nbsp;<span class="ident" id="4178727">priv</span><span class="op" id="4178731">.</span><span class="ident" id="4178732">Precomputed</span><span class="op" id="4178743">.</span><span class="ident" id="4178744">Dq</span><span class="op" id="4178746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178750">priv</span><span class="op" id="4178754">.</span><span class="ident" id="4178755">Precomputed</span><span class="op" id="4178766">.</span><span class="ident" id="4178767">Qinv</span>&nbsp;<span class="op" id="4178772">=</span>&nbsp;<span class="builtinfunc" id="4178774">new</span><span class="op" id="4178777">(</span><span class="ident" id="4178778">big</span><span class="op" id="4178781">.</span><span class="ident" id="4178782">Int</span><span class="op" id="4178785">)</span><span class="op" id="4178786">.</span><span class="ident" id="4178787">ModInverse</span><span class="op" id="4178797">(</span><span class="ident" id="4178798">priv</span><span class="op" id="4178802">.</span><span class="ident" id="4178803">Primes</span><span class="op" id="4178809">[</span><span class="num" id="4178810">1</span><span class="op" id="4178811">]</span><span class="op" id="4178812">,</span>&nbsp;<span class="ident" id="4178814">priv</span><span class="op" id="4178818">.</span><span class="ident" id="4178819">Primes</span><span class="op" id="4178825">[</span><span class="num" id="4178826">0</span><span class="op" id="4178827">]</span><span class="op" id="4178828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178832">r</span>&nbsp;<span class="op" id="4178834">:=</span>&nbsp;<span class="builtinfunc" id="4178837">new</span><span class="op" id="4178840">(</span><span class="ident" id="4178841">big</span><span class="op" id="4178844">.</span><span class="ident" id="4178845">Int</span><span class="op" id="4178848">)</span><span class="op" id="4178849">.</span><span class="ident" id="4178850">Mul</span><span class="op" id="4178853">(</span><span class="ident" id="4178854">priv</span><span class="op" id="4178858">.</span><span class="ident" id="4178859">Primes</span><span class="op" id="4178865">[</span><span class="num" id="4178866">0</span><span class="op" id="4178867">]</span><span class="op" id="4178868">,</span>&nbsp;<span class="ident" id="4178870">priv</span><span class="op" id="4178874">.</span><span class="ident" id="4178875">Primes</span><span class="op" id="4178881">[</span><span class="num" id="4178882">1</span><span class="op" id="4178883">]</span><span class="op" id="4178884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178887">priv</span><span class="op" id="4178891">.</span><span class="ident" id="4178892">Precomputed</span><span class="op" id="4178903">.</span><span class="ident" id="4178904">CRTValues</span>&nbsp;<span class="op" id="4178914">=</span>&nbsp;<span class="builtinfunc" id="4178916">make</span><span class="op" id="4178920">(</span><span class="op" id="4178921">[</span><span class="op" id="4178922">]</span><span class="ident" id="4178923">CRTValue</span><span class="op" id="4178931">,</span>&nbsp;<span class="builtinfunc" id="4178933">len</span><span class="op" id="4178936">(</span><span class="ident" id="4178937">priv</span><span class="op" id="4178941">.</span><span class="ident" id="4178942">Primes</span><span class="op" id="4178948">)</span><span class="op" id="4178949">-</span><span class="num" id="4178950">2</span><span class="op" id="4178951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4178954">for</span>&nbsp;<span class="ident" id="4178958">i</span>&nbsp;<span class="op" id="4178960">:=</span>&nbsp;<span class="num" id="4178963">2</span><span class="op" id="4178964">;</span>&nbsp;<span class="ident" id="4178966">i</span>&nbsp;<span class="op" id="4178968">&lt;</span>&nbsp;<span class="builtinfunc" id="4178970">len</span><span class="op" id="4178973">(</span><span class="ident" id="4178974">priv</span><span class="op" id="4178978">.</span><span class="ident" id="4178979">Primes</span><span class="op" id="4178985">)</span><span class="op" id="4178986">;</span>&nbsp;<span class="ident" id="4178988">i</span><span class="op" id="4178989">++</span>&nbsp;<span class="op" id="4178992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178996">prime</span>&nbsp;<span class="op" id="4179002">:=</span>&nbsp;<span class="ident" id="4179005">priv</span><span class="op" id="4179009">.</span><span class="ident" id="4179010">Primes</span><span class="op" id="4179016">[</span><span class="ident" id="4179017">i</span><span class="op" id="4179018">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179022">values</span>&nbsp;<span class="op" id="4179029">:=</span>&nbsp;<span class="op" id="4179032">&amp;</span><span class="ident" id="4179033">priv</span><span class="op" id="4179037">.</span><span class="ident" id="4179038">Precomputed</span><span class="op" id="4179049">.</span><span class="ident" id="4179050">CRTValues</span><span class="op" id="4179059">[</span><span class="ident" id="4179060">i</span><span class="op" id="4179061">-</span><span class="num" id="4179062">2</span><span class="op" id="4179063">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179068">values</span><span class="op" id="4179074">.</span><span class="ident" id="4179075">Exp</span>&nbsp;<span class="op" id="4179079">=</span>&nbsp;<span class="builtinfunc" id="4179081">new</span><span class="op" id="4179084">(</span><span class="ident" id="4179085">big</span><span class="op" id="4179088">.</span><span class="ident" id="4179089">Int</span><span class="op" id="4179092">)</span><span class="op" id="4179093">.</span><span class="ident" id="4179094">Sub</span><span class="op" id="4179097">(</span><span class="ident" id="4179098">prime</span><span class="op" id="4179103">,</span>&nbsp;<span class="ident" id="4179105">bigOne</span><span class="op" id="4179111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179115">values</span><span class="op" id="4179121">.</span><span class="ident" id="4179122">Exp</span><span class="op" id="4179125">.</span><span class="ident" id="4179126">Mod</span><span class="op" id="4179129">(</span><span class="ident" id="4179130">priv</span><span class="op" id="4179134">.</span><span class="ident" id="4179135">D</span><span class="op" id="4179136">,</span>&nbsp;<span class="ident" id="4179138">values</span><span class="op" id="4179144">.</span><span class="ident" id="4179145">Exp</span><span class="op" id="4179148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179153">values</span><span class="op" id="4179159">.</span><span class="ident" id="4179160">R</span>&nbsp;<span class="op" id="4179162">=</span>&nbsp;<span class="builtinfunc" id="4179164">new</span><span class="op" id="4179167">(</span><span class="ident" id="4179168">big</span><span class="op" id="4179171">.</span><span class="ident" id="4179172">Int</span><span class="op" id="4179175">)</span><span class="op" id="4179176">.</span><span class="ident" id="4179177">Set</span><span class="op" id="4179180">(</span><span class="ident" id="4179181">r</span><span class="op" id="4179182">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179186">values</span><span class="op" id="4179192">.</span><span class="ident" id="4179193">Coeff</span>&nbsp;<span class="op" id="4179199">=</span>&nbsp;<span class="builtinfunc" id="4179201">new</span><span class="op" id="4179204">(</span><span class="ident" id="4179205">big</span><span class="op" id="4179208">.</span><span class="ident" id="4179209">Int</span><span class="op" id="4179212">)</span><span class="op" id="4179213">.</span><span class="ident" id="4179214">ModInverse</span><span class="op" id="4179224">(</span><span class="ident" id="4179225">r</span><span class="op" id="4179226">,</span>&nbsp;<span class="ident" id="4179228">prime</span><span class="op" id="4179233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179238">r</span><span class="op" id="4179239">.</span><span class="ident" id="4179240">Mul</span><span class="op" id="4179243">(</span><span class="ident" id="4179244">r</span><span class="op" id="4179245">,</span>&nbsp;<span class="ident" id="4179247">prime</span><span class="op" id="4179252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179255">}</span><br>
<span class="lineno"></span><span class="op" id="4179257">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4179260">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4179338">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4179387">func</span>&nbsp;<span class="ident" id="4179392">decrypt</span><span class="op" id="4179399">(</span><span class="ident" id="4179400">random</span>&nbsp;<span class="ident" id="4179407">io</span><span class="op" id="4179409">.</span><span class="ident" id="4179410">Reader</span><span class="op" id="4179416">,</span>&nbsp;<span class="ident" id="4179418">priv</span>&nbsp;<span class="op" id="4179423">*</span><span class="ident" id="4179424">PrivateKey</span><span class="op" id="4179434">,</span>&nbsp;<span class="ident" id="4179436">c</span>&nbsp;<span class="op" id="4179438">*</span><span class="ident" id="4179439">big</span><span class="op" id="4179442">.</span><span class="ident" id="4179443">Int</span><span class="op" id="4179446">)</span>&nbsp;<span class="op" id="4179448">(</span><span class="ident" id="4179449">m</span>&nbsp;<span class="op" id="4179451">*</span><span class="ident" id="4179452">big</span><span class="op" id="4179455">.</span><span class="ident" id="4179456">Int</span><span class="op" id="4179459">,</span>&nbsp;<span class="ident" id="4179461">err</span>&nbsp;<span class="builtintype" id="4179465">error</span><span class="op" id="4179470">)</span>&nbsp;<span class="op" id="4179472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179475">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179527">if</span>&nbsp;<span class="ident" id="4179530">c</span><span class="op" id="4179531">.</span><span class="ident" id="4179532">Cmp</span><span class="op" id="4179535">(</span><span class="ident" id="4179536">priv</span><span class="op" id="4179540">.</span><span class="ident" id="4179541">N</span><span class="op" id="4179542">)</span>&nbsp;<span class="op" id="4179544">&gt;</span>&nbsp;<span class="num" id="4179546">0</span>&nbsp;<span class="op" id="4179548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179552">err</span>&nbsp;<span class="op" id="4179556">=</span>&nbsp;<span class="ident" id="4179558">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179574">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179586">var</span>&nbsp;<span class="ident" id="4179590">ir</span>&nbsp;<span class="op" id="4179593">*</span><span class="ident" id="4179594">big</span><span class="op" id="4179597">.</span><span class="ident" id="4179598">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179603">if</span>&nbsp;<span class="ident" id="4179606">random</span>&nbsp;<span class="op" id="4179613">!=</span>&nbsp;<span class="ident" id="4179616">nil</span>&nbsp;<span class="op" id="4179620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179624">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179687">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179751">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179815">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179872">var</span>&nbsp;<span class="ident" id="4179876">r</span>&nbsp;<span class="op" id="4179878">*</span><span class="ident" id="4179879">big</span><span class="op" id="4179882">.</span><span class="ident" id="4179883">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179890">for</span>&nbsp;<span class="op" id="4179894">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179899">r</span><span class="op" id="4179900">,</span>&nbsp;<span class="ident" id="4179902">err</span>&nbsp;<span class="op" id="4179906">=</span>&nbsp;<span class="ident" id="4179908">rand</span><span class="op" id="4179912">.</span><span class="ident" id="4179913">Int</span><span class="op" id="4179916">(</span><span class="ident" id="4179917">random</span><span class="op" id="4179923">,</span>&nbsp;<span class="ident" id="4179925">priv</span><span class="op" id="4179929">.</span><span class="ident" id="4179930">N</span><span class="op" id="4179931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179936">if</span>&nbsp;<span class="ident" id="4179939">err</span>&nbsp;<span class="op" id="4179943">!=</span>&nbsp;<span class="ident" id="4179946">nil</span>&nbsp;<span class="op" id="4179950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179956">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4179966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4179971">if</span>&nbsp;<span class="ident" id="4179974">r</span><span class="op" id="4179975">.</span><span class="ident" id="4179976">Cmp</span><span class="op" id="4179979">(</span><span class="ident" id="4179980">bigZero</span><span class="op" id="4179987">)</span>&nbsp;<span class="op" id="4179989">==</span>&nbsp;<span class="num" id="4179992">0</span>&nbsp;<span class="op" id="4179994">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180000">r</span>&nbsp;<span class="op" id="4180002">=</span>&nbsp;<span class="ident" id="4180004">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180019">var</span>&nbsp;<span class="ident" id="4180023">ok</span>&nbsp;<span class="builtintype" id="4180026">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180034">ir</span><span class="op" id="4180036">,</span>&nbsp;<span class="ident" id="4180038">ok</span>&nbsp;<span class="op" id="4180041">=</span>&nbsp;<span class="ident" id="4180043">modInverse</span><span class="op" id="4180053">(</span><span class="ident" id="4180054">r</span><span class="op" id="4180055">,</span>&nbsp;<span class="ident" id="4180057">priv</span><span class="op" id="4180061">.</span><span class="ident" id="4180062">N</span><span class="op" id="4180063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180068">if</span>&nbsp;<span class="ident" id="4180071">ok</span>&nbsp;<span class="op" id="4180074">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180097">bigE</span>&nbsp;<span class="op" id="4180102">:=</span>&nbsp;<span class="ident" id="4180105">big</span><span class="op" id="4180108">.</span><span class="ident" id="4180109">NewInt</span><span class="op" id="4180115">(</span><span class="ident" id="4180116">int64</span><span class="op" id="4180121">(</span><span class="ident" id="4180122">priv</span><span class="op" id="4180126">.</span><span class="ident" id="4180127">E</span><span class="op" id="4180128">)</span><span class="op" id="4180129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180133">rpowe</span>&nbsp;<span class="op" id="4180139">:=</span>&nbsp;<span class="builtinfunc" id="4180142">new</span><span class="op" id="4180145">(</span><span class="ident" id="4180146">big</span><span class="op" id="4180149">.</span><span class="ident" id="4180150">Int</span><span class="op" id="4180153">)</span><span class="op" id="4180154">.</span><span class="ident" id="4180155">Exp</span><span class="op" id="4180158">(</span><span class="ident" id="4180159">r</span><span class="op" id="4180160">,</span>&nbsp;<span class="ident" id="4180162">bigE</span><span class="op" id="4180166">,</span>&nbsp;<span class="ident" id="4180168">priv</span><span class="op" id="4180172">.</span><span class="ident" id="4180173">N</span><span class="op" id="4180174">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180178">cCopy</span>&nbsp;<span class="op" id="4180184">:=</span>&nbsp;<span class="builtinfunc" id="4180187">new</span><span class="op" id="4180190">(</span><span class="ident" id="4180191">big</span><span class="op" id="4180194">.</span><span class="ident" id="4180195">Int</span><span class="op" id="4180198">)</span><span class="op" id="4180199">.</span><span class="ident" id="4180200">Set</span><span class="op" id="4180203">(</span><span class="ident" id="4180204">c</span><span class="op" id="4180205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180209">cCopy</span><span class="op" id="4180214">.</span><span class="ident" id="4180215">Mul</span><span class="op" id="4180218">(</span><span class="ident" id="4180219">cCopy</span><span class="op" id="4180224">,</span>&nbsp;<span class="ident" id="4180226">rpowe</span><span class="op" id="4180231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180235">cCopy</span><span class="op" id="4180240">.</span><span class="ident" id="4180241">Mod</span><span class="op" id="4180244">(</span><span class="ident" id="4180245">cCopy</span><span class="op" id="4180250">,</span>&nbsp;<span class="ident" id="4180252">priv</span><span class="op" id="4180256">.</span><span class="ident" id="4180257">N</span><span class="op" id="4180258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180262">c</span>&nbsp;<span class="op" id="4180264">=</span>&nbsp;<span class="ident" id="4180266">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180273">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180277">if</span>&nbsp;<span class="ident" id="4180280">priv</span><span class="op" id="4180284">.</span><span class="ident" id="4180285">Precomputed</span><span class="op" id="4180296">.</span><span class="ident" id="4180297">Dp</span>&nbsp;<span class="op" id="4180300">==</span>&nbsp;<span class="ident" id="4180303">nil</span>&nbsp;<span class="op" id="4180307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180311">m</span>&nbsp;<span class="op" id="4180313">=</span>&nbsp;<span class="builtinfunc" id="4180315">new</span><span class="op" id="4180318">(</span><span class="ident" id="4180319">big</span><span class="op" id="4180322">.</span><span class="ident" id="4180323">Int</span><span class="op" id="4180326">)</span><span class="op" id="4180327">.</span><span class="ident" id="4180328">Exp</span><span class="op" id="4180331">(</span><span class="ident" id="4180332">c</span><span class="op" id="4180333">,</span>&nbsp;<span class="ident" id="4180335">priv</span><span class="op" id="4180339">.</span><span class="ident" id="4180340">D</span><span class="op" id="4180341">,</span>&nbsp;<span class="ident" id="4180343">priv</span><span class="op" id="4180347">.</span><span class="ident" id="4180348">N</span><span class="op" id="4180349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180352">}</span>&nbsp;<span class="keyword" id="4180354">else</span>&nbsp;<span class="op" id="4180359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180363">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180421">m</span>&nbsp;<span class="op" id="4180423">=</span>&nbsp;<span class="builtinfunc" id="4180425">new</span><span class="op" id="4180428">(</span><span class="ident" id="4180429">big</span><span class="op" id="4180432">.</span><span class="ident" id="4180433">Int</span><span class="op" id="4180436">)</span><span class="op" id="4180437">.</span><span class="ident" id="4180438">Exp</span><span class="op" id="4180441">(</span><span class="ident" id="4180442">c</span><span class="op" id="4180443">,</span>&nbsp;<span class="ident" id="4180445">priv</span><span class="op" id="4180449">.</span><span class="ident" id="4180450">Precomputed</span><span class="op" id="4180461">.</span><span class="ident" id="4180462">Dp</span><span class="op" id="4180464">,</span>&nbsp;<span class="ident" id="4180466">priv</span><span class="op" id="4180470">.</span><span class="ident" id="4180471">Primes</span><span class="op" id="4180477">[</span><span class="num" id="4180478">0</span><span class="op" id="4180479">]</span><span class="op" id="4180480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180484">m2</span>&nbsp;<span class="op" id="4180487">:=</span>&nbsp;<span class="builtinfunc" id="4180490">new</span><span class="op" id="4180493">(</span><span class="ident" id="4180494">big</span><span class="op" id="4180497">.</span><span class="ident" id="4180498">Int</span><span class="op" id="4180501">)</span><span class="op" id="4180502">.</span><span class="ident" id="4180503">Exp</span><span class="op" id="4180506">(</span><span class="ident" id="4180507">c</span><span class="op" id="4180508">,</span>&nbsp;<span class="ident" id="4180510">priv</span><span class="op" id="4180514">.</span><span class="ident" id="4180515">Precomputed</span><span class="op" id="4180526">.</span><span class="ident" id="4180527">Dq</span><span class="op" id="4180529">,</span>&nbsp;<span class="ident" id="4180531">priv</span><span class="op" id="4180535">.</span><span class="ident" id="4180536">Primes</span><span class="op" id="4180542">[</span><span class="num" id="4180543">1</span><span class="op" id="4180544">]</span><span class="op" id="4180545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180549">m</span><span class="op" id="4180550">.</span><span class="ident" id="4180551">Sub</span><span class="op" id="4180554">(</span><span class="ident" id="4180555">m</span><span class="op" id="4180556">,</span>&nbsp;<span class="ident" id="4180558">m2</span><span class="op" id="4180560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180564">if</span>&nbsp;<span class="ident" id="4180567">m</span><span class="op" id="4180568">.</span><span class="ident" id="4180569">Sign</span><span class="op" id="4180573">(</span><span class="op" id="4180574">)</span>&nbsp;<span class="op" id="4180576">&lt;</span>&nbsp;<span class="num" id="4180578">0</span>&nbsp;<span class="op" id="4180580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180585">m</span><span class="op" id="4180586">.</span><span class="ident" id="4180587">Add</span><span class="op" id="4180590">(</span><span class="ident" id="4180591">m</span><span class="op" id="4180592">,</span>&nbsp;<span class="ident" id="4180594">priv</span><span class="op" id="4180598">.</span><span class="ident" id="4180599">Primes</span><span class="op" id="4180605">[</span><span class="num" id="4180606">0</span><span class="op" id="4180607">]</span><span class="op" id="4180608">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180616">m</span><span class="op" id="4180617">.</span><span class="ident" id="4180618">Mul</span><span class="op" id="4180621">(</span><span class="ident" id="4180622">m</span><span class="op" id="4180623">,</span>&nbsp;<span class="ident" id="4180625">priv</span><span class="op" id="4180629">.</span><span class="ident" id="4180630">Precomputed</span><span class="op" id="4180641">.</span><span class="ident" id="4180642">Qinv</span><span class="op" id="4180646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180650">m</span><span class="op" id="4180651">.</span><span class="ident" id="4180652">Mod</span><span class="op" id="4180655">(</span><span class="ident" id="4180656">m</span><span class="op" id="4180657">,</span>&nbsp;<span class="ident" id="4180659">priv</span><span class="op" id="4180663">.</span><span class="ident" id="4180664">Primes</span><span class="op" id="4180670">[</span><span class="num" id="4180671">0</span><span class="op" id="4180672">]</span><span class="op" id="4180673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180677">m</span><span class="op" id="4180678">.</span><span class="ident" id="4180679">Mul</span><span class="op" id="4180682">(</span><span class="ident" id="4180683">m</span><span class="op" id="4180684">,</span>&nbsp;<span class="ident" id="4180686">priv</span><span class="op" id="4180690">.</span><span class="ident" id="4180691">Primes</span><span class="op" id="4180697">[</span><span class="num" id="4180698">1</span><span class="op" id="4180699">]</span><span class="op" id="4180700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180704">m</span><span class="op" id="4180705">.</span><span class="ident" id="4180706">Add</span><span class="op" id="4180709">(</span><span class="ident" id="4180710">m</span><span class="op" id="4180711">,</span>&nbsp;<span class="ident" id="4180713">m2</span><span class="op" id="4180715">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180720">for</span>&nbsp;<span class="ident" id="4180724">i</span><span class="op" id="4180725">,</span>&nbsp;<span class="ident" id="4180727">values</span>&nbsp;<span class="op" id="4180734">:=</span>&nbsp;<span class="keyword" id="4180737">range</span>&nbsp;<span class="ident" id="4180743">priv</span><span class="op" id="4180747">.</span><span class="ident" id="4180748">Precomputed</span><span class="op" id="4180759">.</span><span class="ident" id="4180760">CRTValues</span>&nbsp;<span class="op" id="4180770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180775">prime</span>&nbsp;<span class="op" id="4180781">:=</span>&nbsp;<span class="ident" id="4180784">priv</span><span class="op" id="4180788">.</span><span class="ident" id="4180789">Primes</span><span class="op" id="4180795">[</span><span class="num" id="4180796">2</span><span class="op" id="4180797">+</span><span class="ident" id="4180798">i</span><span class="op" id="4180799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180804">m2</span><span class="op" id="4180806">.</span><span class="ident" id="4180807">Exp</span><span class="op" id="4180810">(</span><span class="ident" id="4180811">c</span><span class="op" id="4180812">,</span>&nbsp;<span class="ident" id="4180814">values</span><span class="op" id="4180820">.</span><span class="ident" id="4180821">Exp</span><span class="op" id="4180824">,</span>&nbsp;<span class="ident" id="4180826">prime</span><span class="op" id="4180831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180836">m2</span><span class="op" id="4180838">.</span><span class="ident" id="4180839">Sub</span><span class="op" id="4180842">(</span><span class="ident" id="4180843">m2</span><span class="op" id="4180845">,</span>&nbsp;<span class="ident" id="4180847">m</span><span class="op" id="4180848">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180853">m2</span><span class="op" id="4180855">.</span><span class="ident" id="4180856">Mul</span><span class="op" id="4180859">(</span><span class="ident" id="4180860">m2</span><span class="op" id="4180862">,</span>&nbsp;<span class="ident" id="4180864">values</span><span class="op" id="4180870">.</span><span class="ident" id="4180871">Coeff</span><span class="op" id="4180876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180881">m2</span><span class="op" id="4180883">.</span><span class="ident" id="4180884">Mod</span><span class="op" id="4180887">(</span><span class="ident" id="4180888">m2</span><span class="op" id="4180890">,</span>&nbsp;<span class="ident" id="4180892">prime</span><span class="op" id="4180897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180902">if</span>&nbsp;<span class="ident" id="4180905">m2</span><span class="op" id="4180907">.</span><span class="ident" id="4180908">Sign</span><span class="op" id="4180912">(</span><span class="op" id="4180913">)</span>&nbsp;<span class="op" id="4180915">&lt;</span>&nbsp;<span class="num" id="4180917">0</span>&nbsp;<span class="op" id="4180919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180925">m2</span><span class="op" id="4180927">.</span><span class="ident" id="4180928">Add</span><span class="op" id="4180931">(</span><span class="ident" id="4180932">m2</span><span class="op" id="4180934">,</span>&nbsp;<span class="ident" id="4180936">prime</span><span class="op" id="4180941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180946">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180951">m2</span><span class="op" id="4180953">.</span><span class="ident" id="4180954">Mul</span><span class="op" id="4180957">(</span><span class="ident" id="4180958">m2</span><span class="op" id="4180960">,</span>&nbsp;<span class="ident" id="4180962">values</span><span class="op" id="4180968">.</span><span class="ident" id="4180969">R</span><span class="op" id="4180970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180975">m</span><span class="op" id="4180976">.</span><span class="ident" id="4180977">Add</span><span class="op" id="4180980">(</span><span class="ident" id="4180981">m</span><span class="op" id="4180982">,</span>&nbsp;<span class="ident" id="4180984">m2</span><span class="op" id="4180986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4180993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4180997">if</span>&nbsp;<span class="ident" id="4181000">ir</span>&nbsp;<span class="op" id="4181003">!=</span>&nbsp;<span class="ident" id="4181006">nil</span>&nbsp;<span class="op" id="4181010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181014">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181028">m</span><span class="op" id="4181029">.</span><span class="ident" id="4181030">Mul</span><span class="op" id="4181033">(</span><span class="ident" id="4181034">m</span><span class="op" id="4181035">,</span>&nbsp;<span class="ident" id="4181037">ir</span><span class="op" id="4181039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181043">m</span><span class="op" id="4181044">.</span><span class="ident" id="4181045">Mod</span><span class="op" id="4181048">(</span><span class="ident" id="4181049">m</span><span class="op" id="4181050">,</span>&nbsp;<span class="ident" id="4181052">priv</span><span class="op" id="4181056">.</span><span class="ident" id="4181057">N</span><span class="op" id="4181058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4181061">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181065">return</span><br>
<span class="lineno"></span><span class="op" id="4181072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4181075">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4181126">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4181215">func</span>&nbsp;<span class="ident" id="4181220">DecryptOAEP</span><span class="op" id="4181231">(</span><span class="ident" id="4181232">hash</span>&nbsp;<span class="ident" id="4181237">hash</span><span class="op" id="4181241">.</span><span class="ident" id="4181242">Hash</span><span class="op" id="4181246">,</span>&nbsp;<span class="ident" id="4181248">random</span>&nbsp;<span class="ident" id="4181255">io</span><span class="op" id="4181257">.</span><span class="ident" id="4181258">Reader</span><span class="op" id="4181264">,</span>&nbsp;<span class="ident" id="4181266">priv</span>&nbsp;<span class="op" id="4181271">*</span><span class="ident" id="4181272">PrivateKey</span><span class="op" id="4181282">,</span>&nbsp;<span class="ident" id="4181284">ciphertext</span>&nbsp;<span class="op" id="4181295">[</span><span class="op" id="4181296">]</span><span class="builtintype" id="4181297">byte</span><span class="op" id="4181301">,</span>&nbsp;<span class="ident" id="4181303">label</span>&nbsp;<span class="op" id="4181309">[</span><span class="op" id="4181310">]</span><span class="builtintype" id="4181311">byte</span><span class="op" id="4181315">)</span>&nbsp;<span class="op" id="4181317">(</span><span class="ident" id="4181318">msg</span>&nbsp;<span class="op" id="4181322">[</span><span class="op" id="4181323">]</span><span class="builtintype" id="4181324">byte</span><span class="op" id="4181328">,</span>&nbsp;<span class="ident" id="4181330">err</span>&nbsp;<span class="builtintype" id="4181334">error</span><span class="op" id="4181339">)</span>&nbsp;<span class="op" id="4181341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181344">if</span>&nbsp;<span class="ident" id="4181347">err</span>&nbsp;<span class="op" id="4181351">:=</span>&nbsp;<span class="ident" id="4181354">checkPub</span><span class="op" id="4181362">(</span><span class="op" id="4181363">&amp;</span><span class="ident" id="4181364">priv</span><span class="op" id="4181368">.</span><span class="ident" id="4181369">PublicKey</span><span class="op" id="4181378">)</span><span class="op" id="4181379">;</span>&nbsp;<span class="ident" id="4181381">err</span>&nbsp;<span class="op" id="4181385">!=</span>&nbsp;<span class="ident" id="4181388">nil</span>&nbsp;<span class="op" id="4181392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181396">return</span>&nbsp;<span class="ident" id="4181403">nil</span><span class="op" id="4181406">,</span>&nbsp;<span class="ident" id="4181408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4181413">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181416">k</span>&nbsp;<span class="op" id="4181418">:=</span>&nbsp;<span class="op" id="4181421">(</span><span class="ident" id="4181422">priv</span><span class="op" id="4181426">.</span><span class="ident" id="4181427">N</span><span class="op" id="4181428">.</span><span class="ident" id="4181429">BitLen</span><span class="op" id="4181435">(</span><span class="op" id="4181436">)</span>&nbsp;<span class="op" id="4181438">+</span>&nbsp;<span class="num" id="4181440">7</span><span class="op" id="4181441">)</span>&nbsp;<span class="op" id="4181443">/</span>&nbsp;<span class="num" id="4181445">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181448">if</span>&nbsp;<span class="builtinfunc" id="4181451">len</span><span class="op" id="4181454">(</span><span class="ident" id="4181455">ciphertext</span><span class="op" id="4181465">)</span>&nbsp;<span class="op" id="4181467">&gt;</span>&nbsp;<span class="ident" id="4181469">k</span>&nbsp;<span class="op" id="4181471">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181476">k</span>&nbsp;<span class="op" id="4181478">&lt;</span>&nbsp;<span class="ident" id="4181480">hash</span><span class="op" id="4181484">.</span><span class="ident" id="4181485">Size</span><span class="op" id="4181489">(</span><span class="op" id="4181490">)</span><span class="op" id="4181491">*</span><span class="num" id="4181492">2</span><span class="op" id="4181493">+</span><span class="num" id="4181494">2</span>&nbsp;<span class="op" id="4181496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181500">err</span>&nbsp;<span class="op" id="4181504">=</span>&nbsp;<span class="ident" id="4181506">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181522">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4181530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181534">c</span>&nbsp;<span class="op" id="4181536">:=</span>&nbsp;<span class="builtinfunc" id="4181539">new</span><span class="op" id="4181542">(</span><span class="ident" id="4181543">big</span><span class="op" id="4181546">.</span><span class="ident" id="4181547">Int</span><span class="op" id="4181550">)</span><span class="op" id="4181551">.</span><span class="ident" id="4181552">SetBytes</span><span class="op" id="4181560">(</span><span class="ident" id="4181561">ciphertext</span><span class="op" id="4181571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181575">m</span><span class="op" id="4181576">,</span>&nbsp;<span class="ident" id="4181578">err</span>&nbsp;<span class="op" id="4181582">:=</span>&nbsp;<span class="ident" id="4181585">decrypt</span><span class="op" id="4181592">(</span><span class="ident" id="4181593">random</span><span class="op" id="4181599">,</span>&nbsp;<span class="ident" id="4181601">priv</span><span class="op" id="4181605">,</span>&nbsp;<span class="ident" id="4181607">c</span><span class="op" id="4181608">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181611">if</span>&nbsp;<span class="ident" id="4181614">err</span>&nbsp;<span class="op" id="4181618">!=</span>&nbsp;<span class="ident" id="4181621">nil</span>&nbsp;<span class="op" id="4181625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4181629">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4181637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181641">hash</span><span class="op" id="4181645">.</span><span class="ident" id="4181646">Write</span><span class="op" id="4181651">(</span><span class="ident" id="4181652">label</span><span class="op" id="4181657">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181660">lHash</span>&nbsp;<span class="op" id="4181666">:=</span>&nbsp;<span class="ident" id="4181669">hash</span><span class="op" id="4181673">.</span><span class="ident" id="4181674">Sum</span><span class="op" id="4181677">(</span><span class="ident" id="4181678">nil</span><span class="op" id="4181681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181684">hash</span><span class="op" id="4181688">.</span><span class="ident" id="4181689">Reset</span><span class="op" id="4181694">(</span><span class="op" id="4181695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181699">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181759">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181832">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181901">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181969">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181995">em</span>&nbsp;<span class="op" id="4181998">:=</span>&nbsp;<span class="ident" id="4182001">leftPad</span><span class="op" id="4182008">(</span><span class="ident" id="4182009">m</span><span class="op" id="4182010">.</span><span class="ident" id="4182011">Bytes</span><span class="op" id="4182016">(</span><span class="op" id="4182017">)</span><span class="op" id="4182018">,</span>&nbsp;<span class="ident" id="4182020">k</span><span class="op" id="4182021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182025">firstByteIsZero</span>&nbsp;<span class="op" id="4182041">:=</span>&nbsp;<span class="ident" id="4182044">subtle</span><span class="op" id="4182050">.</span><span class="ident" id="4182051">ConstantTimeByteEq</span><span class="op" id="4182069">(</span><span class="ident" id="4182070">em</span><span class="op" id="4182072">[</span><span class="num" id="4182073">0</span><span class="op" id="4182074">]</span><span class="op" id="4182075">,</span>&nbsp;<span class="num" id="4182077">0</span><span class="op" id="4182078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182082">seed</span>&nbsp;<span class="op" id="4182087">:=</span>&nbsp;<span class="ident" id="4182090">em</span><span class="op" id="4182092">[</span><span class="num" id="4182093">1</span>&nbsp;<span class="op" id="4182095">:</span>&nbsp;<span class="ident" id="4182097">hash</span><span class="op" id="4182101">.</span><span class="ident" id="4182102">Size</span><span class="op" id="4182106">(</span><span class="op" id="4182107">)</span><span class="op" id="4182108">+</span><span class="num" id="4182109">1</span><span class="op" id="4182110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182113">db</span>&nbsp;<span class="op" id="4182116">:=</span>&nbsp;<span class="ident" id="4182119">em</span><span class="op" id="4182121">[</span><span class="ident" id="4182122">hash</span><span class="op" id="4182126">.</span><span class="ident" id="4182127">Size</span><span class="op" id="4182131">(</span><span class="op" id="4182132">)</span><span class="op" id="4182133">+</span><span class="num" id="4182134">1</span><span class="op" id="4182135">:</span><span class="op" id="4182136">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182140">mgf1XOR</span><span class="op" id="4182147">(</span><span class="ident" id="4182148">seed</span><span class="op" id="4182152">,</span>&nbsp;<span class="ident" id="4182154">hash</span><span class="op" id="4182158">,</span>&nbsp;<span class="ident" id="4182160">db</span><span class="op" id="4182162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182165">mgf1XOR</span><span class="op" id="4182172">(</span><span class="ident" id="4182173">db</span><span class="op" id="4182175">,</span>&nbsp;<span class="ident" id="4182177">hash</span><span class="op" id="4182181">,</span>&nbsp;<span class="ident" id="4182183">seed</span><span class="op" id="4182187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182191">lHash2</span>&nbsp;<span class="op" id="4182198">:=</span>&nbsp;<span class="ident" id="4182201">db</span><span class="op" id="4182203">[</span><span class="num" id="4182204">0</span><span class="op" id="4182205">:</span><span class="ident" id="4182206">hash</span><span class="op" id="4182210">.</span><span class="ident" id="4182211">Size</span><span class="op" id="4182215">(</span><span class="op" id="4182216">)</span><span class="op" id="4182217">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182221">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182294">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182365">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182433">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182489">lHash2Good</span>&nbsp;<span class="op" id="4182500">:=</span>&nbsp;<span class="ident" id="4182503">subtle</span><span class="op" id="4182509">.</span><span class="ident" id="4182510">ConstantTimeCompare</span><span class="op" id="4182529">(</span><span class="ident" id="4182530">lHash</span><span class="op" id="4182535">,</span>&nbsp;<span class="ident" id="4182537">lHash2</span><span class="op" id="4182543">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182547">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182618">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182656">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182719">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182766">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4182827">var</span>&nbsp;<span class="ident" id="4182831">lookingForIndex</span><span class="op" id="4182846">,</span>&nbsp;<span class="ident" id="4182848">index</span><span class="op" id="4182853">,</span>&nbsp;<span class="ident" id="4182855">invalid</span>&nbsp;<span class="builtintype" id="4182863">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182868">lookingForIndex</span>&nbsp;<span class="op" id="4182884">=</span>&nbsp;<span class="num" id="4182886">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182889">rest</span>&nbsp;<span class="op" id="4182894">:=</span>&nbsp;<span class="ident" id="4182897">db</span><span class="op" id="4182899">[</span><span class="ident" id="4182900">hash</span><span class="op" id="4182904">.</span><span class="ident" id="4182905">Size</span><span class="op" id="4182909">(</span><span class="op" id="4182910">)</span><span class="op" id="4182911">:</span><span class="op" id="4182912">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4182916">for</span>&nbsp;<span class="ident" id="4182920">i</span>&nbsp;<span class="op" id="4182922">:=</span>&nbsp;<span class="num" id="4182925">0</span><span class="op" id="4182926">;</span>&nbsp;<span class="ident" id="4182928">i</span>&nbsp;<span class="op" id="4182930">&lt;</span>&nbsp;<span class="builtinfunc" id="4182932">len</span><span class="op" id="4182935">(</span><span class="ident" id="4182936">rest</span><span class="op" id="4182940">)</span><span class="op" id="4182941">;</span>&nbsp;<span class="ident" id="4182943">i</span><span class="op" id="4182944">++</span>&nbsp;<span class="op" id="4182947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182951">equals0</span>&nbsp;<span class="op" id="4182959">:=</span>&nbsp;<span class="ident" id="4182962">subtle</span><span class="op" id="4182968">.</span><span class="ident" id="4182969">ConstantTimeByteEq</span><span class="op" id="4182987">(</span><span class="ident" id="4182988">rest</span><span class="op" id="4182992">[</span><span class="ident" id="4182993">i</span><span class="op" id="4182994">]</span><span class="op" id="4182995">,</span>&nbsp;<span class="num" id="4182997">0</span><span class="op" id="4182998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183002">equals1</span>&nbsp;<span class="op" id="4183010">:=</span>&nbsp;<span class="ident" id="4183013">subtle</span><span class="op" id="4183019">.</span><span class="ident" id="4183020">ConstantTimeByteEq</span><span class="op" id="4183038">(</span><span class="ident" id="4183039">rest</span><span class="op" id="4183043">[</span><span class="ident" id="4183044">i</span><span class="op" id="4183045">]</span><span class="op" id="4183046">,</span>&nbsp;<span class="num" id="4183048">1</span><span class="op" id="4183049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183053">index</span>&nbsp;<span class="op" id="4183059">=</span>&nbsp;<span class="ident" id="4183061">subtle</span><span class="op" id="4183067">.</span><span class="ident" id="4183068">ConstantTimeSelect</span><span class="op" id="4183086">(</span><span class="ident" id="4183087">lookingForIndex</span><span class="op" id="4183102">&amp;</span><span class="ident" id="4183103">equals1</span><span class="op" id="4183110">,</span>&nbsp;<span class="ident" id="4183112">i</span><span class="op" id="4183113">,</span>&nbsp;<span class="ident" id="4183115">index</span><span class="op" id="4183120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183124">lookingForIndex</span>&nbsp;<span class="op" id="4183140">=</span>&nbsp;<span class="ident" id="4183142">subtle</span><span class="op" id="4183148">.</span><span class="ident" id="4183149">ConstantTimeSelect</span><span class="op" id="4183167">(</span><span class="ident" id="4183168">equals1</span><span class="op" id="4183175">,</span>&nbsp;<span class="num" id="4183177">0</span><span class="op" id="4183178">,</span>&nbsp;<span class="ident" id="4183180">lookingForIndex</span><span class="op" id="4183195">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183199">invalid</span>&nbsp;<span class="op" id="4183207">=</span>&nbsp;<span class="ident" id="4183209">subtle</span><span class="op" id="4183215">.</span><span class="ident" id="4183216">ConstantTimeSelect</span><span class="op" id="4183234">(</span><span class="ident" id="4183235">lookingForIndex</span><span class="op" id="4183250">&amp;^</span><span class="ident" id="4183252">equals0</span><span class="op" id="4183259">,</span>&nbsp;<span class="num" id="4183261">1</span><span class="op" id="4183262">,</span>&nbsp;<span class="ident" id="4183264">invalid</span><span class="op" id="4183271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4183274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4183278">if</span>&nbsp;<span class="ident" id="4183281">firstByteIsZero</span><span class="op" id="4183296">&amp;</span><span class="ident" id="4183297">lHash2Good</span><span class="op" id="4183307">&amp;^</span><span class="ident" id="4183309">invalid</span><span class="op" id="4183316">&amp;^</span><span class="ident" id="4183318">lookingForIndex</span>&nbsp;<span class="op" id="4183334">!=</span>&nbsp;<span class="num" id="4183337">1</span>&nbsp;<span class="op" id="4183339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183343">err</span>&nbsp;<span class="op" id="4183347">=</span>&nbsp;<span class="ident" id="4183349">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4183365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4183373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183377">msg</span>&nbsp;<span class="op" id="4183381">=</span>&nbsp;<span class="ident" id="4183383">rest</span><span class="op" id="4183387">[</span><span class="ident" id="4183388">index</span><span class="op" id="4183393">+</span><span class="num" id="4183394">1</span><span class="op" id="4183395">:</span><span class="op" id="4183396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4183399">return</span><br>
<span class="lineno">545</span><span class="op" id="4183406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4183409">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4183488">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4183517">func</span>&nbsp;<span class="ident" id="4183522">leftPad</span><span class="op" id="4183529">(</span><span class="ident" id="4183530">input</span>&nbsp;<span class="op" id="4183536">[</span><span class="op" id="4183537">]</span><span class="builtintype" id="4183538">byte</span><span class="op" id="4183542">,</span>&nbsp;<span class="ident" id="4183544">size</span>&nbsp;<span class="builtintype" id="4183549">int</span><span class="op" id="4183552">)</span>&nbsp;<span class="op" id="4183554">(</span><span class="ident" id="4183555">out</span>&nbsp;<span class="op" id="4183559">[</span><span class="op" id="4183560">]</span><span class="builtintype" id="4183561">byte</span><span class="op" id="4183565">)</span>&nbsp;<span class="op" id="4183567">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183570">n</span>&nbsp;<span class="op" id="4183572">:=</span>&nbsp;<span class="builtinfunc" id="4183575">len</span><span class="op" id="4183578">(</span><span class="ident" id="4183579">input</span><span class="op" id="4183584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4183587">if</span>&nbsp;<span class="ident" id="4183590">n</span>&nbsp;<span class="op" id="4183592">&gt;</span>&nbsp;<span class="ident" id="4183594">size</span>&nbsp;<span class="op" id="4183599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183603">n</span>&nbsp;<span class="op" id="4183605">=</span>&nbsp;<span class="ident" id="4183607">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4183613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183616">out</span>&nbsp;<span class="op" id="4183620">=</span>&nbsp;<span class="builtinfunc" id="4183622">make</span><span class="op" id="4183626">(</span><span class="op" id="4183627">[</span><span class="op" id="4183628">]</span><span class="builtintype" id="4183629">byte</span><span class="op" id="4183633">,</span>&nbsp;<span class="ident" id="4183635">size</span><span class="op" id="4183639">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4183642">copy</span><span class="op" id="4183646">(</span><span class="ident" id="4183647">out</span><span class="op" id="4183650">[</span><span class="builtinfunc" id="4183651">len</span><span class="op" id="4183654">(</span><span class="ident" id="4183655">out</span><span class="op" id="4183658">)</span><span class="op" id="4183659">-</span><span class="ident" id="4183660">n</span><span class="op" id="4183661">:</span><span class="op" id="4183662">]</span><span class="op" id="4183663">,</span>&nbsp;<span class="ident" id="4183665">input</span><span class="op" id="4183670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4183673">return</span><br>
<span class="lineno"></span><span class="op" id="4183680">}</span>
</div>
</body>
</html>
