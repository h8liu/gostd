<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5772186">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5772241">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5772295">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5772346">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772399">package</span>&nbsp;<span class="ident" id="5772407">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772412">import</span>&nbsp;<span class="op" id="5772419">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772422">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772432">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="5772443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5772446">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="5772509">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="5772569">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5772615">//</span><br>
<span class="lineno"></span><span class="keyword" id="5772618">func</span>&nbsp;<span class="ident" id="5772623">filterIdentList</span><span class="op" id="5772638">(</span><span class="ident" id="5772639">list</span>&nbsp;<span class="op" id="5772644">[</span><span class="op" id="5772645">]</span><span class="op" id="5772646">*</span><span class="ident" id="5772647">ast</span><span class="op" id="5772650">.</span><span class="ident" id="5772651">Ident</span><span class="op" id="5772656">,</span>&nbsp;<span class="ident" id="5772658">blankOk</span>&nbsp;<span class="builtintype" id="5772666">bool</span><span class="op" id="5772670">)</span>&nbsp;<span class="op" id="5772672">[</span><span class="op" id="5772673">]</span><span class="op" id="5772674">*</span><span class="ident" id="5772675">ast</span><span class="op" id="5772678">.</span><span class="ident" id="5772679">Ident</span>&nbsp;<span class="op" id="5772685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772688">j</span>&nbsp;<span class="op" id="5772690">:=</span>&nbsp;<span class="num" id="5772693">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772696">for</span>&nbsp;<span class="ident" id="5772700">_</span><span class="op" id="5772701">,</span>&nbsp;<span class="ident" id="5772703">x</span>&nbsp;<span class="op" id="5772705">:=</span>&nbsp;<span class="keyword" id="5772708">range</span>&nbsp;<span class="ident" id="5772714">list</span>&nbsp;<span class="op" id="5772719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772723">if</span>&nbsp;<span class="ident" id="5772726">ast</span><span class="op" id="5772729">.</span><span class="ident" id="5772730">IsExported</span><span class="op" id="5772740">(</span><span class="ident" id="5772741">x</span><span class="op" id="5772742">.</span><span class="ident" id="5772743">Name</span><span class="op" id="5772747">)</span>&nbsp;<span class="op" id="5772749">||</span>&nbsp;<span class="op" id="5772752">(</span><span class="ident" id="5772753">blankOk</span>&nbsp;<span class="op" id="5772761">&amp;&amp;</span>&nbsp;<span class="ident" id="5772764">x</span><span class="op" id="5772765">.</span><span class="ident" id="5772766">Name</span>&nbsp;<span class="op" id="5772771">==</span>&nbsp;<span class="string" id="5772774">&#34;_&#34;</span><span class="op" id="5772777">)</span>&nbsp;<span class="op" id="5772779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772784">list</span><span class="op" id="5772788">[</span><span class="ident" id="5772789">j</span><span class="op" id="5772790">]</span>&nbsp;<span class="op" id="5772792">=</span>&nbsp;<span class="ident" id="5772794">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772799">j</span><span class="op" id="5772800">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772805">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772811">return</span>&nbsp;<span class="ident" id="5772818">list</span><span class="op" id="5772822">[</span><span class="num" id="5772823">0</span><span class="op" id="5772824">:</span><span class="ident" id="5772825">j</span><span class="op" id="5772826">]</span><br>
<span class="lineno"></span><span class="op" id="5772828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5772831">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="5772909">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="5772980">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5773009">//</span><br>
<span class="lineno"></span><span class="keyword" id="5773012">func</span>&nbsp;<span class="ident" id="5773017">removeErrorField</span><span class="op" id="5773033">(</span><span class="ident" id="5773034">ityp</span>&nbsp;<span class="op" id="5773039">*</span><span class="ident" id="5773040">ast</span><span class="op" id="5773043">.</span><span class="ident" id="5773044">InterfaceType</span><span class="op" id="5773057">)</span>&nbsp;<span class="op" id="5773059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773062">list</span>&nbsp;<span class="op" id="5773067">:=</span>&nbsp;<span class="ident" id="5773070">ityp</span><span class="op" id="5773074">.</span><span class="ident" id="5773075">Methods</span><span class="op" id="5773082">.</span><span class="ident" id="5773083">List</span>&nbsp;<span class="comment" id="5773088">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773125">j</span>&nbsp;<span class="op" id="5773127">:=</span>&nbsp;<span class="num" id="5773130">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773133">for</span>&nbsp;<span class="ident" id="5773137">_</span><span class="op" id="5773138">,</span>&nbsp;<span class="ident" id="5773140">field</span>&nbsp;<span class="op" id="5773146">:=</span>&nbsp;<span class="keyword" id="5773149">range</span>&nbsp;<span class="ident" id="5773155">list</span>&nbsp;<span class="op" id="5773160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773164">keepField</span>&nbsp;<span class="op" id="5773174">:=</span>&nbsp;<span class="builtintype" id="5773177">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773184">if</span>&nbsp;<span class="ident" id="5773187">n</span>&nbsp;<span class="op" id="5773189">:=</span>&nbsp;<span class="builtinfunc" id="5773192">len</span><span class="op" id="5773195">(</span><span class="ident" id="5773196">field</span><span class="op" id="5773201">.</span><span class="ident" id="5773202">Names</span><span class="op" id="5773207">)</span><span class="op" id="5773208">;</span>&nbsp;<span class="ident" id="5773210">n</span>&nbsp;<span class="op" id="5773212">==</span>&nbsp;<span class="num" id="5773215">0</span>&nbsp;<span class="op" id="5773217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773222">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773244">if</span>&nbsp;<span class="ident" id="5773247">fname</span><span class="op" id="5773252">,</span>&nbsp;<span class="ident" id="5773254">_</span>&nbsp;<span class="op" id="5773256">:=</span>&nbsp;<span class="ident" id="5773259">baseTypeName</span><span class="op" id="5773271">(</span><span class="ident" id="5773272">field</span><span class="op" id="5773277">.</span><span class="ident" id="5773278">Type</span><span class="op" id="5773282">)</span><span class="op" id="5773283">;</span>&nbsp;<span class="ident" id="5773285">fname</span>&nbsp;<span class="op" id="5773291">==</span>&nbsp;<span class="string" id="5773294">&#34;error&#34;</span>&nbsp;<span class="op" id="5773302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773308">keepField</span>&nbsp;<span class="op" id="5773318">=</span>&nbsp;<span class="builtintype" id="5773320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773337">if</span>&nbsp;<span class="ident" id="5773340">keepField</span>&nbsp;<span class="op" id="5773350">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773355">list</span><span class="op" id="5773359">[</span><span class="ident" id="5773360">j</span><span class="op" id="5773361">]</span>&nbsp;<span class="op" id="5773363">=</span>&nbsp;<span class="ident" id="5773365">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773374">j</span><span class="op" id="5773375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773386">if</span>&nbsp;<span class="ident" id="5773389">j</span>&nbsp;<span class="op" id="5773391">&lt;</span>&nbsp;<span class="builtinfunc" id="5773393">len</span><span class="op" id="5773396">(</span><span class="ident" id="5773397">list</span><span class="op" id="5773401">)</span>&nbsp;<span class="op" id="5773403">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773407">ityp</span><span class="op" id="5773411">.</span><span class="ident" id="5773412">Incomplete</span>&nbsp;<span class="op" id="5773423">=</span>&nbsp;<span class="builtintype" id="5773425">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773434">ityp</span><span class="op" id="5773438">.</span><span class="ident" id="5773439">Methods</span><span class="op" id="5773446">.</span><span class="ident" id="5773447">List</span>&nbsp;<span class="op" id="5773452">=</span>&nbsp;<span class="ident" id="5773454">list</span><span class="op" id="5773458">[</span><span class="num" id="5773459">0</span><span class="op" id="5773460">:</span><span class="ident" id="5773461">j</span><span class="op" id="5773462">]</span><br>
<span class="lineno"></span><span class="op" id="5773464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5773467">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5773546">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5773620">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5773693">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5773718">//</span><br>
<span class="lineno">60</span><span class="keyword" id="5773721">func</span>&nbsp;<span class="op" id="5773726">(</span><span class="ident" id="5773727">r</span>&nbsp;<span class="op" id="5773729">*</span><span class="ident" id="5773730">reader</span><span class="op" id="5773736">)</span>&nbsp;<span class="ident" id="5773738">filterFieldList</span><span class="op" id="5773753">(</span><span class="ident" id="5773754">parent</span>&nbsp;<span class="op" id="5773761">*</span><span class="ident" id="5773762">namedType</span><span class="op" id="5773771">,</span>&nbsp;<span class="ident" id="5773773">fields</span>&nbsp;<span class="op" id="5773780">*</span><span class="ident" id="5773781">ast</span><span class="op" id="5773784">.</span><span class="ident" id="5773785">FieldList</span><span class="op" id="5773794">,</span>&nbsp;<span class="ident" id="5773796">ityp</span>&nbsp;<span class="op" id="5773801">*</span><span class="ident" id="5773802">ast</span><span class="op" id="5773805">.</span><span class="ident" id="5773806">InterfaceType</span><span class="op" id="5773819">)</span>&nbsp;<span class="op" id="5773821">(</span><span class="ident" id="5773822">removedFields</span>&nbsp;<span class="builtintype" id="5773836">bool</span><span class="op" id="5773840">)</span>&nbsp;<span class="op" id="5773842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773845">if</span>&nbsp;<span class="ident" id="5773848">fields</span>&nbsp;<span class="op" id="5773855">==</span>&nbsp;<span class="ident" id="5773858">nil</span>&nbsp;<span class="op" id="5773862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773866">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773877">list</span>&nbsp;<span class="op" id="5773882">:=</span>&nbsp;<span class="ident" id="5773885">fields</span><span class="op" id="5773891">.</span><span class="ident" id="5773892">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773898">j</span>&nbsp;<span class="op" id="5773900">:=</span>&nbsp;<span class="num" id="5773903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773906">for</span>&nbsp;<span class="ident" id="5773910">_</span><span class="op" id="5773911">,</span>&nbsp;<span class="ident" id="5773913">field</span>&nbsp;<span class="op" id="5773919">:=</span>&nbsp;<span class="keyword" id="5773922">range</span>&nbsp;<span class="ident" id="5773928">list</span>&nbsp;<span class="op" id="5773933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773937">keepField</span>&nbsp;<span class="op" id="5773947">:=</span>&nbsp;<span class="builtintype" id="5773950">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773958">if</span>&nbsp;<span class="ident" id="5773961">n</span>&nbsp;<span class="op" id="5773963">:=</span>&nbsp;<span class="builtinfunc" id="5773966">len</span><span class="op" id="5773969">(</span><span class="ident" id="5773970">field</span><span class="op" id="5773975">.</span><span class="ident" id="5773976">Names</span><span class="op" id="5773981">)</span><span class="op" id="5773982">;</span>&nbsp;<span class="ident" id="5773984">n</span>&nbsp;<span class="op" id="5773986">==</span>&nbsp;<span class="num" id="5773989">0</span>&nbsp;<span class="op" id="5773991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773996">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774018">fname</span>&nbsp;<span class="op" id="5774024">:=</span>&nbsp;<span class="ident" id="5774027">r</span><span class="op" id="5774028">.</span><span class="ident" id="5774029">recordAnonymousField</span><span class="op" id="5774049">(</span><span class="ident" id="5774050">parent</span><span class="op" id="5774056">,</span>&nbsp;<span class="ident" id="5774058">field</span><span class="op" id="5774063">.</span><span class="ident" id="5774064">Type</span><span class="op" id="5774068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774073">if</span>&nbsp;<span class="ident" id="5774076">ast</span><span class="op" id="5774079">.</span><span class="ident" id="5774080">IsExported</span><span class="op" id="5774090">(</span><span class="ident" id="5774091">fname</span><span class="op" id="5774096">)</span>&nbsp;<span class="op" id="5774098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774104">keepField</span>&nbsp;<span class="op" id="5774114">=</span>&nbsp;<span class="builtintype" id="5774116">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774124">}</span>&nbsp;<span class="keyword" id="5774126">else</span>&nbsp;<span class="keyword" id="5774131">if</span>&nbsp;<span class="ident" id="5774134">ityp</span>&nbsp;<span class="op" id="5774139">!=</span>&nbsp;<span class="ident" id="5774142">nil</span>&nbsp;<span class="op" id="5774146">&amp;&amp;</span>&nbsp;<span class="ident" id="5774149">fname</span>&nbsp;<span class="op" id="5774155">==</span>&nbsp;<span class="string" id="5774158">&#34;error&#34;</span>&nbsp;<span class="op" id="5774166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774172">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774226">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5774280">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774336">keepField</span>&nbsp;<span class="op" id="5774346">=</span>&nbsp;<span class="builtintype" id="5774348">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774357">r</span><span class="op" id="5774358">.</span><span class="ident" id="5774359">remember</span><span class="op" id="5774367">(</span><span class="ident" id="5774368">ityp</span><span class="op" id="5774372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774377">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774381">}</span>&nbsp;<span class="keyword" id="5774383">else</span>&nbsp;<span class="op" id="5774388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774393">field</span><span class="op" id="5774398">.</span><span class="ident" id="5774399">Names</span>&nbsp;<span class="op" id="5774405">=</span>&nbsp;<span class="ident" id="5774407">filterIdentList</span><span class="op" id="5774422">(</span><span class="ident" id="5774423">field</span><span class="op" id="5774428">.</span><span class="ident" id="5774429">Names</span><span class="op" id="5774434">,</span>&nbsp;<span class="builtintype" id="5774436">false</span><span class="op" id="5774441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774446">if</span>&nbsp;<span class="builtinfunc" id="5774449">len</span><span class="op" id="5774452">(</span><span class="ident" id="5774453">field</span><span class="op" id="5774458">.</span><span class="ident" id="5774459">Names</span><span class="op" id="5774464">)</span>&nbsp;<span class="op" id="5774466">&lt;</span>&nbsp;<span class="ident" id="5774468">n</span>&nbsp;<span class="op" id="5774470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774476">removedFields</span>&nbsp;<span class="op" id="5774490">=</span>&nbsp;<span class="builtintype" id="5774492">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774500">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774505">if</span>&nbsp;<span class="builtinfunc" id="5774508">len</span><span class="op" id="5774511">(</span><span class="ident" id="5774512">field</span><span class="op" id="5774517">.</span><span class="ident" id="5774518">Names</span><span class="op" id="5774523">)</span>&nbsp;<span class="op" id="5774525">&gt;</span>&nbsp;<span class="num" id="5774527">0</span>&nbsp;<span class="op" id="5774529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774535">keepField</span>&nbsp;<span class="op" id="5774545">=</span>&nbsp;<span class="builtintype" id="5774547">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774563">if</span>&nbsp;<span class="ident" id="5774566">keepField</span>&nbsp;<span class="op" id="5774576">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774581">r</span><span class="op" id="5774582">.</span><span class="ident" id="5774583">filterType</span><span class="op" id="5774593">(</span><span class="ident" id="5774594">nil</span><span class="op" id="5774597">,</span>&nbsp;<span class="ident" id="5774599">field</span><span class="op" id="5774604">.</span><span class="ident" id="5774605">Type</span><span class="op" id="5774609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774614">list</span><span class="op" id="5774618">[</span><span class="ident" id="5774619">j</span><span class="op" id="5774620">]</span>&nbsp;<span class="op" id="5774622">=</span>&nbsp;<span class="ident" id="5774624">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774633">j</span><span class="op" id="5774634">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774642">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774645">if</span>&nbsp;<span class="ident" id="5774648">j</span>&nbsp;<span class="op" id="5774650">&lt;</span>&nbsp;<span class="builtinfunc" id="5774652">len</span><span class="op" id="5774655">(</span><span class="ident" id="5774656">list</span><span class="op" id="5774660">)</span>&nbsp;<span class="op" id="5774662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774666">removedFields</span>&nbsp;<span class="op" id="5774680">=</span>&nbsp;<span class="builtintype" id="5774682">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774691">fields</span><span class="op" id="5774697">.</span><span class="ident" id="5774698">List</span>&nbsp;<span class="op" id="5774703">=</span>&nbsp;<span class="ident" id="5774705">list</span><span class="op" id="5774709">[</span><span class="num" id="5774710">0</span><span class="op" id="5774711">:</span><span class="ident" id="5774712">j</span><span class="op" id="5774713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774716">return</span><br>
<span class="lineno">100</span><span class="op" id="5774723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774726">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5774798">//</span><br>
<span class="lineno"></span><span class="keyword" id="5774801">func</span>&nbsp;<span class="op" id="5774806">(</span><span class="ident" id="5774807">r</span>&nbsp;<span class="op" id="5774809">*</span><span class="ident" id="5774810">reader</span><span class="op" id="5774816">)</span>&nbsp;<span class="ident" id="5774818">filterParamList</span><span class="op" id="5774833">(</span><span class="ident" id="5774834">fields</span>&nbsp;<span class="op" id="5774841">*</span><span class="ident" id="5774842">ast</span><span class="op" id="5774845">.</span><span class="ident" id="5774846">FieldList</span><span class="op" id="5774855">)</span>&nbsp;<span class="op" id="5774857">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774860">if</span>&nbsp;<span class="ident" id="5774863">fields</span>&nbsp;<span class="op" id="5774870">!=</span>&nbsp;<span class="ident" id="5774873">nil</span>&nbsp;<span class="op" id="5774877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774881">for</span>&nbsp;<span class="ident" id="5774885">_</span><span class="op" id="5774886">,</span>&nbsp;<span class="ident" id="5774888">f</span>&nbsp;<span class="op" id="5774890">:=</span>&nbsp;<span class="keyword" id="5774893">range</span>&nbsp;<span class="ident" id="5774899">fields</span><span class="op" id="5774905">.</span><span class="ident" id="5774906">List</span>&nbsp;<span class="op" id="5774911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774916">r</span><span class="op" id="5774917">.</span><span class="ident" id="5774918">filterType</span><span class="op" id="5774928">(</span><span class="ident" id="5774929">nil</span><span class="op" id="5774932">,</span>&nbsp;<span class="ident" id="5774934">f</span><span class="op" id="5774935">.</span><span class="ident" id="5774936">Type</span><span class="op" id="5774940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774947">}</span><br>
<span class="lineno">110</span><span class="op" id="5774949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774952">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="5775027">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5775100">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="5775166">//</span><br>
<span class="lineno"></span><span class="keyword" id="5775169">func</span>&nbsp;<span class="op" id="5775174">(</span><span class="ident" id="5775175">r</span>&nbsp;<span class="op" id="5775177">*</span><span class="ident" id="5775178">reader</span><span class="op" id="5775184">)</span>&nbsp;<span class="ident" id="5775186">filterType</span><span class="op" id="5775196">(</span><span class="ident" id="5775197">parent</span>&nbsp;<span class="op" id="5775204">*</span><span class="ident" id="5775205">namedType</span><span class="op" id="5775214">,</span>&nbsp;<span class="ident" id="5775216">typ</span>&nbsp;<span class="ident" id="5775220">ast</span><span class="op" id="5775223">.</span><span class="ident" id="5775224">Expr</span><span class="op" id="5775228">)</span>&nbsp;<span class="op" id="5775230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775233">switch</span>&nbsp;<span class="ident" id="5775240">t</span>&nbsp;<span class="op" id="5775242">:=</span>&nbsp;<span class="ident" id="5775245">typ</span><span class="op" id="5775248">.</span><span class="op" id="5775249">(</span><span class="keyword" id="5775250">type</span><span class="op" id="5775254">)</span>&nbsp;<span class="op" id="5775256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775259">case</span>&nbsp;<span class="op" id="5775264">*</span><span class="ident" id="5775265">ast</span><span class="op" id="5775268">.</span><span class="ident" id="5775269">Ident</span><span class="op" id="5775274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775278">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775296">case</span>&nbsp;<span class="op" id="5775301">*</span><span class="ident" id="5775302">ast</span><span class="op" id="5775305">.</span><span class="ident" id="5775306">ParenExpr</span><span class="op" id="5775315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775319">r</span><span class="op" id="5775320">.</span><span class="ident" id="5775321">filterType</span><span class="op" id="5775331">(</span><span class="ident" id="5775332">nil</span><span class="op" id="5775335">,</span>&nbsp;<span class="ident" id="5775337">t</span><span class="op" id="5775338">.</span><span class="ident" id="5775339">X</span><span class="op" id="5775340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775343">case</span>&nbsp;<span class="op" id="5775348">*</span><span class="ident" id="5775349">ast</span><span class="op" id="5775352">.</span><span class="ident" id="5775353">ArrayType</span><span class="op" id="5775362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775366">r</span><span class="op" id="5775367">.</span><span class="ident" id="5775368">filterType</span><span class="op" id="5775378">(</span><span class="ident" id="5775379">nil</span><span class="op" id="5775382">,</span>&nbsp;<span class="ident" id="5775384">t</span><span class="op" id="5775385">.</span><span class="ident" id="5775386">Elt</span><span class="op" id="5775389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775392">case</span>&nbsp;<span class="op" id="5775397">*</span><span class="ident" id="5775398">ast</span><span class="op" id="5775401">.</span><span class="ident" id="5775402">StructType</span><span class="op" id="5775412">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775416">if</span>&nbsp;<span class="ident" id="5775419">r</span><span class="op" id="5775420">.</span><span class="ident" id="5775421">filterFieldList</span><span class="op" id="5775436">(</span><span class="ident" id="5775437">parent</span><span class="op" id="5775443">,</span>&nbsp;<span class="ident" id="5775445">t</span><span class="op" id="5775446">.</span><span class="ident" id="5775447">Fields</span><span class="op" id="5775453">,</span>&nbsp;<span class="ident" id="5775455">nil</span><span class="op" id="5775458">)</span>&nbsp;<span class="op" id="5775460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775465">t</span><span class="op" id="5775466">.</span><span class="ident" id="5775467">Incomplete</span>&nbsp;<span class="op" id="5775478">=</span>&nbsp;<span class="builtintype" id="5775480">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775490">case</span>&nbsp;<span class="op" id="5775495">*</span><span class="ident" id="5775496">ast</span><span class="op" id="5775499">.</span><span class="ident" id="5775500">FuncType</span><span class="op" id="5775508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775512">r</span><span class="op" id="5775513">.</span><span class="ident" id="5775514">filterParamList</span><span class="op" id="5775529">(</span><span class="ident" id="5775530">t</span><span class="op" id="5775531">.</span><span class="ident" id="5775532">Params</span><span class="op" id="5775538">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775542">r</span><span class="op" id="5775543">.</span><span class="ident" id="5775544">filterParamList</span><span class="op" id="5775559">(</span><span class="ident" id="5775560">t</span><span class="op" id="5775561">.</span><span class="ident" id="5775562">Results</span><span class="op" id="5775569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775572">case</span>&nbsp;<span class="op" id="5775577">*</span><span class="ident" id="5775578">ast</span><span class="op" id="5775581">.</span><span class="ident" id="5775582">InterfaceType</span><span class="op" id="5775595">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775599">if</span>&nbsp;<span class="ident" id="5775602">r</span><span class="op" id="5775603">.</span><span class="ident" id="5775604">filterFieldList</span><span class="op" id="5775619">(</span><span class="ident" id="5775620">parent</span><span class="op" id="5775626">,</span>&nbsp;<span class="ident" id="5775628">t</span><span class="op" id="5775629">.</span><span class="ident" id="5775630">Methods</span><span class="op" id="5775637">,</span>&nbsp;<span class="ident" id="5775639">t</span><span class="op" id="5775640">)</span>&nbsp;<span class="op" id="5775642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775647">t</span><span class="op" id="5775648">.</span><span class="ident" id="5775649">Incomplete</span>&nbsp;<span class="op" id="5775660">=</span>&nbsp;<span class="builtintype" id="5775662">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775669">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775672">case</span>&nbsp;<span class="op" id="5775677">*</span><span class="ident" id="5775678">ast</span><span class="op" id="5775681">.</span><span class="ident" id="5775682">MapType</span><span class="op" id="5775689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775693">r</span><span class="op" id="5775694">.</span><span class="ident" id="5775695">filterType</span><span class="op" id="5775705">(</span><span class="ident" id="5775706">nil</span><span class="op" id="5775709">,</span>&nbsp;<span class="ident" id="5775711">t</span><span class="op" id="5775712">.</span><span class="ident" id="5775713">Key</span><span class="op" id="5775716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775720">r</span><span class="op" id="5775721">.</span><span class="ident" id="5775722">filterType</span><span class="op" id="5775732">(</span><span class="ident" id="5775733">nil</span><span class="op" id="5775736">,</span>&nbsp;<span class="ident" id="5775738">t</span><span class="op" id="5775739">.</span><span class="ident" id="5775740">Value</span><span class="op" id="5775745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775748">case</span>&nbsp;<span class="op" id="5775753">*</span><span class="ident" id="5775754">ast</span><span class="op" id="5775757">.</span><span class="ident" id="5775758">ChanType</span><span class="op" id="5775766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775770">r</span><span class="op" id="5775771">.</span><span class="ident" id="5775772">filterType</span><span class="op" id="5775782">(</span><span class="ident" id="5775783">nil</span><span class="op" id="5775786">,</span>&nbsp;<span class="ident" id="5775788">t</span><span class="op" id="5775789">.</span><span class="ident" id="5775790">Value</span><span class="op" id="5775795">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775798">}</span><br>
<span class="lineno"></span><span class="op" id="5775800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5775803">func</span>&nbsp;<span class="op" id="5775808">(</span><span class="ident" id="5775809">r</span>&nbsp;<span class="op" id="5775811">*</span><span class="ident" id="5775812">reader</span><span class="op" id="5775818">)</span>&nbsp;<span class="ident" id="5775820">filterSpec</span><span class="op" id="5775830">(</span><span class="ident" id="5775831">spec</span>&nbsp;<span class="ident" id="5775836">ast</span><span class="op" id="5775839">.</span><span class="ident" id="5775840">Spec</span><span class="op" id="5775844">,</span>&nbsp;<span class="ident" id="5775846">tok</span>&nbsp;<span class="ident" id="5775850">token</span><span class="op" id="5775855">.</span><span class="ident" id="5775856">Token</span><span class="op" id="5775861">)</span>&nbsp;<span class="builtintype" id="5775863">bool</span>&nbsp;<span class="op" id="5775868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775871">switch</span>&nbsp;<span class="ident" id="5775878">s</span>&nbsp;<span class="op" id="5775880">:=</span>&nbsp;<span class="ident" id="5775883">spec</span><span class="op" id="5775887">.</span><span class="op" id="5775888">(</span><span class="keyword" id="5775889">type</span><span class="op" id="5775893">)</span>&nbsp;<span class="op" id="5775895">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775898">case</span>&nbsp;<span class="op" id="5775903">*</span><span class="ident" id="5775904">ast</span><span class="op" id="5775907">.</span><span class="ident" id="5775908">ImportSpec</span><span class="op" id="5775918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775922">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775970">return</span>&nbsp;<span class="builtintype" id="5775977">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775983">case</span>&nbsp;<span class="op" id="5775988">*</span><span class="ident" id="5775989">ast</span><span class="op" id="5775992">.</span><span class="ident" id="5775993">ValueSpec</span><span class="op" id="5776002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776006">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776062">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776096">s</span><span class="op" id="5776097">.</span><span class="ident" id="5776098">Names</span>&nbsp;<span class="op" id="5776104">=</span>&nbsp;<span class="ident" id="5776106">filterIdentList</span><span class="op" id="5776121">(</span><span class="ident" id="5776122">s</span><span class="op" id="5776123">.</span><span class="ident" id="5776124">Names</span><span class="op" id="5776129">,</span>&nbsp;<span class="ident" id="5776131">tok</span>&nbsp;<span class="op" id="5776135">==</span>&nbsp;<span class="ident" id="5776138">token</span><span class="op" id="5776143">.</span><span class="ident" id="5776144">CONST</span><span class="op" id="5776149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776153">if</span>&nbsp;<span class="builtinfunc" id="5776156">len</span><span class="op" id="5776159">(</span><span class="ident" id="5776160">s</span><span class="op" id="5776161">.</span><span class="ident" id="5776162">Names</span><span class="op" id="5776167">)</span>&nbsp;<span class="op" id="5776169">&gt;</span>&nbsp;<span class="num" id="5776171">0</span>&nbsp;<span class="op" id="5776173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776178">r</span><span class="op" id="5776179">.</span><span class="ident" id="5776180">filterType</span><span class="op" id="5776190">(</span><span class="ident" id="5776191">nil</span><span class="op" id="5776194">,</span>&nbsp;<span class="ident" id="5776196">s</span><span class="op" id="5776197">.</span><span class="ident" id="5776198">Type</span><span class="op" id="5776202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776207">return</span>&nbsp;<span class="builtintype" id="5776214">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776224">case</span>&nbsp;<span class="op" id="5776229">*</span><span class="ident" id="5776230">ast</span><span class="op" id="5776233">.</span><span class="ident" id="5776234">TypeSpec</span><span class="op" id="5776242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776246">if</span>&nbsp;<span class="ident" id="5776249">name</span>&nbsp;<span class="op" id="5776254">:=</span>&nbsp;<span class="ident" id="5776257">s</span><span class="op" id="5776258">.</span><span class="ident" id="5776259">Name</span><span class="op" id="5776263">.</span><span class="ident" id="5776264">Name</span><span class="op" id="5776268">;</span>&nbsp;<span class="ident" id="5776270">ast</span><span class="op" id="5776273">.</span><span class="ident" id="5776274">IsExported</span><span class="op" id="5776284">(</span><span class="ident" id="5776285">name</span><span class="op" id="5776289">)</span>&nbsp;<span class="op" id="5776291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776296">r</span><span class="op" id="5776297">.</span><span class="ident" id="5776298">filterType</span><span class="op" id="5776308">(</span><span class="ident" id="5776309">r</span><span class="op" id="5776310">.</span><span class="ident" id="5776311">lookupType</span><span class="op" id="5776321">(</span><span class="ident" id="5776322">s</span><span class="op" id="5776323">.</span><span class="ident" id="5776324">Name</span><span class="op" id="5776328">.</span><span class="ident" id="5776329">Name</span><span class="op" id="5776333">)</span><span class="op" id="5776334">,</span>&nbsp;<span class="ident" id="5776336">s</span><span class="op" id="5776337">.</span><span class="ident" id="5776338">Type</span><span class="op" id="5776342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776347">return</span>&nbsp;<span class="builtintype" id="5776354">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776361">}</span>&nbsp;<span class="keyword" id="5776363">else</span>&nbsp;<span class="keyword" id="5776368">if</span>&nbsp;<span class="ident" id="5776371">name</span>&nbsp;<span class="op" id="5776376">==</span>&nbsp;<span class="string" id="5776379">&#34;error&#34;</span>&nbsp;<span class="op" id="5776387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776392">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776452">r</span><span class="op" id="5776453">.</span><span class="ident" id="5776454">errorDecl</span>&nbsp;<span class="op" id="5776464">=</span>&nbsp;<span class="builtintype" id="5776466">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776476">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776479">return</span>&nbsp;<span class="builtintype" id="5776486">false</span><br>
<span class="lineno"></span><span class="op" id="5776492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5776495">func</span>&nbsp;<span class="op" id="5776500">(</span><span class="ident" id="5776501">r</span>&nbsp;<span class="op" id="5776503">*</span><span class="ident" id="5776504">reader</span><span class="op" id="5776510">)</span>&nbsp;<span class="ident" id="5776512">filterSpecList</span><span class="op" id="5776526">(</span><span class="ident" id="5776527">list</span>&nbsp;<span class="op" id="5776532">[</span><span class="op" id="5776533">]</span><span class="ident" id="5776534">ast</span><span class="op" id="5776537">.</span><span class="ident" id="5776538">Spec</span><span class="op" id="5776542">,</span>&nbsp;<span class="ident" id="5776544">tok</span>&nbsp;<span class="ident" id="5776548">token</span><span class="op" id="5776553">.</span><span class="ident" id="5776554">Token</span><span class="op" id="5776559">)</span>&nbsp;<span class="op" id="5776561">[</span><span class="op" id="5776562">]</span><span class="ident" id="5776563">ast</span><span class="op" id="5776566">.</span><span class="ident" id="5776567">Spec</span>&nbsp;<span class="op" id="5776572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776575">j</span>&nbsp;<span class="op" id="5776577">:=</span>&nbsp;<span class="num" id="5776580">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776583">for</span>&nbsp;<span class="ident" id="5776587">_</span><span class="op" id="5776588">,</span>&nbsp;<span class="ident" id="5776590">s</span>&nbsp;<span class="op" id="5776592">:=</span>&nbsp;<span class="keyword" id="5776595">range</span>&nbsp;<span class="ident" id="5776601">list</span>&nbsp;<span class="op" id="5776606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776610">if</span>&nbsp;<span class="ident" id="5776613">r</span><span class="op" id="5776614">.</span><span class="ident" id="5776615">filterSpec</span><span class="op" id="5776625">(</span><span class="ident" id="5776626">s</span><span class="op" id="5776627">,</span>&nbsp;<span class="ident" id="5776629">tok</span><span class="op" id="5776632">)</span>&nbsp;<span class="op" id="5776634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776639">list</span><span class="op" id="5776643">[</span><span class="ident" id="5776644">j</span><span class="op" id="5776645">]</span>&nbsp;<span class="op" id="5776647">=</span>&nbsp;<span class="ident" id="5776649">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776654">j</span><span class="op" id="5776655">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776660">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776666">return</span>&nbsp;<span class="ident" id="5776673">list</span><span class="op" id="5776677">[</span><span class="num" id="5776678">0</span><span class="op" id="5776679">:</span><span class="ident" id="5776680">j</span><span class="op" id="5776681">]</span><br>
<span class="lineno"></span><span class="op" id="5776683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5776686">func</span>&nbsp;<span class="op" id="5776691">(</span><span class="ident" id="5776692">r</span>&nbsp;<span class="op" id="5776694">*</span><span class="ident" id="5776695">reader</span><span class="op" id="5776701">)</span>&nbsp;<span class="ident" id="5776703">filterDecl</span><span class="op" id="5776713">(</span><span class="ident" id="5776714">decl</span>&nbsp;<span class="ident" id="5776719">ast</span><span class="op" id="5776722">.</span><span class="ident" id="5776723">Decl</span><span class="op" id="5776727">)</span>&nbsp;<span class="builtintype" id="5776729">bool</span>&nbsp;<span class="op" id="5776734">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776737">switch</span>&nbsp;<span class="ident" id="5776744">d</span>&nbsp;<span class="op" id="5776746">:=</span>&nbsp;<span class="ident" id="5776749">decl</span><span class="op" id="5776753">.</span><span class="op" id="5776754">(</span><span class="keyword" id="5776755">type</span><span class="op" id="5776759">)</span>&nbsp;<span class="op" id="5776761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776764">case</span>&nbsp;<span class="op" id="5776769">*</span><span class="ident" id="5776770">ast</span><span class="op" id="5776773">.</span><span class="ident" id="5776774">GenDecl</span><span class="op" id="5776781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776785">d</span><span class="op" id="5776786">.</span><span class="ident" id="5776787">Specs</span>&nbsp;<span class="op" id="5776793">=</span>&nbsp;<span class="ident" id="5776795">r</span><span class="op" id="5776796">.</span><span class="ident" id="5776797">filterSpecList</span><span class="op" id="5776811">(</span><span class="ident" id="5776812">d</span><span class="op" id="5776813">.</span><span class="ident" id="5776814">Specs</span><span class="op" id="5776819">,</span>&nbsp;<span class="ident" id="5776821">d</span><span class="op" id="5776822">.</span><span class="ident" id="5776823">Tok</span><span class="op" id="5776826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776830">return</span>&nbsp;<span class="builtinfunc" id="5776837">len</span><span class="op" id="5776840">(</span><span class="ident" id="5776841">d</span><span class="op" id="5776842">.</span><span class="ident" id="5776843">Specs</span><span class="op" id="5776848">)</span>&nbsp;<span class="op" id="5776850">&gt;</span>&nbsp;<span class="num" id="5776852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776855">case</span>&nbsp;<span class="op" id="5776860">*</span><span class="ident" id="5776861">ast</span><span class="op" id="5776864">.</span><span class="ident" id="5776865">FuncDecl</span><span class="op" id="5776873">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776877">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776927">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776980">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777034">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777082">return</span>&nbsp;<span class="ident" id="5777089">ast</span><span class="op" id="5777092">.</span><span class="ident" id="5777093">IsExported</span><span class="op" id="5777103">(</span><span class="ident" id="5777104">d</span><span class="op" id="5777105">.</span><span class="ident" id="5777106">Name</span><span class="op" id="5777110">.</span><span class="ident" id="5777111">Name</span><span class="op" id="5777115">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777121">return</span>&nbsp;<span class="builtintype" id="5777128">false</span><br>
<span class="lineno"></span><span class="op" id="5777134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5777137">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="5777203">//</span><br>
<span class="lineno"></span><span class="keyword" id="5777206">func</span>&nbsp;<span class="op" id="5777211">(</span><span class="ident" id="5777212">r</span>&nbsp;<span class="op" id="5777214">*</span><span class="ident" id="5777215">reader</span><span class="op" id="5777221">)</span>&nbsp;<span class="ident" id="5777223">fileExports</span><span class="op" id="5777234">(</span><span class="ident" id="5777235">src</span>&nbsp;<span class="op" id="5777239">*</span><span class="ident" id="5777240">ast</span><span class="op" id="5777243">.</span><span class="ident" id="5777244">File</span><span class="op" id="5777248">)</span>&nbsp;<span class="op" id="5777250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777253">j</span>&nbsp;<span class="op" id="5777255">:=</span>&nbsp;<span class="num" id="5777258">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777261">for</span>&nbsp;<span class="ident" id="5777265">_</span><span class="op" id="5777266">,</span>&nbsp;<span class="ident" id="5777268">d</span>&nbsp;<span class="op" id="5777270">:=</span>&nbsp;<span class="keyword" id="5777273">range</span>&nbsp;<span class="ident" id="5777279">src</span><span class="op" id="5777282">.</span><span class="ident" id="5777283">Decls</span>&nbsp;<span class="op" id="5777289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777293">if</span>&nbsp;<span class="ident" id="5777296">r</span><span class="op" id="5777297">.</span><span class="ident" id="5777298">filterDecl</span><span class="op" id="5777308">(</span><span class="ident" id="5777309">d</span><span class="op" id="5777310">)</span>&nbsp;<span class="op" id="5777312">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777317">src</span><span class="op" id="5777320">.</span><span class="ident" id="5777321">Decls</span><span class="op" id="5777326">[</span><span class="ident" id="5777327">j</span><span class="op" id="5777328">]</span>&nbsp;<span class="op" id="5777330">=</span>&nbsp;<span class="ident" id="5777332">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777337">j</span><span class="op" id="5777338">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777349">src</span><span class="op" id="5777352">.</span><span class="ident" id="5777353">Decls</span>&nbsp;<span class="op" id="5777359">=</span>&nbsp;<span class="ident" id="5777361">src</span><span class="op" id="5777364">.</span><span class="ident" id="5777365">Decls</span><span class="op" id="5777370">[</span><span class="num" id="5777371">0</span><span class="op" id="5777372">:</span><span class="ident" id="5777373">j</span><span class="op" id="5777374">]</span><br>
<span class="lineno">205</span><span class="op" id="5777376">}</span>
</div>
</body>
</html>
