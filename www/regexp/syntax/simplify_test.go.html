<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="string">&#34;testing&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">simplifyTests</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Regexp</span>&nbsp;<span class="builtintype">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Simple</span>&nbsp;<span class="builtintype">string</span><br>
<span class="lineno"></span><span class="op">}</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Already-simple&nbsp;constructs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a`</span><span class="op">,</span>&nbsp;<span class="string">`a`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`ab`</span><span class="op">,</span>&nbsp;<span class="string">`ab`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a|b`</span><span class="op">,</span>&nbsp;<span class="string">`[a-b]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`ab|cd`</span><span class="op">,</span>&nbsp;<span class="string">`ab|cd`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(ab)*`</span><span class="op">,</span>&nbsp;<span class="string">`(ab)*`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(ab)+`</span><span class="op">,</span>&nbsp;<span class="string">`(ab)+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(ab)?`</span><span class="op">,</span>&nbsp;<span class="string">`(ab)?`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`.`</span><span class="op">,</span>&nbsp;<span class="string">`(?s:.)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`^`</span><span class="op">,</span>&nbsp;<span class="string">`^`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`$`</span><span class="op">,</span>&nbsp;<span class="string">`$`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[ac]`</span><span class="op">,</span>&nbsp;<span class="string">`[ac]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[^ac]`</span><span class="op">,</span>&nbsp;<span class="string">`[^ac]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Posix&nbsp;character&nbsp;classes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:alnum:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9A-Za-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:alpha:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[A-Za-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:blank:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[\t&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:cntrl:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[\x00-\x1f\x7f]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:digit:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:graph:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[!-~]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:lower:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:print:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[&nbsp;-~]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:punct:]]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[!-/:-@\\[-`\\{-~]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:space:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[\t-\r&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:upper:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[A-Z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:xdigit:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9A-Fa-f]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Perl&nbsp;character&nbsp;classes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\d`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\s`</span><span class="op">,</span>&nbsp;<span class="string">`[\t-\n\f-\r&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\w`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9A-Z_a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\D`</span><span class="op">,</span>&nbsp;<span class="string">`[^0-9]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\S`</span><span class="op">,</span>&nbsp;<span class="string">`[^\t-\n\f-\r&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`\W`</span><span class="op">,</span>&nbsp;<span class="string">`[^0-9A-Z_a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\d]`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\s]`</span><span class="op">,</span>&nbsp;<span class="string">`[\t-\n\f-\r&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\w]`</span><span class="op">,</span>&nbsp;<span class="string">`[0-9A-Z_a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\D]`</span><span class="op">,</span>&nbsp;<span class="string">`[^0-9]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\S]`</span><span class="op">,</span>&nbsp;<span class="string">`[^\t-\n\f-\r&nbsp;]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[\W]`</span><span class="op">,</span>&nbsp;<span class="string">`[^0-9A-Z_a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Posix&nbsp;repetitions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{1}`</span><span class="op">,</span>&nbsp;<span class="string">`a`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{2}`</span><span class="op">,</span>&nbsp;<span class="string">`aa`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{5}`</span><span class="op">,</span>&nbsp;<span class="string">`aaaaa`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{0,1}`</span><span class="op">,</span>&nbsp;<span class="string">`a?`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;next&nbsp;three&nbsp;are&nbsp;illegible&nbsp;because&nbsp;Simplify&nbsp;inserts&nbsp;(?:)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;parens&nbsp;instead&nbsp;of&nbsp;()&nbsp;parens&nbsp;to&nbsp;avoid&nbsp;creating&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;captured&nbsp;subexpressions.&nbsp;&nbsp;The&nbsp;comments&nbsp;show&nbsp;a&nbsp;version&nbsp;with&nbsp;fewer&nbsp;parens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a){0,2}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:(a)(a)?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(aa?)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a){0,4}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:(a)(?:(a)(?:(a)(a)?)?)?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;&nbsp;&nbsp;(a(a(aa?)?)?)?</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a){2,6}`</span><span class="op">,</span>&nbsp;<span class="string">`(a)(a)(?:(a)(?:(a)(?:(a)(a)?)?)?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;aa(a(a(aa?)?)?)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{0,2}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:aa?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(aa?)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{0,4}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:a(?:a(?:aa?)?)?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;&nbsp;&nbsp;(a(a(aa?)?)?)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{2,6}`</span><span class="op">,</span>&nbsp;<span class="string">`aa(?:a(?:a(?:aa?)?)?)?`</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;aa(a(a(aa?)?)?)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{0,}`</span><span class="op">,</span>&nbsp;<span class="string">`a*`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{1,}`</span><span class="op">,</span>&nbsp;<span class="string">`a+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{2,}`</span><span class="op">,</span>&nbsp;<span class="string">`aa+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{5,}`</span><span class="op">,</span>&nbsp;<span class="string">`aaaaa+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Test&nbsp;that&nbsp;operators&nbsp;simplify&nbsp;their&nbsp;arguments.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?:a{1,}){1,}`</span><span class="op">,</span>&nbsp;<span class="string">`a+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a{1,}b{1,})`</span><span class="op">,</span>&nbsp;<span class="string">`(a+b+)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{1,}|b{1,}`</span><span class="op">,</span>&nbsp;<span class="string">`a+|b+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?:a{1,})*`</span><span class="op">,</span>&nbsp;<span class="string">`(?:a+)*`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?:a{1,})+`</span><span class="op">,</span>&nbsp;<span class="string">`a+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?:a{1,})?`</span><span class="op">,</span>&nbsp;<span class="string">`(?:a+)?`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">``</span><span class="op">,</span>&nbsp;<span class="string">`(?:)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a{0}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Character&nbsp;class&nbsp;simplification</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[ab]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-b]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[a-za-za-z]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[A-Za-zA-Za-z]`</span><span class="op">,</span>&nbsp;<span class="string">`[A-Za-z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[ABCDEFGH]`</span><span class="op">,</span>&nbsp;<span class="string">`[A-H]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[AB-CD-EF-GH]`</span><span class="op">,</span>&nbsp;<span class="string">`[A-H]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[W-ZP-XE-R]`</span><span class="op">,</span>&nbsp;<span class="string">`[E-Z]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[a-ee-gg-m]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-m]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[a-ea-ha-m]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-m]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[a-ma-ha-e]`</span><span class="op">,</span>&nbsp;<span class="string">`[a-m]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[a-zA-Z0-9&nbsp;-~]`</span><span class="op">,</span>&nbsp;<span class="string">`[&nbsp;-~]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Empty&nbsp;character&nbsp;classes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[^[:cntrl:][:^cntrl:]]`</span><span class="op">,</span>&nbsp;<span class="string">`[^\x00-\x{10FFFF}]`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Full&nbsp;character&nbsp;classes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`[[:cntrl:][:^cntrl:]]`</span><span class="op">,</span>&nbsp;<span class="string">`(?s:.)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Unicode&nbsp;case&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)A`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:A)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)a`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:A)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[A]`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:A)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[a]`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:A)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)K`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:K)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)k`</span><span class="op">,</span>&nbsp;<span class="string">`(?i:K)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)\x{212a}`</span><span class="op">,</span>&nbsp;<span class="string">&#34;(?i:K)&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[K]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[Kk\u212A]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[k]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[Kk\u212A]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[\x{212a}]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[Kk\u212A]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[a-z]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[A-Za-z\u017F\u212A]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[\x00-\x{FFFD}]`</span><span class="op">,</span>&nbsp;<span class="string">&#34;[\\x00-\uFFFD]&#34;</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(?i)[\x00-\x{10FFFF}]`</span><span class="op">,</span>&nbsp;<span class="string">`(?s:.)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Empty&nbsp;string&nbsp;as&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;empty&nbsp;string&nbsp;must&nbsp;be&nbsp;preserved&nbsp;inside&nbsp;parens&nbsp;in&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;to&nbsp;make&nbsp;submatches&nbsp;work&nbsp;right,&nbsp;so&nbsp;these&nbsp;tests&nbsp;are&nbsp;less</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;interesting&nbsp;than&nbsp;they&nbsp;might&nbsp;otherwise&nbsp;be.&nbsp;&nbsp;String&nbsp;inserts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;explicit&nbsp;(?:)&nbsp;in&nbsp;place&nbsp;of&nbsp;non-parenthesized&nbsp;empty&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;to&nbsp;make&nbsp;them&nbsp;easier&nbsp;to&nbsp;spot&nbsp;for&nbsp;other&nbsp;parsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a|b|)`</span><span class="op">,</span>&nbsp;<span class="string">`([a-b]|(?:))`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(|)`</span><span class="op">,</span>&nbsp;<span class="string">`()`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`a()`</span><span class="op">,</span>&nbsp;<span class="string">`a()`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(()|())`</span><span class="op">,</span>&nbsp;<span class="string">`(()|())`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(a|)`</span><span class="op">,</span>&nbsp;<span class="string">`(a|(?:))`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`ab()cd()`</span><span class="op">,</span>&nbsp;<span class="string">`ab()cd()`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`()`</span><span class="op">,</span>&nbsp;<span class="string">`()`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`()*`</span><span class="op">,</span>&nbsp;<span class="string">`()*`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`()+`</span><span class="op">,</span>&nbsp;<span class="string">`()+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`()?`</span><span class="op">,</span>&nbsp;<span class="string">`()?`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(){0}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:)`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(){1}`</span><span class="op">,</span>&nbsp;<span class="string">`()`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(){1,}`</span><span class="op">,</span>&nbsp;<span class="string">`()+`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="string">`(){0,2}`</span><span class="op">,</span>&nbsp;<span class="string">`(?:()()?)?`</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">TestSimplify</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">testing</span><span class="op">.</span><span class="ident">T</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">tt</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">simplifyTests</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">re</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Parse</span><span class="op">(</span><span class="ident">tt</span><span class="op">.</span><span class="ident">Regexp</span><span class="op">,</span>&nbsp;<span class="ident">MatchNL</span><span class="op">|</span><span class="ident">Perl</span><span class="op">&amp;^</span><span class="ident">OneLine</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;Parse(%#q)&nbsp;=&nbsp;error&nbsp;%v&#34;</span><span class="op">,</span>&nbsp;<span class="ident">tt</span><span class="op">.</span><span class="ident">Regexp</span><span class="op">,</span>&nbsp;<span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">re</span><span class="op">.</span><span class="ident">Simplify</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="ident">String</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">s</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">tt</span><span class="op">.</span><span class="ident">Simple</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">Errorf</span><span class="op">(</span><span class="string">&#34;Simplify(%#q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op">,</span>&nbsp;<span class="ident">tt</span><span class="op">.</span><span class="ident">Regexp</span><span class="op">,</span>&nbsp;<span class="ident">s</span><span class="op">,</span>&nbsp;<span class="ident">tt</span><span class="op">.</span><span class="ident">Simple</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
