<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3631040">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3631095">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3631149">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3631200">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3631268">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3631314">//</span><br>
<span class="lineno"></span><span class="comment" id="3631317">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;signed&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3631342">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsp;rational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3631368">//</span><br>
<span class="lineno"></span><span class="comment" id="3631371">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3631409">//</span><br>
<span class="lineno"></span><span class="comment" id="3631412">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp;(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3631467">//</span><br>
<span class="lineno">15</span><span class="comment" id="3631470">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3631544">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3631617">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3631691">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3631765">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3631782">//</span><br>
<span class="lineno"></span><span class="keyword" id="3631785">package</span>&nbsp;<span class="ident" id="3631793">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3631798">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3631869">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3631940">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3631959">import</span>&nbsp;<span class="op" id="3631966">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3631969">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3631979">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3631985">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3631993">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3632006">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3632013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3632016">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3632053">//</span><br>
<span class="lineno"></span><span class="comment" id="3632056">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3632122">//</span><br>
<span class="lineno"></span><span class="comment" id="3632125">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3632197">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3632244">//</span><br>
<span class="lineno"></span><span class="comment" id="3632247">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3632316">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3632387">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3632458">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3632521">//</span><br>
<span class="lineno"></span><span class="keyword" id="3632524">type</span>&nbsp;<span class="ident" id="3632529">nat</span>&nbsp;<span class="op" id="3632533">[</span><span class="op" id="3632534">]</span><span class="ident" id="3632535">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3632541">var</span>&nbsp;<span class="op" id="3632545">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632548">natOne</span>&nbsp;<span class="op" id="3632555">=</span>&nbsp;<span class="ident" id="3632557">nat</span><span class="op" id="3632560">{</span><span class="num" id="3632561">1</span><span class="op" id="3632562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632565">natTwo</span>&nbsp;<span class="op" id="3632572">=</span>&nbsp;<span class="ident" id="3632574">nat</span><span class="op" id="3632577">{</span><span class="num" id="3632578">2</span><span class="op" id="3632579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632582">natTen</span>&nbsp;<span class="op" id="3632589">=</span>&nbsp;<span class="ident" id="3632591">nat</span><span class="op" id="3632594">{</span><span class="num" id="3632595">10</span><span class="op" id="3632597">}</span><br>
<span class="lineno"></span><span class="op" id="3632599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3632602">func</span>&nbsp;<span class="op" id="3632607">(</span><span class="ident" id="3632608">z</span>&nbsp;<span class="ident" id="3632610">nat</span><span class="op" id="3632613">)</span>&nbsp;<span class="ident" id="3632615">clear</span><span class="op" id="3632620">(</span><span class="op" id="3632621">)</span>&nbsp;<span class="op" id="3632623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632626">for</span>&nbsp;<span class="ident" id="3632630">i</span>&nbsp;<span class="op" id="3632632">:=</span>&nbsp;<span class="keyword" id="3632635">range</span>&nbsp;<span class="ident" id="3632641">z</span>&nbsp;<span class="op" id="3632643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632647">z</span><span class="op" id="3632648">[</span><span class="ident" id="3632649">i</span><span class="op" id="3632650">]</span>&nbsp;<span class="op" id="3632652">=</span>&nbsp;<span class="num" id="3632654">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632657">}</span><br>
<span class="lineno"></span><span class="op" id="3632659">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3632662">func</span>&nbsp;<span class="op" id="3632667">(</span><span class="ident" id="3632668">z</span>&nbsp;<span class="ident" id="3632670">nat</span><span class="op" id="3632673">)</span>&nbsp;<span class="ident" id="3632675">norm</span><span class="op" id="3632679">(</span><span class="op" id="3632680">)</span>&nbsp;<span class="ident" id="3632682">nat</span>&nbsp;<span class="op" id="3632686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632689">i</span>&nbsp;<span class="op" id="3632691">:=</span>&nbsp;<span class="builtinfunc" id="3632694">len</span><span class="op" id="3632697">(</span><span class="ident" id="3632698">z</span><span class="op" id="3632699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632702">for</span>&nbsp;<span class="ident" id="3632706">i</span>&nbsp;<span class="op" id="3632708">&gt;</span>&nbsp;<span class="num" id="3632710">0</span>&nbsp;<span class="op" id="3632712">&amp;&amp;</span>&nbsp;<span class="ident" id="3632715">z</span><span class="op" id="3632716">[</span><span class="ident" id="3632717">i</span><span class="op" id="3632718">-</span><span class="num" id="3632719">1</span><span class="op" id="3632720">]</span>&nbsp;<span class="op" id="3632722">==</span>&nbsp;<span class="num" id="3632725">0</span>&nbsp;<span class="op" id="3632727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3632731">i</span><span class="op" id="3632732">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632739">return</span>&nbsp;<span class="ident" id="3632746">z</span><span class="op" id="3632747">[</span><span class="num" id="3632748">0</span><span class="op" id="3632749">:</span><span class="ident" id="3632750">i</span><span class="op" id="3632751">]</span><br>
<span class="lineno"></span><span class="op" id="3632753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3632756">func</span>&nbsp;<span class="op" id="3632761">(</span><span class="ident" id="3632762">z</span>&nbsp;<span class="ident" id="3632764">nat</span><span class="op" id="3632767">)</span>&nbsp;<span class="builtinfunc" id="3632769">make</span><span class="op" id="3632773">(</span><span class="ident" id="3632774">n</span>&nbsp;<span class="builtintype" id="3632776">int</span><span class="op" id="3632779">)</span>&nbsp;<span class="ident" id="3632781">nat</span>&nbsp;<span class="op" id="3632785">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632788">if</span>&nbsp;<span class="ident" id="3632791">n</span>&nbsp;<span class="op" id="3632793">&lt;=</span>&nbsp;<span class="builtinfunc" id="3632796">cap</span><span class="op" id="3632799">(</span><span class="ident" id="3632800">z</span><span class="op" id="3632801">)</span>&nbsp;<span class="op" id="3632803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632807">return</span>&nbsp;<span class="ident" id="3632814">z</span><span class="op" id="3632815">[</span><span class="num" id="3632816">0</span><span class="op" id="3632817">:</span><span class="ident" id="3632818">n</span><span class="op" id="3632819">]</span>&nbsp;<span class="comment" id="3632821">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3632833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3632836">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3632903">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632967">const</span>&nbsp;<span class="ident" id="3632973">e</span>&nbsp;<span class="op" id="3632975">=</span>&nbsp;<span class="num" id="3632977">4</span>&nbsp;<span class="comment" id="3632979">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3632998">return</span>&nbsp;<span class="builtinfunc" id="3633005">make</span><span class="op" id="3633009">(</span><span class="ident" id="3633010">nat</span><span class="op" id="3633013">,</span>&nbsp;<span class="ident" id="3633015">n</span><span class="op" id="3633016">,</span>&nbsp;<span class="ident" id="3633018">n</span><span class="op" id="3633019">+</span><span class="ident" id="3633020">e</span><span class="op" id="3633021">)</span><br>
<span class="lineno"></span><span class="op" id="3633023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633026">func</span>&nbsp;<span class="op" id="3633031">(</span><span class="ident" id="3633032">z</span>&nbsp;<span class="ident" id="3633034">nat</span><span class="op" id="3633037">)</span>&nbsp;<span class="ident" id="3633039">setWord</span><span class="op" id="3633046">(</span><span class="ident" id="3633047">x</span>&nbsp;<span class="ident" id="3633049">Word</span><span class="op" id="3633053">)</span>&nbsp;<span class="ident" id="3633055">nat</span>&nbsp;<span class="op" id="3633059">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633062">if</span>&nbsp;<span class="ident" id="3633065">x</span>&nbsp;<span class="op" id="3633067">==</span>&nbsp;<span class="num" id="3633070">0</span>&nbsp;<span class="op" id="3633072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633076">return</span>&nbsp;<span class="ident" id="3633083">z</span><span class="op" id="3633084">.</span><span class="builtinfunc" id="3633085">make</span><span class="op" id="3633089">(</span><span class="num" id="3633090">0</span><span class="op" id="3633091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633097">z</span>&nbsp;<span class="op" id="3633099">=</span>&nbsp;<span class="ident" id="3633101">z</span><span class="op" id="3633102">.</span><span class="builtinfunc" id="3633103">make</span><span class="op" id="3633107">(</span><span class="num" id="3633108">1</span><span class="op" id="3633109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633112">z</span><span class="op" id="3633113">[</span><span class="num" id="3633114">0</span><span class="op" id="3633115">]</span>&nbsp;<span class="op" id="3633117">=</span>&nbsp;<span class="ident" id="3633119">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633122">return</span>&nbsp;<span class="ident" id="3633129">z</span><br>
<span class="lineno"></span><span class="op" id="3633131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633134">func</span>&nbsp;<span class="op" id="3633139">(</span><span class="ident" id="3633140">z</span>&nbsp;<span class="ident" id="3633142">nat</span><span class="op" id="3633145">)</span>&nbsp;<span class="ident" id="3633147">setUint64</span><span class="op" id="3633156">(</span><span class="ident" id="3633157">x</span>&nbsp;<span class="ident" id="3633159">uint64</span><span class="op" id="3633165">)</span>&nbsp;<span class="ident" id="3633167">nat</span>&nbsp;<span class="op" id="3633171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633174">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633198">if</span>&nbsp;<span class="ident" id="3633201">w</span>&nbsp;<span class="op" id="3633203">:=</span>&nbsp;<span class="ident" id="3633206">Word</span><span class="op" id="3633210">(</span><span class="ident" id="3633211">x</span><span class="op" id="3633212">)</span><span class="op" id="3633213">;</span>&nbsp;<span class="ident" id="3633215">uint64</span><span class="op" id="3633221">(</span><span class="ident" id="3633222">w</span><span class="op" id="3633223">)</span>&nbsp;<span class="op" id="3633225">==</span>&nbsp;<span class="ident" id="3633228">x</span>&nbsp;<span class="op" id="3633230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633234">return</span>&nbsp;<span class="ident" id="3633241">z</span><span class="op" id="3633242">.</span><span class="ident" id="3633243">setWord</span><span class="op" id="3633250">(</span><span class="ident" id="3633251">w</span><span class="op" id="3633252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633259">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633313">n</span>&nbsp;<span class="op" id="3633315">:=</span>&nbsp;<span class="num" id="3633318">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633321">for</span>&nbsp;<span class="ident" id="3633325">t</span>&nbsp;<span class="op" id="3633327">:=</span>&nbsp;<span class="ident" id="3633330">x</span><span class="op" id="3633331">;</span>&nbsp;<span class="ident" id="3633333">t</span>&nbsp;<span class="op" id="3633335">&gt;</span>&nbsp;<span class="num" id="3633337">0</span><span class="op" id="3633338">;</span>&nbsp;<span class="ident" id="3633340">t</span>&nbsp;<span class="op" id="3633342">&gt;&gt;=</span>&nbsp;<span class="ident" id="3633346">_W</span>&nbsp;<span class="op" id="3633349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633353">n</span><span class="op" id="3633354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633362">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633387">z</span>&nbsp;<span class="op" id="3633389">=</span>&nbsp;<span class="ident" id="3633391">z</span><span class="op" id="3633392">.</span><span class="builtinfunc" id="3633393">make</span><span class="op" id="3633397">(</span><span class="ident" id="3633398">n</span><span class="op" id="3633399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633402">for</span>&nbsp;<span class="ident" id="3633406">i</span>&nbsp;<span class="op" id="3633408">:=</span>&nbsp;<span class="keyword" id="3633411">range</span>&nbsp;<span class="ident" id="3633417">z</span>&nbsp;<span class="op" id="3633419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633423">z</span><span class="op" id="3633424">[</span><span class="ident" id="3633425">i</span><span class="op" id="3633426">]</span>&nbsp;<span class="op" id="3633428">=</span>&nbsp;<span class="ident" id="3633430">Word</span><span class="op" id="3633434">(</span><span class="ident" id="3633435">x</span>&nbsp;<span class="op" id="3633437">&amp;</span>&nbsp;<span class="ident" id="3633439">_M</span><span class="op" id="3633441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633445">x</span>&nbsp;<span class="op" id="3633447">&gt;&gt;=</span>&nbsp;<span class="ident" id="3633451">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633459">return</span>&nbsp;<span class="ident" id="3633466">z</span><br>
<span class="lineno"></span><span class="op" id="3633468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3633471">func</span>&nbsp;<span class="op" id="3633476">(</span><span class="ident" id="3633477">z</span>&nbsp;<span class="ident" id="3633479">nat</span><span class="op" id="3633482">)</span>&nbsp;<span class="ident" id="3633484">set</span><span class="op" id="3633487">(</span><span class="ident" id="3633488">x</span>&nbsp;<span class="ident" id="3633490">nat</span><span class="op" id="3633493">)</span>&nbsp;<span class="ident" id="3633495">nat</span>&nbsp;<span class="op" id="3633499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633502">z</span>&nbsp;<span class="op" id="3633504">=</span>&nbsp;<span class="ident" id="3633506">z</span><span class="op" id="3633507">.</span><span class="builtinfunc" id="3633508">make</span><span class="op" id="3633512">(</span><span class="builtinfunc" id="3633513">len</span><span class="op" id="3633516">(</span><span class="ident" id="3633517">x</span><span class="op" id="3633518">)</span><span class="op" id="3633519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3633522">copy</span><span class="op" id="3633526">(</span><span class="ident" id="3633527">z</span><span class="op" id="3633528">,</span>&nbsp;<span class="ident" id="3633530">x</span><span class="op" id="3633531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633534">return</span>&nbsp;<span class="ident" id="3633541">z</span><br>
<span class="lineno"></span><span class="op" id="3633543">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3633546">func</span>&nbsp;<span class="op" id="3633551">(</span><span class="ident" id="3633552">z</span>&nbsp;<span class="ident" id="3633554">nat</span><span class="op" id="3633557">)</span>&nbsp;<span class="ident" id="3633559">add</span><span class="op" id="3633562">(</span><span class="ident" id="3633563">x</span><span class="op" id="3633564">,</span>&nbsp;<span class="ident" id="3633566">y</span>&nbsp;<span class="ident" id="3633568">nat</span><span class="op" id="3633571">)</span>&nbsp;<span class="ident" id="3633573">nat</span>&nbsp;<span class="op" id="3633577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633580">m</span>&nbsp;<span class="op" id="3633582">:=</span>&nbsp;<span class="builtinfunc" id="3633585">len</span><span class="op" id="3633588">(</span><span class="ident" id="3633589">x</span><span class="op" id="3633590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633593">n</span>&nbsp;<span class="op" id="3633595">:=</span>&nbsp;<span class="builtinfunc" id="3633598">len</span><span class="op" id="3633601">(</span><span class="ident" id="3633602">y</span><span class="op" id="3633603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633607">switch</span>&nbsp;<span class="op" id="3633614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633617">case</span>&nbsp;<span class="ident" id="3633622">m</span>&nbsp;<span class="op" id="3633624">&lt;</span>&nbsp;<span class="ident" id="3633626">n</span><span class="op" id="3633627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633631">return</span>&nbsp;<span class="ident" id="3633638">z</span><span class="op" id="3633639">.</span><span class="ident" id="3633640">add</span><span class="op" id="3633643">(</span><span class="ident" id="3633644">y</span><span class="op" id="3633645">,</span>&nbsp;<span class="ident" id="3633647">x</span><span class="op" id="3633648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633651">case</span>&nbsp;<span class="ident" id="3633656">m</span>&nbsp;<span class="op" id="3633658">==</span>&nbsp;<span class="num" id="3633661">0</span><span class="op" id="3633662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633666">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633706">return</span>&nbsp;<span class="ident" id="3633713">z</span><span class="op" id="3633714">.</span><span class="builtinfunc" id="3633715">make</span><span class="op" id="3633719">(</span><span class="num" id="3633720">0</span><span class="op" id="3633721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633724">case</span>&nbsp;<span class="ident" id="3633729">n</span>&nbsp;<span class="op" id="3633731">==</span>&nbsp;<span class="num" id="3633734">0</span><span class="op" id="3633735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633739">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633756">return</span>&nbsp;<span class="ident" id="3633763">z</span><span class="op" id="3633764">.</span><span class="ident" id="3633765">set</span><span class="op" id="3633768">(</span><span class="ident" id="3633769">x</span><span class="op" id="3633770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633773">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3633776">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633787">z</span>&nbsp;<span class="op" id="3633789">=</span>&nbsp;<span class="ident" id="3633791">z</span><span class="op" id="3633792">.</span><span class="builtinfunc" id="3633793">make</span><span class="op" id="3633797">(</span><span class="ident" id="3633798">m</span>&nbsp;<span class="op" id="3633800">+</span>&nbsp;<span class="num" id="3633802">1</span><span class="op" id="3633803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633806">c</span>&nbsp;<span class="op" id="3633808">:=</span>&nbsp;<span class="ident" id="3633811">addVV</span><span class="op" id="3633816">(</span><span class="ident" id="3633817">z</span><span class="op" id="3633818">[</span><span class="num" id="3633819">0</span><span class="op" id="3633820">:</span><span class="ident" id="3633821">n</span><span class="op" id="3633822">]</span><span class="op" id="3633823">,</span>&nbsp;<span class="ident" id="3633825">x</span><span class="op" id="3633826">,</span>&nbsp;<span class="ident" id="3633828">y</span><span class="op" id="3633829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633832">if</span>&nbsp;<span class="ident" id="3633835">m</span>&nbsp;<span class="op" id="3633837">&gt;</span>&nbsp;<span class="ident" id="3633839">n</span>&nbsp;<span class="op" id="3633841">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633845">c</span>&nbsp;<span class="op" id="3633847">=</span>&nbsp;<span class="ident" id="3633849">addVW</span><span class="op" id="3633854">(</span><span class="ident" id="3633855">z</span><span class="op" id="3633856">[</span><span class="ident" id="3633857">n</span><span class="op" id="3633858">:</span><span class="ident" id="3633859">m</span><span class="op" id="3633860">]</span><span class="op" id="3633861">,</span>&nbsp;<span class="ident" id="3633863">x</span><span class="op" id="3633864">[</span><span class="ident" id="3633865">n</span><span class="op" id="3633866">:</span><span class="op" id="3633867">]</span><span class="op" id="3633868">,</span>&nbsp;<span class="ident" id="3633870">c</span><span class="op" id="3633871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633877">z</span><span class="op" id="3633878">[</span><span class="ident" id="3633879">m</span><span class="op" id="3633880">]</span>&nbsp;<span class="op" id="3633882">=</span>&nbsp;<span class="ident" id="3633884">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633888">return</span>&nbsp;<span class="ident" id="3633895">z</span><span class="op" id="3633896">.</span><span class="ident" id="3633897">norm</span><span class="op" id="3633901">(</span><span class="op" id="3633902">)</span><br>
<span class="lineno">140</span><span class="op" id="3633904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633907">func</span>&nbsp;<span class="op" id="3633912">(</span><span class="ident" id="3633913">z</span>&nbsp;<span class="ident" id="3633915">nat</span><span class="op" id="3633918">)</span>&nbsp;<span class="ident" id="3633920">sub</span><span class="op" id="3633923">(</span><span class="ident" id="3633924">x</span><span class="op" id="3633925">,</span>&nbsp;<span class="ident" id="3633927">y</span>&nbsp;<span class="ident" id="3633929">nat</span><span class="op" id="3633932">)</span>&nbsp;<span class="ident" id="3633934">nat</span>&nbsp;<span class="op" id="3633938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633941">m</span>&nbsp;<span class="op" id="3633943">:=</span>&nbsp;<span class="builtinfunc" id="3633946">len</span><span class="op" id="3633949">(</span><span class="ident" id="3633950">x</span><span class="op" id="3633951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633954">n</span>&nbsp;<span class="op" id="3633956">:=</span>&nbsp;<span class="builtinfunc" id="3633959">len</span><span class="op" id="3633962">(</span><span class="ident" id="3633963">y</span><span class="op" id="3633964">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633968">switch</span>&nbsp;<span class="op" id="3633975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3633978">case</span>&nbsp;<span class="ident" id="3633983">m</span>&nbsp;<span class="op" id="3633985">&lt;</span>&nbsp;<span class="ident" id="3633987">n</span><span class="op" id="3633988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3633992">panic</span><span class="op" id="3633997">(</span><span class="string" id="3633998">&#34;underflow&#34;</span><span class="op" id="3634009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634012">case</span>&nbsp;<span class="ident" id="3634017">m</span>&nbsp;<span class="op" id="3634019">==</span>&nbsp;<span class="num" id="3634022">0</span><span class="op" id="3634023">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634027">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634067">return</span>&nbsp;<span class="ident" id="3634074">z</span><span class="op" id="3634075">.</span><span class="builtinfunc" id="3634076">make</span><span class="op" id="3634080">(</span><span class="num" id="3634081">0</span><span class="op" id="3634082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634085">case</span>&nbsp;<span class="ident" id="3634090">n</span>&nbsp;<span class="op" id="3634092">==</span>&nbsp;<span class="num" id="3634095">0</span><span class="op" id="3634096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634100">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634117">return</span>&nbsp;<span class="ident" id="3634124">z</span><span class="op" id="3634125">.</span><span class="ident" id="3634126">set</span><span class="op" id="3634129">(</span><span class="ident" id="3634130">x</span><span class="op" id="3634131">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634137">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634148">z</span>&nbsp;<span class="op" id="3634150">=</span>&nbsp;<span class="ident" id="3634152">z</span><span class="op" id="3634153">.</span><span class="builtinfunc" id="3634154">make</span><span class="op" id="3634158">(</span><span class="ident" id="3634159">m</span><span class="op" id="3634160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634163">c</span>&nbsp;<span class="op" id="3634165">:=</span>&nbsp;<span class="ident" id="3634168">subVV</span><span class="op" id="3634173">(</span><span class="ident" id="3634174">z</span><span class="op" id="3634175">[</span><span class="num" id="3634176">0</span><span class="op" id="3634177">:</span><span class="ident" id="3634178">n</span><span class="op" id="3634179">]</span><span class="op" id="3634180">,</span>&nbsp;<span class="ident" id="3634182">x</span><span class="op" id="3634183">,</span>&nbsp;<span class="ident" id="3634185">y</span><span class="op" id="3634186">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634189">if</span>&nbsp;<span class="ident" id="3634192">m</span>&nbsp;<span class="op" id="3634194">&gt;</span>&nbsp;<span class="ident" id="3634196">n</span>&nbsp;<span class="op" id="3634198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634202">c</span>&nbsp;<span class="op" id="3634204">=</span>&nbsp;<span class="ident" id="3634206">subVW</span><span class="op" id="3634211">(</span><span class="ident" id="3634212">z</span><span class="op" id="3634213">[</span><span class="ident" id="3634214">n</span><span class="op" id="3634215">:</span><span class="op" id="3634216">]</span><span class="op" id="3634217">,</span>&nbsp;<span class="ident" id="3634219">x</span><span class="op" id="3634220">[</span><span class="ident" id="3634221">n</span><span class="op" id="3634222">:</span><span class="op" id="3634223">]</span><span class="op" id="3634224">,</span>&nbsp;<span class="ident" id="3634226">c</span><span class="op" id="3634227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634233">if</span>&nbsp;<span class="ident" id="3634236">c</span>&nbsp;<span class="op" id="3634238">!=</span>&nbsp;<span class="num" id="3634241">0</span>&nbsp;<span class="op" id="3634243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3634247">panic</span><span class="op" id="3634252">(</span><span class="string" id="3634253">&#34;underflow&#34;</span><span class="op" id="3634264">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634271">return</span>&nbsp;<span class="ident" id="3634278">z</span><span class="op" id="3634279">.</span><span class="ident" id="3634280">norm</span><span class="op" id="3634284">(</span><span class="op" id="3634285">)</span><br>
<span class="lineno"></span><span class="op" id="3634287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3634290">func</span>&nbsp;<span class="op" id="3634295">(</span><span class="ident" id="3634296">x</span>&nbsp;<span class="ident" id="3634298">nat</span><span class="op" id="3634301">)</span>&nbsp;<span class="ident" id="3634303">cmp</span><span class="op" id="3634306">(</span><span class="ident" id="3634307">y</span>&nbsp;<span class="ident" id="3634309">nat</span><span class="op" id="3634312">)</span>&nbsp;<span class="op" id="3634314">(</span><span class="ident" id="3634315">r</span>&nbsp;<span class="builtintype" id="3634317">int</span><span class="op" id="3634320">)</span>&nbsp;<span class="op" id="3634322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634325">m</span>&nbsp;<span class="op" id="3634327">:=</span>&nbsp;<span class="builtinfunc" id="3634330">len</span><span class="op" id="3634333">(</span><span class="ident" id="3634334">x</span><span class="op" id="3634335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634338">n</span>&nbsp;<span class="op" id="3634340">:=</span>&nbsp;<span class="builtinfunc" id="3634343">len</span><span class="op" id="3634346">(</span><span class="ident" id="3634347">y</span><span class="op" id="3634348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634351">if</span>&nbsp;<span class="ident" id="3634354">m</span>&nbsp;<span class="op" id="3634356">!=</span>&nbsp;<span class="ident" id="3634359">n</span>&nbsp;<span class="op" id="3634361">||</span>&nbsp;<span class="ident" id="3634364">m</span>&nbsp;<span class="op" id="3634366">==</span>&nbsp;<span class="num" id="3634369">0</span>&nbsp;<span class="op" id="3634371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634375">switch</span>&nbsp;<span class="op" id="3634382">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634386">case</span>&nbsp;<span class="ident" id="3634391">m</span>&nbsp;<span class="op" id="3634393">&lt;</span>&nbsp;<span class="ident" id="3634395">n</span><span class="op" id="3634396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634401">r</span>&nbsp;<span class="op" id="3634403">=</span>&nbsp;<span class="op" id="3634405">-</span><span class="num" id="3634406">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634410">case</span>&nbsp;<span class="ident" id="3634415">m</span>&nbsp;<span class="op" id="3634417">&gt;</span>&nbsp;<span class="ident" id="3634419">n</span><span class="op" id="3634420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634425">r</span>&nbsp;<span class="op" id="3634427">=</span>&nbsp;<span class="num" id="3634429">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634433">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634437">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634449">i</span>&nbsp;<span class="op" id="3634451">:=</span>&nbsp;<span class="ident" id="3634454">m</span>&nbsp;<span class="op" id="3634456">-</span>&nbsp;<span class="num" id="3634458">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634461">for</span>&nbsp;<span class="ident" id="3634465">i</span>&nbsp;<span class="op" id="3634467">&gt;</span>&nbsp;<span class="num" id="3634469">0</span>&nbsp;<span class="op" id="3634471">&amp;&amp;</span>&nbsp;<span class="ident" id="3634474">x</span><span class="op" id="3634475">[</span><span class="ident" id="3634476">i</span><span class="op" id="3634477">]</span>&nbsp;<span class="op" id="3634479">==</span>&nbsp;<span class="ident" id="3634482">y</span><span class="op" id="3634483">[</span><span class="ident" id="3634484">i</span><span class="op" id="3634485">]</span>&nbsp;<span class="op" id="3634487">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634491">i</span><span class="op" id="3634492">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634500">switch</span>&nbsp;<span class="op" id="3634507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634510">case</span>&nbsp;<span class="ident" id="3634515">x</span><span class="op" id="3634516">[</span><span class="ident" id="3634517">i</span><span class="op" id="3634518">]</span>&nbsp;<span class="op" id="3634520">&lt;</span>&nbsp;<span class="ident" id="3634522">y</span><span class="op" id="3634523">[</span><span class="ident" id="3634524">i</span><span class="op" id="3634525">]</span><span class="op" id="3634526">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634530">r</span>&nbsp;<span class="op" id="3634532">=</span>&nbsp;<span class="op" id="3634534">-</span><span class="num" id="3634535">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634538">case</span>&nbsp;<span class="ident" id="3634543">x</span><span class="op" id="3634544">[</span><span class="ident" id="3634545">i</span><span class="op" id="3634546">]</span>&nbsp;<span class="op" id="3634548">&gt;</span>&nbsp;<span class="ident" id="3634550">y</span><span class="op" id="3634551">[</span><span class="ident" id="3634552">i</span><span class="op" id="3634553">]</span><span class="op" id="3634554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634558">r</span>&nbsp;<span class="op" id="3634560">=</span>&nbsp;<span class="num" id="3634562">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634568">return</span><br>
<span class="lineno">195</span><span class="op" id="3634575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634578">func</span>&nbsp;<span class="op" id="3634583">(</span><span class="ident" id="3634584">z</span>&nbsp;<span class="ident" id="3634586">nat</span><span class="op" id="3634589">)</span>&nbsp;<span class="ident" id="3634591">mulAddWW</span><span class="op" id="3634599">(</span><span class="ident" id="3634600">x</span>&nbsp;<span class="ident" id="3634602">nat</span><span class="op" id="3634605">,</span>&nbsp;<span class="ident" id="3634607">y</span><span class="op" id="3634608">,</span>&nbsp;<span class="ident" id="3634610">r</span>&nbsp;<span class="ident" id="3634612">Word</span><span class="op" id="3634616">)</span>&nbsp;<span class="ident" id="3634618">nat</span>&nbsp;<span class="op" id="3634622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634625">m</span>&nbsp;<span class="op" id="3634627">:=</span>&nbsp;<span class="builtinfunc" id="3634630">len</span><span class="op" id="3634633">(</span><span class="ident" id="3634634">x</span><span class="op" id="3634635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634638">if</span>&nbsp;<span class="ident" id="3634641">m</span>&nbsp;<span class="op" id="3634643">==</span>&nbsp;<span class="num" id="3634646">0</span>&nbsp;<span class="op" id="3634648">||</span>&nbsp;<span class="ident" id="3634651">y</span>&nbsp;<span class="op" id="3634653">==</span>&nbsp;<span class="num" id="3634656">0</span>&nbsp;<span class="op" id="3634658">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634662">return</span>&nbsp;<span class="ident" id="3634669">z</span><span class="op" id="3634670">.</span><span class="ident" id="3634671">setWord</span><span class="op" id="3634678">(</span><span class="ident" id="3634679">r</span><span class="op" id="3634680">)</span>&nbsp;<span class="comment" id="3634682">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3634698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3634701">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634712">z</span>&nbsp;<span class="op" id="3634714">=</span>&nbsp;<span class="ident" id="3634716">z</span><span class="op" id="3634717">.</span><span class="builtinfunc" id="3634718">make</span><span class="op" id="3634722">(</span><span class="ident" id="3634723">m</span>&nbsp;<span class="op" id="3634725">+</span>&nbsp;<span class="num" id="3634727">1</span><span class="op" id="3634728">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634731">z</span><span class="op" id="3634732">[</span><span class="ident" id="3634733">m</span><span class="op" id="3634734">]</span>&nbsp;<span class="op" id="3634736">=</span>&nbsp;<span class="ident" id="3634738">mulAddVWW</span><span class="op" id="3634747">(</span><span class="ident" id="3634748">z</span><span class="op" id="3634749">[</span><span class="num" id="3634750">0</span><span class="op" id="3634751">:</span><span class="ident" id="3634752">m</span><span class="op" id="3634753">]</span><span class="op" id="3634754">,</span>&nbsp;<span class="ident" id="3634756">x</span><span class="op" id="3634757">,</span>&nbsp;<span class="ident" id="3634759">y</span><span class="op" id="3634760">,</span>&nbsp;<span class="ident" id="3634762">r</span><span class="op" id="3634763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634767">return</span>&nbsp;<span class="ident" id="3634774">z</span><span class="op" id="3634775">.</span><span class="ident" id="3634776">norm</span><span class="op" id="3634780">(</span><span class="op" id="3634781">)</span><br>
<span class="lineno"></span><span class="op" id="3634783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3634786">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3634845">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3634913">func</span>&nbsp;<span class="ident" id="3634918">basicMul</span><span class="op" id="3634926">(</span><span class="ident" id="3634927">z</span><span class="op" id="3634928">,</span>&nbsp;<span class="ident" id="3634930">x</span><span class="op" id="3634931">,</span>&nbsp;<span class="ident" id="3634933">y</span>&nbsp;<span class="ident" id="3634935">nat</span><span class="op" id="3634938">)</span>&nbsp;<span class="op" id="3634940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3634943">z</span><span class="op" id="3634944">[</span><span class="num" id="3634945">0</span>&nbsp;<span class="op" id="3634947">:</span>&nbsp;<span class="builtinfunc" id="3634949">len</span><span class="op" id="3634952">(</span><span class="ident" id="3634953">x</span><span class="op" id="3634954">)</span><span class="op" id="3634955">+</span><span class="builtinfunc" id="3634956">len</span><span class="op" id="3634959">(</span><span class="ident" id="3634960">y</span><span class="op" id="3634961">)</span><span class="op" id="3634962">]</span><span class="op" id="3634963">.</span><span class="ident" id="3634964">clear</span><span class="op" id="3634969">(</span><span class="op" id="3634970">)</span>&nbsp;<span class="comment" id="3634972">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3634989">for</span>&nbsp;<span class="ident" id="3634993">i</span><span class="op" id="3634994">,</span>&nbsp;<span class="ident" id="3634996">d</span>&nbsp;<span class="op" id="3634998">:=</span>&nbsp;<span class="keyword" id="3635001">range</span>&nbsp;<span class="ident" id="3635007">y</span>&nbsp;<span class="op" id="3635009">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3635013">if</span>&nbsp;<span class="ident" id="3635016">d</span>&nbsp;<span class="op" id="3635018">!=</span>&nbsp;<span class="num" id="3635021">0</span>&nbsp;<span class="op" id="3635023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3635028">z</span><span class="op" id="3635029">[</span><span class="builtinfunc" id="3635030">len</span><span class="op" id="3635033">(</span><span class="ident" id="3635034">x</span><span class="op" id="3635035">)</span><span class="op" id="3635036">+</span><span class="ident" id="3635037">i</span><span class="op" id="3635038">]</span>&nbsp;<span class="op" id="3635040">=</span>&nbsp;<span class="ident" id="3635042">addMulVVW</span><span class="op" id="3635051">(</span><span class="ident" id="3635052">z</span><span class="op" id="3635053">[</span><span class="ident" id="3635054">i</span><span class="op" id="3635055">:</span><span class="ident" id="3635056">i</span><span class="op" id="3635057">+</span><span class="builtinfunc" id="3635058">len</span><span class="op" id="3635061">(</span><span class="ident" id="3635062">x</span><span class="op" id="3635063">)</span><span class="op" id="3635064">]</span><span class="op" id="3635065">,</span>&nbsp;<span class="ident" id="3635067">x</span><span class="op" id="3635068">,</span>&nbsp;<span class="ident" id="3635070">d</span><span class="op" id="3635071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3635075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3635078">}</span><br>
<span class="lineno"></span><span class="op" id="3635080">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3635083">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3635158">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3635222">func</span>&nbsp;<span class="ident" id="3635227">karatsubaAdd</span><span class="op" id="3635239">(</span><span class="ident" id="3635240">z</span><span class="op" id="3635241">,</span>&nbsp;<span class="ident" id="3635243">x</span>&nbsp;<span class="ident" id="3635245">nat</span><span class="op" id="3635248">,</span>&nbsp;<span class="ident" id="3635250">n</span>&nbsp;<span class="builtintype" id="3635252">int</span><span class="op" id="3635255">)</span>&nbsp;<span class="op" id="3635257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3635260">if</span>&nbsp;<span class="ident" id="3635263">c</span>&nbsp;<span class="op" id="3635265">:=</span>&nbsp;<span class="ident" id="3635268">addVV</span><span class="op" id="3635273">(</span><span class="ident" id="3635274">z</span><span class="op" id="3635275">[</span><span class="num" id="3635276">0</span><span class="op" id="3635277">:</span><span class="ident" id="3635278">n</span><span class="op" id="3635279">]</span><span class="op" id="3635280">,</span>&nbsp;<span class="ident" id="3635282">z</span><span class="op" id="3635283">,</span>&nbsp;<span class="ident" id="3635285">x</span><span class="op" id="3635286">)</span><span class="op" id="3635287">;</span>&nbsp;<span class="ident" id="3635289">c</span>&nbsp;<span class="op" id="3635291">!=</span>&nbsp;<span class="num" id="3635294">0</span>&nbsp;<span class="op" id="3635296">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3635300">addVW</span><span class="op" id="3635305">(</span><span class="ident" id="3635306">z</span><span class="op" id="3635307">[</span><span class="ident" id="3635308">n</span><span class="op" id="3635309">:</span><span class="ident" id="3635310">n</span><span class="op" id="3635311">+</span><span class="ident" id="3635312">n</span><span class="op" id="3635313">&gt;&gt;</span><span class="num" id="3635315">1</span><span class="op" id="3635316">]</span><span class="op" id="3635317">,</span>&nbsp;<span class="ident" id="3635319">z</span><span class="op" id="3635320">[</span><span class="ident" id="3635321">n</span><span class="op" id="3635322">:</span><span class="op" id="3635323">]</span><span class="op" id="3635324">,</span>&nbsp;<span class="ident" id="3635326">c</span><span class="op" id="3635327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3635330">}</span><br>
<span class="lineno"></span><span class="op" id="3635332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635335">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3635376">func</span>&nbsp;<span class="ident" id="3635381">karatsubaSub</span><span class="op" id="3635393">(</span><span class="ident" id="3635394">z</span><span class="op" id="3635395">,</span>&nbsp;<span class="ident" id="3635397">x</span>&nbsp;<span class="ident" id="3635399">nat</span><span class="op" id="3635402">,</span>&nbsp;<span class="ident" id="3635404">n</span>&nbsp;<span class="builtintype" id="3635406">int</span><span class="op" id="3635409">)</span>&nbsp;<span class="op" id="3635411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3635414">if</span>&nbsp;<span class="ident" id="3635417">c</span>&nbsp;<span class="op" id="3635419">:=</span>&nbsp;<span class="ident" id="3635422">subVV</span><span class="op" id="3635427">(</span><span class="ident" id="3635428">z</span><span class="op" id="3635429">[</span><span class="num" id="3635430">0</span><span class="op" id="3635431">:</span><span class="ident" id="3635432">n</span><span class="op" id="3635433">]</span><span class="op" id="3635434">,</span>&nbsp;<span class="ident" id="3635436">z</span><span class="op" id="3635437">,</span>&nbsp;<span class="ident" id="3635439">x</span><span class="op" id="3635440">)</span><span class="op" id="3635441">;</span>&nbsp;<span class="ident" id="3635443">c</span>&nbsp;<span class="op" id="3635445">!=</span>&nbsp;<span class="num" id="3635448">0</span>&nbsp;<span class="op" id="3635450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3635454">subVW</span><span class="op" id="3635459">(</span><span class="ident" id="3635460">z</span><span class="op" id="3635461">[</span><span class="ident" id="3635462">n</span><span class="op" id="3635463">:</span><span class="ident" id="3635464">n</span><span class="op" id="3635465">+</span><span class="ident" id="3635466">n</span><span class="op" id="3635467">&gt;&gt;</span><span class="num" id="3635469">1</span><span class="op" id="3635470">]</span><span class="op" id="3635471">,</span>&nbsp;<span class="ident" id="3635473">z</span><span class="op" id="3635474">[</span><span class="ident" id="3635475">n</span><span class="op" id="3635476">:</span><span class="op" id="3635477">]</span><span class="op" id="3635478">,</span>&nbsp;<span class="ident" id="3635480">c</span><span class="op" id="3635481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3635484">}</span><br>
<span class="lineno"></span><span class="op" id="3635486">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3635489">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3635563">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3635641">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3635653">var</span>&nbsp;<span class="ident" id="3635657">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3635676">int</span>&nbsp;<span class="op" id="3635680">=</span>&nbsp;<span class="num" id="3635682">40</span>&nbsp;<span class="comment" id="3635685">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3635714">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3635774">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3635834">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3635894">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3635950">func</span>&nbsp;<span class="ident" id="3635955">karatsuba</span><span class="op" id="3635964">(</span><span class="ident" id="3635965">z</span><span class="op" id="3635966">,</span>&nbsp;<span class="ident" id="3635968">x</span><span class="op" id="3635969">,</span>&nbsp;<span class="ident" id="3635971">y</span>&nbsp;<span class="ident" id="3635973">nat</span><span class="op" id="3635976">)</span>&nbsp;<span class="op" id="3635978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3635981">n</span>&nbsp;<span class="op" id="3635983">:=</span>&nbsp;<span class="builtinfunc" id="3635986">len</span><span class="op" id="3635989">(</span><span class="ident" id="3635990">y</span><span class="op" id="3635991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3635995">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636059">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636119">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636137">if</span>&nbsp;<span class="ident" id="3636140">n</span><span class="op" id="3636141">&amp;</span><span class="num" id="3636142">1</span>&nbsp;<span class="op" id="3636144">!=</span>&nbsp;<span class="num" id="3636147">0</span>&nbsp;<span class="op" id="3636149">||</span>&nbsp;<span class="ident" id="3636152">n</span>&nbsp;<span class="op" id="3636154">&lt;</span>&nbsp;<span class="ident" id="3636156">karatsubaThreshold</span>&nbsp;<span class="op" id="3636175">||</span>&nbsp;<span class="ident" id="3636178">n</span>&nbsp;<span class="op" id="3636180">&lt;</span>&nbsp;<span class="num" id="3636182">2</span>&nbsp;<span class="op" id="3636184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636188">basicMul</span><span class="op" id="3636196">(</span><span class="ident" id="3636197">z</span><span class="op" id="3636198">,</span>&nbsp;<span class="ident" id="3636200">x</span><span class="op" id="3636201">,</span>&nbsp;<span class="ident" id="3636203">y</span><span class="op" id="3636204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3636208">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3636216">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636219">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636270">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636332">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636366">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636370">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636390">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636410">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636414">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636477">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636495">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636499">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636549">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636599">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636603">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636613">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636617">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636636">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636655">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636659">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636710">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636761">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636863">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636905">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636934">n2</span>&nbsp;<span class="op" id="3636937">:=</span>&nbsp;<span class="ident" id="3636940">n</span>&nbsp;<span class="op" id="3636942">&gt;&gt;</span>&nbsp;<span class="num" id="3636945">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3636960">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3636972">x1</span><span class="op" id="3636974">,</span>&nbsp;<span class="ident" id="3636976">x0</span>&nbsp;<span class="op" id="3636979">:=</span>&nbsp;<span class="ident" id="3636982">x</span><span class="op" id="3636983">[</span><span class="ident" id="3636984">n2</span><span class="op" id="3636986">:</span><span class="op" id="3636987">]</span><span class="op" id="3636988">,</span>&nbsp;<span class="ident" id="3636990">x</span><span class="op" id="3636991">[</span><span class="num" id="3636992">0</span><span class="op" id="3636993">:</span><span class="ident" id="3636994">n2</span><span class="op" id="3636996">]</span>&nbsp;<span class="comment" id="3636998">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637016">y1</span><span class="op" id="3637018">,</span>&nbsp;<span class="ident" id="3637020">y0</span>&nbsp;<span class="op" id="3637023">:=</span>&nbsp;<span class="ident" id="3637026">y</span><span class="op" id="3637027">[</span><span class="ident" id="3637028">n2</span><span class="op" id="3637030">:</span><span class="op" id="3637031">]</span><span class="op" id="3637032">,</span>&nbsp;<span class="ident" id="3637034">y</span><span class="op" id="3637035">[</span><span class="num" id="3637036">0</span><span class="op" id="3637037">:</span><span class="ident" id="3637038">n2</span><span class="op" id="3637040">]</span>&nbsp;<span class="comment" id="3637042">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637061">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637113">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637117">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637175">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637233">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637237">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637298">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637360">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637377">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637431">karatsuba</span><span class="op" id="3637440">(</span><span class="ident" id="3637441">z</span><span class="op" id="3637442">,</span>&nbsp;<span class="ident" id="3637444">x0</span><span class="op" id="3637446">,</span>&nbsp;<span class="ident" id="3637448">y0</span><span class="op" id="3637450">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637456">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637471">karatsuba</span><span class="op" id="3637480">(</span><span class="ident" id="3637481">z</span><span class="op" id="3637482">[</span><span class="ident" id="3637483">n</span><span class="op" id="3637484">:</span><span class="op" id="3637485">]</span><span class="op" id="3637486">,</span>&nbsp;<span class="ident" id="3637488">x1</span><span class="op" id="3637490">,</span>&nbsp;<span class="ident" id="3637492">y1</span><span class="op" id="3637494">)</span>&nbsp;<span class="comment" id="3637496">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637512">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637571">s</span>&nbsp;<span class="op" id="3637573">:=</span>&nbsp;<span class="num" id="3637576">1</span>&nbsp;<span class="comment" id="3637578">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637604">xd</span>&nbsp;<span class="op" id="3637607">:=</span>&nbsp;<span class="ident" id="3637610">z</span><span class="op" id="3637611">[</span><span class="num" id="3637612">2</span><span class="op" id="3637613">*</span><span class="ident" id="3637614">n</span>&nbsp;<span class="op" id="3637616">:</span>&nbsp;<span class="num" id="3637618">2</span><span class="op" id="3637619">*</span><span class="ident" id="3637620">n</span><span class="op" id="3637621">+</span><span class="ident" id="3637622">n2</span><span class="op" id="3637624">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637627">if</span>&nbsp;<span class="ident" id="3637630">subVV</span><span class="op" id="3637635">(</span><span class="ident" id="3637636">xd</span><span class="op" id="3637638">,</span>&nbsp;<span class="ident" id="3637640">x1</span><span class="op" id="3637642">,</span>&nbsp;<span class="ident" id="3637644">x0</span><span class="op" id="3637646">)</span>&nbsp;<span class="op" id="3637648">!=</span>&nbsp;<span class="num" id="3637651">0</span>&nbsp;<span class="op" id="3637653">{</span>&nbsp;<span class="comment" id="3637655">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637666">s</span>&nbsp;<span class="op" id="3637668">=</span>&nbsp;<span class="op" id="3637670">-</span><span class="ident" id="3637671">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637675">subVV</span><span class="op" id="3637680">(</span><span class="ident" id="3637681">xd</span><span class="op" id="3637683">,</span>&nbsp;<span class="ident" id="3637685">x0</span><span class="op" id="3637687">,</span>&nbsp;<span class="ident" id="3637689">x1</span><span class="op" id="3637691">)</span>&nbsp;<span class="comment" id="3637693">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637703">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637707">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637766">yd</span>&nbsp;<span class="op" id="3637769">:=</span>&nbsp;<span class="ident" id="3637772">z</span><span class="op" id="3637773">[</span><span class="num" id="3637774">2</span><span class="op" id="3637775">*</span><span class="ident" id="3637776">n</span><span class="op" id="3637777">+</span><span class="ident" id="3637778">n2</span>&nbsp;<span class="op" id="3637781">:</span>&nbsp;<span class="num" id="3637783">3</span><span class="op" id="3637784">*</span><span class="ident" id="3637785">n</span><span class="op" id="3637786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3637789">if</span>&nbsp;<span class="ident" id="3637792">subVV</span><span class="op" id="3637797">(</span><span class="ident" id="3637798">yd</span><span class="op" id="3637800">,</span>&nbsp;<span class="ident" id="3637802">y0</span><span class="op" id="3637804">,</span>&nbsp;<span class="ident" id="3637806">y1</span><span class="op" id="3637808">)</span>&nbsp;<span class="op" id="3637810">!=</span>&nbsp;<span class="num" id="3637813">0</span>&nbsp;<span class="op" id="3637815">{</span>&nbsp;<span class="comment" id="3637817">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637828">s</span>&nbsp;<span class="op" id="3637830">=</span>&nbsp;<span class="op" id="3637832">-</span><span class="ident" id="3637833">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3637837">subVV</span><span class="op" id="3637842">(</span><span class="ident" id="3637843">yd</span><span class="op" id="3637845">,</span>&nbsp;<span class="ident" id="3637847">y1</span><span class="op" id="3637849">,</span>&nbsp;<span class="ident" id="3637851">y0</span><span class="op" id="3637853">)</span>&nbsp;<span class="comment" id="3637855">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3637865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637869">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3637936">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638003">p</span>&nbsp;<span class="op" id="3638005">:=</span>&nbsp;<span class="ident" id="3638008">z</span><span class="op" id="3638009">[</span><span class="ident" id="3638010">n</span><span class="op" id="3638011">*</span><span class="num" id="3638012">3</span><span class="op" id="3638013">:</span><span class="op" id="3638014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638017">karatsuba</span><span class="op" id="3638026">(</span><span class="ident" id="3638027">p</span><span class="op" id="3638028">,</span>&nbsp;<span class="ident" id="3638030">xd</span><span class="op" id="3638032">,</span>&nbsp;<span class="ident" id="3638034">yd</span><span class="op" id="3638036">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638040">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638064">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638123">r</span>&nbsp;<span class="op" id="3638125">:=</span>&nbsp;<span class="ident" id="3638128">z</span><span class="op" id="3638129">[</span><span class="ident" id="3638130">n</span><span class="op" id="3638131">*</span><span class="num" id="3638132">4</span><span class="op" id="3638133">:</span><span class="op" id="3638134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3638137">copy</span><span class="op" id="3638141">(</span><span class="ident" id="3638142">r</span><span class="op" id="3638143">,</span>&nbsp;<span class="ident" id="3638145">z</span><span class="op" id="3638146">[</span><span class="op" id="3638147">:</span><span class="ident" id="3638148">n</span><span class="op" id="3638149">*</span><span class="num" id="3638150">2</span><span class="op" id="3638151">]</span><span class="op" id="3638152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638156">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638188">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638192">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638214">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638236">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638255">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638274">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3638293">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638297">karatsubaAdd</span><span class="op" id="3638309">(</span><span class="ident" id="3638310">z</span><span class="op" id="3638311">[</span><span class="ident" id="3638312">n2</span><span class="op" id="3638314">:</span><span class="op" id="3638315">]</span><span class="op" id="3638316">,</span>&nbsp;<span class="ident" id="3638318">r</span><span class="op" id="3638319">,</span>&nbsp;<span class="ident" id="3638321">n</span><span class="op" id="3638322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638325">karatsubaAdd</span><span class="op" id="3638337">(</span><span class="ident" id="3638338">z</span><span class="op" id="3638339">[</span><span class="ident" id="3638340">n2</span><span class="op" id="3638342">:</span><span class="op" id="3638343">]</span><span class="op" id="3638344">,</span>&nbsp;<span class="ident" id="3638346">r</span><span class="op" id="3638347">[</span><span class="ident" id="3638348">n</span><span class="op" id="3638349">:</span><span class="op" id="3638350">]</span><span class="op" id="3638351">,</span>&nbsp;<span class="ident" id="3638353">n</span><span class="op" id="3638354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638357">if</span>&nbsp;<span class="ident" id="3638360">s</span>&nbsp;<span class="op" id="3638362">&gt;</span>&nbsp;<span class="num" id="3638364">0</span>&nbsp;<span class="op" id="3638366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638370">karatsubaAdd</span><span class="op" id="3638382">(</span><span class="ident" id="3638383">z</span><span class="op" id="3638384">[</span><span class="ident" id="3638385">n2</span><span class="op" id="3638387">:</span><span class="op" id="3638388">]</span><span class="op" id="3638389">,</span>&nbsp;<span class="ident" id="3638391">p</span><span class="op" id="3638392">,</span>&nbsp;<span class="ident" id="3638394">n</span><span class="op" id="3638395">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638398">}</span>&nbsp;<span class="keyword" id="3638400">else</span>&nbsp;<span class="op" id="3638405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638409">karatsubaSub</span><span class="op" id="3638421">(</span><span class="ident" id="3638422">z</span><span class="op" id="3638423">[</span><span class="ident" id="3638424">n2</span><span class="op" id="3638426">:</span><span class="op" id="3638427">]</span><span class="op" id="3638428">,</span>&nbsp;<span class="ident" id="3638430">p</span><span class="op" id="3638431">,</span>&nbsp;<span class="ident" id="3638433">n</span><span class="op" id="3638434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638437">}</span><br>
<span class="lineno"></span><span class="op" id="3638439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3638442">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3638502">func</span>&nbsp;<span class="ident" id="3638507">alias</span><span class="op" id="3638512">(</span><span class="ident" id="3638513">x</span><span class="op" id="3638514">,</span>&nbsp;<span class="ident" id="3638516">y</span>&nbsp;<span class="ident" id="3638518">nat</span><span class="op" id="3638521">)</span>&nbsp;<span class="builtintype" id="3638523">bool</span>&nbsp;<span class="op" id="3638528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638531">return</span>&nbsp;<span class="builtinfunc" id="3638538">cap</span><span class="op" id="3638541">(</span><span class="ident" id="3638542">x</span><span class="op" id="3638543">)</span>&nbsp;<span class="op" id="3638545">&gt;</span>&nbsp;<span class="num" id="3638547">0</span>&nbsp;<span class="op" id="3638549">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3638552">cap</span><span class="op" id="3638555">(</span><span class="ident" id="3638556">y</span><span class="op" id="3638557">)</span>&nbsp;<span class="op" id="3638559">&gt;</span>&nbsp;<span class="num" id="3638561">0</span>&nbsp;<span class="op" id="3638563">&amp;&amp;</span>&nbsp;<span class="op" id="3638566">&amp;</span><span class="ident" id="3638567">x</span><span class="op" id="3638568">[</span><span class="num" id="3638569">0</span><span class="op" id="3638570">:</span><span class="builtinfunc" id="3638571">cap</span><span class="op" id="3638574">(</span><span class="ident" id="3638575">x</span><span class="op" id="3638576">)</span><span class="op" id="3638577">]</span><span class="op" id="3638578">[</span><span class="builtinfunc" id="3638579">cap</span><span class="op" id="3638582">(</span><span class="ident" id="3638583">x</span><span class="op" id="3638584">)</span><span class="op" id="3638585">-</span><span class="num" id="3638586">1</span><span class="op" id="3638587">]</span>&nbsp;<span class="op" id="3638589">==</span>&nbsp;<span class="op" id="3638592">&amp;</span><span class="ident" id="3638593">y</span><span class="op" id="3638594">[</span><span class="num" id="3638595">0</span><span class="op" id="3638596">:</span><span class="builtinfunc" id="3638597">cap</span><span class="op" id="3638600">(</span><span class="ident" id="3638601">y</span><span class="op" id="3638602">)</span><span class="op" id="3638603">]</span><span class="op" id="3638604">[</span><span class="builtinfunc" id="3638605">cap</span><span class="op" id="3638608">(</span><span class="ident" id="3638609">y</span><span class="op" id="3638610">)</span><span class="op" id="3638611">-</span><span class="num" id="3638612">1</span><span class="op" id="3638613">]</span><br>
<span class="lineno"></span><span class="op" id="3638615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3638618">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3638677">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3638737">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3638801">func</span>&nbsp;<span class="ident" id="3638806">addAt</span><span class="op" id="3638811">(</span><span class="ident" id="3638812">z</span><span class="op" id="3638813">,</span>&nbsp;<span class="ident" id="3638815">x</span>&nbsp;<span class="ident" id="3638817">nat</span><span class="op" id="3638820">,</span>&nbsp;<span class="ident" id="3638822">i</span>&nbsp;<span class="builtintype" id="3638824">int</span><span class="op" id="3638827">)</span>&nbsp;<span class="op" id="3638829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638832">if</span>&nbsp;<span class="ident" id="3638835">n</span>&nbsp;<span class="op" id="3638837">:=</span>&nbsp;<span class="builtinfunc" id="3638840">len</span><span class="op" id="3638843">(</span><span class="ident" id="3638844">x</span><span class="op" id="3638845">)</span><span class="op" id="3638846">;</span>&nbsp;<span class="ident" id="3638848">n</span>&nbsp;<span class="op" id="3638850">&gt;</span>&nbsp;<span class="num" id="3638852">0</span>&nbsp;<span class="op" id="3638854">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638858">if</span>&nbsp;<span class="ident" id="3638861">c</span>&nbsp;<span class="op" id="3638863">:=</span>&nbsp;<span class="ident" id="3638866">addVV</span><span class="op" id="3638871">(</span><span class="ident" id="3638872">z</span><span class="op" id="3638873">[</span><span class="ident" id="3638874">i</span><span class="op" id="3638875">:</span><span class="ident" id="3638876">i</span><span class="op" id="3638877">+</span><span class="ident" id="3638878">n</span><span class="op" id="3638879">]</span><span class="op" id="3638880">,</span>&nbsp;<span class="ident" id="3638882">z</span><span class="op" id="3638883">[</span><span class="ident" id="3638884">i</span><span class="op" id="3638885">:</span><span class="op" id="3638886">]</span><span class="op" id="3638887">,</span>&nbsp;<span class="ident" id="3638889">x</span><span class="op" id="3638890">)</span><span class="op" id="3638891">;</span>&nbsp;<span class="ident" id="3638893">c</span>&nbsp;<span class="op" id="3638895">!=</span>&nbsp;<span class="num" id="3638898">0</span>&nbsp;<span class="op" id="3638900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638905">j</span>&nbsp;<span class="op" id="3638907">:=</span>&nbsp;<span class="ident" id="3638910">i</span>&nbsp;<span class="op" id="3638912">+</span>&nbsp;<span class="ident" id="3638914">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638919">if</span>&nbsp;<span class="ident" id="3638922">j</span>&nbsp;<span class="op" id="3638924">&lt;</span>&nbsp;<span class="builtinfunc" id="3638926">len</span><span class="op" id="3638929">(</span><span class="ident" id="3638930">z</span><span class="op" id="3638931">)</span>&nbsp;<span class="op" id="3638933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638939">addVW</span><span class="op" id="3638944">(</span><span class="ident" id="3638945">z</span><span class="op" id="3638946">[</span><span class="ident" id="3638947">j</span><span class="op" id="3638948">:</span><span class="op" id="3638949">]</span><span class="op" id="3638950">,</span>&nbsp;<span class="ident" id="3638952">z</span><span class="op" id="3638953">[</span><span class="ident" id="3638954">j</span><span class="op" id="3638955">:</span><span class="op" id="3638956">]</span><span class="op" id="3638957">,</span>&nbsp;<span class="ident" id="3638959">c</span><span class="op" id="3638960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638965">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638972">}</span><br>
<span class="lineno"></span><span class="op" id="3638974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3638977">func</span>&nbsp;<span class="ident" id="3638982">max</span><span class="op" id="3638985">(</span><span class="ident" id="3638986">x</span><span class="op" id="3638987">,</span>&nbsp;<span class="ident" id="3638989">y</span>&nbsp;<span class="builtintype" id="3638991">int</span><span class="op" id="3638994">)</span>&nbsp;<span class="builtintype" id="3638996">int</span>&nbsp;<span class="op" id="3639000">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639003">if</span>&nbsp;<span class="ident" id="3639006">x</span>&nbsp;<span class="op" id="3639008">&gt;</span>&nbsp;<span class="ident" id="3639010">y</span>&nbsp;<span class="op" id="3639012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639016">return</span>&nbsp;<span class="ident" id="3639023">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639029">return</span>&nbsp;<span class="ident" id="3639036">y</span><br>
<span class="lineno"></span><span class="op" id="3639038">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3639041">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3639115">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3639189">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3639264">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3639315">func</span>&nbsp;<span class="ident" id="3639320">karatsubaLen</span><span class="op" id="3639332">(</span><span class="ident" id="3639333">n</span>&nbsp;<span class="builtintype" id="3639335">int</span><span class="op" id="3639338">)</span>&nbsp;<span class="builtintype" id="3639340">int</span>&nbsp;<span class="op" id="3639344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639347">i</span>&nbsp;<span class="op" id="3639349">:=</span>&nbsp;<span class="builtintype" id="3639352">uint</span><span class="op" id="3639356">(</span><span class="num" id="3639357">0</span><span class="op" id="3639358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639361">for</span>&nbsp;<span class="ident" id="3639365">n</span>&nbsp;<span class="op" id="3639367">&gt;</span>&nbsp;<span class="ident" id="3639369">karatsubaThreshold</span>&nbsp;<span class="op" id="3639388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639392">n</span>&nbsp;<span class="op" id="3639394">&gt;&gt;=</span>&nbsp;<span class="num" id="3639398">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639402">i</span><span class="op" id="3639403">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639410">return</span>&nbsp;<span class="ident" id="3639417">n</span>&nbsp;<span class="op" id="3639419">&lt;&lt;</span>&nbsp;<span class="ident" id="3639422">i</span><br>
<span class="lineno"></span><span class="op" id="3639424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3639427">func</span>&nbsp;<span class="op" id="3639432">(</span><span class="ident" id="3639433">z</span>&nbsp;<span class="ident" id="3639435">nat</span><span class="op" id="3639438">)</span>&nbsp;<span class="ident" id="3639440">mul</span><span class="op" id="3639443">(</span><span class="ident" id="3639444">x</span><span class="op" id="3639445">,</span>&nbsp;<span class="ident" id="3639447">y</span>&nbsp;<span class="ident" id="3639449">nat</span><span class="op" id="3639452">)</span>&nbsp;<span class="ident" id="3639454">nat</span>&nbsp;<span class="op" id="3639458">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639461">m</span>&nbsp;<span class="op" id="3639463">:=</span>&nbsp;<span class="builtinfunc" id="3639466">len</span><span class="op" id="3639469">(</span><span class="ident" id="3639470">x</span><span class="op" id="3639471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639474">n</span>&nbsp;<span class="op" id="3639476">:=</span>&nbsp;<span class="builtinfunc" id="3639479">len</span><span class="op" id="3639482">(</span><span class="ident" id="3639483">y</span><span class="op" id="3639484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639488">switch</span>&nbsp;<span class="op" id="3639495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639498">case</span>&nbsp;<span class="ident" id="3639503">m</span>&nbsp;<span class="op" id="3639505">&lt;</span>&nbsp;<span class="ident" id="3639507">n</span><span class="op" id="3639508">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639512">return</span>&nbsp;<span class="ident" id="3639519">z</span><span class="op" id="3639520">.</span><span class="ident" id="3639521">mul</span><span class="op" id="3639524">(</span><span class="ident" id="3639525">y</span><span class="op" id="3639526">,</span>&nbsp;<span class="ident" id="3639528">x</span><span class="op" id="3639529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639532">case</span>&nbsp;<span class="ident" id="3639537">m</span>&nbsp;<span class="op" id="3639539">==</span>&nbsp;<span class="num" id="3639542">0</span>&nbsp;<span class="op" id="3639544">||</span>&nbsp;<span class="ident" id="3639547">n</span>&nbsp;<span class="op" id="3639549">==</span>&nbsp;<span class="num" id="3639552">0</span><span class="op" id="3639553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639557">return</span>&nbsp;<span class="ident" id="3639564">z</span><span class="op" id="3639565">.</span><span class="builtinfunc" id="3639566">make</span><span class="op" id="3639570">(</span><span class="num" id="3639571">0</span><span class="op" id="3639572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639575">case</span>&nbsp;<span class="ident" id="3639580">n</span>&nbsp;<span class="op" id="3639582">==</span>&nbsp;<span class="num" id="3639585">1</span><span class="op" id="3639586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639590">return</span>&nbsp;<span class="ident" id="3639597">z</span><span class="op" id="3639598">.</span><span class="ident" id="3639599">mulAddWW</span><span class="op" id="3639607">(</span><span class="ident" id="3639608">x</span><span class="op" id="3639609">,</span>&nbsp;<span class="ident" id="3639611">y</span><span class="op" id="3639612">[</span><span class="num" id="3639613">0</span><span class="op" id="3639614">]</span><span class="op" id="3639615">,</span>&nbsp;<span class="num" id="3639617">0</span><span class="op" id="3639618">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639624">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639640">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639673">if</span>&nbsp;<span class="ident" id="3639676">alias</span><span class="op" id="3639681">(</span><span class="ident" id="3639682">z</span><span class="op" id="3639683">,</span>&nbsp;<span class="ident" id="3639685">x</span><span class="op" id="3639686">)</span>&nbsp;<span class="op" id="3639688">||</span>&nbsp;<span class="ident" id="3639691">alias</span><span class="op" id="3639696">(</span><span class="ident" id="3639697">z</span><span class="op" id="3639698">,</span>&nbsp;<span class="ident" id="3639700">y</span><span class="op" id="3639701">)</span>&nbsp;<span class="op" id="3639703">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639707">z</span>&nbsp;<span class="op" id="3639709">=</span>&nbsp;<span class="builtintype" id="3639711">nil</span>&nbsp;<span class="comment" id="3639715">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639763">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639817">if</span>&nbsp;<span class="ident" id="3639820">n</span>&nbsp;<span class="op" id="3639822">&lt;</span>&nbsp;<span class="ident" id="3639824">karatsubaThreshold</span>&nbsp;<span class="op" id="3639843">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639847">z</span>&nbsp;<span class="op" id="3639849">=</span>&nbsp;<span class="ident" id="3639851">z</span><span class="op" id="3639852">.</span><span class="builtinfunc" id="3639853">make</span><span class="op" id="3639857">(</span><span class="ident" id="3639858">m</span>&nbsp;<span class="op" id="3639860">+</span>&nbsp;<span class="ident" id="3639862">n</span><span class="op" id="3639863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3639867">basicMul</span><span class="op" id="3639875">(</span><span class="ident" id="3639876">z</span><span class="op" id="3639877">,</span>&nbsp;<span class="ident" id="3639879">x</span><span class="op" id="3639880">,</span>&nbsp;<span class="ident" id="3639882">y</span><span class="op" id="3639883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3639887">return</span>&nbsp;<span class="ident" id="3639894">z</span><span class="op" id="3639895">.</span><span class="ident" id="3639896">norm</span><span class="op" id="3639900">(</span><span class="op" id="3639901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3639904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639907">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639956">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639999">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640003">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640038">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640073">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640120">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640124">k</span>&nbsp;<span class="op" id="3640126">:=</span>&nbsp;<span class="ident" id="3640129">karatsubaLen</span><span class="op" id="3640141">(</span><span class="ident" id="3640142">n</span><span class="op" id="3640143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640146">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640158">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640195">x0</span>&nbsp;<span class="op" id="3640198">:=</span>&nbsp;<span class="ident" id="3640201">x</span><span class="op" id="3640202">[</span><span class="num" id="3640203">0</span><span class="op" id="3640204">:</span><span class="ident" id="3640205">k</span><span class="op" id="3640206">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640221">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640246">y0</span>&nbsp;<span class="op" id="3640249">:=</span>&nbsp;<span class="ident" id="3640252">y</span><span class="op" id="3640253">[</span><span class="num" id="3640254">0</span><span class="op" id="3640255">:</span><span class="ident" id="3640256">k</span><span class="op" id="3640257">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640272">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640297">z</span>&nbsp;<span class="op" id="3640299">=</span>&nbsp;<span class="ident" id="3640301">z</span><span class="op" id="3640302">.</span><span class="builtinfunc" id="3640303">make</span><span class="op" id="3640307">(</span><span class="ident" id="3640308">max</span><span class="op" id="3640311">(</span><span class="num" id="3640312">6</span><span class="op" id="3640313">*</span><span class="ident" id="3640314">k</span><span class="op" id="3640315">,</span>&nbsp;<span class="ident" id="3640317">m</span><span class="op" id="3640318">+</span><span class="ident" id="3640319">n</span><span class="op" id="3640320">)</span><span class="op" id="3640321">)</span>&nbsp;<span class="comment" id="3640323">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640386">karatsuba</span><span class="op" id="3640395">(</span><span class="ident" id="3640396">z</span><span class="op" id="3640397">,</span>&nbsp;<span class="ident" id="3640399">x0</span><span class="op" id="3640401">,</span>&nbsp;<span class="ident" id="3640403">y0</span><span class="op" id="3640405">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640408">z</span>&nbsp;<span class="op" id="3640410">=</span>&nbsp;<span class="ident" id="3640412">z</span><span class="op" id="3640413">[</span><span class="num" id="3640414">0</span>&nbsp;<span class="op" id="3640416">:</span>&nbsp;<span class="ident" id="3640418">m</span><span class="op" id="3640419">+</span><span class="ident" id="3640420">n</span><span class="op" id="3640421">]</span>&nbsp;&nbsp;<span class="comment" id="3640424">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640469">z</span><span class="op" id="3640470">[</span><span class="num" id="3640471">2</span><span class="op" id="3640472">*</span><span class="ident" id="3640473">k</span><span class="op" id="3640474">:</span><span class="op" id="3640475">]</span><span class="op" id="3640476">.</span><span class="ident" id="3640477">clear</span><span class="op" id="3640482">(</span><span class="op" id="3640483">)</span>&nbsp;<span class="comment" id="3640485">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640555">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640614">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640618">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640672">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640726">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640730">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640756">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640760">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640813">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640817">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640885">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640953">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3641023">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641027">if</span>&nbsp;<span class="ident" id="3641030">k</span>&nbsp;<span class="op" id="3641032">&lt;</span>&nbsp;<span class="ident" id="3641034">n</span>&nbsp;<span class="op" id="3641036">||</span>&nbsp;<span class="ident" id="3641039">m</span>&nbsp;<span class="op" id="3641041">!=</span>&nbsp;<span class="ident" id="3641044">n</span>&nbsp;<span class="op" id="3641046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641050">var</span>&nbsp;<span class="ident" id="3641054">t</span>&nbsp;<span class="ident" id="3641056">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3641063">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641080">x0</span>&nbsp;<span class="op" id="3641083">:=</span>&nbsp;<span class="ident" id="3641086">x0</span><span class="op" id="3641088">.</span><span class="ident" id="3641089">norm</span><span class="op" id="3641093">(</span><span class="op" id="3641094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641098">y1</span>&nbsp;<span class="op" id="3641101">:=</span>&nbsp;<span class="ident" id="3641104">y</span><span class="op" id="3641105">[</span><span class="ident" id="3641106">k</span><span class="op" id="3641107">:</span><span class="op" id="3641108">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3641116">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641151">t</span>&nbsp;<span class="op" id="3641153">=</span>&nbsp;<span class="ident" id="3641155">t</span><span class="op" id="3641156">.</span><span class="ident" id="3641157">mul</span><span class="op" id="3641160">(</span><span class="ident" id="3641161">x0</span><span class="op" id="3641163">,</span>&nbsp;<span class="ident" id="3641165">y1</span><span class="op" id="3641167">)</span>&nbsp;<span class="comment" id="3641169">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641221">addAt</span><span class="op" id="3641226">(</span><span class="ident" id="3641227">z</span><span class="op" id="3641228">,</span>&nbsp;<span class="ident" id="3641230">t</span><span class="op" id="3641231">,</span>&nbsp;<span class="ident" id="3641233">k</span><span class="op" id="3641234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3641239">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641273">y0</span>&nbsp;<span class="op" id="3641276">:=</span>&nbsp;<span class="ident" id="3641279">y0</span><span class="op" id="3641281">.</span><span class="ident" id="3641282">norm</span><span class="op" id="3641286">(</span><span class="op" id="3641287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641291">for</span>&nbsp;<span class="ident" id="3641295">i</span>&nbsp;<span class="op" id="3641297">:=</span>&nbsp;<span class="ident" id="3641300">k</span><span class="op" id="3641301">;</span>&nbsp;<span class="ident" id="3641303">i</span>&nbsp;<span class="op" id="3641305">&lt;</span>&nbsp;<span class="builtinfunc" id="3641307">len</span><span class="op" id="3641310">(</span><span class="ident" id="3641311">x</span><span class="op" id="3641312">)</span><span class="op" id="3641313">;</span>&nbsp;<span class="ident" id="3641315">i</span>&nbsp;<span class="op" id="3641317">+=</span>&nbsp;<span class="ident" id="3641320">k</span>&nbsp;<span class="op" id="3641322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641327">xi</span>&nbsp;<span class="op" id="3641330">:=</span>&nbsp;<span class="ident" id="3641333">x</span><span class="op" id="3641334">[</span><span class="ident" id="3641335">i</span><span class="op" id="3641336">:</span><span class="op" id="3641337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641342">if</span>&nbsp;<span class="builtinfunc" id="3641345">len</span><span class="op" id="3641348">(</span><span class="ident" id="3641349">xi</span><span class="op" id="3641351">)</span>&nbsp;<span class="op" id="3641353">&gt;</span>&nbsp;<span class="ident" id="3641355">k</span>&nbsp;<span class="op" id="3641357">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641363">xi</span>&nbsp;<span class="op" id="3641366">=</span>&nbsp;<span class="ident" id="3641368">xi</span><span class="op" id="3641370">[</span><span class="op" id="3641371">:</span><span class="ident" id="3641372">k</span><span class="op" id="3641373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641383">xi</span>&nbsp;<span class="op" id="3641386">=</span>&nbsp;<span class="ident" id="3641388">xi</span><span class="op" id="3641390">.</span><span class="ident" id="3641391">norm</span><span class="op" id="3641395">(</span><span class="op" id="3641396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641401">t</span>&nbsp;<span class="op" id="3641403">=</span>&nbsp;<span class="ident" id="3641405">t</span><span class="op" id="3641406">.</span><span class="ident" id="3641407">mul</span><span class="op" id="3641410">(</span><span class="ident" id="3641411">xi</span><span class="op" id="3641413">,</span>&nbsp;<span class="ident" id="3641415">y0</span><span class="op" id="3641417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641422">addAt</span><span class="op" id="3641427">(</span><span class="ident" id="3641428">z</span><span class="op" id="3641429">,</span>&nbsp;<span class="ident" id="3641431">t</span><span class="op" id="3641432">,</span>&nbsp;<span class="ident" id="3641434">i</span><span class="op" id="3641435">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641440">t</span>&nbsp;<span class="op" id="3641442">=</span>&nbsp;<span class="ident" id="3641444">t</span><span class="op" id="3641445">.</span><span class="ident" id="3641446">mul</span><span class="op" id="3641449">(</span><span class="ident" id="3641450">xi</span><span class="op" id="3641452">,</span>&nbsp;<span class="ident" id="3641454">y1</span><span class="op" id="3641456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641461">addAt</span><span class="op" id="3641466">(</span><span class="ident" id="3641467">z</span><span class="op" id="3641468">,</span>&nbsp;<span class="ident" id="3641470">t</span><span class="op" id="3641471">,</span>&nbsp;<span class="ident" id="3641473">i</span><span class="op" id="3641474">+</span><span class="ident" id="3641475">k</span><span class="op" id="3641476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641487">return</span>&nbsp;<span class="ident" id="3641494">z</span><span class="op" id="3641495">.</span><span class="ident" id="3641496">norm</span><span class="op" id="3641500">(</span><span class="op" id="3641501">)</span><br>
<span class="lineno"></span><span class="op" id="3641503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3641506">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3641575">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3641645">func</span>&nbsp;<span class="op" id="3641650">(</span><span class="ident" id="3641651">z</span>&nbsp;<span class="ident" id="3641653">nat</span><span class="op" id="3641656">)</span>&nbsp;<span class="ident" id="3641658">mulRange</span><span class="op" id="3641666">(</span><span class="ident" id="3641667">a</span><span class="op" id="3641668">,</span>&nbsp;<span class="ident" id="3641670">b</span>&nbsp;<span class="ident" id="3641672">uint64</span><span class="op" id="3641678">)</span>&nbsp;<span class="ident" id="3641680">nat</span>&nbsp;<span class="op" id="3641684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641687">switch</span>&nbsp;<span class="op" id="3641694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641697">case</span>&nbsp;<span class="ident" id="3641702">a</span>&nbsp;<span class="op" id="3641704">==</span>&nbsp;<span class="num" id="3641707">0</span><span class="op" id="3641708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3641712">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641754">return</span>&nbsp;<span class="ident" id="3641761">z</span><span class="op" id="3641762">.</span><span class="ident" id="3641763">setUint64</span><span class="op" id="3641772">(</span><span class="num" id="3641773">0</span><span class="op" id="3641774">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641777">case</span>&nbsp;<span class="ident" id="3641782">a</span>&nbsp;<span class="op" id="3641784">&gt;</span>&nbsp;<span class="ident" id="3641786">b</span><span class="op" id="3641787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641791">return</span>&nbsp;<span class="ident" id="3641798">z</span><span class="op" id="3641799">.</span><span class="ident" id="3641800">setUint64</span><span class="op" id="3641809">(</span><span class="num" id="3641810">1</span><span class="op" id="3641811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641814">case</span>&nbsp;<span class="ident" id="3641819">a</span>&nbsp;<span class="op" id="3641821">==</span>&nbsp;<span class="ident" id="3641824">b</span><span class="op" id="3641825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641829">return</span>&nbsp;<span class="ident" id="3641836">z</span><span class="op" id="3641837">.</span><span class="ident" id="3641838">setUint64</span><span class="op" id="3641847">(</span><span class="ident" id="3641848">a</span><span class="op" id="3641849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641852">case</span>&nbsp;<span class="ident" id="3641857">a</span><span class="op" id="3641858">+</span><span class="num" id="3641859">1</span>&nbsp;<span class="op" id="3641861">==</span>&nbsp;<span class="ident" id="3641864">b</span><span class="op" id="3641865">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641869">return</span>&nbsp;<span class="ident" id="3641876">z</span><span class="op" id="3641877">.</span><span class="ident" id="3641878">mul</span><span class="op" id="3641881">(</span><span class="ident" id="3641882">nat</span><span class="op" id="3641885">(</span><span class="builtintype" id="3641886">nil</span><span class="op" id="3641889">)</span><span class="op" id="3641890">.</span><span class="ident" id="3641891">setUint64</span><span class="op" id="3641900">(</span><span class="ident" id="3641901">a</span><span class="op" id="3641902">)</span><span class="op" id="3641903">,</span>&nbsp;<span class="ident" id="3641905">nat</span><span class="op" id="3641908">(</span><span class="builtintype" id="3641909">nil</span><span class="op" id="3641912">)</span><span class="op" id="3641913">.</span><span class="ident" id="3641914">setUint64</span><span class="op" id="3641923">(</span><span class="ident" id="3641924">b</span><span class="op" id="3641925">)</span><span class="op" id="3641926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3641929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3641932">m</span>&nbsp;<span class="op" id="3641934">:=</span>&nbsp;<span class="op" id="3641937">(</span><span class="ident" id="3641938">a</span>&nbsp;<span class="op" id="3641940">+</span>&nbsp;<span class="ident" id="3641942">b</span><span class="op" id="3641943">)</span>&nbsp;<span class="op" id="3641945">/</span>&nbsp;<span class="num" id="3641947">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3641950">return</span>&nbsp;<span class="ident" id="3641957">z</span><span class="op" id="3641958">.</span><span class="ident" id="3641959">mul</span><span class="op" id="3641962">(</span><span class="ident" id="3641963">nat</span><span class="op" id="3641966">(</span><span class="builtintype" id="3641967">nil</span><span class="op" id="3641970">)</span><span class="op" id="3641971">.</span><span class="ident" id="3641972">mulRange</span><span class="op" id="3641980">(</span><span class="ident" id="3641981">a</span><span class="op" id="3641982">,</span>&nbsp;<span class="ident" id="3641984">m</span><span class="op" id="3641985">)</span><span class="op" id="3641986">,</span>&nbsp;<span class="ident" id="3641988">nat</span><span class="op" id="3641991">(</span><span class="builtintype" id="3641992">nil</span><span class="op" id="3641995">)</span><span class="op" id="3641996">.</span><span class="ident" id="3641997">mulRange</span><span class="op" id="3642005">(</span><span class="ident" id="3642006">m</span><span class="op" id="3642007">+</span><span class="num" id="3642008">1</span><span class="op" id="3642009">,</span>&nbsp;<span class="ident" id="3642011">b</span><span class="op" id="3642012">)</span><span class="op" id="3642013">)</span><br>
<span class="lineno"></span><span class="op" id="3642015">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3642018">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3642050">func</span>&nbsp;<span class="op" id="3642055">(</span><span class="ident" id="3642056">z</span>&nbsp;<span class="ident" id="3642058">nat</span><span class="op" id="3642061">)</span>&nbsp;<span class="ident" id="3642063">divW</span><span class="op" id="3642067">(</span><span class="ident" id="3642068">x</span>&nbsp;<span class="ident" id="3642070">nat</span><span class="op" id="3642073">,</span>&nbsp;<span class="ident" id="3642075">y</span>&nbsp;<span class="ident" id="3642077">Word</span><span class="op" id="3642081">)</span>&nbsp;<span class="op" id="3642083">(</span><span class="ident" id="3642084">q</span>&nbsp;<span class="ident" id="3642086">nat</span><span class="op" id="3642089">,</span>&nbsp;<span class="ident" id="3642091">r</span>&nbsp;<span class="ident" id="3642093">Word</span><span class="op" id="3642097">)</span>&nbsp;<span class="op" id="3642099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642102">m</span>&nbsp;<span class="op" id="3642104">:=</span>&nbsp;<span class="builtinfunc" id="3642107">len</span><span class="op" id="3642110">(</span><span class="ident" id="3642111">x</span><span class="op" id="3642112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642115">switch</span>&nbsp;<span class="op" id="3642122">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642125">case</span>&nbsp;<span class="ident" id="3642130">y</span>&nbsp;<span class="op" id="3642132">==</span>&nbsp;<span class="num" id="3642135">0</span><span class="op" id="3642136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3642140">panic</span><span class="op" id="3642145">(</span><span class="string" id="3642146">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3642164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642167">case</span>&nbsp;<span class="ident" id="3642172">y</span>&nbsp;<span class="op" id="3642174">==</span>&nbsp;<span class="num" id="3642177">1</span><span class="op" id="3642178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642182">q</span>&nbsp;<span class="op" id="3642184">=</span>&nbsp;<span class="ident" id="3642186">z</span><span class="op" id="3642187">.</span><span class="ident" id="3642188">set</span><span class="op" id="3642191">(</span><span class="ident" id="3642192">x</span><span class="op" id="3642193">)</span>&nbsp;<span class="comment" id="3642195">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642212">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642220">case</span>&nbsp;<span class="ident" id="3642225">m</span>&nbsp;<span class="op" id="3642227">==</span>&nbsp;<span class="num" id="3642230">0</span><span class="op" id="3642231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642235">q</span>&nbsp;<span class="op" id="3642237">=</span>&nbsp;<span class="ident" id="3642239">z</span><span class="op" id="3642240">.</span><span class="builtinfunc" id="3642241">make</span><span class="op" id="3642245">(</span><span class="num" id="3642246">0</span><span class="op" id="3642247">)</span>&nbsp;<span class="comment" id="3642249">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642266">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3642277">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642287">z</span>&nbsp;<span class="op" id="3642289">=</span>&nbsp;<span class="ident" id="3642291">z</span><span class="op" id="3642292">.</span><span class="builtinfunc" id="3642293">make</span><span class="op" id="3642297">(</span><span class="ident" id="3642298">m</span><span class="op" id="3642299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642302">r</span>&nbsp;<span class="op" id="3642304">=</span>&nbsp;<span class="ident" id="3642306">divWVW</span><span class="op" id="3642312">(</span><span class="ident" id="3642313">z</span><span class="op" id="3642314">,</span>&nbsp;<span class="num" id="3642316">0</span><span class="op" id="3642317">,</span>&nbsp;<span class="ident" id="3642319">x</span><span class="op" id="3642320">,</span>&nbsp;<span class="ident" id="3642322">y</span><span class="op" id="3642323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642326">q</span>&nbsp;<span class="op" id="3642328">=</span>&nbsp;<span class="ident" id="3642330">z</span><span class="op" id="3642331">.</span><span class="ident" id="3642332">norm</span><span class="op" id="3642336">(</span><span class="op" id="3642337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642340">return</span><br>
<span class="lineno"></span><span class="op" id="3642347">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3642350">func</span>&nbsp;<span class="op" id="3642355">(</span><span class="ident" id="3642356">z</span>&nbsp;<span class="ident" id="3642358">nat</span><span class="op" id="3642361">)</span>&nbsp;<span class="ident" id="3642363">div</span><span class="op" id="3642366">(</span><span class="ident" id="3642367">z2</span><span class="op" id="3642369">,</span>&nbsp;<span class="ident" id="3642371">u</span><span class="op" id="3642372">,</span>&nbsp;<span class="ident" id="3642374">v</span>&nbsp;<span class="ident" id="3642376">nat</span><span class="op" id="3642379">)</span>&nbsp;<span class="op" id="3642381">(</span><span class="ident" id="3642382">q</span><span class="op" id="3642383">,</span>&nbsp;<span class="ident" id="3642385">r</span>&nbsp;<span class="ident" id="3642387">nat</span><span class="op" id="3642390">)</span>&nbsp;<span class="op" id="3642392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642395">if</span>&nbsp;<span class="builtinfunc" id="3642398">len</span><span class="op" id="3642401">(</span><span class="ident" id="3642402">v</span><span class="op" id="3642403">)</span>&nbsp;<span class="op" id="3642405">==</span>&nbsp;<span class="num" id="3642408">0</span>&nbsp;<span class="op" id="3642410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3642414">panic</span><span class="op" id="3642419">(</span><span class="string" id="3642420">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3642438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642441">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642445">if</span>&nbsp;<span class="ident" id="3642448">u</span><span class="op" id="3642449">.</span><span class="ident" id="3642450">cmp</span><span class="op" id="3642453">(</span><span class="ident" id="3642454">v</span><span class="op" id="3642455">)</span>&nbsp;<span class="op" id="3642457">&lt;</span>&nbsp;<span class="num" id="3642459">0</span>&nbsp;<span class="op" id="3642461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642465">q</span>&nbsp;<span class="op" id="3642467">=</span>&nbsp;<span class="ident" id="3642469">z</span><span class="op" id="3642470">.</span><span class="builtinfunc" id="3642471">make</span><span class="op" id="3642475">(</span><span class="num" id="3642476">0</span><span class="op" id="3642477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642481">r</span>&nbsp;<span class="op" id="3642483">=</span>&nbsp;<span class="ident" id="3642485">z2</span><span class="op" id="3642487">.</span><span class="ident" id="3642488">set</span><span class="op" id="3642491">(</span><span class="ident" id="3642492">u</span><span class="op" id="3642493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642497">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642509">if</span>&nbsp;<span class="builtinfunc" id="3642512">len</span><span class="op" id="3642515">(</span><span class="ident" id="3642516">v</span><span class="op" id="3642517">)</span>&nbsp;<span class="op" id="3642519">==</span>&nbsp;<span class="num" id="3642522">1</span>&nbsp;<span class="op" id="3642524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642528">var</span>&nbsp;<span class="ident" id="3642532">r2</span>&nbsp;<span class="ident" id="3642535">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642542">q</span><span class="op" id="3642543">,</span>&nbsp;<span class="ident" id="3642545">r2</span>&nbsp;<span class="op" id="3642548">=</span>&nbsp;<span class="ident" id="3642550">z</span><span class="op" id="3642551">.</span><span class="ident" id="3642552">divW</span><span class="op" id="3642556">(</span><span class="ident" id="3642557">u</span><span class="op" id="3642558">,</span>&nbsp;<span class="ident" id="3642560">v</span><span class="op" id="3642561">[</span><span class="num" id="3642562">0</span><span class="op" id="3642563">]</span><span class="op" id="3642564">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642568">r</span>&nbsp;<span class="op" id="3642570">=</span>&nbsp;<span class="ident" id="3642572">z2</span><span class="op" id="3642574">.</span><span class="ident" id="3642575">setWord</span><span class="op" id="3642582">(</span><span class="ident" id="3642583">r2</span><span class="op" id="3642585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642589">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3642597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642601">q</span><span class="op" id="3642602">,</span>&nbsp;<span class="ident" id="3642604">r</span>&nbsp;<span class="op" id="3642606">=</span>&nbsp;<span class="ident" id="3642608">z</span><span class="op" id="3642609">.</span><span class="ident" id="3642610">divLarge</span><span class="op" id="3642618">(</span><span class="ident" id="3642619">z2</span><span class="op" id="3642621">,</span>&nbsp;<span class="ident" id="3642623">u</span><span class="op" id="3642624">,</span>&nbsp;<span class="ident" id="3642626">v</span><span class="op" id="3642627">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3642630">return</span><br>
<span class="lineno"></span><span class="op" id="3642637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642640">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3642674">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3642738">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3642790">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3642808">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3642826">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3642851">func</span>&nbsp;<span class="op" id="3642856">(</span><span class="ident" id="3642857">z</span>&nbsp;<span class="ident" id="3642859">nat</span><span class="op" id="3642862">)</span>&nbsp;<span class="ident" id="3642864">divLarge</span><span class="op" id="3642872">(</span><span class="ident" id="3642873">u</span><span class="op" id="3642874">,</span>&nbsp;<span class="ident" id="3642876">uIn</span><span class="op" id="3642879">,</span>&nbsp;<span class="ident" id="3642881">v</span>&nbsp;<span class="ident" id="3642883">nat</span><span class="op" id="3642886">)</span>&nbsp;<span class="op" id="3642888">(</span><span class="ident" id="3642889">q</span><span class="op" id="3642890">,</span>&nbsp;<span class="ident" id="3642892">r</span>&nbsp;<span class="ident" id="3642894">nat</span><span class="op" id="3642897">)</span>&nbsp;<span class="op" id="3642899">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642902">n</span>&nbsp;<span class="op" id="3642904">:=</span>&nbsp;<span class="builtinfunc" id="3642907">len</span><span class="op" id="3642910">(</span><span class="ident" id="3642911">v</span><span class="op" id="3642912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3642915">m</span>&nbsp;<span class="op" id="3642917">:=</span>&nbsp;<span class="builtinfunc" id="3642920">len</span><span class="op" id="3642923">(</span><span class="ident" id="3642924">uIn</span><span class="op" id="3642927">)</span>&nbsp;<span class="op" id="3642929">-</span>&nbsp;<span class="ident" id="3642931">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3642935">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3642968">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643032">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643098">if</span>&nbsp;<span class="ident" id="3643101">alias</span><span class="op" id="3643106">(</span><span class="ident" id="3643107">z</span><span class="op" id="3643108">,</span>&nbsp;<span class="ident" id="3643110">uIn</span><span class="op" id="3643113">)</span>&nbsp;<span class="op" id="3643115">||</span>&nbsp;<span class="ident" id="3643118">alias</span><span class="op" id="3643123">(</span><span class="ident" id="3643124">z</span><span class="op" id="3643125">,</span>&nbsp;<span class="ident" id="3643127">v</span><span class="op" id="3643128">)</span>&nbsp;<span class="op" id="3643130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643134">z</span>&nbsp;<span class="op" id="3643136">=</span>&nbsp;<span class="builtintype" id="3643138">nil</span>&nbsp;<span class="comment" id="3643142">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643191">q</span>&nbsp;<span class="op" id="3643193">=</span>&nbsp;<span class="ident" id="3643195">z</span><span class="op" id="3643196">.</span><span class="builtinfunc" id="3643197">make</span><span class="op" id="3643201">(</span><span class="ident" id="3643202">m</span>&nbsp;<span class="op" id="3643204">+</span>&nbsp;<span class="num" id="3643206">1</span><span class="op" id="3643207">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643211">qhatv</span>&nbsp;<span class="op" id="3643217">:=</span>&nbsp;<span class="builtinfunc" id="3643220">make</span><span class="op" id="3643224">(</span><span class="ident" id="3643225">nat</span><span class="op" id="3643228">,</span>&nbsp;<span class="ident" id="3643230">n</span><span class="op" id="3643231">+</span><span class="num" id="3643232">1</span><span class="op" id="3643233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643236">if</span>&nbsp;<span class="ident" id="3643239">alias</span><span class="op" id="3643244">(</span><span class="ident" id="3643245">u</span><span class="op" id="3643246">,</span>&nbsp;<span class="ident" id="3643248">uIn</span><span class="op" id="3643251">)</span>&nbsp;<span class="op" id="3643253">||</span>&nbsp;<span class="ident" id="3643256">alias</span><span class="op" id="3643261">(</span><span class="ident" id="3643262">u</span><span class="op" id="3643263">,</span>&nbsp;<span class="ident" id="3643265">v</span><span class="op" id="3643266">)</span>&nbsp;<span class="op" id="3643268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643272">u</span>&nbsp;<span class="op" id="3643274">=</span>&nbsp;<span class="builtintype" id="3643276">nil</span>&nbsp;<span class="comment" id="3643280">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643326">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643329">u</span>&nbsp;<span class="op" id="3643331">=</span>&nbsp;<span class="ident" id="3643333">u</span><span class="op" id="3643334">.</span><span class="builtinfunc" id="3643335">make</span><span class="op" id="3643339">(</span><span class="builtinfunc" id="3643340">len</span><span class="op" id="3643343">(</span><span class="ident" id="3643344">uIn</span><span class="op" id="3643347">)</span>&nbsp;<span class="op" id="3643349">+</span>&nbsp;<span class="num" id="3643351">1</span><span class="op" id="3643352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643355">u</span><span class="op" id="3643356">.</span><span class="ident" id="3643357">clear</span><span class="op" id="3643362">(</span><span class="op" id="3643363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643367">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643375">shift</span>&nbsp;<span class="op" id="3643381">:=</span>&nbsp;<span class="ident" id="3643384">leadingZeros</span><span class="op" id="3643396">(</span><span class="ident" id="3643397">v</span><span class="op" id="3643398">[</span><span class="ident" id="3643399">n</span><span class="op" id="3643400">-</span><span class="num" id="3643401">1</span><span class="op" id="3643402">]</span><span class="op" id="3643403">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643406">if</span>&nbsp;<span class="ident" id="3643409">shift</span>&nbsp;<span class="op" id="3643415">&gt;</span>&nbsp;<span class="num" id="3643417">0</span>&nbsp;<span class="op" id="3643419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643423">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643496">v1</span>&nbsp;<span class="op" id="3643499">:=</span>&nbsp;<span class="builtinfunc" id="3643502">make</span><span class="op" id="3643506">(</span><span class="ident" id="3643507">nat</span><span class="op" id="3643510">,</span>&nbsp;<span class="ident" id="3643512">n</span><span class="op" id="3643513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643517">shlVU</span><span class="op" id="3643522">(</span><span class="ident" id="3643523">v1</span><span class="op" id="3643525">,</span>&nbsp;<span class="ident" id="3643527">v</span><span class="op" id="3643528">,</span>&nbsp;<span class="ident" id="3643530">shift</span><span class="op" id="3643535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643539">v</span>&nbsp;<span class="op" id="3643541">=</span>&nbsp;<span class="ident" id="3643543">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3643547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643550">u</span><span class="op" id="3643551">[</span><span class="builtinfunc" id="3643552">len</span><span class="op" id="3643555">(</span><span class="ident" id="3643556">uIn</span><span class="op" id="3643559">)</span><span class="op" id="3643560">]</span>&nbsp;<span class="op" id="3643562">=</span>&nbsp;<span class="ident" id="3643564">shlVU</span><span class="op" id="3643569">(</span><span class="ident" id="3643570">u</span><span class="op" id="3643571">[</span><span class="num" id="3643572">0</span><span class="op" id="3643573">:</span><span class="builtinfunc" id="3643574">len</span><span class="op" id="3643577">(</span><span class="ident" id="3643578">uIn</span><span class="op" id="3643581">)</span><span class="op" id="3643582">]</span><span class="op" id="3643583">,</span>&nbsp;<span class="ident" id="3643585">uIn</span><span class="op" id="3643588">,</span>&nbsp;<span class="ident" id="3643590">shift</span><span class="op" id="3643595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643599">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643607">for</span>&nbsp;<span class="ident" id="3643611">j</span>&nbsp;<span class="op" id="3643613">:=</span>&nbsp;<span class="ident" id="3643616">m</span><span class="op" id="3643617">;</span>&nbsp;<span class="ident" id="3643619">j</span>&nbsp;<span class="op" id="3643621">&gt;=</span>&nbsp;<span class="num" id="3643624">0</span><span class="op" id="3643625">;</span>&nbsp;<span class="ident" id="3643627">j</span><span class="op" id="3643628">--</span>&nbsp;<span class="op" id="3643631">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643635">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643644">qhat</span>&nbsp;<span class="op" id="3643649">:=</span>&nbsp;<span class="ident" id="3643652">Word</span><span class="op" id="3643656">(</span><span class="ident" id="3643657">_M</span><span class="op" id="3643659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643663">if</span>&nbsp;<span class="ident" id="3643666">u</span><span class="op" id="3643667">[</span><span class="ident" id="3643668">j</span><span class="op" id="3643669">+</span><span class="ident" id="3643670">n</span><span class="op" id="3643671">]</span>&nbsp;<span class="op" id="3643673">!=</span>&nbsp;<span class="ident" id="3643676">v</span><span class="op" id="3643677">[</span><span class="ident" id="3643678">n</span><span class="op" id="3643679">-</span><span class="num" id="3643680">1</span><span class="op" id="3643681">]</span>&nbsp;<span class="op" id="3643683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643688">var</span>&nbsp;<span class="ident" id="3643692">rhat</span>&nbsp;<span class="ident" id="3643697">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643705">qhat</span><span class="op" id="3643709">,</span>&nbsp;<span class="ident" id="3643711">rhat</span>&nbsp;<span class="op" id="3643716">=</span>&nbsp;<span class="ident" id="3643718">divWW</span><span class="op" id="3643723">(</span><span class="ident" id="3643724">u</span><span class="op" id="3643725">[</span><span class="ident" id="3643726">j</span><span class="op" id="3643727">+</span><span class="ident" id="3643728">n</span><span class="op" id="3643729">]</span><span class="op" id="3643730">,</span>&nbsp;<span class="ident" id="3643732">u</span><span class="op" id="3643733">[</span><span class="ident" id="3643734">j</span><span class="op" id="3643735">+</span><span class="ident" id="3643736">n</span><span class="op" id="3643737">-</span><span class="num" id="3643738">1</span><span class="op" id="3643739">]</span><span class="op" id="3643740">,</span>&nbsp;<span class="ident" id="3643742">v</span><span class="op" id="3643743">[</span><span class="ident" id="3643744">n</span><span class="op" id="3643745">-</span><span class="num" id="3643746">1</span><span class="op" id="3643747">]</span><span class="op" id="3643748">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643754">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643781">x1</span><span class="op" id="3643783">,</span>&nbsp;<span class="ident" id="3643785">x2</span>&nbsp;<span class="op" id="3643788">:=</span>&nbsp;<span class="ident" id="3643791">mulWW</span><span class="op" id="3643796">(</span><span class="ident" id="3643797">qhat</span><span class="op" id="3643801">,</span>&nbsp;<span class="ident" id="3643803">v</span><span class="op" id="3643804">[</span><span class="ident" id="3643805">n</span><span class="op" id="3643806">-</span><span class="num" id="3643807">2</span><span class="op" id="3643808">]</span><span class="op" id="3643809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643814">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3643858">for</span>&nbsp;<span class="ident" id="3643862">greaterThan</span><span class="op" id="3643873">(</span><span class="ident" id="3643874">x1</span><span class="op" id="3643876">,</span>&nbsp;<span class="ident" id="3643878">x2</span><span class="op" id="3643880">,</span>&nbsp;<span class="ident" id="3643882">rhat</span><span class="op" id="3643886">,</span>&nbsp;<span class="ident" id="3643888">u</span><span class="op" id="3643889">[</span><span class="ident" id="3643890">j</span><span class="op" id="3643891">+</span><span class="ident" id="3643892">n</span><span class="op" id="3643893">-</span><span class="num" id="3643894">2</span><span class="op" id="3643895">]</span><span class="op" id="3643896">)</span>&nbsp;<span class="op" id="3643898">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643904">qhat</span><span class="op" id="3643908">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643915">prevRhat</span>&nbsp;<span class="op" id="3643924">:=</span>&nbsp;<span class="ident" id="3643927">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3643936">rhat</span>&nbsp;<span class="op" id="3643941">+=</span>&nbsp;<span class="ident" id="3643944">v</span><span class="op" id="3643945">[</span><span class="ident" id="3643946">n</span><span class="op" id="3643947">-</span><span class="num" id="3643948">1</span><span class="op" id="3643949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3643955">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644003">if</span>&nbsp;<span class="ident" id="3644006">rhat</span>&nbsp;<span class="op" id="3644011">&lt;</span>&nbsp;<span class="ident" id="3644013">prevRhat</span>&nbsp;<span class="op" id="3644022">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644029">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644045">x1</span><span class="op" id="3644047">,</span>&nbsp;<span class="ident" id="3644049">x2</span>&nbsp;<span class="op" id="3644052">=</span>&nbsp;<span class="ident" id="3644054">mulWW</span><span class="op" id="3644059">(</span><span class="ident" id="3644060">qhat</span><span class="op" id="3644064">,</span>&nbsp;<span class="ident" id="3644066">v</span><span class="op" id="3644067">[</span><span class="ident" id="3644068">n</span><span class="op" id="3644069">-</span><span class="num" id="3644070">2</span><span class="op" id="3644071">]</span><span class="op" id="3644072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644081">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3644086">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644095">qhatv</span><span class="op" id="3644100">[</span><span class="ident" id="3644101">n</span><span class="op" id="3644102">]</span>&nbsp;<span class="op" id="3644104">=</span>&nbsp;<span class="ident" id="3644106">mulAddVWW</span><span class="op" id="3644115">(</span><span class="ident" id="3644116">qhatv</span><span class="op" id="3644121">[</span><span class="num" id="3644122">0</span><span class="op" id="3644123">:</span><span class="ident" id="3644124">n</span><span class="op" id="3644125">]</span><span class="op" id="3644126">,</span>&nbsp;<span class="ident" id="3644128">v</span><span class="op" id="3644129">,</span>&nbsp;<span class="ident" id="3644131">qhat</span><span class="op" id="3644135">,</span>&nbsp;<span class="num" id="3644137">0</span><span class="op" id="3644138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644143">c</span>&nbsp;<span class="op" id="3644145">:=</span>&nbsp;<span class="ident" id="3644148">subVV</span><span class="op" id="3644153">(</span><span class="ident" id="3644154">u</span><span class="op" id="3644155">[</span><span class="ident" id="3644156">j</span><span class="op" id="3644157">:</span><span class="ident" id="3644158">j</span><span class="op" id="3644159">+</span><span class="builtinfunc" id="3644160">len</span><span class="op" id="3644163">(</span><span class="ident" id="3644164">qhatv</span><span class="op" id="3644169">)</span><span class="op" id="3644170">]</span><span class="op" id="3644171">,</span>&nbsp;<span class="ident" id="3644173">u</span><span class="op" id="3644174">[</span><span class="ident" id="3644175">j</span><span class="op" id="3644176">:</span><span class="op" id="3644177">]</span><span class="op" id="3644178">,</span>&nbsp;<span class="ident" id="3644180">qhatv</span><span class="op" id="3644185">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644189">if</span>&nbsp;<span class="ident" id="3644192">c</span>&nbsp;<span class="op" id="3644194">!=</span>&nbsp;<span class="num" id="3644197">0</span>&nbsp;<span class="op" id="3644199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644204">c</span>&nbsp;<span class="op" id="3644206">:=</span>&nbsp;<span class="ident" id="3644209">addVV</span><span class="op" id="3644214">(</span><span class="ident" id="3644215">u</span><span class="op" id="3644216">[</span><span class="ident" id="3644217">j</span><span class="op" id="3644218">:</span><span class="ident" id="3644219">j</span><span class="op" id="3644220">+</span><span class="ident" id="3644221">n</span><span class="op" id="3644222">]</span><span class="op" id="3644223">,</span>&nbsp;<span class="ident" id="3644225">u</span><span class="op" id="3644226">[</span><span class="ident" id="3644227">j</span><span class="op" id="3644228">:</span><span class="op" id="3644229">]</span><span class="op" id="3644230">,</span>&nbsp;<span class="ident" id="3644232">v</span><span class="op" id="3644233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644238">u</span><span class="op" id="3644239">[</span><span class="ident" id="3644240">j</span><span class="op" id="3644241">+</span><span class="ident" id="3644242">n</span><span class="op" id="3644243">]</span>&nbsp;<span class="op" id="3644245">+=</span>&nbsp;<span class="ident" id="3644248">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644253">qhat</span><span class="op" id="3644257">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644262">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644267">q</span><span class="op" id="3644268">[</span><span class="ident" id="3644269">j</span><span class="op" id="3644270">]</span>&nbsp;<span class="op" id="3644272">=</span>&nbsp;<span class="ident" id="3644274">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644284">q</span>&nbsp;<span class="op" id="3644286">=</span>&nbsp;<span class="ident" id="3644288">q</span><span class="op" id="3644289">.</span><span class="ident" id="3644290">norm</span><span class="op" id="3644294">(</span><span class="op" id="3644295">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644298">shrVU</span><span class="op" id="3644303">(</span><span class="ident" id="3644304">u</span><span class="op" id="3644305">,</span>&nbsp;<span class="ident" id="3644307">u</span><span class="op" id="3644308">,</span>&nbsp;<span class="ident" id="3644310">shift</span><span class="op" id="3644315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644318">r</span>&nbsp;<span class="op" id="3644320">=</span>&nbsp;<span class="ident" id="3644322">u</span><span class="op" id="3644323">.</span><span class="ident" id="3644324">norm</span><span class="op" id="3644328">(</span><span class="op" id="3644329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644333">return</span>&nbsp;<span class="ident" id="3644340">q</span><span class="op" id="3644341">,</span>&nbsp;<span class="ident" id="3644343">r</span><br>
<span class="lineno"></span><span class="op" id="3644345">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3644348">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3644394">func</span>&nbsp;<span class="op" id="3644399">(</span><span class="ident" id="3644400">x</span>&nbsp;<span class="ident" id="3644402">nat</span><span class="op" id="3644405">)</span>&nbsp;<span class="ident" id="3644407">bitLen</span><span class="op" id="3644413">(</span><span class="op" id="3644414">)</span>&nbsp;<span class="builtintype" id="3644416">int</span>&nbsp;<span class="op" id="3644420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644423">if</span>&nbsp;<span class="ident" id="3644426">i</span>&nbsp;<span class="op" id="3644428">:=</span>&nbsp;<span class="builtinfunc" id="3644431">len</span><span class="op" id="3644434">(</span><span class="ident" id="3644435">x</span><span class="op" id="3644436">)</span>&nbsp;<span class="op" id="3644438">-</span>&nbsp;<span class="num" id="3644440">1</span><span class="op" id="3644441">;</span>&nbsp;<span class="ident" id="3644443">i</span>&nbsp;<span class="op" id="3644445">&gt;=</span>&nbsp;<span class="num" id="3644448">0</span>&nbsp;<span class="op" id="3644450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644454">return</span>&nbsp;<span class="ident" id="3644461">i</span><span class="op" id="3644462">*</span><span class="ident" id="3644463">_W</span>&nbsp;<span class="op" id="3644466">+</span>&nbsp;<span class="ident" id="3644468">bitLen</span><span class="op" id="3644474">(</span><span class="ident" id="3644475">x</span><span class="op" id="3644476">[</span><span class="ident" id="3644477">i</span><span class="op" id="3644478">]</span><span class="op" id="3644479">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644485">return</span>&nbsp;<span class="num" id="3644492">0</span><br>
<span class="lineno"></span><span class="op" id="3644494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3644497">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3644568">const</span>&nbsp;<span class="ident" id="3644574">MaxBase</span>&nbsp;<span class="op" id="3644582">=</span>&nbsp;<span class="string" id="3644584">&#39;z&#39;</span>&nbsp;<span class="op" id="3644588">-</span>&nbsp;<span class="string" id="3644590">&#39;a&#39;</span>&nbsp;<span class="op" id="3644594">+</span>&nbsp;<span class="num" id="3644596">10</span>&nbsp;<span class="op" id="3644599">+</span>&nbsp;<span class="num" id="3644601">1</span>&nbsp;<span class="comment" id="3644603">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3644627">func</span>&nbsp;<span class="ident" id="3644632">hexValue</span><span class="op" id="3644640">(</span><span class="ident" id="3644641">ch</span>&nbsp;<span class="builtintype" id="3644644">rune</span><span class="op" id="3644648">)</span>&nbsp;<span class="ident" id="3644650">Word</span>&nbsp;<span class="op" id="3644655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644658">d</span>&nbsp;<span class="op" id="3644660">:=</span>&nbsp;<span class="builtintype" id="3644663">int</span><span class="op" id="3644666">(</span><span class="ident" id="3644667">MaxBase</span>&nbsp;<span class="op" id="3644675">+</span>&nbsp;<span class="num" id="3644677">1</span><span class="op" id="3644678">)</span>&nbsp;<span class="comment" id="3644680">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644697">switch</span>&nbsp;<span class="op" id="3644704">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644707">case</span>&nbsp;<span class="string" id="3644712">&#39;0&#39;</span>&nbsp;<span class="op" id="3644716">&lt;=</span>&nbsp;<span class="ident" id="3644719">ch</span>&nbsp;<span class="op" id="3644722">&amp;&amp;</span>&nbsp;<span class="ident" id="3644725">ch</span>&nbsp;<span class="op" id="3644728">&lt;=</span>&nbsp;<span class="string" id="3644731">&#39;9&#39;</span><span class="op" id="3644734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644738">d</span>&nbsp;<span class="op" id="3644740">=</span>&nbsp;<span class="builtintype" id="3644742">int</span><span class="op" id="3644745">(</span><span class="ident" id="3644746">ch</span>&nbsp;<span class="op" id="3644749">-</span>&nbsp;<span class="string" id="3644751">&#39;0&#39;</span><span class="op" id="3644754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644757">case</span>&nbsp;<span class="string" id="3644762">&#39;a&#39;</span>&nbsp;<span class="op" id="3644766">&lt;=</span>&nbsp;<span class="ident" id="3644769">ch</span>&nbsp;<span class="op" id="3644772">&amp;&amp;</span>&nbsp;<span class="ident" id="3644775">ch</span>&nbsp;<span class="op" id="3644778">&lt;=</span>&nbsp;<span class="string" id="3644781">&#39;z&#39;</span><span class="op" id="3644784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644788">d</span>&nbsp;<span class="op" id="3644790">=</span>&nbsp;<span class="builtintype" id="3644792">int</span><span class="op" id="3644795">(</span><span class="ident" id="3644796">ch</span>&nbsp;<span class="op" id="3644799">-</span>&nbsp;<span class="string" id="3644801">&#39;a&#39;</span>&nbsp;<span class="op" id="3644805">+</span>&nbsp;<span class="num" id="3644807">10</span><span class="op" id="3644809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644812">case</span>&nbsp;<span class="string" id="3644817">&#39;A&#39;</span>&nbsp;<span class="op" id="3644821">&lt;=</span>&nbsp;<span class="ident" id="3644824">ch</span>&nbsp;<span class="op" id="3644827">&amp;&amp;</span>&nbsp;<span class="ident" id="3644830">ch</span>&nbsp;<span class="op" id="3644833">&lt;=</span>&nbsp;<span class="string" id="3644836">&#39;Z&#39;</span><span class="op" id="3644839">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3644843">d</span>&nbsp;<span class="op" id="3644845">=</span>&nbsp;<span class="builtintype" id="3644847">int</span><span class="op" id="3644850">(</span><span class="ident" id="3644851">ch</span>&nbsp;<span class="op" id="3644854">-</span>&nbsp;<span class="string" id="3644856">&#39;A&#39;</span>&nbsp;<span class="op" id="3644860">+</span>&nbsp;<span class="num" id="3644862">10</span><span class="op" id="3644864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3644867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3644870">return</span>&nbsp;<span class="ident" id="3644877">Word</span><span class="op" id="3644881">(</span><span class="ident" id="3644882">d</span><span class="op" id="3644883">)</span><br>
<span class="lineno"></span><span class="op" id="3644885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3644888">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3644970">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3645046">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3645125">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3645202">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3645238">//</span><br>
<span class="lineno"></span><span class="comment" id="3645241">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3645319">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3645397">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3645473">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3645551">//</span><br>
<span class="lineno"></span><span class="keyword" id="3645554">func</span>&nbsp;<span class="op" id="3645559">(</span><span class="ident" id="3645560">z</span>&nbsp;<span class="ident" id="3645562">nat</span><span class="op" id="3645565">)</span>&nbsp;<span class="ident" id="3645567">scan</span><span class="op" id="3645571">(</span><span class="ident" id="3645572">r</span>&nbsp;<span class="ident" id="3645574">io</span><span class="op" id="3645576">.</span><span class="ident" id="3645577">RuneScanner</span><span class="op" id="3645588">,</span>&nbsp;<span class="ident" id="3645590">base</span>&nbsp;<span class="builtintype" id="3645595">int</span><span class="op" id="3645598">)</span>&nbsp;<span class="op" id="3645600">(</span><span class="ident" id="3645601">nat</span><span class="op" id="3645604">,</span>&nbsp;<span class="builtintype" id="3645606">int</span><span class="op" id="3645609">,</span>&nbsp;<span class="builtintype" id="3645611">error</span><span class="op" id="3645616">)</span>&nbsp;<span class="op" id="3645618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3645621">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645646">if</span>&nbsp;<span class="ident" id="3645649">base</span>&nbsp;<span class="op" id="3645654">&lt;</span>&nbsp;<span class="num" id="3645656">0</span>&nbsp;<span class="op" id="3645658">||</span>&nbsp;<span class="ident" id="3645661">base</span>&nbsp;<span class="op" id="3645666">==</span>&nbsp;<span class="num" id="3645669">1</span>&nbsp;<span class="op" id="3645671">||</span>&nbsp;<span class="ident" id="3645674">MaxBase</span>&nbsp;<span class="op" id="3645682">&lt;</span>&nbsp;<span class="ident" id="3645684">base</span>&nbsp;<span class="op" id="3645689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645693">return</span>&nbsp;<span class="ident" id="3645700">z</span><span class="op" id="3645701">,</span>&nbsp;<span class="num" id="3645703">0</span><span class="op" id="3645704">,</span>&nbsp;<span class="ident" id="3645706">errors</span><span class="op" id="3645712">.</span><span class="ident" id="3645713">New</span><span class="op" id="3645716">(</span><span class="string" id="3645717">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3645738">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3645745">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645769">ch</span><span class="op" id="3645771">,</span>&nbsp;<span class="ident" id="3645773">_</span><span class="op" id="3645774">,</span>&nbsp;<span class="ident" id="3645776">err</span>&nbsp;<span class="op" id="3645780">:=</span>&nbsp;<span class="ident" id="3645783">r</span><span class="op" id="3645784">.</span><span class="ident" id="3645785">ReadRune</span><span class="op" id="3645793">(</span><span class="op" id="3645794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645797">if</span>&nbsp;<span class="ident" id="3645800">err</span>&nbsp;<span class="op" id="3645804">!=</span>&nbsp;<span class="builtintype" id="3645807">nil</span>&nbsp;<span class="op" id="3645811">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645815">return</span>&nbsp;<span class="ident" id="3645822">z</span><span class="op" id="3645823">,</span>&nbsp;<span class="num" id="3645825">0</span><span class="op" id="3645826">,</span>&nbsp;<span class="ident" id="3645828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3645833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3645837">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645869">b</span>&nbsp;<span class="op" id="3645871">:=</span>&nbsp;<span class="ident" id="3645874">Word</span><span class="op" id="3645878">(</span><span class="ident" id="3645879">base</span><span class="op" id="3645883">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645886">if</span>&nbsp;<span class="ident" id="3645889">base</span>&nbsp;<span class="op" id="3645894">==</span>&nbsp;<span class="num" id="3645897">0</span>&nbsp;<span class="op" id="3645899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645903">b</span>&nbsp;<span class="op" id="3645905">=</span>&nbsp;<span class="num" id="3645907">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645912">if</span>&nbsp;<span class="ident" id="3645915">ch</span>&nbsp;<span class="op" id="3645918">==</span>&nbsp;<span class="string" id="3645921">&#39;0&#39;</span>&nbsp;<span class="op" id="3645925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645930">switch</span>&nbsp;<span class="ident" id="3645937">ch</span><span class="op" id="3645939">,</span>&nbsp;<span class="ident" id="3645941">_</span><span class="op" id="3645942">,</span>&nbsp;<span class="ident" id="3645944">err</span>&nbsp;<span class="op" id="3645948">=</span>&nbsp;<span class="ident" id="3645950">r</span><span class="op" id="3645951">.</span><span class="ident" id="3645952">ReadRune</span><span class="op" id="3645960">(</span><span class="op" id="3645961">)</span><span class="op" id="3645962">;</span>&nbsp;<span class="ident" id="3645964">err</span>&nbsp;<span class="op" id="3645968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645973">case</span>&nbsp;<span class="builtintype" id="3645978">nil</span><span class="op" id="3645981">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3645987">b</span>&nbsp;<span class="op" id="3645989">=</span>&nbsp;<span class="num" id="3645991">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3645997">switch</span>&nbsp;<span class="ident" id="3646004">ch</span>&nbsp;<span class="op" id="3646007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646013">case</span>&nbsp;<span class="string" id="3646018">&#39;x&#39;</span><span class="op" id="3646021">,</span>&nbsp;<span class="string" id="3646023">&#39;X&#39;</span><span class="op" id="3646026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646033">b</span>&nbsp;<span class="op" id="3646035">=</span>&nbsp;<span class="num" id="3646037">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646044">case</span>&nbsp;<span class="string" id="3646049">&#39;b&#39;</span><span class="op" id="3646052">,</span>&nbsp;<span class="string" id="3646054">&#39;B&#39;</span><span class="op" id="3646057">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646064">b</span>&nbsp;<span class="op" id="3646066">=</span>&nbsp;<span class="num" id="3646068">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646080">if</span>&nbsp;<span class="ident" id="3646083">b</span>&nbsp;<span class="op" id="3646085">==</span>&nbsp;<span class="num" id="3646088">2</span>&nbsp;<span class="op" id="3646090">||</span>&nbsp;<span class="ident" id="3646093">b</span>&nbsp;<span class="op" id="3646095">==</span>&nbsp;<span class="num" id="3646098">16</span>&nbsp;<span class="op" id="3646101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646108">if</span>&nbsp;<span class="ident" id="3646111">ch</span><span class="op" id="3646113">,</span>&nbsp;<span class="ident" id="3646115">_</span><span class="op" id="3646116">,</span>&nbsp;<span class="ident" id="3646118">err</span>&nbsp;<span class="op" id="3646122">=</span>&nbsp;<span class="ident" id="3646124">r</span><span class="op" id="3646125">.</span><span class="ident" id="3646126">ReadRune</span><span class="op" id="3646134">(</span><span class="op" id="3646135">)</span><span class="op" id="3646136">;</span>&nbsp;<span class="ident" id="3646138">err</span>&nbsp;<span class="op" id="3646142">!=</span>&nbsp;<span class="builtintype" id="3646145">nil</span>&nbsp;<span class="op" id="3646149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646157">return</span>&nbsp;<span class="ident" id="3646164">z</span><span class="op" id="3646165">,</span>&nbsp;<span class="num" id="3646167">0</span><span class="op" id="3646168">,</span>&nbsp;<span class="ident" id="3646170">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646190">case</span>&nbsp;<span class="ident" id="3646195">io</span><span class="op" id="3646197">.</span><span class="ident" id="3646198">EOF</span><span class="op" id="3646201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646207">return</span>&nbsp;<span class="ident" id="3646214">z</span><span class="op" id="3646215">.</span><span class="builtinfunc" id="3646216">make</span><span class="op" id="3646220">(</span><span class="num" id="3646221">0</span><span class="op" id="3646222">)</span><span class="op" id="3646223">,</span>&nbsp;<span class="num" id="3646225">10</span><span class="op" id="3646227">,</span>&nbsp;<span class="builtintype" id="3646229">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646236">default</span><span class="op" id="3646243">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646249">return</span>&nbsp;<span class="ident" id="3646256">z</span><span class="op" id="3646257">,</span>&nbsp;<span class="num" id="3646259">10</span><span class="op" id="3646261">,</span>&nbsp;<span class="ident" id="3646263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646281">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646300">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646395">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646490">z</span>&nbsp;<span class="op" id="3646492">=</span>&nbsp;<span class="ident" id="3646494">z</span><span class="op" id="3646495">.</span><span class="builtinfunc" id="3646496">make</span><span class="op" id="3646500">(</span><span class="num" id="3646501">0</span><span class="op" id="3646502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646505">bb</span>&nbsp;<span class="op" id="3646508">:=</span>&nbsp;<span class="ident" id="3646511">Word</span><span class="op" id="3646515">(</span><span class="num" id="3646516">1</span><span class="op" id="3646517">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646520">dd</span>&nbsp;<span class="op" id="3646523">:=</span>&nbsp;<span class="ident" id="3646526">Word</span><span class="op" id="3646530">(</span><span class="num" id="3646531">0</span><span class="op" id="3646532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646535">for</span>&nbsp;<span class="ident" id="3646539">max</span>&nbsp;<span class="op" id="3646543">:=</span>&nbsp;<span class="ident" id="3646546">_M</span>&nbsp;<span class="op" id="3646549">/</span>&nbsp;<span class="ident" id="3646551">b</span><span class="op" id="3646552">;</span>&nbsp;<span class="op" id="3646554">;</span>&nbsp;<span class="op" id="3646556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646560">d</span>&nbsp;<span class="op" id="3646562">:=</span>&nbsp;<span class="ident" id="3646565">hexValue</span><span class="op" id="3646573">(</span><span class="ident" id="3646574">ch</span><span class="op" id="3646576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646580">if</span>&nbsp;<span class="ident" id="3646583">d</span>&nbsp;<span class="op" id="3646585">&gt;=</span>&nbsp;<span class="ident" id="3646588">b</span>&nbsp;<span class="op" id="3646590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646595">r</span><span class="op" id="3646596">.</span><span class="ident" id="3646597">UnreadRune</span><span class="op" id="3646607">(</span><span class="op" id="3646608">)</span>&nbsp;<span class="comment" id="3646610">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646653">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646666">if</span>&nbsp;<span class="ident" id="3646669">bb</span>&nbsp;<span class="op" id="3646672">&lt;=</span>&nbsp;<span class="ident" id="3646675">max</span>&nbsp;<span class="op" id="3646679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646684">bb</span>&nbsp;<span class="op" id="3646687">*=</span>&nbsp;<span class="ident" id="3646690">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646695">dd</span>&nbsp;<span class="op" id="3646698">=</span>&nbsp;<span class="ident" id="3646700">dd</span><span class="op" id="3646702">*</span><span class="ident" id="3646703">b</span>&nbsp;<span class="op" id="3646705">+</span>&nbsp;<span class="ident" id="3646707">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646711">}</span>&nbsp;<span class="keyword" id="3646713">else</span>&nbsp;<span class="op" id="3646718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646723">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646751">z</span>&nbsp;<span class="op" id="3646753">=</span>&nbsp;<span class="ident" id="3646755">z</span><span class="op" id="3646756">.</span><span class="ident" id="3646757">mulAddWW</span><span class="op" id="3646765">(</span><span class="ident" id="3646766">z</span><span class="op" id="3646767">,</span>&nbsp;<span class="ident" id="3646769">bb</span><span class="op" id="3646771">,</span>&nbsp;<span class="ident" id="3646773">dd</span><span class="op" id="3646775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646780">bb</span>&nbsp;<span class="op" id="3646783">=</span>&nbsp;<span class="ident" id="3646785">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646790">dd</span>&nbsp;<span class="op" id="3646793">=</span>&nbsp;<span class="ident" id="3646795">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646804">if</span>&nbsp;<span class="ident" id="3646807">ch</span><span class="op" id="3646809">,</span>&nbsp;<span class="ident" id="3646811">_</span><span class="op" id="3646812">,</span>&nbsp;<span class="ident" id="3646814">err</span>&nbsp;<span class="op" id="3646818">=</span>&nbsp;<span class="ident" id="3646820">r</span><span class="op" id="3646821">.</span><span class="ident" id="3646822">ReadRune</span><span class="op" id="3646830">(</span><span class="op" id="3646831">)</span><span class="op" id="3646832">;</span>&nbsp;<span class="ident" id="3646834">err</span>&nbsp;<span class="op" id="3646838">!=</span>&nbsp;<span class="builtintype" id="3646841">nil</span>&nbsp;<span class="op" id="3646845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646850">if</span>&nbsp;<span class="ident" id="3646853">err</span>&nbsp;<span class="op" id="3646857">!=</span>&nbsp;<span class="ident" id="3646860">io</span><span class="op" id="3646862">.</span><span class="ident" id="3646863">EOF</span>&nbsp;<span class="op" id="3646867">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646873">return</span>&nbsp;<span class="ident" id="3646880">z</span><span class="op" id="3646881">,</span>&nbsp;<span class="builtintype" id="3646883">int</span><span class="op" id="3646886">(</span><span class="ident" id="3646887">b</span><span class="op" id="3646888">)</span><span class="op" id="3646889">,</span>&nbsp;<span class="ident" id="3646891">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646903">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3646914">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646918">switch</span>&nbsp;<span class="op" id="3646925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3646928">case</span>&nbsp;<span class="ident" id="3646933">bb</span>&nbsp;<span class="op" id="3646936">&gt;</span>&nbsp;<span class="num" id="3646938">1</span><span class="op" id="3646939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3646943">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3646986">z</span>&nbsp;<span class="op" id="3646988">=</span>&nbsp;<span class="ident" id="3646990">z</span><span class="op" id="3646991">.</span><span class="ident" id="3646992">mulAddWW</span><span class="op" id="3647000">(</span><span class="ident" id="3647001">z</span><span class="op" id="3647002">,</span>&nbsp;<span class="ident" id="3647004">bb</span><span class="op" id="3647006">,</span>&nbsp;<span class="ident" id="3647008">dd</span><span class="op" id="3647010">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647013">case</span>&nbsp;<span class="ident" id="3647018">base</span>&nbsp;<span class="op" id="3647023">==</span>&nbsp;<span class="num" id="3647026">0</span>&nbsp;<span class="op" id="3647028">&amp;&amp;</span>&nbsp;<span class="ident" id="3647031">b</span>&nbsp;<span class="op" id="3647033">==</span>&nbsp;<span class="num" id="3647036">8</span><span class="op" id="3647037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3647041">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3647115">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647142">return</span>&nbsp;<span class="ident" id="3647149">z</span><span class="op" id="3647150">,</span>&nbsp;<span class="num" id="3647152">10</span><span class="op" id="3647154">,</span>&nbsp;<span class="builtintype" id="3647156">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647161">case</span>&nbsp;<span class="ident" id="3647166">base</span>&nbsp;<span class="op" id="3647171">!=</span>&nbsp;<span class="num" id="3647174">0</span>&nbsp;<span class="op" id="3647176">||</span>&nbsp;<span class="ident" id="3647179">b</span>&nbsp;<span class="op" id="3647181">!=</span>&nbsp;<span class="num" id="3647184">8</span><span class="op" id="3647185">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3647189">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647252">return</span>&nbsp;<span class="ident" id="3647259">z</span><span class="op" id="3647260">,</span>&nbsp;<span class="builtintype" id="3647262">int</span><span class="op" id="3647265">(</span><span class="ident" id="3647266">b</span><span class="op" id="3647267">)</span><span class="op" id="3647268">,</span>&nbsp;<span class="ident" id="3647270">errors</span><span class="op" id="3647276">.</span><span class="ident" id="3647277">New</span><span class="op" id="3647280">(</span><span class="string" id="3647281">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3647311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3647314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647318">return</span>&nbsp;<span class="ident" id="3647325">z</span><span class="op" id="3647326">.</span><span class="ident" id="3647327">norm</span><span class="op" id="3647331">(</span><span class="op" id="3647332">)</span><span class="op" id="3647333">,</span>&nbsp;<span class="builtintype" id="3647335">int</span><span class="op" id="3647338">(</span><span class="ident" id="3647339">b</span><span class="op" id="3647340">)</span><span class="op" id="3647341">,</span>&nbsp;<span class="builtintype" id="3647343">nil</span><br>
<span class="lineno">720</span><span class="op" id="3647347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3647350">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3647391">const</span>&nbsp;<span class="op" id="3647397">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647400">lowercaseDigits</span>&nbsp;<span class="op" id="3647416">=</span>&nbsp;<span class="string" id="3647418">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647458">uppercaseDigits</span>&nbsp;<span class="op" id="3647474">=</span>&nbsp;<span class="string" id="3647476">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3647515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3647518">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3647574">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3647626">func</span>&nbsp;<span class="op" id="3647631">(</span><span class="ident" id="3647632">x</span>&nbsp;<span class="ident" id="3647634">nat</span><span class="op" id="3647637">)</span>&nbsp;<span class="ident" id="3647639">decimalString</span><span class="op" id="3647652">(</span><span class="op" id="3647653">)</span>&nbsp;<span class="builtintype" id="3647655">string</span>&nbsp;<span class="op" id="3647662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647665">return</span>&nbsp;<span class="ident" id="3647672">x</span><span class="op" id="3647673">.</span><span class="builtintype" id="3647674">string</span><span class="op" id="3647680">(</span><span class="ident" id="3647681">lowercaseDigits</span><span class="op" id="3647696">[</span><span class="num" id="3647697">0</span><span class="op" id="3647698">:</span><span class="num" id="3647699">10</span><span class="op" id="3647701">]</span><span class="op" id="3647702">)</span><br>
<span class="lineno"></span><span class="op" id="3647704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3647707">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3647782">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3647857">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3647908">func</span>&nbsp;<span class="op" id="3647913">(</span><span class="ident" id="3647914">x</span>&nbsp;<span class="ident" id="3647916">nat</span><span class="op" id="3647919">)</span>&nbsp;<span class="builtintype" id="3647921">string</span><span class="op" id="3647927">(</span><span class="ident" id="3647928">charset</span>&nbsp;<span class="builtintype" id="3647936">string</span><span class="op" id="3647942">)</span>&nbsp;<span class="builtintype" id="3647944">string</span>&nbsp;<span class="op" id="3647951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3647954">b</span>&nbsp;<span class="op" id="3647956">:=</span>&nbsp;<span class="ident" id="3647959">Word</span><span class="op" id="3647963">(</span><span class="builtinfunc" id="3647964">len</span><span class="op" id="3647967">(</span><span class="ident" id="3647968">charset</span><span class="op" id="3647975">)</span><span class="op" id="3647976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3647980">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3647998">switch</span>&nbsp;<span class="op" id="3648005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648008">case</span>&nbsp;<span class="ident" id="3648013">b</span>&nbsp;<span class="op" id="3648015">&lt;</span>&nbsp;<span class="num" id="3648017">2</span>&nbsp;<span class="op" id="3648019">||</span>&nbsp;<span class="ident" id="3648022">MaxBase</span>&nbsp;<span class="op" id="3648030">&gt;</span>&nbsp;<span class="num" id="3648032">256</span><span class="op" id="3648035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3648039">panic</span><span class="op" id="3648044">(</span><span class="string" id="3648045">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3648059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648062">case</span>&nbsp;<span class="builtinfunc" id="3648067">len</span><span class="op" id="3648070">(</span><span class="ident" id="3648071">x</span><span class="op" id="3648072">)</span>&nbsp;<span class="op" id="3648074">==</span>&nbsp;<span class="num" id="3648077">0</span><span class="op" id="3648078">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648082">return</span>&nbsp;<span class="builtintype" id="3648089">string</span><span class="op" id="3648095">(</span><span class="ident" id="3648096">charset</span><span class="op" id="3648103">[</span><span class="num" id="3648104">0</span><span class="op" id="3648105">]</span><span class="op" id="3648106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3648109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648113">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648148">i</span>&nbsp;<span class="op" id="3648150">:=</span>&nbsp;<span class="builtintype" id="3648153">int</span><span class="op" id="3648156">(</span><span class="builtintype" id="3648157">float64</span><span class="op" id="3648164">(</span><span class="ident" id="3648165">x</span><span class="op" id="3648166">.</span><span class="ident" id="3648167">bitLen</span><span class="op" id="3648173">(</span><span class="op" id="3648174">)</span><span class="op" id="3648175">)</span><span class="op" id="3648176">/</span><span class="ident" id="3648177">math</span><span class="op" id="3648181">.</span><span class="ident" id="3648182">Log2</span><span class="op" id="3648186">(</span><span class="builtintype" id="3648187">float64</span><span class="op" id="3648194">(</span><span class="ident" id="3648195">b</span><span class="op" id="3648196">)</span><span class="op" id="3648197">)</span><span class="op" id="3648198">)</span>&nbsp;<span class="op" id="3648200">+</span>&nbsp;<span class="num" id="3648202">1</span>&nbsp;<span class="comment" id="3648204">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648227">s</span>&nbsp;<span class="op" id="3648229">:=</span>&nbsp;<span class="builtinfunc" id="3648232">make</span><span class="op" id="3648236">(</span><span class="op" id="3648237">[</span><span class="op" id="3648238">]</span><span class="builtintype" id="3648239">byte</span><span class="op" id="3648243">,</span>&nbsp;<span class="ident" id="3648245">i</span><span class="op" id="3648246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648250">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648313">if</span>&nbsp;<span class="ident" id="3648316">b</span>&nbsp;<span class="op" id="3648318">==</span>&nbsp;<span class="ident" id="3648321">b</span><span class="op" id="3648322">&amp;</span><span class="op" id="3648323">-</span><span class="ident" id="3648324">b</span>&nbsp;<span class="op" id="3648326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648330">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648370">shift</span>&nbsp;<span class="op" id="3648376">:=</span>&nbsp;<span class="ident" id="3648379">trailingZeroBits</span><span class="op" id="3648395">(</span><span class="ident" id="3648396">b</span><span class="op" id="3648397">)</span>&nbsp;<span class="comment" id="3648399">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648429">mask</span>&nbsp;<span class="op" id="3648434">:=</span>&nbsp;<span class="ident" id="3648437">Word</span><span class="op" id="3648441">(</span><span class="num" id="3648442">1</span><span class="op" id="3648443">)</span><span class="op" id="3648444">&lt;&lt;</span><span class="ident" id="3648446">shift</span>&nbsp;<span class="op" id="3648452">-</span>&nbsp;<span class="num" id="3648454">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648458">w</span>&nbsp;<span class="op" id="3648460">:=</span>&nbsp;<span class="ident" id="3648463">x</span><span class="op" id="3648464">[</span><span class="num" id="3648465">0</span><span class="op" id="3648466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648470">nbits</span>&nbsp;<span class="op" id="3648476">:=</span>&nbsp;<span class="builtintype" id="3648479">uint</span><span class="op" id="3648483">(</span><span class="ident" id="3648484">_W</span><span class="op" id="3648486">)</span>&nbsp;<span class="comment" id="3648488">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648526">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648562">for</span>&nbsp;<span class="ident" id="3648566">k</span>&nbsp;<span class="op" id="3648568">:=</span>&nbsp;<span class="num" id="3648571">1</span><span class="op" id="3648572">;</span>&nbsp;<span class="ident" id="3648574">k</span>&nbsp;<span class="op" id="3648576">&lt;</span>&nbsp;<span class="builtinfunc" id="3648578">len</span><span class="op" id="3648581">(</span><span class="ident" id="3648582">x</span><span class="op" id="3648583">)</span><span class="op" id="3648584">;</span>&nbsp;<span class="ident" id="3648586">k</span><span class="op" id="3648587">++</span>&nbsp;<span class="op" id="3648590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648595">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648621">for</span>&nbsp;<span class="ident" id="3648625">nbits</span>&nbsp;<span class="op" id="3648631">&gt;=</span>&nbsp;<span class="ident" id="3648634">shift</span>&nbsp;<span class="op" id="3648640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648646">i</span><span class="op" id="3648647">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648654">s</span><span class="op" id="3648655">[</span><span class="ident" id="3648656">i</span><span class="op" id="3648657">]</span>&nbsp;<span class="op" id="3648659">=</span>&nbsp;<span class="ident" id="3648661">charset</span><span class="op" id="3648668">[</span><span class="ident" id="3648669">w</span><span class="op" id="3648670">&amp;</span><span class="ident" id="3648671">mask</span><span class="op" id="3648675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648681">w</span>&nbsp;<span class="op" id="3648683">&gt;&gt;=</span>&nbsp;<span class="ident" id="3648687">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648697">nbits</span>&nbsp;<span class="op" id="3648703">-=</span>&nbsp;<span class="ident" id="3648706">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3648715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648721">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3648786">if</span>&nbsp;<span class="ident" id="3648789">nbits</span>&nbsp;<span class="op" id="3648795">==</span>&nbsp;<span class="num" id="3648798">0</span>&nbsp;<span class="op" id="3648800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648806">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648854">w</span>&nbsp;<span class="op" id="3648856">=</span>&nbsp;<span class="ident" id="3648858">x</span><span class="op" id="3648859">[</span><span class="ident" id="3648860">k</span><span class="op" id="3648861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648867">nbits</span>&nbsp;<span class="op" id="3648873">=</span>&nbsp;<span class="ident" id="3648875">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3648881">}</span>&nbsp;<span class="keyword" id="3648883">else</span>&nbsp;<span class="op" id="3648888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3648894">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648950">w</span>&nbsp;<span class="op" id="3648952">|=</span>&nbsp;<span class="ident" id="3648955">x</span><span class="op" id="3648956">[</span><span class="ident" id="3648957">k</span><span class="op" id="3648958">]</span>&nbsp;<span class="op" id="3648960">&lt;&lt;</span>&nbsp;<span class="ident" id="3648963">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648973">i</span><span class="op" id="3648974">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3648981">s</span><span class="op" id="3648982">[</span><span class="ident" id="3648983">i</span><span class="op" id="3648984">]</span>&nbsp;<span class="op" id="3648986">=</span>&nbsp;<span class="ident" id="3648988">charset</span><span class="op" id="3648995">[</span><span class="ident" id="3648996">w</span><span class="op" id="3648997">&amp;</span><span class="ident" id="3648998">mask</span><span class="op" id="3649002">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649009">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649024">w</span>&nbsp;<span class="op" id="3649026">=</span>&nbsp;<span class="ident" id="3649028">x</span><span class="op" id="3649029">[</span><span class="ident" id="3649030">k</span><span class="op" id="3649031">]</span>&nbsp;<span class="op" id="3649033">&gt;&gt;</span>&nbsp;<span class="op" id="3649036">(</span><span class="ident" id="3649037">shift</span>&nbsp;<span class="op" id="3649043">-</span>&nbsp;<span class="ident" id="3649045">nbits</span><span class="op" id="3649050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649056">nbits</span>&nbsp;<span class="op" id="3649062">=</span>&nbsp;<span class="ident" id="3649064">_W</span>&nbsp;<span class="op" id="3649067">-</span>&nbsp;<span class="op" id="3649069">(</span><span class="ident" id="3649070">shift</span>&nbsp;<span class="op" id="3649076">-</span>&nbsp;<span class="ident" id="3649078">nbits</span><span class="op" id="3649083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3649088">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3649092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649097">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3649163">for</span>&nbsp;<span class="ident" id="3649167">nbits</span>&nbsp;<span class="op" id="3649173">&gt;=</span>&nbsp;<span class="num" id="3649176">0</span>&nbsp;<span class="op" id="3649178">&amp;&amp;</span>&nbsp;<span class="ident" id="3649181">w</span>&nbsp;<span class="op" id="3649183">!=</span>&nbsp;<span class="num" id="3649186">0</span>&nbsp;<span class="op" id="3649188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649193">i</span><span class="op" id="3649194">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649200">s</span><span class="op" id="3649201">[</span><span class="ident" id="3649202">i</span><span class="op" id="3649203">]</span>&nbsp;<span class="op" id="3649205">=</span>&nbsp;<span class="ident" id="3649207">charset</span><span class="op" id="3649214">[</span><span class="ident" id="3649215">w</span><span class="op" id="3649216">&amp;</span><span class="ident" id="3649217">mask</span><span class="op" id="3649221">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649226">w</span>&nbsp;<span class="op" id="3649228">&gt;&gt;=</span>&nbsp;<span class="ident" id="3649232">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649241">nbits</span>&nbsp;<span class="op" id="3649247">-=</span>&nbsp;<span class="ident" id="3649250">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3649258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3649262">}</span>&nbsp;<span class="keyword" id="3649264">else</span>&nbsp;<span class="op" id="3649269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649273">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649336">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649394">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649451">bb</span>&nbsp;<span class="op" id="3649454">:=</span>&nbsp;<span class="ident" id="3649457">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649464">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649492">ndigits</span>&nbsp;<span class="op" id="3649500">:=</span>&nbsp;<span class="num" id="3649503">1</span>&nbsp;<span class="comment" id="3649505">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3649534">for</span>&nbsp;<span class="ident" id="3649538">max</span>&nbsp;<span class="op" id="3649542">:=</span>&nbsp;<span class="ident" id="3649545">Word</span><span class="op" id="3649549">(</span><span class="ident" id="3649550">_M</span>&nbsp;<span class="op" id="3649553">/</span>&nbsp;<span class="ident" id="3649555">b</span><span class="op" id="3649556">)</span><span class="op" id="3649557">;</span>&nbsp;<span class="ident" id="3649559">bb</span>&nbsp;<span class="op" id="3649562">&lt;=</span>&nbsp;<span class="ident" id="3649565">max</span><span class="op" id="3649568">;</span>&nbsp;<span class="ident" id="3649570">bb</span>&nbsp;<span class="op" id="3649573">*=</span>&nbsp;<span class="ident" id="3649576">b</span>&nbsp;<span class="op" id="3649578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649583">ndigits</span><span class="op" id="3649590">++</span>&nbsp;<span class="comment" id="3649593">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3649647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649652">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649733">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649788">table</span>&nbsp;<span class="op" id="3649794">:=</span>&nbsp;<span class="ident" id="3649797">divisors</span><span class="op" id="3649805">(</span><span class="builtinfunc" id="3649806">len</span><span class="op" id="3649809">(</span><span class="ident" id="3649810">x</span><span class="op" id="3649811">)</span><span class="op" id="3649812">,</span>&nbsp;<span class="ident" id="3649814">b</span><span class="op" id="3649815">,</span>&nbsp;<span class="ident" id="3649817">ndigits</span><span class="op" id="3649824">,</span>&nbsp;<span class="ident" id="3649826">bb</span><span class="op" id="3649828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649833">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649892">q</span>&nbsp;<span class="op" id="3649894">:=</span>&nbsp;<span class="ident" id="3649897">nat</span><span class="op" id="3649900">(</span><span class="builtintype" id="3649901">nil</span><span class="op" id="3649904">)</span><span class="op" id="3649905">.</span><span class="ident" id="3649906">set</span><span class="op" id="3649909">(</span><span class="ident" id="3649910">x</span><span class="op" id="3649911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649916">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3649953">q</span><span class="op" id="3649954">.</span><span class="ident" id="3649955">convertWords</span><span class="op" id="3649967">(</span><span class="ident" id="3649968">s</span><span class="op" id="3649969">,</span>&nbsp;<span class="ident" id="3649971">charset</span><span class="op" id="3649978">,</span>&nbsp;<span class="ident" id="3649980">b</span><span class="op" id="3649981">,</span>&nbsp;<span class="ident" id="3649983">ndigits</span><span class="op" id="3649990">,</span>&nbsp;<span class="ident" id="3649992">bb</span><span class="op" id="3649994">,</span>&nbsp;<span class="ident" id="3649996">table</span><span class="op" id="3650001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3650006">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3650031">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3650093">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3650127">i</span>&nbsp;<span class="op" id="3650129">=</span>&nbsp;<span class="num" id="3650131">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3650135">for</span>&nbsp;<span class="ident" id="3650139">zero</span>&nbsp;<span class="op" id="3650144">:=</span>&nbsp;<span class="ident" id="3650147">charset</span><span class="op" id="3650154">[</span><span class="num" id="3650155">0</span><span class="op" id="3650156">]</span><span class="op" id="3650157">;</span>&nbsp;<span class="ident" id="3650159">s</span><span class="op" id="3650160">[</span><span class="ident" id="3650161">i</span><span class="op" id="3650162">]</span>&nbsp;<span class="op" id="3650164">==</span>&nbsp;<span class="ident" id="3650167">zero</span><span class="op" id="3650171">;</span>&nbsp;<span class="op" id="3650173">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3650178">i</span><span class="op" id="3650179">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3650184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3650187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3650191">return</span>&nbsp;<span class="builtintype" id="3650198">string</span><span class="op" id="3650204">(</span><span class="ident" id="3650205">s</span><span class="op" id="3650206">[</span><span class="ident" id="3650207">i</span><span class="op" id="3650208">:</span><span class="op" id="3650209">]</span><span class="op" id="3650210">)</span><br>
<span class="lineno">825</span><span class="op" id="3650212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3650215">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3650309">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3650403">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3650434">//</span><br>
<span class="lineno"></span><span class="comment" id="3650437">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3650537">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3650634">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3650730">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3650826">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3650924">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3651021">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3651118">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3651216">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3651312">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3651405">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3651427">//</span><br>
<span class="lineno"></span><span class="keyword" id="3651430">func</span>&nbsp;<span class="op" id="3651435">(</span><span class="ident" id="3651436">q</span>&nbsp;<span class="ident" id="3651438">nat</span><span class="op" id="3651441">)</span>&nbsp;<span class="ident" id="3651443">convertWords</span><span class="op" id="3651455">(</span><span class="ident" id="3651456">s</span>&nbsp;<span class="op" id="3651458">[</span><span class="op" id="3651459">]</span><span class="builtintype" id="3651460">byte</span><span class="op" id="3651464">,</span>&nbsp;<span class="ident" id="3651466">charset</span>&nbsp;<span class="builtintype" id="3651474">string</span><span class="op" id="3651480">,</span>&nbsp;<span class="ident" id="3651482">b</span>&nbsp;<span class="ident" id="3651484">Word</span><span class="op" id="3651488">,</span>&nbsp;<span class="ident" id="3651490">ndigits</span>&nbsp;<span class="builtintype" id="3651498">int</span><span class="op" id="3651501">,</span>&nbsp;<span class="ident" id="3651503">bb</span>&nbsp;<span class="ident" id="3651506">Word</span><span class="op" id="3651510">,</span>&nbsp;<span class="ident" id="3651512">table</span>&nbsp;<span class="op" id="3651518">[</span><span class="op" id="3651519">]</span><span class="ident" id="3651520">divisor</span><span class="op" id="3651527">)</span>&nbsp;<span class="op" id="3651529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3651532">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3651568">if</span>&nbsp;<span class="ident" id="3651571">table</span>&nbsp;<span class="op" id="3651577">!=</span>&nbsp;<span class="builtintype" id="3651580">nil</span>&nbsp;<span class="op" id="3651584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3651588">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3651615">var</span>&nbsp;<span class="ident" id="3651619">r</span>&nbsp;<span class="ident" id="3651621">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3651627">index</span>&nbsp;<span class="op" id="3651633">:=</span>&nbsp;<span class="builtinfunc" id="3651636">len</span><span class="op" id="3651639">(</span><span class="ident" id="3651640">table</span><span class="op" id="3651645">)</span>&nbsp;<span class="op" id="3651647">-</span>&nbsp;<span class="num" id="3651649">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3651653">for</span>&nbsp;<span class="builtinfunc" id="3651657">len</span><span class="op" id="3651660">(</span><span class="ident" id="3651661">q</span><span class="op" id="3651662">)</span>&nbsp;<span class="op" id="3651664">&gt;</span>&nbsp;<span class="ident" id="3651666">leafSize</span>&nbsp;<span class="op" id="3651675">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3651680">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3651749">maxLength</span>&nbsp;<span class="op" id="3651759">:=</span>&nbsp;<span class="ident" id="3651762">q</span><span class="op" id="3651763">.</span><span class="ident" id="3651764">bitLen</span><span class="op" id="3651770">(</span><span class="op" id="3651771">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3651777">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3651847">minLength</span>&nbsp;<span class="op" id="3651857">:=</span>&nbsp;<span class="ident" id="3651860">maxLength</span>&nbsp;<span class="op" id="3651870">&gt;&gt;</span>&nbsp;<span class="num" id="3651873">1</span>&nbsp;<span class="comment" id="3651875">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3651897">for</span>&nbsp;<span class="ident" id="3651901">index</span>&nbsp;<span class="op" id="3651907">&gt;</span>&nbsp;<span class="num" id="3651909">0</span>&nbsp;<span class="op" id="3651911">&amp;&amp;</span>&nbsp;<span class="ident" id="3651914">table</span><span class="op" id="3651919">[</span><span class="ident" id="3651920">index</span><span class="op" id="3651925">-</span><span class="num" id="3651926">1</span><span class="op" id="3651927">]</span><span class="op" id="3651928">.</span><span class="ident" id="3651929">nbits</span>&nbsp;<span class="op" id="3651935">&gt;</span>&nbsp;<span class="ident" id="3651937">minLength</span>&nbsp;<span class="op" id="3651947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3651953">index</span><span class="op" id="3651958">--</span>&nbsp;<span class="comment" id="3651961">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3651975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3651980">if</span>&nbsp;<span class="ident" id="3651983">table</span><span class="op" id="3651988">[</span><span class="ident" id="3651989">index</span><span class="op" id="3651994">]</span><span class="op" id="3651995">.</span><span class="ident" id="3651996">nbits</span>&nbsp;<span class="op" id="3652002">&gt;=</span>&nbsp;<span class="ident" id="3652005">maxLength</span>&nbsp;<span class="op" id="3652015">&amp;&amp;</span>&nbsp;<span class="ident" id="3652018">table</span><span class="op" id="3652023">[</span><span class="ident" id="3652024">index</span><span class="op" id="3652029">]</span><span class="op" id="3652030">.</span><span class="ident" id="3652031">bbb</span><span class="op" id="3652034">.</span><span class="ident" id="3652035">cmp</span><span class="op" id="3652038">(</span><span class="ident" id="3652039">q</span><span class="op" id="3652040">)</span>&nbsp;<span class="op" id="3652042">&gt;=</span>&nbsp;<span class="num" id="3652045">0</span>&nbsp;<span class="op" id="3652047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652053">index</span><span class="op" id="3652058">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3652065">if</span>&nbsp;<span class="ident" id="3652068">index</span>&nbsp;<span class="op" id="3652074">&lt;</span>&nbsp;<span class="num" id="3652076">0</span>&nbsp;<span class="op" id="3652078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3652085">panic</span><span class="op" id="3652090">(</span><span class="string" id="3652091">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3652115">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3652121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3652126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652132">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652215">q</span><span class="op" id="3652216">,</span>&nbsp;<span class="ident" id="3652218">r</span>&nbsp;<span class="op" id="3652220">=</span>&nbsp;<span class="ident" id="3652222">q</span><span class="op" id="3652223">.</span><span class="ident" id="3652224">div</span><span class="op" id="3652227">(</span><span class="ident" id="3652228">r</span><span class="op" id="3652229">,</span>&nbsp;<span class="ident" id="3652231">q</span><span class="op" id="3652232">,</span>&nbsp;<span class="ident" id="3652234">table</span><span class="op" id="3652239">[</span><span class="ident" id="3652240">index</span><span class="op" id="3652245">]</span><span class="op" id="3652246">.</span><span class="ident" id="3652247">bbb</span><span class="op" id="3652250">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652256">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652319">h</span>&nbsp;<span class="op" id="3652321">:=</span>&nbsp;<span class="builtinfunc" id="3652324">len</span><span class="op" id="3652327">(</span><span class="ident" id="3652328">s</span><span class="op" id="3652329">)</span>&nbsp;<span class="op" id="3652331">-</span>&nbsp;<span class="ident" id="3652333">table</span><span class="op" id="3652338">[</span><span class="ident" id="3652339">index</span><span class="op" id="3652344">]</span><span class="op" id="3652345">.</span><span class="ident" id="3652346">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652357">r</span><span class="op" id="3652358">.</span><span class="ident" id="3652359">convertWords</span><span class="op" id="3652371">(</span><span class="ident" id="3652372">s</span><span class="op" id="3652373">[</span><span class="ident" id="3652374">h</span><span class="op" id="3652375">:</span><span class="op" id="3652376">]</span><span class="op" id="3652377">,</span>&nbsp;<span class="ident" id="3652379">charset</span><span class="op" id="3652386">,</span>&nbsp;<span class="ident" id="3652388">b</span><span class="op" id="3652389">,</span>&nbsp;<span class="ident" id="3652391">ndigits</span><span class="op" id="3652398">,</span>&nbsp;<span class="ident" id="3652400">bb</span><span class="op" id="3652402">,</span>&nbsp;<span class="ident" id="3652404">table</span><span class="op" id="3652409">[</span><span class="num" id="3652410">0</span><span class="op" id="3652411">:</span><span class="ident" id="3652412">index</span><span class="op" id="3652417">]</span><span class="op" id="3652418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652423">s</span>&nbsp;<span class="op" id="3652425">=</span>&nbsp;<span class="ident" id="3652427">s</span><span class="op" id="3652428">[</span><span class="op" id="3652429">:</span><span class="ident" id="3652430">h</span><span class="op" id="3652431">]</span>&nbsp;<span class="comment" id="3652433">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3652502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3652505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652509">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652595">i</span>&nbsp;<span class="op" id="3652597">:=</span>&nbsp;<span class="builtinfunc" id="3652600">len</span><span class="op" id="3652603">(</span><span class="ident" id="3652604">s</span><span class="op" id="3652605">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3652608">var</span>&nbsp;<span class="ident" id="3652612">r</span>&nbsp;<span class="ident" id="3652614">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3652620">if</span>&nbsp;<span class="ident" id="3652623">b</span>&nbsp;<span class="op" id="3652625">==</span>&nbsp;<span class="num" id="3652628">10</span>&nbsp;<span class="op" id="3652631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652635">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3652722">for</span>&nbsp;<span class="builtinfunc" id="3652726">len</span><span class="op" id="3652729">(</span><span class="ident" id="3652730">q</span><span class="op" id="3652731">)</span>&nbsp;<span class="op" id="3652733">&gt;</span>&nbsp;<span class="num" id="3652735">0</span>&nbsp;<span class="op" id="3652737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652742">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652791">q</span><span class="op" id="3652792">,</span>&nbsp;<span class="ident" id="3652794">r</span>&nbsp;<span class="op" id="3652796">=</span>&nbsp;<span class="ident" id="3652798">q</span><span class="op" id="3652799">.</span><span class="ident" id="3652800">divW</span><span class="op" id="3652804">(</span><span class="ident" id="3652805">q</span><span class="op" id="3652806">,</span>&nbsp;<span class="ident" id="3652808">bb</span><span class="op" id="3652810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3652815">for</span>&nbsp;<span class="ident" id="3652819">j</span>&nbsp;<span class="op" id="3652821">:=</span>&nbsp;<span class="num" id="3652824">0</span><span class="op" id="3652825">;</span>&nbsp;<span class="ident" id="3652827">j</span>&nbsp;<span class="op" id="3652829">&lt;</span>&nbsp;<span class="ident" id="3652831">ndigits</span>&nbsp;<span class="op" id="3652839">&amp;&amp;</span>&nbsp;<span class="ident" id="3652842">i</span>&nbsp;<span class="op" id="3652844">&gt;</span>&nbsp;<span class="num" id="3652846">0</span><span class="op" id="3652847">;</span>&nbsp;<span class="ident" id="3652849">j</span><span class="op" id="3652850">++</span>&nbsp;<span class="op" id="3652853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3652859">i</span><span class="op" id="3652860">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652867">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652926">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3652990">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653052">t</span>&nbsp;<span class="op" id="3653054">:=</span>&nbsp;<span class="ident" id="3653057">r</span>&nbsp;<span class="op" id="3653059">/</span>&nbsp;<span class="num" id="3653061">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653068">s</span><span class="op" id="3653069">[</span><span class="ident" id="3653070">i</span><span class="op" id="3653071">]</span>&nbsp;<span class="op" id="3653073">=</span>&nbsp;<span class="ident" id="3653075">charset</span><span class="op" id="3653082">[</span><span class="ident" id="3653083">r</span><span class="op" id="3653084">-</span><span class="ident" id="3653085">t</span><span class="op" id="3653086">&lt;&lt;</span><span class="num" id="3653088">3</span><span class="op" id="3653089">-</span><span class="ident" id="3653090">t</span><span class="op" id="3653091">-</span><span class="ident" id="3653092">t</span><span class="op" id="3653093">]</span>&nbsp;<span class="comment" id="3653095">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653163">r</span>&nbsp;<span class="op" id="3653165">=</span>&nbsp;<span class="ident" id="3653167">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653172">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653179">}</span>&nbsp;<span class="keyword" id="3653181">else</span>&nbsp;<span class="op" id="3653186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653190">for</span>&nbsp;<span class="builtinfunc" id="3653194">len</span><span class="op" id="3653197">(</span><span class="ident" id="3653198">q</span><span class="op" id="3653199">)</span>&nbsp;<span class="op" id="3653201">&gt;</span>&nbsp;<span class="num" id="3653203">0</span>&nbsp;<span class="op" id="3653205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3653210">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653259">q</span><span class="op" id="3653260">,</span>&nbsp;<span class="ident" id="3653262">r</span>&nbsp;<span class="op" id="3653264">=</span>&nbsp;<span class="ident" id="3653266">q</span><span class="op" id="3653267">.</span><span class="ident" id="3653268">divW</span><span class="op" id="3653272">(</span><span class="ident" id="3653273">q</span><span class="op" id="3653274">,</span>&nbsp;<span class="ident" id="3653276">bb</span><span class="op" id="3653278">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653283">for</span>&nbsp;<span class="ident" id="3653287">j</span>&nbsp;<span class="op" id="3653289">:=</span>&nbsp;<span class="num" id="3653292">0</span><span class="op" id="3653293">;</span>&nbsp;<span class="ident" id="3653295">j</span>&nbsp;<span class="op" id="3653297">&lt;</span>&nbsp;<span class="ident" id="3653299">ndigits</span>&nbsp;<span class="op" id="3653307">&amp;&amp;</span>&nbsp;<span class="ident" id="3653310">i</span>&nbsp;<span class="op" id="3653312">&gt;</span>&nbsp;<span class="num" id="3653314">0</span><span class="op" id="3653315">;</span>&nbsp;<span class="ident" id="3653317">j</span><span class="op" id="3653318">++</span>&nbsp;<span class="op" id="3653321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653327">i</span><span class="op" id="3653328">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653335">s</span><span class="op" id="3653336">[</span><span class="ident" id="3653337">i</span><span class="op" id="3653338">]</span>&nbsp;<span class="op" id="3653340">=</span>&nbsp;<span class="ident" id="3653342">charset</span><span class="op" id="3653349">[</span><span class="ident" id="3653350">r</span><span class="op" id="3653351">%</span><span class="ident" id="3653352">b</span><span class="op" id="3653353">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653359">r</span>&nbsp;<span class="op" id="3653361">/=</span>&nbsp;<span class="ident" id="3653364">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653369">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3653380">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653410">zero</span>&nbsp;<span class="op" id="3653415">:=</span>&nbsp;<span class="ident" id="3653418">charset</span><span class="op" id="3653425">[</span><span class="num" id="3653426">0</span><span class="op" id="3653427">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653430">for</span>&nbsp;<span class="ident" id="3653434">i</span>&nbsp;<span class="op" id="3653436">&gt;</span>&nbsp;<span class="num" id="3653438">0</span>&nbsp;<span class="op" id="3653440">{</span>&nbsp;<span class="comment" id="3653442">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653478">i</span><span class="op" id="3653479">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653484">s</span><span class="op" id="3653485">[</span><span class="ident" id="3653486">i</span><span class="op" id="3653487">]</span>&nbsp;<span class="op" id="3653489">=</span>&nbsp;<span class="ident" id="3653491">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653497">}</span><br>
<span class="lineno"></span><span class="op" id="3653499">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3653502">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3653592">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3653657">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3653737">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3653797">var</span>&nbsp;<span class="ident" id="3653801">leafSize</span>&nbsp;<span class="builtintype" id="3653810">int</span>&nbsp;<span class="op" id="3653814">=</span>&nbsp;<span class="num" id="3653816">8</span>&nbsp;<span class="comment" id="3653818">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653884">type</span>&nbsp;<span class="ident" id="3653889">divisor</span>&nbsp;<span class="keyword" id="3653897">struct</span>&nbsp;<span class="op" id="3653904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653907">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653915">nat</span>&nbsp;<span class="comment" id="3653919">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653931">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3653939">int</span>&nbsp;<span class="comment" id="3653943">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654011">ndigits</span>&nbsp;<span class="builtintype" id="3654019">int</span>&nbsp;<span class="comment" id="3654023">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3654081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3654084">var</span>&nbsp;<span class="ident" id="3654088">cacheBase10</span>&nbsp;<span class="keyword" id="3654100">struct</span>&nbsp;<span class="op" id="3654107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654110">sync</span><span class="op" id="3654114">.</span><span class="ident" id="3654115">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654122">table</span>&nbsp;<span class="op" id="3654128">[</span><span class="num" id="3654129">64</span><span class="op" id="3654131">]</span><span class="ident" id="3654132">divisor</span>&nbsp;<span class="comment" id="3654140">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3654171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3654174">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3654197">func</span>&nbsp;<span class="op" id="3654202">(</span><span class="ident" id="3654203">z</span>&nbsp;<span class="ident" id="3654205">nat</span><span class="op" id="3654208">)</span>&nbsp;<span class="ident" id="3654210">expWW</span><span class="op" id="3654215">(</span><span class="ident" id="3654216">x</span><span class="op" id="3654217">,</span>&nbsp;<span class="ident" id="3654219">y</span>&nbsp;<span class="ident" id="3654221">Word</span><span class="op" id="3654225">)</span>&nbsp;<span class="ident" id="3654227">nat</span>&nbsp;<span class="op" id="3654231">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654234">return</span>&nbsp;<span class="ident" id="3654241">z</span><span class="op" id="3654242">.</span><span class="ident" id="3654243">expNN</span><span class="op" id="3654248">(</span><span class="ident" id="3654249">nat</span><span class="op" id="3654252">(</span><span class="builtintype" id="3654253">nil</span><span class="op" id="3654256">)</span><span class="op" id="3654257">.</span><span class="ident" id="3654258">setWord</span><span class="op" id="3654265">(</span><span class="ident" id="3654266">x</span><span class="op" id="3654267">)</span><span class="op" id="3654268">,</span>&nbsp;<span class="ident" id="3654270">nat</span><span class="op" id="3654273">(</span><span class="builtintype" id="3654274">nil</span><span class="op" id="3654277">)</span><span class="op" id="3654278">.</span><span class="ident" id="3654279">setWord</span><span class="op" id="3654286">(</span><span class="ident" id="3654287">y</span><span class="op" id="3654288">)</span><span class="op" id="3654289">,</span>&nbsp;<span class="builtintype" id="3654291">nil</span><span class="op" id="3654294">)</span><br>
<span class="lineno"></span><span class="op" id="3654296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3654299">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3654366">func</span>&nbsp;<span class="ident" id="3654371">divisors</span><span class="op" id="3654379">(</span><span class="ident" id="3654380">m</span>&nbsp;<span class="builtintype" id="3654382">int</span><span class="op" id="3654385">,</span>&nbsp;<span class="ident" id="3654387">b</span>&nbsp;<span class="ident" id="3654389">Word</span><span class="op" id="3654393">,</span>&nbsp;<span class="ident" id="3654395">ndigits</span>&nbsp;<span class="builtintype" id="3654403">int</span><span class="op" id="3654406">,</span>&nbsp;<span class="ident" id="3654408">bb</span>&nbsp;<span class="ident" id="3654411">Word</span><span class="op" id="3654415">)</span>&nbsp;<span class="op" id="3654417">[</span><span class="op" id="3654418">]</span><span class="ident" id="3654419">divisor</span>&nbsp;<span class="op" id="3654427">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654430">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654505">if</span>&nbsp;<span class="ident" id="3654508">leafSize</span>&nbsp;<span class="op" id="3654517">==</span>&nbsp;<span class="num" id="3654520">0</span>&nbsp;<span class="op" id="3654522">||</span>&nbsp;<span class="ident" id="3654525">m</span>&nbsp;<span class="op" id="3654527">&lt;=</span>&nbsp;<span class="ident" id="3654530">leafSize</span>&nbsp;<span class="op" id="3654539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654543">return</span>&nbsp;<span class="builtintype" id="3654550">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3654555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654559">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654615">k</span>&nbsp;<span class="op" id="3654617">:=</span>&nbsp;<span class="num" id="3654620">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654623">for</span>&nbsp;<span class="ident" id="3654627">words</span>&nbsp;<span class="op" id="3654633">:=</span>&nbsp;<span class="ident" id="3654636">leafSize</span><span class="op" id="3654644">;</span>&nbsp;<span class="ident" id="3654646">words</span>&nbsp;<span class="op" id="3654652">&lt;</span>&nbsp;<span class="ident" id="3654654">m</span><span class="op" id="3654655">&gt;&gt;</span><span class="num" id="3654657">1</span>&nbsp;<span class="op" id="3654659">&amp;&amp;</span>&nbsp;<span class="ident" id="3654662">k</span>&nbsp;<span class="op" id="3654664">&lt;</span>&nbsp;<span class="builtinfunc" id="3654666">len</span><span class="op" id="3654669">(</span><span class="ident" id="3654670">cacheBase10</span><span class="op" id="3654681">.</span><span class="ident" id="3654682">table</span><span class="op" id="3654687">)</span><span class="op" id="3654688">;</span>&nbsp;<span class="ident" id="3654690">words</span>&nbsp;<span class="op" id="3654696">&lt;&lt;=</span>&nbsp;<span class="num" id="3654700">1</span>&nbsp;<span class="op" id="3654702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654706">k</span><span class="op" id="3654707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3654711">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654715">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654798">var</span>&nbsp;<span class="ident" id="3654802">table</span>&nbsp;<span class="op" id="3654808">[</span><span class="op" id="3654809">]</span><span class="ident" id="3654810">divisor</span>&nbsp;<span class="comment" id="3654818">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654873">if</span>&nbsp;<span class="ident" id="3654876">b</span>&nbsp;<span class="op" id="3654878">==</span>&nbsp;<span class="num" id="3654881">10</span>&nbsp;<span class="op" id="3654884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654888">cacheBase10</span><span class="op" id="3654899">.</span><span class="ident" id="3654900">Lock</span><span class="op" id="3654904">(</span><span class="op" id="3654905">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654909">table</span>&nbsp;<span class="op" id="3654915">=</span>&nbsp;<span class="ident" id="3654917">cacheBase10</span><span class="op" id="3654928">.</span><span class="ident" id="3654929">table</span><span class="op" id="3654934">[</span><span class="num" id="3654935">0</span><span class="op" id="3654936">:</span><span class="ident" id="3654937">k</span><span class="op" id="3654938">]</span>&nbsp;<span class="comment" id="3654940">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3654980">}</span>&nbsp;<span class="keyword" id="3654982">else</span>&nbsp;<span class="op" id="3654987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3654991">table</span>&nbsp;<span class="op" id="3654997">=</span>&nbsp;<span class="builtinfunc" id="3654999">make</span><span class="op" id="3655003">(</span><span class="op" id="3655004">[</span><span class="op" id="3655005">]</span><span class="ident" id="3655006">divisor</span><span class="op" id="3655013">,</span>&nbsp;<span class="ident" id="3655015">k</span><span class="op" id="3655016">)</span>&nbsp;<span class="comment" id="3655018">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655063">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655080">if</span>&nbsp;<span class="ident" id="3655083">table</span><span class="op" id="3655088">[</span><span class="ident" id="3655089">k</span><span class="op" id="3655090">-</span><span class="num" id="3655091">1</span><span class="op" id="3655092">]</span><span class="op" id="3655093">.</span><span class="ident" id="3655094">ndigits</span>&nbsp;<span class="op" id="3655102">==</span>&nbsp;<span class="num" id="3655105">0</span>&nbsp;<span class="op" id="3655107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655111">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655142">var</span>&nbsp;<span class="ident" id="3655146">larger</span>&nbsp;<span class="ident" id="3655153">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655159">for</span>&nbsp;<span class="ident" id="3655163">i</span>&nbsp;<span class="op" id="3655165">:=</span>&nbsp;<span class="num" id="3655168">0</span><span class="op" id="3655169">;</span>&nbsp;<span class="ident" id="3655171">i</span>&nbsp;<span class="op" id="3655173">&lt;</span>&nbsp;<span class="ident" id="3655175">k</span><span class="op" id="3655176">;</span>&nbsp;<span class="ident" id="3655178">i</span><span class="op" id="3655179">++</span>&nbsp;<span class="op" id="3655182">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655187">if</span>&nbsp;<span class="ident" id="3655190">table</span><span class="op" id="3655195">[</span><span class="ident" id="3655196">i</span><span class="op" id="3655197">]</span><span class="op" id="3655198">.</span><span class="ident" id="3655199">ndigits</span>&nbsp;<span class="op" id="3655207">==</span>&nbsp;<span class="num" id="3655210">0</span>&nbsp;<span class="op" id="3655212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655218">if</span>&nbsp;<span class="ident" id="3655221">i</span>&nbsp;<span class="op" id="3655223">==</span>&nbsp;<span class="num" id="3655226">0</span>&nbsp;<span class="op" id="3655228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655235">table</span><span class="op" id="3655240">[</span><span class="num" id="3655241">0</span><span class="op" id="3655242">]</span><span class="op" id="3655243">.</span><span class="ident" id="3655244">bbb</span>&nbsp;<span class="op" id="3655248">=</span>&nbsp;<span class="ident" id="3655250">nat</span><span class="op" id="3655253">(</span><span class="builtintype" id="3655254">nil</span><span class="op" id="3655257">)</span><span class="op" id="3655258">.</span><span class="ident" id="3655259">expWW</span><span class="op" id="3655264">(</span><span class="ident" id="3655265">bb</span><span class="op" id="3655267">,</span>&nbsp;<span class="ident" id="3655269">Word</span><span class="op" id="3655273">(</span><span class="ident" id="3655274">leafSize</span><span class="op" id="3655282">)</span><span class="op" id="3655283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655290">table</span><span class="op" id="3655295">[</span><span class="num" id="3655296">0</span><span class="op" id="3655297">]</span><span class="op" id="3655298">.</span><span class="ident" id="3655299">ndigits</span>&nbsp;<span class="op" id="3655307">=</span>&nbsp;<span class="ident" id="3655309">ndigits</span>&nbsp;<span class="op" id="3655317">*</span>&nbsp;<span class="ident" id="3655319">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655332">}</span>&nbsp;<span class="keyword" id="3655334">else</span>&nbsp;<span class="op" id="3655339">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655346">table</span><span class="op" id="3655351">[</span><span class="ident" id="3655352">i</span><span class="op" id="3655353">]</span><span class="op" id="3655354">.</span><span class="ident" id="3655355">bbb</span>&nbsp;<span class="op" id="3655359">=</span>&nbsp;<span class="ident" id="3655361">nat</span><span class="op" id="3655364">(</span><span class="builtintype" id="3655365">nil</span><span class="op" id="3655368">)</span><span class="op" id="3655369">.</span><span class="ident" id="3655370">mul</span><span class="op" id="3655373">(</span><span class="ident" id="3655374">table</span><span class="op" id="3655379">[</span><span class="ident" id="3655380">i</span><span class="op" id="3655381">-</span><span class="num" id="3655382">1</span><span class="op" id="3655383">]</span><span class="op" id="3655384">.</span><span class="ident" id="3655385">bbb</span><span class="op" id="3655388">,</span>&nbsp;<span class="ident" id="3655390">table</span><span class="op" id="3655395">[</span><span class="ident" id="3655396">i</span><span class="op" id="3655397">-</span><span class="num" id="3655398">1</span><span class="op" id="3655399">]</span><span class="op" id="3655400">.</span><span class="ident" id="3655401">bbb</span><span class="op" id="3655404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655411">table</span><span class="op" id="3655416">[</span><span class="ident" id="3655417">i</span><span class="op" id="3655418">]</span><span class="op" id="3655419">.</span><span class="ident" id="3655420">ndigits</span>&nbsp;<span class="op" id="3655428">=</span>&nbsp;<span class="num" id="3655430">2</span>&nbsp;<span class="op" id="3655432">*</span>&nbsp;<span class="ident" id="3655434">table</span><span class="op" id="3655439">[</span><span class="ident" id="3655440">i</span><span class="op" id="3655441">-</span><span class="num" id="3655442">1</span><span class="op" id="3655443">]</span><span class="op" id="3655444">.</span><span class="ident" id="3655445">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655464">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655531">larger</span>&nbsp;<span class="op" id="3655538">=</span>&nbsp;<span class="ident" id="3655540">nat</span><span class="op" id="3655543">(</span><span class="builtintype" id="3655544">nil</span><span class="op" id="3655547">)</span><span class="op" id="3655548">.</span><span class="ident" id="3655549">set</span><span class="op" id="3655552">(</span><span class="ident" id="3655553">table</span><span class="op" id="3655558">[</span><span class="ident" id="3655559">i</span><span class="op" id="3655560">]</span><span class="op" id="3655561">.</span><span class="ident" id="3655562">bbb</span><span class="op" id="3655565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655571">for</span>&nbsp;<span class="ident" id="3655575">mulAddVWW</span><span class="op" id="3655584">(</span><span class="ident" id="3655585">larger</span><span class="op" id="3655591">,</span>&nbsp;<span class="ident" id="3655593">larger</span><span class="op" id="3655599">,</span>&nbsp;<span class="ident" id="3655601">b</span><span class="op" id="3655602">,</span>&nbsp;<span class="num" id="3655604">0</span><span class="op" id="3655605">)</span>&nbsp;<span class="op" id="3655607">==</span>&nbsp;<span class="num" id="3655610">0</span>&nbsp;<span class="op" id="3655612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655619">table</span><span class="op" id="3655624">[</span><span class="ident" id="3655625">i</span><span class="op" id="3655626">]</span><span class="op" id="3655627">.</span><span class="ident" id="3655628">bbb</span>&nbsp;<span class="op" id="3655632">=</span>&nbsp;<span class="ident" id="3655634">table</span><span class="op" id="3655639">[</span><span class="ident" id="3655640">i</span><span class="op" id="3655641">]</span><span class="op" id="3655642">.</span><span class="ident" id="3655643">bbb</span><span class="op" id="3655646">.</span><span class="ident" id="3655647">set</span><span class="op" id="3655650">(</span><span class="ident" id="3655651">larger</span><span class="op" id="3655657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655664">table</span><span class="op" id="3655669">[</span><span class="ident" id="3655670">i</span><span class="op" id="3655671">]</span><span class="op" id="3655672">.</span><span class="ident" id="3655673">ndigits</span><span class="op" id="3655680">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655687">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655694">table</span><span class="op" id="3655699">[</span><span class="ident" id="3655700">i</span><span class="op" id="3655701">]</span><span class="op" id="3655702">.</span><span class="ident" id="3655703">nbits</span>&nbsp;<span class="op" id="3655709">=</span>&nbsp;<span class="ident" id="3655711">table</span><span class="op" id="3655716">[</span><span class="ident" id="3655717">i</span><span class="op" id="3655718">]</span><span class="op" id="3655719">.</span><span class="ident" id="3655720">bbb</span><span class="op" id="3655723">.</span><span class="ident" id="3655724">bitLen</span><span class="op" id="3655730">(</span><span class="op" id="3655731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655743">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655747">if</span>&nbsp;<span class="ident" id="3655750">b</span>&nbsp;<span class="op" id="3655752">==</span>&nbsp;<span class="num" id="3655755">10</span>&nbsp;<span class="op" id="3655758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655762">cacheBase10</span><span class="op" id="3655773">.</span><span class="ident" id="3655774">Unlock</span><span class="op" id="3655780">(</span><span class="op" id="3655781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655788">return</span>&nbsp;<span class="ident" id="3655795">table</span><br>
<span class="lineno"></span><span class="op" id="3655801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3655804">const</span>&nbsp;<span class="ident" id="3655810">deBruijn32</span>&nbsp;<span class="op" id="3655821">=</span>&nbsp;<span class="num" id="3655823">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3655835">var</span>&nbsp;<span class="ident" id="3655839">deBruijn32Lookup</span>&nbsp;<span class="op" id="3655856">=</span>&nbsp;<span class="op" id="3655858">[</span><span class="op" id="3655859">]</span><span class="builtintype" id="3655860">byte</span><span class="op" id="3655864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3655867">0</span><span class="op" id="3655868">,</span>&nbsp;<span class="num" id="3655870">1</span><span class="op" id="3655871">,</span>&nbsp;<span class="num" id="3655873">28</span><span class="op" id="3655875">,</span>&nbsp;<span class="num" id="3655877">2</span><span class="op" id="3655878">,</span>&nbsp;<span class="num" id="3655880">29</span><span class="op" id="3655882">,</span>&nbsp;<span class="num" id="3655884">14</span><span class="op" id="3655886">,</span>&nbsp;<span class="num" id="3655888">24</span><span class="op" id="3655890">,</span>&nbsp;<span class="num" id="3655892">3</span><span class="op" id="3655893">,</span>&nbsp;<span class="num" id="3655895">30</span><span class="op" id="3655897">,</span>&nbsp;<span class="num" id="3655899">22</span><span class="op" id="3655901">,</span>&nbsp;<span class="num" id="3655903">20</span><span class="op" id="3655905">,</span>&nbsp;<span class="num" id="3655907">15</span><span class="op" id="3655909">,</span>&nbsp;<span class="num" id="3655911">25</span><span class="op" id="3655913">,</span>&nbsp;<span class="num" id="3655915">17</span><span class="op" id="3655917">,</span>&nbsp;<span class="num" id="3655919">4</span><span class="op" id="3655920">,</span>&nbsp;<span class="num" id="3655922">8</span><span class="op" id="3655923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3655926">31</span><span class="op" id="3655928">,</span>&nbsp;<span class="num" id="3655930">27</span><span class="op" id="3655932">,</span>&nbsp;<span class="num" id="3655934">13</span><span class="op" id="3655936">,</span>&nbsp;<span class="num" id="3655938">23</span><span class="op" id="3655940">,</span>&nbsp;<span class="num" id="3655942">21</span><span class="op" id="3655944">,</span>&nbsp;<span class="num" id="3655946">19</span><span class="op" id="3655948">,</span>&nbsp;<span class="num" id="3655950">16</span><span class="op" id="3655952">,</span>&nbsp;<span class="num" id="3655954">7</span><span class="op" id="3655955">,</span>&nbsp;<span class="num" id="3655957">26</span><span class="op" id="3655959">,</span>&nbsp;<span class="num" id="3655961">12</span><span class="op" id="3655963">,</span>&nbsp;<span class="num" id="3655965">18</span><span class="op" id="3655967">,</span>&nbsp;<span class="num" id="3655969">6</span><span class="op" id="3655970">,</span>&nbsp;<span class="num" id="3655972">11</span><span class="op" id="3655974">,</span>&nbsp;<span class="num" id="3655976">5</span><span class="op" id="3655977">,</span>&nbsp;<span class="num" id="3655979">10</span><span class="op" id="3655981">,</span>&nbsp;<span class="num" id="3655983">9</span><span class="op" id="3655984">,</span><br>
<span class="lineno"></span><span class="op" id="3655986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3655989">const</span>&nbsp;<span class="ident" id="3655995">deBruijn64</span>&nbsp;<span class="op" id="3656006">=</span>&nbsp;<span class="num" id="3656008">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3656028">var</span>&nbsp;<span class="ident" id="3656032">deBruijn64Lookup</span>&nbsp;<span class="op" id="3656049">=</span>&nbsp;<span class="op" id="3656051">[</span><span class="op" id="3656052">]</span><span class="builtintype" id="3656053">byte</span><span class="op" id="3656057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3656060">0</span><span class="op" id="3656061">,</span>&nbsp;<span class="num" id="3656063">1</span><span class="op" id="3656064">,</span>&nbsp;<span class="num" id="3656066">56</span><span class="op" id="3656068">,</span>&nbsp;<span class="num" id="3656070">2</span><span class="op" id="3656071">,</span>&nbsp;<span class="num" id="3656073">57</span><span class="op" id="3656075">,</span>&nbsp;<span class="num" id="3656077">49</span><span class="op" id="3656079">,</span>&nbsp;<span class="num" id="3656081">28</span><span class="op" id="3656083">,</span>&nbsp;<span class="num" id="3656085">3</span><span class="op" id="3656086">,</span>&nbsp;<span class="num" id="3656088">61</span><span class="op" id="3656090">,</span>&nbsp;<span class="num" id="3656092">58</span><span class="op" id="3656094">,</span>&nbsp;<span class="num" id="3656096">42</span><span class="op" id="3656098">,</span>&nbsp;<span class="num" id="3656100">50</span><span class="op" id="3656102">,</span>&nbsp;<span class="num" id="3656104">38</span><span class="op" id="3656106">,</span>&nbsp;<span class="num" id="3656108">29</span><span class="op" id="3656110">,</span>&nbsp;<span class="num" id="3656112">17</span><span class="op" id="3656114">,</span>&nbsp;<span class="num" id="3656116">4</span><span class="op" id="3656117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3656120">62</span><span class="op" id="3656122">,</span>&nbsp;<span class="num" id="3656124">47</span><span class="op" id="3656126">,</span>&nbsp;<span class="num" id="3656128">59</span><span class="op" id="3656130">,</span>&nbsp;<span class="num" id="3656132">36</span><span class="op" id="3656134">,</span>&nbsp;<span class="num" id="3656136">45</span><span class="op" id="3656138">,</span>&nbsp;<span class="num" id="3656140">43</span><span class="op" id="3656142">,</span>&nbsp;<span class="num" id="3656144">51</span><span class="op" id="3656146">,</span>&nbsp;<span class="num" id="3656148">22</span><span class="op" id="3656150">,</span>&nbsp;<span class="num" id="3656152">53</span><span class="op" id="3656154">,</span>&nbsp;<span class="num" id="3656156">39</span><span class="op" id="3656158">,</span>&nbsp;<span class="num" id="3656160">33</span><span class="op" id="3656162">,</span>&nbsp;<span class="num" id="3656164">30</span><span class="op" id="3656166">,</span>&nbsp;<span class="num" id="3656168">24</span><span class="op" id="3656170">,</span>&nbsp;<span class="num" id="3656172">18</span><span class="op" id="3656174">,</span>&nbsp;<span class="num" id="3656176">12</span><span class="op" id="3656178">,</span>&nbsp;<span class="num" id="3656180">5</span><span class="op" id="3656181">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3656184">63</span><span class="op" id="3656186">,</span>&nbsp;<span class="num" id="3656188">55</span><span class="op" id="3656190">,</span>&nbsp;<span class="num" id="3656192">48</span><span class="op" id="3656194">,</span>&nbsp;<span class="num" id="3656196">27</span><span class="op" id="3656198">,</span>&nbsp;<span class="num" id="3656200">60</span><span class="op" id="3656202">,</span>&nbsp;<span class="num" id="3656204">41</span><span class="op" id="3656206">,</span>&nbsp;<span class="num" id="3656208">37</span><span class="op" id="3656210">,</span>&nbsp;<span class="num" id="3656212">16</span><span class="op" id="3656214">,</span>&nbsp;<span class="num" id="3656216">46</span><span class="op" id="3656218">,</span>&nbsp;<span class="num" id="3656220">35</span><span class="op" id="3656222">,</span>&nbsp;<span class="num" id="3656224">44</span><span class="op" id="3656226">,</span>&nbsp;<span class="num" id="3656228">21</span><span class="op" id="3656230">,</span>&nbsp;<span class="num" id="3656232">52</span><span class="op" id="3656234">,</span>&nbsp;<span class="num" id="3656236">32</span><span class="op" id="3656238">,</span>&nbsp;<span class="num" id="3656240">23</span><span class="op" id="3656242">,</span>&nbsp;<span class="num" id="3656244">11</span><span class="op" id="3656246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3656249">54</span><span class="op" id="3656251">,</span>&nbsp;<span class="num" id="3656253">26</span><span class="op" id="3656255">,</span>&nbsp;<span class="num" id="3656257">40</span><span class="op" id="3656259">,</span>&nbsp;<span class="num" id="3656261">15</span><span class="op" id="3656263">,</span>&nbsp;<span class="num" id="3656265">34</span><span class="op" id="3656267">,</span>&nbsp;<span class="num" id="3656269">20</span><span class="op" id="3656271">,</span>&nbsp;<span class="num" id="3656273">31</span><span class="op" id="3656275">,</span>&nbsp;<span class="num" id="3656277">10</span><span class="op" id="3656279">,</span>&nbsp;<span class="num" id="3656281">25</span><span class="op" id="3656283">,</span>&nbsp;<span class="num" id="3656285">14</span><span class="op" id="3656287">,</span>&nbsp;<span class="num" id="3656289">19</span><span class="op" id="3656291">,</span>&nbsp;<span class="num" id="3656293">9</span><span class="op" id="3656294">,</span>&nbsp;<span class="num" id="3656296">13</span><span class="op" id="3656298">,</span>&nbsp;<span class="num" id="3656300">8</span><span class="op" id="3656301">,</span>&nbsp;<span class="num" id="3656303">7</span><span class="op" id="3656304">,</span>&nbsp;<span class="num" id="3656306">6</span><span class="op" id="3656307">,</span><br>
<span class="lineno"></span><span class="op" id="3656309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3656312">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3656389">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3656403">func</span>&nbsp;<span class="ident" id="3656408">trailingZeroBits</span><span class="op" id="3656424">(</span><span class="ident" id="3656425">x</span>&nbsp;<span class="ident" id="3656427">Word</span><span class="op" id="3656431">)</span>&nbsp;<span class="builtintype" id="3656433">uint</span>&nbsp;<span class="op" id="3656438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656441">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656513">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656585">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656655">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656725">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656789">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656862">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656931">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3656978">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657015">switch</span>&nbsp;<span class="ident" id="3657022">_W</span>&nbsp;<span class="op" id="3657025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657028">case</span>&nbsp;<span class="num" id="3657033">32</span><span class="op" id="3657035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657039">return</span>&nbsp;<span class="builtintype" id="3657046">uint</span><span class="op" id="3657050">(</span><span class="ident" id="3657051">deBruijn32Lookup</span><span class="op" id="3657067">[</span><span class="op" id="3657068">(</span><span class="op" id="3657069">(</span><span class="ident" id="3657070">x</span><span class="op" id="3657071">&amp;</span><span class="op" id="3657072">-</span><span class="ident" id="3657073">x</span><span class="op" id="3657074">)</span><span class="op" id="3657075">*</span><span class="ident" id="3657076">deBruijn32</span><span class="op" id="3657086">)</span><span class="op" id="3657087">&gt;&gt;</span><span class="num" id="3657089">27</span><span class="op" id="3657091">]</span><span class="op" id="3657092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657095">case</span>&nbsp;<span class="num" id="3657100">64</span><span class="op" id="3657102">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657106">return</span>&nbsp;<span class="builtintype" id="3657113">uint</span><span class="op" id="3657117">(</span><span class="ident" id="3657118">deBruijn64Lookup</span><span class="op" id="3657134">[</span><span class="op" id="3657135">(</span><span class="op" id="3657136">(</span><span class="ident" id="3657137">x</span><span class="op" id="3657138">&amp;</span><span class="op" id="3657139">-</span><span class="ident" id="3657140">x</span><span class="op" id="3657141">)</span><span class="op" id="3657142">*</span><span class="op" id="3657143">(</span><span class="ident" id="3657144">deBruijn64</span><span class="op" id="3657154">&amp;</span><span class="ident" id="3657155">_M</span><span class="op" id="3657157">)</span><span class="op" id="3657158">)</span><span class="op" id="3657159">&gt;&gt;</span><span class="num" id="3657161">58</span><span class="op" id="3657163">]</span><span class="op" id="3657164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657167">default</span><span class="op" id="3657174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3657178">panic</span><span class="op" id="3657183">(</span><span class="string" id="3657184">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3657203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657206">}</span><br>
<span class="lineno"></span><span class="op" id="3657208">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3657211">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3657288">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3657302">func</span>&nbsp;<span class="op" id="3657307">(</span><span class="ident" id="3657308">x</span>&nbsp;<span class="ident" id="3657310">nat</span><span class="op" id="3657313">)</span>&nbsp;<span class="ident" id="3657315">trailingZeroBits</span><span class="op" id="3657331">(</span><span class="op" id="3657332">)</span>&nbsp;<span class="builtintype" id="3657334">uint</span>&nbsp;<span class="op" id="3657339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657342">if</span>&nbsp;<span class="builtinfunc" id="3657345">len</span><span class="op" id="3657348">(</span><span class="ident" id="3657349">x</span><span class="op" id="3657350">)</span>&nbsp;<span class="op" id="3657352">==</span>&nbsp;<span class="num" id="3657355">0</span>&nbsp;<span class="op" id="3657357">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657361">return</span>&nbsp;<span class="num" id="3657368">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657374">var</span>&nbsp;<span class="ident" id="3657378">i</span>&nbsp;<span class="builtintype" id="3657380">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657386">for</span>&nbsp;<span class="ident" id="3657390">x</span><span class="op" id="3657391">[</span><span class="ident" id="3657392">i</span><span class="op" id="3657393">]</span>&nbsp;<span class="op" id="3657395">==</span>&nbsp;<span class="num" id="3657398">0</span>&nbsp;<span class="op" id="3657400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657404">i</span><span class="op" id="3657405">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3657412">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657426">return</span>&nbsp;<span class="ident" id="3657433">i</span><span class="op" id="3657434">*</span><span class="ident" id="3657435">_W</span>&nbsp;<span class="op" id="3657438">+</span>&nbsp;<span class="ident" id="3657440">trailingZeroBits</span><span class="op" id="3657456">(</span><span class="ident" id="3657457">x</span><span class="op" id="3657458">[</span><span class="ident" id="3657459">i</span><span class="op" id="3657460">]</span><span class="op" id="3657461">)</span><br>
<span class="lineno"></span><span class="op" id="3657463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3657466">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3657480">func</span>&nbsp;<span class="op" id="3657485">(</span><span class="ident" id="3657486">z</span>&nbsp;<span class="ident" id="3657488">nat</span><span class="op" id="3657491">)</span>&nbsp;<span class="ident" id="3657493">shl</span><span class="op" id="3657496">(</span><span class="ident" id="3657497">x</span>&nbsp;<span class="ident" id="3657499">nat</span><span class="op" id="3657502">,</span>&nbsp;<span class="ident" id="3657504">s</span>&nbsp;<span class="builtintype" id="3657506">uint</span><span class="op" id="3657510">)</span>&nbsp;<span class="ident" id="3657512">nat</span>&nbsp;<span class="op" id="3657516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657519">m</span>&nbsp;<span class="op" id="3657521">:=</span>&nbsp;<span class="builtinfunc" id="3657524">len</span><span class="op" id="3657527">(</span><span class="ident" id="3657528">x</span><span class="op" id="3657529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657532">if</span>&nbsp;<span class="ident" id="3657535">m</span>&nbsp;<span class="op" id="3657537">==</span>&nbsp;<span class="num" id="3657540">0</span>&nbsp;<span class="op" id="3657542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657546">return</span>&nbsp;<span class="ident" id="3657553">z</span><span class="op" id="3657554">.</span><span class="builtinfunc" id="3657555">make</span><span class="op" id="3657559">(</span><span class="num" id="3657560">0</span><span class="op" id="3657561">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3657567">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657578">n</span>&nbsp;<span class="op" id="3657580">:=</span>&nbsp;<span class="ident" id="3657583">m</span>&nbsp;<span class="op" id="3657585">+</span>&nbsp;<span class="builtintype" id="3657587">int</span><span class="op" id="3657590">(</span><span class="ident" id="3657591">s</span><span class="op" id="3657592">/</span><span class="ident" id="3657593">_W</span><span class="op" id="3657595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657598">z</span>&nbsp;<span class="op" id="3657600">=</span>&nbsp;<span class="ident" id="3657602">z</span><span class="op" id="3657603">.</span><span class="builtinfunc" id="3657604">make</span><span class="op" id="3657608">(</span><span class="ident" id="3657609">n</span>&nbsp;<span class="op" id="3657611">+</span>&nbsp;<span class="num" id="3657613">1</span><span class="op" id="3657614">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657617">z</span><span class="op" id="3657618">[</span><span class="ident" id="3657619">n</span><span class="op" id="3657620">]</span>&nbsp;<span class="op" id="3657622">=</span>&nbsp;<span class="ident" id="3657624">shlVU</span><span class="op" id="3657629">(</span><span class="ident" id="3657630">z</span><span class="op" id="3657631">[</span><span class="ident" id="3657632">n</span><span class="op" id="3657633">-</span><span class="ident" id="3657634">m</span><span class="op" id="3657635">:</span><span class="ident" id="3657636">n</span><span class="op" id="3657637">]</span><span class="op" id="3657638">,</span>&nbsp;<span class="ident" id="3657640">x</span><span class="op" id="3657641">,</span>&nbsp;<span class="ident" id="3657643">s</span><span class="op" id="3657644">%</span><span class="ident" id="3657645">_W</span><span class="op" id="3657647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657650">z</span><span class="op" id="3657651">[</span><span class="num" id="3657652">0</span>&nbsp;<span class="op" id="3657654">:</span>&nbsp;<span class="ident" id="3657656">n</span><span class="op" id="3657657">-</span><span class="ident" id="3657658">m</span><span class="op" id="3657659">]</span><span class="op" id="3657660">.</span><span class="ident" id="3657661">clear</span><span class="op" id="3657666">(</span><span class="op" id="3657667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657671">return</span>&nbsp;<span class="ident" id="3657678">z</span><span class="op" id="3657679">.</span><span class="ident" id="3657680">norm</span><span class="op" id="3657684">(</span><span class="op" id="3657685">)</span><br>
<span class="lineno"></span><span class="op" id="3657687">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3657690">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3657704">func</span>&nbsp;<span class="op" id="3657709">(</span><span class="ident" id="3657710">z</span>&nbsp;<span class="ident" id="3657712">nat</span><span class="op" id="3657715">)</span>&nbsp;<span class="ident" id="3657717">shr</span><span class="op" id="3657720">(</span><span class="ident" id="3657721">x</span>&nbsp;<span class="ident" id="3657723">nat</span><span class="op" id="3657726">,</span>&nbsp;<span class="ident" id="3657728">s</span>&nbsp;<span class="builtintype" id="3657730">uint</span><span class="op" id="3657734">)</span>&nbsp;<span class="ident" id="3657736">nat</span>&nbsp;<span class="op" id="3657740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657743">m</span>&nbsp;<span class="op" id="3657745">:=</span>&nbsp;<span class="builtinfunc" id="3657748">len</span><span class="op" id="3657751">(</span><span class="ident" id="3657752">x</span><span class="op" id="3657753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657756">n</span>&nbsp;<span class="op" id="3657758">:=</span>&nbsp;<span class="ident" id="3657761">m</span>&nbsp;<span class="op" id="3657763">-</span>&nbsp;<span class="builtintype" id="3657765">int</span><span class="op" id="3657768">(</span><span class="ident" id="3657769">s</span><span class="op" id="3657770">/</span><span class="ident" id="3657771">_W</span><span class="op" id="3657773">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657776">if</span>&nbsp;<span class="ident" id="3657779">n</span>&nbsp;<span class="op" id="3657781">&lt;=</span>&nbsp;<span class="num" id="3657784">0</span>&nbsp;<span class="op" id="3657786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657790">return</span>&nbsp;<span class="ident" id="3657797">z</span><span class="op" id="3657798">.</span><span class="builtinfunc" id="3657799">make</span><span class="op" id="3657803">(</span><span class="num" id="3657804">0</span><span class="op" id="3657805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3657811">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657822">z</span>&nbsp;<span class="op" id="3657824">=</span>&nbsp;<span class="ident" id="3657826">z</span><span class="op" id="3657827">.</span><span class="builtinfunc" id="3657828">make</span><span class="op" id="3657832">(</span><span class="ident" id="3657833">n</span><span class="op" id="3657834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657837">shrVU</span><span class="op" id="3657842">(</span><span class="ident" id="3657843">z</span><span class="op" id="3657844">,</span>&nbsp;<span class="ident" id="3657846">x</span><span class="op" id="3657847">[</span><span class="ident" id="3657848">m</span><span class="op" id="3657849">-</span><span class="ident" id="3657850">n</span><span class="op" id="3657851">:</span><span class="op" id="3657852">]</span><span class="op" id="3657853">,</span>&nbsp;<span class="ident" id="3657855">s</span><span class="op" id="3657856">%</span><span class="ident" id="3657857">_W</span><span class="op" id="3657859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657863">return</span>&nbsp;<span class="ident" id="3657870">z</span><span class="op" id="3657871">.</span><span class="ident" id="3657872">norm</span><span class="op" id="3657876">(</span><span class="op" id="3657877">)</span><br>
<span class="lineno"></span><span class="op" id="3657879">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3657882">func</span>&nbsp;<span class="op" id="3657887">(</span><span class="ident" id="3657888">z</span>&nbsp;<span class="ident" id="3657890">nat</span><span class="op" id="3657893">)</span>&nbsp;<span class="ident" id="3657895">setBit</span><span class="op" id="3657901">(</span><span class="ident" id="3657902">x</span>&nbsp;<span class="ident" id="3657904">nat</span><span class="op" id="3657907">,</span>&nbsp;<span class="ident" id="3657909">i</span>&nbsp;<span class="builtintype" id="3657911">uint</span><span class="op" id="3657915">,</span>&nbsp;<span class="ident" id="3657917">b</span>&nbsp;<span class="builtintype" id="3657919">uint</span><span class="op" id="3657923">)</span>&nbsp;<span class="ident" id="3657925">nat</span>&nbsp;<span class="op" id="3657929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657932">j</span>&nbsp;<span class="op" id="3657934">:=</span>&nbsp;<span class="builtintype" id="3657937">int</span><span class="op" id="3657940">(</span><span class="ident" id="3657941">i</span>&nbsp;<span class="op" id="3657943">/</span>&nbsp;<span class="ident" id="3657945">_W</span><span class="op" id="3657947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657950">m</span>&nbsp;<span class="op" id="3657952">:=</span>&nbsp;<span class="ident" id="3657955">Word</span><span class="op" id="3657959">(</span><span class="num" id="3657960">1</span><span class="op" id="3657961">)</span>&nbsp;<span class="op" id="3657963">&lt;&lt;</span>&nbsp;<span class="op" id="3657966">(</span><span class="ident" id="3657967">i</span>&nbsp;<span class="op" id="3657969">%</span>&nbsp;<span class="ident" id="3657971">_W</span><span class="op" id="3657973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657976">n</span>&nbsp;<span class="op" id="3657978">:=</span>&nbsp;<span class="builtinfunc" id="3657981">len</span><span class="op" id="3657984">(</span><span class="ident" id="3657985">x</span><span class="op" id="3657986">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657989">switch</span>&nbsp;<span class="ident" id="3657996">b</span>&nbsp;<span class="op" id="3657998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658001">case</span>&nbsp;<span class="num" id="3658006">0</span><span class="op" id="3658007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658011">z</span>&nbsp;<span class="op" id="3658013">=</span>&nbsp;<span class="ident" id="3658015">z</span><span class="op" id="3658016">.</span><span class="builtinfunc" id="3658017">make</span><span class="op" id="3658021">(</span><span class="ident" id="3658022">n</span><span class="op" id="3658023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3658027">copy</span><span class="op" id="3658031">(</span><span class="ident" id="3658032">z</span><span class="op" id="3658033">,</span>&nbsp;<span class="ident" id="3658035">x</span><span class="op" id="3658036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658040">if</span>&nbsp;<span class="ident" id="3658043">j</span>&nbsp;<span class="op" id="3658045">&gt;=</span>&nbsp;<span class="ident" id="3658048">n</span>&nbsp;<span class="op" id="3658050">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658055">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658077">return</span>&nbsp;<span class="ident" id="3658084">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658092">z</span><span class="op" id="3658093">[</span><span class="ident" id="3658094">j</span><span class="op" id="3658095">]</span>&nbsp;<span class="op" id="3658097">&amp;^=</span>&nbsp;<span class="ident" id="3658101">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658105">return</span>&nbsp;<span class="ident" id="3658112">z</span><span class="op" id="3658113">.</span><span class="ident" id="3658114">norm</span><span class="op" id="3658118">(</span><span class="op" id="3658119">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658122">case</span>&nbsp;<span class="num" id="3658127">1</span><span class="op" id="3658128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658132">if</span>&nbsp;<span class="ident" id="3658135">j</span>&nbsp;<span class="op" id="3658137">&gt;=</span>&nbsp;<span class="ident" id="3658140">n</span>&nbsp;<span class="op" id="3658142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658147">z</span>&nbsp;<span class="op" id="3658149">=</span>&nbsp;<span class="ident" id="3658151">z</span><span class="op" id="3658152">.</span><span class="builtinfunc" id="3658153">make</span><span class="op" id="3658157">(</span><span class="ident" id="3658158">j</span>&nbsp;<span class="op" id="3658160">+</span>&nbsp;<span class="num" id="3658162">1</span><span class="op" id="3658163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658168">z</span><span class="op" id="3658169">[</span><span class="ident" id="3658170">n</span><span class="op" id="3658171">:</span><span class="op" id="3658172">]</span><span class="op" id="3658173">.</span><span class="ident" id="3658174">clear</span><span class="op" id="3658179">(</span><span class="op" id="3658180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658184">}</span>&nbsp;<span class="keyword" id="3658186">else</span>&nbsp;<span class="op" id="3658191">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658196">z</span>&nbsp;<span class="op" id="3658198">=</span>&nbsp;<span class="ident" id="3658200">z</span><span class="op" id="3658201">.</span><span class="builtinfunc" id="3658202">make</span><span class="op" id="3658206">(</span><span class="ident" id="3658207">n</span><span class="op" id="3658208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3658216">copy</span><span class="op" id="3658220">(</span><span class="ident" id="3658221">z</span><span class="op" id="3658222">,</span>&nbsp;<span class="ident" id="3658224">x</span><span class="op" id="3658225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658229">z</span><span class="op" id="3658230">[</span><span class="ident" id="3658231">j</span><span class="op" id="3658232">]</span>&nbsp;<span class="op" id="3658234">|=</span>&nbsp;<span class="ident" id="3658237">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658241">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658267">return</span>&nbsp;<span class="ident" id="3658274">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3658280">panic</span><span class="op" id="3658285">(</span><span class="string" id="3658286">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3658309">)</span><br>
<span class="lineno"></span><span class="op" id="3658311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3658314">func</span>&nbsp;<span class="op" id="3658319">(</span><span class="ident" id="3658320">z</span>&nbsp;<span class="ident" id="3658322">nat</span><span class="op" id="3658325">)</span>&nbsp;<span class="ident" id="3658327">bit</span><span class="op" id="3658330">(</span><span class="ident" id="3658331">i</span>&nbsp;<span class="builtintype" id="3658333">uint</span><span class="op" id="3658337">)</span>&nbsp;<span class="builtintype" id="3658339">uint</span>&nbsp;<span class="op" id="3658344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658347">j</span>&nbsp;<span class="op" id="3658349">:=</span>&nbsp;<span class="builtintype" id="3658352">int</span><span class="op" id="3658355">(</span><span class="ident" id="3658356">i</span>&nbsp;<span class="op" id="3658358">/</span>&nbsp;<span class="ident" id="3658360">_W</span><span class="op" id="3658362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658365">if</span>&nbsp;<span class="ident" id="3658368">j</span>&nbsp;<span class="op" id="3658370">&gt;=</span>&nbsp;<span class="builtinfunc" id="3658373">len</span><span class="op" id="3658376">(</span><span class="ident" id="3658377">z</span><span class="op" id="3658378">)</span>&nbsp;<span class="op" id="3658380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658384">return</span>&nbsp;<span class="num" id="3658391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658394">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658397">return</span>&nbsp;<span class="builtintype" id="3658404">uint</span><span class="op" id="3658408">(</span><span class="ident" id="3658409">z</span><span class="op" id="3658410">[</span><span class="ident" id="3658411">j</span><span class="op" id="3658412">]</span>&nbsp;<span class="op" id="3658414">&gt;&gt;</span>&nbsp;<span class="op" id="3658417">(</span><span class="ident" id="3658418">i</span>&nbsp;<span class="op" id="3658420">%</span>&nbsp;<span class="ident" id="3658422">_W</span><span class="op" id="3658424">)</span>&nbsp;<span class="op" id="3658426">&amp;</span>&nbsp;<span class="num" id="3658428">1</span><span class="op" id="3658429">)</span><br>
<span class="lineno"></span><span class="op" id="3658431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3658434">func</span>&nbsp;<span class="op" id="3658439">(</span><span class="ident" id="3658440">z</span>&nbsp;<span class="ident" id="3658442">nat</span><span class="op" id="3658445">)</span>&nbsp;<span class="ident" id="3658447">and</span><span class="op" id="3658450">(</span><span class="ident" id="3658451">x</span><span class="op" id="3658452">,</span>&nbsp;<span class="ident" id="3658454">y</span>&nbsp;<span class="ident" id="3658456">nat</span><span class="op" id="3658459">)</span>&nbsp;<span class="ident" id="3658461">nat</span>&nbsp;<span class="op" id="3658465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658468">m</span>&nbsp;<span class="op" id="3658470">:=</span>&nbsp;<span class="builtinfunc" id="3658473">len</span><span class="op" id="3658476">(</span><span class="ident" id="3658477">x</span><span class="op" id="3658478">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658481">n</span>&nbsp;<span class="op" id="3658483">:=</span>&nbsp;<span class="builtinfunc" id="3658486">len</span><span class="op" id="3658489">(</span><span class="ident" id="3658490">y</span><span class="op" id="3658491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658494">if</span>&nbsp;<span class="ident" id="3658497">m</span>&nbsp;<span class="op" id="3658499">&gt;</span>&nbsp;<span class="ident" id="3658501">n</span>&nbsp;<span class="op" id="3658503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658507">m</span>&nbsp;<span class="op" id="3658509">=</span>&nbsp;<span class="ident" id="3658511">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658517">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658529">z</span>&nbsp;<span class="op" id="3658531">=</span>&nbsp;<span class="ident" id="3658533">z</span><span class="op" id="3658534">.</span><span class="builtinfunc" id="3658535">make</span><span class="op" id="3658539">(</span><span class="ident" id="3658540">m</span><span class="op" id="3658541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658544">for</span>&nbsp;<span class="ident" id="3658548">i</span>&nbsp;<span class="op" id="3658550">:=</span>&nbsp;<span class="num" id="3658553">0</span><span class="op" id="3658554">;</span>&nbsp;<span class="ident" id="3658556">i</span>&nbsp;<span class="op" id="3658558">&lt;</span>&nbsp;<span class="ident" id="3658560">m</span><span class="op" id="3658561">;</span>&nbsp;<span class="ident" id="3658563">i</span><span class="op" id="3658564">++</span>&nbsp;<span class="op" id="3658567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658571">z</span><span class="op" id="3658572">[</span><span class="ident" id="3658573">i</span><span class="op" id="3658574">]</span>&nbsp;<span class="op" id="3658576">=</span>&nbsp;<span class="ident" id="3658578">x</span><span class="op" id="3658579">[</span><span class="ident" id="3658580">i</span><span class="op" id="3658581">]</span>&nbsp;<span class="op" id="3658583">&amp;</span>&nbsp;<span class="ident" id="3658585">y</span><span class="op" id="3658586">[</span><span class="ident" id="3658587">i</span><span class="op" id="3658588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658591">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658595">return</span>&nbsp;<span class="ident" id="3658602">z</span><span class="op" id="3658603">.</span><span class="ident" id="3658604">norm</span><span class="op" id="3658608">(</span><span class="op" id="3658609">)</span><br>
<span class="lineno"></span><span class="op" id="3658611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3658614">func</span>&nbsp;<span class="op" id="3658619">(</span><span class="ident" id="3658620">z</span>&nbsp;<span class="ident" id="3658622">nat</span><span class="op" id="3658625">)</span>&nbsp;<span class="ident" id="3658627">andNot</span><span class="op" id="3658633">(</span><span class="ident" id="3658634">x</span><span class="op" id="3658635">,</span>&nbsp;<span class="ident" id="3658637">y</span>&nbsp;<span class="ident" id="3658639">nat</span><span class="op" id="3658642">)</span>&nbsp;<span class="ident" id="3658644">nat</span>&nbsp;<span class="op" id="3658648">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658651">m</span>&nbsp;<span class="op" id="3658653">:=</span>&nbsp;<span class="builtinfunc" id="3658656">len</span><span class="op" id="3658659">(</span><span class="ident" id="3658660">x</span><span class="op" id="3658661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658664">n</span>&nbsp;<span class="op" id="3658666">:=</span>&nbsp;<span class="builtinfunc" id="3658669">len</span><span class="op" id="3658672">(</span><span class="ident" id="3658673">y</span><span class="op" id="3658674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658677">if</span>&nbsp;<span class="ident" id="3658680">n</span>&nbsp;<span class="op" id="3658682">&gt;</span>&nbsp;<span class="ident" id="3658684">m</span>&nbsp;<span class="op" id="3658686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658690">n</span>&nbsp;<span class="op" id="3658692">=</span>&nbsp;<span class="ident" id="3658694">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658697">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658700">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658712">z</span>&nbsp;<span class="op" id="3658714">=</span>&nbsp;<span class="ident" id="3658716">z</span><span class="op" id="3658717">.</span><span class="builtinfunc" id="3658718">make</span><span class="op" id="3658722">(</span><span class="ident" id="3658723">m</span><span class="op" id="3658724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658727">for</span>&nbsp;<span class="ident" id="3658731">i</span>&nbsp;<span class="op" id="3658733">:=</span>&nbsp;<span class="num" id="3658736">0</span><span class="op" id="3658737">;</span>&nbsp;<span class="ident" id="3658739">i</span>&nbsp;<span class="op" id="3658741">&lt;</span>&nbsp;<span class="ident" id="3658743">n</span><span class="op" id="3658744">;</span>&nbsp;<span class="ident" id="3658746">i</span><span class="op" id="3658747">++</span>&nbsp;<span class="op" id="3658750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658754">z</span><span class="op" id="3658755">[</span><span class="ident" id="3658756">i</span><span class="op" id="3658757">]</span>&nbsp;<span class="op" id="3658759">=</span>&nbsp;<span class="ident" id="3658761">x</span><span class="op" id="3658762">[</span><span class="ident" id="3658763">i</span><span class="op" id="3658764">]</span>&nbsp;<span class="op" id="3658766">&amp;^</span>&nbsp;<span class="ident" id="3658769">y</span><span class="op" id="3658770">[</span><span class="ident" id="3658771">i</span><span class="op" id="3658772">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3658778">copy</span><span class="op" id="3658782">(</span><span class="ident" id="3658783">z</span><span class="op" id="3658784">[</span><span class="ident" id="3658785">n</span><span class="op" id="3658786">:</span><span class="ident" id="3658787">m</span><span class="op" id="3658788">]</span><span class="op" id="3658789">,</span>&nbsp;<span class="ident" id="3658791">x</span><span class="op" id="3658792">[</span><span class="ident" id="3658793">n</span><span class="op" id="3658794">:</span><span class="ident" id="3658795">m</span><span class="op" id="3658796">]</span><span class="op" id="3658797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658801">return</span>&nbsp;<span class="ident" id="3658808">z</span><span class="op" id="3658809">.</span><span class="ident" id="3658810">norm</span><span class="op" id="3658814">(</span><span class="op" id="3658815">)</span><br>
<span class="lineno"></span><span class="op" id="3658817">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3658820">func</span>&nbsp;<span class="op" id="3658825">(</span><span class="ident" id="3658826">z</span>&nbsp;<span class="ident" id="3658828">nat</span><span class="op" id="3658831">)</span>&nbsp;<span class="ident" id="3658833">or</span><span class="op" id="3658835">(</span><span class="ident" id="3658836">x</span><span class="op" id="3658837">,</span>&nbsp;<span class="ident" id="3658839">y</span>&nbsp;<span class="ident" id="3658841">nat</span><span class="op" id="3658844">)</span>&nbsp;<span class="ident" id="3658846">nat</span>&nbsp;<span class="op" id="3658850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658853">m</span>&nbsp;<span class="op" id="3658855">:=</span>&nbsp;<span class="builtinfunc" id="3658858">len</span><span class="op" id="3658861">(</span><span class="ident" id="3658862">x</span><span class="op" id="3658863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658866">n</span>&nbsp;<span class="op" id="3658868">:=</span>&nbsp;<span class="builtinfunc" id="3658871">len</span><span class="op" id="3658874">(</span><span class="ident" id="3658875">y</span><span class="op" id="3658876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658879">s</span>&nbsp;<span class="op" id="3658881">:=</span>&nbsp;<span class="ident" id="3658884">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658887">if</span>&nbsp;<span class="ident" id="3658890">m</span>&nbsp;<span class="op" id="3658892">&lt;</span>&nbsp;<span class="ident" id="3658894">n</span>&nbsp;<span class="op" id="3658896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658900">n</span><span class="op" id="3658901">,</span>&nbsp;<span class="ident" id="3658903">m</span>&nbsp;<span class="op" id="3658905">=</span>&nbsp;<span class="ident" id="3658907">m</span><span class="op" id="3658908">,</span>&nbsp;<span class="ident" id="3658910">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658914">s</span>&nbsp;<span class="op" id="3658916">=</span>&nbsp;<span class="ident" id="3658918">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658924">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658936">z</span>&nbsp;<span class="op" id="3658938">=</span>&nbsp;<span class="ident" id="3658940">z</span><span class="op" id="3658941">.</span><span class="builtinfunc" id="3658942">make</span><span class="op" id="3658946">(</span><span class="ident" id="3658947">m</span><span class="op" id="3658948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658951">for</span>&nbsp;<span class="ident" id="3658955">i</span>&nbsp;<span class="op" id="3658957">:=</span>&nbsp;<span class="num" id="3658960">0</span><span class="op" id="3658961">;</span>&nbsp;<span class="ident" id="3658963">i</span>&nbsp;<span class="op" id="3658965">&lt;</span>&nbsp;<span class="ident" id="3658967">n</span><span class="op" id="3658968">;</span>&nbsp;<span class="ident" id="3658970">i</span><span class="op" id="3658971">++</span>&nbsp;<span class="op" id="3658974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658978">z</span><span class="op" id="3658979">[</span><span class="ident" id="3658980">i</span><span class="op" id="3658981">]</span>&nbsp;<span class="op" id="3658983">=</span>&nbsp;<span class="ident" id="3658985">x</span><span class="op" id="3658986">[</span><span class="ident" id="3658987">i</span><span class="op" id="3658988">]</span>&nbsp;<span class="op" id="3658990">|</span>&nbsp;<span class="ident" id="3658992">y</span><span class="op" id="3658993">[</span><span class="ident" id="3658994">i</span><span class="op" id="3658995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658998">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3659001">copy</span><span class="op" id="3659005">(</span><span class="ident" id="3659006">z</span><span class="op" id="3659007">[</span><span class="ident" id="3659008">n</span><span class="op" id="3659009">:</span><span class="ident" id="3659010">m</span><span class="op" id="3659011">]</span><span class="op" id="3659012">,</span>&nbsp;<span class="ident" id="3659014">s</span><span class="op" id="3659015">[</span><span class="ident" id="3659016">n</span><span class="op" id="3659017">:</span><span class="ident" id="3659018">m</span><span class="op" id="3659019">]</span><span class="op" id="3659020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659024">return</span>&nbsp;<span class="ident" id="3659031">z</span><span class="op" id="3659032">.</span><span class="ident" id="3659033">norm</span><span class="op" id="3659037">(</span><span class="op" id="3659038">)</span><br>
<span class="lineno"></span><span class="op" id="3659040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3659043">func</span>&nbsp;<span class="op" id="3659048">(</span><span class="ident" id="3659049">z</span>&nbsp;<span class="ident" id="3659051">nat</span><span class="op" id="3659054">)</span>&nbsp;<span class="ident" id="3659056">xor</span><span class="op" id="3659059">(</span><span class="ident" id="3659060">x</span><span class="op" id="3659061">,</span>&nbsp;<span class="ident" id="3659063">y</span>&nbsp;<span class="ident" id="3659065">nat</span><span class="op" id="3659068">)</span>&nbsp;<span class="ident" id="3659070">nat</span>&nbsp;<span class="op" id="3659074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659077">m</span>&nbsp;<span class="op" id="3659079">:=</span>&nbsp;<span class="builtinfunc" id="3659082">len</span><span class="op" id="3659085">(</span><span class="ident" id="3659086">x</span><span class="op" id="3659087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659090">n</span>&nbsp;<span class="op" id="3659092">:=</span>&nbsp;<span class="builtinfunc" id="3659095">len</span><span class="op" id="3659098">(</span><span class="ident" id="3659099">y</span><span class="op" id="3659100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659103">s</span>&nbsp;<span class="op" id="3659105">:=</span>&nbsp;<span class="ident" id="3659108">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659111">if</span>&nbsp;<span class="ident" id="3659114">m</span>&nbsp;<span class="op" id="3659116">&lt;</span>&nbsp;<span class="ident" id="3659118">n</span>&nbsp;<span class="op" id="3659120">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659124">n</span><span class="op" id="3659125">,</span>&nbsp;<span class="ident" id="3659127">m</span>&nbsp;<span class="op" id="3659129">=</span>&nbsp;<span class="ident" id="3659131">m</span><span class="op" id="3659132">,</span>&nbsp;<span class="ident" id="3659134">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659138">s</span>&nbsp;<span class="op" id="3659140">=</span>&nbsp;<span class="ident" id="3659142">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3659145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3659148">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659160">z</span>&nbsp;<span class="op" id="3659162">=</span>&nbsp;<span class="ident" id="3659164">z</span><span class="op" id="3659165">.</span><span class="builtinfunc" id="3659166">make</span><span class="op" id="3659170">(</span><span class="ident" id="3659171">m</span><span class="op" id="3659172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659175">for</span>&nbsp;<span class="ident" id="3659179">i</span>&nbsp;<span class="op" id="3659181">:=</span>&nbsp;<span class="num" id="3659184">0</span><span class="op" id="3659185">;</span>&nbsp;<span class="ident" id="3659187">i</span>&nbsp;<span class="op" id="3659189">&lt;</span>&nbsp;<span class="ident" id="3659191">n</span><span class="op" id="3659192">;</span>&nbsp;<span class="ident" id="3659194">i</span><span class="op" id="3659195">++</span>&nbsp;<span class="op" id="3659198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659202">z</span><span class="op" id="3659203">[</span><span class="ident" id="3659204">i</span><span class="op" id="3659205">]</span>&nbsp;<span class="op" id="3659207">=</span>&nbsp;<span class="ident" id="3659209">x</span><span class="op" id="3659210">[</span><span class="ident" id="3659211">i</span><span class="op" id="3659212">]</span>&nbsp;<span class="op" id="3659214">^</span>&nbsp;<span class="ident" id="3659216">y</span><span class="op" id="3659217">[</span><span class="ident" id="3659218">i</span><span class="op" id="3659219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3659222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3659225">copy</span><span class="op" id="3659229">(</span><span class="ident" id="3659230">z</span><span class="op" id="3659231">[</span><span class="ident" id="3659232">n</span><span class="op" id="3659233">:</span><span class="ident" id="3659234">m</span><span class="op" id="3659235">]</span><span class="op" id="3659236">,</span>&nbsp;<span class="ident" id="3659238">s</span><span class="op" id="3659239">[</span><span class="ident" id="3659240">n</span><span class="op" id="3659241">:</span><span class="ident" id="3659242">m</span><span class="op" id="3659243">]</span><span class="op" id="3659244">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659248">return</span>&nbsp;<span class="ident" id="3659255">z</span><span class="op" id="3659256">.</span><span class="ident" id="3659257">norm</span><span class="op" id="3659261">(</span><span class="op" id="3659262">)</span><br>
<span class="lineno"></span><span class="op" id="3659264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659267">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3659329">func</span>&nbsp;<span class="ident" id="3659334">greaterThan</span><span class="op" id="3659345">(</span><span class="ident" id="3659346">x1</span><span class="op" id="3659348">,</span>&nbsp;<span class="ident" id="3659350">x2</span><span class="op" id="3659352">,</span>&nbsp;<span class="ident" id="3659354">y1</span><span class="op" id="3659356">,</span>&nbsp;<span class="ident" id="3659358">y2</span>&nbsp;<span class="ident" id="3659361">Word</span><span class="op" id="3659365">)</span>&nbsp;<span class="builtintype" id="3659367">bool</span>&nbsp;<span class="op" id="3659372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659375">return</span>&nbsp;<span class="ident" id="3659382">x1</span>&nbsp;<span class="op" id="3659385">&gt;</span>&nbsp;<span class="ident" id="3659387">y1</span>&nbsp;<span class="op" id="3659390">||</span>&nbsp;<span class="ident" id="3659393">x1</span>&nbsp;<span class="op" id="3659396">==</span>&nbsp;<span class="ident" id="3659399">y1</span>&nbsp;<span class="op" id="3659402">&amp;&amp;</span>&nbsp;<span class="ident" id="3659405">x2</span>&nbsp;<span class="op" id="3659408">&gt;</span>&nbsp;<span class="ident" id="3659410">y2</span><br>
<span class="lineno"></span><span class="op" id="3659413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659416">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3659439">func</span>&nbsp;<span class="op" id="3659444">(</span><span class="ident" id="3659445">x</span>&nbsp;<span class="ident" id="3659447">nat</span><span class="op" id="3659450">)</span>&nbsp;<span class="ident" id="3659452">modW</span><span class="op" id="3659456">(</span><span class="ident" id="3659457">d</span>&nbsp;<span class="ident" id="3659459">Word</span><span class="op" id="3659463">)</span>&nbsp;<span class="op" id="3659465">(</span><span class="ident" id="3659466">r</span>&nbsp;<span class="ident" id="3659468">Word</span><span class="op" id="3659472">)</span>&nbsp;<span class="op" id="3659474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3659477">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659537">var</span>&nbsp;<span class="ident" id="3659541">q</span>&nbsp;<span class="ident" id="3659543">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659548">q</span>&nbsp;<span class="op" id="3659550">=</span>&nbsp;<span class="ident" id="3659552">q</span><span class="op" id="3659553">.</span><span class="builtinfunc" id="3659554">make</span><span class="op" id="3659558">(</span><span class="builtinfunc" id="3659559">len</span><span class="op" id="3659562">(</span><span class="ident" id="3659563">x</span><span class="op" id="3659564">)</span><span class="op" id="3659565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659568">return</span>&nbsp;<span class="ident" id="3659575">divWVW</span><span class="op" id="3659581">(</span><span class="ident" id="3659582">q</span><span class="op" id="3659583">,</span>&nbsp;<span class="num" id="3659585">0</span><span class="op" id="3659586">,</span>&nbsp;<span class="ident" id="3659588">x</span><span class="op" id="3659589">,</span>&nbsp;<span class="ident" id="3659591">d</span><span class="op" id="3659592">)</span><br>
<span class="lineno">1190</span><span class="op" id="3659594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659597">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3659671">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3659714">func</span>&nbsp;<span class="op" id="3659719">(</span><span class="ident" id="3659720">z</span>&nbsp;<span class="ident" id="3659722">nat</span><span class="op" id="3659725">)</span>&nbsp;<span class="ident" id="3659727">random</span><span class="op" id="3659733">(</span><span class="ident" id="3659734">rand</span>&nbsp;<span class="op" id="3659739">*</span><span class="ident" id="3659740">rand</span><span class="op" id="3659744">.</span><span class="ident" id="3659745">Rand</span><span class="op" id="3659749">,</span>&nbsp;<span class="ident" id="3659751">limit</span>&nbsp;<span class="ident" id="3659757">nat</span><span class="op" id="3659760">,</span>&nbsp;<span class="ident" id="3659762">n</span>&nbsp;<span class="builtintype" id="3659764">int</span><span class="op" id="3659767">)</span>&nbsp;<span class="ident" id="3659769">nat</span>&nbsp;<span class="op" id="3659773">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659776">if</span>&nbsp;<span class="ident" id="3659779">alias</span><span class="op" id="3659784">(</span><span class="ident" id="3659785">z</span><span class="op" id="3659786">,</span>&nbsp;<span class="ident" id="3659788">limit</span><span class="op" id="3659793">)</span>&nbsp;<span class="op" id="3659795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659799">z</span>&nbsp;<span class="op" id="3659801">=</span>&nbsp;<span class="builtintype" id="3659803">nil</span>&nbsp;<span class="comment" id="3659807">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3659850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659853">z</span>&nbsp;<span class="op" id="3659855">=</span>&nbsp;<span class="ident" id="3659857">z</span><span class="op" id="3659858">.</span><span class="builtinfunc" id="3659859">make</span><span class="op" id="3659863">(</span><span class="builtinfunc" id="3659864">len</span><span class="op" id="3659867">(</span><span class="ident" id="3659868">limit</span><span class="op" id="3659873">)</span><span class="op" id="3659874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659878">bitLengthOfMSW</span>&nbsp;<span class="op" id="3659893">:=</span>&nbsp;<span class="builtintype" id="3659896">uint</span><span class="op" id="3659900">(</span><span class="ident" id="3659901">n</span>&nbsp;<span class="op" id="3659903">%</span>&nbsp;<span class="ident" id="3659905">_W</span><span class="op" id="3659907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659910">if</span>&nbsp;<span class="ident" id="3659913">bitLengthOfMSW</span>&nbsp;<span class="op" id="3659928">==</span>&nbsp;<span class="num" id="3659931">0</span>&nbsp;<span class="op" id="3659933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659937">bitLengthOfMSW</span>&nbsp;<span class="op" id="3659952">=</span>&nbsp;<span class="ident" id="3659954">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3659958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659961">mask</span>&nbsp;<span class="op" id="3659966">:=</span>&nbsp;<span class="ident" id="3659969">Word</span><span class="op" id="3659973">(</span><span class="op" id="3659974">(</span><span class="num" id="3659975">1</span>&nbsp;<span class="op" id="3659977">&lt;&lt;</span>&nbsp;<span class="ident" id="3659980">bitLengthOfMSW</span><span class="op" id="3659994">)</span>&nbsp;<span class="op" id="3659996">-</span>&nbsp;<span class="num" id="3659998">1</span><span class="op" id="3659999">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660003">for</span>&nbsp;<span class="op" id="3660007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660011">switch</span>&nbsp;<span class="ident" id="3660018">_W</span>&nbsp;<span class="op" id="3660021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660025">case</span>&nbsp;<span class="num" id="3660030">32</span><span class="op" id="3660032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660037">for</span>&nbsp;<span class="ident" id="3660041">i</span>&nbsp;<span class="op" id="3660043">:=</span>&nbsp;<span class="keyword" id="3660046">range</span>&nbsp;<span class="ident" id="3660052">z</span>&nbsp;<span class="op" id="3660054">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660060">z</span><span class="op" id="3660061">[</span><span class="ident" id="3660062">i</span><span class="op" id="3660063">]</span>&nbsp;<span class="op" id="3660065">=</span>&nbsp;<span class="ident" id="3660067">Word</span><span class="op" id="3660071">(</span><span class="ident" id="3660072">rand</span><span class="op" id="3660076">.</span><span class="ident" id="3660077">Uint32</span><span class="op" id="3660083">(</span><span class="op" id="3660084">)</span><span class="op" id="3660085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660094">case</span>&nbsp;<span class="num" id="3660099">64</span><span class="op" id="3660101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660106">for</span>&nbsp;<span class="ident" id="3660110">i</span>&nbsp;<span class="op" id="3660112">:=</span>&nbsp;<span class="keyword" id="3660115">range</span>&nbsp;<span class="ident" id="3660121">z</span>&nbsp;<span class="op" id="3660123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660129">z</span><span class="op" id="3660130">[</span><span class="ident" id="3660131">i</span><span class="op" id="3660132">]</span>&nbsp;<span class="op" id="3660134">=</span>&nbsp;<span class="ident" id="3660136">Word</span><span class="op" id="3660140">(</span><span class="ident" id="3660141">rand</span><span class="op" id="3660145">.</span><span class="ident" id="3660146">Uint32</span><span class="op" id="3660152">(</span><span class="op" id="3660153">)</span><span class="op" id="3660154">)</span>&nbsp;<span class="op" id="3660156">|</span>&nbsp;<span class="ident" id="3660158">Word</span><span class="op" id="3660162">(</span><span class="ident" id="3660163">rand</span><span class="op" id="3660167">.</span><span class="ident" id="3660168">Uint32</span><span class="op" id="3660174">(</span><span class="op" id="3660175">)</span><span class="op" id="3660176">)</span><span class="op" id="3660177">&lt;&lt;</span><span class="num" id="3660179">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660189">default</span><span class="op" id="3660196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3660201">panic</span><span class="op" id="3660206">(</span><span class="string" id="3660207">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3660226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660234">z</span><span class="op" id="3660235">[</span><span class="builtinfunc" id="3660236">len</span><span class="op" id="3660239">(</span><span class="ident" id="3660240">limit</span><span class="op" id="3660245">)</span><span class="op" id="3660246">-</span><span class="num" id="3660247">1</span><span class="op" id="3660248">]</span>&nbsp;<span class="op" id="3660250">&amp;=</span>&nbsp;<span class="ident" id="3660253">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660260">if</span>&nbsp;<span class="ident" id="3660263">z</span><span class="op" id="3660264">.</span><span class="ident" id="3660265">cmp</span><span class="op" id="3660268">(</span><span class="ident" id="3660269">limit</span><span class="op" id="3660274">)</span>&nbsp;<span class="op" id="3660276">&lt;</span>&nbsp;<span class="num" id="3660278">0</span>&nbsp;<span class="op" id="3660280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660285">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660300">return</span>&nbsp;<span class="ident" id="3660307">z</span><span class="op" id="3660308">.</span><span class="ident" id="3660309">norm</span><span class="op" id="3660313">(</span><span class="op" id="3660314">)</span><br>
<span class="lineno"></span><span class="op" id="3660316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3660319">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3660381">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3660443">func</span>&nbsp;<span class="op" id="3660448">(</span><span class="ident" id="3660449">z</span>&nbsp;<span class="ident" id="3660451">nat</span><span class="op" id="3660454">)</span>&nbsp;<span class="ident" id="3660456">expNN</span><span class="op" id="3660461">(</span><span class="ident" id="3660462">x</span><span class="op" id="3660463">,</span>&nbsp;<span class="ident" id="3660465">y</span><span class="op" id="3660466">,</span>&nbsp;<span class="ident" id="3660468">m</span>&nbsp;<span class="ident" id="3660470">nat</span><span class="op" id="3660473">)</span>&nbsp;<span class="ident" id="3660475">nat</span>&nbsp;<span class="op" id="3660479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660482">if</span>&nbsp;<span class="ident" id="3660485">alias</span><span class="op" id="3660490">(</span><span class="ident" id="3660491">z</span><span class="op" id="3660492">,</span>&nbsp;<span class="ident" id="3660494">x</span><span class="op" id="3660495">)</span>&nbsp;<span class="op" id="3660497">||</span>&nbsp;<span class="ident" id="3660500">alias</span><span class="op" id="3660505">(</span><span class="ident" id="3660506">z</span><span class="op" id="3660507">,</span>&nbsp;<span class="ident" id="3660509">y</span><span class="op" id="3660510">)</span>&nbsp;<span class="op" id="3660512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660516">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660570">z</span>&nbsp;<span class="op" id="3660572">=</span>&nbsp;<span class="builtintype" id="3660574">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660579">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660583">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660603">if</span>&nbsp;<span class="builtinfunc" id="3660606">len</span><span class="op" id="3660609">(</span><span class="ident" id="3660610">m</span><span class="op" id="3660611">)</span>&nbsp;<span class="op" id="3660613">==</span>&nbsp;<span class="num" id="3660616">1</span>&nbsp;<span class="op" id="3660618">&amp;&amp;</span>&nbsp;<span class="ident" id="3660621">m</span><span class="op" id="3660622">[</span><span class="num" id="3660623">0</span><span class="op" id="3660624">]</span>&nbsp;<span class="op" id="3660626">==</span>&nbsp;<span class="num" id="3660629">1</span>&nbsp;<span class="op" id="3660631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660635">return</span>&nbsp;<span class="ident" id="3660642">z</span><span class="op" id="3660643">.</span><span class="ident" id="3660644">setWord</span><span class="op" id="3660651">(</span><span class="num" id="3660652">0</span><span class="op" id="3660653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660656">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660659">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660680">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660694">if</span>&nbsp;<span class="builtinfunc" id="3660697">len</span><span class="op" id="3660700">(</span><span class="ident" id="3660701">y</span><span class="op" id="3660702">)</span>&nbsp;<span class="op" id="3660704">==</span>&nbsp;<span class="num" id="3660707">0</span>&nbsp;<span class="op" id="3660709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660713">return</span>&nbsp;<span class="ident" id="3660720">z</span><span class="op" id="3660721">.</span><span class="ident" id="3660722">setWord</span><span class="op" id="3660729">(</span><span class="num" id="3660730">1</span><span class="op" id="3660731">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660737">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660748">if</span>&nbsp;<span class="builtinfunc" id="3660751">len</span><span class="op" id="3660754">(</span><span class="ident" id="3660755">m</span><span class="op" id="3660756">)</span>&nbsp;<span class="op" id="3660758">!=</span>&nbsp;<span class="num" id="3660761">0</span>&nbsp;<span class="op" id="3660763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660767">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660819">z</span>&nbsp;<span class="op" id="3660821">=</span>&nbsp;<span class="ident" id="3660823">z</span><span class="op" id="3660824">.</span><span class="builtinfunc" id="3660825">make</span><span class="op" id="3660829">(</span><span class="builtinfunc" id="3660830">len</span><span class="op" id="3660833">(</span><span class="ident" id="3660834">m</span><span class="op" id="3660835">)</span><span class="op" id="3660836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660842">z</span>&nbsp;<span class="op" id="3660844">=</span>&nbsp;<span class="ident" id="3660846">z</span><span class="op" id="3660847">.</span><span class="ident" id="3660848">set</span><span class="op" id="3660851">(</span><span class="ident" id="3660852">x</span><span class="op" id="3660853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660857">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660922">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660995">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661065">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661131">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661147">if</span>&nbsp;<span class="builtinfunc" id="3661150">len</span><span class="op" id="3661153">(</span><span class="ident" id="3661154">x</span><span class="op" id="3661155">)</span>&nbsp;<span class="op" id="3661157">&gt;</span>&nbsp;<span class="num" id="3661159">1</span>&nbsp;<span class="op" id="3661161">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3661164">len</span><span class="op" id="3661167">(</span><span class="ident" id="3661168">y</span><span class="op" id="3661169">)</span>&nbsp;<span class="op" id="3661171">&gt;</span>&nbsp;<span class="num" id="3661173">1</span>&nbsp;<span class="op" id="3661175">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3661178">len</span><span class="op" id="3661181">(</span><span class="ident" id="3661182">m</span><span class="op" id="3661183">)</span>&nbsp;<span class="op" id="3661185">&gt;</span>&nbsp;<span class="num" id="3661187">0</span>&nbsp;<span class="op" id="3661189">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661193">return</span>&nbsp;<span class="ident" id="3661200">z</span><span class="op" id="3661201">.</span><span class="ident" id="3661202">expNNWindowed</span><span class="op" id="3661215">(</span><span class="ident" id="3661216">x</span><span class="op" id="3661217">,</span>&nbsp;<span class="ident" id="3661219">y</span><span class="op" id="3661220">,</span>&nbsp;<span class="ident" id="3661222">m</span><span class="op" id="3661223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661230">v</span>&nbsp;<span class="op" id="3661232">:=</span>&nbsp;<span class="ident" id="3661235">y</span><span class="op" id="3661236">[</span><span class="builtinfunc" id="3661237">len</span><span class="op" id="3661240">(</span><span class="ident" id="3661241">y</span><span class="op" id="3661242">)</span><span class="op" id="3661243">-</span><span class="num" id="3661244">1</span><span class="op" id="3661245">]</span>&nbsp;<span class="comment" id="3661247">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661291">shift</span>&nbsp;<span class="op" id="3661297">:=</span>&nbsp;<span class="ident" id="3661300">leadingZeros</span><span class="op" id="3661312">(</span><span class="ident" id="3661313">v</span><span class="op" id="3661314">)</span>&nbsp;<span class="op" id="3661316">+</span>&nbsp;<span class="num" id="3661318">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661321">v</span>&nbsp;<span class="op" id="3661323">&lt;&lt;=</span>&nbsp;<span class="ident" id="3661327">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661334">var</span>&nbsp;<span class="ident" id="3661338">q</span>&nbsp;<span class="ident" id="3661340">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661346">const</span>&nbsp;<span class="ident" id="3661352">mask</span>&nbsp;<span class="op" id="3661357">=</span>&nbsp;<span class="num" id="3661359">1</span>&nbsp;<span class="op" id="3661361">&lt;&lt;</span>&nbsp;<span class="op" id="3661364">(</span><span class="ident" id="3661365">_W</span>&nbsp;<span class="op" id="3661368">-</span>&nbsp;<span class="num" id="3661370">1</span><span class="op" id="3661371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661375">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661445">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661517">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661575">w</span>&nbsp;<span class="op" id="3661577">:=</span>&nbsp;<span class="ident" id="3661580">_W</span>&nbsp;<span class="op" id="3661583">-</span>&nbsp;<span class="builtintype" id="3661585">int</span><span class="op" id="3661588">(</span><span class="ident" id="3661589">shift</span><span class="op" id="3661594">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661597">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661657">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661698">var</span>&nbsp;<span class="ident" id="3661702">zz</span><span class="op" id="3661704">,</span>&nbsp;<span class="ident" id="3661706">r</span>&nbsp;<span class="ident" id="3661708">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661713">for</span>&nbsp;<span class="ident" id="3661717">j</span>&nbsp;<span class="op" id="3661719">:=</span>&nbsp;<span class="num" id="3661722">0</span><span class="op" id="3661723">;</span>&nbsp;<span class="ident" id="3661725">j</span>&nbsp;<span class="op" id="3661727">&lt;</span>&nbsp;<span class="ident" id="3661729">w</span><span class="op" id="3661730">;</span>&nbsp;<span class="ident" id="3661732">j</span><span class="op" id="3661733">++</span>&nbsp;<span class="op" id="3661736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661740">zz</span>&nbsp;<span class="op" id="3661743">=</span>&nbsp;<span class="ident" id="3661745">zz</span><span class="op" id="3661747">.</span><span class="ident" id="3661748">mul</span><span class="op" id="3661751">(</span><span class="ident" id="3661752">z</span><span class="op" id="3661753">,</span>&nbsp;<span class="ident" id="3661755">z</span><span class="op" id="3661756">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661760">zz</span><span class="op" id="3661762">,</span>&nbsp;<span class="ident" id="3661764">z</span>&nbsp;<span class="op" id="3661766">=</span>&nbsp;<span class="ident" id="3661768">z</span><span class="op" id="3661769">,</span>&nbsp;<span class="ident" id="3661771">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661777">if</span>&nbsp;<span class="ident" id="3661780">v</span><span class="op" id="3661781">&amp;</span><span class="ident" id="3661782">mask</span>&nbsp;<span class="op" id="3661787">!=</span>&nbsp;<span class="num" id="3661790">0</span>&nbsp;<span class="op" id="3661792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661797">zz</span>&nbsp;<span class="op" id="3661800">=</span>&nbsp;<span class="ident" id="3661802">zz</span><span class="op" id="3661804">.</span><span class="ident" id="3661805">mul</span><span class="op" id="3661808">(</span><span class="ident" id="3661809">z</span><span class="op" id="3661810">,</span>&nbsp;<span class="ident" id="3661812">x</span><span class="op" id="3661813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661818">zz</span><span class="op" id="3661820">,</span>&nbsp;<span class="ident" id="3661822">z</span>&nbsp;<span class="op" id="3661824">=</span>&nbsp;<span class="ident" id="3661826">z</span><span class="op" id="3661827">,</span>&nbsp;<span class="ident" id="3661829">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661839">if</span>&nbsp;<span class="builtinfunc" id="3661842">len</span><span class="op" id="3661845">(</span><span class="ident" id="3661846">m</span><span class="op" id="3661847">)</span>&nbsp;<span class="op" id="3661849">!=</span>&nbsp;<span class="num" id="3661852">0</span>&nbsp;<span class="op" id="3661854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661859">zz</span><span class="op" id="3661861">,</span>&nbsp;<span class="ident" id="3661863">r</span>&nbsp;<span class="op" id="3661865">=</span>&nbsp;<span class="ident" id="3661867">zz</span><span class="op" id="3661869">.</span><span class="ident" id="3661870">div</span><span class="op" id="3661873">(</span><span class="ident" id="3661874">r</span><span class="op" id="3661875">,</span>&nbsp;<span class="ident" id="3661877">z</span><span class="op" id="3661878">,</span>&nbsp;<span class="ident" id="3661880">m</span><span class="op" id="3661881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661886">zz</span><span class="op" id="3661888">,</span>&nbsp;<span class="ident" id="3661890">r</span><span class="op" id="3661891">,</span>&nbsp;<span class="ident" id="3661893">q</span><span class="op" id="3661894">,</span>&nbsp;<span class="ident" id="3661896">z</span>&nbsp;<span class="op" id="3661898">=</span>&nbsp;<span class="ident" id="3661900">q</span><span class="op" id="3661901">,</span>&nbsp;<span class="ident" id="3661903">z</span><span class="op" id="3661904">,</span>&nbsp;<span class="ident" id="3661906">zz</span><span class="op" id="3661908">,</span>&nbsp;<span class="ident" id="3661910">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661919">v</span>&nbsp;<span class="op" id="3661921">&lt;&lt;=</span>&nbsp;<span class="num" id="3661925">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661932">for</span>&nbsp;<span class="ident" id="3661936">i</span>&nbsp;<span class="op" id="3661938">:=</span>&nbsp;<span class="builtinfunc" id="3661941">len</span><span class="op" id="3661944">(</span><span class="ident" id="3661945">y</span><span class="op" id="3661946">)</span>&nbsp;<span class="op" id="3661948">-</span>&nbsp;<span class="num" id="3661950">2</span><span class="op" id="3661951">;</span>&nbsp;<span class="ident" id="3661953">i</span>&nbsp;<span class="op" id="3661955">&gt;=</span>&nbsp;<span class="num" id="3661958">0</span><span class="op" id="3661959">;</span>&nbsp;<span class="ident" id="3661961">i</span><span class="op" id="3661962">--</span>&nbsp;<span class="op" id="3661965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661969">v</span>&nbsp;<span class="op" id="3661971">=</span>&nbsp;<span class="ident" id="3661973">y</span><span class="op" id="3661974">[</span><span class="ident" id="3661975">i</span><span class="op" id="3661976">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661981">for</span>&nbsp;<span class="ident" id="3661985">j</span>&nbsp;<span class="op" id="3661987">:=</span>&nbsp;<span class="num" id="3661990">0</span><span class="op" id="3661991">;</span>&nbsp;<span class="ident" id="3661993">j</span>&nbsp;<span class="op" id="3661995">&lt;</span>&nbsp;<span class="ident" id="3661997">_W</span><span class="op" id="3661999">;</span>&nbsp;<span class="ident" id="3662001">j</span><span class="op" id="3662002">++</span>&nbsp;<span class="op" id="3662005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662010">zz</span>&nbsp;<span class="op" id="3662013">=</span>&nbsp;<span class="ident" id="3662015">zz</span><span class="op" id="3662017">.</span><span class="ident" id="3662018">mul</span><span class="op" id="3662021">(</span><span class="ident" id="3662022">z</span><span class="op" id="3662023">,</span>&nbsp;<span class="ident" id="3662025">z</span><span class="op" id="3662026">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662031">zz</span><span class="op" id="3662033">,</span>&nbsp;<span class="ident" id="3662035">z</span>&nbsp;<span class="op" id="3662037">=</span>&nbsp;<span class="ident" id="3662039">z</span><span class="op" id="3662040">,</span>&nbsp;<span class="ident" id="3662042">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662049">if</span>&nbsp;<span class="ident" id="3662052">v</span><span class="op" id="3662053">&amp;</span><span class="ident" id="3662054">mask</span>&nbsp;<span class="op" id="3662059">!=</span>&nbsp;<span class="num" id="3662062">0</span>&nbsp;<span class="op" id="3662064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662070">zz</span>&nbsp;<span class="op" id="3662073">=</span>&nbsp;<span class="ident" id="3662075">zz</span><span class="op" id="3662077">.</span><span class="ident" id="3662078">mul</span><span class="op" id="3662081">(</span><span class="ident" id="3662082">z</span><span class="op" id="3662083">,</span>&nbsp;<span class="ident" id="3662085">x</span><span class="op" id="3662086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662092">zz</span><span class="op" id="3662094">,</span>&nbsp;<span class="ident" id="3662096">z</span>&nbsp;<span class="op" id="3662098">=</span>&nbsp;<span class="ident" id="3662100">z</span><span class="op" id="3662101">,</span>&nbsp;<span class="ident" id="3662103">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662115">if</span>&nbsp;<span class="builtinfunc" id="3662118">len</span><span class="op" id="3662121">(</span><span class="ident" id="3662122">m</span><span class="op" id="3662123">)</span>&nbsp;<span class="op" id="3662125">!=</span>&nbsp;<span class="num" id="3662128">0</span>&nbsp;<span class="op" id="3662130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662136">zz</span><span class="op" id="3662138">,</span>&nbsp;<span class="ident" id="3662140">r</span>&nbsp;<span class="op" id="3662142">=</span>&nbsp;<span class="ident" id="3662144">zz</span><span class="op" id="3662146">.</span><span class="ident" id="3662147">div</span><span class="op" id="3662150">(</span><span class="ident" id="3662151">r</span><span class="op" id="3662152">,</span>&nbsp;<span class="ident" id="3662154">z</span><span class="op" id="3662155">,</span>&nbsp;<span class="ident" id="3662157">m</span><span class="op" id="3662158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662164">zz</span><span class="op" id="3662166">,</span>&nbsp;<span class="ident" id="3662168">r</span><span class="op" id="3662169">,</span>&nbsp;<span class="ident" id="3662171">q</span><span class="op" id="3662172">,</span>&nbsp;<span class="ident" id="3662174">z</span>&nbsp;<span class="op" id="3662176">=</span>&nbsp;<span class="ident" id="3662178">q</span><span class="op" id="3662179">,</span>&nbsp;<span class="ident" id="3662181">z</span><span class="op" id="3662182">,</span>&nbsp;<span class="ident" id="3662184">zz</span><span class="op" id="3662186">,</span>&nbsp;<span class="ident" id="3662188">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662199">v</span>&nbsp;<span class="op" id="3662201">&lt;&lt;=</span>&nbsp;<span class="num" id="3662205">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662212">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662216">return</span>&nbsp;<span class="ident" id="3662223">z</span><span class="op" id="3662224">.</span><span class="ident" id="3662225">norm</span><span class="op" id="3662229">(</span><span class="op" id="3662230">)</span><br>
<span class="lineno"></span><span class="op" id="3662232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3662235">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3662303">func</span>&nbsp;<span class="op" id="3662308">(</span><span class="ident" id="3662309">z</span>&nbsp;<span class="ident" id="3662311">nat</span><span class="op" id="3662314">)</span>&nbsp;<span class="ident" id="3662316">expNNWindowed</span><span class="op" id="3662329">(</span><span class="ident" id="3662330">x</span><span class="op" id="3662331">,</span>&nbsp;<span class="ident" id="3662333">y</span><span class="op" id="3662334">,</span>&nbsp;<span class="ident" id="3662336">m</span>&nbsp;<span class="ident" id="3662338">nat</span><span class="op" id="3662341">)</span>&nbsp;<span class="ident" id="3662343">nat</span>&nbsp;<span class="op" id="3662347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662350">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662420">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662451">var</span>&nbsp;<span class="ident" id="3662455">zz</span><span class="op" id="3662457">,</span>&nbsp;<span class="ident" id="3662459">r</span>&nbsp;<span class="ident" id="3662461">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662467">const</span>&nbsp;<span class="ident" id="3662473">n</span>&nbsp;<span class="op" id="3662475">=</span>&nbsp;<span class="num" id="3662477">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662480">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662508">var</span>&nbsp;<span class="ident" id="3662512">powers</span>&nbsp;<span class="op" id="3662519">[</span><span class="num" id="3662520">1</span>&nbsp;<span class="op" id="3662522">&lt;&lt;</span>&nbsp;<span class="ident" id="3662525">n</span><span class="op" id="3662526">]</span><span class="ident" id="3662527">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662532">powers</span><span class="op" id="3662538">[</span><span class="num" id="3662539">0</span><span class="op" id="3662540">]</span>&nbsp;<span class="op" id="3662542">=</span>&nbsp;<span class="ident" id="3662544">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662552">powers</span><span class="op" id="3662558">[</span><span class="num" id="3662559">1</span><span class="op" id="3662560">]</span>&nbsp;<span class="op" id="3662562">=</span>&nbsp;<span class="ident" id="3662564">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662567">for</span>&nbsp;<span class="ident" id="3662571">i</span>&nbsp;<span class="op" id="3662573">:=</span>&nbsp;<span class="num" id="3662576">2</span><span class="op" id="3662577">;</span>&nbsp;<span class="ident" id="3662579">i</span>&nbsp;<span class="op" id="3662581">&lt;</span>&nbsp;<span class="num" id="3662583">1</span><span class="op" id="3662584">&lt;&lt;</span><span class="ident" id="3662586">n</span><span class="op" id="3662587">;</span>&nbsp;<span class="ident" id="3662589">i</span>&nbsp;<span class="op" id="3662591">+=</span>&nbsp;<span class="num" id="3662594">2</span>&nbsp;<span class="op" id="3662596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662600">p2</span><span class="op" id="3662602">,</span>&nbsp;<span class="ident" id="3662604">p</span><span class="op" id="3662605">,</span>&nbsp;<span class="ident" id="3662607">p1</span>&nbsp;<span class="op" id="3662610">:=</span>&nbsp;<span class="op" id="3662613">&amp;</span><span class="ident" id="3662614">powers</span><span class="op" id="3662620">[</span><span class="ident" id="3662621">i</span><span class="op" id="3662622">/</span><span class="num" id="3662623">2</span><span class="op" id="3662624">]</span><span class="op" id="3662625">,</span>&nbsp;<span class="op" id="3662627">&amp;</span><span class="ident" id="3662628">powers</span><span class="op" id="3662634">[</span><span class="ident" id="3662635">i</span><span class="op" id="3662636">]</span><span class="op" id="3662637">,</span>&nbsp;<span class="op" id="3662639">&amp;</span><span class="ident" id="3662640">powers</span><span class="op" id="3662646">[</span><span class="ident" id="3662647">i</span><span class="op" id="3662648">+</span><span class="num" id="3662649">1</span><span class="op" id="3662650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662654">*</span><span class="ident" id="3662655">p</span>&nbsp;<span class="op" id="3662657">=</span>&nbsp;<span class="ident" id="3662659">p</span><span class="op" id="3662660">.</span><span class="ident" id="3662661">mul</span><span class="op" id="3662664">(</span><span class="op" id="3662665">*</span><span class="ident" id="3662666">p2</span><span class="op" id="3662668">,</span>&nbsp;<span class="op" id="3662670">*</span><span class="ident" id="3662671">p2</span><span class="op" id="3662673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662677">zz</span><span class="op" id="3662679">,</span>&nbsp;<span class="ident" id="3662681">r</span>&nbsp;<span class="op" id="3662683">=</span>&nbsp;<span class="ident" id="3662685">zz</span><span class="op" id="3662687">.</span><span class="ident" id="3662688">div</span><span class="op" id="3662691">(</span><span class="ident" id="3662692">r</span><span class="op" id="3662693">,</span>&nbsp;<span class="op" id="3662695">*</span><span class="ident" id="3662696">p</span><span class="op" id="3662697">,</span>&nbsp;<span class="ident" id="3662699">m</span><span class="op" id="3662700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662704">*</span><span class="ident" id="3662705">p</span><span class="op" id="3662706">,</span>&nbsp;<span class="ident" id="3662708">r</span>&nbsp;<span class="op" id="3662710">=</span>&nbsp;<span class="ident" id="3662712">r</span><span class="op" id="3662713">,</span>&nbsp;<span class="op" id="3662715">*</span><span class="ident" id="3662716">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662720">*</span><span class="ident" id="3662721">p1</span>&nbsp;<span class="op" id="3662724">=</span>&nbsp;<span class="ident" id="3662726">p1</span><span class="op" id="3662728">.</span><span class="ident" id="3662729">mul</span><span class="op" id="3662732">(</span><span class="op" id="3662733">*</span><span class="ident" id="3662734">p</span><span class="op" id="3662735">,</span>&nbsp;<span class="ident" id="3662737">x</span><span class="op" id="3662738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662742">zz</span><span class="op" id="3662744">,</span>&nbsp;<span class="ident" id="3662746">r</span>&nbsp;<span class="op" id="3662748">=</span>&nbsp;<span class="ident" id="3662750">zz</span><span class="op" id="3662752">.</span><span class="ident" id="3662753">div</span><span class="op" id="3662756">(</span><span class="ident" id="3662757">r</span><span class="op" id="3662758">,</span>&nbsp;<span class="op" id="3662760">*</span><span class="ident" id="3662761">p1</span><span class="op" id="3662763">,</span>&nbsp;<span class="ident" id="3662765">m</span><span class="op" id="3662766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662770">*</span><span class="ident" id="3662771">p1</span><span class="op" id="3662773">,</span>&nbsp;<span class="ident" id="3662775">r</span>&nbsp;<span class="op" id="3662777">=</span>&nbsp;<span class="ident" id="3662779">r</span><span class="op" id="3662780">,</span>&nbsp;<span class="op" id="3662782">*</span><span class="ident" id="3662783">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662791">z</span>&nbsp;<span class="op" id="3662793">=</span>&nbsp;<span class="ident" id="3662795">z</span><span class="op" id="3662796">.</span><span class="ident" id="3662797">setWord</span><span class="op" id="3662804">(</span><span class="num" id="3662805">1</span><span class="op" id="3662806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662810">for</span>&nbsp;<span class="ident" id="3662814">i</span>&nbsp;<span class="op" id="3662816">:=</span>&nbsp;<span class="builtinfunc" id="3662819">len</span><span class="op" id="3662822">(</span><span class="ident" id="3662823">y</span><span class="op" id="3662824">)</span>&nbsp;<span class="op" id="3662826">-</span>&nbsp;<span class="num" id="3662828">1</span><span class="op" id="3662829">;</span>&nbsp;<span class="ident" id="3662831">i</span>&nbsp;<span class="op" id="3662833">&gt;=</span>&nbsp;<span class="num" id="3662836">0</span><span class="op" id="3662837">;</span>&nbsp;<span class="ident" id="3662839">i</span><span class="op" id="3662840">--</span>&nbsp;<span class="op" id="3662843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662847">yi</span>&nbsp;<span class="op" id="3662850">:=</span>&nbsp;<span class="ident" id="3662853">y</span><span class="op" id="3662854">[</span><span class="ident" id="3662855">i</span><span class="op" id="3662856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662860">for</span>&nbsp;<span class="ident" id="3662864">j</span>&nbsp;<span class="op" id="3662866">:=</span>&nbsp;<span class="num" id="3662869">0</span><span class="op" id="3662870">;</span>&nbsp;<span class="ident" id="3662872">j</span>&nbsp;<span class="op" id="3662874">&lt;</span>&nbsp;<span class="ident" id="3662876">_W</span><span class="op" id="3662878">;</span>&nbsp;<span class="ident" id="3662880">j</span>&nbsp;<span class="op" id="3662882">+=</span>&nbsp;<span class="ident" id="3662885">n</span>&nbsp;<span class="op" id="3662887">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662892">if</span>&nbsp;<span class="ident" id="3662895">i</span>&nbsp;<span class="op" id="3662897">!=</span>&nbsp;<span class="builtinfunc" id="3662900">len</span><span class="op" id="3662903">(</span><span class="ident" id="3662904">y</span><span class="op" id="3662905">)</span><span class="op" id="3662906">-</span><span class="num" id="3662907">1</span>&nbsp;<span class="op" id="3662909">||</span>&nbsp;<span class="ident" id="3662912">j</span>&nbsp;<span class="op" id="3662914">!=</span>&nbsp;<span class="num" id="3662917">0</span>&nbsp;<span class="op" id="3662919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662925">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662974">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3663026">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663077">zz</span>&nbsp;<span class="op" id="3663080">=</span>&nbsp;<span class="ident" id="3663082">zz</span><span class="op" id="3663084">.</span><span class="ident" id="3663085">mul</span><span class="op" id="3663088">(</span><span class="ident" id="3663089">z</span><span class="op" id="3663090">,</span>&nbsp;<span class="ident" id="3663092">z</span><span class="op" id="3663093">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663099">zz</span><span class="op" id="3663101">,</span>&nbsp;<span class="ident" id="3663103">z</span>&nbsp;<span class="op" id="3663105">=</span>&nbsp;<span class="ident" id="3663107">z</span><span class="op" id="3663108">,</span>&nbsp;<span class="ident" id="3663110">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663117">zz</span><span class="op" id="3663119">,</span>&nbsp;<span class="ident" id="3663121">r</span>&nbsp;<span class="op" id="3663123">=</span>&nbsp;<span class="ident" id="3663125">zz</span><span class="op" id="3663127">.</span><span class="ident" id="3663128">div</span><span class="op" id="3663131">(</span><span class="ident" id="3663132">r</span><span class="op" id="3663133">,</span>&nbsp;<span class="ident" id="3663135">z</span><span class="op" id="3663136">,</span>&nbsp;<span class="ident" id="3663138">m</span><span class="op" id="3663139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663145">z</span><span class="op" id="3663146">,</span>&nbsp;<span class="ident" id="3663148">r</span>&nbsp;<span class="op" id="3663150">=</span>&nbsp;<span class="ident" id="3663152">r</span><span class="op" id="3663153">,</span>&nbsp;<span class="ident" id="3663155">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663162">zz</span>&nbsp;<span class="op" id="3663165">=</span>&nbsp;<span class="ident" id="3663167">zz</span><span class="op" id="3663169">.</span><span class="ident" id="3663170">mul</span><span class="op" id="3663173">(</span><span class="ident" id="3663174">z</span><span class="op" id="3663175">,</span>&nbsp;<span class="ident" id="3663177">z</span><span class="op" id="3663178">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663184">zz</span><span class="op" id="3663186">,</span>&nbsp;<span class="ident" id="3663188">z</span>&nbsp;<span class="op" id="3663190">=</span>&nbsp;<span class="ident" id="3663192">z</span><span class="op" id="3663193">,</span>&nbsp;<span class="ident" id="3663195">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663202">zz</span><span class="op" id="3663204">,</span>&nbsp;<span class="ident" id="3663206">r</span>&nbsp;<span class="op" id="3663208">=</span>&nbsp;<span class="ident" id="3663210">zz</span><span class="op" id="3663212">.</span><span class="ident" id="3663213">div</span><span class="op" id="3663216">(</span><span class="ident" id="3663217">r</span><span class="op" id="3663218">,</span>&nbsp;<span class="ident" id="3663220">z</span><span class="op" id="3663221">,</span>&nbsp;<span class="ident" id="3663223">m</span><span class="op" id="3663224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663230">z</span><span class="op" id="3663231">,</span>&nbsp;<span class="ident" id="3663233">r</span>&nbsp;<span class="op" id="3663235">=</span>&nbsp;<span class="ident" id="3663237">r</span><span class="op" id="3663238">,</span>&nbsp;<span class="ident" id="3663240">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663247">zz</span>&nbsp;<span class="op" id="3663250">=</span>&nbsp;<span class="ident" id="3663252">zz</span><span class="op" id="3663254">.</span><span class="ident" id="3663255">mul</span><span class="op" id="3663258">(</span><span class="ident" id="3663259">z</span><span class="op" id="3663260">,</span>&nbsp;<span class="ident" id="3663262">z</span><span class="op" id="3663263">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663269">zz</span><span class="op" id="3663271">,</span>&nbsp;<span class="ident" id="3663273">z</span>&nbsp;<span class="op" id="3663275">=</span>&nbsp;<span class="ident" id="3663277">z</span><span class="op" id="3663278">,</span>&nbsp;<span class="ident" id="3663280">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663287">zz</span><span class="op" id="3663289">,</span>&nbsp;<span class="ident" id="3663291">r</span>&nbsp;<span class="op" id="3663293">=</span>&nbsp;<span class="ident" id="3663295">zz</span><span class="op" id="3663297">.</span><span class="ident" id="3663298">div</span><span class="op" id="3663301">(</span><span class="ident" id="3663302">r</span><span class="op" id="3663303">,</span>&nbsp;<span class="ident" id="3663305">z</span><span class="op" id="3663306">,</span>&nbsp;<span class="ident" id="3663308">m</span><span class="op" id="3663309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663315">z</span><span class="op" id="3663316">,</span>&nbsp;<span class="ident" id="3663318">r</span>&nbsp;<span class="op" id="3663320">=</span>&nbsp;<span class="ident" id="3663322">r</span><span class="op" id="3663323">,</span>&nbsp;<span class="ident" id="3663325">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663332">zz</span>&nbsp;<span class="op" id="3663335">=</span>&nbsp;<span class="ident" id="3663337">zz</span><span class="op" id="3663339">.</span><span class="ident" id="3663340">mul</span><span class="op" id="3663343">(</span><span class="ident" id="3663344">z</span><span class="op" id="3663345">,</span>&nbsp;<span class="ident" id="3663347">z</span><span class="op" id="3663348">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663354">zz</span><span class="op" id="3663356">,</span>&nbsp;<span class="ident" id="3663358">z</span>&nbsp;<span class="op" id="3663360">=</span>&nbsp;<span class="ident" id="3663362">z</span><span class="op" id="3663363">,</span>&nbsp;<span class="ident" id="3663365">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663372">zz</span><span class="op" id="3663374">,</span>&nbsp;<span class="ident" id="3663376">r</span>&nbsp;<span class="op" id="3663378">=</span>&nbsp;<span class="ident" id="3663380">zz</span><span class="op" id="3663382">.</span><span class="ident" id="3663383">div</span><span class="op" id="3663386">(</span><span class="ident" id="3663387">r</span><span class="op" id="3663388">,</span>&nbsp;<span class="ident" id="3663390">z</span><span class="op" id="3663391">,</span>&nbsp;<span class="ident" id="3663393">m</span><span class="op" id="3663394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663400">z</span><span class="op" id="3663401">,</span>&nbsp;<span class="ident" id="3663403">r</span>&nbsp;<span class="op" id="3663405">=</span>&nbsp;<span class="ident" id="3663407">r</span><span class="op" id="3663408">,</span>&nbsp;<span class="ident" id="3663410">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663421">zz</span>&nbsp;<span class="op" id="3663424">=</span>&nbsp;<span class="ident" id="3663426">zz</span><span class="op" id="3663428">.</span><span class="ident" id="3663429">mul</span><span class="op" id="3663432">(</span><span class="ident" id="3663433">z</span><span class="op" id="3663434">,</span>&nbsp;<span class="ident" id="3663436">powers</span><span class="op" id="3663442">[</span><span class="ident" id="3663443">yi</span><span class="op" id="3663445">&gt;&gt;</span><span class="op" id="3663447">(</span><span class="ident" id="3663448">_W</span><span class="op" id="3663450">-</span><span class="ident" id="3663451">n</span><span class="op" id="3663452">)</span><span class="op" id="3663453">]</span><span class="op" id="3663454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663459">zz</span><span class="op" id="3663461">,</span>&nbsp;<span class="ident" id="3663463">z</span>&nbsp;<span class="op" id="3663465">=</span>&nbsp;<span class="ident" id="3663467">z</span><span class="op" id="3663468">,</span>&nbsp;<span class="ident" id="3663470">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663476">zz</span><span class="op" id="3663478">,</span>&nbsp;<span class="ident" id="3663480">r</span>&nbsp;<span class="op" id="3663482">=</span>&nbsp;<span class="ident" id="3663484">zz</span><span class="op" id="3663486">.</span><span class="ident" id="3663487">div</span><span class="op" id="3663490">(</span><span class="ident" id="3663491">r</span><span class="op" id="3663492">,</span>&nbsp;<span class="ident" id="3663494">z</span><span class="op" id="3663495">,</span>&nbsp;<span class="ident" id="3663497">m</span><span class="op" id="3663498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663503">z</span><span class="op" id="3663504">,</span>&nbsp;<span class="ident" id="3663506">r</span>&nbsp;<span class="op" id="3663508">=</span>&nbsp;<span class="ident" id="3663510">r</span><span class="op" id="3663511">,</span>&nbsp;<span class="ident" id="3663513">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663519">yi</span>&nbsp;<span class="op" id="3663522">&lt;&lt;=</span>&nbsp;<span class="ident" id="3663526">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663537">return</span>&nbsp;<span class="ident" id="3663544">z</span><span class="op" id="3663545">.</span><span class="ident" id="3663546">norm</span><span class="op" id="3663550">(</span><span class="op" id="3663551">)</span><br>
<span class="lineno">1380</span><span class="op" id="3663553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3663556">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3663635">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3663700">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3663740">func</span>&nbsp;<span class="op" id="3663745">(</span><span class="ident" id="3663746">n</span>&nbsp;<span class="ident" id="3663748">nat</span><span class="op" id="3663751">)</span>&nbsp;<span class="ident" id="3663753">probablyPrime</span><span class="op" id="3663766">(</span><span class="ident" id="3663767">reps</span>&nbsp;<span class="builtintype" id="3663772">int</span><span class="op" id="3663775">)</span>&nbsp;<span class="builtintype" id="3663777">bool</span>&nbsp;<span class="op" id="3663782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663785">if</span>&nbsp;<span class="builtinfunc" id="3663788">len</span><span class="op" id="3663791">(</span><span class="ident" id="3663792">n</span><span class="op" id="3663793">)</span>&nbsp;<span class="op" id="3663795">==</span>&nbsp;<span class="num" id="3663798">0</span>&nbsp;<span class="op" id="3663800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663804">return</span>&nbsp;<span class="builtintype" id="3663811">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663822">if</span>&nbsp;<span class="builtinfunc" id="3663825">len</span><span class="op" id="3663828">(</span><span class="ident" id="3663829">n</span><span class="op" id="3663830">)</span>&nbsp;<span class="op" id="3663832">==</span>&nbsp;<span class="num" id="3663835">1</span>&nbsp;<span class="op" id="3663837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663841">if</span>&nbsp;<span class="ident" id="3663844">n</span><span class="op" id="3663845">[</span><span class="num" id="3663846">0</span><span class="op" id="3663847">]</span>&nbsp;<span class="op" id="3663849">&lt;</span>&nbsp;<span class="num" id="3663851">2</span>&nbsp;<span class="op" id="3663853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663858">return</span>&nbsp;<span class="builtintype" id="3663865">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663878">if</span>&nbsp;<span class="ident" id="3663881">n</span><span class="op" id="3663882">[</span><span class="num" id="3663883">0</span><span class="op" id="3663884">]</span><span class="op" id="3663885">%</span><span class="num" id="3663886">2</span>&nbsp;<span class="op" id="3663888">==</span>&nbsp;<span class="num" id="3663891">0</span>&nbsp;<span class="op" id="3663893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663898">return</span>&nbsp;<span class="ident" id="3663905">n</span><span class="op" id="3663906">[</span><span class="num" id="3663907">0</span><span class="op" id="3663908">]</span>&nbsp;<span class="op" id="3663910">==</span>&nbsp;<span class="num" id="3663913">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3663922">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3663980">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664019">switch</span>&nbsp;<span class="ident" id="3664026">n</span><span class="op" id="3664027">[</span><span class="num" id="3664028">0</span><span class="op" id="3664029">]</span>&nbsp;<span class="op" id="3664031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664035">case</span>&nbsp;<span class="num" id="3664040">3</span><span class="op" id="3664041">,</span>&nbsp;<span class="num" id="3664043">5</span><span class="op" id="3664044">,</span>&nbsp;<span class="num" id="3664046">7</span><span class="op" id="3664047">,</span>&nbsp;<span class="num" id="3664049">11</span><span class="op" id="3664051">,</span>&nbsp;<span class="num" id="3664053">13</span><span class="op" id="3664055">,</span>&nbsp;<span class="num" id="3664057">17</span><span class="op" id="3664059">,</span>&nbsp;<span class="num" id="3664061">19</span><span class="op" id="3664063">,</span>&nbsp;<span class="num" id="3664065">23</span><span class="op" id="3664067">,</span>&nbsp;<span class="num" id="3664069">29</span><span class="op" id="3664071">,</span>&nbsp;<span class="num" id="3664073">31</span><span class="op" id="3664075">,</span>&nbsp;<span class="num" id="3664077">37</span><span class="op" id="3664079">,</span>&nbsp;<span class="num" id="3664081">41</span><span class="op" id="3664083">,</span>&nbsp;<span class="num" id="3664085">43</span><span class="op" id="3664087">,</span>&nbsp;<span class="num" id="3664089">47</span><span class="op" id="3664091">,</span>&nbsp;<span class="num" id="3664093">53</span><span class="op" id="3664095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664100">return</span>&nbsp;<span class="builtintype" id="3664107">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664114">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664121">const</span>&nbsp;<span class="ident" id="3664127">primesProduct32</span>&nbsp;<span class="op" id="3664143">=</span>&nbsp;<span class="num" id="3664145">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3664164">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664199">const</span>&nbsp;<span class="ident" id="3664205">primesProduct64</span>&nbsp;<span class="op" id="3664221">=</span>&nbsp;<span class="num" id="3664223">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3664242">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664278">var</span>&nbsp;<span class="ident" id="3664282">r</span>&nbsp;<span class="ident" id="3664284">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664290">switch</span>&nbsp;<span class="ident" id="3664297">_W</span>&nbsp;<span class="op" id="3664300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664303">case</span>&nbsp;<span class="num" id="3664308">32</span><span class="op" id="3664310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664314">r</span>&nbsp;<span class="op" id="3664316">=</span>&nbsp;<span class="ident" id="3664318">n</span><span class="op" id="3664319">.</span><span class="ident" id="3664320">modW</span><span class="op" id="3664324">(</span><span class="ident" id="3664325">primesProduct32</span><span class="op" id="3664340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664343">case</span>&nbsp;<span class="num" id="3664348">64</span><span class="op" id="3664350">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664354">r</span>&nbsp;<span class="op" id="3664356">=</span>&nbsp;<span class="ident" id="3664358">n</span><span class="op" id="3664359">.</span><span class="ident" id="3664360">modW</span><span class="op" id="3664364">(</span><span class="ident" id="3664365">primesProduct64</span>&nbsp;<span class="op" id="3664381">&amp;</span>&nbsp;<span class="ident" id="3664383">_M</span><span class="op" id="3664385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664388">default</span><span class="op" id="3664395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3664399">panic</span><span class="op" id="3664404">(</span><span class="string" id="3664405">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3664424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664431">if</span>&nbsp;<span class="ident" id="3664434">r</span><span class="op" id="3664435">%</span><span class="num" id="3664436">3</span>&nbsp;<span class="op" id="3664438">==</span>&nbsp;<span class="num" id="3664441">0</span>&nbsp;<span class="op" id="3664443">||</span>&nbsp;<span class="ident" id="3664446">r</span><span class="op" id="3664447">%</span><span class="num" id="3664448">5</span>&nbsp;<span class="op" id="3664450">==</span>&nbsp;<span class="num" id="3664453">0</span>&nbsp;<span class="op" id="3664455">||</span>&nbsp;<span class="ident" id="3664458">r</span><span class="op" id="3664459">%</span><span class="num" id="3664460">7</span>&nbsp;<span class="op" id="3664462">==</span>&nbsp;<span class="num" id="3664465">0</span>&nbsp;<span class="op" id="3664467">||</span>&nbsp;<span class="ident" id="3664470">r</span><span class="op" id="3664471">%</span><span class="num" id="3664472">11</span>&nbsp;<span class="op" id="3664475">==</span>&nbsp;<span class="num" id="3664478">0</span>&nbsp;<span class="op" id="3664480">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664485">r</span><span class="op" id="3664486">%</span><span class="num" id="3664487">13</span>&nbsp;<span class="op" id="3664490">==</span>&nbsp;<span class="num" id="3664493">0</span>&nbsp;<span class="op" id="3664495">||</span>&nbsp;<span class="ident" id="3664498">r</span><span class="op" id="3664499">%</span><span class="num" id="3664500">17</span>&nbsp;<span class="op" id="3664503">==</span>&nbsp;<span class="num" id="3664506">0</span>&nbsp;<span class="op" id="3664508">||</span>&nbsp;<span class="ident" id="3664511">r</span><span class="op" id="3664512">%</span><span class="num" id="3664513">19</span>&nbsp;<span class="op" id="3664516">==</span>&nbsp;<span class="num" id="3664519">0</span>&nbsp;<span class="op" id="3664521">||</span>&nbsp;<span class="ident" id="3664524">r</span><span class="op" id="3664525">%</span><span class="num" id="3664526">23</span>&nbsp;<span class="op" id="3664529">==</span>&nbsp;<span class="num" id="3664532">0</span>&nbsp;<span class="op" id="3664534">||</span>&nbsp;<span class="ident" id="3664537">r</span><span class="op" id="3664538">%</span><span class="num" id="3664539">29</span>&nbsp;<span class="op" id="3664542">==</span>&nbsp;<span class="num" id="3664545">0</span>&nbsp;<span class="op" id="3664547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664551">return</span>&nbsp;<span class="builtintype" id="3664558">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664569">if</span>&nbsp;<span class="ident" id="3664572">_W</span>&nbsp;<span class="op" id="3664575">==</span>&nbsp;<span class="num" id="3664578">64</span>&nbsp;<span class="op" id="3664581">&amp;&amp;</span>&nbsp;<span class="op" id="3664584">(</span><span class="ident" id="3664585">r</span><span class="op" id="3664586">%</span><span class="num" id="3664587">31</span>&nbsp;<span class="op" id="3664590">==</span>&nbsp;<span class="num" id="3664593">0</span>&nbsp;<span class="op" id="3664595">||</span>&nbsp;<span class="ident" id="3664598">r</span><span class="op" id="3664599">%</span><span class="num" id="3664600">37</span>&nbsp;<span class="op" id="3664603">==</span>&nbsp;<span class="num" id="3664606">0</span>&nbsp;<span class="op" id="3664608">||</span>&nbsp;<span class="ident" id="3664611">r</span><span class="op" id="3664612">%</span><span class="num" id="3664613">41</span>&nbsp;<span class="op" id="3664616">==</span>&nbsp;<span class="num" id="3664619">0</span>&nbsp;<span class="op" id="3664621">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664626">r</span><span class="op" id="3664627">%</span><span class="num" id="3664628">43</span>&nbsp;<span class="op" id="3664631">==</span>&nbsp;<span class="num" id="3664634">0</span>&nbsp;<span class="op" id="3664636">||</span>&nbsp;<span class="ident" id="3664639">r</span><span class="op" id="3664640">%</span><span class="num" id="3664641">47</span>&nbsp;<span class="op" id="3664644">==</span>&nbsp;<span class="num" id="3664647">0</span>&nbsp;<span class="op" id="3664649">||</span>&nbsp;<span class="ident" id="3664652">r</span><span class="op" id="3664653">%</span><span class="num" id="3664654">53</span>&nbsp;<span class="op" id="3664657">==</span>&nbsp;<span class="num" id="3664660">0</span><span class="op" id="3664661">)</span>&nbsp;<span class="op" id="3664663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664667">return</span>&nbsp;<span class="builtintype" id="3664674">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664685">nm1</span>&nbsp;<span class="op" id="3664689">:=</span>&nbsp;<span class="ident" id="3664692">nat</span><span class="op" id="3664695">(</span><span class="builtintype" id="3664696">nil</span><span class="op" id="3664699">)</span><span class="op" id="3664700">.</span><span class="ident" id="3664701">sub</span><span class="op" id="3664704">(</span><span class="ident" id="3664705">n</span><span class="op" id="3664706">,</span>&nbsp;<span class="ident" id="3664708">natOne</span><span class="op" id="3664714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3664717">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664759">k</span>&nbsp;<span class="op" id="3664761">:=</span>&nbsp;<span class="ident" id="3664764">nm1</span><span class="op" id="3664767">.</span><span class="ident" id="3664768">trailingZeroBits</span><span class="op" id="3664784">(</span><span class="op" id="3664785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664788">q</span>&nbsp;<span class="op" id="3664790">:=</span>&nbsp;<span class="ident" id="3664793">nat</span><span class="op" id="3664796">(</span><span class="builtintype" id="3664797">nil</span><span class="op" id="3664800">)</span><span class="op" id="3664801">.</span><span class="ident" id="3664802">shr</span><span class="op" id="3664805">(</span><span class="ident" id="3664806">nm1</span><span class="op" id="3664809">,</span>&nbsp;<span class="ident" id="3664811">k</span><span class="op" id="3664812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664816">nm3</span>&nbsp;<span class="op" id="3664820">:=</span>&nbsp;<span class="ident" id="3664823">nat</span><span class="op" id="3664826">(</span><span class="builtintype" id="3664827">nil</span><span class="op" id="3664830">)</span><span class="op" id="3664831">.</span><span class="ident" id="3664832">sub</span><span class="op" id="3664835">(</span><span class="ident" id="3664836">nm1</span><span class="op" id="3664839">,</span>&nbsp;<span class="ident" id="3664841">natTwo</span><span class="op" id="3664847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664850">rand</span>&nbsp;<span class="op" id="3664855">:=</span>&nbsp;<span class="ident" id="3664858">rand</span><span class="op" id="3664862">.</span><span class="ident" id="3664863">New</span><span class="op" id="3664866">(</span><span class="ident" id="3664867">rand</span><span class="op" id="3664871">.</span><span class="ident" id="3664872">NewSource</span><span class="op" id="3664881">(</span><span class="ident" id="3664882">int64</span><span class="op" id="3664887">(</span><span class="ident" id="3664888">n</span><span class="op" id="3664889">[</span><span class="num" id="3664890">0</span><span class="op" id="3664891">]</span><span class="op" id="3664892">)</span><span class="op" id="3664893">)</span><span class="op" id="3664894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664898">var</span>&nbsp;<span class="ident" id="3664902">x</span><span class="op" id="3664903">,</span>&nbsp;<span class="ident" id="3664905">y</span><span class="op" id="3664906">,</span>&nbsp;<span class="ident" id="3664908">quotient</span>&nbsp;<span class="ident" id="3664917">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664922">nm3Len</span>&nbsp;<span class="op" id="3664929">:=</span>&nbsp;<span class="ident" id="3664932">nm3</span><span class="op" id="3664935">.</span><span class="ident" id="3664936">bitLen</span><span class="op" id="3664942">(</span><span class="op" id="3664943">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3664946">NextRandom</span><span class="op" id="3664956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664959">for</span>&nbsp;<span class="ident" id="3664963">i</span>&nbsp;<span class="op" id="3664965">:=</span>&nbsp;<span class="num" id="3664968">0</span><span class="op" id="3664969">;</span>&nbsp;<span class="ident" id="3664971">i</span>&nbsp;<span class="op" id="3664973">&lt;</span>&nbsp;<span class="ident" id="3664975">reps</span><span class="op" id="3664979">;</span>&nbsp;<span class="ident" id="3664981">i</span><span class="op" id="3664982">++</span>&nbsp;<span class="op" id="3664985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664989">x</span>&nbsp;<span class="op" id="3664991">=</span>&nbsp;<span class="ident" id="3664993">x</span><span class="op" id="3664994">.</span><span class="ident" id="3664995">random</span><span class="op" id="3665001">(</span><span class="ident" id="3665002">rand</span><span class="op" id="3665006">,</span>&nbsp;<span class="ident" id="3665008">nm3</span><span class="op" id="3665011">,</span>&nbsp;<span class="ident" id="3665013">nm3Len</span><span class="op" id="3665019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665023">x</span>&nbsp;<span class="op" id="3665025">=</span>&nbsp;<span class="ident" id="3665027">x</span><span class="op" id="3665028">.</span><span class="ident" id="3665029">add</span><span class="op" id="3665032">(</span><span class="ident" id="3665033">x</span><span class="op" id="3665034">,</span>&nbsp;<span class="ident" id="3665036">natTwo</span><span class="op" id="3665042">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665046">y</span>&nbsp;<span class="op" id="3665048">=</span>&nbsp;<span class="ident" id="3665050">y</span><span class="op" id="3665051">.</span><span class="ident" id="3665052">expNN</span><span class="op" id="3665057">(</span><span class="ident" id="3665058">x</span><span class="op" id="3665059">,</span>&nbsp;<span class="ident" id="3665061">q</span><span class="op" id="3665062">,</span>&nbsp;<span class="ident" id="3665064">n</span><span class="op" id="3665065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665069">if</span>&nbsp;<span class="ident" id="3665072">y</span><span class="op" id="3665073">.</span><span class="ident" id="3665074">cmp</span><span class="op" id="3665077">(</span><span class="ident" id="3665078">natOne</span><span class="op" id="3665084">)</span>&nbsp;<span class="op" id="3665086">==</span>&nbsp;<span class="num" id="3665089">0</span>&nbsp;<span class="op" id="3665091">||</span>&nbsp;<span class="ident" id="3665094">y</span><span class="op" id="3665095">.</span><span class="ident" id="3665096">cmp</span><span class="op" id="3665099">(</span><span class="ident" id="3665100">nm1</span><span class="op" id="3665103">)</span>&nbsp;<span class="op" id="3665105">==</span>&nbsp;<span class="num" id="3665108">0</span>&nbsp;<span class="op" id="3665110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665115">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665130">for</span>&nbsp;<span class="ident" id="3665134">j</span>&nbsp;<span class="op" id="3665136">:=</span>&nbsp;<span class="builtintype" id="3665139">uint</span><span class="op" id="3665143">(</span><span class="num" id="3665144">1</span><span class="op" id="3665145">)</span><span class="op" id="3665146">;</span>&nbsp;<span class="ident" id="3665148">j</span>&nbsp;<span class="op" id="3665150">&lt;</span>&nbsp;<span class="ident" id="3665152">k</span><span class="op" id="3665153">;</span>&nbsp;<span class="ident" id="3665155">j</span><span class="op" id="3665156">++</span>&nbsp;<span class="op" id="3665159">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665164">y</span>&nbsp;<span class="op" id="3665166">=</span>&nbsp;<span class="ident" id="3665168">y</span><span class="op" id="3665169">.</span><span class="ident" id="3665170">mul</span><span class="op" id="3665173">(</span><span class="ident" id="3665174">y</span><span class="op" id="3665175">,</span>&nbsp;<span class="ident" id="3665177">y</span><span class="op" id="3665178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665183">quotient</span><span class="op" id="3665191">,</span>&nbsp;<span class="ident" id="3665193">y</span>&nbsp;<span class="op" id="3665195">=</span>&nbsp;<span class="ident" id="3665197">quotient</span><span class="op" id="3665205">.</span><span class="ident" id="3665206">div</span><span class="op" id="3665209">(</span><span class="ident" id="3665210">y</span><span class="op" id="3665211">,</span>&nbsp;<span class="ident" id="3665213">y</span><span class="op" id="3665214">,</span>&nbsp;<span class="ident" id="3665216">n</span><span class="op" id="3665217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665222">if</span>&nbsp;<span class="ident" id="3665225">y</span><span class="op" id="3665226">.</span><span class="ident" id="3665227">cmp</span><span class="op" id="3665230">(</span><span class="ident" id="3665231">nm1</span><span class="op" id="3665234">)</span>&nbsp;<span class="op" id="3665236">==</span>&nbsp;<span class="num" id="3665239">0</span>&nbsp;<span class="op" id="3665241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665247">continue</span>&nbsp;<span class="ident" id="3665256">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665270">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665275">if</span>&nbsp;<span class="ident" id="3665278">y</span><span class="op" id="3665279">.</span><span class="ident" id="3665280">cmp</span><span class="op" id="3665283">(</span><span class="ident" id="3665284">natOne</span><span class="op" id="3665290">)</span>&nbsp;<span class="op" id="3665292">==</span>&nbsp;<span class="num" id="3665295">0</span>&nbsp;<span class="op" id="3665297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665303">return</span>&nbsp;<span class="builtintype" id="3665310">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665327">return</span>&nbsp;<span class="builtintype" id="3665334">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665345">return</span>&nbsp;<span class="builtintype" id="3665352">true</span><br>
<span class="lineno"></span><span class="op" id="3665357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3665360">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3665427">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3665494">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3665561">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3665591">func</span>&nbsp;<span class="op" id="3665596">(</span><span class="ident" id="3665597">z</span>&nbsp;<span class="ident" id="3665599">nat</span><span class="op" id="3665602">)</span>&nbsp;<span class="ident" id="3665604">bytes</span><span class="op" id="3665609">(</span><span class="ident" id="3665610">buf</span>&nbsp;<span class="op" id="3665614">[</span><span class="op" id="3665615">]</span><span class="builtintype" id="3665616">byte</span><span class="op" id="3665620">)</span>&nbsp;<span class="op" id="3665622">(</span><span class="ident" id="3665623">i</span>&nbsp;<span class="builtintype" id="3665625">int</span><span class="op" id="3665628">)</span>&nbsp;<span class="op" id="3665630">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665633">i</span>&nbsp;<span class="op" id="3665635">=</span>&nbsp;<span class="builtinfunc" id="3665637">len</span><span class="op" id="3665640">(</span><span class="ident" id="3665641">buf</span><span class="op" id="3665644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665647">for</span>&nbsp;<span class="ident" id="3665651">_</span><span class="op" id="3665652">,</span>&nbsp;<span class="ident" id="3665654">d</span>&nbsp;<span class="op" id="3665656">:=</span>&nbsp;<span class="keyword" id="3665659">range</span>&nbsp;<span class="ident" id="3665665">z</span>&nbsp;<span class="op" id="3665667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665671">for</span>&nbsp;<span class="ident" id="3665675">j</span>&nbsp;<span class="op" id="3665677">:=</span>&nbsp;<span class="num" id="3665680">0</span><span class="op" id="3665681">;</span>&nbsp;<span class="ident" id="3665683">j</span>&nbsp;<span class="op" id="3665685">&lt;</span>&nbsp;<span class="ident" id="3665687">_S</span><span class="op" id="3665689">;</span>&nbsp;<span class="ident" id="3665691">j</span><span class="op" id="3665692">++</span>&nbsp;<span class="op" id="3665695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665700">i</span><span class="op" id="3665701">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665707">buf</span><span class="op" id="3665710">[</span><span class="ident" id="3665711">i</span><span class="op" id="3665712">]</span>&nbsp;<span class="op" id="3665714">=</span>&nbsp;<span class="builtintype" id="3665716">byte</span><span class="op" id="3665720">(</span><span class="ident" id="3665721">d</span><span class="op" id="3665722">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665727">d</span>&nbsp;<span class="op" id="3665729">&gt;&gt;=</span>&nbsp;<span class="num" id="3665733">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665744">for</span>&nbsp;<span class="ident" id="3665748">i</span>&nbsp;<span class="op" id="3665750">&lt;</span>&nbsp;<span class="builtinfunc" id="3665752">len</span><span class="op" id="3665755">(</span><span class="ident" id="3665756">buf</span><span class="op" id="3665759">)</span>&nbsp;<span class="op" id="3665761">&amp;&amp;</span>&nbsp;<span class="ident" id="3665764">buf</span><span class="op" id="3665767">[</span><span class="ident" id="3665768">i</span><span class="op" id="3665769">]</span>&nbsp;<span class="op" id="3665771">==</span>&nbsp;<span class="num" id="3665774">0</span>&nbsp;<span class="op" id="3665776">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665780">i</span><span class="op" id="3665781">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665789">return</span><br>
<span class="lineno"></span><span class="op" id="3665796">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3665799">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3665864">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3665913">func</span>&nbsp;<span class="op" id="3665918">(</span><span class="ident" id="3665919">z</span>&nbsp;<span class="ident" id="3665921">nat</span><span class="op" id="3665924">)</span>&nbsp;<span class="ident" id="3665926">setBytes</span><span class="op" id="3665934">(</span><span class="ident" id="3665935">buf</span>&nbsp;<span class="op" id="3665939">[</span><span class="op" id="3665940">]</span><span class="builtintype" id="3665941">byte</span><span class="op" id="3665945">)</span>&nbsp;<span class="ident" id="3665947">nat</span>&nbsp;<span class="op" id="3665951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665954">z</span>&nbsp;<span class="op" id="3665956">=</span>&nbsp;<span class="ident" id="3665958">z</span><span class="op" id="3665959">.</span><span class="builtinfunc" id="3665960">make</span><span class="op" id="3665964">(</span><span class="op" id="3665965">(</span><span class="builtinfunc" id="3665966">len</span><span class="op" id="3665969">(</span><span class="ident" id="3665970">buf</span><span class="op" id="3665973">)</span>&nbsp;<span class="op" id="3665975">+</span>&nbsp;<span class="ident" id="3665977">_S</span>&nbsp;<span class="op" id="3665980">-</span>&nbsp;<span class="num" id="3665982">1</span><span class="op" id="3665983">)</span>&nbsp;<span class="op" id="3665985">/</span>&nbsp;<span class="ident" id="3665987">_S</span><span class="op" id="3665989">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665993">k</span>&nbsp;<span class="op" id="3665995">:=</span>&nbsp;<span class="num" id="3665998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666001">s</span>&nbsp;<span class="op" id="3666003">:=</span>&nbsp;<span class="builtintype" id="3666006">uint</span><span class="op" id="3666010">(</span><span class="num" id="3666011">0</span><span class="op" id="3666012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666015">var</span>&nbsp;<span class="ident" id="3666019">d</span>&nbsp;<span class="ident" id="3666021">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666027">for</span>&nbsp;<span class="ident" id="3666031">i</span>&nbsp;<span class="op" id="3666033">:=</span>&nbsp;<span class="builtinfunc" id="3666036">len</span><span class="op" id="3666039">(</span><span class="ident" id="3666040">buf</span><span class="op" id="3666043">)</span><span class="op" id="3666044">;</span>&nbsp;<span class="ident" id="3666046">i</span>&nbsp;<span class="op" id="3666048">&gt;</span>&nbsp;<span class="num" id="3666050">0</span><span class="op" id="3666051">;</span>&nbsp;<span class="ident" id="3666053">i</span><span class="op" id="3666054">--</span>&nbsp;<span class="op" id="3666057">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666061">d</span>&nbsp;<span class="op" id="3666063">|=</span>&nbsp;<span class="ident" id="3666066">Word</span><span class="op" id="3666070">(</span><span class="ident" id="3666071">buf</span><span class="op" id="3666074">[</span><span class="ident" id="3666075">i</span><span class="op" id="3666076">-</span><span class="num" id="3666077">1</span><span class="op" id="3666078">]</span><span class="op" id="3666079">)</span>&nbsp;<span class="op" id="3666081">&lt;&lt;</span>&nbsp;<span class="ident" id="3666084">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666088">if</span>&nbsp;<span class="ident" id="3666091">s</span>&nbsp;<span class="op" id="3666093">+=</span>&nbsp;<span class="num" id="3666096">8</span><span class="op" id="3666097">;</span>&nbsp;<span class="ident" id="3666099">s</span>&nbsp;<span class="op" id="3666101">==</span>&nbsp;<span class="ident" id="3666104">_S</span><span class="op" id="3666106">*</span><span class="num" id="3666107">8</span>&nbsp;<span class="op" id="3666109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666114">z</span><span class="op" id="3666115">[</span><span class="ident" id="3666116">k</span><span class="op" id="3666117">]</span>&nbsp;<span class="op" id="3666119">=</span>&nbsp;<span class="ident" id="3666121">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666126">k</span><span class="op" id="3666127">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666133">s</span>&nbsp;<span class="op" id="3666135">=</span>&nbsp;<span class="num" id="3666137">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666142">d</span>&nbsp;<span class="op" id="3666144">=</span>&nbsp;<span class="num" id="3666146">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3666150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3666153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666156">if</span>&nbsp;<span class="ident" id="3666159">k</span>&nbsp;<span class="op" id="3666161">&lt;</span>&nbsp;<span class="builtinfunc" id="3666163">len</span><span class="op" id="3666166">(</span><span class="ident" id="3666167">z</span><span class="op" id="3666168">)</span>&nbsp;<span class="op" id="3666170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666174">z</span><span class="op" id="3666175">[</span><span class="ident" id="3666176">k</span><span class="op" id="3666177">]</span>&nbsp;<span class="op" id="3666179">=</span>&nbsp;<span class="ident" id="3666181">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3666184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666188">return</span>&nbsp;<span class="ident" id="3666195">z</span><span class="op" id="3666196">.</span><span class="ident" id="3666197">norm</span><span class="op" id="3666201">(</span><span class="op" id="3666202">)</span><br>
<span class="lineno"></span><span class="op" id="3666204">}</span>
</div>
</body>
</html>
