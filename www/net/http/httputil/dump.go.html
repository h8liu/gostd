<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5516967">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5517022">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5517076">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5517127">package</span>&nbsp;<span class="ident" id="5517135">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517145">import</span>&nbsp;<span class="op" id="5517152">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517155">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517164">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517173">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517183">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517190">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517196">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517209">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517216">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517228">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517239">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517250">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5517257">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5517260">//&nbsp;One&nbsp;of&nbsp;the&nbsp;copies,&nbsp;say&nbsp;from&nbsp;b&nbsp;to&nbsp;r2,&nbsp;could&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using&nbsp;a&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="5517333">//&nbsp;elaborate&nbsp;trick&nbsp;where&nbsp;the&nbsp;other&nbsp;copy&nbsp;is&nbsp;made&nbsp;during&nbsp;Request/Response.Write.</span><br>
<span class="lineno"></span><span class="comment" id="5517412">//&nbsp;This&nbsp;would&nbsp;complicate&nbsp;things&nbsp;too&nbsp;much,&nbsp;given&nbsp;that&nbsp;these&nbsp;functions&nbsp;are&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5517489">//&nbsp;debugging&nbsp;only.</span><br>
<span class="lineno">25</span><span class="keyword" id="5517508">func</span>&nbsp;<span class="ident" id="5517513">drainBody</span><span class="op" id="5517522">(</span><span class="ident" id="5517523">b</span>&nbsp;<span class="ident" id="5517525"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5517527">.</span><span class="ident" id="5517528">ReadCloser</span><span class="op" id="5517538">)</span>&nbsp;<span class="op" id="5517540">(</span><span class="ident" id="5517541">r1</span><span class="op" id="5517543">,</span>&nbsp;<span class="ident" id="5517545">r2</span>&nbsp;<span class="ident" id="5517548"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5517550">.</span><span class="ident" id="5517551">ReadCloser</span><span class="op" id="5517561">,</span>&nbsp;<span class="ident" id="5517563">err</span>&nbsp;<span class="builtintype" id="5517567">error</span><span class="op" id="5517572">)</span>&nbsp;<span class="op" id="5517574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517577">var</span>&nbsp;<span class="ident" id="5517581">buf</span>&nbsp;<span class="ident" id="5517585"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5517590">.</span><span class="ident" id="5517591">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517599">if</span>&nbsp;<span class="ident" id="5517602">_</span><span class="op" id="5517603">,</span>&nbsp;<span class="ident" id="5517605"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span>&nbsp;<span class="op" id="5517609">=</span>&nbsp;<span class="ident" id="5517611"><a href="/net/http/httputil/dump.go.html#5517581">buf</a></span><span class="op" id="5517614">.</span><span class="ident" id="5517615">ReadFrom</span><span class="op" id="5517623">(</span><span class="ident" id="5517624"><a href="/net/http/httputil/dump.go.html#5517523">b</a></span><span class="op" id="5517625">)</span><span class="op" id="5517626">;</span>&nbsp;<span class="ident" id="5517628"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span>&nbsp;<span class="op" id="5517632">!=</span>&nbsp;<span class="ident" id="5517635">nil</span>&nbsp;<span class="op" id="5517639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517643">return</span>&nbsp;<span class="ident" id="5517650">nil</span><span class="op" id="5517653">,</span>&nbsp;<span class="ident" id="5517655">nil</span><span class="op" id="5517658">,</span>&nbsp;<span class="ident" id="5517660"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517665">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517668">if</span>&nbsp;<span class="ident" id="5517671"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span>&nbsp;<span class="op" id="5517675">=</span>&nbsp;<span class="ident" id="5517677"><a href="/net/http/httputil/dump.go.html#5517523">b</a></span><span class="op" id="5517678">.</span><span class="ident" id="5517679">Close</span><span class="op" id="5517684">(</span><span class="op" id="5517685">)</span><span class="op" id="5517686">;</span>&nbsp;<span class="ident" id="5517688"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span>&nbsp;<span class="op" id="5517692">!=</span>&nbsp;<span class="ident" id="5517695">nil</span>&nbsp;<span class="op" id="5517699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517703">return</span>&nbsp;<span class="ident" id="5517710">nil</span><span class="op" id="5517713">,</span>&nbsp;<span class="ident" id="5517715">nil</span><span class="op" id="5517718">,</span>&nbsp;<span class="ident" id="5517720"><a href="/net/http/httputil/dump.go.html#5517563">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517728">return</span>&nbsp;<span class="ident" id="5517735"><a href="/net/http/httputil/dump.go.html#5517196">ioutil</a></span><span class="op" id="5517741">.</span><span class="ident" id="5517742">NopCloser</span><span class="op" id="5517751">(</span><span class="op" id="5517752">&amp;</span><span class="ident" id="5517753"><a href="/net/http/httputil/dump.go.html#5517581">buf</a></span><span class="op" id="5517756">)</span><span class="op" id="5517757">,</span>&nbsp;<span class="ident" id="5517759"><a href="/net/http/httputil/dump.go.html#5517196">ioutil</a></span><span class="op" id="5517765">.</span><span class="ident" id="5517766">NopCloser</span><span class="op" id="5517775">(</span><span class="ident" id="5517776"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5517781">.</span><span class="ident" id="5517782">NewReader</span><span class="op" id="5517791">(</span><span class="ident" id="5517792"><a href="/net/http/httputil/dump.go.html#5517581">buf</a></span><span class="op" id="5517795">.</span><span class="ident" id="5517796">Bytes</span><span class="op" id="5517801">(</span><span class="op" id="5517802">)</span><span class="op" id="5517803">)</span><span class="op" id="5517804">)</span><span class="op" id="5517805">,</span>&nbsp;<span class="ident" id="5517807">nil</span><br>
<span class="lineno"></span><span class="op" id="5517811">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5517814">//&nbsp;dumpConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;which&nbsp;writes&nbsp;to&nbsp;Writer&nbsp;and&nbsp;reads&nbsp;from&nbsp;Reader</span><br>
<span class="lineno"></span><span class="keyword" id="5517885">type</span>&nbsp;<span class="ident" id="5517890">dumpConn</span>&nbsp;<span class="keyword" id="5517899">struct</span>&nbsp;<span class="op" id="5517906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517909"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5517911">.</span><span class="ident" id="5517912">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517920"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5517922">.</span><span class="ident" id="5517923">Reader</span><br>
<span class="lineno">40</span><span class="op" id="5517930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517933">func</span>&nbsp;<span class="op" id="5517938">(</span><span class="ident" id="5517939">c</span>&nbsp;<span class="op" id="5517941">*</span><span class="ident" id="5517942"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5517950">)</span>&nbsp;<span class="ident" id="5517952">Close</span><span class="op" id="5517957">(</span><span class="op" id="5517958">)</span>&nbsp;<span class="builtintype" id="5517960">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517988">{</span>&nbsp;<span class="keyword" id="5517990">return</span>&nbsp;<span class="ident" id="5517997">nil</span>&nbsp;<span class="op" id="5518001">}</span><br>
<span class="lineno"></span><span class="keyword" id="5518003">func</span>&nbsp;<span class="op" id="5518008">(</span><span class="ident" id="5518009">c</span>&nbsp;<span class="op" id="5518011">*</span><span class="ident" id="5518012"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5518020">)</span>&nbsp;<span class="ident" id="5518022">LocalAddr</span><span class="op" id="5518031">(</span><span class="op" id="5518032">)</span>&nbsp;<span class="ident" id="5518034"><a href="/net/http/httputil/dump.go.html#5517209">net</a></span><span class="op" id="5518037">.</span><span class="ident" id="5518038">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518058">{</span>&nbsp;<span class="keyword" id="5518060">return</span>&nbsp;<span class="ident" id="5518067">nil</span>&nbsp;<span class="op" id="5518071">}</span><br>
<span class="lineno"></span><span class="keyword" id="5518073">func</span>&nbsp;<span class="op" id="5518078">(</span><span class="ident" id="5518079">c</span>&nbsp;<span class="op" id="5518081">*</span><span class="ident" id="5518082"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5518090">)</span>&nbsp;<span class="ident" id="5518092">RemoteAddr</span><span class="op" id="5518102">(</span><span class="op" id="5518103">)</span>&nbsp;<span class="ident" id="5518105"><a href="/net/http/httputil/dump.go.html#5517209">net</a></span><span class="op" id="5518108">.</span><span class="ident" id="5518109">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518128">{</span>&nbsp;<span class="keyword" id="5518130">return</span>&nbsp;<span class="ident" id="5518137">nil</span>&nbsp;<span class="op" id="5518141">}</span><br>
<span class="lineno">45</span><span class="keyword" id="5518143">func</span>&nbsp;<span class="op" id="5518148">(</span><span class="ident" id="5518149">c</span>&nbsp;<span class="op" id="5518151">*</span><span class="ident" id="5518152"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5518160">)</span>&nbsp;<span class="ident" id="5518162">SetDeadline</span><span class="op" id="5518173">(</span><span class="ident" id="5518174">t</span>&nbsp;<span class="ident" id="5518176"><a href="/net/http/httputil/dump.go.html#5517250">time</a></span><span class="op" id="5518180">.</span><span class="ident" id="5518181">Time</span><span class="op" id="5518185">)</span>&nbsp;<span class="builtintype" id="5518187">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518198">{</span>&nbsp;<span class="keyword" id="5518200">return</span>&nbsp;<span class="ident" id="5518207">nil</span>&nbsp;<span class="op" id="5518211">}</span><br>
<span class="lineno"></span><span class="keyword" id="5518213">func</span>&nbsp;<span class="op" id="5518218">(</span><span class="ident" id="5518219">c</span>&nbsp;<span class="op" id="5518221">*</span><span class="ident" id="5518222"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5518230">)</span>&nbsp;<span class="ident" id="5518232">SetReadDeadline</span><span class="op" id="5518247">(</span><span class="ident" id="5518248">t</span>&nbsp;<span class="ident" id="5518250"><a href="/net/http/httputil/dump.go.html#5517250">time</a></span><span class="op" id="5518254">.</span><span class="ident" id="5518255">Time</span><span class="op" id="5518259">)</span>&nbsp;<span class="builtintype" id="5518261">error</span>&nbsp;&nbsp;<span class="op" id="5518268">{</span>&nbsp;<span class="keyword" id="5518270">return</span>&nbsp;<span class="ident" id="5518277">nil</span>&nbsp;<span class="op" id="5518281">}</span><br>
<span class="lineno"></span><span class="keyword" id="5518283">func</span>&nbsp;<span class="op" id="5518288">(</span><span class="ident" id="5518289">c</span>&nbsp;<span class="op" id="5518291">*</span><span class="ident" id="5518292"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5518300">)</span>&nbsp;<span class="ident" id="5518302">SetWriteDeadline</span><span class="op" id="5518318">(</span><span class="ident" id="5518319">t</span>&nbsp;<span class="ident" id="5518321"><a href="/net/http/httputil/dump.go.html#5517250">time</a></span><span class="op" id="5518325">.</span><span class="ident" id="5518326">Time</span><span class="op" id="5518330">)</span>&nbsp;<span class="builtintype" id="5518332">error</span>&nbsp;<span class="op" id="5518338">{</span>&nbsp;<span class="keyword" id="5518340">return</span>&nbsp;<span class="ident" id="5518347">nil</span>&nbsp;<span class="op" id="5518351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5518354">type</span>&nbsp;<span class="ident" id="5518359">neverEnding</span>&nbsp;<span class="builtintype" id="5518371">byte</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5518377">func</span>&nbsp;<span class="op" id="5518382">(</span><span class="ident" id="5518383">b</span>&nbsp;<span class="ident" id="5518385"><a href="/net/http/httputil/dump.go.html#5518359">neverEnding</a></span><span class="op" id="5518396">)</span>&nbsp;<span class="ident" id="5518398">Read</span><span class="op" id="5518402">(</span><span class="ident" id="5518403">p</span>&nbsp;<span class="op" id="5518405">[</span><span class="op" id="5518406">]</span><span class="builtintype" id="5518407">byte</span><span class="op" id="5518411">)</span>&nbsp;<span class="op" id="5518413">(</span><span class="ident" id="5518414">n</span>&nbsp;<span class="builtintype" id="5518416">int</span><span class="op" id="5518419">,</span>&nbsp;<span class="ident" id="5518421">err</span>&nbsp;<span class="builtintype" id="5518425">error</span><span class="op" id="5518430">)</span>&nbsp;<span class="op" id="5518432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518435">for</span>&nbsp;<span class="ident" id="5518439">i</span>&nbsp;<span class="op" id="5518441">:=</span>&nbsp;<span class="keyword" id="5518444">range</span>&nbsp;<span class="ident" id="5518450"><a href="/net/http/httputil/dump.go.html#5518403">p</a></span>&nbsp;<span class="op" id="5518452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518456"><a href="/net/http/httputil/dump.go.html#5518403">p</a></span><span class="op" id="5518457">[</span><span class="ident" id="5518458"><a href="/net/http/httputil/dump.go.html#5518439">i</a></span><span class="op" id="5518459">]</span>&nbsp;<span class="op" id="5518461">=</span>&nbsp;<span class="builtintype" id="5518463">byte</span><span class="op" id="5518467">(</span><span class="ident" id="5518468"><a href="/net/http/httputil/dump.go.html#5518383">b</a></span><span class="op" id="5518469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518472">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518475">return</span>&nbsp;<span class="builtinfunc" id="5518482">len</span><span class="op" id="5518485">(</span><span class="ident" id="5518486"><a href="/net/http/httputil/dump.go.html#5518403">p</a></span><span class="op" id="5518487">)</span><span class="op" id="5518488">,</span>&nbsp;<span class="ident" id="5518490">nil</span><br>
<span class="lineno"></span><span class="op" id="5518494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5518497">//&nbsp;DumpRequestOut&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;includes</span><br>
<span class="lineno"></span><span class="comment" id="5518548">//&nbsp;headers&nbsp;that&nbsp;the&nbsp;standard&nbsp;http.Transport&nbsp;adds,</span><br>
<span class="lineno">60</span><span class="comment" id="5518598">//&nbsp;such&nbsp;as&nbsp;User-Agent.</span><br>
<span class="lineno"></span><span class="keyword" id="5518621">func</span>&nbsp;<span class="ident" id="5518626">DumpRequestOut</span><span class="op" id="5518640">(</span><span class="ident" id="5518641">req</span>&nbsp;<span class="op" id="5518645">*</span><span class="ident" id="5518646"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5518650">.</span><span class="ident" id="5518651">Request</span><span class="op" id="5518658">,</span>&nbsp;<span class="ident" id="5518660">body</span>&nbsp;<span class="builtintype" id="5518665">bool</span><span class="op" id="5518669">)</span>&nbsp;<span class="op" id="5518671">(</span><span class="op" id="5518672">[</span><span class="op" id="5518673">]</span><span class="builtintype" id="5518674">byte</span><span class="op" id="5518678">,</span>&nbsp;<span class="builtintype" id="5518680">error</span><span class="op" id="5518685">)</span>&nbsp;<span class="op" id="5518687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518690">save</span>&nbsp;<span class="op" id="5518695">:=</span>&nbsp;<span class="ident" id="5518698"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518701">.</span><span class="ident" id="5518702">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518708">dummyBody</span>&nbsp;<span class="op" id="5518718">:=</span>&nbsp;<span class="builtintype" id="5518721">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518728">if</span>&nbsp;<span class="op" id="5518731">!</span><span class="ident" id="5518732"><a href="/net/http/httputil/dump.go.html#5518660">body</a></span>&nbsp;<span class="op" id="5518737">||</span>&nbsp;<span class="ident" id="5518740"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518743">.</span><span class="ident" id="5518744">Body</span>&nbsp;<span class="op" id="5518749">==</span>&nbsp;<span class="ident" id="5518752">nil</span>&nbsp;<span class="op" id="5518756">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518760"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518763">.</span><span class="ident" id="5518764">Body</span>&nbsp;<span class="op" id="5518769">=</span>&nbsp;<span class="ident" id="5518771">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518777">if</span>&nbsp;<span class="ident" id="5518780"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518783">.</span><span class="ident" id="5518784">ContentLength</span>&nbsp;<span class="op" id="5518798">!=</span>&nbsp;<span class="num" id="5518801">0</span>&nbsp;<span class="op" id="5518803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518808"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518811">.</span><span class="ident" id="5518812">Body</span>&nbsp;<span class="op" id="5518817">=</span>&nbsp;<span class="ident" id="5518819"><a href="/net/http/httputil/dump.go.html#5517196">ioutil</a></span><span class="op" id="5518825">.</span><span class="ident" id="5518826">NopCloser</span><span class="op" id="5518835">(</span><span class="ident" id="5518836"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5518838">.</span><span class="ident" id="5518839">LimitReader</span><span class="op" id="5518850">(</span><span class="ident" id="5518851"><a href="/net/http/httputil/dump.go.html#5518359">neverEnding</a></span><span class="op" id="5518862">(</span><span class="string" id="5518863">&#39;x&#39;</span><span class="op" id="5518866">)</span><span class="op" id="5518867">,</span>&nbsp;<span class="ident" id="5518869"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518872">.</span><span class="ident" id="5518873">ContentLength</span><span class="op" id="5518886">)</span><span class="op" id="5518887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518892"><a href="/net/http/httputil/dump.go.html#5518708">dummyBody</a></span>&nbsp;<span class="op" id="5518902">=</span>&nbsp;<span class="builtintype" id="5518904">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518911">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518914">}</span>&nbsp;<span class="keyword" id="5518916">else</span>&nbsp;<span class="op" id="5518921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518925">var</span>&nbsp;<span class="ident" id="5518929">err</span>&nbsp;<span class="builtintype" id="5518933">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518941"><a href="/net/http/httputil/dump.go.html#5518690">save</a></span><span class="op" id="5518945">,</span>&nbsp;<span class="ident" id="5518947"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518950">.</span><span class="ident" id="5518951">Body</span><span class="op" id="5518955">,</span>&nbsp;<span class="ident" id="5518957"><a href="/net/http/httputil/dump.go.html#5518929">err</a></span>&nbsp;<span class="op" id="5518961">=</span>&nbsp;<span class="ident" id="5518963"><a href="/net/http/httputil/dump.go.html#5517513">drainBody</a></span><span class="op" id="5518972">(</span><span class="ident" id="5518973"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5518976">.</span><span class="ident" id="5518977">Body</span><span class="op" id="5518981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518985">if</span>&nbsp;<span class="ident" id="5518988"><a href="/net/http/httputil/dump.go.html#5518929">err</a></span>&nbsp;<span class="op" id="5518992">!=</span>&nbsp;<span class="ident" id="5518995">nil</span>&nbsp;<span class="op" id="5518999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519004">return</span>&nbsp;<span class="ident" id="5519011">nil</span><span class="op" id="5519014">,</span>&nbsp;<span class="ident" id="5519016"><a href="/net/http/httputil/dump.go.html#5518929">err</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519029">//&nbsp;Since&nbsp;we&#39;re&nbsp;using&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;write&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519099">//&nbsp;switch&nbsp;to&nbsp;http&nbsp;so&nbsp;the&nbsp;Transport&nbsp;doesn&#39;t&nbsp;try&nbsp;to&nbsp;do&nbsp;an&nbsp;SSL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519160">//&nbsp;negotiation&nbsp;with&nbsp;our&nbsp;dumpConn&nbsp;and&nbsp;its&nbsp;bytes.Buffer&nbsp;&amp;&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519223">//&nbsp;The&nbsp;wire&nbsp;format&nbsp;for&nbsp;https&nbsp;and&nbsp;http&nbsp;are&nbsp;the&nbsp;same,&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519284">reqSend</span>&nbsp;<span class="op" id="5519292">:=</span>&nbsp;<span class="ident" id="5519295"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519300">if</span>&nbsp;<span class="ident" id="5519303"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5519306">.</span><span class="ident" id="5519307">URL</span><span class="op" id="5519310">.</span><span class="ident" id="5519311">Scheme</span>&nbsp;<span class="op" id="5519318">==</span>&nbsp;<span class="string" id="5519321">&#34;https&#34;</span>&nbsp;<span class="op" id="5519329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519333"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span>&nbsp;<span class="op" id="5519341">=</span>&nbsp;<span class="builtinfunc" id="5519343">new</span><span class="op" id="5519346">(</span><span class="ident" id="5519347"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5519351">.</span><span class="ident" id="5519352">Request</span><span class="op" id="5519359">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519363">*</span><span class="ident" id="5519364"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span>&nbsp;<span class="op" id="5519372">=</span>&nbsp;<span class="op" id="5519374">*</span><span class="ident" id="5519375"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519381"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span><span class="op" id="5519388">.</span><span class="ident" id="5519389">URL</span>&nbsp;<span class="op" id="5519393">=</span>&nbsp;<span class="builtinfunc" id="5519395">new</span><span class="op" id="5519398">(</span><span class="ident" id="5519399"><a href="/net/http/httputil/dump.go.html#5517228">url</a></span><span class="op" id="5519402">.</span><span class="ident" id="5519403">URL</span><span class="op" id="5519406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519410">*</span><span class="ident" id="5519411"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span><span class="op" id="5519418">.</span><span class="ident" id="5519419">URL</span>&nbsp;<span class="op" id="5519423">=</span>&nbsp;<span class="op" id="5519425">*</span><span class="ident" id="5519426"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5519429">.</span><span class="ident" id="5519430">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519436"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span><span class="op" id="5519443">.</span><span class="ident" id="5519444">URL</span><span class="op" id="5519447">.</span><span class="ident" id="5519448">Scheme</span>&nbsp;<span class="op" id="5519455">=</span>&nbsp;<span class="string" id="5519457">&#34;http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519465">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519469">//&nbsp;Use&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;record&nbsp;what&nbsp;we&nbsp;would&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519532">//&nbsp;on&nbsp;the&nbsp;wire,&nbsp;but&nbsp;not&nbsp;using&nbsp;TCP.&nbsp;&nbsp;Use&nbsp;a&nbsp;Transport&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519592">//&nbsp;custom&nbsp;dialer&nbsp;that&nbsp;returns&nbsp;a&nbsp;fake&nbsp;net.Conn&nbsp;that&nbsp;waits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519650">//&nbsp;for&nbsp;the&nbsp;full&nbsp;input&nbsp;(and&nbsp;recording&nbsp;it),&nbsp;and&nbsp;then&nbsp;responds</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519711">//&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519738">var</span>&nbsp;<span class="ident" id="5519742">buf</span>&nbsp;<span class="ident" id="5519746"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5519751">.</span><span class="ident" id="5519752">Buffer</span>&nbsp;<span class="comment" id="5519759">//&nbsp;records&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519782">pr</span><span class="op" id="5519784">,</span>&nbsp;<span class="ident" id="5519786">pw</span>&nbsp;<span class="op" id="5519789">:=</span>&nbsp;<span class="ident" id="5519792"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5519794">.</span><span class="ident" id="5519795">Pipe</span><span class="op" id="5519799">(</span><span class="op" id="5519800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519803">defer</span>&nbsp;<span class="ident" id="5519809"><a href="/net/http/httputil/dump.go.html#5519782">pr</a></span><span class="op" id="5519811">.</span><span class="ident" id="5519812">Close</span><span class="op" id="5519817">(</span><span class="op" id="5519818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519821">defer</span>&nbsp;<span class="ident" id="5519827"><a href="/net/http/httputil/dump.go.html#5519786">pw</a></span><span class="op" id="5519829">.</span><span class="ident" id="5519830">Close</span><span class="op" id="5519835">(</span><span class="op" id="5519836">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519839">dr</span>&nbsp;<span class="op" id="5519842">:=</span>&nbsp;<span class="op" id="5519845">&amp;</span><span class="ident" id="5519846"><a href="/net/http/httputil/dump.go.html#5521025">delegateReader</a></span><span class="op" id="5519860">{</span><span class="ident" id="5519861">c</span><span class="op" id="5519862">:</span>&nbsp;<span class="builtinfunc" id="5519864">make</span><span class="op" id="5519868">(</span><span class="keyword" id="5519869">chan</span>&nbsp;<span class="ident" id="5519874"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5519876">.</span><span class="ident" id="5519877">Reader</span><span class="op" id="5519883">)</span><span class="op" id="5519884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519887">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;request&nbsp;before&nbsp;replying&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519951">go</span>&nbsp;<span class="keyword" id="5519954">func</span><span class="op" id="5519958">(</span><span class="op" id="5519959">)</span>&nbsp;<span class="op" id="5519961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519965">req</span><span class="op" id="5519968">,</span>&nbsp;<span class="ident" id="5519970">err</span>&nbsp;<span class="op" id="5519974">:=</span>&nbsp;<span class="ident" id="5519977"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5519981">.</span><span class="ident" id="5519982">ReadRequest</span><span class="op" id="5519993">(</span><span class="ident" id="5519994"><a href="/net/http/httputil/dump.go.html#5517155">bufio</a></span><span class="op" id="5519999">.</span><span class="ident" id="5520000">NewReader</span><span class="op" id="5520009">(</span><span class="ident" id="5520010"><a href="/net/http/httputil/dump.go.html#5519782">pr</a></span><span class="op" id="5520012">)</span><span class="op" id="5520013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520017">if</span>&nbsp;<span class="ident" id="5520020"><a href="/net/http/httputil/dump.go.html#5519970">err</a></span>&nbsp;<span class="op" id="5520024">==</span>&nbsp;<span class="ident" id="5520027">nil</span>&nbsp;<span class="op" id="5520031">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520036">//&nbsp;Ensure&nbsp;all&nbsp;the&nbsp;body&nbsp;is&nbsp;read;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520081">//&nbsp;we&#39;ll&nbsp;get&nbsp;a&nbsp;partial&nbsp;dump.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520113"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5520115">.</span><span class="ident" id="5520116">Copy</span><span class="op" id="5520120">(</span><span class="ident" id="5520121"><a href="/net/http/httputil/dump.go.html#5517196">ioutil</a></span><span class="op" id="5520127">.</span><span class="ident" id="5520128">Discard</span><span class="op" id="5520135">,</span>&nbsp;<span class="ident" id="5520137"><a href="/net/http/httputil/dump.go.html#5519965">req</a></span><span class="op" id="5520140">.</span><span class="ident" id="5520141">Body</span><span class="op" id="5520145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520150"><a href="/net/http/httputil/dump.go.html#5519965">req</a></span><span class="op" id="5520153">.</span><span class="ident" id="5520154">Body</span><span class="op" id="5520158">.</span><span class="ident" id="5520159">Close</span><span class="op" id="5520164">(</span><span class="op" id="5520165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520169">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520173"><a href="/net/http/httputil/dump.go.html#5519839">dr</a></span><span class="op" id="5520175">.</span><span class="ident" id="5520176">c</span>&nbsp;<span class="op" id="5520178">&lt;-</span>&nbsp;<span class="ident" id="5520181"><a href="/net/http/httputil/dump.go.html#5517239">strings</a></span><span class="op" id="5520188">.</span><span class="ident" id="5520189">NewReader</span><span class="op" id="5520198">(</span><span class="string" id="5520199">&#34;HTTP/1.1&nbsp;204&nbsp;No&nbsp;Content\r\n\r\n&#34;</span><span class="op" id="5520232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520235">}</span><span class="op" id="5520236">(</span><span class="op" id="5520237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520241">t</span>&nbsp;<span class="op" id="5520243">:=</span>&nbsp;<span class="op" id="5520246">&amp;</span><span class="ident" id="5520247"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5520251">.</span><span class="ident" id="5520252">Transport</span><span class="op" id="5520261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520265">DisableKeepAlives</span><span class="op" id="5520282">:</span>&nbsp;<span class="builtintype" id="5520284">true</span><span class="op" id="5520288">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520292">Dial</span><span class="op" id="5520296">:</span>&nbsp;<span class="keyword" id="5520298">func</span><span class="op" id="5520302">(</span><span class="ident" id="5520303">net</span><span class="op" id="5520306">,</span>&nbsp;<span class="ident" id="5520308">addr</span>&nbsp;<span class="builtintype" id="5520313">string</span><span class="op" id="5520319">)</span>&nbsp;<span class="op" id="5520321">(</span><span class="ident" id="5520322"><a href="/net/http/httputil/dump.go.html#5517209">net</a></span><span class="op" id="5520325">.</span><span class="ident" id="5520326">Conn</span><span class="op" id="5520330">,</span>&nbsp;<span class="builtintype" id="5520332">error</span><span class="op" id="5520337">)</span>&nbsp;<span class="op" id="5520339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520344">return</span>&nbsp;<span class="op" id="5520351">&amp;</span><span class="ident" id="5520352"><a href="/net/http/httputil/dump.go.html#5517890">dumpConn</a></span><span class="op" id="5520360">{</span><span class="ident" id="5520361"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5520363">.</span><span class="ident" id="5520364">MultiWriter</span><span class="op" id="5520375">(</span><span class="op" id="5520376">&amp;</span><span class="ident" id="5520377"><a href="/net/http/httputil/dump.go.html#5519742">buf</a></span><span class="op" id="5520380">,</span>&nbsp;<span class="ident" id="5520382"><a href="/net/http/httputil/dump.go.html#5519786">pw</a></span><span class="op" id="5520384">)</span><span class="op" id="5520385">,</span>&nbsp;<span class="ident" id="5520387"><a href="/net/http/httputil/dump.go.html#5519839">dr</a></span><span class="op" id="5520389">}</span><span class="op" id="5520390">,</span>&nbsp;<span class="ident" id="5520392">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520398">}</span><span class="op" id="5520399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520406">_</span><span class="op" id="5520407">,</span>&nbsp;<span class="ident" id="5520409">err</span>&nbsp;<span class="op" id="5520413">:=</span>&nbsp;<span class="ident" id="5520416"><a href="/net/http/httputil/dump.go.html#5520241">t</a></span><span class="op" id="5520417">.</span><span class="ident" id="5520418">RoundTrip</span><span class="op" id="5520427">(</span><span class="ident" id="5520428"><a href="/net/http/httputil/dump.go.html#5519284">reqSend</a></span><span class="op" id="5520435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520439"><a href="/net/http/httputil/dump.go.html#5518641">req</a></span><span class="op" id="5520442">.</span><span class="ident" id="5520443">Body</span>&nbsp;<span class="op" id="5520448">=</span>&nbsp;<span class="ident" id="5520450"><a href="/net/http/httputil/dump.go.html#5518690">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520456">if</span>&nbsp;<span class="ident" id="5520459"><a href="/net/http/httputil/dump.go.html#5520409">err</a></span>&nbsp;<span class="op" id="5520463">!=</span>&nbsp;<span class="ident" id="5520466">nil</span>&nbsp;<span class="op" id="5520470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520474">return</span>&nbsp;<span class="ident" id="5520481">nil</span><span class="op" id="5520484">,</span>&nbsp;<span class="ident" id="5520486"><a href="/net/http/httputil/dump.go.html#5520409">err</a></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520494">dump</span>&nbsp;<span class="op" id="5520499">:=</span>&nbsp;<span class="ident" id="5520502"><a href="/net/http/httputil/dump.go.html#5519742">buf</a></span><span class="op" id="5520505">.</span><span class="ident" id="5520506">Bytes</span><span class="op" id="5520511">(</span><span class="op" id="5520512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520516">//&nbsp;If&nbsp;we&nbsp;used&nbsp;a&nbsp;dummy&nbsp;body&nbsp;above,&nbsp;remove&nbsp;it&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520566">//&nbsp;TODO:&nbsp;if&nbsp;the&nbsp;req.ContentLength&nbsp;is&nbsp;large,&nbsp;we&nbsp;allocate&nbsp;memory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520630">//&nbsp;unnecessarily&nbsp;just&nbsp;to&nbsp;slice&nbsp;it&nbsp;off&nbsp;here.&nbsp;&nbsp;But&nbsp;this&nbsp;is&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520693">//&nbsp;a&nbsp;debug&nbsp;function,&nbsp;so&nbsp;this&nbsp;is&nbsp;acceptable&nbsp;for&nbsp;now.&nbsp;We&nbsp;could</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520755">//&nbsp;discard&nbsp;the&nbsp;body&nbsp;earlier&nbsp;if&nbsp;this&nbsp;matters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520801">if</span>&nbsp;<span class="ident" id="5520804"><a href="/net/http/httputil/dump.go.html#5518708">dummyBody</a></span>&nbsp;<span class="op" id="5520814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520818">if</span>&nbsp;<span class="ident" id="5520821">i</span>&nbsp;<span class="op" id="5520823">:=</span>&nbsp;<span class="ident" id="5520826"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5520831">.</span><span class="ident" id="5520832">Index</span><span class="op" id="5520837">(</span><span class="ident" id="5520838"><a href="/net/http/httputil/dump.go.html#5520494">dump</a></span><span class="op" id="5520842">,</span>&nbsp;<span class="op" id="5520844">[</span><span class="op" id="5520845">]</span><span class="builtintype" id="5520846">byte</span><span class="op" id="5520850">(</span><span class="string" id="5520851">&#34;\r\n\r\n&#34;</span><span class="op" id="5520861">)</span><span class="op" id="5520862">)</span><span class="op" id="5520863">;</span>&nbsp;<span class="ident" id="5520865"><a href="/net/http/httputil/dump.go.html#5520821">i</a></span>&nbsp;<span class="op" id="5520867">&gt;=</span>&nbsp;<span class="num" id="5520870">0</span>&nbsp;<span class="op" id="5520872">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520877"><a href="/net/http/httputil/dump.go.html#5520494">dump</a></span>&nbsp;<span class="op" id="5520882">=</span>&nbsp;<span class="ident" id="5520884"><a href="/net/http/httputil/dump.go.html#5520494">dump</a></span><span class="op" id="5520888">[</span><span class="op" id="5520889">:</span><span class="ident" id="5520890"><a href="/net/http/httputil/dump.go.html#5520821">i</a></span><span class="op" id="5520891">+</span><span class="num" id="5520892">4</span><span class="op" id="5520893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520903">return</span>&nbsp;<span class="ident" id="5520910"><a href="/net/http/httputil/dump.go.html#5520494">dump</a></span><span class="op" id="5520914">,</span>&nbsp;<span class="ident" id="5520916">nil</span><br>
<span class="lineno"></span><span class="op" id="5520920">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="5520923">//&nbsp;delegateReader&nbsp;is&nbsp;a&nbsp;reader&nbsp;that&nbsp;delegates&nbsp;to&nbsp;another&nbsp;reader,</span><br>
<span class="lineno"></span><span class="comment" id="5520987">//&nbsp;once&nbsp;it&nbsp;arrives&nbsp;on&nbsp;a&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="5521020">type</span>&nbsp;<span class="ident" id="5521025">delegateReader</span>&nbsp;<span class="keyword" id="5521040">struct</span>&nbsp;<span class="op" id="5521047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521050">c</span>&nbsp;<span class="keyword" id="5521052">chan</span>&nbsp;<span class="ident" id="5521057"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5521059">.</span><span class="ident" id="5521060">Reader</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521068">r</span>&nbsp;<span class="ident" id="5521070"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5521072">.</span><span class="ident" id="5521073">Reader</span>&nbsp;<span class="comment" id="5521080">//&nbsp;nil&nbsp;until&nbsp;received&nbsp;from&nbsp;c</span><br>
<span class="lineno"></span><span class="op" id="5521109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521112">func</span>&nbsp;<span class="op" id="5521117">(</span><span class="ident" id="5521118">r</span>&nbsp;<span class="op" id="5521120">*</span><span class="ident" id="5521121"><a href="/net/http/httputil/dump.go.html#5521025">delegateReader</a></span><span class="op" id="5521135">)</span>&nbsp;<span class="ident" id="5521137">Read</span><span class="op" id="5521141">(</span><span class="ident" id="5521142">p</span>&nbsp;<span class="op" id="5521144">[</span><span class="op" id="5521145">]</span><span class="builtintype" id="5521146">byte</span><span class="op" id="5521150">)</span>&nbsp;<span class="op" id="5521152">(</span><span class="builtintype" id="5521153">int</span><span class="op" id="5521156">,</span>&nbsp;<span class="builtintype" id="5521158">error</span><span class="op" id="5521163">)</span>&nbsp;<span class="op" id="5521165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521168">if</span>&nbsp;<span class="ident" id="5521171"><a href="/net/http/httputil/dump.go.html#5521118">r</a></span><span class="op" id="5521172">.</span><span class="ident" id="5521173">r</span>&nbsp;<span class="op" id="5521175">==</span>&nbsp;<span class="ident" id="5521178">nil</span>&nbsp;<span class="op" id="5521182">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521186"><a href="/net/http/httputil/dump.go.html#5521118">r</a></span><span class="op" id="5521187">.</span><span class="ident" id="5521188">r</span>&nbsp;<span class="op" id="5521190">=</span>&nbsp;<span class="op" id="5521192">&lt;-</span><span class="ident" id="5521194"><a href="/net/http/httputil/dump.go.html#5521118">r</a></span><span class="op" id="5521195">.</span><span class="ident" id="5521196">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521202">return</span>&nbsp;<span class="ident" id="5521209"><a href="/net/http/httputil/dump.go.html#5521118">r</a></span><span class="op" id="5521210">.</span><span class="ident" id="5521211">r</span><span class="op" id="5521212">.</span><span class="ident" id="5521213">Read</span><span class="op" id="5521217">(</span><span class="ident" id="5521218"><a href="/net/http/httputil/dump.go.html#5521142">p</a></span><span class="op" id="5521219">)</span><br>
<span class="lineno"></span><span class="op" id="5521221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5521224">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="5521268">func</span>&nbsp;<span class="ident" id="5521273">valueOrDefault</span><span class="op" id="5521287">(</span><span class="ident" id="5521288">value</span><span class="op" id="5521293">,</span>&nbsp;<span class="ident" id="5521295">def</span>&nbsp;<span class="builtintype" id="5521299">string</span><span class="op" id="5521305">)</span>&nbsp;<span class="builtintype" id="5521307">string</span>&nbsp;<span class="op" id="5521314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521317">if</span>&nbsp;<span class="ident" id="5521320"><a href="/net/http/httputil/dump.go.html#5521288">value</a></span>&nbsp;<span class="op" id="5521326">!=</span>&nbsp;<span class="string" id="5521329">&#34;&#34;</span>&nbsp;<span class="op" id="5521332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521336">return</span>&nbsp;<span class="ident" id="5521343"><a href="/net/http/httputil/dump.go.html#5521288">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521350">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521353">return</span>&nbsp;<span class="ident" id="5521360"><a href="/net/http/httputil/dump.go.html#5521295">def</a></span><br>
<span class="lineno"></span><span class="op" id="5521364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521367">var</span>&nbsp;<span class="ident" id="5521371">reqWriteExcludeHeaderDump</span>&nbsp;<span class="op" id="5521397">=</span>&nbsp;<span class="keyword" id="5521399">map</span><span class="op" id="5521402">[</span><span class="builtintype" id="5521403">string</span><span class="op" id="5521409">]</span><span class="builtintype" id="5521410">bool</span><span class="op" id="5521414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5521417">&#34;Host&#34;</span><span class="op" id="5521423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5521438">true</span><span class="op" id="5521442">,</span>&nbsp;<span class="comment" id="5521444">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5521473">&#34;Content-Length&#34;</span><span class="op" id="5521489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5521494">true</span><span class="op" id="5521498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5521501">&#34;Transfer-Encoding&#34;</span><span class="op" id="5521520">:</span>&nbsp;<span class="builtintype" id="5521522">true</span><span class="op" id="5521526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5521529">&#34;Trailer&#34;</span><span class="op" id="5521538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5521550">true</span><span class="op" id="5521554">,</span><br>
<span class="lineno"></span><span class="op" id="5521556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5521559">//&nbsp;dumpAsReceived&nbsp;writes&nbsp;req&nbsp;to&nbsp;w&nbsp;in&nbsp;the&nbsp;form&nbsp;as&nbsp;it&nbsp;was&nbsp;received,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5521628">//&nbsp;at&nbsp;least&nbsp;as&nbsp;accurately&nbsp;as&nbsp;possible&nbsp;from&nbsp;the&nbsp;information&nbsp;retained&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5521699">//&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="5521715">func</span>&nbsp;<span class="ident" id="5521720">dumpAsReceived</span><span class="op" id="5521734">(</span><span class="ident" id="5521735">req</span>&nbsp;<span class="op" id="5521739">*</span><span class="ident" id="5521740"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5521744">.</span><span class="ident" id="5521745">Request</span><span class="op" id="5521752">,</span>&nbsp;<span class="ident" id="5521754">w</span>&nbsp;<span class="ident" id="5521756"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5521758">.</span><span class="ident" id="5521759">Writer</span><span class="op" id="5521765">)</span>&nbsp;<span class="builtintype" id="5521767">error</span>&nbsp;<span class="op" id="5521773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521776">return</span>&nbsp;<span class="ident" id="5521783">nil</span><br>
<span class="lineno">175</span><span class="op" id="5521787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5521790">//&nbsp;DumpRequest&nbsp;returns&nbsp;the&nbsp;as-received&nbsp;wire&nbsp;representation&nbsp;of&nbsp;req,</span><br>
<span class="lineno"></span><span class="comment" id="5521857">//&nbsp;optionally&nbsp;including&nbsp;the&nbsp;request&nbsp;body,&nbsp;for&nbsp;debugging.</span><br>
<span class="lineno"></span><span class="comment" id="5521914">//&nbsp;DumpRequest&nbsp;is&nbsp;semantically&nbsp;a&nbsp;no-op,&nbsp;but&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">180</span><span class="comment" id="5521970">//&nbsp;dump&nbsp;the&nbsp;body,&nbsp;it&nbsp;reads&nbsp;the&nbsp;body&nbsp;data&nbsp;into&nbsp;memory&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5522027">//&nbsp;changes&nbsp;req.Body&nbsp;to&nbsp;refer&nbsp;to&nbsp;the&nbsp;in-memory&nbsp;copy.</span><br>
<span class="lineno"></span><span class="comment" id="5522079">//&nbsp;The&nbsp;documentation&nbsp;for&nbsp;http.Request.Write&nbsp;details&nbsp;which&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="5522144">//&nbsp;of&nbsp;req&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="5522164">func</span>&nbsp;<span class="ident" id="5522169">DumpRequest</span><span class="op" id="5522180">(</span><span class="ident" id="5522181">req</span>&nbsp;<span class="op" id="5522185">*</span><span class="ident" id="5522186"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5522190">.</span><span class="ident" id="5522191">Request</span><span class="op" id="5522198">,</span>&nbsp;<span class="ident" id="5522200">body</span>&nbsp;<span class="builtintype" id="5522205">bool</span><span class="op" id="5522209">)</span>&nbsp;<span class="op" id="5522211">(</span><span class="ident" id="5522212">dump</span>&nbsp;<span class="op" id="5522217">[</span><span class="op" id="5522218">]</span><span class="builtintype" id="5522219">byte</span><span class="op" id="5522223">,</span>&nbsp;<span class="ident" id="5522225">err</span>&nbsp;<span class="builtintype" id="5522229">error</span><span class="op" id="5522234">)</span>&nbsp;<span class="op" id="5522236">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522239">save</span>&nbsp;<span class="op" id="5522244">:=</span>&nbsp;<span class="ident" id="5522247"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522250">.</span><span class="ident" id="5522251">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522257">if</span>&nbsp;<span class="op" id="5522260">!</span><span class="ident" id="5522261"><a href="/net/http/httputil/dump.go.html#5522200">body</a></span>&nbsp;<span class="op" id="5522266">||</span>&nbsp;<span class="ident" id="5522269"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522272">.</span><span class="ident" id="5522273">Body</span>&nbsp;<span class="op" id="5522278">==</span>&nbsp;<span class="ident" id="5522281">nil</span>&nbsp;<span class="op" id="5522285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522289"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522292">.</span><span class="ident" id="5522293">Body</span>&nbsp;<span class="op" id="5522298">=</span>&nbsp;<span class="ident" id="5522300">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522305">}</span>&nbsp;<span class="keyword" id="5522307">else</span>&nbsp;<span class="op" id="5522312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522316"><a href="/net/http/httputil/dump.go.html#5522239">save</a></span><span class="op" id="5522320">,</span>&nbsp;<span class="ident" id="5522322"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522325">.</span><span class="ident" id="5522326">Body</span><span class="op" id="5522330">,</span>&nbsp;<span class="ident" id="5522332"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5522336">=</span>&nbsp;<span class="ident" id="5522338"><a href="/net/http/httputil/dump.go.html#5517513">drainBody</a></span><span class="op" id="5522347">(</span><span class="ident" id="5522348"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522351">.</span><span class="ident" id="5522352">Body</span><span class="op" id="5522356">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522360">if</span>&nbsp;<span class="ident" id="5522363"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5522367">!=</span>&nbsp;<span class="ident" id="5522370">nil</span>&nbsp;<span class="op" id="5522374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522379">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522395">var</span>&nbsp;<span class="ident" id="5522399">b</span>&nbsp;<span class="ident" id="5522401"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5522406">.</span><span class="ident" id="5522407">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522416"><a href="/net/http/httputil/dump.go.html#5517183">fmt</a></span><span class="op" id="5522419">.</span><span class="ident" id="5522420">Fprintf</span><span class="op" id="5522427">(</span><span class="op" id="5522428">&amp;</span><span class="ident" id="5522429"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5522430">,</span>&nbsp;<span class="string" id="5522432">&#34;%s&nbsp;%s&nbsp;HTTP/%d.%d\r\n&#34;</span><span class="op" id="5522454">,</span>&nbsp;<span class="ident" id="5522456"><a href="/net/http/httputil/dump.go.html#5521273">valueOrDefault</a></span><span class="op" id="5522470">(</span><span class="ident" id="5522471"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522474">.</span><span class="ident" id="5522475">Method</span><span class="op" id="5522481">,</span>&nbsp;<span class="string" id="5522483">&#34;GET&#34;</span><span class="op" id="5522488">)</span><span class="op" id="5522489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522493"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522496">.</span><span class="ident" id="5522497">URL</span><span class="op" id="5522500">.</span><span class="ident" id="5522501">RequestURI</span><span class="op" id="5522511">(</span><span class="op" id="5522512">)</span><span class="op" id="5522513">,</span>&nbsp;<span class="ident" id="5522515"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522518">.</span><span class="ident" id="5522519">ProtoMajor</span><span class="op" id="5522529">,</span>&nbsp;<span class="ident" id="5522531"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522534">.</span><span class="ident" id="5522535">ProtoMinor</span><span class="op" id="5522545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522549">host</span>&nbsp;<span class="op" id="5522554">:=</span>&nbsp;<span class="ident" id="5522557"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522560">.</span><span class="ident" id="5522561">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522567">if</span>&nbsp;<span class="ident" id="5522570"><a href="/net/http/httputil/dump.go.html#5522549">host</a></span>&nbsp;<span class="op" id="5522575">==</span>&nbsp;<span class="string" id="5522578">&#34;&#34;</span>&nbsp;<span class="op" id="5522581">&amp;&amp;</span>&nbsp;<span class="ident" id="5522584"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522587">.</span><span class="ident" id="5522588">URL</span>&nbsp;<span class="op" id="5522592">!=</span>&nbsp;<span class="ident" id="5522595">nil</span>&nbsp;<span class="op" id="5522599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522603"><a href="/net/http/httputil/dump.go.html#5522549">host</a></span>&nbsp;<span class="op" id="5522608">=</span>&nbsp;<span class="ident" id="5522610"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522613">.</span><span class="ident" id="5522614">URL</span><span class="op" id="5522617">.</span><span class="ident" id="5522618">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522627">if</span>&nbsp;<span class="ident" id="5522630"><a href="/net/http/httputil/dump.go.html#5522549">host</a></span>&nbsp;<span class="op" id="5522635">!=</span>&nbsp;<span class="string" id="5522638">&#34;&#34;</span>&nbsp;<span class="op" id="5522641">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522645"><a href="/net/http/httputil/dump.go.html#5517183">fmt</a></span><span class="op" id="5522648">.</span><span class="ident" id="5522649">Fprintf</span><span class="op" id="5522656">(</span><span class="op" id="5522657">&amp;</span><span class="ident" id="5522658"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5522659">,</span>&nbsp;<span class="string" id="5522661">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="5522675">,</span>&nbsp;<span class="ident" id="5522677"><a href="/net/http/httputil/dump.go.html#5522549">host</a></span><span class="op" id="5522681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522688">chunked</span>&nbsp;<span class="op" id="5522696">:=</span>&nbsp;<span class="builtinfunc" id="5522699">len</span><span class="op" id="5522702">(</span><span class="ident" id="5522703"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522706">.</span><span class="ident" id="5522707">TransferEncoding</span><span class="op" id="5522723">)</span>&nbsp;<span class="op" id="5522725">&gt;</span>&nbsp;<span class="num" id="5522727">0</span>&nbsp;<span class="op" id="5522729">&amp;&amp;</span>&nbsp;<span class="ident" id="5522732"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522735">.</span><span class="ident" id="5522736">TransferEncoding</span><span class="op" id="5522752">[</span><span class="num" id="5522753">0</span><span class="op" id="5522754">]</span>&nbsp;<span class="op" id="5522756">==</span>&nbsp;<span class="string" id="5522759">&#34;chunked&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522770">if</span>&nbsp;<span class="builtinfunc" id="5522773">len</span><span class="op" id="5522776">(</span><span class="ident" id="5522777"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522780">.</span><span class="ident" id="5522781">TransferEncoding</span><span class="op" id="5522797">)</span>&nbsp;<span class="op" id="5522799">&gt;</span>&nbsp;<span class="num" id="5522801">0</span>&nbsp;<span class="op" id="5522803">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522807"><a href="/net/http/httputil/dump.go.html#5517183">fmt</a></span><span class="op" id="5522810">.</span><span class="ident" id="5522811">Fprintf</span><span class="op" id="5522818">(</span><span class="op" id="5522819">&amp;</span><span class="ident" id="5522820"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5522821">,</span>&nbsp;<span class="string" id="5522823">&#34;Transfer-Encoding:&nbsp;%s\r\n&#34;</span><span class="op" id="5522850">,</span>&nbsp;<span class="ident" id="5522852"><a href="/net/http/httputil/dump.go.html#5517239">strings</a></span><span class="op" id="5522859">.</span><span class="ident" id="5522860">Join</span><span class="op" id="5522864">(</span><span class="ident" id="5522865"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522868">.</span><span class="ident" id="5522869">TransferEncoding</span><span class="op" id="5522885">,</span>&nbsp;<span class="string" id="5522887">&#34;,&#34;</span><span class="op" id="5522890">)</span><span class="op" id="5522891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522897">if</span>&nbsp;<span class="ident" id="5522900"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522903">.</span><span class="ident" id="5522904">Close</span>&nbsp;<span class="op" id="5522910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522914"><a href="/net/http/httputil/dump.go.html#5517183">fmt</a></span><span class="op" id="5522917">.</span><span class="ident" id="5522918">Fprintf</span><span class="op" id="5522925">(</span><span class="op" id="5522926">&amp;</span><span class="ident" id="5522927"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5522928">,</span>&nbsp;<span class="string" id="5522930">&#34;Connection:&nbsp;close\r\n&#34;</span><span class="op" id="5522953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522956">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522960"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5522964">=</span>&nbsp;<span class="ident" id="5522966"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5522969">.</span><span class="ident" id="5522970">Header</span><span class="op" id="5522976">.</span><span class="ident" id="5522977">WriteSubset</span><span class="op" id="5522988">(</span><span class="op" id="5522989">&amp;</span><span class="ident" id="5522990"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5522991">,</span>&nbsp;<span class="ident" id="5522993"><a href="/net/http/httputil/dump.go.html#5521371">reqWriteExcludeHeaderDump</a></span><span class="op" id="5523018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523021">if</span>&nbsp;<span class="ident" id="5523024"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5523028">!=</span>&nbsp;<span class="ident" id="5523031">nil</span>&nbsp;<span class="op" id="5523035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523047">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523051"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5523053">.</span><span class="ident" id="5523054">WriteString</span><span class="op" id="5523065">(</span><span class="op" id="5523066">&amp;</span><span class="ident" id="5523067"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5523068">,</span>&nbsp;<span class="string" id="5523070">&#34;\r\n&#34;</span><span class="op" id="5523076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523080">if</span>&nbsp;<span class="ident" id="5523083"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5523086">.</span><span class="ident" id="5523087">Body</span>&nbsp;<span class="op" id="5523092">!=</span>&nbsp;<span class="ident" id="5523095">nil</span>&nbsp;<span class="op" id="5523099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523103">var</span>&nbsp;<span class="ident" id="5523107">dest</span>&nbsp;<span class="ident" id="5523112"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5523114">.</span><span class="ident" id="5523115">Writer</span>&nbsp;<span class="op" id="5523122">=</span>&nbsp;<span class="op" id="5523124">&amp;</span><span class="ident" id="5523125"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523129">if</span>&nbsp;<span class="ident" id="5523132"><a href="/net/http/httputil/dump.go.html#5522688">chunked</a></span>&nbsp;<span class="op" id="5523140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523145"><a href="/net/http/httputil/dump.go.html#5523107">dest</a></span>&nbsp;<span class="op" id="5523150">=</span>&nbsp;<span class="ident" id="5523152"><a href="/net/http/httputil/httputil.go.html#5525898">NewChunkedWriter</a></span><span class="op" id="5523168">(</span><span class="ident" id="5523169"><a href="/net/http/httputil/dump.go.html#5523107">dest</a></span><span class="op" id="5523173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523181">_</span><span class="op" id="5523182">,</span>&nbsp;<span class="ident" id="5523184"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5523188">=</span>&nbsp;<span class="ident" id="5523190"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5523192">.</span><span class="ident" id="5523193">Copy</span><span class="op" id="5523197">(</span><span class="ident" id="5523198"><a href="/net/http/httputil/dump.go.html#5523107">dest</a></span><span class="op" id="5523202">,</span>&nbsp;<span class="ident" id="5523204"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5523207">.</span><span class="ident" id="5523208">Body</span><span class="op" id="5523212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523216">if</span>&nbsp;<span class="ident" id="5523219"><a href="/net/http/httputil/dump.go.html#5522688">chunked</a></span>&nbsp;<span class="op" id="5523227">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523232"><a href="/net/http/httputil/dump.go.html#5523107">dest</a></span><span class="op" id="5523236">.</span><span class="op" id="5523237">(</span><span class="ident" id="5523238"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5523240">.</span><span class="ident" id="5523241">Closer</span><span class="op" id="5523247">)</span><span class="op" id="5523248">.</span><span class="ident" id="5523249">Close</span><span class="op" id="5523254">(</span><span class="op" id="5523255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523260"><a href="/net/http/httputil/dump.go.html#5517190">io</a></span><span class="op" id="5523262">.</span><span class="ident" id="5523263">WriteString</span><span class="op" id="5523274">(</span><span class="op" id="5523275">&amp;</span><span class="ident" id="5523276"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5523277">,</span>&nbsp;<span class="string" id="5523279">&#34;\r\n&#34;</span><span class="op" id="5523285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523296"><a href="/net/http/httputil/dump.go.html#5522181">req</a></span><span class="op" id="5523299">.</span><span class="ident" id="5523300">Body</span>&nbsp;<span class="op" id="5523305">=</span>&nbsp;<span class="ident" id="5523307"><a href="/net/http/httputil/dump.go.html#5522239">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523313">if</span>&nbsp;<span class="ident" id="5523316"><a href="/net/http/httputil/dump.go.html#5522225">err</a></span>&nbsp;<span class="op" id="5523320">!=</span>&nbsp;<span class="ident" id="5523323">nil</span>&nbsp;<span class="op" id="5523327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523342"><a href="/net/http/httputil/dump.go.html#5522212">dump</a></span>&nbsp;<span class="op" id="5523347">=</span>&nbsp;<span class="ident" id="5523349"><a href="/net/http/httputil/dump.go.html#5522399">b</a></span><span class="op" id="5523350">.</span><span class="ident" id="5523351">Bytes</span><span class="op" id="5523356">(</span><span class="op" id="5523357">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523360">return</span><br>
<span class="lineno"></span><span class="op" id="5523367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5523370">//&nbsp;errNoBody&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;error&nbsp;value&nbsp;used&nbsp;by&nbsp;failureToReadBody&nbsp;so&nbsp;we&nbsp;can&nbsp;detect</span><br>
<span class="lineno"></span><span class="comment" id="5523452">//&nbsp;that&nbsp;the&nbsp;lack&nbsp;of&nbsp;body&nbsp;was&nbsp;intentional.</span><br>
<span class="lineno">245</span><span class="keyword" id="5523494">var</span>&nbsp;<span class="ident" id="5523498">errNoBody</span>&nbsp;<span class="op" id="5523508">=</span>&nbsp;<span class="ident" id="5523510"><a href="/net/http/httputil/dump.go.html#5517173">errors</a></span><span class="op" id="5523516">.</span><span class="ident" id="5523517">New</span><span class="op" id="5523520">(</span><span class="string" id="5523521">&#34;sentinel&nbsp;error&nbsp;value&#34;</span><span class="op" id="5523543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5523546">//&nbsp;failureToReadBody&nbsp;is&nbsp;a&nbsp;io.ReadCloser&nbsp;that&nbsp;just&nbsp;returns&nbsp;errNoBody&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5523617">//&nbsp;Read.&nbsp;&nbsp;It&#39;s&nbsp;swapped&nbsp;in&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;want&nbsp;to&nbsp;consume&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5523686">//&nbsp;body,&nbsp;but&nbsp;need&nbsp;a&nbsp;non-nil&nbsp;one,&nbsp;and&nbsp;want&nbsp;to&nbsp;distinguish&nbsp;the&nbsp;error</span><br>
<span class="lineno">250</span><span class="comment" id="5523753">//&nbsp;from&nbsp;reading&nbsp;the&nbsp;dummy&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5523785">type</span>&nbsp;<span class="ident" id="5523790">failureToReadBody</span>&nbsp;<span class="keyword" id="5523808">struct</span><span class="op" id="5523814">{</span><span class="op" id="5523815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523818">func</span>&nbsp;<span class="op" id="5523823">(</span><span class="ident" id="5523824"><a href="/net/http/httputil/dump.go.html#5523790">failureToReadBody</a></span><span class="op" id="5523841">)</span>&nbsp;<span class="ident" id="5523843">Read</span><span class="op" id="5523847">(</span><span class="op" id="5523848">[</span><span class="op" id="5523849">]</span><span class="builtintype" id="5523850">byte</span><span class="op" id="5523854">)</span>&nbsp;<span class="op" id="5523856">(</span><span class="builtintype" id="5523857">int</span><span class="op" id="5523860">,</span>&nbsp;<span class="builtintype" id="5523862">error</span><span class="op" id="5523867">)</span>&nbsp;<span class="op" id="5523869">{</span>&nbsp;<span class="keyword" id="5523871">return</span>&nbsp;<span class="num" id="5523878">0</span><span class="op" id="5523879">,</span>&nbsp;<span class="ident" id="5523881"><a href="/net/http/httputil/dump.go.html#5523498">errNoBody</a></span>&nbsp;<span class="op" id="5523891">}</span><br>
<span class="lineno"></span><span class="keyword" id="5523893">func</span>&nbsp;<span class="op" id="5523898">(</span><span class="ident" id="5523899"><a href="/net/http/httputil/dump.go.html#5523790">failureToReadBody</a></span><span class="op" id="5523916">)</span>&nbsp;<span class="ident" id="5523918">Close</span><span class="op" id="5523923">(</span><span class="op" id="5523924">)</span>&nbsp;<span class="builtintype" id="5523926">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5523944">{</span>&nbsp;<span class="keyword" id="5523946">return</span>&nbsp;<span class="ident" id="5523953">nil</span>&nbsp;<span class="op" id="5523957">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5523960">var</span>&nbsp;<span class="ident" id="5523964">emptyBody</span>&nbsp;<span class="op" id="5523974">=</span>&nbsp;<span class="ident" id="5523976"><a href="/net/http/httputil/dump.go.html#5517196">ioutil</a></span><span class="op" id="5523982">.</span><span class="ident" id="5523983">NopCloser</span><span class="op" id="5523992">(</span><span class="ident" id="5523993"><a href="/net/http/httputil/dump.go.html#5517239">strings</a></span><span class="op" id="5524000">.</span><span class="ident" id="5524001">NewReader</span><span class="op" id="5524010">(</span><span class="string" id="5524011">&#34;&#34;</span><span class="op" id="5524013">)</span><span class="op" id="5524014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524017">//&nbsp;DumpResponse&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;dumps&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="5524075">func</span>&nbsp;<span class="ident" id="5524080">DumpResponse</span><span class="op" id="5524092">(</span><span class="ident" id="5524093">resp</span>&nbsp;<span class="op" id="5524098">*</span><span class="ident" id="5524099"><a href="/net/http/httputil/dump.go.html#5517216">http</a></span><span class="op" id="5524103">.</span><span class="ident" id="5524104">Response</span><span class="op" id="5524112">,</span>&nbsp;<span class="ident" id="5524114">body</span>&nbsp;<span class="builtintype" id="5524119">bool</span><span class="op" id="5524123">)</span>&nbsp;<span class="op" id="5524125">(</span><span class="ident" id="5524126">dump</span>&nbsp;<span class="op" id="5524131">[</span><span class="op" id="5524132">]</span><span class="builtintype" id="5524133">byte</span><span class="op" id="5524137">,</span>&nbsp;<span class="ident" id="5524139">err</span>&nbsp;<span class="builtintype" id="5524143">error</span><span class="op" id="5524148">)</span>&nbsp;<span class="op" id="5524150">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524153">var</span>&nbsp;<span class="ident" id="5524157">b</span>&nbsp;<span class="ident" id="5524159"><a href="/net/http/httputil/dump.go.html#5517164">bytes</a></span><span class="op" id="5524164">.</span><span class="ident" id="5524165">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524173">save</span>&nbsp;<span class="op" id="5524178">:=</span>&nbsp;<span class="ident" id="5524181"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524185">.</span><span class="ident" id="5524186">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524192">savecl</span>&nbsp;<span class="op" id="5524199">:=</span>&nbsp;<span class="ident" id="5524202"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524206">.</span><span class="ident" id="5524207">ContentLength</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524223">if</span>&nbsp;<span class="op" id="5524226">!</span><span class="ident" id="5524227"><a href="/net/http/httputil/dump.go.html#5524114">body</a></span>&nbsp;<span class="op" id="5524232">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524236"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524240">.</span><span class="ident" id="5524241">Body</span>&nbsp;<span class="op" id="5524246">=</span>&nbsp;<span class="ident" id="5524248"><a href="/net/http/httputil/dump.go.html#5523790">failureToReadBody</a></span><span class="op" id="5524265">{</span><span class="op" id="5524266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524269">}</span>&nbsp;<span class="keyword" id="5524271">else</span>&nbsp;<span class="keyword" id="5524276">if</span>&nbsp;<span class="ident" id="5524279"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524283">.</span><span class="ident" id="5524284">Body</span>&nbsp;<span class="op" id="5524289">==</span>&nbsp;<span class="ident" id="5524292">nil</span>&nbsp;<span class="op" id="5524296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524300"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524304">.</span><span class="ident" id="5524305">Body</span>&nbsp;<span class="op" id="5524310">=</span>&nbsp;<span class="ident" id="5524312"><a href="/net/http/httputil/dump.go.html#5523964">emptyBody</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524323">}</span>&nbsp;<span class="keyword" id="5524325">else</span>&nbsp;<span class="op" id="5524330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524334"><a href="/net/http/httputil/dump.go.html#5524173">save</a></span><span class="op" id="5524338">,</span>&nbsp;<span class="ident" id="5524340"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524344">.</span><span class="ident" id="5524345">Body</span><span class="op" id="5524349">,</span>&nbsp;<span class="ident" id="5524351"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524355">=</span>&nbsp;<span class="ident" id="5524357"><a href="/net/http/httputil/dump.go.html#5517513">drainBody</a></span><span class="op" id="5524366">(</span><span class="ident" id="5524367"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524371">.</span><span class="ident" id="5524372">Body</span><span class="op" id="5524376">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524380">if</span>&nbsp;<span class="ident" id="5524383"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524387">!=</span>&nbsp;<span class="ident" id="5524390">nil</span>&nbsp;<span class="op" id="5524394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524414"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524418">=</span>&nbsp;<span class="ident" id="5524420"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524424">.</span><span class="ident" id="5524425">Write</span><span class="op" id="5524430">(</span><span class="op" id="5524431">&amp;</span><span class="ident" id="5524432"><a href="/net/http/httputil/dump.go.html#5524157">b</a></span><span class="op" id="5524433">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524436">if</span>&nbsp;<span class="ident" id="5524439"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524443">==</span>&nbsp;<span class="ident" id="5524446"><a href="/net/http/httputil/dump.go.html#5523498">errNoBody</a></span>&nbsp;<span class="op" id="5524456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524460"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524464">=</span>&nbsp;<span class="ident" id="5524466">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524474"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524478">.</span><span class="ident" id="5524479">Body</span>&nbsp;<span class="op" id="5524484">=</span>&nbsp;<span class="ident" id="5524486"><a href="/net/http/httputil/dump.go.html#5524173">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524492"><a href="/net/http/httputil/dump.go.html#5524093">resp</a></span><span class="op" id="5524496">.</span><span class="ident" id="5524497">ContentLength</span>&nbsp;<span class="op" id="5524511">=</span>&nbsp;<span class="ident" id="5524513"><a href="/net/http/httputil/dump.go.html#5524192">savecl</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524521">if</span>&nbsp;<span class="ident" id="5524524"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span>&nbsp;<span class="op" id="5524528">!=</span>&nbsp;<span class="ident" id="5524531">nil</span>&nbsp;<span class="op" id="5524535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524539">return</span>&nbsp;<span class="ident" id="5524546">nil</span><span class="op" id="5524549">,</span>&nbsp;<span class="ident" id="5524551"><a href="/net/http/httputil/dump.go.html#5524139">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524559">return</span>&nbsp;<span class="ident" id="5524566"><a href="/net/http/httputil/dump.go.html#5524157">b</a></span><span class="op" id="5524567">.</span><span class="ident" id="5524568">Bytes</span><span class="op" id="5524573">(</span><span class="op" id="5524574">)</span><span class="op" id="5524575">,</span>&nbsp;<span class="ident" id="5524577">nil</span><br>
<span class="lineno"></span><span class="op" id="5524581">}</span>
</div>
</body>
</html>
