<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5903078">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5903133">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5903187">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5903238">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5903291">package</span>&nbsp;<span class="ident" id="5903299">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5903308">import</span>&nbsp;<span class="op" id="5903315">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903318">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903325">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903335">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903347">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903353">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903359">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903370">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903381">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5903399">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5903409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5903412">const</span>&nbsp;<span class="op" id="5903418">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903421">maxNewlines</span>&nbsp;<span class="op" id="5903433">=</span>&nbsp;<span class="num" id="5903435">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903441">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903489">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903501">=</span>&nbsp;<span class="builtintype" id="5903503">false</span>&nbsp;<span class="comment" id="5903509">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903534">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903546">=</span>&nbsp;<span class="num" id="5903548">1</span>&nbsp;<span class="op" id="5903550">&lt;&lt;</span>&nbsp;<span class="num" id="5903553">30</span><br>
<span class="lineno"></span><span class="op" id="5903556">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5903559">type</span>&nbsp;<span class="ident" id="5903564">whiteSpace</span>&nbsp;<span class="builtintype" id="5903575">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5903581">const</span>&nbsp;<span class="op" id="5903587">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903590">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5903599">=</span>&nbsp;<span class="ident" id="5903601">whiteSpace</span><span class="op" id="5903611">(</span><span class="num" id="5903612">0</span><span class="op" id="5903613">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903616">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903625">=</span>&nbsp;<span class="ident" id="5903627">whiteSpace</span><span class="op" id="5903637">(</span><span class="string" id="5903638">&#39;&nbsp;&#39;</span><span class="op" id="5903641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903644">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903653">=</span>&nbsp;<span class="ident" id="5903655">whiteSpace</span><span class="op" id="5903665">(</span><span class="string" id="5903666">&#39;\v&#39;</span><span class="op" id="5903670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903673">newline</span>&nbsp;&nbsp;<span class="op" id="5903682">=</span>&nbsp;<span class="ident" id="5903684">whiteSpace</span><span class="op" id="5903694">(</span><span class="string" id="5903695">&#39;\n&#39;</span><span class="op" id="5903699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903702">formfeed</span>&nbsp;<span class="op" id="5903711">=</span>&nbsp;<span class="ident" id="5903713">whiteSpace</span><span class="op" id="5903723">(</span><span class="string" id="5903724">&#39;\f&#39;</span><span class="op" id="5903728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903731">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5903740">=</span>&nbsp;<span class="ident" id="5903742">whiteSpace</span><span class="op" id="5903752">(</span><span class="string" id="5903753">&#39;&gt;&#39;</span><span class="op" id="5903756">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903759">unindent</span>&nbsp;<span class="op" id="5903768">=</span>&nbsp;<span class="ident" id="5903770">whiteSpace</span><span class="op" id="5903780">(</span><span class="string" id="5903781">&#39;&lt;&#39;</span><span class="op" id="5903784">)</span><br>
<span class="lineno"></span><span class="op" id="5903786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5903789">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5903843">type</span>&nbsp;<span class="ident" id="5903848">pmode</span>&nbsp;<span class="builtintype" id="5903854">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5903859">const</span>&nbsp;<span class="op" id="5903865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903868">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903885">pmode</span>&nbsp;<span class="op" id="5903891">=</span>&nbsp;<span class="num" id="5903893">1</span>&nbsp;<span class="op" id="5903895">&lt;&lt;</span>&nbsp;<span class="ident" id="5903898">iota</span>&nbsp;<span class="comment" id="5903903">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903951">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5903986">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5904038">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5904041">type</span>&nbsp;<span class="ident" id="5904046">commentInfo</span>&nbsp;<span class="keyword" id="5904058">struct</span>&nbsp;<span class="op" id="5904065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904068">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5904083">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904101">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904127">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904142">*</span><span class="ident" id="5904143">ast</span><span class="op" id="5904146">.</span><span class="ident" id="5904147">CommentGroup</span>&nbsp;<span class="comment" id="5904160">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904199">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5904214">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904232">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904313">commentNewline</span>&nbsp;<span class="builtintype" id="5904328">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904346">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5904393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5904396">type</span>&nbsp;<span class="ident" id="5904401">printer</span>&nbsp;<span class="keyword" id="5904409">struct</span>&nbsp;<span class="op" id="5904416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904419">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904476">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904484">fset</span>&nbsp;<span class="op" id="5904489">*</span><span class="ident" id="5904490">token</span><span class="op" id="5904495">.</span><span class="ident" id="5904496">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904506">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904524">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904536">[</span><span class="op" id="5904537">]</span><span class="builtintype" id="5904538">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904549">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904572">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5904584">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904597">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904621">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904633">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904646">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904671">impliedSemi</span>&nbsp;<span class="builtintype" id="5904683">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5904696">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904740">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904752">token</span><span class="op" id="5904757">.</span><span class="ident" id="5904758">Token</span>&nbsp;&nbsp;<span class="comment" id="5904765">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904823">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904835">token</span><span class="op" id="5904840">.</span><span class="ident" id="5904841">Token</span>&nbsp;&nbsp;<span class="comment" id="5904848">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904907">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5904919">[</span><span class="op" id="5904920">]</span><span class="ident" id="5904921">whiteSpace</span>&nbsp;<span class="comment" id="5904932">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904957">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904971">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905038">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905106">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905172">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905238">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905282">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905290">token</span><span class="op" id="5905295">.</span><span class="ident" id="5905296">Position</span>&nbsp;<span class="comment" id="5905305">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905348">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905356">token</span><span class="op" id="5905361">.</span><span class="ident" id="5905362">Position</span>&nbsp;<span class="comment" id="5905371">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905408">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5905416">token</span><span class="op" id="5905421">.</span><span class="ident" id="5905422">Position</span>&nbsp;<span class="comment" id="5905431">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905474">linePtr</span>&nbsp;<span class="op" id="5905482">*</span><span class="builtintype" id="5905483">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905497">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905557">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905618">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905634">[</span><span class="op" id="5905635">]</span><span class="op" id="5905636">*</span><span class="ident" id="5905637">ast</span><span class="op" id="5905640">.</span><span class="ident" id="5905641">CommentGroup</span>&nbsp;<span class="comment" id="5905654">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905669">useNodeComments</span>&nbsp;<span class="builtintype" id="5905685">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5905705">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905761">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905828">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905842">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905884">nodeSizes</span>&nbsp;<span class="keyword" id="5905894">map</span><span class="op" id="5905897">[</span><span class="ident" id="5905898">ast</span><span class="op" id="5905901">.</span><span class="ident" id="5905902">Node</span><span class="op" id="5905906">]</span><span class="builtintype" id="5905907">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905913">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905964">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5905975">token</span><span class="op" id="5905980">.</span><span class="ident" id="5905981">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905986">cachedLine</span>&nbsp;<span class="builtintype" id="5905997">int</span>&nbsp;<span class="comment" id="5906001">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5906036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906039">func</span>&nbsp;<span class="op" id="5906044">(</span><span class="ident" id="5906045">p</span>&nbsp;<span class="op" id="5906047">*</span><span class="ident" id="5906048">printer</span><span class="op" id="5906055">)</span>&nbsp;<span class="ident" id="5906057">init</span><span class="op" id="5906061">(</span><span class="ident" id="5906062">cfg</span>&nbsp;<span class="op" id="5906066">*</span><span class="ident" id="5906067">Config</span><span class="op" id="5906073">,</span>&nbsp;<span class="ident" id="5906075">fset</span>&nbsp;<span class="op" id="5906080">*</span><span class="ident" id="5906081">token</span><span class="op" id="5906086">.</span><span class="ident" id="5906087">FileSet</span><span class="op" id="5906094">,</span>&nbsp;<span class="ident" id="5906096">nodeSizes</span>&nbsp;<span class="keyword" id="5906106">map</span><span class="op" id="5906109">[</span><span class="ident" id="5906110">ast</span><span class="op" id="5906113">.</span><span class="ident" id="5906114">Node</span><span class="op" id="5906118">]</span><span class="builtintype" id="5906119">int</span><span class="op" id="5906122">)</span>&nbsp;<span class="op" id="5906124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906127">p</span><span class="op" id="5906128">.</span><span class="ident" id="5906129">Config</span>&nbsp;<span class="op" id="5906136">=</span>&nbsp;<span class="op" id="5906138">*</span><span class="ident" id="5906139">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906144">p</span><span class="op" id="5906145">.</span><span class="ident" id="5906146">fset</span>&nbsp;<span class="op" id="5906151">=</span>&nbsp;<span class="ident" id="5906153">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906159">p</span><span class="op" id="5906160">.</span><span class="ident" id="5906161">pos</span>&nbsp;<span class="op" id="5906165">=</span>&nbsp;<span class="ident" id="5906167">token</span><span class="op" id="5906172">.</span><span class="ident" id="5906173">Position</span><span class="op" id="5906181">{</span><span class="ident" id="5906182">Line</span><span class="op" id="5906186">:</span>&nbsp;<span class="num" id="5906188">1</span><span class="op" id="5906189">,</span>&nbsp;<span class="ident" id="5906191">Column</span><span class="op" id="5906197">:</span>&nbsp;<span class="num" id="5906199">1</span><span class="op" id="5906200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906203">p</span><span class="op" id="5906204">.</span><span class="ident" id="5906205">out</span>&nbsp;<span class="op" id="5906209">=</span>&nbsp;<span class="ident" id="5906211">token</span><span class="op" id="5906216">.</span><span class="ident" id="5906217">Position</span><span class="op" id="5906225">{</span><span class="ident" id="5906226">Line</span><span class="op" id="5906230">:</span>&nbsp;<span class="num" id="5906232">1</span><span class="op" id="5906233">,</span>&nbsp;<span class="ident" id="5906235">Column</span><span class="op" id="5906241">:</span>&nbsp;<span class="num" id="5906243">1</span><span class="op" id="5906244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906247">p</span><span class="op" id="5906248">.</span><span class="ident" id="5906249">wsbuf</span>&nbsp;<span class="op" id="5906255">=</span>&nbsp;<span class="builtinfunc" id="5906257">make</span><span class="op" id="5906261">(</span><span class="op" id="5906262">[</span><span class="op" id="5906263">]</span><span class="ident" id="5906264">whiteSpace</span><span class="op" id="5906274">,</span>&nbsp;<span class="num" id="5906276">0</span><span class="op" id="5906277">,</span>&nbsp;<span class="num" id="5906279">16</span><span class="op" id="5906281">)</span>&nbsp;<span class="comment" id="5906283">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906318">p</span><span class="op" id="5906319">.</span><span class="ident" id="5906320">nodeSizes</span>&nbsp;<span class="op" id="5906330">=</span>&nbsp;<span class="ident" id="5906332">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906343">p</span><span class="op" id="5906344">.</span><span class="ident" id="5906345">cachedPos</span>&nbsp;<span class="op" id="5906355">=</span>&nbsp;<span class="op" id="5906357">-</span><span class="num" id="5906358">1</span><br>
<span class="lineno"></span><span class="op" id="5906360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906363">func</span>&nbsp;<span class="op" id="5906368">(</span><span class="ident" id="5906369">p</span>&nbsp;<span class="op" id="5906371">*</span><span class="ident" id="5906372">printer</span><span class="op" id="5906379">)</span>&nbsp;<span class="ident" id="5906381">internalError</span><span class="op" id="5906394">(</span><span class="ident" id="5906395">msg</span>&nbsp;<span class="op" id="5906399">...</span><span class="keyword" id="5906402">interface</span><span class="op" id="5906411">{</span><span class="op" id="5906412">}</span><span class="op" id="5906413">)</span>&nbsp;<span class="op" id="5906415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906418">if</span>&nbsp;<span class="ident" id="5906421">debug</span>&nbsp;<span class="op" id="5906427">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906431">fmt</span><span class="op" id="5906434">.</span><span class="ident" id="5906435">Print</span><span class="op" id="5906440">(</span><span class="ident" id="5906441">p</span><span class="op" id="5906442">.</span><span class="ident" id="5906443">pos</span><span class="op" id="5906446">.</span><span class="ident" id="5906447">String</span><span class="op" id="5906453">(</span><span class="op" id="5906454">)</span>&nbsp;<span class="op" id="5906456">+</span>&nbsp;<span class="string" id="5906458">&#34;:&nbsp;&#34;</span><span class="op" id="5906462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906466">fmt</span><span class="op" id="5906469">.</span><span class="ident" id="5906470">Println</span><span class="op" id="5906477">(</span><span class="ident" id="5906478">msg</span><span class="op" id="5906481">...</span><span class="op" id="5906484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5906488">panic</span><span class="op" id="5906493">(</span><span class="string" id="5906494">&#34;go/printer&#34;</span><span class="op" id="5906506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906509">}</span><br>
<span class="lineno"></span><span class="op" id="5906511">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5906514">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5906585">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5906661">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5906734">func</span>&nbsp;<span class="op" id="5906739">(</span><span class="ident" id="5906740">p</span>&nbsp;<span class="op" id="5906742">*</span><span class="ident" id="5906743">printer</span><span class="op" id="5906750">)</span>&nbsp;<span class="ident" id="5906752">commentsHaveNewline</span><span class="op" id="5906771">(</span><span class="ident" id="5906772">list</span>&nbsp;<span class="op" id="5906777">[</span><span class="op" id="5906778">]</span><span class="op" id="5906779">*</span><span class="ident" id="5906780">ast</span><span class="op" id="5906783">.</span><span class="ident" id="5906784">Comment</span><span class="op" id="5906791">)</span>&nbsp;<span class="builtintype" id="5906793">bool</span>&nbsp;<span class="op" id="5906798">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906801">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906819">line</span>&nbsp;<span class="op" id="5906824">:=</span>&nbsp;<span class="ident" id="5906827">p</span><span class="op" id="5906828">.</span><span class="ident" id="5906829">lineFor</span><span class="op" id="5906836">(</span><span class="ident" id="5906837">list</span><span class="op" id="5906841">[</span><span class="num" id="5906842">0</span><span class="op" id="5906843">]</span><span class="op" id="5906844">.</span><span class="ident" id="5906845">Pos</span><span class="op" id="5906848">(</span><span class="op" id="5906849">)</span><span class="op" id="5906850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906853">for</span>&nbsp;<span class="ident" id="5906857">i</span><span class="op" id="5906858">,</span>&nbsp;<span class="ident" id="5906860">c</span>&nbsp;<span class="op" id="5906862">:=</span>&nbsp;<span class="keyword" id="5906865">range</span>&nbsp;<span class="ident" id="5906871">list</span>&nbsp;<span class="op" id="5906876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906880">if</span>&nbsp;<span class="ident" id="5906883">i</span>&nbsp;<span class="op" id="5906885">&gt;</span>&nbsp;<span class="num" id="5906887">0</span>&nbsp;<span class="op" id="5906889">&amp;&amp;</span>&nbsp;<span class="ident" id="5906892">p</span><span class="op" id="5906893">.</span><span class="ident" id="5906894">lineFor</span><span class="op" id="5906901">(</span><span class="ident" id="5906902">list</span><span class="op" id="5906906">[</span><span class="ident" id="5906907">i</span><span class="op" id="5906908">]</span><span class="op" id="5906909">.</span><span class="ident" id="5906910">Pos</span><span class="op" id="5906913">(</span><span class="op" id="5906914">)</span><span class="op" id="5906915">)</span>&nbsp;<span class="op" id="5906917">!=</span>&nbsp;<span class="ident" id="5906920">line</span>&nbsp;<span class="op" id="5906925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906930">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906970">return</span>&nbsp;<span class="builtintype" id="5906977">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906988">if</span>&nbsp;<span class="ident" id="5906991">t</span>&nbsp;<span class="op" id="5906993">:=</span>&nbsp;<span class="ident" id="5906996">c</span><span class="op" id="5906997">.</span><span class="ident" id="5906998">Text</span><span class="op" id="5907002">;</span>&nbsp;<span class="builtinfunc" id="5907004">len</span><span class="op" id="5907007">(</span><span class="ident" id="5907008">t</span><span class="op" id="5907009">)</span>&nbsp;<span class="op" id="5907011">&gt;=</span>&nbsp;<span class="num" id="5907014">2</span>&nbsp;<span class="op" id="5907016">&amp;&amp;</span>&nbsp;<span class="op" id="5907019">(</span><span class="ident" id="5907020">t</span><span class="op" id="5907021">[</span><span class="num" id="5907022">1</span><span class="op" id="5907023">]</span>&nbsp;<span class="op" id="5907025">==</span>&nbsp;<span class="string" id="5907028">&#39;/&#39;</span>&nbsp;<span class="op" id="5907032">||</span>&nbsp;<span class="ident" id="5907035">strings</span><span class="op" id="5907042">.</span><span class="ident" id="5907043">Contains</span><span class="op" id="5907051">(</span><span class="ident" id="5907052">t</span><span class="op" id="5907053">,</span>&nbsp;<span class="string" id="5907055">&#34;\n&#34;</span><span class="op" id="5907059">)</span><span class="op" id="5907060">)</span>&nbsp;<span class="op" id="5907062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907067">return</span>&nbsp;<span class="builtintype" id="5907074">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907081">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907087">_</span>&nbsp;<span class="op" id="5907089">=</span>&nbsp;<span class="ident" id="5907091">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907097">return</span>&nbsp;<span class="builtintype" id="5907104">false</span><br>
<span class="lineno"></span><span class="op" id="5907110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5907113">func</span>&nbsp;<span class="op" id="5907118">(</span><span class="ident" id="5907119">p</span>&nbsp;<span class="op" id="5907121">*</span><span class="ident" id="5907122">printer</span><span class="op" id="5907129">)</span>&nbsp;<span class="ident" id="5907131">nextComment</span><span class="op" id="5907142">(</span><span class="op" id="5907143">)</span>&nbsp;<span class="op" id="5907145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907148">for</span>&nbsp;<span class="ident" id="5907152">p</span><span class="op" id="5907153">.</span><span class="ident" id="5907154">cindex</span>&nbsp;<span class="op" id="5907161">&lt;</span>&nbsp;<span class="builtinfunc" id="5907163">len</span><span class="op" id="5907166">(</span><span class="ident" id="5907167">p</span><span class="op" id="5907168">.</span><span class="ident" id="5907169">comments</span><span class="op" id="5907177">)</span>&nbsp;<span class="op" id="5907179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907183">c</span>&nbsp;<span class="op" id="5907185">:=</span>&nbsp;<span class="ident" id="5907188">p</span><span class="op" id="5907189">.</span><span class="ident" id="5907190">comments</span><span class="op" id="5907198">[</span><span class="ident" id="5907199">p</span><span class="op" id="5907200">.</span><span class="ident" id="5907201">cindex</span><span class="op" id="5907207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907211">p</span><span class="op" id="5907212">.</span><span class="ident" id="5907213">cindex</span><span class="op" id="5907219">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907224">if</span>&nbsp;<span class="ident" id="5907227">list</span>&nbsp;<span class="op" id="5907232">:=</span>&nbsp;<span class="ident" id="5907235">c</span><span class="op" id="5907236">.</span><span class="ident" id="5907237">List</span><span class="op" id="5907241">;</span>&nbsp;<span class="builtinfunc" id="5907243">len</span><span class="op" id="5907246">(</span><span class="ident" id="5907247">list</span><span class="op" id="5907251">)</span>&nbsp;<span class="op" id="5907253">&gt;</span>&nbsp;<span class="num" id="5907255">0</span>&nbsp;<span class="op" id="5907257">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907262">p</span><span class="op" id="5907263">.</span><span class="ident" id="5907264">comment</span>&nbsp;<span class="op" id="5907272">=</span>&nbsp;<span class="ident" id="5907274">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907279">p</span><span class="op" id="5907280">.</span><span class="ident" id="5907281">commentOffset</span>&nbsp;<span class="op" id="5907295">=</span>&nbsp;<span class="ident" id="5907297">p</span><span class="op" id="5907298">.</span><span class="ident" id="5907299">posFor</span><span class="op" id="5907305">(</span><span class="ident" id="5907306">list</span><span class="op" id="5907310">[</span><span class="num" id="5907311">0</span><span class="op" id="5907312">]</span><span class="op" id="5907313">.</span><span class="ident" id="5907314">Pos</span><span class="op" id="5907317">(</span><span class="op" id="5907318">)</span><span class="op" id="5907319">)</span><span class="op" id="5907320">.</span><span class="ident" id="5907321">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907331">p</span><span class="op" id="5907332">.</span><span class="ident" id="5907333">commentNewline</span>&nbsp;<span class="op" id="5907348">=</span>&nbsp;<span class="ident" id="5907350">p</span><span class="op" id="5907351">.</span><span class="ident" id="5907352">commentsHaveNewline</span><span class="op" id="5907371">(</span><span class="ident" id="5907372">list</span><span class="op" id="5907376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907381">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907390">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907394">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907455">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907521">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907542">p</span><span class="op" id="5907543">.</span><span class="ident" id="5907544">commentOffset</span>&nbsp;<span class="op" id="5907558">=</span>&nbsp;<span class="ident" id="5907560">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5907569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907572">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5907639">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5907707">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5907745">//</span><br>
<span class="lineno"></span><span class="keyword" id="5907748">func</span>&nbsp;<span class="op" id="5907753">(</span><span class="ident" id="5907754">p</span>&nbsp;<span class="op" id="5907756">*</span><span class="ident" id="5907757">printer</span><span class="op" id="5907764">)</span>&nbsp;<span class="ident" id="5907766">commentBefore</span><span class="op" id="5907779">(</span><span class="ident" id="5907780">next</span>&nbsp;<span class="ident" id="5907785">token</span><span class="op" id="5907790">.</span><span class="ident" id="5907791">Position</span><span class="op" id="5907799">)</span>&nbsp;<span class="builtintype" id="5907801">bool</span>&nbsp;<span class="op" id="5907806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907809">return</span>&nbsp;<span class="ident" id="5907816">p</span><span class="op" id="5907817">.</span><span class="ident" id="5907818">commentOffset</span>&nbsp;<span class="op" id="5907832">&lt;</span>&nbsp;<span class="ident" id="5907834">next</span><span class="op" id="5907838">.</span><span class="ident" id="5907839">Offset</span>&nbsp;<span class="op" id="5907846">&amp;&amp;</span>&nbsp;<span class="op" id="5907849">(</span><span class="op" id="5907850">!</span><span class="ident" id="5907851">p</span><span class="op" id="5907852">.</span><span class="ident" id="5907853">impliedSemi</span>&nbsp;<span class="op" id="5907865">||</span>&nbsp;<span class="op" id="5907868">!</span><span class="ident" id="5907869">p</span><span class="op" id="5907870">.</span><span class="ident" id="5907871">commentNewline</span><span class="op" id="5907885">)</span><br>
<span class="lineno"></span><span class="op" id="5907887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5907890">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5907945">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5908000">//</span><br>
<span class="lineno"></span><span class="keyword" id="5908003">func</span>&nbsp;<span class="op" id="5908008">(</span><span class="ident" id="5908009">p</span>&nbsp;<span class="op" id="5908011">*</span><span class="ident" id="5908012">printer</span><span class="op" id="5908019">)</span>&nbsp;<span class="ident" id="5908021">commentSizeBefore</span><span class="op" id="5908038">(</span><span class="ident" id="5908039">next</span>&nbsp;<span class="ident" id="5908044">token</span><span class="op" id="5908049">.</span><span class="ident" id="5908050">Position</span><span class="op" id="5908058">)</span>&nbsp;<span class="builtintype" id="5908060">int</span>&nbsp;<span class="op" id="5908064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908067">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908136">defer</span>&nbsp;<span class="keyword" id="5908142">func</span><span class="op" id="5908146">(</span><span class="ident" id="5908147">info</span>&nbsp;<span class="ident" id="5908152">commentInfo</span><span class="op" id="5908163">)</span>&nbsp;<span class="op" id="5908165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908169">p</span><span class="op" id="5908170">.</span><span class="ident" id="5908171">commentInfo</span>&nbsp;<span class="op" id="5908183">=</span>&nbsp;<span class="ident" id="5908185">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908191">}</span><span class="op" id="5908192">(</span><span class="ident" id="5908193">p</span><span class="op" id="5908194">.</span><span class="ident" id="5908195">commentInfo</span><span class="op" id="5908206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908210">size</span>&nbsp;<span class="op" id="5908215">:=</span>&nbsp;<span class="num" id="5908218">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908221">for</span>&nbsp;<span class="ident" id="5908225">p</span><span class="op" id="5908226">.</span><span class="ident" id="5908227">commentBefore</span><span class="op" id="5908240">(</span><span class="ident" id="5908241">next</span><span class="op" id="5908245">)</span>&nbsp;<span class="op" id="5908247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908251">for</span>&nbsp;<span class="ident" id="5908255">_</span><span class="op" id="5908256">,</span>&nbsp;<span class="ident" id="5908258">c</span>&nbsp;<span class="op" id="5908260">:=</span>&nbsp;<span class="keyword" id="5908263">range</span>&nbsp;<span class="ident" id="5908269">p</span><span class="op" id="5908270">.</span><span class="ident" id="5908271">comment</span><span class="op" id="5908278">.</span><span class="ident" id="5908279">List</span>&nbsp;<span class="op" id="5908284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908289">size</span>&nbsp;<span class="op" id="5908294">+=</span>&nbsp;<span class="builtinfunc" id="5908297">len</span><span class="op" id="5908300">(</span><span class="ident" id="5908301">c</span><span class="op" id="5908302">.</span><span class="ident" id="5908303">Text</span><span class="op" id="5908307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908315">p</span><span class="op" id="5908316">.</span><span class="ident" id="5908317">nextComment</span><span class="op" id="5908328">(</span><span class="op" id="5908329">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908335">return</span>&nbsp;<span class="ident" id="5908342">size</span><br>
<span class="lineno"></span><span class="op" id="5908347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908350">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5908423">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5908497">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5908573">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5908589">//</span><br>
<span class="lineno"></span><span class="keyword" id="5908592">func</span>&nbsp;<span class="op" id="5908597">(</span><span class="ident" id="5908598">p</span>&nbsp;<span class="op" id="5908600">*</span><span class="ident" id="5908601">printer</span><span class="op" id="5908608">)</span>&nbsp;<span class="ident" id="5908610">recordLine</span><span class="op" id="5908620">(</span><span class="ident" id="5908621">linePtr</span>&nbsp;<span class="op" id="5908629">*</span><span class="builtintype" id="5908630">int</span><span class="op" id="5908633">)</span>&nbsp;<span class="op" id="5908635">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908638">p</span><span class="op" id="5908639">.</span><span class="ident" id="5908640">linePtr</span>&nbsp;<span class="op" id="5908648">=</span>&nbsp;<span class="ident" id="5908650">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5908658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908661">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5908729">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5908797">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5908867">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5908923">//</span><br>
<span class="lineno"></span><span class="keyword" id="5908926">func</span>&nbsp;<span class="op" id="5908931">(</span><span class="ident" id="5908932">p</span>&nbsp;<span class="op" id="5908934">*</span><span class="ident" id="5908935">printer</span><span class="op" id="5908942">)</span>&nbsp;<span class="ident" id="5908944">linesFrom</span><span class="op" id="5908953">(</span><span class="ident" id="5908954">line</span>&nbsp;<span class="builtintype" id="5908959">int</span><span class="op" id="5908962">)</span>&nbsp;<span class="builtintype" id="5908964">int</span>&nbsp;<span class="op" id="5908968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908971">return</span>&nbsp;<span class="ident" id="5908978">p</span><span class="op" id="5908979">.</span><span class="ident" id="5908980">out</span><span class="op" id="5908983">.</span><span class="ident" id="5908984">Line</span>&nbsp;<span class="op" id="5908989">-</span>&nbsp;<span class="ident" id="5908991">line</span><br>
<span class="lineno">190</span><span class="op" id="5908996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5908999">func</span>&nbsp;<span class="op" id="5909004">(</span><span class="ident" id="5909005">p</span>&nbsp;<span class="op" id="5909007">*</span><span class="ident" id="5909008">printer</span><span class="op" id="5909015">)</span>&nbsp;<span class="ident" id="5909017">posFor</span><span class="op" id="5909023">(</span><span class="ident" id="5909024">pos</span>&nbsp;<span class="ident" id="5909028">token</span><span class="op" id="5909033">.</span><span class="ident" id="5909034">Pos</span><span class="op" id="5909037">)</span>&nbsp;<span class="ident" id="5909039">token</span><span class="op" id="5909044">.</span><span class="ident" id="5909045">Position</span>&nbsp;<span class="op" id="5909054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909057">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909119">return</span>&nbsp;<span class="ident" id="5909126">p</span><span class="op" id="5909127">.</span><span class="ident" id="5909128">fset</span><span class="op" id="5909132">.</span><span class="ident" id="5909133">Position</span><span class="op" id="5909141">(</span><span class="ident" id="5909142">pos</span><span class="op" id="5909145">)</span><br>
<span class="lineno">195</span><span class="op" id="5909147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5909150">func</span>&nbsp;<span class="op" id="5909155">(</span><span class="ident" id="5909156">p</span>&nbsp;<span class="op" id="5909158">*</span><span class="ident" id="5909159">printer</span><span class="op" id="5909166">)</span>&nbsp;<span class="ident" id="5909168">lineFor</span><span class="op" id="5909175">(</span><span class="ident" id="5909176">pos</span>&nbsp;<span class="ident" id="5909180">token</span><span class="op" id="5909185">.</span><span class="ident" id="5909186">Pos</span><span class="op" id="5909189">)</span>&nbsp;<span class="builtintype" id="5909191">int</span>&nbsp;<span class="op" id="5909195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909198">if</span>&nbsp;<span class="ident" id="5909201">pos</span>&nbsp;<span class="op" id="5909205">!=</span>&nbsp;<span class="ident" id="5909208">p</span><span class="op" id="5909209">.</span><span class="ident" id="5909210">cachedPos</span>&nbsp;<span class="op" id="5909220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909224">p</span><span class="op" id="5909225">.</span><span class="ident" id="5909226">cachedPos</span>&nbsp;<span class="op" id="5909236">=</span>&nbsp;<span class="ident" id="5909238">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909244">p</span><span class="op" id="5909245">.</span><span class="ident" id="5909246">cachedLine</span>&nbsp;<span class="op" id="5909257">=</span>&nbsp;<span class="ident" id="5909259">p</span><span class="op" id="5909260">.</span><span class="ident" id="5909261">fset</span><span class="op" id="5909265">.</span><span class="ident" id="5909266">Position</span><span class="op" id="5909274">(</span><span class="ident" id="5909275">pos</span><span class="op" id="5909278">)</span><span class="op" id="5909279">.</span><span class="ident" id="5909280">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909289">return</span>&nbsp;<span class="ident" id="5909296">p</span><span class="op" id="5909297">.</span><span class="ident" id="5909298">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5909309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5909312">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5909387">func</span>&nbsp;<span class="op" id="5909392">(</span><span class="ident" id="5909393">p</span>&nbsp;<span class="op" id="5909395">*</span><span class="ident" id="5909396">printer</span><span class="op" id="5909403">)</span>&nbsp;<span class="ident" id="5909405">atLineBegin</span><span class="op" id="5909416">(</span><span class="ident" id="5909417">pos</span>&nbsp;<span class="ident" id="5909421">token</span><span class="op" id="5909426">.</span><span class="ident" id="5909427">Position</span><span class="op" id="5909435">)</span>&nbsp;<span class="op" id="5909437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909440">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909480">if</span>&nbsp;<span class="ident" id="5909483">p</span><span class="op" id="5909484">.</span><span class="ident" id="5909485">Config</span><span class="op" id="5909491">.</span><span class="ident" id="5909492">Mode</span><span class="op" id="5909496">&amp;</span><span class="ident" id="5909497">SourcePos</span>&nbsp;<span class="op" id="5909507">!=</span>&nbsp;<span class="num" id="5909510">0</span>&nbsp;<span class="op" id="5909512">&amp;&amp;</span>&nbsp;<span class="ident" id="5909515">pos</span><span class="op" id="5909518">.</span><span class="ident" id="5909519">IsValid</span><span class="op" id="5909526">(</span><span class="op" id="5909527">)</span>&nbsp;<span class="op" id="5909529">&amp;&amp;</span>&nbsp;<span class="op" id="5909532">(</span><span class="ident" id="5909533">p</span><span class="op" id="5909534">.</span><span class="ident" id="5909535">out</span><span class="op" id="5909538">.</span><span class="ident" id="5909539">Line</span>&nbsp;<span class="op" id="5909544">!=</span>&nbsp;<span class="ident" id="5909547">pos</span><span class="op" id="5909550">.</span><span class="ident" id="5909551">Line</span>&nbsp;<span class="op" id="5909556">||</span>&nbsp;<span class="ident" id="5909559">p</span><span class="op" id="5909560">.</span><span class="ident" id="5909561">out</span><span class="op" id="5909564">.</span><span class="ident" id="5909565">Filename</span>&nbsp;<span class="op" id="5909574">!=</span>&nbsp;<span class="ident" id="5909577">pos</span><span class="op" id="5909580">.</span><span class="ident" id="5909581">Filename</span><span class="op" id="5909589">)</span>&nbsp;<span class="op" id="5909591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909595">p</span><span class="op" id="5909596">.</span><span class="ident" id="5909597">output</span>&nbsp;<span class="op" id="5909604">=</span>&nbsp;<span class="builtinfunc" id="5909606">append</span><span class="op" id="5909612">(</span><span class="ident" id="5909613">p</span><span class="op" id="5909614">.</span><span class="ident" id="5909615">output</span><span class="op" id="5909621">,</span>&nbsp;<span class="ident" id="5909623">tabwriter</span><span class="op" id="5909632">.</span><span class="ident" id="5909633">Escape</span><span class="op" id="5909639">)</span>&nbsp;<span class="comment" id="5909641">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909699">p</span><span class="op" id="5909700">.</span><span class="ident" id="5909701">output</span>&nbsp;<span class="op" id="5909708">=</span>&nbsp;<span class="builtinfunc" id="5909710">append</span><span class="op" id="5909716">(</span><span class="ident" id="5909717">p</span><span class="op" id="5909718">.</span><span class="ident" id="5909719">output</span><span class="op" id="5909725">,</span>&nbsp;<span class="ident" id="5909727">fmt</span><span class="op" id="5909730">.</span><span class="ident" id="5909731">Sprintf</span><span class="op" id="5909738">(</span><span class="string" id="5909739">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5909755">,</span>&nbsp;<span class="ident" id="5909757">pos</span><span class="op" id="5909760">.</span><span class="ident" id="5909761">Filename</span><span class="op" id="5909769">,</span>&nbsp;<span class="ident" id="5909771">pos</span><span class="op" id="5909774">.</span><span class="ident" id="5909775">Line</span><span class="op" id="5909779">)</span><span class="op" id="5909780">...</span><span class="op" id="5909783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909787">p</span><span class="op" id="5909788">.</span><span class="ident" id="5909789">output</span>&nbsp;<span class="op" id="5909796">=</span>&nbsp;<span class="builtinfunc" id="5909798">append</span><span class="op" id="5909804">(</span><span class="ident" id="5909805">p</span><span class="op" id="5909806">.</span><span class="ident" id="5909807">output</span><span class="op" id="5909813">,</span>&nbsp;<span class="ident" id="5909815">tabwriter</span><span class="op" id="5909824">.</span><span class="ident" id="5909825">Escape</span><span class="op" id="5909831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909835">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909876">p</span><span class="op" id="5909877">.</span><span class="ident" id="5909878">out</span><span class="op" id="5909881">.</span><span class="ident" id="5909882">Filename</span>&nbsp;<span class="op" id="5909891">=</span>&nbsp;<span class="ident" id="5909893">pos</span><span class="op" id="5909896">.</span><span class="ident" id="5909897">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909908">p</span><span class="op" id="5909909">.</span><span class="ident" id="5909910">out</span><span class="op" id="5909913">.</span><span class="ident" id="5909914">Line</span>&nbsp;<span class="op" id="5909919">=</span>&nbsp;<span class="ident" id="5909921">pos</span><span class="op" id="5909924">.</span><span class="ident" id="5909925">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909935">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909957">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910000">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910043">n</span>&nbsp;<span class="op" id="5910045">:=</span>&nbsp;<span class="ident" id="5910048">p</span><span class="op" id="5910049">.</span><span class="ident" id="5910050">Config</span><span class="op" id="5910056">.</span><span class="ident" id="5910057">Indent</span>&nbsp;<span class="op" id="5910064">+</span>&nbsp;<span class="ident" id="5910066">p</span><span class="op" id="5910067">.</span><span class="ident" id="5910068">indent</span>&nbsp;<span class="comment" id="5910075">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910104">for</span>&nbsp;<span class="ident" id="5910108">i</span>&nbsp;<span class="op" id="5910110">:=</span>&nbsp;<span class="num" id="5910113">0</span><span class="op" id="5910114">;</span>&nbsp;<span class="ident" id="5910116">i</span>&nbsp;<span class="op" id="5910118">&lt;</span>&nbsp;<span class="ident" id="5910120">n</span><span class="op" id="5910121">;</span>&nbsp;<span class="ident" id="5910123">i</span><span class="op" id="5910124">++</span>&nbsp;<span class="op" id="5910127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910131">p</span><span class="op" id="5910132">.</span><span class="ident" id="5910133">output</span>&nbsp;<span class="op" id="5910140">=</span>&nbsp;<span class="builtinfunc" id="5910142">append</span><span class="op" id="5910148">(</span><span class="ident" id="5910149">p</span><span class="op" id="5910150">.</span><span class="ident" id="5910151">output</span><span class="op" id="5910157">,</span>&nbsp;<span class="string" id="5910159">&#39;\t&#39;</span><span class="op" id="5910163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910170">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910191">p</span><span class="op" id="5910192">.</span><span class="ident" id="5910193">pos</span><span class="op" id="5910196">.</span><span class="ident" id="5910197">Offset</span>&nbsp;<span class="op" id="5910204">+=</span>&nbsp;<span class="ident" id="5910207">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910210">p</span><span class="op" id="5910211">.</span><span class="ident" id="5910212">pos</span><span class="op" id="5910215">.</span><span class="ident" id="5910216">Column</span>&nbsp;<span class="op" id="5910223">+=</span>&nbsp;<span class="ident" id="5910226">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910229">p</span><span class="op" id="5910230">.</span><span class="ident" id="5910231">out</span><span class="op" id="5910234">.</span><span class="ident" id="5910235">Column</span>&nbsp;<span class="op" id="5910242">+=</span>&nbsp;<span class="ident" id="5910245">n</span><br>
<span class="lineno"></span><span class="op" id="5910247">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5910250">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5910312">func</span>&nbsp;<span class="op" id="5910317">(</span><span class="ident" id="5910318">p</span>&nbsp;<span class="op" id="5910320">*</span><span class="ident" id="5910321">printer</span><span class="op" id="5910328">)</span>&nbsp;<span class="ident" id="5910330">writeByte</span><span class="op" id="5910339">(</span><span class="ident" id="5910340">ch</span>&nbsp;<span class="builtintype" id="5910343">byte</span><span class="op" id="5910347">,</span>&nbsp;<span class="ident" id="5910349">n</span>&nbsp;<span class="builtintype" id="5910351">int</span><span class="op" id="5910354">)</span>&nbsp;<span class="op" id="5910356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910359">if</span>&nbsp;<span class="ident" id="5910362">p</span><span class="op" id="5910363">.</span><span class="ident" id="5910364">out</span><span class="op" id="5910367">.</span><span class="ident" id="5910368">Column</span>&nbsp;<span class="op" id="5910375">==</span>&nbsp;<span class="num" id="5910378">1</span>&nbsp;<span class="op" id="5910380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910384">p</span><span class="op" id="5910385">.</span><span class="ident" id="5910386">atLineBegin</span><span class="op" id="5910397">(</span><span class="ident" id="5910398">p</span><span class="op" id="5910399">.</span><span class="ident" id="5910400">pos</span><span class="op" id="5910403">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910410">for</span>&nbsp;<span class="ident" id="5910414">i</span>&nbsp;<span class="op" id="5910416">:=</span>&nbsp;<span class="num" id="5910419">0</span><span class="op" id="5910420">;</span>&nbsp;<span class="ident" id="5910422">i</span>&nbsp;<span class="op" id="5910424">&lt;</span>&nbsp;<span class="ident" id="5910426">n</span><span class="op" id="5910427">;</span>&nbsp;<span class="ident" id="5910429">i</span><span class="op" id="5910430">++</span>&nbsp;<span class="op" id="5910433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910437">p</span><span class="op" id="5910438">.</span><span class="ident" id="5910439">output</span>&nbsp;<span class="op" id="5910446">=</span>&nbsp;<span class="builtinfunc" id="5910448">append</span><span class="op" id="5910454">(</span><span class="ident" id="5910455">p</span><span class="op" id="5910456">.</span><span class="ident" id="5910457">output</span><span class="op" id="5910463">,</span>&nbsp;<span class="ident" id="5910465">ch</span><span class="op" id="5910467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910470">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910474">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910495">p</span><span class="op" id="5910496">.</span><span class="ident" id="5910497">pos</span><span class="op" id="5910500">.</span><span class="ident" id="5910501">Offset</span>&nbsp;<span class="op" id="5910508">+=</span>&nbsp;<span class="ident" id="5910511">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910514">if</span>&nbsp;<span class="ident" id="5910517">ch</span>&nbsp;<span class="op" id="5910520">==</span>&nbsp;<span class="string" id="5910523">&#39;\n&#39;</span>&nbsp;<span class="op" id="5910528">||</span>&nbsp;<span class="ident" id="5910531">ch</span>&nbsp;<span class="op" id="5910534">==</span>&nbsp;<span class="string" id="5910537">&#39;\f&#39;</span>&nbsp;<span class="op" id="5910542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910546">p</span><span class="op" id="5910547">.</span><span class="ident" id="5910548">pos</span><span class="op" id="5910551">.</span><span class="ident" id="5910552">Line</span>&nbsp;<span class="op" id="5910557">+=</span>&nbsp;<span class="ident" id="5910560">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910564">p</span><span class="op" id="5910565">.</span><span class="ident" id="5910566">out</span><span class="op" id="5910569">.</span><span class="ident" id="5910570">Line</span>&nbsp;<span class="op" id="5910575">+=</span>&nbsp;<span class="ident" id="5910578">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910582">p</span><span class="op" id="5910583">.</span><span class="ident" id="5910584">pos</span><span class="op" id="5910587">.</span><span class="ident" id="5910588">Column</span>&nbsp;<span class="op" id="5910595">=</span>&nbsp;<span class="num" id="5910597">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910601">p</span><span class="op" id="5910602">.</span><span class="ident" id="5910603">out</span><span class="op" id="5910606">.</span><span class="ident" id="5910607">Column</span>&nbsp;<span class="op" id="5910614">=</span>&nbsp;<span class="num" id="5910616">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910620">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910628">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910631">p</span><span class="op" id="5910632">.</span><span class="ident" id="5910633">pos</span><span class="op" id="5910636">.</span><span class="ident" id="5910637">Column</span>&nbsp;<span class="op" id="5910644">+=</span>&nbsp;<span class="ident" id="5910647">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910650">p</span><span class="op" id="5910651">.</span><span class="ident" id="5910652">out</span><span class="op" id="5910655">.</span><span class="ident" id="5910656">Column</span>&nbsp;<span class="op" id="5910663">+=</span>&nbsp;<span class="ident" id="5910666">n</span><br>
<span class="lineno"></span><span class="op" id="5910668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5910671">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5910744">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5910820">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5910877">//</span><br>
<span class="lineno"></span><span class="comment" id="5910880">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5910948">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5911021">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5911093">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5911169">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5911242">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5911277">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5911280">func</span>&nbsp;<span class="op" id="5911285">(</span><span class="ident" id="5911286">p</span>&nbsp;<span class="op" id="5911288">*</span><span class="ident" id="5911289">printer</span><span class="op" id="5911296">)</span>&nbsp;<span class="ident" id="5911298">writeString</span><span class="op" id="5911309">(</span><span class="ident" id="5911310">pos</span>&nbsp;<span class="ident" id="5911314">token</span><span class="op" id="5911319">.</span><span class="ident" id="5911320">Position</span><span class="op" id="5911328">,</span>&nbsp;<span class="ident" id="5911330">s</span>&nbsp;<span class="builtintype" id="5911332">string</span><span class="op" id="5911338">,</span>&nbsp;<span class="ident" id="5911340">isLit</span>&nbsp;<span class="builtintype" id="5911346">bool</span><span class="op" id="5911350">)</span>&nbsp;<span class="op" id="5911352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911355">if</span>&nbsp;<span class="ident" id="5911358">p</span><span class="op" id="5911359">.</span><span class="ident" id="5911360">out</span><span class="op" id="5911363">.</span><span class="ident" id="5911364">Column</span>&nbsp;<span class="op" id="5911371">==</span>&nbsp;<span class="num" id="5911374">1</span>&nbsp;<span class="op" id="5911376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911380">p</span><span class="op" id="5911381">.</span><span class="ident" id="5911382">atLineBegin</span><span class="op" id="5911393">(</span><span class="ident" id="5911394">pos</span><span class="op" id="5911397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911404">if</span>&nbsp;<span class="ident" id="5911407">pos</span><span class="op" id="5911410">.</span><span class="ident" id="5911411">IsValid</span><span class="op" id="5911418">(</span><span class="op" id="5911419">)</span>&nbsp;<span class="op" id="5911421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911425">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911493">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911556">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911621">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911648">p</span><span class="op" id="5911649">.</span><span class="ident" id="5911650">pos</span>&nbsp;<span class="op" id="5911654">=</span>&nbsp;<span class="ident" id="5911656">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911665">if</span>&nbsp;<span class="ident" id="5911668">isLit</span>&nbsp;<span class="op" id="5911674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911678">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911735">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911794">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911856">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911878">p</span><span class="op" id="5911879">.</span><span class="ident" id="5911880">output</span>&nbsp;<span class="op" id="5911887">=</span>&nbsp;<span class="builtinfunc" id="5911889">append</span><span class="op" id="5911895">(</span><span class="ident" id="5911896">p</span><span class="op" id="5911897">.</span><span class="ident" id="5911898">output</span><span class="op" id="5911904">,</span>&nbsp;<span class="ident" id="5911906">tabwriter</span><span class="op" id="5911915">.</span><span class="ident" id="5911916">Escape</span><span class="op" id="5911922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911925">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911929">if</span>&nbsp;<span class="ident" id="5911932">debug</span>&nbsp;<span class="op" id="5911938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911942">p</span><span class="op" id="5911943">.</span><span class="ident" id="5911944">output</span>&nbsp;<span class="op" id="5911951">=</span>&nbsp;<span class="builtinfunc" id="5911953">append</span><span class="op" id="5911959">(</span><span class="ident" id="5911960">p</span><span class="op" id="5911961">.</span><span class="ident" id="5911962">output</span><span class="op" id="5911968">,</span>&nbsp;<span class="ident" id="5911970">fmt</span><span class="op" id="5911973">.</span><span class="ident" id="5911974">Sprintf</span><span class="op" id="5911981">(</span><span class="string" id="5911982">&#34;/*%s*/&#34;</span><span class="op" id="5911990">,</span>&nbsp;<span class="ident" id="5911992">pos</span><span class="op" id="5911995">)</span><span class="op" id="5911996">...</span><span class="op" id="5911999">)</span>&nbsp;<span class="comment" id="5912001">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912029">p</span><span class="op" id="5912030">.</span><span class="ident" id="5912031">output</span>&nbsp;<span class="op" id="5912038">=</span>&nbsp;<span class="builtinfunc" id="5912040">append</span><span class="op" id="5912046">(</span><span class="ident" id="5912047">p</span><span class="op" id="5912048">.</span><span class="ident" id="5912049">output</span><span class="op" id="5912055">,</span>&nbsp;<span class="ident" id="5912057">s</span><span class="op" id="5912058">...</span><span class="op" id="5912061">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912065">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912086">nlines</span>&nbsp;<span class="op" id="5912093">:=</span>&nbsp;<span class="num" id="5912096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912099">var</span>&nbsp;<span class="ident" id="5912103">li</span>&nbsp;<span class="builtintype" id="5912106">int</span>&nbsp;<span class="comment" id="5912110">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912157">for</span>&nbsp;<span class="ident" id="5912161">i</span>&nbsp;<span class="op" id="5912163">:=</span>&nbsp;<span class="num" id="5912166">0</span><span class="op" id="5912167">;</span>&nbsp;<span class="ident" id="5912169">i</span>&nbsp;<span class="op" id="5912171">&lt;</span>&nbsp;<span class="builtinfunc" id="5912173">len</span><span class="op" id="5912176">(</span><span class="ident" id="5912177">s</span><span class="op" id="5912178">)</span><span class="op" id="5912179">;</span>&nbsp;<span class="ident" id="5912181">i</span><span class="op" id="5912182">++</span>&nbsp;<span class="op" id="5912185">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912189">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912249">if</span>&nbsp;<span class="ident" id="5912252">s</span><span class="op" id="5912253">[</span><span class="ident" id="5912254">i</span><span class="op" id="5912255">]</span>&nbsp;<span class="op" id="5912257">==</span>&nbsp;<span class="string" id="5912260">&#39;\n&#39;</span>&nbsp;<span class="op" id="5912265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912270">nlines</span><span class="op" id="5912276">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912282">li</span>&nbsp;<span class="op" id="5912285">=</span>&nbsp;<span class="ident" id="5912287">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912291">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912297">p</span><span class="op" id="5912298">.</span><span class="ident" id="5912299">pos</span><span class="op" id="5912302">.</span><span class="ident" id="5912303">Offset</span>&nbsp;<span class="op" id="5912310">+=</span>&nbsp;<span class="builtinfunc" id="5912313">len</span><span class="op" id="5912316">(</span><span class="ident" id="5912317">s</span><span class="op" id="5912318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912321">if</span>&nbsp;<span class="ident" id="5912324">nlines</span>&nbsp;<span class="op" id="5912331">&gt;</span>&nbsp;<span class="num" id="5912333">0</span>&nbsp;<span class="op" id="5912335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912339">p</span><span class="op" id="5912340">.</span><span class="ident" id="5912341">pos</span><span class="op" id="5912344">.</span><span class="ident" id="5912345">Line</span>&nbsp;<span class="op" id="5912350">+=</span>&nbsp;<span class="ident" id="5912353">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912362">p</span><span class="op" id="5912363">.</span><span class="ident" id="5912364">out</span><span class="op" id="5912367">.</span><span class="ident" id="5912368">Line</span>&nbsp;<span class="op" id="5912373">+=</span>&nbsp;<span class="ident" id="5912376">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912385">c</span>&nbsp;<span class="op" id="5912387">:=</span>&nbsp;<span class="builtinfunc" id="5912390">len</span><span class="op" id="5912393">(</span><span class="ident" id="5912394">s</span><span class="op" id="5912395">)</span>&nbsp;<span class="op" id="5912397">-</span>&nbsp;<span class="ident" id="5912399">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912404">p</span><span class="op" id="5912405">.</span><span class="ident" id="5912406">pos</span><span class="op" id="5912409">.</span><span class="ident" id="5912410">Column</span>&nbsp;<span class="op" id="5912417">=</span>&nbsp;<span class="ident" id="5912419">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912423">p</span><span class="op" id="5912424">.</span><span class="ident" id="5912425">out</span><span class="op" id="5912428">.</span><span class="ident" id="5912429">Column</span>&nbsp;<span class="op" id="5912436">=</span>&nbsp;<span class="ident" id="5912438">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912441">}</span>&nbsp;<span class="keyword" id="5912443">else</span>&nbsp;<span class="op" id="5912448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912452">p</span><span class="op" id="5912453">.</span><span class="ident" id="5912454">pos</span><span class="op" id="5912457">.</span><span class="ident" id="5912458">Column</span>&nbsp;<span class="op" id="5912465">+=</span>&nbsp;<span class="builtinfunc" id="5912468">len</span><span class="op" id="5912471">(</span><span class="ident" id="5912472">s</span><span class="op" id="5912473">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912477">p</span><span class="op" id="5912478">.</span><span class="ident" id="5912479">out</span><span class="op" id="5912482">.</span><span class="ident" id="5912483">Column</span>&nbsp;<span class="op" id="5912490">+=</span>&nbsp;<span class="builtinfunc" id="5912493">len</span><span class="op" id="5912496">(</span><span class="ident" id="5912497">s</span><span class="op" id="5912498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912505">if</span>&nbsp;<span class="ident" id="5912508">isLit</span>&nbsp;<span class="op" id="5912514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912518">p</span><span class="op" id="5912519">.</span><span class="ident" id="5912520">output</span>&nbsp;<span class="op" id="5912527">=</span>&nbsp;<span class="builtinfunc" id="5912529">append</span><span class="op" id="5912535">(</span><span class="ident" id="5912536">p</span><span class="op" id="5912537">.</span><span class="ident" id="5912538">output</span><span class="op" id="5912544">,</span>&nbsp;<span class="ident" id="5912546">tabwriter</span><span class="op" id="5912555">.</span><span class="ident" id="5912556">Escape</span><span class="op" id="5912562">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912569">p</span><span class="op" id="5912570">.</span><span class="ident" id="5912571">last</span>&nbsp;<span class="op" id="5912576">=</span>&nbsp;<span class="ident" id="5912578">p</span><span class="op" id="5912579">.</span><span class="ident" id="5912580">pos</span><br>
<span class="lineno"></span><span class="op" id="5912584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5912587">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5912649">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5912711">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5912767">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5912829">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5912892">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5912952">//</span><br>
<span class="lineno"></span><span class="keyword" id="5912955">func</span>&nbsp;<span class="op" id="5912960">(</span><span class="ident" id="5912961">p</span>&nbsp;<span class="op" id="5912963">*</span><span class="ident" id="5912964">printer</span><span class="op" id="5912971">)</span>&nbsp;<span class="ident" id="5912973">writeCommentPrefix</span><span class="op" id="5912991">(</span><span class="ident" id="5912992">pos</span><span class="op" id="5912995">,</span>&nbsp;<span class="ident" id="5912997">next</span>&nbsp;<span class="ident" id="5913002">token</span><span class="op" id="5913007">.</span><span class="ident" id="5913008">Position</span><span class="op" id="5913016">,</span>&nbsp;<span class="ident" id="5913018">prev</span><span class="op" id="5913022">,</span>&nbsp;<span class="ident" id="5913024">comment</span>&nbsp;<span class="op" id="5913032">*</span><span class="ident" id="5913033">ast</span><span class="op" id="5913036">.</span><span class="ident" id="5913037">Comment</span><span class="op" id="5913044">,</span>&nbsp;<span class="ident" id="5913046">tok</span>&nbsp;<span class="ident" id="5913050">token</span><span class="op" id="5913055">.</span><span class="ident" id="5913056">Token</span><span class="op" id="5913061">)</span>&nbsp;<span class="op" id="5913063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913066">if</span>&nbsp;<span class="builtinfunc" id="5913069">len</span><span class="op" id="5913072">(</span><span class="ident" id="5913073">p</span><span class="op" id="5913074">.</span><span class="ident" id="5913075">output</span><span class="op" id="5913081">)</span>&nbsp;<span class="op" id="5913083">==</span>&nbsp;<span class="num" id="5913086">0</span>&nbsp;<span class="op" id="5913088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913092">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913170">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913182">if</span>&nbsp;<span class="ident" id="5913185">pos</span><span class="op" id="5913188">.</span><span class="ident" id="5913189">IsValid</span><span class="op" id="5913196">(</span><span class="op" id="5913197">)</span>&nbsp;<span class="op" id="5913199">&amp;&amp;</span>&nbsp;<span class="ident" id="5913202">pos</span><span class="op" id="5913205">.</span><span class="ident" id="5913206">Filename</span>&nbsp;<span class="op" id="5913215">!=</span>&nbsp;<span class="ident" id="5913218">p</span><span class="op" id="5913219">.</span><span class="ident" id="5913220">last</span><span class="op" id="5913224">.</span><span class="ident" id="5913225">Filename</span>&nbsp;<span class="op" id="5913234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913238">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913296">p</span><span class="op" id="5913297">.</span><span class="ident" id="5913298">writeByte</span><span class="op" id="5913307">(</span><span class="string" id="5913308">&#39;\f&#39;</span><span class="op" id="5913312">,</span>&nbsp;<span class="ident" id="5913314">maxNewlines</span><span class="op" id="5913325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913329">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913341">if</span>&nbsp;<span class="ident" id="5913344">pos</span><span class="op" id="5913347">.</span><span class="ident" id="5913348">Line</span>&nbsp;<span class="op" id="5913353">==</span>&nbsp;<span class="ident" id="5913356">p</span><span class="op" id="5913357">.</span><span class="ident" id="5913358">last</span><span class="op" id="5913362">.</span><span class="ident" id="5913363">Line</span>&nbsp;<span class="op" id="5913368">&amp;&amp;</span>&nbsp;<span class="op" id="5913371">(</span><span class="ident" id="5913372">prev</span>&nbsp;<span class="op" id="5913377">==</span>&nbsp;<span class="ident" id="5913380">nil</span>&nbsp;<span class="op" id="5913384">||</span>&nbsp;<span class="ident" id="5913387">prev</span><span class="op" id="5913391">.</span><span class="ident" id="5913392">Text</span><span class="op" id="5913396">[</span><span class="num" id="5913397">1</span><span class="op" id="5913398">]</span>&nbsp;<span class="op" id="5913400">!=</span>&nbsp;<span class="string" id="5913403">&#39;/&#39;</span><span class="op" id="5913406">)</span>&nbsp;<span class="op" id="5913408">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913412">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913456">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913498">hasSep</span>&nbsp;<span class="op" id="5913505">:=</span>&nbsp;<span class="builtintype" id="5913508">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913516">if</span>&nbsp;<span class="ident" id="5913519">prev</span>&nbsp;<span class="op" id="5913524">==</span>&nbsp;<span class="ident" id="5913527">nil</span>&nbsp;<span class="op" id="5913531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913536">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913575">j</span>&nbsp;<span class="op" id="5913577">:=</span>&nbsp;<span class="num" id="5913580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913585">for</span>&nbsp;<span class="ident" id="5913589">i</span><span class="op" id="5913590">,</span>&nbsp;<span class="ident" id="5913592">ch</span>&nbsp;<span class="op" id="5913595">:=</span>&nbsp;<span class="keyword" id="5913598">range</span>&nbsp;<span class="ident" id="5913604">p</span><span class="op" id="5913605">.</span><span class="ident" id="5913606">wsbuf</span>&nbsp;<span class="op" id="5913612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913618">switch</span>&nbsp;<span class="ident" id="5913625">ch</span>&nbsp;<span class="op" id="5913628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913634">case</span>&nbsp;<span class="ident" id="5913639">blank</span><span class="op" id="5913644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913651">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913694">p</span><span class="op" id="5913695">.</span><span class="ident" id="5913696">wsbuf</span><span class="op" id="5913701">[</span><span class="ident" id="5913702">i</span><span class="op" id="5913703">]</span>&nbsp;<span class="op" id="5913705">=</span>&nbsp;<span class="ident" id="5913707">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913719">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913732">case</span>&nbsp;<span class="ident" id="5913737">vtab</span><span class="op" id="5913741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913748">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913790">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913841">hasSep</span>&nbsp;<span class="op" id="5913848">=</span>&nbsp;<span class="builtintype" id="5913850">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913860">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913873">case</span>&nbsp;<span class="ident" id="5913878">indent</span><span class="op" id="5913884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913891">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913925">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913944">j</span>&nbsp;<span class="op" id="5913946">=</span>&nbsp;<span class="ident" id="5913948">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913954">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913968">p</span><span class="op" id="5913969">.</span><span class="ident" id="5913970">writeWhitespace</span><span class="op" id="5913985">(</span><span class="ident" id="5913986">j</span><span class="op" id="5913987">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913995">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914042">if</span>&nbsp;<span class="op" id="5914045">!</span><span class="ident" id="5914046">hasSep</span>&nbsp;<span class="op" id="5914053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914058">sep</span>&nbsp;<span class="op" id="5914062">:=</span>&nbsp;<span class="builtintype" id="5914065">byte</span><span class="op" id="5914069">(</span><span class="string" id="5914070">&#39;\t&#39;</span><span class="op" id="5914074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914079">if</span>&nbsp;<span class="ident" id="5914082">pos</span><span class="op" id="5914085">.</span><span class="ident" id="5914086">Line</span>&nbsp;<span class="op" id="5914091">==</span>&nbsp;<span class="ident" id="5914094">next</span><span class="op" id="5914098">.</span><span class="ident" id="5914099">Line</span>&nbsp;<span class="op" id="5914104">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914110">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914162">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914214">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914251">sep</span>&nbsp;<span class="op" id="5914255">=</span>&nbsp;<span class="string" id="5914257">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914264">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914269">p</span><span class="op" id="5914270">.</span><span class="ident" id="5914271">writeByte</span><span class="op" id="5914280">(</span><span class="ident" id="5914281">sep</span><span class="op" id="5914284">,</span>&nbsp;<span class="num" id="5914286">1</span><span class="op" id="5914287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914295">}</span>&nbsp;<span class="keyword" id="5914297">else</span>&nbsp;<span class="op" id="5914302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914306">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914340">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914383">droppedLinebreak</span>&nbsp;<span class="op" id="5914400">:=</span>&nbsp;<span class="builtintype" id="5914403">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914411">j</span>&nbsp;<span class="op" id="5914413">:=</span>&nbsp;<span class="num" id="5914416">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914420">for</span>&nbsp;<span class="ident" id="5914424">i</span><span class="op" id="5914425">,</span>&nbsp;<span class="ident" id="5914427">ch</span>&nbsp;<span class="op" id="5914430">:=</span>&nbsp;<span class="keyword" id="5914433">range</span>&nbsp;<span class="ident" id="5914439">p</span><span class="op" id="5914440">.</span><span class="ident" id="5914441">wsbuf</span>&nbsp;<span class="op" id="5914447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914452">switch</span>&nbsp;<span class="ident" id="5914459">ch</span>&nbsp;<span class="op" id="5914462">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914467">case</span>&nbsp;<span class="ident" id="5914472">blank</span><span class="op" id="5914477">,</span>&nbsp;<span class="ident" id="5914479">vtab</span><span class="op" id="5914483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914489">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914548">p</span><span class="op" id="5914549">.</span><span class="ident" id="5914550">wsbuf</span><span class="op" id="5914555">[</span><span class="ident" id="5914556">i</span><span class="op" id="5914557">]</span>&nbsp;<span class="op" id="5914559">=</span>&nbsp;<span class="ident" id="5914561">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914584">case</span>&nbsp;<span class="ident" id="5914589">indent</span><span class="op" id="5914595">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914601">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914634">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914646">case</span>&nbsp;<span class="ident" id="5914651">unindent</span><span class="op" id="5914659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914665">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914715">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914762">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914816">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914858">if</span>&nbsp;<span class="ident" id="5914861">i</span><span class="op" id="5914862">+</span><span class="num" id="5914863">1</span>&nbsp;<span class="op" id="5914865">&lt;</span>&nbsp;<span class="builtinfunc" id="5914867">len</span><span class="op" id="5914870">(</span><span class="ident" id="5914871">p</span><span class="op" id="5914872">.</span><span class="ident" id="5914873">wsbuf</span><span class="op" id="5914878">)</span>&nbsp;<span class="op" id="5914880">&amp;&amp;</span>&nbsp;<span class="ident" id="5914883">p</span><span class="op" id="5914884">.</span><span class="ident" id="5914885">wsbuf</span><span class="op" id="5914890">[</span><span class="ident" id="5914891">i</span><span class="op" id="5914892">+</span><span class="num" id="5914893">1</span><span class="op" id="5914894">]</span>&nbsp;<span class="op" id="5914896">==</span>&nbsp;<span class="ident" id="5914899">unindent</span>&nbsp;<span class="op" id="5914908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914915">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914928">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914934">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914998">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915056">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915113">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915171">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915226">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915284">if</span>&nbsp;<span class="ident" id="5915287">tok</span>&nbsp;<span class="op" id="5915291">!=</span>&nbsp;<span class="ident" id="5915294">token</span><span class="op" id="5915299">.</span><span class="ident" id="5915300">RBRACE</span>&nbsp;<span class="op" id="5915307">&amp;&amp;</span>&nbsp;<span class="ident" id="5915310">pos</span><span class="op" id="5915313">.</span><span class="ident" id="5915314">Column</span>&nbsp;<span class="op" id="5915321">==</span>&nbsp;<span class="ident" id="5915324">next</span><span class="op" id="5915328">.</span><span class="ident" id="5915329">Column</span>&nbsp;<span class="op" id="5915336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915343">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915361">case</span>&nbsp;<span class="ident" id="5915366">newline</span><span class="op" id="5915373">,</span>&nbsp;<span class="ident" id="5915375">formfeed</span><span class="op" id="5915383">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915389">p</span><span class="op" id="5915390">.</span><span class="ident" id="5915391">wsbuf</span><span class="op" id="5915396">[</span><span class="ident" id="5915397">i</span><span class="op" id="5915398">]</span>&nbsp;<span class="op" id="5915400">=</span>&nbsp;<span class="ident" id="5915402">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915413">droppedLinebreak</span>&nbsp;<span class="op" id="5915430">=</span>&nbsp;<span class="ident" id="5915432">prev</span>&nbsp;<span class="op" id="5915437">==</span>&nbsp;<span class="ident" id="5915440">nil</span>&nbsp;<span class="comment" id="5915444">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915495">j</span>&nbsp;<span class="op" id="5915497">=</span>&nbsp;<span class="ident" id="5915499">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915504">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915516">p</span><span class="op" id="5915517">.</span><span class="ident" id="5915518">writeWhitespace</span><span class="op" id="5915533">(</span><span class="ident" id="5915534">j</span><span class="op" id="5915535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915540">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915595">n</span>&nbsp;<span class="op" id="5915597">:=</span>&nbsp;<span class="num" id="5915600">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915604">if</span>&nbsp;<span class="ident" id="5915607">pos</span><span class="op" id="5915610">.</span><span class="ident" id="5915611">IsValid</span><span class="op" id="5915618">(</span><span class="op" id="5915619">)</span>&nbsp;<span class="op" id="5915621">&amp;&amp;</span>&nbsp;<span class="ident" id="5915624">p</span><span class="op" id="5915625">.</span><span class="ident" id="5915626">last</span><span class="op" id="5915630">.</span><span class="ident" id="5915631">IsValid</span><span class="op" id="5915638">(</span><span class="op" id="5915639">)</span>&nbsp;<span class="op" id="5915641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915646">n</span>&nbsp;<span class="op" id="5915648">=</span>&nbsp;<span class="ident" id="5915650">pos</span><span class="op" id="5915653">.</span><span class="ident" id="5915654">Line</span>&nbsp;<span class="op" id="5915659">-</span>&nbsp;<span class="ident" id="5915661">p</span><span class="op" id="5915662">.</span><span class="ident" id="5915663">last</span><span class="op" id="5915667">.</span><span class="ident" id="5915668">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915676">if</span>&nbsp;<span class="ident" id="5915679">n</span>&nbsp;<span class="op" id="5915681">&lt;</span>&nbsp;<span class="num" id="5915683">0</span>&nbsp;<span class="op" id="5915685">{</span>&nbsp;<span class="comment" id="5915687">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915714">n</span>&nbsp;<span class="op" id="5915716">=</span>&nbsp;<span class="num" id="5915718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915723">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915732">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915786">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915838">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915892">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915946">if</span>&nbsp;<span class="ident" id="5915949">p</span><span class="op" id="5915950">.</span><span class="ident" id="5915951">indent</span>&nbsp;<span class="op" id="5915958">==</span>&nbsp;<span class="num" id="5915961">0</span>&nbsp;<span class="op" id="5915963">&amp;&amp;</span>&nbsp;<span class="ident" id="5915966">droppedLinebreak</span>&nbsp;<span class="op" id="5915983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915988">n</span><span class="op" id="5915989">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915999">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916047">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916095">if</span>&nbsp;<span class="ident" id="5916098">n</span>&nbsp;<span class="op" id="5916100">==</span>&nbsp;<span class="num" id="5916103">0</span>&nbsp;<span class="op" id="5916105">&amp;&amp;</span>&nbsp;<span class="ident" id="5916108">prev</span>&nbsp;<span class="op" id="5916113">!=</span>&nbsp;<span class="ident" id="5916116">nil</span>&nbsp;<span class="op" id="5916120">&amp;&amp;</span>&nbsp;<span class="ident" id="5916123">prev</span><span class="op" id="5916127">.</span><span class="ident" id="5916128">Text</span><span class="op" id="5916132">[</span><span class="num" id="5916133">1</span><span class="op" id="5916134">]</span>&nbsp;<span class="op" id="5916136">==</span>&nbsp;<span class="string" id="5916139">&#39;/&#39;</span>&nbsp;<span class="op" id="5916143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916148">n</span>&nbsp;<span class="op" id="5916150">=</span>&nbsp;<span class="num" id="5916152">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916156">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916161">if</span>&nbsp;<span class="ident" id="5916164">n</span>&nbsp;<span class="op" id="5916166">&gt;</span>&nbsp;<span class="num" id="5916168">0</span>&nbsp;<span class="op" id="5916170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916175">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916230">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916285">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916329">p</span><span class="op" id="5916330">.</span><span class="ident" id="5916331">writeByte</span><span class="op" id="5916340">(</span><span class="string" id="5916341">&#39;\f&#39;</span><span class="op" id="5916345">,</span>&nbsp;<span class="ident" id="5916347">nlimit</span><span class="op" id="5916353">(</span><span class="ident" id="5916354">n</span><span class="op" id="5916355">)</span><span class="op" id="5916356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916363">}</span><br>
<span class="lineno"></span><span class="op" id="5916365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5916368">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5916415">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5916478">//</span><br>
<span class="lineno"></span><span class="keyword" id="5916481">func</span>&nbsp;<span class="ident" id="5916486">isBlank</span><span class="op" id="5916493">(</span><span class="ident" id="5916494">s</span>&nbsp;<span class="builtintype" id="5916496">string</span><span class="op" id="5916502">)</span>&nbsp;<span class="builtintype" id="5916504">bool</span>&nbsp;<span class="op" id="5916509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916512">for</span>&nbsp;<span class="ident" id="5916516">i</span>&nbsp;<span class="op" id="5916518">:=</span>&nbsp;<span class="num" id="5916521">0</span><span class="op" id="5916522">;</span>&nbsp;<span class="ident" id="5916524">i</span>&nbsp;<span class="op" id="5916526">&lt;</span>&nbsp;<span class="builtinfunc" id="5916528">len</span><span class="op" id="5916531">(</span><span class="ident" id="5916532">s</span><span class="op" id="5916533">)</span><span class="op" id="5916534">;</span>&nbsp;<span class="ident" id="5916536">i</span><span class="op" id="5916537">++</span>&nbsp;<span class="op" id="5916540">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916544">if</span>&nbsp;<span class="ident" id="5916547">s</span><span class="op" id="5916548">[</span><span class="ident" id="5916549">i</span><span class="op" id="5916550">]</span>&nbsp;<span class="op" id="5916552">&gt;</span>&nbsp;<span class="string" id="5916554">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5916558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916563">return</span>&nbsp;<span class="builtintype" id="5916570">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916584">return</span>&nbsp;<span class="builtintype" id="5916591">true</span><br>
<span class="lineno">460</span><span class="op" id="5916596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916599">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5916653">func</span>&nbsp;<span class="ident" id="5916658">commonPrefix</span><span class="op" id="5916670">(</span><span class="ident" id="5916671">a</span><span class="op" id="5916672">,</span>&nbsp;<span class="ident" id="5916674">b</span>&nbsp;<span class="builtintype" id="5916676">string</span><span class="op" id="5916682">)</span>&nbsp;<span class="builtintype" id="5916684">string</span>&nbsp;<span class="op" id="5916691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916694">i</span>&nbsp;<span class="op" id="5916696">:=</span>&nbsp;<span class="num" id="5916699">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916702">for</span>&nbsp;<span class="ident" id="5916706">i</span>&nbsp;<span class="op" id="5916708">&lt;</span>&nbsp;<span class="builtinfunc" id="5916710">len</span><span class="op" id="5916713">(</span><span class="ident" id="5916714">a</span><span class="op" id="5916715">)</span>&nbsp;<span class="op" id="5916717">&amp;&amp;</span>&nbsp;<span class="ident" id="5916720">i</span>&nbsp;<span class="op" id="5916722">&lt;</span>&nbsp;<span class="builtinfunc" id="5916724">len</span><span class="op" id="5916727">(</span><span class="ident" id="5916728">b</span><span class="op" id="5916729">)</span>&nbsp;<span class="op" id="5916731">&amp;&amp;</span>&nbsp;<span class="ident" id="5916734">a</span><span class="op" id="5916735">[</span><span class="ident" id="5916736">i</span><span class="op" id="5916737">]</span>&nbsp;<span class="op" id="5916739">==</span>&nbsp;<span class="ident" id="5916742">b</span><span class="op" id="5916743">[</span><span class="ident" id="5916744">i</span><span class="op" id="5916745">]</span>&nbsp;<span class="op" id="5916747">&amp;&amp;</span>&nbsp;<span class="op" id="5916750">(</span><span class="ident" id="5916751">a</span><span class="op" id="5916752">[</span><span class="ident" id="5916753">i</span><span class="op" id="5916754">]</span>&nbsp;<span class="op" id="5916756">&lt;=</span>&nbsp;<span class="string" id="5916759">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5916763">||</span>&nbsp;<span class="ident" id="5916766">a</span><span class="op" id="5916767">[</span><span class="ident" id="5916768">i</span><span class="op" id="5916769">]</span>&nbsp;<span class="op" id="5916771">==</span>&nbsp;<span class="string" id="5916774">&#39;*&#39;</span><span class="op" id="5916777">)</span>&nbsp;<span class="op" id="5916779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916783">i</span><span class="op" id="5916784">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916791">return</span>&nbsp;<span class="ident" id="5916798">a</span><span class="op" id="5916799">[</span><span class="num" id="5916800">0</span><span class="op" id="5916801">:</span><span class="ident" id="5916802">i</span><span class="op" id="5916803">]</span><br>
<span class="lineno"></span><span class="op" id="5916805">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5916808">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5916865">func</span>&nbsp;<span class="ident" id="5916870">trimRight</span><span class="op" id="5916879">(</span><span class="ident" id="5916880">s</span>&nbsp;<span class="builtintype" id="5916882">string</span><span class="op" id="5916888">)</span>&nbsp;<span class="builtintype" id="5916890">string</span>&nbsp;<span class="op" id="5916897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916900">return</span>&nbsp;<span class="ident" id="5916907">strings</span><span class="op" id="5916914">.</span><span class="ident" id="5916915">TrimRightFunc</span><span class="op" id="5916928">(</span><span class="ident" id="5916929">s</span><span class="op" id="5916930">,</span>&nbsp;<span class="ident" id="5916932">unicode</span><span class="op" id="5916939">.</span><span class="ident" id="5916940">IsSpace</span><span class="op" id="5916947">)</span><br>
<span class="lineno"></span><span class="op" id="5916949">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5916952">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5917036">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5917121">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5917201">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5917281">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5917305">//</span><br>
<span class="lineno"></span><span class="keyword" id="5917308">func</span>&nbsp;<span class="ident" id="5917313">stripCommonPrefix</span><span class="op" id="5917330">(</span><span class="ident" id="5917331">lines</span>&nbsp;<span class="op" id="5917337">[</span><span class="op" id="5917338">]</span><span class="builtintype" id="5917339">string</span><span class="op" id="5917345">)</span>&nbsp;<span class="op" id="5917347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917350">if</span>&nbsp;<span class="builtinfunc" id="5917353">len</span><span class="op" id="5917356">(</span><span class="ident" id="5917357">lines</span><span class="op" id="5917362">)</span>&nbsp;<span class="op" id="5917364">&lt;=</span>&nbsp;<span class="num" id="5917367">1</span>&nbsp;<span class="op" id="5917369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917373">return</span>&nbsp;<span class="comment" id="5917380">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917420">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917440">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917497">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917554">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917608">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917666">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917724">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917782">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917823">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917885">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917947">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918008">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918069">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918129">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918143">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918147">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918207">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918267">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918321">var</span>&nbsp;<span class="ident" id="5918325">prefix</span>&nbsp;<span class="builtintype" id="5918332">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918340">if</span>&nbsp;<span class="builtinfunc" id="5918343">len</span><span class="op" id="5918346">(</span><span class="ident" id="5918347">lines</span><span class="op" id="5918352">)</span>&nbsp;<span class="op" id="5918354">&gt;</span>&nbsp;<span class="num" id="5918356">2</span>&nbsp;<span class="op" id="5918358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918362">first</span>&nbsp;<span class="op" id="5918368">:=</span>&nbsp;<span class="builtintype" id="5918371">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918378">for</span>&nbsp;<span class="ident" id="5918382">i</span><span class="op" id="5918383">,</span>&nbsp;<span class="ident" id="5918385">line</span>&nbsp;<span class="op" id="5918390">:=</span>&nbsp;<span class="keyword" id="5918393">range</span>&nbsp;<span class="ident" id="5918399">lines</span><span class="op" id="5918404">[</span><span class="num" id="5918405">1</span>&nbsp;<span class="op" id="5918407">:</span>&nbsp;<span class="builtinfunc" id="5918409">len</span><span class="op" id="5918412">(</span><span class="ident" id="5918413">lines</span><span class="op" id="5918418">)</span><span class="op" id="5918419">-</span><span class="num" id="5918420">1</span><span class="op" id="5918421">]</span>&nbsp;<span class="op" id="5918423">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918428">switch</span>&nbsp;<span class="op" id="5918435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918440">case</span>&nbsp;<span class="ident" id="5918445">isBlank</span><span class="op" id="5918452">(</span><span class="ident" id="5918453">line</span><span class="op" id="5918457">)</span><span class="op" id="5918458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918464">lines</span><span class="op" id="5918469">[</span><span class="num" id="5918470">1</span><span class="op" id="5918471">+</span><span class="ident" id="5918472">i</span><span class="op" id="5918473">]</span>&nbsp;<span class="op" id="5918475">=</span>&nbsp;<span class="string" id="5918477">&#34;&#34;</span>&nbsp;<span class="comment" id="5918480">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918513">case</span>&nbsp;<span class="ident" id="5918518">first</span><span class="op" id="5918523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918529">prefix</span>&nbsp;<span class="op" id="5918536">=</span>&nbsp;<span class="ident" id="5918538">commonPrefix</span><span class="op" id="5918550">(</span><span class="ident" id="5918551">line</span><span class="op" id="5918555">,</span>&nbsp;<span class="ident" id="5918557">line</span><span class="op" id="5918561">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918567">first</span>&nbsp;<span class="op" id="5918573">=</span>&nbsp;<span class="builtintype" id="5918575">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918584">default</span><span class="op" id="5918591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918597">prefix</span>&nbsp;<span class="op" id="5918604">=</span>&nbsp;<span class="ident" id="5918606">commonPrefix</span><span class="op" id="5918618">(</span><span class="ident" id="5918619">prefix</span><span class="op" id="5918625">,</span>&nbsp;<span class="ident" id="5918627">line</span><span class="op" id="5918631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918640">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918643">}</span>&nbsp;<span class="keyword" id="5918645">else</span>&nbsp;<span class="op" id="5918650">{</span>&nbsp;<span class="comment" id="5918652">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918716">line</span>&nbsp;<span class="op" id="5918721">:=</span>&nbsp;<span class="ident" id="5918724">lines</span><span class="op" id="5918729">[</span><span class="num" id="5918730">1</span><span class="op" id="5918731">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918735">prefix</span>&nbsp;<span class="op" id="5918742">=</span>&nbsp;<span class="ident" id="5918744">commonPrefix</span><span class="op" id="5918756">(</span><span class="ident" id="5918757">line</span><span class="op" id="5918761">,</span>&nbsp;<span class="ident" id="5918763">line</span><span class="op" id="5918767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918774">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918854">lineOfStars</span>&nbsp;<span class="op" id="5918866">:=</span>&nbsp;<span class="builtintype" id="5918869">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918876">if</span>&nbsp;<span class="ident" id="5918879">i</span>&nbsp;<span class="op" id="5918881">:=</span>&nbsp;<span class="ident" id="5918884">strings</span><span class="op" id="5918891">.</span><span class="ident" id="5918892">Index</span><span class="op" id="5918897">(</span><span class="ident" id="5918898">prefix</span><span class="op" id="5918904">,</span>&nbsp;<span class="string" id="5918906">&#34;*&#34;</span><span class="op" id="5918909">)</span><span class="op" id="5918910">;</span>&nbsp;<span class="ident" id="5918912">i</span>&nbsp;<span class="op" id="5918914">&gt;=</span>&nbsp;<span class="num" id="5918917">0</span>&nbsp;<span class="op" id="5918919">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918923">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918951">if</span>&nbsp;<span class="ident" id="5918954">i</span>&nbsp;<span class="op" id="5918956">&gt;</span>&nbsp;<span class="num" id="5918958">0</span>&nbsp;<span class="op" id="5918960">&amp;&amp;</span>&nbsp;<span class="ident" id="5918963">prefix</span><span class="op" id="5918969">[</span><span class="ident" id="5918970">i</span><span class="op" id="5918971">-</span><span class="num" id="5918972">1</span><span class="op" id="5918973">]</span>&nbsp;<span class="op" id="5918975">==</span>&nbsp;<span class="string" id="5918978">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5918982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918987">i</span><span class="op" id="5918988">--</span>&nbsp;<span class="comment" id="5918991">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919058">prefix</span>&nbsp;<span class="op" id="5919065">=</span>&nbsp;<span class="ident" id="5919067">prefix</span><span class="op" id="5919073">[</span><span class="num" id="5919074">0</span><span class="op" id="5919075">:</span><span class="ident" id="5919076">i</span><span class="op" id="5919077">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919081">lineOfStars</span>&nbsp;<span class="op" id="5919093">=</span>&nbsp;<span class="builtintype" id="5919095">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919101">}</span>&nbsp;<span class="keyword" id="5919103">else</span>&nbsp;<span class="op" id="5919108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919112">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919143">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919205">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919267">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919330">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919391">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919453">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919514">first</span>&nbsp;<span class="op" id="5919520">:=</span>&nbsp;<span class="ident" id="5919523">lines</span><span class="op" id="5919528">[</span><span class="num" id="5919529">0</span><span class="op" id="5919530">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919534">if</span>&nbsp;<span class="ident" id="5919537">isBlank</span><span class="op" id="5919544">(</span><span class="ident" id="5919545">first</span><span class="op" id="5919550">[</span><span class="num" id="5919551">2</span><span class="op" id="5919552">:</span><span class="op" id="5919553">]</span><span class="op" id="5919554">)</span>&nbsp;<span class="op" id="5919556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919561">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919602">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919649">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919701">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919754">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919779">i</span>&nbsp;<span class="op" id="5919781">:=</span>&nbsp;<span class="builtinfunc" id="5919784">len</span><span class="op" id="5919787">(</span><span class="ident" id="5919788">prefix</span><span class="op" id="5919794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919799">for</span>&nbsp;<span class="ident" id="5919803">n</span>&nbsp;<span class="op" id="5919805">:=</span>&nbsp;<span class="num" id="5919808">0</span><span class="op" id="5919809">;</span>&nbsp;<span class="ident" id="5919811">n</span>&nbsp;<span class="op" id="5919813">&lt;</span>&nbsp;<span class="num" id="5919815">3</span>&nbsp;<span class="op" id="5919817">&amp;&amp;</span>&nbsp;<span class="ident" id="5919820">i</span>&nbsp;<span class="op" id="5919822">&gt;</span>&nbsp;<span class="num" id="5919824">0</span>&nbsp;<span class="op" id="5919826">&amp;&amp;</span>&nbsp;<span class="ident" id="5919829">prefix</span><span class="op" id="5919835">[</span><span class="ident" id="5919836">i</span><span class="op" id="5919837">-</span><span class="num" id="5919838">1</span><span class="op" id="5919839">]</span>&nbsp;<span class="op" id="5919841">==</span>&nbsp;<span class="string" id="5919844">&#39;&nbsp;&#39;</span><span class="op" id="5919847">;</span>&nbsp;<span class="ident" id="5919849">n</span><span class="op" id="5919850">++</span>&nbsp;<span class="op" id="5919853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919859">i</span><span class="op" id="5919860">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919866">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919871">if</span>&nbsp;<span class="ident" id="5919874">i</span>&nbsp;<span class="op" id="5919876">==</span>&nbsp;<span class="builtinfunc" id="5919879">len</span><span class="op" id="5919882">(</span><span class="ident" id="5919883">prefix</span><span class="op" id="5919889">)</span>&nbsp;<span class="op" id="5919891">&amp;&amp;</span>&nbsp;<span class="ident" id="5919894">i</span>&nbsp;<span class="op" id="5919896">&gt;</span>&nbsp;<span class="num" id="5919898">0</span>&nbsp;<span class="op" id="5919900">&amp;&amp;</span>&nbsp;<span class="ident" id="5919903">prefix</span><span class="op" id="5919909">[</span><span class="ident" id="5919910">i</span><span class="op" id="5919911">-</span><span class="num" id="5919912">1</span><span class="op" id="5919913">]</span>&nbsp;<span class="op" id="5919915">==</span>&nbsp;<span class="string" id="5919918">&#39;\t&#39;</span>&nbsp;<span class="op" id="5919923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919929">i</span><span class="op" id="5919930">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919941">prefix</span>&nbsp;<span class="op" id="5919948">=</span>&nbsp;<span class="ident" id="5919950">prefix</span><span class="op" id="5919956">[</span><span class="num" id="5919957">0</span><span class="op" id="5919958">:</span><span class="ident" id="5919959">i</span><span class="op" id="5919960">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919964">}</span>&nbsp;<span class="keyword" id="5919966">else</span>&nbsp;<span class="op" id="5919971">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919976">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920013">suffix</span>&nbsp;<span class="op" id="5920020">:=</span>&nbsp;<span class="builtinfunc" id="5920023">make</span><span class="op" id="5920027">(</span><span class="op" id="5920028">[</span><span class="op" id="5920029">]</span><span class="builtintype" id="5920030">byte</span><span class="op" id="5920034">,</span>&nbsp;<span class="builtinfunc" id="5920036">len</span><span class="op" id="5920039">(</span><span class="ident" id="5920040">first</span><span class="op" id="5920045">)</span><span class="op" id="5920046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920051">n</span>&nbsp;<span class="op" id="5920053">:=</span>&nbsp;<span class="num" id="5920056">2</span>&nbsp;<span class="comment" id="5920058">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920087">for</span>&nbsp;<span class="ident" id="5920091">n</span>&nbsp;<span class="op" id="5920093">&lt;</span>&nbsp;<span class="builtinfunc" id="5920095">len</span><span class="op" id="5920098">(</span><span class="ident" id="5920099">first</span><span class="op" id="5920104">)</span>&nbsp;<span class="op" id="5920106">&amp;&amp;</span>&nbsp;<span class="ident" id="5920109">first</span><span class="op" id="5920114">[</span><span class="ident" id="5920115">n</span><span class="op" id="5920116">]</span>&nbsp;<span class="op" id="5920118">&lt;=</span>&nbsp;<span class="string" id="5920121">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5920125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920131">suffix</span><span class="op" id="5920137">[</span><span class="ident" id="5920138">n</span><span class="op" id="5920139">]</span>&nbsp;<span class="op" id="5920141">=</span>&nbsp;<span class="ident" id="5920143">first</span><span class="op" id="5920148">[</span><span class="ident" id="5920149">n</span><span class="op" id="5920150">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920156">n</span><span class="op" id="5920157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920168">if</span>&nbsp;<span class="ident" id="5920171">n</span>&nbsp;<span class="op" id="5920173">&gt;</span>&nbsp;<span class="num" id="5920175">2</span>&nbsp;<span class="op" id="5920177">&amp;&amp;</span>&nbsp;<span class="ident" id="5920180">suffix</span><span class="op" id="5920186">[</span><span class="num" id="5920187">2</span><span class="op" id="5920188">]</span>&nbsp;<span class="op" id="5920190">==</span>&nbsp;<span class="string" id="5920193">&#39;\t&#39;</span>&nbsp;<span class="op" id="5920198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920204">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920250">suffix</span>&nbsp;<span class="op" id="5920257">=</span>&nbsp;<span class="ident" id="5920259">suffix</span><span class="op" id="5920265">[</span><span class="num" id="5920266">2</span><span class="op" id="5920267">:</span><span class="ident" id="5920268">n</span><span class="op" id="5920269">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920274">}</span>&nbsp;<span class="keyword" id="5920276">else</span>&nbsp;<span class="op" id="5920281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920287">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920322">suffix</span><span class="op" id="5920328">[</span><span class="num" id="5920329">0</span><span class="op" id="5920330">]</span><span class="op" id="5920331">,</span>&nbsp;<span class="ident" id="5920333">suffix</span><span class="op" id="5920339">[</span><span class="num" id="5920340">1</span><span class="op" id="5920341">]</span>&nbsp;<span class="op" id="5920343">=</span>&nbsp;<span class="string" id="5920345">&#39;&nbsp;&#39;</span><span class="op" id="5920348">,</span>&nbsp;<span class="string" id="5920350">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920358">suffix</span>&nbsp;<span class="op" id="5920365">=</span>&nbsp;<span class="ident" id="5920367">suffix</span><span class="op" id="5920373">[</span><span class="num" id="5920374">0</span><span class="op" id="5920375">:</span><span class="ident" id="5920376">n</span><span class="op" id="5920377">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920382">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920387">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920445">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920499">prefix</span>&nbsp;<span class="op" id="5920506">=</span>&nbsp;<span class="ident" id="5920508">strings</span><span class="op" id="5920515">.</span><span class="ident" id="5920516">TrimSuffix</span><span class="op" id="5920526">(</span><span class="ident" id="5920527">prefix</span><span class="op" id="5920533">,</span>&nbsp;<span class="builtintype" id="5920535">string</span><span class="op" id="5920541">(</span><span class="ident" id="5920542">suffix</span><span class="op" id="5920548">)</span><span class="op" id="5920549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920556">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920560">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920625">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920690">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920701">last</span>&nbsp;<span class="op" id="5920706">:=</span>&nbsp;<span class="ident" id="5920709">lines</span><span class="op" id="5920714">[</span><span class="builtinfunc" id="5920715">len</span><span class="op" id="5920718">(</span><span class="ident" id="5920719">lines</span><span class="op" id="5920724">)</span><span class="op" id="5920725">-</span><span class="num" id="5920726">1</span><span class="op" id="5920727">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920730">closing</span>&nbsp;<span class="op" id="5920738">:=</span>&nbsp;<span class="string" id="5920741">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920747">i</span>&nbsp;<span class="op" id="5920749">:=</span>&nbsp;<span class="ident" id="5920752">strings</span><span class="op" id="5920759">.</span><span class="ident" id="5920760">Index</span><span class="op" id="5920765">(</span><span class="ident" id="5920766">last</span><span class="op" id="5920770">,</span>&nbsp;<span class="ident" id="5920772">closing</span><span class="op" id="5920779">)</span>&nbsp;<span class="comment" id="5920781">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920820">if</span>&nbsp;<span class="ident" id="5920823">isBlank</span><span class="op" id="5920830">(</span><span class="ident" id="5920831">last</span><span class="op" id="5920835">[</span><span class="num" id="5920836">0</span><span class="op" id="5920837">:</span><span class="ident" id="5920838">i</span><span class="op" id="5920839">]</span><span class="op" id="5920840">)</span>&nbsp;<span class="op" id="5920842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920846">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920886">if</span>&nbsp;<span class="ident" id="5920889">lineOfStars</span>&nbsp;<span class="op" id="5920901">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920906">closing</span>&nbsp;<span class="op" id="5920914">=</span>&nbsp;<span class="string" id="5920916">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5920922">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920961">lines</span><span class="op" id="5920966">[</span><span class="builtinfunc" id="5920967">len</span><span class="op" id="5920970">(</span><span class="ident" id="5920971">lines</span><span class="op" id="5920976">)</span><span class="op" id="5920977">-</span><span class="num" id="5920978">1</span><span class="op" id="5920979">]</span>&nbsp;<span class="op" id="5920981">=</span>&nbsp;<span class="ident" id="5920983">prefix</span>&nbsp;<span class="op" id="5920990">+</span>&nbsp;<span class="ident" id="5920992">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921001">}</span>&nbsp;<span class="keyword" id="5921003">else</span>&nbsp;<span class="op" id="5921008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921012">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921063">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921115">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921142">prefix</span>&nbsp;<span class="op" id="5921149">=</span>&nbsp;<span class="ident" id="5921151">commonPrefix</span><span class="op" id="5921163">(</span><span class="ident" id="5921164">prefix</span><span class="op" id="5921170">,</span>&nbsp;<span class="ident" id="5921172">last</span><span class="op" id="5921176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921183">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921252">for</span>&nbsp;<span class="ident" id="5921256">i</span><span class="op" id="5921257">,</span>&nbsp;<span class="ident" id="5921259">line</span>&nbsp;<span class="op" id="5921264">:=</span>&nbsp;<span class="keyword" id="5921267">range</span>&nbsp;<span class="ident" id="5921273">lines</span>&nbsp;<span class="op" id="5921279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921283">if</span>&nbsp;<span class="ident" id="5921286">i</span>&nbsp;<span class="op" id="5921288">&gt;</span>&nbsp;<span class="num" id="5921290">0</span>&nbsp;<span class="op" id="5921292">&amp;&amp;</span>&nbsp;<span class="ident" id="5921295">line</span>&nbsp;<span class="op" id="5921300">!=</span>&nbsp;<span class="string" id="5921303">&#34;&#34;</span>&nbsp;<span class="op" id="5921306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921311">lines</span><span class="op" id="5921316">[</span><span class="ident" id="5921317">i</span><span class="op" id="5921318">]</span>&nbsp;<span class="op" id="5921320">=</span>&nbsp;<span class="ident" id="5921322">line</span><span class="op" id="5921326">[</span><span class="builtinfunc" id="5921327">len</span><span class="op" id="5921330">(</span><span class="ident" id="5921331">prefix</span><span class="op" id="5921337">)</span><span class="op" id="5921338">:</span><span class="op" id="5921339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921343">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921346">}</span><br>
<span class="lineno"></span><span class="op" id="5921348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5921351">func</span>&nbsp;<span class="op" id="5921356">(</span><span class="ident" id="5921357">p</span>&nbsp;<span class="op" id="5921359">*</span><span class="ident" id="5921360">printer</span><span class="op" id="5921367">)</span>&nbsp;<span class="ident" id="5921369">writeComment</span><span class="op" id="5921381">(</span><span class="ident" id="5921382">comment</span>&nbsp;<span class="op" id="5921390">*</span><span class="ident" id="5921391">ast</span><span class="op" id="5921394">.</span><span class="ident" id="5921395">Comment</span><span class="op" id="5921402">)</span>&nbsp;<span class="op" id="5921404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921407">text</span>&nbsp;<span class="op" id="5921412">:=</span>&nbsp;<span class="ident" id="5921415">comment</span><span class="op" id="5921422">.</span><span class="ident" id="5921423">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921429">pos</span>&nbsp;<span class="op" id="5921433">:=</span>&nbsp;<span class="ident" id="5921436">p</span><span class="op" id="5921437">.</span><span class="ident" id="5921438">posFor</span><span class="op" id="5921444">(</span><span class="ident" id="5921445">comment</span><span class="op" id="5921452">.</span><span class="ident" id="5921453">Pos</span><span class="op" id="5921456">(</span><span class="op" id="5921457">)</span><span class="op" id="5921458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921462">const</span>&nbsp;<span class="ident" id="5921468">linePrefix</span>&nbsp;<span class="op" id="5921479">=</span>&nbsp;<span class="string" id="5921481">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921492">if</span>&nbsp;<span class="ident" id="5921495">strings</span><span class="op" id="5921502">.</span><span class="ident" id="5921503">HasPrefix</span><span class="op" id="5921512">(</span><span class="ident" id="5921513">text</span><span class="op" id="5921517">,</span>&nbsp;<span class="ident" id="5921519">linePrefix</span><span class="op" id="5921529">)</span>&nbsp;<span class="op" id="5921531">&amp;&amp;</span>&nbsp;<span class="op" id="5921534">(</span><span class="op" id="5921535">!</span><span class="ident" id="5921536">pos</span><span class="op" id="5921539">.</span><span class="ident" id="5921540">IsValid</span><span class="op" id="5921547">(</span><span class="op" id="5921548">)</span>&nbsp;<span class="op" id="5921550">||</span>&nbsp;<span class="ident" id="5921553">pos</span><span class="op" id="5921556">.</span><span class="ident" id="5921557">Column</span>&nbsp;<span class="op" id="5921564">==</span>&nbsp;<span class="num" id="5921567">1</span><span class="op" id="5921568">)</span>&nbsp;<span class="op" id="5921570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921574">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921605">ldir</span>&nbsp;<span class="op" id="5921610">:=</span>&nbsp;<span class="ident" id="5921613">strings</span><span class="op" id="5921620">.</span><span class="ident" id="5921621">TrimSpace</span><span class="op" id="5921630">(</span><span class="ident" id="5921631">text</span><span class="op" id="5921635">[</span><span class="builtinfunc" id="5921636">len</span><span class="op" id="5921639">(</span><span class="ident" id="5921640">linePrefix</span><span class="op" id="5921650">)</span><span class="op" id="5921651">:</span><span class="op" id="5921652">]</span><span class="op" id="5921653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921657">if</span>&nbsp;<span class="ident" id="5921660">i</span>&nbsp;<span class="op" id="5921662">:=</span>&nbsp;<span class="ident" id="5921665">strings</span><span class="op" id="5921672">.</span><span class="ident" id="5921673">LastIndex</span><span class="op" id="5921682">(</span><span class="ident" id="5921683">ldir</span><span class="op" id="5921687">,</span>&nbsp;<span class="string" id="5921689">&#34;:&#34;</span><span class="op" id="5921692">)</span><span class="op" id="5921693">;</span>&nbsp;<span class="ident" id="5921695">i</span>&nbsp;<span class="op" id="5921697">&gt;=</span>&nbsp;<span class="num" id="5921700">0</span>&nbsp;<span class="op" id="5921702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921707">if</span>&nbsp;<span class="ident" id="5921710">line</span><span class="op" id="5921714">,</span>&nbsp;<span class="ident" id="5921716">err</span>&nbsp;<span class="op" id="5921720">:=</span>&nbsp;<span class="ident" id="5921723">strconv</span><span class="op" id="5921730">.</span><span class="ident" id="5921731">Atoi</span><span class="op" id="5921735">(</span><span class="ident" id="5921736">ldir</span><span class="op" id="5921740">[</span><span class="ident" id="5921741">i</span><span class="op" id="5921742">+</span><span class="num" id="5921743">1</span><span class="op" id="5921744">:</span><span class="op" id="5921745">]</span><span class="op" id="5921746">)</span><span class="op" id="5921747">;</span>&nbsp;<span class="ident" id="5921749">err</span>&nbsp;<span class="op" id="5921753">==</span>&nbsp;<span class="ident" id="5921756">nil</span>&nbsp;<span class="op" id="5921760">&amp;&amp;</span>&nbsp;<span class="ident" id="5921763">line</span>&nbsp;<span class="op" id="5921768">&gt;</span>&nbsp;<span class="num" id="5921770">0</span>&nbsp;<span class="op" id="5921772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921778">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921834">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921890">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921946">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922002">indent</span>&nbsp;<span class="op" id="5922009">:=</span>&nbsp;<span class="ident" id="5922012">p</span><span class="op" id="5922013">.</span><span class="ident" id="5922014">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922025">p</span><span class="op" id="5922026">.</span><span class="ident" id="5922027">indent</span>&nbsp;<span class="op" id="5922034">=</span>&nbsp;<span class="num" id="5922036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922042">defer</span>&nbsp;<span class="keyword" id="5922048">func</span><span class="op" id="5922052">(</span><span class="op" id="5922053">)</span>&nbsp;<span class="op" id="5922055">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922062">p</span><span class="op" id="5922063">.</span><span class="ident" id="5922064">pos</span><span class="op" id="5922067">.</span><span class="ident" id="5922068">Filename</span>&nbsp;<span class="op" id="5922077">=</span>&nbsp;<span class="ident" id="5922079">ldir</span><span class="op" id="5922083">[</span><span class="op" id="5922084">:</span><span class="ident" id="5922085">i</span><span class="op" id="5922086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922093">p</span><span class="op" id="5922094">.</span><span class="ident" id="5922095">pos</span><span class="op" id="5922098">.</span><span class="ident" id="5922099">Line</span>&nbsp;<span class="op" id="5922104">=</span>&nbsp;<span class="ident" id="5922106">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922116">p</span><span class="op" id="5922117">.</span><span class="ident" id="5922118">pos</span><span class="op" id="5922121">.</span><span class="ident" id="5922122">Column</span>&nbsp;<span class="op" id="5922129">=</span>&nbsp;<span class="num" id="5922131">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922138">p</span><span class="op" id="5922139">.</span><span class="ident" id="5922140">indent</span>&nbsp;<span class="op" id="5922147">=</span>&nbsp;<span class="ident" id="5922149">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922160">}</span><span class="op" id="5922161">(</span><span class="op" id="5922162">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922178">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922224">if</span>&nbsp;<span class="ident" id="5922227">text</span><span class="op" id="5922231">[</span><span class="num" id="5922232">1</span><span class="op" id="5922233">]</span>&nbsp;<span class="op" id="5922235">==</span>&nbsp;<span class="string" id="5922238">&#39;/&#39;</span>&nbsp;<span class="op" id="5922242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922246">p</span><span class="op" id="5922247">.</span><span class="ident" id="5922248">writeString</span><span class="op" id="5922259">(</span><span class="ident" id="5922260">pos</span><span class="op" id="5922263">,</span>&nbsp;<span class="ident" id="5922265">trimRight</span><span class="op" id="5922274">(</span><span class="ident" id="5922275">text</span><span class="op" id="5922279">)</span><span class="op" id="5922280">,</span>&nbsp;<span class="builtintype" id="5922282">true</span><span class="op" id="5922286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922302">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922360">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922415">lines</span>&nbsp;<span class="op" id="5922421">:=</span>&nbsp;<span class="ident" id="5922424">strings</span><span class="op" id="5922431">.</span><span class="ident" id="5922432">Split</span><span class="op" id="5922437">(</span><span class="ident" id="5922438">text</span><span class="op" id="5922442">,</span>&nbsp;<span class="string" id="5922444">&#34;\n&#34;</span><span class="op" id="5922448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922452">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922509">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922571">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922632">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922695">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922755">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922785">if</span>&nbsp;<span class="ident" id="5922788">pos</span><span class="op" id="5922791">.</span><span class="ident" id="5922792">IsValid</span><span class="op" id="5922799">(</span><span class="op" id="5922800">)</span>&nbsp;<span class="op" id="5922802">&amp;&amp;</span>&nbsp;<span class="ident" id="5922805">pos</span><span class="op" id="5922808">.</span><span class="ident" id="5922809">Column</span>&nbsp;<span class="op" id="5922816">==</span>&nbsp;<span class="num" id="5922819">1</span>&nbsp;<span class="op" id="5922821">&amp;&amp;</span>&nbsp;<span class="ident" id="5922824">p</span><span class="op" id="5922825">.</span><span class="ident" id="5922826">indent</span>&nbsp;<span class="op" id="5922833">&gt;</span>&nbsp;<span class="num" id="5922835">0</span>&nbsp;<span class="op" id="5922837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922841">for</span>&nbsp;<span class="ident" id="5922845">i</span><span class="op" id="5922846">,</span>&nbsp;<span class="ident" id="5922848">line</span>&nbsp;<span class="op" id="5922853">:=</span>&nbsp;<span class="keyword" id="5922856">range</span>&nbsp;<span class="ident" id="5922862">lines</span><span class="op" id="5922867">[</span><span class="num" id="5922868">1</span><span class="op" id="5922869">:</span><span class="op" id="5922870">]</span>&nbsp;<span class="op" id="5922872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922877">lines</span><span class="op" id="5922882">[</span><span class="num" id="5922883">1</span><span class="op" id="5922884">+</span><span class="ident" id="5922885">i</span><span class="op" id="5922886">]</span>&nbsp;<span class="op" id="5922888">=</span>&nbsp;<span class="string" id="5922890">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5922896">+</span>&nbsp;<span class="ident" id="5922898">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922908">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922912">stripCommonPrefix</span><span class="op" id="5922929">(</span><span class="ident" id="5922930">lines</span><span class="op" id="5922935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922939">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922987">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923032">for</span>&nbsp;<span class="ident" id="5923036">i</span><span class="op" id="5923037">,</span>&nbsp;<span class="ident" id="5923039">line</span>&nbsp;<span class="op" id="5923044">:=</span>&nbsp;<span class="keyword" id="5923047">range</span>&nbsp;<span class="ident" id="5923053">lines</span>&nbsp;<span class="op" id="5923059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923063">if</span>&nbsp;<span class="ident" id="5923066">i</span>&nbsp;<span class="op" id="5923068">&gt;</span>&nbsp;<span class="num" id="5923070">0</span>&nbsp;<span class="op" id="5923072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923077">p</span><span class="op" id="5923078">.</span><span class="ident" id="5923079">writeByte</span><span class="op" id="5923088">(</span><span class="string" id="5923089">&#39;\f&#39;</span><span class="op" id="5923093">,</span>&nbsp;<span class="num" id="5923095">1</span><span class="op" id="5923096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923101">pos</span>&nbsp;<span class="op" id="5923105">=</span>&nbsp;<span class="ident" id="5923107">p</span><span class="op" id="5923108">.</span><span class="ident" id="5923109">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923115">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923119">if</span>&nbsp;<span class="builtinfunc" id="5923122">len</span><span class="op" id="5923125">(</span><span class="ident" id="5923126">line</span><span class="op" id="5923130">)</span>&nbsp;<span class="op" id="5923132">&gt;</span>&nbsp;<span class="num" id="5923134">0</span>&nbsp;<span class="op" id="5923136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923141">p</span><span class="op" id="5923142">.</span><span class="ident" id="5923143">writeString</span><span class="op" id="5923154">(</span><span class="ident" id="5923155">pos</span><span class="op" id="5923158">,</span>&nbsp;<span class="ident" id="5923160">trimRight</span><span class="op" id="5923169">(</span><span class="ident" id="5923170">line</span><span class="op" id="5923174">)</span><span class="op" id="5923175">,</span>&nbsp;<span class="builtintype" id="5923177">true</span><span class="op" id="5923181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923188">}</span><br>
<span class="lineno"></span><span class="op" id="5923190">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5923193">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5923264">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5923335">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5923404">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5923472">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5923544">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5923555">//</span><br>
<span class="lineno"></span><span class="keyword" id="5923558">func</span>&nbsp;<span class="op" id="5923563">(</span><span class="ident" id="5923564">p</span>&nbsp;<span class="op" id="5923566">*</span><span class="ident" id="5923567">printer</span><span class="op" id="5923574">)</span>&nbsp;<span class="ident" id="5923576">writeCommentSuffix</span><span class="op" id="5923594">(</span><span class="ident" id="5923595">needsLinebreak</span>&nbsp;<span class="builtintype" id="5923610">bool</span><span class="op" id="5923614">)</span>&nbsp;<span class="op" id="5923616">(</span><span class="ident" id="5923617">wroteNewline</span><span class="op" id="5923629">,</span>&nbsp;<span class="ident" id="5923631">droppedFF</span>&nbsp;<span class="builtintype" id="5923641">bool</span><span class="op" id="5923645">)</span>&nbsp;<span class="op" id="5923647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923650">for</span>&nbsp;<span class="ident" id="5923654">i</span><span class="op" id="5923655">,</span>&nbsp;<span class="ident" id="5923657">ch</span>&nbsp;<span class="op" id="5923660">:=</span>&nbsp;<span class="keyword" id="5923663">range</span>&nbsp;<span class="ident" id="5923669">p</span><span class="op" id="5923670">.</span><span class="ident" id="5923671">wsbuf</span>&nbsp;<span class="op" id="5923677">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923681">switch</span>&nbsp;<span class="ident" id="5923688">ch</span>&nbsp;<span class="op" id="5923691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923695">case</span>&nbsp;<span class="ident" id="5923700">blank</span><span class="op" id="5923705">,</span>&nbsp;<span class="ident" id="5923707">vtab</span><span class="op" id="5923711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923716">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923749">p</span><span class="op" id="5923750">.</span><span class="ident" id="5923751">wsbuf</span><span class="op" id="5923756">[</span><span class="ident" id="5923757">i</span><span class="op" id="5923758">]</span>&nbsp;<span class="op" id="5923760">=</span>&nbsp;<span class="ident" id="5923762">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923771">case</span>&nbsp;<span class="ident" id="5923776">indent</span><span class="op" id="5923782">,</span>&nbsp;<span class="ident" id="5923784">unindent</span><span class="op" id="5923792">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923797">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923837">case</span>&nbsp;<span class="ident" id="5923842">newline</span><span class="op" id="5923849">,</span>&nbsp;<span class="ident" id="5923851">formfeed</span><span class="op" id="5923859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923864">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923912">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923959">if</span>&nbsp;<span class="ident" id="5923962">needsLinebreak</span>&nbsp;<span class="op" id="5923977">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923983">needsLinebreak</span>&nbsp;<span class="op" id="5923998">=</span>&nbsp;<span class="builtintype" id="5924000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924010">wroteNewline</span>&nbsp;<span class="op" id="5924023">=</span>&nbsp;<span class="builtintype" id="5924025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924033">}</span>&nbsp;<span class="keyword" id="5924035">else</span>&nbsp;<span class="op" id="5924040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924046">if</span>&nbsp;<span class="ident" id="5924049">ch</span>&nbsp;<span class="op" id="5924052">==</span>&nbsp;<span class="ident" id="5924055">formfeed</span>&nbsp;<span class="op" id="5924064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924071">droppedFF</span>&nbsp;<span class="op" id="5924081">=</span>&nbsp;<span class="builtintype" id="5924083">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924098">p</span><span class="op" id="5924099">.</span><span class="ident" id="5924100">wsbuf</span><span class="op" id="5924105">[</span><span class="ident" id="5924106">i</span><span class="op" id="5924107">]</span>&nbsp;<span class="op" id="5924109">=</span>&nbsp;<span class="ident" id="5924111">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924128">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924131">p</span><span class="op" id="5924132">.</span><span class="ident" id="5924133">writeWhitespace</span><span class="op" id="5924148">(</span><span class="builtinfunc" id="5924149">len</span><span class="op" id="5924152">(</span><span class="ident" id="5924153">p</span><span class="op" id="5924154">.</span><span class="ident" id="5924155">wsbuf</span><span class="op" id="5924160">)</span><span class="op" id="5924161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924165">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924200">if</span>&nbsp;<span class="ident" id="5924203">needsLinebreak</span>&nbsp;<span class="op" id="5924218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924222">p</span><span class="op" id="5924223">.</span><span class="ident" id="5924224">writeByte</span><span class="op" id="5924233">(</span><span class="string" id="5924234">&#39;\n&#39;</span><span class="op" id="5924238">,</span>&nbsp;<span class="num" id="5924240">1</span><span class="op" id="5924241">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924245">wroteNewline</span>&nbsp;<span class="op" id="5924258">=</span>&nbsp;<span class="builtintype" id="5924260">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924270">return</span><br>
<span class="lineno"></span><span class="op" id="5924277">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5924280">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5924359">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5924440">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5924519">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5924597">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5924677">//</span><br>
<span class="lineno"></span><span class="keyword" id="5924680">func</span>&nbsp;<span class="op" id="5924685">(</span><span class="ident" id="5924686">p</span>&nbsp;<span class="op" id="5924688">*</span><span class="ident" id="5924689">printer</span><span class="op" id="5924696">)</span>&nbsp;<span class="ident" id="5924698">intersperseComments</span><span class="op" id="5924717">(</span><span class="ident" id="5924718">next</span>&nbsp;<span class="ident" id="5924723">token</span><span class="op" id="5924728">.</span><span class="ident" id="5924729">Position</span><span class="op" id="5924737">,</span>&nbsp;<span class="ident" id="5924739">tok</span>&nbsp;<span class="ident" id="5924743">token</span><span class="op" id="5924748">.</span><span class="ident" id="5924749">Token</span><span class="op" id="5924754">)</span>&nbsp;<span class="op" id="5924756">(</span><span class="ident" id="5924757">wroteNewline</span><span class="op" id="5924769">,</span>&nbsp;<span class="ident" id="5924771">droppedFF</span>&nbsp;<span class="builtintype" id="5924781">bool</span><span class="op" id="5924785">)</span>&nbsp;<span class="op" id="5924787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924790">var</span>&nbsp;<span class="ident" id="5924794">last</span>&nbsp;<span class="op" id="5924799">*</span><span class="ident" id="5924800">ast</span><span class="op" id="5924803">.</span><span class="ident" id="5924804">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924813">for</span>&nbsp;<span class="ident" id="5924817">p</span><span class="op" id="5924818">.</span><span class="ident" id="5924819">commentBefore</span><span class="op" id="5924832">(</span><span class="ident" id="5924833">next</span><span class="op" id="5924837">)</span>&nbsp;<span class="op" id="5924839">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924843">for</span>&nbsp;<span class="ident" id="5924847">_</span><span class="op" id="5924848">,</span>&nbsp;<span class="ident" id="5924850">c</span>&nbsp;<span class="op" id="5924852">:=</span>&nbsp;<span class="keyword" id="5924855">range</span>&nbsp;<span class="ident" id="5924861">p</span><span class="op" id="5924862">.</span><span class="ident" id="5924863">comment</span><span class="op" id="5924870">.</span><span class="ident" id="5924871">List</span>&nbsp;<span class="op" id="5924876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924881">p</span><span class="op" id="5924882">.</span><span class="ident" id="5924883">writeCommentPrefix</span><span class="op" id="5924901">(</span><span class="ident" id="5924902">p</span><span class="op" id="5924903">.</span><span class="ident" id="5924904">posFor</span><span class="op" id="5924910">(</span><span class="ident" id="5924911">c</span><span class="op" id="5924912">.</span><span class="ident" id="5924913">Pos</span><span class="op" id="5924916">(</span><span class="op" id="5924917">)</span><span class="op" id="5924918">)</span><span class="op" id="5924919">,</span>&nbsp;<span class="ident" id="5924921">next</span><span class="op" id="5924925">,</span>&nbsp;<span class="ident" id="5924927">last</span><span class="op" id="5924931">,</span>&nbsp;<span class="ident" id="5924933">c</span><span class="op" id="5924934">,</span>&nbsp;<span class="ident" id="5924936">tok</span><span class="op" id="5924939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924944">p</span><span class="op" id="5924945">.</span><span class="ident" id="5924946">writeComment</span><span class="op" id="5924958">(</span><span class="ident" id="5924959">c</span><span class="op" id="5924960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924965">last</span>&nbsp;<span class="op" id="5924970">=</span>&nbsp;<span class="ident" id="5924972">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924976">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924980">p</span><span class="op" id="5924981">.</span><span class="ident" id="5924982">nextComment</span><span class="op" id="5924993">(</span><span class="op" id="5924994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925001">if</span>&nbsp;<span class="ident" id="5925004">last</span>&nbsp;<span class="op" id="5925009">!=</span>&nbsp;<span class="ident" id="5925012">nil</span>&nbsp;<span class="op" id="5925016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925020">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925085">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925155">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925223">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925289">if</span>&nbsp;<span class="ident" id="5925292">p</span><span class="op" id="5925293">.</span><span class="ident" id="5925294">mode</span><span class="op" id="5925298">&amp;</span><span class="ident" id="5925299">noExtraBlank</span>&nbsp;<span class="op" id="5925312">==</span>&nbsp;<span class="num" id="5925315">0</span>&nbsp;<span class="op" id="5925317">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925323">last</span><span class="op" id="5925327">.</span><span class="ident" id="5925328">Text</span><span class="op" id="5925332">[</span><span class="num" id="5925333">1</span><span class="op" id="5925334">]</span>&nbsp;<span class="op" id="5925336">==</span>&nbsp;<span class="string" id="5925339">&#39;*&#39;</span>&nbsp;<span class="op" id="5925343">&amp;&amp;</span>&nbsp;<span class="ident" id="5925346">p</span><span class="op" id="5925347">.</span><span class="ident" id="5925348">lineFor</span><span class="op" id="5925355">(</span><span class="ident" id="5925356">last</span><span class="op" id="5925360">.</span><span class="ident" id="5925361">Pos</span><span class="op" id="5925364">(</span><span class="op" id="5925365">)</span><span class="op" id="5925366">)</span>&nbsp;<span class="op" id="5925368">==</span>&nbsp;<span class="ident" id="5925371">next</span><span class="op" id="5925375">.</span><span class="ident" id="5925376">Line</span>&nbsp;<span class="op" id="5925381">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925387">tok</span>&nbsp;<span class="op" id="5925391">!=</span>&nbsp;<span class="ident" id="5925394">token</span><span class="op" id="5925399">.</span><span class="ident" id="5925400">COMMA</span>&nbsp;<span class="op" id="5925406">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925412">(</span><span class="ident" id="5925413">tok</span>&nbsp;<span class="op" id="5925417">!=</span>&nbsp;<span class="ident" id="5925420">token</span><span class="op" id="5925425">.</span><span class="ident" id="5925426">RPAREN</span>&nbsp;<span class="op" id="5925433">||</span>&nbsp;<span class="ident" id="5925436">p</span><span class="op" id="5925437">.</span><span class="ident" id="5925438">prevOpen</span>&nbsp;<span class="op" id="5925447">==</span>&nbsp;<span class="ident" id="5925450">token</span><span class="op" id="5925455">.</span><span class="ident" id="5925456">LPAREN</span><span class="op" id="5925462">)</span>&nbsp;<span class="op" id="5925464">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925470">(</span><span class="ident" id="5925471">tok</span>&nbsp;<span class="op" id="5925475">!=</span>&nbsp;<span class="ident" id="5925478">token</span><span class="op" id="5925483">.</span><span class="ident" id="5925484">RBRACK</span>&nbsp;<span class="op" id="5925491">||</span>&nbsp;<span class="ident" id="5925494">p</span><span class="op" id="5925495">.</span><span class="ident" id="5925496">prevOpen</span>&nbsp;<span class="op" id="5925505">==</span>&nbsp;<span class="ident" id="5925508">token</span><span class="op" id="5925513">.</span><span class="ident" id="5925514">LBRACK</span><span class="op" id="5925520">)</span>&nbsp;<span class="op" id="5925522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925527">p</span><span class="op" id="5925528">.</span><span class="ident" id="5925529">writeByte</span><span class="op" id="5925538">(</span><span class="string" id="5925539">&#39;&nbsp;&#39;</span><span class="op" id="5925542">,</span>&nbsp;<span class="num" id="5925544">1</span><span class="op" id="5925545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925549">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925553">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925618">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925682">needsLinebreak</span>&nbsp;<span class="op" id="5925697">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925703">last</span><span class="op" id="5925707">.</span><span class="ident" id="5925708">Text</span><span class="op" id="5925712">[</span><span class="num" id="5925713">1</span><span class="op" id="5925714">]</span>&nbsp;<span class="op" id="5925716">==</span>&nbsp;<span class="string" id="5925719">&#39;/&#39;</span>&nbsp;<span class="op" id="5925723">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925730">tok</span>&nbsp;<span class="op" id="5925734">==</span>&nbsp;<span class="ident" id="5925737">token</span><span class="op" id="5925742">.</span><span class="ident" id="5925743">RBRACE</span>&nbsp;<span class="op" id="5925750">&amp;&amp;</span>&nbsp;<span class="ident" id="5925753">p</span><span class="op" id="5925754">.</span><span class="ident" id="5925755">mode</span><span class="op" id="5925759">&amp;</span><span class="ident" id="5925760">noExtraLinebreak</span>&nbsp;<span class="op" id="5925777">==</span>&nbsp;<span class="num" id="5925780">0</span>&nbsp;<span class="op" id="5925782">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925789">tok</span>&nbsp;<span class="op" id="5925793">==</span>&nbsp;<span class="ident" id="5925796">token</span><span class="op" id="5925801">.</span><span class="ident" id="5925802">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925808">return</span>&nbsp;<span class="ident" id="5925815">p</span><span class="op" id="5925816">.</span><span class="ident" id="5925817">writeCommentSuffix</span><span class="op" id="5925835">(</span><span class="ident" id="5925836">needsLinebreak</span><span class="op" id="5925850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925857">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925919">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925977">p</span><span class="op" id="5925978">.</span><span class="ident" id="5925979">internalError</span><span class="op" id="5925992">(</span><span class="string" id="5925993">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5926046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926049">return</span><br>
<span class="lineno"></span><span class="op" id="5926056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5926059">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5926117">func</span>&nbsp;<span class="op" id="5926122">(</span><span class="ident" id="5926123">p</span>&nbsp;<span class="op" id="5926125">*</span><span class="ident" id="5926126">printer</span><span class="op" id="5926133">)</span>&nbsp;<span class="ident" id="5926135">writeWhitespace</span><span class="op" id="5926150">(</span><span class="ident" id="5926151">n</span>&nbsp;<span class="builtintype" id="5926153">int</span><span class="op" id="5926156">)</span>&nbsp;<span class="op" id="5926158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926161">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926179">for</span>&nbsp;<span class="ident" id="5926183">i</span>&nbsp;<span class="op" id="5926185">:=</span>&nbsp;<span class="num" id="5926188">0</span><span class="op" id="5926189">;</span>&nbsp;<span class="ident" id="5926191">i</span>&nbsp;<span class="op" id="5926193">&lt;</span>&nbsp;<span class="ident" id="5926195">n</span><span class="op" id="5926196">;</span>&nbsp;<span class="ident" id="5926198">i</span><span class="op" id="5926199">++</span>&nbsp;<span class="op" id="5926202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926206">switch</span>&nbsp;<span class="ident" id="5926213">ch</span>&nbsp;<span class="op" id="5926216">:=</span>&nbsp;<span class="ident" id="5926219">p</span><span class="op" id="5926220">.</span><span class="ident" id="5926221">wsbuf</span><span class="op" id="5926226">[</span><span class="ident" id="5926227">i</span><span class="op" id="5926228">]</span><span class="op" id="5926229">;</span>&nbsp;<span class="ident" id="5926231">ch</span>&nbsp;<span class="op" id="5926234">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926238">case</span>&nbsp;<span class="ident" id="5926243">ignore</span><span class="op" id="5926249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926254">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926267">case</span>&nbsp;<span class="ident" id="5926272">indent</span><span class="op" id="5926278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926283">p</span><span class="op" id="5926284">.</span><span class="ident" id="5926285">indent</span><span class="op" id="5926291">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926296">case</span>&nbsp;<span class="ident" id="5926301">unindent</span><span class="op" id="5926309">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926314">p</span><span class="op" id="5926315">.</span><span class="ident" id="5926316">indent</span><span class="op" id="5926322">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926328">if</span>&nbsp;<span class="ident" id="5926331">p</span><span class="op" id="5926332">.</span><span class="ident" id="5926333">indent</span>&nbsp;<span class="op" id="5926340">&lt;</span>&nbsp;<span class="num" id="5926342">0</span>&nbsp;<span class="op" id="5926344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926350">p</span><span class="op" id="5926351">.</span><span class="ident" id="5926352">internalError</span><span class="op" id="5926365">(</span><span class="string" id="5926366">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5926389">,</span>&nbsp;<span class="ident" id="5926391">p</span><span class="op" id="5926392">.</span><span class="ident" id="5926393">indent</span><span class="op" id="5926399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926405">p</span><span class="op" id="5926406">.</span><span class="ident" id="5926407">indent</span>&nbsp;<span class="op" id="5926414">=</span>&nbsp;<span class="num" id="5926416">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926421">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926425">case</span>&nbsp;<span class="ident" id="5926430">newline</span><span class="op" id="5926437">,</span>&nbsp;<span class="ident" id="5926439">formfeed</span><span class="op" id="5926447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926452">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926510">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926569">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926625">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926681">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926741">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926786">if</span>&nbsp;<span class="ident" id="5926789">i</span><span class="op" id="5926790">+</span><span class="num" id="5926791">1</span>&nbsp;<span class="op" id="5926793">&lt;</span>&nbsp;<span class="ident" id="5926795">n</span>&nbsp;<span class="op" id="5926797">&amp;&amp;</span>&nbsp;<span class="ident" id="5926800">p</span><span class="op" id="5926801">.</span><span class="ident" id="5926802">wsbuf</span><span class="op" id="5926807">[</span><span class="ident" id="5926808">i</span><span class="op" id="5926809">+</span><span class="num" id="5926810">1</span><span class="op" id="5926811">]</span>&nbsp;<span class="op" id="5926813">==</span>&nbsp;<span class="ident" id="5926816">unindent</span>&nbsp;<span class="op" id="5926825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926831">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926887">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926948">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927008">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927071">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927091">p</span><span class="op" id="5927092">.</span><span class="ident" id="5927093">wsbuf</span><span class="op" id="5927098">[</span><span class="ident" id="5927099">i</span><span class="op" id="5927100">]</span><span class="op" id="5927101">,</span>&nbsp;<span class="ident" id="5927103">p</span><span class="op" id="5927104">.</span><span class="ident" id="5927105">wsbuf</span><span class="op" id="5927110">[</span><span class="ident" id="5927111">i</span><span class="op" id="5927112">+</span><span class="num" id="5927113">1</span><span class="op" id="5927114">]</span>&nbsp;<span class="op" id="5927116">=</span>&nbsp;<span class="ident" id="5927118">unindent</span><span class="op" id="5927126">,</span>&nbsp;<span class="ident" id="5927128">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927141">i</span><span class="op" id="5927142">--</span>&nbsp;<span class="comment" id="5927145">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927164">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927181">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927195">default</span><span class="op" id="5927202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927207">p</span><span class="op" id="5927208">.</span><span class="ident" id="5927209">writeByte</span><span class="op" id="5927218">(</span><span class="builtintype" id="5927219">byte</span><span class="op" id="5927223">(</span><span class="ident" id="5927224">ch</span><span class="op" id="5927226">)</span><span class="op" id="5927227">,</span>&nbsp;<span class="num" id="5927229">1</span><span class="op" id="5927230">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927241">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927274">l</span>&nbsp;<span class="op" id="5927276">:=</span>&nbsp;<span class="builtinfunc" id="5927279">copy</span><span class="op" id="5927283">(</span><span class="ident" id="5927284">p</span><span class="op" id="5927285">.</span><span class="ident" id="5927286">wsbuf</span><span class="op" id="5927291">,</span>&nbsp;<span class="ident" id="5927293">p</span><span class="op" id="5927294">.</span><span class="ident" id="5927295">wsbuf</span><span class="op" id="5927300">[</span><span class="ident" id="5927301">n</span><span class="op" id="5927302">:</span><span class="op" id="5927303">]</span><span class="op" id="5927304">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927307">p</span><span class="op" id="5927308">.</span><span class="ident" id="5927309">wsbuf</span>&nbsp;<span class="op" id="5927315">=</span>&nbsp;<span class="ident" id="5927317">p</span><span class="op" id="5927318">.</span><span class="ident" id="5927319">wsbuf</span><span class="op" id="5927324">[</span><span class="op" id="5927325">:</span><span class="ident" id="5927326">l</span><span class="op" id="5927327">]</span><br>
<span class="lineno"></span><span class="op" id="5927329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927332">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5927412">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5927435">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5927470">func</span>&nbsp;<span class="ident" id="5927475">nlimit</span><span class="op" id="5927481">(</span><span class="ident" id="5927482">n</span>&nbsp;<span class="builtintype" id="5927484">int</span><span class="op" id="5927487">)</span>&nbsp;<span class="builtintype" id="5927489">int</span>&nbsp;<span class="op" id="5927493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927496">if</span>&nbsp;<span class="ident" id="5927499">n</span>&nbsp;<span class="op" id="5927501">&gt;</span>&nbsp;<span class="ident" id="5927503">maxNewlines</span>&nbsp;<span class="op" id="5927515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927519">n</span>&nbsp;<span class="op" id="5927521">=</span>&nbsp;<span class="ident" id="5927523">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927539">return</span>&nbsp;<span class="ident" id="5927546">n</span><br>
<span class="lineno"></span><span class="op" id="5927548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5927551">func</span>&nbsp;<span class="ident" id="5927556">mayCombine</span><span class="op" id="5927566">(</span><span class="ident" id="5927567">prev</span>&nbsp;<span class="ident" id="5927572">token</span><span class="op" id="5927577">.</span><span class="ident" id="5927578">Token</span><span class="op" id="5927583">,</span>&nbsp;<span class="ident" id="5927585">next</span>&nbsp;<span class="builtintype" id="5927590">byte</span><span class="op" id="5927594">)</span>&nbsp;<span class="op" id="5927596">(</span><span class="ident" id="5927597">b</span>&nbsp;<span class="builtintype" id="5927599">bool</span><span class="op" id="5927603">)</span>&nbsp;<span class="op" id="5927605">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927608">switch</span>&nbsp;<span class="ident" id="5927615">prev</span>&nbsp;<span class="op" id="5927620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927623">case</span>&nbsp;<span class="ident" id="5927628">token</span><span class="op" id="5927633">.</span><span class="ident" id="5927634">INT</span><span class="op" id="5927637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927641">b</span>&nbsp;<span class="op" id="5927643">=</span>&nbsp;<span class="ident" id="5927645">next</span>&nbsp;<span class="op" id="5927650">==</span>&nbsp;<span class="string" id="5927653">&#39;.&#39;</span>&nbsp;<span class="comment" id="5927657">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927664">case</span>&nbsp;<span class="ident" id="5927669">token</span><span class="op" id="5927674">.</span><span class="ident" id="5927675">ADD</span><span class="op" id="5927678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927682">b</span>&nbsp;<span class="op" id="5927684">=</span>&nbsp;<span class="ident" id="5927686">next</span>&nbsp;<span class="op" id="5927691">==</span>&nbsp;<span class="string" id="5927694">&#39;+&#39;</span>&nbsp;<span class="comment" id="5927698">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927705">case</span>&nbsp;<span class="ident" id="5927710">token</span><span class="op" id="5927715">.</span><span class="ident" id="5927716">SUB</span><span class="op" id="5927719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927723">b</span>&nbsp;<span class="op" id="5927725">=</span>&nbsp;<span class="ident" id="5927727">next</span>&nbsp;<span class="op" id="5927732">==</span>&nbsp;<span class="string" id="5927735">&#39;-&#39;</span>&nbsp;<span class="comment" id="5927739">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927746">case</span>&nbsp;<span class="ident" id="5927751">token</span><span class="op" id="5927756">.</span><span class="ident" id="5927757">QUO</span><span class="op" id="5927760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927764">b</span>&nbsp;<span class="op" id="5927766">=</span>&nbsp;<span class="ident" id="5927768">next</span>&nbsp;<span class="op" id="5927773">==</span>&nbsp;<span class="string" id="5927776">&#39;*&#39;</span>&nbsp;<span class="comment" id="5927780">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927787">case</span>&nbsp;<span class="ident" id="5927792">token</span><span class="op" id="5927797">.</span><span class="ident" id="5927798">LSS</span><span class="op" id="5927801">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927805">b</span>&nbsp;<span class="op" id="5927807">=</span>&nbsp;<span class="ident" id="5927809">next</span>&nbsp;<span class="op" id="5927814">==</span>&nbsp;<span class="string" id="5927817">&#39;-&#39;</span>&nbsp;<span class="op" id="5927821">||</span>&nbsp;<span class="ident" id="5927824">next</span>&nbsp;<span class="op" id="5927829">==</span>&nbsp;<span class="string" id="5927832">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5927836">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927849">case</span>&nbsp;<span class="ident" id="5927854">token</span><span class="op" id="5927859">.</span><span class="ident" id="5927860">AND</span><span class="op" id="5927863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927867">b</span>&nbsp;<span class="op" id="5927869">=</span>&nbsp;<span class="ident" id="5927871">next</span>&nbsp;<span class="op" id="5927876">==</span>&nbsp;<span class="string" id="5927879">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5927883">||</span>&nbsp;<span class="ident" id="5927886">next</span>&nbsp;<span class="op" id="5927891">==</span>&nbsp;<span class="string" id="5927894">&#39;^&#39;</span>&nbsp;<span class="comment" id="5927898">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927914">return</span><br>
<span class="lineno">825</span><span class="op" id="5927921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927924">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5927994">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5928064">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5928133">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5928183">//</span><br>
<span class="lineno"></span><span class="comment" id="5928186">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5928257">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5928326">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5928396">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5928466">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5928508">//</span><br>
<span class="lineno"></span><span class="keyword" id="5928511">func</span>&nbsp;<span class="op" id="5928516">(</span><span class="ident" id="5928517">p</span>&nbsp;<span class="op" id="5928519">*</span><span class="ident" id="5928520">printer</span><span class="op" id="5928527">)</span>&nbsp;<span class="builtinfunc" id="5928529">print</span><span class="op" id="5928534">(</span><span class="ident" id="5928535">args</span>&nbsp;<span class="op" id="5928540">...</span><span class="keyword" id="5928543">interface</span><span class="op" id="5928552">{</span><span class="op" id="5928553">}</span><span class="op" id="5928554">)</span>&nbsp;<span class="op" id="5928556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928559">for</span>&nbsp;<span class="ident" id="5928563">_</span><span class="op" id="5928564">,</span>&nbsp;<span class="ident" id="5928566">arg</span>&nbsp;<span class="op" id="5928570">:=</span>&nbsp;<span class="keyword" id="5928573">range</span>&nbsp;<span class="ident" id="5928579">args</span>&nbsp;<span class="op" id="5928584">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928588">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928627">var</span>&nbsp;<span class="ident" id="5928631">data</span>&nbsp;<span class="builtintype" id="5928636">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928645">var</span>&nbsp;<span class="ident" id="5928649">isLit</span>&nbsp;<span class="builtintype" id="5928655">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928662">var</span>&nbsp;<span class="ident" id="5928666">impliedSemi</span>&nbsp;<span class="builtintype" id="5928678">bool</span>&nbsp;<span class="comment" id="5928683">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928728">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928771">switch</span>&nbsp;<span class="ident" id="5928778">p</span><span class="op" id="5928779">.</span><span class="ident" id="5928780">lastTok</span>&nbsp;<span class="op" id="5928788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928792">case</span>&nbsp;<span class="ident" id="5928797">token</span><span class="op" id="5928802">.</span><span class="ident" id="5928803">ILLEGAL</span><span class="op" id="5928810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928815">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928841">case</span>&nbsp;<span class="ident" id="5928846">token</span><span class="op" id="5928851">.</span><span class="ident" id="5928852">LPAREN</span><span class="op" id="5928858">,</span>&nbsp;<span class="ident" id="5928860">token</span><span class="op" id="5928865">.</span><span class="ident" id="5928866">LBRACK</span><span class="op" id="5928872">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928877">p</span><span class="op" id="5928878">.</span><span class="ident" id="5928879">prevOpen</span>&nbsp;<span class="op" id="5928888">=</span>&nbsp;<span class="ident" id="5928890">p</span><span class="op" id="5928891">.</span><span class="ident" id="5928892">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928902">default</span><span class="op" id="5928909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928914">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928960">p</span><span class="op" id="5928961">.</span><span class="ident" id="5928962">prevOpen</span>&nbsp;<span class="op" id="5928971">=</span>&nbsp;<span class="ident" id="5928973">token</span><span class="op" id="5928978">.</span><span class="ident" id="5928979">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928989">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928994">switch</span>&nbsp;<span class="ident" id="5929001">x</span>&nbsp;<span class="op" id="5929003">:=</span>&nbsp;<span class="ident" id="5929006">arg</span><span class="op" id="5929009">.</span><span class="op" id="5929010">(</span><span class="keyword" id="5929011">type</span><span class="op" id="5929015">)</span>&nbsp;<span class="op" id="5929017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929021">case</span>&nbsp;<span class="ident" id="5929026">pmode</span><span class="op" id="5929031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929036">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929062">p</span><span class="op" id="5929063">.</span><span class="ident" id="5929064">mode</span>&nbsp;<span class="op" id="5929069">^=</span>&nbsp;<span class="ident" id="5929072">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929077">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929089">case</span>&nbsp;<span class="ident" id="5929094">whiteSpace</span><span class="op" id="5929104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929109">if</span>&nbsp;<span class="ident" id="5929112">x</span>&nbsp;<span class="op" id="5929114">==</span>&nbsp;<span class="ident" id="5929117">ignore</span>&nbsp;<span class="op" id="5929124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929130">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929176">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929224">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929244">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929261">i</span>&nbsp;<span class="op" id="5929263">:=</span>&nbsp;<span class="builtinfunc" id="5929266">len</span><span class="op" id="5929269">(</span><span class="ident" id="5929270">p</span><span class="op" id="5929271">.</span><span class="ident" id="5929272">wsbuf</span><span class="op" id="5929277">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929282">if</span>&nbsp;<span class="ident" id="5929285">i</span>&nbsp;<span class="op" id="5929287">==</span>&nbsp;<span class="builtinfunc" id="5929290">cap</span><span class="op" id="5929293">(</span><span class="ident" id="5929294">p</span><span class="op" id="5929295">.</span><span class="ident" id="5929296">wsbuf</span><span class="op" id="5929301">)</span>&nbsp;<span class="op" id="5929303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929309">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929367">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929425">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929474">p</span><span class="op" id="5929475">.</span><span class="ident" id="5929476">writeWhitespace</span><span class="op" id="5929491">(</span><span class="ident" id="5929492">i</span><span class="op" id="5929493">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929499">i</span>&nbsp;<span class="op" id="5929501">=</span>&nbsp;<span class="num" id="5929503">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929513">p</span><span class="op" id="5929514">.</span><span class="ident" id="5929515">wsbuf</span>&nbsp;<span class="op" id="5929521">=</span>&nbsp;<span class="ident" id="5929523">p</span><span class="op" id="5929524">.</span><span class="ident" id="5929525">wsbuf</span><span class="op" id="5929530">[</span><span class="num" id="5929531">0</span>&nbsp;<span class="op" id="5929533">:</span>&nbsp;<span class="ident" id="5929535">i</span><span class="op" id="5929536">+</span><span class="num" id="5929537">1</span><span class="op" id="5929538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929543">p</span><span class="op" id="5929544">.</span><span class="ident" id="5929545">wsbuf</span><span class="op" id="5929550">[</span><span class="ident" id="5929551">i</span><span class="op" id="5929552">]</span>&nbsp;<span class="op" id="5929554">=</span>&nbsp;<span class="ident" id="5929556">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929561">if</span>&nbsp;<span class="ident" id="5929564">x</span>&nbsp;<span class="op" id="5929566">==</span>&nbsp;<span class="ident" id="5929569">newline</span>&nbsp;<span class="op" id="5929577">||</span>&nbsp;<span class="ident" id="5929580">x</span>&nbsp;<span class="op" id="5929582">==</span>&nbsp;<span class="ident" id="5929585">formfeed</span>&nbsp;<span class="op" id="5929594">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929600">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929657">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929715">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5929774">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929794">p</span><span class="op" id="5929795">.</span><span class="ident" id="5929796">impliedSemi</span>&nbsp;<span class="op" id="5929808">=</span>&nbsp;<span class="builtintype" id="5929810">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929824">p</span><span class="op" id="5929825">.</span><span class="ident" id="5929826">lastTok</span>&nbsp;<span class="op" id="5929834">=</span>&nbsp;<span class="ident" id="5929836">token</span><span class="op" id="5929841">.</span><span class="ident" id="5929842">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929853">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929865">case</span>&nbsp;<span class="op" id="5929870">*</span><span class="ident" id="5929871">ast</span><span class="op" id="5929874">.</span><span class="ident" id="5929875">Ident</span><span class="op" id="5929880">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929885">data</span>&nbsp;<span class="op" id="5929890">=</span>&nbsp;<span class="ident" id="5929892">x</span><span class="op" id="5929893">.</span><span class="ident" id="5929894">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929902">impliedSemi</span>&nbsp;<span class="op" id="5929914">=</span>&nbsp;<span class="builtintype" id="5929916">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929924">p</span><span class="op" id="5929925">.</span><span class="ident" id="5929926">lastTok</span>&nbsp;<span class="op" id="5929934">=</span>&nbsp;<span class="ident" id="5929936">token</span><span class="op" id="5929941">.</span><span class="ident" id="5929942">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929951">case</span>&nbsp;<span class="op" id="5929956">*</span><span class="ident" id="5929957">ast</span><span class="op" id="5929960">.</span><span class="ident" id="5929961">BasicLit</span><span class="op" id="5929969">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929974">data</span>&nbsp;<span class="op" id="5929979">=</span>&nbsp;<span class="ident" id="5929981">x</span><span class="op" id="5929982">.</span><span class="ident" id="5929983">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929992">isLit</span>&nbsp;<span class="op" id="5929998">=</span>&nbsp;<span class="builtintype" id="5930000">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930008">impliedSemi</span>&nbsp;<span class="op" id="5930020">=</span>&nbsp;<span class="builtintype" id="5930022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930030">p</span><span class="op" id="5930031">.</span><span class="ident" id="5930032">lastTok</span>&nbsp;<span class="op" id="5930040">=</span>&nbsp;<span class="ident" id="5930042">x</span><span class="op" id="5930043">.</span><span class="ident" id="5930044">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930052">case</span>&nbsp;<span class="ident" id="5930057">token</span><span class="op" id="5930062">.</span><span class="ident" id="5930063">Token</span><span class="op" id="5930068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930073">s</span>&nbsp;<span class="op" id="5930075">:=</span>&nbsp;<span class="ident" id="5930078">x</span><span class="op" id="5930079">.</span><span class="ident" id="5930080">String</span><span class="op" id="5930086">(</span><span class="op" id="5930087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930092">if</span>&nbsp;<span class="ident" id="5930095">mayCombine</span><span class="op" id="5930105">(</span><span class="ident" id="5930106">p</span><span class="op" id="5930107">.</span><span class="ident" id="5930108">lastTok</span><span class="op" id="5930115">,</span>&nbsp;<span class="ident" id="5930117">s</span><span class="op" id="5930118">[</span><span class="num" id="5930119">0</span><span class="op" id="5930120">]</span><span class="op" id="5930121">)</span>&nbsp;<span class="op" id="5930123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930129">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930179">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930230">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930279">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930331">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930383">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930427">if</span>&nbsp;<span class="builtinfunc" id="5930430">len</span><span class="op" id="5930433">(</span><span class="ident" id="5930434">p</span><span class="op" id="5930435">.</span><span class="ident" id="5930436">wsbuf</span><span class="op" id="5930441">)</span>&nbsp;<span class="op" id="5930443">!=</span>&nbsp;<span class="num" id="5930446">0</span>&nbsp;<span class="op" id="5930448">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930455">p</span><span class="op" id="5930456">.</span><span class="ident" id="5930457">internalError</span><span class="op" id="5930470">(</span><span class="string" id="5930471">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5930500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930512">p</span><span class="op" id="5930513">.</span><span class="ident" id="5930514">wsbuf</span>&nbsp;<span class="op" id="5930520">=</span>&nbsp;<span class="ident" id="5930522">p</span><span class="op" id="5930523">.</span><span class="ident" id="5930524">wsbuf</span><span class="op" id="5930529">[</span><span class="num" id="5930530">0</span><span class="op" id="5930531">:</span><span class="num" id="5930532">1</span><span class="op" id="5930533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930539">p</span><span class="op" id="5930540">.</span><span class="ident" id="5930541">wsbuf</span><span class="op" id="5930546">[</span><span class="num" id="5930547">0</span><span class="op" id="5930548">]</span>&nbsp;<span class="op" id="5930550">=</span>&nbsp;<span class="string" id="5930552">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930559">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930564">data</span>&nbsp;<span class="op" id="5930569">=</span>&nbsp;<span class="ident" id="5930571">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930576">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930636">switch</span>&nbsp;<span class="ident" id="5930643">x</span>&nbsp;<span class="op" id="5930645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930650">case</span>&nbsp;<span class="ident" id="5930655">token</span><span class="op" id="5930660">.</span><span class="ident" id="5930661">BREAK</span><span class="op" id="5930666">,</span>&nbsp;<span class="ident" id="5930668">token</span><span class="op" id="5930673">.</span><span class="ident" id="5930674">CONTINUE</span><span class="op" id="5930682">,</span>&nbsp;<span class="ident" id="5930684">token</span><span class="op" id="5930689">.</span><span class="ident" id="5930690">FALLTHROUGH</span><span class="op" id="5930701">,</span>&nbsp;<span class="ident" id="5930703">token</span><span class="op" id="5930708">.</span><span class="ident" id="5930709">RETURN</span><span class="op" id="5930715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930721">token</span><span class="op" id="5930726">.</span><span class="ident" id="5930727">INC</span><span class="op" id="5930730">,</span>&nbsp;<span class="ident" id="5930732">token</span><span class="op" id="5930737">.</span><span class="ident" id="5930738">DEC</span><span class="op" id="5930741">,</span>&nbsp;<span class="ident" id="5930743">token</span><span class="op" id="5930748">.</span><span class="ident" id="5930749">RPAREN</span><span class="op" id="5930755">,</span>&nbsp;<span class="ident" id="5930757">token</span><span class="op" id="5930762">.</span><span class="ident" id="5930763">RBRACK</span><span class="op" id="5930769">,</span>&nbsp;<span class="ident" id="5930771">token</span><span class="op" id="5930776">.</span><span class="ident" id="5930777">RBRACE</span><span class="op" id="5930783">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930789">impliedSemi</span>&nbsp;<span class="op" id="5930801">=</span>&nbsp;<span class="builtintype" id="5930803">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930816">p</span><span class="op" id="5930817">.</span><span class="ident" id="5930818">lastTok</span>&nbsp;<span class="op" id="5930826">=</span>&nbsp;<span class="ident" id="5930828">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930833">case</span>&nbsp;<span class="ident" id="5930838">token</span><span class="op" id="5930843">.</span><span class="ident" id="5930844">Pos</span><span class="op" id="5930847">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930852">if</span>&nbsp;<span class="ident" id="5930855">x</span><span class="op" id="5930856">.</span><span class="ident" id="5930857">IsValid</span><span class="op" id="5930864">(</span><span class="op" id="5930865">)</span>&nbsp;<span class="op" id="5930867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930873">p</span><span class="op" id="5930874">.</span><span class="ident" id="5930875">pos</span>&nbsp;<span class="op" id="5930879">=</span>&nbsp;<span class="ident" id="5930881">p</span><span class="op" id="5930882">.</span><span class="ident" id="5930883">posFor</span><span class="op" id="5930889">(</span><span class="ident" id="5930890">x</span><span class="op" id="5930891">)</span>&nbsp;<span class="comment" id="5930893">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930935">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930947">case</span>&nbsp;<span class="builtintype" id="5930952">string</span><span class="op" id="5930958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5930963">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931005">data</span>&nbsp;<span class="op" id="5931010">=</span>&nbsp;<span class="ident" id="5931012">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931017">isLit</span>&nbsp;<span class="op" id="5931023">=</span>&nbsp;<span class="builtintype" id="5931025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931033">impliedSemi</span>&nbsp;<span class="op" id="5931045">=</span>&nbsp;<span class="builtintype" id="5931047">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931055">p</span><span class="op" id="5931056">.</span><span class="ident" id="5931057">lastTok</span>&nbsp;<span class="op" id="5931065">=</span>&nbsp;<span class="ident" id="5931067">token</span><span class="op" id="5931072">.</span><span class="ident" id="5931073">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931083">default</span><span class="op" id="5931090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931095">fmt</span><span class="op" id="5931098">.</span><span class="ident" id="5931099">Fprintf</span><span class="op" id="5931106">(</span><span class="ident" id="5931107">os</span><span class="op" id="5931109">.</span><span class="ident" id="5931110">Stderr</span><span class="op" id="5931116">,</span>&nbsp;<span class="string" id="5931118">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5931157">,</span>&nbsp;<span class="ident" id="5931159">arg</span><span class="op" id="5931162">,</span>&nbsp;<span class="ident" id="5931164">arg</span><span class="op" id="5931167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5931172">panic</span><span class="op" id="5931177">(</span><span class="string" id="5931178">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5931195">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931203">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931220">next</span>&nbsp;<span class="op" id="5931225">:=</span>&nbsp;<span class="ident" id="5931228">p</span><span class="op" id="5931229">.</span><span class="ident" id="5931230">pos</span>&nbsp;<span class="comment" id="5931234">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931280">wroteNewline</span><span class="op" id="5931292">,</span>&nbsp;<span class="ident" id="5931294">droppedFF</span>&nbsp;<span class="op" id="5931304">:=</span>&nbsp;<span class="ident" id="5931307">p</span><span class="op" id="5931308">.</span><span class="ident" id="5931309">flush</span><span class="op" id="5931314">(</span><span class="ident" id="5931315">next</span><span class="op" id="5931319">,</span>&nbsp;<span class="ident" id="5931321">p</span><span class="op" id="5931322">.</span><span class="ident" id="5931323">lastTok</span><span class="op" id="5931330">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931335">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931396">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931456">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931521">if</span>&nbsp;<span class="op" id="5931524">!</span><span class="ident" id="5931525">p</span><span class="op" id="5931526">.</span><span class="ident" id="5931527">impliedSemi</span>&nbsp;<span class="op" id="5931539">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931544">n</span>&nbsp;<span class="op" id="5931546">:=</span>&nbsp;<span class="ident" id="5931549">nlimit</span><span class="op" id="5931555">(</span><span class="ident" id="5931556">next</span><span class="op" id="5931560">.</span><span class="ident" id="5931561">Line</span>&nbsp;<span class="op" id="5931566">-</span>&nbsp;<span class="ident" id="5931568">p</span><span class="op" id="5931569">.</span><span class="ident" id="5931570">pos</span><span class="op" id="5931573">.</span><span class="ident" id="5931574">Line</span><span class="op" id="5931578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931583">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931638">if</span>&nbsp;<span class="ident" id="5931641">wroteNewline</span>&nbsp;<span class="op" id="5931654">&amp;&amp;</span>&nbsp;<span class="ident" id="5931657">n</span>&nbsp;<span class="op" id="5931659">==</span>&nbsp;<span class="ident" id="5931662">maxNewlines</span>&nbsp;<span class="op" id="5931674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931680">n</span>&nbsp;<span class="op" id="5931682">=</span>&nbsp;<span class="ident" id="5931684">maxNewlines</span>&nbsp;<span class="op" id="5931696">-</span>&nbsp;<span class="num" id="5931698">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931703">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931708">if</span>&nbsp;<span class="ident" id="5931711">n</span>&nbsp;<span class="op" id="5931713">&gt;</span>&nbsp;<span class="num" id="5931715">0</span>&nbsp;<span class="op" id="5931717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931723">ch</span>&nbsp;<span class="op" id="5931726">:=</span>&nbsp;<span class="builtintype" id="5931729">byte</span><span class="op" id="5931733">(</span><span class="string" id="5931734">&#39;\n&#39;</span><span class="op" id="5931738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931744">if</span>&nbsp;<span class="ident" id="5931747">droppedFF</span>&nbsp;<span class="op" id="5931757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931764">ch</span>&nbsp;<span class="op" id="5931767">=</span>&nbsp;<span class="string" id="5931769">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5931774">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931822">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931828">p</span><span class="op" id="5931829">.</span><span class="ident" id="5931830">writeByte</span><span class="op" id="5931839">(</span><span class="ident" id="5931840">ch</span><span class="op" id="5931842">,</span>&nbsp;<span class="ident" id="5931844">n</span><span class="op" id="5931845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931851">impliedSemi</span>&nbsp;<span class="op" id="5931863">=</span>&nbsp;<span class="builtintype" id="5931865">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5931883">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931952">if</span>&nbsp;<span class="ident" id="5931955">p</span><span class="op" id="5931956">.</span><span class="ident" id="5931957">linePtr</span>&nbsp;<span class="op" id="5931965">!=</span>&nbsp;<span class="ident" id="5931968">nil</span>&nbsp;<span class="op" id="5931972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931977">*</span><span class="ident" id="5931978">p</span><span class="op" id="5931979">.</span><span class="ident" id="5931980">linePtr</span>&nbsp;<span class="op" id="5931988">=</span>&nbsp;<span class="ident" id="5931990">p</span><span class="op" id="5931991">.</span><span class="ident" id="5931992">out</span><span class="op" id="5931995">.</span><span class="ident" id="5931996">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932004">p</span><span class="op" id="5932005">.</span><span class="ident" id="5932006">linePtr</span>&nbsp;<span class="op" id="5932014">=</span>&nbsp;<span class="ident" id="5932016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932022">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932027">p</span><span class="op" id="5932028">.</span><span class="ident" id="5932029">writeString</span><span class="op" id="5932040">(</span><span class="ident" id="5932041">next</span><span class="op" id="5932045">,</span>&nbsp;<span class="ident" id="5932047">data</span><span class="op" id="5932051">,</span>&nbsp;<span class="ident" id="5932053">isLit</span><span class="op" id="5932058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932062">p</span><span class="op" id="5932063">.</span><span class="ident" id="5932064">impliedSemi</span>&nbsp;<span class="op" id="5932076">=</span>&nbsp;<span class="ident" id="5932078">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932091">}</span><br>
<span class="lineno"></span><span class="op" id="5932093">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5932096">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5932168">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5932241">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5932318">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5932329">//</span><br>
<span class="lineno"></span><span class="keyword" id="5932332">func</span>&nbsp;<span class="op" id="5932337">(</span><span class="ident" id="5932338">p</span>&nbsp;<span class="op" id="5932340">*</span><span class="ident" id="5932341">printer</span><span class="op" id="5932348">)</span>&nbsp;<span class="ident" id="5932350">flush</span><span class="op" id="5932355">(</span><span class="ident" id="5932356">next</span>&nbsp;<span class="ident" id="5932361">token</span><span class="op" id="5932366">.</span><span class="ident" id="5932367">Position</span><span class="op" id="5932375">,</span>&nbsp;<span class="ident" id="5932377">tok</span>&nbsp;<span class="ident" id="5932381">token</span><span class="op" id="5932386">.</span><span class="ident" id="5932387">Token</span><span class="op" id="5932392">)</span>&nbsp;<span class="op" id="5932394">(</span><span class="ident" id="5932395">wroteNewline</span><span class="op" id="5932407">,</span>&nbsp;<span class="ident" id="5932409">droppedFF</span>&nbsp;<span class="builtintype" id="5932419">bool</span><span class="op" id="5932423">)</span>&nbsp;<span class="op" id="5932425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932428">if</span>&nbsp;<span class="ident" id="5932431">p</span><span class="op" id="5932432">.</span><span class="ident" id="5932433">commentBefore</span><span class="op" id="5932446">(</span><span class="ident" id="5932447">next</span><span class="op" id="5932451">)</span>&nbsp;<span class="op" id="5932453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932457">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932523">wroteNewline</span><span class="op" id="5932535">,</span>&nbsp;<span class="ident" id="5932537">droppedFF</span>&nbsp;<span class="op" id="5932547">=</span>&nbsp;<span class="ident" id="5932549">p</span><span class="op" id="5932550">.</span><span class="ident" id="5932551">intersperseComments</span><span class="op" id="5932570">(</span><span class="ident" id="5932571">next</span><span class="op" id="5932575">,</span>&nbsp;<span class="ident" id="5932577">tok</span><span class="op" id="5932580">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932583">}</span>&nbsp;<span class="keyword" id="5932585">else</span>&nbsp;<span class="op" id="5932590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932594">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932640">p</span><span class="op" id="5932641">.</span><span class="ident" id="5932642">writeWhitespace</span><span class="op" id="5932657">(</span><span class="builtinfunc" id="5932658">len</span><span class="op" id="5932661">(</span><span class="ident" id="5932662">p</span><span class="op" id="5932663">.</span><span class="ident" id="5932664">wsbuf</span><span class="op" id="5932669">)</span><span class="op" id="5932670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932676">return</span><br>
<span class="lineno">990</span><span class="op" id="5932683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5932686">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5932753">func</span>&nbsp;<span class="ident" id="5932758">getDoc</span><span class="op" id="5932764">(</span><span class="ident" id="5932765">n</span>&nbsp;<span class="ident" id="5932767">ast</span><span class="op" id="5932770">.</span><span class="ident" id="5932771">Node</span><span class="op" id="5932775">)</span>&nbsp;<span class="op" id="5932777">*</span><span class="ident" id="5932778">ast</span><span class="op" id="5932781">.</span><span class="ident" id="5932782">CommentGroup</span>&nbsp;<span class="op" id="5932795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932798">switch</span>&nbsp;<span class="ident" id="5932805">n</span>&nbsp;<span class="op" id="5932807">:=</span>&nbsp;<span class="ident" id="5932810">n</span><span class="op" id="5932811">.</span><span class="op" id="5932812">(</span><span class="keyword" id="5932813">type</span><span class="op" id="5932817">)</span>&nbsp;<span class="op" id="5932819">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932822">case</span>&nbsp;<span class="op" id="5932827">*</span><span class="ident" id="5932828">ast</span><span class="op" id="5932831">.</span><span class="ident" id="5932832">Field</span><span class="op" id="5932837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932841">return</span>&nbsp;<span class="ident" id="5932848">n</span><span class="op" id="5932849">.</span><span class="ident" id="5932850">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932855">case</span>&nbsp;<span class="op" id="5932860">*</span><span class="ident" id="5932861">ast</span><span class="op" id="5932864">.</span><span class="ident" id="5932865">ImportSpec</span><span class="op" id="5932875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932879">return</span>&nbsp;<span class="ident" id="5932886">n</span><span class="op" id="5932887">.</span><span class="ident" id="5932888">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932893">case</span>&nbsp;<span class="op" id="5932898">*</span><span class="ident" id="5932899">ast</span><span class="op" id="5932902">.</span><span class="ident" id="5932903">ValueSpec</span><span class="op" id="5932912">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932916">return</span>&nbsp;<span class="ident" id="5932923">n</span><span class="op" id="5932924">.</span><span class="ident" id="5932925">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932930">case</span>&nbsp;<span class="op" id="5932935">*</span><span class="ident" id="5932936">ast</span><span class="op" id="5932939">.</span><span class="ident" id="5932940">TypeSpec</span><span class="op" id="5932948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932952">return</span>&nbsp;<span class="ident" id="5932959">n</span><span class="op" id="5932960">.</span><span class="ident" id="5932961">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932966">case</span>&nbsp;<span class="op" id="5932971">*</span><span class="ident" id="5932972">ast</span><span class="op" id="5932975">.</span><span class="ident" id="5932976">GenDecl</span><span class="op" id="5932983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932987">return</span>&nbsp;<span class="ident" id="5932994">n</span><span class="op" id="5932995">.</span><span class="ident" id="5932996">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933001">case</span>&nbsp;<span class="op" id="5933006">*</span><span class="ident" id="5933007">ast</span><span class="op" id="5933010">.</span><span class="ident" id="5933011">FuncDecl</span><span class="op" id="5933019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933023">return</span>&nbsp;<span class="ident" id="5933030">n</span><span class="op" id="5933031">.</span><span class="ident" id="5933032">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933037">case</span>&nbsp;<span class="op" id="5933042">*</span><span class="ident" id="5933043">ast</span><span class="op" id="5933046">.</span><span class="ident" id="5933047">File</span><span class="op" id="5933051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933055">return</span>&nbsp;<span class="ident" id="5933062">n</span><span class="op" id="5933063">.</span><span class="ident" id="5933064">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933069">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933072">return</span>&nbsp;<span class="ident" id="5933079">nil</span><br>
<span class="lineno"></span><span class="op" id="5933083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5933086">func</span>&nbsp;<span class="op" id="5933091">(</span><span class="ident" id="5933092">p</span>&nbsp;<span class="op" id="5933094">*</span><span class="ident" id="5933095">printer</span><span class="op" id="5933102">)</span>&nbsp;<span class="ident" id="5933104">printNode</span><span class="op" id="5933113">(</span><span class="ident" id="5933114">node</span>&nbsp;<span class="keyword" id="5933119">interface</span><span class="op" id="5933128">{</span><span class="op" id="5933129">}</span><span class="op" id="5933130">)</span>&nbsp;<span class="builtintype" id="5933132">error</span>&nbsp;<span class="op" id="5933138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933141">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933175">var</span>&nbsp;<span class="ident" id="5933179">comments</span>&nbsp;<span class="op" id="5933188">[</span><span class="op" id="5933189">]</span><span class="op" id="5933190">*</span><span class="ident" id="5933191">ast</span><span class="op" id="5933194">.</span><span class="ident" id="5933195">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933209">if</span>&nbsp;<span class="ident" id="5933212">cnode</span><span class="op" id="5933217">,</span>&nbsp;<span class="ident" id="5933219">ok</span>&nbsp;<span class="op" id="5933222">:=</span>&nbsp;<span class="ident" id="5933225">node</span><span class="op" id="5933229">.</span><span class="op" id="5933230">(</span><span class="op" id="5933231">*</span><span class="ident" id="5933232">CommentedNode</span><span class="op" id="5933245">)</span><span class="op" id="5933246">;</span>&nbsp;<span class="ident" id="5933248">ok</span>&nbsp;<span class="op" id="5933251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933255">node</span>&nbsp;<span class="op" id="5933260">=</span>&nbsp;<span class="ident" id="5933262">cnode</span><span class="op" id="5933267">.</span><span class="ident" id="5933268">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933275">comments</span>&nbsp;<span class="op" id="5933284">=</span>&nbsp;<span class="ident" id="5933286">cnode</span><span class="op" id="5933291">.</span><span class="ident" id="5933292">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933302">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933306">if</span>&nbsp;<span class="ident" id="5933309">comments</span>&nbsp;<span class="op" id="5933318">!=</span>&nbsp;<span class="ident" id="5933321">nil</span>&nbsp;<span class="op" id="5933325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933329">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933391">n</span><span class="op" id="5933392">,</span>&nbsp;<span class="ident" id="5933394">ok</span>&nbsp;<span class="op" id="5933397">:=</span>&nbsp;<span class="ident" id="5933400">node</span><span class="op" id="5933404">.</span><span class="op" id="5933405">(</span><span class="ident" id="5933406">ast</span><span class="op" id="5933409">.</span><span class="ident" id="5933410">Node</span><span class="op" id="5933414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933418">if</span>&nbsp;<span class="op" id="5933421">!</span><span class="ident" id="5933422">ok</span>&nbsp;<span class="op" id="5933425">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933430">goto</span>&nbsp;<span class="ident" id="5933435">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933453">beg</span>&nbsp;<span class="op" id="5933457">:=</span>&nbsp;<span class="ident" id="5933460">n</span><span class="op" id="5933461">.</span><span class="ident" id="5933462">Pos</span><span class="op" id="5933465">(</span><span class="op" id="5933466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933470">end</span>&nbsp;<span class="op" id="5933474">:=</span>&nbsp;<span class="ident" id="5933477">n</span><span class="op" id="5933478">.</span><span class="ident" id="5933479">End</span><span class="op" id="5933482">(</span><span class="op" id="5933483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933487">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933534">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933578">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933624">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933675">if</span>&nbsp;<span class="ident" id="5933678">doc</span>&nbsp;<span class="op" id="5933682">:=</span>&nbsp;<span class="ident" id="5933685">getDoc</span><span class="op" id="5933691">(</span><span class="ident" id="5933692">n</span><span class="op" id="5933693">)</span><span class="op" id="5933694">;</span>&nbsp;<span class="ident" id="5933696">doc</span>&nbsp;<span class="op" id="5933700">!=</span>&nbsp;<span class="ident" id="5933703">nil</span>&nbsp;<span class="op" id="5933707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933712">beg</span>&nbsp;<span class="op" id="5933716">=</span>&nbsp;<span class="ident" id="5933718">doc</span><span class="op" id="5933721">.</span><span class="ident" id="5933722">Pos</span><span class="op" id="5933725">(</span><span class="op" id="5933726">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933734">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933783">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933810">i</span>&nbsp;<span class="op" id="5933812">:=</span>&nbsp;<span class="num" id="5933815">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933819">for</span>&nbsp;<span class="ident" id="5933823">i</span>&nbsp;<span class="op" id="5933825">&lt;</span>&nbsp;<span class="builtinfunc" id="5933827">len</span><span class="op" id="5933830">(</span><span class="ident" id="5933831">comments</span><span class="op" id="5933839">)</span>&nbsp;<span class="op" id="5933841">&amp;&amp;</span>&nbsp;<span class="ident" id="5933844">comments</span><span class="op" id="5933852">[</span><span class="ident" id="5933853">i</span><span class="op" id="5933854">]</span><span class="op" id="5933855">.</span><span class="ident" id="5933856">End</span><span class="op" id="5933859">(</span><span class="op" id="5933860">)</span>&nbsp;<span class="op" id="5933862">&lt;</span>&nbsp;<span class="ident" id="5933864">beg</span>&nbsp;<span class="op" id="5933868">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933873">i</span><span class="op" id="5933874">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933883">j</span>&nbsp;<span class="op" id="5933885">:=</span>&nbsp;<span class="ident" id="5933888">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933892">for</span>&nbsp;<span class="ident" id="5933896">j</span>&nbsp;<span class="op" id="5933898">&lt;</span>&nbsp;<span class="builtinfunc" id="5933900">len</span><span class="op" id="5933903">(</span><span class="ident" id="5933904">comments</span><span class="op" id="5933912">)</span>&nbsp;<span class="op" id="5933914">&amp;&amp;</span>&nbsp;<span class="ident" id="5933917">comments</span><span class="op" id="5933925">[</span><span class="ident" id="5933926">j</span><span class="op" id="5933927">]</span><span class="op" id="5933928">.</span><span class="ident" id="5933929">Pos</span><span class="op" id="5933932">(</span><span class="op" id="5933933">)</span>&nbsp;<span class="op" id="5933935">&lt;</span>&nbsp;<span class="ident" id="5933937">end</span>&nbsp;<span class="op" id="5933941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933946">j</span><span class="op" id="5933947">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933956">if</span>&nbsp;<span class="ident" id="5933959">i</span>&nbsp;<span class="op" id="5933961">&lt;</span>&nbsp;<span class="ident" id="5933963">j</span>&nbsp;<span class="op" id="5933965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933970">p</span><span class="op" id="5933971">.</span><span class="ident" id="5933972">comments</span>&nbsp;<span class="op" id="5933981">=</span>&nbsp;<span class="ident" id="5933983">comments</span><span class="op" id="5933991">[</span><span class="ident" id="5933992">i</span><span class="op" id="5933993">:</span><span class="ident" id="5933994">j</span><span class="op" id="5933995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934002">}</span>&nbsp;<span class="keyword" id="5934004">else</span>&nbsp;<span class="keyword" id="5934009">if</span>&nbsp;<span class="ident" id="5934012">n</span><span class="op" id="5934013">,</span>&nbsp;<span class="ident" id="5934015">ok</span>&nbsp;<span class="op" id="5934018">:=</span>&nbsp;<span class="ident" id="5934021">node</span><span class="op" id="5934025">.</span><span class="op" id="5934026">(</span><span class="op" id="5934027">*</span><span class="ident" id="5934028">ast</span><span class="op" id="5934031">.</span><span class="ident" id="5934032">File</span><span class="op" id="5934036">)</span><span class="op" id="5934037">;</span>&nbsp;<span class="ident" id="5934039">ok</span>&nbsp;<span class="op" id="5934042">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934046">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934081">p</span><span class="op" id="5934082">.</span><span class="ident" id="5934083">comments</span>&nbsp;<span class="op" id="5934092">=</span>&nbsp;<span class="ident" id="5934094">n</span><span class="op" id="5934095">.</span><span class="ident" id="5934096">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934110">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934158">p</span><span class="op" id="5934159">.</span><span class="ident" id="5934160">useNodeComments</span>&nbsp;<span class="op" id="5934176">=</span>&nbsp;<span class="ident" id="5934178">p</span><span class="op" id="5934179">.</span><span class="ident" id="5934180">comments</span>&nbsp;<span class="op" id="5934189">==</span>&nbsp;<span class="ident" id="5934192">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934198">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934229">p</span><span class="op" id="5934230">.</span><span class="ident" id="5934231">nextComment</span><span class="op" id="5934242">(</span><span class="op" id="5934243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934247">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934263">switch</span>&nbsp;<span class="ident" id="5934270">n</span>&nbsp;<span class="op" id="5934272">:=</span>&nbsp;<span class="ident" id="5934275">node</span><span class="op" id="5934279">.</span><span class="op" id="5934280">(</span><span class="keyword" id="5934281">type</span><span class="op" id="5934285">)</span>&nbsp;<span class="op" id="5934287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934290">case</span>&nbsp;<span class="ident" id="5934295">ast</span><span class="op" id="5934298">.</span><span class="ident" id="5934299">Expr</span><span class="op" id="5934303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934307">p</span><span class="op" id="5934308">.</span><span class="ident" id="5934309">expr</span><span class="op" id="5934313">(</span><span class="ident" id="5934314">n</span><span class="op" id="5934315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934318">case</span>&nbsp;<span class="ident" id="5934323">ast</span><span class="op" id="5934326">.</span><span class="ident" id="5934327">Stmt</span><span class="op" id="5934331">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934335">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934398">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934457">if</span>&nbsp;<span class="ident" id="5934460">_</span><span class="op" id="5934461">,</span>&nbsp;<span class="ident" id="5934463">ok</span>&nbsp;<span class="op" id="5934466">:=</span>&nbsp;<span class="ident" id="5934469">n</span><span class="op" id="5934470">.</span><span class="op" id="5934471">(</span><span class="op" id="5934472">*</span><span class="ident" id="5934473">ast</span><span class="op" id="5934476">.</span><span class="ident" id="5934477">LabeledStmt</span><span class="op" id="5934488">)</span><span class="op" id="5934489">;</span>&nbsp;<span class="ident" id="5934491">ok</span>&nbsp;<span class="op" id="5934494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934499">p</span><span class="op" id="5934500">.</span><span class="ident" id="5934501">indent</span>&nbsp;<span class="op" id="5934508">=</span>&nbsp;<span class="num" id="5934510">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934514">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934518">p</span><span class="op" id="5934519">.</span><span class="ident" id="5934520">stmt</span><span class="op" id="5934524">(</span><span class="ident" id="5934525">n</span><span class="op" id="5934526">,</span>&nbsp;<span class="builtintype" id="5934528">false</span><span class="op" id="5934533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934536">case</span>&nbsp;<span class="ident" id="5934541">ast</span><span class="op" id="5934544">.</span><span class="ident" id="5934545">Decl</span><span class="op" id="5934549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934553">p</span><span class="op" id="5934554">.</span><span class="ident" id="5934555">decl</span><span class="op" id="5934559">(</span><span class="ident" id="5934560">n</span><span class="op" id="5934561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934564">case</span>&nbsp;<span class="ident" id="5934569">ast</span><span class="op" id="5934572">.</span><span class="ident" id="5934573">Spec</span><span class="op" id="5934577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934581">p</span><span class="op" id="5934582">.</span><span class="ident" id="5934583">spec</span><span class="op" id="5934587">(</span><span class="ident" id="5934588">n</span><span class="op" id="5934589">,</span>&nbsp;<span class="num" id="5934591">1</span><span class="op" id="5934592">,</span>&nbsp;<span class="builtintype" id="5934594">false</span><span class="op" id="5934599">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934602">case</span>&nbsp;<span class="op" id="5934607">[</span><span class="op" id="5934608">]</span><span class="ident" id="5934609">ast</span><span class="op" id="5934612">.</span><span class="ident" id="5934613">Stmt</span><span class="op" id="5934617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934621">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934684">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934743">for</span>&nbsp;<span class="ident" id="5934747">_</span><span class="op" id="5934748">,</span>&nbsp;<span class="ident" id="5934750">s</span>&nbsp;<span class="op" id="5934752">:=</span>&nbsp;<span class="keyword" id="5934755">range</span>&nbsp;<span class="ident" id="5934761">n</span>&nbsp;<span class="op" id="5934763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934768">if</span>&nbsp;<span class="ident" id="5934771">_</span><span class="op" id="5934772">,</span>&nbsp;<span class="ident" id="5934774">ok</span>&nbsp;<span class="op" id="5934777">:=</span>&nbsp;<span class="ident" id="5934780">s</span><span class="op" id="5934781">.</span><span class="op" id="5934782">(</span><span class="op" id="5934783">*</span><span class="ident" id="5934784">ast</span><span class="op" id="5934787">.</span><span class="ident" id="5934788">LabeledStmt</span><span class="op" id="5934799">)</span><span class="op" id="5934800">;</span>&nbsp;<span class="ident" id="5934802">ok</span>&nbsp;<span class="op" id="5934805">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934811">p</span><span class="op" id="5934812">.</span><span class="ident" id="5934813">indent</span>&nbsp;<span class="op" id="5934820">=</span>&nbsp;<span class="num" id="5934822">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934835">p</span><span class="op" id="5934836">.</span><span class="ident" id="5934837">stmtList</span><span class="op" id="5934845">(</span><span class="ident" id="5934846">n</span><span class="op" id="5934847">,</span>&nbsp;<span class="num" id="5934849">0</span><span class="op" id="5934850">,</span>&nbsp;<span class="builtintype" id="5934852">false</span><span class="op" id="5934857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934860">case</span>&nbsp;<span class="op" id="5934865">[</span><span class="op" id="5934866">]</span><span class="ident" id="5934867">ast</span><span class="op" id="5934870">.</span><span class="ident" id="5934871">Decl</span><span class="op" id="5934875">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934879">p</span><span class="op" id="5934880">.</span><span class="ident" id="5934881">declList</span><span class="op" id="5934889">(</span><span class="ident" id="5934890">n</span><span class="op" id="5934891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934894">case</span>&nbsp;<span class="op" id="5934899">*</span><span class="ident" id="5934900">ast</span><span class="op" id="5934903">.</span><span class="ident" id="5934904">File</span><span class="op" id="5934908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934912">p</span><span class="op" id="5934913">.</span><span class="ident" id="5934914">file</span><span class="op" id="5934918">(</span><span class="ident" id="5934919">n</span><span class="op" id="5934920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934923">default</span><span class="op" id="5934930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934934">goto</span>&nbsp;<span class="ident" id="5934939">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934956">return</span>&nbsp;<span class="ident" id="5934963">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5934968">unsupported</span><span class="op" id="5934979">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934982">return</span>&nbsp;<span class="ident" id="5934989">fmt</span><span class="op" id="5934992">.</span><span class="ident" id="5934993">Errorf</span><span class="op" id="5934999">(</span><span class="string" id="5935000">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5935038">,</span>&nbsp;<span class="ident" id="5935040">node</span><span class="op" id="5935044">)</span><br>
<span class="lineno"></span><span class="op" id="5935046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935049">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5935129">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5935141">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5935208">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5935277">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5935346">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5935415">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5935437">//</span><br>
<span class="lineno"></span><span class="keyword" id="5935440">type</span>&nbsp;<span class="ident" id="5935445">trimmer</span>&nbsp;<span class="keyword" id="5935453">struct</span>&nbsp;<span class="op" id="5935460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935463">output</span>&nbsp;<span class="ident" id="5935470">io</span><span class="op" id="5935472">.</span><span class="ident" id="5935473">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935481">state</span>&nbsp;&nbsp;<span class="builtintype" id="5935488">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935493">space</span>&nbsp;&nbsp;<span class="op" id="5935500">[</span><span class="op" id="5935501">]</span><span class="builtintype" id="5935502">byte</span><br>
<span class="lineno"></span><span class="op" id="5935507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935510">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5935556">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5935601">const</span>&nbsp;<span class="op" id="5935607">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935610">inSpace</span>&nbsp;&nbsp;<span class="op" id="5935619">=</span>&nbsp;<span class="ident" id="5935621">iota</span>&nbsp;<span class="comment" id="5935626">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935643">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935659">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935706">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935722">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5935737">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5935740">func</span>&nbsp;<span class="op" id="5935745">(</span><span class="ident" id="5935746">p</span>&nbsp;<span class="op" id="5935748">*</span><span class="ident" id="5935749">trimmer</span><span class="op" id="5935756">)</span>&nbsp;<span class="ident" id="5935758">resetSpace</span><span class="op" id="5935768">(</span><span class="op" id="5935769">)</span>&nbsp;<span class="op" id="5935771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935774">p</span><span class="op" id="5935775">.</span><span class="ident" id="5935776">state</span>&nbsp;<span class="op" id="5935782">=</span>&nbsp;<span class="ident" id="5935784">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935793">p</span><span class="op" id="5935794">.</span><span class="ident" id="5935795">space</span>&nbsp;<span class="op" id="5935801">=</span>&nbsp;<span class="ident" id="5935803">p</span><span class="op" id="5935804">.</span><span class="ident" id="5935805">space</span><span class="op" id="5935810">[</span><span class="num" id="5935811">0</span><span class="op" id="5935812">:</span><span class="num" id="5935813">0</span><span class="op" id="5935814">]</span><br>
<span class="lineno"></span><span class="op" id="5935816">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5935819">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5935889">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5935959">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5936027">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5936094">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5936126">var</span>&nbsp;<span class="ident" id="5936130">aNewline</span>&nbsp;<span class="op" id="5936139">=</span>&nbsp;<span class="op" id="5936141">[</span><span class="op" id="5936142">]</span><span class="builtintype" id="5936143">byte</span><span class="op" id="5936147">(</span><span class="string" id="5936148">&#34;\n&#34;</span><span class="op" id="5936152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5936155">func</span>&nbsp;<span class="op" id="5936160">(</span><span class="ident" id="5936161">p</span>&nbsp;<span class="op" id="5936163">*</span><span class="ident" id="5936164">trimmer</span><span class="op" id="5936171">)</span>&nbsp;<span class="ident" id="5936173">Write</span><span class="op" id="5936178">(</span><span class="ident" id="5936179">data</span>&nbsp;<span class="op" id="5936184">[</span><span class="op" id="5936185">]</span><span class="builtintype" id="5936186">byte</span><span class="op" id="5936190">)</span>&nbsp;<span class="op" id="5936192">(</span><span class="ident" id="5936193">n</span>&nbsp;<span class="builtintype" id="5936195">int</span><span class="op" id="5936198">,</span>&nbsp;<span class="ident" id="5936200">err</span>&nbsp;<span class="builtintype" id="5936204">error</span><span class="op" id="5936209">)</span>&nbsp;<span class="op" id="5936211">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936214">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936230">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936254">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936279">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936312">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936339">m</span>&nbsp;<span class="op" id="5936341">:=</span>&nbsp;<span class="num" id="5936344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936347">var</span>&nbsp;<span class="ident" id="5936351">b</span>&nbsp;<span class="builtintype" id="5936353">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936359">for</span>&nbsp;<span class="ident" id="5936363">n</span><span class="op" id="5936364">,</span>&nbsp;<span class="ident" id="5936366">b</span>&nbsp;<span class="op" id="5936368">=</span>&nbsp;<span class="keyword" id="5936370">range</span>&nbsp;<span class="ident" id="5936376">data</span>&nbsp;<span class="op" id="5936381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936385">if</span>&nbsp;<span class="ident" id="5936388">b</span>&nbsp;<span class="op" id="5936390">==</span>&nbsp;<span class="string" id="5936393">&#39;\v&#39;</span>&nbsp;<span class="op" id="5936398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936403">b</span>&nbsp;<span class="op" id="5936405">=</span>&nbsp;<span class="string" id="5936407">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5936412">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936437">switch</span>&nbsp;<span class="ident" id="5936444">p</span><span class="op" id="5936445">.</span><span class="ident" id="5936446">state</span>&nbsp;<span class="op" id="5936452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936456">case</span>&nbsp;<span class="ident" id="5936461">inSpace</span><span class="op" id="5936468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936473">switch</span>&nbsp;<span class="ident" id="5936480">b</span>&nbsp;<span class="op" id="5936482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936487">case</span>&nbsp;<span class="string" id="5936492">&#39;\t&#39;</span><span class="op" id="5936496">,</span>&nbsp;<span class="string" id="5936498">&#39;&nbsp;&#39;</span><span class="op" id="5936501">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936507">p</span><span class="op" id="5936508">.</span><span class="ident" id="5936509">space</span>&nbsp;<span class="op" id="5936515">=</span>&nbsp;<span class="builtinfunc" id="5936517">append</span><span class="op" id="5936523">(</span><span class="ident" id="5936524">p</span><span class="op" id="5936525">.</span><span class="ident" id="5936526">space</span><span class="op" id="5936531">,</span>&nbsp;<span class="ident" id="5936533">b</span><span class="op" id="5936534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936539">case</span>&nbsp;<span class="string" id="5936544">&#39;\n&#39;</span><span class="op" id="5936548">,</span>&nbsp;<span class="string" id="5936550">&#39;\f&#39;</span><span class="op" id="5936554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936560">p</span><span class="op" id="5936561">.</span><span class="ident" id="5936562">resetSpace</span><span class="op" id="5936572">(</span><span class="op" id="5936573">)</span>&nbsp;<span class="comment" id="5936575">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936605">_</span><span class="op" id="5936606">,</span>&nbsp;<span class="ident" id="5936608">err</span>&nbsp;<span class="op" id="5936612">=</span>&nbsp;<span class="ident" id="5936614">p</span><span class="op" id="5936615">.</span><span class="ident" id="5936616">output</span><span class="op" id="5936622">.</span><span class="ident" id="5936623">Write</span><span class="op" id="5936628">(</span><span class="ident" id="5936629">aNewline</span><span class="op" id="5936637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936642">case</span>&nbsp;<span class="ident" id="5936647">tabwriter</span><span class="op" id="5936656">.</span><span class="ident" id="5936657">Escape</span><span class="op" id="5936663">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936669">_</span><span class="op" id="5936670">,</span>&nbsp;<span class="ident" id="5936672">err</span>&nbsp;<span class="op" id="5936676">=</span>&nbsp;<span class="ident" id="5936678">p</span><span class="op" id="5936679">.</span><span class="ident" id="5936680">output</span><span class="op" id="5936686">.</span><span class="ident" id="5936687">Write</span><span class="op" id="5936692">(</span><span class="ident" id="5936693">p</span><span class="op" id="5936694">.</span><span class="ident" id="5936695">space</span><span class="op" id="5936700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936706">p</span><span class="op" id="5936707">.</span><span class="ident" id="5936708">state</span>&nbsp;<span class="op" id="5936714">=</span>&nbsp;<span class="ident" id="5936716">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936729">m</span>&nbsp;<span class="op" id="5936731">=</span>&nbsp;<span class="ident" id="5936733">n</span>&nbsp;<span class="op" id="5936735">+</span>&nbsp;<span class="num" id="5936737">1</span>&nbsp;<span class="comment" id="5936739">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936771">default</span><span class="op" id="5936778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936784">_</span><span class="op" id="5936785">,</span>&nbsp;<span class="ident" id="5936787">err</span>&nbsp;<span class="op" id="5936791">=</span>&nbsp;<span class="ident" id="5936793">p</span><span class="op" id="5936794">.</span><span class="ident" id="5936795">output</span><span class="op" id="5936801">.</span><span class="ident" id="5936802">Write</span><span class="op" id="5936807">(</span><span class="ident" id="5936808">p</span><span class="op" id="5936809">.</span><span class="ident" id="5936810">space</span><span class="op" id="5936815">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936821">p</span><span class="op" id="5936822">.</span><span class="ident" id="5936823">state</span>&nbsp;<span class="op" id="5936829">=</span>&nbsp;<span class="ident" id="5936831">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936842">m</span>&nbsp;<span class="op" id="5936844">=</span>&nbsp;<span class="ident" id="5936846">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936855">case</span>&nbsp;<span class="ident" id="5936860">inEscape</span><span class="op" id="5936868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936873">if</span>&nbsp;<span class="ident" id="5936876">b</span>&nbsp;<span class="op" id="5936878">==</span>&nbsp;<span class="ident" id="5936881">tabwriter</span><span class="op" id="5936890">.</span><span class="ident" id="5936891">Escape</span>&nbsp;<span class="op" id="5936898">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936904">_</span><span class="op" id="5936905">,</span>&nbsp;<span class="ident" id="5936907">err</span>&nbsp;<span class="op" id="5936911">=</span>&nbsp;<span class="ident" id="5936913">p</span><span class="op" id="5936914">.</span><span class="ident" id="5936915">output</span><span class="op" id="5936921">.</span><span class="ident" id="5936922">Write</span><span class="op" id="5936927">(</span><span class="ident" id="5936928">data</span><span class="op" id="5936932">[</span><span class="ident" id="5936933">m</span><span class="op" id="5936934">:</span><span class="ident" id="5936935">n</span><span class="op" id="5936936">]</span><span class="op" id="5936937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936943">p</span><span class="op" id="5936944">.</span><span class="ident" id="5936945">resetSpace</span><span class="op" id="5936955">(</span><span class="op" id="5936956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936965">case</span>&nbsp;<span class="ident" id="5936970">inText</span><span class="op" id="5936976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936981">switch</span>&nbsp;<span class="ident" id="5936988">b</span>&nbsp;<span class="op" id="5936990">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936995">case</span>&nbsp;<span class="string" id="5937000">&#39;\t&#39;</span><span class="op" id="5937004">,</span>&nbsp;<span class="string" id="5937006">&#39;&nbsp;&#39;</span><span class="op" id="5937009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937015">_</span><span class="op" id="5937016">,</span>&nbsp;<span class="ident" id="5937018">err</span>&nbsp;<span class="op" id="5937022">=</span>&nbsp;<span class="ident" id="5937024">p</span><span class="op" id="5937025">.</span><span class="ident" id="5937026">output</span><span class="op" id="5937032">.</span><span class="ident" id="5937033">Write</span><span class="op" id="5937038">(</span><span class="ident" id="5937039">data</span><span class="op" id="5937043">[</span><span class="ident" id="5937044">m</span><span class="op" id="5937045">:</span><span class="ident" id="5937046">n</span><span class="op" id="5937047">]</span><span class="op" id="5937048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937054">p</span><span class="op" id="5937055">.</span><span class="ident" id="5937056">resetSpace</span><span class="op" id="5937066">(</span><span class="op" id="5937067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937073">p</span><span class="op" id="5937074">.</span><span class="ident" id="5937075">space</span>&nbsp;<span class="op" id="5937081">=</span>&nbsp;<span class="builtinfunc" id="5937083">append</span><span class="op" id="5937089">(</span><span class="ident" id="5937090">p</span><span class="op" id="5937091">.</span><span class="ident" id="5937092">space</span><span class="op" id="5937097">,</span>&nbsp;<span class="ident" id="5937099">b</span><span class="op" id="5937100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937105">case</span>&nbsp;<span class="string" id="5937110">&#39;\n&#39;</span><span class="op" id="5937114">,</span>&nbsp;<span class="string" id="5937116">&#39;\f&#39;</span><span class="op" id="5937120">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937126">_</span><span class="op" id="5937127">,</span>&nbsp;<span class="ident" id="5937129">err</span>&nbsp;<span class="op" id="5937133">=</span>&nbsp;<span class="ident" id="5937135">p</span><span class="op" id="5937136">.</span><span class="ident" id="5937137">output</span><span class="op" id="5937143">.</span><span class="ident" id="5937144">Write</span><span class="op" id="5937149">(</span><span class="ident" id="5937150">data</span><span class="op" id="5937154">[</span><span class="ident" id="5937155">m</span><span class="op" id="5937156">:</span><span class="ident" id="5937157">n</span><span class="op" id="5937158">]</span><span class="op" id="5937159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937165">p</span><span class="op" id="5937166">.</span><span class="ident" id="5937167">resetSpace</span><span class="op" id="5937177">(</span><span class="op" id="5937178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937184">_</span><span class="op" id="5937185">,</span>&nbsp;<span class="ident" id="5937187">err</span>&nbsp;<span class="op" id="5937191">=</span>&nbsp;<span class="ident" id="5937193">p</span><span class="op" id="5937194">.</span><span class="ident" id="5937195">output</span><span class="op" id="5937201">.</span><span class="ident" id="5937202">Write</span><span class="op" id="5937207">(</span><span class="ident" id="5937208">aNewline</span><span class="op" id="5937216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937221">case</span>&nbsp;<span class="ident" id="5937226">tabwriter</span><span class="op" id="5937235">.</span><span class="ident" id="5937236">Escape</span><span class="op" id="5937242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937248">_</span><span class="op" id="5937249">,</span>&nbsp;<span class="ident" id="5937251">err</span>&nbsp;<span class="op" id="5937255">=</span>&nbsp;<span class="ident" id="5937257">p</span><span class="op" id="5937258">.</span><span class="ident" id="5937259">output</span><span class="op" id="5937265">.</span><span class="ident" id="5937266">Write</span><span class="op" id="5937271">(</span><span class="ident" id="5937272">data</span><span class="op" id="5937276">[</span><span class="ident" id="5937277">m</span><span class="op" id="5937278">:</span><span class="ident" id="5937279">n</span><span class="op" id="5937280">]</span><span class="op" id="5937281">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937287">p</span><span class="op" id="5937288">.</span><span class="ident" id="5937289">state</span>&nbsp;<span class="op" id="5937295">=</span>&nbsp;<span class="ident" id="5937297">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937310">m</span>&nbsp;<span class="op" id="5937312">=</span>&nbsp;<span class="ident" id="5937314">n</span>&nbsp;<span class="op" id="5937316">+</span>&nbsp;<span class="num" id="5937318">1</span>&nbsp;<span class="comment" id="5937320">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937356">default</span><span class="op" id="5937363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5937368">panic</span><span class="op" id="5937373">(</span><span class="string" id="5937374">&#34;unreachable&#34;</span><span class="op" id="5937387">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937395">if</span>&nbsp;<span class="ident" id="5937398">err</span>&nbsp;<span class="op" id="5937402">!=</span>&nbsp;<span class="ident" id="5937405">nil</span>&nbsp;<span class="op" id="5937409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937414">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937426">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937429">n</span>&nbsp;<span class="op" id="5937431">=</span>&nbsp;<span class="builtinfunc" id="5937433">len</span><span class="op" id="5937436">(</span><span class="ident" id="5937437">data</span><span class="op" id="5937441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937445">switch</span>&nbsp;<span class="ident" id="5937452">p</span><span class="op" id="5937453">.</span><span class="ident" id="5937454">state</span>&nbsp;<span class="op" id="5937460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937463">case</span>&nbsp;<span class="ident" id="5937468">inEscape</span><span class="op" id="5937476">,</span>&nbsp;<span class="ident" id="5937478">inText</span><span class="op" id="5937484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937488">_</span><span class="op" id="5937489">,</span>&nbsp;<span class="ident" id="5937491">err</span>&nbsp;<span class="op" id="5937495">=</span>&nbsp;<span class="ident" id="5937497">p</span><span class="op" id="5937498">.</span><span class="ident" id="5937499">output</span><span class="op" id="5937505">.</span><span class="ident" id="5937506">Write</span><span class="op" id="5937511">(</span><span class="ident" id="5937512">data</span><span class="op" id="5937516">[</span><span class="ident" id="5937517">m</span><span class="op" id="5937518">:</span><span class="ident" id="5937519">n</span><span class="op" id="5937520">]</span><span class="op" id="5937521">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937525">p</span><span class="op" id="5937526">.</span><span class="ident" id="5937527">resetSpace</span><span class="op" id="5937537">(</span><span class="op" id="5937538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937545">return</span><br>
<span class="lineno"></span><span class="op" id="5937552">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5937555">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5937635">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5937656">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5937721">type</span>&nbsp;<span class="ident" id="5937726">Mode</span>&nbsp;<span class="builtintype" id="5937731">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5937737">const</span>&nbsp;<span class="op" id="5937743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937746">RawFormat</span>&nbsp;<span class="ident" id="5937756">Mode</span>&nbsp;<span class="op" id="5937761">=</span>&nbsp;<span class="num" id="5937763">1</span>&nbsp;<span class="op" id="5937765">&lt;&lt;</span>&nbsp;<span class="ident" id="5937768">iota</span>&nbsp;<span class="comment" id="5937773">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937830">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5937857">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937911">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5937938">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937983">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5938010">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5938072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938075">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5938123">type</span>&nbsp;<span class="ident" id="5938128">Config</span>&nbsp;<span class="keyword" id="5938135">struct</span>&nbsp;<span class="op" id="5938142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938145">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5938154">Mode</span>&nbsp;<span class="comment" id="5938159">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938174">Tabwidth</span>&nbsp;<span class="builtintype" id="5938183">int</span>&nbsp;&nbsp;<span class="comment" id="5938188">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938203">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5938212">int</span>&nbsp;&nbsp;<span class="comment" id="5938217">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5938276">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5938279">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5938368">func</span>&nbsp;<span class="op" id="5938373">(</span><span class="ident" id="5938374">cfg</span>&nbsp;<span class="op" id="5938378">*</span><span class="ident" id="5938379">Config</span><span class="op" id="5938385">)</span>&nbsp;<span class="ident" id="5938387">fprint</span><span class="op" id="5938393">(</span><span class="ident" id="5938394">output</span>&nbsp;<span class="ident" id="5938401">io</span><span class="op" id="5938403">.</span><span class="ident" id="5938404">Writer</span><span class="op" id="5938410">,</span>&nbsp;<span class="ident" id="5938412">fset</span>&nbsp;<span class="op" id="5938417">*</span><span class="ident" id="5938418">token</span><span class="op" id="5938423">.</span><span class="ident" id="5938424">FileSet</span><span class="op" id="5938431">,</span>&nbsp;<span class="ident" id="5938433">node</span>&nbsp;<span class="keyword" id="5938438">interface</span><span class="op" id="5938447">{</span><span class="op" id="5938448">}</span><span class="op" id="5938449">,</span>&nbsp;<span class="ident" id="5938451">nodeSizes</span>&nbsp;<span class="keyword" id="5938461">map</span><span class="op" id="5938464">[</span><span class="ident" id="5938465">ast</span><span class="op" id="5938468">.</span><span class="ident" id="5938469">Node</span><span class="op" id="5938473">]</span><span class="builtintype" id="5938474">int</span><span class="op" id="5938477">)</span>&nbsp;<span class="op" id="5938479">(</span><span class="ident" id="5938480">err</span>&nbsp;<span class="builtintype" id="5938484">error</span><span class="op" id="5938489">)</span>&nbsp;<span class="op" id="5938491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938494">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938509">var</span>&nbsp;<span class="ident" id="5938513">p</span>&nbsp;<span class="ident" id="5938515">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938524">p</span><span class="op" id="5938525">.</span><span class="ident" id="5938526">init</span><span class="op" id="5938530">(</span><span class="ident" id="5938531">cfg</span><span class="op" id="5938534">,</span>&nbsp;<span class="ident" id="5938536">fset</span><span class="op" id="5938540">,</span>&nbsp;<span class="ident" id="5938542">nodeSizes</span><span class="op" id="5938551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938554">if</span>&nbsp;<span class="ident" id="5938557">err</span>&nbsp;<span class="op" id="5938561">=</span>&nbsp;<span class="ident" id="5938563">p</span><span class="op" id="5938564">.</span><span class="ident" id="5938565">printNode</span><span class="op" id="5938574">(</span><span class="ident" id="5938575">node</span><span class="op" id="5938579">)</span><span class="op" id="5938580">;</span>&nbsp;<span class="ident" id="5938582">err</span>&nbsp;<span class="op" id="5938586">!=</span>&nbsp;<span class="ident" id="5938589">nil</span>&nbsp;<span class="op" id="5938593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938597">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938608">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938639">p</span><span class="op" id="5938640">.</span><span class="ident" id="5938641">impliedSemi</span>&nbsp;<span class="op" id="5938653">=</span>&nbsp;<span class="builtintype" id="5938655">false</span>&nbsp;<span class="comment" id="5938661">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938689">p</span><span class="op" id="5938690">.</span><span class="ident" id="5938691">flush</span><span class="op" id="5938696">(</span><span class="ident" id="5938697">token</span><span class="op" id="5938702">.</span><span class="ident" id="5938703">Position</span><span class="op" id="5938711">{</span><span class="ident" id="5938712">Offset</span><span class="op" id="5938718">:</span>&nbsp;<span class="ident" id="5938720">infinity</span><span class="op" id="5938728">,</span>&nbsp;<span class="ident" id="5938730">Line</span><span class="op" id="5938734">:</span>&nbsp;<span class="ident" id="5938736">infinity</span><span class="op" id="5938744">}</span><span class="op" id="5938745">,</span>&nbsp;<span class="ident" id="5938747">token</span><span class="op" id="5938752">.</span><span class="ident" id="5938753">EOF</span><span class="op" id="5938756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938760">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938831">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938903">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938968">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939035">output</span>&nbsp;<span class="op" id="5939042">=</span>&nbsp;<span class="op" id="5939044">&amp;</span><span class="ident" id="5939045">trimmer</span><span class="op" id="5939052">{</span><span class="ident" id="5939053">output</span><span class="op" id="5939059">:</span>&nbsp;<span class="ident" id="5939061">output</span><span class="op" id="5939067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939071">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939124">if</span>&nbsp;<span class="ident" id="5939127">cfg</span><span class="op" id="5939130">.</span><span class="ident" id="5939131">Mode</span><span class="op" id="5939135">&amp;</span><span class="ident" id="5939136">RawFormat</span>&nbsp;<span class="op" id="5939146">==</span>&nbsp;<span class="num" id="5939149">0</span>&nbsp;<span class="op" id="5939151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939155">minwidth</span>&nbsp;<span class="op" id="5939164">:=</span>&nbsp;<span class="ident" id="5939167">cfg</span><span class="op" id="5939170">.</span><span class="ident" id="5939171">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939183">padchar</span>&nbsp;<span class="op" id="5939191">:=</span>&nbsp;<span class="builtintype" id="5939194">byte</span><span class="op" id="5939198">(</span><span class="string" id="5939199">&#39;\t&#39;</span><span class="op" id="5939203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939207">if</span>&nbsp;<span class="ident" id="5939210">cfg</span><span class="op" id="5939213">.</span><span class="ident" id="5939214">Mode</span><span class="op" id="5939218">&amp;</span><span class="ident" id="5939219">UseSpaces</span>&nbsp;<span class="op" id="5939229">!=</span>&nbsp;<span class="num" id="5939232">0</span>&nbsp;<span class="op" id="5939234">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939239">padchar</span>&nbsp;<span class="op" id="5939247">=</span>&nbsp;<span class="string" id="5939249">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939260">twmode</span>&nbsp;<span class="op" id="5939267">:=</span>&nbsp;<span class="ident" id="5939270">tabwriter</span><span class="op" id="5939279">.</span><span class="ident" id="5939280">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939302">if</span>&nbsp;<span class="ident" id="5939305">cfg</span><span class="op" id="5939308">.</span><span class="ident" id="5939309">Mode</span><span class="op" id="5939313">&amp;</span><span class="ident" id="5939314">TabIndent</span>&nbsp;<span class="op" id="5939324">!=</span>&nbsp;<span class="num" id="5939327">0</span>&nbsp;<span class="op" id="5939329">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939334">minwidth</span>&nbsp;<span class="op" id="5939343">=</span>&nbsp;<span class="num" id="5939345">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939350">twmode</span>&nbsp;<span class="op" id="5939357">|=</span>&nbsp;<span class="ident" id="5939360">tabwriter</span><span class="op" id="5939369">.</span><span class="ident" id="5939370">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939387">output</span>&nbsp;<span class="op" id="5939394">=</span>&nbsp;<span class="ident" id="5939396">tabwriter</span><span class="op" id="5939405">.</span><span class="ident" id="5939406">NewWriter</span><span class="op" id="5939415">(</span><span class="ident" id="5939416">output</span><span class="op" id="5939422">,</span>&nbsp;<span class="ident" id="5939424">minwidth</span><span class="op" id="5939432">,</span>&nbsp;<span class="ident" id="5939434">cfg</span><span class="op" id="5939437">.</span><span class="ident" id="5939438">Tabwidth</span><span class="op" id="5939446">,</span>&nbsp;<span class="num" id="5939448">1</span><span class="op" id="5939449">,</span>&nbsp;<span class="ident" id="5939451">padchar</span><span class="op" id="5939458">,</span>&nbsp;<span class="ident" id="5939460">twmode</span><span class="op" id="5939466">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939473">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939530">if</span>&nbsp;<span class="ident" id="5939533">_</span><span class="op" id="5939534">,</span>&nbsp;<span class="ident" id="5939536">err</span>&nbsp;<span class="op" id="5939540">=</span>&nbsp;<span class="ident" id="5939542">output</span><span class="op" id="5939548">.</span><span class="ident" id="5939549">Write</span><span class="op" id="5939554">(</span><span class="ident" id="5939555">p</span><span class="op" id="5939556">.</span><span class="ident" id="5939557">output</span><span class="op" id="5939563">)</span><span class="op" id="5939564">;</span>&nbsp;<span class="ident" id="5939566">err</span>&nbsp;<span class="op" id="5939570">!=</span>&nbsp;<span class="ident" id="5939573">nil</span>&nbsp;<span class="op" id="5939577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939581">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939593">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939621">if</span>&nbsp;<span class="ident" id="5939624">tw</span><span class="op" id="5939626">,</span>&nbsp;<span class="ident" id="5939628">_</span>&nbsp;<span class="op" id="5939630">:=</span>&nbsp;<span class="ident" id="5939633">output</span><span class="op" id="5939639">.</span><span class="op" id="5939640">(</span><span class="op" id="5939641">*</span><span class="ident" id="5939642">tabwriter</span><span class="op" id="5939651">.</span><span class="ident" id="5939652">Writer</span><span class="op" id="5939658">)</span><span class="op" id="5939659">;</span>&nbsp;<span class="ident" id="5939661">tw</span>&nbsp;<span class="op" id="5939664">!=</span>&nbsp;<span class="ident" id="5939667">nil</span>&nbsp;<span class="op" id="5939671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939675">err</span>&nbsp;<span class="op" id="5939679">=</span>&nbsp;<span class="ident" id="5939681">tw</span><span class="op" id="5939683">.</span><span class="ident" id="5939684">Flush</span><span class="op" id="5939689">(</span><span class="op" id="5939690">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939697">return</span><br>
<span class="lineno"></span><span class="op" id="5939704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5939707">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5939774">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5939840">//</span><br>
<span class="lineno"></span><span class="keyword" id="5939843">type</span>&nbsp;<span class="ident" id="5939848">CommentedNode</span>&nbsp;<span class="keyword" id="5939862">struct</span>&nbsp;<span class="op" id="5939869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939872">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939881">interface</span><span class="op" id="5939890">{</span><span class="op" id="5939891">}</span>&nbsp;<span class="comment" id="5939893">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939953">Comments</span>&nbsp;<span class="op" id="5939962">[</span><span class="op" id="5939963">]</span><span class="op" id="5939964">*</span><span class="ident" id="5939965">ast</span><span class="op" id="5939968">.</span><span class="ident" id="5939969">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5939982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939985">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5940064">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5940134">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5940210">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5940284">//</span><br>
<span class="lineno"></span><span class="keyword" id="5940287">func</span>&nbsp;<span class="op" id="5940292">(</span><span class="ident" id="5940293">cfg</span>&nbsp;<span class="op" id="5940297">*</span><span class="ident" id="5940298">Config</span><span class="op" id="5940304">)</span>&nbsp;<span class="ident" id="5940306">Fprint</span><span class="op" id="5940312">(</span><span class="ident" id="5940313">output</span>&nbsp;<span class="ident" id="5940320">io</span><span class="op" id="5940322">.</span><span class="ident" id="5940323">Writer</span><span class="op" id="5940329">,</span>&nbsp;<span class="ident" id="5940331">fset</span>&nbsp;<span class="op" id="5940336">*</span><span class="ident" id="5940337">token</span><span class="op" id="5940342">.</span><span class="ident" id="5940343">FileSet</span><span class="op" id="5940350">,</span>&nbsp;<span class="ident" id="5940352">node</span>&nbsp;<span class="keyword" id="5940357">interface</span><span class="op" id="5940366">{</span><span class="op" id="5940367">}</span><span class="op" id="5940368">)</span>&nbsp;<span class="builtintype" id="5940370">error</span>&nbsp;<span class="op" id="5940376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940379">return</span>&nbsp;<span class="ident" id="5940386">cfg</span><span class="op" id="5940389">.</span><span class="ident" id="5940390">fprint</span><span class="op" id="5940396">(</span><span class="ident" id="5940397">output</span><span class="op" id="5940403">,</span>&nbsp;<span class="ident" id="5940405">fset</span><span class="op" id="5940409">,</span>&nbsp;<span class="ident" id="5940411">node</span><span class="op" id="5940415">,</span>&nbsp;<span class="builtinfunc" id="5940417">make</span><span class="op" id="5940421">(</span><span class="keyword" id="5940422">map</span><span class="op" id="5940425">[</span><span class="ident" id="5940426">ast</span><span class="op" id="5940429">.</span><span class="ident" id="5940430">Node</span><span class="op" id="5940434">]</span><span class="builtintype" id="5940435">int</span><span class="op" id="5940438">)</span><span class="op" id="5940439">)</span><br>
<span class="lineno">1285</span><span class="op" id="5940441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940444">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5940493">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5940542">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5940545">func</span>&nbsp;<span class="ident" id="5940550">Fprint</span><span class="op" id="5940556">(</span><span class="ident" id="5940557">output</span>&nbsp;<span class="ident" id="5940564">io</span><span class="op" id="5940566">.</span><span class="ident" id="5940567">Writer</span><span class="op" id="5940573">,</span>&nbsp;<span class="ident" id="5940575">fset</span>&nbsp;<span class="op" id="5940580">*</span><span class="ident" id="5940581">token</span><span class="op" id="5940586">.</span><span class="ident" id="5940587">FileSet</span><span class="op" id="5940594">,</span>&nbsp;<span class="ident" id="5940596">node</span>&nbsp;<span class="keyword" id="5940601">interface</span><span class="op" id="5940610">{</span><span class="op" id="5940611">}</span><span class="op" id="5940612">)</span>&nbsp;<span class="builtintype" id="5940614">error</span>&nbsp;<span class="op" id="5940620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940623">return</span>&nbsp;<span class="op" id="5940630">(</span><span class="op" id="5940631">&amp;</span><span class="ident" id="5940632">Config</span><span class="op" id="5940638">{</span><span class="ident" id="5940639">Tabwidth</span><span class="op" id="5940647">:</span>&nbsp;<span class="num" id="5940649">8</span><span class="op" id="5940650">}</span><span class="op" id="5940651">)</span><span class="op" id="5940652">.</span><span class="ident" id="5940653">Fprint</span><span class="op" id="5940659">(</span><span class="ident" id="5940660">output</span><span class="op" id="5940666">,</span>&nbsp;<span class="ident" id="5940668">fset</span><span class="op" id="5940672">,</span>&nbsp;<span class="ident" id="5940674">node</span><span class="op" id="5940678">)</span><br>
<span class="lineno"></span><span class="op" id="5940680">}</span>
</div>
</body>
</html>
