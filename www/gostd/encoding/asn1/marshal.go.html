<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/asn1</h2>
<ul>
<li><a href="/gostd/encoding/asn1/asn1.go.html">asn1.go</a></li>
<li><a href="/gostd/encoding/asn1/asn1_test.go.html">asn1_test.go</a></li>
<li><a href="/gostd/encoding/asn1/common.go.html">common.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal.go.html" class="current">marshal.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal_test.go.html">marshal_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4854371">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4854426">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4854480">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4854531">package</span>&nbsp;<span class="ident" id="4854539">asn1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854545">import</span>&nbsp;<span class="op" id="4854552">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854555">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854564">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854574">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854581">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854587">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854599">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854610">&#34;time&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854618">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4854633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854636">//&nbsp;A&nbsp;forkableWriter&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;buffer&nbsp;that&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4854691">//&nbsp;&#39;forked&#39;&nbsp;to&nbsp;create&nbsp;new&nbsp;forkableWriters&nbsp;that&nbsp;bracket&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="4854750">//&nbsp;original.&nbsp;&nbsp;After</span><br>
<span class="lineno"></span><span class="comment" id="4854770">//&nbsp;&nbsp;&nbsp;&nbsp;pre,&nbsp;post&nbsp;:=&nbsp;w.fork();</span><br>
<span class="lineno"></span><span class="comment" id="4854799">//&nbsp;the&nbsp;overall&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;represented&nbsp;is&nbsp;logically&nbsp;w+pre+post.</span><br>
<span class="lineno"></span><span class="keyword" id="4854869">type</span>&nbsp;<span class="ident" id="4854874">forkableWriter</span>&nbsp;<span class="keyword" id="4854889">struct</span>&nbsp;<span class="op" id="4854896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854899">*</span><span class="ident" id="4854900">bytes</span><span class="op" id="4854905">.</span><span class="ident" id="4854906">Buffer</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854914">pre</span><span class="op" id="4854917">,</span>&nbsp;<span class="ident" id="4854919">post</span>&nbsp;<span class="op" id="4854924">*</span><span class="ident" id="4854925">forkableWriter</span><br>
<span class="lineno"></span><span class="op" id="4854940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854943">func</span>&nbsp;<span class="ident" id="4854948">newForkableWriter</span><span class="op" id="4854965">(</span><span class="op" id="4854966">)</span>&nbsp;<span class="op" id="4854968">*</span><span class="ident" id="4854969">forkableWriter</span>&nbsp;<span class="op" id="4854984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854987">return</span>&nbsp;<span class="op" id="4854994">&amp;</span><span class="ident" id="4854995">forkableWriter</span><span class="op" id="4855009">{</span><span class="builtinfunc" id="4855010">new</span><span class="op" id="4855013">(</span><span class="ident" id="4855014">bytes</span><span class="op" id="4855019">.</span><span class="ident" id="4855020">Buffer</span><span class="op" id="4855026">)</span><span class="op" id="4855027">,</span>&nbsp;<span class="ident" id="4855029">nil</span><span class="op" id="4855032">,</span>&nbsp;<span class="ident" id="4855034">nil</span><span class="op" id="4855037">}</span><br>
<span class="lineno">30</span><span class="op" id="4855039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4855042">func</span>&nbsp;<span class="op" id="4855047">(</span><span class="ident" id="4855048">f</span>&nbsp;<span class="op" id="4855050">*</span><span class="ident" id="4855051">forkableWriter</span><span class="op" id="4855065">)</span>&nbsp;<span class="ident" id="4855067">fork</span><span class="op" id="4855071">(</span><span class="op" id="4855072">)</span>&nbsp;<span class="op" id="4855074">(</span><span class="ident" id="4855075">pre</span><span class="op" id="4855078">,</span>&nbsp;<span class="ident" id="4855080">post</span>&nbsp;<span class="op" id="4855085">*</span><span class="ident" id="4855086">forkableWriter</span><span class="op" id="4855100">)</span>&nbsp;<span class="op" id="4855102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855105">if</span>&nbsp;<span class="ident" id="4855108">f</span><span class="op" id="4855109">.</span><span class="ident" id="4855110">pre</span>&nbsp;<span class="op" id="4855114">!=</span>&nbsp;<span class="ident" id="4855117">nil</span>&nbsp;<span class="op" id="4855121">||</span>&nbsp;<span class="ident" id="4855124">f</span><span class="op" id="4855125">.</span><span class="ident" id="4855126">post</span>&nbsp;<span class="op" id="4855131">!=</span>&nbsp;<span class="ident" id="4855134">nil</span>&nbsp;<span class="op" id="4855138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4855142">panic</span><span class="op" id="4855147">(</span><span class="string" id="4855148">&#34;have&nbsp;already&nbsp;forked&#34;</span><span class="op" id="4855169">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855175">f</span><span class="op" id="4855176">.</span><span class="ident" id="4855177">pre</span>&nbsp;<span class="op" id="4855181">=</span>&nbsp;<span class="ident" id="4855183">newForkableWriter</span><span class="op" id="4855200">(</span><span class="op" id="4855201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855204">f</span><span class="op" id="4855205">.</span><span class="ident" id="4855206">post</span>&nbsp;<span class="op" id="4855211">=</span>&nbsp;<span class="ident" id="4855213">newForkableWriter</span><span class="op" id="4855230">(</span><span class="op" id="4855231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855234">return</span>&nbsp;<span class="ident" id="4855241">f</span><span class="op" id="4855242">.</span><span class="ident" id="4855243">pre</span><span class="op" id="4855246">,</span>&nbsp;<span class="ident" id="4855248">f</span><span class="op" id="4855249">.</span><span class="ident" id="4855250">post</span><br>
<span class="lineno"></span><span class="op" id="4855255">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4855258">func</span>&nbsp;<span class="op" id="4855263">(</span><span class="ident" id="4855264">f</span>&nbsp;<span class="op" id="4855266">*</span><span class="ident" id="4855267">forkableWriter</span><span class="op" id="4855281">)</span>&nbsp;<span class="ident" id="4855283">Len</span><span class="op" id="4855286">(</span><span class="op" id="4855287">)</span>&nbsp;<span class="op" id="4855289">(</span><span class="ident" id="4855290">l</span>&nbsp;<span class="builtintype" id="4855292">int</span><span class="op" id="4855295">)</span>&nbsp;<span class="op" id="4855297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855300">l</span>&nbsp;<span class="op" id="4855302">+=</span>&nbsp;<span class="ident" id="4855305">f</span><span class="op" id="4855306">.</span><span class="ident" id="4855307">Buffer</span><span class="op" id="4855313">.</span><span class="ident" id="4855314">Len</span><span class="op" id="4855317">(</span><span class="op" id="4855318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855321">if</span>&nbsp;<span class="ident" id="4855324">f</span><span class="op" id="4855325">.</span><span class="ident" id="4855326">pre</span>&nbsp;<span class="op" id="4855330">!=</span>&nbsp;<span class="ident" id="4855333">nil</span>&nbsp;<span class="op" id="4855337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855341">l</span>&nbsp;<span class="op" id="4855343">+=</span>&nbsp;<span class="ident" id="4855346">f</span><span class="op" id="4855347">.</span><span class="ident" id="4855348">pre</span><span class="op" id="4855351">.</span><span class="ident" id="4855352">Len</span><span class="op" id="4855355">(</span><span class="op" id="4855356">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855362">if</span>&nbsp;<span class="ident" id="4855365">f</span><span class="op" id="4855366">.</span><span class="ident" id="4855367">post</span>&nbsp;<span class="op" id="4855372">!=</span>&nbsp;<span class="ident" id="4855375">nil</span>&nbsp;<span class="op" id="4855379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855383">l</span>&nbsp;<span class="op" id="4855385">+=</span>&nbsp;<span class="ident" id="4855388">f</span><span class="op" id="4855389">.</span><span class="ident" id="4855390">post</span><span class="op" id="4855394">.</span><span class="ident" id="4855395">Len</span><span class="op" id="4855398">(</span><span class="op" id="4855399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855405">return</span><br>
<span class="lineno">50</span><span class="op" id="4855412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4855415">func</span>&nbsp;<span class="op" id="4855420">(</span><span class="ident" id="4855421">f</span>&nbsp;<span class="op" id="4855423">*</span><span class="ident" id="4855424">forkableWriter</span><span class="op" id="4855438">)</span>&nbsp;<span class="ident" id="4855440">writeTo</span><span class="op" id="4855447">(</span><span class="ident" id="4855448">out</span>&nbsp;<span class="ident" id="4855452">io</span><span class="op" id="4855454">.</span><span class="ident" id="4855455">Writer</span><span class="op" id="4855461">)</span>&nbsp;<span class="op" id="4855463">(</span><span class="ident" id="4855464">n</span>&nbsp;<span class="builtintype" id="4855466">int</span><span class="op" id="4855469">,</span>&nbsp;<span class="ident" id="4855471">err</span>&nbsp;<span class="builtintype" id="4855475">error</span><span class="op" id="4855480">)</span>&nbsp;<span class="op" id="4855482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855485">n</span><span class="op" id="4855486">,</span>&nbsp;<span class="ident" id="4855488">err</span>&nbsp;<span class="op" id="4855492">=</span>&nbsp;<span class="ident" id="4855494">out</span><span class="op" id="4855497">.</span><span class="ident" id="4855498">Write</span><span class="op" id="4855503">(</span><span class="ident" id="4855504">f</span><span class="op" id="4855505">.</span><span class="ident" id="4855506">Bytes</span><span class="op" id="4855511">(</span><span class="op" id="4855512">)</span><span class="op" id="4855513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855516">if</span>&nbsp;<span class="ident" id="4855519">err</span>&nbsp;<span class="op" id="4855523">!=</span>&nbsp;<span class="ident" id="4855526">nil</span>&nbsp;<span class="op" id="4855530">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855546">var</span>&nbsp;<span class="ident" id="4855550">nn</span>&nbsp;<span class="builtintype" id="4855553">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855559">if</span>&nbsp;<span class="ident" id="4855562">f</span><span class="op" id="4855563">.</span><span class="ident" id="4855564">pre</span>&nbsp;<span class="op" id="4855568">!=</span>&nbsp;<span class="ident" id="4855571">nil</span>&nbsp;<span class="op" id="4855575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855579">nn</span><span class="op" id="4855581">,</span>&nbsp;<span class="ident" id="4855583">err</span>&nbsp;<span class="op" id="4855587">=</span>&nbsp;<span class="ident" id="4855589">f</span><span class="op" id="4855590">.</span><span class="ident" id="4855591">pre</span><span class="op" id="4855594">.</span><span class="ident" id="4855595">writeTo</span><span class="op" id="4855602">(</span><span class="ident" id="4855603">out</span><span class="op" id="4855606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855610">n</span>&nbsp;<span class="op" id="4855612">+=</span>&nbsp;<span class="ident" id="4855615">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855620">if</span>&nbsp;<span class="ident" id="4855623">err</span>&nbsp;<span class="op" id="4855627">!=</span>&nbsp;<span class="ident" id="4855630">nil</span>&nbsp;<span class="op" id="4855634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855639">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855655">if</span>&nbsp;<span class="ident" id="4855658">f</span><span class="op" id="4855659">.</span><span class="ident" id="4855660">post</span>&nbsp;<span class="op" id="4855665">!=</span>&nbsp;<span class="ident" id="4855668">nil</span>&nbsp;<span class="op" id="4855672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855676">nn</span><span class="op" id="4855678">,</span>&nbsp;<span class="ident" id="4855680">err</span>&nbsp;<span class="op" id="4855684">=</span>&nbsp;<span class="ident" id="4855686">f</span><span class="op" id="4855687">.</span><span class="ident" id="4855688">post</span><span class="op" id="4855692">.</span><span class="ident" id="4855693">writeTo</span><span class="op" id="4855700">(</span><span class="ident" id="4855701">out</span><span class="op" id="4855704">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855708">n</span>&nbsp;<span class="op" id="4855710">+=</span>&nbsp;<span class="ident" id="4855713">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855720">return</span><br>
<span class="lineno"></span><span class="op" id="4855727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="4855730">func</span>&nbsp;<span class="ident" id="4855735">marshalBase128Int</span><span class="op" id="4855752">(</span><span class="ident" id="4855753">out</span>&nbsp;<span class="op" id="4855757">*</span><span class="ident" id="4855758">forkableWriter</span><span class="op" id="4855772">,</span>&nbsp;<span class="ident" id="4855774">n</span>&nbsp;<span class="ident" id="4855776">int64</span><span class="op" id="4855781">)</span>&nbsp;<span class="op" id="4855783">(</span><span class="ident" id="4855784">err</span>&nbsp;<span class="builtintype" id="4855788">error</span><span class="op" id="4855793">)</span>&nbsp;<span class="op" id="4855795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855798">if</span>&nbsp;<span class="ident" id="4855801">n</span>&nbsp;<span class="op" id="4855803">==</span>&nbsp;<span class="num" id="4855806">0</span>&nbsp;<span class="op" id="4855808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855812">err</span>&nbsp;<span class="op" id="4855816">=</span>&nbsp;<span class="ident" id="4855818">out</span><span class="op" id="4855821">.</span><span class="ident" id="4855822">WriteByte</span><span class="op" id="4855831">(</span><span class="num" id="4855832">0</span><span class="op" id="4855833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855837">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855845">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855849">l</span>&nbsp;<span class="op" id="4855851">:=</span>&nbsp;<span class="num" id="4855854">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855857">for</span>&nbsp;<span class="ident" id="4855861">i</span>&nbsp;<span class="op" id="4855863">:=</span>&nbsp;<span class="ident" id="4855866">n</span><span class="op" id="4855867">;</span>&nbsp;<span class="ident" id="4855869">i</span>&nbsp;<span class="op" id="4855871">&gt;</span>&nbsp;<span class="num" id="4855873">0</span><span class="op" id="4855874">;</span>&nbsp;<span class="ident" id="4855876">i</span>&nbsp;<span class="op" id="4855878">&gt;&gt;=</span>&nbsp;<span class="num" id="4855882">7</span>&nbsp;<span class="op" id="4855884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855888">l</span><span class="op" id="4855889">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855893">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855897">for</span>&nbsp;<span class="ident" id="4855901">i</span>&nbsp;<span class="op" id="4855903">:=</span>&nbsp;<span class="ident" id="4855906">l</span>&nbsp;<span class="op" id="4855908">-</span>&nbsp;<span class="num" id="4855910">1</span><span class="op" id="4855911">;</span>&nbsp;<span class="ident" id="4855913">i</span>&nbsp;<span class="op" id="4855915">&gt;=</span>&nbsp;<span class="num" id="4855918">0</span><span class="op" id="4855919">;</span>&nbsp;<span class="ident" id="4855921">i</span><span class="op" id="4855922">--</span>&nbsp;<span class="op" id="4855925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855929">o</span>&nbsp;<span class="op" id="4855931">:=</span>&nbsp;<span class="builtintype" id="4855934">byte</span><span class="op" id="4855938">(</span><span class="ident" id="4855939">n</span>&nbsp;<span class="op" id="4855941">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4855944">uint</span><span class="op" id="4855948">(</span><span class="ident" id="4855949">i</span><span class="op" id="4855950">*</span><span class="num" id="4855951">7</span><span class="op" id="4855952">)</span><span class="op" id="4855953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855957">o</span>&nbsp;<span class="op" id="4855959">&amp;=</span>&nbsp;<span class="num" id="4855962">0x7f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855969">if</span>&nbsp;<span class="ident" id="4855972">i</span>&nbsp;<span class="op" id="4855974">!=</span>&nbsp;<span class="num" id="4855977">0</span>&nbsp;<span class="op" id="4855979">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855984">o</span>&nbsp;<span class="op" id="4855986">|=</span>&nbsp;<span class="num" id="4855989">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856000">err</span>&nbsp;<span class="op" id="4856004">=</span>&nbsp;<span class="ident" id="4856006">out</span><span class="op" id="4856009">.</span><span class="ident" id="4856010">WriteByte</span><span class="op" id="4856019">(</span><span class="ident" id="4856020">o</span><span class="op" id="4856021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856025">if</span>&nbsp;<span class="ident" id="4856028">err</span>&nbsp;<span class="op" id="4856032">!=</span>&nbsp;<span class="ident" id="4856035">nil</span>&nbsp;<span class="op" id="4856039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856044">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856060">return</span>&nbsp;<span class="ident" id="4856067">nil</span><br>
<span class="lineno"></span><span class="op" id="4856071">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4856074">func</span>&nbsp;<span class="ident" id="4856079">marshalInt64</span><span class="op" id="4856091">(</span><span class="ident" id="4856092">out</span>&nbsp;<span class="op" id="4856096">*</span><span class="ident" id="4856097">forkableWriter</span><span class="op" id="4856111">,</span>&nbsp;<span class="ident" id="4856113">i</span>&nbsp;<span class="ident" id="4856115">int64</span><span class="op" id="4856120">)</span>&nbsp;<span class="op" id="4856122">(</span><span class="ident" id="4856123">err</span>&nbsp;<span class="builtintype" id="4856127">error</span><span class="op" id="4856132">)</span>&nbsp;<span class="op" id="4856134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856137">n</span>&nbsp;<span class="op" id="4856139">:=</span>&nbsp;<span class="ident" id="4856142">int64Length</span><span class="op" id="4856153">(</span><span class="ident" id="4856154">i</span><span class="op" id="4856155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856159">for</span>&nbsp;<span class="op" id="4856163">;</span>&nbsp;<span class="ident" id="4856165">n</span>&nbsp;<span class="op" id="4856167">&gt;</span>&nbsp;<span class="num" id="4856169">0</span><span class="op" id="4856170">;</span>&nbsp;<span class="ident" id="4856172">n</span><span class="op" id="4856173">--</span>&nbsp;<span class="op" id="4856176">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856180">err</span>&nbsp;<span class="op" id="4856184">=</span>&nbsp;<span class="ident" id="4856186">out</span><span class="op" id="4856189">.</span><span class="ident" id="4856190">WriteByte</span><span class="op" id="4856199">(</span><span class="builtintype" id="4856200">byte</span><span class="op" id="4856204">(</span><span class="ident" id="4856205">i</span>&nbsp;<span class="op" id="4856207">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4856210">uint</span><span class="op" id="4856214">(</span><span class="op" id="4856215">(</span><span class="ident" id="4856216">n</span><span class="op" id="4856217">-</span><span class="num" id="4856218">1</span><span class="op" id="4856219">)</span><span class="op" id="4856220">*</span><span class="num" id="4856221">8</span><span class="op" id="4856222">)</span><span class="op" id="4856223">)</span><span class="op" id="4856224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856228">if</span>&nbsp;<span class="ident" id="4856231">err</span>&nbsp;<span class="op" id="4856235">!=</span>&nbsp;<span class="ident" id="4856238">nil</span>&nbsp;<span class="op" id="4856242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856259">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856263">return</span>&nbsp;<span class="ident" id="4856270">nil</span><br>
<span class="lineno"></span><span class="op" id="4856274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856277">func</span>&nbsp;<span class="ident" id="4856282">int64Length</span><span class="op" id="4856293">(</span><span class="ident" id="4856294">i</span>&nbsp;<span class="ident" id="4856296">int64</span><span class="op" id="4856301">)</span>&nbsp;<span class="op" id="4856303">(</span><span class="ident" id="4856304">numBytes</span>&nbsp;<span class="builtintype" id="4856313">int</span><span class="op" id="4856316">)</span>&nbsp;<span class="op" id="4856318">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856321">numBytes</span>&nbsp;<span class="op" id="4856330">=</span>&nbsp;<span class="num" id="4856332">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856336">for</span>&nbsp;<span class="ident" id="4856340">i</span>&nbsp;<span class="op" id="4856342">&gt;</span>&nbsp;<span class="num" id="4856344">127</span>&nbsp;<span class="op" id="4856348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856352">numBytes</span><span class="op" id="4856360">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856365">i</span>&nbsp;<span class="op" id="4856367">&gt;&gt;=</span>&nbsp;<span class="num" id="4856371">8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856378">for</span>&nbsp;<span class="ident" id="4856382">i</span>&nbsp;<span class="op" id="4856384">&lt;</span>&nbsp;<span class="op" id="4856386">-</span><span class="num" id="4856387">128</span>&nbsp;<span class="op" id="4856391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856395">numBytes</span><span class="op" id="4856403">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856408">i</span>&nbsp;<span class="op" id="4856410">&gt;&gt;=</span>&nbsp;<span class="num" id="4856414">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856421">return</span><br>
<span class="lineno"></span><span class="op" id="4856428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4856431">func</span>&nbsp;<span class="ident" id="4856436">marshalBigInt</span><span class="op" id="4856449">(</span><span class="ident" id="4856450">out</span>&nbsp;<span class="op" id="4856454">*</span><span class="ident" id="4856455">forkableWriter</span><span class="op" id="4856469">,</span>&nbsp;<span class="ident" id="4856471">n</span>&nbsp;<span class="op" id="4856473">*</span><span class="ident" id="4856474">big</span><span class="op" id="4856477">.</span><span class="ident" id="4856478">Int</span><span class="op" id="4856481">)</span>&nbsp;<span class="op" id="4856483">(</span><span class="ident" id="4856484">err</span>&nbsp;<span class="builtintype" id="4856488">error</span><span class="op" id="4856493">)</span>&nbsp;<span class="op" id="4856495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856498">if</span>&nbsp;<span class="ident" id="4856501">n</span><span class="op" id="4856502">.</span><span class="ident" id="4856503">Sign</span><span class="op" id="4856507">(</span><span class="op" id="4856508">)</span>&nbsp;<span class="op" id="4856510">&lt;</span>&nbsp;<span class="num" id="4856512">0</span>&nbsp;<span class="op" id="4856514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856518">//&nbsp;A&nbsp;negative&nbsp;number&nbsp;has&nbsp;to&nbsp;be&nbsp;converted&nbsp;to&nbsp;two&#39;s-complement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856581">//&nbsp;form.&nbsp;So&nbsp;we&#39;ll&nbsp;subtract&nbsp;1&nbsp;and&nbsp;invert.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856631">//&nbsp;most-significant-bit&nbsp;isn&#39;t&nbsp;set&nbsp;then&nbsp;we&#39;ll&nbsp;need&nbsp;to&nbsp;pad&nbsp;the</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856694">//&nbsp;beginning&nbsp;with&nbsp;0xff&nbsp;in&nbsp;order&nbsp;to&nbsp;keep&nbsp;the&nbsp;number&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856757">nMinus1</span>&nbsp;<span class="op" id="4856765">:=</span>&nbsp;<span class="builtinfunc" id="4856768">new</span><span class="op" id="4856771">(</span><span class="ident" id="4856772">big</span><span class="op" id="4856775">.</span><span class="ident" id="4856776">Int</span><span class="op" id="4856779">)</span><span class="op" id="4856780">.</span><span class="ident" id="4856781">Neg</span><span class="op" id="4856784">(</span><span class="ident" id="4856785">n</span><span class="op" id="4856786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856790">nMinus1</span><span class="op" id="4856797">.</span><span class="ident" id="4856798">Sub</span><span class="op" id="4856801">(</span><span class="ident" id="4856802">nMinus1</span><span class="op" id="4856809">,</span>&nbsp;<span class="ident" id="4856811">bigOne</span><span class="op" id="4856817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856821">bytes</span>&nbsp;<span class="op" id="4856827">:=</span>&nbsp;<span class="ident" id="4856830">nMinus1</span><span class="op" id="4856837">.</span><span class="ident" id="4856838">Bytes</span><span class="op" id="4856843">(</span><span class="op" id="4856844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856848">for</span>&nbsp;<span class="ident" id="4856852">i</span>&nbsp;<span class="op" id="4856854">:=</span>&nbsp;<span class="keyword" id="4856857">range</span>&nbsp;<span class="ident" id="4856863">bytes</span>&nbsp;<span class="op" id="4856869">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856874">bytes</span><span class="op" id="4856879">[</span><span class="ident" id="4856880">i</span><span class="op" id="4856881">]</span>&nbsp;<span class="op" id="4856883">^=</span>&nbsp;<span class="num" id="4856886">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856897">if</span>&nbsp;<span class="builtinfunc" id="4856900">len</span><span class="op" id="4856903">(</span><span class="ident" id="4856904">bytes</span><span class="op" id="4856909">)</span>&nbsp;<span class="op" id="4856911">==</span>&nbsp;<span class="num" id="4856914">0</span>&nbsp;<span class="op" id="4856916">||</span>&nbsp;<span class="ident" id="4856919">bytes</span><span class="op" id="4856924">[</span><span class="num" id="4856925">0</span><span class="op" id="4856926">]</span><span class="op" id="4856927">&amp;</span><span class="num" id="4856928">0x80</span>&nbsp;<span class="op" id="4856933">==</span>&nbsp;<span class="num" id="4856936">0</span>&nbsp;<span class="op" id="4856938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856943">err</span>&nbsp;<span class="op" id="4856947">=</span>&nbsp;<span class="ident" id="4856949">out</span><span class="op" id="4856952">.</span><span class="ident" id="4856953">WriteByte</span><span class="op" id="4856962">(</span><span class="num" id="4856963">0xff</span><span class="op" id="4856967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856972">if</span>&nbsp;<span class="ident" id="4856975">err</span>&nbsp;<span class="op" id="4856979">!=</span>&nbsp;<span class="ident" id="4856982">nil</span>&nbsp;<span class="op" id="4856986">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856992">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857010">_</span><span class="op" id="4857011">,</span>&nbsp;<span class="ident" id="4857013">err</span>&nbsp;<span class="op" id="4857017">=</span>&nbsp;<span class="ident" id="4857019">out</span><span class="op" id="4857022">.</span><span class="ident" id="4857023">Write</span><span class="op" id="4857028">(</span><span class="ident" id="4857029">bytes</span><span class="op" id="4857034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857037">}</span>&nbsp;<span class="keyword" id="4857039">else</span>&nbsp;<span class="keyword" id="4857044">if</span>&nbsp;<span class="ident" id="4857047">n</span><span class="op" id="4857048">.</span><span class="ident" id="4857049">Sign</span><span class="op" id="4857053">(</span><span class="op" id="4857054">)</span>&nbsp;<span class="op" id="4857056">==</span>&nbsp;<span class="num" id="4857059">0</span>&nbsp;<span class="op" id="4857061">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857065">//&nbsp;Zero&nbsp;is&nbsp;written&nbsp;as&nbsp;a&nbsp;single&nbsp;0&nbsp;zero&nbsp;rather&nbsp;than&nbsp;no&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857127">err</span>&nbsp;<span class="op" id="4857131">=</span>&nbsp;<span class="ident" id="4857133">out</span><span class="op" id="4857136">.</span><span class="ident" id="4857137">WriteByte</span><span class="op" id="4857146">(</span><span class="num" id="4857147">0x00</span><span class="op" id="4857151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857154">}</span>&nbsp;<span class="keyword" id="4857156">else</span>&nbsp;<span class="op" id="4857161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857165">bytes</span>&nbsp;<span class="op" id="4857171">:=</span>&nbsp;<span class="ident" id="4857174">n</span><span class="op" id="4857175">.</span><span class="ident" id="4857176">Bytes</span><span class="op" id="4857181">(</span><span class="op" id="4857182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857186">if</span>&nbsp;<span class="builtinfunc" id="4857189">len</span><span class="op" id="4857192">(</span><span class="ident" id="4857193">bytes</span><span class="op" id="4857198">)</span>&nbsp;<span class="op" id="4857200">&gt;</span>&nbsp;<span class="num" id="4857202">0</span>&nbsp;<span class="op" id="4857204">&amp;&amp;</span>&nbsp;<span class="ident" id="4857207">bytes</span><span class="op" id="4857212">[</span><span class="num" id="4857213">0</span><span class="op" id="4857214">]</span><span class="op" id="4857215">&amp;</span><span class="num" id="4857216">0x80</span>&nbsp;<span class="op" id="4857221">!=</span>&nbsp;<span class="num" id="4857224">0</span>&nbsp;<span class="op" id="4857226">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857231">//&nbsp;We&#39;ll&nbsp;have&nbsp;to&nbsp;pad&nbsp;this&nbsp;with&nbsp;0x00&nbsp;in&nbsp;order&nbsp;to&nbsp;stop&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857290">//&nbsp;looking&nbsp;like&nbsp;a&nbsp;negative&nbsp;number.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857328">err</span>&nbsp;<span class="op" id="4857332">=</span>&nbsp;<span class="ident" id="4857334">out</span><span class="op" id="4857337">.</span><span class="ident" id="4857338">WriteByte</span><span class="op" id="4857347">(</span><span class="num" id="4857348">0</span><span class="op" id="4857349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857354">if</span>&nbsp;<span class="ident" id="4857357">err</span>&nbsp;<span class="op" id="4857361">!=</span>&nbsp;<span class="ident" id="4857364">nil</span>&nbsp;<span class="op" id="4857368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857374">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857392">_</span><span class="op" id="4857393">,</span>&nbsp;<span class="ident" id="4857395">err</span>&nbsp;<span class="op" id="4857399">=</span>&nbsp;<span class="ident" id="4857401">out</span><span class="op" id="4857404">.</span><span class="ident" id="4857405">Write</span><span class="op" id="4857410">(</span><span class="ident" id="4857411">bytes</span><span class="op" id="4857416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857422">return</span><br>
<span class="lineno">165</span><span class="op" id="4857429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4857432">func</span>&nbsp;<span class="ident" id="4857437">marshalLength</span><span class="op" id="4857450">(</span><span class="ident" id="4857451">out</span>&nbsp;<span class="op" id="4857455">*</span><span class="ident" id="4857456">forkableWriter</span><span class="op" id="4857470">,</span>&nbsp;<span class="ident" id="4857472">i</span>&nbsp;<span class="builtintype" id="4857474">int</span><span class="op" id="4857477">)</span>&nbsp;<span class="op" id="4857479">(</span><span class="ident" id="4857480">err</span>&nbsp;<span class="builtintype" id="4857484">error</span><span class="op" id="4857489">)</span>&nbsp;<span class="op" id="4857491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857494">n</span>&nbsp;<span class="op" id="4857496">:=</span>&nbsp;<span class="ident" id="4857499">lengthLength</span><span class="op" id="4857511">(</span><span class="ident" id="4857512">i</span><span class="op" id="4857513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857517">for</span>&nbsp;<span class="op" id="4857521">;</span>&nbsp;<span class="ident" id="4857523">n</span>&nbsp;<span class="op" id="4857525">&gt;</span>&nbsp;<span class="num" id="4857527">0</span><span class="op" id="4857528">;</span>&nbsp;<span class="ident" id="4857530">n</span><span class="op" id="4857531">--</span>&nbsp;<span class="op" id="4857534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857538">err</span>&nbsp;<span class="op" id="4857542">=</span>&nbsp;<span class="ident" id="4857544">out</span><span class="op" id="4857547">.</span><span class="ident" id="4857548">WriteByte</span><span class="op" id="4857557">(</span><span class="builtintype" id="4857558">byte</span><span class="op" id="4857562">(</span><span class="ident" id="4857563">i</span>&nbsp;<span class="op" id="4857565">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4857568">uint</span><span class="op" id="4857572">(</span><span class="op" id="4857573">(</span><span class="ident" id="4857574">n</span><span class="op" id="4857575">-</span><span class="num" id="4857576">1</span><span class="op" id="4857577">)</span><span class="op" id="4857578">*</span><span class="num" id="4857579">8</span><span class="op" id="4857580">)</span><span class="op" id="4857581">)</span><span class="op" id="4857582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857586">if</span>&nbsp;<span class="ident" id="4857589">err</span>&nbsp;<span class="op" id="4857593">!=</span>&nbsp;<span class="ident" id="4857596">nil</span>&nbsp;<span class="op" id="4857600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857614">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857621">return</span>&nbsp;<span class="ident" id="4857628">nil</span><br>
<span class="lineno"></span><span class="op" id="4857632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="4857635">func</span>&nbsp;<span class="ident" id="4857640">lengthLength</span><span class="op" id="4857652">(</span><span class="ident" id="4857653">i</span>&nbsp;<span class="builtintype" id="4857655">int</span><span class="op" id="4857658">)</span>&nbsp;<span class="op" id="4857660">(</span><span class="ident" id="4857661">numBytes</span>&nbsp;<span class="builtintype" id="4857670">int</span><span class="op" id="4857673">)</span>&nbsp;<span class="op" id="4857675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857678">numBytes</span>&nbsp;<span class="op" id="4857687">=</span>&nbsp;<span class="num" id="4857689">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857692">for</span>&nbsp;<span class="ident" id="4857696">i</span>&nbsp;<span class="op" id="4857698">&gt;</span>&nbsp;<span class="num" id="4857700">255</span>&nbsp;<span class="op" id="4857704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857708">numBytes</span><span class="op" id="4857716">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857721">i</span>&nbsp;<span class="op" id="4857723">&gt;&gt;=</span>&nbsp;<span class="num" id="4857727">8</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857733">return</span><br>
<span class="lineno"></span><span class="op" id="4857740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4857743">func</span>&nbsp;<span class="ident" id="4857748">marshalTagAndLength</span><span class="op" id="4857767">(</span><span class="ident" id="4857768">out</span>&nbsp;<span class="op" id="4857772">*</span><span class="ident" id="4857773">forkableWriter</span><span class="op" id="4857787">,</span>&nbsp;<span class="ident" id="4857789">t</span>&nbsp;<span class="ident" id="4857791">tagAndLength</span><span class="op" id="4857803">)</span>&nbsp;<span class="op" id="4857805">(</span><span class="ident" id="4857806">err</span>&nbsp;<span class="builtintype" id="4857810">error</span><span class="op" id="4857815">)</span>&nbsp;<span class="op" id="4857817">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857820">b</span>&nbsp;<span class="op" id="4857822">:=</span>&nbsp;<span class="builtintype" id="4857825">uint8</span><span class="op" id="4857830">(</span><span class="ident" id="4857831">t</span><span class="op" id="4857832">.</span><span class="ident" id="4857833">class</span><span class="op" id="4857838">)</span>&nbsp;<span class="op" id="4857840">&lt;&lt;</span>&nbsp;<span class="num" id="4857843">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857846">if</span>&nbsp;<span class="ident" id="4857849">t</span><span class="op" id="4857850">.</span><span class="ident" id="4857851">isCompound</span>&nbsp;<span class="op" id="4857862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857866">b</span>&nbsp;<span class="op" id="4857868">|=</span>&nbsp;<span class="num" id="4857871">0x20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857880">if</span>&nbsp;<span class="ident" id="4857883">t</span><span class="op" id="4857884">.</span><span class="ident" id="4857885">tag</span>&nbsp;<span class="op" id="4857889">&gt;=</span>&nbsp;<span class="num" id="4857892">31</span>&nbsp;<span class="op" id="4857895">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857899">b</span>&nbsp;<span class="op" id="4857901">|=</span>&nbsp;<span class="num" id="4857904">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857911">err</span>&nbsp;<span class="op" id="4857915">=</span>&nbsp;<span class="ident" id="4857917">out</span><span class="op" id="4857920">.</span><span class="ident" id="4857921">WriteByte</span><span class="op" id="4857930">(</span><span class="ident" id="4857931">b</span><span class="op" id="4857932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857936">if</span>&nbsp;<span class="ident" id="4857939">err</span>&nbsp;<span class="op" id="4857943">!=</span>&nbsp;<span class="ident" id="4857946">nil</span>&nbsp;<span class="op" id="4857950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857964">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857968">err</span>&nbsp;<span class="op" id="4857972">=</span>&nbsp;<span class="ident" id="4857974">marshalBase128Int</span><span class="op" id="4857991">(</span><span class="ident" id="4857992">out</span><span class="op" id="4857995">,</span>&nbsp;<span class="ident" id="4857997">int64</span><span class="op" id="4858002">(</span><span class="ident" id="4858003">t</span><span class="op" id="4858004">.</span><span class="ident" id="4858005">tag</span><span class="op" id="4858008">)</span><span class="op" id="4858009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858013">if</span>&nbsp;<span class="ident" id="4858016">err</span>&nbsp;<span class="op" id="4858020">!=</span>&nbsp;<span class="ident" id="4858023">nil</span>&nbsp;<span class="op" id="4858027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858032">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858044">}</span>&nbsp;<span class="keyword" id="4858046">else</span>&nbsp;<span class="op" id="4858051">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858055">b</span>&nbsp;<span class="op" id="4858057">|=</span>&nbsp;<span class="builtintype" id="4858060">uint8</span><span class="op" id="4858065">(</span><span class="ident" id="4858066">t</span><span class="op" id="4858067">.</span><span class="ident" id="4858068">tag</span><span class="op" id="4858071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858075">err</span>&nbsp;<span class="op" id="4858079">=</span>&nbsp;<span class="ident" id="4858081">out</span><span class="op" id="4858084">.</span><span class="ident" id="4858085">WriteByte</span><span class="op" id="4858094">(</span><span class="ident" id="4858095">b</span><span class="op" id="4858096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858100">if</span>&nbsp;<span class="ident" id="4858103">err</span>&nbsp;<span class="op" id="4858107">!=</span>&nbsp;<span class="ident" id="4858110">nil</span>&nbsp;<span class="op" id="4858114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858128">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858135">if</span>&nbsp;<span class="ident" id="4858138">t</span><span class="op" id="4858139">.</span><span class="ident" id="4858140">length</span>&nbsp;<span class="op" id="4858147">&gt;=</span>&nbsp;<span class="num" id="4858150">128</span>&nbsp;<span class="op" id="4858154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858158">l</span>&nbsp;<span class="op" id="4858160">:=</span>&nbsp;<span class="ident" id="4858163">lengthLength</span><span class="op" id="4858175">(</span><span class="ident" id="4858176">t</span><span class="op" id="4858177">.</span><span class="ident" id="4858178">length</span><span class="op" id="4858184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858188">err</span>&nbsp;<span class="op" id="4858192">=</span>&nbsp;<span class="ident" id="4858194">out</span><span class="op" id="4858197">.</span><span class="ident" id="4858198">WriteByte</span><span class="op" id="4858207">(</span><span class="num" id="4858208">0x80</span>&nbsp;<span class="op" id="4858213">|</span>&nbsp;<span class="builtintype" id="4858215">byte</span><span class="op" id="4858219">(</span><span class="ident" id="4858220">l</span><span class="op" id="4858221">)</span><span class="op" id="4858222">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858226">if</span>&nbsp;<span class="ident" id="4858229">err</span>&nbsp;<span class="op" id="4858233">!=</span>&nbsp;<span class="ident" id="4858236">nil</span>&nbsp;<span class="op" id="4858240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858245">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858258">err</span>&nbsp;<span class="op" id="4858262">=</span>&nbsp;<span class="ident" id="4858264">marshalLength</span><span class="op" id="4858277">(</span><span class="ident" id="4858278">out</span><span class="op" id="4858281">,</span>&nbsp;<span class="ident" id="4858283">t</span><span class="op" id="4858284">.</span><span class="ident" id="4858285">length</span><span class="op" id="4858291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858295">if</span>&nbsp;<span class="ident" id="4858298">err</span>&nbsp;<span class="op" id="4858302">!=</span>&nbsp;<span class="ident" id="4858305">nil</span>&nbsp;<span class="op" id="4858309">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858326">}</span>&nbsp;<span class="keyword" id="4858328">else</span>&nbsp;<span class="op" id="4858333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858337">err</span>&nbsp;<span class="op" id="4858341">=</span>&nbsp;<span class="ident" id="4858343">out</span><span class="op" id="4858346">.</span><span class="ident" id="4858347">WriteByte</span><span class="op" id="4858356">(</span><span class="builtintype" id="4858357">byte</span><span class="op" id="4858361">(</span><span class="ident" id="4858362">t</span><span class="op" id="4858363">.</span><span class="ident" id="4858364">length</span><span class="op" id="4858370">)</span><span class="op" id="4858371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858375">if</span>&nbsp;<span class="ident" id="4858378">err</span>&nbsp;<span class="op" id="4858382">!=</span>&nbsp;<span class="ident" id="4858385">nil</span>&nbsp;<span class="op" id="4858389">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858394">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858410">return</span>&nbsp;<span class="ident" id="4858417">nil</span><br>
<span class="lineno">230</span><span class="op" id="4858421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858424">func</span>&nbsp;<span class="ident" id="4858429">marshalBitString</span><span class="op" id="4858445">(</span><span class="ident" id="4858446">out</span>&nbsp;<span class="op" id="4858450">*</span><span class="ident" id="4858451">forkableWriter</span><span class="op" id="4858465">,</span>&nbsp;<span class="ident" id="4858467">b</span>&nbsp;<span class="ident" id="4858469">BitString</span><span class="op" id="4858478">)</span>&nbsp;<span class="op" id="4858480">(</span><span class="ident" id="4858481">err</span>&nbsp;<span class="builtintype" id="4858485">error</span><span class="op" id="4858490">)</span>&nbsp;<span class="op" id="4858492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858495">paddingBits</span>&nbsp;<span class="op" id="4858507">:=</span>&nbsp;<span class="builtintype" id="4858510">byte</span><span class="op" id="4858514">(</span><span class="op" id="4858515">(</span><span class="num" id="4858516">8</span>&nbsp;<span class="op" id="4858518">-</span>&nbsp;<span class="ident" id="4858520">b</span><span class="op" id="4858521">.</span><span class="ident" id="4858522">BitLength</span><span class="op" id="4858531">%</span><span class="num" id="4858532">8</span><span class="op" id="4858533">)</span>&nbsp;<span class="op" id="4858535">%</span>&nbsp;<span class="num" id="4858537">8</span><span class="op" id="4858538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858541">err</span>&nbsp;<span class="op" id="4858545">=</span>&nbsp;<span class="ident" id="4858547">out</span><span class="op" id="4858550">.</span><span class="ident" id="4858551">WriteByte</span><span class="op" id="4858560">(</span><span class="ident" id="4858561">paddingBits</span><span class="op" id="4858572">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858575">if</span>&nbsp;<span class="ident" id="4858578">err</span>&nbsp;<span class="op" id="4858582">!=</span>&nbsp;<span class="ident" id="4858585">nil</span>&nbsp;<span class="op" id="4858589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858593">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858604">_</span><span class="op" id="4858605">,</span>&nbsp;<span class="ident" id="4858607">err</span>&nbsp;<span class="op" id="4858611">=</span>&nbsp;<span class="ident" id="4858613">out</span><span class="op" id="4858616">.</span><span class="ident" id="4858617">Write</span><span class="op" id="4858622">(</span><span class="ident" id="4858623">b</span><span class="op" id="4858624">.</span><span class="ident" id="4858625">Bytes</span><span class="op" id="4858630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858633">return</span><br>
<span class="lineno">240</span><span class="op" id="4858640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858643">func</span>&nbsp;<span class="ident" id="4858648">marshalObjectIdentifier</span><span class="op" id="4858671">(</span><span class="ident" id="4858672">out</span>&nbsp;<span class="op" id="4858676">*</span><span class="ident" id="4858677">forkableWriter</span><span class="op" id="4858691">,</span>&nbsp;<span class="ident" id="4858693">oid</span>&nbsp;<span class="op" id="4858697">[</span><span class="op" id="4858698">]</span><span class="builtintype" id="4858699">int</span><span class="op" id="4858702">)</span>&nbsp;<span class="op" id="4858704">(</span><span class="ident" id="4858705">err</span>&nbsp;<span class="builtintype" id="4858709">error</span><span class="op" id="4858714">)</span>&nbsp;<span class="op" id="4858716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858719">if</span>&nbsp;<span class="builtinfunc" id="4858722">len</span><span class="op" id="4858725">(</span><span class="ident" id="4858726">oid</span><span class="op" id="4858729">)</span>&nbsp;<span class="op" id="4858731">&lt;</span>&nbsp;<span class="num" id="4858733">2</span>&nbsp;<span class="op" id="4858735">||</span>&nbsp;<span class="ident" id="4858738">oid</span><span class="op" id="4858741">[</span><span class="num" id="4858742">0</span><span class="op" id="4858743">]</span>&nbsp;<span class="op" id="4858745">&gt;</span>&nbsp;<span class="num" id="4858747">2</span>&nbsp;<span class="op" id="4858749">||</span>&nbsp;<span class="op" id="4858752">(</span><span class="ident" id="4858753">oid</span><span class="op" id="4858756">[</span><span class="num" id="4858757">0</span><span class="op" id="4858758">]</span>&nbsp;<span class="op" id="4858760">&lt;</span>&nbsp;<span class="num" id="4858762">2</span>&nbsp;<span class="op" id="4858764">&amp;&amp;</span>&nbsp;<span class="ident" id="4858767">oid</span><span class="op" id="4858770">[</span><span class="num" id="4858771">1</span><span class="op" id="4858772">]</span>&nbsp;<span class="op" id="4858774">&gt;=</span>&nbsp;<span class="num" id="4858777">40</span><span class="op" id="4858779">)</span>&nbsp;<span class="op" id="4858781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858785">return</span>&nbsp;<span class="ident" id="4858792">StructuralError</span><span class="op" id="4858807">{</span><span class="string" id="4858808">&#34;invalid&nbsp;object&nbsp;identifier&#34;</span><span class="op" id="4858835">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858842">err</span>&nbsp;<span class="op" id="4858846">=</span>&nbsp;<span class="ident" id="4858848">marshalBase128Int</span><span class="op" id="4858865">(</span><span class="ident" id="4858866">out</span><span class="op" id="4858869">,</span>&nbsp;<span class="ident" id="4858871">int64</span><span class="op" id="4858876">(</span><span class="ident" id="4858877">oid</span><span class="op" id="4858880">[</span><span class="num" id="4858881">0</span><span class="op" id="4858882">]</span><span class="op" id="4858883">*</span><span class="num" id="4858884">40</span><span class="op" id="4858886">+</span><span class="ident" id="4858887">oid</span><span class="op" id="4858890">[</span><span class="num" id="4858891">1</span><span class="op" id="4858892">]</span><span class="op" id="4858893">)</span><span class="op" id="4858894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858897">if</span>&nbsp;<span class="ident" id="4858900">err</span>&nbsp;<span class="op" id="4858904">!=</span>&nbsp;<span class="ident" id="4858907">nil</span>&nbsp;<span class="op" id="4858911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858915">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858926">for</span>&nbsp;<span class="ident" id="4858930">i</span>&nbsp;<span class="op" id="4858932">:=</span>&nbsp;<span class="num" id="4858935">2</span><span class="op" id="4858936">;</span>&nbsp;<span class="ident" id="4858938">i</span>&nbsp;<span class="op" id="4858940">&lt;</span>&nbsp;<span class="builtinfunc" id="4858942">len</span><span class="op" id="4858945">(</span><span class="ident" id="4858946">oid</span><span class="op" id="4858949">)</span><span class="op" id="4858950">;</span>&nbsp;<span class="ident" id="4858952">i</span><span class="op" id="4858953">++</span>&nbsp;<span class="op" id="4858956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858960">err</span>&nbsp;<span class="op" id="4858964">=</span>&nbsp;<span class="ident" id="4858966">marshalBase128Int</span><span class="op" id="4858983">(</span><span class="ident" id="4858984">out</span><span class="op" id="4858987">,</span>&nbsp;<span class="ident" id="4858989">int64</span><span class="op" id="4858994">(</span><span class="ident" id="4858995">oid</span><span class="op" id="4858998">[</span><span class="ident" id="4858999">i</span><span class="op" id="4859000">]</span><span class="op" id="4859001">)</span><span class="op" id="4859002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859006">if</span>&nbsp;<span class="ident" id="4859009">err</span>&nbsp;<span class="op" id="4859013">!=</span>&nbsp;<span class="ident" id="4859016">nil</span>&nbsp;<span class="op" id="4859020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859025">return</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859041">return</span><br>
<span class="lineno"></span><span class="op" id="4859048">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="4859051">func</span>&nbsp;<span class="ident" id="4859056">marshalPrintableString</span><span class="op" id="4859078">(</span><span class="ident" id="4859079">out</span>&nbsp;<span class="op" id="4859083">*</span><span class="ident" id="4859084">forkableWriter</span><span class="op" id="4859098">,</span>&nbsp;<span class="ident" id="4859100">s</span>&nbsp;<span class="builtintype" id="4859102">string</span><span class="op" id="4859108">)</span>&nbsp;<span class="op" id="4859110">(</span><span class="ident" id="4859111">err</span>&nbsp;<span class="builtintype" id="4859115">error</span><span class="op" id="4859120">)</span>&nbsp;<span class="op" id="4859122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859125">b</span>&nbsp;<span class="op" id="4859127">:=</span>&nbsp;<span class="op" id="4859130">[</span><span class="op" id="4859131">]</span><span class="builtintype" id="4859132">byte</span><span class="op" id="4859136">(</span><span class="ident" id="4859137">s</span><span class="op" id="4859138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859141">for</span>&nbsp;<span class="ident" id="4859145">_</span><span class="op" id="4859146">,</span>&nbsp;<span class="ident" id="4859148">c</span>&nbsp;<span class="op" id="4859150">:=</span>&nbsp;<span class="keyword" id="4859153">range</span>&nbsp;<span class="ident" id="4859159">b</span>&nbsp;<span class="op" id="4859161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859165">if</span>&nbsp;<span class="op" id="4859168">!</span><span class="ident" id="4859169">isPrintable</span><span class="op" id="4859180">(</span><span class="ident" id="4859181">c</span><span class="op" id="4859182">)</span>&nbsp;<span class="op" id="4859184">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859189">return</span>&nbsp;<span class="ident" id="4859196">StructuralError</span><span class="op" id="4859211">{</span><span class="string" id="4859212">&#34;PrintableString&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="4859256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859267">_</span><span class="op" id="4859268">,</span>&nbsp;<span class="ident" id="4859270">err</span>&nbsp;<span class="op" id="4859274">=</span>&nbsp;<span class="ident" id="4859276">out</span><span class="op" id="4859279">.</span><span class="ident" id="4859280">Write</span><span class="op" id="4859285">(</span><span class="ident" id="4859286">b</span><span class="op" id="4859287">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859290">return</span><br>
<span class="lineno"></span><span class="op" id="4859297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4859300">func</span>&nbsp;<span class="ident" id="4859305">marshalIA5String</span><span class="op" id="4859321">(</span><span class="ident" id="4859322">out</span>&nbsp;<span class="op" id="4859326">*</span><span class="ident" id="4859327">forkableWriter</span><span class="op" id="4859341">,</span>&nbsp;<span class="ident" id="4859343">s</span>&nbsp;<span class="builtintype" id="4859345">string</span><span class="op" id="4859351">)</span>&nbsp;<span class="op" id="4859353">(</span><span class="ident" id="4859354">err</span>&nbsp;<span class="builtintype" id="4859358">error</span><span class="op" id="4859363">)</span>&nbsp;<span class="op" id="4859365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859368">b</span>&nbsp;<span class="op" id="4859370">:=</span>&nbsp;<span class="op" id="4859373">[</span><span class="op" id="4859374">]</span><span class="builtintype" id="4859375">byte</span><span class="op" id="4859379">(</span><span class="ident" id="4859380">s</span><span class="op" id="4859381">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859384">for</span>&nbsp;<span class="ident" id="4859388">_</span><span class="op" id="4859389">,</span>&nbsp;<span class="ident" id="4859391">c</span>&nbsp;<span class="op" id="4859393">:=</span>&nbsp;<span class="keyword" id="4859396">range</span>&nbsp;<span class="ident" id="4859402">b</span>&nbsp;<span class="op" id="4859404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859408">if</span>&nbsp;<span class="ident" id="4859411">c</span>&nbsp;<span class="op" id="4859413">&gt;</span>&nbsp;<span class="num" id="4859415">127</span>&nbsp;<span class="op" id="4859419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859424">return</span>&nbsp;<span class="ident" id="4859431">StructuralError</span><span class="op" id="4859446">{</span><span class="string" id="4859447">&#34;IA5String&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="4859485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859492">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859496">_</span><span class="op" id="4859497">,</span>&nbsp;<span class="ident" id="4859499">err</span>&nbsp;<span class="op" id="4859503">=</span>&nbsp;<span class="ident" id="4859505">out</span><span class="op" id="4859508">.</span><span class="ident" id="4859509">Write</span><span class="op" id="4859514">(</span><span class="ident" id="4859515">b</span><span class="op" id="4859516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859519">return</span><br>
<span class="lineno"></span><span class="op" id="4859526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4859529">func</span>&nbsp;<span class="ident" id="4859534">marshalUTF8String</span><span class="op" id="4859551">(</span><span class="ident" id="4859552">out</span>&nbsp;<span class="op" id="4859556">*</span><span class="ident" id="4859557">forkableWriter</span><span class="op" id="4859571">,</span>&nbsp;<span class="ident" id="4859573">s</span>&nbsp;<span class="builtintype" id="4859575">string</span><span class="op" id="4859581">)</span>&nbsp;<span class="op" id="4859583">(</span><span class="ident" id="4859584">err</span>&nbsp;<span class="builtintype" id="4859588">error</span><span class="op" id="4859593">)</span>&nbsp;<span class="op" id="4859595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859598">_</span><span class="op" id="4859599">,</span>&nbsp;<span class="ident" id="4859601">err</span>&nbsp;<span class="op" id="4859605">=</span>&nbsp;<span class="ident" id="4859607">out</span><span class="op" id="4859610">.</span><span class="ident" id="4859611">Write</span><span class="op" id="4859616">(</span><span class="op" id="4859617">[</span><span class="op" id="4859618">]</span><span class="builtintype" id="4859619">byte</span><span class="op" id="4859623">(</span><span class="ident" id="4859624">s</span><span class="op" id="4859625">)</span><span class="op" id="4859626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859629">return</span><br>
<span class="lineno"></span><span class="op" id="4859636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4859639">func</span>&nbsp;<span class="ident" id="4859644">marshalTwoDigits</span><span class="op" id="4859660">(</span><span class="ident" id="4859661">out</span>&nbsp;<span class="op" id="4859665">*</span><span class="ident" id="4859666">forkableWriter</span><span class="op" id="4859680">,</span>&nbsp;<span class="ident" id="4859682">v</span>&nbsp;<span class="builtintype" id="4859684">int</span><span class="op" id="4859687">)</span>&nbsp;<span class="op" id="4859689">(</span><span class="ident" id="4859690">err</span>&nbsp;<span class="builtintype" id="4859694">error</span><span class="op" id="4859699">)</span>&nbsp;<span class="op" id="4859701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859704">err</span>&nbsp;<span class="op" id="4859708">=</span>&nbsp;<span class="ident" id="4859710">out</span><span class="op" id="4859713">.</span><span class="ident" id="4859714">WriteByte</span><span class="op" id="4859723">(</span><span class="builtintype" id="4859724">byte</span><span class="op" id="4859728">(</span><span class="string" id="4859729">&#39;0&#39;</span>&nbsp;<span class="op" id="4859733">+</span>&nbsp;<span class="op" id="4859735">(</span><span class="ident" id="4859736">v</span><span class="op" id="4859737">/</span><span class="num" id="4859738">10</span><span class="op" id="4859740">)</span><span class="op" id="4859741">%</span><span class="num" id="4859742">10</span><span class="op" id="4859744">)</span><span class="op" id="4859745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859748">if</span>&nbsp;<span class="ident" id="4859751">err</span>&nbsp;<span class="op" id="4859755">!=</span>&nbsp;<span class="ident" id="4859758">nil</span>&nbsp;<span class="op" id="4859762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859766">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859774">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859777">return</span>&nbsp;<span class="ident" id="4859784">out</span><span class="op" id="4859787">.</span><span class="ident" id="4859788">WriteByte</span><span class="op" id="4859797">(</span><span class="builtintype" id="4859798">byte</span><span class="op" id="4859802">(</span><span class="string" id="4859803">&#39;0&#39;</span>&nbsp;<span class="op" id="4859807">+</span>&nbsp;<span class="ident" id="4859809">v</span><span class="op" id="4859810">%</span><span class="num" id="4859811">10</span><span class="op" id="4859813">)</span><span class="op" id="4859814">)</span><br>
<span class="lineno"></span><span class="op" id="4859816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4859819">func</span>&nbsp;<span class="ident" id="4859824">marshalFourDigits</span><span class="op" id="4859841">(</span><span class="ident" id="4859842">out</span>&nbsp;<span class="op" id="4859846">*</span><span class="ident" id="4859847">forkableWriter</span><span class="op" id="4859861">,</span>&nbsp;<span class="ident" id="4859863">v</span>&nbsp;<span class="builtintype" id="4859865">int</span><span class="op" id="4859868">)</span>&nbsp;<span class="op" id="4859870">(</span><span class="ident" id="4859871">err</span>&nbsp;<span class="builtintype" id="4859875">error</span><span class="op" id="4859880">)</span>&nbsp;<span class="op" id="4859882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859885">var</span>&nbsp;<span class="ident" id="4859889">bytes</span>&nbsp;<span class="op" id="4859895">[</span><span class="num" id="4859896">4</span><span class="op" id="4859897">]</span><span class="builtintype" id="4859898">byte</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859904">for</span>&nbsp;<span class="ident" id="4859908">i</span>&nbsp;<span class="op" id="4859910">:=</span>&nbsp;<span class="keyword" id="4859913">range</span>&nbsp;<span class="ident" id="4859919">bytes</span>&nbsp;<span class="op" id="4859925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859929">bytes</span><span class="op" id="4859934">[</span><span class="num" id="4859935">3</span><span class="op" id="4859936">-</span><span class="ident" id="4859937">i</span><span class="op" id="4859938">]</span>&nbsp;<span class="op" id="4859940">=</span>&nbsp;<span class="string" id="4859942">&#39;0&#39;</span>&nbsp;<span class="op" id="4859946">+</span>&nbsp;<span class="builtintype" id="4859948">byte</span><span class="op" id="4859952">(</span><span class="ident" id="4859953">v</span><span class="op" id="4859954">%</span><span class="num" id="4859955">10</span><span class="op" id="4859957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859961">v</span>&nbsp;<span class="op" id="4859963">/=</span>&nbsp;<span class="num" id="4859966">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859973">_</span><span class="op" id="4859974">,</span>&nbsp;<span class="ident" id="4859976">err</span>&nbsp;<span class="op" id="4859980">=</span>&nbsp;<span class="ident" id="4859982">out</span><span class="op" id="4859985">.</span><span class="ident" id="4859986">Write</span><span class="op" id="4859991">(</span><span class="ident" id="4859992">bytes</span><span class="op" id="4859997">[</span><span class="op" id="4859998">:</span><span class="op" id="4859999">]</span><span class="op" id="4860000">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860003">return</span><br>
<span class="lineno"></span><span class="op" id="4860010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4860013">func</span>&nbsp;<span class="ident" id="4860018">outsideUTCRange</span><span class="op" id="4860033">(</span><span class="ident" id="4860034">t</span>&nbsp;<span class="ident" id="4860036">time</span><span class="op" id="4860040">.</span><span class="ident" id="4860041">Time</span><span class="op" id="4860045">)</span>&nbsp;<span class="builtintype" id="4860047">bool</span>&nbsp;<span class="op" id="4860052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860055">year</span>&nbsp;<span class="op" id="4860060">:=</span>&nbsp;<span class="ident" id="4860063">t</span><span class="op" id="4860064">.</span><span class="ident" id="4860065">Year</span><span class="op" id="4860069">(</span><span class="op" id="4860070">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860073">return</span>&nbsp;<span class="ident" id="4860080">year</span>&nbsp;<span class="op" id="4860085">&lt;</span>&nbsp;<span class="num" id="4860087">1950</span>&nbsp;<span class="op" id="4860092">||</span>&nbsp;<span class="ident" id="4860095">year</span>&nbsp;<span class="op" id="4860100">&gt;=</span>&nbsp;<span class="num" id="4860103">2050</span><br>
<span class="lineno"></span><span class="op" id="4860108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4860111">func</span>&nbsp;<span class="ident" id="4860116">marshalUTCTime</span><span class="op" id="4860130">(</span><span class="ident" id="4860131">out</span>&nbsp;<span class="op" id="4860135">*</span><span class="ident" id="4860136">forkableWriter</span><span class="op" id="4860150">,</span>&nbsp;<span class="ident" id="4860152">t</span>&nbsp;<span class="ident" id="4860154">time</span><span class="op" id="4860158">.</span><span class="ident" id="4860159">Time</span><span class="op" id="4860163">)</span>&nbsp;<span class="op" id="4860165">(</span><span class="ident" id="4860166">err</span>&nbsp;<span class="builtintype" id="4860170">error</span><span class="op" id="4860175">)</span>&nbsp;<span class="op" id="4860177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860180">year</span>&nbsp;<span class="op" id="4860185">:=</span>&nbsp;<span class="ident" id="4860188">t</span><span class="op" id="4860189">.</span><span class="ident" id="4860190">Year</span><span class="op" id="4860194">(</span><span class="op" id="4860195">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860199">switch</span>&nbsp;<span class="op" id="4860206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860209">case</span>&nbsp;<span class="num" id="4860214">1950</span>&nbsp;<span class="op" id="4860219">&lt;=</span>&nbsp;<span class="ident" id="4860222">year</span>&nbsp;<span class="op" id="4860227">&amp;&amp;</span>&nbsp;<span class="ident" id="4860230">year</span>&nbsp;<span class="op" id="4860235">&lt;</span>&nbsp;<span class="num" id="4860237">2000</span><span class="op" id="4860241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860245">err</span>&nbsp;<span class="op" id="4860249">=</span>&nbsp;<span class="ident" id="4860251">marshalTwoDigits</span><span class="op" id="4860267">(</span><span class="ident" id="4860268">out</span><span class="op" id="4860271">,</span>&nbsp;<span class="builtintype" id="4860273">int</span><span class="op" id="4860276">(</span><span class="ident" id="4860277">year</span><span class="op" id="4860281">-</span><span class="num" id="4860282">1900</span><span class="op" id="4860286">)</span><span class="op" id="4860287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860290">case</span>&nbsp;<span class="num" id="4860295">2000</span>&nbsp;<span class="op" id="4860300">&lt;=</span>&nbsp;<span class="ident" id="4860303">year</span>&nbsp;<span class="op" id="4860308">&amp;&amp;</span>&nbsp;<span class="ident" id="4860311">year</span>&nbsp;<span class="op" id="4860316">&lt;</span>&nbsp;<span class="num" id="4860318">2050</span><span class="op" id="4860322">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860326">err</span>&nbsp;<span class="op" id="4860330">=</span>&nbsp;<span class="ident" id="4860332">marshalTwoDigits</span><span class="op" id="4860348">(</span><span class="ident" id="4860349">out</span><span class="op" id="4860352">,</span>&nbsp;<span class="builtintype" id="4860354">int</span><span class="op" id="4860357">(</span><span class="ident" id="4860358">year</span><span class="op" id="4860362">-</span><span class="num" id="4860363">2000</span><span class="op" id="4860367">)</span><span class="op" id="4860368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860371">default</span><span class="op" id="4860378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860382">return</span>&nbsp;<span class="ident" id="4860389">StructuralError</span><span class="op" id="4860404">{</span><span class="string" id="4860405">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;UTCTime&#34;</span><span class="op" id="4860439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860445">if</span>&nbsp;<span class="ident" id="4860448">err</span>&nbsp;<span class="op" id="4860452">!=</span>&nbsp;<span class="ident" id="4860455">nil</span>&nbsp;<span class="op" id="4860459">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860463">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860475">return</span>&nbsp;<span class="ident" id="4860482">marshalTimeCommon</span><span class="op" id="4860499">(</span><span class="ident" id="4860500">out</span><span class="op" id="4860503">,</span>&nbsp;<span class="ident" id="4860505">t</span><span class="op" id="4860506">)</span><br>
<span class="lineno"></span><span class="op" id="4860508">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4860511">func</span>&nbsp;<span class="ident" id="4860516">marshalGeneralizedTime</span><span class="op" id="4860538">(</span><span class="ident" id="4860539">out</span>&nbsp;<span class="op" id="4860543">*</span><span class="ident" id="4860544">forkableWriter</span><span class="op" id="4860558">,</span>&nbsp;<span class="ident" id="4860560">t</span>&nbsp;<span class="ident" id="4860562">time</span><span class="op" id="4860566">.</span><span class="ident" id="4860567">Time</span><span class="op" id="4860571">)</span>&nbsp;<span class="op" id="4860573">(</span><span class="ident" id="4860574">err</span>&nbsp;<span class="builtintype" id="4860578">error</span><span class="op" id="4860583">)</span>&nbsp;<span class="op" id="4860585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860588">year</span>&nbsp;<span class="op" id="4860593">:=</span>&nbsp;<span class="ident" id="4860596">t</span><span class="op" id="4860597">.</span><span class="ident" id="4860598">Year</span><span class="op" id="4860602">(</span><span class="op" id="4860603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860606">if</span>&nbsp;<span class="ident" id="4860609">year</span>&nbsp;<span class="op" id="4860614">&lt;</span>&nbsp;<span class="num" id="4860616">0</span>&nbsp;<span class="op" id="4860618">||</span>&nbsp;<span class="ident" id="4860621">year</span>&nbsp;<span class="op" id="4860626">&gt;</span>&nbsp;<span class="num" id="4860628">9999</span>&nbsp;<span class="op" id="4860633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860637">return</span>&nbsp;<span class="ident" id="4860644">StructuralError</span><span class="op" id="4860659">{</span><span class="string" id="4860660">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;GeneralizedTime&#34;</span><span class="op" id="4860702">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860708">if</span>&nbsp;<span class="ident" id="4860711">err</span>&nbsp;<span class="op" id="4860715">=</span>&nbsp;<span class="ident" id="4860717">marshalFourDigits</span><span class="op" id="4860734">(</span><span class="ident" id="4860735">out</span><span class="op" id="4860738">,</span>&nbsp;<span class="ident" id="4860740">year</span><span class="op" id="4860744">)</span><span class="op" id="4860745">;</span>&nbsp;<span class="ident" id="4860747">err</span>&nbsp;<span class="op" id="4860751">!=</span>&nbsp;<span class="ident" id="4860754">nil</span>&nbsp;<span class="op" id="4860758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860774">return</span>&nbsp;<span class="ident" id="4860781">marshalTimeCommon</span><span class="op" id="4860798">(</span><span class="ident" id="4860799">out</span><span class="op" id="4860802">,</span>&nbsp;<span class="ident" id="4860804">t</span><span class="op" id="4860805">)</span><br>
<span class="lineno"></span><span class="op" id="4860807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4860810">func</span>&nbsp;<span class="ident" id="4860815">marshalTimeCommon</span><span class="op" id="4860832">(</span><span class="ident" id="4860833">out</span>&nbsp;<span class="op" id="4860837">*</span><span class="ident" id="4860838">forkableWriter</span><span class="op" id="4860852">,</span>&nbsp;<span class="ident" id="4860854">t</span>&nbsp;<span class="ident" id="4860856">time</span><span class="op" id="4860860">.</span><span class="ident" id="4860861">Time</span><span class="op" id="4860865">)</span>&nbsp;<span class="op" id="4860867">(</span><span class="ident" id="4860868">err</span>&nbsp;<span class="builtintype" id="4860872">error</span><span class="op" id="4860877">)</span>&nbsp;<span class="op" id="4860879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860882">_</span><span class="op" id="4860883">,</span>&nbsp;<span class="ident" id="4860885">month</span><span class="op" id="4860890">,</span>&nbsp;<span class="ident" id="4860892">day</span>&nbsp;<span class="op" id="4860896">:=</span>&nbsp;<span class="ident" id="4860899">t</span><span class="op" id="4860900">.</span><span class="ident" id="4860901">Date</span><span class="op" id="4860905">(</span><span class="op" id="4860906">)</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860910">err</span>&nbsp;<span class="op" id="4860914">=</span>&nbsp;<span class="ident" id="4860916">marshalTwoDigits</span><span class="op" id="4860932">(</span><span class="ident" id="4860933">out</span><span class="op" id="4860936">,</span>&nbsp;<span class="builtintype" id="4860938">int</span><span class="op" id="4860941">(</span><span class="ident" id="4860942">month</span><span class="op" id="4860947">)</span><span class="op" id="4860948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860951">if</span>&nbsp;<span class="ident" id="4860954">err</span>&nbsp;<span class="op" id="4860958">!=</span>&nbsp;<span class="ident" id="4860961">nil</span>&nbsp;<span class="op" id="4860965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860977">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860981">err</span>&nbsp;<span class="op" id="4860985">=</span>&nbsp;<span class="ident" id="4860987">marshalTwoDigits</span><span class="op" id="4861003">(</span><span class="ident" id="4861004">out</span><span class="op" id="4861007">,</span>&nbsp;<span class="ident" id="4861009">day</span><span class="op" id="4861012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861015">if</span>&nbsp;<span class="ident" id="4861018">err</span>&nbsp;<span class="op" id="4861022">!=</span>&nbsp;<span class="ident" id="4861025">nil</span>&nbsp;<span class="op" id="4861029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861033">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861041">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861045">hour</span><span class="op" id="4861049">,</span>&nbsp;<span class="ident" id="4861051">min</span><span class="op" id="4861054">,</span>&nbsp;<span class="ident" id="4861056">sec</span>&nbsp;<span class="op" id="4861060">:=</span>&nbsp;<span class="ident" id="4861063">t</span><span class="op" id="4861064">.</span><span class="ident" id="4861065">Clock</span><span class="op" id="4861070">(</span><span class="op" id="4861071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861075">err</span>&nbsp;<span class="op" id="4861079">=</span>&nbsp;<span class="ident" id="4861081">marshalTwoDigits</span><span class="op" id="4861097">(</span><span class="ident" id="4861098">out</span><span class="op" id="4861101">,</span>&nbsp;<span class="ident" id="4861103">hour</span><span class="op" id="4861107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861110">if</span>&nbsp;<span class="ident" id="4861113">err</span>&nbsp;<span class="op" id="4861117">!=</span>&nbsp;<span class="ident" id="4861120">nil</span>&nbsp;<span class="op" id="4861124">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861128">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861140">err</span>&nbsp;<span class="op" id="4861144">=</span>&nbsp;<span class="ident" id="4861146">marshalTwoDigits</span><span class="op" id="4861162">(</span><span class="ident" id="4861163">out</span><span class="op" id="4861166">,</span>&nbsp;<span class="ident" id="4861168">min</span><span class="op" id="4861171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861174">if</span>&nbsp;<span class="ident" id="4861177">err</span>&nbsp;<span class="op" id="4861181">!=</span>&nbsp;<span class="ident" id="4861184">nil</span>&nbsp;<span class="op" id="4861188">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861192">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861204">err</span>&nbsp;<span class="op" id="4861208">=</span>&nbsp;<span class="ident" id="4861210">marshalTwoDigits</span><span class="op" id="4861226">(</span><span class="ident" id="4861227">out</span><span class="op" id="4861230">,</span>&nbsp;<span class="ident" id="4861232">sec</span><span class="op" id="4861235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861238">if</span>&nbsp;<span class="ident" id="4861241">err</span>&nbsp;<span class="op" id="4861245">!=</span>&nbsp;<span class="ident" id="4861248">nil</span>&nbsp;<span class="op" id="4861252">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861268">_</span><span class="op" id="4861269">,</span>&nbsp;<span class="ident" id="4861271">offset</span>&nbsp;<span class="op" id="4861278">:=</span>&nbsp;<span class="ident" id="4861281">t</span><span class="op" id="4861282">.</span><span class="ident" id="4861283">Zone</span><span class="op" id="4861287">(</span><span class="op" id="4861288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861292">switch</span>&nbsp;<span class="op" id="4861299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861302">case</span>&nbsp;<span class="ident" id="4861307">offset</span><span class="op" id="4861313">/</span><span class="num" id="4861314">60</span>&nbsp;<span class="op" id="4861317">==</span>&nbsp;<span class="num" id="4861320">0</span><span class="op" id="4861321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861325">err</span>&nbsp;<span class="op" id="4861329">=</span>&nbsp;<span class="ident" id="4861331">out</span><span class="op" id="4861334">.</span><span class="ident" id="4861335">WriteByte</span><span class="op" id="4861344">(</span><span class="string" id="4861345">&#39;Z&#39;</span><span class="op" id="4861348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861352">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861360">case</span>&nbsp;<span class="ident" id="4861365">offset</span>&nbsp;<span class="op" id="4861372">&gt;</span>&nbsp;<span class="num" id="4861374">0</span><span class="op" id="4861375">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861379">err</span>&nbsp;<span class="op" id="4861383">=</span>&nbsp;<span class="ident" id="4861385">out</span><span class="op" id="4861388">.</span><span class="ident" id="4861389">WriteByte</span><span class="op" id="4861398">(</span><span class="string" id="4861399">&#39;+&#39;</span><span class="op" id="4861402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861405">case</span>&nbsp;<span class="ident" id="4861410">offset</span>&nbsp;<span class="op" id="4861417">&lt;</span>&nbsp;<span class="num" id="4861419">0</span><span class="op" id="4861420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861424">err</span>&nbsp;<span class="op" id="4861428">=</span>&nbsp;<span class="ident" id="4861430">out</span><span class="op" id="4861433">.</span><span class="ident" id="4861434">WriteByte</span><span class="op" id="4861443">(</span><span class="string" id="4861444">&#39;-&#39;</span><span class="op" id="4861447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861454">if</span>&nbsp;<span class="ident" id="4861457">err</span>&nbsp;<span class="op" id="4861461">!=</span>&nbsp;<span class="ident" id="4861464">nil</span>&nbsp;<span class="op" id="4861468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861484">offsetMinutes</span>&nbsp;<span class="op" id="4861498">:=</span>&nbsp;<span class="ident" id="4861501">offset</span>&nbsp;<span class="op" id="4861508">/</span>&nbsp;<span class="num" id="4861510">60</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861514">if</span>&nbsp;<span class="ident" id="4861517">offsetMinutes</span>&nbsp;<span class="op" id="4861531">&lt;</span>&nbsp;<span class="num" id="4861533">0</span>&nbsp;<span class="op" id="4861535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861539">offsetMinutes</span>&nbsp;<span class="op" id="4861553">=</span>&nbsp;<span class="op" id="4861555">-</span><span class="ident" id="4861556">offsetMinutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861575">err</span>&nbsp;<span class="op" id="4861579">=</span>&nbsp;<span class="ident" id="4861581">marshalTwoDigits</span><span class="op" id="4861597">(</span><span class="ident" id="4861598">out</span><span class="op" id="4861601">,</span>&nbsp;<span class="ident" id="4861603">offsetMinutes</span><span class="op" id="4861616">/</span><span class="num" id="4861617">60</span><span class="op" id="4861619">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861622">if</span>&nbsp;<span class="ident" id="4861625">err</span>&nbsp;<span class="op" id="4861629">!=</span>&nbsp;<span class="ident" id="4861632">nil</span>&nbsp;<span class="op" id="4861636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861652">err</span>&nbsp;<span class="op" id="4861656">=</span>&nbsp;<span class="ident" id="4861658">marshalTwoDigits</span><span class="op" id="4861674">(</span><span class="ident" id="4861675">out</span><span class="op" id="4861678">,</span>&nbsp;<span class="ident" id="4861680">offsetMinutes</span><span class="op" id="4861693">%</span><span class="num" id="4861694">60</span><span class="op" id="4861696">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861699">return</span><br>
<span class="lineno"></span><span class="op" id="4861706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4861709">func</span>&nbsp;<span class="ident" id="4861714">stripTagAndLength</span><span class="op" id="4861731">(</span><span class="ident" id="4861732">in</span>&nbsp;<span class="op" id="4861735">[</span><span class="op" id="4861736">]</span><span class="builtintype" id="4861737">byte</span><span class="op" id="4861741">)</span>&nbsp;<span class="op" id="4861743">[</span><span class="op" id="4861744">]</span><span class="builtintype" id="4861745">byte</span>&nbsp;<span class="op" id="4861750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861753">_</span><span class="op" id="4861754">,</span>&nbsp;<span class="ident" id="4861756">offset</span><span class="op" id="4861762">,</span>&nbsp;<span class="ident" id="4861764">err</span>&nbsp;<span class="op" id="4861768">:=</span>&nbsp;<span class="ident" id="4861771">parseTagAndLength</span><span class="op" id="4861788">(</span><span class="ident" id="4861789">in</span><span class="op" id="4861791">,</span>&nbsp;<span class="num" id="4861793">0</span><span class="op" id="4861794">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861797">if</span>&nbsp;<span class="ident" id="4861800">err</span>&nbsp;<span class="op" id="4861804">!=</span>&nbsp;<span class="ident" id="4861807">nil</span>&nbsp;<span class="op" id="4861811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861815">return</span>&nbsp;<span class="ident" id="4861822">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861829">return</span>&nbsp;<span class="ident" id="4861836">in</span><span class="op" id="4861838">[</span><span class="ident" id="4861839">offset</span><span class="op" id="4861845">:</span><span class="op" id="4861846">]</span><br>
<span class="lineno"></span><span class="op" id="4861848">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="keyword" id="4861851">func</span>&nbsp;<span class="ident" id="4861856">marshalBody</span><span class="op" id="4861867">(</span><span class="ident" id="4861868">out</span>&nbsp;<span class="op" id="4861872">*</span><span class="ident" id="4861873">forkableWriter</span><span class="op" id="4861887">,</span>&nbsp;<span class="ident" id="4861889">value</span>&nbsp;<span class="ident" id="4861895">reflect</span><span class="op" id="4861902">.</span><span class="ident" id="4861903">Value</span><span class="op" id="4861908">,</span>&nbsp;<span class="ident" id="4861910">params</span>&nbsp;<span class="ident" id="4861917">fieldParameters</span><span class="op" id="4861932">)</span>&nbsp;<span class="op" id="4861934">(</span><span class="ident" id="4861935">err</span>&nbsp;<span class="builtintype" id="4861939">error</span><span class="op" id="4861944">)</span>&nbsp;<span class="op" id="4861946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861949">switch</span>&nbsp;<span class="ident" id="4861956">value</span><span class="op" id="4861961">.</span><span class="ident" id="4861962">Type</span><span class="op" id="4861966">(</span><span class="op" id="4861967">)</span>&nbsp;<span class="op" id="4861969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861972">case</span>&nbsp;<span class="ident" id="4861977">timeType</span><span class="op" id="4861985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861989">t</span>&nbsp;<span class="op" id="4861991">:=</span>&nbsp;<span class="ident" id="4861994">value</span><span class="op" id="4861999">.</span><span class="ident" id="4862000">Interface</span><span class="op" id="4862009">(</span><span class="op" id="4862010">)</span><span class="op" id="4862011">.</span><span class="op" id="4862012">(</span><span class="ident" id="4862013">time</span><span class="op" id="4862017">.</span><span class="ident" id="4862018">Time</span><span class="op" id="4862022">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862026">if</span>&nbsp;<span class="ident" id="4862029">outsideUTCRange</span><span class="op" id="4862044">(</span><span class="ident" id="4862045">t</span><span class="op" id="4862046">)</span>&nbsp;<span class="op" id="4862048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862053">return</span>&nbsp;<span class="ident" id="4862060">marshalGeneralizedTime</span><span class="op" id="4862082">(</span><span class="ident" id="4862083">out</span><span class="op" id="4862086">,</span>&nbsp;<span class="ident" id="4862088">t</span><span class="op" id="4862089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862093">}</span>&nbsp;<span class="keyword" id="4862095">else</span>&nbsp;<span class="op" id="4862100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862105">return</span>&nbsp;<span class="ident" id="4862112">marshalUTCTime</span><span class="op" id="4862126">(</span><span class="ident" id="4862127">out</span><span class="op" id="4862130">,</span>&nbsp;<span class="ident" id="4862132">t</span><span class="op" id="4862133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862137">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862140">case</span>&nbsp;<span class="ident" id="4862145">bitStringType</span><span class="op" id="4862158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862162">return</span>&nbsp;<span class="ident" id="4862169">marshalBitString</span><span class="op" id="4862185">(</span><span class="ident" id="4862186">out</span><span class="op" id="4862189">,</span>&nbsp;<span class="ident" id="4862191">value</span><span class="op" id="4862196">.</span><span class="ident" id="4862197">Interface</span><span class="op" id="4862206">(</span><span class="op" id="4862207">)</span><span class="op" id="4862208">.</span><span class="op" id="4862209">(</span><span class="ident" id="4862210">BitString</span><span class="op" id="4862219">)</span><span class="op" id="4862220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862223">case</span>&nbsp;<span class="ident" id="4862228">objectIdentifierType</span><span class="op" id="4862248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862252">return</span>&nbsp;<span class="ident" id="4862259">marshalObjectIdentifier</span><span class="op" id="4862282">(</span><span class="ident" id="4862283">out</span><span class="op" id="4862286">,</span>&nbsp;<span class="ident" id="4862288">value</span><span class="op" id="4862293">.</span><span class="ident" id="4862294">Interface</span><span class="op" id="4862303">(</span><span class="op" id="4862304">)</span><span class="op" id="4862305">.</span><span class="op" id="4862306">(</span><span class="ident" id="4862307">ObjectIdentifier</span><span class="op" id="4862323">)</span><span class="op" id="4862324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862327">case</span>&nbsp;<span class="ident" id="4862332">bigIntType</span><span class="op" id="4862342">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862346">return</span>&nbsp;<span class="ident" id="4862353">marshalBigInt</span><span class="op" id="4862366">(</span><span class="ident" id="4862367">out</span><span class="op" id="4862370">,</span>&nbsp;<span class="ident" id="4862372">value</span><span class="op" id="4862377">.</span><span class="ident" id="4862378">Interface</span><span class="op" id="4862387">(</span><span class="op" id="4862388">)</span><span class="op" id="4862389">.</span><span class="op" id="4862390">(</span><span class="op" id="4862391">*</span><span class="ident" id="4862392">big</span><span class="op" id="4862395">.</span><span class="ident" id="4862396">Int</span><span class="op" id="4862399">)</span><span class="op" id="4862400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862407">switch</span>&nbsp;<span class="ident" id="4862414">v</span>&nbsp;<span class="op" id="4862416">:=</span>&nbsp;<span class="ident" id="4862419">value</span><span class="op" id="4862424">;</span>&nbsp;<span class="ident" id="4862426">v</span><span class="op" id="4862427">.</span><span class="ident" id="4862428">Kind</span><span class="op" id="4862432">(</span><span class="op" id="4862433">)</span>&nbsp;<span class="op" id="4862435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862438">case</span>&nbsp;<span class="ident" id="4862443">reflect</span><span class="op" id="4862450">.</span><span class="ident" id="4862451">Bool</span><span class="op" id="4862455">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862459">if</span>&nbsp;<span class="ident" id="4862462">v</span><span class="op" id="4862463">.</span><span class="ident" id="4862464">Bool</span><span class="op" id="4862468">(</span><span class="op" id="4862469">)</span>&nbsp;<span class="op" id="4862471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862476">return</span>&nbsp;<span class="ident" id="4862483">out</span><span class="op" id="4862486">.</span><span class="ident" id="4862487">WriteByte</span><span class="op" id="4862496">(</span><span class="num" id="4862497">255</span><span class="op" id="4862500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862504">}</span>&nbsp;<span class="keyword" id="4862506">else</span>&nbsp;<span class="op" id="4862511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862516">return</span>&nbsp;<span class="ident" id="4862523">out</span><span class="op" id="4862526">.</span><span class="ident" id="4862527">WriteByte</span><span class="op" id="4862536">(</span><span class="num" id="4862537">0</span><span class="op" id="4862538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862542">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862545">case</span>&nbsp;<span class="ident" id="4862550">reflect</span><span class="op" id="4862557">.</span><span class="ident" id="4862558">Int</span><span class="op" id="4862561">,</span>&nbsp;<span class="ident" id="4862563">reflect</span><span class="op" id="4862570">.</span><span class="ident" id="4862571">Int8</span><span class="op" id="4862575">,</span>&nbsp;<span class="ident" id="4862577">reflect</span><span class="op" id="4862584">.</span><span class="ident" id="4862585">Int16</span><span class="op" id="4862590">,</span>&nbsp;<span class="ident" id="4862592">reflect</span><span class="op" id="4862599">.</span><span class="ident" id="4862600">Int32</span><span class="op" id="4862605">,</span>&nbsp;<span class="ident" id="4862607">reflect</span><span class="op" id="4862614">.</span><span class="ident" id="4862615">Int64</span><span class="op" id="4862620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862624">return</span>&nbsp;<span class="ident" id="4862631">marshalInt64</span><span class="op" id="4862643">(</span><span class="ident" id="4862644">out</span><span class="op" id="4862647">,</span>&nbsp;<span class="ident" id="4862649">int64</span><span class="op" id="4862654">(</span><span class="ident" id="4862655">v</span><span class="op" id="4862656">.</span><span class="ident" id="4862657">Int</span><span class="op" id="4862660">(</span><span class="op" id="4862661">)</span><span class="op" id="4862662">)</span><span class="op" id="4862663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862666">case</span>&nbsp;<span class="ident" id="4862671">reflect</span><span class="op" id="4862678">.</span><span class="ident" id="4862679">Struct</span><span class="op" id="4862685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862689">t</span>&nbsp;<span class="op" id="4862691">:=</span>&nbsp;<span class="ident" id="4862694">v</span><span class="op" id="4862695">.</span><span class="ident" id="4862696">Type</span><span class="op" id="4862700">(</span><span class="op" id="4862701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862706">startingField</span>&nbsp;<span class="op" id="4862720">:=</span>&nbsp;<span class="num" id="4862723">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4862728">//&nbsp;If&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;structure&nbsp;is&nbsp;a&nbsp;non-empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4862786">//&nbsp;RawContents,&nbsp;then&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;serializing&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862847">if</span>&nbsp;<span class="ident" id="4862850">t</span><span class="op" id="4862851">.</span><span class="ident" id="4862852">NumField</span><span class="op" id="4862860">(</span><span class="op" id="4862861">)</span>&nbsp;<span class="op" id="4862863">&gt;</span>&nbsp;<span class="num" id="4862865">0</span>&nbsp;<span class="op" id="4862867">&amp;&amp;</span>&nbsp;<span class="ident" id="4862870">t</span><span class="op" id="4862871">.</span><span class="ident" id="4862872">Field</span><span class="op" id="4862877">(</span><span class="num" id="4862878">0</span><span class="op" id="4862879">)</span><span class="op" id="4862880">.</span><span class="ident" id="4862881">Type</span>&nbsp;<span class="op" id="4862886">==</span>&nbsp;<span class="ident" id="4862889">rawContentsType</span>&nbsp;<span class="op" id="4862905">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862910">s</span>&nbsp;<span class="op" id="4862912">:=</span>&nbsp;<span class="ident" id="4862915">v</span><span class="op" id="4862916">.</span><span class="ident" id="4862917">Field</span><span class="op" id="4862922">(</span><span class="num" id="4862923">0</span><span class="op" id="4862924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862929">if</span>&nbsp;<span class="ident" id="4862932">s</span><span class="op" id="4862933">.</span><span class="ident" id="4862934">Len</span><span class="op" id="4862937">(</span><span class="op" id="4862938">)</span>&nbsp;<span class="op" id="4862940">&gt;</span>&nbsp;<span class="num" id="4862942">0</span>&nbsp;<span class="op" id="4862944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862950">bytes</span>&nbsp;<span class="op" id="4862956">:=</span>&nbsp;<span class="builtinfunc" id="4862959">make</span><span class="op" id="4862963">(</span><span class="op" id="4862964">[</span><span class="op" id="4862965">]</span><span class="builtintype" id="4862966">byte</span><span class="op" id="4862970">,</span>&nbsp;<span class="ident" id="4862972">s</span><span class="op" id="4862973">.</span><span class="ident" id="4862974">Len</span><span class="op" id="4862977">(</span><span class="op" id="4862978">)</span><span class="op" id="4862979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862985">for</span>&nbsp;<span class="ident" id="4862989">i</span>&nbsp;<span class="op" id="4862991">:=</span>&nbsp;<span class="num" id="4862994">0</span><span class="op" id="4862995">;</span>&nbsp;<span class="ident" id="4862997">i</span>&nbsp;<span class="op" id="4862999">&lt;</span>&nbsp;<span class="ident" id="4863001">s</span><span class="op" id="4863002">.</span><span class="ident" id="4863003">Len</span><span class="op" id="4863006">(</span><span class="op" id="4863007">)</span><span class="op" id="4863008">;</span>&nbsp;<span class="ident" id="4863010">i</span><span class="op" id="4863011">++</span>&nbsp;<span class="op" id="4863014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863021">bytes</span><span class="op" id="4863026">[</span><span class="ident" id="4863027">i</span><span class="op" id="4863028">]</span>&nbsp;<span class="op" id="4863030">=</span>&nbsp;<span class="builtintype" id="4863032">uint8</span><span class="op" id="4863037">(</span><span class="ident" id="4863038">s</span><span class="op" id="4863039">.</span><span class="ident" id="4863040">Index</span><span class="op" id="4863045">(</span><span class="ident" id="4863046">i</span><span class="op" id="4863047">)</span><span class="op" id="4863048">.</span><span class="ident" id="4863049">Uint</span><span class="op" id="4863053">(</span><span class="op" id="4863054">)</span><span class="op" id="4863055">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863067">/*&nbsp;The&nbsp;RawContents&nbsp;will&nbsp;contain&nbsp;the&nbsp;tag&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;length&nbsp;fields&nbsp;but&nbsp;we&#39;ll&nbsp;also&nbsp;be&nbsp;writing<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;those&nbsp;ourselves,&nbsp;so&nbsp;we&nbsp;strip&nbsp;them&nbsp;out&nbsp;of<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;bytes&nbsp;*/</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863226">_</span><span class="op" id="4863227">,</span>&nbsp;<span class="ident" id="4863229">err</span>&nbsp;<span class="op" id="4863233">=</span>&nbsp;<span class="ident" id="4863235">out</span><span class="op" id="4863238">.</span><span class="ident" id="4863239">Write</span><span class="op" id="4863244">(</span><span class="ident" id="4863245">stripTagAndLength</span><span class="op" id="4863262">(</span><span class="ident" id="4863263">bytes</span><span class="op" id="4863268">)</span><span class="op" id="4863269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863285">}</span>&nbsp;<span class="keyword" id="4863287">else</span>&nbsp;<span class="op" id="4863292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863298">startingField</span>&nbsp;<span class="op" id="4863312">=</span>&nbsp;<span class="num" id="4863314">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863319">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863328">for</span>&nbsp;<span class="ident" id="4863332">i</span>&nbsp;<span class="op" id="4863334">:=</span>&nbsp;<span class="ident" id="4863337">startingField</span><span class="op" id="4863350">;</span>&nbsp;<span class="ident" id="4863352">i</span>&nbsp;<span class="op" id="4863354">&lt;</span>&nbsp;<span class="ident" id="4863356">t</span><span class="op" id="4863357">.</span><span class="ident" id="4863358">NumField</span><span class="op" id="4863366">(</span><span class="op" id="4863367">)</span><span class="op" id="4863368">;</span>&nbsp;<span class="ident" id="4863370">i</span><span class="op" id="4863371">++</span>&nbsp;<span class="op" id="4863374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863379">var</span>&nbsp;<span class="ident" id="4863383">pre</span>&nbsp;<span class="op" id="4863387">*</span><span class="ident" id="4863388">forkableWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863406">pre</span><span class="op" id="4863409">,</span>&nbsp;<span class="ident" id="4863411">out</span>&nbsp;<span class="op" id="4863415">=</span>&nbsp;<span class="ident" id="4863417">out</span><span class="op" id="4863420">.</span><span class="ident" id="4863421">fork</span><span class="op" id="4863425">(</span><span class="op" id="4863426">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863431">err</span>&nbsp;<span class="op" id="4863435">=</span>&nbsp;<span class="ident" id="4863437">marshalField</span><span class="op" id="4863449">(</span><span class="ident" id="4863450">pre</span><span class="op" id="4863453">,</span>&nbsp;<span class="ident" id="4863455">v</span><span class="op" id="4863456">.</span><span class="ident" id="4863457">Field</span><span class="op" id="4863462">(</span><span class="ident" id="4863463">i</span><span class="op" id="4863464">)</span><span class="op" id="4863465">,</span>&nbsp;<span class="ident" id="4863467">parseFieldParameters</span><span class="op" id="4863487">(</span><span class="ident" id="4863488">t</span><span class="op" id="4863489">.</span><span class="ident" id="4863490">Field</span><span class="op" id="4863495">(</span><span class="ident" id="4863496">i</span><span class="op" id="4863497">)</span><span class="op" id="4863498">.</span><span class="ident" id="4863499">Tag</span><span class="op" id="4863502">.</span><span class="ident" id="4863503">Get</span><span class="op" id="4863506">(</span><span class="string" id="4863507">&#34;asn1&#34;</span><span class="op" id="4863513">)</span><span class="op" id="4863514">)</span><span class="op" id="4863515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863520">if</span>&nbsp;<span class="ident" id="4863523">err</span>&nbsp;<span class="op" id="4863527">!=</span>&nbsp;<span class="ident" id="4863530">nil</span>&nbsp;<span class="op" id="4863534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863540">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863554">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863566">case</span>&nbsp;<span class="ident" id="4863571">reflect</span><span class="op" id="4863578">.</span><span class="ident" id="4863579">Slice</span><span class="op" id="4863584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863588">sliceType</span>&nbsp;<span class="op" id="4863598">:=</span>&nbsp;<span class="ident" id="4863601">v</span><span class="op" id="4863602">.</span><span class="ident" id="4863603">Type</span><span class="op" id="4863607">(</span><span class="op" id="4863608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863612">if</span>&nbsp;<span class="ident" id="4863615">sliceType</span><span class="op" id="4863624">.</span><span class="ident" id="4863625">Elem</span><span class="op" id="4863629">(</span><span class="op" id="4863630">)</span><span class="op" id="4863631">.</span><span class="ident" id="4863632">Kind</span><span class="op" id="4863636">(</span><span class="op" id="4863637">)</span>&nbsp;<span class="op" id="4863639">==</span>&nbsp;<span class="ident" id="4863642">reflect</span><span class="op" id="4863649">.</span><span class="ident" id="4863650">Uint8</span>&nbsp;<span class="op" id="4863656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863661">bytes</span>&nbsp;<span class="op" id="4863667">:=</span>&nbsp;<span class="builtinfunc" id="4863670">make</span><span class="op" id="4863674">(</span><span class="op" id="4863675">[</span><span class="op" id="4863676">]</span><span class="builtintype" id="4863677">byte</span><span class="op" id="4863681">,</span>&nbsp;<span class="ident" id="4863683">v</span><span class="op" id="4863684">.</span><span class="ident" id="4863685">Len</span><span class="op" id="4863688">(</span><span class="op" id="4863689">)</span><span class="op" id="4863690">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863695">for</span>&nbsp;<span class="ident" id="4863699">i</span>&nbsp;<span class="op" id="4863701">:=</span>&nbsp;<span class="num" id="4863704">0</span><span class="op" id="4863705">;</span>&nbsp;<span class="ident" id="4863707">i</span>&nbsp;<span class="op" id="4863709">&lt;</span>&nbsp;<span class="ident" id="4863711">v</span><span class="op" id="4863712">.</span><span class="ident" id="4863713">Len</span><span class="op" id="4863716">(</span><span class="op" id="4863717">)</span><span class="op" id="4863718">;</span>&nbsp;<span class="ident" id="4863720">i</span><span class="op" id="4863721">++</span>&nbsp;<span class="op" id="4863724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863730">bytes</span><span class="op" id="4863735">[</span><span class="ident" id="4863736">i</span><span class="op" id="4863737">]</span>&nbsp;<span class="op" id="4863739">=</span>&nbsp;<span class="builtintype" id="4863741">uint8</span><span class="op" id="4863746">(</span><span class="ident" id="4863747">v</span><span class="op" id="4863748">.</span><span class="ident" id="4863749">Index</span><span class="op" id="4863754">(</span><span class="ident" id="4863755">i</span><span class="op" id="4863756">)</span><span class="op" id="4863757">.</span><span class="ident" id="4863758">Uint</span><span class="op" id="4863762">(</span><span class="op" id="4863763">)</span><span class="op" id="4863764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863774">_</span><span class="op" id="4863775">,</span>&nbsp;<span class="ident" id="4863777">err</span>&nbsp;<span class="op" id="4863781">=</span>&nbsp;<span class="ident" id="4863783">out</span><span class="op" id="4863786">.</span><span class="ident" id="4863787">Write</span><span class="op" id="4863792">(</span><span class="ident" id="4863793">bytes</span><span class="op" id="4863798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863803">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863817">var</span>&nbsp;<span class="ident" id="4863821">fp</span>&nbsp;<span class="ident" id="4863824">fieldParameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863842">for</span>&nbsp;<span class="ident" id="4863846">i</span>&nbsp;<span class="op" id="4863848">:=</span>&nbsp;<span class="num" id="4863851">0</span><span class="op" id="4863852">;</span>&nbsp;<span class="ident" id="4863854">i</span>&nbsp;<span class="op" id="4863856">&lt;</span>&nbsp;<span class="ident" id="4863858">v</span><span class="op" id="4863859">.</span><span class="ident" id="4863860">Len</span><span class="op" id="4863863">(</span><span class="op" id="4863864">)</span><span class="op" id="4863865">;</span>&nbsp;<span class="ident" id="4863867">i</span><span class="op" id="4863868">++</span>&nbsp;<span class="op" id="4863871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863876">var</span>&nbsp;<span class="ident" id="4863880">pre</span>&nbsp;<span class="op" id="4863884">*</span><span class="ident" id="4863885">forkableWriter</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863903">pre</span><span class="op" id="4863906">,</span>&nbsp;<span class="ident" id="4863908">out</span>&nbsp;<span class="op" id="4863912">=</span>&nbsp;<span class="ident" id="4863914">out</span><span class="op" id="4863917">.</span><span class="ident" id="4863918">fork</span><span class="op" id="4863922">(</span><span class="op" id="4863923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863928">err</span>&nbsp;<span class="op" id="4863932">=</span>&nbsp;<span class="ident" id="4863934">marshalField</span><span class="op" id="4863946">(</span><span class="ident" id="4863947">pre</span><span class="op" id="4863950">,</span>&nbsp;<span class="ident" id="4863952">v</span><span class="op" id="4863953">.</span><span class="ident" id="4863954">Index</span><span class="op" id="4863959">(</span><span class="ident" id="4863960">i</span><span class="op" id="4863961">)</span><span class="op" id="4863962">,</span>&nbsp;<span class="ident" id="4863964">fp</span><span class="op" id="4863966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863971">if</span>&nbsp;<span class="ident" id="4863974">err</span>&nbsp;<span class="op" id="4863978">!=</span>&nbsp;<span class="ident" id="4863981">nil</span>&nbsp;<span class="op" id="4863985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864001">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864009">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864017">case</span>&nbsp;<span class="ident" id="4864022">reflect</span><span class="op" id="4864029">.</span><span class="ident" id="4864030">String</span><span class="op" id="4864036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864040">switch</span>&nbsp;<span class="ident" id="4864047">params</span><span class="op" id="4864053">.</span><span class="ident" id="4864054">stringType</span>&nbsp;<span class="op" id="4864065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864069">case</span>&nbsp;<span class="ident" id="4864074">tagIA5String</span><span class="op" id="4864086">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864091">return</span>&nbsp;<span class="ident" id="4864098">marshalIA5String</span><span class="op" id="4864114">(</span><span class="ident" id="4864115">out</span><span class="op" id="4864118">,</span>&nbsp;<span class="ident" id="4864120">v</span><span class="op" id="4864121">.</span><span class="ident" id="4864122">String</span><span class="op" id="4864128">(</span><span class="op" id="4864129">)</span><span class="op" id="4864130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864134">case</span>&nbsp;<span class="ident" id="4864139">tagPrintableString</span><span class="op" id="4864157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864162">return</span>&nbsp;<span class="ident" id="4864169">marshalPrintableString</span><span class="op" id="4864191">(</span><span class="ident" id="4864192">out</span><span class="op" id="4864195">,</span>&nbsp;<span class="ident" id="4864197">v</span><span class="op" id="4864198">.</span><span class="ident" id="4864199">String</span><span class="op" id="4864205">(</span><span class="op" id="4864206">)</span><span class="op" id="4864207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864211">default</span><span class="op" id="4864218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864223">return</span>&nbsp;<span class="ident" id="4864230">marshalUTF8String</span><span class="op" id="4864247">(</span><span class="ident" id="4864248">out</span><span class="op" id="4864251">,</span>&nbsp;<span class="ident" id="4864253">v</span><span class="op" id="4864254">.</span><span class="ident" id="4864255">String</span><span class="op" id="4864261">(</span><span class="op" id="4864262">)</span><span class="op" id="4864263">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864274">return</span>&nbsp;<span class="ident" id="4864281">StructuralError</span><span class="op" id="4864296">{</span><span class="string" id="4864297">&#34;unknown&nbsp;Go&nbsp;type&#34;</span><span class="op" id="4864314">}</span><br>
<span class="lineno"></span><span class="op" id="4864316">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="keyword" id="4864319">func</span>&nbsp;<span class="ident" id="4864324">marshalField</span><span class="op" id="4864336">(</span><span class="ident" id="4864337">out</span>&nbsp;<span class="op" id="4864341">*</span><span class="ident" id="4864342">forkableWriter</span><span class="op" id="4864356">,</span>&nbsp;<span class="ident" id="4864358">v</span>&nbsp;<span class="ident" id="4864360">reflect</span><span class="op" id="4864367">.</span><span class="ident" id="4864368">Value</span><span class="op" id="4864373">,</span>&nbsp;<span class="ident" id="4864375">params</span>&nbsp;<span class="ident" id="4864382">fieldParameters</span><span class="op" id="4864397">)</span>&nbsp;<span class="op" id="4864399">(</span><span class="ident" id="4864400">err</span>&nbsp;<span class="builtintype" id="4864404">error</span><span class="op" id="4864409">)</span>&nbsp;<span class="op" id="4864411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864414">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;an&nbsp;interface{}&nbsp;then&nbsp;recurse&nbsp;into&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864471">if</span>&nbsp;<span class="ident" id="4864474">v</span><span class="op" id="4864475">.</span><span class="ident" id="4864476">Kind</span><span class="op" id="4864480">(</span><span class="op" id="4864481">)</span>&nbsp;<span class="op" id="4864483">==</span>&nbsp;<span class="ident" id="4864486">reflect</span><span class="op" id="4864493">.</span><span class="ident" id="4864494">Interface</span>&nbsp;<span class="op" id="4864504">&amp;&amp;</span>&nbsp;<span class="ident" id="4864507">v</span><span class="op" id="4864508">.</span><span class="ident" id="4864509">Type</span><span class="op" id="4864513">(</span><span class="op" id="4864514">)</span><span class="op" id="4864515">.</span><span class="ident" id="4864516">NumMethod</span><span class="op" id="4864525">(</span><span class="op" id="4864526">)</span>&nbsp;<span class="op" id="4864528">==</span>&nbsp;<span class="num" id="4864531">0</span>&nbsp;<span class="op" id="4864533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864537">return</span>&nbsp;<span class="ident" id="4864544">marshalField</span><span class="op" id="4864556">(</span><span class="ident" id="4864557">out</span><span class="op" id="4864560">,</span>&nbsp;<span class="ident" id="4864562">v</span><span class="op" id="4864563">.</span><span class="ident" id="4864564">Elem</span><span class="op" id="4864568">(</span><span class="op" id="4864569">)</span><span class="op" id="4864570">,</span>&nbsp;<span class="ident" id="4864572">params</span><span class="op" id="4864578">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864585">if</span>&nbsp;<span class="ident" id="4864588">v</span><span class="op" id="4864589">.</span><span class="ident" id="4864590">Kind</span><span class="op" id="4864594">(</span><span class="op" id="4864595">)</span>&nbsp;<span class="op" id="4864597">==</span>&nbsp;<span class="ident" id="4864600">reflect</span><span class="op" id="4864607">.</span><span class="ident" id="4864608">Slice</span>&nbsp;<span class="op" id="4864614">&amp;&amp;</span>&nbsp;<span class="ident" id="4864617">v</span><span class="op" id="4864618">.</span><span class="ident" id="4864619">Len</span><span class="op" id="4864622">(</span><span class="op" id="4864623">)</span>&nbsp;<span class="op" id="4864625">==</span>&nbsp;<span class="num" id="4864628">0</span>&nbsp;<span class="op" id="4864630">&amp;&amp;</span>&nbsp;<span class="ident" id="4864633">params</span><span class="op" id="4864639">.</span><span class="ident" id="4864640">omitEmpty</span>&nbsp;<span class="op" id="4864650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864662">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864666">if</span>&nbsp;<span class="ident" id="4864669">params</span><span class="op" id="4864675">.</span><span class="ident" id="4864676">optional</span>&nbsp;<span class="op" id="4864685">&amp;&amp;</span>&nbsp;<span class="ident" id="4864688">params</span><span class="op" id="4864694">.</span><span class="ident" id="4864695">defaultValue</span>&nbsp;<span class="op" id="4864708">!=</span>&nbsp;<span class="ident" id="4864711">nil</span>&nbsp;<span class="op" id="4864715">&amp;&amp;</span>&nbsp;<span class="ident" id="4864718">canHaveDefaultValue</span><span class="op" id="4864737">(</span><span class="ident" id="4864738">v</span><span class="op" id="4864739">.</span><span class="ident" id="4864740">Kind</span><span class="op" id="4864744">(</span><span class="op" id="4864745">)</span><span class="op" id="4864746">)</span>&nbsp;<span class="op" id="4864748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864752">defaultValue</span>&nbsp;<span class="op" id="4864765">:=</span>&nbsp;<span class="ident" id="4864768">reflect</span><span class="op" id="4864775">.</span><span class="ident" id="4864776">New</span><span class="op" id="4864779">(</span><span class="ident" id="4864780">v</span><span class="op" id="4864781">.</span><span class="ident" id="4864782">Type</span><span class="op" id="4864786">(</span><span class="op" id="4864787">)</span><span class="op" id="4864788">)</span><span class="op" id="4864789">.</span><span class="ident" id="4864790">Elem</span><span class="op" id="4864794">(</span><span class="op" id="4864795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864799">defaultValue</span><span class="op" id="4864811">.</span><span class="ident" id="4864812">SetInt</span><span class="op" id="4864818">(</span><span class="op" id="4864819">*</span><span class="ident" id="4864820">params</span><span class="op" id="4864826">.</span><span class="ident" id="4864827">defaultValue</span><span class="op" id="4864839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864844">if</span>&nbsp;<span class="ident" id="4864847">reflect</span><span class="op" id="4864854">.</span><span class="ident" id="4864855">DeepEqual</span><span class="op" id="4864864">(</span><span class="ident" id="4864865">v</span><span class="op" id="4864866">.</span><span class="ident" id="4864867">Interface</span><span class="op" id="4864876">(</span><span class="op" id="4864877">)</span><span class="op" id="4864878">,</span>&nbsp;<span class="ident" id="4864880">defaultValue</span><span class="op" id="4864892">.</span><span class="ident" id="4864893">Interface</span><span class="op" id="4864902">(</span><span class="op" id="4864903">)</span><span class="op" id="4864904">)</span>&nbsp;<span class="op" id="4864906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864911">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864927">//&nbsp;If&nbsp;no&nbsp;default&nbsp;value&nbsp;is&nbsp;given&nbsp;then&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;the&nbsp;type&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864996">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;the&nbsp;default&nbsp;value.&nbsp;This&nbsp;isn&#39;t&nbsp;obviously&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865066">//&nbsp;behaviour,&nbsp;but&nbsp;it&#39;s&nbsp;what&nbsp;Go&nbsp;has&nbsp;traditionally&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865122">if</span>&nbsp;<span class="ident" id="4865125">params</span><span class="op" id="4865131">.</span><span class="ident" id="4865132">optional</span>&nbsp;<span class="op" id="4865141">&amp;&amp;</span>&nbsp;<span class="ident" id="4865144">params</span><span class="op" id="4865150">.</span><span class="ident" id="4865151">defaultValue</span>&nbsp;<span class="op" id="4865164">==</span>&nbsp;<span class="ident" id="4865167">nil</span>&nbsp;<span class="op" id="4865171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865175">if</span>&nbsp;<span class="ident" id="4865178">reflect</span><span class="op" id="4865185">.</span><span class="ident" id="4865186">DeepEqual</span><span class="op" id="4865195">(</span><span class="ident" id="4865196">v</span><span class="op" id="4865197">.</span><span class="ident" id="4865198">Interface</span><span class="op" id="4865207">(</span><span class="op" id="4865208">)</span><span class="op" id="4865209">,</span>&nbsp;<span class="ident" id="4865211">reflect</span><span class="op" id="4865218">.</span><span class="ident" id="4865219">Zero</span><span class="op" id="4865223">(</span><span class="ident" id="4865224">v</span><span class="op" id="4865225">.</span><span class="ident" id="4865226">Type</span><span class="op" id="4865230">(</span><span class="op" id="4865231">)</span><span class="op" id="4865232">)</span><span class="op" id="4865233">.</span><span class="ident" id="4865234">Interface</span><span class="op" id="4865243">(</span><span class="op" id="4865244">)</span><span class="op" id="4865245">)</span>&nbsp;<span class="op" id="4865247">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865252">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865268">if</span>&nbsp;<span class="ident" id="4865271">v</span><span class="op" id="4865272">.</span><span class="ident" id="4865273">Type</span><span class="op" id="4865277">(</span><span class="op" id="4865278">)</span>&nbsp;<span class="op" id="4865280">==</span>&nbsp;<span class="ident" id="4865283">rawValueType</span>&nbsp;<span class="op" id="4865296">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865300">rv</span>&nbsp;<span class="op" id="4865303">:=</span>&nbsp;<span class="ident" id="4865306">v</span><span class="op" id="4865307">.</span><span class="ident" id="4865308">Interface</span><span class="op" id="4865317">(</span><span class="op" id="4865318">)</span><span class="op" id="4865319">.</span><span class="op" id="4865320">(</span><span class="ident" id="4865321">RawValue</span><span class="op" id="4865329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865333">if</span>&nbsp;<span class="builtinfunc" id="4865336">len</span><span class="op" id="4865339">(</span><span class="ident" id="4865340">rv</span><span class="op" id="4865342">.</span><span class="ident" id="4865343">FullBytes</span><span class="op" id="4865352">)</span>&nbsp;<span class="op" id="4865354">!=</span>&nbsp;<span class="num" id="4865357">0</span>&nbsp;<span class="op" id="4865359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865364">_</span><span class="op" id="4865365">,</span>&nbsp;<span class="ident" id="4865367">err</span>&nbsp;<span class="op" id="4865371">=</span>&nbsp;<span class="ident" id="4865373">out</span><span class="op" id="4865376">.</span><span class="ident" id="4865377">Write</span><span class="op" id="4865382">(</span><span class="ident" id="4865383">rv</span><span class="op" id="4865385">.</span><span class="ident" id="4865386">FullBytes</span><span class="op" id="4865395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865399">}</span>&nbsp;<span class="keyword" id="4865401">else</span>&nbsp;<span class="op" id="4865406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865411">err</span>&nbsp;<span class="op" id="4865415">=</span>&nbsp;<span class="ident" id="4865417">marshalTagAndLength</span><span class="op" id="4865436">(</span><span class="ident" id="4865437">out</span><span class="op" id="4865440">,</span>&nbsp;<span class="ident" id="4865442">tagAndLength</span><span class="op" id="4865454">{</span><span class="ident" id="4865455">rv</span><span class="op" id="4865457">.</span><span class="ident" id="4865458">Class</span><span class="op" id="4865463">,</span>&nbsp;<span class="ident" id="4865465">rv</span><span class="op" id="4865467">.</span><span class="ident" id="4865468">Tag</span><span class="op" id="4865471">,</span>&nbsp;<span class="builtinfunc" id="4865473">len</span><span class="op" id="4865476">(</span><span class="ident" id="4865477">rv</span><span class="op" id="4865479">.</span><span class="ident" id="4865480">Bytes</span><span class="op" id="4865485">)</span><span class="op" id="4865486">,</span>&nbsp;<span class="ident" id="4865488">rv</span><span class="op" id="4865490">.</span><span class="ident" id="4865491">IsCompound</span><span class="op" id="4865501">}</span><span class="op" id="4865502">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865507">if</span>&nbsp;<span class="ident" id="4865510">err</span>&nbsp;<span class="op" id="4865514">!=</span>&nbsp;<span class="ident" id="4865517">nil</span>&nbsp;<span class="op" id="4865521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865527">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865542">_</span><span class="op" id="4865543">,</span>&nbsp;<span class="ident" id="4865545">err</span>&nbsp;<span class="op" id="4865549">=</span>&nbsp;<span class="ident" id="4865551">out</span><span class="op" id="4865554">.</span><span class="ident" id="4865555">Write</span><span class="op" id="4865560">(</span><span class="ident" id="4865561">rv</span><span class="op" id="4865563">.</span><span class="ident" id="4865564">Bytes</span><span class="op" id="4865569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865573">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865577">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865589">tag</span><span class="op" id="4865592">,</span>&nbsp;<span class="ident" id="4865594">isCompound</span><span class="op" id="4865604">,</span>&nbsp;<span class="ident" id="4865606">ok</span>&nbsp;<span class="op" id="4865609">:=</span>&nbsp;<span class="ident" id="4865612">getUniversalType</span><span class="op" id="4865628">(</span><span class="ident" id="4865629">v</span><span class="op" id="4865630">.</span><span class="ident" id="4865631">Type</span><span class="op" id="4865635">(</span><span class="op" id="4865636">)</span><span class="op" id="4865637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865640">if</span>&nbsp;<span class="op" id="4865643">!</span><span class="ident" id="4865644">ok</span>&nbsp;<span class="op" id="4865647">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865651">err</span>&nbsp;<span class="op" id="4865655">=</span>&nbsp;<span class="ident" id="4865657">StructuralError</span><span class="op" id="4865672">{</span><span class="ident" id="4865673">fmt</span><span class="op" id="4865676">.</span><span class="ident" id="4865677">Sprintf</span><span class="op" id="4865684">(</span><span class="string" id="4865685">&#34;unknown&nbsp;Go&nbsp;type:&nbsp;%v&#34;</span><span class="op" id="4865706">,</span>&nbsp;<span class="ident" id="4865708">v</span><span class="op" id="4865709">.</span><span class="ident" id="4865710">Type</span><span class="op" id="4865714">(</span><span class="op" id="4865715">)</span><span class="op" id="4865716">)</span><span class="op" id="4865717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865721">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865732">class</span>&nbsp;<span class="op" id="4865738">:=</span>&nbsp;<span class="ident" id="4865741">classUniversal</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865758">if</span>&nbsp;<span class="ident" id="4865761">params</span><span class="op" id="4865767">.</span><span class="ident" id="4865768">stringType</span>&nbsp;<span class="op" id="4865779">!=</span>&nbsp;<span class="num" id="4865782">0</span>&nbsp;<span class="op" id="4865784">&amp;&amp;</span>&nbsp;<span class="ident" id="4865787">tag</span>&nbsp;<span class="op" id="4865791">!=</span>&nbsp;<span class="ident" id="4865794">tagPrintableString</span>&nbsp;<span class="op" id="4865813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865817">return</span>&nbsp;<span class="ident" id="4865824">StructuralError</span><span class="op" id="4865839">{</span><span class="string" id="4865840">&#34;explicit&nbsp;string&nbsp;type&nbsp;given&nbsp;to&nbsp;non-string&nbsp;member&#34;</span><span class="op" id="4865889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865896">switch</span>&nbsp;<span class="ident" id="4865903">tag</span>&nbsp;<span class="op" id="4865907">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865910">case</span>&nbsp;<span class="ident" id="4865915">tagPrintableString</span><span class="op" id="4865933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865937">if</span>&nbsp;<span class="ident" id="4865940">params</span><span class="op" id="4865946">.</span><span class="ident" id="4865947">stringType</span>&nbsp;<span class="op" id="4865958">==</span>&nbsp;<span class="num" id="4865961">0</span>&nbsp;<span class="op" id="4865963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865968">//&nbsp;This&nbsp;is&nbsp;a&nbsp;string&nbsp;without&nbsp;an&nbsp;explicit&nbsp;string&nbsp;type.&nbsp;We&#39;ll&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866034">//&nbsp;a&nbsp;PrintableString&nbsp;if&nbsp;the&nbsp;character&nbsp;set&nbsp;in&nbsp;the&nbsp;string&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866096">//&nbsp;sufficiently&nbsp;limited,&nbsp;otherwise&nbsp;we&#39;ll&nbsp;use&nbsp;a&nbsp;UTF8String.</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866158">for</span>&nbsp;<span class="ident" id="4866162">_</span><span class="op" id="4866163">,</span>&nbsp;<span class="ident" id="4866165">r</span>&nbsp;<span class="op" id="4866167">:=</span>&nbsp;<span class="keyword" id="4866170">range</span>&nbsp;<span class="ident" id="4866176">v</span><span class="op" id="4866177">.</span><span class="ident" id="4866178">String</span><span class="op" id="4866184">(</span><span class="op" id="4866185">)</span>&nbsp;<span class="op" id="4866187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866193">if</span>&nbsp;<span class="ident" id="4866196">r</span>&nbsp;<span class="op" id="4866198">&gt;=</span>&nbsp;<span class="ident" id="4866201">utf8</span><span class="op" id="4866205">.</span><span class="ident" id="4866206">RuneSelf</span>&nbsp;<span class="op" id="4866215">||</span>&nbsp;<span class="op" id="4866218">!</span><span class="ident" id="4866219">isPrintable</span><span class="op" id="4866230">(</span><span class="builtintype" id="4866231">byte</span><span class="op" id="4866235">(</span><span class="ident" id="4866236">r</span><span class="op" id="4866237">)</span><span class="op" id="4866238">)</span>&nbsp;<span class="op" id="4866240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866247">if</span>&nbsp;<span class="op" id="4866250">!</span><span class="ident" id="4866251">utf8</span><span class="op" id="4866255">.</span><span class="ident" id="4866256">ValidString</span><span class="op" id="4866267">(</span><span class="ident" id="4866268">v</span><span class="op" id="4866269">.</span><span class="ident" id="4866270">String</span><span class="op" id="4866276">(</span><span class="op" id="4866277">)</span><span class="op" id="4866278">)</span>&nbsp;<span class="op" id="4866280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866288">return</span>&nbsp;<span class="ident" id="4866295">errors</span><span class="op" id="4866301">.</span><span class="ident" id="4866302">New</span><span class="op" id="4866305">(</span><span class="string" id="4866306">&#34;asn1:&nbsp;string&nbsp;not&nbsp;valid&nbsp;UTF-8&#34;</span><span class="op" id="4866336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866343">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866350">tag</span>&nbsp;<span class="op" id="4866354">=</span>&nbsp;<span class="ident" id="4866356">tagUTF8String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866375">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866394">}</span>&nbsp;<span class="keyword" id="4866396">else</span>&nbsp;<span class="op" id="4866401">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866406">tag</span>&nbsp;<span class="op" id="4866410">=</span>&nbsp;<span class="ident" id="4866412">params</span><span class="op" id="4866418">.</span><span class="ident" id="4866419">stringType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866435">case</span>&nbsp;<span class="ident" id="4866440">tagUTCTime</span><span class="op" id="4866450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866454">if</span>&nbsp;<span class="ident" id="4866457">outsideUTCRange</span><span class="op" id="4866472">(</span><span class="ident" id="4866473">v</span><span class="op" id="4866474">.</span><span class="ident" id="4866475">Interface</span><span class="op" id="4866484">(</span><span class="op" id="4866485">)</span><span class="op" id="4866486">.</span><span class="op" id="4866487">(</span><span class="ident" id="4866488">time</span><span class="op" id="4866492">.</span><span class="ident" id="4866493">Time</span><span class="op" id="4866497">)</span><span class="op" id="4866498">)</span>&nbsp;<span class="op" id="4866500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866505">tag</span>&nbsp;<span class="op" id="4866509">=</span>&nbsp;<span class="ident" id="4866511">tagGeneralizedTime</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866539">if</span>&nbsp;<span class="ident" id="4866542">params</span><span class="op" id="4866548">.</span><span class="ident" id="4866549">set</span>&nbsp;<span class="op" id="4866553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866557">if</span>&nbsp;<span class="ident" id="4866560">tag</span>&nbsp;<span class="op" id="4866564">!=</span>&nbsp;<span class="ident" id="4866567">tagSequence</span>&nbsp;<span class="op" id="4866579">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866584">return</span>&nbsp;<span class="ident" id="4866591">StructuralError</span><span class="op" id="4866606">{</span><span class="string" id="4866607">&#34;non&nbsp;sequence&nbsp;tagged&nbsp;as&nbsp;set&#34;</span><span class="op" id="4866635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866643">tag</span>&nbsp;<span class="op" id="4866647">=</span>&nbsp;<span class="ident" id="4866649">tagSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866661">tags</span><span class="op" id="4866665">,</span>&nbsp;<span class="ident" id="4866667">body</span>&nbsp;<span class="op" id="4866672">:=</span>&nbsp;<span class="ident" id="4866675">out</span><span class="op" id="4866678">.</span><span class="ident" id="4866679">fork</span><span class="op" id="4866683">(</span><span class="op" id="4866684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866688">err</span>&nbsp;<span class="op" id="4866692">=</span>&nbsp;<span class="ident" id="4866694">marshalBody</span><span class="op" id="4866705">(</span><span class="ident" id="4866706">body</span><span class="op" id="4866710">,</span>&nbsp;<span class="ident" id="4866712">v</span><span class="op" id="4866713">,</span>&nbsp;<span class="ident" id="4866715">params</span><span class="op" id="4866721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866724">if</span>&nbsp;<span class="ident" id="4866727">err</span>&nbsp;<span class="op" id="4866731">!=</span>&nbsp;<span class="ident" id="4866734">nil</span>&nbsp;<span class="op" id="4866738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866742">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866754">bodyLen</span>&nbsp;<span class="op" id="4866762">:=</span>&nbsp;<span class="ident" id="4866765">body</span><span class="op" id="4866769">.</span><span class="ident" id="4866770">Len</span><span class="op" id="4866773">(</span><span class="op" id="4866774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866778">var</span>&nbsp;<span class="ident" id="4866782">explicitTag</span>&nbsp;<span class="op" id="4866794">*</span><span class="ident" id="4866795">forkableWriter</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866811">if</span>&nbsp;<span class="ident" id="4866814">params</span><span class="op" id="4866820">.</span><span class="ident" id="4866821">explicit</span>&nbsp;<span class="op" id="4866830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866834">explicitTag</span><span class="op" id="4866845">,</span>&nbsp;<span class="ident" id="4866847">tags</span>&nbsp;<span class="op" id="4866852">=</span>&nbsp;<span class="ident" id="4866854">tags</span><span class="op" id="4866858">.</span><span class="ident" id="4866859">fork</span><span class="op" id="4866863">(</span><span class="op" id="4866864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866871">if</span>&nbsp;<span class="op" id="4866874">!</span><span class="ident" id="4866875">params</span><span class="op" id="4866881">.</span><span class="ident" id="4866882">explicit</span>&nbsp;<span class="op" id="4866891">&amp;&amp;</span>&nbsp;<span class="ident" id="4866894">params</span><span class="op" id="4866900">.</span><span class="ident" id="4866901">tag</span>&nbsp;<span class="op" id="4866905">!=</span>&nbsp;<span class="ident" id="4866908">nil</span>&nbsp;<span class="op" id="4866912">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866916">//&nbsp;implicit&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866935">tag</span>&nbsp;<span class="op" id="4866939">=</span>&nbsp;<span class="op" id="4866941">*</span><span class="ident" id="4866942">params</span><span class="op" id="4866948">.</span><span class="ident" id="4866949">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866955">class</span>&nbsp;<span class="op" id="4866961">=</span>&nbsp;<span class="ident" id="4866963">classContextSpecific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866989">err</span>&nbsp;<span class="op" id="4866993">=</span>&nbsp;<span class="ident" id="4866995">marshalTagAndLength</span><span class="op" id="4867014">(</span><span class="ident" id="4867015">tags</span><span class="op" id="4867019">,</span>&nbsp;<span class="ident" id="4867021">tagAndLength</span><span class="op" id="4867033">{</span><span class="ident" id="4867034">class</span><span class="op" id="4867039">,</span>&nbsp;<span class="ident" id="4867041">tag</span><span class="op" id="4867044">,</span>&nbsp;<span class="ident" id="4867046">bodyLen</span><span class="op" id="4867053">,</span>&nbsp;<span class="ident" id="4867055">isCompound</span><span class="op" id="4867065">}</span><span class="op" id="4867066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867069">if</span>&nbsp;<span class="ident" id="4867072">err</span>&nbsp;<span class="op" id="4867076">!=</span>&nbsp;<span class="ident" id="4867079">nil</span>&nbsp;<span class="op" id="4867083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867087">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867099">if</span>&nbsp;<span class="ident" id="4867102">params</span><span class="op" id="4867108">.</span><span class="ident" id="4867109">explicit</span>&nbsp;<span class="op" id="4867118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867122">err</span>&nbsp;<span class="op" id="4867126">=</span>&nbsp;<span class="ident" id="4867128">marshalTagAndLength</span><span class="op" id="4867147">(</span><span class="ident" id="4867148">explicitTag</span><span class="op" id="4867159">,</span>&nbsp;<span class="ident" id="4867161">tagAndLength</span><span class="op" id="4867173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867178">class</span><span class="op" id="4867183">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867190">classContextSpecific</span><span class="op" id="4867210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867215">tag</span><span class="op" id="4867218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4867227">*</span><span class="ident" id="4867228">params</span><span class="op" id="4867234">.</span><span class="ident" id="4867235">tag</span><span class="op" id="4867238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867243">length</span><span class="op" id="4867249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867255">bodyLen</span>&nbsp;<span class="op" id="4867263">+</span>&nbsp;<span class="ident" id="4867265">tags</span><span class="op" id="4867269">.</span><span class="ident" id="4867270">Len</span><span class="op" id="4867273">(</span><span class="op" id="4867274">)</span><span class="op" id="4867275">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867280">isCompound</span><span class="op" id="4867290">:</span>&nbsp;<span class="builtintype" id="4867292">true</span><span class="op" id="4867296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867300">}</span><span class="op" id="4867301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867308">return</span>&nbsp;<span class="ident" id="4867315">nil</span><br>
<span class="lineno">625</span><span class="op" id="4867319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4867322">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;ASN.1&nbsp;encoding&nbsp;of&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="4867368">//</span><br>
<span class="lineno"></span><span class="comment" id="4867371">//&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;struct&nbsp;tags&nbsp;recognised&nbsp;by&nbsp;Unmarshal,&nbsp;the&nbsp;following&nbsp;can&nbsp;be</span><br>
<span class="lineno">630</span><span class="comment" id="4867451">//&nbsp;used:</span><br>
<span class="lineno"></span><span class="comment" id="4867460">//</span><br>
<span class="lineno"></span><span class="comment" id="4867463">//&nbsp;&nbsp;&nbsp;&nbspia5:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;IA5&nbsp;strings</span><br>
<span class="lineno"></span><span class="comment" id="4867525">//&nbsp;&nbsp;&nbsp;&nbspomitempty:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;empty&nbsp;slices&nbsp;to&nbsp;be&nbsp;skipped</span><br>
<span class="lineno"></span><span class="comment" id="4867573">//&nbsp;&nbsp;&nbsp;&nbspprintable:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;PrintableString&nbsp;strings.</span><br>
<span class="lineno">635</span><span class="comment" id="4867653">//&nbsp;&nbsp;&nbsp;&nbsputf8:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;UTF8&nbsp;strings</span><br>
<span class="lineno"></span><span class="keyword" id="4867717">func</span>&nbsp;<span class="ident" id="4867722">Marshal</span><span class="op" id="4867729">(</span><span class="ident" id="4867730">val</span>&nbsp;<span class="keyword" id="4867734">interface</span><span class="op" id="4867743">{</span><span class="op" id="4867744">}</span><span class="op" id="4867745">)</span>&nbsp;<span class="op" id="4867747">(</span><span class="op" id="4867748">[</span><span class="op" id="4867749">]</span><span class="builtintype" id="4867750">byte</span><span class="op" id="4867754">,</span>&nbsp;<span class="builtintype" id="4867756">error</span><span class="op" id="4867761">)</span>&nbsp;<span class="op" id="4867763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867766">var</span>&nbsp;<span class="ident" id="4867770">out</span>&nbsp;<span class="ident" id="4867774">bytes</span><span class="op" id="4867779">.</span><span class="ident" id="4867780">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867788">v</span>&nbsp;<span class="op" id="4867790">:=</span>&nbsp;<span class="ident" id="4867793">reflect</span><span class="op" id="4867800">.</span><span class="ident" id="4867801">ValueOf</span><span class="op" id="4867808">(</span><span class="ident" id="4867809">val</span><span class="op" id="4867812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867815">f</span>&nbsp;<span class="op" id="4867817">:=</span>&nbsp;<span class="ident" id="4867820">newForkableWriter</span><span class="op" id="4867837">(</span><span class="op" id="4867838">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867841">err</span>&nbsp;<span class="op" id="4867845">:=</span>&nbsp;<span class="ident" id="4867848">marshalField</span><span class="op" id="4867860">(</span><span class="ident" id="4867861">f</span><span class="op" id="4867862">,</span>&nbsp;<span class="ident" id="4867864">v</span><span class="op" id="4867865">,</span>&nbsp;<span class="ident" id="4867867">fieldParameters</span><span class="op" id="4867882">{</span><span class="op" id="4867883">}</span><span class="op" id="4867884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867887">if</span>&nbsp;<span class="ident" id="4867890">err</span>&nbsp;<span class="op" id="4867894">!=</span>&nbsp;<span class="ident" id="4867897">nil</span>&nbsp;<span class="op" id="4867901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867905">return</span>&nbsp;<span class="ident" id="4867912">nil</span><span class="op" id="4867915">,</span>&nbsp;<span class="ident" id="4867917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867925">_</span><span class="op" id="4867926">,</span>&nbsp;<span class="ident" id="4867928">err</span>&nbsp;<span class="op" id="4867932">=</span>&nbsp;<span class="ident" id="4867934">f</span><span class="op" id="4867935">.</span><span class="ident" id="4867936">writeTo</span><span class="op" id="4867943">(</span><span class="op" id="4867944">&amp;</span><span class="ident" id="4867945">out</span><span class="op" id="4867948">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867951">return</span>&nbsp;<span class="ident" id="4867958">out</span><span class="op" id="4867961">.</span><span class="ident" id="4867962">Bytes</span><span class="op" id="4867967">(</span><span class="op" id="4867968">)</span><span class="op" id="4867969">,</span>&nbsp;<span class="ident" id="4867971">nil</span><br>
<span class="lineno"></span><span class="op" id="4867975">}</span>
</div>
</body>
</html>
