<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html" class="current">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4453152">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4453207">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4453261">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4453312">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4453371">package</span>&nbsp;<span class="ident" id="4453379">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4453384">import</span>&nbsp;<span class="op" id="4453391">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453394">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453413">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453423">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453430">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453438">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4453448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453451">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="4453510">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4453562">type</span>&nbsp;<span class="ident" id="4453567">Rat</span>&nbsp;<span class="keyword" id="4453571">struct</span>&nbsp;<span class="op" id="4453578">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453581">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453638">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453692">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453752">a</span><span class="op" id="4453753">,</span>&nbsp;<span class="ident" id="4453755">b</span>&nbsp;<span class="ident" id="4453757">Int</span><br>
<span class="lineno"></span><span class="op" id="4453761">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4453764">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4453828">func</span>&nbsp;<span class="ident" id="4453833">NewRat</span><span class="op" id="4453839">(</span><span class="ident" id="4453840">a</span><span class="op" id="4453841">,</span>&nbsp;<span class="ident" id="4453843">b</span>&nbsp;<span class="ident" id="4453845">int64</span><span class="op" id="4453850">)</span>&nbsp;<span class="op" id="4453852">*</span><span class="ident" id="4453853">Rat</span>&nbsp;<span class="op" id="4453857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453860">return</span>&nbsp;<span class="builtinfunc" id="4453867">new</span><span class="op" id="4453870">(</span><span class="ident" id="4453871">Rat</span><span class="op" id="4453874">)</span><span class="op" id="4453875">.</span><span class="ident" id="4453876">SetFrac64</span><span class="op" id="4453885">(</span><span class="ident" id="4453886">a</span><span class="op" id="4453887">,</span>&nbsp;<span class="ident" id="4453889">b</span><span class="op" id="4453890">)</span><br>
<span class="lineno"></span><span class="op" id="4453892">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4453895">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4453944">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4453989">func</span>&nbsp;<span class="op" id="4453994">(</span><span class="ident" id="4453995">z</span>&nbsp;<span class="op" id="4453997">*</span><span class="ident" id="4453998">Rat</span><span class="op" id="4454001">)</span>&nbsp;<span class="ident" id="4454003">SetFloat64</span><span class="op" id="4454013">(</span><span class="ident" id="4454014">f</span>&nbsp;<span class="builtintype" id="4454016">float64</span><span class="op" id="4454023">)</span>&nbsp;<span class="op" id="4454025">*</span><span class="ident" id="4454026">Rat</span>&nbsp;<span class="op" id="4454030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454033">const</span>&nbsp;<span class="ident" id="4454039">expMask</span>&nbsp;<span class="op" id="4454047">=</span>&nbsp;<span class="num" id="4454049">1</span><span class="op" id="4454050">&lt;&lt;</span><span class="num" id="4454052">11</span>&nbsp;<span class="op" id="4454055">-</span>&nbsp;<span class="num" id="4454057">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454060">bits</span>&nbsp;<span class="op" id="4454065">:=</span>&nbsp;<span class="ident" id="4454068">math</span><span class="op" id="4454072">.</span><span class="ident" id="4454073">Float64bits</span><span class="op" id="4454084">(</span><span class="ident" id="4454085">f</span><span class="op" id="4454086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454089">mantissa</span>&nbsp;<span class="op" id="4454098">:=</span>&nbsp;<span class="ident" id="4454101">bits</span>&nbsp;<span class="op" id="4454106">&amp;</span>&nbsp;<span class="op" id="4454108">(</span><span class="num" id="4454109">1</span><span class="op" id="4454110">&lt;&lt;</span><span class="num" id="4454112">52</span>&nbsp;<span class="op" id="4454115">-</span>&nbsp;<span class="num" id="4454117">1</span><span class="op" id="4454118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454121">exp</span>&nbsp;<span class="op" id="4454125">:=</span>&nbsp;<span class="builtintype" id="4454128">int</span><span class="op" id="4454131">(</span><span class="op" id="4454132">(</span><span class="ident" id="4454133">bits</span>&nbsp;<span class="op" id="4454138">&gt;&gt;</span>&nbsp;<span class="num" id="4454141">52</span><span class="op" id="4454143">)</span>&nbsp;<span class="op" id="4454145">&amp;</span>&nbsp;<span class="ident" id="4454147">expMask</span><span class="op" id="4454154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454157">switch</span>&nbsp;<span class="ident" id="4454164">exp</span>&nbsp;<span class="op" id="4454168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454171">case</span>&nbsp;<span class="ident" id="4454176">expMask</span><span class="op" id="4454183">:</span>&nbsp;<span class="comment" id="4454185">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454201">return</span>&nbsp;<span class="ident" id="4454208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454213">case</span>&nbsp;<span class="num" id="4454218">0</span><span class="op" id="4454219">:</span>&nbsp;<span class="comment" id="4454221">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454235">exp</span>&nbsp;<span class="op" id="4454239">-=</span>&nbsp;<span class="num" id="4454242">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454248">default</span><span class="op" id="4454255">:</span>&nbsp;<span class="comment" id="4454257">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454269">mantissa</span>&nbsp;<span class="op" id="4454278">|=</span>&nbsp;<span class="num" id="4454281">1</span>&nbsp;<span class="op" id="4454283">&lt;&lt;</span>&nbsp;<span class="num" id="4454286">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454291">exp</span>&nbsp;<span class="op" id="4454295">-=</span>&nbsp;<span class="num" id="4454298">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454308">shift</span>&nbsp;<span class="op" id="4454314">:=</span>&nbsp;<span class="num" id="4454317">52</span>&nbsp;<span class="op" id="4454320">-</span>&nbsp;<span class="ident" id="4454322">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454328">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454375">for</span>&nbsp;<span class="ident" id="4454379">mantissa</span><span class="op" id="4454387">&amp;</span><span class="num" id="4454388">1</span>&nbsp;<span class="op" id="4454390">==</span>&nbsp;<span class="num" id="4454393">0</span>&nbsp;<span class="op" id="4454395">&amp;&amp;</span>&nbsp;<span class="ident" id="4454398">shift</span>&nbsp;<span class="op" id="4454404">&gt;</span>&nbsp;<span class="num" id="4454406">0</span>&nbsp;<span class="op" id="4454408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454412">mantissa</span>&nbsp;<span class="op" id="4454421">&gt;&gt;=</span>&nbsp;<span class="num" id="4454425">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454429">shift</span><span class="op" id="4454434">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454438">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454442">z</span><span class="op" id="4454443">.</span><span class="ident" id="4454444">a</span><span class="op" id="4454445">.</span><span class="ident" id="4454446">SetUint64</span><span class="op" id="4454455">(</span><span class="ident" id="4454456">mantissa</span><span class="op" id="4454464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454467">z</span><span class="op" id="4454468">.</span><span class="ident" id="4454469">a</span><span class="op" id="4454470">.</span><span class="ident" id="4454471">neg</span>&nbsp;<span class="op" id="4454475">=</span>&nbsp;<span class="ident" id="4454477">f</span>&nbsp;<span class="op" id="4454479">&lt;</span>&nbsp;<span class="num" id="4454481">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454484">z</span><span class="op" id="4454485">.</span><span class="ident" id="4454486">b</span><span class="op" id="4454487">.</span><span class="ident" id="4454488">Set</span><span class="op" id="4454491">(</span><span class="ident" id="4454492">intOne</span><span class="op" id="4454498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454501">if</span>&nbsp;<span class="ident" id="4454504">shift</span>&nbsp;<span class="op" id="4454510">&gt;</span>&nbsp;<span class="num" id="4454512">0</span>&nbsp;<span class="op" id="4454514">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454518">z</span><span class="op" id="4454519">.</span><span class="ident" id="4454520">b</span><span class="op" id="4454521">.</span><span class="ident" id="4454522">Lsh</span><span class="op" id="4454525">(</span><span class="op" id="4454526">&amp;</span><span class="ident" id="4454527">z</span><span class="op" id="4454528">.</span><span class="ident" id="4454529">b</span><span class="op" id="4454530">,</span>&nbsp;<span class="builtintype" id="4454532">uint</span><span class="op" id="4454536">(</span><span class="ident" id="4454537">shift</span><span class="op" id="4454542">)</span><span class="op" id="4454543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454546">}</span>&nbsp;<span class="keyword" id="4454548">else</span>&nbsp;<span class="op" id="4454553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454557">z</span><span class="op" id="4454558">.</span><span class="ident" id="4454559">a</span><span class="op" id="4454560">.</span><span class="ident" id="4454561">Lsh</span><span class="op" id="4454564">(</span><span class="op" id="4454565">&amp;</span><span class="ident" id="4454566">z</span><span class="op" id="4454567">.</span><span class="ident" id="4454568">a</span><span class="op" id="4454569">,</span>&nbsp;<span class="builtintype" id="4454571">uint</span><span class="op" id="4454575">(</span><span class="op" id="4454576">-</span><span class="ident" id="4454577">shift</span><span class="op" id="4454582">)</span><span class="op" id="4454583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454589">return</span>&nbsp;<span class="ident" id="4454596">z</span><span class="op" id="4454597">.</span><span class="ident" id="4454598">norm</span><span class="op" id="4454602">(</span><span class="op" id="4454603">)</span><br>
<span class="lineno">65</span><span class="op" id="4454605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4454608">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4454664">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4454719">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="4454772">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4454837">func</span>&nbsp;<span class="ident" id="4454842">quotToFloat32</span><span class="op" id="4454855">(</span><span class="ident" id="4454856">a</span><span class="op" id="4454857">,</span>&nbsp;<span class="ident" id="4454859">b</span>&nbsp;<span class="ident" id="4454861">nat</span><span class="op" id="4454864">)</span>&nbsp;<span class="op" id="4454866">(</span><span class="ident" id="4454867">f</span>&nbsp;<span class="builtintype" id="4454869">float32</span><span class="op" id="4454876">,</span>&nbsp;<span class="ident" id="4454878">exact</span>&nbsp;<span class="builtintype" id="4454884">bool</span><span class="op" id="4454888">)</span>&nbsp;<span class="op" id="4454890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454893">const</span>&nbsp;<span class="op" id="4454899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454903">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454927">Fsize</span>&nbsp;<span class="op" id="4454933">=</span>&nbsp;<span class="num" id="4454935">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454941">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454955">Msize</span>&nbsp;&nbsp;<span class="op" id="4454962">=</span>&nbsp;<span class="num" id="4454964">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454969">Msize1</span>&nbsp;<span class="op" id="4454976">=</span>&nbsp;<span class="ident" id="4454978">Msize</span>&nbsp;<span class="op" id="4454984">+</span>&nbsp;<span class="num" id="4454986">1</span>&nbsp;<span class="comment" id="4454988">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455010">Msize2</span>&nbsp;<span class="op" id="4455017">=</span>&nbsp;<span class="ident" id="4455019">Msize1</span>&nbsp;<span class="op" id="4455026">+</span>&nbsp;<span class="num" id="4455028">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455033">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455047">Esize</span>&nbsp;<span class="op" id="4455053">=</span>&nbsp;<span class="ident" id="4455055">Fsize</span>&nbsp;<span class="op" id="4455061">-</span>&nbsp;<span class="ident" id="4455063">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455072">Ebias</span>&nbsp;<span class="op" id="4455078">=</span>&nbsp;<span class="num" id="4455080">1</span><span class="op" id="4455081">&lt;&lt;</span><span class="op" id="4455083">(</span><span class="ident" id="4455084">Esize</span><span class="op" id="4455089">-</span><span class="num" id="4455090">1</span><span class="op" id="4455091">)</span>&nbsp;<span class="op" id="4455093">-</span>&nbsp;<span class="num" id="4455095">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455099">Emin</span>&nbsp;&nbsp;<span class="op" id="4455105">=</span>&nbsp;<span class="num" id="4455107">1</span>&nbsp;<span class="op" id="4455109">-</span>&nbsp;<span class="ident" id="4455111">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455119">Emax</span>&nbsp;&nbsp;<span class="op" id="4455125">=</span>&nbsp;<span class="ident" id="4455127">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455138">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455209">alen</span>&nbsp;<span class="op" id="4455214">:=</span>&nbsp;<span class="ident" id="4455217">a</span><span class="op" id="4455218">.</span><span class="ident" id="4455219">bitLen</span><span class="op" id="4455225">(</span><span class="op" id="4455226">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455229">if</span>&nbsp;<span class="ident" id="4455232">alen</span>&nbsp;<span class="op" id="4455237">==</span>&nbsp;<span class="num" id="4455240">0</span>&nbsp;<span class="op" id="4455242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455246">return</span>&nbsp;<span class="num" id="4455253">0</span><span class="op" id="4455254">,</span>&nbsp;<span class="builtintype" id="4455256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455265">blen</span>&nbsp;<span class="op" id="4455270">:=</span>&nbsp;<span class="ident" id="4455273">b</span><span class="op" id="4455274">.</span><span class="ident" id="4455275">bitLen</span><span class="op" id="4455281">(</span><span class="op" id="4455282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455285">if</span>&nbsp;<span class="ident" id="4455288">blen</span>&nbsp;<span class="op" id="4455293">==</span>&nbsp;<span class="num" id="4455296">0</span>&nbsp;<span class="op" id="4455298">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4455302">panic</span><span class="op" id="4455307">(</span><span class="string" id="4455308">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4455326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455333">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455413">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455493">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455565">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455627">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455689">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455756">exp</span>&nbsp;<span class="op" id="4455760">:=</span>&nbsp;<span class="ident" id="4455763">alen</span>&nbsp;<span class="op" id="4455768">-</span>&nbsp;<span class="ident" id="4455770">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455776">var</span>&nbsp;<span class="ident" id="4455780">a2</span><span class="op" id="4455782">,</span>&nbsp;<span class="ident" id="4455784">b2</span>&nbsp;<span class="ident" id="4455787">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455792">a2</span>&nbsp;<span class="op" id="4455795">=</span>&nbsp;<span class="ident" id="4455797">a2</span><span class="op" id="4455799">.</span><span class="ident" id="4455800">set</span><span class="op" id="4455803">(</span><span class="ident" id="4455804">a</span><span class="op" id="4455805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455808">b2</span>&nbsp;<span class="op" id="4455811">=</span>&nbsp;<span class="ident" id="4455813">b2</span><span class="op" id="4455815">.</span><span class="ident" id="4455816">set</span><span class="op" id="4455819">(</span><span class="ident" id="4455820">b</span><span class="op" id="4455821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455824">if</span>&nbsp;<span class="ident" id="4455827">shift</span>&nbsp;<span class="op" id="4455833">:=</span>&nbsp;<span class="ident" id="4455836">Msize2</span>&nbsp;<span class="op" id="4455843">-</span>&nbsp;<span class="ident" id="4455845">exp</span><span class="op" id="4455848">;</span>&nbsp;<span class="ident" id="4455850">shift</span>&nbsp;<span class="op" id="4455856">&gt;</span>&nbsp;<span class="num" id="4455858">0</span>&nbsp;<span class="op" id="4455860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455864">a2</span>&nbsp;<span class="op" id="4455867">=</span>&nbsp;<span class="ident" id="4455869">a2</span><span class="op" id="4455871">.</span><span class="ident" id="4455872">shl</span><span class="op" id="4455875">(</span><span class="ident" id="4455876">a2</span><span class="op" id="4455878">,</span>&nbsp;<span class="builtintype" id="4455880">uint</span><span class="op" id="4455884">(</span><span class="ident" id="4455885">shift</span><span class="op" id="4455890">)</span><span class="op" id="4455891">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455894">}</span>&nbsp;<span class="keyword" id="4455896">else</span>&nbsp;<span class="keyword" id="4455901">if</span>&nbsp;<span class="ident" id="4455904">shift</span>&nbsp;<span class="op" id="4455910">&lt;</span>&nbsp;<span class="num" id="4455912">0</span>&nbsp;<span class="op" id="4455914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455918">b2</span>&nbsp;<span class="op" id="4455921">=</span>&nbsp;<span class="ident" id="4455923">b2</span><span class="op" id="4455925">.</span><span class="ident" id="4455926">shl</span><span class="op" id="4455929">(</span><span class="ident" id="4455930">b2</span><span class="op" id="4455932">,</span>&nbsp;<span class="builtintype" id="4455934">uint</span><span class="op" id="4455938">(</span><span class="op" id="4455939">-</span><span class="ident" id="4455940">shift</span><span class="op" id="4455945">)</span><span class="op" id="4455946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4455953">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456015">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456072">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456097">var</span>&nbsp;<span class="ident" id="4456101">q</span>&nbsp;<span class="ident" id="4456103">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456108">q</span><span class="op" id="4456109">,</span>&nbsp;<span class="ident" id="4456111">r</span>&nbsp;<span class="op" id="4456113">:=</span>&nbsp;<span class="ident" id="4456116">q</span><span class="op" id="4456117">.</span><span class="ident" id="4456118">div</span><span class="op" id="4456121">(</span><span class="ident" id="4456122">a2</span><span class="op" id="4456124">,</span>&nbsp;<span class="ident" id="4456126">a2</span><span class="op" id="4456128">,</span>&nbsp;<span class="ident" id="4456130">b2</span><span class="op" id="4456132">)</span>&nbsp;<span class="comment" id="4456134">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456151">mantissa</span>&nbsp;<span class="op" id="4456160">:=</span>&nbsp;<span class="ident" id="4456163">low32</span><span class="op" id="4456168">(</span><span class="ident" id="4456169">q</span><span class="op" id="4456170">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456173">haveRem</span>&nbsp;<span class="op" id="4456181">:=</span>&nbsp;<span class="builtinfunc" id="4456184">len</span><span class="op" id="4456187">(</span><span class="ident" id="4456188">r</span><span class="op" id="4456189">)</span>&nbsp;<span class="op" id="4456191">&gt;</span>&nbsp;<span class="num" id="4456193">0</span>&nbsp;<span class="comment" id="4456195">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456252">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456321">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456373">if</span>&nbsp;<span class="ident" id="4456376">mantissa</span><span class="op" id="4456384">&gt;&gt;</span><span class="ident" id="4456386">Msize2</span>&nbsp;<span class="op" id="4456393">==</span>&nbsp;<span class="num" id="4456396">1</span>&nbsp;<span class="op" id="4456398">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456402">if</span>&nbsp;<span class="ident" id="4456405">mantissa</span><span class="op" id="4456413">&amp;</span><span class="num" id="4456414">1</span>&nbsp;<span class="op" id="4456416">==</span>&nbsp;<span class="num" id="4456419">1</span>&nbsp;<span class="op" id="4456421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456426">haveRem</span>&nbsp;<span class="op" id="4456434">=</span>&nbsp;<span class="builtintype" id="4456436">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456447">mantissa</span>&nbsp;<span class="op" id="4456456">&gt;&gt;=</span>&nbsp;<span class="num" id="4456460">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456464">exp</span><span class="op" id="4456467">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456474">if</span>&nbsp;<span class="ident" id="4456477">mantissa</span><span class="op" id="4456485">&gt;&gt;</span><span class="ident" id="4456487">Msize1</span>&nbsp;<span class="op" id="4456494">!=</span>&nbsp;<span class="num" id="4456497">1</span>&nbsp;<span class="op" id="4456499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4456503">panic</span><span class="op" id="4456508">(</span><span class="ident" id="4456509">fmt</span><span class="op" id="4456512">.</span><span class="ident" id="4456513">Sprintf</span><span class="op" id="4456520">(</span><span class="string" id="4456521">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4456557">,</span>&nbsp;<span class="ident" id="4456559">Msize2</span><span class="op" id="4456565">)</span><span class="op" id="4456566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456573">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456590">if</span>&nbsp;<span class="ident" id="4456593">Emin</span><span class="op" id="4456597">-</span><span class="ident" id="4456598">Msize</span>&nbsp;<span class="op" id="4456604">&lt;=</span>&nbsp;<span class="ident" id="4456607">exp</span>&nbsp;<span class="op" id="4456611">&amp;&amp;</span>&nbsp;<span class="ident" id="4456614">exp</span>&nbsp;<span class="op" id="4456618">&lt;=</span>&nbsp;<span class="ident" id="4456621">Emin</span>&nbsp;<span class="op" id="4456626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456630">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456682">shift</span>&nbsp;<span class="op" id="4456688">:=</span>&nbsp;<span class="builtintype" id="4456691">uint</span><span class="op" id="4456695">(</span><span class="ident" id="4456696">Emin</span>&nbsp;<span class="op" id="4456701">-</span>&nbsp;<span class="op" id="4456703">(</span><span class="ident" id="4456704">exp</span>&nbsp;<span class="op" id="4456708">-</span>&nbsp;<span class="num" id="4456710">1</span><span class="op" id="4456711">)</span><span class="op" id="4456712">)</span>&nbsp;<span class="comment" id="4456714">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456731">lostbits</span>&nbsp;<span class="op" id="4456740">:=</span>&nbsp;<span class="ident" id="4456743">mantissa</span>&nbsp;<span class="op" id="4456752">&amp;</span>&nbsp;<span class="op" id="4456754">(</span><span class="num" id="4456755">1</span><span class="op" id="4456756">&lt;&lt;</span><span class="ident" id="4456758">shift</span>&nbsp;<span class="op" id="4456764">-</span>&nbsp;<span class="num" id="4456766">1</span><span class="op" id="4456767">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456771">haveRem</span>&nbsp;<span class="op" id="4456779">=</span>&nbsp;<span class="ident" id="4456781">haveRem</span>&nbsp;<span class="op" id="4456789">||</span>&nbsp;<span class="ident" id="4456792">lostbits</span>&nbsp;<span class="op" id="4456801">!=</span>&nbsp;<span class="num" id="4456804">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456808">mantissa</span>&nbsp;<span class="op" id="4456817">&gt;&gt;=</span>&nbsp;<span class="ident" id="4456821">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456829">exp</span>&nbsp;<span class="op" id="4456833">=</span>&nbsp;<span class="num" id="4456835">2</span>&nbsp;<span class="op" id="4456837">-</span>&nbsp;<span class="ident" id="4456839">Ebias</span>&nbsp;<span class="comment" id="4456845">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456867">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456905">exact</span>&nbsp;<span class="op" id="4456911">=</span>&nbsp;<span class="op" id="4456913">!</span><span class="ident" id="4456914">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456923">if</span>&nbsp;<span class="ident" id="4456926">mantissa</span><span class="op" id="4456934">&amp;</span><span class="num" id="4456935">1</span>&nbsp;<span class="op" id="4456937">!=</span>&nbsp;<span class="num" id="4456940">0</span>&nbsp;<span class="op" id="4456942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456946">exact</span>&nbsp;<span class="op" id="4456952">=</span>&nbsp;<span class="builtintype" id="4456954">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456962">if</span>&nbsp;<span class="ident" id="4456965">haveRem</span>&nbsp;<span class="op" id="4456973">||</span>&nbsp;<span class="ident" id="4456976">mantissa</span><span class="op" id="4456984">&amp;</span><span class="num" id="4456985">2</span>&nbsp;<span class="op" id="4456987">!=</span>&nbsp;<span class="num" id="4456990">0</span>&nbsp;<span class="op" id="4456992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456997">if</span>&nbsp;<span class="ident" id="4457000">mantissa</span><span class="op" id="4457008">++</span><span class="op" id="4457010">;</span>&nbsp;<span class="ident" id="4457012">mantissa</span>&nbsp;<span class="op" id="4457021">&gt;=</span>&nbsp;<span class="num" id="4457024">1</span><span class="op" id="4457025">&lt;&lt;</span><span class="ident" id="4457027">Msize2</span>&nbsp;<span class="op" id="4457034">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457040">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457101">mantissa</span>&nbsp;<span class="op" id="4457110">&gt;&gt;=</span>&nbsp;<span class="num" id="4457114">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457120">exp</span><span class="op" id="4457123">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457133">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457139">mantissa</span>&nbsp;<span class="op" id="4457148">&gt;&gt;=</span>&nbsp;<span class="num" id="4457152">1</span>&nbsp;<span class="comment" id="4457154">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457216">f</span>&nbsp;<span class="op" id="4457218">=</span>&nbsp;<span class="builtintype" id="4457220">float32</span><span class="op" id="4457227">(</span><span class="ident" id="4457228">math</span><span class="op" id="4457232">.</span><span class="ident" id="4457233">Ldexp</span><span class="op" id="4457238">(</span><span class="builtintype" id="4457239">float64</span><span class="op" id="4457246">(</span><span class="ident" id="4457247">mantissa</span><span class="op" id="4457255">)</span><span class="op" id="4457256">,</span>&nbsp;<span class="ident" id="4457258">exp</span><span class="op" id="4457261">-</span><span class="ident" id="4457262">Msize1</span><span class="op" id="4457268">)</span><span class="op" id="4457269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457272">if</span>&nbsp;<span class="ident" id="4457275">math</span><span class="op" id="4457279">.</span><span class="ident" id="4457280">IsInf</span><span class="op" id="4457285">(</span><span class="builtintype" id="4457286">float64</span><span class="op" id="4457293">(</span><span class="ident" id="4457294">f</span><span class="op" id="4457295">)</span><span class="op" id="4457296">,</span>&nbsp;<span class="num" id="4457298">0</span><span class="op" id="4457299">)</span>&nbsp;<span class="op" id="4457301">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457305">exact</span>&nbsp;<span class="op" id="4457311">=</span>&nbsp;<span class="builtintype" id="4457313">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457323">return</span><br>
<span class="lineno"></span><span class="op" id="4457330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4457333">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4457389">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4457444">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="4457497">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4457562">func</span>&nbsp;<span class="ident" id="4457567">quotToFloat64</span><span class="op" id="4457580">(</span><span class="ident" id="4457581">a</span><span class="op" id="4457582">,</span>&nbsp;<span class="ident" id="4457584">b</span>&nbsp;<span class="ident" id="4457586">nat</span><span class="op" id="4457589">)</span>&nbsp;<span class="op" id="4457591">(</span><span class="ident" id="4457592">f</span>&nbsp;<span class="builtintype" id="4457594">float64</span><span class="op" id="4457601">,</span>&nbsp;<span class="ident" id="4457603">exact</span>&nbsp;<span class="builtintype" id="4457609">bool</span><span class="op" id="4457613">)</span>&nbsp;<span class="op" id="4457615">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457618">const</span>&nbsp;<span class="op" id="4457624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457628">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457652">Fsize</span>&nbsp;<span class="op" id="4457658">=</span>&nbsp;<span class="num" id="4457660">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457666">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457680">Msize</span>&nbsp;&nbsp;<span class="op" id="4457687">=</span>&nbsp;<span class="num" id="4457689">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457694">Msize1</span>&nbsp;<span class="op" id="4457701">=</span>&nbsp;<span class="ident" id="4457703">Msize</span>&nbsp;<span class="op" id="4457709">+</span>&nbsp;<span class="num" id="4457711">1</span>&nbsp;<span class="comment" id="4457713">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457735">Msize2</span>&nbsp;<span class="op" id="4457742">=</span>&nbsp;<span class="ident" id="4457744">Msize1</span>&nbsp;<span class="op" id="4457751">+</span>&nbsp;<span class="num" id="4457753">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457758">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457772">Esize</span>&nbsp;<span class="op" id="4457778">=</span>&nbsp;<span class="ident" id="4457780">Fsize</span>&nbsp;<span class="op" id="4457786">-</span>&nbsp;<span class="ident" id="4457788">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457797">Ebias</span>&nbsp;<span class="op" id="4457803">=</span>&nbsp;<span class="num" id="4457805">1</span><span class="op" id="4457806">&lt;&lt;</span><span class="op" id="4457808">(</span><span class="ident" id="4457809">Esize</span><span class="op" id="4457814">-</span><span class="num" id="4457815">1</span><span class="op" id="4457816">)</span>&nbsp;<span class="op" id="4457818">-</span>&nbsp;<span class="num" id="4457820">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457824">Emin</span>&nbsp;&nbsp;<span class="op" id="4457830">=</span>&nbsp;<span class="num" id="4457832">1</span>&nbsp;<span class="op" id="4457834">-</span>&nbsp;<span class="ident" id="4457836">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457844">Emax</span>&nbsp;&nbsp;<span class="op" id="4457850">=</span>&nbsp;<span class="ident" id="4457852">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457859">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457863">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457934">alen</span>&nbsp;<span class="op" id="4457939">:=</span>&nbsp;<span class="ident" id="4457942">a</span><span class="op" id="4457943">.</span><span class="ident" id="4457944">bitLen</span><span class="op" id="4457950">(</span><span class="op" id="4457951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457954">if</span>&nbsp;<span class="ident" id="4457957">alen</span>&nbsp;<span class="op" id="4457962">==</span>&nbsp;<span class="num" id="4457965">0</span>&nbsp;<span class="op" id="4457967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457971">return</span>&nbsp;<span class="num" id="4457978">0</span><span class="op" id="4457979">,</span>&nbsp;<span class="builtintype" id="4457981">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457990">blen</span>&nbsp;<span class="op" id="4457995">:=</span>&nbsp;<span class="ident" id="4457998">b</span><span class="op" id="4457999">.</span><span class="ident" id="4458000">bitLen</span><span class="op" id="4458006">(</span><span class="op" id="4458007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458010">if</span>&nbsp;<span class="ident" id="4458013">blen</span>&nbsp;<span class="op" id="4458018">==</span>&nbsp;<span class="num" id="4458021">0</span>&nbsp;<span class="op" id="4458023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4458027">panic</span><span class="op" id="4458032">(</span><span class="string" id="4458033">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4458051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458054">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458058">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458138">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458218">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458290">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458352">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458414">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458481">exp</span>&nbsp;<span class="op" id="4458485">:=</span>&nbsp;<span class="ident" id="4458488">alen</span>&nbsp;<span class="op" id="4458493">-</span>&nbsp;<span class="ident" id="4458495">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458501">var</span>&nbsp;<span class="ident" id="4458505">a2</span><span class="op" id="4458507">,</span>&nbsp;<span class="ident" id="4458509">b2</span>&nbsp;<span class="ident" id="4458512">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458517">a2</span>&nbsp;<span class="op" id="4458520">=</span>&nbsp;<span class="ident" id="4458522">a2</span><span class="op" id="4458524">.</span><span class="ident" id="4458525">set</span><span class="op" id="4458528">(</span><span class="ident" id="4458529">a</span><span class="op" id="4458530">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458533">b2</span>&nbsp;<span class="op" id="4458536">=</span>&nbsp;<span class="ident" id="4458538">b2</span><span class="op" id="4458540">.</span><span class="ident" id="4458541">set</span><span class="op" id="4458544">(</span><span class="ident" id="4458545">b</span><span class="op" id="4458546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458549">if</span>&nbsp;<span class="ident" id="4458552">shift</span>&nbsp;<span class="op" id="4458558">:=</span>&nbsp;<span class="ident" id="4458561">Msize2</span>&nbsp;<span class="op" id="4458568">-</span>&nbsp;<span class="ident" id="4458570">exp</span><span class="op" id="4458573">;</span>&nbsp;<span class="ident" id="4458575">shift</span>&nbsp;<span class="op" id="4458581">&gt;</span>&nbsp;<span class="num" id="4458583">0</span>&nbsp;<span class="op" id="4458585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458589">a2</span>&nbsp;<span class="op" id="4458592">=</span>&nbsp;<span class="ident" id="4458594">a2</span><span class="op" id="4458596">.</span><span class="ident" id="4458597">shl</span><span class="op" id="4458600">(</span><span class="ident" id="4458601">a2</span><span class="op" id="4458603">,</span>&nbsp;<span class="builtintype" id="4458605">uint</span><span class="op" id="4458609">(</span><span class="ident" id="4458610">shift</span><span class="op" id="4458615">)</span><span class="op" id="4458616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458619">}</span>&nbsp;<span class="keyword" id="4458621">else</span>&nbsp;<span class="keyword" id="4458626">if</span>&nbsp;<span class="ident" id="4458629">shift</span>&nbsp;<span class="op" id="4458635">&lt;</span>&nbsp;<span class="num" id="4458637">0</span>&nbsp;<span class="op" id="4458639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458643">b2</span>&nbsp;<span class="op" id="4458646">=</span>&nbsp;<span class="ident" id="4458648">b2</span><span class="op" id="4458650">.</span><span class="ident" id="4458651">shl</span><span class="op" id="4458654">(</span><span class="ident" id="4458655">b2</span><span class="op" id="4458657">,</span>&nbsp;<span class="builtintype" id="4458659">uint</span><span class="op" id="4458663">(</span><span class="op" id="4458664">-</span><span class="ident" id="4458665">shift</span><span class="op" id="4458670">)</span><span class="op" id="4458671">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4458674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458678">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458740">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458797">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4458822">var</span>&nbsp;<span class="ident" id="4458826">q</span>&nbsp;<span class="ident" id="4458828">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458833">q</span><span class="op" id="4458834">,</span>&nbsp;<span class="ident" id="4458836">r</span>&nbsp;<span class="op" id="4458838">:=</span>&nbsp;<span class="ident" id="4458841">q</span><span class="op" id="4458842">.</span><span class="ident" id="4458843">div</span><span class="op" id="4458846">(</span><span class="ident" id="4458847">a2</span><span class="op" id="4458849">,</span>&nbsp;<span class="ident" id="4458851">a2</span><span class="op" id="4458853">,</span>&nbsp;<span class="ident" id="4458855">b2</span><span class="op" id="4458857">)</span>&nbsp;<span class="comment" id="4458859">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458876">mantissa</span>&nbsp;<span class="op" id="4458885">:=</span>&nbsp;<span class="ident" id="4458888">low64</span><span class="op" id="4458893">(</span><span class="ident" id="4458894">q</span><span class="op" id="4458895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4458898">haveRem</span>&nbsp;<span class="op" id="4458906">:=</span>&nbsp;<span class="builtinfunc" id="4458909">len</span><span class="op" id="4458912">(</span><span class="ident" id="4458913">r</span><span class="op" id="4458914">)</span>&nbsp;<span class="op" id="4458916">&gt;</span>&nbsp;<span class="num" id="4458918">0</span>&nbsp;<span class="comment" id="4458920">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4458977">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459046">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459098">if</span>&nbsp;<span class="ident" id="4459101">mantissa</span><span class="op" id="4459109">&gt;&gt;</span><span class="ident" id="4459111">Msize2</span>&nbsp;<span class="op" id="4459118">==</span>&nbsp;<span class="num" id="4459121">1</span>&nbsp;<span class="op" id="4459123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459127">if</span>&nbsp;<span class="ident" id="4459130">mantissa</span><span class="op" id="4459138">&amp;</span><span class="num" id="4459139">1</span>&nbsp;<span class="op" id="4459141">==</span>&nbsp;<span class="num" id="4459144">1</span>&nbsp;<span class="op" id="4459146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459151">haveRem</span>&nbsp;<span class="op" id="4459159">=</span>&nbsp;<span class="builtintype" id="4459161">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459172">mantissa</span>&nbsp;<span class="op" id="4459181">&gt;&gt;=</span>&nbsp;<span class="num" id="4459185">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459189">exp</span><span class="op" id="4459192">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459199">if</span>&nbsp;<span class="ident" id="4459202">mantissa</span><span class="op" id="4459210">&gt;&gt;</span><span class="ident" id="4459212">Msize1</span>&nbsp;<span class="op" id="4459219">!=</span>&nbsp;<span class="num" id="4459222">1</span>&nbsp;<span class="op" id="4459224">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4459228">panic</span><span class="op" id="4459233">(</span><span class="ident" id="4459234">fmt</span><span class="op" id="4459237">.</span><span class="ident" id="4459238">Sprintf</span><span class="op" id="4459245">(</span><span class="string" id="4459246">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4459282">,</span>&nbsp;<span class="ident" id="4459284">Msize2</span><span class="op" id="4459290">)</span><span class="op" id="4459291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459298">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459315">if</span>&nbsp;<span class="ident" id="4459318">Emin</span><span class="op" id="4459322">-</span><span class="ident" id="4459323">Msize</span>&nbsp;<span class="op" id="4459329">&lt;=</span>&nbsp;<span class="ident" id="4459332">exp</span>&nbsp;<span class="op" id="4459336">&amp;&amp;</span>&nbsp;<span class="ident" id="4459339">exp</span>&nbsp;<span class="op" id="4459343">&lt;=</span>&nbsp;<span class="ident" id="4459346">Emin</span>&nbsp;<span class="op" id="4459351">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459355">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459407">shift</span>&nbsp;<span class="op" id="4459413">:=</span>&nbsp;<span class="builtintype" id="4459416">uint</span><span class="op" id="4459420">(</span><span class="ident" id="4459421">Emin</span>&nbsp;<span class="op" id="4459426">-</span>&nbsp;<span class="op" id="4459428">(</span><span class="ident" id="4459429">exp</span>&nbsp;<span class="op" id="4459433">-</span>&nbsp;<span class="num" id="4459435">1</span><span class="op" id="4459436">)</span><span class="op" id="4459437">)</span>&nbsp;<span class="comment" id="4459439">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459456">lostbits</span>&nbsp;<span class="op" id="4459465">:=</span>&nbsp;<span class="ident" id="4459468">mantissa</span>&nbsp;<span class="op" id="4459477">&amp;</span>&nbsp;<span class="op" id="4459479">(</span><span class="num" id="4459480">1</span><span class="op" id="4459481">&lt;&lt;</span><span class="ident" id="4459483">shift</span>&nbsp;<span class="op" id="4459489">-</span>&nbsp;<span class="num" id="4459491">1</span><span class="op" id="4459492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459496">haveRem</span>&nbsp;<span class="op" id="4459504">=</span>&nbsp;<span class="ident" id="4459506">haveRem</span>&nbsp;<span class="op" id="4459514">||</span>&nbsp;<span class="ident" id="4459517">lostbits</span>&nbsp;<span class="op" id="4459526">!=</span>&nbsp;<span class="num" id="4459529">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459533">mantissa</span>&nbsp;<span class="op" id="4459542">&gt;&gt;=</span>&nbsp;<span class="ident" id="4459546">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459554">exp</span>&nbsp;<span class="op" id="4459558">=</span>&nbsp;<span class="num" id="4459560">2</span>&nbsp;<span class="op" id="4459562">-</span>&nbsp;<span class="ident" id="4459564">Ebias</span>&nbsp;<span class="comment" id="4459570">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459592">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459630">exact</span>&nbsp;<span class="op" id="4459636">=</span>&nbsp;<span class="op" id="4459638">!</span><span class="ident" id="4459639">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459648">if</span>&nbsp;<span class="ident" id="4459651">mantissa</span><span class="op" id="4459659">&amp;</span><span class="num" id="4459660">1</span>&nbsp;<span class="op" id="4459662">!=</span>&nbsp;<span class="num" id="4459665">0</span>&nbsp;<span class="op" id="4459667">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459671">exact</span>&nbsp;<span class="op" id="4459677">=</span>&nbsp;<span class="builtintype" id="4459679">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459687">if</span>&nbsp;<span class="ident" id="4459690">haveRem</span>&nbsp;<span class="op" id="4459698">||</span>&nbsp;<span class="ident" id="4459701">mantissa</span><span class="op" id="4459709">&amp;</span><span class="num" id="4459710">2</span>&nbsp;<span class="op" id="4459712">!=</span>&nbsp;<span class="num" id="4459715">0</span>&nbsp;<span class="op" id="4459717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459722">if</span>&nbsp;<span class="ident" id="4459725">mantissa</span><span class="op" id="4459733">++</span><span class="op" id="4459735">;</span>&nbsp;<span class="ident" id="4459737">mantissa</span>&nbsp;<span class="op" id="4459746">&gt;=</span>&nbsp;<span class="num" id="4459749">1</span><span class="op" id="4459750">&lt;&lt;</span><span class="ident" id="4459752">Msize2</span>&nbsp;<span class="op" id="4459759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4459765">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459826">mantissa</span>&nbsp;<span class="op" id="4459835">&gt;&gt;=</span>&nbsp;<span class="num" id="4459839">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459845">exp</span><span class="op" id="4459848">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4459861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459864">mantissa</span>&nbsp;<span class="op" id="4459873">&gt;&gt;=</span>&nbsp;<span class="num" id="4459877">1</span>&nbsp;<span class="comment" id="4459879">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459941">f</span>&nbsp;<span class="op" id="4459943">=</span>&nbsp;<span class="ident" id="4459945">math</span><span class="op" id="4459949">.</span><span class="ident" id="4459950">Ldexp</span><span class="op" id="4459955">(</span><span class="builtintype" id="4459956">float64</span><span class="op" id="4459963">(</span><span class="ident" id="4459964">mantissa</span><span class="op" id="4459972">)</span><span class="op" id="4459973">,</span>&nbsp;<span class="ident" id="4459975">exp</span><span class="op" id="4459978">-</span><span class="ident" id="4459979">Msize1</span><span class="op" id="4459985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4459988">if</span>&nbsp;<span class="ident" id="4459991">math</span><span class="op" id="4459995">.</span><span class="ident" id="4459996">IsInf</span><span class="op" id="4460001">(</span><span class="ident" id="4460002">f</span><span class="op" id="4460003">,</span>&nbsp;<span class="num" id="4460005">0</span><span class="op" id="4460006">)</span>&nbsp;<span class="op" id="4460008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460012">exact</span>&nbsp;<span class="op" id="4460018">=</span>&nbsp;<span class="builtintype" id="4460020">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460027">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460030">return</span><br>
<span class="lineno"></span><span class="op" id="4460037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4460040">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4460113">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="4460186">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4460255">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4460318">func</span>&nbsp;<span class="op" id="4460323">(</span><span class="ident" id="4460324">x</span>&nbsp;<span class="op" id="4460326">*</span><span class="ident" id="4460327">Rat</span><span class="op" id="4460330">)</span>&nbsp;<span class="ident" id="4460332">Float32</span><span class="op" id="4460339">(</span><span class="op" id="4460340">)</span>&nbsp;<span class="op" id="4460342">(</span><span class="ident" id="4460343">f</span>&nbsp;<span class="builtintype" id="4460345">float32</span><span class="op" id="4460352">,</span>&nbsp;<span class="ident" id="4460354">exact</span>&nbsp;<span class="builtintype" id="4460360">bool</span><span class="op" id="4460364">)</span>&nbsp;<span class="op" id="4460366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460369">b</span>&nbsp;<span class="op" id="4460371">:=</span>&nbsp;<span class="ident" id="4460374">x</span><span class="op" id="4460375">.</span><span class="ident" id="4460376">b</span><span class="op" id="4460377">.</span><span class="ident" id="4460378">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460383">if</span>&nbsp;<span class="builtinfunc" id="4460386">len</span><span class="op" id="4460389">(</span><span class="ident" id="4460390">b</span><span class="op" id="4460391">)</span>&nbsp;<span class="op" id="4460393">==</span>&nbsp;<span class="num" id="4460396">0</span>&nbsp;<span class="op" id="4460398">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460402">b</span>&nbsp;<span class="op" id="4460404">=</span>&nbsp;<span class="ident" id="4460406">b</span><span class="op" id="4460407">.</span><span class="ident" id="4460408">set</span><span class="op" id="4460411">(</span><span class="ident" id="4460412">natOne</span><span class="op" id="4460418">)</span>&nbsp;<span class="comment" id="4460420">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460451">f</span><span class="op" id="4460452">,</span>&nbsp;<span class="ident" id="4460454">exact</span>&nbsp;<span class="op" id="4460460">=</span>&nbsp;<span class="ident" id="4460462">quotToFloat32</span><span class="op" id="4460475">(</span><span class="ident" id="4460476">x</span><span class="op" id="4460477">.</span><span class="ident" id="4460478">a</span><span class="op" id="4460479">.</span><span class="ident" id="4460480">abs</span><span class="op" id="4460483">,</span>&nbsp;<span class="ident" id="4460485">b</span><span class="op" id="4460486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460489">if</span>&nbsp;<span class="ident" id="4460492">x</span><span class="op" id="4460493">.</span><span class="ident" id="4460494">a</span><span class="op" id="4460495">.</span><span class="ident" id="4460496">neg</span>&nbsp;<span class="op" id="4460500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460504">f</span>&nbsp;<span class="op" id="4460506">=</span>&nbsp;<span class="op" id="4460508">-</span><span class="ident" id="4460509">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460515">return</span><br>
<span class="lineno"></span><span class="op" id="4460522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4460525">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="4460598">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4460671">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4460740">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4460803">func</span>&nbsp;<span class="op" id="4460808">(</span><span class="ident" id="4460809">x</span>&nbsp;<span class="op" id="4460811">*</span><span class="ident" id="4460812">Rat</span><span class="op" id="4460815">)</span>&nbsp;<span class="ident" id="4460817">Float64</span><span class="op" id="4460824">(</span><span class="op" id="4460825">)</span>&nbsp;<span class="op" id="4460827">(</span><span class="ident" id="4460828">f</span>&nbsp;<span class="builtintype" id="4460830">float64</span><span class="op" id="4460837">,</span>&nbsp;<span class="ident" id="4460839">exact</span>&nbsp;<span class="builtintype" id="4460845">bool</span><span class="op" id="4460849">)</span>&nbsp;<span class="op" id="4460851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460854">b</span>&nbsp;<span class="op" id="4460856">:=</span>&nbsp;<span class="ident" id="4460859">x</span><span class="op" id="4460860">.</span><span class="ident" id="4460861">b</span><span class="op" id="4460862">.</span><span class="ident" id="4460863">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460868">if</span>&nbsp;<span class="builtinfunc" id="4460871">len</span><span class="op" id="4460874">(</span><span class="ident" id="4460875">b</span><span class="op" id="4460876">)</span>&nbsp;<span class="op" id="4460878">==</span>&nbsp;<span class="num" id="4460881">0</span>&nbsp;<span class="op" id="4460883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460887">b</span>&nbsp;<span class="op" id="4460889">=</span>&nbsp;<span class="ident" id="4460891">b</span><span class="op" id="4460892">.</span><span class="ident" id="4460893">set</span><span class="op" id="4460896">(</span><span class="ident" id="4460897">natOne</span><span class="op" id="4460903">)</span>&nbsp;<span class="comment" id="4460905">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460936">f</span><span class="op" id="4460937">,</span>&nbsp;<span class="ident" id="4460939">exact</span>&nbsp;<span class="op" id="4460945">=</span>&nbsp;<span class="ident" id="4460947">quotToFloat64</span><span class="op" id="4460960">(</span><span class="ident" id="4460961">x</span><span class="op" id="4460962">.</span><span class="ident" id="4460963">a</span><span class="op" id="4460964">.</span><span class="ident" id="4460965">abs</span><span class="op" id="4460968">,</span>&nbsp;<span class="ident" id="4460970">b</span><span class="op" id="4460971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4460974">if</span>&nbsp;<span class="ident" id="4460977">x</span><span class="op" id="4460978">.</span><span class="ident" id="4460979">a</span><span class="op" id="4460980">.</span><span class="ident" id="4460981">neg</span>&nbsp;<span class="op" id="4460985">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460989">f</span>&nbsp;<span class="op" id="4460991">=</span>&nbsp;<span class="op" id="4460993">-</span><span class="ident" id="4460994">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4460997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461000">return</span><br>
<span class="lineno"></span><span class="op" id="4461007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="4461010">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4461050">func</span>&nbsp;<span class="op" id="4461055">(</span><span class="ident" id="4461056">z</span>&nbsp;<span class="op" id="4461058">*</span><span class="ident" id="4461059">Rat</span><span class="op" id="4461062">)</span>&nbsp;<span class="ident" id="4461064">SetFrac</span><span class="op" id="4461071">(</span><span class="ident" id="4461072">a</span><span class="op" id="4461073">,</span>&nbsp;<span class="ident" id="4461075">b</span>&nbsp;<span class="op" id="4461077">*</span><span class="ident" id="4461078">Int</span><span class="op" id="4461081">)</span>&nbsp;<span class="op" id="4461083">*</span><span class="ident" id="4461084">Rat</span>&nbsp;<span class="op" id="4461088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461091">z</span><span class="op" id="4461092">.</span><span class="ident" id="4461093">a</span><span class="op" id="4461094">.</span><span class="ident" id="4461095">neg</span>&nbsp;<span class="op" id="4461099">=</span>&nbsp;<span class="ident" id="4461101">a</span><span class="op" id="4461102">.</span><span class="ident" id="4461103">neg</span>&nbsp;<span class="op" id="4461107">!=</span>&nbsp;<span class="ident" id="4461110">b</span><span class="op" id="4461111">.</span><span class="ident" id="4461112">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461117">babs</span>&nbsp;<span class="op" id="4461122">:=</span>&nbsp;<span class="ident" id="4461125">b</span><span class="op" id="4461126">.</span><span class="ident" id="4461127">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461132">if</span>&nbsp;<span class="builtinfunc" id="4461135">len</span><span class="op" id="4461138">(</span><span class="ident" id="4461139">babs</span><span class="op" id="4461143">)</span>&nbsp;<span class="op" id="4461145">==</span>&nbsp;<span class="num" id="4461148">0</span>&nbsp;<span class="op" id="4461150">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4461154">panic</span><span class="op" id="4461159">(</span><span class="string" id="4461160">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4461178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4461181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461184">if</span>&nbsp;<span class="op" id="4461187">&amp;</span><span class="ident" id="4461188">z</span><span class="op" id="4461189">.</span><span class="ident" id="4461190">a</span>&nbsp;<span class="op" id="4461192">==</span>&nbsp;<span class="ident" id="4461195">b</span>&nbsp;<span class="op" id="4461197">||</span>&nbsp;<span class="ident" id="4461200">alias</span><span class="op" id="4461205">(</span><span class="ident" id="4461206">z</span><span class="op" id="4461207">.</span><span class="ident" id="4461208">a</span><span class="op" id="4461209">.</span><span class="ident" id="4461210">abs</span><span class="op" id="4461213">,</span>&nbsp;<span class="ident" id="4461215">babs</span><span class="op" id="4461219">)</span>&nbsp;<span class="op" id="4461221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461225">babs</span>&nbsp;<span class="op" id="4461230">=</span>&nbsp;<span class="ident" id="4461232">nat</span><span class="op" id="4461235">(</span><span class="ident" id="4461236">nil</span><span class="op" id="4461239">)</span><span class="op" id="4461240">.</span><span class="ident" id="4461241">set</span><span class="op" id="4461244">(</span><span class="ident" id="4461245">babs</span><span class="op" id="4461249">)</span>&nbsp;<span class="comment" id="4461251">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4461267">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461270">z</span><span class="op" id="4461271">.</span><span class="ident" id="4461272">a</span><span class="op" id="4461273">.</span><span class="ident" id="4461274">abs</span>&nbsp;<span class="op" id="4461278">=</span>&nbsp;<span class="ident" id="4461280">z</span><span class="op" id="4461281">.</span><span class="ident" id="4461282">a</span><span class="op" id="4461283">.</span><span class="ident" id="4461284">abs</span><span class="op" id="4461287">.</span><span class="ident" id="4461288">set</span><span class="op" id="4461291">(</span><span class="ident" id="4461292">a</span><span class="op" id="4461293">.</span><span class="ident" id="4461294">abs</span><span class="op" id="4461297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461300">z</span><span class="op" id="4461301">.</span><span class="ident" id="4461302">b</span><span class="op" id="4461303">.</span><span class="ident" id="4461304">abs</span>&nbsp;<span class="op" id="4461308">=</span>&nbsp;<span class="ident" id="4461310">z</span><span class="op" id="4461311">.</span><span class="ident" id="4461312">b</span><span class="op" id="4461313">.</span><span class="ident" id="4461314">abs</span><span class="op" id="4461317">.</span><span class="ident" id="4461318">set</span><span class="op" id="4461321">(</span><span class="ident" id="4461322">babs</span><span class="op" id="4461326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461329">return</span>&nbsp;<span class="ident" id="4461336">z</span><span class="op" id="4461337">.</span><span class="ident" id="4461338">norm</span><span class="op" id="4461342">(</span><span class="op" id="4461343">)</span><br>
<span class="lineno"></span><span class="op" id="4461345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4461348">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4461390">func</span>&nbsp;<span class="op" id="4461395">(</span><span class="ident" id="4461396">z</span>&nbsp;<span class="op" id="4461398">*</span><span class="ident" id="4461399">Rat</span><span class="op" id="4461402">)</span>&nbsp;<span class="ident" id="4461404">SetFrac64</span><span class="op" id="4461413">(</span><span class="ident" id="4461414">a</span><span class="op" id="4461415">,</span>&nbsp;<span class="ident" id="4461417">b</span>&nbsp;<span class="ident" id="4461419">int64</span><span class="op" id="4461424">)</span>&nbsp;<span class="op" id="4461426">*</span><span class="ident" id="4461427">Rat</span>&nbsp;<span class="op" id="4461431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461434">z</span><span class="op" id="4461435">.</span><span class="ident" id="4461436">a</span><span class="op" id="4461437">.</span><span class="ident" id="4461438">SetInt64</span><span class="op" id="4461446">(</span><span class="ident" id="4461447">a</span><span class="op" id="4461448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461451">if</span>&nbsp;<span class="ident" id="4461454">b</span>&nbsp;<span class="op" id="4461456">==</span>&nbsp;<span class="num" id="4461459">0</span>&nbsp;<span class="op" id="4461461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4461465">panic</span><span class="op" id="4461470">(</span><span class="string" id="4461471">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4461489">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4461492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461495">if</span>&nbsp;<span class="ident" id="4461498">b</span>&nbsp;<span class="op" id="4461500">&lt;</span>&nbsp;<span class="num" id="4461502">0</span>&nbsp;<span class="op" id="4461504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461508">b</span>&nbsp;<span class="op" id="4461510">=</span>&nbsp;<span class="op" id="4461512">-</span><span class="ident" id="4461513">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461517">z</span><span class="op" id="4461518">.</span><span class="ident" id="4461519">a</span><span class="op" id="4461520">.</span><span class="ident" id="4461521">neg</span>&nbsp;<span class="op" id="4461525">=</span>&nbsp;<span class="op" id="4461527">!</span><span class="ident" id="4461528">z</span><span class="op" id="4461529">.</span><span class="ident" id="4461530">a</span><span class="op" id="4461531">.</span><span class="ident" id="4461532">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4461537">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461540">z</span><span class="op" id="4461541">.</span><span class="ident" id="4461542">b</span><span class="op" id="4461543">.</span><span class="ident" id="4461544">abs</span>&nbsp;<span class="op" id="4461548">=</span>&nbsp;<span class="ident" id="4461550">z</span><span class="op" id="4461551">.</span><span class="ident" id="4461552">b</span><span class="op" id="4461553">.</span><span class="ident" id="4461554">abs</span><span class="op" id="4461557">.</span><span class="ident" id="4461558">setUint64</span><span class="op" id="4461567">(</span><span class="ident" id="4461568">uint64</span><span class="op" id="4461574">(</span><span class="ident" id="4461575">b</span><span class="op" id="4461576">)</span><span class="op" id="4461577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461580">return</span>&nbsp;<span class="ident" id="4461587">z</span><span class="op" id="4461588">.</span><span class="ident" id="4461589">norm</span><span class="op" id="4461593">(</span><span class="op" id="4461594">)</span><br>
<span class="lineno"></span><span class="op" id="4461596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4461599">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="4461660">func</span>&nbsp;<span class="op" id="4461665">(</span><span class="ident" id="4461666">z</span>&nbsp;<span class="op" id="4461668">*</span><span class="ident" id="4461669">Rat</span><span class="op" id="4461672">)</span>&nbsp;<span class="ident" id="4461674">SetInt</span><span class="op" id="4461680">(</span><span class="ident" id="4461681">x</span>&nbsp;<span class="op" id="4461683">*</span><span class="ident" id="4461684">Int</span><span class="op" id="4461687">)</span>&nbsp;<span class="op" id="4461689">*</span><span class="ident" id="4461690">Rat</span>&nbsp;<span class="op" id="4461694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461697">z</span><span class="op" id="4461698">.</span><span class="ident" id="4461699">a</span><span class="op" id="4461700">.</span><span class="ident" id="4461701">Set</span><span class="op" id="4461704">(</span><span class="ident" id="4461705">x</span><span class="op" id="4461706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461709">z</span><span class="op" id="4461710">.</span><span class="ident" id="4461711">b</span><span class="op" id="4461712">.</span><span class="ident" id="4461713">abs</span>&nbsp;<span class="op" id="4461717">=</span>&nbsp;<span class="ident" id="4461719">z</span><span class="op" id="4461720">.</span><span class="ident" id="4461721">b</span><span class="op" id="4461722">.</span><span class="ident" id="4461723">abs</span><span class="op" id="4461726">.</span><span class="builtinfunc" id="4461727">make</span><span class="op" id="4461731">(</span><span class="num" id="4461732">0</span><span class="op" id="4461733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461736">return</span>&nbsp;<span class="ident" id="4461743">z</span><br>
<span class="lineno"></span><span class="op" id="4461745">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4461748">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4461787">func</span>&nbsp;<span class="op" id="4461792">(</span><span class="ident" id="4461793">z</span>&nbsp;<span class="op" id="4461795">*</span><span class="ident" id="4461796">Rat</span><span class="op" id="4461799">)</span>&nbsp;<span class="ident" id="4461801">SetInt64</span><span class="op" id="4461809">(</span><span class="ident" id="4461810">x</span>&nbsp;<span class="ident" id="4461812">int64</span><span class="op" id="4461817">)</span>&nbsp;<span class="op" id="4461819">*</span><span class="ident" id="4461820">Rat</span>&nbsp;<span class="op" id="4461824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461827">z</span><span class="op" id="4461828">.</span><span class="ident" id="4461829">a</span><span class="op" id="4461830">.</span><span class="ident" id="4461831">SetInt64</span><span class="op" id="4461839">(</span><span class="ident" id="4461840">x</span><span class="op" id="4461841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461844">z</span><span class="op" id="4461845">.</span><span class="ident" id="4461846">b</span><span class="op" id="4461847">.</span><span class="ident" id="4461848">abs</span>&nbsp;<span class="op" id="4461852">=</span>&nbsp;<span class="ident" id="4461854">z</span><span class="op" id="4461855">.</span><span class="ident" id="4461856">b</span><span class="op" id="4461857">.</span><span class="ident" id="4461858">abs</span><span class="op" id="4461861">.</span><span class="builtinfunc" id="4461862">make</span><span class="op" id="4461866">(</span><span class="num" id="4461867">0</span><span class="op" id="4461868">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461871">return</span>&nbsp;<span class="ident" id="4461878">z</span><br>
<span class="lineno"></span><span class="op" id="4461880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4461883">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4461941">func</span>&nbsp;<span class="op" id="4461946">(</span><span class="ident" id="4461947">z</span>&nbsp;<span class="op" id="4461949">*</span><span class="ident" id="4461950">Rat</span><span class="op" id="4461953">)</span>&nbsp;<span class="ident" id="4461955">Set</span><span class="op" id="4461958">(</span><span class="ident" id="4461959">x</span>&nbsp;<span class="op" id="4461961">*</span><span class="ident" id="4461962">Rat</span><span class="op" id="4461965">)</span>&nbsp;<span class="op" id="4461967">*</span><span class="ident" id="4461968">Rat</span>&nbsp;<span class="op" id="4461972">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4461975">if</span>&nbsp;<span class="ident" id="4461978">z</span>&nbsp;<span class="op" id="4461980">!=</span>&nbsp;<span class="ident" id="4461983">x</span>&nbsp;<span class="op" id="4461985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461989">z</span><span class="op" id="4461990">.</span><span class="ident" id="4461991">a</span><span class="op" id="4461992">.</span><span class="ident" id="4461993">Set</span><span class="op" id="4461996">(</span><span class="op" id="4461997">&amp;</span><span class="ident" id="4461998">x</span><span class="op" id="4461999">.</span><span class="ident" id="4462000">a</span><span class="op" id="4462001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462005">z</span><span class="op" id="4462006">.</span><span class="ident" id="4462007">b</span><span class="op" id="4462008">.</span><span class="ident" id="4462009">Set</span><span class="op" id="4462012">(</span><span class="op" id="4462013">&amp;</span><span class="ident" id="4462014">x</span><span class="op" id="4462015">.</span><span class="ident" id="4462016">b</span><span class="op" id="4462017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462023">return</span>&nbsp;<span class="ident" id="4462030">z</span><br>
<span class="lineno">345</span><span class="op" id="4462032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462035">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4462097">func</span>&nbsp;<span class="op" id="4462102">(</span><span class="ident" id="4462103">z</span>&nbsp;<span class="op" id="4462105">*</span><span class="ident" id="4462106">Rat</span><span class="op" id="4462109">)</span>&nbsp;<span class="ident" id="4462111">Abs</span><span class="op" id="4462114">(</span><span class="ident" id="4462115">x</span>&nbsp;<span class="op" id="4462117">*</span><span class="ident" id="4462118">Rat</span><span class="op" id="4462121">)</span>&nbsp;<span class="op" id="4462123">*</span><span class="ident" id="4462124">Rat</span>&nbsp;<span class="op" id="4462128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462131">z</span><span class="op" id="4462132">.</span><span class="ident" id="4462133">Set</span><span class="op" id="4462136">(</span><span class="ident" id="4462137">x</span><span class="op" id="4462138">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462141">z</span><span class="op" id="4462142">.</span><span class="ident" id="4462143">a</span><span class="op" id="4462144">.</span><span class="ident" id="4462145">neg</span>&nbsp;<span class="op" id="4462149">=</span>&nbsp;<span class="builtintype" id="4462151">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462158">return</span>&nbsp;<span class="ident" id="4462165">z</span><br>
<span class="lineno"></span><span class="op" id="4462167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462170">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="4462205">func</span>&nbsp;<span class="op" id="4462210">(</span><span class="ident" id="4462211">z</span>&nbsp;<span class="op" id="4462213">*</span><span class="ident" id="4462214">Rat</span><span class="op" id="4462217">)</span>&nbsp;<span class="ident" id="4462219">Neg</span><span class="op" id="4462222">(</span><span class="ident" id="4462223">x</span>&nbsp;<span class="op" id="4462225">*</span><span class="ident" id="4462226">Rat</span><span class="op" id="4462229">)</span>&nbsp;<span class="op" id="4462231">*</span><span class="ident" id="4462232">Rat</span>&nbsp;<span class="op" id="4462236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462239">z</span><span class="op" id="4462240">.</span><span class="ident" id="4462241">Set</span><span class="op" id="4462244">(</span><span class="ident" id="4462245">x</span><span class="op" id="4462246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462249">z</span><span class="op" id="4462250">.</span><span class="ident" id="4462251">a</span><span class="op" id="4462252">.</span><span class="ident" id="4462253">neg</span>&nbsp;<span class="op" id="4462257">=</span>&nbsp;<span class="builtinfunc" id="4462259">len</span><span class="op" id="4462262">(</span><span class="ident" id="4462263">z</span><span class="op" id="4462264">.</span><span class="ident" id="4462265">a</span><span class="op" id="4462266">.</span><span class="ident" id="4462267">abs</span><span class="op" id="4462270">)</span>&nbsp;<span class="op" id="4462272">&gt;</span>&nbsp;<span class="num" id="4462274">0</span>&nbsp;<span class="op" id="4462276">&amp;&amp;</span>&nbsp;<span class="op" id="4462279">!</span><span class="ident" id="4462280">z</span><span class="op" id="4462281">.</span><span class="ident" id="4462282">a</span><span class="op" id="4462283">.</span><span class="ident" id="4462284">neg</span>&nbsp;<span class="comment" id="4462288">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462306">return</span>&nbsp;<span class="ident" id="4462313">z</span><br>
<span class="lineno"></span><span class="op" id="4462315">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4462318">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4462354">func</span>&nbsp;<span class="op" id="4462359">(</span><span class="ident" id="4462360">z</span>&nbsp;<span class="op" id="4462362">*</span><span class="ident" id="4462363">Rat</span><span class="op" id="4462366">)</span>&nbsp;<span class="ident" id="4462368">Inv</span><span class="op" id="4462371">(</span><span class="ident" id="4462372">x</span>&nbsp;<span class="op" id="4462374">*</span><span class="ident" id="4462375">Rat</span><span class="op" id="4462378">)</span>&nbsp;<span class="op" id="4462380">*</span><span class="ident" id="4462381">Rat</span>&nbsp;<span class="op" id="4462385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462388">if</span>&nbsp;<span class="builtinfunc" id="4462391">len</span><span class="op" id="4462394">(</span><span class="ident" id="4462395">x</span><span class="op" id="4462396">.</span><span class="ident" id="4462397">a</span><span class="op" id="4462398">.</span><span class="ident" id="4462399">abs</span><span class="op" id="4462402">)</span>&nbsp;<span class="op" id="4462404">==</span>&nbsp;<span class="num" id="4462407">0</span>&nbsp;<span class="op" id="4462409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4462413">panic</span><span class="op" id="4462418">(</span><span class="string" id="4462419">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4462437">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462443">z</span><span class="op" id="4462444">.</span><span class="ident" id="4462445">Set</span><span class="op" id="4462448">(</span><span class="ident" id="4462449">x</span><span class="op" id="4462450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462453">a</span>&nbsp;<span class="op" id="4462455">:=</span>&nbsp;<span class="ident" id="4462458">z</span><span class="op" id="4462459">.</span><span class="ident" id="4462460">b</span><span class="op" id="4462461">.</span><span class="ident" id="4462462">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462467">if</span>&nbsp;<span class="builtinfunc" id="4462470">len</span><span class="op" id="4462473">(</span><span class="ident" id="4462474">a</span><span class="op" id="4462475">)</span>&nbsp;<span class="op" id="4462477">==</span>&nbsp;<span class="num" id="4462480">0</span>&nbsp;<span class="op" id="4462482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462486">a</span>&nbsp;<span class="op" id="4462488">=</span>&nbsp;<span class="ident" id="4462490">a</span><span class="op" id="4462491">.</span><span class="ident" id="4462492">set</span><span class="op" id="4462495">(</span><span class="ident" id="4462496">natOne</span><span class="op" id="4462502">)</span>&nbsp;<span class="comment" id="4462504">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462533">b</span>&nbsp;<span class="op" id="4462535">:=</span>&nbsp;<span class="ident" id="4462538">z</span><span class="op" id="4462539">.</span><span class="ident" id="4462540">a</span><span class="op" id="4462541">.</span><span class="ident" id="4462542">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462547">if</span>&nbsp;<span class="ident" id="4462550">b</span><span class="op" id="4462551">.</span><span class="ident" id="4462552">cmp</span><span class="op" id="4462555">(</span><span class="ident" id="4462556">natOne</span><span class="op" id="4462562">)</span>&nbsp;<span class="op" id="4462564">==</span>&nbsp;<span class="num" id="4462567">0</span>&nbsp;<span class="op" id="4462569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462573">b</span>&nbsp;<span class="op" id="4462575">=</span>&nbsp;<span class="ident" id="4462577">b</span><span class="op" id="4462578">.</span><span class="builtinfunc" id="4462579">make</span><span class="op" id="4462583">(</span><span class="num" id="4462584">0</span><span class="op" id="4462585">)</span>&nbsp;<span class="comment" id="4462587">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462613">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462616">z</span><span class="op" id="4462617">.</span><span class="ident" id="4462618">a</span><span class="op" id="4462619">.</span><span class="ident" id="4462620">abs</span><span class="op" id="4462623">,</span>&nbsp;<span class="ident" id="4462625">z</span><span class="op" id="4462626">.</span><span class="ident" id="4462627">b</span><span class="op" id="4462628">.</span><span class="ident" id="4462629">abs</span>&nbsp;<span class="op" id="4462633">=</span>&nbsp;<span class="ident" id="4462635">a</span><span class="op" id="4462636">,</span>&nbsp;<span class="ident" id="4462638">b</span>&nbsp;<span class="comment" id="4462640">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462664">return</span>&nbsp;<span class="ident" id="4462671">z</span><br>
<span class="lineno"></span><span class="op" id="4462673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462676">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="4462693">//</span><br>
<span class="lineno"></span><span class="comment" id="4462696">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4462712">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4462728">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4462744">//</span><br>
<span class="lineno">385</span><span class="keyword" id="4462747">func</span>&nbsp;<span class="op" id="4462752">(</span><span class="ident" id="4462753">x</span>&nbsp;<span class="op" id="4462755">*</span><span class="ident" id="4462756">Rat</span><span class="op" id="4462759">)</span>&nbsp;<span class="ident" id="4462761">Sign</span><span class="op" id="4462765">(</span><span class="op" id="4462766">)</span>&nbsp;<span class="builtintype" id="4462768">int</span>&nbsp;<span class="op" id="4462772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462775">return</span>&nbsp;<span class="ident" id="4462782">x</span><span class="op" id="4462783">.</span><span class="ident" id="4462784">a</span><span class="op" id="4462785">.</span><span class="ident" id="4462786">Sign</span><span class="op" id="4462790">(</span><span class="op" id="4462791">)</span><br>
<span class="lineno"></span><span class="op" id="4462793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462796">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="4462848">func</span>&nbsp;<span class="op" id="4462853">(</span><span class="ident" id="4462854">x</span>&nbsp;<span class="op" id="4462856">*</span><span class="ident" id="4462857">Rat</span><span class="op" id="4462860">)</span>&nbsp;<span class="ident" id="4462862">IsInt</span><span class="op" id="4462867">(</span><span class="op" id="4462868">)</span>&nbsp;<span class="builtintype" id="4462870">bool</span>&nbsp;<span class="op" id="4462875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462878">return</span>&nbsp;<span class="builtinfunc" id="4462885">len</span><span class="op" id="4462888">(</span><span class="ident" id="4462889">x</span><span class="op" id="4462890">.</span><span class="ident" id="4462891">b</span><span class="op" id="4462892">.</span><span class="ident" id="4462893">abs</span><span class="op" id="4462896">)</span>&nbsp;<span class="op" id="4462898">==</span>&nbsp;<span class="num" id="4462901">0</span>&nbsp;<span class="op" id="4462903">||</span>&nbsp;<span class="ident" id="4462906">x</span><span class="op" id="4462907">.</span><span class="ident" id="4462908">b</span><span class="op" id="4462909">.</span><span class="ident" id="4462910">abs</span><span class="op" id="4462913">.</span><span class="ident" id="4462914">cmp</span><span class="op" id="4462917">(</span><span class="ident" id="4462918">natOne</span><span class="op" id="4462924">)</span>&nbsp;<span class="op" id="4462926">==</span>&nbsp;<span class="num" id="4462929">0</span><br>
<span class="lineno"></span><span class="op" id="4462931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462934">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="4462985">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4463035">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="4463098">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4463157">func</span>&nbsp;<span class="op" id="4463162">(</span><span class="ident" id="4463163">x</span>&nbsp;<span class="op" id="4463165">*</span><span class="ident" id="4463166">Rat</span><span class="op" id="4463169">)</span>&nbsp;<span class="ident" id="4463171">Num</span><span class="op" id="4463174">(</span><span class="op" id="4463175">)</span>&nbsp;<span class="op" id="4463177">*</span><span class="ident" id="4463178">Int</span>&nbsp;<span class="op" id="4463182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463185">return</span>&nbsp;<span class="op" id="4463192">&amp;</span><span class="ident" id="4463193">x</span><span class="op" id="4463194">.</span><span class="ident" id="4463195">a</span><br>
<span class="lineno">400</span><span class="op" id="4463197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4463200">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4463257">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4463309">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="4463372">func</span>&nbsp;<span class="op" id="4463377">(</span><span class="ident" id="4463378">x</span>&nbsp;<span class="op" id="4463380">*</span><span class="ident" id="4463381">Rat</span><span class="op" id="4463384">)</span>&nbsp;<span class="ident" id="4463386">Denom</span><span class="op" id="4463391">(</span><span class="op" id="4463392">)</span>&nbsp;<span class="op" id="4463394">*</span><span class="ident" id="4463395">Int</span>&nbsp;<span class="op" id="4463399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463402">x</span><span class="op" id="4463403">.</span><span class="ident" id="4463404">b</span><span class="op" id="4463405">.</span><span class="ident" id="4463406">neg</span>&nbsp;<span class="op" id="4463410">=</span>&nbsp;<span class="builtintype" id="4463412">false</span>&nbsp;<span class="comment" id="4463418">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463448">if</span>&nbsp;<span class="builtinfunc" id="4463451">len</span><span class="op" id="4463454">(</span><span class="ident" id="4463455">x</span><span class="op" id="4463456">.</span><span class="ident" id="4463457">b</span><span class="op" id="4463458">.</span><span class="ident" id="4463459">abs</span><span class="op" id="4463462">)</span>&nbsp;<span class="op" id="4463464">==</span>&nbsp;<span class="num" id="4463467">0</span>&nbsp;<span class="op" id="4463469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463473">x</span><span class="op" id="4463474">.</span><span class="ident" id="4463475">b</span><span class="op" id="4463476">.</span><span class="ident" id="4463477">abs</span>&nbsp;<span class="op" id="4463481">=</span>&nbsp;<span class="ident" id="4463483">x</span><span class="op" id="4463484">.</span><span class="ident" id="4463485">b</span><span class="op" id="4463486">.</span><span class="ident" id="4463487">abs</span><span class="op" id="4463490">.</span><span class="ident" id="4463491">set</span><span class="op" id="4463494">(</span><span class="ident" id="4463495">natOne</span><span class="op" id="4463501">)</span>&nbsp;<span class="comment" id="4463503">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4463531">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463534">return</span>&nbsp;<span class="op" id="4463541">&amp;</span><span class="ident" id="4463542">x</span><span class="op" id="4463543">.</span><span class="ident" id="4463544">b</span><br>
<span class="lineno"></span><span class="op" id="4463546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4463549">func</span>&nbsp;<span class="op" id="4463554">(</span><span class="ident" id="4463555">z</span>&nbsp;<span class="op" id="4463557">*</span><span class="ident" id="4463558">Rat</span><span class="op" id="4463561">)</span>&nbsp;<span class="ident" id="4463563">norm</span><span class="op" id="4463567">(</span><span class="op" id="4463568">)</span>&nbsp;<span class="op" id="4463570">*</span><span class="ident" id="4463571">Rat</span>&nbsp;<span class="op" id="4463575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463578">switch</span>&nbsp;<span class="op" id="4463585">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463588">case</span>&nbsp;<span class="builtinfunc" id="4463593">len</span><span class="op" id="4463596">(</span><span class="ident" id="4463597">z</span><span class="op" id="4463598">.</span><span class="ident" id="4463599">a</span><span class="op" id="4463600">.</span><span class="ident" id="4463601">abs</span><span class="op" id="4463604">)</span>&nbsp;<span class="op" id="4463606">==</span>&nbsp;<span class="num" id="4463609">0</span><span class="op" id="4463610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463614">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463659">z</span><span class="op" id="4463660">.</span><span class="ident" id="4463661">a</span><span class="op" id="4463662">.</span><span class="ident" id="4463663">neg</span>&nbsp;<span class="op" id="4463667">=</span>&nbsp;<span class="builtintype" id="4463669">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463677">z</span><span class="op" id="4463678">.</span><span class="ident" id="4463679">b</span><span class="op" id="4463680">.</span><span class="ident" id="4463681">abs</span>&nbsp;<span class="op" id="4463685">=</span>&nbsp;<span class="ident" id="4463687">z</span><span class="op" id="4463688">.</span><span class="ident" id="4463689">b</span><span class="op" id="4463690">.</span><span class="ident" id="4463691">abs</span><span class="op" id="4463694">.</span><span class="builtinfunc" id="4463695">make</span><span class="op" id="4463699">(</span><span class="num" id="4463700">0</span><span class="op" id="4463701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463704">case</span>&nbsp;<span class="builtinfunc" id="4463709">len</span><span class="op" id="4463712">(</span><span class="ident" id="4463713">z</span><span class="op" id="4463714">.</span><span class="ident" id="4463715">b</span><span class="op" id="4463716">.</span><span class="ident" id="4463717">abs</span><span class="op" id="4463720">)</span>&nbsp;<span class="op" id="4463722">==</span>&nbsp;<span class="num" id="4463725">0</span><span class="op" id="4463726">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463730">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463770">case</span>&nbsp;<span class="ident" id="4463775">z</span><span class="op" id="4463776">.</span><span class="ident" id="4463777">b</span><span class="op" id="4463778">.</span><span class="ident" id="4463779">abs</span><span class="op" id="4463782">.</span><span class="ident" id="4463783">cmp</span><span class="op" id="4463786">(</span><span class="ident" id="4463787">natOne</span><span class="op" id="4463793">)</span>&nbsp;<span class="op" id="4463795">==</span>&nbsp;<span class="num" id="4463798">0</span><span class="op" id="4463799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463803">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463841">z</span><span class="op" id="4463842">.</span><span class="ident" id="4463843">b</span><span class="op" id="4463844">.</span><span class="ident" id="4463845">abs</span>&nbsp;<span class="op" id="4463849">=</span>&nbsp;<span class="ident" id="4463851">z</span><span class="op" id="4463852">.</span><span class="ident" id="4463853">b</span><span class="op" id="4463854">.</span><span class="ident" id="4463855">abs</span><span class="op" id="4463858">.</span><span class="builtinfunc" id="4463859">make</span><span class="op" id="4463863">(</span><span class="num" id="4463864">0</span><span class="op" id="4463865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463868">default</span><span class="op" id="4463875">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463879">neg</span>&nbsp;<span class="op" id="4463883">:=</span>&nbsp;<span class="ident" id="4463886">z</span><span class="op" id="4463887">.</span><span class="ident" id="4463888">a</span><span class="op" id="4463889">.</span><span class="ident" id="4463890">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463896">z</span><span class="op" id="4463897">.</span><span class="ident" id="4463898">a</span><span class="op" id="4463899">.</span><span class="ident" id="4463900">neg</span>&nbsp;<span class="op" id="4463904">=</span>&nbsp;<span class="builtintype" id="4463906">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463914">z</span><span class="op" id="4463915">.</span><span class="ident" id="4463916">b</span><span class="op" id="4463917">.</span><span class="ident" id="4463918">neg</span>&nbsp;<span class="op" id="4463922">=</span>&nbsp;<span class="builtintype" id="4463924">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463932">if</span>&nbsp;<span class="ident" id="4463935">f</span>&nbsp;<span class="op" id="4463937">:=</span>&nbsp;<span class="ident" id="4463940">NewInt</span><span class="op" id="4463946">(</span><span class="num" id="4463947">0</span><span class="op" id="4463948">)</span><span class="op" id="4463949">.</span><span class="ident" id="4463950">binaryGCD</span><span class="op" id="4463959">(</span><span class="op" id="4463960">&amp;</span><span class="ident" id="4463961">z</span><span class="op" id="4463962">.</span><span class="ident" id="4463963">a</span><span class="op" id="4463964">,</span>&nbsp;<span class="op" id="4463966">&amp;</span><span class="ident" id="4463967">z</span><span class="op" id="4463968">.</span><span class="ident" id="4463969">b</span><span class="op" id="4463970">)</span><span class="op" id="4463971">;</span>&nbsp;<span class="ident" id="4463973">f</span><span class="op" id="4463974">.</span><span class="ident" id="4463975">Cmp</span><span class="op" id="4463978">(</span><span class="ident" id="4463979">intOne</span><span class="op" id="4463985">)</span>&nbsp;<span class="op" id="4463987">!=</span>&nbsp;<span class="num" id="4463990">0</span>&nbsp;<span class="op" id="4463992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463997">z</span><span class="op" id="4463998">.</span><span class="ident" id="4463999">a</span><span class="op" id="4464000">.</span><span class="ident" id="4464001">abs</span><span class="op" id="4464004">,</span>&nbsp;<span class="ident" id="4464006">_</span>&nbsp;<span class="op" id="4464008">=</span>&nbsp;<span class="ident" id="4464010">z</span><span class="op" id="4464011">.</span><span class="ident" id="4464012">a</span><span class="op" id="4464013">.</span><span class="ident" id="4464014">abs</span><span class="op" id="4464017">.</span><span class="ident" id="4464018">div</span><span class="op" id="4464021">(</span><span class="ident" id="4464022">nil</span><span class="op" id="4464025">,</span>&nbsp;<span class="ident" id="4464027">z</span><span class="op" id="4464028">.</span><span class="ident" id="4464029">a</span><span class="op" id="4464030">.</span><span class="ident" id="4464031">abs</span><span class="op" id="4464034">,</span>&nbsp;<span class="ident" id="4464036">f</span><span class="op" id="4464037">.</span><span class="ident" id="4464038">abs</span><span class="op" id="4464041">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464046">z</span><span class="op" id="4464047">.</span><span class="ident" id="4464048">b</span><span class="op" id="4464049">.</span><span class="ident" id="4464050">abs</span><span class="op" id="4464053">,</span>&nbsp;<span class="ident" id="4464055">_</span>&nbsp;<span class="op" id="4464057">=</span>&nbsp;<span class="ident" id="4464059">z</span><span class="op" id="4464060">.</span><span class="ident" id="4464061">b</span><span class="op" id="4464062">.</span><span class="ident" id="4464063">abs</span><span class="op" id="4464066">.</span><span class="ident" id="4464067">div</span><span class="op" id="4464070">(</span><span class="ident" id="4464071">nil</span><span class="op" id="4464074">,</span>&nbsp;<span class="ident" id="4464076">z</span><span class="op" id="4464077">.</span><span class="ident" id="4464078">b</span><span class="op" id="4464079">.</span><span class="ident" id="4464080">abs</span><span class="op" id="4464083">,</span>&nbsp;<span class="ident" id="4464085">f</span><span class="op" id="4464086">.</span><span class="ident" id="4464087">abs</span><span class="op" id="4464090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464095">if</span>&nbsp;<span class="ident" id="4464098">z</span><span class="op" id="4464099">.</span><span class="ident" id="4464100">b</span><span class="op" id="4464101">.</span><span class="ident" id="4464102">abs</span><span class="op" id="4464105">.</span><span class="ident" id="4464106">cmp</span><span class="op" id="4464109">(</span><span class="ident" id="4464110">natOne</span><span class="op" id="4464116">)</span>&nbsp;<span class="op" id="4464118">==</span>&nbsp;<span class="num" id="4464121">0</span>&nbsp;<span class="op" id="4464123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4464129">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464169">z</span><span class="op" id="4464170">.</span><span class="ident" id="4464171">b</span><span class="op" id="4464172">.</span><span class="ident" id="4464173">abs</span>&nbsp;<span class="op" id="4464177">=</span>&nbsp;<span class="ident" id="4464179">z</span><span class="op" id="4464180">.</span><span class="ident" id="4464181">b</span><span class="op" id="4464182">.</span><span class="ident" id="4464183">abs</span><span class="op" id="4464186">.</span><span class="builtinfunc" id="4464187">make</span><span class="op" id="4464191">(</span><span class="num" id="4464192">0</span><span class="op" id="4464193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464198">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464206">z</span><span class="op" id="4464207">.</span><span class="ident" id="4464208">a</span><span class="op" id="4464209">.</span><span class="ident" id="4464210">neg</span>&nbsp;<span class="op" id="4464214">=</span>&nbsp;<span class="ident" id="4464216">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464224">return</span>&nbsp;<span class="ident" id="4464231">z</span><br>
<span class="lineno"></span><span class="op" id="4464233">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="4464236">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4464302">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4464368">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4464382">func</span>&nbsp;<span class="ident" id="4464387">mulDenom</span><span class="op" id="4464395">(</span><span class="ident" id="4464396">z</span><span class="op" id="4464397">,</span>&nbsp;<span class="ident" id="4464399">x</span><span class="op" id="4464400">,</span>&nbsp;<span class="ident" id="4464402">y</span>&nbsp;<span class="ident" id="4464404">nat</span><span class="op" id="4464407">)</span>&nbsp;<span class="ident" id="4464409">nat</span>&nbsp;<span class="op" id="4464413">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464416">switch</span>&nbsp;<span class="op" id="4464423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464426">case</span>&nbsp;<span class="builtinfunc" id="4464431">len</span><span class="op" id="4464434">(</span><span class="ident" id="4464435">x</span><span class="op" id="4464436">)</span>&nbsp;<span class="op" id="4464438">==</span>&nbsp;<span class="num" id="4464441">0</span><span class="op" id="4464442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464446">return</span>&nbsp;<span class="ident" id="4464453">z</span><span class="op" id="4464454">.</span><span class="ident" id="4464455">set</span><span class="op" id="4464458">(</span><span class="ident" id="4464459">y</span><span class="op" id="4464460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464463">case</span>&nbsp;<span class="builtinfunc" id="4464468">len</span><span class="op" id="4464471">(</span><span class="ident" id="4464472">y</span><span class="op" id="4464473">)</span>&nbsp;<span class="op" id="4464475">==</span>&nbsp;<span class="num" id="4464478">0</span><span class="op" id="4464479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464483">return</span>&nbsp;<span class="ident" id="4464490">z</span><span class="op" id="4464491">.</span><span class="ident" id="4464492">set</span><span class="op" id="4464495">(</span><span class="ident" id="4464496">x</span><span class="op" id="4464497">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464503">return</span>&nbsp;<span class="ident" id="4464510">z</span><span class="op" id="4464511">.</span><span class="ident" id="4464512">mul</span><span class="op" id="4464515">(</span><span class="ident" id="4464516">x</span><span class="op" id="4464517">,</span>&nbsp;<span class="ident" id="4464519">y</span><span class="op" id="4464520">)</span><br>
<span class="lineno"></span><span class="op" id="4464522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4464525">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="4464553">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4464624">func</span>&nbsp;<span class="ident" id="4464629">scaleDenom</span><span class="op" id="4464639">(</span><span class="ident" id="4464640">x</span>&nbsp;<span class="op" id="4464642">*</span><span class="ident" id="4464643">Int</span><span class="op" id="4464646">,</span>&nbsp;<span class="ident" id="4464648">f</span>&nbsp;<span class="ident" id="4464650">nat</span><span class="op" id="4464653">)</span>&nbsp;<span class="op" id="4464655">*</span><span class="ident" id="4464656">Int</span>&nbsp;<span class="op" id="4464660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464663">var</span>&nbsp;<span class="ident" id="4464667">z</span>&nbsp;<span class="ident" id="4464669">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464674">if</span>&nbsp;<span class="builtinfunc" id="4464677">len</span><span class="op" id="4464680">(</span><span class="ident" id="4464681">f</span><span class="op" id="4464682">)</span>&nbsp;<span class="op" id="4464684">==</span>&nbsp;<span class="num" id="4464687">0</span>&nbsp;<span class="op" id="4464689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464693">return</span>&nbsp;<span class="ident" id="4464700">z</span><span class="op" id="4464701">.</span><span class="ident" id="4464702">Set</span><span class="op" id="4464705">(</span><span class="ident" id="4464706">x</span><span class="op" id="4464707">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464713">z</span><span class="op" id="4464714">.</span><span class="ident" id="4464715">abs</span>&nbsp;<span class="op" id="4464719">=</span>&nbsp;<span class="ident" id="4464721">z</span><span class="op" id="4464722">.</span><span class="ident" id="4464723">abs</span><span class="op" id="4464726">.</span><span class="ident" id="4464727">mul</span><span class="op" id="4464730">(</span><span class="ident" id="4464731">x</span><span class="op" id="4464732">.</span><span class="ident" id="4464733">abs</span><span class="op" id="4464736">,</span>&nbsp;<span class="ident" id="4464738">f</span><span class="op" id="4464739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464742">z</span><span class="op" id="4464743">.</span><span class="ident" id="4464744">neg</span>&nbsp;<span class="op" id="4464748">=</span>&nbsp;<span class="ident" id="4464750">x</span><span class="op" id="4464751">.</span><span class="ident" id="4464752">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464757">return</span>&nbsp;<span class="op" id="4464764">&amp;</span><span class="ident" id="4464765">z</span><br>
<span class="lineno"></span><span class="op" id="4464767">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="4464770">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="4464807">//</span><br>
<span class="lineno"></span><span class="comment" id="4464810">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4464828">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="4464846">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4464864">//</span><br>
<span class="lineno"></span><span class="keyword" id="4464867">func</span>&nbsp;<span class="op" id="4464872">(</span><span class="ident" id="4464873">x</span>&nbsp;<span class="op" id="4464875">*</span><span class="ident" id="4464876">Rat</span><span class="op" id="4464879">)</span>&nbsp;<span class="ident" id="4464881">Cmp</span><span class="op" id="4464884">(</span><span class="ident" id="4464885">y</span>&nbsp;<span class="op" id="4464887">*</span><span class="ident" id="4464888">Rat</span><span class="op" id="4464891">)</span>&nbsp;<span class="builtintype" id="4464893">int</span>&nbsp;<span class="op" id="4464897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464900">return</span>&nbsp;<span class="ident" id="4464907">scaleDenom</span><span class="op" id="4464917">(</span><span class="op" id="4464918">&amp;</span><span class="ident" id="4464919">x</span><span class="op" id="4464920">.</span><span class="ident" id="4464921">a</span><span class="op" id="4464922">,</span>&nbsp;<span class="ident" id="4464924">y</span><span class="op" id="4464925">.</span><span class="ident" id="4464926">b</span><span class="op" id="4464927">.</span><span class="ident" id="4464928">abs</span><span class="op" id="4464931">)</span><span class="op" id="4464932">.</span><span class="ident" id="4464933">Cmp</span><span class="op" id="4464936">(</span><span class="ident" id="4464937">scaleDenom</span><span class="op" id="4464947">(</span><span class="op" id="4464948">&amp;</span><span class="ident" id="4464949">y</span><span class="op" id="4464950">.</span><span class="ident" id="4464951">a</span><span class="op" id="4464952">,</span>&nbsp;<span class="ident" id="4464954">x</span><span class="op" id="4464955">.</span><span class="ident" id="4464956">b</span><span class="op" id="4464957">.</span><span class="ident" id="4464958">abs</span><span class="op" id="4464961">)</span><span class="op" id="4464962">)</span><br>
<span class="lineno"></span><span class="op" id="4464964">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4464967">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4465011">func</span>&nbsp;<span class="op" id="4465016">(</span><span class="ident" id="4465017">z</span>&nbsp;<span class="op" id="4465019">*</span><span class="ident" id="4465020">Rat</span><span class="op" id="4465023">)</span>&nbsp;<span class="ident" id="4465025">Add</span><span class="op" id="4465028">(</span><span class="ident" id="4465029">x</span><span class="op" id="4465030">,</span>&nbsp;<span class="ident" id="4465032">y</span>&nbsp;<span class="op" id="4465034">*</span><span class="ident" id="4465035">Rat</span><span class="op" id="4465038">)</span>&nbsp;<span class="op" id="4465040">*</span><span class="ident" id="4465041">Rat</span>&nbsp;<span class="op" id="4465045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465048">a1</span>&nbsp;<span class="op" id="4465051">:=</span>&nbsp;<span class="ident" id="4465054">scaleDenom</span><span class="op" id="4465064">(</span><span class="op" id="4465065">&amp;</span><span class="ident" id="4465066">x</span><span class="op" id="4465067">.</span><span class="ident" id="4465068">a</span><span class="op" id="4465069">,</span>&nbsp;<span class="ident" id="4465071">y</span><span class="op" id="4465072">.</span><span class="ident" id="4465073">b</span><span class="op" id="4465074">.</span><span class="ident" id="4465075">abs</span><span class="op" id="4465078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465081">a2</span>&nbsp;<span class="op" id="4465084">:=</span>&nbsp;<span class="ident" id="4465087">scaleDenom</span><span class="op" id="4465097">(</span><span class="op" id="4465098">&amp;</span><span class="ident" id="4465099">y</span><span class="op" id="4465100">.</span><span class="ident" id="4465101">a</span><span class="op" id="4465102">,</span>&nbsp;<span class="ident" id="4465104">x</span><span class="op" id="4465105">.</span><span class="ident" id="4465106">b</span><span class="op" id="4465107">.</span><span class="ident" id="4465108">abs</span><span class="op" id="4465111">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465114">z</span><span class="op" id="4465115">.</span><span class="ident" id="4465116">a</span><span class="op" id="4465117">.</span><span class="ident" id="4465118">Add</span><span class="op" id="4465121">(</span><span class="ident" id="4465122">a1</span><span class="op" id="4465124">,</span>&nbsp;<span class="ident" id="4465126">a2</span><span class="op" id="4465128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465131">z</span><span class="op" id="4465132">.</span><span class="ident" id="4465133">b</span><span class="op" id="4465134">.</span><span class="ident" id="4465135">abs</span>&nbsp;<span class="op" id="4465139">=</span>&nbsp;<span class="ident" id="4465141">mulDenom</span><span class="op" id="4465149">(</span><span class="ident" id="4465150">z</span><span class="op" id="4465151">.</span><span class="ident" id="4465152">b</span><span class="op" id="4465153">.</span><span class="ident" id="4465154">abs</span><span class="op" id="4465157">,</span>&nbsp;<span class="ident" id="4465159">x</span><span class="op" id="4465160">.</span><span class="ident" id="4465161">b</span><span class="op" id="4465162">.</span><span class="ident" id="4465163">abs</span><span class="op" id="4465166">,</span>&nbsp;<span class="ident" id="4465168">y</span><span class="op" id="4465169">.</span><span class="ident" id="4465170">b</span><span class="op" id="4465171">.</span><span class="ident" id="4465172">abs</span><span class="op" id="4465175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465178">return</span>&nbsp;<span class="ident" id="4465185">z</span><span class="op" id="4465186">.</span><span class="ident" id="4465187">norm</span><span class="op" id="4465191">(</span><span class="op" id="4465192">)</span><br>
<span class="lineno"></span><span class="op" id="4465194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="4465197">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4465248">func</span>&nbsp;<span class="op" id="4465253">(</span><span class="ident" id="4465254">z</span>&nbsp;<span class="op" id="4465256">*</span><span class="ident" id="4465257">Rat</span><span class="op" id="4465260">)</span>&nbsp;<span class="ident" id="4465262">Sub</span><span class="op" id="4465265">(</span><span class="ident" id="4465266">x</span><span class="op" id="4465267">,</span>&nbsp;<span class="ident" id="4465269">y</span>&nbsp;<span class="op" id="4465271">*</span><span class="ident" id="4465272">Rat</span><span class="op" id="4465275">)</span>&nbsp;<span class="op" id="4465277">*</span><span class="ident" id="4465278">Rat</span>&nbsp;<span class="op" id="4465282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465285">a1</span>&nbsp;<span class="op" id="4465288">:=</span>&nbsp;<span class="ident" id="4465291">scaleDenom</span><span class="op" id="4465301">(</span><span class="op" id="4465302">&amp;</span><span class="ident" id="4465303">x</span><span class="op" id="4465304">.</span><span class="ident" id="4465305">a</span><span class="op" id="4465306">,</span>&nbsp;<span class="ident" id="4465308">y</span><span class="op" id="4465309">.</span><span class="ident" id="4465310">b</span><span class="op" id="4465311">.</span><span class="ident" id="4465312">abs</span><span class="op" id="4465315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465318">a2</span>&nbsp;<span class="op" id="4465321">:=</span>&nbsp;<span class="ident" id="4465324">scaleDenom</span><span class="op" id="4465334">(</span><span class="op" id="4465335">&amp;</span><span class="ident" id="4465336">y</span><span class="op" id="4465337">.</span><span class="ident" id="4465338">a</span><span class="op" id="4465339">,</span>&nbsp;<span class="ident" id="4465341">x</span><span class="op" id="4465342">.</span><span class="ident" id="4465343">b</span><span class="op" id="4465344">.</span><span class="ident" id="4465345">abs</span><span class="op" id="4465348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465351">z</span><span class="op" id="4465352">.</span><span class="ident" id="4465353">a</span><span class="op" id="4465354">.</span><span class="ident" id="4465355">Sub</span><span class="op" id="4465358">(</span><span class="ident" id="4465359">a1</span><span class="op" id="4465361">,</span>&nbsp;<span class="ident" id="4465363">a2</span><span class="op" id="4465365">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465368">z</span><span class="op" id="4465369">.</span><span class="ident" id="4465370">b</span><span class="op" id="4465371">.</span><span class="ident" id="4465372">abs</span>&nbsp;<span class="op" id="4465376">=</span>&nbsp;<span class="ident" id="4465378">mulDenom</span><span class="op" id="4465386">(</span><span class="ident" id="4465387">z</span><span class="op" id="4465388">.</span><span class="ident" id="4465389">b</span><span class="op" id="4465390">.</span><span class="ident" id="4465391">abs</span><span class="op" id="4465394">,</span>&nbsp;<span class="ident" id="4465396">x</span><span class="op" id="4465397">.</span><span class="ident" id="4465398">b</span><span class="op" id="4465399">.</span><span class="ident" id="4465400">abs</span><span class="op" id="4465403">,</span>&nbsp;<span class="ident" id="4465405">y</span><span class="op" id="4465406">.</span><span class="ident" id="4465407">b</span><span class="op" id="4465408">.</span><span class="ident" id="4465409">abs</span><span class="op" id="4465412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465415">return</span>&nbsp;<span class="ident" id="4465422">z</span><span class="op" id="4465423">.</span><span class="ident" id="4465424">norm</span><span class="op" id="4465428">(</span><span class="op" id="4465429">)</span><br>
<span class="lineno"></span><span class="op" id="4465431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4465434">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="4465482">func</span>&nbsp;<span class="op" id="4465487">(</span><span class="ident" id="4465488">z</span>&nbsp;<span class="op" id="4465490">*</span><span class="ident" id="4465491">Rat</span><span class="op" id="4465494">)</span>&nbsp;<span class="ident" id="4465496">Mul</span><span class="op" id="4465499">(</span><span class="ident" id="4465500">x</span><span class="op" id="4465501">,</span>&nbsp;<span class="ident" id="4465503">y</span>&nbsp;<span class="op" id="4465505">*</span><span class="ident" id="4465506">Rat</span><span class="op" id="4465509">)</span>&nbsp;<span class="op" id="4465511">*</span><span class="ident" id="4465512">Rat</span>&nbsp;<span class="op" id="4465516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465519">z</span><span class="op" id="4465520">.</span><span class="ident" id="4465521">a</span><span class="op" id="4465522">.</span><span class="ident" id="4465523">Mul</span><span class="op" id="4465526">(</span><span class="op" id="4465527">&amp;</span><span class="ident" id="4465528">x</span><span class="op" id="4465529">.</span><span class="ident" id="4465530">a</span><span class="op" id="4465531">,</span>&nbsp;<span class="op" id="4465533">&amp;</span><span class="ident" id="4465534">y</span><span class="op" id="4465535">.</span><span class="ident" id="4465536">a</span><span class="op" id="4465537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465540">z</span><span class="op" id="4465541">.</span><span class="ident" id="4465542">b</span><span class="op" id="4465543">.</span><span class="ident" id="4465544">abs</span>&nbsp;<span class="op" id="4465548">=</span>&nbsp;<span class="ident" id="4465550">mulDenom</span><span class="op" id="4465558">(</span><span class="ident" id="4465559">z</span><span class="op" id="4465560">.</span><span class="ident" id="4465561">b</span><span class="op" id="4465562">.</span><span class="ident" id="4465563">abs</span><span class="op" id="4465566">,</span>&nbsp;<span class="ident" id="4465568">x</span><span class="op" id="4465569">.</span><span class="ident" id="4465570">b</span><span class="op" id="4465571">.</span><span class="ident" id="4465572">abs</span><span class="op" id="4465575">,</span>&nbsp;<span class="ident" id="4465577">y</span><span class="op" id="4465578">.</span><span class="ident" id="4465579">b</span><span class="op" id="4465580">.</span><span class="ident" id="4465581">abs</span><span class="op" id="4465584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465587">return</span>&nbsp;<span class="ident" id="4465594">z</span><span class="op" id="4465595">.</span><span class="ident" id="4465596">norm</span><span class="op" id="4465600">(</span><span class="op" id="4465601">)</span><br>
<span class="lineno"></span><span class="op" id="4465603">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="4465606">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4465655">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="4465711">func</span>&nbsp;<span class="op" id="4465716">(</span><span class="ident" id="4465717">z</span>&nbsp;<span class="op" id="4465719">*</span><span class="ident" id="4465720">Rat</span><span class="op" id="4465723">)</span>&nbsp;<span class="ident" id="4465725">Quo</span><span class="op" id="4465728">(</span><span class="ident" id="4465729">x</span><span class="op" id="4465730">,</span>&nbsp;<span class="ident" id="4465732">y</span>&nbsp;<span class="op" id="4465734">*</span><span class="ident" id="4465735">Rat</span><span class="op" id="4465738">)</span>&nbsp;<span class="op" id="4465740">*</span><span class="ident" id="4465741">Rat</span>&nbsp;<span class="op" id="4465745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465748">if</span>&nbsp;<span class="builtinfunc" id="4465751">len</span><span class="op" id="4465754">(</span><span class="ident" id="4465755">y</span><span class="op" id="4465756">.</span><span class="ident" id="4465757">a</span><span class="op" id="4465758">.</span><span class="ident" id="4465759">abs</span><span class="op" id="4465762">)</span>&nbsp;<span class="op" id="4465764">==</span>&nbsp;<span class="num" id="4465767">0</span>&nbsp;<span class="op" id="4465769">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4465773">panic</span><span class="op" id="4465778">(</span><span class="string" id="4465779">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4465797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4465800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465803">a</span>&nbsp;<span class="op" id="4465805">:=</span>&nbsp;<span class="ident" id="4465808">scaleDenom</span><span class="op" id="4465818">(</span><span class="op" id="4465819">&amp;</span><span class="ident" id="4465820">x</span><span class="op" id="4465821">.</span><span class="ident" id="4465822">a</span><span class="op" id="4465823">,</span>&nbsp;<span class="ident" id="4465825">y</span><span class="op" id="4465826">.</span><span class="ident" id="4465827">b</span><span class="op" id="4465828">.</span><span class="ident" id="4465829">abs</span><span class="op" id="4465832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465835">b</span>&nbsp;<span class="op" id="4465837">:=</span>&nbsp;<span class="ident" id="4465840">scaleDenom</span><span class="op" id="4465850">(</span><span class="op" id="4465851">&amp;</span><span class="ident" id="4465852">y</span><span class="op" id="4465853">.</span><span class="ident" id="4465854">a</span><span class="op" id="4465855">,</span>&nbsp;<span class="ident" id="4465857">x</span><span class="op" id="4465858">.</span><span class="ident" id="4465859">b</span><span class="op" id="4465860">.</span><span class="ident" id="4465861">abs</span><span class="op" id="4465864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465867">z</span><span class="op" id="4465868">.</span><span class="ident" id="4465869">a</span><span class="op" id="4465870">.</span><span class="ident" id="4465871">abs</span>&nbsp;<span class="op" id="4465875">=</span>&nbsp;<span class="ident" id="4465877">a</span><span class="op" id="4465878">.</span><span class="ident" id="4465879">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465884">z</span><span class="op" id="4465885">.</span><span class="ident" id="4465886">b</span><span class="op" id="4465887">.</span><span class="ident" id="4465888">abs</span>&nbsp;<span class="op" id="4465892">=</span>&nbsp;<span class="ident" id="4465894">b</span><span class="op" id="4465895">.</span><span class="ident" id="4465896">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465901">z</span><span class="op" id="4465902">.</span><span class="ident" id="4465903">a</span><span class="op" id="4465904">.</span><span class="ident" id="4465905">neg</span>&nbsp;<span class="op" id="4465909">=</span>&nbsp;<span class="ident" id="4465911">a</span><span class="op" id="4465912">.</span><span class="ident" id="4465913">neg</span>&nbsp;<span class="op" id="4465917">!=</span>&nbsp;<span class="ident" id="4465920">b</span><span class="op" id="4465921">.</span><span class="ident" id="4465922">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465927">return</span>&nbsp;<span class="ident" id="4465934">z</span><span class="op" id="4465935">.</span><span class="ident" id="4465936">norm</span><span class="op" id="4465940">(</span><span class="op" id="4465941">)</span><br>
<span class="lineno"></span><span class="op" id="4465943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="4465946">func</span>&nbsp;<span class="ident" id="4465951">ratTok</span><span class="op" id="4465957">(</span><span class="ident" id="4465958">ch</span>&nbsp;<span class="builtintype" id="4465961">rune</span><span class="op" id="4465965">)</span>&nbsp;<span class="builtintype" id="4465967">bool</span>&nbsp;<span class="op" id="4465972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465975">return</span>&nbsp;<span class="ident" id="4465982">strings</span><span class="op" id="4465989">.</span><span class="ident" id="4465990">IndexRune</span><span class="op" id="4465999">(</span><span class="string" id="4466000">&#34;+-/0123456789.eE&#34;</span><span class="op" id="4466018">,</span>&nbsp;<span class="ident" id="4466020">ch</span><span class="op" id="4466022">)</span>&nbsp;<span class="op" id="4466024">&gt;=</span>&nbsp;<span class="num" id="4466027">0</span><br>
<span class="lineno"></span><span class="op" id="4466029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4466032">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="4466101">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="4466171">func</span>&nbsp;<span class="op" id="4466176">(</span><span class="ident" id="4466177">z</span>&nbsp;<span class="op" id="4466179">*</span><span class="ident" id="4466180">Rat</span><span class="op" id="4466183">)</span>&nbsp;<span class="ident" id="4466185">Scan</span><span class="op" id="4466189">(</span><span class="ident" id="4466190">s</span>&nbsp;<span class="ident" id="4466192">fmt</span><span class="op" id="4466195">.</span><span class="ident" id="4466196">ScanState</span><span class="op" id="4466205">,</span>&nbsp;<span class="ident" id="4466207">ch</span>&nbsp;<span class="builtintype" id="4466210">rune</span><span class="op" id="4466214">)</span>&nbsp;<span class="builtintype" id="4466216">error</span>&nbsp;<span class="op" id="4466222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466225">tok</span><span class="op" id="4466228">,</span>&nbsp;<span class="ident" id="4466230">err</span>&nbsp;<span class="op" id="4466234">:=</span>&nbsp;<span class="ident" id="4466237">s</span><span class="op" id="4466238">.</span><span class="ident" id="4466239">Token</span><span class="op" id="4466244">(</span><span class="builtintype" id="4466245">true</span><span class="op" id="4466249">,</span>&nbsp;<span class="ident" id="4466251">ratTok</span><span class="op" id="4466257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466260">if</span>&nbsp;<span class="ident" id="4466263">err</span>&nbsp;<span class="op" id="4466267">!=</span>&nbsp;<span class="ident" id="4466270">nil</span>&nbsp;<span class="op" id="4466274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466278">return</span>&nbsp;<span class="ident" id="4466285">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466293">if</span>&nbsp;<span class="ident" id="4466296">strings</span><span class="op" id="4466303">.</span><span class="ident" id="4466304">IndexRune</span><span class="op" id="4466313">(</span><span class="string" id="4466314">&#34;efgEFGv&#34;</span><span class="op" id="4466323">,</span>&nbsp;<span class="ident" id="4466325">ch</span><span class="op" id="4466327">)</span>&nbsp;<span class="op" id="4466329">&lt;</span>&nbsp;<span class="num" id="4466331">0</span>&nbsp;<span class="op" id="4466333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466337">return</span>&nbsp;<span class="ident" id="4466344">errors</span><span class="op" id="4466350">.</span><span class="ident" id="4466351">New</span><span class="op" id="4466354">(</span><span class="string" id="4466355">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="4466379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466385">if</span>&nbsp;<span class="ident" id="4466388">_</span><span class="op" id="4466389">,</span>&nbsp;<span class="ident" id="4466391">ok</span>&nbsp;<span class="op" id="4466394">:=</span>&nbsp;<span class="ident" id="4466397">z</span><span class="op" id="4466398">.</span><span class="ident" id="4466399">SetString</span><span class="op" id="4466408">(</span><span class="builtintype" id="4466409">string</span><span class="op" id="4466415">(</span><span class="ident" id="4466416">tok</span><span class="op" id="4466419">)</span><span class="op" id="4466420">)</span><span class="op" id="4466421">;</span>&nbsp;<span class="op" id="4466423">!</span><span class="ident" id="4466424">ok</span>&nbsp;<span class="op" id="4466427">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466431">return</span>&nbsp;<span class="ident" id="4466438">errors</span><span class="op" id="4466444">.</span><span class="ident" id="4466445">New</span><span class="op" id="4466448">(</span><span class="string" id="4466449">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="4466475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466481">return</span>&nbsp;<span class="ident" id="4466488">nil</span><br>
<span class="lineno"></span><span class="op" id="4466492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4466495">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4466572">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4466649">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4466726">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4466775">func</span>&nbsp;<span class="op" id="4466780">(</span><span class="ident" id="4466781">z</span>&nbsp;<span class="op" id="4466783">*</span><span class="ident" id="4466784">Rat</span><span class="op" id="4466787">)</span>&nbsp;<span class="ident" id="4466789">SetString</span><span class="op" id="4466798">(</span><span class="ident" id="4466799">s</span>&nbsp;<span class="builtintype" id="4466801">string</span><span class="op" id="4466807">)</span>&nbsp;<span class="op" id="4466809">(</span><span class="op" id="4466810">*</span><span class="ident" id="4466811">Rat</span><span class="op" id="4466814">,</span>&nbsp;<span class="builtintype" id="4466816">bool</span><span class="op" id="4466820">)</span>&nbsp;<span class="op" id="4466822">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466825">if</span>&nbsp;<span class="builtinfunc" id="4466828">len</span><span class="op" id="4466831">(</span><span class="ident" id="4466832">s</span><span class="op" id="4466833">)</span>&nbsp;<span class="op" id="4466835">==</span>&nbsp;<span class="num" id="4466838">0</span>&nbsp;<span class="op" id="4466840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466844">return</span>&nbsp;<span class="ident" id="4466851">nil</span><span class="op" id="4466854">,</span>&nbsp;<span class="builtintype" id="4466856">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4466867">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466892">sep</span>&nbsp;<span class="op" id="4466896">:=</span>&nbsp;<span class="ident" id="4466899">strings</span><span class="op" id="4466906">.</span><span class="ident" id="4466907">Index</span><span class="op" id="4466912">(</span><span class="ident" id="4466913">s</span><span class="op" id="4466914">,</span>&nbsp;<span class="string" id="4466916">&#34;/&#34;</span><span class="op" id="4466919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466922">if</span>&nbsp;<span class="ident" id="4466925">sep</span>&nbsp;<span class="op" id="4466929">&gt;=</span>&nbsp;<span class="num" id="4466932">0</span>&nbsp;<span class="op" id="4466934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466938">if</span>&nbsp;<span class="ident" id="4466941">_</span><span class="op" id="4466942">,</span>&nbsp;<span class="ident" id="4466944">ok</span>&nbsp;<span class="op" id="4466947">:=</span>&nbsp;<span class="ident" id="4466950">z</span><span class="op" id="4466951">.</span><span class="ident" id="4466952">a</span><span class="op" id="4466953">.</span><span class="ident" id="4466954">SetString</span><span class="op" id="4466963">(</span><span class="ident" id="4466964">s</span><span class="op" id="4466965">[</span><span class="num" id="4466966">0</span><span class="op" id="4466967">:</span><span class="ident" id="4466968">sep</span><span class="op" id="4466971">]</span><span class="op" id="4466972">,</span>&nbsp;<span class="num" id="4466974">10</span><span class="op" id="4466976">)</span><span class="op" id="4466977">;</span>&nbsp;<span class="op" id="4466979">!</span><span class="ident" id="4466980">ok</span>&nbsp;<span class="op" id="4466983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466988">return</span>&nbsp;<span class="ident" id="4466995">nil</span><span class="op" id="4466998">,</span>&nbsp;<span class="builtintype" id="4467000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467008">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467012">s</span>&nbsp;<span class="op" id="4467014">=</span>&nbsp;<span class="ident" id="4467016">s</span><span class="op" id="4467017">[</span><span class="ident" id="4467018">sep</span><span class="op" id="4467021">+</span><span class="num" id="4467022">1</span><span class="op" id="4467023">:</span><span class="op" id="4467024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467028">var</span>&nbsp;<span class="ident" id="4467032">err</span>&nbsp;<span class="builtintype" id="4467036">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467044">if</span>&nbsp;<span class="ident" id="4467047">z</span><span class="op" id="4467048">.</span><span class="ident" id="4467049">b</span><span class="op" id="4467050">.</span><span class="ident" id="4467051">abs</span><span class="op" id="4467054">,</span>&nbsp;<span class="ident" id="4467056">_</span><span class="op" id="4467057">,</span>&nbsp;<span class="ident" id="4467059">err</span>&nbsp;<span class="op" id="4467063">=</span>&nbsp;<span class="ident" id="4467065">z</span><span class="op" id="4467066">.</span><span class="ident" id="4467067">b</span><span class="op" id="4467068">.</span><span class="ident" id="4467069">abs</span><span class="op" id="4467072">.</span><span class="ident" id="4467073">scan</span><span class="op" id="4467077">(</span><span class="ident" id="4467078">strings</span><span class="op" id="4467085">.</span><span class="ident" id="4467086">NewReader</span><span class="op" id="4467095">(</span><span class="ident" id="4467096">s</span><span class="op" id="4467097">)</span><span class="op" id="4467098">,</span>&nbsp;<span class="num" id="4467100">10</span><span class="op" id="4467102">)</span><span class="op" id="4467103">;</span>&nbsp;<span class="ident" id="4467105">err</span>&nbsp;<span class="op" id="4467109">!=</span>&nbsp;<span class="ident" id="4467112">nil</span>&nbsp;<span class="op" id="4467116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467121">return</span>&nbsp;<span class="ident" id="4467128">nil</span><span class="op" id="4467131">,</span>&nbsp;<span class="builtintype" id="4467133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467141">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467145">if</span>&nbsp;<span class="builtinfunc" id="4467148">len</span><span class="op" id="4467151">(</span><span class="ident" id="4467152">z</span><span class="op" id="4467153">.</span><span class="ident" id="4467154">b</span><span class="op" id="4467155">.</span><span class="ident" id="4467156">abs</span><span class="op" id="4467159">)</span>&nbsp;<span class="op" id="4467161">==</span>&nbsp;<span class="num" id="4467164">0</span>&nbsp;<span class="op" id="4467166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467171">return</span>&nbsp;<span class="ident" id="4467178">nil</span><span class="op" id="4467181">,</span>&nbsp;<span class="builtintype" id="4467183">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467195">return</span>&nbsp;<span class="ident" id="4467202">z</span><span class="op" id="4467203">.</span><span class="ident" id="4467204">norm</span><span class="op" id="4467208">(</span><span class="op" id="4467209">)</span><span class="op" id="4467210">,</span>&nbsp;<span class="builtintype" id="4467212">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467218">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467222">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467252">sep</span>&nbsp;<span class="op" id="4467256">=</span>&nbsp;<span class="ident" id="4467258">strings</span><span class="op" id="4467265">.</span><span class="ident" id="4467266">Index</span><span class="op" id="4467271">(</span><span class="ident" id="4467272">s</span><span class="op" id="4467273">,</span>&nbsp;<span class="string" id="4467275">&#34;.&#34;</span><span class="op" id="4467278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467281">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467307">e</span>&nbsp;<span class="op" id="4467309">:=</span>&nbsp;<span class="ident" id="4467312">strings</span><span class="op" id="4467319">.</span><span class="ident" id="4467320">IndexAny</span><span class="op" id="4467328">(</span><span class="ident" id="4467329">s</span><span class="op" id="4467330">,</span>&nbsp;<span class="string" id="4467332">&#34;eE&#34;</span><span class="op" id="4467336">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467339">var</span>&nbsp;<span class="ident" id="4467343">exp</span>&nbsp;<span class="ident" id="4467347">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467352">if</span>&nbsp;<span class="ident" id="4467355">e</span>&nbsp;<span class="op" id="4467357">&gt;=</span>&nbsp;<span class="num" id="4467360">0</span>&nbsp;<span class="op" id="4467362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467366">if</span>&nbsp;<span class="ident" id="4467369">e</span>&nbsp;<span class="op" id="4467371">&lt;</span>&nbsp;<span class="ident" id="4467373">sep</span>&nbsp;<span class="op" id="4467377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467382">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467429">return</span>&nbsp;<span class="ident" id="4467436">nil</span><span class="op" id="4467439">,</span>&nbsp;<span class="builtintype" id="4467441">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467453">if</span>&nbsp;<span class="ident" id="4467456">_</span><span class="op" id="4467457">,</span>&nbsp;<span class="ident" id="4467459">ok</span>&nbsp;<span class="op" id="4467462">:=</span>&nbsp;<span class="ident" id="4467465">exp</span><span class="op" id="4467468">.</span><span class="ident" id="4467469">SetString</span><span class="op" id="4467478">(</span><span class="ident" id="4467479">s</span><span class="op" id="4467480">[</span><span class="ident" id="4467481">e</span><span class="op" id="4467482">+</span><span class="num" id="4467483">1</span><span class="op" id="4467484">:</span><span class="op" id="4467485">]</span><span class="op" id="4467486">,</span>&nbsp;<span class="num" id="4467488">10</span><span class="op" id="4467490">)</span><span class="op" id="4467491">;</span>&nbsp;<span class="op" id="4467493">!</span><span class="ident" id="4467494">ok</span>&nbsp;<span class="op" id="4467497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467502">return</span>&nbsp;<span class="ident" id="4467509">nil</span><span class="op" id="4467512">,</span>&nbsp;<span class="builtintype" id="4467514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467526">s</span>&nbsp;<span class="op" id="4467528">=</span>&nbsp;<span class="ident" id="4467530">s</span><span class="op" id="4467531">[</span><span class="num" id="4467532">0</span><span class="op" id="4467533">:</span><span class="ident" id="4467534">e</span><span class="op" id="4467535">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467541">if</span>&nbsp;<span class="ident" id="4467544">sep</span>&nbsp;<span class="op" id="4467548">&gt;=</span>&nbsp;<span class="num" id="4467551">0</span>&nbsp;<span class="op" id="4467553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467557">s</span>&nbsp;<span class="op" id="4467559">=</span>&nbsp;<span class="ident" id="4467561">s</span><span class="op" id="4467562">[</span><span class="num" id="4467563">0</span><span class="op" id="4467564">:</span><span class="ident" id="4467565">sep</span><span class="op" id="4467568">]</span>&nbsp;<span class="op" id="4467570">+</span>&nbsp;<span class="ident" id="4467572">s</span><span class="op" id="4467573">[</span><span class="ident" id="4467574">sep</span><span class="op" id="4467577">+</span><span class="num" id="4467578">1</span><span class="op" id="4467579">:</span><span class="op" id="4467580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467584">exp</span><span class="op" id="4467587">.</span><span class="ident" id="4467588">Sub</span><span class="op" id="4467591">(</span><span class="op" id="4467592">&amp;</span><span class="ident" id="4467593">exp</span><span class="op" id="4467596">,</span>&nbsp;<span class="ident" id="4467598">NewInt</span><span class="op" id="4467604">(</span><span class="ident" id="4467605">int64</span><span class="op" id="4467610">(</span><span class="builtinfunc" id="4467611">len</span><span class="op" id="4467614">(</span><span class="ident" id="4467615">s</span><span class="op" id="4467616">)</span><span class="op" id="4467617">-</span><span class="ident" id="4467618">sep</span><span class="op" id="4467621">)</span><span class="op" id="4467622">)</span><span class="op" id="4467623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467626">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467630">if</span>&nbsp;<span class="ident" id="4467633">_</span><span class="op" id="4467634">,</span>&nbsp;<span class="ident" id="4467636">ok</span>&nbsp;<span class="op" id="4467639">:=</span>&nbsp;<span class="ident" id="4467642">z</span><span class="op" id="4467643">.</span><span class="ident" id="4467644">a</span><span class="op" id="4467645">.</span><span class="ident" id="4467646">SetString</span><span class="op" id="4467655">(</span><span class="ident" id="4467656">s</span><span class="op" id="4467657">,</span>&nbsp;<span class="num" id="4467659">10</span><span class="op" id="4467661">)</span><span class="op" id="4467662">;</span>&nbsp;<span class="op" id="4467664">!</span><span class="ident" id="4467665">ok</span>&nbsp;<span class="op" id="4467668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467672">return</span>&nbsp;<span class="ident" id="4467679">nil</span><span class="op" id="4467682">,</span>&nbsp;<span class="builtintype" id="4467684">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467694">powTen</span>&nbsp;<span class="op" id="4467701">:=</span>&nbsp;<span class="ident" id="4467704">nat</span><span class="op" id="4467707">(</span><span class="ident" id="4467708">nil</span><span class="op" id="4467711">)</span><span class="op" id="4467712">.</span><span class="ident" id="4467713">expNN</span><span class="op" id="4467718">(</span><span class="ident" id="4467719">natTen</span><span class="op" id="4467725">,</span>&nbsp;<span class="ident" id="4467727">exp</span><span class="op" id="4467730">.</span><span class="ident" id="4467731">abs</span><span class="op" id="4467734">,</span>&nbsp;<span class="ident" id="4467736">nil</span><span class="op" id="4467739">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467742">if</span>&nbsp;<span class="ident" id="4467745">exp</span><span class="op" id="4467748">.</span><span class="ident" id="4467749">neg</span>&nbsp;<span class="op" id="4467753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467757">z</span><span class="op" id="4467758">.</span><span class="ident" id="4467759">b</span><span class="op" id="4467760">.</span><span class="ident" id="4467761">abs</span>&nbsp;<span class="op" id="4467765">=</span>&nbsp;<span class="ident" id="4467767">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467776">z</span><span class="op" id="4467777">.</span><span class="ident" id="4467778">norm</span><span class="op" id="4467782">(</span><span class="op" id="4467783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467786">}</span>&nbsp;<span class="keyword" id="4467788">else</span>&nbsp;<span class="op" id="4467793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467797">z</span><span class="op" id="4467798">.</span><span class="ident" id="4467799">a</span><span class="op" id="4467800">.</span><span class="ident" id="4467801">abs</span>&nbsp;<span class="op" id="4467805">=</span>&nbsp;<span class="ident" id="4467807">z</span><span class="op" id="4467808">.</span><span class="ident" id="4467809">a</span><span class="op" id="4467810">.</span><span class="ident" id="4467811">abs</span><span class="op" id="4467814">.</span><span class="ident" id="4467815">mul</span><span class="op" id="4467818">(</span><span class="ident" id="4467819">z</span><span class="op" id="4467820">.</span><span class="ident" id="4467821">a</span><span class="op" id="4467822">.</span><span class="ident" id="4467823">abs</span><span class="op" id="4467826">,</span>&nbsp;<span class="ident" id="4467828">powTen</span><span class="op" id="4467834">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467838">z</span><span class="op" id="4467839">.</span><span class="ident" id="4467840">b</span><span class="op" id="4467841">.</span><span class="ident" id="4467842">abs</span>&nbsp;<span class="op" id="4467846">=</span>&nbsp;<span class="ident" id="4467848">z</span><span class="op" id="4467849">.</span><span class="ident" id="4467850">b</span><span class="op" id="4467851">.</span><span class="ident" id="4467852">abs</span><span class="op" id="4467855">.</span><span class="builtinfunc" id="4467856">make</span><span class="op" id="4467860">(</span><span class="num" id="4467861">0</span><span class="op" id="4467862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467869">return</span>&nbsp;<span class="ident" id="4467876">z</span><span class="op" id="4467877">,</span>&nbsp;<span class="builtintype" id="4467879">true</span><br>
<span class="lineno"></span><span class="op" id="4467884">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="4467887">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="4467970">func</span>&nbsp;<span class="op" id="4467975">(</span><span class="ident" id="4467976">x</span>&nbsp;<span class="op" id="4467978">*</span><span class="ident" id="4467979">Rat</span><span class="op" id="4467982">)</span>&nbsp;<span class="ident" id="4467984">String</span><span class="op" id="4467990">(</span><span class="op" id="4467991">)</span>&nbsp;<span class="builtintype" id="4467993">string</span>&nbsp;<span class="op" id="4468000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468003">s</span>&nbsp;<span class="op" id="4468005">:=</span>&nbsp;<span class="string" id="4468008">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468014">if</span>&nbsp;<span class="builtinfunc" id="4468017">len</span><span class="op" id="4468020">(</span><span class="ident" id="4468021">x</span><span class="op" id="4468022">.</span><span class="ident" id="4468023">b</span><span class="op" id="4468024">.</span><span class="ident" id="4468025">abs</span><span class="op" id="4468028">)</span>&nbsp;<span class="op" id="4468030">!=</span>&nbsp;<span class="num" id="4468033">0</span>&nbsp;<span class="op" id="4468035">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468039">s</span>&nbsp;<span class="op" id="4468041">=</span>&nbsp;<span class="string" id="4468043">&#34;/&#34;</span>&nbsp;<span class="op" id="4468047">+</span>&nbsp;<span class="ident" id="4468049">x</span><span class="op" id="4468050">.</span><span class="ident" id="4468051">b</span><span class="op" id="4468052">.</span><span class="ident" id="4468053">abs</span><span class="op" id="4468056">.</span><span class="ident" id="4468057">decimalString</span><span class="op" id="4468070">(</span><span class="op" id="4468071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468077">return</span>&nbsp;<span class="ident" id="4468084">x</span><span class="op" id="4468085">.</span><span class="ident" id="4468086">a</span><span class="op" id="4468087">.</span><span class="ident" id="4468088">String</span><span class="op" id="4468094">(</span><span class="op" id="4468095">)</span>&nbsp;<span class="op" id="4468097">+</span>&nbsp;<span class="ident" id="4468099">s</span><br>
<span class="lineno"></span><span class="op" id="4468101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="4468104">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="4468183">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4468217">func</span>&nbsp;<span class="op" id="4468222">(</span><span class="ident" id="4468223">x</span>&nbsp;<span class="op" id="4468225">*</span><span class="ident" id="4468226">Rat</span><span class="op" id="4468229">)</span>&nbsp;<span class="ident" id="4468231">RatString</span><span class="op" id="4468240">(</span><span class="op" id="4468241">)</span>&nbsp;<span class="builtintype" id="4468243">string</span>&nbsp;<span class="op" id="4468250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468253">if</span>&nbsp;<span class="ident" id="4468256">x</span><span class="op" id="4468257">.</span><span class="ident" id="4468258">IsInt</span><span class="op" id="4468263">(</span><span class="op" id="4468264">)</span>&nbsp;<span class="op" id="4468266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468270">return</span>&nbsp;<span class="ident" id="4468277">x</span><span class="op" id="4468278">.</span><span class="ident" id="4468279">a</span><span class="op" id="4468280">.</span><span class="ident" id="4468281">String</span><span class="op" id="4468287">(</span><span class="op" id="4468288">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468294">return</span>&nbsp;<span class="ident" id="4468301">x</span><span class="op" id="4468302">.</span><span class="ident" id="4468303">String</span><span class="op" id="4468309">(</span><span class="op" id="4468310">)</span><br>
<span class="lineno"></span><span class="op" id="4468312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4468315">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="4468393">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="4468468">func</span>&nbsp;<span class="op" id="4468473">(</span><span class="ident" id="4468474">x</span>&nbsp;<span class="op" id="4468476">*</span><span class="ident" id="4468477">Rat</span><span class="op" id="4468480">)</span>&nbsp;<span class="ident" id="4468482">FloatString</span><span class="op" id="4468493">(</span><span class="ident" id="4468494">prec</span>&nbsp;<span class="builtintype" id="4468499">int</span><span class="op" id="4468502">)</span>&nbsp;<span class="builtintype" id="4468504">string</span>&nbsp;<span class="op" id="4468511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468514">if</span>&nbsp;<span class="ident" id="4468517">x</span><span class="op" id="4468518">.</span><span class="ident" id="4468519">IsInt</span><span class="op" id="4468524">(</span><span class="op" id="4468525">)</span>&nbsp;<span class="op" id="4468527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468531">s</span>&nbsp;<span class="op" id="4468533">:=</span>&nbsp;<span class="ident" id="4468536">x</span><span class="op" id="4468537">.</span><span class="ident" id="4468538">a</span><span class="op" id="4468539">.</span><span class="ident" id="4468540">String</span><span class="op" id="4468546">(</span><span class="op" id="4468547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468551">if</span>&nbsp;<span class="ident" id="4468554">prec</span>&nbsp;<span class="op" id="4468559">&gt;</span>&nbsp;<span class="num" id="4468561">0</span>&nbsp;<span class="op" id="4468563">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468568">s</span>&nbsp;<span class="op" id="4468570">+=</span>&nbsp;<span class="string" id="4468573">&#34;.&#34;</span>&nbsp;<span class="op" id="4468577">+</span>&nbsp;<span class="ident" id="4468579">strings</span><span class="op" id="4468586">.</span><span class="ident" id="4468587">Repeat</span><span class="op" id="4468593">(</span><span class="string" id="4468594">&#34;0&#34;</span><span class="op" id="4468597">,</span>&nbsp;<span class="ident" id="4468599">prec</span><span class="op" id="4468603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468611">return</span>&nbsp;<span class="ident" id="4468618">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4468624">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468642">q</span><span class="op" id="4468643">,</span>&nbsp;<span class="ident" id="4468645">r</span>&nbsp;<span class="op" id="4468647">:=</span>&nbsp;<span class="ident" id="4468650">nat</span><span class="op" id="4468653">(</span><span class="ident" id="4468654">nil</span><span class="op" id="4468657">)</span><span class="op" id="4468658">.</span><span class="ident" id="4468659">div</span><span class="op" id="4468662">(</span><span class="ident" id="4468663">nat</span><span class="op" id="4468666">(</span><span class="ident" id="4468667">nil</span><span class="op" id="4468670">)</span><span class="op" id="4468671">,</span>&nbsp;<span class="ident" id="4468673">x</span><span class="op" id="4468674">.</span><span class="ident" id="4468675">a</span><span class="op" id="4468676">.</span><span class="ident" id="4468677">abs</span><span class="op" id="4468680">,</span>&nbsp;<span class="ident" id="4468682">x</span><span class="op" id="4468683">.</span><span class="ident" id="4468684">b</span><span class="op" id="4468685">.</span><span class="ident" id="4468686">abs</span><span class="op" id="4468689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468693">p</span>&nbsp;<span class="op" id="4468695">:=</span>&nbsp;<span class="ident" id="4468698">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468706">if</span>&nbsp;<span class="ident" id="4468709">prec</span>&nbsp;<span class="op" id="4468714">&gt;</span>&nbsp;<span class="num" id="4468716">0</span>&nbsp;<span class="op" id="4468718">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468722">p</span>&nbsp;<span class="op" id="4468724">=</span>&nbsp;<span class="ident" id="4468726">nat</span><span class="op" id="4468729">(</span><span class="ident" id="4468730">nil</span><span class="op" id="4468733">)</span><span class="op" id="4468734">.</span><span class="ident" id="4468735">expNN</span><span class="op" id="4468740">(</span><span class="ident" id="4468741">natTen</span><span class="op" id="4468747">,</span>&nbsp;<span class="ident" id="4468749">nat</span><span class="op" id="4468752">(</span><span class="ident" id="4468753">nil</span><span class="op" id="4468756">)</span><span class="op" id="4468757">.</span><span class="ident" id="4468758">setUint64</span><span class="op" id="4468767">(</span><span class="ident" id="4468768">uint64</span><span class="op" id="4468774">(</span><span class="ident" id="4468775">prec</span><span class="op" id="4468779">)</span><span class="op" id="4468780">)</span><span class="op" id="4468781">,</span>&nbsp;<span class="ident" id="4468783">nil</span><span class="op" id="4468786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468793">r</span>&nbsp;<span class="op" id="4468795">=</span>&nbsp;<span class="ident" id="4468797">r</span><span class="op" id="4468798">.</span><span class="ident" id="4468799">mul</span><span class="op" id="4468802">(</span><span class="ident" id="4468803">r</span><span class="op" id="4468804">,</span>&nbsp;<span class="ident" id="4468806">p</span><span class="op" id="4468807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468810">r</span><span class="op" id="4468811">,</span>&nbsp;<span class="ident" id="4468813">r2</span>&nbsp;<span class="op" id="4468816">:=</span>&nbsp;<span class="ident" id="4468819">r</span><span class="op" id="4468820">.</span><span class="ident" id="4468821">div</span><span class="op" id="4468824">(</span><span class="ident" id="4468825">nat</span><span class="op" id="4468828">(</span><span class="ident" id="4468829">nil</span><span class="op" id="4468832">)</span><span class="op" id="4468833">,</span>&nbsp;<span class="ident" id="4468835">r</span><span class="op" id="4468836">,</span>&nbsp;<span class="ident" id="4468838">x</span><span class="op" id="4468839">.</span><span class="ident" id="4468840">b</span><span class="op" id="4468841">.</span><span class="ident" id="4468842">abs</span><span class="op" id="4468845">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4468849">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468880">r2</span>&nbsp;<span class="op" id="4468883">=</span>&nbsp;<span class="ident" id="4468885">r2</span><span class="op" id="4468887">.</span><span class="ident" id="4468888">add</span><span class="op" id="4468891">(</span><span class="ident" id="4468892">r2</span><span class="op" id="4468894">,</span>&nbsp;<span class="ident" id="4468896">r2</span><span class="op" id="4468898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468901">if</span>&nbsp;<span class="ident" id="4468904">x</span><span class="op" id="4468905">.</span><span class="ident" id="4468906">b</span><span class="op" id="4468907">.</span><span class="ident" id="4468908">abs</span><span class="op" id="4468911">.</span><span class="ident" id="4468912">cmp</span><span class="op" id="4468915">(</span><span class="ident" id="4468916">r2</span><span class="op" id="4468918">)</span>&nbsp;<span class="op" id="4468920">&lt;=</span>&nbsp;<span class="num" id="4468923">0</span>&nbsp;<span class="op" id="4468925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468929">r</span>&nbsp;<span class="op" id="4468931">=</span>&nbsp;<span class="ident" id="4468933">r</span><span class="op" id="4468934">.</span><span class="ident" id="4468935">add</span><span class="op" id="4468938">(</span><span class="ident" id="4468939">r</span><span class="op" id="4468940">,</span>&nbsp;<span class="ident" id="4468942">natOne</span><span class="op" id="4468948">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468952">if</span>&nbsp;<span class="ident" id="4468955">r</span><span class="op" id="4468956">.</span><span class="ident" id="4468957">cmp</span><span class="op" id="4468960">(</span><span class="ident" id="4468961">p</span><span class="op" id="4468962">)</span>&nbsp;<span class="op" id="4468964">&gt;=</span>&nbsp;<span class="num" id="4468967">0</span>&nbsp;<span class="op" id="4468969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468974">q</span>&nbsp;<span class="op" id="4468976">=</span>&nbsp;<span class="ident" id="4468978">nat</span><span class="op" id="4468981">(</span><span class="ident" id="4468982">nil</span><span class="op" id="4468985">)</span><span class="op" id="4468986">.</span><span class="ident" id="4468987">add</span><span class="op" id="4468990">(</span><span class="ident" id="4468991">q</span><span class="op" id="4468992">,</span>&nbsp;<span class="ident" id="4468994">natOne</span><span class="op" id="4469000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469005">r</span>&nbsp;<span class="op" id="4469007">=</span>&nbsp;<span class="ident" id="4469009">nat</span><span class="op" id="4469012">(</span><span class="ident" id="4469013">nil</span><span class="op" id="4469016">)</span><span class="op" id="4469017">.</span><span class="ident" id="4469018">sub</span><span class="op" id="4469021">(</span><span class="ident" id="4469022">r</span><span class="op" id="4469023">,</span>&nbsp;<span class="ident" id="4469025">p</span><span class="op" id="4469026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469033">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469037">s</span>&nbsp;<span class="op" id="4469039">:=</span>&nbsp;<span class="ident" id="4469042">q</span><span class="op" id="4469043">.</span><span class="ident" id="4469044">decimalString</span><span class="op" id="4469057">(</span><span class="op" id="4469058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469061">if</span>&nbsp;<span class="ident" id="4469064">x</span><span class="op" id="4469065">.</span><span class="ident" id="4469066">a</span><span class="op" id="4469067">.</span><span class="ident" id="4469068">neg</span>&nbsp;<span class="op" id="4469072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469076">s</span>&nbsp;<span class="op" id="4469078">=</span>&nbsp;<span class="string" id="4469080">&#34;-&#34;</span>&nbsp;<span class="op" id="4469084">+</span>&nbsp;<span class="ident" id="4469086">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469089">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469093">if</span>&nbsp;<span class="ident" id="4469096">prec</span>&nbsp;<span class="op" id="4469101">&gt;</span>&nbsp;<span class="num" id="4469103">0</span>&nbsp;<span class="op" id="4469105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469109">rs</span>&nbsp;<span class="op" id="4469112">:=</span>&nbsp;<span class="ident" id="4469115">r</span><span class="op" id="4469116">.</span><span class="ident" id="4469117">decimalString</span><span class="op" id="4469130">(</span><span class="op" id="4469131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469135">leadingZeros</span>&nbsp;<span class="op" id="4469148">:=</span>&nbsp;<span class="ident" id="4469151">prec</span>&nbsp;<span class="op" id="4469156">-</span>&nbsp;<span class="builtinfunc" id="4469158">len</span><span class="op" id="4469161">(</span><span class="ident" id="4469162">rs</span><span class="op" id="4469164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469168">s</span>&nbsp;<span class="op" id="4469170">+=</span>&nbsp;<span class="string" id="4469173">&#34;.&#34;</span>&nbsp;<span class="op" id="4469177">+</span>&nbsp;<span class="ident" id="4469179">strings</span><span class="op" id="4469186">.</span><span class="ident" id="4469187">Repeat</span><span class="op" id="4469193">(</span><span class="string" id="4469194">&#34;0&#34;</span><span class="op" id="4469197">,</span>&nbsp;<span class="ident" id="4469199">leadingZeros</span><span class="op" id="4469211">)</span>&nbsp;<span class="op" id="4469213">+</span>&nbsp;<span class="ident" id="4469215">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469223">return</span>&nbsp;<span class="ident" id="4469230">s</span><br>
<span class="lineno"></span><span class="op" id="4469232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4469235">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4469310">const</span>&nbsp;<span class="ident" id="4469316">ratGobVersion</span>&nbsp;<span class="builtintype" id="4469330">byte</span>&nbsp;<span class="op" id="4469335">=</span>&nbsp;<span class="num" id="4469337">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4469340">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4469394">func</span>&nbsp;<span class="op" id="4469399">(</span><span class="ident" id="4469400">x</span>&nbsp;<span class="op" id="4469402">*</span><span class="ident" id="4469403">Rat</span><span class="op" id="4469406">)</span>&nbsp;<span class="ident" id="4469408">GobEncode</span><span class="op" id="4469417">(</span><span class="op" id="4469418">)</span>&nbsp;<span class="op" id="4469420">(</span><span class="op" id="4469421">[</span><span class="op" id="4469422">]</span><span class="builtintype" id="4469423">byte</span><span class="op" id="4469427">,</span>&nbsp;<span class="builtintype" id="4469429">error</span><span class="op" id="4469434">)</span>&nbsp;<span class="op" id="4469436">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469439">if</span>&nbsp;<span class="ident" id="4469442">x</span>&nbsp;<span class="op" id="4469444">==</span>&nbsp;<span class="ident" id="4469447">nil</span>&nbsp;<span class="op" id="4469451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469455">return</span>&nbsp;<span class="ident" id="4469462">nil</span><span class="op" id="4469465">,</span>&nbsp;<span class="ident" id="4469467">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469475">buf</span>&nbsp;<span class="op" id="4469479">:=</span>&nbsp;<span class="builtinfunc" id="4469482">make</span><span class="op" id="4469486">(</span><span class="op" id="4469487">[</span><span class="op" id="4469488">]</span><span class="builtintype" id="4469489">byte</span><span class="op" id="4469493">,</span>&nbsp;<span class="num" id="4469495">1</span><span class="op" id="4469496">+</span><span class="num" id="4469497">4</span><span class="op" id="4469498">+</span><span class="op" id="4469499">(</span><span class="builtinfunc" id="4469500">len</span><span class="op" id="4469503">(</span><span class="ident" id="4469504">x</span><span class="op" id="4469505">.</span><span class="ident" id="4469506">a</span><span class="op" id="4469507">.</span><span class="ident" id="4469508">abs</span><span class="op" id="4469511">)</span><span class="op" id="4469512">+</span><span class="builtinfunc" id="4469513">len</span><span class="op" id="4469516">(</span><span class="ident" id="4469517">x</span><span class="op" id="4469518">.</span><span class="ident" id="4469519">b</span><span class="op" id="4469520">.</span><span class="ident" id="4469521">abs</span><span class="op" id="4469524">)</span><span class="op" id="4469525">)</span><span class="op" id="4469526">*</span><span class="ident" id="4469527">_S</span><span class="op" id="4469529">)</span>&nbsp;<span class="comment" id="4469531">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469602">i</span>&nbsp;<span class="op" id="4469604">:=</span>&nbsp;<span class="ident" id="4469607">x</span><span class="op" id="4469608">.</span><span class="ident" id="4469609">b</span><span class="op" id="4469610">.</span><span class="ident" id="4469611">abs</span><span class="op" id="4469614">.</span><span class="ident" id="4469615">bytes</span><span class="op" id="4469620">(</span><span class="ident" id="4469621">buf</span><span class="op" id="4469624">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469627">j</span>&nbsp;<span class="op" id="4469629">:=</span>&nbsp;<span class="ident" id="4469632">x</span><span class="op" id="4469633">.</span><span class="ident" id="4469634">a</span><span class="op" id="4469635">.</span><span class="ident" id="4469636">abs</span><span class="op" id="4469639">.</span><span class="ident" id="4469640">bytes</span><span class="op" id="4469645">(</span><span class="ident" id="4469646">buf</span><span class="op" id="4469649">[</span><span class="num" id="4469650">0</span><span class="op" id="4469651">:</span><span class="ident" id="4469652">i</span><span class="op" id="4469653">]</span><span class="op" id="4469654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469657">n</span>&nbsp;<span class="op" id="4469659">:=</span>&nbsp;<span class="ident" id="4469662">i</span>&nbsp;<span class="op" id="4469664">-</span>&nbsp;<span class="ident" id="4469666">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469669">if</span>&nbsp;<span class="builtintype" id="4469672">int</span><span class="op" id="4469675">(</span><span class="builtintype" id="4469676">uint32</span><span class="op" id="4469682">(</span><span class="ident" id="4469683">n</span><span class="op" id="4469684">)</span><span class="op" id="4469685">)</span>&nbsp;<span class="op" id="4469687">!=</span>&nbsp;<span class="ident" id="4469690">n</span>&nbsp;<span class="op" id="4469692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469696">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469726">return</span>&nbsp;<span class="ident" id="4469733">nil</span><span class="op" id="4469736">,</span>&nbsp;<span class="ident" id="4469738">errors</span><span class="op" id="4469744">.</span><span class="ident" id="4469745">New</span><span class="op" id="4469748">(</span><span class="string" id="4469749">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="4469785">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469791">binary</span><span class="op" id="4469797">.</span><span class="ident" id="4469798">BigEndian</span><span class="op" id="4469807">.</span><span class="ident" id="4469808">PutUint32</span><span class="op" id="4469817">(</span><span class="ident" id="4469818">buf</span><span class="op" id="4469821">[</span><span class="ident" id="4469822">j</span><span class="op" id="4469823">-</span><span class="num" id="4469824">4</span><span class="op" id="4469825">:</span><span class="ident" id="4469826">j</span><span class="op" id="4469827">]</span><span class="op" id="4469828">,</span>&nbsp;<span class="builtintype" id="4469830">uint32</span><span class="op" id="4469836">(</span><span class="ident" id="4469837">n</span><span class="op" id="4469838">)</span><span class="op" id="4469839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469842">j</span>&nbsp;<span class="op" id="4469844">-=</span>&nbsp;<span class="num" id="4469847">1</span>&nbsp;<span class="op" id="4469849">+</span>&nbsp;<span class="num" id="4469851">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469854">b</span>&nbsp;<span class="op" id="4469856">:=</span>&nbsp;<span class="ident" id="4469859">ratGobVersion</span>&nbsp;<span class="op" id="4469873">&lt;&lt;</span>&nbsp;<span class="num" id="4469876">1</span>&nbsp;<span class="comment" id="4469878">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469906">if</span>&nbsp;<span class="ident" id="4469909">x</span><span class="op" id="4469910">.</span><span class="ident" id="4469911">a</span><span class="op" id="4469912">.</span><span class="ident" id="4469913">neg</span>&nbsp;<span class="op" id="4469917">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469921">b</span>&nbsp;<span class="op" id="4469923">|=</span>&nbsp;<span class="num" id="4469926">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469932">buf</span><span class="op" id="4469935">[</span><span class="ident" id="4469936">j</span><span class="op" id="4469937">]</span>&nbsp;<span class="op" id="4469939">=</span>&nbsp;<span class="ident" id="4469941">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469944">return</span>&nbsp;<span class="ident" id="4469951">buf</span><span class="op" id="4469954">[</span><span class="ident" id="4469955">j</span><span class="op" id="4469956">:</span><span class="op" id="4469957">]</span><span class="op" id="4469958">,</span>&nbsp;<span class="ident" id="4469960">nil</span><br>
<span class="lineno"></span><span class="op" id="4469964">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="4469967">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4470021">func</span>&nbsp;<span class="op" id="4470026">(</span><span class="ident" id="4470027">z</span>&nbsp;<span class="op" id="4470029">*</span><span class="ident" id="4470030">Rat</span><span class="op" id="4470033">)</span>&nbsp;<span class="ident" id="4470035">GobDecode</span><span class="op" id="4470044">(</span><span class="ident" id="4470045">buf</span>&nbsp;<span class="op" id="4470049">[</span><span class="op" id="4470050">]</span><span class="builtintype" id="4470051">byte</span><span class="op" id="4470055">)</span>&nbsp;<span class="builtintype" id="4470057">error</span>&nbsp;<span class="op" id="4470063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470066">if</span>&nbsp;<span class="builtinfunc" id="4470069">len</span><span class="op" id="4470072">(</span><span class="ident" id="4470073">buf</span><span class="op" id="4470076">)</span>&nbsp;<span class="op" id="4470078">==</span>&nbsp;<span class="num" id="4470081">0</span>&nbsp;<span class="op" id="4470083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470087">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470132">*</span><span class="ident" id="4470133">z</span>&nbsp;<span class="op" id="4470135">=</span>&nbsp;<span class="ident" id="4470137">Rat</span><span class="op" id="4470140">{</span><span class="op" id="4470141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470145">return</span>&nbsp;<span class="ident" id="4470152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470160">b</span>&nbsp;<span class="op" id="4470162">:=</span>&nbsp;<span class="ident" id="4470165">buf</span><span class="op" id="4470168">[</span><span class="num" id="4470169">0</span><span class="op" id="4470170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470173">if</span>&nbsp;<span class="ident" id="4470176">b</span><span class="op" id="4470177">&gt;&gt;</span><span class="num" id="4470179">1</span>&nbsp;<span class="op" id="4470181">!=</span>&nbsp;<span class="ident" id="4470184">ratGobVersion</span>&nbsp;<span class="op" id="4470198">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470202">return</span>&nbsp;<span class="ident" id="4470209">errors</span><span class="op" id="4470215">.</span><span class="ident" id="4470216">New</span><span class="op" id="4470219">(</span><span class="ident" id="4470220">fmt</span><span class="op" id="4470223">.</span><span class="ident" id="4470224">Sprintf</span><span class="op" id="4470231">(</span><span class="string" id="4470232">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4470282">,</span>&nbsp;<span class="ident" id="4470284">b</span><span class="op" id="4470285">&gt;&gt;</span><span class="num" id="4470287">1</span><span class="op" id="4470288">)</span><span class="op" id="4470289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470295">const</span>&nbsp;<span class="ident" id="4470301">j</span>&nbsp;<span class="op" id="4470303">=</span>&nbsp;<span class="num" id="4470305">1</span>&nbsp;<span class="op" id="4470307">+</span>&nbsp;<span class="num" id="4470309">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470312">i</span>&nbsp;<span class="op" id="4470314">:=</span>&nbsp;<span class="ident" id="4470317">j</span>&nbsp;<span class="op" id="4470319">+</span>&nbsp;<span class="ident" id="4470321">binary</span><span class="op" id="4470327">.</span><span class="ident" id="4470328">BigEndian</span><span class="op" id="4470337">.</span><span class="ident" id="4470338">Uint32</span><span class="op" id="4470344">(</span><span class="ident" id="4470345">buf</span><span class="op" id="4470348">[</span><span class="ident" id="4470349">j</span><span class="op" id="4470350">-</span><span class="num" id="4470351">4</span><span class="op" id="4470352">:</span><span class="ident" id="4470353">j</span><span class="op" id="4470354">]</span><span class="op" id="4470355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470358">z</span><span class="op" id="4470359">.</span><span class="ident" id="4470360">a</span><span class="op" id="4470361">.</span><span class="ident" id="4470362">neg</span>&nbsp;<span class="op" id="4470366">=</span>&nbsp;<span class="ident" id="4470368">b</span><span class="op" id="4470369">&amp;</span><span class="num" id="4470370">1</span>&nbsp;<span class="op" id="4470372">!=</span>&nbsp;<span class="num" id="4470375">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470378">z</span><span class="op" id="4470379">.</span><span class="ident" id="4470380">a</span><span class="op" id="4470381">.</span><span class="ident" id="4470382">abs</span>&nbsp;<span class="op" id="4470386">=</span>&nbsp;<span class="ident" id="4470388">z</span><span class="op" id="4470389">.</span><span class="ident" id="4470390">a</span><span class="op" id="4470391">.</span><span class="ident" id="4470392">abs</span><span class="op" id="4470395">.</span><span class="ident" id="4470396">setBytes</span><span class="op" id="4470404">(</span><span class="ident" id="4470405">buf</span><span class="op" id="4470408">[</span><span class="ident" id="4470409">j</span><span class="op" id="4470410">:</span><span class="ident" id="4470411">i</span><span class="op" id="4470412">]</span><span class="op" id="4470413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470416">z</span><span class="op" id="4470417">.</span><span class="ident" id="4470418">b</span><span class="op" id="4470419">.</span><span class="ident" id="4470420">abs</span>&nbsp;<span class="op" id="4470424">=</span>&nbsp;<span class="ident" id="4470426">z</span><span class="op" id="4470427">.</span><span class="ident" id="4470428">b</span><span class="op" id="4470429">.</span><span class="ident" id="4470430">abs</span><span class="op" id="4470433">.</span><span class="ident" id="4470434">setBytes</span><span class="op" id="4470442">(</span><span class="ident" id="4470443">buf</span><span class="op" id="4470446">[</span><span class="ident" id="4470447">i</span><span class="op" id="4470448">:</span><span class="op" id="4470449">]</span><span class="op" id="4470450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470453">return</span>&nbsp;<span class="ident" id="4470460">nil</span><br>
<span class="lineno"></span><span class="op" id="4470464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4470467">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4470531">func</span>&nbsp;<span class="op" id="4470536">(</span><span class="ident" id="4470537">r</span>&nbsp;<span class="op" id="4470539">*</span><span class="ident" id="4470540">Rat</span><span class="op" id="4470543">)</span>&nbsp;<span class="ident" id="4470545">MarshalText</span><span class="op" id="4470556">(</span><span class="op" id="4470557">)</span>&nbsp;<span class="op" id="4470559">(</span><span class="ident" id="4470560">text</span>&nbsp;<span class="op" id="4470565">[</span><span class="op" id="4470566">]</span><span class="builtintype" id="4470567">byte</span><span class="op" id="4470571">,</span>&nbsp;<span class="ident" id="4470573">err</span>&nbsp;<span class="builtintype" id="4470577">error</span><span class="op" id="4470582">)</span>&nbsp;<span class="op" id="4470584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470587">return</span>&nbsp;<span class="op" id="4470594">[</span><span class="op" id="4470595">]</span><span class="builtintype" id="4470596">byte</span><span class="op" id="4470600">(</span><span class="ident" id="4470601">r</span><span class="op" id="4470602">.</span><span class="ident" id="4470603">RatString</span><span class="op" id="4470612">(</span><span class="op" id="4470613">)</span><span class="op" id="4470614">)</span><span class="op" id="4470615">,</span>&nbsp;<span class="ident" id="4470617">nil</span><br>
<span class="lineno"></span><span class="op" id="4470621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="4470624">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4470692">func</span>&nbsp;<span class="op" id="4470697">(</span><span class="ident" id="4470698">r</span>&nbsp;<span class="op" id="4470700">*</span><span class="ident" id="4470701">Rat</span><span class="op" id="4470704">)</span>&nbsp;<span class="ident" id="4470706">UnmarshalText</span><span class="op" id="4470719">(</span><span class="ident" id="4470720">text</span>&nbsp;<span class="op" id="4470725">[</span><span class="op" id="4470726">]</span><span class="builtintype" id="4470727">byte</span><span class="op" id="4470731">)</span>&nbsp;<span class="builtintype" id="4470733">error</span>&nbsp;<span class="op" id="4470739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470742">if</span>&nbsp;<span class="ident" id="4470745">_</span><span class="op" id="4470746">,</span>&nbsp;<span class="ident" id="4470748">ok</span>&nbsp;<span class="op" id="4470751">:=</span>&nbsp;<span class="ident" id="4470754">r</span><span class="op" id="4470755">.</span><span class="ident" id="4470756">SetString</span><span class="op" id="4470765">(</span><span class="builtintype" id="4470766">string</span><span class="op" id="4470772">(</span><span class="ident" id="4470773">text</span><span class="op" id="4470777">)</span><span class="op" id="4470778">)</span><span class="op" id="4470779">;</span>&nbsp;<span class="op" id="4470781">!</span><span class="ident" id="4470782">ok</span>&nbsp;<span class="op" id="4470785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470789">return</span>&nbsp;<span class="ident" id="4470796">fmt</span><span class="op" id="4470799">.</span><span class="ident" id="4470800">Errorf</span><span class="op" id="4470806">(</span><span class="string" id="4470807">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="4470854">,</span>&nbsp;<span class="ident" id="4470856">text</span><span class="op" id="4470860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470863">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470866">return</span>&nbsp;<span class="ident" id="4470873">nil</span><br>
<span class="lineno"></span><span class="op" id="4470877">}</span>
</div>
</body>
</html>
