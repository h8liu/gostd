<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4698115">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4698170">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4698224">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4698275">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="4698352">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4698431">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="4698462">package</span>&nbsp;<span class="ident" id="4698470">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4698475">import</span>&nbsp;<span class="op" id="4698482">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4698485">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4698494">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4698513">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4698519">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4698526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4698529">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4698576">//</span><br>
<span class="lineno"></span><span class="comment" id="4698579">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="4698603">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4698630">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="4698644">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="4698671">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4698696">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="4698763">type</span>&nbsp;<span class="ident" id="4698768">Block</span>&nbsp;<span class="keyword" id="4698774">struct</span>&nbsp;<span class="op" id="4698781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698784">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4698792">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698810">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698874">Headers</span>&nbsp;<span class="keyword" id="4698882">map</span><span class="op" id="4698885">[</span><span class="builtintype" id="4698886">string</span><span class="op" id="4698892">]</span><span class="builtintype" id="4698893">string</span>&nbsp;<span class="comment" id="4698900">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698922">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4698930">[</span><span class="op" id="4698931">]</span><span class="builtintype" id="4698932">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4698948">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="4699027">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4699030">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4699106">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4699182">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4699262">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="4699339">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4699352">func</span>&nbsp;<span class="ident" id="4699357">getLine</span><span class="op" id="4699364">(</span><span class="ident" id="4699365">data</span>&nbsp;<span class="op" id="4699370">[</span><span class="op" id="4699371">]</span><span class="builtintype" id="4699372">byte</span><span class="op" id="4699376">)</span>&nbsp;<span class="op" id="4699378">(</span><span class="ident" id="4699379">line</span><span class="op" id="4699383">,</span>&nbsp;<span class="ident" id="4699385">rest</span>&nbsp;<span class="op" id="4699390">[</span><span class="op" id="4699391">]</span><span class="builtintype" id="4699392">byte</span><span class="op" id="4699396">)</span>&nbsp;<span class="op" id="4699398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699401">i</span>&nbsp;<span class="op" id="4699403">:=</span>&nbsp;<span class="ident" id="4699406">bytes</span><span class="op" id="4699411">.</span><span class="ident" id="4699412">Index</span><span class="op" id="4699417">(</span><span class="ident" id="4699418">data</span><span class="op" id="4699422">,</span>&nbsp;<span class="op" id="4699424">[</span><span class="op" id="4699425">]</span><span class="builtintype" id="4699426">byte</span><span class="op" id="4699430">{</span><span class="string" id="4699431">&#39;\n&#39;</span><span class="op" id="4699435">}</span><span class="op" id="4699436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699439">var</span>&nbsp;<span class="ident" id="4699443">j</span>&nbsp;<span class="builtintype" id="4699445">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699450">if</span>&nbsp;<span class="ident" id="4699453">i</span>&nbsp;<span class="op" id="4699455">&lt;</span>&nbsp;<span class="num" id="4699457">0</span>&nbsp;<span class="op" id="4699459">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699463">i</span>&nbsp;<span class="op" id="4699465">=</span>&nbsp;<span class="builtinfunc" id="4699467">len</span><span class="op" id="4699470">(</span><span class="ident" id="4699471">data</span><span class="op" id="4699475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699479">j</span>&nbsp;<span class="op" id="4699481">=</span>&nbsp;<span class="ident" id="4699483">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699486">}</span>&nbsp;<span class="keyword" id="4699488">else</span>&nbsp;<span class="op" id="4699493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699497">j</span>&nbsp;<span class="op" id="4699499">=</span>&nbsp;<span class="ident" id="4699501">i</span>&nbsp;<span class="op" id="4699503">+</span>&nbsp;<span class="num" id="4699505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699509">if</span>&nbsp;<span class="ident" id="4699512">i</span>&nbsp;<span class="op" id="4699514">&gt;</span>&nbsp;<span class="num" id="4699516">0</span>&nbsp;<span class="op" id="4699518">&amp;&amp;</span>&nbsp;<span class="ident" id="4699521">data</span><span class="op" id="4699525">[</span><span class="ident" id="4699526">i</span><span class="op" id="4699527">-</span><span class="num" id="4699528">1</span><span class="op" id="4699529">]</span>&nbsp;<span class="op" id="4699531">==</span>&nbsp;<span class="string" id="4699534">&#39;\r&#39;</span>&nbsp;<span class="op" id="4699539">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699544">i</span><span class="op" id="4699545">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699556">return</span>&nbsp;<span class="ident" id="4699563">bytes</span><span class="op" id="4699568">.</span><span class="ident" id="4699569">TrimRight</span><span class="op" id="4699578">(</span><span class="ident" id="4699579">data</span><span class="op" id="4699583">[</span><span class="num" id="4699584">0</span><span class="op" id="4699585">:</span><span class="ident" id="4699586">i</span><span class="op" id="4699587">]</span><span class="op" id="4699588">,</span>&nbsp;<span class="string" id="4699590">&#34;&nbsp;\t&#34;</span><span class="op" id="4699595">)</span><span class="op" id="4699596">,</span>&nbsp;<span class="ident" id="4699598">data</span><span class="op" id="4699602">[</span><span class="ident" id="4699603">j</span><span class="op" id="4699604">:</span><span class="op" id="4699605">]</span><br>
<span class="lineno"></span><span class="op" id="4699607">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4699610">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4699683">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4699714">func</span>&nbsp;<span class="ident" id="4699719">removeWhitespace</span><span class="op" id="4699735">(</span><span class="ident" id="4699736">data</span>&nbsp;<span class="op" id="4699741">[</span><span class="op" id="4699742">]</span><span class="builtintype" id="4699743">byte</span><span class="op" id="4699747">)</span>&nbsp;<span class="op" id="4699749">[</span><span class="op" id="4699750">]</span><span class="builtintype" id="4699751">byte</span>&nbsp;<span class="op" id="4699756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699759">result</span>&nbsp;<span class="op" id="4699766">:=</span>&nbsp;<span class="builtinfunc" id="4699769">make</span><span class="op" id="4699773">(</span><span class="op" id="4699774">[</span><span class="op" id="4699775">]</span><span class="builtintype" id="4699776">byte</span><span class="op" id="4699780">,</span>&nbsp;<span class="builtinfunc" id="4699782">len</span><span class="op" id="4699785">(</span><span class="ident" id="4699786">data</span><span class="op" id="4699790">)</span><span class="op" id="4699791">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699794">n</span>&nbsp;<span class="op" id="4699796">:=</span>&nbsp;<span class="num" id="4699799">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699803">for</span>&nbsp;<span class="ident" id="4699807">_</span><span class="op" id="4699808">,</span>&nbsp;<span class="ident" id="4699810">b</span>&nbsp;<span class="op" id="4699812">:=</span>&nbsp;<span class="keyword" id="4699815">range</span>&nbsp;<span class="ident" id="4699821">data</span>&nbsp;<span class="op" id="4699826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699830">if</span>&nbsp;<span class="ident" id="4699833">b</span>&nbsp;<span class="op" id="4699835">==</span>&nbsp;<span class="string" id="4699838">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4699842">||</span>&nbsp;<span class="ident" id="4699845">b</span>&nbsp;<span class="op" id="4699847">==</span>&nbsp;<span class="string" id="4699850">&#39;\t&#39;</span>&nbsp;<span class="op" id="4699855">||</span>&nbsp;<span class="ident" id="4699858">b</span>&nbsp;<span class="op" id="4699860">==</span>&nbsp;<span class="string" id="4699863">&#39;\r&#39;</span>&nbsp;<span class="op" id="4699868">||</span>&nbsp;<span class="ident" id="4699871">b</span>&nbsp;<span class="op" id="4699873">==</span>&nbsp;<span class="string" id="4699876">&#39;\n&#39;</span>&nbsp;<span class="op" id="4699881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699886">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699901">result</span><span class="op" id="4699907">[</span><span class="ident" id="4699908">n</span><span class="op" id="4699909">]</span>&nbsp;<span class="op" id="4699911">=</span>&nbsp;<span class="ident" id="4699913">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699917">n</span><span class="op" id="4699918">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699926">return</span>&nbsp;<span class="ident" id="4699933">result</span><span class="op" id="4699939">[</span><span class="num" id="4699940">0</span><span class="op" id="4699941">:</span><span class="ident" id="4699942">n</span><span class="op" id="4699943">]</span><br>
<span class="lineno"></span><span class="op" id="4699945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4699948">var</span>&nbsp;<span class="ident" id="4699952">pemStart</span>&nbsp;<span class="op" id="4699961">=</span>&nbsp;<span class="op" id="4699963">[</span><span class="op" id="4699964">]</span><span class="builtintype" id="4699965">byte</span><span class="op" id="4699969">(</span><span class="string" id="4699970">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="4699985">)</span><br>
<span class="lineno"></span><span class="keyword" id="4699987">var</span>&nbsp;<span class="ident" id="4699991">pemEnd</span>&nbsp;<span class="op" id="4699998">=</span>&nbsp;<span class="op" id="4700000">[</span><span class="op" id="4700001">]</span><span class="builtintype" id="4700002">byte</span><span class="op" id="4700006">(</span><span class="string" id="4700007">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="4700020">)</span><br>
<span class="lineno">70</span><span class="keyword" id="4700022">var</span>&nbsp;<span class="ident" id="4700026">pemEndOfLine</span>&nbsp;<span class="op" id="4700039">=</span>&nbsp;<span class="op" id="4700041">[</span><span class="op" id="4700042">]</span><span class="builtintype" id="4700043">byte</span><span class="op" id="4700047">(</span><span class="string" id="4700048">&#34;-----&#34;</span><span class="op" id="4700055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700058">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="4700133">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4700212">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="4700288">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="4700297">func</span>&nbsp;<span class="ident" id="4700302">Decode</span><span class="op" id="4700308">(</span><span class="ident" id="4700309">data</span>&nbsp;<span class="op" id="4700314">[</span><span class="op" id="4700315">]</span><span class="builtintype" id="4700316">byte</span><span class="op" id="4700320">)</span>&nbsp;<span class="op" id="4700322">(</span><span class="ident" id="4700323">p</span>&nbsp;<span class="op" id="4700325">*</span><span class="ident" id="4700326">Block</span><span class="op" id="4700331">,</span>&nbsp;<span class="ident" id="4700333">rest</span>&nbsp;<span class="op" id="4700338">[</span><span class="op" id="4700339">]</span><span class="builtintype" id="4700340">byte</span><span class="op" id="4700344">)</span>&nbsp;<span class="op" id="4700346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700349">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700419">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700481">rest</span>&nbsp;<span class="op" id="4700486">=</span>&nbsp;<span class="ident" id="4700488">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700494">if</span>&nbsp;<span class="ident" id="4700497">bytes</span><span class="op" id="4700502">.</span><span class="ident" id="4700503">HasPrefix</span><span class="op" id="4700512">(</span><span class="ident" id="4700513">data</span><span class="op" id="4700517">,</span>&nbsp;<span class="ident" id="4700519">pemStart</span><span class="op" id="4700527">[</span><span class="num" id="4700528">1</span><span class="op" id="4700529">:</span><span class="op" id="4700530">]</span><span class="op" id="4700531">)</span>&nbsp;<span class="op" id="4700533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700537">rest</span>&nbsp;<span class="op" id="4700542">=</span>&nbsp;<span class="ident" id="4700544">rest</span><span class="op" id="4700548">[</span><span class="builtinfunc" id="4700549">len</span><span class="op" id="4700552">(</span><span class="ident" id="4700553">pemStart</span><span class="op" id="4700561">)</span><span class="op" id="4700562">-</span><span class="num" id="4700563">1</span>&nbsp;<span class="op" id="4700565">:</span>&nbsp;<span class="builtinfunc" id="4700567">len</span><span class="op" id="4700570">(</span><span class="ident" id="4700571">data</span><span class="op" id="4700575">)</span><span class="op" id="4700576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700579">}</span>&nbsp;<span class="keyword" id="4700581">else</span>&nbsp;<span class="keyword" id="4700586">if</span>&nbsp;<span class="ident" id="4700589">i</span>&nbsp;<span class="op" id="4700591">:=</span>&nbsp;<span class="ident" id="4700594">bytes</span><span class="op" id="4700599">.</span><span class="ident" id="4700600">Index</span><span class="op" id="4700605">(</span><span class="ident" id="4700606">data</span><span class="op" id="4700610">,</span>&nbsp;<span class="ident" id="4700612">pemStart</span><span class="op" id="4700620">)</span><span class="op" id="4700621">;</span>&nbsp;<span class="ident" id="4700623">i</span>&nbsp;<span class="op" id="4700625">&gt;=</span>&nbsp;<span class="num" id="4700628">0</span>&nbsp;<span class="op" id="4700630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700634">rest</span>&nbsp;<span class="op" id="4700639">=</span>&nbsp;<span class="ident" id="4700641">rest</span><span class="op" id="4700645">[</span><span class="ident" id="4700646">i</span><span class="op" id="4700647">+</span><span class="builtinfunc" id="4700648">len</span><span class="op" id="4700651">(</span><span class="ident" id="4700652">pemStart</span><span class="op" id="4700660">)</span>&nbsp;<span class="op" id="4700662">:</span>&nbsp;<span class="builtinfunc" id="4700664">len</span><span class="op" id="4700667">(</span><span class="ident" id="4700668">data</span><span class="op" id="4700672">)</span><span class="op" id="4700673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700676">}</span>&nbsp;<span class="keyword" id="4700678">else</span>&nbsp;<span class="op" id="4700683">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700687">return</span>&nbsp;<span class="ident" id="4700694">nil</span><span class="op" id="4700697">,</span>&nbsp;<span class="ident" id="4700699">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700709">typeLine</span><span class="op" id="4700717">,</span>&nbsp;<span class="ident" id="4700719">rest</span>&nbsp;<span class="op" id="4700724">:=</span>&nbsp;<span class="ident" id="4700727">getLine</span><span class="op" id="4700734">(</span><span class="ident" id="4700735">rest</span><span class="op" id="4700739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700742">if</span>&nbsp;<span class="op" id="4700745">!</span><span class="ident" id="4700746">bytes</span><span class="op" id="4700751">.</span><span class="ident" id="4700752">HasSuffix</span><span class="op" id="4700761">(</span><span class="ident" id="4700762">typeLine</span><span class="op" id="4700770">,</span>&nbsp;<span class="ident" id="4700772">pemEndOfLine</span><span class="op" id="4700784">)</span>&nbsp;<span class="op" id="4700786">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700790">return</span>&nbsp;<span class="ident" id="4700797">decodeError</span><span class="op" id="4700808">(</span><span class="ident" id="4700809">data</span><span class="op" id="4700813">,</span>&nbsp;<span class="ident" id="4700815">rest</span><span class="op" id="4700819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700825">typeLine</span>&nbsp;<span class="op" id="4700834">=</span>&nbsp;<span class="ident" id="4700836">typeLine</span><span class="op" id="4700844">[</span><span class="num" id="4700845">0</span>&nbsp;<span class="op" id="4700847">:</span>&nbsp;<span class="builtinfunc" id="4700849">len</span><span class="op" id="4700852">(</span><span class="ident" id="4700853">typeLine</span><span class="op" id="4700861">)</span><span class="op" id="4700862">-</span><span class="builtinfunc" id="4700863">len</span><span class="op" id="4700866">(</span><span class="ident" id="4700867">pemEndOfLine</span><span class="op" id="4700879">)</span><span class="op" id="4700880">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700884">p</span>&nbsp;<span class="op" id="4700886">=</span>&nbsp;<span class="op" id="4700888">&amp;</span><span class="ident" id="4700889">Block</span><span class="op" id="4700894">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700898">Headers</span><span class="op" id="4700905">:</span>&nbsp;<span class="builtinfunc" id="4700907">make</span><span class="op" id="4700911">(</span><span class="keyword" id="4700912">map</span><span class="op" id="4700915">[</span><span class="builtintype" id="4700916">string</span><span class="op" id="4700922">]</span><span class="builtintype" id="4700923">string</span><span class="op" id="4700929">)</span><span class="op" id="4700930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700934">Type</span><span class="op" id="4700938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4700943">string</span><span class="op" id="4700949">(</span><span class="ident" id="4700950">typeLine</span><span class="op" id="4700958">)</span><span class="op" id="4700959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700966">for</span>&nbsp;<span class="op" id="4700970">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700974">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701035">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701074">if</span>&nbsp;<span class="builtinfunc" id="4701077">len</span><span class="op" id="4701080">(</span><span class="ident" id="4701081">rest</span><span class="op" id="4701085">)</span>&nbsp;<span class="op" id="4701087">==</span>&nbsp;<span class="num" id="4701090">0</span>&nbsp;<span class="op" id="4701092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701097">return</span>&nbsp;<span class="ident" id="4701104">nil</span><span class="op" id="4701107">,</span>&nbsp;<span class="ident" id="4701109">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701116">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701120">line</span><span class="op" id="4701124">,</span>&nbsp;<span class="ident" id="4701126">next</span>&nbsp;<span class="op" id="4701131">:=</span>&nbsp;<span class="ident" id="4701134">getLine</span><span class="op" id="4701141">(</span><span class="ident" id="4701142">rest</span><span class="op" id="4701146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701151">i</span>&nbsp;<span class="op" id="4701153">:=</span>&nbsp;<span class="ident" id="4701156">bytes</span><span class="op" id="4701161">.</span><span class="ident" id="4701162">Index</span><span class="op" id="4701167">(</span><span class="ident" id="4701168">line</span><span class="op" id="4701172">,</span>&nbsp;<span class="op" id="4701174">[</span><span class="op" id="4701175">]</span><span class="builtintype" id="4701176">byte</span><span class="op" id="4701180">{</span><span class="string" id="4701181">&#39;:&#39;</span><span class="op" id="4701184">}</span><span class="op" id="4701185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701189">if</span>&nbsp;<span class="ident" id="4701192">i</span>&nbsp;<span class="op" id="4701194">==</span>&nbsp;<span class="op" id="4701197">-</span><span class="num" id="4701198">1</span>&nbsp;<span class="op" id="4701200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701205">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701218">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701285">key</span><span class="op" id="4701288">,</span>&nbsp;<span class="ident" id="4701290">val</span>&nbsp;<span class="op" id="4701294">:=</span>&nbsp;<span class="ident" id="4701297">line</span><span class="op" id="4701301">[</span><span class="num" id="4701302">0</span><span class="op" id="4701303">:</span><span class="ident" id="4701304">i</span><span class="op" id="4701305">]</span><span class="op" id="4701306">,</span>&nbsp;<span class="ident" id="4701308">line</span><span class="op" id="4701312">[</span><span class="ident" id="4701313">i</span><span class="op" id="4701314">+</span><span class="num" id="4701315">1</span><span class="op" id="4701316">:</span><span class="op" id="4701317">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701321">key</span>&nbsp;<span class="op" id="4701325">=</span>&nbsp;<span class="ident" id="4701327">bytes</span><span class="op" id="4701332">.</span><span class="ident" id="4701333">TrimSpace</span><span class="op" id="4701342">(</span><span class="ident" id="4701343">key</span><span class="op" id="4701346">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701350">val</span>&nbsp;<span class="op" id="4701354">=</span>&nbsp;<span class="ident" id="4701356">bytes</span><span class="op" id="4701361">.</span><span class="ident" id="4701362">TrimSpace</span><span class="op" id="4701371">(</span><span class="ident" id="4701372">val</span><span class="op" id="4701375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701379">p</span><span class="op" id="4701380">.</span><span class="ident" id="4701381">Headers</span><span class="op" id="4701388">[</span><span class="builtintype" id="4701389">string</span><span class="op" id="4701395">(</span><span class="ident" id="4701396">key</span><span class="op" id="4701399">)</span><span class="op" id="4701400">]</span>&nbsp;<span class="op" id="4701402">=</span>&nbsp;<span class="builtintype" id="4701404">string</span><span class="op" id="4701410">(</span><span class="ident" id="4701411">val</span><span class="op" id="4701414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701418">rest</span>&nbsp;<span class="op" id="4701423">=</span>&nbsp;<span class="ident" id="4701425">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701435">i</span>&nbsp;<span class="op" id="4701437">:=</span>&nbsp;<span class="ident" id="4701440">bytes</span><span class="op" id="4701445">.</span><span class="ident" id="4701446">Index</span><span class="op" id="4701451">(</span><span class="ident" id="4701452">rest</span><span class="op" id="4701456">,</span>&nbsp;<span class="ident" id="4701458">pemEnd</span><span class="op" id="4701464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701467">if</span>&nbsp;<span class="ident" id="4701470">i</span>&nbsp;<span class="op" id="4701472">&lt;</span>&nbsp;<span class="num" id="4701474">0</span>&nbsp;<span class="op" id="4701476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701480">return</span>&nbsp;<span class="ident" id="4701487">decodeError</span><span class="op" id="4701498">(</span><span class="ident" id="4701499">data</span><span class="op" id="4701503">,</span>&nbsp;<span class="ident" id="4701505">rest</span><span class="op" id="4701509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701515">base64Data</span>&nbsp;<span class="op" id="4701526">:=</span>&nbsp;<span class="ident" id="4701529">removeWhitespace</span><span class="op" id="4701545">(</span><span class="ident" id="4701546">rest</span><span class="op" id="4701550">[</span><span class="num" id="4701551">0</span><span class="op" id="4701552">:</span><span class="ident" id="4701553">i</span><span class="op" id="4701554">]</span><span class="op" id="4701555">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701559">p</span><span class="op" id="4701560">.</span><span class="ident" id="4701561">Bytes</span>&nbsp;<span class="op" id="4701567">=</span>&nbsp;<span class="builtinfunc" id="4701569">make</span><span class="op" id="4701573">(</span><span class="op" id="4701574">[</span><span class="op" id="4701575">]</span><span class="builtintype" id="4701576">byte</span><span class="op" id="4701580">,</span>&nbsp;<span class="ident" id="4701582">base64</span><span class="op" id="4701588">.</span><span class="ident" id="4701589">StdEncoding</span><span class="op" id="4701600">.</span><span class="ident" id="4701601">DecodedLen</span><span class="op" id="4701611">(</span><span class="builtinfunc" id="4701612">len</span><span class="op" id="4701615">(</span><span class="ident" id="4701616">base64Data</span><span class="op" id="4701626">)</span><span class="op" id="4701627">)</span><span class="op" id="4701628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701631">n</span><span class="op" id="4701632">,</span>&nbsp;<span class="ident" id="4701634">err</span>&nbsp;<span class="op" id="4701638">:=</span>&nbsp;<span class="ident" id="4701641">base64</span><span class="op" id="4701647">.</span><span class="ident" id="4701648">StdEncoding</span><span class="op" id="4701659">.</span><span class="ident" id="4701660">Decode</span><span class="op" id="4701666">(</span><span class="ident" id="4701667">p</span><span class="op" id="4701668">.</span><span class="ident" id="4701669">Bytes</span><span class="op" id="4701674">,</span>&nbsp;<span class="ident" id="4701676">base64Data</span><span class="op" id="4701686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701689">if</span>&nbsp;<span class="ident" id="4701692">err</span>&nbsp;<span class="op" id="4701696">!=</span>&nbsp;<span class="ident" id="4701699">nil</span>&nbsp;<span class="op" id="4701703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701707">return</span>&nbsp;<span class="ident" id="4701714">decodeError</span><span class="op" id="4701725">(</span><span class="ident" id="4701726">data</span><span class="op" id="4701730">,</span>&nbsp;<span class="ident" id="4701732">rest</span><span class="op" id="4701736">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701742">p</span><span class="op" id="4701743">.</span><span class="ident" id="4701744">Bytes</span>&nbsp;<span class="op" id="4701750">=</span>&nbsp;<span class="ident" id="4701752">p</span><span class="op" id="4701753">.</span><span class="ident" id="4701754">Bytes</span><span class="op" id="4701759">[</span><span class="num" id="4701760">0</span><span class="op" id="4701761">:</span><span class="ident" id="4701762">n</span><span class="op" id="4701763">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701767">_</span><span class="op" id="4701768">,</span>&nbsp;<span class="ident" id="4701770">rest</span>&nbsp;<span class="op" id="4701775">=</span>&nbsp;<span class="ident" id="4701777">getLine</span><span class="op" id="4701784">(</span><span class="ident" id="4701785">rest</span><span class="op" id="4701789">[</span><span class="ident" id="4701790">i</span><span class="op" id="4701791">+</span><span class="builtinfunc" id="4701792">len</span><span class="op" id="4701795">(</span><span class="ident" id="4701796">pemEnd</span><span class="op" id="4701802">)</span><span class="op" id="4701803">:</span><span class="op" id="4701804">]</span><span class="op" id="4701805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701809">return</span><br>
<span class="lineno"></span><span class="op" id="4701816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701819">func</span>&nbsp;<span class="ident" id="4701824">decodeError</span><span class="op" id="4701835">(</span><span class="ident" id="4701836">data</span><span class="op" id="4701840">,</span>&nbsp;<span class="ident" id="4701842">rest</span>&nbsp;<span class="op" id="4701847">[</span><span class="op" id="4701848">]</span><span class="builtintype" id="4701849">byte</span><span class="op" id="4701853">)</span>&nbsp;<span class="op" id="4701855">(</span><span class="op" id="4701856">*</span><span class="ident" id="4701857">Block</span><span class="op" id="4701862">,</span>&nbsp;<span class="op" id="4701864">[</span><span class="op" id="4701865">]</span><span class="builtintype" id="4701866">byte</span><span class="op" id="4701870">)</span>&nbsp;<span class="op" id="4701872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701875">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701938">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702005">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702078">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702147">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702218">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702291">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702350">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702354">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702387">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702391">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702430">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702474">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702511">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702515">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702551">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702567">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702601">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702605">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702658">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702715">p</span><span class="op" id="4702716">,</span>&nbsp;<span class="ident" id="4702718">rest</span>&nbsp;<span class="op" id="4702723">:=</span>&nbsp;<span class="ident" id="4702726">Decode</span><span class="op" id="4702732">(</span><span class="ident" id="4702733">rest</span><span class="op" id="4702737">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702740">if</span>&nbsp;<span class="ident" id="4702743">p</span>&nbsp;<span class="op" id="4702745">==</span>&nbsp;<span class="ident" id="4702748">nil</span>&nbsp;<span class="op" id="4702752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702756">rest</span>&nbsp;<span class="op" id="4702761">=</span>&nbsp;<span class="ident" id="4702763">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702772">return</span>&nbsp;<span class="ident" id="4702779">p</span><span class="op" id="4702780">,</span>&nbsp;<span class="ident" id="4702782">rest</span><br>
<span class="lineno"></span><span class="op" id="4702787">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4702790">const</span>&nbsp;<span class="ident" id="4702796">pemLineLength</span>&nbsp;<span class="op" id="4702810">=</span>&nbsp;<span class="num" id="4702812">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702816">type</span>&nbsp;<span class="ident" id="4702821">lineBreaker</span>&nbsp;<span class="keyword" id="4702833">struct</span>&nbsp;<span class="op" id="4702840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702843">line</span>&nbsp;<span class="op" id="4702848">[</span><span class="ident" id="4702849">pemLineLength</span><span class="op" id="4702862">]</span><span class="builtintype" id="4702863">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702869">used</span>&nbsp;<span class="builtintype" id="4702874">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702879">out</span>&nbsp;&nbsp;<span class="ident" id="4702884">io</span><span class="op" id="4702886">.</span><span class="ident" id="4702887">Writer</span><br>
<span class="lineno"></span><span class="op" id="4702894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702897">func</span>&nbsp;<span class="op" id="4702902">(</span><span class="ident" id="4702903">l</span>&nbsp;<span class="op" id="4702905">*</span><span class="ident" id="4702906">lineBreaker</span><span class="op" id="4702917">)</span>&nbsp;<span class="ident" id="4702919">Write</span><span class="op" id="4702924">(</span><span class="ident" id="4702925">b</span>&nbsp;<span class="op" id="4702927">[</span><span class="op" id="4702928">]</span><span class="builtintype" id="4702929">byte</span><span class="op" id="4702933">)</span>&nbsp;<span class="op" id="4702935">(</span><span class="ident" id="4702936">n</span>&nbsp;<span class="builtintype" id="4702938">int</span><span class="op" id="4702941">,</span>&nbsp;<span class="ident" id="4702943">err</span>&nbsp;<span class="builtintype" id="4702947">error</span><span class="op" id="4702952">)</span>&nbsp;<span class="op" id="4702954">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702957">if</span>&nbsp;<span class="ident" id="4702960">l</span><span class="op" id="4702961">.</span><span class="ident" id="4702962">used</span><span class="op" id="4702966">+</span><span class="builtinfunc" id="4702967">len</span><span class="op" id="4702970">(</span><span class="ident" id="4702971">b</span><span class="op" id="4702972">)</span>&nbsp;<span class="op" id="4702974">&lt;</span>&nbsp;<span class="ident" id="4702976">pemLineLength</span>&nbsp;<span class="op" id="4702990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4702994">copy</span><span class="op" id="4702998">(</span><span class="ident" id="4702999">l</span><span class="op" id="4703000">.</span><span class="ident" id="4703001">line</span><span class="op" id="4703005">[</span><span class="ident" id="4703006">l</span><span class="op" id="4703007">.</span><span class="ident" id="4703008">used</span><span class="op" id="4703012">:</span><span class="op" id="4703013">]</span><span class="op" id="4703014">,</span>&nbsp;<span class="ident" id="4703016">b</span><span class="op" id="4703017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703021">l</span><span class="op" id="4703022">.</span><span class="ident" id="4703023">used</span>&nbsp;<span class="op" id="4703028">+=</span>&nbsp;<span class="builtinfunc" id="4703031">len</span><span class="op" id="4703034">(</span><span class="ident" id="4703035">b</span><span class="op" id="4703036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703040">return</span>&nbsp;<span class="builtinfunc" id="4703047">len</span><span class="op" id="4703050">(</span><span class="ident" id="4703051">b</span><span class="op" id="4703052">)</span><span class="op" id="4703053">,</span>&nbsp;<span class="ident" id="4703055">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703060">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703064">n</span><span class="op" id="4703065">,</span>&nbsp;<span class="ident" id="4703067">err</span>&nbsp;<span class="op" id="4703071">=</span>&nbsp;<span class="ident" id="4703073">l</span><span class="op" id="4703074">.</span><span class="ident" id="4703075">out</span><span class="op" id="4703078">.</span><span class="ident" id="4703079">Write</span><span class="op" id="4703084">(</span><span class="ident" id="4703085">l</span><span class="op" id="4703086">.</span><span class="ident" id="4703087">line</span><span class="op" id="4703091">[</span><span class="num" id="4703092">0</span><span class="op" id="4703093">:</span><span class="ident" id="4703094">l</span><span class="op" id="4703095">.</span><span class="ident" id="4703096">used</span><span class="op" id="4703100">]</span><span class="op" id="4703101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703104">if</span>&nbsp;<span class="ident" id="4703107">err</span>&nbsp;<span class="op" id="4703111">!=</span>&nbsp;<span class="ident" id="4703114">nil</span>&nbsp;<span class="op" id="4703118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703130">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703133">excess</span>&nbsp;<span class="op" id="4703140">:=</span>&nbsp;<span class="ident" id="4703143">pemLineLength</span>&nbsp;<span class="op" id="4703157">-</span>&nbsp;<span class="ident" id="4703159">l</span><span class="op" id="4703160">.</span><span class="ident" id="4703161">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703167">l</span><span class="op" id="4703168">.</span><span class="ident" id="4703169">used</span>&nbsp;<span class="op" id="4703174">=</span>&nbsp;<span class="num" id="4703176">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703180">n</span><span class="op" id="4703181">,</span>&nbsp;<span class="ident" id="4703183">err</span>&nbsp;<span class="op" id="4703187">=</span>&nbsp;<span class="ident" id="4703189">l</span><span class="op" id="4703190">.</span><span class="ident" id="4703191">out</span><span class="op" id="4703194">.</span><span class="ident" id="4703195">Write</span><span class="op" id="4703200">(</span><span class="ident" id="4703201">b</span><span class="op" id="4703202">[</span><span class="num" id="4703203">0</span><span class="op" id="4703204">:</span><span class="ident" id="4703205">excess</span><span class="op" id="4703211">]</span><span class="op" id="4703212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703215">if</span>&nbsp;<span class="ident" id="4703218">err</span>&nbsp;<span class="op" id="4703222">!=</span>&nbsp;<span class="ident" id="4703225">nil</span>&nbsp;<span class="op" id="4703229">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703233">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703245">n</span><span class="op" id="4703246">,</span>&nbsp;<span class="ident" id="4703248">err</span>&nbsp;<span class="op" id="4703252">=</span>&nbsp;<span class="ident" id="4703254">l</span><span class="op" id="4703255">.</span><span class="ident" id="4703256">out</span><span class="op" id="4703259">.</span><span class="ident" id="4703260">Write</span><span class="op" id="4703265">(</span><span class="op" id="4703266">[</span><span class="op" id="4703267">]</span><span class="builtintype" id="4703268">byte</span><span class="op" id="4703272">{</span><span class="string" id="4703273">&#39;\n&#39;</span><span class="op" id="4703277">}</span><span class="op" id="4703278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703281">if</span>&nbsp;<span class="ident" id="4703284">err</span>&nbsp;<span class="op" id="4703288">!=</span>&nbsp;<span class="ident" id="4703291">nil</span>&nbsp;<span class="op" id="4703295">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703299">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703311">return</span>&nbsp;<span class="ident" id="4703318">l</span><span class="op" id="4703319">.</span><span class="ident" id="4703320">Write</span><span class="op" id="4703325">(</span><span class="ident" id="4703326">b</span><span class="op" id="4703327">[</span><span class="ident" id="4703328">excess</span><span class="op" id="4703334">:</span><span class="op" id="4703335">]</span><span class="op" id="4703336">)</span><br>
<span class="lineno"></span><span class="op" id="4703338">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="4703341">func</span>&nbsp;<span class="op" id="4703346">(</span><span class="ident" id="4703347">l</span>&nbsp;<span class="op" id="4703349">*</span><span class="ident" id="4703350">lineBreaker</span><span class="op" id="4703361">)</span>&nbsp;<span class="ident" id="4703363">Close</span><span class="op" id="4703368">(</span><span class="op" id="4703369">)</span>&nbsp;<span class="op" id="4703371">(</span><span class="ident" id="4703372">err</span>&nbsp;<span class="builtintype" id="4703376">error</span><span class="op" id="4703381">)</span>&nbsp;<span class="op" id="4703383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703386">if</span>&nbsp;<span class="ident" id="4703389">l</span><span class="op" id="4703390">.</span><span class="ident" id="4703391">used</span>&nbsp;<span class="op" id="4703396">&gt;</span>&nbsp;<span class="num" id="4703398">0</span>&nbsp;<span class="op" id="4703400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703404">_</span><span class="op" id="4703405">,</span>&nbsp;<span class="ident" id="4703407">err</span>&nbsp;<span class="op" id="4703411">=</span>&nbsp;<span class="ident" id="4703413">l</span><span class="op" id="4703414">.</span><span class="ident" id="4703415">out</span><span class="op" id="4703418">.</span><span class="ident" id="4703419">Write</span><span class="op" id="4703424">(</span><span class="ident" id="4703425">l</span><span class="op" id="4703426">.</span><span class="ident" id="4703427">line</span><span class="op" id="4703431">[</span><span class="num" id="4703432">0</span><span class="op" id="4703433">:</span><span class="ident" id="4703434">l</span><span class="op" id="4703435">.</span><span class="ident" id="4703436">used</span><span class="op" id="4703440">]</span><span class="op" id="4703441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703445">if</span>&nbsp;<span class="ident" id="4703448">err</span>&nbsp;<span class="op" id="4703452">!=</span>&nbsp;<span class="ident" id="4703455">nil</span>&nbsp;<span class="op" id="4703459">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703464">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703477">_</span><span class="op" id="4703478">,</span>&nbsp;<span class="ident" id="4703480">err</span>&nbsp;<span class="op" id="4703484">=</span>&nbsp;<span class="ident" id="4703486">l</span><span class="op" id="4703487">.</span><span class="ident" id="4703488">out</span><span class="op" id="4703491">.</span><span class="ident" id="4703492">Write</span><span class="op" id="4703497">(</span><span class="op" id="4703498">[</span><span class="op" id="4703499">]</span><span class="builtintype" id="4703500">byte</span><span class="op" id="4703504">{</span><span class="string" id="4703505">&#39;\n&#39;</span><span class="op" id="4703509">}</span><span class="op" id="4703510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703517">return</span><br>
<span class="lineno"></span><span class="op" id="4703524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4703527">func</span>&nbsp;<span class="ident" id="4703532">writeHeader</span><span class="op" id="4703543">(</span><span class="ident" id="4703544">out</span>&nbsp;<span class="ident" id="4703548">io</span><span class="op" id="4703550">.</span><span class="ident" id="4703551">Writer</span><span class="op" id="4703557">,</span>&nbsp;<span class="ident" id="4703559">k</span><span class="op" id="4703560">,</span>&nbsp;<span class="ident" id="4703562">v</span>&nbsp;<span class="builtintype" id="4703564">string</span><span class="op" id="4703570">)</span>&nbsp;<span class="builtintype" id="4703572">error</span>&nbsp;<span class="op" id="4703578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703581">_</span><span class="op" id="4703582">,</span>&nbsp;<span class="ident" id="4703584">err</span>&nbsp;<span class="op" id="4703588">:=</span>&nbsp;<span class="ident" id="4703591">out</span><span class="op" id="4703594">.</span><span class="ident" id="4703595">Write</span><span class="op" id="4703600">(</span><span class="op" id="4703601">[</span><span class="op" id="4703602">]</span><span class="builtintype" id="4703603">byte</span><span class="op" id="4703607">(</span><span class="ident" id="4703608">k</span>&nbsp;<span class="op" id="4703610">+</span>&nbsp;<span class="string" id="4703612">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4703617">+</span>&nbsp;<span class="ident" id="4703619">v</span>&nbsp;<span class="op" id="4703621">+</span>&nbsp;<span class="string" id="4703623">&#34;\n&#34;</span><span class="op" id="4703627">)</span><span class="op" id="4703628">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703631">return</span>&nbsp;<span class="ident" id="4703638">err</span><br>
<span class="lineno"></span><span class="op" id="4703642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4703645">func</span>&nbsp;<span class="ident" id="4703650">Encode</span><span class="op" id="4703656">(</span><span class="ident" id="4703657">out</span>&nbsp;<span class="ident" id="4703661">io</span><span class="op" id="4703663">.</span><span class="ident" id="4703664">Writer</span><span class="op" id="4703670">,</span>&nbsp;<span class="ident" id="4703672">b</span>&nbsp;<span class="op" id="4703674">*</span><span class="ident" id="4703675">Block</span><span class="op" id="4703680">)</span>&nbsp;<span class="builtintype" id="4703682">error</span>&nbsp;<span class="op" id="4703688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703691">if</span>&nbsp;<span class="ident" id="4703694">_</span><span class="op" id="4703695">,</span>&nbsp;<span class="ident" id="4703697">err</span>&nbsp;<span class="op" id="4703701">:=</span>&nbsp;<span class="ident" id="4703704">out</span><span class="op" id="4703707">.</span><span class="ident" id="4703708">Write</span><span class="op" id="4703713">(</span><span class="ident" id="4703714">pemStart</span><span class="op" id="4703722">[</span><span class="num" id="4703723">1</span><span class="op" id="4703724">:</span><span class="op" id="4703725">]</span><span class="op" id="4703726">)</span><span class="op" id="4703727">;</span>&nbsp;<span class="ident" id="4703729">err</span>&nbsp;<span class="op" id="4703733">!=</span>&nbsp;<span class="ident" id="4703736">nil</span>&nbsp;<span class="op" id="4703740">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703744">return</span>&nbsp;<span class="ident" id="4703751">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703759">if</span>&nbsp;<span class="ident" id="4703762">_</span><span class="op" id="4703763">,</span>&nbsp;<span class="ident" id="4703765">err</span>&nbsp;<span class="op" id="4703769">:=</span>&nbsp;<span class="ident" id="4703772">out</span><span class="op" id="4703775">.</span><span class="ident" id="4703776">Write</span><span class="op" id="4703781">(</span><span class="op" id="4703782">[</span><span class="op" id="4703783">]</span><span class="builtintype" id="4703784">byte</span><span class="op" id="4703788">(</span><span class="ident" id="4703789">b</span><span class="op" id="4703790">.</span><span class="ident" id="4703791">Type</span>&nbsp;<span class="op" id="4703796">+</span>&nbsp;<span class="string" id="4703798">&#34;-----\n&#34;</span><span class="op" id="4703807">)</span><span class="op" id="4703808">)</span><span class="op" id="4703809">;</span>&nbsp;<span class="ident" id="4703811">err</span>&nbsp;<span class="op" id="4703815">!=</span>&nbsp;<span class="ident" id="4703818">nil</span>&nbsp;<span class="op" id="4703822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703826">return</span>&nbsp;<span class="ident" id="4703833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703838">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703842">if</span>&nbsp;<span class="builtinfunc" id="4703845">len</span><span class="op" id="4703848">(</span><span class="ident" id="4703849">b</span><span class="op" id="4703850">.</span><span class="ident" id="4703851">Headers</span><span class="op" id="4703858">)</span>&nbsp;<span class="op" id="4703860">&gt;</span>&nbsp;<span class="num" id="4703862">0</span>&nbsp;<span class="op" id="4703864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703868">const</span>&nbsp;<span class="ident" id="4703874">procType</span>&nbsp;<span class="op" id="4703883">=</span>&nbsp;<span class="string" id="4703885">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703899">h</span>&nbsp;<span class="op" id="4703901">:=</span>&nbsp;<span class="builtinfunc" id="4703904">make</span><span class="op" id="4703908">(</span><span class="op" id="4703909">[</span><span class="op" id="4703910">]</span><span class="builtintype" id="4703911">string</span><span class="op" id="4703917">,</span>&nbsp;<span class="num" id="4703919">0</span><span class="op" id="4703920">,</span>&nbsp;<span class="builtinfunc" id="4703922">len</span><span class="op" id="4703925">(</span><span class="ident" id="4703926">b</span><span class="op" id="4703927">.</span><span class="ident" id="4703928">Headers</span><span class="op" id="4703935">)</span><span class="op" id="4703936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703940">hasProcType</span>&nbsp;<span class="op" id="4703952">:=</span>&nbsp;<span class="builtintype" id="4703955">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703963">for</span>&nbsp;<span class="ident" id="4703967">k</span>&nbsp;<span class="op" id="4703969">:=</span>&nbsp;<span class="keyword" id="4703972">range</span>&nbsp;<span class="ident" id="4703978">b</span><span class="op" id="4703979">.</span><span class="ident" id="4703980">Headers</span>&nbsp;<span class="op" id="4703988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703993">if</span>&nbsp;<span class="ident" id="4703996">k</span>&nbsp;<span class="op" id="4703998">==</span>&nbsp;<span class="ident" id="4704001">procType</span>&nbsp;<span class="op" id="4704010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704016">hasProcType</span>&nbsp;<span class="op" id="4704028">=</span>&nbsp;<span class="builtintype" id="4704030">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704039">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704051">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704056">h</span>&nbsp;<span class="op" id="4704058">=</span>&nbsp;<span class="builtinfunc" id="4704060">append</span><span class="op" id="4704066">(</span><span class="ident" id="4704067">h</span><span class="op" id="4704068">,</span>&nbsp;<span class="ident" id="4704070">k</span><span class="op" id="4704071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704079">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704128">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704163">if</span>&nbsp;<span class="ident" id="4704166">hasProcType</span>&nbsp;<span class="op" id="4704178">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704183">if</span>&nbsp;<span class="ident" id="4704186">err</span>&nbsp;<span class="op" id="4704190">:=</span>&nbsp;<span class="ident" id="4704193">writeHeader</span><span class="op" id="4704204">(</span><span class="ident" id="4704205">out</span><span class="op" id="4704208">,</span>&nbsp;<span class="ident" id="4704210">procType</span><span class="op" id="4704218">,</span>&nbsp;<span class="ident" id="4704220">b</span><span class="op" id="4704221">.</span><span class="ident" id="4704222">Headers</span><span class="op" id="4704229">[</span><span class="ident" id="4704230">procType</span><span class="op" id="4704238">]</span><span class="op" id="4704239">)</span><span class="op" id="4704240">;</span>&nbsp;<span class="ident" id="4704242">err</span>&nbsp;<span class="op" id="4704246">!=</span>&nbsp;<span class="ident" id="4704249">nil</span>&nbsp;<span class="op" id="4704253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704259">return</span>&nbsp;<span class="ident" id="4704266">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704281">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704348">sort</span><span class="op" id="4704352">.</span><span class="ident" id="4704353">Strings</span><span class="op" id="4704360">(</span><span class="ident" id="4704361">h</span><span class="op" id="4704362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704366">for</span>&nbsp;<span class="ident" id="4704370">_</span><span class="op" id="4704371">,</span>&nbsp;<span class="ident" id="4704373">k</span>&nbsp;<span class="op" id="4704375">:=</span>&nbsp;<span class="keyword" id="4704378">range</span>&nbsp;<span class="ident" id="4704384">h</span>&nbsp;<span class="op" id="4704386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704391">if</span>&nbsp;<span class="ident" id="4704394">err</span>&nbsp;<span class="op" id="4704398">:=</span>&nbsp;<span class="ident" id="4704401">writeHeader</span><span class="op" id="4704412">(</span><span class="ident" id="4704413">out</span><span class="op" id="4704416">,</span>&nbsp;<span class="ident" id="4704418">k</span><span class="op" id="4704419">,</span>&nbsp;<span class="ident" id="4704421">b</span><span class="op" id="4704422">.</span><span class="ident" id="4704423">Headers</span><span class="op" id="4704430">[</span><span class="ident" id="4704431">k</span><span class="op" id="4704432">]</span><span class="op" id="4704433">)</span><span class="op" id="4704434">;</span>&nbsp;<span class="ident" id="4704436">err</span>&nbsp;<span class="op" id="4704440">!=</span>&nbsp;<span class="ident" id="4704443">nil</span>&nbsp;<span class="op" id="4704447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704453">return</span>&nbsp;<span class="ident" id="4704460">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704467">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704475">if</span>&nbsp;<span class="ident" id="4704478">_</span><span class="op" id="4704479">,</span>&nbsp;<span class="ident" id="4704481">err</span>&nbsp;<span class="op" id="4704485">:=</span>&nbsp;<span class="ident" id="4704488">out</span><span class="op" id="4704491">.</span><span class="ident" id="4704492">Write</span><span class="op" id="4704497">(</span><span class="op" id="4704498">[</span><span class="op" id="4704499">]</span><span class="builtintype" id="4704500">byte</span><span class="op" id="4704504">{</span><span class="string" id="4704505">&#39;\n&#39;</span><span class="op" id="4704509">}</span><span class="op" id="4704510">)</span><span class="op" id="4704511">;</span>&nbsp;<span class="ident" id="4704513">err</span>&nbsp;<span class="op" id="4704517">!=</span>&nbsp;<span class="ident" id="4704520">nil</span>&nbsp;<span class="op" id="4704524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704529">return</span>&nbsp;<span class="ident" id="4704536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704545">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704549">var</span>&nbsp;<span class="ident" id="4704553">breaker</span>&nbsp;<span class="ident" id="4704561">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704574">breaker</span><span class="op" id="4704581">.</span><span class="ident" id="4704582">out</span>&nbsp;<span class="op" id="4704586">=</span>&nbsp;<span class="ident" id="4704588">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704594">b64</span>&nbsp;<span class="op" id="4704598">:=</span>&nbsp;<span class="ident" id="4704601">base64</span><span class="op" id="4704607">.</span><span class="ident" id="4704608">NewEncoder</span><span class="op" id="4704618">(</span><span class="ident" id="4704619">base64</span><span class="op" id="4704625">.</span><span class="ident" id="4704626">StdEncoding</span><span class="op" id="4704637">,</span>&nbsp;<span class="op" id="4704639">&amp;</span><span class="ident" id="4704640">breaker</span><span class="op" id="4704647">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704650">if</span>&nbsp;<span class="ident" id="4704653">_</span><span class="op" id="4704654">,</span>&nbsp;<span class="ident" id="4704656">err</span>&nbsp;<span class="op" id="4704660">:=</span>&nbsp;<span class="ident" id="4704663">b64</span><span class="op" id="4704666">.</span><span class="ident" id="4704667">Write</span><span class="op" id="4704672">(</span><span class="ident" id="4704673">b</span><span class="op" id="4704674">.</span><span class="ident" id="4704675">Bytes</span><span class="op" id="4704680">)</span><span class="op" id="4704681">;</span>&nbsp;<span class="ident" id="4704683">err</span>&nbsp;<span class="op" id="4704687">!=</span>&nbsp;<span class="ident" id="4704690">nil</span>&nbsp;<span class="op" id="4704694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704698">return</span>&nbsp;<span class="ident" id="4704705">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704713">b64</span><span class="op" id="4704716">.</span><span class="ident" id="4704717">Close</span><span class="op" id="4704722">(</span><span class="op" id="4704723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704726">breaker</span><span class="op" id="4704733">.</span><span class="ident" id="4704734">Close</span><span class="op" id="4704739">(</span><span class="op" id="4704740">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704744">if</span>&nbsp;<span class="ident" id="4704747">_</span><span class="op" id="4704748">,</span>&nbsp;<span class="ident" id="4704750">err</span>&nbsp;<span class="op" id="4704754">:=</span>&nbsp;<span class="ident" id="4704757">out</span><span class="op" id="4704760">.</span><span class="ident" id="4704761">Write</span><span class="op" id="4704766">(</span><span class="ident" id="4704767">pemEnd</span><span class="op" id="4704773">[</span><span class="num" id="4704774">1</span><span class="op" id="4704775">:</span><span class="op" id="4704776">]</span><span class="op" id="4704777">)</span><span class="op" id="4704778">;</span>&nbsp;<span class="ident" id="4704780">err</span>&nbsp;<span class="op" id="4704784">!=</span>&nbsp;<span class="ident" id="4704787">nil</span>&nbsp;<span class="op" id="4704791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704795">return</span>&nbsp;<span class="ident" id="4704802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704810">_</span><span class="op" id="4704811">,</span>&nbsp;<span class="ident" id="4704813">err</span>&nbsp;<span class="op" id="4704817">:=</span>&nbsp;<span class="ident" id="4704820">out</span><span class="op" id="4704823">.</span><span class="ident" id="4704824">Write</span><span class="op" id="4704829">(</span><span class="op" id="4704830">[</span><span class="op" id="4704831">]</span><span class="builtintype" id="4704832">byte</span><span class="op" id="4704836">(</span><span class="ident" id="4704837">b</span><span class="op" id="4704838">.</span><span class="ident" id="4704839">Type</span>&nbsp;<span class="op" id="4704844">+</span>&nbsp;<span class="string" id="4704846">&#34;-----\n&#34;</span><span class="op" id="4704855">)</span><span class="op" id="4704856">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704859">return</span>&nbsp;<span class="ident" id="4704866">err</span><br>
<span class="lineno"></span><span class="op" id="4704870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4704873">func</span>&nbsp;<span class="ident" id="4704878">EncodeToMemory</span><span class="op" id="4704892">(</span><span class="ident" id="4704893">b</span>&nbsp;<span class="op" id="4704895">*</span><span class="ident" id="4704896">Block</span><span class="op" id="4704901">)</span>&nbsp;<span class="op" id="4704903">[</span><span class="op" id="4704904">]</span><span class="builtintype" id="4704905">byte</span>&nbsp;<span class="op" id="4704910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704913">var</span>&nbsp;<span class="ident" id="4704917">buf</span>&nbsp;<span class="ident" id="4704921">bytes</span><span class="op" id="4704926">.</span><span class="ident" id="4704927">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704935">Encode</span><span class="op" id="4704941">(</span><span class="op" id="4704942">&amp;</span><span class="ident" id="4704943">buf</span><span class="op" id="4704946">,</span>&nbsp;<span class="ident" id="4704948">b</span><span class="op" id="4704949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704952">return</span>&nbsp;<span class="ident" id="4704959">buf</span><span class="op" id="4704962">.</span><span class="ident" id="4704963">Bytes</span><span class="op" id="4704968">(</span><span class="op" id="4704969">)</span><br>
<span class="lineno"></span><span class="op" id="4704971">}</span>
</div>
</body>
</html>
