<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6296358">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6296413">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6296467">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6296518">package</span>&nbsp;<span class="ident" id="6296526">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296532">import</span>&nbsp;<span class="op" id="6296539">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6296542">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6296557">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6296571">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6296581">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6296587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296590">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6296650">type</span>&nbsp;<span class="ident" id="6296655">Auth</span>&nbsp;<span class="keyword" id="6296660">interface</span>&nbsp;<span class="op" id="6296670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296673">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296723">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296778">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296841">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296903">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296950">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297008">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297066">Start</span><span class="op" id="6297071">(</span><span class="ident" id="6297072">server</span>&nbsp;<span class="op" id="6297079">*</span><span class="ident" id="6297080">ServerInfo</span><span class="op" id="6297090">)</span>&nbsp;<span class="op" id="6297092">(</span><span class="ident" id="6297093">proto</span>&nbsp;<span class="builtintype" id="6297099">string</span><span class="op" id="6297105">,</span>&nbsp;<span class="ident" id="6297107">toServer</span>&nbsp;<span class="op" id="6297116">[</span><span class="op" id="6297117">]</span><span class="builtintype" id="6297118">byte</span><span class="op" id="6297122">,</span>&nbsp;<span class="ident" id="6297124">err</span>&nbsp;<span class="builtintype" id="6297128">error</span><span class="op" id="6297133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297137">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297201">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297264">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297326">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297366">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297426">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297484">Next</span><span class="op" id="6297488">(</span><span class="ident" id="6297489">fromServer</span>&nbsp;<span class="op" id="6297500">[</span><span class="op" id="6297501">]</span><span class="builtintype" id="6297502">byte</span><span class="op" id="6297506">,</span>&nbsp;<span class="ident" id="6297508">more</span>&nbsp;<span class="builtintype" id="6297513">bool</span><span class="op" id="6297517">)</span>&nbsp;<span class="op" id="6297519">(</span><span class="ident" id="6297520">toServer</span>&nbsp;<span class="op" id="6297529">[</span><span class="op" id="6297530">]</span><span class="builtintype" id="6297531">byte</span><span class="op" id="6297535">,</span>&nbsp;<span class="ident" id="6297537">err</span>&nbsp;<span class="builtintype" id="6297541">error</span><span class="op" id="6297546">)</span><br>
<span class="lineno"></span><span class="op" id="6297548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297551">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6297607">type</span>&nbsp;<span class="ident" id="6297612">ServerInfo</span>&nbsp;<span class="keyword" id="6297623">struct</span>&nbsp;<span class="op" id="6297630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297633">Name</span>&nbsp;<span class="builtintype" id="6297638">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6297647">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297668">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6297673">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297682">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297729">Auth</span>&nbsp;<span class="op" id="6297734">[</span><span class="op" id="6297735">]</span><span class="builtintype" id="6297736">string</span>&nbsp;<span class="comment" id="6297743">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6297783">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6297786">type</span>&nbsp;<span class="ident" id="6297791">plainAuth</span>&nbsp;<span class="keyword" id="6297801">struct</span>&nbsp;<span class="op" id="6297808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297811">identity</span><span class="op" id="6297819">,</span>&nbsp;<span class="ident" id="6297821">username</span><span class="op" id="6297829">,</span>&nbsp;<span class="ident" id="6297831">password</span>&nbsp;<span class="builtintype" id="6297840">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297848">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6297877">string</span><br>
<span class="lineno"></span><span class="op" id="6297884">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6297887">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6297957">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6297994">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6298068">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6298144">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6298178">func</span>&nbsp;<span class="ident" id="6298183">PlainAuth</span><span class="op" id="6298192">(</span><span class="ident" id="6298193">identity</span><span class="op" id="6298201">,</span>&nbsp;<span class="ident" id="6298203">username</span><span class="op" id="6298211">,</span>&nbsp;<span class="ident" id="6298213">password</span><span class="op" id="6298221">,</span>&nbsp;<span class="ident" id="6298223">host</span>&nbsp;<span class="builtintype" id="6298228">string</span><span class="op" id="6298234">)</span>&nbsp;<span class="ident" id="6298236">Auth</span>&nbsp;<span class="op" id="6298241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298244">return</span>&nbsp;<span class="op" id="6298251">&amp;</span><span class="ident" id="6298252">plainAuth</span><span class="op" id="6298261">{</span><span class="ident" id="6298262">identity</span><span class="op" id="6298270">,</span>&nbsp;<span class="ident" id="6298272">username</span><span class="op" id="6298280">,</span>&nbsp;<span class="ident" id="6298282">password</span><span class="op" id="6298290">,</span>&nbsp;<span class="ident" id="6298292">host</span><span class="op" id="6298296">}</span><br>
<span class="lineno"></span><span class="op" id="6298298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6298301">func</span>&nbsp;<span class="op" id="6298306">(</span><span class="ident" id="6298307">a</span>&nbsp;<span class="op" id="6298309">*</span><span class="ident" id="6298310">plainAuth</span><span class="op" id="6298319">)</span>&nbsp;<span class="ident" id="6298321">Start</span><span class="op" id="6298326">(</span><span class="ident" id="6298327">server</span>&nbsp;<span class="op" id="6298334">*</span><span class="ident" id="6298335">ServerInfo</span><span class="op" id="6298345">)</span>&nbsp;<span class="op" id="6298347">(</span><span class="builtintype" id="6298348">string</span><span class="op" id="6298354">,</span>&nbsp;<span class="op" id="6298356">[</span><span class="op" id="6298357">]</span><span class="builtintype" id="6298358">byte</span><span class="op" id="6298362">,</span>&nbsp;<span class="builtintype" id="6298364">error</span><span class="op" id="6298369">)</span>&nbsp;<span class="op" id="6298371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298374">if</span>&nbsp;<span class="op" id="6298377">!</span><span class="ident" id="6298378">server</span><span class="op" id="6298384">.</span><span class="ident" id="6298385">TLS</span>&nbsp;<span class="op" id="6298389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298393">advertised</span>&nbsp;<span class="op" id="6298404">:=</span>&nbsp;<span class="builtintype" id="6298407">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298415">for</span>&nbsp;<span class="ident" id="6298419">_</span><span class="op" id="6298420">,</span>&nbsp;<span class="ident" id="6298422">mechanism</span>&nbsp;<span class="op" id="6298432">:=</span>&nbsp;<span class="keyword" id="6298435">range</span>&nbsp;<span class="ident" id="6298441">server</span><span class="op" id="6298447">.</span><span class="ident" id="6298448">Auth</span>&nbsp;<span class="op" id="6298453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298458">if</span>&nbsp;<span class="ident" id="6298461">mechanism</span>&nbsp;<span class="op" id="6298471">==</span>&nbsp;<span class="string" id="6298474">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6298482">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298488">advertised</span>&nbsp;<span class="op" id="6298499">=</span>&nbsp;<span class="builtintype" id="6298501">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298510">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298527">if</span>&nbsp;<span class="op" id="6298530">!</span><span class="ident" id="6298531">advertised</span>&nbsp;<span class="op" id="6298542">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298547">return</span>&nbsp;<span class="string" id="6298554">&#34;&#34;</span><span class="op" id="6298556">,</span>&nbsp;<span class="builtintype" id="6298558">nil</span><span class="op" id="6298561">,</span>&nbsp;<span class="ident" id="6298563">errors</span><span class="op" id="6298569">.</span><span class="ident" id="6298570">New</span><span class="op" id="6298573">(</span><span class="string" id="6298574">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6298598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298608">if</span>&nbsp;<span class="ident" id="6298611">server</span><span class="op" id="6298617">.</span><span class="ident" id="6298618">Name</span>&nbsp;<span class="op" id="6298623">!=</span>&nbsp;<span class="ident" id="6298626">a</span><span class="op" id="6298627">.</span><span class="ident" id="6298628">host</span>&nbsp;<span class="op" id="6298633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298637">return</span>&nbsp;<span class="string" id="6298644">&#34;&#34;</span><span class="op" id="6298646">,</span>&nbsp;<span class="builtintype" id="6298648">nil</span><span class="op" id="6298651">,</span>&nbsp;<span class="ident" id="6298653">errors</span><span class="op" id="6298659">.</span><span class="ident" id="6298660">New</span><span class="op" id="6298663">(</span><span class="string" id="6298664">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6298681">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298687">resp</span>&nbsp;<span class="op" id="6298692">:=</span>&nbsp;<span class="op" id="6298695">[</span><span class="op" id="6298696">]</span><span class="builtintype" id="6298697">byte</span><span class="op" id="6298701">(</span><span class="ident" id="6298702">a</span><span class="op" id="6298703">.</span><span class="ident" id="6298704">identity</span>&nbsp;<span class="op" id="6298713">+</span>&nbsp;<span class="string" id="6298715">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6298722">+</span>&nbsp;<span class="ident" id="6298724">a</span><span class="op" id="6298725">.</span><span class="ident" id="6298726">username</span>&nbsp;<span class="op" id="6298735">+</span>&nbsp;<span class="string" id="6298737">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6298744">+</span>&nbsp;<span class="ident" id="6298746">a</span><span class="op" id="6298747">.</span><span class="ident" id="6298748">password</span><span class="op" id="6298756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298759">return</span>&nbsp;<span class="string" id="6298766">&#34;PLAIN&#34;</span><span class="op" id="6298773">,</span>&nbsp;<span class="ident" id="6298775">resp</span><span class="op" id="6298779">,</span>&nbsp;<span class="builtintype" id="6298781">nil</span><br>
<span class="lineno"></span><span class="op" id="6298785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6298788">func</span>&nbsp;<span class="op" id="6298793">(</span><span class="ident" id="6298794">a</span>&nbsp;<span class="op" id="6298796">*</span><span class="ident" id="6298797">plainAuth</span><span class="op" id="6298806">)</span>&nbsp;<span class="ident" id="6298808">Next</span><span class="op" id="6298812">(</span><span class="ident" id="6298813">fromServer</span>&nbsp;<span class="op" id="6298824">[</span><span class="op" id="6298825">]</span><span class="builtintype" id="6298826">byte</span><span class="op" id="6298830">,</span>&nbsp;<span class="ident" id="6298832">more</span>&nbsp;<span class="builtintype" id="6298837">bool</span><span class="op" id="6298841">)</span>&nbsp;<span class="op" id="6298843">(</span><span class="op" id="6298844">[</span><span class="op" id="6298845">]</span><span class="builtintype" id="6298846">byte</span><span class="op" id="6298850">,</span>&nbsp;<span class="builtintype" id="6298852">error</span><span class="op" id="6298857">)</span>&nbsp;<span class="op" id="6298859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298862">if</span>&nbsp;<span class="ident" id="6298865">more</span>&nbsp;<span class="op" id="6298870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6298874">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298910">return</span>&nbsp;<span class="builtintype" id="6298917">nil</span><span class="op" id="6298920">,</span>&nbsp;<span class="ident" id="6298922">errors</span><span class="op" id="6298928">.</span><span class="ident" id="6298929">New</span><span class="op" id="6298932">(</span><span class="string" id="6298933">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6298962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298965">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298968">return</span>&nbsp;<span class="builtintype" id="6298975">nil</span><span class="op" id="6298978">,</span>&nbsp;<span class="builtintype" id="6298980">nil</span><br>
<span class="lineno"></span><span class="op" id="6298984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298987">type</span>&nbsp;<span class="ident" id="6298992">cramMD5Auth</span>&nbsp;<span class="keyword" id="6299004">struct</span>&nbsp;<span class="op" id="6299011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299014">username</span><span class="op" id="6299022">,</span>&nbsp;<span class="ident" id="6299024">secret</span>&nbsp;<span class="builtintype" id="6299031">string</span><br>
<span class="lineno">85</span><span class="op" id="6299038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299041">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6299116">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6299153">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6299225">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6299282">func</span>&nbsp;<span class="ident" id="6299287">CRAMMD5Auth</span><span class="op" id="6299298">(</span><span class="ident" id="6299299">username</span><span class="op" id="6299307">,</span>&nbsp;<span class="ident" id="6299309">secret</span>&nbsp;<span class="builtintype" id="6299316">string</span><span class="op" id="6299322">)</span>&nbsp;<span class="ident" id="6299324">Auth</span>&nbsp;<span class="op" id="6299329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299332">return</span>&nbsp;<span class="op" id="6299339">&amp;</span><span class="ident" id="6299340">cramMD5Auth</span><span class="op" id="6299351">{</span><span class="ident" id="6299352">username</span><span class="op" id="6299360">,</span>&nbsp;<span class="ident" id="6299362">secret</span><span class="op" id="6299368">}</span><br>
<span class="lineno"></span><span class="op" id="6299370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6299373">func</span>&nbsp;<span class="op" id="6299378">(</span><span class="ident" id="6299379">a</span>&nbsp;<span class="op" id="6299381">*</span><span class="ident" id="6299382">cramMD5Auth</span><span class="op" id="6299393">)</span>&nbsp;<span class="ident" id="6299395">Start</span><span class="op" id="6299400">(</span><span class="ident" id="6299401">server</span>&nbsp;<span class="op" id="6299408">*</span><span class="ident" id="6299409">ServerInfo</span><span class="op" id="6299419">)</span>&nbsp;<span class="op" id="6299421">(</span><span class="builtintype" id="6299422">string</span><span class="op" id="6299428">,</span>&nbsp;<span class="op" id="6299430">[</span><span class="op" id="6299431">]</span><span class="builtintype" id="6299432">byte</span><span class="op" id="6299436">,</span>&nbsp;<span class="builtintype" id="6299438">error</span><span class="op" id="6299443">)</span>&nbsp;<span class="op" id="6299445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299448">return</span>&nbsp;<span class="string" id="6299455">&#34;CRAM-MD5&#34;</span><span class="op" id="6299465">,</span>&nbsp;<span class="builtintype" id="6299467">nil</span><span class="op" id="6299470">,</span>&nbsp;<span class="builtintype" id="6299472">nil</span><br>
<span class="lineno"></span><span class="op" id="6299476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6299479">func</span>&nbsp;<span class="op" id="6299484">(</span><span class="ident" id="6299485">a</span>&nbsp;<span class="op" id="6299487">*</span><span class="ident" id="6299488">cramMD5Auth</span><span class="op" id="6299499">)</span>&nbsp;<span class="ident" id="6299501">Next</span><span class="op" id="6299505">(</span><span class="ident" id="6299506">fromServer</span>&nbsp;<span class="op" id="6299517">[</span><span class="op" id="6299518">]</span><span class="builtintype" id="6299519">byte</span><span class="op" id="6299523">,</span>&nbsp;<span class="ident" id="6299525">more</span>&nbsp;<span class="builtintype" id="6299530">bool</span><span class="op" id="6299534">)</span>&nbsp;<span class="op" id="6299536">(</span><span class="op" id="6299537">[</span><span class="op" id="6299538">]</span><span class="builtintype" id="6299539">byte</span><span class="op" id="6299543">,</span>&nbsp;<span class="builtintype" id="6299545">error</span><span class="op" id="6299550">)</span>&nbsp;<span class="op" id="6299552">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299555">if</span>&nbsp;<span class="ident" id="6299558">more</span>&nbsp;<span class="op" id="6299563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299567">d</span>&nbsp;<span class="op" id="6299569">:=</span>&nbsp;<span class="ident" id="6299572">hmac</span><span class="op" id="6299576">.</span><span class="ident" id="6299577">New</span><span class="op" id="6299580">(</span><span class="ident" id="6299581">md5</span><span class="op" id="6299584">.</span><span class="ident" id="6299585">New</span><span class="op" id="6299588">,</span>&nbsp;<span class="op" id="6299590">[</span><span class="op" id="6299591">]</span><span class="builtintype" id="6299592">byte</span><span class="op" id="6299596">(</span><span class="ident" id="6299597">a</span><span class="op" id="6299598">.</span><span class="ident" id="6299599">secret</span><span class="op" id="6299605">)</span><span class="op" id="6299606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299610">d</span><span class="op" id="6299611">.</span><span class="ident" id="6299612">Write</span><span class="op" id="6299617">(</span><span class="ident" id="6299618">fromServer</span><span class="op" id="6299628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299632">s</span>&nbsp;<span class="op" id="6299634">:=</span>&nbsp;<span class="builtinfunc" id="6299637">make</span><span class="op" id="6299641">(</span><span class="op" id="6299642">[</span><span class="op" id="6299643">]</span><span class="builtintype" id="6299644">byte</span><span class="op" id="6299648">,</span>&nbsp;<span class="num" id="6299650">0</span><span class="op" id="6299651">,</span>&nbsp;<span class="ident" id="6299653">d</span><span class="op" id="6299654">.</span><span class="ident" id="6299655">Size</span><span class="op" id="6299659">(</span><span class="op" id="6299660">)</span><span class="op" id="6299661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299665">return</span>&nbsp;<span class="op" id="6299672">[</span><span class="op" id="6299673">]</span><span class="builtintype" id="6299674">byte</span><span class="op" id="6299678">(</span><span class="ident" id="6299679">fmt</span><span class="op" id="6299682">.</span><span class="ident" id="6299683">Sprintf</span><span class="op" id="6299690">(</span><span class="string" id="6299691">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6299698">,</span>&nbsp;<span class="ident" id="6299700">a</span><span class="op" id="6299701">.</span><span class="ident" id="6299702">username</span><span class="op" id="6299710">,</span>&nbsp;<span class="ident" id="6299712">d</span><span class="op" id="6299713">.</span><span class="ident" id="6299714">Sum</span><span class="op" id="6299717">(</span><span class="ident" id="6299718">s</span><span class="op" id="6299719">)</span><span class="op" id="6299720">)</span><span class="op" id="6299721">)</span><span class="op" id="6299722">,</span>&nbsp;<span class="builtintype" id="6299724">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6299732">return</span>&nbsp;<span class="builtintype" id="6299739">nil</span><span class="op" id="6299742">,</span>&nbsp;<span class="builtintype" id="6299744">nil</span><br>
<span class="lineno"></span><span class="op" id="6299748">}</span>
</div>
</body>
</html>
