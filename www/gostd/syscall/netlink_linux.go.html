<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html" class="current">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2388792">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2388848">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2388902">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2388953">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2388986">package</span>&nbsp;<span class="ident" id="2388994">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389003">import</span>&nbsp;<span class="string" id="2389010">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2389020">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2389086">func</span>&nbsp;<span class="ident" id="2389091">nlmAlignOf</span><span class="op" id="2389101">(</span><span class="ident" id="2389102">msglen</span>&nbsp;<span class="builtintype" id="2389109">int</span><span class="op" id="2389112">)</span>&nbsp;<span class="builtintype" id="2389114">int</span>&nbsp;<span class="op" id="2389118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389121">return</span>&nbsp;<span class="op" id="2389128">(</span><span class="ident" id="2389129">msglen</span>&nbsp;<span class="op" id="2389136">+</span>&nbsp;<span class="ident" id="2389138">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2389152">-</span>&nbsp;<span class="num" id="2389154">1</span><span class="op" id="2389155">)</span>&nbsp;<span class="op" id="2389157">&amp;</span>&nbsp;<span class="op" id="2389159">^</span><span class="op" id="2389160">(</span><span class="ident" id="2389161">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2389175">-</span>&nbsp;<span class="num" id="2389177">1</span><span class="op" id="2389178">)</span><br>
<span class="lineno"></span><span class="op" id="2389180">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2389183">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2389247">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2389260">func</span>&nbsp;<span class="ident" id="2389265">rtaAlignOf</span><span class="op" id="2389275">(</span><span class="ident" id="2389276">attrlen</span>&nbsp;<span class="builtintype" id="2389284">int</span><span class="op" id="2389287">)</span>&nbsp;<span class="builtintype" id="2389289">int</span>&nbsp;<span class="op" id="2389293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389296">return</span>&nbsp;<span class="op" id="2389303">(</span><span class="ident" id="2389304">attrlen</span>&nbsp;<span class="op" id="2389312">+</span>&nbsp;<span class="ident" id="2389314">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2389326">-</span>&nbsp;<span class="num" id="2389328">1</span><span class="op" id="2389329">)</span>&nbsp;<span class="op" id="2389331">&amp;</span>&nbsp;<span class="op" id="2389333">^</span><span class="op" id="2389334">(</span><span class="ident" id="2389335">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2389347">-</span>&nbsp;<span class="num" id="2389349">1</span><span class="op" id="2389350">)</span><br>
<span class="lineno">20</span><span class="op" id="2389352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2389355">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2389426">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2389462">type</span>&nbsp;<span class="ident" id="2389467">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2389487">struct</span>&nbsp;<span class="op" id="2389494">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389497">Header</span>&nbsp;<span class="ident" id="2389504">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389514">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2389521">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2389530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389533">func</span>&nbsp;<span class="op" id="2389538">(</span><span class="ident" id="2389539">rr</span>&nbsp;<span class="op" id="2389542">*</span><span class="ident" id="2389543">NetlinkRouteRequest</span><span class="op" id="2389562">)</span>&nbsp;<span class="ident" id="2389564">toWireFormat</span><span class="op" id="2389576">(</span><span class="op" id="2389577">)</span>&nbsp;<span class="op" id="2389579">[</span><span class="op" id="2389580">]</span><span class="builtintype" id="2389581">byte</span>&nbsp;<span class="op" id="2389586">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389589">b</span>&nbsp;<span class="op" id="2389591">:=</span>&nbsp;<span class="builtinfunc" id="2389594">make</span><span class="op" id="2389598">(</span><span class="op" id="2389599">[</span><span class="op" id="2389600">]</span><span class="builtintype" id="2389601">byte</span><span class="op" id="2389605">,</span>&nbsp;<span class="ident" id="2389607">rr</span><span class="op" id="2389609">.</span><span class="ident" id="2389610">Header</span><span class="op" id="2389616">.</span><span class="ident" id="2389617">Len</span><span class="op" id="2389620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389623">*</span><span class="op" id="2389624">(</span><span class="op" id="2389625">*</span><span class="builtintype" id="2389626">uint32</span><span class="op" id="2389632">)</span><span class="op" id="2389633">(</span><span class="ident" id="2389634">unsafe</span><span class="op" id="2389640">.</span><span class="ident" id="2389641">Pointer</span><span class="op" id="2389648">(</span><span class="op" id="2389649">&amp;</span><span class="ident" id="2389650">b</span><span class="op" id="2389651">[</span><span class="num" id="2389652">0</span><span class="op" id="2389653">:</span><span class="num" id="2389654">4</span><span class="op" id="2389655">]</span><span class="op" id="2389656">[</span><span class="num" id="2389657">0</span><span class="op" id="2389658">]</span><span class="op" id="2389659">)</span><span class="op" id="2389660">)</span>&nbsp;<span class="op" id="2389662">=</span>&nbsp;<span class="ident" id="2389664">rr</span><span class="op" id="2389666">.</span><span class="ident" id="2389667">Header</span><span class="op" id="2389673">.</span><span class="ident" id="2389674">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389679">*</span><span class="op" id="2389680">(</span><span class="op" id="2389681">*</span><span class="builtintype" id="2389682">uint16</span><span class="op" id="2389688">)</span><span class="op" id="2389689">(</span><span class="ident" id="2389690">unsafe</span><span class="op" id="2389696">.</span><span class="ident" id="2389697">Pointer</span><span class="op" id="2389704">(</span><span class="op" id="2389705">&amp;</span><span class="ident" id="2389706">b</span><span class="op" id="2389707">[</span><span class="num" id="2389708">4</span><span class="op" id="2389709">:</span><span class="num" id="2389710">6</span><span class="op" id="2389711">]</span><span class="op" id="2389712">[</span><span class="num" id="2389713">0</span><span class="op" id="2389714">]</span><span class="op" id="2389715">)</span><span class="op" id="2389716">)</span>&nbsp;<span class="op" id="2389718">=</span>&nbsp;<span class="ident" id="2389720">rr</span><span class="op" id="2389722">.</span><span class="ident" id="2389723">Header</span><span class="op" id="2389729">.</span><span class="ident" id="2389730">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389736">*</span><span class="op" id="2389737">(</span><span class="op" id="2389738">*</span><span class="builtintype" id="2389739">uint16</span><span class="op" id="2389745">)</span><span class="op" id="2389746">(</span><span class="ident" id="2389747">unsafe</span><span class="op" id="2389753">.</span><span class="ident" id="2389754">Pointer</span><span class="op" id="2389761">(</span><span class="op" id="2389762">&amp;</span><span class="ident" id="2389763">b</span><span class="op" id="2389764">[</span><span class="num" id="2389765">6</span><span class="op" id="2389766">:</span><span class="num" id="2389767">8</span><span class="op" id="2389768">]</span><span class="op" id="2389769">[</span><span class="num" id="2389770">0</span><span class="op" id="2389771">]</span><span class="op" id="2389772">)</span><span class="op" id="2389773">)</span>&nbsp;<span class="op" id="2389775">=</span>&nbsp;<span class="ident" id="2389777">rr</span><span class="op" id="2389779">.</span><span class="ident" id="2389780">Header</span><span class="op" id="2389786">.</span><span class="ident" id="2389787">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389794">*</span><span class="op" id="2389795">(</span><span class="op" id="2389796">*</span><span class="builtintype" id="2389797">uint32</span><span class="op" id="2389803">)</span><span class="op" id="2389804">(</span><span class="ident" id="2389805">unsafe</span><span class="op" id="2389811">.</span><span class="ident" id="2389812">Pointer</span><span class="op" id="2389819">(</span><span class="op" id="2389820">&amp;</span><span class="ident" id="2389821">b</span><span class="op" id="2389822">[</span><span class="num" id="2389823">8</span><span class="op" id="2389824">:</span><span class="num" id="2389825">12</span><span class="op" id="2389827">]</span><span class="op" id="2389828">[</span><span class="num" id="2389829">0</span><span class="op" id="2389830">]</span><span class="op" id="2389831">)</span><span class="op" id="2389832">)</span>&nbsp;<span class="op" id="2389834">=</span>&nbsp;<span class="ident" id="2389836">rr</span><span class="op" id="2389838">.</span><span class="ident" id="2389839">Header</span><span class="op" id="2389845">.</span><span class="ident" id="2389846">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389851">*</span><span class="op" id="2389852">(</span><span class="op" id="2389853">*</span><span class="builtintype" id="2389854">uint32</span><span class="op" id="2389860">)</span><span class="op" id="2389861">(</span><span class="ident" id="2389862">unsafe</span><span class="op" id="2389868">.</span><span class="ident" id="2389869">Pointer</span><span class="op" id="2389876">(</span><span class="op" id="2389877">&amp;</span><span class="ident" id="2389878">b</span><span class="op" id="2389879">[</span><span class="num" id="2389880">12</span><span class="op" id="2389882">:</span><span class="num" id="2389883">16</span><span class="op" id="2389885">]</span><span class="op" id="2389886">[</span><span class="num" id="2389887">0</span><span class="op" id="2389888">]</span><span class="op" id="2389889">)</span><span class="op" id="2389890">)</span>&nbsp;<span class="op" id="2389892">=</span>&nbsp;<span class="ident" id="2389894">rr</span><span class="op" id="2389896">.</span><span class="ident" id="2389897">Header</span><span class="op" id="2389903">.</span><span class="ident" id="2389904">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389909">b</span><span class="op" id="2389910">[</span><span class="num" id="2389911">16</span><span class="op" id="2389913">]</span>&nbsp;<span class="op" id="2389915">=</span>&nbsp;<span class="builtintype" id="2389917">byte</span><span class="op" id="2389921">(</span><span class="ident" id="2389922">rr</span><span class="op" id="2389924">.</span><span class="ident" id="2389925">Data</span><span class="op" id="2389929">.</span><span class="ident" id="2389930">Family</span><span class="op" id="2389936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389939">return</span>&nbsp;<span class="ident" id="2389946">b</span><br>
<span class="lineno"></span><span class="op" id="2389948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2389951">func</span>&nbsp;<span class="ident" id="2389956">newNetlinkRouteRequest</span><span class="op" id="2389978">(</span><span class="ident" id="2389979">proto</span><span class="op" id="2389984">,</span>&nbsp;<span class="ident" id="2389986">seq</span><span class="op" id="2389989">,</span>&nbsp;<span class="ident" id="2389991">family</span>&nbsp;<span class="builtintype" id="2389998">int</span><span class="op" id="2390001">)</span>&nbsp;<span class="op" id="2390003">[</span><span class="op" id="2390004">]</span><span class="builtintype" id="2390005">byte</span>&nbsp;<span class="op" id="2390010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390013">rr</span>&nbsp;<span class="op" id="2390016">:=</span>&nbsp;<span class="op" id="2390019">&amp;</span><span class="ident" id="2390020">NetlinkRouteRequest</span><span class="op" id="2390039">{</span><span class="op" id="2390040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390043">rr</span><span class="op" id="2390045">.</span><span class="ident" id="2390046">Header</span><span class="op" id="2390052">.</span><span class="ident" id="2390053">Len</span>&nbsp;<span class="op" id="2390057">=</span>&nbsp;<span class="builtintype" id="2390059">uint32</span><span class="op" id="2390065">(</span><span class="ident" id="2390066">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2390079">+</span>&nbsp;<span class="ident" id="2390081">SizeofRtGenmsg</span><span class="op" id="2390095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390098">rr</span><span class="op" id="2390100">.</span><span class="ident" id="2390101">Header</span><span class="op" id="2390107">.</span><span class="ident" id="2390108">Type</span>&nbsp;<span class="op" id="2390113">=</span>&nbsp;<span class="builtintype" id="2390115">uint16</span><span class="op" id="2390121">(</span><span class="ident" id="2390122">proto</span><span class="op" id="2390127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390130">rr</span><span class="op" id="2390132">.</span><span class="ident" id="2390133">Header</span><span class="op" id="2390139">.</span><span class="ident" id="2390140">Flags</span>&nbsp;<span class="op" id="2390146">=</span>&nbsp;<span class="ident" id="2390148">NLM_F_DUMP</span>&nbsp;<span class="op" id="2390159">|</span>&nbsp;<span class="ident" id="2390161">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390176">rr</span><span class="op" id="2390178">.</span><span class="ident" id="2390179">Header</span><span class="op" id="2390185">.</span><span class="ident" id="2390186">Seq</span>&nbsp;<span class="op" id="2390190">=</span>&nbsp;<span class="builtintype" id="2390192">uint32</span><span class="op" id="2390198">(</span><span class="ident" id="2390199">seq</span><span class="op" id="2390202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390205">rr</span><span class="op" id="2390207">.</span><span class="ident" id="2390208">Data</span><span class="op" id="2390212">.</span><span class="ident" id="2390213">Family</span>&nbsp;<span class="op" id="2390220">=</span>&nbsp;<span class="builtintype" id="2390222">uint8</span><span class="op" id="2390227">(</span><span class="ident" id="2390228">family</span><span class="op" id="2390234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390237">return</span>&nbsp;<span class="ident" id="2390244">rr</span><span class="op" id="2390246">.</span><span class="ident" id="2390247">toWireFormat</span><span class="op" id="2390259">(</span><span class="op" id="2390260">)</span><br>
<span class="lineno"></span><span class="op" id="2390262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2390265">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2390336">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2390404">func</span>&nbsp;<span class="ident" id="2390409">NetlinkRIB</span><span class="op" id="2390419">(</span><span class="ident" id="2390420">proto</span><span class="op" id="2390425">,</span>&nbsp;<span class="ident" id="2390427">family</span>&nbsp;<span class="builtintype" id="2390434">int</span><span class="op" id="2390437">)</span>&nbsp;<span class="op" id="2390439">(</span><span class="op" id="2390440">[</span><span class="op" id="2390441">]</span><span class="builtintype" id="2390442">byte</span><span class="op" id="2390446">,</span>&nbsp;<span class="builtintype" id="2390448">error</span><span class="op" id="2390453">)</span>&nbsp;<span class="op" id="2390455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390458">s</span><span class="op" id="2390459">,</span>&nbsp;<span class="ident" id="2390461">err</span>&nbsp;<span class="op" id="2390465">:=</span>&nbsp;<span class="ident" id="2390468">Socket</span><span class="op" id="2390474">(</span><span class="ident" id="2390475">AF_NETLINK</span><span class="op" id="2390485">,</span>&nbsp;<span class="ident" id="2390487">SOCK_RAW</span><span class="op" id="2390495">,</span>&nbsp;<span class="ident" id="2390497">NETLINK_ROUTE</span><span class="op" id="2390510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390513">if</span>&nbsp;<span class="ident" id="2390516">err</span>&nbsp;<span class="op" id="2390520">!=</span>&nbsp;<span class="ident" id="2390523">nil</span>&nbsp;<span class="op" id="2390527">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390531">return</span>&nbsp;<span class="ident" id="2390538">nil</span><span class="op" id="2390541">,</span>&nbsp;<span class="ident" id="2390543">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390551">defer</span>&nbsp;<span class="ident" id="2390557">Close</span><span class="op" id="2390562">(</span><span class="ident" id="2390563">s</span><span class="op" id="2390564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390567">lsa</span>&nbsp;<span class="op" id="2390571">:=</span>&nbsp;<span class="op" id="2390574">&amp;</span><span class="ident" id="2390575">SockaddrNetlink</span><span class="op" id="2390590">{</span><span class="ident" id="2390591">Family</span><span class="op" id="2390597">:</span>&nbsp;<span class="ident" id="2390599">AF_NETLINK</span><span class="op" id="2390609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390612">if</span>&nbsp;<span class="ident" id="2390615">err</span>&nbsp;<span class="op" id="2390619">:=</span>&nbsp;<span class="ident" id="2390622">Bind</span><span class="op" id="2390626">(</span><span class="ident" id="2390627">s</span><span class="op" id="2390628">,</span>&nbsp;<span class="ident" id="2390630">lsa</span><span class="op" id="2390633">)</span><span class="op" id="2390634">;</span>&nbsp;<span class="ident" id="2390636">err</span>&nbsp;<span class="op" id="2390640">!=</span>&nbsp;<span class="ident" id="2390643">nil</span>&nbsp;<span class="op" id="2390647">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390651">return</span>&nbsp;<span class="ident" id="2390658">nil</span><span class="op" id="2390661">,</span>&nbsp;<span class="ident" id="2390663">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390671">wb</span>&nbsp;<span class="op" id="2390674">:=</span>&nbsp;<span class="ident" id="2390677">newNetlinkRouteRequest</span><span class="op" id="2390699">(</span><span class="ident" id="2390700">proto</span><span class="op" id="2390705">,</span>&nbsp;<span class="num" id="2390707">1</span><span class="op" id="2390708">,</span>&nbsp;<span class="ident" id="2390710">family</span><span class="op" id="2390716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390719">if</span>&nbsp;<span class="ident" id="2390722">err</span>&nbsp;<span class="op" id="2390726">:=</span>&nbsp;<span class="ident" id="2390729">Sendto</span><span class="op" id="2390735">(</span><span class="ident" id="2390736">s</span><span class="op" id="2390737">,</span>&nbsp;<span class="ident" id="2390739">wb</span><span class="op" id="2390741">,</span>&nbsp;<span class="num" id="2390743">0</span><span class="op" id="2390744">,</span>&nbsp;<span class="ident" id="2390746">lsa</span><span class="op" id="2390749">)</span><span class="op" id="2390750">;</span>&nbsp;<span class="ident" id="2390752">err</span>&nbsp;<span class="op" id="2390756">!=</span>&nbsp;<span class="ident" id="2390759">nil</span>&nbsp;<span class="op" id="2390763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390767">return</span>&nbsp;<span class="ident" id="2390774">nil</span><span class="op" id="2390777">,</span>&nbsp;<span class="ident" id="2390779">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390787">var</span>&nbsp;<span class="ident" id="2390791">tab</span>&nbsp;<span class="op" id="2390795">[</span><span class="op" id="2390796">]</span><span class="builtintype" id="2390797">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390803">rbNew</span>&nbsp;<span class="op" id="2390809">:=</span>&nbsp;<span class="builtinfunc" id="2390812">make</span><span class="op" id="2390816">(</span><span class="op" id="2390817">[</span><span class="op" id="2390818">]</span><span class="builtintype" id="2390819">byte</span><span class="op" id="2390823">,</span>&nbsp;<span class="ident" id="2390825">Getpagesize</span><span class="op" id="2390836">(</span><span class="op" id="2390837">)</span><span class="op" id="2390838">)</span><br>
<span class="lineno"></span><span class="ident" id="2390840">done</span><span class="op" id="2390844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390847">for</span>&nbsp;<span class="op" id="2390851">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390855">rb</span>&nbsp;<span class="op" id="2390858">:=</span>&nbsp;<span class="ident" id="2390861">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390869">nr</span><span class="op" id="2390871">,</span>&nbsp;<span class="ident" id="2390873">_</span><span class="op" id="2390874">,</span>&nbsp;<span class="ident" id="2390876">err</span>&nbsp;<span class="op" id="2390880">:=</span>&nbsp;<span class="ident" id="2390883">Recvfrom</span><span class="op" id="2390891">(</span><span class="ident" id="2390892">s</span><span class="op" id="2390893">,</span>&nbsp;<span class="ident" id="2390895">rb</span><span class="op" id="2390897">,</span>&nbsp;<span class="num" id="2390899">0</span><span class="op" id="2390900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390904">if</span>&nbsp;<span class="ident" id="2390907">err</span>&nbsp;<span class="op" id="2390911">!=</span>&nbsp;<span class="ident" id="2390914">nil</span>&nbsp;<span class="op" id="2390918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390923">return</span>&nbsp;<span class="ident" id="2390930">nil</span><span class="op" id="2390933">,</span>&nbsp;<span class="ident" id="2390935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390941">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390945">if</span>&nbsp;<span class="ident" id="2390948">nr</span>&nbsp;<span class="op" id="2390951">&lt;</span>&nbsp;<span class="ident" id="2390953">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2390966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390971">return</span>&nbsp;<span class="ident" id="2390978">nil</span><span class="op" id="2390981">,</span>&nbsp;<span class="ident" id="2390983">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390996">rb</span>&nbsp;<span class="op" id="2390999">=</span>&nbsp;<span class="ident" id="2391001">rb</span><span class="op" id="2391003">[</span><span class="op" id="2391004">:</span><span class="ident" id="2391005">nr</span><span class="op" id="2391007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391011">tab</span>&nbsp;<span class="op" id="2391015">=</span>&nbsp;<span class="builtinfunc" id="2391017">append</span><span class="op" id="2391023">(</span><span class="ident" id="2391024">tab</span><span class="op" id="2391027">,</span>&nbsp;<span class="ident" id="2391029">rb</span><span class="op" id="2391031">...</span><span class="op" id="2391034">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391038">msgs</span><span class="op" id="2391042">,</span>&nbsp;<span class="ident" id="2391044">err</span>&nbsp;<span class="op" id="2391048">:=</span>&nbsp;<span class="ident" id="2391051">ParseNetlinkMessage</span><span class="op" id="2391070">(</span><span class="ident" id="2391071">rb</span><span class="op" id="2391073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391077">if</span>&nbsp;<span class="ident" id="2391080">err</span>&nbsp;<span class="op" id="2391084">!=</span>&nbsp;<span class="ident" id="2391087">nil</span>&nbsp;<span class="op" id="2391091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391096">return</span>&nbsp;<span class="ident" id="2391103">nil</span><span class="op" id="2391106">,</span>&nbsp;<span class="ident" id="2391108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391118">for</span>&nbsp;<span class="ident" id="2391122">_</span><span class="op" id="2391123">,</span>&nbsp;<span class="ident" id="2391125">m</span>&nbsp;<span class="op" id="2391127">:=</span>&nbsp;<span class="keyword" id="2391130">range</span>&nbsp;<span class="ident" id="2391136">msgs</span>&nbsp;<span class="op" id="2391141">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391146">lsa</span><span class="op" id="2391149">,</span>&nbsp;<span class="ident" id="2391151">err</span>&nbsp;<span class="op" id="2391155">:=</span>&nbsp;<span class="ident" id="2391158">Getsockname</span><span class="op" id="2391169">(</span><span class="ident" id="2391170">s</span><span class="op" id="2391171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391176">if</span>&nbsp;<span class="ident" id="2391179">err</span>&nbsp;<span class="op" id="2391183">!=</span>&nbsp;<span class="ident" id="2391186">nil</span>&nbsp;<span class="op" id="2391190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391196">return</span>&nbsp;<span class="ident" id="2391203">nil</span><span class="op" id="2391206">,</span>&nbsp;<span class="ident" id="2391208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391220">switch</span>&nbsp;<span class="ident" id="2391227">v</span>&nbsp;<span class="op" id="2391229">:=</span>&nbsp;<span class="ident" id="2391232">lsa</span><span class="op" id="2391235">.</span><span class="op" id="2391236">(</span><span class="keyword" id="2391237">type</span><span class="op" id="2391241">)</span>&nbsp;<span class="op" id="2391243">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391248">case</span>&nbsp;<span class="op" id="2391253">*</span><span class="ident" id="2391254">SockaddrNetlink</span><span class="op" id="2391269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391275">if</span>&nbsp;<span class="ident" id="2391278">m</span><span class="op" id="2391279">.</span><span class="ident" id="2391280">Header</span><span class="op" id="2391286">.</span><span class="ident" id="2391287">Seq</span>&nbsp;<span class="op" id="2391291">!=</span>&nbsp;<span class="num" id="2391294">1</span>&nbsp;<span class="op" id="2391296">||</span>&nbsp;<span class="ident" id="2391299">m</span><span class="op" id="2391300">.</span><span class="ident" id="2391301">Header</span><span class="op" id="2391307">.</span><span class="ident" id="2391308">Pid</span>&nbsp;<span class="op" id="2391312">!=</span>&nbsp;<span class="ident" id="2391315">v</span><span class="op" id="2391316">.</span><span class="ident" id="2391317">Pid</span>&nbsp;<span class="op" id="2391321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391328">return</span>&nbsp;<span class="ident" id="2391335">nil</span><span class="op" id="2391338">,</span>&nbsp;<span class="ident" id="2391340">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391356">default</span><span class="op" id="2391363">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391369">return</span>&nbsp;<span class="ident" id="2391376">nil</span><span class="op" id="2391379">,</span>&nbsp;<span class="ident" id="2391381">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391396">if</span>&nbsp;<span class="ident" id="2391399">m</span><span class="op" id="2391400">.</span><span class="ident" id="2391401">Header</span><span class="op" id="2391407">.</span><span class="ident" id="2391408">Type</span>&nbsp;<span class="op" id="2391413">==</span>&nbsp;<span class="ident" id="2391416">NLMSG_DONE</span>&nbsp;<span class="op" id="2391427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391433">break</span>&nbsp;<span class="ident" id="2391439">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391447">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391452">if</span>&nbsp;<span class="ident" id="2391455">m</span><span class="op" id="2391456">.</span><span class="ident" id="2391457">Header</span><span class="op" id="2391463">.</span><span class="ident" id="2391464">Type</span>&nbsp;<span class="op" id="2391469">==</span>&nbsp;<span class="ident" id="2391472">NLMSG_ERROR</span>&nbsp;<span class="op" id="2391484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391490">return</span>&nbsp;<span class="ident" id="2391497">nil</span><span class="op" id="2391500">,</span>&nbsp;<span class="ident" id="2391502">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391519">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391522">return</span>&nbsp;<span class="ident" id="2391529">tab</span><span class="op" id="2391532">,</span>&nbsp;<span class="ident" id="2391534">nil</span><br>
<span class="lineno"></span><span class="op" id="2391538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2391541">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2391589">type</span>&nbsp;<span class="ident" id="2391594">NetlinkMessage</span>&nbsp;<span class="keyword" id="2391609">struct</span>&nbsp;<span class="op" id="2391616">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391619">Header</span>&nbsp;<span class="ident" id="2391626">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391636">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2391643">[</span><span class="op" id="2391644">]</span><span class="builtintype" id="2391645">byte</span><br>
<span class="lineno"></span><span class="op" id="2391650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2391653">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2391721">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2391784">func</span>&nbsp;<span class="ident" id="2391789">ParseNetlinkMessage</span><span class="op" id="2391808">(</span><span class="ident" id="2391809">b</span>&nbsp;<span class="op" id="2391811">[</span><span class="op" id="2391812">]</span><span class="builtintype" id="2391813">byte</span><span class="op" id="2391817">)</span>&nbsp;<span class="op" id="2391819">(</span><span class="op" id="2391820">[</span><span class="op" id="2391821">]</span><span class="ident" id="2391822">NetlinkMessage</span><span class="op" id="2391836">,</span>&nbsp;<span class="builtintype" id="2391838">error</span><span class="op" id="2391843">)</span>&nbsp;<span class="op" id="2391845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391848">var</span>&nbsp;<span class="ident" id="2391852">msgs</span>&nbsp;<span class="op" id="2391857">[</span><span class="op" id="2391858">]</span><span class="ident" id="2391859">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391875">for</span>&nbsp;<span class="builtinfunc" id="2391879">len</span><span class="op" id="2391882">(</span><span class="ident" id="2391883">b</span><span class="op" id="2391884">)</span>&nbsp;<span class="op" id="2391886">&gt;=</span>&nbsp;<span class="ident" id="2391889">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2391902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391906">h</span><span class="op" id="2391907">,</span>&nbsp;<span class="ident" id="2391909">dbuf</span><span class="op" id="2391913">,</span>&nbsp;<span class="ident" id="2391915">dlen</span><span class="op" id="2391919">,</span>&nbsp;<span class="ident" id="2391921">err</span>&nbsp;<span class="op" id="2391925">:=</span>&nbsp;<span class="ident" id="2391928">netlinkMessageHeaderAndData</span><span class="op" id="2391955">(</span><span class="ident" id="2391956">b</span><span class="op" id="2391957">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391961">if</span>&nbsp;<span class="ident" id="2391964">err</span>&nbsp;<span class="op" id="2391968">!=</span>&nbsp;<span class="ident" id="2391971">nil</span>&nbsp;<span class="op" id="2391975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391980">return</span>&nbsp;<span class="ident" id="2391987">nil</span><span class="op" id="2391990">,</span>&nbsp;<span class="ident" id="2391992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392002">m</span>&nbsp;<span class="op" id="2392004">:=</span>&nbsp;<span class="ident" id="2392007">NetlinkMessage</span><span class="op" id="2392021">{</span><span class="ident" id="2392022">Header</span><span class="op" id="2392028">:</span>&nbsp;<span class="op" id="2392030">*</span><span class="ident" id="2392031">h</span><span class="op" id="2392032">,</span>&nbsp;<span class="ident" id="2392034">Data</span><span class="op" id="2392038">:</span>&nbsp;<span class="ident" id="2392040">dbuf</span><span class="op" id="2392044">[</span><span class="op" id="2392045">:</span><span class="builtintype" id="2392046">int</span><span class="op" id="2392049">(</span><span class="ident" id="2392050">h</span><span class="op" id="2392051">.</span><span class="ident" id="2392052">Len</span><span class="op" id="2392055">)</span><span class="op" id="2392056">-</span><span class="ident" id="2392057">NLMSG_HDRLEN</span><span class="op" id="2392069">]</span><span class="op" id="2392070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392074">msgs</span>&nbsp;<span class="op" id="2392079">=</span>&nbsp;<span class="builtinfunc" id="2392081">append</span><span class="op" id="2392087">(</span><span class="ident" id="2392088">msgs</span><span class="op" id="2392092">,</span>&nbsp;<span class="ident" id="2392094">m</span><span class="op" id="2392095">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392099">b</span>&nbsp;<span class="op" id="2392101">=</span>&nbsp;<span class="ident" id="2392103">b</span><span class="op" id="2392104">[</span><span class="ident" id="2392105">dlen</span><span class="op" id="2392109">:</span><span class="op" id="2392110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392116">return</span>&nbsp;<span class="ident" id="2392123">msgs</span><span class="op" id="2392127">,</span>&nbsp;<span class="ident" id="2392129">nil</span><br>
<span class="lineno"></span><span class="op" id="2392133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2392136">func</span>&nbsp;<span class="ident" id="2392141">netlinkMessageHeaderAndData</span><span class="op" id="2392168">(</span><span class="ident" id="2392169">b</span>&nbsp;<span class="op" id="2392171">[</span><span class="op" id="2392172">]</span><span class="builtintype" id="2392173">byte</span><span class="op" id="2392177">)</span>&nbsp;<span class="op" id="2392179">(</span><span class="op" id="2392180">*</span><span class="ident" id="2392181">NlMsghdr</span><span class="op" id="2392189">,</span>&nbsp;<span class="op" id="2392191">[</span><span class="op" id="2392192">]</span><span class="builtintype" id="2392193">byte</span><span class="op" id="2392197">,</span>&nbsp;<span class="builtintype" id="2392199">int</span><span class="op" id="2392202">,</span>&nbsp;<span class="builtintype" id="2392204">error</span><span class="op" id="2392209">)</span>&nbsp;<span class="op" id="2392211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392214">h</span>&nbsp;<span class="op" id="2392216">:=</span>&nbsp;<span class="op" id="2392219">(</span><span class="op" id="2392220">*</span><span class="ident" id="2392221">NlMsghdr</span><span class="op" id="2392229">)</span><span class="op" id="2392230">(</span><span class="ident" id="2392231">unsafe</span><span class="op" id="2392237">.</span><span class="ident" id="2392238">Pointer</span><span class="op" id="2392245">(</span><span class="op" id="2392246">&amp;</span><span class="ident" id="2392247">b</span><span class="op" id="2392248">[</span><span class="num" id="2392249">0</span><span class="op" id="2392250">]</span><span class="op" id="2392251">)</span><span class="op" id="2392252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392255">if</span>&nbsp;<span class="builtintype" id="2392258">int</span><span class="op" id="2392261">(</span><span class="ident" id="2392262">h</span><span class="op" id="2392263">.</span><span class="ident" id="2392264">Len</span><span class="op" id="2392267">)</span>&nbsp;<span class="op" id="2392269">&lt;</span>&nbsp;<span class="ident" id="2392271">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2392284">||</span>&nbsp;<span class="builtintype" id="2392287">int</span><span class="op" id="2392290">(</span><span class="ident" id="2392291">h</span><span class="op" id="2392292">.</span><span class="ident" id="2392293">Len</span><span class="op" id="2392296">)</span>&nbsp;<span class="op" id="2392298">&gt;</span>&nbsp;<span class="builtinfunc" id="2392300">len</span><span class="op" id="2392303">(</span><span class="ident" id="2392304">b</span><span class="op" id="2392305">)</span>&nbsp;<span class="op" id="2392307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392311">return</span>&nbsp;<span class="ident" id="2392318">nil</span><span class="op" id="2392321">,</span>&nbsp;<span class="ident" id="2392323">nil</span><span class="op" id="2392326">,</span>&nbsp;<span class="num" id="2392328">0</span><span class="op" id="2392329">,</span>&nbsp;<span class="ident" id="2392331">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392339">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392342">return</span>&nbsp;<span class="ident" id="2392349">h</span><span class="op" id="2392350">,</span>&nbsp;<span class="ident" id="2392352">b</span><span class="op" id="2392353">[</span><span class="ident" id="2392354">NLMSG_HDRLEN</span><span class="op" id="2392366">:</span><span class="op" id="2392367">]</span><span class="op" id="2392368">,</span>&nbsp;<span class="ident" id="2392370">nlmAlignOf</span><span class="op" id="2392380">(</span><span class="builtintype" id="2392381">int</span><span class="op" id="2392384">(</span><span class="ident" id="2392385">h</span><span class="op" id="2392386">.</span><span class="ident" id="2392387">Len</span><span class="op" id="2392390">)</span><span class="op" id="2392391">)</span><span class="op" id="2392392">,</span>&nbsp;<span class="ident" id="2392394">nil</span><br>
<span class="lineno"></span><span class="op" id="2392398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2392401">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2392459">type</span>&nbsp;<span class="ident" id="2392464">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2392481">struct</span>&nbsp;<span class="op" id="2392488">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392491">Attr</span>&nbsp;&nbsp;<span class="ident" id="2392497">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392505">Value</span>&nbsp;<span class="op" id="2392511">[</span><span class="op" id="2392512">]</span><span class="builtintype" id="2392513">byte</span><br>
<span class="lineno"></span><span class="op" id="2392518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2392521">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2392588">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2392645">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2392677">func</span>&nbsp;<span class="ident" id="2392682">ParseNetlinkRouteAttr</span><span class="op" id="2392703">(</span><span class="ident" id="2392704">m</span>&nbsp;<span class="op" id="2392706">*</span><span class="ident" id="2392707">NetlinkMessage</span><span class="op" id="2392721">)</span>&nbsp;<span class="op" id="2392723">(</span><span class="op" id="2392724">[</span><span class="op" id="2392725">]</span><span class="ident" id="2392726">NetlinkRouteAttr</span><span class="op" id="2392742">,</span>&nbsp;<span class="builtintype" id="2392744">error</span><span class="op" id="2392749">)</span>&nbsp;<span class="op" id="2392751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392754">var</span>&nbsp;<span class="ident" id="2392758">b</span>&nbsp;<span class="op" id="2392760">[</span><span class="op" id="2392761">]</span><span class="builtintype" id="2392762">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392768">switch</span>&nbsp;<span class="ident" id="2392775">m</span><span class="op" id="2392776">.</span><span class="ident" id="2392777">Header</span><span class="op" id="2392783">.</span><span class="ident" id="2392784">Type</span>&nbsp;<span class="op" id="2392789">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392792">case</span>&nbsp;<span class="ident" id="2392797">RTM_NEWLINK</span><span class="op" id="2392808">,</span>&nbsp;<span class="ident" id="2392810">RTM_DELLINK</span><span class="op" id="2392821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392825">b</span>&nbsp;<span class="op" id="2392827">=</span>&nbsp;<span class="ident" id="2392829">m</span><span class="op" id="2392830">.</span><span class="ident" id="2392831">Data</span><span class="op" id="2392835">[</span><span class="ident" id="2392836">SizeofIfInfomsg</span><span class="op" id="2392851">:</span><span class="op" id="2392852">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392855">case</span>&nbsp;<span class="ident" id="2392860">RTM_NEWADDR</span><span class="op" id="2392871">,</span>&nbsp;<span class="ident" id="2392873">RTM_DELADDR</span><span class="op" id="2392884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392888">b</span>&nbsp;<span class="op" id="2392890">=</span>&nbsp;<span class="ident" id="2392892">m</span><span class="op" id="2392893">.</span><span class="ident" id="2392894">Data</span><span class="op" id="2392898">[</span><span class="ident" id="2392899">SizeofIfAddrmsg</span><span class="op" id="2392914">:</span><span class="op" id="2392915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392918">case</span>&nbsp;<span class="ident" id="2392923">RTM_NEWROUTE</span><span class="op" id="2392935">,</span>&nbsp;<span class="ident" id="2392937">RTM_DELROUTE</span><span class="op" id="2392949">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392953">b</span>&nbsp;<span class="op" id="2392955">=</span>&nbsp;<span class="ident" id="2392957">m</span><span class="op" id="2392958">.</span><span class="ident" id="2392959">Data</span><span class="op" id="2392963">[</span><span class="ident" id="2392964">SizeofRtMsg</span><span class="op" id="2392975">:</span><span class="op" id="2392976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392979">default</span><span class="op" id="2392986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392990">return</span>&nbsp;<span class="ident" id="2392997">nil</span><span class="op" id="2393000">,</span>&nbsp;<span class="ident" id="2393002">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2393010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393013">var</span>&nbsp;<span class="ident" id="2393017">attrs</span>&nbsp;<span class="op" id="2393023">[</span><span class="op" id="2393024">]</span><span class="ident" id="2393025">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393043">for</span>&nbsp;<span class="builtinfunc" id="2393047">len</span><span class="op" id="2393050">(</span><span class="ident" id="2393051">b</span><span class="op" id="2393052">)</span>&nbsp;<span class="op" id="2393054">&gt;=</span>&nbsp;<span class="ident" id="2393057">SizeofRtAttr</span>&nbsp;<span class="op" id="2393070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393074">a</span><span class="op" id="2393075">,</span>&nbsp;<span class="ident" id="2393077">vbuf</span><span class="op" id="2393081">,</span>&nbsp;<span class="ident" id="2393083">alen</span><span class="op" id="2393087">,</span>&nbsp;<span class="ident" id="2393089">err</span>&nbsp;<span class="op" id="2393093">:=</span>&nbsp;<span class="ident" id="2393096">netlinkRouteAttrAndValue</span><span class="op" id="2393120">(</span><span class="ident" id="2393121">b</span><span class="op" id="2393122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393126">if</span>&nbsp;<span class="ident" id="2393129">err</span>&nbsp;<span class="op" id="2393133">!=</span>&nbsp;<span class="ident" id="2393136">nil</span>&nbsp;<span class="op" id="2393140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393145">return</span>&nbsp;<span class="ident" id="2393152">nil</span><span class="op" id="2393155">,</span>&nbsp;<span class="ident" id="2393157">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2393163">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393167">ra</span>&nbsp;<span class="op" id="2393170">:=</span>&nbsp;<span class="ident" id="2393173">NetlinkRouteAttr</span><span class="op" id="2393189">{</span><span class="ident" id="2393190">Attr</span><span class="op" id="2393194">:</span>&nbsp;<span class="op" id="2393196">*</span><span class="ident" id="2393197">a</span><span class="op" id="2393198">,</span>&nbsp;<span class="ident" id="2393200">Value</span><span class="op" id="2393205">:</span>&nbsp;<span class="ident" id="2393207">vbuf</span><span class="op" id="2393211">[</span><span class="op" id="2393212">:</span><span class="builtintype" id="2393213">int</span><span class="op" id="2393216">(</span><span class="ident" id="2393217">a</span><span class="op" id="2393218">.</span><span class="ident" id="2393219">Len</span><span class="op" id="2393222">)</span><span class="op" id="2393223">-</span><span class="ident" id="2393224">SizeofRtAttr</span><span class="op" id="2393236">]</span><span class="op" id="2393237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393241">attrs</span>&nbsp;<span class="op" id="2393247">=</span>&nbsp;<span class="builtinfunc" id="2393249">append</span><span class="op" id="2393255">(</span><span class="ident" id="2393256">attrs</span><span class="op" id="2393261">,</span>&nbsp;<span class="ident" id="2393263">ra</span><span class="op" id="2393265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393269">b</span>&nbsp;<span class="op" id="2393271">=</span>&nbsp;<span class="ident" id="2393273">b</span><span class="op" id="2393274">[</span><span class="ident" id="2393275">alen</span><span class="op" id="2393279">:</span><span class="op" id="2393280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2393283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393286">return</span>&nbsp;<span class="ident" id="2393293">attrs</span><span class="op" id="2393298">,</span>&nbsp;<span class="ident" id="2393300">nil</span><br>
<span class="lineno">170</span><span class="op" id="2393304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2393307">func</span>&nbsp;<span class="ident" id="2393312">netlinkRouteAttrAndValue</span><span class="op" id="2393336">(</span><span class="ident" id="2393337">b</span>&nbsp;<span class="op" id="2393339">[</span><span class="op" id="2393340">]</span><span class="builtintype" id="2393341">byte</span><span class="op" id="2393345">)</span>&nbsp;<span class="op" id="2393347">(</span><span class="op" id="2393348">*</span><span class="ident" id="2393349">RtAttr</span><span class="op" id="2393355">,</span>&nbsp;<span class="op" id="2393357">[</span><span class="op" id="2393358">]</span><span class="builtintype" id="2393359">byte</span><span class="op" id="2393363">,</span>&nbsp;<span class="builtintype" id="2393365">int</span><span class="op" id="2393368">,</span>&nbsp;<span class="builtintype" id="2393370">error</span><span class="op" id="2393375">)</span>&nbsp;<span class="op" id="2393377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393380">a</span>&nbsp;<span class="op" id="2393382">:=</span>&nbsp;<span class="op" id="2393385">(</span><span class="op" id="2393386">*</span><span class="ident" id="2393387">RtAttr</span><span class="op" id="2393393">)</span><span class="op" id="2393394">(</span><span class="ident" id="2393395">unsafe</span><span class="op" id="2393401">.</span><span class="ident" id="2393402">Pointer</span><span class="op" id="2393409">(</span><span class="op" id="2393410">&amp;</span><span class="ident" id="2393411">b</span><span class="op" id="2393412">[</span><span class="num" id="2393413">0</span><span class="op" id="2393414">]</span><span class="op" id="2393415">)</span><span class="op" id="2393416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393419">if</span>&nbsp;<span class="builtintype" id="2393422">int</span><span class="op" id="2393425">(</span><span class="ident" id="2393426">a</span><span class="op" id="2393427">.</span><span class="ident" id="2393428">Len</span><span class="op" id="2393431">)</span>&nbsp;<span class="op" id="2393433">&lt;</span>&nbsp;<span class="ident" id="2393435">SizeofRtAttr</span>&nbsp;<span class="op" id="2393448">||</span>&nbsp;<span class="builtintype" id="2393451">int</span><span class="op" id="2393454">(</span><span class="ident" id="2393455">a</span><span class="op" id="2393456">.</span><span class="ident" id="2393457">Len</span><span class="op" id="2393460">)</span>&nbsp;<span class="op" id="2393462">&gt;</span>&nbsp;<span class="builtinfunc" id="2393464">len</span><span class="op" id="2393467">(</span><span class="ident" id="2393468">b</span><span class="op" id="2393469">)</span>&nbsp;<span class="op" id="2393471">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393475">return</span>&nbsp;<span class="ident" id="2393482">nil</span><span class="op" id="2393485">,</span>&nbsp;<span class="ident" id="2393487">nil</span><span class="op" id="2393490">,</span>&nbsp;<span class="num" id="2393492">0</span><span class="op" id="2393493">,</span>&nbsp;<span class="ident" id="2393495">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2393503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393506">return</span>&nbsp;<span class="ident" id="2393513">a</span><span class="op" id="2393514">,</span>&nbsp;<span class="ident" id="2393516">b</span><span class="op" id="2393517">[</span><span class="ident" id="2393518">SizeofRtAttr</span><span class="op" id="2393530">:</span><span class="op" id="2393531">]</span><span class="op" id="2393532">,</span>&nbsp;<span class="ident" id="2393534">rtaAlignOf</span><span class="op" id="2393544">(</span><span class="builtintype" id="2393545">int</span><span class="op" id="2393548">(</span><span class="ident" id="2393549">a</span><span class="op" id="2393550">.</span><span class="ident" id="2393551">Len</span><span class="op" id="2393554">)</span><span class="op" id="2393555">)</span><span class="op" id="2393556">,</span>&nbsp;<span class="ident" id="2393558">nil</span><br>
<span class="lineno"></span><span class="op" id="2393562">}</span>
</div>
</body>
</html>
