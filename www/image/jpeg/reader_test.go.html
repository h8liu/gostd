<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8065757">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8065812">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8065866">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8065917">package</span>&nbsp;<span class="ident" id="8065925">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8065931">import</span>&nbsp;<span class="op" id="8065938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065941">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065950">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065957">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065966">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065981">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8065987">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066000">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066013">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066019">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066030">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8066040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="8066043">//&nbsp;TestDecodeProgressive&nbsp;tests&nbsp;that&nbsp;decoding&nbsp;the&nbsp;baseline&nbsp;and&nbsp;progressive</span><br>
<span class="lineno"></span><span class="comment" id="8066117">//&nbsp;versions&nbsp;of&nbsp;the&nbsp;same&nbsp;image&nbsp;result&nbsp;in&nbsp;exactly&nbsp;the&nbsp;same&nbsp;pixel&nbsp;data,&nbsp;in&nbsp;YCbCr</span><br>
<span class="lineno"></span><span class="comment" id="8066195">//&nbsp;space&nbsp;for&nbsp;color&nbsp;images,&nbsp;and&nbsp;Y&nbsp;space&nbsp;for&nbsp;grayscale&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="8066256">func</span>&nbsp;<span class="ident" id="8066261">TestDecodeProgressive</span><span class="op" id="8066282">(</span><span class="ident" id="8066283">t</span>&nbsp;<span class="op" id="8066285">*</span><span class="ident" id="8066286"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8066293">.</span><span class="ident" id="8066294">T</span><span class="op" id="8066295">)</span>&nbsp;<span class="op" id="8066297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066300">testCases</span>&nbsp;<span class="op" id="8066310">:=</span>&nbsp;<span class="op" id="8066313">[</span><span class="op" id="8066314">]</span><span class="builtintype" id="8066315">string</span><span class="op" id="8066321">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066325">&#34;../testdata/video-001&#34;</span><span class="op" id="8066348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066352">&#34;../testdata/video-001.q50.420&#34;</span><span class="op" id="8066383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066387">&#34;../testdata/video-001.q50.422&#34;</span><span class="op" id="8066418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066422">&#34;../testdata/video-001.q50.440&#34;</span><span class="op" id="8066453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066457">&#34;../testdata/video-001.q50.444&#34;</span><span class="op" id="8066488">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066492">&#34;../testdata/video-005.gray.q50&#34;</span><span class="op" id="8066524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066528">&#34;../testdata/video-005.gray.q50.2x2&#34;</span><span class="op" id="8066564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8066568">&#34;../testdata/video-001.separate.dc.progression&#34;</span><span class="op" id="8066615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066621">for</span>&nbsp;<span class="ident" id="8066625">_</span><span class="op" id="8066626">,</span>&nbsp;<span class="ident" id="8066628">tc</span>&nbsp;<span class="op" id="8066631">:=</span>&nbsp;<span class="keyword" id="8066634">range</span>&nbsp;<span class="ident" id="8066640"><a href="/image/jpeg/reader_test.go.html#8066300">testCases</a></span>&nbsp;<span class="op" id="8066650">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066654">m0</span><span class="op" id="8066656">,</span>&nbsp;<span class="ident" id="8066658">err</span>&nbsp;<span class="op" id="8066662">:=</span>&nbsp;<span class="ident" id="8066665"><a href="/image/jpeg/reader_test.go.html#8067946">decodeFile</a></span><span class="op" id="8066675">(</span><span class="ident" id="8066676"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span>&nbsp;<span class="op" id="8066679">+</span>&nbsp;<span class="string" id="8066681">&#34;.jpeg&#34;</span><span class="op" id="8066688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066692">if</span>&nbsp;<span class="ident" id="8066695"><a href="/image/jpeg/reader_test.go.html#8066658">err</a></span>&nbsp;<span class="op" id="8066699">!=</span>&nbsp;<span class="ident" id="8066702">nil</span>&nbsp;<span class="op" id="8066706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066711"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8066712">.</span><span class="ident" id="8066713">Errorf</span><span class="op" id="8066719">(</span><span class="string" id="8066720">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8066728">,</span>&nbsp;<span class="ident" id="8066730"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8066732">+</span><span class="string" id="8066733">&#34;.jpeg&#34;</span><span class="op" id="8066740">,</span>&nbsp;<span class="ident" id="8066742"><a href="/image/jpeg/reader_test.go.html#8066658">err</a></span><span class="op" id="8066745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066750">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066761">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066765">m1</span><span class="op" id="8066767">,</span>&nbsp;<span class="ident" id="8066769"><a href="/image/jpeg/reader_test.go.html#8066658">err</a></span>&nbsp;<span class="op" id="8066773">:=</span>&nbsp;<span class="ident" id="8066776"><a href="/image/jpeg/reader_test.go.html#8067946">decodeFile</a></span><span class="op" id="8066786">(</span><span class="ident" id="8066787"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span>&nbsp;<span class="op" id="8066790">+</span>&nbsp;<span class="string" id="8066792">&#34;.progressive.jpeg&#34;</span><span class="op" id="8066811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066815">if</span>&nbsp;<span class="ident" id="8066818"><a href="/image/jpeg/reader_test.go.html#8066658">err</a></span>&nbsp;<span class="op" id="8066822">!=</span>&nbsp;<span class="ident" id="8066825">nil</span>&nbsp;<span class="op" id="8066829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066834"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8066835">.</span><span class="ident" id="8066836">Errorf</span><span class="op" id="8066842">(</span><span class="string" id="8066843">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8066851">,</span>&nbsp;<span class="ident" id="8066853"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8066855">+</span><span class="string" id="8066856">&#34;.progressive.jpeg&#34;</span><span class="op" id="8066875">,</span>&nbsp;<span class="ident" id="8066877"><a href="/image/jpeg/reader_test.go.html#8066658">err</a></span><span class="op" id="8066880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066885">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066896">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066900">if</span>&nbsp;<span class="ident" id="8066903"><a href="/image/jpeg/reader_test.go.html#8066654">m0</a></span><span class="op" id="8066905">.</span><span class="ident" id="8066906">Bounds</span><span class="op" id="8066912">(</span><span class="op" id="8066913">)</span>&nbsp;<span class="op" id="8066915">!=</span>&nbsp;<span class="ident" id="8066918"><a href="/image/jpeg/reader_test.go.html#8066765">m1</a></span><span class="op" id="8066920">.</span><span class="ident" id="8066921">Bounds</span><span class="op" id="8066927">(</span><span class="op" id="8066928">)</span>&nbsp;<span class="op" id="8066930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066935"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8066936">.</span><span class="ident" id="8066937">Errorf</span><span class="op" id="8066943">(</span><span class="string" id="8066944">&#34;%s:&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8066974">,</span>&nbsp;<span class="ident" id="8066976"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8066978">,</span>&nbsp;<span class="ident" id="8066980"><a href="/image/jpeg/reader_test.go.html#8066654">m0</a></span><span class="op" id="8066982">.</span><span class="ident" id="8066983">Bounds</span><span class="op" id="8066989">(</span><span class="op" id="8066990">)</span><span class="op" id="8066991">,</span>&nbsp;<span class="ident" id="8066993"><a href="/image/jpeg/reader_test.go.html#8066765">m1</a></span><span class="op" id="8066995">.</span><span class="ident" id="8066996">Bounds</span><span class="op" id="8067002">(</span><span class="op" id="8067003">)</span><span class="op" id="8067004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067009">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067024">//&nbsp;All&nbsp;of&nbsp;the&nbsp;video-*.jpeg&nbsp;files&nbsp;are&nbsp;150x103.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067072">if</span>&nbsp;<span class="ident" id="8067075"><a href="/image/jpeg/reader_test.go.html#8066654">m0</a></span><span class="op" id="8067077">.</span><span class="ident" id="8067078">Bounds</span><span class="op" id="8067084">(</span><span class="op" id="8067085">)</span>&nbsp;<span class="op" id="8067087">!=</span>&nbsp;<span class="ident" id="8067090"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067095">.</span><span class="ident" id="8067096">Rect</span><span class="op" id="8067100">(</span><span class="num" id="8067101">0</span><span class="op" id="8067102">,</span>&nbsp;<span class="num" id="8067104">0</span><span class="op" id="8067105">,</span>&nbsp;<span class="num" id="8067107">150</span><span class="op" id="8067110">,</span>&nbsp;<span class="num" id="8067112">103</span><span class="op" id="8067115">)</span>&nbsp;<span class="op" id="8067117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067122"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067123">.</span><span class="ident" id="8067124">Errorf</span><span class="op" id="8067130">(</span><span class="string" id="8067131">&#34;%s:&nbsp;bad&nbsp;bounds:&nbsp;%v&#34;</span><span class="op" id="8067151">,</span>&nbsp;<span class="ident" id="8067153"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067155">,</span>&nbsp;<span class="ident" id="8067157"><a href="/image/jpeg/reader_test.go.html#8066654">m0</a></span><span class="op" id="8067159">.</span><span class="ident" id="8067160">Bounds</span><span class="op" id="8067166">(</span><span class="op" id="8067167">)</span><span class="op" id="8067168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067173">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067189">switch</span>&nbsp;<span class="ident" id="8067196">m0</span>&nbsp;<span class="op" id="8067199">:=</span>&nbsp;<span class="ident" id="8067202"><a href="/image/jpeg/reader_test.go.html#8066654">m0</a></span><span class="op" id="8067204">.</span><span class="op" id="8067205">(</span><span class="keyword" id="8067206">type</span><span class="op" id="8067210">)</span>&nbsp;<span class="op" id="8067212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067216">case</span>&nbsp;<span class="op" id="8067221">*</span><span class="ident" id="8067222"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067227">.</span><span class="ident" id="8067228">YCbCr</span><span class="op" id="8067233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067238">m1</span>&nbsp;<span class="op" id="8067241">:=</span>&nbsp;<span class="ident" id="8067244"><a href="/image/jpeg/reader_test.go.html#8066765">m1</a></span><span class="op" id="8067246">.</span><span class="op" id="8067247">(</span><span class="op" id="8067248">*</span><span class="ident" id="8067249"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067254">.</span><span class="ident" id="8067255">YCbCr</span><span class="op" id="8067260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067265">if</span>&nbsp;<span class="ident" id="8067268">err</span>&nbsp;<span class="op" id="8067272">:=</span>&nbsp;<span class="ident" id="8067275"><a href="/image/jpeg/reader_test.go.html#8069094">check</a></span><span class="op" id="8067280">(</span><span class="ident" id="8067281"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067283">.</span><span class="ident" id="8067284">Bounds</span><span class="op" id="8067290">(</span><span class="op" id="8067291">)</span><span class="op" id="8067292">,</span>&nbsp;<span class="ident" id="8067294"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067296">.</span><span class="ident" id="8067297">Y</span><span class="op" id="8067298">,</span>&nbsp;<span class="ident" id="8067300"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067302">.</span><span class="ident" id="8067303">Y</span><span class="op" id="8067304">,</span>&nbsp;<span class="ident" id="8067306"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067308">.</span><span class="ident" id="8067309">YStride</span><span class="op" id="8067316">,</span>&nbsp;<span class="ident" id="8067318"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067320">.</span><span class="ident" id="8067321">YStride</span><span class="op" id="8067328">)</span><span class="op" id="8067329">;</span>&nbsp;<span class="ident" id="8067331"><a href="/image/jpeg/reader_test.go.html#8067268">err</a></span>&nbsp;<span class="op" id="8067335">!=</span>&nbsp;<span class="ident" id="8067338">nil</span>&nbsp;<span class="op" id="8067342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067348"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067349">.</span><span class="ident" id="8067350">Errorf</span><span class="op" id="8067356">(</span><span class="string" id="8067357">&#34;%s&nbsp;(Y):&nbsp;%v&#34;</span><span class="op" id="8067369">,</span>&nbsp;<span class="ident" id="8067371"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067373">,</span>&nbsp;<span class="ident" id="8067375"><a href="/image/jpeg/reader_test.go.html#8067268">err</a></span><span class="op" id="8067378">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067384">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067401">if</span>&nbsp;<span class="ident" id="8067404">err</span>&nbsp;<span class="op" id="8067408">:=</span>&nbsp;<span class="ident" id="8067411"><a href="/image/jpeg/reader_test.go.html#8069094">check</a></span><span class="op" id="8067416">(</span><span class="ident" id="8067417"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067419">.</span><span class="ident" id="8067420">Bounds</span><span class="op" id="8067426">(</span><span class="op" id="8067427">)</span><span class="op" id="8067428">,</span>&nbsp;<span class="ident" id="8067430"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067432">.</span><span class="ident" id="8067433">Cb</span><span class="op" id="8067435">,</span>&nbsp;<span class="ident" id="8067437"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067439">.</span><span class="ident" id="8067440">Cb</span><span class="op" id="8067442">,</span>&nbsp;<span class="ident" id="8067444"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067446">.</span><span class="ident" id="8067447">CStride</span><span class="op" id="8067454">,</span>&nbsp;<span class="ident" id="8067456"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067458">.</span><span class="ident" id="8067459">CStride</span><span class="op" id="8067466">)</span><span class="op" id="8067467">;</span>&nbsp;<span class="ident" id="8067469"><a href="/image/jpeg/reader_test.go.html#8067404">err</a></span>&nbsp;<span class="op" id="8067473">!=</span>&nbsp;<span class="ident" id="8067476">nil</span>&nbsp;<span class="op" id="8067480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067486"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067487">.</span><span class="ident" id="8067488">Errorf</span><span class="op" id="8067494">(</span><span class="string" id="8067495">&#34;%s&nbsp;(Cb):&nbsp;%v&#34;</span><span class="op" id="8067508">,</span>&nbsp;<span class="ident" id="8067510"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067512">,</span>&nbsp;<span class="ident" id="8067514"><a href="/image/jpeg/reader_test.go.html#8067404">err</a></span><span class="op" id="8067517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067523">continue</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067540">if</span>&nbsp;<span class="ident" id="8067543">err</span>&nbsp;<span class="op" id="8067547">:=</span>&nbsp;<span class="ident" id="8067550"><a href="/image/jpeg/reader_test.go.html#8069094">check</a></span><span class="op" id="8067555">(</span><span class="ident" id="8067556"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067558">.</span><span class="ident" id="8067559">Bounds</span><span class="op" id="8067565">(</span><span class="op" id="8067566">)</span><span class="op" id="8067567">,</span>&nbsp;<span class="ident" id="8067569"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067571">.</span><span class="ident" id="8067572">Cr</span><span class="op" id="8067574">,</span>&nbsp;<span class="ident" id="8067576"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067578">.</span><span class="ident" id="8067579">Cr</span><span class="op" id="8067581">,</span>&nbsp;<span class="ident" id="8067583"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067585">.</span><span class="ident" id="8067586">CStride</span><span class="op" id="8067593">,</span>&nbsp;<span class="ident" id="8067595"><a href="/image/jpeg/reader_test.go.html#8067238">m1</a></span><span class="op" id="8067597">.</span><span class="ident" id="8067598">CStride</span><span class="op" id="8067605">)</span><span class="op" id="8067606">;</span>&nbsp;<span class="ident" id="8067608"><a href="/image/jpeg/reader_test.go.html#8067543">err</a></span>&nbsp;<span class="op" id="8067612">!=</span>&nbsp;<span class="ident" id="8067615">nil</span>&nbsp;<span class="op" id="8067619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067625"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067626">.</span><span class="ident" id="8067627">Errorf</span><span class="op" id="8067633">(</span><span class="string" id="8067634">&#34;%s&nbsp;(Cr):&nbsp;%v&#34;</span><span class="op" id="8067647">,</span>&nbsp;<span class="ident" id="8067649"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067651">,</span>&nbsp;<span class="ident" id="8067653"><a href="/image/jpeg/reader_test.go.html#8067543">err</a></span><span class="op" id="8067656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067662">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067674">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067678">case</span>&nbsp;<span class="op" id="8067683">*</span><span class="ident" id="8067684"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067689">.</span><span class="ident" id="8067690">Gray</span><span class="op" id="8067694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067699">m1</span>&nbsp;<span class="op" id="8067702">:=</span>&nbsp;<span class="ident" id="8067705"><a href="/image/jpeg/reader_test.go.html#8066765">m1</a></span><span class="op" id="8067707">.</span><span class="op" id="8067708">(</span><span class="op" id="8067709">*</span><span class="ident" id="8067710"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067715">.</span><span class="ident" id="8067716">Gray</span><span class="op" id="8067720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067725">if</span>&nbsp;<span class="ident" id="8067728">err</span>&nbsp;<span class="op" id="8067732">:=</span>&nbsp;<span class="ident" id="8067735"><a href="/image/jpeg/reader_test.go.html#8069094">check</a></span><span class="op" id="8067740">(</span><span class="ident" id="8067741"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067743">.</span><span class="ident" id="8067744">Bounds</span><span class="op" id="8067750">(</span><span class="op" id="8067751">)</span><span class="op" id="8067752">,</span>&nbsp;<span class="ident" id="8067754"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067756">.</span><span class="ident" id="8067757">Pix</span><span class="op" id="8067760">,</span>&nbsp;<span class="ident" id="8067762"><a href="/image/jpeg/reader_test.go.html#8067699">m1</a></span><span class="op" id="8067764">.</span><span class="ident" id="8067765">Pix</span><span class="op" id="8067768">,</span>&nbsp;<span class="ident" id="8067770"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067772">.</span><span class="ident" id="8067773">Stride</span><span class="op" id="8067779">,</span>&nbsp;<span class="ident" id="8067781"><a href="/image/jpeg/reader_test.go.html#8067699">m1</a></span><span class="op" id="8067783">.</span><span class="ident" id="8067784">Stride</span><span class="op" id="8067790">)</span><span class="op" id="8067791">;</span>&nbsp;<span class="ident" id="8067793"><a href="/image/jpeg/reader_test.go.html#8067728">err</a></span>&nbsp;<span class="op" id="8067797">!=</span>&nbsp;<span class="ident" id="8067800">nil</span>&nbsp;<span class="op" id="8067804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067810"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067811">.</span><span class="ident" id="8067812">Errorf</span><span class="op" id="8067818">(</span><span class="string" id="8067819">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8067827">,</span>&nbsp;<span class="ident" id="8067829"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067831">,</span>&nbsp;<span class="ident" id="8067833"><a href="/image/jpeg/reader_test.go.html#8067728">err</a></span><span class="op" id="8067836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067842">continue</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067858">default</span><span class="op" id="8067865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067870"><a href="/image/jpeg/reader_test.go.html#8066283">t</a></span><span class="op" id="8067871">.</span><span class="ident" id="8067872">Errorf</span><span class="op" id="8067878">(</span><span class="string" id="8067879">&#34;%s:&nbsp;unexpected&nbsp;image&nbsp;type&nbsp;%T&#34;</span><span class="op" id="8067909">,</span>&nbsp;<span class="ident" id="8067911"><a href="/image/jpeg/reader_test.go.html#8066628">tc</a></span><span class="op" id="8067913">,</span>&nbsp;<span class="ident" id="8067915"><a href="/image/jpeg/reader_test.go.html#8067196">m0</a></span><span class="op" id="8067917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067933">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067936">}</span><br>
<span class="lineno"></span><span class="op" id="8067938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8067941">func</span>&nbsp;<span class="ident" id="8067946">decodeFile</span><span class="op" id="8067956">(</span><span class="ident" id="8067957">filename</span>&nbsp;<span class="builtintype" id="8067966">string</span><span class="op" id="8067972">)</span>&nbsp;<span class="op" id="8067974">(</span><span class="ident" id="8067975"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8067980">.</span><span class="ident" id="8067981">Image</span><span class="op" id="8067986">,</span>&nbsp;<span class="builtintype" id="8067988">error</span><span class="op" id="8067993">)</span>&nbsp;<span class="op" id="8067995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067998">f</span><span class="op" id="8067999">,</span>&nbsp;<span class="ident" id="8068001">err</span>&nbsp;<span class="op" id="8068005">:=</span>&nbsp;<span class="ident" id="8068008"><a href="/image/jpeg/reader_test.go.html#8066013">os</a></span><span class="op" id="8068010">.</span><span class="ident" id="8068011">Open</span><span class="op" id="8068015">(</span><span class="ident" id="8068016"><a href="/image/jpeg/reader_test.go.html#8067957">filename</a></span><span class="op" id="8068024">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068027">if</span>&nbsp;<span class="ident" id="8068030"><a href="/image/jpeg/reader_test.go.html#8068001">err</a></span>&nbsp;<span class="op" id="8068034">!=</span>&nbsp;<span class="ident" id="8068037">nil</span>&nbsp;<span class="op" id="8068041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068045">return</span>&nbsp;<span class="ident" id="8068052">nil</span><span class="op" id="8068055">,</span>&nbsp;<span class="ident" id="8068057"><a href="/image/jpeg/reader_test.go.html#8068001">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068065">defer</span>&nbsp;<span class="ident" id="8068071"><a href="/image/jpeg/reader_test.go.html#8067998">f</a></span><span class="op" id="8068072">.</span><span class="ident" id="8068073">Close</span><span class="op" id="8068078">(</span><span class="op" id="8068079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068082">return</span>&nbsp;<span class="ident" id="8068089"><a href="/image/jpeg/reader.go.html#3150112">Decode</a></span><span class="op" id="8068095">(</span><span class="ident" id="8068096"><a href="/image/jpeg/reader_test.go.html#8067998">f</a></span><span class="op" id="8068097">)</span><br>
<span class="lineno">90</span><span class="op" id="8068099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8068102">type</span>&nbsp;<span class="ident" id="8068107">eofReader</span>&nbsp;<span class="keyword" id="8068117">struct</span>&nbsp;<span class="op" id="8068124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068127">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8068136">[</span><span class="op" id="8068137">]</span><span class="builtintype" id="8068138">byte</span>&nbsp;<span class="comment" id="8068143">//&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;without&nbsp;EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068177">dataEOF</span>&nbsp;&nbsp;<span class="op" id="8068186">[</span><span class="op" id="8068187">]</span><span class="builtintype" id="8068188">byte</span>&nbsp;<span class="comment" id="8068193">//&nbsp;then&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;with&nbsp;EOF&nbsp;on&nbsp;last&nbsp;chunk</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068243">lenAtEOF</span>&nbsp;<span class="builtintype" id="8068252">int</span><br>
<span class="lineno"></span><span class="op" id="8068256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8068259">func</span>&nbsp;<span class="op" id="8068264">(</span><span class="ident" id="8068265">r</span>&nbsp;<span class="op" id="8068267">*</span><span class="ident" id="8068268"><a href="/image/jpeg/reader_test.go.html#8068107">eofReader</a></span><span class="op" id="8068277">)</span>&nbsp;<span class="ident" id="8068279">Read</span><span class="op" id="8068283">(</span><span class="ident" id="8068284">b</span>&nbsp;<span class="op" id="8068286">[</span><span class="op" id="8068287">]</span><span class="builtintype" id="8068288">byte</span><span class="op" id="8068292">)</span>&nbsp;<span class="op" id="8068294">(</span><span class="ident" id="8068295">n</span>&nbsp;<span class="builtintype" id="8068297">int</span><span class="op" id="8068300">,</span>&nbsp;<span class="ident" id="8068302">err</span>&nbsp;<span class="builtintype" id="8068306">error</span><span class="op" id="8068311">)</span>&nbsp;<span class="op" id="8068313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068316">if</span>&nbsp;<span class="builtinfunc" id="8068319">len</span><span class="op" id="8068322">(</span><span class="ident" id="8068323"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068324">.</span><span class="ident" id="8068325">data</span><span class="op" id="8068329">)</span>&nbsp;<span class="op" id="8068331">&gt;</span>&nbsp;<span class="num" id="8068333">0</span>&nbsp;<span class="op" id="8068335">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068339"><a href="/image/jpeg/reader_test.go.html#8068295">n</a></span>&nbsp;<span class="op" id="8068341">=</span>&nbsp;<span class="builtinfunc" id="8068343">copy</span><span class="op" id="8068347">(</span><span class="ident" id="8068348"><a href="/image/jpeg/reader_test.go.html#8068284">b</a></span><span class="op" id="8068349">,</span>&nbsp;<span class="ident" id="8068351"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068352">.</span><span class="ident" id="8068353">data</span><span class="op" id="8068357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068361"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068362">.</span><span class="ident" id="8068363">data</span>&nbsp;<span class="op" id="8068368">=</span>&nbsp;<span class="ident" id="8068370"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068371">.</span><span class="ident" id="8068372">data</span><span class="op" id="8068376">[</span><span class="ident" id="8068377"><a href="/image/jpeg/reader_test.go.html#8068295">n</a></span><span class="op" id="8068378">:</span><span class="op" id="8068379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068382">}</span>&nbsp;<span class="keyword" id="8068384">else</span>&nbsp;<span class="op" id="8068389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068393"><a href="/image/jpeg/reader_test.go.html#8068295">n</a></span>&nbsp;<span class="op" id="8068395">=</span>&nbsp;<span class="builtinfunc" id="8068397">copy</span><span class="op" id="8068401">(</span><span class="ident" id="8068402"><a href="/image/jpeg/reader_test.go.html#8068284">b</a></span><span class="op" id="8068403">,</span>&nbsp;<span class="ident" id="8068405"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068406">.</span><span class="ident" id="8068407">dataEOF</span><span class="op" id="8068414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068418"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068419">.</span><span class="ident" id="8068420">dataEOF</span>&nbsp;<span class="op" id="8068428">=</span>&nbsp;<span class="ident" id="8068430"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068431">.</span><span class="ident" id="8068432">dataEOF</span><span class="op" id="8068439">[</span><span class="ident" id="8068440"><a href="/image/jpeg/reader_test.go.html#8068295">n</a></span><span class="op" id="8068441">:</span><span class="op" id="8068442">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068446">if</span>&nbsp;<span class="builtinfunc" id="8068449">len</span><span class="op" id="8068452">(</span><span class="ident" id="8068453"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068454">.</span><span class="ident" id="8068455">dataEOF</span><span class="op" id="8068462">)</span>&nbsp;<span class="op" id="8068464">==</span>&nbsp;<span class="num" id="8068467">0</span>&nbsp;<span class="op" id="8068469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068474"><a href="/image/jpeg/reader_test.go.html#8068302">err</a></span>&nbsp;<span class="op" id="8068478">=</span>&nbsp;<span class="ident" id="8068480"><a href="/image/jpeg/reader_test.go.html#8065981">io</a></span><span class="op" id="8068482">.</span><span class="ident" id="8068483">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068490">if</span>&nbsp;<span class="ident" id="8068493"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068494">.</span><span class="ident" id="8068495">lenAtEOF</span>&nbsp;<span class="op" id="8068504">==</span>&nbsp;<span class="op" id="8068507">-</span><span class="num" id="8068508">1</span>&nbsp;<span class="op" id="8068510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068516"><a href="/image/jpeg/reader_test.go.html#8068265">r</a></span><span class="op" id="8068517">.</span><span class="ident" id="8068518">lenAtEOF</span>&nbsp;<span class="op" id="8068527">=</span>&nbsp;<span class="ident" id="8068529"><a href="/image/jpeg/reader_test.go.html#8068295">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068534">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068544">return</span><br>
<span class="lineno"></span><span class="op" id="8068551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="8068554">func</span>&nbsp;<span class="ident" id="8068559">TestDecodeEOF</span><span class="op" id="8068572">(</span><span class="ident" id="8068573">t</span>&nbsp;<span class="op" id="8068575">*</span><span class="ident" id="8068576"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8068583">.</span><span class="ident" id="8068584">T</span><span class="op" id="8068585">)</span>&nbsp;<span class="op" id="8068587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068590">//&nbsp;Check&nbsp;that&nbsp;if&nbsp;reader&nbsp;returns&nbsp;final&nbsp;data&nbsp;and&nbsp;EOF&nbsp;at&nbsp;same&nbsp;time,&nbsp;jpeg&nbsp;handles&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068673">data</span><span class="op" id="8068677">,</span>&nbsp;<span class="ident" id="8068679">err</span>&nbsp;<span class="op" id="8068683">:=</span>&nbsp;<span class="ident" id="8068686"><a href="/image/jpeg/reader_test.go.html#8065987">ioutil</a></span><span class="op" id="8068692">.</span><span class="ident" id="8068693">ReadFile</span><span class="op" id="8068701">(</span><span class="string" id="8068702">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="8068730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068733">if</span>&nbsp;<span class="ident" id="8068736"><a href="/image/jpeg/reader_test.go.html#8068679">err</a></span>&nbsp;<span class="op" id="8068740">!=</span>&nbsp;<span class="ident" id="8068743">nil</span>&nbsp;<span class="op" id="8068747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068751"><a href="/image/jpeg/reader_test.go.html#8068573">t</a></span><span class="op" id="8068752">.</span><span class="ident" id="8068753">Fatal</span><span class="op" id="8068758">(</span><span class="ident" id="8068759"><a href="/image/jpeg/reader_test.go.html#8068679">err</a></span><span class="op" id="8068762">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068769">n</span>&nbsp;<span class="op" id="8068771">:=</span>&nbsp;<span class="builtinfunc" id="8068774">len</span><span class="op" id="8068777">(</span><span class="ident" id="8068778"><a href="/image/jpeg/reader_test.go.html#8068673">data</a></span><span class="op" id="8068782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068785">for</span>&nbsp;<span class="ident" id="8068789">i</span>&nbsp;<span class="op" id="8068791">:=</span>&nbsp;<span class="num" id="8068794">0</span><span class="op" id="8068795">;</span>&nbsp;<span class="ident" id="8068797"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span>&nbsp;<span class="op" id="8068799">&lt;</span>&nbsp;<span class="ident" id="8068801"><a href="/image/jpeg/reader_test.go.html#8068769">n</a></span><span class="op" id="8068802">;</span>&nbsp;<span class="op" id="8068804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068808">r</span>&nbsp;<span class="op" id="8068810">:=</span>&nbsp;<span class="op" id="8068813">&amp;</span><span class="ident" id="8068814"><a href="/image/jpeg/reader_test.go.html#8068107">eofReader</a></span><span class="op" id="8068823">{</span><span class="ident" id="8068824"><a href="/image/jpeg/reader_test.go.html#8068673">data</a></span><span class="op" id="8068828">[</span><span class="op" id="8068829">:</span><span class="ident" id="8068830"><a href="/image/jpeg/reader_test.go.html#8068769">n</a></span><span class="op" id="8068831">-</span><span class="ident" id="8068832"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span><span class="op" id="8068833">]</span><span class="op" id="8068834">,</span>&nbsp;<span class="ident" id="8068836"><a href="/image/jpeg/reader_test.go.html#8068673">data</a></span><span class="op" id="8068840">[</span><span class="ident" id="8068841"><a href="/image/jpeg/reader_test.go.html#8068769">n</a></span><span class="op" id="8068842">-</span><span class="ident" id="8068843"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span><span class="op" id="8068844">:</span><span class="op" id="8068845">]</span><span class="op" id="8068846">,</span>&nbsp;<span class="op" id="8068848">-</span><span class="num" id="8068849">1</span><span class="op" id="8068850">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068854">_</span><span class="op" id="8068855">,</span>&nbsp;<span class="ident" id="8068857">err</span>&nbsp;<span class="op" id="8068861">:=</span>&nbsp;<span class="ident" id="8068864"><a href="/image/jpeg/reader.go.html#3150112">Decode</a></span><span class="op" id="8068870">(</span><span class="ident" id="8068871"><a href="/image/jpeg/reader_test.go.html#8068808">r</a></span><span class="op" id="8068872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068876">if</span>&nbsp;<span class="ident" id="8068879"><a href="/image/jpeg/reader_test.go.html#8068857">err</a></span>&nbsp;<span class="op" id="8068883">!=</span>&nbsp;<span class="ident" id="8068886">nil</span>&nbsp;<span class="op" id="8068890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068895"><a href="/image/jpeg/reader_test.go.html#8068573">t</a></span><span class="op" id="8068896">.</span><span class="ident" id="8068897">Errorf</span><span class="op" id="8068903">(</span><span class="string" id="8068904">&#34;Decode&nbsp;with&nbsp;Read()&nbsp;=&nbsp;%d,&nbsp;EOF:&nbsp;%v&#34;</span><span class="op" id="8068938">,</span>&nbsp;<span class="ident" id="8068940"><a href="/image/jpeg/reader_test.go.html#8068808">r</a></span><span class="op" id="8068941">.</span><span class="ident" id="8068942">lenAtEOF</span><span class="op" id="8068950">,</span>&nbsp;<span class="ident" id="8068952"><a href="/image/jpeg/reader_test.go.html#8068857">err</a></span><span class="op" id="8068955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068963">if</span>&nbsp;<span class="ident" id="8068966"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span>&nbsp;<span class="op" id="8068968">==</span>&nbsp;<span class="num" id="8068971">0</span>&nbsp;<span class="op" id="8068973">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068978"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span>&nbsp;<span class="op" id="8068980">=</span>&nbsp;<span class="num" id="8068982">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068986">}</span>&nbsp;<span class="keyword" id="8068988">else</span>&nbsp;<span class="op" id="8068993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068998"><a href="/image/jpeg/reader_test.go.html#8068789">i</a></span>&nbsp;<span class="op" id="8069000">*=</span>&nbsp;<span class="num" id="8069003">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069010">}</span><br>
<span class="lineno">135</span><span class="op" id="8069012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8069015">//&nbsp;check&nbsp;checks&nbsp;that&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;are&nbsp;equal,&nbsp;within&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8069089">func</span>&nbsp;<span class="ident" id="8069094">check</span><span class="op" id="8069099">(</span><span class="ident" id="8069100">bounds</span>&nbsp;<span class="ident" id="8069107"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8069112">.</span><span class="ident" id="8069113">Rectangle</span><span class="op" id="8069122">,</span>&nbsp;<span class="ident" id="8069124">pix0</span><span class="op" id="8069128">,</span>&nbsp;<span class="ident" id="8069130">pix1</span>&nbsp;<span class="op" id="8069135">[</span><span class="op" id="8069136">]</span><span class="builtintype" id="8069137">byte</span><span class="op" id="8069141">,</span>&nbsp;<span class="ident" id="8069143">stride0</span><span class="op" id="8069150">,</span>&nbsp;<span class="ident" id="8069152">stride1</span>&nbsp;<span class="builtintype" id="8069160">int</span><span class="op" id="8069163">)</span>&nbsp;<span class="builtintype" id="8069165">error</span>&nbsp;<span class="op" id="8069171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069174">if</span>&nbsp;<span class="ident" id="8069177"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span>&nbsp;<span class="op" id="8069185">&lt;=</span>&nbsp;<span class="num" id="8069188">0</span>&nbsp;<span class="op" id="8069190">||</span>&nbsp;<span class="ident" id="8069193"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span><span class="op" id="8069200">%</span><span class="num" id="8069201">8</span>&nbsp;<span class="op" id="8069203">!=</span>&nbsp;<span class="num" id="8069206">0</span>&nbsp;<span class="op" id="8069208">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069212">return</span>&nbsp;<span class="ident" id="8069219"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8069222">.</span><span class="ident" id="8069223">Errorf</span><span class="op" id="8069229">(</span><span class="string" id="8069230">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="8069245">,</span>&nbsp;<span class="ident" id="8069247"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span><span class="op" id="8069254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069260">if</span>&nbsp;<span class="ident" id="8069263"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span>&nbsp;<span class="op" id="8069271">&lt;=</span>&nbsp;<span class="num" id="8069274">0</span>&nbsp;<span class="op" id="8069276">||</span>&nbsp;<span class="ident" id="8069279"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span><span class="op" id="8069286">%</span><span class="num" id="8069287">8</span>&nbsp;<span class="op" id="8069289">!=</span>&nbsp;<span class="num" id="8069292">0</span>&nbsp;<span class="op" id="8069294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069298">return</span>&nbsp;<span class="ident" id="8069305"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8069308">.</span><span class="ident" id="8069309">Errorf</span><span class="op" id="8069315">(</span><span class="string" id="8069316">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="8069331">,</span>&nbsp;<span class="ident" id="8069333"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span><span class="op" id="8069340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069343">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069346">//&nbsp;Compare&nbsp;the&nbsp;two&nbsp;pix&nbsp;data,&nbsp;one&nbsp;8x8&nbsp;block&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069401">for</span>&nbsp;<span class="ident" id="8069405">y</span>&nbsp;<span class="op" id="8069407">:=</span>&nbsp;<span class="num" id="8069410">0</span><span class="op" id="8069411">;</span>&nbsp;<span class="ident" id="8069413"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span>&nbsp;<span class="op" id="8069415">&lt;</span>&nbsp;<span class="builtinfunc" id="8069417">len</span><span class="op" id="8069420">(</span><span class="ident" id="8069421"><a href="/image/jpeg/reader_test.go.html#8069124">pix0</a></span><span class="op" id="8069425">)</span><span class="op" id="8069426">/</span><span class="ident" id="8069427"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span>&nbsp;<span class="op" id="8069435">&amp;&amp;</span>&nbsp;<span class="ident" id="8069438"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span>&nbsp;<span class="op" id="8069440">&lt;</span>&nbsp;<span class="builtinfunc" id="8069442">len</span><span class="op" id="8069445">(</span><span class="ident" id="8069446"><a href="/image/jpeg/reader_test.go.html#8069130">pix1</a></span><span class="op" id="8069450">)</span><span class="op" id="8069451">/</span><span class="ident" id="8069452"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span><span class="op" id="8069459">;</span>&nbsp;<span class="ident" id="8069461"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span>&nbsp;<span class="op" id="8069463">+=</span>&nbsp;<span class="num" id="8069466">8</span>&nbsp;<span class="op" id="8069468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069472">for</span>&nbsp;<span class="ident" id="8069476">x</span>&nbsp;<span class="op" id="8069478">:=</span>&nbsp;<span class="num" id="8069481">0</span><span class="op" id="8069482">;</span>&nbsp;<span class="ident" id="8069484"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8069486">&lt;</span>&nbsp;<span class="ident" id="8069488"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span>&nbsp;<span class="op" id="8069496">&amp;&amp;</span>&nbsp;<span class="ident" id="8069499"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8069501">&lt;</span>&nbsp;<span class="ident" id="8069503"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span><span class="op" id="8069510">;</span>&nbsp;<span class="ident" id="8069512"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8069514">+=</span>&nbsp;<span class="num" id="8069517">8</span>&nbsp;<span class="op" id="8069519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069524">if</span>&nbsp;<span class="ident" id="8069527"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8069529">&gt;=</span>&nbsp;<span class="ident" id="8069532"><a href="/image/jpeg/reader_test.go.html#8069100">bounds</a></span><span class="op" id="8069538">.</span><span class="ident" id="8069539">Max</span><span class="op" id="8069542">.</span><span class="ident" id="8069543">X</span>&nbsp;<span class="op" id="8069545">||</span>&nbsp;<span class="ident" id="8069548"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span>&nbsp;<span class="op" id="8069550">&gt;=</span>&nbsp;<span class="ident" id="8069553"><a href="/image/jpeg/reader_test.go.html#8069100">bounds</a></span><span class="op" id="8069559">.</span><span class="ident" id="8069560">Max</span><span class="op" id="8069563">.</span><span class="ident" id="8069564">Y</span>&nbsp;<span class="op" id="8069566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069572">//&nbsp;We&nbsp;don&#39;t&nbsp;care&nbsp;if&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;differ&nbsp;if&nbsp;the&nbsp;8x8&nbsp;block&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069640">//&nbsp;entirely&nbsp;outside&nbsp;of&nbsp;the&nbsp;image&#39;s&nbsp;bounds.&nbsp;For&nbsp;example,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069709">//&nbsp;occur&nbsp;with&nbsp;a&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling&nbsp;and&nbsp;a&nbsp;1x1&nbsp;image.&nbsp;Baseline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069780">//&nbsp;decoding&nbsp;works&nbsp;on&nbsp;the&nbsp;one&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole;&nbsp;progressive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069847">//&nbsp;decoding&#39;s&nbsp;first&nbsp;pass&nbsp;works&nbsp;on&nbsp;that&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069915">//&nbsp;refinement&nbsp;passes&nbsp;only&nbsp;process&nbsp;one&nbsp;8x8&nbsp;block&nbsp;within&nbsp;the&nbsp;MCU.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069983">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070001">for</span>&nbsp;<span class="ident" id="8070005">j</span>&nbsp;<span class="op" id="8070007">:=</span>&nbsp;<span class="num" id="8070010">0</span><span class="op" id="8070011">;</span>&nbsp;<span class="ident" id="8070013"><a href="/image/jpeg/reader_test.go.html#8070005">j</a></span>&nbsp;<span class="op" id="8070015">&lt;</span>&nbsp;<span class="num" id="8070017">8</span><span class="op" id="8070018">;</span>&nbsp;<span class="ident" id="8070020"><a href="/image/jpeg/reader_test.go.html#8070005">j</a></span><span class="op" id="8070021">++</span>&nbsp;<span class="op" id="8070024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070030">for</span>&nbsp;<span class="ident" id="8070034">i</span>&nbsp;<span class="op" id="8070036">:=</span>&nbsp;<span class="num" id="8070039">0</span><span class="op" id="8070040">;</span>&nbsp;<span class="ident" id="8070042"><a href="/image/jpeg/reader_test.go.html#8070034">i</a></span>&nbsp;<span class="op" id="8070044">&lt;</span>&nbsp;<span class="num" id="8070046">8</span><span class="op" id="8070047">;</span>&nbsp;<span class="ident" id="8070049"><a href="/image/jpeg/reader_test.go.html#8070034">i</a></span><span class="op" id="8070050">++</span>&nbsp;<span class="op" id="8070053">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070060">index0</span>&nbsp;<span class="op" id="8070067">:=</span>&nbsp;<span class="op" id="8070070">(</span><span class="ident" id="8070071"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span><span class="op" id="8070072">+</span><span class="ident" id="8070073"><a href="/image/jpeg/reader_test.go.html#8070005">j</a></span><span class="op" id="8070074">)</span><span class="op" id="8070075">*</span><span class="ident" id="8070076"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span>&nbsp;<span class="op" id="8070084">+</span>&nbsp;<span class="op" id="8070086">(</span><span class="ident" id="8070087"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8070089">+</span>&nbsp;<span class="ident" id="8070091"><a href="/image/jpeg/reader_test.go.html#8070034">i</a></span><span class="op" id="8070092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070099">index1</span>&nbsp;<span class="op" id="8070106">:=</span>&nbsp;<span class="op" id="8070109">(</span><span class="ident" id="8070110"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span><span class="op" id="8070111">+</span><span class="ident" id="8070112"><a href="/image/jpeg/reader_test.go.html#8070005">j</a></span><span class="op" id="8070113">)</span><span class="op" id="8070114">*</span><span class="ident" id="8070115"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span>&nbsp;<span class="op" id="8070123">+</span>&nbsp;<span class="op" id="8070125">(</span><span class="ident" id="8070126"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span>&nbsp;<span class="op" id="8070128">+</span>&nbsp;<span class="ident" id="8070130"><a href="/image/jpeg/reader_test.go.html#8070034">i</a></span><span class="op" id="8070131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070138">if</span>&nbsp;<span class="ident" id="8070141"><a href="/image/jpeg/reader_test.go.html#8069124">pix0</a></span><span class="op" id="8070145">[</span><span class="ident" id="8070146"><a href="/image/jpeg/reader_test.go.html#8070060">index0</a></span><span class="op" id="8070152">]</span>&nbsp;<span class="op" id="8070154">!=</span>&nbsp;<span class="ident" id="8070157"><a href="/image/jpeg/reader_test.go.html#8069130">pix1</a></span><span class="op" id="8070161">[</span><span class="ident" id="8070162"><a href="/image/jpeg/reader_test.go.html#8070099">index1</a></span><span class="op" id="8070168">]</span>&nbsp;<span class="op" id="8070170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070178">return</span>&nbsp;<span class="ident" id="8070185"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8070188">.</span><span class="ident" id="8070189">Errorf</span><span class="op" id="8070195">(</span><span class="string" id="8070196">&#34;blocks&nbsp;at&nbsp;(%d,&nbsp;%d)&nbsp;differ:\n%sand\n%s&#34;</span><span class="op" id="8070235">,</span>&nbsp;<span class="ident" id="8070237"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span><span class="op" id="8070238">,</span>&nbsp;<span class="ident" id="8070240"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span><span class="op" id="8070241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070250"><a href="/image/jpeg/reader_test.go.html#8070374">pixString</a></span><span class="op" id="8070259">(</span><span class="ident" id="8070260"><a href="/image/jpeg/reader_test.go.html#8069124">pix0</a></span><span class="op" id="8070264">,</span>&nbsp;<span class="ident" id="8070266"><a href="/image/jpeg/reader_test.go.html#8069143">stride0</a></span><span class="op" id="8070273">,</span>&nbsp;<span class="ident" id="8070275"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span><span class="op" id="8070276">,</span>&nbsp;<span class="ident" id="8070278"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span><span class="op" id="8070279">)</span><span class="op" id="8070280">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070289"><a href="/image/jpeg/reader_test.go.html#8070374">pixString</a></span><span class="op" id="8070298">(</span><span class="ident" id="8070299"><a href="/image/jpeg/reader_test.go.html#8069130">pix1</a></span><span class="op" id="8070303">,</span>&nbsp;<span class="ident" id="8070305"><a href="/image/jpeg/reader_test.go.html#8069152">stride1</a></span><span class="op" id="8070312">,</span>&nbsp;<span class="ident" id="8070314"><a href="/image/jpeg/reader_test.go.html#8069476">x</a></span><span class="op" id="8070315">,</span>&nbsp;<span class="ident" id="8070317"><a href="/image/jpeg/reader_test.go.html#8069405">y</a></span><span class="op" id="8070318">)</span><span class="op" id="8070319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070345">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070355">return</span>&nbsp;<span class="ident" id="8070362">nil</span><br>
<span class="lineno"></span><span class="op" id="8070366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8070369">func</span>&nbsp;<span class="ident" id="8070374">pixString</span><span class="op" id="8070383">(</span><span class="ident" id="8070384">pix</span>&nbsp;<span class="op" id="8070388">[</span><span class="op" id="8070389">]</span><span class="builtintype" id="8070390">byte</span><span class="op" id="8070394">,</span>&nbsp;<span class="ident" id="8070396">stride</span><span class="op" id="8070402">,</span>&nbsp;<span class="ident" id="8070404">x</span><span class="op" id="8070405">,</span>&nbsp;<span class="ident" id="8070407">y</span>&nbsp;<span class="builtintype" id="8070409">int</span><span class="op" id="8070412">)</span>&nbsp;<span class="builtintype" id="8070414">string</span>&nbsp;<span class="op" id="8070421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070424">s</span>&nbsp;<span class="op" id="8070426">:=</span>&nbsp;<span class="ident" id="8070429"><a href="/image/jpeg/reader_test.go.html#8065941">bytes</a></span><span class="op" id="8070434">.</span><span class="ident" id="8070435">NewBuffer</span><span class="op" id="8070444">(</span><span class="ident" id="8070445">nil</span><span class="op" id="8070448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070451">for</span>&nbsp;<span class="ident" id="8070455">j</span>&nbsp;<span class="op" id="8070457">:=</span>&nbsp;<span class="num" id="8070460">0</span><span class="op" id="8070461">;</span>&nbsp;<span class="ident" id="8070463"><a href="/image/jpeg/reader_test.go.html#8070455">j</a></span>&nbsp;<span class="op" id="8070465">&lt;</span>&nbsp;<span class="num" id="8070467">8</span><span class="op" id="8070468">;</span>&nbsp;<span class="ident" id="8070470"><a href="/image/jpeg/reader_test.go.html#8070455">j</a></span><span class="op" id="8070471">++</span>&nbsp;<span class="op" id="8070474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070478"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8070481">.</span><span class="ident" id="8070482">Fprintf</span><span class="op" id="8070489">(</span><span class="ident" id="8070490"><a href="/image/jpeg/reader_test.go.html#8070424">s</a></span><span class="op" id="8070491">,</span>&nbsp;<span class="string" id="8070493">&#34;\t&#34;</span><span class="op" id="8070497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070501">for</span>&nbsp;<span class="ident" id="8070505">i</span>&nbsp;<span class="op" id="8070507">:=</span>&nbsp;<span class="num" id="8070510">0</span><span class="op" id="8070511">;</span>&nbsp;<span class="ident" id="8070513"><a href="/image/jpeg/reader_test.go.html#8070505">i</a></span>&nbsp;<span class="op" id="8070515">&lt;</span>&nbsp;<span class="num" id="8070517">8</span><span class="op" id="8070518">;</span>&nbsp;<span class="ident" id="8070520"><a href="/image/jpeg/reader_test.go.html#8070505">i</a></span><span class="op" id="8070521">++</span>&nbsp;<span class="op" id="8070524">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070529"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8070532">.</span><span class="ident" id="8070533">Fprintf</span><span class="op" id="8070540">(</span><span class="ident" id="8070541"><a href="/image/jpeg/reader_test.go.html#8070424">s</a></span><span class="op" id="8070542">,</span>&nbsp;<span class="string" id="8070544">&#34;%02x&nbsp;&#34;</span><span class="op" id="8070551">,</span>&nbsp;<span class="ident" id="8070553"><a href="/image/jpeg/reader_test.go.html#8070384">pix</a></span><span class="op" id="8070556">[</span><span class="op" id="8070557">(</span><span class="ident" id="8070558"><a href="/image/jpeg/reader_test.go.html#8070407">y</a></span><span class="op" id="8070559">+</span><span class="ident" id="8070560"><a href="/image/jpeg/reader_test.go.html#8070455">j</a></span><span class="op" id="8070561">)</span><span class="op" id="8070562">*</span><span class="ident" id="8070563"><a href="/image/jpeg/reader_test.go.html#8070396">stride</a></span><span class="op" id="8070569">+</span><span class="op" id="8070570">(</span><span class="ident" id="8070571"><a href="/image/jpeg/reader_test.go.html#8070404">x</a></span><span class="op" id="8070572">+</span><span class="ident" id="8070573"><a href="/image/jpeg/reader_test.go.html#8070505">i</a></span><span class="op" id="8070574">)</span><span class="op" id="8070575">]</span><span class="op" id="8070576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070584"><a href="/image/jpeg/reader_test.go.html#8065950">fmt</a></span><span class="op" id="8070587">.</span><span class="ident" id="8070588">Fprintf</span><span class="op" id="8070595">(</span><span class="ident" id="8070596"><a href="/image/jpeg/reader_test.go.html#8070424">s</a></span><span class="op" id="8070597">,</span>&nbsp;<span class="string" id="8070599">&#34;\n&#34;</span><span class="op" id="8070603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070609">return</span>&nbsp;<span class="ident" id="8070616"><a href="/image/jpeg/reader_test.go.html#8070424">s</a></span><span class="op" id="8070617">.</span><span class="ident" id="8070618">String</span><span class="op" id="8070624">(</span><span class="op" id="8070625">)</span><br>
<span class="lineno">185</span><span class="op" id="8070627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8070630">func</span>&nbsp;<span class="ident" id="8070635">TestExtraneousData</span><span class="op" id="8070653">(</span><span class="ident" id="8070654">t</span>&nbsp;<span class="op" id="8070656">*</span><span class="ident" id="8070657"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8070664">.</span><span class="ident" id="8070665">T</span><span class="op" id="8070666">)</span>&nbsp;<span class="op" id="8070668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8070671">//&nbsp;Encode&nbsp;a&nbsp;1x1&nbsp;red&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070699">src</span>&nbsp;<span class="op" id="8070703">:=</span>&nbsp;<span class="ident" id="8070706"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8070711">.</span><span class="ident" id="8070712">NewRGBA</span><span class="op" id="8070719">(</span><span class="ident" id="8070720"><a href="/image/jpeg/reader_test.go.html#8065957">image</a></span><span class="op" id="8070725">.</span><span class="ident" id="8070726">Rect</span><span class="op" id="8070730">(</span><span class="num" id="8070731">0</span><span class="op" id="8070732">,</span>&nbsp;<span class="num" id="8070734">0</span><span class="op" id="8070735">,</span>&nbsp;<span class="num" id="8070737">1</span><span class="op" id="8070738">,</span>&nbsp;<span class="num" id="8070740">1</span><span class="op" id="8070741">)</span><span class="op" id="8070742">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070745"><a href="/image/jpeg/reader_test.go.html#8070699">src</a></span><span class="op" id="8070748">.</span><span class="ident" id="8070749">Set</span><span class="op" id="8070752">(</span><span class="num" id="8070753">0</span><span class="op" id="8070754">,</span>&nbsp;<span class="num" id="8070756">0</span><span class="op" id="8070757">,</span>&nbsp;<span class="ident" id="8070759"><a href="/image/jpeg/reader_test.go.html#8065966">color</a></span><span class="op" id="8070764">.</span><span class="ident" id="8070765">RGBA</span><span class="op" id="8070769">{</span><span class="num" id="8070770">0xff</span><span class="op" id="8070774">,</span>&nbsp;<span class="num" id="8070776">0x00</span><span class="op" id="8070780">,</span>&nbsp;<span class="num" id="8070782">0x00</span><span class="op" id="8070786">,</span>&nbsp;<span class="num" id="8070788">0xff</span><span class="op" id="8070792">}</span><span class="op" id="8070793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070796">buf</span>&nbsp;<span class="op" id="8070800">:=</span>&nbsp;<span class="builtinfunc" id="8070803">new</span><span class="op" id="8070806">(</span><span class="ident" id="8070807"><a href="/image/jpeg/reader_test.go.html#8065941">bytes</a></span><span class="op" id="8070812">.</span><span class="ident" id="8070813">Buffer</span><span class="op" id="8070819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070822">if</span>&nbsp;<span class="ident" id="8070825">err</span>&nbsp;<span class="op" id="8070829">:=</span>&nbsp;<span class="ident" id="8070832"><a href="/image/jpeg/writer.go.html#3179028">Encode</a></span><span class="op" id="8070838">(</span><span class="ident" id="8070839"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8070842">,</span>&nbsp;<span class="ident" id="8070844"><a href="/image/jpeg/reader_test.go.html#8070699">src</a></span><span class="op" id="8070847">,</span>&nbsp;<span class="ident" id="8070849">nil</span><span class="op" id="8070852">)</span><span class="op" id="8070853">;</span>&nbsp;<span class="ident" id="8070855"><a href="/image/jpeg/reader_test.go.html#8070825">err</a></span>&nbsp;<span class="op" id="8070859">!=</span>&nbsp;<span class="ident" id="8070862">nil</span>&nbsp;<span class="op" id="8070866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070870"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8070871">.</span><span class="ident" id="8070872">Fatalf</span><span class="op" id="8070878">(</span><span class="string" id="8070879">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8070891">,</span>&nbsp;<span class="ident" id="8070893"><a href="/image/jpeg/reader_test.go.html#8070825">err</a></span><span class="op" id="8070896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070899">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070902">enc</span>&nbsp;<span class="op" id="8070906">:=</span>&nbsp;<span class="ident" id="8070909"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8070912">.</span><span class="ident" id="8070913">String</span><span class="op" id="8070919">(</span><span class="op" id="8070920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8070923">//&nbsp;Sanity&nbsp;check&nbsp;that&nbsp;the&nbsp;encoded&nbsp;JPEG&nbsp;is&nbsp;long&nbsp;enough,&nbsp;that&nbsp;it&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8070996">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker,&nbsp;and&nbsp;that&nbsp;it&nbsp;contains&nbsp;a&nbsp;&#34;\xff\xda&#34;&nbsp;SOS&nbsp;marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071068">//&nbsp;somewhere&nbsp;in&nbsp;the&nbsp;final&nbsp;64&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071105">if</span>&nbsp;<span class="builtinfunc" id="8071108">len</span><span class="op" id="8071111">(</span><span class="ident" id="8071112"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071115">)</span>&nbsp;<span class="op" id="8071117">&lt;</span>&nbsp;<span class="num" id="8071119">64</span>&nbsp;<span class="op" id="8071122">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071126"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8071127">.</span><span class="ident" id="8071128">Fatalf</span><span class="op" id="8071134">(</span><span class="string" id="8071135">&#34;encoded&nbsp;JPEG&nbsp;is&nbsp;too&nbsp;short:&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8071172">,</span>&nbsp;<span class="builtinfunc" id="8071174">len</span><span class="op" id="8071177">(</span><span class="ident" id="8071178"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071181">)</span><span class="op" id="8071182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071188">if</span>&nbsp;<span class="ident" id="8071191">got</span><span class="op" id="8071194">,</span>&nbsp;<span class="ident" id="8071196">want</span>&nbsp;<span class="op" id="8071201">:=</span>&nbsp;<span class="ident" id="8071204"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071207">[</span><span class="builtinfunc" id="8071208">len</span><span class="op" id="8071211">(</span><span class="ident" id="8071212"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071215">)</span><span class="op" id="8071216">-</span><span class="num" id="8071217">2</span><span class="op" id="8071218">:</span><span class="op" id="8071219">]</span><span class="op" id="8071220">,</span>&nbsp;<span class="string" id="8071222">&#34;\xff\xd9&#34;</span><span class="op" id="8071232">;</span>&nbsp;<span class="ident" id="8071234"><a href="/image/jpeg/reader_test.go.html#8071191">got</a></span>&nbsp;<span class="op" id="8071238">!=</span>&nbsp;<span class="ident" id="8071241"><a href="/image/jpeg/reader_test.go.html#8071196">want</a></span>&nbsp;<span class="op" id="8071246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071250"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8071251">.</span><span class="ident" id="8071252">Fatalf</span><span class="op" id="8071258">(</span><span class="string" id="8071259">&#34;encoded&nbsp;JPEG&nbsp;ends&nbsp;with&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8071295">,</span>&nbsp;<span class="ident" id="8071297"><a href="/image/jpeg/reader_test.go.html#8071191">got</a></span><span class="op" id="8071300">,</span>&nbsp;<span class="ident" id="8071302"><a href="/image/jpeg/reader_test.go.html#8071196">want</a></span><span class="op" id="8071306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071309">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071312">if</span>&nbsp;<span class="ident" id="8071315">s</span>&nbsp;<span class="op" id="8071317">:=</span>&nbsp;<span class="ident" id="8071320"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071323">[</span><span class="builtinfunc" id="8071324">len</span><span class="op" id="8071327">(</span><span class="ident" id="8071328"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071331">)</span><span class="op" id="8071332">-</span><span class="num" id="8071333">64</span><span class="op" id="8071335">:</span><span class="op" id="8071336">]</span><span class="op" id="8071337">;</span>&nbsp;<span class="op" id="8071339">!</span><span class="ident" id="8071340"><a href="/image/jpeg/reader_test.go.html#8066019">strings</a></span><span class="op" id="8071347">.</span><span class="ident" id="8071348">Contains</span><span class="op" id="8071356">(</span><span class="ident" id="8071357"><a href="/image/jpeg/reader_test.go.html#8071315">s</a></span><span class="op" id="8071358">,</span>&nbsp;<span class="string" id="8071360">&#34;\xff\xda&#34;</span><span class="op" id="8071370">)</span>&nbsp;<span class="op" id="8071372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071376"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8071377">.</span><span class="ident" id="8071378">Fatalf</span><span class="op" id="8071384">(</span><span class="string" id="8071385">&#34;encoded&nbsp;JPEG&nbsp;does&nbsp;not&nbsp;contain&nbsp;a&nbsp;SOS&nbsp;marker&nbsp;(ff&nbsp;da)&nbsp;near&nbsp;the&nbsp;end:&nbsp;%&nbsp;x&#34;</span><span class="op" id="8071455">,</span>&nbsp;<span class="ident" id="8071457"><a href="/image/jpeg/reader_test.go.html#8071315">s</a></span><span class="op" id="8071458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071464">//&nbsp;Test&nbsp;that&nbsp;adding&nbsp;some&nbsp;random&nbsp;junk&nbsp;between&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071533">//&nbsp;EOI&nbsp;marker&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;decoding.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071578">rnd</span>&nbsp;<span class="op" id="8071582">:=</span>&nbsp;<span class="ident" id="8071585"><a href="/image/jpeg/reader_test.go.html#8066000">rand</a></span><span class="op" id="8071589">.</span><span class="ident" id="8071590">New</span><span class="op" id="8071593">(</span><span class="ident" id="8071594"><a href="/image/jpeg/reader_test.go.html#8066000">rand</a></span><span class="op" id="8071598">.</span><span class="ident" id="8071599">NewSource</span><span class="op" id="8071608">(</span><span class="num" id="8071609">1</span><span class="op" id="8071610">)</span><span class="op" id="8071611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071614">for</span>&nbsp;<span class="ident" id="8071618">i</span><span class="op" id="8071619">,</span>&nbsp;<span class="ident" id="8071621">nerr</span>&nbsp;<span class="op" id="8071626">:=</span>&nbsp;<span class="num" id="8071629">0</span><span class="op" id="8071630">,</span>&nbsp;<span class="num" id="8071632">0</span><span class="op" id="8071633">;</span>&nbsp;<span class="ident" id="8071635"><a href="/image/jpeg/reader_test.go.html#8071618">i</a></span>&nbsp;<span class="op" id="8071637">&lt;</span>&nbsp;<span class="num" id="8071639">1000</span>&nbsp;<span class="op" id="8071644">&amp;&amp;</span>&nbsp;<span class="ident" id="8071647"><a href="/image/jpeg/reader_test.go.html#8071621">nerr</a></span>&nbsp;<span class="op" id="8071652">&lt;</span>&nbsp;<span class="num" id="8071654">10</span><span class="op" id="8071656">;</span>&nbsp;<span class="ident" id="8071658"><a href="/image/jpeg/reader_test.go.html#8071618">i</a></span><span class="op" id="8071659">++</span>&nbsp;<span class="op" id="8071662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071666"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8071669">.</span><span class="ident" id="8071670">Reset</span><span class="op" id="8071675">(</span><span class="op" id="8071676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071680">//&nbsp;Write&nbsp;all&nbsp;but&nbsp;the&nbsp;trailing&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071735"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8071738">.</span><span class="ident" id="8071739">WriteString</span><span class="op" id="8071750">(</span><span class="ident" id="8071751"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071754">[</span><span class="op" id="8071755">:</span><span class="builtinfunc" id="8071756">len</span><span class="op" id="8071759">(</span><span class="ident" id="8071760"><a href="/image/jpeg/reader_test.go.html#8070902">enc</a></span><span class="op" id="8071763">)</span><span class="op" id="8071764">-</span><span class="num" id="8071765">2</span><span class="op" id="8071766">]</span><span class="op" id="8071767">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071771">//&nbsp;Write&nbsp;some&nbsp;random&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071811">for</span>&nbsp;<span class="ident" id="8071815">n</span>&nbsp;<span class="op" id="8071817">:=</span>&nbsp;<span class="ident" id="8071820"><a href="/image/jpeg/reader_test.go.html#8071578">rnd</a></span><span class="op" id="8071823">.</span><span class="ident" id="8071824">Intn</span><span class="op" id="8071828">(</span><span class="num" id="8071829">10</span><span class="op" id="8071831">)</span><span class="op" id="8071832">;</span>&nbsp;<span class="ident" id="8071834"><a href="/image/jpeg/reader_test.go.html#8071815">n</a></span>&nbsp;<span class="op" id="8071836">&gt;</span>&nbsp;<span class="num" id="8071838">0</span><span class="op" id="8071839">;</span>&nbsp;<span class="ident" id="8071841"><a href="/image/jpeg/reader_test.go.html#8071815">n</a></span><span class="op" id="8071842">--</span>&nbsp;<span class="op" id="8071845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071850">if</span>&nbsp;<span class="ident" id="8071853">x</span>&nbsp;<span class="op" id="8071855">:=</span>&nbsp;<span class="builtintype" id="8071858">byte</span><span class="op" id="8071862">(</span><span class="ident" id="8071863"><a href="/image/jpeg/reader_test.go.html#8071578">rnd</a></span><span class="op" id="8071866">.</span><span class="ident" id="8071867">Intn</span><span class="op" id="8071871">(</span><span class="num" id="8071872">256</span><span class="op" id="8071875">)</span><span class="op" id="8071876">)</span><span class="op" id="8071877">;</span>&nbsp;<span class="ident" id="8071879"><a href="/image/jpeg/reader_test.go.html#8071853">x</a></span>&nbsp;<span class="op" id="8071881">!=</span>&nbsp;<span class="num" id="8071884">0xff</span>&nbsp;<span class="op" id="8071889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071895"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8071898">.</span><span class="ident" id="8071899">WriteByte</span><span class="op" id="8071908">(</span><span class="ident" id="8071909"><a href="/image/jpeg/reader_test.go.html#8071853">x</a></span><span class="op" id="8071910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071915">}</span>&nbsp;<span class="keyword" id="8071917">else</span>&nbsp;<span class="op" id="8071922">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071928">//&nbsp;The&nbsp;JPEG&nbsp;format&nbsp;escapes&nbsp;a&nbsp;SOS&nbsp;0xff&nbsp;data&nbsp;byte&nbsp;as&nbsp;&#34;\xff\x00&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071995"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8071998">.</span><span class="ident" id="8071999">WriteString</span><span class="op" id="8072010">(</span><span class="string" id="8072011">&#34;\xff\x00&#34;</span><span class="op" id="8072021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8072034">//&nbsp;Write&nbsp;the&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072072"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8072075">.</span><span class="ident" id="8072076">WriteString</span><span class="op" id="8072087">(</span><span class="string" id="8072088">&#34;\xff\xd9&#34;</span><span class="op" id="8072098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8072103">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;can&nbsp;still&nbsp;decode&nbsp;the&nbsp;resultant&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072160">got</span><span class="op" id="8072163">,</span>&nbsp;<span class="ident" id="8072165">err</span>&nbsp;<span class="op" id="8072169">:=</span>&nbsp;<span class="ident" id="8072172"><a href="/image/jpeg/reader.go.html#3150112">Decode</a></span><span class="op" id="8072178">(</span><span class="ident" id="8072179"><a href="/image/jpeg/reader_test.go.html#8070796">buf</a></span><span class="op" id="8072182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072186">if</span>&nbsp;<span class="ident" id="8072189"><a href="/image/jpeg/reader_test.go.html#8072165">err</a></span>&nbsp;<span class="op" id="8072193">!=</span>&nbsp;<span class="ident" id="8072196">nil</span>&nbsp;<span class="op" id="8072200">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072205"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8072206">.</span><span class="ident" id="8072207">Errorf</span><span class="op" id="8072213">(</span><span class="string" id="8072214">&#34;could&nbsp;not&nbsp;decode&nbsp;image&nbsp;#%d:&nbsp;%v&#34;</span><span class="op" id="8072246">,</span>&nbsp;<span class="ident" id="8072248"><a href="/image/jpeg/reader_test.go.html#8071618">i</a></span><span class="op" id="8072249">,</span>&nbsp;<span class="ident" id="8072251"><a href="/image/jpeg/reader_test.go.html#8072165">err</a></span><span class="op" id="8072254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072259"><a href="/image/jpeg/reader_test.go.html#8071621">nerr</a></span><span class="op" id="8072263">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072284">if</span>&nbsp;<span class="ident" id="8072287"><a href="/image/jpeg/reader_test.go.html#8072160">got</a></span><span class="op" id="8072290">.</span><span class="ident" id="8072291">Bounds</span><span class="op" id="8072297">(</span><span class="op" id="8072298">)</span>&nbsp;<span class="op" id="8072300">!=</span>&nbsp;<span class="ident" id="8072303"><a href="/image/jpeg/reader_test.go.html#8070699">src</a></span><span class="op" id="8072306">.</span><span class="ident" id="8072307">Bounds</span><span class="op" id="8072313">(</span><span class="op" id="8072314">)</span>&nbsp;<span class="op" id="8072316">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072321"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8072322">.</span><span class="ident" id="8072323">Errorf</span><span class="op" id="8072329">(</span><span class="string" id="8072330">&#34;image&nbsp;#%d,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8072367">,</span>&nbsp;<span class="ident" id="8072369"><a href="/image/jpeg/reader_test.go.html#8071618">i</a></span><span class="op" id="8072370">,</span>&nbsp;<span class="ident" id="8072372"><a href="/image/jpeg/reader_test.go.html#8072160">got</a></span><span class="op" id="8072375">.</span><span class="ident" id="8072376">Bounds</span><span class="op" id="8072382">(</span><span class="op" id="8072383">)</span><span class="op" id="8072384">,</span>&nbsp;<span class="ident" id="8072386"><a href="/image/jpeg/reader_test.go.html#8070699">src</a></span><span class="op" id="8072389">.</span><span class="ident" id="8072390">Bounds</span><span class="op" id="8072396">(</span><span class="op" id="8072397">)</span><span class="op" id="8072398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072403"><a href="/image/jpeg/reader_test.go.html#8071621">nerr</a></span><span class="op" id="8072407">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072413">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072428">if</span>&nbsp;<span class="ident" id="8072431"><a href="/image/jpeg/writer_test.go.html#8078007">averageDelta</a></span><span class="op" id="8072443">(</span><span class="ident" id="8072444"><a href="/image/jpeg/reader_test.go.html#8072160">got</a></span><span class="op" id="8072447">,</span>&nbsp;<span class="ident" id="8072449"><a href="/image/jpeg/reader_test.go.html#8070699">src</a></span><span class="op" id="8072452">)</span>&nbsp;<span class="op" id="8072454">&gt;</span>&nbsp;<span class="num" id="8072456">2</span><span class="op" id="8072457">&lt;&lt;</span><span class="num" id="8072459">8</span>&nbsp;<span class="op" id="8072461">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072466"><a href="/image/jpeg/reader_test.go.html#8070654">t</a></span><span class="op" id="8072467">.</span><span class="ident" id="8072468">Errorf</span><span class="op" id="8072474">(</span><span class="string" id="8072475">&#34;image&nbsp;#%d&nbsp;changed&nbsp;too&nbsp;much&nbsp;after&nbsp;a&nbsp;round&nbsp;trip&#34;</span><span class="op" id="8072522">,</span>&nbsp;<span class="ident" id="8072524"><a href="/image/jpeg/reader_test.go.html#8071618">i</a></span><span class="op" id="8072525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072530"><a href="/image/jpeg/reader_test.go.html#8071621">nerr</a></span><span class="op" id="8072534">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072540">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072554">}</span><br>
<span class="lineno">245</span><span class="op" id="8072556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8072559">func</span>&nbsp;<span class="ident" id="8072564">benchmarkDecode</span><span class="op" id="8072579">(</span><span class="ident" id="8072580">b</span>&nbsp;<span class="op" id="8072582">*</span><span class="ident" id="8072583"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8072590">.</span><span class="ident" id="8072591">B</span><span class="op" id="8072592">,</span>&nbsp;<span class="ident" id="8072594">filename</span>&nbsp;<span class="builtintype" id="8072603">string</span><span class="op" id="8072609">)</span>&nbsp;<span class="op" id="8072611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072614"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072615">.</span><span class="ident" id="8072616">StopTimer</span><span class="op" id="8072625">(</span><span class="op" id="8072626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072629">data</span><span class="op" id="8072633">,</span>&nbsp;<span class="ident" id="8072635">err</span>&nbsp;<span class="op" id="8072639">:=</span>&nbsp;<span class="ident" id="8072642"><a href="/image/jpeg/reader_test.go.html#8065987">ioutil</a></span><span class="op" id="8072648">.</span><span class="ident" id="8072649">ReadFile</span><span class="op" id="8072657">(</span><span class="ident" id="8072658"><a href="/image/jpeg/reader_test.go.html#8072594">filename</a></span><span class="op" id="8072666">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072669">if</span>&nbsp;<span class="ident" id="8072672"><a href="/image/jpeg/reader_test.go.html#8072635">err</a></span>&nbsp;<span class="op" id="8072676">!=</span>&nbsp;<span class="ident" id="8072679">nil</span>&nbsp;<span class="op" id="8072683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072687"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072688">.</span><span class="ident" id="8072689">Fatal</span><span class="op" id="8072694">(</span><span class="ident" id="8072695"><a href="/image/jpeg/reader_test.go.html#8072635">err</a></span><span class="op" id="8072698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072704">cfg</span><span class="op" id="8072707">,</span>&nbsp;<span class="ident" id="8072709"><a href="/image/jpeg/reader_test.go.html#8072635">err</a></span>&nbsp;<span class="op" id="8072713">:=</span>&nbsp;<span class="ident" id="8072716"><a href="/image/jpeg/reader.go.html#3150314">DecodeConfig</a></span><span class="op" id="8072728">(</span><span class="ident" id="8072729"><a href="/image/jpeg/reader_test.go.html#8065941">bytes</a></span><span class="op" id="8072734">.</span><span class="ident" id="8072735">NewReader</span><span class="op" id="8072744">(</span><span class="ident" id="8072745"><a href="/image/jpeg/reader_test.go.html#8072629">data</a></span><span class="op" id="8072749">)</span><span class="op" id="8072750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072753">if</span>&nbsp;<span class="ident" id="8072756"><a href="/image/jpeg/reader_test.go.html#8072635">err</a></span>&nbsp;<span class="op" id="8072760">!=</span>&nbsp;<span class="ident" id="8072763">nil</span>&nbsp;<span class="op" id="8072767">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072771"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072772">.</span><span class="ident" id="8072773">Fatal</span><span class="op" id="8072778">(</span><span class="ident" id="8072779"><a href="/image/jpeg/reader_test.go.html#8072635">err</a></span><span class="op" id="8072782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072788"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072789">.</span><span class="ident" id="8072790">SetBytes</span><span class="op" id="8072798">(</span><span class="ident" id="8072799">int64</span><span class="op" id="8072804">(</span><span class="ident" id="8072805"><a href="/image/jpeg/reader_test.go.html#8072704">cfg</a></span><span class="op" id="8072808">.</span><span class="ident" id="8072809">Width</span>&nbsp;<span class="op" id="8072815">*</span>&nbsp;<span class="ident" id="8072817"><a href="/image/jpeg/reader_test.go.html#8072704">cfg</a></span><span class="op" id="8072820">.</span><span class="ident" id="8072821">Height</span>&nbsp;<span class="op" id="8072828">*</span>&nbsp;<span class="num" id="8072830">4</span><span class="op" id="8072831">)</span><span class="op" id="8072832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072835"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072836">.</span><span class="ident" id="8072837">StartTimer</span><span class="op" id="8072847">(</span><span class="op" id="8072848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072851">for</span>&nbsp;<span class="ident" id="8072855">i</span>&nbsp;<span class="op" id="8072857">:=</span>&nbsp;<span class="num" id="8072860">0</span><span class="op" id="8072861">;</span>&nbsp;<span class="ident" id="8072863"><a href="/image/jpeg/reader_test.go.html#8072855">i</a></span>&nbsp;<span class="op" id="8072865">&lt;</span>&nbsp;<span class="ident" id="8072867"><a href="/image/jpeg/reader_test.go.html#8072580">b</a></span><span class="op" id="8072868">.</span><span class="ident" id="8072869">N</span><span class="op" id="8072870">;</span>&nbsp;<span class="ident" id="8072872"><a href="/image/jpeg/reader_test.go.html#8072855">i</a></span><span class="op" id="8072873">++</span>&nbsp;<span class="op" id="8072876">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072880"><a href="/image/jpeg/reader.go.html#3150112">Decode</a></span><span class="op" id="8072886">(</span><span class="ident" id="8072887"><a href="/image/jpeg/reader_test.go.html#8065941">bytes</a></span><span class="op" id="8072892">.</span><span class="ident" id="8072893">NewReader</span><span class="op" id="8072902">(</span><span class="ident" id="8072903"><a href="/image/jpeg/reader_test.go.html#8072629">data</a></span><span class="op" id="8072907">)</span><span class="op" id="8072908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072911">}</span><br>
<span class="lineno"></span><span class="op" id="8072913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8072916">func</span>&nbsp;<span class="ident" id="8072921">BenchmarkDecodeBaseline</span><span class="op" id="8072944">(</span><span class="ident" id="8072945">b</span>&nbsp;<span class="op" id="8072947">*</span><span class="ident" id="8072948"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8072955">.</span><span class="ident" id="8072956">B</span><span class="op" id="8072957">)</span>&nbsp;<span class="op" id="8072959">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072962"><a href="/image/jpeg/reader_test.go.html#8072564">benchmarkDecode</a></span><span class="op" id="8072977">(</span><span class="ident" id="8072978"><a href="/image/jpeg/reader_test.go.html#8072945">b</a></span><span class="op" id="8072979">,</span>&nbsp;<span class="string" id="8072981">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="8073009">)</span><br>
<span class="lineno"></span><span class="op" id="8073011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073014">func</span>&nbsp;<span class="ident" id="8073019">BenchmarkDecodeProgressive</span><span class="op" id="8073045">(</span><span class="ident" id="8073046">b</span>&nbsp;<span class="op" id="8073048">*</span><span class="ident" id="8073049"><a href="/image/jpeg/reader_test.go.html#8066030">testing</a></span><span class="op" id="8073056">.</span><span class="ident" id="8073057">B</span><span class="op" id="8073058">)</span>&nbsp;<span class="op" id="8073060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073063"><a href="/image/jpeg/reader_test.go.html#8072564">benchmarkDecode</a></span><span class="op" id="8073078">(</span><span class="ident" id="8073079"><a href="/image/jpeg/reader_test.go.html#8073046">b</a></span><span class="op" id="8073080">,</span>&nbsp;<span class="string" id="8073082">&#34;../testdata/video-001.progressive.jpeg&#34;</span><span class="op" id="8073122">)</span><br>
<span class="lineno">270</span><span class="op" id="8073124">}</span>
</div>
</body>
</html>
