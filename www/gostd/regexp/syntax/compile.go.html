<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2225295">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2225350">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2225404">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2225455">package</span>&nbsp;<span class="ident" id="2225463">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2225471">import</span>&nbsp;<span class="string" id="2225478">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2225489">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="2225575">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="2225654">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="2225725">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="2225791">//</span><br>
<span class="lineno"></span><span class="comment" id="2225794">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="2225872">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="2225933">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="2225980">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="2226050">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="2226127">type</span>&nbsp;<span class="ident" id="2226132">patchList</span>&nbsp;<span class="builtintype" id="2226142">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2226150">func</span>&nbsp;<span class="op" id="2226155">(</span><span class="ident" id="2226156">l</span>&nbsp;<span class="ident" id="2226158">patchList</span><span class="op" id="2226167">)</span>&nbsp;<span class="ident" id="2226169">next</span><span class="op" id="2226173">(</span><span class="ident" id="2226174">p</span>&nbsp;<span class="op" id="2226176">*</span><span class="ident" id="2226177">Prog</span><span class="op" id="2226181">)</span>&nbsp;<span class="ident" id="2226183">patchList</span>&nbsp;<span class="op" id="2226193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226196">i</span>&nbsp;<span class="op" id="2226198">:=</span>&nbsp;<span class="op" id="2226201">&amp;</span><span class="ident" id="2226202">p</span><span class="op" id="2226203">.</span><span class="ident" id="2226204">Inst</span><span class="op" id="2226208">[</span><span class="ident" id="2226209">l</span><span class="op" id="2226210">&gt;&gt;</span><span class="num" id="2226212">1</span><span class="op" id="2226213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226216">if</span>&nbsp;<span class="ident" id="2226219">l</span><span class="op" id="2226220">&amp;</span><span class="num" id="2226221">1</span>&nbsp;<span class="op" id="2226223">==</span>&nbsp;<span class="num" id="2226226">0</span>&nbsp;<span class="op" id="2226228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226232">return</span>&nbsp;<span class="ident" id="2226239">patchList</span><span class="op" id="2226248">(</span><span class="ident" id="2226249">i</span><span class="op" id="2226250">.</span><span class="ident" id="2226251">Out</span><span class="op" id="2226254">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226260">return</span>&nbsp;<span class="ident" id="2226267">patchList</span><span class="op" id="2226276">(</span><span class="ident" id="2226277">i</span><span class="op" id="2226278">.</span><span class="ident" id="2226279">Arg</span><span class="op" id="2226282">)</span><br>
<span class="lineno"></span><span class="op" id="2226284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2226287">func</span>&nbsp;<span class="op" id="2226292">(</span><span class="ident" id="2226293">l</span>&nbsp;<span class="ident" id="2226295">patchList</span><span class="op" id="2226304">)</span>&nbsp;<span class="ident" id="2226306">patch</span><span class="op" id="2226311">(</span><span class="ident" id="2226312">p</span>&nbsp;<span class="op" id="2226314">*</span><span class="ident" id="2226315">Prog</span><span class="op" id="2226319">,</span>&nbsp;<span class="ident" id="2226321">val</span>&nbsp;<span class="builtintype" id="2226325">uint32</span><span class="op" id="2226331">)</span>&nbsp;<span class="op" id="2226333">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226336">for</span>&nbsp;<span class="ident" id="2226340">l</span>&nbsp;<span class="op" id="2226342">!=</span>&nbsp;<span class="num" id="2226345">0</span>&nbsp;<span class="op" id="2226347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226351">i</span>&nbsp;<span class="op" id="2226353">:=</span>&nbsp;<span class="op" id="2226356">&amp;</span><span class="ident" id="2226357">p</span><span class="op" id="2226358">.</span><span class="ident" id="2226359">Inst</span><span class="op" id="2226363">[</span><span class="ident" id="2226364">l</span><span class="op" id="2226365">&gt;&gt;</span><span class="num" id="2226367">1</span><span class="op" id="2226368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226372">if</span>&nbsp;<span class="ident" id="2226375">l</span><span class="op" id="2226376">&amp;</span><span class="num" id="2226377">1</span>&nbsp;<span class="op" id="2226379">==</span>&nbsp;<span class="num" id="2226382">0</span>&nbsp;<span class="op" id="2226384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226389">l</span>&nbsp;<span class="op" id="2226391">=</span>&nbsp;<span class="ident" id="2226393">patchList</span><span class="op" id="2226402">(</span><span class="ident" id="2226403">i</span><span class="op" id="2226404">.</span><span class="ident" id="2226405">Out</span><span class="op" id="2226408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226413">i</span><span class="op" id="2226414">.</span><span class="ident" id="2226415">Out</span>&nbsp;<span class="op" id="2226419">=</span>&nbsp;<span class="ident" id="2226421">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226427">}</span>&nbsp;<span class="keyword" id="2226429">else</span>&nbsp;<span class="op" id="2226434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226439">l</span>&nbsp;<span class="op" id="2226441">=</span>&nbsp;<span class="ident" id="2226443">patchList</span><span class="op" id="2226452">(</span><span class="ident" id="2226453">i</span><span class="op" id="2226454">.</span><span class="ident" id="2226455">Arg</span><span class="op" id="2226458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226463">i</span><span class="op" id="2226464">.</span><span class="ident" id="2226465">Arg</span>&nbsp;<span class="op" id="2226469">=</span>&nbsp;<span class="ident" id="2226471">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226480">}</span><br>
<span class="lineno">40</span><span class="op" id="2226482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2226485">func</span>&nbsp;<span class="op" id="2226490">(</span><span class="ident" id="2226491">l1</span>&nbsp;<span class="ident" id="2226494">patchList</span><span class="op" id="2226503">)</span>&nbsp;<span class="builtinfunc" id="2226505">append</span><span class="op" id="2226511">(</span><span class="ident" id="2226512">p</span>&nbsp;<span class="op" id="2226514">*</span><span class="ident" id="2226515">Prog</span><span class="op" id="2226519">,</span>&nbsp;<span class="ident" id="2226521">l2</span>&nbsp;<span class="ident" id="2226524">patchList</span><span class="op" id="2226533">)</span>&nbsp;<span class="ident" id="2226535">patchList</span>&nbsp;<span class="op" id="2226545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226548">if</span>&nbsp;<span class="ident" id="2226551">l1</span>&nbsp;<span class="op" id="2226554">==</span>&nbsp;<span class="num" id="2226557">0</span>&nbsp;<span class="op" id="2226559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226563">return</span>&nbsp;<span class="ident" id="2226570">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226577">if</span>&nbsp;<span class="ident" id="2226580">l2</span>&nbsp;<span class="op" id="2226583">==</span>&nbsp;<span class="num" id="2226586">0</span>&nbsp;<span class="op" id="2226588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226592">return</span>&nbsp;<span class="ident" id="2226599">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226607">last</span>&nbsp;<span class="op" id="2226612">:=</span>&nbsp;<span class="ident" id="2226615">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226619">for</span>&nbsp;<span class="op" id="2226623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226627">next</span>&nbsp;<span class="op" id="2226632">:=</span>&nbsp;<span class="ident" id="2226635">last</span><span class="op" id="2226639">.</span><span class="ident" id="2226640">next</span><span class="op" id="2226644">(</span><span class="ident" id="2226645">p</span><span class="op" id="2226646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226650">if</span>&nbsp;<span class="ident" id="2226653">next</span>&nbsp;<span class="op" id="2226658">==</span>&nbsp;<span class="num" id="2226661">0</span>&nbsp;<span class="op" id="2226663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226668">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226680">last</span>&nbsp;<span class="op" id="2226685">=</span>&nbsp;<span class="ident" id="2226687">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226697">i</span>&nbsp;<span class="op" id="2226699">:=</span>&nbsp;<span class="op" id="2226702">&amp;</span><span class="ident" id="2226703">p</span><span class="op" id="2226704">.</span><span class="ident" id="2226705">Inst</span><span class="op" id="2226709">[</span><span class="ident" id="2226710">last</span><span class="op" id="2226714">&gt;&gt;</span><span class="num" id="2226716">1</span><span class="op" id="2226717">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226720">if</span>&nbsp;<span class="ident" id="2226723">last</span><span class="op" id="2226727">&amp;</span><span class="num" id="2226728">1</span>&nbsp;<span class="op" id="2226730">==</span>&nbsp;<span class="num" id="2226733">0</span>&nbsp;<span class="op" id="2226735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226739">i</span><span class="op" id="2226740">.</span><span class="ident" id="2226741">Out</span>&nbsp;<span class="op" id="2226745">=</span>&nbsp;<span class="builtintype" id="2226747">uint32</span><span class="op" id="2226753">(</span><span class="ident" id="2226754">l2</span><span class="op" id="2226756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226759">}</span>&nbsp;<span class="keyword" id="2226761">else</span>&nbsp;<span class="op" id="2226766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226770">i</span><span class="op" id="2226771">.</span><span class="ident" id="2226772">Arg</span>&nbsp;<span class="op" id="2226776">=</span>&nbsp;<span class="builtintype" id="2226778">uint32</span><span class="op" id="2226784">(</span><span class="ident" id="2226785">l2</span><span class="op" id="2226787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226790">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226793">return</span>&nbsp;<span class="ident" id="2226800">l1</span><br>
<span class="lineno"></span><span class="op" id="2226803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2226806">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="2226856">type</span>&nbsp;<span class="ident" id="2226861">frag</span>&nbsp;<span class="keyword" id="2226866">struct</span>&nbsp;<span class="op" id="2226873">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226876">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2226880">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2226890">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226921">out</span>&nbsp;<span class="ident" id="2226925">patchList</span>&nbsp;<span class="comment" id="2226935">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="2226970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2226973">type</span>&nbsp;<span class="ident" id="2226978">compiler</span>&nbsp;<span class="keyword" id="2226987">struct</span>&nbsp;<span class="op" id="2226994">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226997">p</span>&nbsp;<span class="op" id="2226999">*</span><span class="ident" id="2227000">Prog</span><br>
<span class="lineno"></span><span class="op" id="2227005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2227008">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="2227070">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="2227149">func</span>&nbsp;<span class="ident" id="2227154">Compile</span><span class="op" id="2227161">(</span><span class="ident" id="2227162">re</span>&nbsp;<span class="op" id="2227165">*</span><span class="ident" id="2227166">Regexp</span><span class="op" id="2227172">)</span>&nbsp;<span class="op" id="2227174">(</span><span class="op" id="2227175">*</span><span class="ident" id="2227176">Prog</span><span class="op" id="2227180">,</span>&nbsp;<span class="builtintype" id="2227182">error</span><span class="op" id="2227187">)</span>&nbsp;<span class="op" id="2227189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227192">var</span>&nbsp;<span class="ident" id="2227196">c</span>&nbsp;<span class="ident" id="2227198">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227208">c</span><span class="op" id="2227209">.</span><span class="ident" id="2227210">init</span><span class="op" id="2227214">(</span><span class="op" id="2227215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227218">f</span>&nbsp;<span class="op" id="2227220">:=</span>&nbsp;<span class="ident" id="2227223">c</span><span class="op" id="2227224">.</span><span class="ident" id="2227225">compile</span><span class="op" id="2227232">(</span><span class="ident" id="2227233">re</span><span class="op" id="2227235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227238">f</span><span class="op" id="2227239">.</span><span class="ident" id="2227240">out</span><span class="op" id="2227243">.</span><span class="ident" id="2227244">patch</span><span class="op" id="2227249">(</span><span class="ident" id="2227250">c</span><span class="op" id="2227251">.</span><span class="ident" id="2227252">p</span><span class="op" id="2227253">,</span>&nbsp;<span class="ident" id="2227255">c</span><span class="op" id="2227256">.</span><span class="ident" id="2227257">inst</span><span class="op" id="2227261">(</span><span class="ident" id="2227262">InstMatch</span><span class="op" id="2227271">)</span><span class="op" id="2227272">.</span><span class="ident" id="2227273">i</span><span class="op" id="2227274">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227277">c</span><span class="op" id="2227278">.</span><span class="ident" id="2227279">p</span><span class="op" id="2227280">.</span><span class="ident" id="2227281">Start</span>&nbsp;<span class="op" id="2227287">=</span>&nbsp;<span class="builtintype" id="2227289">int</span><span class="op" id="2227292">(</span><span class="ident" id="2227293">f</span><span class="op" id="2227294">.</span><span class="ident" id="2227295">i</span><span class="op" id="2227296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227299">return</span>&nbsp;<span class="ident" id="2227306">c</span><span class="op" id="2227307">.</span><span class="ident" id="2227308">p</span><span class="op" id="2227309">,</span>&nbsp;<span class="ident" id="2227311">nil</span><br>
<span class="lineno"></span><span class="op" id="2227315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2227318">func</span>&nbsp;<span class="op" id="2227323">(</span><span class="ident" id="2227324">c</span>&nbsp;<span class="op" id="2227326">*</span><span class="ident" id="2227327">compiler</span><span class="op" id="2227335">)</span>&nbsp;<span class="ident" id="2227337">init</span><span class="op" id="2227341">(</span><span class="op" id="2227342">)</span>&nbsp;<span class="op" id="2227344">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227347">c</span><span class="op" id="2227348">.</span><span class="ident" id="2227349">p</span>&nbsp;<span class="op" id="2227351">=</span>&nbsp;<span class="builtinfunc" id="2227353">new</span><span class="op" id="2227356">(</span><span class="ident" id="2227357">Prog</span><span class="op" id="2227361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227364">c</span><span class="op" id="2227365">.</span><span class="ident" id="2227366">p</span><span class="op" id="2227367">.</span><span class="ident" id="2227368">NumCap</span>&nbsp;<span class="op" id="2227375">=</span>&nbsp;<span class="num" id="2227377">2</span>&nbsp;<span class="comment" id="2227379">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227419">c</span><span class="op" id="2227420">.</span><span class="ident" id="2227421">inst</span><span class="op" id="2227425">(</span><span class="ident" id="2227426">InstFail</span><span class="op" id="2227434">)</span><br>
<span class="lineno"></span><span class="op" id="2227436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="2227439">var</span>&nbsp;<span class="ident" id="2227443">anyRuneNotNL</span>&nbsp;<span class="op" id="2227456">=</span>&nbsp;<span class="op" id="2227458">[</span><span class="op" id="2227459">]</span><span class="builtintype" id="2227460">rune</span><span class="op" id="2227464">{</span><span class="num" id="2227465">0</span><span class="op" id="2227466">,</span>&nbsp;<span class="string" id="2227468">&#39;\n&#39;</span>&nbsp;<span class="op" id="2227473">-</span>&nbsp;<span class="num" id="2227475">1</span><span class="op" id="2227476">,</span>&nbsp;<span class="string" id="2227478">&#39;\n&#39;</span>&nbsp;<span class="op" id="2227483">+</span>&nbsp;<span class="num" id="2227485">1</span><span class="op" id="2227486">,</span>&nbsp;<span class="ident" id="2227488">unicode</span><span class="op" id="2227495">.</span><span class="ident" id="2227496">MaxRune</span><span class="op" id="2227503">}</span><br>
<span class="lineno"></span><span class="keyword" id="2227505">var</span>&nbsp;<span class="ident" id="2227509">anyRune</span>&nbsp;<span class="op" id="2227517">=</span>&nbsp;<span class="op" id="2227519">[</span><span class="op" id="2227520">]</span><span class="builtintype" id="2227521">rune</span><span class="op" id="2227525">{</span><span class="num" id="2227526">0</span><span class="op" id="2227527">,</span>&nbsp;<span class="ident" id="2227529">unicode</span><span class="op" id="2227536">.</span><span class="ident" id="2227537">MaxRune</span><span class="op" id="2227544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2227547">func</span>&nbsp;<span class="op" id="2227552">(</span><span class="ident" id="2227553">c</span>&nbsp;<span class="op" id="2227555">*</span><span class="ident" id="2227556">compiler</span><span class="op" id="2227564">)</span>&nbsp;<span class="ident" id="2227566">compile</span><span class="op" id="2227573">(</span><span class="ident" id="2227574">re</span>&nbsp;<span class="op" id="2227577">*</span><span class="ident" id="2227578">Regexp</span><span class="op" id="2227584">)</span>&nbsp;<span class="ident" id="2227586">frag</span>&nbsp;<span class="op" id="2227591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227594">switch</span>&nbsp;<span class="ident" id="2227601">re</span><span class="op" id="2227603">.</span><span class="ident" id="2227604">Op</span>&nbsp;<span class="op" id="2227607">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227610">case</span>&nbsp;<span class="ident" id="2227615">OpNoMatch</span><span class="op" id="2227624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227628">return</span>&nbsp;<span class="ident" id="2227635">c</span><span class="op" id="2227636">.</span><span class="ident" id="2227637">fail</span><span class="op" id="2227641">(</span><span class="op" id="2227642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227645">case</span>&nbsp;<span class="ident" id="2227650">OpEmptyMatch</span><span class="op" id="2227662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227666">return</span>&nbsp;<span class="ident" id="2227673">c</span><span class="op" id="2227674">.</span><span class="ident" id="2227675">nop</span><span class="op" id="2227678">(</span><span class="op" id="2227679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227682">case</span>&nbsp;<span class="ident" id="2227687">OpLiteral</span><span class="op" id="2227696">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227700">if</span>&nbsp;<span class="builtinfunc" id="2227703">len</span><span class="op" id="2227706">(</span><span class="ident" id="2227707">re</span><span class="op" id="2227709">.</span><span class="ident" id="2227710">Rune</span><span class="op" id="2227714">)</span>&nbsp;<span class="op" id="2227716">==</span>&nbsp;<span class="num" id="2227719">0</span>&nbsp;<span class="op" id="2227721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227726">return</span>&nbsp;<span class="ident" id="2227733">c</span><span class="op" id="2227734">.</span><span class="ident" id="2227735">nop</span><span class="op" id="2227738">(</span><span class="op" id="2227739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227747">var</span>&nbsp;<span class="ident" id="2227751">f</span>&nbsp;<span class="ident" id="2227753">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227760">for</span>&nbsp;<span class="ident" id="2227764">j</span>&nbsp;<span class="op" id="2227766">:=</span>&nbsp;<span class="keyword" id="2227769">range</span>&nbsp;<span class="ident" id="2227775">re</span><span class="op" id="2227777">.</span><span class="ident" id="2227778">Rune</span>&nbsp;<span class="op" id="2227783">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227788">f1</span>&nbsp;<span class="op" id="2227791">:=</span>&nbsp;<span class="ident" id="2227794">c</span><span class="op" id="2227795">.</span><span class="builtintype" id="2227796">rune</span><span class="op" id="2227800">(</span><span class="ident" id="2227801">re</span><span class="op" id="2227803">.</span><span class="ident" id="2227804">Rune</span><span class="op" id="2227808">[</span><span class="ident" id="2227809">j</span><span class="op" id="2227810">:</span><span class="ident" id="2227811">j</span><span class="op" id="2227812">+</span><span class="num" id="2227813">1</span><span class="op" id="2227814">]</span><span class="op" id="2227815">,</span>&nbsp;<span class="ident" id="2227817">re</span><span class="op" id="2227819">.</span><span class="ident" id="2227820">Flags</span><span class="op" id="2227825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227830">if</span>&nbsp;<span class="ident" id="2227833">j</span>&nbsp;<span class="op" id="2227835">==</span>&nbsp;<span class="num" id="2227838">0</span>&nbsp;<span class="op" id="2227840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227846">f</span>&nbsp;<span class="op" id="2227848">=</span>&nbsp;<span class="ident" id="2227850">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227856">}</span>&nbsp;<span class="keyword" id="2227858">else</span>&nbsp;<span class="op" id="2227863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227869">f</span>&nbsp;<span class="op" id="2227871">=</span>&nbsp;<span class="ident" id="2227873">c</span><span class="op" id="2227874">.</span><span class="ident" id="2227875">cat</span><span class="op" id="2227878">(</span><span class="ident" id="2227879">f</span><span class="op" id="2227880">,</span>&nbsp;<span class="ident" id="2227882">f1</span><span class="op" id="2227884">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227897">return</span>&nbsp;<span class="ident" id="2227904">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227907">case</span>&nbsp;<span class="ident" id="2227912">OpCharClass</span><span class="op" id="2227923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227927">return</span>&nbsp;<span class="ident" id="2227934">c</span><span class="op" id="2227935">.</span><span class="builtintype" id="2227936">rune</span><span class="op" id="2227940">(</span><span class="ident" id="2227941">re</span><span class="op" id="2227943">.</span><span class="ident" id="2227944">Rune</span><span class="op" id="2227948">,</span>&nbsp;<span class="ident" id="2227950">re</span><span class="op" id="2227952">.</span><span class="ident" id="2227953">Flags</span><span class="op" id="2227958">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227961">case</span>&nbsp;<span class="ident" id="2227966">OpAnyCharNotNL</span><span class="op" id="2227980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227984">return</span>&nbsp;<span class="ident" id="2227991">c</span><span class="op" id="2227992">.</span><span class="builtintype" id="2227993">rune</span><span class="op" id="2227997">(</span><span class="ident" id="2227998">anyRuneNotNL</span><span class="op" id="2228010">,</span>&nbsp;<span class="num" id="2228012">0</span><span class="op" id="2228013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228016">case</span>&nbsp;<span class="ident" id="2228021">OpAnyChar</span><span class="op" id="2228030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228034">return</span>&nbsp;<span class="ident" id="2228041">c</span><span class="op" id="2228042">.</span><span class="builtintype" id="2228043">rune</span><span class="op" id="2228047">(</span><span class="ident" id="2228048">anyRune</span><span class="op" id="2228055">,</span>&nbsp;<span class="num" id="2228057">0</span><span class="op" id="2228058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228061">case</span>&nbsp;<span class="ident" id="2228066">OpBeginLine</span><span class="op" id="2228077">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228081">return</span>&nbsp;<span class="ident" id="2228088">c</span><span class="op" id="2228089">.</span><span class="ident" id="2228090">empty</span><span class="op" id="2228095">(</span><span class="ident" id="2228096">EmptyBeginLine</span><span class="op" id="2228110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228113">case</span>&nbsp;<span class="ident" id="2228118">OpEndLine</span><span class="op" id="2228127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228131">return</span>&nbsp;<span class="ident" id="2228138">c</span><span class="op" id="2228139">.</span><span class="ident" id="2228140">empty</span><span class="op" id="2228145">(</span><span class="ident" id="2228146">EmptyEndLine</span><span class="op" id="2228158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228161">case</span>&nbsp;<span class="ident" id="2228166">OpBeginText</span><span class="op" id="2228177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228181">return</span>&nbsp;<span class="ident" id="2228188">c</span><span class="op" id="2228189">.</span><span class="ident" id="2228190">empty</span><span class="op" id="2228195">(</span><span class="ident" id="2228196">EmptyBeginText</span><span class="op" id="2228210">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228213">case</span>&nbsp;<span class="ident" id="2228218">OpEndText</span><span class="op" id="2228227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228231">return</span>&nbsp;<span class="ident" id="2228238">c</span><span class="op" id="2228239">.</span><span class="ident" id="2228240">empty</span><span class="op" id="2228245">(</span><span class="ident" id="2228246">EmptyEndText</span><span class="op" id="2228258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228261">case</span>&nbsp;<span class="ident" id="2228266">OpWordBoundary</span><span class="op" id="2228280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228284">return</span>&nbsp;<span class="ident" id="2228291">c</span><span class="op" id="2228292">.</span><span class="ident" id="2228293">empty</span><span class="op" id="2228298">(</span><span class="ident" id="2228299">EmptyWordBoundary</span><span class="op" id="2228316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228319">case</span>&nbsp;<span class="ident" id="2228324">OpNoWordBoundary</span><span class="op" id="2228340">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228344">return</span>&nbsp;<span class="ident" id="2228351">c</span><span class="op" id="2228352">.</span><span class="ident" id="2228353">empty</span><span class="op" id="2228358">(</span><span class="ident" id="2228359">EmptyNoWordBoundary</span><span class="op" id="2228378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228381">case</span>&nbsp;<span class="ident" id="2228386">OpCapture</span><span class="op" id="2228395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228399">bra</span>&nbsp;<span class="op" id="2228403">:=</span>&nbsp;<span class="ident" id="2228406">c</span><span class="op" id="2228407">.</span><span class="builtinfunc" id="2228408">cap</span><span class="op" id="2228411">(</span><span class="builtintype" id="2228412">uint32</span><span class="op" id="2228418">(</span><span class="ident" id="2228419">re</span><span class="op" id="2228421">.</span><span class="ident" id="2228422">Cap</span>&nbsp;<span class="op" id="2228426">&lt;&lt;</span>&nbsp;<span class="num" id="2228429">1</span><span class="op" id="2228430">)</span><span class="op" id="2228431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228435">sub</span>&nbsp;<span class="op" id="2228439">:=</span>&nbsp;<span class="ident" id="2228442">c</span><span class="op" id="2228443">.</span><span class="ident" id="2228444">compile</span><span class="op" id="2228451">(</span><span class="ident" id="2228452">re</span><span class="op" id="2228454">.</span><span class="ident" id="2228455">Sub</span><span class="op" id="2228458">[</span><span class="num" id="2228459">0</span><span class="op" id="2228460">]</span><span class="op" id="2228461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228465">ket</span>&nbsp;<span class="op" id="2228469">:=</span>&nbsp;<span class="ident" id="2228472">c</span><span class="op" id="2228473">.</span><span class="builtinfunc" id="2228474">cap</span><span class="op" id="2228477">(</span><span class="builtintype" id="2228478">uint32</span><span class="op" id="2228484">(</span><span class="ident" id="2228485">re</span><span class="op" id="2228487">.</span><span class="ident" id="2228488">Cap</span><span class="op" id="2228491">&lt;&lt;</span><span class="num" id="2228493">1</span>&nbsp;<span class="op" id="2228495">|</span>&nbsp;<span class="num" id="2228497">1</span><span class="op" id="2228498">)</span><span class="op" id="2228499">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228503">return</span>&nbsp;<span class="ident" id="2228510">c</span><span class="op" id="2228511">.</span><span class="ident" id="2228512">cat</span><span class="op" id="2228515">(</span><span class="ident" id="2228516">c</span><span class="op" id="2228517">.</span><span class="ident" id="2228518">cat</span><span class="op" id="2228521">(</span><span class="ident" id="2228522">bra</span><span class="op" id="2228525">,</span>&nbsp;<span class="ident" id="2228527">sub</span><span class="op" id="2228530">)</span><span class="op" id="2228531">,</span>&nbsp;<span class="ident" id="2228533">ket</span><span class="op" id="2228536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228539">case</span>&nbsp;<span class="ident" id="2228544">OpStar</span><span class="op" id="2228550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228554">return</span>&nbsp;<span class="ident" id="2228561">c</span><span class="op" id="2228562">.</span><span class="ident" id="2228563">star</span><span class="op" id="2228567">(</span><span class="ident" id="2228568">c</span><span class="op" id="2228569">.</span><span class="ident" id="2228570">compile</span><span class="op" id="2228577">(</span><span class="ident" id="2228578">re</span><span class="op" id="2228580">.</span><span class="ident" id="2228581">Sub</span><span class="op" id="2228584">[</span><span class="num" id="2228585">0</span><span class="op" id="2228586">]</span><span class="op" id="2228587">)</span><span class="op" id="2228588">,</span>&nbsp;<span class="ident" id="2228590">re</span><span class="op" id="2228592">.</span><span class="ident" id="2228593">Flags</span><span class="op" id="2228598">&amp;</span><span class="ident" id="2228599">NonGreedy</span>&nbsp;<span class="op" id="2228609">!=</span>&nbsp;<span class="num" id="2228612">0</span><span class="op" id="2228613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228616">case</span>&nbsp;<span class="ident" id="2228621">OpPlus</span><span class="op" id="2228627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228631">return</span>&nbsp;<span class="ident" id="2228638">c</span><span class="op" id="2228639">.</span><span class="ident" id="2228640">plus</span><span class="op" id="2228644">(</span><span class="ident" id="2228645">c</span><span class="op" id="2228646">.</span><span class="ident" id="2228647">compile</span><span class="op" id="2228654">(</span><span class="ident" id="2228655">re</span><span class="op" id="2228657">.</span><span class="ident" id="2228658">Sub</span><span class="op" id="2228661">[</span><span class="num" id="2228662">0</span><span class="op" id="2228663">]</span><span class="op" id="2228664">)</span><span class="op" id="2228665">,</span>&nbsp;<span class="ident" id="2228667">re</span><span class="op" id="2228669">.</span><span class="ident" id="2228670">Flags</span><span class="op" id="2228675">&amp;</span><span class="ident" id="2228676">NonGreedy</span>&nbsp;<span class="op" id="2228686">!=</span>&nbsp;<span class="num" id="2228689">0</span><span class="op" id="2228690">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228693">case</span>&nbsp;<span class="ident" id="2228698">OpQuest</span><span class="op" id="2228705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228709">return</span>&nbsp;<span class="ident" id="2228716">c</span><span class="op" id="2228717">.</span><span class="ident" id="2228718">quest</span><span class="op" id="2228723">(</span><span class="ident" id="2228724">c</span><span class="op" id="2228725">.</span><span class="ident" id="2228726">compile</span><span class="op" id="2228733">(</span><span class="ident" id="2228734">re</span><span class="op" id="2228736">.</span><span class="ident" id="2228737">Sub</span><span class="op" id="2228740">[</span><span class="num" id="2228741">0</span><span class="op" id="2228742">]</span><span class="op" id="2228743">)</span><span class="op" id="2228744">,</span>&nbsp;<span class="ident" id="2228746">re</span><span class="op" id="2228748">.</span><span class="ident" id="2228749">Flags</span><span class="op" id="2228754">&amp;</span><span class="ident" id="2228755">NonGreedy</span>&nbsp;<span class="op" id="2228765">!=</span>&nbsp;<span class="num" id="2228768">0</span><span class="op" id="2228769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228772">case</span>&nbsp;<span class="ident" id="2228777">OpConcat</span><span class="op" id="2228785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228789">if</span>&nbsp;<span class="builtinfunc" id="2228792">len</span><span class="op" id="2228795">(</span><span class="ident" id="2228796">re</span><span class="op" id="2228798">.</span><span class="ident" id="2228799">Sub</span><span class="op" id="2228802">)</span>&nbsp;<span class="op" id="2228804">==</span>&nbsp;<span class="num" id="2228807">0</span>&nbsp;<span class="op" id="2228809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228814">return</span>&nbsp;<span class="ident" id="2228821">c</span><span class="op" id="2228822">.</span><span class="ident" id="2228823">nop</span><span class="op" id="2228826">(</span><span class="op" id="2228827">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228835">var</span>&nbsp;<span class="ident" id="2228839">f</span>&nbsp;<span class="ident" id="2228841">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228848">for</span>&nbsp;<span class="ident" id="2228852">i</span><span class="op" id="2228853">,</span>&nbsp;<span class="ident" id="2228855">sub</span>&nbsp;<span class="op" id="2228859">:=</span>&nbsp;<span class="keyword" id="2228862">range</span>&nbsp;<span class="ident" id="2228868">re</span><span class="op" id="2228870">.</span><span class="ident" id="2228871">Sub</span>&nbsp;<span class="op" id="2228875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228880">if</span>&nbsp;<span class="ident" id="2228883">i</span>&nbsp;<span class="op" id="2228885">==</span>&nbsp;<span class="num" id="2228888">0</span>&nbsp;<span class="op" id="2228890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228896">f</span>&nbsp;<span class="op" id="2228898">=</span>&nbsp;<span class="ident" id="2228900">c</span><span class="op" id="2228901">.</span><span class="ident" id="2228902">compile</span><span class="op" id="2228909">(</span><span class="ident" id="2228910">sub</span><span class="op" id="2228913">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228918">}</span>&nbsp;<span class="keyword" id="2228920">else</span>&nbsp;<span class="op" id="2228925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228931">f</span>&nbsp;<span class="op" id="2228933">=</span>&nbsp;<span class="ident" id="2228935">c</span><span class="op" id="2228936">.</span><span class="ident" id="2228937">cat</span><span class="op" id="2228940">(</span><span class="ident" id="2228941">f</span><span class="op" id="2228942">,</span>&nbsp;<span class="ident" id="2228944">c</span><span class="op" id="2228945">.</span><span class="ident" id="2228946">compile</span><span class="op" id="2228953">(</span><span class="ident" id="2228954">sub</span><span class="op" id="2228957">)</span><span class="op" id="2228958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228971">return</span>&nbsp;<span class="ident" id="2228978">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228981">case</span>&nbsp;<span class="ident" id="2228986">OpAlternate</span><span class="op" id="2228997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229001">var</span>&nbsp;<span class="ident" id="2229005">f</span>&nbsp;<span class="ident" id="2229007">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229014">for</span>&nbsp;<span class="ident" id="2229018">_</span><span class="op" id="2229019">,</span>&nbsp;<span class="ident" id="2229021">sub</span>&nbsp;<span class="op" id="2229025">:=</span>&nbsp;<span class="keyword" id="2229028">range</span>&nbsp;<span class="ident" id="2229034">re</span><span class="op" id="2229036">.</span><span class="ident" id="2229037">Sub</span>&nbsp;<span class="op" id="2229041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229046">f</span>&nbsp;<span class="op" id="2229048">=</span>&nbsp;<span class="ident" id="2229050">c</span><span class="op" id="2229051">.</span><span class="ident" id="2229052">alt</span><span class="op" id="2229055">(</span><span class="ident" id="2229056">f</span><span class="op" id="2229057">,</span>&nbsp;<span class="ident" id="2229059">c</span><span class="op" id="2229060">.</span><span class="ident" id="2229061">compile</span><span class="op" id="2229068">(</span><span class="ident" id="2229069">sub</span><span class="op" id="2229072">)</span><span class="op" id="2229073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229077">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229081">return</span>&nbsp;<span class="ident" id="2229088">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2229094">panic</span><span class="op" id="2229099">(</span><span class="string" id="2229100">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="2229135">)</span><br>
<span class="lineno"></span><span class="op" id="2229137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="2229140">func</span>&nbsp;<span class="op" id="2229145">(</span><span class="ident" id="2229146">c</span>&nbsp;<span class="op" id="2229148">*</span><span class="ident" id="2229149">compiler</span><span class="op" id="2229157">)</span>&nbsp;<span class="ident" id="2229159">inst</span><span class="op" id="2229163">(</span><span class="ident" id="2229164">op</span>&nbsp;<span class="ident" id="2229167">InstOp</span><span class="op" id="2229173">)</span>&nbsp;<span class="ident" id="2229175">frag</span>&nbsp;<span class="op" id="2229180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229183">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229213">f</span>&nbsp;<span class="op" id="2229215">:=</span>&nbsp;<span class="ident" id="2229218">frag</span><span class="op" id="2229222">{</span><span class="ident" id="2229223">i</span><span class="op" id="2229224">:</span>&nbsp;<span class="builtintype" id="2229226">uint32</span><span class="op" id="2229232">(</span><span class="builtinfunc" id="2229233">len</span><span class="op" id="2229236">(</span><span class="ident" id="2229237">c</span><span class="op" id="2229238">.</span><span class="ident" id="2229239">p</span><span class="op" id="2229240">.</span><span class="ident" id="2229241">Inst</span><span class="op" id="2229245">)</span><span class="op" id="2229246">)</span><span class="op" id="2229247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229250">c</span><span class="op" id="2229251">.</span><span class="ident" id="2229252">p</span><span class="op" id="2229253">.</span><span class="ident" id="2229254">Inst</span>&nbsp;<span class="op" id="2229259">=</span>&nbsp;<span class="builtinfunc" id="2229261">append</span><span class="op" id="2229267">(</span><span class="ident" id="2229268">c</span><span class="op" id="2229269">.</span><span class="ident" id="2229270">p</span><span class="op" id="2229271">.</span><span class="ident" id="2229272">Inst</span><span class="op" id="2229276">,</span>&nbsp;<span class="ident" id="2229278">Inst</span><span class="op" id="2229282">{</span><span class="ident" id="2229283">Op</span><span class="op" id="2229285">:</span>&nbsp;<span class="ident" id="2229287">op</span><span class="op" id="2229289">}</span><span class="op" id="2229290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229293">return</span>&nbsp;<span class="ident" id="2229300">f</span><br>
<span class="lineno">175</span><span class="op" id="2229302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2229305">func</span>&nbsp;<span class="op" id="2229310">(</span><span class="ident" id="2229311">c</span>&nbsp;<span class="op" id="2229313">*</span><span class="ident" id="2229314">compiler</span><span class="op" id="2229322">)</span>&nbsp;<span class="ident" id="2229324">nop</span><span class="op" id="2229327">(</span><span class="op" id="2229328">)</span>&nbsp;<span class="ident" id="2229330">frag</span>&nbsp;<span class="op" id="2229335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229338">f</span>&nbsp;<span class="op" id="2229340">:=</span>&nbsp;<span class="ident" id="2229343">c</span><span class="op" id="2229344">.</span><span class="ident" id="2229345">inst</span><span class="op" id="2229349">(</span><span class="ident" id="2229350">InstNop</span><span class="op" id="2229357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229360">f</span><span class="op" id="2229361">.</span><span class="ident" id="2229362">out</span>&nbsp;<span class="op" id="2229366">=</span>&nbsp;<span class="ident" id="2229368">patchList</span><span class="op" id="2229377">(</span><span class="ident" id="2229378">f</span><span class="op" id="2229379">.</span><span class="ident" id="2229380">i</span>&nbsp;<span class="op" id="2229382">&lt;&lt;</span>&nbsp;<span class="num" id="2229385">1</span><span class="op" id="2229386">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229389">return</span>&nbsp;<span class="ident" id="2229396">f</span><br>
<span class="lineno"></span><span class="op" id="2229398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2229401">func</span>&nbsp;<span class="op" id="2229406">(</span><span class="ident" id="2229407">c</span>&nbsp;<span class="op" id="2229409">*</span><span class="ident" id="2229410">compiler</span><span class="op" id="2229418">)</span>&nbsp;<span class="ident" id="2229420">fail</span><span class="op" id="2229424">(</span><span class="op" id="2229425">)</span>&nbsp;<span class="ident" id="2229427">frag</span>&nbsp;<span class="op" id="2229432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229435">return</span>&nbsp;<span class="ident" id="2229442">frag</span><span class="op" id="2229446">{</span><span class="op" id="2229447">}</span><br>
<span class="lineno">185</span><span class="op" id="2229449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2229452">func</span>&nbsp;<span class="op" id="2229457">(</span><span class="ident" id="2229458">c</span>&nbsp;<span class="op" id="2229460">*</span><span class="ident" id="2229461">compiler</span><span class="op" id="2229469">)</span>&nbsp;<span class="builtinfunc" id="2229471">cap</span><span class="op" id="2229474">(</span><span class="ident" id="2229475">arg</span>&nbsp;<span class="builtintype" id="2229479">uint32</span><span class="op" id="2229485">)</span>&nbsp;<span class="ident" id="2229487">frag</span>&nbsp;<span class="op" id="2229492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229495">f</span>&nbsp;<span class="op" id="2229497">:=</span>&nbsp;<span class="ident" id="2229500">c</span><span class="op" id="2229501">.</span><span class="ident" id="2229502">inst</span><span class="op" id="2229506">(</span><span class="ident" id="2229507">InstCapture</span><span class="op" id="2229518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229521">f</span><span class="op" id="2229522">.</span><span class="ident" id="2229523">out</span>&nbsp;<span class="op" id="2229527">=</span>&nbsp;<span class="ident" id="2229529">patchList</span><span class="op" id="2229538">(</span><span class="ident" id="2229539">f</span><span class="op" id="2229540">.</span><span class="ident" id="2229541">i</span>&nbsp;<span class="op" id="2229543">&lt;&lt;</span>&nbsp;<span class="num" id="2229546">1</span><span class="op" id="2229547">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229550">c</span><span class="op" id="2229551">.</span><span class="ident" id="2229552">p</span><span class="op" id="2229553">.</span><span class="ident" id="2229554">Inst</span><span class="op" id="2229558">[</span><span class="ident" id="2229559">f</span><span class="op" id="2229560">.</span><span class="ident" id="2229561">i</span><span class="op" id="2229562">]</span><span class="op" id="2229563">.</span><span class="ident" id="2229564">Arg</span>&nbsp;<span class="op" id="2229568">=</span>&nbsp;<span class="ident" id="2229570">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229576">if</span>&nbsp;<span class="ident" id="2229579">c</span><span class="op" id="2229580">.</span><span class="ident" id="2229581">p</span><span class="op" id="2229582">.</span><span class="ident" id="2229583">NumCap</span>&nbsp;<span class="op" id="2229590">&lt;</span>&nbsp;<span class="builtintype" id="2229592">int</span><span class="op" id="2229595">(</span><span class="ident" id="2229596">arg</span><span class="op" id="2229599">)</span><span class="op" id="2229600">+</span><span class="num" id="2229601">1</span>&nbsp;<span class="op" id="2229603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229607">c</span><span class="op" id="2229608">.</span><span class="ident" id="2229609">p</span><span class="op" id="2229610">.</span><span class="ident" id="2229611">NumCap</span>&nbsp;<span class="op" id="2229618">=</span>&nbsp;<span class="builtintype" id="2229620">int</span><span class="op" id="2229623">(</span><span class="ident" id="2229624">arg</span><span class="op" id="2229627">)</span>&nbsp;<span class="op" id="2229629">+</span>&nbsp;<span class="num" id="2229631">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229634">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229637">return</span>&nbsp;<span class="ident" id="2229644">f</span><br>
<span class="lineno"></span><span class="op" id="2229646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2229649">func</span>&nbsp;<span class="op" id="2229654">(</span><span class="ident" id="2229655">c</span>&nbsp;<span class="op" id="2229657">*</span><span class="ident" id="2229658">compiler</span><span class="op" id="2229666">)</span>&nbsp;<span class="ident" id="2229668">cat</span><span class="op" id="2229671">(</span><span class="ident" id="2229672">f1</span><span class="op" id="2229674">,</span>&nbsp;<span class="ident" id="2229676">f2</span>&nbsp;<span class="ident" id="2229679">frag</span><span class="op" id="2229683">)</span>&nbsp;<span class="ident" id="2229685">frag</span>&nbsp;<span class="op" id="2229690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229693">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229726">if</span>&nbsp;<span class="ident" id="2229729">f1</span><span class="op" id="2229731">.</span><span class="ident" id="2229732">i</span>&nbsp;<span class="op" id="2229734">==</span>&nbsp;<span class="num" id="2229737">0</span>&nbsp;<span class="op" id="2229739">||</span>&nbsp;<span class="ident" id="2229742">f2</span><span class="op" id="2229744">.</span><span class="ident" id="2229745">i</span>&nbsp;<span class="op" id="2229747">==</span>&nbsp;<span class="num" id="2229750">0</span>&nbsp;<span class="op" id="2229752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229756">return</span>&nbsp;<span class="ident" id="2229763">frag</span><span class="op" id="2229767">{</span><span class="op" id="2229768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229775">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229796">f1</span><span class="op" id="2229798">.</span><span class="ident" id="2229799">out</span><span class="op" id="2229802">.</span><span class="ident" id="2229803">patch</span><span class="op" id="2229808">(</span><span class="ident" id="2229809">c</span><span class="op" id="2229810">.</span><span class="ident" id="2229811">p</span><span class="op" id="2229812">,</span>&nbsp;<span class="ident" id="2229814">f2</span><span class="op" id="2229816">.</span><span class="ident" id="2229817">i</span><span class="op" id="2229818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229821">return</span>&nbsp;<span class="ident" id="2229828">frag</span><span class="op" id="2229832">{</span><span class="ident" id="2229833">f1</span><span class="op" id="2229835">.</span><span class="ident" id="2229836">i</span><span class="op" id="2229837">,</span>&nbsp;<span class="ident" id="2229839">f2</span><span class="op" id="2229841">.</span><span class="ident" id="2229842">out</span><span class="op" id="2229845">}</span><br>
<span class="lineno"></span><span class="op" id="2229847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2229850">func</span>&nbsp;<span class="op" id="2229855">(</span><span class="ident" id="2229856">c</span>&nbsp;<span class="op" id="2229858">*</span><span class="ident" id="2229859">compiler</span><span class="op" id="2229867">)</span>&nbsp;<span class="ident" id="2229869">alt</span><span class="op" id="2229872">(</span><span class="ident" id="2229873">f1</span><span class="op" id="2229875">,</span>&nbsp;<span class="ident" id="2229877">f2</span>&nbsp;<span class="ident" id="2229880">frag</span><span class="op" id="2229884">)</span>&nbsp;<span class="ident" id="2229886">frag</span>&nbsp;<span class="op" id="2229891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229894">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229922">if</span>&nbsp;<span class="ident" id="2229925">f1</span><span class="op" id="2229927">.</span><span class="ident" id="2229928">i</span>&nbsp;<span class="op" id="2229930">==</span>&nbsp;<span class="num" id="2229933">0</span>&nbsp;<span class="op" id="2229935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229939">return</span>&nbsp;<span class="ident" id="2229946">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229950">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229953">if</span>&nbsp;<span class="ident" id="2229956">f2</span><span class="op" id="2229958">.</span><span class="ident" id="2229959">i</span>&nbsp;<span class="op" id="2229961">==</span>&nbsp;<span class="num" id="2229964">0</span>&nbsp;<span class="op" id="2229966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229970">return</span>&nbsp;<span class="ident" id="2229977">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229985">f</span>&nbsp;<span class="op" id="2229987">:=</span>&nbsp;<span class="ident" id="2229990">c</span><span class="op" id="2229991">.</span><span class="ident" id="2229992">inst</span><span class="op" id="2229996">(</span><span class="ident" id="2229997">InstAlt</span><span class="op" id="2230004">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230007">i</span>&nbsp;<span class="op" id="2230009">:=</span>&nbsp;<span class="op" id="2230012">&amp;</span><span class="ident" id="2230013">c</span><span class="op" id="2230014">.</span><span class="ident" id="2230015">p</span><span class="op" id="2230016">.</span><span class="ident" id="2230017">Inst</span><span class="op" id="2230021">[</span><span class="ident" id="2230022">f</span><span class="op" id="2230023">.</span><span class="ident" id="2230024">i</span><span class="op" id="2230025">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230028">i</span><span class="op" id="2230029">.</span><span class="ident" id="2230030">Out</span>&nbsp;<span class="op" id="2230034">=</span>&nbsp;<span class="ident" id="2230036">f1</span><span class="op" id="2230038">.</span><span class="ident" id="2230039">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230042">i</span><span class="op" id="2230043">.</span><span class="ident" id="2230044">Arg</span>&nbsp;<span class="op" id="2230048">=</span>&nbsp;<span class="ident" id="2230050">f2</span><span class="op" id="2230052">.</span><span class="ident" id="2230053">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230056">f</span><span class="op" id="2230057">.</span><span class="ident" id="2230058">out</span>&nbsp;<span class="op" id="2230062">=</span>&nbsp;<span class="ident" id="2230064">f1</span><span class="op" id="2230066">.</span><span class="ident" id="2230067">out</span><span class="op" id="2230070">.</span><span class="builtinfunc" id="2230071">append</span><span class="op" id="2230077">(</span><span class="ident" id="2230078">c</span><span class="op" id="2230079">.</span><span class="ident" id="2230080">p</span><span class="op" id="2230081">,</span>&nbsp;<span class="ident" id="2230083">f2</span><span class="op" id="2230085">.</span><span class="ident" id="2230086">out</span><span class="op" id="2230089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230092">return</span>&nbsp;<span class="ident" id="2230099">f</span><br>
<span class="lineno">225</span><span class="op" id="2230101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2230104">func</span>&nbsp;<span class="op" id="2230109">(</span><span class="ident" id="2230110">c</span>&nbsp;<span class="op" id="2230112">*</span><span class="ident" id="2230113">compiler</span><span class="op" id="2230121">)</span>&nbsp;<span class="ident" id="2230123">quest</span><span class="op" id="2230128">(</span><span class="ident" id="2230129">f1</span>&nbsp;<span class="ident" id="2230132">frag</span><span class="op" id="2230136">,</span>&nbsp;<span class="ident" id="2230138">nongreedy</span>&nbsp;<span class="builtintype" id="2230148">bool</span><span class="op" id="2230152">)</span>&nbsp;<span class="ident" id="2230154">frag</span>&nbsp;<span class="op" id="2230159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230162">f</span>&nbsp;<span class="op" id="2230164">:=</span>&nbsp;<span class="ident" id="2230167">c</span><span class="op" id="2230168">.</span><span class="ident" id="2230169">inst</span><span class="op" id="2230173">(</span><span class="ident" id="2230174">InstAlt</span><span class="op" id="2230181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230184">i</span>&nbsp;<span class="op" id="2230186">:=</span>&nbsp;<span class="op" id="2230189">&amp;</span><span class="ident" id="2230190">c</span><span class="op" id="2230191">.</span><span class="ident" id="2230192">p</span><span class="op" id="2230193">.</span><span class="ident" id="2230194">Inst</span><span class="op" id="2230198">[</span><span class="ident" id="2230199">f</span><span class="op" id="2230200">.</span><span class="ident" id="2230201">i</span><span class="op" id="2230202">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230205">if</span>&nbsp;<span class="ident" id="2230208">nongreedy</span>&nbsp;<span class="op" id="2230218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230222">i</span><span class="op" id="2230223">.</span><span class="ident" id="2230224">Arg</span>&nbsp;<span class="op" id="2230228">=</span>&nbsp;<span class="ident" id="2230230">f1</span><span class="op" id="2230232">.</span><span class="ident" id="2230233">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230237">f</span><span class="op" id="2230238">.</span><span class="ident" id="2230239">out</span>&nbsp;<span class="op" id="2230243">=</span>&nbsp;<span class="ident" id="2230245">patchList</span><span class="op" id="2230254">(</span><span class="ident" id="2230255">f</span><span class="op" id="2230256">.</span><span class="ident" id="2230257">i</span>&nbsp;<span class="op" id="2230259">&lt;&lt;</span>&nbsp;<span class="num" id="2230262">1</span><span class="op" id="2230263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230266">}</span>&nbsp;<span class="keyword" id="2230268">else</span>&nbsp;<span class="op" id="2230273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230277">i</span><span class="op" id="2230278">.</span><span class="ident" id="2230279">Out</span>&nbsp;<span class="op" id="2230283">=</span>&nbsp;<span class="ident" id="2230285">f1</span><span class="op" id="2230287">.</span><span class="ident" id="2230288">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230292">f</span><span class="op" id="2230293">.</span><span class="ident" id="2230294">out</span>&nbsp;<span class="op" id="2230298">=</span>&nbsp;<span class="ident" id="2230300">patchList</span><span class="op" id="2230309">(</span><span class="ident" id="2230310">f</span><span class="op" id="2230311">.</span><span class="ident" id="2230312">i</span><span class="op" id="2230313">&lt;&lt;</span><span class="num" id="2230315">1</span>&nbsp;<span class="op" id="2230317">|</span>&nbsp;<span class="num" id="2230319">1</span><span class="op" id="2230320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230326">f</span><span class="op" id="2230327">.</span><span class="ident" id="2230328">out</span>&nbsp;<span class="op" id="2230332">=</span>&nbsp;<span class="ident" id="2230334">f</span><span class="op" id="2230335">.</span><span class="ident" id="2230336">out</span><span class="op" id="2230339">.</span><span class="builtinfunc" id="2230340">append</span><span class="op" id="2230346">(</span><span class="ident" id="2230347">c</span><span class="op" id="2230348">.</span><span class="ident" id="2230349">p</span><span class="op" id="2230350">,</span>&nbsp;<span class="ident" id="2230352">f1</span><span class="op" id="2230354">.</span><span class="ident" id="2230355">out</span><span class="op" id="2230358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230361">return</span>&nbsp;<span class="ident" id="2230368">f</span><br>
<span class="lineno"></span><span class="op" id="2230370">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2230373">func</span>&nbsp;<span class="op" id="2230378">(</span><span class="ident" id="2230379">c</span>&nbsp;<span class="op" id="2230381">*</span><span class="ident" id="2230382">compiler</span><span class="op" id="2230390">)</span>&nbsp;<span class="ident" id="2230392">star</span><span class="op" id="2230396">(</span><span class="ident" id="2230397">f1</span>&nbsp;<span class="ident" id="2230400">frag</span><span class="op" id="2230404">,</span>&nbsp;<span class="ident" id="2230406">nongreedy</span>&nbsp;<span class="builtintype" id="2230416">bool</span><span class="op" id="2230420">)</span>&nbsp;<span class="ident" id="2230422">frag</span>&nbsp;<span class="op" id="2230427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230430">f</span>&nbsp;<span class="op" id="2230432">:=</span>&nbsp;<span class="ident" id="2230435">c</span><span class="op" id="2230436">.</span><span class="ident" id="2230437">inst</span><span class="op" id="2230441">(</span><span class="ident" id="2230442">InstAlt</span><span class="op" id="2230449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230452">i</span>&nbsp;<span class="op" id="2230454">:=</span>&nbsp;<span class="op" id="2230457">&amp;</span><span class="ident" id="2230458">c</span><span class="op" id="2230459">.</span><span class="ident" id="2230460">p</span><span class="op" id="2230461">.</span><span class="ident" id="2230462">Inst</span><span class="op" id="2230466">[</span><span class="ident" id="2230467">f</span><span class="op" id="2230468">.</span><span class="ident" id="2230469">i</span><span class="op" id="2230470">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230473">if</span>&nbsp;<span class="ident" id="2230476">nongreedy</span>&nbsp;<span class="op" id="2230486">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230490">i</span><span class="op" id="2230491">.</span><span class="ident" id="2230492">Arg</span>&nbsp;<span class="op" id="2230496">=</span>&nbsp;<span class="ident" id="2230498">f1</span><span class="op" id="2230500">.</span><span class="ident" id="2230501">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230505">f</span><span class="op" id="2230506">.</span><span class="ident" id="2230507">out</span>&nbsp;<span class="op" id="2230511">=</span>&nbsp;<span class="ident" id="2230513">patchList</span><span class="op" id="2230522">(</span><span class="ident" id="2230523">f</span><span class="op" id="2230524">.</span><span class="ident" id="2230525">i</span>&nbsp;<span class="op" id="2230527">&lt;&lt;</span>&nbsp;<span class="num" id="2230530">1</span><span class="op" id="2230531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230534">}</span>&nbsp;<span class="keyword" id="2230536">else</span>&nbsp;<span class="op" id="2230541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230545">i</span><span class="op" id="2230546">.</span><span class="ident" id="2230547">Out</span>&nbsp;<span class="op" id="2230551">=</span>&nbsp;<span class="ident" id="2230553">f1</span><span class="op" id="2230555">.</span><span class="ident" id="2230556">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230560">f</span><span class="op" id="2230561">.</span><span class="ident" id="2230562">out</span>&nbsp;<span class="op" id="2230566">=</span>&nbsp;<span class="ident" id="2230568">patchList</span><span class="op" id="2230577">(</span><span class="ident" id="2230578">f</span><span class="op" id="2230579">.</span><span class="ident" id="2230580">i</span><span class="op" id="2230581">&lt;&lt;</span><span class="num" id="2230583">1</span>&nbsp;<span class="op" id="2230585">|</span>&nbsp;<span class="num" id="2230587">1</span><span class="op" id="2230588">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230594">f1</span><span class="op" id="2230596">.</span><span class="ident" id="2230597">out</span><span class="op" id="2230600">.</span><span class="ident" id="2230601">patch</span><span class="op" id="2230606">(</span><span class="ident" id="2230607">c</span><span class="op" id="2230608">.</span><span class="ident" id="2230609">p</span><span class="op" id="2230610">,</span>&nbsp;<span class="ident" id="2230612">f</span><span class="op" id="2230613">.</span><span class="ident" id="2230614">i</span><span class="op" id="2230615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230618">return</span>&nbsp;<span class="ident" id="2230625">f</span><br>
<span class="lineno"></span><span class="op" id="2230627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="2230630">func</span>&nbsp;<span class="op" id="2230635">(</span><span class="ident" id="2230636">c</span>&nbsp;<span class="op" id="2230638">*</span><span class="ident" id="2230639">compiler</span><span class="op" id="2230647">)</span>&nbsp;<span class="ident" id="2230649">plus</span><span class="op" id="2230653">(</span><span class="ident" id="2230654">f1</span>&nbsp;<span class="ident" id="2230657">frag</span><span class="op" id="2230661">,</span>&nbsp;<span class="ident" id="2230663">nongreedy</span>&nbsp;<span class="builtintype" id="2230673">bool</span><span class="op" id="2230677">)</span>&nbsp;<span class="ident" id="2230679">frag</span>&nbsp;<span class="op" id="2230684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230687">return</span>&nbsp;<span class="ident" id="2230694">frag</span><span class="op" id="2230698">{</span><span class="ident" id="2230699">f1</span><span class="op" id="2230701">.</span><span class="ident" id="2230702">i</span><span class="op" id="2230703">,</span>&nbsp;<span class="ident" id="2230705">c</span><span class="op" id="2230706">.</span><span class="ident" id="2230707">star</span><span class="op" id="2230711">(</span><span class="ident" id="2230712">f1</span><span class="op" id="2230714">,</span>&nbsp;<span class="ident" id="2230716">nongreedy</span><span class="op" id="2230725">)</span><span class="op" id="2230726">.</span><span class="ident" id="2230727">out</span><span class="op" id="2230730">}</span><br>
<span class="lineno"></span><span class="op" id="2230732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2230735">func</span>&nbsp;<span class="op" id="2230740">(</span><span class="ident" id="2230741">c</span>&nbsp;<span class="op" id="2230743">*</span><span class="ident" id="2230744">compiler</span><span class="op" id="2230752">)</span>&nbsp;<span class="ident" id="2230754">empty</span><span class="op" id="2230759">(</span><span class="ident" id="2230760">op</span>&nbsp;<span class="ident" id="2230763">EmptyOp</span><span class="op" id="2230770">)</span>&nbsp;<span class="ident" id="2230772">frag</span>&nbsp;<span class="op" id="2230777">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230780">f</span>&nbsp;<span class="op" id="2230782">:=</span>&nbsp;<span class="ident" id="2230785">c</span><span class="op" id="2230786">.</span><span class="ident" id="2230787">inst</span><span class="op" id="2230791">(</span><span class="ident" id="2230792">InstEmptyWidth</span><span class="op" id="2230806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230809">c</span><span class="op" id="2230810">.</span><span class="ident" id="2230811">p</span><span class="op" id="2230812">.</span><span class="ident" id="2230813">Inst</span><span class="op" id="2230817">[</span><span class="ident" id="2230818">f</span><span class="op" id="2230819">.</span><span class="ident" id="2230820">i</span><span class="op" id="2230821">]</span><span class="op" id="2230822">.</span><span class="ident" id="2230823">Arg</span>&nbsp;<span class="op" id="2230827">=</span>&nbsp;<span class="builtintype" id="2230829">uint32</span><span class="op" id="2230835">(</span><span class="ident" id="2230836">op</span><span class="op" id="2230838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230841">f</span><span class="op" id="2230842">.</span><span class="ident" id="2230843">out</span>&nbsp;<span class="op" id="2230847">=</span>&nbsp;<span class="ident" id="2230849">patchList</span><span class="op" id="2230858">(</span><span class="ident" id="2230859">f</span><span class="op" id="2230860">.</span><span class="ident" id="2230861">i</span>&nbsp;<span class="op" id="2230863">&lt;&lt;</span>&nbsp;<span class="num" id="2230866">1</span><span class="op" id="2230867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230870">return</span>&nbsp;<span class="ident" id="2230877">f</span><br>
<span class="lineno"></span><span class="op" id="2230879">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2230882">func</span>&nbsp;<span class="op" id="2230887">(</span><span class="ident" id="2230888">c</span>&nbsp;<span class="op" id="2230890">*</span><span class="ident" id="2230891">compiler</span><span class="op" id="2230899">)</span>&nbsp;<span class="builtintype" id="2230901">rune</span><span class="op" id="2230905">(</span><span class="ident" id="2230906">r</span>&nbsp;<span class="op" id="2230908">[</span><span class="op" id="2230909">]</span><span class="builtintype" id="2230910">rune</span><span class="op" id="2230914">,</span>&nbsp;<span class="ident" id="2230916">flags</span>&nbsp;<span class="ident" id="2230922">Flags</span><span class="op" id="2230927">)</span>&nbsp;<span class="ident" id="2230929">frag</span>&nbsp;<span class="op" id="2230934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230937">f</span>&nbsp;<span class="op" id="2230939">:=</span>&nbsp;<span class="ident" id="2230942">c</span><span class="op" id="2230943">.</span><span class="ident" id="2230944">inst</span><span class="op" id="2230948">(</span><span class="ident" id="2230949">InstRune</span><span class="op" id="2230957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230960">i</span>&nbsp;<span class="op" id="2230962">:=</span>&nbsp;<span class="op" id="2230965">&amp;</span><span class="ident" id="2230966">c</span><span class="op" id="2230967">.</span><span class="ident" id="2230968">p</span><span class="op" id="2230969">.</span><span class="ident" id="2230970">Inst</span><span class="op" id="2230974">[</span><span class="ident" id="2230975">f</span><span class="op" id="2230976">.</span><span class="ident" id="2230977">i</span><span class="op" id="2230978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230981">i</span><span class="op" id="2230982">.</span><span class="ident" id="2230983">Rune</span>&nbsp;<span class="op" id="2230988">=</span>&nbsp;<span class="ident" id="2230990">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230993">flags</span>&nbsp;<span class="op" id="2230999">&amp;=</span>&nbsp;<span class="ident" id="2231002">FoldCase</span>&nbsp;<span class="comment" id="2231011">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231046">if</span>&nbsp;<span class="builtinfunc" id="2231049">len</span><span class="op" id="2231052">(</span><span class="ident" id="2231053">r</span><span class="op" id="2231054">)</span>&nbsp;<span class="op" id="2231056">!=</span>&nbsp;<span class="num" id="2231059">1</span>&nbsp;<span class="op" id="2231061">||</span>&nbsp;<span class="ident" id="2231064">unicode</span><span class="op" id="2231071">.</span><span class="ident" id="2231072">SimpleFold</span><span class="op" id="2231082">(</span><span class="ident" id="2231083">r</span><span class="op" id="2231084">[</span><span class="num" id="2231085">0</span><span class="op" id="2231086">]</span><span class="op" id="2231087">)</span>&nbsp;<span class="op" id="2231089">==</span>&nbsp;<span class="ident" id="2231092">r</span><span class="op" id="2231093">[</span><span class="num" id="2231094">0</span><span class="op" id="2231095">]</span>&nbsp;<span class="op" id="2231097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231101">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231134">flags</span>&nbsp;<span class="op" id="2231140">&amp;^=</span>&nbsp;<span class="ident" id="2231144">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231154">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231157">i</span><span class="op" id="2231158">.</span><span class="ident" id="2231159">Arg</span>&nbsp;<span class="op" id="2231163">=</span>&nbsp;<span class="builtintype" id="2231165">uint32</span><span class="op" id="2231171">(</span><span class="ident" id="2231172">flags</span><span class="op" id="2231177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231180">f</span><span class="op" id="2231181">.</span><span class="ident" id="2231182">out</span>&nbsp;<span class="op" id="2231186">=</span>&nbsp;<span class="ident" id="2231188">patchList</span><span class="op" id="2231197">(</span><span class="ident" id="2231198">f</span><span class="op" id="2231199">.</span><span class="ident" id="2231200">i</span>&nbsp;<span class="op" id="2231202">&lt;&lt;</span>&nbsp;<span class="num" id="2231205">1</span><span class="op" id="2231206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231210">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231246">switch</span>&nbsp;<span class="op" id="2231253">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231256">case</span>&nbsp;<span class="ident" id="2231261">flags</span><span class="op" id="2231266">&amp;</span><span class="ident" id="2231267">FoldCase</span>&nbsp;<span class="op" id="2231276">==</span>&nbsp;<span class="num" id="2231279">0</span>&nbsp;<span class="op" id="2231281">&amp;&amp;</span>&nbsp;<span class="op" id="2231284">(</span><span class="builtinfunc" id="2231285">len</span><span class="op" id="2231288">(</span><span class="ident" id="2231289">r</span><span class="op" id="2231290">)</span>&nbsp;<span class="op" id="2231292">==</span>&nbsp;<span class="num" id="2231295">1</span>&nbsp;<span class="op" id="2231297">||</span>&nbsp;<span class="builtinfunc" id="2231300">len</span><span class="op" id="2231303">(</span><span class="ident" id="2231304">r</span><span class="op" id="2231305">)</span>&nbsp;<span class="op" id="2231307">==</span>&nbsp;<span class="num" id="2231310">2</span>&nbsp;<span class="op" id="2231312">&amp;&amp;</span>&nbsp;<span class="ident" id="2231315">r</span><span class="op" id="2231316">[</span><span class="num" id="2231317">0</span><span class="op" id="2231318">]</span>&nbsp;<span class="op" id="2231320">==</span>&nbsp;<span class="ident" id="2231323">r</span><span class="op" id="2231324">[</span><span class="num" id="2231325">1</span><span class="op" id="2231326">]</span><span class="op" id="2231327">)</span><span class="op" id="2231328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231332">i</span><span class="op" id="2231333">.</span><span class="ident" id="2231334">Op</span>&nbsp;<span class="op" id="2231337">=</span>&nbsp;<span class="ident" id="2231339">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231350">case</span>&nbsp;<span class="builtinfunc" id="2231355">len</span><span class="op" id="2231358">(</span><span class="ident" id="2231359">r</span><span class="op" id="2231360">)</span>&nbsp;<span class="op" id="2231362">==</span>&nbsp;<span class="num" id="2231365">2</span>&nbsp;<span class="op" id="2231367">&amp;&amp;</span>&nbsp;<span class="ident" id="2231370">r</span><span class="op" id="2231371">[</span><span class="num" id="2231372">0</span><span class="op" id="2231373">]</span>&nbsp;<span class="op" id="2231375">==</span>&nbsp;<span class="num" id="2231378">0</span>&nbsp;<span class="op" id="2231380">&amp;&amp;</span>&nbsp;<span class="ident" id="2231383">r</span><span class="op" id="2231384">[</span><span class="num" id="2231385">1</span><span class="op" id="2231386">]</span>&nbsp;<span class="op" id="2231388">==</span>&nbsp;<span class="ident" id="2231391">unicode</span><span class="op" id="2231398">.</span><span class="ident" id="2231399">MaxRune</span><span class="op" id="2231406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231410">i</span><span class="op" id="2231411">.</span><span class="ident" id="2231412">Op</span>&nbsp;<span class="op" id="2231415">=</span>&nbsp;<span class="ident" id="2231417">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231430">case</span>&nbsp;<span class="builtinfunc" id="2231435">len</span><span class="op" id="2231438">(</span><span class="ident" id="2231439">r</span><span class="op" id="2231440">)</span>&nbsp;<span class="op" id="2231442">==</span>&nbsp;<span class="num" id="2231445">4</span>&nbsp;<span class="op" id="2231447">&amp;&amp;</span>&nbsp;<span class="ident" id="2231450">r</span><span class="op" id="2231451">[</span><span class="num" id="2231452">0</span><span class="op" id="2231453">]</span>&nbsp;<span class="op" id="2231455">==</span>&nbsp;<span class="num" id="2231458">0</span>&nbsp;<span class="op" id="2231460">&amp;&amp;</span>&nbsp;<span class="ident" id="2231463">r</span><span class="op" id="2231464">[</span><span class="num" id="2231465">1</span><span class="op" id="2231466">]</span>&nbsp;<span class="op" id="2231468">==</span>&nbsp;<span class="string" id="2231471">&#39;\n&#39;</span><span class="op" id="2231475">-</span><span class="num" id="2231476">1</span>&nbsp;<span class="op" id="2231478">&amp;&amp;</span>&nbsp;<span class="ident" id="2231481">r</span><span class="op" id="2231482">[</span><span class="num" id="2231483">2</span><span class="op" id="2231484">]</span>&nbsp;<span class="op" id="2231486">==</span>&nbsp;<span class="string" id="2231489">&#39;\n&#39;</span><span class="op" id="2231493">+</span><span class="num" id="2231494">1</span>&nbsp;<span class="op" id="2231496">&amp;&amp;</span>&nbsp;<span class="ident" id="2231499">r</span><span class="op" id="2231500">[</span><span class="num" id="2231501">3</span><span class="op" id="2231502">]</span>&nbsp;<span class="op" id="2231504">==</span>&nbsp;<span class="ident" id="2231507">unicode</span><span class="op" id="2231514">.</span><span class="ident" id="2231515">MaxRune</span><span class="op" id="2231522">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231526">i</span><span class="op" id="2231527">.</span><span class="ident" id="2231528">Op</span>&nbsp;<span class="op" id="2231531">=</span>&nbsp;<span class="ident" id="2231533">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231555">return</span>&nbsp;<span class="ident" id="2231562">f</span><br>
<span class="lineno"></span><span class="op" id="2231564">}</span>
</div>
</body>
</html>
