<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4530307">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4530362">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4530416">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4530467">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4530552">package</span>&nbsp;<span class="ident" id="4530560">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4530565">import</span>&nbsp;<span class="op" id="4530572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4530575">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4530585">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4530591">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4530602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4530605">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4530684">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4530760">type</span>&nbsp;<span class="ident" id="4530765">Parameters</span>&nbsp;<span class="keyword" id="4530776">struct</span>&nbsp;<span class="op" id="4530783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530786">P</span><span class="op" id="4530787">,</span>&nbsp;<span class="ident" id="4530789">Q</span><span class="op" id="4530790">,</span>&nbsp;<span class="ident" id="4530792">G</span>&nbsp;<span class="op" id="4530794">*</span><span class="ident" id="4530795">big</span><span class="op" id="4530798">.</span><span class="ident" id="4530799">Int</span><br>
<span class="lineno"></span><span class="op" id="4530803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4530806">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4530848">type</span>&nbsp;<span class="ident" id="4530853">PublicKey</span>&nbsp;<span class="keyword" id="4530863">struct</span>&nbsp;<span class="op" id="4530870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530873">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530885">Y</span>&nbsp;<span class="op" id="4530887">*</span><span class="ident" id="4530888">big</span><span class="op" id="4530891">.</span><span class="ident" id="4530892">Int</span><br>
<span class="lineno"></span><span class="op" id="4530896">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4530899">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4530943">type</span>&nbsp;<span class="ident" id="4530948">PrivateKey</span>&nbsp;<span class="keyword" id="4530959">struct</span>&nbsp;<span class="op" id="4530966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530969">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4530980">X</span>&nbsp;<span class="op" id="4530982">*</span><span class="ident" id="4530983">big</span><span class="op" id="4530986">.</span><span class="ident" id="4530987">Int</span><br>
<span class="lineno">30</span><span class="op" id="4530991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4530994">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4531071">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4531147">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4531226">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4531257">var</span>&nbsp;<span class="ident" id="4531261">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4531281">=</span>&nbsp;<span class="ident" id="4531283">errors</span><span class="op" id="4531289">.</span><span class="ident" id="4531290">New</span><span class="op" id="4531293">(</span><span class="string" id="4531294">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4531326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531329">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4531408">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4531468">type</span>&nbsp;<span class="ident" id="4531473">ParameterSizes</span>&nbsp;<span class="builtintype" id="4531488">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4531493">const</span>&nbsp;<span class="op" id="4531499">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531502">L1024N160</span>&nbsp;<span class="ident" id="4531512">ParameterSizes</span>&nbsp;<span class="op" id="4531527">=</span>&nbsp;<span class="ident" id="4531529">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531535">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531546">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4531557">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4531567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531570">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4531650">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4531719">const</span>&nbsp;<span class="ident" id="4531725">numMRTests</span>&nbsp;<span class="op" id="4531736">=</span>&nbsp;<span class="num" id="4531738">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4531742">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4531820">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4531880">func</span>&nbsp;<span class="ident" id="4531885">GenerateParameters</span><span class="op" id="4531903">(</span><span class="ident" id="4531904">params</span>&nbsp;<span class="op" id="4531911">*</span><span class="ident" id="4531912">Parameters</span><span class="op" id="4531922">,</span>&nbsp;<span class="ident" id="4531924">rand</span>&nbsp;<span class="ident" id="4531929">io</span><span class="op" id="4531931">.</span><span class="ident" id="4531932">Reader</span><span class="op" id="4531938">,</span>&nbsp;<span class="ident" id="4531940">sizes</span>&nbsp;<span class="ident" id="4531946">ParameterSizes</span><span class="op" id="4531960">)</span>&nbsp;<span class="op" id="4531962">(</span><span class="ident" id="4531963">err</span>&nbsp;<span class="builtintype" id="4531967">error</span><span class="op" id="4531972">)</span>&nbsp;<span class="op" id="4531974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4531977">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532048">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532117">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4532182">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532223">var</span>&nbsp;<span class="ident" id="4532227">L</span><span class="op" id="4532228">,</span>&nbsp;<span class="ident" id="4532230">N</span>&nbsp;<span class="builtintype" id="4532232">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532237">switch</span>&nbsp;<span class="ident" id="4532244">sizes</span>&nbsp;<span class="op" id="4532250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532253">case</span>&nbsp;<span class="ident" id="4532258">L1024N160</span><span class="op" id="4532267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532271">L</span>&nbsp;<span class="op" id="4532273">=</span>&nbsp;<span class="num" id="4532275">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532282">N</span>&nbsp;<span class="op" id="4532284">=</span>&nbsp;<span class="num" id="4532286">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532291">case</span>&nbsp;<span class="ident" id="4532296">L2048N224</span><span class="op" id="4532305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532309">L</span>&nbsp;<span class="op" id="4532311">=</span>&nbsp;<span class="num" id="4532313">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532320">N</span>&nbsp;<span class="op" id="4532322">=</span>&nbsp;<span class="num" id="4532324">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532329">case</span>&nbsp;<span class="ident" id="4532334">L2048N256</span><span class="op" id="4532343">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532347">L</span>&nbsp;<span class="op" id="4532349">=</span>&nbsp;<span class="num" id="4532351">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532358">N</span>&nbsp;<span class="op" id="4532360">=</span>&nbsp;<span class="num" id="4532362">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532367">case</span>&nbsp;<span class="ident" id="4532372">L3072N256</span><span class="op" id="4532381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532385">L</span>&nbsp;<span class="op" id="4532387">=</span>&nbsp;<span class="num" id="4532389">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532396">N</span>&nbsp;<span class="op" id="4532398">=</span>&nbsp;<span class="num" id="4532400">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532405">default</span><span class="op" id="4532412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532416">return</span>&nbsp;<span class="ident" id="4532423">errors</span><span class="op" id="4532429">.</span><span class="ident" id="4532430">New</span><span class="op" id="4532433">(</span><span class="string" id="4532434">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4532470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532477">qBytes</span>&nbsp;<span class="op" id="4532484">:=</span>&nbsp;<span class="builtinfunc" id="4532487">make</span><span class="op" id="4532491">(</span><span class="op" id="4532492">[</span><span class="op" id="4532493">]</span><span class="builtintype" id="4532494">byte</span><span class="op" id="4532498">,</span>&nbsp;<span class="ident" id="4532500">N</span><span class="op" id="4532501">/</span><span class="num" id="4532502">8</span><span class="op" id="4532503">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532506">pBytes</span>&nbsp;<span class="op" id="4532513">:=</span>&nbsp;<span class="builtinfunc" id="4532516">make</span><span class="op" id="4532520">(</span><span class="op" id="4532521">[</span><span class="op" id="4532522">]</span><span class="builtintype" id="4532523">byte</span><span class="op" id="4532527">,</span>&nbsp;<span class="ident" id="4532529">L</span><span class="op" id="4532530">/</span><span class="num" id="4532531">8</span><span class="op" id="4532532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532536">q</span>&nbsp;<span class="op" id="4532538">:=</span>&nbsp;<span class="builtinfunc" id="4532541">new</span><span class="op" id="4532544">(</span><span class="ident" id="4532545">big</span><span class="op" id="4532548">.</span><span class="ident" id="4532549">Int</span><span class="op" id="4532552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532555">p</span>&nbsp;<span class="op" id="4532557">:=</span>&nbsp;<span class="builtinfunc" id="4532560">new</span><span class="op" id="4532563">(</span><span class="ident" id="4532564">big</span><span class="op" id="4532567">.</span><span class="ident" id="4532568">Int</span><span class="op" id="4532571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532574">rem</span>&nbsp;<span class="op" id="4532578">:=</span>&nbsp;<span class="builtinfunc" id="4532581">new</span><span class="op" id="4532584">(</span><span class="ident" id="4532585">big</span><span class="op" id="4532588">.</span><span class="ident" id="4532589">Int</span><span class="op" id="4532592">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532595">one</span>&nbsp;<span class="op" id="4532599">:=</span>&nbsp;<span class="builtinfunc" id="4532602">new</span><span class="op" id="4532605">(</span><span class="ident" id="4532606">big</span><span class="op" id="4532609">.</span><span class="ident" id="4532610">Int</span><span class="op" id="4532613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532616">one</span><span class="op" id="4532619">.</span><span class="ident" id="4532620">SetInt64</span><span class="op" id="4532628">(</span><span class="num" id="4532629">1</span><span class="op" id="4532630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4532633">GeneratePrimes</span><span class="op" id="4532647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532650">for</span>&nbsp;<span class="op" id="4532654">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532658">_</span><span class="op" id="4532659">,</span>&nbsp;<span class="ident" id="4532661">err</span>&nbsp;<span class="op" id="4532665">=</span>&nbsp;<span class="ident" id="4532667">io</span><span class="op" id="4532669">.</span><span class="ident" id="4532670">ReadFull</span><span class="op" id="4532678">(</span><span class="ident" id="4532679">rand</span><span class="op" id="4532683">,</span>&nbsp;<span class="ident" id="4532685">qBytes</span><span class="op" id="4532691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532695">if</span>&nbsp;<span class="ident" id="4532698">err</span>&nbsp;<span class="op" id="4532702">!=</span>&nbsp;<span class="ident" id="4532705">nil</span>&nbsp;<span class="op" id="4532709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532714">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532728">qBytes</span><span class="op" id="4532734">[</span><span class="builtinfunc" id="4532735">len</span><span class="op" id="4532738">(</span><span class="ident" id="4532739">qBytes</span><span class="op" id="4532745">)</span><span class="op" id="4532746">-</span><span class="num" id="4532747">1</span><span class="op" id="4532748">]</span>&nbsp;<span class="op" id="4532750">|=</span>&nbsp;<span class="num" id="4532753">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532757">qBytes</span><span class="op" id="4532763">[</span><span class="num" id="4532764">0</span><span class="op" id="4532765">]</span>&nbsp;<span class="op" id="4532767">|=</span>&nbsp;<span class="num" id="4532770">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532777">q</span><span class="op" id="4532778">.</span><span class="ident" id="4532779">SetBytes</span><span class="op" id="4532787">(</span><span class="ident" id="4532788">qBytes</span><span class="op" id="4532794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532799">if</span>&nbsp;<span class="op" id="4532802">!</span><span class="ident" id="4532803">q</span><span class="op" id="4532804">.</span><span class="ident" id="4532805">ProbablyPrime</span><span class="op" id="4532818">(</span><span class="ident" id="4532819">numMRTests</span><span class="op" id="4532829">)</span>&nbsp;<span class="op" id="4532831">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532836">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532852">for</span>&nbsp;<span class="ident" id="4532856">i</span>&nbsp;<span class="op" id="4532858">:=</span>&nbsp;<span class="num" id="4532861">0</span><span class="op" id="4532862">;</span>&nbsp;<span class="ident" id="4532864">i</span>&nbsp;<span class="op" id="4532866">&lt;</span>&nbsp;<span class="num" id="4532868">4</span><span class="op" id="4532869">*</span><span class="ident" id="4532870">L</span><span class="op" id="4532871">;</span>&nbsp;<span class="ident" id="4532873">i</span><span class="op" id="4532874">++</span>&nbsp;<span class="op" id="4532877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532882">_</span><span class="op" id="4532883">,</span>&nbsp;<span class="ident" id="4532885">err</span>&nbsp;<span class="op" id="4532889">=</span>&nbsp;<span class="ident" id="4532891">io</span><span class="op" id="4532893">.</span><span class="ident" id="4532894">ReadFull</span><span class="op" id="4532902">(</span><span class="ident" id="4532903">rand</span><span class="op" id="4532907">,</span>&nbsp;<span class="ident" id="4532909">pBytes</span><span class="op" id="4532915">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532920">if</span>&nbsp;<span class="ident" id="4532923">err</span>&nbsp;<span class="op" id="4532927">!=</span>&nbsp;<span class="ident" id="4532930">nil</span>&nbsp;<span class="op" id="4532934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4532940">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4532950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532956">pBytes</span><span class="op" id="4532962">[</span><span class="builtinfunc" id="4532963">len</span><span class="op" id="4532966">(</span><span class="ident" id="4532967">pBytes</span><span class="op" id="4532973">)</span><span class="op" id="4532974">-</span><span class="num" id="4532975">1</span><span class="op" id="4532976">]</span>&nbsp;<span class="op" id="4532978">|=</span>&nbsp;<span class="num" id="4532981">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4532986">pBytes</span><span class="op" id="4532992">[</span><span class="num" id="4532993">0</span><span class="op" id="4532994">]</span>&nbsp;<span class="op" id="4532996">|=</span>&nbsp;<span class="num" id="4532999">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533008">p</span><span class="op" id="4533009">.</span><span class="ident" id="4533010">SetBytes</span><span class="op" id="4533018">(</span><span class="ident" id="4533019">pBytes</span><span class="op" id="4533025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533030">rem</span><span class="op" id="4533033">.</span><span class="ident" id="4533034">Mod</span><span class="op" id="4533037">(</span><span class="ident" id="4533038">p</span><span class="op" id="4533039">,</span>&nbsp;<span class="ident" id="4533041">q</span><span class="op" id="4533042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533047">rem</span><span class="op" id="4533050">.</span><span class="ident" id="4533051">Sub</span><span class="op" id="4533054">(</span><span class="ident" id="4533055">rem</span><span class="op" id="4533058">,</span>&nbsp;<span class="ident" id="4533060">one</span><span class="op" id="4533063">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533068">p</span><span class="op" id="4533069">.</span><span class="ident" id="4533070">Sub</span><span class="op" id="4533073">(</span><span class="ident" id="4533074">p</span><span class="op" id="4533075">,</span>&nbsp;<span class="ident" id="4533077">rem</span><span class="op" id="4533080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533085">if</span>&nbsp;<span class="ident" id="4533088">p</span><span class="op" id="4533089">.</span><span class="ident" id="4533090">BitLen</span><span class="op" id="4533096">(</span><span class="op" id="4533097">)</span>&nbsp;<span class="op" id="4533099">&lt;</span>&nbsp;<span class="ident" id="4533101">L</span>&nbsp;<span class="op" id="4533103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533109">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533127">if</span>&nbsp;<span class="op" id="4533130">!</span><span class="ident" id="4533131">p</span><span class="op" id="4533132">.</span><span class="ident" id="4533133">ProbablyPrime</span><span class="op" id="4533146">(</span><span class="ident" id="4533147">numMRTests</span><span class="op" id="4533157">)</span>&nbsp;<span class="op" id="4533159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533165">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533183">params</span><span class="op" id="4533189">.</span><span class="ident" id="4533190">P</span>&nbsp;<span class="op" id="4533192">=</span>&nbsp;<span class="ident" id="4533194">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533199">params</span><span class="op" id="4533205">.</span><span class="ident" id="4533206">Q</span>&nbsp;<span class="op" id="4533208">=</span>&nbsp;<span class="ident" id="4533210">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533215">break</span>&nbsp;<span class="ident" id="4533221">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533245">h</span>&nbsp;<span class="op" id="4533247">:=</span>&nbsp;<span class="builtinfunc" id="4533250">new</span><span class="op" id="4533253">(</span><span class="ident" id="4533254">big</span><span class="op" id="4533257">.</span><span class="ident" id="4533258">Int</span><span class="op" id="4533261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533264">h</span><span class="op" id="4533265">.</span><span class="ident" id="4533266">SetInt64</span><span class="op" id="4533274">(</span><span class="num" id="4533275">2</span><span class="op" id="4533276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533279">g</span>&nbsp;<span class="op" id="4533281">:=</span>&nbsp;<span class="builtinfunc" id="4533284">new</span><span class="op" id="4533287">(</span><span class="ident" id="4533288">big</span><span class="op" id="4533291">.</span><span class="ident" id="4533292">Int</span><span class="op" id="4533295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533299">pm1</span>&nbsp;<span class="op" id="4533303">:=</span>&nbsp;<span class="builtinfunc" id="4533306">new</span><span class="op" id="4533309">(</span><span class="ident" id="4533310">big</span><span class="op" id="4533313">.</span><span class="ident" id="4533314">Int</span><span class="op" id="4533317">)</span><span class="op" id="4533318">.</span><span class="ident" id="4533319">Sub</span><span class="op" id="4533322">(</span><span class="ident" id="4533323">p</span><span class="op" id="4533324">,</span>&nbsp;<span class="ident" id="4533326">one</span><span class="op" id="4533329">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533332">e</span>&nbsp;<span class="op" id="4533334">:=</span>&nbsp;<span class="builtinfunc" id="4533337">new</span><span class="op" id="4533340">(</span><span class="ident" id="4533341">big</span><span class="op" id="4533344">.</span><span class="ident" id="4533345">Int</span><span class="op" id="4533348">)</span><span class="op" id="4533349">.</span><span class="ident" id="4533350">Div</span><span class="op" id="4533353">(</span><span class="ident" id="4533354">pm1</span><span class="op" id="4533357">,</span>&nbsp;<span class="ident" id="4533359">q</span><span class="op" id="4533360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533364">for</span>&nbsp;<span class="op" id="4533368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533372">g</span><span class="op" id="4533373">.</span><span class="ident" id="4533374">Exp</span><span class="op" id="4533377">(</span><span class="ident" id="4533378">h</span><span class="op" id="4533379">,</span>&nbsp;<span class="ident" id="4533381">e</span><span class="op" id="4533382">,</span>&nbsp;<span class="ident" id="4533384">p</span><span class="op" id="4533385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533389">if</span>&nbsp;<span class="ident" id="4533392">g</span><span class="op" id="4533393">.</span><span class="ident" id="4533394">Cmp</span><span class="op" id="4533397">(</span><span class="ident" id="4533398">one</span><span class="op" id="4533401">)</span>&nbsp;<span class="op" id="4533403">==</span>&nbsp;<span class="num" id="4533406">0</span>&nbsp;<span class="op" id="4533408">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533413">h</span><span class="op" id="4533414">.</span><span class="ident" id="4533415">Add</span><span class="op" id="4533418">(</span><span class="ident" id="4533419">h</span><span class="op" id="4533420">,</span>&nbsp;<span class="ident" id="4533422">one</span><span class="op" id="4533425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533430">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533446">params</span><span class="op" id="4533452">.</span><span class="ident" id="4533453">G</span>&nbsp;<span class="op" id="4533455">=</span>&nbsp;<span class="ident" id="4533457">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533461">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533469">}</span><br>
<span class="lineno"></span><span class="op" id="4533471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4533474">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4533548">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4533610">func</span>&nbsp;<span class="ident" id="4533615">GenerateKey</span><span class="op" id="4533626">(</span><span class="ident" id="4533627">priv</span>&nbsp;<span class="op" id="4533632">*</span><span class="ident" id="4533633">PrivateKey</span><span class="op" id="4533643">,</span>&nbsp;<span class="ident" id="4533645">rand</span>&nbsp;<span class="ident" id="4533650">io</span><span class="op" id="4533652">.</span><span class="ident" id="4533653">Reader</span><span class="op" id="4533659">)</span>&nbsp;<span class="builtintype" id="4533661">error</span>&nbsp;<span class="op" id="4533667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533670">if</span>&nbsp;<span class="ident" id="4533673">priv</span><span class="op" id="4533677">.</span><span class="ident" id="4533678">P</span>&nbsp;<span class="op" id="4533680">==</span>&nbsp;<span class="ident" id="4533683">nil</span>&nbsp;<span class="op" id="4533687">||</span>&nbsp;<span class="ident" id="4533690">priv</span><span class="op" id="4533694">.</span><span class="ident" id="4533695">Q</span>&nbsp;<span class="op" id="4533697">==</span>&nbsp;<span class="ident" id="4533700">nil</span>&nbsp;<span class="op" id="4533704">||</span>&nbsp;<span class="ident" id="4533707">priv</span><span class="op" id="4533711">.</span><span class="ident" id="4533712">G</span>&nbsp;<span class="op" id="4533714">==</span>&nbsp;<span class="ident" id="4533717">nil</span>&nbsp;<span class="op" id="4533721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533725">return</span>&nbsp;<span class="ident" id="4533732">errors</span><span class="op" id="4533738">.</span><span class="ident" id="4533739">New</span><span class="op" id="4533742">(</span><span class="string" id="4533743">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4533800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533803">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533807">x</span>&nbsp;<span class="op" id="4533809">:=</span>&nbsp;<span class="builtinfunc" id="4533812">new</span><span class="op" id="4533815">(</span><span class="ident" id="4533816">big</span><span class="op" id="4533819">.</span><span class="ident" id="4533820">Int</span><span class="op" id="4533823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533826">xBytes</span>&nbsp;<span class="op" id="4533833">:=</span>&nbsp;<span class="builtinfunc" id="4533836">make</span><span class="op" id="4533840">(</span><span class="op" id="4533841">[</span><span class="op" id="4533842">]</span><span class="builtintype" id="4533843">byte</span><span class="op" id="4533847">,</span>&nbsp;<span class="ident" id="4533849">priv</span><span class="op" id="4533853">.</span><span class="ident" id="4533854">Q</span><span class="op" id="4533855">.</span><span class="ident" id="4533856">BitLen</span><span class="op" id="4533862">(</span><span class="op" id="4533863">)</span><span class="op" id="4533864">/</span><span class="num" id="4533865">8</span><span class="op" id="4533866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533870">for</span>&nbsp;<span class="op" id="4533874">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533878">_</span><span class="op" id="4533879">,</span>&nbsp;<span class="ident" id="4533881">err</span>&nbsp;<span class="op" id="4533885">:=</span>&nbsp;<span class="ident" id="4533888">io</span><span class="op" id="4533890">.</span><span class="ident" id="4533891">ReadFull</span><span class="op" id="4533899">(</span><span class="ident" id="4533900">rand</span><span class="op" id="4533904">,</span>&nbsp;<span class="ident" id="4533906">xBytes</span><span class="op" id="4533912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533916">if</span>&nbsp;<span class="ident" id="4533919">err</span>&nbsp;<span class="op" id="4533923">!=</span>&nbsp;<span class="ident" id="4533926">nil</span>&nbsp;<span class="op" id="4533930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533935">return</span>&nbsp;<span class="ident" id="4533942">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533952">x</span><span class="op" id="4533953">.</span><span class="ident" id="4533954">SetBytes</span><span class="op" id="4533962">(</span><span class="ident" id="4533963">xBytes</span><span class="op" id="4533969">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533973">if</span>&nbsp;<span class="ident" id="4533976">x</span><span class="op" id="4533977">.</span><span class="ident" id="4533978">Sign</span><span class="op" id="4533982">(</span><span class="op" id="4533983">)</span>&nbsp;<span class="op" id="4533985">!=</span>&nbsp;<span class="num" id="4533988">0</span>&nbsp;<span class="op" id="4533990">&amp;&amp;</span>&nbsp;<span class="ident" id="4533993">x</span><span class="op" id="4533994">.</span><span class="ident" id="4533995">Cmp</span><span class="op" id="4533998">(</span><span class="ident" id="4533999">priv</span><span class="op" id="4534003">.</span><span class="ident" id="4534004">Q</span><span class="op" id="4534005">)</span>&nbsp;<span class="op" id="4534007">&lt;</span>&nbsp;<span class="num" id="4534009">0</span>&nbsp;<span class="op" id="4534011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534016">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4534027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534031">priv</span><span class="op" id="4534035">.</span><span class="ident" id="4534036">X</span>&nbsp;<span class="op" id="4534038">=</span>&nbsp;<span class="ident" id="4534040">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534043">priv</span><span class="op" id="4534047">.</span><span class="ident" id="4534048">Y</span>&nbsp;<span class="op" id="4534050">=</span>&nbsp;<span class="builtinfunc" id="4534052">new</span><span class="op" id="4534055">(</span><span class="ident" id="4534056">big</span><span class="op" id="4534059">.</span><span class="ident" id="4534060">Int</span><span class="op" id="4534063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534066">priv</span><span class="op" id="4534070">.</span><span class="ident" id="4534071">Y</span><span class="op" id="4534072">.</span><span class="ident" id="4534073">Exp</span><span class="op" id="4534076">(</span><span class="ident" id="4534077">priv</span><span class="op" id="4534081">.</span><span class="ident" id="4534082">G</span><span class="op" id="4534083">,</span>&nbsp;<span class="ident" id="4534085">x</span><span class="op" id="4534086">,</span>&nbsp;<span class="ident" id="4534088">priv</span><span class="op" id="4534092">.</span><span class="ident" id="4534093">P</span><span class="op" id="4534094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534097">return</span>&nbsp;<span class="ident" id="4534104">nil</span><br>
<span class="lineno"></span><span class="op" id="4534108">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4534111">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4534188">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4534266">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4534337">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4534375">func</span>&nbsp;<span class="ident" id="4534380">fermatInverse</span><span class="op" id="4534393">(</span><span class="ident" id="4534394">k</span><span class="op" id="4534395">,</span>&nbsp;<span class="ident" id="4534397">P</span>&nbsp;<span class="op" id="4534399">*</span><span class="ident" id="4534400">big</span><span class="op" id="4534403">.</span><span class="ident" id="4534404">Int</span><span class="op" id="4534407">)</span>&nbsp;<span class="op" id="4534409">*</span><span class="ident" id="4534410">big</span><span class="op" id="4534413">.</span><span class="ident" id="4534414">Int</span>&nbsp;<span class="op" id="4534418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534421">two</span>&nbsp;<span class="op" id="4534425">:=</span>&nbsp;<span class="ident" id="4534428">big</span><span class="op" id="4534431">.</span><span class="ident" id="4534432">NewInt</span><span class="op" id="4534438">(</span><span class="num" id="4534439">2</span><span class="op" id="4534440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534443">pMinus2</span>&nbsp;<span class="op" id="4534451">:=</span>&nbsp;<span class="builtinfunc" id="4534454">new</span><span class="op" id="4534457">(</span><span class="ident" id="4534458">big</span><span class="op" id="4534461">.</span><span class="ident" id="4534462">Int</span><span class="op" id="4534465">)</span><span class="op" id="4534466">.</span><span class="ident" id="4534467">Sub</span><span class="op" id="4534470">(</span><span class="ident" id="4534471">P</span><span class="op" id="4534472">,</span>&nbsp;<span class="ident" id="4534474">two</span><span class="op" id="4534477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4534480">return</span>&nbsp;<span class="builtinfunc" id="4534487">new</span><span class="op" id="4534490">(</span><span class="ident" id="4534491">big</span><span class="op" id="4534494">.</span><span class="ident" id="4534495">Int</span><span class="op" id="4534498">)</span><span class="op" id="4534499">.</span><span class="ident" id="4534500">Exp</span><span class="op" id="4534503">(</span><span class="ident" id="4534504">k</span><span class="op" id="4534505">,</span>&nbsp;<span class="ident" id="4534507">pMinus2</span><span class="op" id="4534514">,</span>&nbsp;<span class="ident" id="4534516">P</span><span class="op" id="4534517">)</span><br>
<span class="lineno"></span><span class="op" id="4534519">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4534522">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4534602">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4534680">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4534759">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4534768">//</span><br>
<span class="lineno"></span><span class="comment" id="4534771">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4534851">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4534926">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4534948">func</span>&nbsp;<span class="ident" id="4534953">Sign</span><span class="op" id="4534957">(</span><span class="ident" id="4534958">rand</span>&nbsp;<span class="ident" id="4534963">io</span><span class="op" id="4534965">.</span><span class="ident" id="4534966">Reader</span><span class="op" id="4534972">,</span>&nbsp;<span class="ident" id="4534974">priv</span>&nbsp;<span class="op" id="4534979">*</span><span class="ident" id="4534980">PrivateKey</span><span class="op" id="4534990">,</span>&nbsp;<span class="ident" id="4534992">hash</span>&nbsp;<span class="op" id="4534997">[</span><span class="op" id="4534998">]</span><span class="builtintype" id="4534999">byte</span><span class="op" id="4535003">)</span>&nbsp;<span class="op" id="4535005">(</span><span class="ident" id="4535006">r</span><span class="op" id="4535007">,</span>&nbsp;<span class="ident" id="4535009">s</span>&nbsp;<span class="op" id="4535011">*</span><span class="ident" id="4535012">big</span><span class="op" id="4535015">.</span><span class="ident" id="4535016">Int</span><span class="op" id="4535019">,</span>&nbsp;<span class="ident" id="4535021">err</span>&nbsp;<span class="builtintype" id="4535025">error</span><span class="op" id="4535030">)</span>&nbsp;<span class="op" id="4535032">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4535035">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535064">n</span>&nbsp;<span class="op" id="4535066">:=</span>&nbsp;<span class="ident" id="4535069">priv</span><span class="op" id="4535073">.</span><span class="ident" id="4535074">Q</span><span class="op" id="4535075">.</span><span class="ident" id="4535076">BitLen</span><span class="op" id="4535082">(</span><span class="op" id="4535083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535086">if</span>&nbsp;<span class="ident" id="4535089">n</span><span class="op" id="4535090">&amp;</span><span class="num" id="4535091">7</span>&nbsp;<span class="op" id="4535093">!=</span>&nbsp;<span class="num" id="4535096">0</span>&nbsp;<span class="op" id="4535098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535102">err</span>&nbsp;<span class="op" id="4535106">=</span>&nbsp;<span class="ident" id="4535108">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535141">n</span>&nbsp;<span class="op" id="4535143">&gt;&gt;=</span>&nbsp;<span class="num" id="4535147">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535151">for</span>&nbsp;<span class="op" id="4535155">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535159">k</span>&nbsp;<span class="op" id="4535161">:=</span>&nbsp;<span class="builtinfunc" id="4535164">new</span><span class="op" id="4535167">(</span><span class="ident" id="4535168">big</span><span class="op" id="4535171">.</span><span class="ident" id="4535172">Int</span><span class="op" id="4535175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535179">buf</span>&nbsp;<span class="op" id="4535183">:=</span>&nbsp;<span class="builtinfunc" id="4535186">make</span><span class="op" id="4535190">(</span><span class="op" id="4535191">[</span><span class="op" id="4535192">]</span><span class="builtintype" id="4535193">byte</span><span class="op" id="4535197">,</span>&nbsp;<span class="ident" id="4535199">n</span><span class="op" id="4535200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535204">for</span>&nbsp;<span class="op" id="4535208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535213">_</span><span class="op" id="4535214">,</span>&nbsp;<span class="ident" id="4535216">err</span>&nbsp;<span class="op" id="4535220">=</span>&nbsp;<span class="ident" id="4535222">io</span><span class="op" id="4535224">.</span><span class="ident" id="4535225">ReadFull</span><span class="op" id="4535233">(</span><span class="ident" id="4535234">rand</span><span class="op" id="4535238">,</span>&nbsp;<span class="ident" id="4535240">buf</span><span class="op" id="4535243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535248">if</span>&nbsp;<span class="ident" id="4535251">err</span>&nbsp;<span class="op" id="4535255">!=</span>&nbsp;<span class="ident" id="4535258">nil</span>&nbsp;<span class="op" id="4535262">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535283">k</span><span class="op" id="4535284">.</span><span class="ident" id="4535285">SetBytes</span><span class="op" id="4535293">(</span><span class="ident" id="4535294">buf</span><span class="op" id="4535297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535302">if</span>&nbsp;<span class="ident" id="4535305">k</span><span class="op" id="4535306">.</span><span class="ident" id="4535307">Sign</span><span class="op" id="4535311">(</span><span class="op" id="4535312">)</span>&nbsp;<span class="op" id="4535314">&gt;</span>&nbsp;<span class="num" id="4535316">0</span>&nbsp;<span class="op" id="4535318">&amp;&amp;</span>&nbsp;<span class="ident" id="4535321">k</span><span class="op" id="4535322">.</span><span class="ident" id="4535323">Cmp</span><span class="op" id="4535326">(</span><span class="ident" id="4535327">priv</span><span class="op" id="4535331">.</span><span class="ident" id="4535332">Q</span><span class="op" id="4535333">)</span>&nbsp;<span class="op" id="4535335">&lt;</span>&nbsp;<span class="num" id="4535337">0</span>&nbsp;<span class="op" id="4535339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535345">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535363">kInv</span>&nbsp;<span class="op" id="4535368">:=</span>&nbsp;<span class="ident" id="4535371">fermatInverse</span><span class="op" id="4535384">(</span><span class="ident" id="4535385">k</span><span class="op" id="4535386">,</span>&nbsp;<span class="ident" id="4535388">priv</span><span class="op" id="4535392">.</span><span class="ident" id="4535393">Q</span><span class="op" id="4535394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535399">r</span>&nbsp;<span class="op" id="4535401">=</span>&nbsp;<span class="builtinfunc" id="4535403">new</span><span class="op" id="4535406">(</span><span class="ident" id="4535407">big</span><span class="op" id="4535410">.</span><span class="ident" id="4535411">Int</span><span class="op" id="4535414">)</span><span class="op" id="4535415">.</span><span class="ident" id="4535416">Exp</span><span class="op" id="4535419">(</span><span class="ident" id="4535420">priv</span><span class="op" id="4535424">.</span><span class="ident" id="4535425">G</span><span class="op" id="4535426">,</span>&nbsp;<span class="ident" id="4535428">k</span><span class="op" id="4535429">,</span>&nbsp;<span class="ident" id="4535431">priv</span><span class="op" id="4535435">.</span><span class="ident" id="4535436">P</span><span class="op" id="4535437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535441">r</span><span class="op" id="4535442">.</span><span class="ident" id="4535443">Mod</span><span class="op" id="4535446">(</span><span class="ident" id="4535447">r</span><span class="op" id="4535448">,</span>&nbsp;<span class="ident" id="4535450">priv</span><span class="op" id="4535454">.</span><span class="ident" id="4535455">Q</span><span class="op" id="4535456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535461">if</span>&nbsp;<span class="ident" id="4535464">r</span><span class="op" id="4535465">.</span><span class="ident" id="4535466">Sign</span><span class="op" id="4535470">(</span><span class="op" id="4535471">)</span>&nbsp;<span class="op" id="4535473">==</span>&nbsp;<span class="num" id="4535476">0</span>&nbsp;<span class="op" id="4535478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535483">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535499">z</span>&nbsp;<span class="op" id="4535501">:=</span>&nbsp;<span class="ident" id="4535504">k</span><span class="op" id="4535505">.</span><span class="ident" id="4535506">SetBytes</span><span class="op" id="4535514">(</span><span class="ident" id="4535515">hash</span><span class="op" id="4535519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535524">s</span>&nbsp;<span class="op" id="4535526">=</span>&nbsp;<span class="builtinfunc" id="4535528">new</span><span class="op" id="4535531">(</span><span class="ident" id="4535532">big</span><span class="op" id="4535535">.</span><span class="ident" id="4535536">Int</span><span class="op" id="4535539">)</span><span class="op" id="4535540">.</span><span class="ident" id="4535541">Mul</span><span class="op" id="4535544">(</span><span class="ident" id="4535545">priv</span><span class="op" id="4535549">.</span><span class="ident" id="4535550">X</span><span class="op" id="4535551">,</span>&nbsp;<span class="ident" id="4535553">r</span><span class="op" id="4535554">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535558">s</span><span class="op" id="4535559">.</span><span class="ident" id="4535560">Add</span><span class="op" id="4535563">(</span><span class="ident" id="4535564">s</span><span class="op" id="4535565">,</span>&nbsp;<span class="ident" id="4535567">z</span><span class="op" id="4535568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535572">s</span><span class="op" id="4535573">.</span><span class="ident" id="4535574">Mod</span><span class="op" id="4535577">(</span><span class="ident" id="4535578">s</span><span class="op" id="4535579">,</span>&nbsp;<span class="ident" id="4535581">priv</span><span class="op" id="4535585">.</span><span class="ident" id="4535586">Q</span><span class="op" id="4535587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535591">s</span><span class="op" id="4535592">.</span><span class="ident" id="4535593">Mul</span><span class="op" id="4535596">(</span><span class="ident" id="4535597">s</span><span class="op" id="4535598">,</span>&nbsp;<span class="ident" id="4535600">kInv</span><span class="op" id="4535604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535608">s</span><span class="op" id="4535609">.</span><span class="ident" id="4535610">Mod</span><span class="op" id="4535613">(</span><span class="ident" id="4535614">s</span><span class="op" id="4535615">,</span>&nbsp;<span class="ident" id="4535617">priv</span><span class="op" id="4535621">.</span><span class="ident" id="4535622">Q</span><span class="op" id="4535623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535628">if</span>&nbsp;<span class="ident" id="4535631">s</span><span class="op" id="4535632">.</span><span class="ident" id="4535633">Sign</span><span class="op" id="4535637">(</span><span class="op" id="4535638">)</span>&nbsp;<span class="op" id="4535640">!=</span>&nbsp;<span class="num" id="4535643">0</span>&nbsp;<span class="op" id="4535645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535650">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535665">return</span><br>
<span class="lineno"></span><span class="op" id="4535672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4535675">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4535754">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4535797">//</span><br>
<span class="lineno"></span><span class="comment" id="4535800">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4535880">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4535955">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4535977">func</span>&nbsp;<span class="ident" id="4535982">Verify</span><span class="op" id="4535988">(</span><span class="ident" id="4535989">pub</span>&nbsp;<span class="op" id="4535993">*</span><span class="ident" id="4535994">PublicKey</span><span class="op" id="4536003">,</span>&nbsp;<span class="ident" id="4536005">hash</span>&nbsp;<span class="op" id="4536010">[</span><span class="op" id="4536011">]</span><span class="builtintype" id="4536012">byte</span><span class="op" id="4536016">,</span>&nbsp;<span class="ident" id="4536018">r</span><span class="op" id="4536019">,</span>&nbsp;<span class="ident" id="4536021">s</span>&nbsp;<span class="op" id="4536023">*</span><span class="ident" id="4536024">big</span><span class="op" id="4536027">.</span><span class="ident" id="4536028">Int</span><span class="op" id="4536031">)</span>&nbsp;<span class="builtintype" id="4536033">bool</span>&nbsp;<span class="op" id="4536038">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4536041">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536070">if</span>&nbsp;<span class="ident" id="4536073">r</span><span class="op" id="4536074">.</span><span class="ident" id="4536075">Sign</span><span class="op" id="4536079">(</span><span class="op" id="4536080">)</span>&nbsp;<span class="op" id="4536082">&lt;</span>&nbsp;<span class="num" id="4536084">1</span>&nbsp;<span class="op" id="4536086">||</span>&nbsp;<span class="ident" id="4536089">r</span><span class="op" id="4536090">.</span><span class="ident" id="4536091">Cmp</span><span class="op" id="4536094">(</span><span class="ident" id="4536095">pub</span><span class="op" id="4536098">.</span><span class="ident" id="4536099">Q</span><span class="op" id="4536100">)</span>&nbsp;<span class="op" id="4536102">&gt;=</span>&nbsp;<span class="num" id="4536105">0</span>&nbsp;<span class="op" id="4536107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536111">return</span>&nbsp;<span class="builtintype" id="4536118">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4536125">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536128">if</span>&nbsp;<span class="ident" id="4536131">s</span><span class="op" id="4536132">.</span><span class="ident" id="4536133">Sign</span><span class="op" id="4536137">(</span><span class="op" id="4536138">)</span>&nbsp;<span class="op" id="4536140">&lt;</span>&nbsp;<span class="num" id="4536142">1</span>&nbsp;<span class="op" id="4536144">||</span>&nbsp;<span class="ident" id="4536147">s</span><span class="op" id="4536148">.</span><span class="ident" id="4536149">Cmp</span><span class="op" id="4536152">(</span><span class="ident" id="4536153">pub</span><span class="op" id="4536156">.</span><span class="ident" id="4536157">Q</span><span class="op" id="4536158">)</span>&nbsp;<span class="op" id="4536160">&gt;=</span>&nbsp;<span class="num" id="4536163">0</span>&nbsp;<span class="op" id="4536165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536169">return</span>&nbsp;<span class="builtintype" id="4536176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4536183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536187">w</span>&nbsp;<span class="op" id="4536189">:=</span>&nbsp;<span class="builtinfunc" id="4536192">new</span><span class="op" id="4536195">(</span><span class="ident" id="4536196">big</span><span class="op" id="4536199">.</span><span class="ident" id="4536200">Int</span><span class="op" id="4536203">)</span><span class="op" id="4536204">.</span><span class="ident" id="4536205">ModInverse</span><span class="op" id="4536215">(</span><span class="ident" id="4536216">s</span><span class="op" id="4536217">,</span>&nbsp;<span class="ident" id="4536219">pub</span><span class="op" id="4536222">.</span><span class="ident" id="4536223">Q</span><span class="op" id="4536224">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536228">n</span>&nbsp;<span class="op" id="4536230">:=</span>&nbsp;<span class="ident" id="4536233">pub</span><span class="op" id="4536236">.</span><span class="ident" id="4536237">Q</span><span class="op" id="4536238">.</span><span class="ident" id="4536239">BitLen</span><span class="op" id="4536245">(</span><span class="op" id="4536246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536249">if</span>&nbsp;<span class="ident" id="4536252">n</span><span class="op" id="4536253">&amp;</span><span class="num" id="4536254">7</span>&nbsp;<span class="op" id="4536256">!=</span>&nbsp;<span class="num" id="4536259">0</span>&nbsp;<span class="op" id="4536261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536265">return</span>&nbsp;<span class="builtintype" id="4536272">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4536279">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536282">z</span>&nbsp;<span class="op" id="4536284">:=</span>&nbsp;<span class="builtinfunc" id="4536287">new</span><span class="op" id="4536290">(</span><span class="ident" id="4536291">big</span><span class="op" id="4536294">.</span><span class="ident" id="4536295">Int</span><span class="op" id="4536298">)</span><span class="op" id="4536299">.</span><span class="ident" id="4536300">SetBytes</span><span class="op" id="4536308">(</span><span class="ident" id="4536309">hash</span><span class="op" id="4536313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536317">u1</span>&nbsp;<span class="op" id="4536320">:=</span>&nbsp;<span class="builtinfunc" id="4536323">new</span><span class="op" id="4536326">(</span><span class="ident" id="4536327">big</span><span class="op" id="4536330">.</span><span class="ident" id="4536331">Int</span><span class="op" id="4536334">)</span><span class="op" id="4536335">.</span><span class="ident" id="4536336">Mul</span><span class="op" id="4536339">(</span><span class="ident" id="4536340">z</span><span class="op" id="4536341">,</span>&nbsp;<span class="ident" id="4536343">w</span><span class="op" id="4536344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536347">u1</span><span class="op" id="4536349">.</span><span class="ident" id="4536350">Mod</span><span class="op" id="4536353">(</span><span class="ident" id="4536354">u1</span><span class="op" id="4536356">,</span>&nbsp;<span class="ident" id="4536358">pub</span><span class="op" id="4536361">.</span><span class="ident" id="4536362">Q</span><span class="op" id="4536363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536366">u2</span>&nbsp;<span class="op" id="4536369">:=</span>&nbsp;<span class="ident" id="4536372">w</span><span class="op" id="4536373">.</span><span class="ident" id="4536374">Mul</span><span class="op" id="4536377">(</span><span class="ident" id="4536378">r</span><span class="op" id="4536379">,</span>&nbsp;<span class="ident" id="4536381">w</span><span class="op" id="4536382">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536385">u2</span><span class="op" id="4536387">.</span><span class="ident" id="4536388">Mod</span><span class="op" id="4536391">(</span><span class="ident" id="4536392">u2</span><span class="op" id="4536394">,</span>&nbsp;<span class="ident" id="4536396">pub</span><span class="op" id="4536399">.</span><span class="ident" id="4536400">Q</span><span class="op" id="4536401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536404">v</span>&nbsp;<span class="op" id="4536406">:=</span>&nbsp;<span class="ident" id="4536409">u1</span><span class="op" id="4536411">.</span><span class="ident" id="4536412">Exp</span><span class="op" id="4536415">(</span><span class="ident" id="4536416">pub</span><span class="op" id="4536419">.</span><span class="ident" id="4536420">G</span><span class="op" id="4536421">,</span>&nbsp;<span class="ident" id="4536423">u1</span><span class="op" id="4536425">,</span>&nbsp;<span class="ident" id="4536427">pub</span><span class="op" id="4536430">.</span><span class="ident" id="4536431">P</span><span class="op" id="4536432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536435">u2</span><span class="op" id="4536437">.</span><span class="ident" id="4536438">Exp</span><span class="op" id="4536441">(</span><span class="ident" id="4536442">pub</span><span class="op" id="4536445">.</span><span class="ident" id="4536446">Y</span><span class="op" id="4536447">,</span>&nbsp;<span class="ident" id="4536449">u2</span><span class="op" id="4536451">,</span>&nbsp;<span class="ident" id="4536453">pub</span><span class="op" id="4536456">.</span><span class="ident" id="4536457">P</span><span class="op" id="4536458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536461">v</span><span class="op" id="4536462">.</span><span class="ident" id="4536463">Mul</span><span class="op" id="4536466">(</span><span class="ident" id="4536467">v</span><span class="op" id="4536468">,</span>&nbsp;<span class="ident" id="4536470">u2</span><span class="op" id="4536472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536475">v</span><span class="op" id="4536476">.</span><span class="ident" id="4536477">Mod</span><span class="op" id="4536480">(</span><span class="ident" id="4536481">v</span><span class="op" id="4536482">,</span>&nbsp;<span class="ident" id="4536484">pub</span><span class="op" id="4536487">.</span><span class="ident" id="4536488">P</span><span class="op" id="4536489">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536492">v</span><span class="op" id="4536493">.</span><span class="ident" id="4536494">Mod</span><span class="op" id="4536497">(</span><span class="ident" id="4536498">v</span><span class="op" id="4536499">,</span>&nbsp;<span class="ident" id="4536501">pub</span><span class="op" id="4536504">.</span><span class="ident" id="4536505">Q</span><span class="op" id="4536506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536510">return</span>&nbsp;<span class="ident" id="4536517">v</span><span class="op" id="4536518">.</span><span class="ident" id="4536519">Cmp</span><span class="op" id="4536522">(</span><span class="ident" id="4536523">r</span><span class="op" id="4536524">)</span>&nbsp;<span class="op" id="4536526">==</span>&nbsp;<span class="num" id="4536529">0</span><br>
<span class="lineno"></span><span class="op" id="4536531">}</span>
</div>
</body>
</html>
