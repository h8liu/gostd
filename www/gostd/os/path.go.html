<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2346964">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2347019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2347073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2347124">package</span>&nbsp;<span class="ident" id="2347132">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2347136">import</span>&nbsp;<span class="op" id="2347143">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2347146">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2347152">&#34;syscall&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2347162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2347165">//&nbsp;MkdirAll&nbsp;creates&nbsp;a&nbsp;directory&nbsp;named&nbsp;path,</span><br>
<span class="lineno"></span><span class="comment" id="2347209">//&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;parents,&nbsp;and&nbsp;returns&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="2347263">//&nbsp;or&nbsp;else&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">15</span><span class="comment" id="2347292">//&nbsp;The&nbsp;permission&nbsp;bits&nbsp;perm&nbsp;are&nbsp;used&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2347337">//&nbsp;directories&nbsp;that&nbsp;MkdirAll&nbsp;creates.</span><br>
<span class="lineno"></span><span class="comment" id="2347375">//&nbsp;If&nbsp;path&nbsp;is&nbsp;already&nbsp;a&nbsp;directory,&nbsp;MkdirAll&nbsp;does&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="2347432">//&nbsp;and&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2347452">func</span>&nbsp;<span class="ident" id="2347457">MkdirAll</span><span class="op" id="2347465">(</span><span class="ident" id="2347466">path</span>&nbsp;<span class="builtintype" id="2347471">string</span><span class="op" id="2347477">,</span>&nbsp;<span class="ident" id="2347479">perm</span>&nbsp;<span class="ident" id="2347484">FileMode</span><span class="op" id="2347492">)</span>&nbsp;<span class="builtintype" id="2347494">error</span>&nbsp;<span class="op" id="2347500">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2347503">//&nbsp;Fast&nbsp;path:&nbsp;if&nbsp;we&nbsp;can&nbsp;tell&nbsp;whether&nbsp;path&nbsp;is&nbsp;a&nbsp;directory&nbsp;or&nbsp;file,&nbsp;stop&nbsp;with&nbsp;success&nbsp;or&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347598">dir</span><span class="op" id="2347601">,</span>&nbsp;<span class="ident" id="2347603">err</span>&nbsp;<span class="op" id="2347607">:=</span>&nbsp;<span class="ident" id="2347610">Stat</span><span class="op" id="2347614">(</span><span class="ident" id="2347615">path</span><span class="op" id="2347619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347622">if</span>&nbsp;<span class="ident" id="2347625">err</span>&nbsp;<span class="op" id="2347629">==</span>&nbsp;<span class="ident" id="2347632">nil</span>&nbsp;<span class="op" id="2347636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347640">if</span>&nbsp;<span class="ident" id="2347643">dir</span><span class="op" id="2347646">.</span><span class="ident" id="2347647">IsDir</span><span class="op" id="2347652">(</span><span class="op" id="2347653">)</span>&nbsp;<span class="op" id="2347655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347660">return</span>&nbsp;<span class="ident" id="2347667">nil</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347677">return</span>&nbsp;<span class="op" id="2347684">&amp;</span><span class="ident" id="2347685">PathError</span><span class="op" id="2347694">{</span><span class="string" id="2347695">&#34;mkdir&#34;</span><span class="op" id="2347702">,</span>&nbsp;<span class="ident" id="2347704">path</span><span class="op" id="2347708">,</span>&nbsp;<span class="ident" id="2347710">syscall</span><span class="op" id="2347717">.</span><span class="ident" id="2347718">ENOTDIR</span><span class="op" id="2347725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2347732">//&nbsp;Slow&nbsp;path:&nbsp;make&nbsp;sure&nbsp;parent&nbsp;exists&nbsp;and&nbsp;then&nbsp;call&nbsp;Mkdir&nbsp;for&nbsp;path.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347801">i</span>&nbsp;<span class="op" id="2347803">:=</span>&nbsp;<span class="builtinfunc" id="2347806">len</span><span class="op" id="2347809">(</span><span class="ident" id="2347810">path</span><span class="op" id="2347814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347817">for</span>&nbsp;<span class="ident" id="2347821">i</span>&nbsp;<span class="op" id="2347823">&gt;</span>&nbsp;<span class="num" id="2347825">0</span>&nbsp;<span class="op" id="2347827">&amp;&amp;</span>&nbsp;<span class="ident" id="2347830">IsPathSeparator</span><span class="op" id="2347845">(</span><span class="ident" id="2347846">path</span><span class="op" id="2347850">[</span><span class="ident" id="2347851">i</span><span class="op" id="2347852">-</span><span class="num" id="2347853">1</span><span class="op" id="2347854">]</span><span class="op" id="2347855">)</span>&nbsp;<span class="op" id="2347857">{</span>&nbsp;<span class="comment" id="2347859">//&nbsp;Skip&nbsp;trailing&nbsp;path&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347894">i</span><span class="op" id="2347895">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347903">j</span>&nbsp;<span class="op" id="2347905">:=</span>&nbsp;<span class="ident" id="2347908">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347911">for</span>&nbsp;<span class="ident" id="2347915">j</span>&nbsp;<span class="op" id="2347917">&gt;</span>&nbsp;<span class="num" id="2347919">0</span>&nbsp;<span class="op" id="2347921">&amp;&amp;</span>&nbsp;<span class="op" id="2347924">!</span><span class="ident" id="2347925">IsPathSeparator</span><span class="op" id="2347940">(</span><span class="ident" id="2347941">path</span><span class="op" id="2347945">[</span><span class="ident" id="2347946">j</span><span class="op" id="2347947">-</span><span class="num" id="2347948">1</span><span class="op" id="2347949">]</span><span class="op" id="2347950">)</span>&nbsp;<span class="op" id="2347952">{</span>&nbsp;<span class="comment" id="2347954">//&nbsp;Scan&nbsp;backward&nbsp;over&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347987">j</span><span class="op" id="2347988">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347996">if</span>&nbsp;<span class="ident" id="2347999">j</span>&nbsp;<span class="op" id="2348001">&gt;</span>&nbsp;<span class="num" id="2348003">1</span>&nbsp;<span class="op" id="2348005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348009">//&nbsp;Create&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348028">err</span>&nbsp;<span class="op" id="2348032">=</span>&nbsp;<span class="ident" id="2348034">MkdirAll</span><span class="op" id="2348042">(</span><span class="ident" id="2348043">path</span><span class="op" id="2348047">[</span><span class="num" id="2348048">0</span><span class="op" id="2348049">:</span><span class="ident" id="2348050">j</span><span class="op" id="2348051">-</span><span class="num" id="2348052">1</span><span class="op" id="2348053">]</span><span class="op" id="2348054">,</span>&nbsp;<span class="ident" id="2348056">perm</span><span class="op" id="2348060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348064">if</span>&nbsp;<span class="ident" id="2348067">err</span>&nbsp;<span class="op" id="2348071">!=</span>&nbsp;<span class="ident" id="2348074">nil</span>&nbsp;<span class="op" id="2348078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348083">return</span>&nbsp;<span class="ident" id="2348090">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348103">//&nbsp;Parent&nbsp;now&nbsp;exists;&nbsp;invoke&nbsp;Mkdir&nbsp;and&nbsp;use&nbsp;its&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348159">err</span>&nbsp;<span class="op" id="2348163">=</span>&nbsp;<span class="ident" id="2348165">Mkdir</span><span class="op" id="2348170">(</span><span class="ident" id="2348171">path</span><span class="op" id="2348175">,</span>&nbsp;<span class="ident" id="2348177">perm</span><span class="op" id="2348181">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348184">if</span>&nbsp;<span class="ident" id="2348187">err</span>&nbsp;<span class="op" id="2348191">!=</span>&nbsp;<span class="ident" id="2348194">nil</span>&nbsp;<span class="op" id="2348198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348202">//&nbsp;Handle&nbsp;arguments&nbsp;like&nbsp;&#34;foo/.&#34;&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348240">//&nbsp;double-checking&nbsp;that&nbsp;directory&nbsp;doesn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348291">dir</span><span class="op" id="2348294">,</span>&nbsp;<span class="ident" id="2348296">err1</span>&nbsp;<span class="op" id="2348301">:=</span>&nbsp;<span class="ident" id="2348304">Lstat</span><span class="op" id="2348309">(</span><span class="ident" id="2348310">path</span><span class="op" id="2348314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348318">if</span>&nbsp;<span class="ident" id="2348321">err1</span>&nbsp;<span class="op" id="2348326">==</span>&nbsp;<span class="ident" id="2348329">nil</span>&nbsp;<span class="op" id="2348333">&amp;&amp;</span>&nbsp;<span class="ident" id="2348336">dir</span><span class="op" id="2348339">.</span><span class="ident" id="2348340">IsDir</span><span class="op" id="2348345">(</span><span class="op" id="2348346">)</span>&nbsp;<span class="op" id="2348348">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348353">return</span>&nbsp;<span class="ident" id="2348360">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348370">return</span>&nbsp;<span class="ident" id="2348377">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348385">return</span>&nbsp;<span class="ident" id="2348392">nil</span><br>
<span class="lineno">60</span><span class="op" id="2348396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348399">//&nbsp;RemoveAll&nbsp;removes&nbsp;path&nbsp;and&nbsp;any&nbsp;children&nbsp;it&nbsp;contains.</span><br>
<span class="lineno"></span><span class="comment" id="2348455">//&nbsp;It&nbsp;removes&nbsp;everything&nbsp;it&nbsp;can&nbsp;but&nbsp;returns&nbsp;the&nbsp;first&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2348515">//&nbsp;it&nbsp;encounters.&nbsp;&nbsp;If&nbsp;the&nbsp;path&nbsp;does&nbsp;not&nbsp;exist,&nbsp;RemoveAll</span><br>
<span class="lineno">65</span><span class="comment" id="2348572">//&nbsp;returns&nbsp;nil&nbsp;(no&nbsp;error).</span><br>
<span class="lineno"></span><span class="keyword" id="2348599">func</span>&nbsp;<span class="ident" id="2348604">RemoveAll</span><span class="op" id="2348613">(</span><span class="ident" id="2348614">path</span>&nbsp;<span class="builtintype" id="2348619">string</span><span class="op" id="2348625">)</span>&nbsp;<span class="builtintype" id="2348627">error</span>&nbsp;<span class="op" id="2348633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348636">//&nbsp;Simple&nbsp;case:&nbsp;if&nbsp;Remove&nbsp;works,&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348682">err</span>&nbsp;<span class="op" id="2348686">:=</span>&nbsp;<span class="ident" id="2348689">Remove</span><span class="op" id="2348695">(</span><span class="ident" id="2348696">path</span><span class="op" id="2348700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348703">if</span>&nbsp;<span class="ident" id="2348706">err</span>&nbsp;<span class="op" id="2348710">==</span>&nbsp;<span class="ident" id="2348713">nil</span>&nbsp;<span class="op" id="2348717">||</span>&nbsp;<span class="ident" id="2348720">IsNotExist</span><span class="op" id="2348730">(</span><span class="ident" id="2348731">err</span><span class="op" id="2348734">)</span>&nbsp;<span class="op" id="2348736">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348740">return</span>&nbsp;<span class="ident" id="2348747">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2348756">//&nbsp;Otherwise,&nbsp;is&nbsp;this&nbsp;a&nbsp;directory&nbsp;we&nbsp;need&nbsp;to&nbsp;recurse&nbsp;into?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348816">dir</span><span class="op" id="2348819">,</span>&nbsp;<span class="ident" id="2348821">serr</span>&nbsp;<span class="op" id="2348826">:=</span>&nbsp;<span class="ident" id="2348829">Lstat</span><span class="op" id="2348834">(</span><span class="ident" id="2348835">path</span><span class="op" id="2348839">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348842">if</span>&nbsp;<span class="ident" id="2348845">serr</span>&nbsp;<span class="op" id="2348850">!=</span>&nbsp;<span class="ident" id="2348853">nil</span>&nbsp;<span class="op" id="2348857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348861">if</span>&nbsp;<span class="ident" id="2348864">serr</span><span class="op" id="2348868">,</span>&nbsp;<span class="ident" id="2348870">ok</span>&nbsp;<span class="op" id="2348873">:=</span>&nbsp;<span class="ident" id="2348876">serr</span><span class="op" id="2348880">.</span><span class="op" id="2348881">(</span><span class="op" id="2348882">*</span><span class="ident" id="2348883">PathError</span><span class="op" id="2348892">)</span><span class="op" id="2348893">;</span>&nbsp;<span class="ident" id="2348895">ok</span>&nbsp;<span class="op" id="2348898">&amp;&amp;</span>&nbsp;<span class="op" id="2348901">(</span><span class="ident" id="2348902">IsNotExist</span><span class="op" id="2348912">(</span><span class="ident" id="2348913">serr</span><span class="op" id="2348917">.</span><span class="ident" id="2348918">Err</span><span class="op" id="2348921">)</span>&nbsp;<span class="op" id="2348923">||</span>&nbsp;<span class="ident" id="2348926">serr</span><span class="op" id="2348930">.</span><span class="ident" id="2348931">Err</span>&nbsp;<span class="op" id="2348935">==</span>&nbsp;<span class="ident" id="2348938">syscall</span><span class="op" id="2348945">.</span><span class="ident" id="2348946">ENOTDIR</span><span class="op" id="2348953">)</span>&nbsp;<span class="op" id="2348955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348960">return</span>&nbsp;<span class="ident" id="2348967">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348977">return</span>&nbsp;<span class="ident" id="2348984">serr</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348993">if</span>&nbsp;<span class="op" id="2348996">!</span><span class="ident" id="2348997">dir</span><span class="op" id="2349000">.</span><span class="ident" id="2349001">IsDir</span><span class="op" id="2349006">(</span><span class="op" id="2349007">)</span>&nbsp;<span class="op" id="2349009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349013">//&nbsp;Not&nbsp;a&nbsp;directory;&nbsp;return&nbsp;the&nbsp;error&nbsp;from&nbsp;Remove.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349065">return</span>&nbsp;<span class="ident" id="2349072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349077">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349081">//&nbsp;Directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349096">fd</span><span class="op" id="2349098">,</span>&nbsp;<span class="ident" id="2349100">err</span>&nbsp;<span class="op" id="2349104">:=</span>&nbsp;<span class="ident" id="2349107">Open</span><span class="op" id="2349111">(</span><span class="ident" id="2349112">path</span><span class="op" id="2349116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349119">if</span>&nbsp;<span class="ident" id="2349122">err</span>&nbsp;<span class="op" id="2349126">!=</span>&nbsp;<span class="ident" id="2349129">nil</span>&nbsp;<span class="op" id="2349133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349137">if</span>&nbsp;<span class="ident" id="2349140">IsNotExist</span><span class="op" id="2349150">(</span><span class="ident" id="2349151">err</span><span class="op" id="2349154">)</span>&nbsp;<span class="op" id="2349156">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349161">//&nbsp;Race.&nbsp;It&nbsp;was&nbsp;deleted&nbsp;between&nbsp;the&nbsp;Lstat&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349216">//&nbsp;Return&nbsp;nil&nbsp;per&nbsp;RemoveAll&#39;s&nbsp;docs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349255">return</span>&nbsp;<span class="ident" id="2349262">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349272">return</span>&nbsp;<span class="ident" id="2349279">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349288">//&nbsp;Remove&nbsp;contents&nbsp;&amp;&nbsp;return&nbsp;first&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349330">err</span>&nbsp;<span class="op" id="2349334">=</span>&nbsp;<span class="ident" id="2349336">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349341">for</span>&nbsp;<span class="op" id="2349345">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349349">names</span><span class="op" id="2349354">,</span>&nbsp;<span class="ident" id="2349356">err1</span>&nbsp;<span class="op" id="2349361">:=</span>&nbsp;<span class="ident" id="2349364">fd</span><span class="op" id="2349366">.</span><span class="ident" id="2349367">Readdirnames</span><span class="op" id="2349379">(</span><span class="num" id="2349380">100</span><span class="op" id="2349383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349387">for</span>&nbsp;<span class="ident" id="2349391">_</span><span class="op" id="2349392">,</span>&nbsp;<span class="ident" id="2349394">name</span>&nbsp;<span class="op" id="2349399">:=</span>&nbsp;<span class="keyword" id="2349402">range</span>&nbsp;<span class="ident" id="2349408">names</span>&nbsp;<span class="op" id="2349414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349419">err1</span>&nbsp;<span class="op" id="2349424">:=</span>&nbsp;<span class="ident" id="2349427">RemoveAll</span><span class="op" id="2349436">(</span><span class="ident" id="2349437">path</span>&nbsp;<span class="op" id="2349442">+</span>&nbsp;<span class="builtintype" id="2349444">string</span><span class="op" id="2349450">(</span><span class="ident" id="2349451">PathSeparator</span><span class="op" id="2349464">)</span>&nbsp;<span class="op" id="2349466">+</span>&nbsp;<span class="ident" id="2349468">name</span><span class="op" id="2349472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349477">if</span>&nbsp;<span class="ident" id="2349480">err</span>&nbsp;<span class="op" id="2349484">==</span>&nbsp;<span class="ident" id="2349487">nil</span>&nbsp;<span class="op" id="2349491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349497">err</span>&nbsp;<span class="op" id="2349501">=</span>&nbsp;<span class="ident" id="2349503">err1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349519">if</span>&nbsp;<span class="ident" id="2349522">err1</span>&nbsp;<span class="op" id="2349527">==</span>&nbsp;<span class="ident" id="2349530">io</span><span class="op" id="2349532">.</span><span class="ident" id="2349533">EOF</span>&nbsp;<span class="op" id="2349537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349542">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349550">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349554">//&nbsp;If&nbsp;Readdirnames&nbsp;returned&nbsp;an&nbsp;error,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349602">if</span>&nbsp;<span class="ident" id="2349605">err</span>&nbsp;<span class="op" id="2349609">==</span>&nbsp;<span class="ident" id="2349612">nil</span>&nbsp;<span class="op" id="2349616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349621">err</span>&nbsp;<span class="op" id="2349625">=</span>&nbsp;<span class="ident" id="2349627">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349638">if</span>&nbsp;<span class="builtinfunc" id="2349641">len</span><span class="op" id="2349644">(</span><span class="ident" id="2349645">names</span><span class="op" id="2349650">)</span>&nbsp;<span class="op" id="2349652">==</span>&nbsp;<span class="num" id="2349655">0</span>&nbsp;<span class="op" id="2349657">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349662">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349677">//&nbsp;Close&nbsp;directory,&nbsp;because&nbsp;windows&nbsp;won&#39;t&nbsp;remove&nbsp;opened&nbsp;directory.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349745">fd</span><span class="op" id="2349747">.</span><span class="ident" id="2349748">Close</span><span class="op" id="2349753">(</span><span class="op" id="2349754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349758">//&nbsp;Remove&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349780">err1</span>&nbsp;<span class="op" id="2349785">:=</span>&nbsp;<span class="ident" id="2349788">Remove</span><span class="op" id="2349794">(</span><span class="ident" id="2349795">path</span><span class="op" id="2349799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349802">if</span>&nbsp;<span class="ident" id="2349805">err1</span>&nbsp;<span class="op" id="2349810">==</span>&nbsp;<span class="ident" id="2349813">nil</span>&nbsp;<span class="op" id="2349817">||</span>&nbsp;<span class="ident" id="2349820">IsNotExist</span><span class="op" id="2349830">(</span><span class="ident" id="2349831">err1</span><span class="op" id="2349835">)</span>&nbsp;<span class="op" id="2349837">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349841">return</span>&nbsp;<span class="ident" id="2349848">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349856">if</span>&nbsp;<span class="ident" id="2349859">err</span>&nbsp;<span class="op" id="2349863">==</span>&nbsp;<span class="ident" id="2349866">nil</span>&nbsp;<span class="op" id="2349870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349874">err</span>&nbsp;<span class="op" id="2349878">=</span>&nbsp;<span class="ident" id="2349880">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349886">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349889">return</span>&nbsp;<span class="ident" id="2349896">err</span><br>
<span class="lineno"></span><span class="op" id="2349900">}</span>
</div>
</body>
</html>
