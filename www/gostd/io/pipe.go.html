<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1425733">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1425788">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1425842">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1425893">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1425948">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1425986">package</span>&nbsp;<span class="ident" id="1425994">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1425998">import</span>&nbsp;<span class="op" id="1426005">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1426008">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1426018">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1426025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1426028">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1426110">var</span>&nbsp;<span class="ident" id="1426114">ErrClosedPipe</span>&nbsp;<span class="op" id="1426128">=</span>&nbsp;<span class="ident" id="1426130">errors</span><span class="op" id="1426136">.</span><span class="ident" id="1426137">New</span><span class="op" id="1426140">(</span><span class="string" id="1426141">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1426172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1426175">type</span>&nbsp;<span class="ident" id="1426180">pipeResult</span>&nbsp;<span class="keyword" id="1426191">struct</span>&nbsp;<span class="op" id="1426198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426201">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1426205">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426210">err</span>&nbsp;<span class="builtintype" id="1426214">error</span><br>
<span class="lineno"></span><span class="op" id="1426220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426223">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1426300">type</span>&nbsp;<span class="ident" id="1426305">pipe</span>&nbsp;<span class="keyword" id="1426310">struct</span>&nbsp;<span class="op" id="1426317">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426320">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1426326">sync</span><span class="op" id="1426330">.</span><span class="ident" id="1426331">Mutex</span>&nbsp;<span class="comment" id="1426337">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426369">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1426375">sync</span><span class="op" id="1426379">.</span><span class="ident" id="1426380">Mutex</span>&nbsp;<span class="comment" id="1426386">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426418">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1426424">sync</span><span class="op" id="1426428">.</span><span class="ident" id="1426429">Mutex</span>&nbsp;<span class="comment" id="1426435">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426465">data</span>&nbsp;&nbsp;<span class="op" id="1426471">[</span><span class="op" id="1426472">]</span><span class="builtintype" id="1426473">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1426482">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426518">rwait</span>&nbsp;<span class="ident" id="1426524">sync</span><span class="op" id="1426528">.</span><span class="ident" id="1426529">Cond</span>&nbsp;&nbsp;<span class="comment" id="1426535">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426554">wwait</span>&nbsp;<span class="ident" id="1426560">sync</span><span class="op" id="1426564">.</span><span class="ident" id="1426565">Cond</span>&nbsp;&nbsp;<span class="comment" id="1426571">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426590">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1426596">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1426607">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426650">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1426656">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1426667">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1426708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1426711">func</span>&nbsp;<span class="op" id="1426716">(</span><span class="ident" id="1426717">p</span>&nbsp;<span class="op" id="1426719">*</span><span class="ident" id="1426720">pipe</span><span class="op" id="1426724">)</span>&nbsp;<span class="ident" id="1426726">read</span><span class="op" id="1426730">(</span><span class="ident" id="1426731">b</span>&nbsp;<span class="op" id="1426733">[</span><span class="op" id="1426734">]</span><span class="builtintype" id="1426735">byte</span><span class="op" id="1426739">)</span>&nbsp;<span class="op" id="1426741">(</span><span class="ident" id="1426742">n</span>&nbsp;<span class="builtintype" id="1426744">int</span><span class="op" id="1426747">,</span>&nbsp;<span class="ident" id="1426749">err</span>&nbsp;<span class="builtintype" id="1426753">error</span><span class="op" id="1426758">)</span>&nbsp;<span class="op" id="1426760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426763">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426789">p</span><span class="op" id="1426790">.</span><span class="ident" id="1426791">rl</span><span class="op" id="1426793">.</span><span class="ident" id="1426794">Lock</span><span class="op" id="1426798">(</span><span class="op" id="1426799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426802">defer</span>&nbsp;<span class="ident" id="1426808">p</span><span class="op" id="1426809">.</span><span class="ident" id="1426810">rl</span><span class="op" id="1426812">.</span><span class="ident" id="1426813">Unlock</span><span class="op" id="1426819">(</span><span class="op" id="1426820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426824">p</span><span class="op" id="1426825">.</span><span class="ident" id="1426826">l</span><span class="op" id="1426827">.</span><span class="ident" id="1426828">Lock</span><span class="op" id="1426832">(</span><span class="op" id="1426833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426836">defer</span>&nbsp;<span class="ident" id="1426842">p</span><span class="op" id="1426843">.</span><span class="ident" id="1426844">l</span><span class="op" id="1426845">.</span><span class="ident" id="1426846">Unlock</span><span class="op" id="1426852">(</span><span class="op" id="1426853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426856">for</span>&nbsp;<span class="op" id="1426860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426864">if</span>&nbsp;<span class="ident" id="1426867">p</span><span class="op" id="1426868">.</span><span class="ident" id="1426869">rerr</span>&nbsp;<span class="op" id="1426874">!=</span>&nbsp;<span class="ident" id="1426877">nil</span>&nbsp;<span class="op" id="1426881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426886">return</span>&nbsp;<span class="num" id="1426893">0</span><span class="op" id="1426894">,</span>&nbsp;<span class="ident" id="1426896">ErrClosedPipe</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426916">if</span>&nbsp;<span class="ident" id="1426919">p</span><span class="op" id="1426920">.</span><span class="ident" id="1426921">data</span>&nbsp;<span class="op" id="1426926">!=</span>&nbsp;<span class="ident" id="1426929">nil</span>&nbsp;<span class="op" id="1426933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426938">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426950">if</span>&nbsp;<span class="ident" id="1426953">p</span><span class="op" id="1426954">.</span><span class="ident" id="1426955">werr</span>&nbsp;<span class="op" id="1426960">!=</span>&nbsp;<span class="ident" id="1426963">nil</span>&nbsp;<span class="op" id="1426967">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426972">return</span>&nbsp;<span class="num" id="1426979">0</span><span class="op" id="1426980">,</span>&nbsp;<span class="ident" id="1426982">p</span><span class="op" id="1426983">.</span><span class="ident" id="1426984">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426995">p</span><span class="op" id="1426996">.</span><span class="ident" id="1426997">rwait</span><span class="op" id="1427002">.</span><span class="ident" id="1427003">Wait</span><span class="op" id="1427007">(</span><span class="op" id="1427008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427014">n</span>&nbsp;<span class="op" id="1427016">=</span>&nbsp;<span class="builtinfunc" id="1427018">copy</span><span class="op" id="1427022">(</span><span class="ident" id="1427023">b</span><span class="op" id="1427024">,</span>&nbsp;<span class="ident" id="1427026">p</span><span class="op" id="1427027">.</span><span class="ident" id="1427028">data</span><span class="op" id="1427032">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427035">p</span><span class="op" id="1427036">.</span><span class="ident" id="1427037">data</span>&nbsp;<span class="op" id="1427042">=</span>&nbsp;<span class="ident" id="1427044">p</span><span class="op" id="1427045">.</span><span class="ident" id="1427046">data</span><span class="op" id="1427050">[</span><span class="ident" id="1427051">n</span><span class="op" id="1427052">:</span><span class="op" id="1427053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427056">if</span>&nbsp;<span class="builtinfunc" id="1427059">len</span><span class="op" id="1427062">(</span><span class="ident" id="1427063">p</span><span class="op" id="1427064">.</span><span class="ident" id="1427065">data</span><span class="op" id="1427069">)</span>&nbsp;<span class="op" id="1427071">==</span>&nbsp;<span class="num" id="1427074">0</span>&nbsp;<span class="op" id="1427076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427080">p</span><span class="op" id="1427081">.</span><span class="ident" id="1427082">data</span>&nbsp;<span class="op" id="1427087">=</span>&nbsp;<span class="ident" id="1427089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427095">p</span><span class="op" id="1427096">.</span><span class="ident" id="1427097">wwait</span><span class="op" id="1427102">.</span><span class="ident" id="1427103">Signal</span><span class="op" id="1427109">(</span><span class="op" id="1427110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427113">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427116">return</span><br>
<span class="lineno"></span><span class="op" id="1427123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1427126">var</span>&nbsp;<span class="ident" id="1427130">zero</span>&nbsp;<span class="op" id="1427135">[</span><span class="num" id="1427136">0</span><span class="op" id="1427137">]</span><span class="builtintype" id="1427138">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1427144">func</span>&nbsp;<span class="op" id="1427149">(</span><span class="ident" id="1427150">p</span>&nbsp;<span class="op" id="1427152">*</span><span class="ident" id="1427153">pipe</span><span class="op" id="1427157">)</span>&nbsp;<span class="ident" id="1427159">write</span><span class="op" id="1427164">(</span><span class="ident" id="1427165">b</span>&nbsp;<span class="op" id="1427167">[</span><span class="op" id="1427168">]</span><span class="builtintype" id="1427169">byte</span><span class="op" id="1427173">)</span>&nbsp;<span class="op" id="1427175">(</span><span class="ident" id="1427176">n</span>&nbsp;<span class="builtintype" id="1427178">int</span><span class="op" id="1427181">,</span>&nbsp;<span class="ident" id="1427183">err</span>&nbsp;<span class="builtintype" id="1427187">error</span><span class="op" id="1427192">)</span>&nbsp;<span class="op" id="1427194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427197">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427237">if</span>&nbsp;<span class="ident" id="1427240">b</span>&nbsp;<span class="op" id="1427242">==</span>&nbsp;<span class="ident" id="1427245">nil</span>&nbsp;<span class="op" id="1427249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427253">b</span>&nbsp;<span class="op" id="1427255">=</span>&nbsp;<span class="ident" id="1427257">zero</span><span class="op" id="1427261">[</span><span class="op" id="1427262">:</span><span class="op" id="1427263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427266">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427270">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427296">p</span><span class="op" id="1427297">.</span><span class="ident" id="1427298">wl</span><span class="op" id="1427300">.</span><span class="ident" id="1427301">Lock</span><span class="op" id="1427305">(</span><span class="op" id="1427306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427309">defer</span>&nbsp;<span class="ident" id="1427315">p</span><span class="op" id="1427316">.</span><span class="ident" id="1427317">wl</span><span class="op" id="1427319">.</span><span class="ident" id="1427320">Unlock</span><span class="op" id="1427326">(</span><span class="op" id="1427327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427331">p</span><span class="op" id="1427332">.</span><span class="ident" id="1427333">l</span><span class="op" id="1427334">.</span><span class="ident" id="1427335">Lock</span><span class="op" id="1427339">(</span><span class="op" id="1427340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427343">defer</span>&nbsp;<span class="ident" id="1427349">p</span><span class="op" id="1427350">.</span><span class="ident" id="1427351">l</span><span class="op" id="1427352">.</span><span class="ident" id="1427353">Unlock</span><span class="op" id="1427359">(</span><span class="op" id="1427360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427363">if</span>&nbsp;<span class="ident" id="1427366">p</span><span class="op" id="1427367">.</span><span class="ident" id="1427368">werr</span>&nbsp;<span class="op" id="1427373">!=</span>&nbsp;<span class="ident" id="1427376">nil</span>&nbsp;<span class="op" id="1427380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427384">err</span>&nbsp;<span class="op" id="1427388">=</span>&nbsp;<span class="ident" id="1427390">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427406">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427417">p</span><span class="op" id="1427418">.</span><span class="ident" id="1427419">data</span>&nbsp;<span class="op" id="1427424">=</span>&nbsp;<span class="ident" id="1427426">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427429">p</span><span class="op" id="1427430">.</span><span class="ident" id="1427431">rwait</span><span class="op" id="1427436">.</span><span class="ident" id="1427437">Signal</span><span class="op" id="1427443">(</span><span class="op" id="1427444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427447">for</span>&nbsp;<span class="op" id="1427451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427455">if</span>&nbsp;<span class="ident" id="1427458">p</span><span class="op" id="1427459">.</span><span class="ident" id="1427460">data</span>&nbsp;<span class="op" id="1427465">==</span>&nbsp;<span class="ident" id="1427468">nil</span>&nbsp;<span class="op" id="1427472">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427477">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427489">if</span>&nbsp;<span class="ident" id="1427492">p</span><span class="op" id="1427493">.</span><span class="ident" id="1427494">rerr</span>&nbsp;<span class="op" id="1427499">!=</span>&nbsp;<span class="ident" id="1427502">nil</span>&nbsp;<span class="op" id="1427506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427511">err</span>&nbsp;<span class="op" id="1427515">=</span>&nbsp;<span class="ident" id="1427517">p</span><span class="op" id="1427518">.</span><span class="ident" id="1427519">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427527">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427539">if</span>&nbsp;<span class="ident" id="1427542">p</span><span class="op" id="1427543">.</span><span class="ident" id="1427544">werr</span>&nbsp;<span class="op" id="1427549">!=</span>&nbsp;<span class="ident" id="1427552">nil</span>&nbsp;<span class="op" id="1427556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427561">err</span>&nbsp;<span class="op" id="1427565">=</span>&nbsp;<span class="ident" id="1427567">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427587">p</span><span class="op" id="1427588">.</span><span class="ident" id="1427589">wwait</span><span class="op" id="1427594">.</span><span class="ident" id="1427595">Wait</span><span class="op" id="1427599">(</span><span class="op" id="1427600">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427606">n</span>&nbsp;<span class="op" id="1427608">=</span>&nbsp;<span class="builtinfunc" id="1427610">len</span><span class="op" id="1427613">(</span><span class="ident" id="1427614">b</span><span class="op" id="1427615">)</span>&nbsp;<span class="op" id="1427617">-</span>&nbsp;<span class="builtinfunc" id="1427619">len</span><span class="op" id="1427622">(</span><span class="ident" id="1427623">p</span><span class="op" id="1427624">.</span><span class="ident" id="1427625">data</span><span class="op" id="1427629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427632">p</span><span class="op" id="1427633">.</span><span class="ident" id="1427634">data</span>&nbsp;<span class="op" id="1427639">=</span>&nbsp;<span class="ident" id="1427641">nil</span>&nbsp;<span class="comment" id="1427645">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427673">return</span><br>
<span class="lineno"></span><span class="op" id="1427680">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1427683">func</span>&nbsp;<span class="op" id="1427688">(</span><span class="ident" id="1427689">p</span>&nbsp;<span class="op" id="1427691">*</span><span class="ident" id="1427692">pipe</span><span class="op" id="1427696">)</span>&nbsp;<span class="ident" id="1427698">rclose</span><span class="op" id="1427704">(</span><span class="ident" id="1427705">err</span>&nbsp;<span class="builtintype" id="1427709">error</span><span class="op" id="1427714">)</span>&nbsp;<span class="op" id="1427716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427719">if</span>&nbsp;<span class="ident" id="1427722">err</span>&nbsp;<span class="op" id="1427726">==</span>&nbsp;<span class="ident" id="1427729">nil</span>&nbsp;<span class="op" id="1427733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427737">err</span>&nbsp;<span class="op" id="1427741">=</span>&nbsp;<span class="ident" id="1427743">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427758">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427761">p</span><span class="op" id="1427762">.</span><span class="ident" id="1427763">l</span><span class="op" id="1427764">.</span><span class="ident" id="1427765">Lock</span><span class="op" id="1427769">(</span><span class="op" id="1427770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427773">defer</span>&nbsp;<span class="ident" id="1427779">p</span><span class="op" id="1427780">.</span><span class="ident" id="1427781">l</span><span class="op" id="1427782">.</span><span class="ident" id="1427783">Unlock</span><span class="op" id="1427789">(</span><span class="op" id="1427790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427793">p</span><span class="op" id="1427794">.</span><span class="ident" id="1427795">rerr</span>&nbsp;<span class="op" id="1427800">=</span>&nbsp;<span class="ident" id="1427802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427807">p</span><span class="op" id="1427808">.</span><span class="ident" id="1427809">rwait</span><span class="op" id="1427814">.</span><span class="ident" id="1427815">Signal</span><span class="op" id="1427821">(</span><span class="op" id="1427822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427825">p</span><span class="op" id="1427826">.</span><span class="ident" id="1427827">wwait</span><span class="op" id="1427832">.</span><span class="ident" id="1427833">Signal</span><span class="op" id="1427839">(</span><span class="op" id="1427840">)</span><br>
<span class="lineno">110</span><span class="op" id="1427842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1427845">func</span>&nbsp;<span class="op" id="1427850">(</span><span class="ident" id="1427851">p</span>&nbsp;<span class="op" id="1427853">*</span><span class="ident" id="1427854">pipe</span><span class="op" id="1427858">)</span>&nbsp;<span class="ident" id="1427860">wclose</span><span class="op" id="1427866">(</span><span class="ident" id="1427867">err</span>&nbsp;<span class="builtintype" id="1427871">error</span><span class="op" id="1427876">)</span>&nbsp;<span class="op" id="1427878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427881">if</span>&nbsp;<span class="ident" id="1427884">err</span>&nbsp;<span class="op" id="1427888">==</span>&nbsp;<span class="ident" id="1427891">nil</span>&nbsp;<span class="op" id="1427895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427899">err</span>&nbsp;<span class="op" id="1427903">=</span>&nbsp;<span class="ident" id="1427905">EOF</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427913">p</span><span class="op" id="1427914">.</span><span class="ident" id="1427915">l</span><span class="op" id="1427916">.</span><span class="ident" id="1427917">Lock</span><span class="op" id="1427921">(</span><span class="op" id="1427922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427925">defer</span>&nbsp;<span class="ident" id="1427931">p</span><span class="op" id="1427932">.</span><span class="ident" id="1427933">l</span><span class="op" id="1427934">.</span><span class="ident" id="1427935">Unlock</span><span class="op" id="1427941">(</span><span class="op" id="1427942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427945">p</span><span class="op" id="1427946">.</span><span class="ident" id="1427947">werr</span>&nbsp;<span class="op" id="1427952">=</span>&nbsp;<span class="ident" id="1427954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427959">p</span><span class="op" id="1427960">.</span><span class="ident" id="1427961">rwait</span><span class="op" id="1427966">.</span><span class="ident" id="1427967">Signal</span><span class="op" id="1427973">(</span><span class="op" id="1427974">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427977">p</span><span class="op" id="1427978">.</span><span class="ident" id="1427979">wwait</span><span class="op" id="1427984">.</span><span class="ident" id="1427985">Signal</span><span class="op" id="1427991">(</span><span class="op" id="1427992">)</span><br>
<span class="lineno"></span><span class="op" id="1427994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427997">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1428041">type</span>&nbsp;<span class="ident" id="1428046">PipeReader</span>&nbsp;<span class="keyword" id="1428057">struct</span>&nbsp;<span class="op" id="1428064">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428067">p</span>&nbsp;<span class="op" id="1428069">*</span><span class="ident" id="1428070">pipe</span><br>
<span class="lineno"></span><span class="op" id="1428075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1428078">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1428126">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1428182">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1428221">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1428280">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1428322">func</span>&nbsp;<span class="op" id="1428327">(</span><span class="ident" id="1428328">r</span>&nbsp;<span class="op" id="1428330">*</span><span class="ident" id="1428331">PipeReader</span><span class="op" id="1428341">)</span>&nbsp;<span class="ident" id="1428343">Read</span><span class="op" id="1428347">(</span><span class="ident" id="1428348">data</span>&nbsp;<span class="op" id="1428353">[</span><span class="op" id="1428354">]</span><span class="builtintype" id="1428355">byte</span><span class="op" id="1428359">)</span>&nbsp;<span class="op" id="1428361">(</span><span class="ident" id="1428362">n</span>&nbsp;<span class="builtintype" id="1428364">int</span><span class="op" id="1428367">,</span>&nbsp;<span class="ident" id="1428369">err</span>&nbsp;<span class="builtintype" id="1428373">error</span><span class="op" id="1428378">)</span>&nbsp;<span class="op" id="1428380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1428383">return</span>&nbsp;<span class="ident" id="1428390">r</span><span class="op" id="1428391">.</span><span class="ident" id="1428392">p</span><span class="op" id="1428393">.</span><span class="ident" id="1428394">read</span><span class="op" id="1428398">(</span><span class="ident" id="1428399">data</span><span class="op" id="1428403">)</span><br>
<span class="lineno">135</span><span class="op" id="1428405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1428408">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1428461">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1428524">func</span>&nbsp;<span class="op" id="1428529">(</span><span class="ident" id="1428530">r</span>&nbsp;<span class="op" id="1428532">*</span><span class="ident" id="1428533">PipeReader</span><span class="op" id="1428543">)</span>&nbsp;<span class="ident" id="1428545">Close</span><span class="op" id="1428550">(</span><span class="op" id="1428551">)</span>&nbsp;<span class="builtintype" id="1428553">error</span>&nbsp;<span class="op" id="1428559">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1428562">return</span>&nbsp;<span class="ident" id="1428569">r</span><span class="op" id="1428570">.</span><span class="ident" id="1428571">CloseWithError</span><span class="op" id="1428585">(</span><span class="ident" id="1428586">nil</span><span class="op" id="1428589">)</span><br>
<span class="lineno"></span><span class="op" id="1428591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1428594">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1428649">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1428709">func</span>&nbsp;<span class="op" id="1428714">(</span><span class="ident" id="1428715">r</span>&nbsp;<span class="op" id="1428717">*</span><span class="ident" id="1428718">PipeReader</span><span class="op" id="1428728">)</span>&nbsp;<span class="ident" id="1428730">CloseWithError</span><span class="op" id="1428744">(</span><span class="ident" id="1428745">err</span>&nbsp;<span class="builtintype" id="1428749">error</span><span class="op" id="1428754">)</span>&nbsp;<span class="builtintype" id="1428756">error</span>&nbsp;<span class="op" id="1428762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428765">r</span><span class="op" id="1428766">.</span><span class="ident" id="1428767">p</span><span class="op" id="1428768">.</span><span class="ident" id="1428769">rclose</span><span class="op" id="1428775">(</span><span class="ident" id="1428776">err</span><span class="op" id="1428779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1428782">return</span>&nbsp;<span class="ident" id="1428789">nil</span><br>
<span class="lineno"></span><span class="op" id="1428793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1428796">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1428841">type</span>&nbsp;<span class="ident" id="1428846">PipeWriter</span>&nbsp;<span class="keyword" id="1428857">struct</span>&nbsp;<span class="op" id="1428864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428867">p</span>&nbsp;<span class="op" id="1428869">*</span><span class="ident" id="1428870">pipe</span><br>
<span class="lineno"></span><span class="op" id="1428875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1428878">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1428928">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1428982">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1429039">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1429095">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1429147">func</span>&nbsp;<span class="op" id="1429152">(</span><span class="ident" id="1429153">w</span>&nbsp;<span class="op" id="1429155">*</span><span class="ident" id="1429156">PipeWriter</span><span class="op" id="1429166">)</span>&nbsp;<span class="ident" id="1429168">Write</span><span class="op" id="1429173">(</span><span class="ident" id="1429174">data</span>&nbsp;<span class="op" id="1429179">[</span><span class="op" id="1429180">]</span><span class="builtintype" id="1429181">byte</span><span class="op" id="1429185">)</span>&nbsp;<span class="op" id="1429187">(</span><span class="ident" id="1429188">n</span>&nbsp;<span class="builtintype" id="1429190">int</span><span class="op" id="1429193">,</span>&nbsp;<span class="ident" id="1429195">err</span>&nbsp;<span class="builtintype" id="1429199">error</span><span class="op" id="1429204">)</span>&nbsp;<span class="op" id="1429206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429209">return</span>&nbsp;<span class="ident" id="1429216">w</span><span class="op" id="1429217">.</span><span class="ident" id="1429218">p</span><span class="op" id="1429219">.</span><span class="ident" id="1429220">write</span><span class="op" id="1429225">(</span><span class="ident" id="1429226">data</span><span class="op" id="1429230">)</span><br>
<span class="lineno"></span><span class="op" id="1429232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1429235">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1429289">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1429344">func</span>&nbsp;<span class="op" id="1429349">(</span><span class="ident" id="1429350">w</span>&nbsp;<span class="op" id="1429352">*</span><span class="ident" id="1429353">PipeWriter</span><span class="op" id="1429363">)</span>&nbsp;<span class="ident" id="1429365">Close</span><span class="op" id="1429370">(</span><span class="op" id="1429371">)</span>&nbsp;<span class="builtintype" id="1429373">error</span>&nbsp;<span class="op" id="1429379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429382">return</span>&nbsp;<span class="ident" id="1429389">w</span><span class="op" id="1429390">.</span><span class="ident" id="1429391">CloseWithError</span><span class="op" id="1429405">(</span><span class="ident" id="1429406">nil</span><span class="op" id="1429409">)</span><br>
<span class="lineno"></span><span class="op" id="1429411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1429414">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1429477">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1429542">func</span>&nbsp;<span class="op" id="1429547">(</span><span class="ident" id="1429548">w</span>&nbsp;<span class="op" id="1429550">*</span><span class="ident" id="1429551">PipeWriter</span><span class="op" id="1429561">)</span>&nbsp;<span class="ident" id="1429563">CloseWithError</span><span class="op" id="1429577">(</span><span class="ident" id="1429578">err</span>&nbsp;<span class="builtintype" id="1429582">error</span><span class="op" id="1429587">)</span>&nbsp;<span class="builtintype" id="1429589">error</span>&nbsp;<span class="op" id="1429595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429598">w</span><span class="op" id="1429599">.</span><span class="ident" id="1429600">p</span><span class="op" id="1429601">.</span><span class="ident" id="1429602">wclose</span><span class="op" id="1429608">(</span><span class="ident" id="1429609">err</span><span class="op" id="1429612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429615">return</span>&nbsp;<span class="ident" id="1429622">nil</span><br>
<span class="lineno">175</span><span class="op" id="1429626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1429629">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1429675">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1429732">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1429769">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1429827">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1429901">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1429974">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1430048">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1430101">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1430153">func</span>&nbsp;<span class="ident" id="1430158">Pipe</span><span class="op" id="1430162">(</span><span class="op" id="1430163">)</span>&nbsp;<span class="op" id="1430165">(</span><span class="op" id="1430166">*</span><span class="ident" id="1430167">PipeReader</span><span class="op" id="1430177">,</span>&nbsp;<span class="op" id="1430179">*</span><span class="ident" id="1430180">PipeWriter</span><span class="op" id="1430190">)</span>&nbsp;<span class="op" id="1430192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430195">p</span>&nbsp;<span class="op" id="1430197">:=</span>&nbsp;<span class="builtinfunc" id="1430200">new</span><span class="op" id="1430203">(</span><span class="ident" id="1430204">pipe</span><span class="op" id="1430208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430211">p</span><span class="op" id="1430212">.</span><span class="ident" id="1430213">rwait</span><span class="op" id="1430218">.</span><span class="ident" id="1430219">L</span>&nbsp;<span class="op" id="1430221">=</span>&nbsp;<span class="op" id="1430223">&amp;</span><span class="ident" id="1430224">p</span><span class="op" id="1430225">.</span><span class="ident" id="1430226">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430229">p</span><span class="op" id="1430230">.</span><span class="ident" id="1430231">wwait</span><span class="op" id="1430236">.</span><span class="ident" id="1430237">L</span>&nbsp;<span class="op" id="1430239">=</span>&nbsp;<span class="op" id="1430241">&amp;</span><span class="ident" id="1430242">p</span><span class="op" id="1430243">.</span><span class="ident" id="1430244">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430247">r</span>&nbsp;<span class="op" id="1430249">:=</span>&nbsp;<span class="op" id="1430252">&amp;</span><span class="ident" id="1430253">PipeReader</span><span class="op" id="1430263">{</span><span class="ident" id="1430264">p</span><span class="op" id="1430265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430268">w</span>&nbsp;<span class="op" id="1430270">:=</span>&nbsp;<span class="op" id="1430273">&amp;</span><span class="ident" id="1430274">PipeWriter</span><span class="op" id="1430284">{</span><span class="ident" id="1430285">p</span><span class="op" id="1430286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1430289">return</span>&nbsp;<span class="ident" id="1430296">r</span><span class="op" id="1430297">,</span>&nbsp;<span class="ident" id="1430299">w</span><br>
<span class="lineno"></span><span class="op" id="1430301">}</span>
</div>
</body>
</html>
