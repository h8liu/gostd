<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8305474">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8305530">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8305584">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8305635">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="8305714">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305723">package</span>&nbsp;<span class="ident" id="8305731">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8305736">import</span>&nbsp;<span class="op" id="8305743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305746">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305759">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305765">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305776">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305787">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8305794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8305797">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="8305867">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="8305935">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="8305957">func</span>&nbsp;<span class="ident" id="8305962">testUnixAddr</span><span class="op" id="8305974">(</span><span class="op" id="8305975">)</span>&nbsp;<span class="builtintype" id="8305977">string</span>&nbsp;<span class="op" id="8305984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305987">f</span><span class="op" id="8305988">,</span>&nbsp;<span class="ident" id="8305990">err</span>&nbsp;<span class="op" id="8305994">:=</span>&nbsp;<span class="ident" id="8305997">ioutil</span><span class="op" id="8306003">.</span><span class="ident" id="8306004">TempFile</span><span class="op" id="8306012">(</span><span class="string" id="8306013">&#34;&#34;</span><span class="op" id="8306015">,</span>&nbsp;<span class="string" id="8306017">&#34;nettest&#34;</span><span class="op" id="8306026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306029">if</span>&nbsp;<span class="ident" id="8306032">err</span>&nbsp;<span class="op" id="8306036">!=</span>&nbsp;<span class="ident" id="8306039">nil</span>&nbsp;<span class="op" id="8306043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8306047">panic</span><span class="op" id="8306052">(</span><span class="ident" id="8306053">err</span><span class="op" id="8306056">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306062">addr</span>&nbsp;<span class="op" id="8306067">:=</span>&nbsp;<span class="ident" id="8306070">f</span><span class="op" id="8306071">.</span><span class="ident" id="8306072">Name</span><span class="op" id="8306076">(</span><span class="op" id="8306077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306080">f</span><span class="op" id="8306081">.</span><span class="ident" id="8306082">Close</span><span class="op" id="8306087">(</span><span class="op" id="8306088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306091">os</span><span class="op" id="8306093">.</span><span class="ident" id="8306094">Remove</span><span class="op" id="8306100">(</span><span class="ident" id="8306101">addr</span><span class="op" id="8306105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306108">return</span>&nbsp;<span class="ident" id="8306115">addr</span><br>
<span class="lineno">30</span><span class="op" id="8306120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8306123">var</span>&nbsp;<span class="ident" id="8306127">condFatalf</span>&nbsp;<span class="op" id="8306138">=</span>&nbsp;<span class="keyword" id="8306140">func</span><span class="op" id="8306144">(</span><span class="op" id="8306145">)</span>&nbsp;<span class="keyword" id="8306147">func</span><span class="op" id="8306151">(</span><span class="op" id="8306152">*</span><span class="ident" id="8306153">testing</span><span class="op" id="8306160">.</span><span class="ident" id="8306161">T</span><span class="op" id="8306162">,</span>&nbsp;<span class="builtintype" id="8306164">string</span><span class="op" id="8306170">,</span>&nbsp;<span class="op" id="8306172">...</span><span class="keyword" id="8306175">interface</span><span class="op" id="8306184">{</span><span class="op" id="8306185">}</span><span class="op" id="8306186">)</span>&nbsp;<span class="op" id="8306188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8306191">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306258">switch</span>&nbsp;<span class="ident" id="8306265">runtime</span><span class="op" id="8306272">.</span><span class="ident" id="8306273">GOOS</span>&nbsp;<span class="op" id="8306278">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306281">case</span>&nbsp;<span class="string" id="8306286">&#34;plan9&#34;</span><span class="op" id="8306293">,</span>&nbsp;<span class="string" id="8306295">&#34;windows&#34;</span><span class="op" id="8306304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306308">return</span>&nbsp;<span class="op" id="8306315">(</span><span class="op" id="8306316">*</span><span class="ident" id="8306317">testing</span><span class="op" id="8306324">.</span><span class="ident" id="8306325">T</span><span class="op" id="8306326">)</span><span class="op" id="8306327">.</span><span class="ident" id="8306328">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306337">return</span>&nbsp;<span class="op" id="8306344">(</span><span class="op" id="8306345">*</span><span class="ident" id="8306346">testing</span><span class="op" id="8306353">.</span><span class="ident" id="8306354">T</span><span class="op" id="8306355">)</span><span class="op" id="8306356">.</span><span class="ident" id="8306357">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="8306364">}</span><span class="op" id="8306365">(</span><span class="op" id="8306366">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8306369">func</span>&nbsp;<span class="ident" id="8306374">TestTCPListenerSpecificMethods</span><span class="op" id="8306404">(</span><span class="ident" id="8306405">t</span>&nbsp;<span class="op" id="8306407">*</span><span class="ident" id="8306408">testing</span><span class="op" id="8306415">.</span><span class="ident" id="8306416">T</span><span class="op" id="8306417">)</span>&nbsp;<span class="op" id="8306419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306422">switch</span>&nbsp;<span class="ident" id="8306429">runtime</span><span class="op" id="8306436">.</span><span class="ident" id="8306437">GOOS</span>&nbsp;<span class="op" id="8306442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306445">case</span>&nbsp;<span class="string" id="8306450">&#34;plan9&#34;</span><span class="op" id="8306457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306461">t</span><span class="op" id="8306462">.</span><span class="ident" id="8306463">Skipf</span><span class="op" id="8306468">(</span><span class="string" id="8306469">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8306490">,</span>&nbsp;<span class="ident" id="8306492">runtime</span><span class="op" id="8306499">.</span><span class="ident" id="8306500">GOOS</span><span class="op" id="8306504">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306511">la</span><span class="op" id="8306513">,</span>&nbsp;<span class="ident" id="8306515">err</span>&nbsp;<span class="op" id="8306519">:=</span>&nbsp;<span class="ident" id="8306522">ResolveTCPAddr</span><span class="op" id="8306536">(</span><span class="string" id="8306537">&#34;tcp4&#34;</span><span class="op" id="8306543">,</span>&nbsp;<span class="string" id="8306545">&#34;127.0.0.1:0&#34;</span><span class="op" id="8306558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306561">if</span>&nbsp;<span class="ident" id="8306564">err</span>&nbsp;<span class="op" id="8306568">!=</span>&nbsp;<span class="ident" id="8306571">nil</span>&nbsp;<span class="op" id="8306575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306579">t</span><span class="op" id="8306580">.</span><span class="ident" id="8306581">Fatalf</span><span class="op" id="8306587">(</span><span class="string" id="8306588">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8306615">,</span>&nbsp;<span class="ident" id="8306617">err</span><span class="op" id="8306620">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306626">ln</span><span class="op" id="8306628">,</span>&nbsp;<span class="ident" id="8306630">err</span>&nbsp;<span class="op" id="8306634">:=</span>&nbsp;<span class="ident" id="8306637">ListenTCP</span><span class="op" id="8306646">(</span><span class="string" id="8306647">&#34;tcp4&#34;</span><span class="op" id="8306653">,</span>&nbsp;<span class="ident" id="8306655">la</span><span class="op" id="8306657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306660">if</span>&nbsp;<span class="ident" id="8306663">err</span>&nbsp;<span class="op" id="8306667">!=</span>&nbsp;<span class="ident" id="8306670">nil</span>&nbsp;<span class="op" id="8306674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306678">t</span><span class="op" id="8306679">.</span><span class="ident" id="8306680">Fatalf</span><span class="op" id="8306686">(</span><span class="string" id="8306687">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8306709">,</span>&nbsp;<span class="ident" id="8306711">err</span><span class="op" id="8306714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306717">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306720">defer</span>&nbsp;<span class="ident" id="8306726">ln</span><span class="op" id="8306728">.</span><span class="ident" id="8306729">Close</span><span class="op" id="8306734">(</span><span class="op" id="8306735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306738">ln</span><span class="op" id="8306740">.</span><span class="ident" id="8306741">Addr</span><span class="op" id="8306745">(</span><span class="op" id="8306746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306749">ln</span><span class="op" id="8306751">.</span><span class="ident" id="8306752">SetDeadline</span><span class="op" id="8306763">(</span><span class="ident" id="8306764">time</span><span class="op" id="8306768">.</span><span class="ident" id="8306769">Now</span><span class="op" id="8306772">(</span><span class="op" id="8306773">)</span><span class="op" id="8306774">.</span><span class="ident" id="8306775">Add</span><span class="op" id="8306778">(</span><span class="num" id="8306779">30</span>&nbsp;<span class="op" id="8306782">*</span>&nbsp;<span class="ident" id="8306784">time</span><span class="op" id="8306788">.</span><span class="ident" id="8306789">Nanosecond</span><span class="op" id="8306799">)</span><span class="op" id="8306800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306804">if</span>&nbsp;<span class="ident" id="8306807">c</span><span class="op" id="8306808">,</span>&nbsp;<span class="ident" id="8306810">err</span>&nbsp;<span class="op" id="8306814">:=</span>&nbsp;<span class="ident" id="8306817">ln</span><span class="op" id="8306819">.</span><span class="ident" id="8306820">Accept</span><span class="op" id="8306826">(</span><span class="op" id="8306827">)</span><span class="op" id="8306828">;</span>&nbsp;<span class="ident" id="8306830">err</span>&nbsp;<span class="op" id="8306834">!=</span>&nbsp;<span class="ident" id="8306837">nil</span>&nbsp;<span class="op" id="8306841">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306845">if</span>&nbsp;<span class="op" id="8306848">!</span><span class="ident" id="8306849">err</span><span class="op" id="8306852">.</span><span class="op" id="8306853">(</span><span class="ident" id="8306854">Error</span><span class="op" id="8306859">)</span><span class="op" id="8306860">.</span><span class="ident" id="8306861">Timeout</span><span class="op" id="8306868">(</span><span class="op" id="8306869">)</span>&nbsp;<span class="op" id="8306871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306876">t</span><span class="op" id="8306877">.</span><span class="ident" id="8306878">Fatalf</span><span class="op" id="8306884">(</span><span class="string" id="8306885">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8306916">,</span>&nbsp;<span class="ident" id="8306918">err</span><span class="op" id="8306921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306928">}</span>&nbsp;<span class="keyword" id="8306930">else</span>&nbsp;<span class="op" id="8306935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306939">c</span><span class="op" id="8306940">.</span><span class="ident" id="8306941">Close</span><span class="op" id="8306946">(</span><span class="op" id="8306947">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306953">if</span>&nbsp;<span class="ident" id="8306956">c</span><span class="op" id="8306957">,</span>&nbsp;<span class="ident" id="8306959">err</span>&nbsp;<span class="op" id="8306963">:=</span>&nbsp;<span class="ident" id="8306966">ln</span><span class="op" id="8306968">.</span><span class="ident" id="8306969">AcceptTCP</span><span class="op" id="8306978">(</span><span class="op" id="8306979">)</span><span class="op" id="8306980">;</span>&nbsp;<span class="ident" id="8306982">err</span>&nbsp;<span class="op" id="8306986">!=</span>&nbsp;<span class="ident" id="8306989">nil</span>&nbsp;<span class="op" id="8306993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306997">if</span>&nbsp;<span class="op" id="8307000">!</span><span class="ident" id="8307001">err</span><span class="op" id="8307004">.</span><span class="op" id="8307005">(</span><span class="ident" id="8307006">Error</span><span class="op" id="8307011">)</span><span class="op" id="8307012">.</span><span class="ident" id="8307013">Timeout</span><span class="op" id="8307020">(</span><span class="op" id="8307021">)</span>&nbsp;<span class="op" id="8307023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307028">t</span><span class="op" id="8307029">.</span><span class="ident" id="8307030">Fatalf</span><span class="op" id="8307036">(</span><span class="string" id="8307037">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307071">,</span>&nbsp;<span class="ident" id="8307073">err</span><span class="op" id="8307076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307080">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307083">}</span>&nbsp;<span class="keyword" id="8307085">else</span>&nbsp;<span class="op" id="8307090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307094">c</span><span class="op" id="8307095">.</span><span class="ident" id="8307096">Close</span><span class="op" id="8307101">(</span><span class="op" id="8307102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307109">if</span>&nbsp;<span class="ident" id="8307112">f</span><span class="op" id="8307113">,</span>&nbsp;<span class="ident" id="8307115">err</span>&nbsp;<span class="op" id="8307119">:=</span>&nbsp;<span class="ident" id="8307122">ln</span><span class="op" id="8307124">.</span><span class="ident" id="8307125">File</span><span class="op" id="8307129">(</span><span class="op" id="8307130">)</span><span class="op" id="8307131">;</span>&nbsp;<span class="ident" id="8307133">err</span>&nbsp;<span class="op" id="8307137">!=</span>&nbsp;<span class="ident" id="8307140">nil</span>&nbsp;<span class="op" id="8307144">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307148">condFatalf</span><span class="op" id="8307158">(</span><span class="ident" id="8307159">t</span><span class="op" id="8307160">,</span>&nbsp;<span class="string" id="8307162">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307191">,</span>&nbsp;<span class="ident" id="8307193">err</span><span class="op" id="8307196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307199">}</span>&nbsp;<span class="keyword" id="8307201">else</span>&nbsp;<span class="op" id="8307206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307210">f</span><span class="op" id="8307211">.</span><span class="ident" id="8307212">Close</span><span class="op" id="8307217">(</span><span class="op" id="8307218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307221">}</span><br>
<span class="lineno"></span><span class="op" id="8307223">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8307226">func</span>&nbsp;<span class="ident" id="8307231">TestTCPConnSpecificMethods</span><span class="op" id="8307257">(</span><span class="ident" id="8307258">t</span>&nbsp;<span class="op" id="8307260">*</span><span class="ident" id="8307261">testing</span><span class="op" id="8307268">.</span><span class="ident" id="8307269">T</span><span class="op" id="8307270">)</span>&nbsp;<span class="op" id="8307272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307275">la</span><span class="op" id="8307277">,</span>&nbsp;<span class="ident" id="8307279">err</span>&nbsp;<span class="op" id="8307283">:=</span>&nbsp;<span class="ident" id="8307286">ResolveTCPAddr</span><span class="op" id="8307300">(</span><span class="string" id="8307301">&#34;tcp4&#34;</span><span class="op" id="8307307">,</span>&nbsp;<span class="string" id="8307309">&#34;127.0.0.1:0&#34;</span><span class="op" id="8307322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307325">if</span>&nbsp;<span class="ident" id="8307328">err</span>&nbsp;<span class="op" id="8307332">!=</span>&nbsp;<span class="ident" id="8307335">nil</span>&nbsp;<span class="op" id="8307339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307343">t</span><span class="op" id="8307344">.</span><span class="ident" id="8307345">Fatalf</span><span class="op" id="8307351">(</span><span class="string" id="8307352">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307379">,</span>&nbsp;<span class="ident" id="8307381">err</span><span class="op" id="8307384">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307390">ln</span><span class="op" id="8307392">,</span>&nbsp;<span class="ident" id="8307394">err</span>&nbsp;<span class="op" id="8307398">:=</span>&nbsp;<span class="ident" id="8307401">ListenTCP</span><span class="op" id="8307410">(</span><span class="string" id="8307411">&#34;tcp4&#34;</span><span class="op" id="8307417">,</span>&nbsp;<span class="ident" id="8307419">la</span><span class="op" id="8307421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307424">if</span>&nbsp;<span class="ident" id="8307427">err</span>&nbsp;<span class="op" id="8307431">!=</span>&nbsp;<span class="ident" id="8307434">nil</span>&nbsp;<span class="op" id="8307438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307442">t</span><span class="op" id="8307443">.</span><span class="ident" id="8307444">Fatalf</span><span class="op" id="8307450">(</span><span class="string" id="8307451">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307473">,</span>&nbsp;<span class="ident" id="8307475">err</span><span class="op" id="8307478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307481">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307484">defer</span>&nbsp;<span class="ident" id="8307490">ln</span><span class="op" id="8307492">.</span><span class="ident" id="8307493">Close</span><span class="op" id="8307498">(</span><span class="op" id="8307499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307502">ln</span><span class="op" id="8307504">.</span><span class="ident" id="8307505">Addr</span><span class="op" id="8307509">(</span><span class="op" id="8307510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307514">done</span>&nbsp;<span class="op" id="8307519">:=</span>&nbsp;<span class="builtinfunc" id="8307522">make</span><span class="op" id="8307526">(</span><span class="keyword" id="8307527">chan</span>&nbsp;<span class="builtintype" id="8307532">int</span><span class="op" id="8307535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307538">go</span>&nbsp;<span class="ident" id="8307541">transponder</span><span class="op" id="8307552">(</span><span class="ident" id="8307553">t</span><span class="op" id="8307554">,</span>&nbsp;<span class="ident" id="8307556">ln</span><span class="op" id="8307558">,</span>&nbsp;<span class="ident" id="8307560">done</span><span class="op" id="8307564">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307568">ra</span><span class="op" id="8307570">,</span>&nbsp;<span class="ident" id="8307572">err</span>&nbsp;<span class="op" id="8307576">:=</span>&nbsp;<span class="ident" id="8307579">ResolveTCPAddr</span><span class="op" id="8307593">(</span><span class="string" id="8307594">&#34;tcp4&#34;</span><span class="op" id="8307600">,</span>&nbsp;<span class="ident" id="8307602">ln</span><span class="op" id="8307604">.</span><span class="ident" id="8307605">Addr</span><span class="op" id="8307609">(</span><span class="op" id="8307610">)</span><span class="op" id="8307611">.</span><span class="ident" id="8307612">String</span><span class="op" id="8307618">(</span><span class="op" id="8307619">)</span><span class="op" id="8307620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307623">if</span>&nbsp;<span class="ident" id="8307626">err</span>&nbsp;<span class="op" id="8307630">!=</span>&nbsp;<span class="ident" id="8307633">nil</span>&nbsp;<span class="op" id="8307637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307641">t</span><span class="op" id="8307642">.</span><span class="ident" id="8307643">Fatalf</span><span class="op" id="8307649">(</span><span class="string" id="8307650">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307677">,</span>&nbsp;<span class="ident" id="8307679">err</span><span class="op" id="8307682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307685">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307688">c</span><span class="op" id="8307689">,</span>&nbsp;<span class="ident" id="8307691">err</span>&nbsp;<span class="op" id="8307695">:=</span>&nbsp;<span class="ident" id="8307698">DialTCP</span><span class="op" id="8307705">(</span><span class="string" id="8307706">&#34;tcp4&#34;</span><span class="op" id="8307712">,</span>&nbsp;<span class="ident" id="8307714">nil</span><span class="op" id="8307717">,</span>&nbsp;<span class="ident" id="8307719">ra</span><span class="op" id="8307721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307724">if</span>&nbsp;<span class="ident" id="8307727">err</span>&nbsp;<span class="op" id="8307731">!=</span>&nbsp;<span class="ident" id="8307734">nil</span>&nbsp;<span class="op" id="8307738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307742">t</span><span class="op" id="8307743">.</span><span class="ident" id="8307744">Fatalf</span><span class="op" id="8307750">(</span><span class="string" id="8307751">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8307771">,</span>&nbsp;<span class="ident" id="8307773">err</span><span class="op" id="8307776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307782">defer</span>&nbsp;<span class="ident" id="8307788">c</span><span class="op" id="8307789">.</span><span class="ident" id="8307790">Close</span><span class="op" id="8307795">(</span><span class="op" id="8307796">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307799">c</span><span class="op" id="8307800">.</span><span class="ident" id="8307801">SetKeepAlive</span><span class="op" id="8307813">(</span><span class="builtintype" id="8307814">false</span><span class="op" id="8307819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307822">c</span><span class="op" id="8307823">.</span><span class="ident" id="8307824">SetKeepAlivePeriod</span><span class="op" id="8307842">(</span><span class="num" id="8307843">3</span>&nbsp;<span class="op" id="8307845">*</span>&nbsp;<span class="ident" id="8307847">time</span><span class="op" id="8307851">.</span><span class="ident" id="8307852">Second</span><span class="op" id="8307858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307861">c</span><span class="op" id="8307862">.</span><span class="ident" id="8307863">SetLinger</span><span class="op" id="8307872">(</span><span class="num" id="8307873">0</span><span class="op" id="8307874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307877">c</span><span class="op" id="8307878">.</span><span class="ident" id="8307879">SetNoDelay</span><span class="op" id="8307889">(</span><span class="builtintype" id="8307890">false</span><span class="op" id="8307895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307898">c</span><span class="op" id="8307899">.</span><span class="ident" id="8307900">LocalAddr</span><span class="op" id="8307909">(</span><span class="op" id="8307910">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307913">c</span><span class="op" id="8307914">.</span><span class="ident" id="8307915">RemoteAddr</span><span class="op" id="8307925">(</span><span class="op" id="8307926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307929">c</span><span class="op" id="8307930">.</span><span class="ident" id="8307931">SetDeadline</span><span class="op" id="8307942">(</span><span class="ident" id="8307943">time</span><span class="op" id="8307947">.</span><span class="ident" id="8307948">Now</span><span class="op" id="8307951">(</span><span class="op" id="8307952">)</span><span class="op" id="8307953">.</span><span class="ident" id="8307954">Add</span><span class="op" id="8307957">(</span><span class="ident" id="8307958">someTimeout</span><span class="op" id="8307969">)</span><span class="op" id="8307970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307973">c</span><span class="op" id="8307974">.</span><span class="ident" id="8307975">SetReadDeadline</span><span class="op" id="8307990">(</span><span class="ident" id="8307991">time</span><span class="op" id="8307995">.</span><span class="ident" id="8307996">Now</span><span class="op" id="8307999">(</span><span class="op" id="8308000">)</span><span class="op" id="8308001">.</span><span class="ident" id="8308002">Add</span><span class="op" id="8308005">(</span><span class="ident" id="8308006">someTimeout</span><span class="op" id="8308017">)</span><span class="op" id="8308018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308021">c</span><span class="op" id="8308022">.</span><span class="ident" id="8308023">SetWriteDeadline</span><span class="op" id="8308039">(</span><span class="ident" id="8308040">time</span><span class="op" id="8308044">.</span><span class="ident" id="8308045">Now</span><span class="op" id="8308048">(</span><span class="op" id="8308049">)</span><span class="op" id="8308050">.</span><span class="ident" id="8308051">Add</span><span class="op" id="8308054">(</span><span class="ident" id="8308055">someTimeout</span><span class="op" id="8308066">)</span><span class="op" id="8308067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308071">if</span>&nbsp;<span class="ident" id="8308074">_</span><span class="op" id="8308075">,</span>&nbsp;<span class="ident" id="8308077">err</span>&nbsp;<span class="op" id="8308081">:=</span>&nbsp;<span class="ident" id="8308084">c</span><span class="op" id="8308085">.</span><span class="ident" id="8308086">Write</span><span class="op" id="8308091">(</span><span class="op" id="8308092">[</span><span class="op" id="8308093">]</span><span class="builtintype" id="8308094">byte</span><span class="op" id="8308098">(</span><span class="string" id="8308099">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="8308113">)</span><span class="op" id="8308114">)</span><span class="op" id="8308115">;</span>&nbsp;<span class="ident" id="8308117">err</span>&nbsp;<span class="op" id="8308121">!=</span>&nbsp;<span class="ident" id="8308124">nil</span>&nbsp;<span class="op" id="8308128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308132">t</span><span class="op" id="8308133">.</span><span class="ident" id="8308134">Fatalf</span><span class="op" id="8308140">(</span><span class="string" id="8308141">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308167">,</span>&nbsp;<span class="ident" id="8308169">err</span><span class="op" id="8308172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308178">rb</span>&nbsp;<span class="op" id="8308181">:=</span>&nbsp;<span class="builtinfunc" id="8308184">make</span><span class="op" id="8308188">(</span><span class="op" id="8308189">[</span><span class="op" id="8308190">]</span><span class="builtintype" id="8308191">byte</span><span class="op" id="8308195">,</span>&nbsp;<span class="num" id="8308197">128</span><span class="op" id="8308200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308203">if</span>&nbsp;<span class="ident" id="8308206">_</span><span class="op" id="8308207">,</span>&nbsp;<span class="ident" id="8308209">err</span>&nbsp;<span class="op" id="8308213">:=</span>&nbsp;<span class="ident" id="8308216">c</span><span class="op" id="8308217">.</span><span class="ident" id="8308218">Read</span><span class="op" id="8308222">(</span><span class="ident" id="8308223">rb</span><span class="op" id="8308225">)</span><span class="op" id="8308226">;</span>&nbsp;<span class="ident" id="8308228">err</span>&nbsp;<span class="op" id="8308232">!=</span>&nbsp;<span class="ident" id="8308235">nil</span>&nbsp;<span class="op" id="8308239">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308243">t</span><span class="op" id="8308244">.</span><span class="ident" id="8308245">Fatalf</span><span class="op" id="8308251">(</span><span class="string" id="8308252">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308277">,</span>&nbsp;<span class="ident" id="8308279">err</span><span class="op" id="8308282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308289">&lt;-</span><span class="ident" id="8308291">done</span><br>
<span class="lineno"></span><span class="op" id="8308296">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8308299">func</span>&nbsp;<span class="ident" id="8308304">TestUDPConnSpecificMethods</span><span class="op" id="8308330">(</span><span class="ident" id="8308331">t</span>&nbsp;<span class="op" id="8308333">*</span><span class="ident" id="8308334">testing</span><span class="op" id="8308341">.</span><span class="ident" id="8308342">T</span><span class="op" id="8308343">)</span>&nbsp;<span class="op" id="8308345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308348">la</span><span class="op" id="8308350">,</span>&nbsp;<span class="ident" id="8308352">err</span>&nbsp;<span class="op" id="8308356">:=</span>&nbsp;<span class="ident" id="8308359">ResolveUDPAddr</span><span class="op" id="8308373">(</span><span class="string" id="8308374">&#34;udp4&#34;</span><span class="op" id="8308380">,</span>&nbsp;<span class="string" id="8308382">&#34;127.0.0.1:0&#34;</span><span class="op" id="8308395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308398">if</span>&nbsp;<span class="ident" id="8308401">err</span>&nbsp;<span class="op" id="8308405">!=</span>&nbsp;<span class="ident" id="8308408">nil</span>&nbsp;<span class="op" id="8308412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308416">t</span><span class="op" id="8308417">.</span><span class="ident" id="8308418">Fatalf</span><span class="op" id="8308424">(</span><span class="string" id="8308425">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308452">,</span>&nbsp;<span class="ident" id="8308454">err</span><span class="op" id="8308457">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308463">c</span><span class="op" id="8308464">,</span>&nbsp;<span class="ident" id="8308466">err</span>&nbsp;<span class="op" id="8308470">:=</span>&nbsp;<span class="ident" id="8308473">ListenUDP</span><span class="op" id="8308482">(</span><span class="string" id="8308483">&#34;udp4&#34;</span><span class="op" id="8308489">,</span>&nbsp;<span class="ident" id="8308491">la</span><span class="op" id="8308493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308496">if</span>&nbsp;<span class="ident" id="8308499">err</span>&nbsp;<span class="op" id="8308503">!=</span>&nbsp;<span class="ident" id="8308506">nil</span>&nbsp;<span class="op" id="8308510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308514">t</span><span class="op" id="8308515">.</span><span class="ident" id="8308516">Fatalf</span><span class="op" id="8308522">(</span><span class="string" id="8308523">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308545">,</span>&nbsp;<span class="ident" id="8308547">err</span><span class="op" id="8308550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308553">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308556">defer</span>&nbsp;<span class="ident" id="8308562">c</span><span class="op" id="8308563">.</span><span class="ident" id="8308564">Close</span><span class="op" id="8308569">(</span><span class="op" id="8308570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308573">c</span><span class="op" id="8308574">.</span><span class="ident" id="8308575">LocalAddr</span><span class="op" id="8308584">(</span><span class="op" id="8308585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308588">c</span><span class="op" id="8308589">.</span><span class="ident" id="8308590">RemoteAddr</span><span class="op" id="8308600">(</span><span class="op" id="8308601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308604">c</span><span class="op" id="8308605">.</span><span class="ident" id="8308606">SetDeadline</span><span class="op" id="8308617">(</span><span class="ident" id="8308618">time</span><span class="op" id="8308622">.</span><span class="ident" id="8308623">Now</span><span class="op" id="8308626">(</span><span class="op" id="8308627">)</span><span class="op" id="8308628">.</span><span class="ident" id="8308629">Add</span><span class="op" id="8308632">(</span><span class="ident" id="8308633">someTimeout</span><span class="op" id="8308644">)</span><span class="op" id="8308645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308648">c</span><span class="op" id="8308649">.</span><span class="ident" id="8308650">SetReadDeadline</span><span class="op" id="8308665">(</span><span class="ident" id="8308666">time</span><span class="op" id="8308670">.</span><span class="ident" id="8308671">Now</span><span class="op" id="8308674">(</span><span class="op" id="8308675">)</span><span class="op" id="8308676">.</span><span class="ident" id="8308677">Add</span><span class="op" id="8308680">(</span><span class="ident" id="8308681">someTimeout</span><span class="op" id="8308692">)</span><span class="op" id="8308693">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308696">c</span><span class="op" id="8308697">.</span><span class="ident" id="8308698">SetWriteDeadline</span><span class="op" id="8308714">(</span><span class="ident" id="8308715">time</span><span class="op" id="8308719">.</span><span class="ident" id="8308720">Now</span><span class="op" id="8308723">(</span><span class="op" id="8308724">)</span><span class="op" id="8308725">.</span><span class="ident" id="8308726">Add</span><span class="op" id="8308729">(</span><span class="ident" id="8308730">someTimeout</span><span class="op" id="8308741">)</span><span class="op" id="8308742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308745">c</span><span class="op" id="8308746">.</span><span class="ident" id="8308747">SetReadBuffer</span><span class="op" id="8308760">(</span><span class="num" id="8308761">2048</span><span class="op" id="8308765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308768">c</span><span class="op" id="8308769">.</span><span class="ident" id="8308770">SetWriteBuffer</span><span class="op" id="8308784">(</span><span class="num" id="8308785">2048</span><span class="op" id="8308789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308793">wb</span>&nbsp;<span class="op" id="8308796">:=</span>&nbsp;<span class="op" id="8308799">[</span><span class="op" id="8308800">]</span><span class="builtintype" id="8308801">byte</span><span class="op" id="8308805">(</span><span class="string" id="8308806">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="8308820">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308823">rb</span>&nbsp;<span class="op" id="8308826">:=</span>&nbsp;<span class="builtinfunc" id="8308829">make</span><span class="op" id="8308833">(</span><span class="op" id="8308834">[</span><span class="op" id="8308835">]</span><span class="builtintype" id="8308836">byte</span><span class="op" id="8308840">,</span>&nbsp;<span class="num" id="8308842">128</span><span class="op" id="8308845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308848">if</span>&nbsp;<span class="ident" id="8308851">_</span><span class="op" id="8308852">,</span>&nbsp;<span class="ident" id="8308854">err</span>&nbsp;<span class="op" id="8308858">:=</span>&nbsp;<span class="ident" id="8308861">c</span><span class="op" id="8308862">.</span><span class="ident" id="8308863">WriteToUDP</span><span class="op" id="8308873">(</span><span class="ident" id="8308874">wb</span><span class="op" id="8308876">,</span>&nbsp;<span class="ident" id="8308878">c</span><span class="op" id="8308879">.</span><span class="ident" id="8308880">LocalAddr</span><span class="op" id="8308889">(</span><span class="op" id="8308890">)</span><span class="op" id="8308891">.</span><span class="op" id="8308892">(</span><span class="op" id="8308893">*</span><span class="ident" id="8308894">UDPAddr</span><span class="op" id="8308901">)</span><span class="op" id="8308902">)</span><span class="op" id="8308903">;</span>&nbsp;<span class="ident" id="8308905">err</span>&nbsp;<span class="op" id="8308909">!=</span>&nbsp;<span class="ident" id="8308912">nil</span>&nbsp;<span class="op" id="8308916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308920">t</span><span class="op" id="8308921">.</span><span class="ident" id="8308922">Fatalf</span><span class="op" id="8308928">(</span><span class="string" id="8308929">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308960">,</span>&nbsp;<span class="ident" id="8308962">err</span><span class="op" id="8308965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308971">if</span>&nbsp;<span class="ident" id="8308974">_</span><span class="op" id="8308975">,</span>&nbsp;<span class="ident" id="8308977">_</span><span class="op" id="8308978">,</span>&nbsp;<span class="ident" id="8308980">err</span>&nbsp;<span class="op" id="8308984">:=</span>&nbsp;<span class="ident" id="8308987">c</span><span class="op" id="8308988">.</span><span class="ident" id="8308989">ReadFromUDP</span><span class="op" id="8309000">(</span><span class="ident" id="8309001">rb</span><span class="op" id="8309003">)</span><span class="op" id="8309004">;</span>&nbsp;<span class="ident" id="8309006">err</span>&nbsp;<span class="op" id="8309010">!=</span>&nbsp;<span class="ident" id="8309013">nil</span>&nbsp;<span class="op" id="8309017">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309021">t</span><span class="op" id="8309022">.</span><span class="ident" id="8309023">Fatalf</span><span class="op" id="8309029">(</span><span class="string" id="8309030">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309062">,</span>&nbsp;<span class="ident" id="8309064">err</span><span class="op" id="8309067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309073">if</span>&nbsp;<span class="ident" id="8309076">_</span><span class="op" id="8309077">,</span>&nbsp;<span class="ident" id="8309079">_</span><span class="op" id="8309080">,</span>&nbsp;<span class="ident" id="8309082">err</span>&nbsp;<span class="op" id="8309086">:=</span>&nbsp;<span class="ident" id="8309089">c</span><span class="op" id="8309090">.</span><span class="ident" id="8309091">WriteMsgUDP</span><span class="op" id="8309102">(</span><span class="ident" id="8309103">wb</span><span class="op" id="8309105">,</span>&nbsp;<span class="ident" id="8309107">nil</span><span class="op" id="8309110">,</span>&nbsp;<span class="ident" id="8309112">c</span><span class="op" id="8309113">.</span><span class="ident" id="8309114">LocalAddr</span><span class="op" id="8309123">(</span><span class="op" id="8309124">)</span><span class="op" id="8309125">.</span><span class="op" id="8309126">(</span><span class="op" id="8309127">*</span><span class="ident" id="8309128">UDPAddr</span><span class="op" id="8309135">)</span><span class="op" id="8309136">)</span><span class="op" id="8309137">;</span>&nbsp;<span class="ident" id="8309139">err</span>&nbsp;<span class="op" id="8309143">!=</span>&nbsp;<span class="ident" id="8309146">nil</span>&nbsp;<span class="op" id="8309150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309154">condFatalf</span><span class="op" id="8309164">(</span><span class="ident" id="8309165">t</span><span class="op" id="8309166">,</span>&nbsp;<span class="string" id="8309168">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309200">,</span>&nbsp;<span class="ident" id="8309202">err</span><span class="op" id="8309205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309208">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309211">if</span>&nbsp;<span class="ident" id="8309214">_</span><span class="op" id="8309215">,</span>&nbsp;<span class="ident" id="8309217">_</span><span class="op" id="8309218">,</span>&nbsp;<span class="ident" id="8309220">_</span><span class="op" id="8309221">,</span>&nbsp;<span class="ident" id="8309223">_</span><span class="op" id="8309224">,</span>&nbsp;<span class="ident" id="8309226">err</span>&nbsp;<span class="op" id="8309230">:=</span>&nbsp;<span class="ident" id="8309233">c</span><span class="op" id="8309234">.</span><span class="ident" id="8309235">ReadMsgUDP</span><span class="op" id="8309245">(</span><span class="ident" id="8309246">rb</span><span class="op" id="8309248">,</span>&nbsp;<span class="ident" id="8309250">nil</span><span class="op" id="8309253">)</span><span class="op" id="8309254">;</span>&nbsp;<span class="ident" id="8309256">err</span>&nbsp;<span class="op" id="8309260">!=</span>&nbsp;<span class="ident" id="8309263">nil</span>&nbsp;<span class="op" id="8309267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309271">condFatalf</span><span class="op" id="8309281">(</span><span class="ident" id="8309282">t</span><span class="op" id="8309283">,</span>&nbsp;<span class="string" id="8309285">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309316">,</span>&nbsp;<span class="ident" id="8309318">err</span><span class="op" id="8309321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309328">if</span>&nbsp;<span class="ident" id="8309331">f</span><span class="op" id="8309332">,</span>&nbsp;<span class="ident" id="8309334">err</span>&nbsp;<span class="op" id="8309338">:=</span>&nbsp;<span class="ident" id="8309341">c</span><span class="op" id="8309342">.</span><span class="ident" id="8309343">File</span><span class="op" id="8309347">(</span><span class="op" id="8309348">)</span><span class="op" id="8309349">;</span>&nbsp;<span class="ident" id="8309351">err</span>&nbsp;<span class="op" id="8309355">!=</span>&nbsp;<span class="ident" id="8309358">nil</span>&nbsp;<span class="op" id="8309362">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309366">condFatalf</span><span class="op" id="8309376">(</span><span class="ident" id="8309377">t</span><span class="op" id="8309378">,</span>&nbsp;<span class="string" id="8309380">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309405">,</span>&nbsp;<span class="ident" id="8309407">err</span><span class="op" id="8309410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309413">}</span>&nbsp;<span class="keyword" id="8309415">else</span>&nbsp;<span class="op" id="8309420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309424">f</span><span class="op" id="8309425">.</span><span class="ident" id="8309426">Close</span><span class="op" id="8309431">(</span><span class="op" id="8309432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309439">defer</span>&nbsp;<span class="keyword" id="8309445">func</span><span class="op" id="8309449">(</span><span class="op" id="8309450">)</span>&nbsp;<span class="op" id="8309452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309456">if</span>&nbsp;<span class="ident" id="8309459">p</span>&nbsp;<span class="op" id="8309461">:=</span>&nbsp;<span class="builtinfunc" id="8309464">recover</span><span class="op" id="8309471">(</span><span class="op" id="8309472">)</span><span class="op" id="8309473">;</span>&nbsp;<span class="ident" id="8309475">p</span>&nbsp;<span class="op" id="8309477">!=</span>&nbsp;<span class="ident" id="8309480">nil</span>&nbsp;<span class="op" id="8309484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309489">t</span><span class="op" id="8309490">.</span><span class="ident" id="8309491">Fatalf</span><span class="op" id="8309497">(</span><span class="string" id="8309498">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8309546">,</span>&nbsp;<span class="ident" id="8309548">p</span><span class="op" id="8309549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309556">}</span><span class="op" id="8309557">(</span><span class="op" id="8309558">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309562">c</span><span class="op" id="8309563">.</span><span class="ident" id="8309564">WriteToUDP</span><span class="op" id="8309574">(</span><span class="ident" id="8309575">wb</span><span class="op" id="8309577">,</span>&nbsp;<span class="ident" id="8309579">nil</span><span class="op" id="8309582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309585">c</span><span class="op" id="8309586">.</span><span class="ident" id="8309587">WriteMsgUDP</span><span class="op" id="8309598">(</span><span class="ident" id="8309599">wb</span><span class="op" id="8309601">,</span>&nbsp;<span class="ident" id="8309603">nil</span><span class="op" id="8309606">,</span>&nbsp;<span class="ident" id="8309608">nil</span><span class="op" id="8309611">)</span><br>
<span class="lineno"></span><span class="op" id="8309613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8309616">func</span>&nbsp;<span class="ident" id="8309621">TestIPConnSpecificMethods</span><span class="op" id="8309646">(</span><span class="ident" id="8309647">t</span>&nbsp;<span class="op" id="8309649">*</span><span class="ident" id="8309650">testing</span><span class="op" id="8309657">.</span><span class="ident" id="8309658">T</span><span class="op" id="8309659">)</span>&nbsp;<span class="op" id="8309661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309664">if</span>&nbsp;<span class="ident" id="8309667">skip</span><span class="op" id="8309671">,</span>&nbsp;<span class="ident" id="8309673">skipmsg</span>&nbsp;<span class="op" id="8309681">:=</span>&nbsp;<span class="ident" id="8309684">skipRawSocketTest</span><span class="op" id="8309701">(</span><span class="ident" id="8309702">t</span><span class="op" id="8309703">)</span><span class="op" id="8309704">;</span>&nbsp;<span class="ident" id="8309706">skip</span>&nbsp;<span class="op" id="8309711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309715">t</span><span class="op" id="8309716">.</span><span class="ident" id="8309717">Skip</span><span class="op" id="8309721">(</span><span class="ident" id="8309722">skipmsg</span><span class="op" id="8309729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309736">la</span><span class="op" id="8309738">,</span>&nbsp;<span class="ident" id="8309740">err</span>&nbsp;<span class="op" id="8309744">:=</span>&nbsp;<span class="ident" id="8309747">ResolveIPAddr</span><span class="op" id="8309760">(</span><span class="string" id="8309761">&#34;ip4&#34;</span><span class="op" id="8309766">,</span>&nbsp;<span class="string" id="8309768">&#34;127.0.0.1&#34;</span><span class="op" id="8309779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309782">if</span>&nbsp;<span class="ident" id="8309785">err</span>&nbsp;<span class="op" id="8309789">!=</span>&nbsp;<span class="ident" id="8309792">nil</span>&nbsp;<span class="op" id="8309796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309800">t</span><span class="op" id="8309801">.</span><span class="ident" id="8309802">Fatalf</span><span class="op" id="8309808">(</span><span class="string" id="8309809">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309835">,</span>&nbsp;<span class="ident" id="8309837">err</span><span class="op" id="8309840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309846">c</span><span class="op" id="8309847">,</span>&nbsp;<span class="ident" id="8309849">err</span>&nbsp;<span class="op" id="8309853">:=</span>&nbsp;<span class="ident" id="8309856">ListenIP</span><span class="op" id="8309864">(</span><span class="string" id="8309865">&#34;ip4:icmp&#34;</span><span class="op" id="8309875">,</span>&nbsp;<span class="ident" id="8309877">la</span><span class="op" id="8309879">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309882">if</span>&nbsp;<span class="ident" id="8309885">err</span>&nbsp;<span class="op" id="8309889">!=</span>&nbsp;<span class="ident" id="8309892">nil</span>&nbsp;<span class="op" id="8309896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309900">t</span><span class="op" id="8309901">.</span><span class="ident" id="8309902">Fatalf</span><span class="op" id="8309908">(</span><span class="string" id="8309909">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309930">,</span>&nbsp;<span class="ident" id="8309932">err</span><span class="op" id="8309935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309941">defer</span>&nbsp;<span class="ident" id="8309947">c</span><span class="op" id="8309948">.</span><span class="ident" id="8309949">Close</span><span class="op" id="8309954">(</span><span class="op" id="8309955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309958">c</span><span class="op" id="8309959">.</span><span class="ident" id="8309960">LocalAddr</span><span class="op" id="8309969">(</span><span class="op" id="8309970">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309973">c</span><span class="op" id="8309974">.</span><span class="ident" id="8309975">RemoteAddr</span><span class="op" id="8309985">(</span><span class="op" id="8309986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309989">c</span><span class="op" id="8309990">.</span><span class="ident" id="8309991">SetDeadline</span><span class="op" id="8310002">(</span><span class="ident" id="8310003">time</span><span class="op" id="8310007">.</span><span class="ident" id="8310008">Now</span><span class="op" id="8310011">(</span><span class="op" id="8310012">)</span><span class="op" id="8310013">.</span><span class="ident" id="8310014">Add</span><span class="op" id="8310017">(</span><span class="ident" id="8310018">someTimeout</span><span class="op" id="8310029">)</span><span class="op" id="8310030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310033">c</span><span class="op" id="8310034">.</span><span class="ident" id="8310035">SetReadDeadline</span><span class="op" id="8310050">(</span><span class="ident" id="8310051">time</span><span class="op" id="8310055">.</span><span class="ident" id="8310056">Now</span><span class="op" id="8310059">(</span><span class="op" id="8310060">)</span><span class="op" id="8310061">.</span><span class="ident" id="8310062">Add</span><span class="op" id="8310065">(</span><span class="ident" id="8310066">someTimeout</span><span class="op" id="8310077">)</span><span class="op" id="8310078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310081">c</span><span class="op" id="8310082">.</span><span class="ident" id="8310083">SetWriteDeadline</span><span class="op" id="8310099">(</span><span class="ident" id="8310100">time</span><span class="op" id="8310104">.</span><span class="ident" id="8310105">Now</span><span class="op" id="8310108">(</span><span class="op" id="8310109">)</span><span class="op" id="8310110">.</span><span class="ident" id="8310111">Add</span><span class="op" id="8310114">(</span><span class="ident" id="8310115">someTimeout</span><span class="op" id="8310126">)</span><span class="op" id="8310127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310130">c</span><span class="op" id="8310131">.</span><span class="ident" id="8310132">SetReadBuffer</span><span class="op" id="8310145">(</span><span class="num" id="8310146">2048</span><span class="op" id="8310150">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310153">c</span><span class="op" id="8310154">.</span><span class="ident" id="8310155">SetWriteBuffer</span><span class="op" id="8310169">(</span><span class="num" id="8310170">2048</span><span class="op" id="8310174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310178">wb</span><span class="op" id="8310180">,</span>&nbsp;<span class="ident" id="8310182">err</span>&nbsp;<span class="op" id="8310186">:=</span>&nbsp;<span class="op" id="8310189">(</span><span class="op" id="8310190">&amp;</span><span class="ident" id="8310191">icmpMessage</span><span class="op" id="8310202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310206">Type</span><span class="op" id="8310210">:</span>&nbsp;<span class="ident" id="8310212">icmpv4EchoRequest</span><span class="op" id="8310229">,</span>&nbsp;<span class="ident" id="8310231">Code</span><span class="op" id="8310235">:</span>&nbsp;<span class="num" id="8310237">0</span><span class="op" id="8310238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310242">Body</span><span class="op" id="8310246">:</span>&nbsp;<span class="op" id="8310248">&amp;</span><span class="ident" id="8310249">icmpEcho</span><span class="op" id="8310257">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310262">ID</span><span class="op" id="8310264">:</span>&nbsp;<span class="ident" id="8310266">os</span><span class="op" id="8310268">.</span><span class="ident" id="8310269">Getpid</span><span class="op" id="8310275">(</span><span class="op" id="8310276">)</span>&nbsp;<span class="op" id="8310278">&amp;</span>&nbsp;<span class="num" id="8310280">0xffff</span><span class="op" id="8310286">,</span>&nbsp;<span class="ident" id="8310288">Seq</span><span class="op" id="8310291">:</span>&nbsp;<span class="num" id="8310293">1</span><span class="op" id="8310294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310299">Data</span><span class="op" id="8310303">:</span>&nbsp;<span class="op" id="8310305">[</span><span class="op" id="8310306">]</span><span class="builtintype" id="8310307">byte</span><span class="op" id="8310311">(</span><span class="string" id="8310312">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="8310326">)</span><span class="op" id="8310327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310331">}</span><span class="op" id="8310332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310335">}</span><span class="op" id="8310336">)</span><span class="op" id="8310337">.</span><span class="ident" id="8310338">Marshal</span><span class="op" id="8310345">(</span><span class="op" id="8310346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310349">if</span>&nbsp;<span class="ident" id="8310352">err</span>&nbsp;<span class="op" id="8310356">!=</span>&nbsp;<span class="ident" id="8310359">nil</span>&nbsp;<span class="op" id="8310363">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310367">t</span><span class="op" id="8310368">.</span><span class="ident" id="8310369">Fatalf</span><span class="op" id="8310375">(</span><span class="string" id="8310376">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310408">,</span>&nbsp;<span class="ident" id="8310410">err</span><span class="op" id="8310413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310419">rb</span>&nbsp;<span class="op" id="8310422">:=</span>&nbsp;<span class="builtinfunc" id="8310425">make</span><span class="op" id="8310429">(</span><span class="op" id="8310430">[</span><span class="op" id="8310431">]</span><span class="builtintype" id="8310432">byte</span><span class="op" id="8310436">,</span>&nbsp;<span class="num" id="8310438">20</span><span class="op" id="8310440">+</span><span class="builtinfunc" id="8310441">len</span><span class="op" id="8310444">(</span><span class="ident" id="8310445">wb</span><span class="op" id="8310447">)</span><span class="op" id="8310448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310451">if</span>&nbsp;<span class="ident" id="8310454">_</span><span class="op" id="8310455">,</span>&nbsp;<span class="ident" id="8310457">err</span>&nbsp;<span class="op" id="8310461">:=</span>&nbsp;<span class="ident" id="8310464">c</span><span class="op" id="8310465">.</span><span class="ident" id="8310466">WriteToIP</span><span class="op" id="8310475">(</span><span class="ident" id="8310476">wb</span><span class="op" id="8310478">,</span>&nbsp;<span class="ident" id="8310480">c</span><span class="op" id="8310481">.</span><span class="ident" id="8310482">LocalAddr</span><span class="op" id="8310491">(</span><span class="op" id="8310492">)</span><span class="op" id="8310493">.</span><span class="op" id="8310494">(</span><span class="op" id="8310495">*</span><span class="ident" id="8310496">IPAddr</span><span class="op" id="8310502">)</span><span class="op" id="8310503">)</span><span class="op" id="8310504">;</span>&nbsp;<span class="ident" id="8310506">err</span>&nbsp;<span class="op" id="8310510">!=</span>&nbsp;<span class="ident" id="8310513">nil</span>&nbsp;<span class="op" id="8310517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310521">t</span><span class="op" id="8310522">.</span><span class="ident" id="8310523">Fatalf</span><span class="op" id="8310529">(</span><span class="string" id="8310530">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310559">,</span>&nbsp;<span class="ident" id="8310561">err</span><span class="op" id="8310564">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310570">if</span>&nbsp;<span class="ident" id="8310573">_</span><span class="op" id="8310574">,</span>&nbsp;<span class="ident" id="8310576">_</span><span class="op" id="8310577">,</span>&nbsp;<span class="ident" id="8310579">err</span>&nbsp;<span class="op" id="8310583">:=</span>&nbsp;<span class="ident" id="8310586">c</span><span class="op" id="8310587">.</span><span class="ident" id="8310588">ReadFromIP</span><span class="op" id="8310598">(</span><span class="ident" id="8310599">rb</span><span class="op" id="8310601">)</span><span class="op" id="8310602">;</span>&nbsp;<span class="ident" id="8310604">err</span>&nbsp;<span class="op" id="8310608">!=</span>&nbsp;<span class="ident" id="8310611">nil</span>&nbsp;<span class="op" id="8310615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310619">t</span><span class="op" id="8310620">.</span><span class="ident" id="8310621">Fatalf</span><span class="op" id="8310627">(</span><span class="string" id="8310628">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310658">,</span>&nbsp;<span class="ident" id="8310660">err</span><span class="op" id="8310663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310669">if</span>&nbsp;<span class="ident" id="8310672">_</span><span class="op" id="8310673">,</span>&nbsp;<span class="ident" id="8310675">_</span><span class="op" id="8310676">,</span>&nbsp;<span class="ident" id="8310678">err</span>&nbsp;<span class="op" id="8310682">:=</span>&nbsp;<span class="ident" id="8310685">c</span><span class="op" id="8310686">.</span><span class="ident" id="8310687">WriteMsgIP</span><span class="op" id="8310697">(</span><span class="ident" id="8310698">wb</span><span class="op" id="8310700">,</span>&nbsp;<span class="ident" id="8310702">nil</span><span class="op" id="8310705">,</span>&nbsp;<span class="ident" id="8310707">c</span><span class="op" id="8310708">.</span><span class="ident" id="8310709">LocalAddr</span><span class="op" id="8310718">(</span><span class="op" id="8310719">)</span><span class="op" id="8310720">.</span><span class="op" id="8310721">(</span><span class="op" id="8310722">*</span><span class="ident" id="8310723">IPAddr</span><span class="op" id="8310729">)</span><span class="op" id="8310730">)</span><span class="op" id="8310731">;</span>&nbsp;<span class="ident" id="8310733">err</span>&nbsp;<span class="op" id="8310737">!=</span>&nbsp;<span class="ident" id="8310740">nil</span>&nbsp;<span class="op" id="8310744">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310748">condFatalf</span><span class="op" id="8310758">(</span><span class="ident" id="8310759">t</span><span class="op" id="8310760">,</span>&nbsp;<span class="string" id="8310762">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310792">,</span>&nbsp;<span class="ident" id="8310794">err</span><span class="op" id="8310797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310803">if</span>&nbsp;<span class="ident" id="8310806">_</span><span class="op" id="8310807">,</span>&nbsp;<span class="ident" id="8310809">_</span><span class="op" id="8310810">,</span>&nbsp;<span class="ident" id="8310812">_</span><span class="op" id="8310813">,</span>&nbsp;<span class="ident" id="8310815">_</span><span class="op" id="8310816">,</span>&nbsp;<span class="ident" id="8310818">err</span>&nbsp;<span class="op" id="8310822">:=</span>&nbsp;<span class="ident" id="8310825">c</span><span class="op" id="8310826">.</span><span class="ident" id="8310827">ReadMsgIP</span><span class="op" id="8310836">(</span><span class="ident" id="8310837">rb</span><span class="op" id="8310839">,</span>&nbsp;<span class="ident" id="8310841">nil</span><span class="op" id="8310844">)</span><span class="op" id="8310845">;</span>&nbsp;<span class="ident" id="8310847">err</span>&nbsp;<span class="op" id="8310851">!=</span>&nbsp;<span class="ident" id="8310854">nil</span>&nbsp;<span class="op" id="8310858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310862">condFatalf</span><span class="op" id="8310872">(</span><span class="ident" id="8310873">t</span><span class="op" id="8310874">,</span>&nbsp;<span class="string" id="8310876">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310905">,</span>&nbsp;<span class="ident" id="8310907">err</span><span class="op" id="8310910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310913">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310917">if</span>&nbsp;<span class="ident" id="8310920">f</span><span class="op" id="8310921">,</span>&nbsp;<span class="ident" id="8310923">err</span>&nbsp;<span class="op" id="8310927">:=</span>&nbsp;<span class="ident" id="8310930">c</span><span class="op" id="8310931">.</span><span class="ident" id="8310932">File</span><span class="op" id="8310936">(</span><span class="op" id="8310937">)</span><span class="op" id="8310938">;</span>&nbsp;<span class="ident" id="8310940">err</span>&nbsp;<span class="op" id="8310944">!=</span>&nbsp;<span class="ident" id="8310947">nil</span>&nbsp;<span class="op" id="8310951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310955">condFatalf</span><span class="op" id="8310965">(</span><span class="ident" id="8310966">t</span><span class="op" id="8310967">,</span>&nbsp;<span class="string" id="8310969">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310993">,</span>&nbsp;<span class="ident" id="8310995">err</span><span class="op" id="8310998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311001">}</span>&nbsp;<span class="keyword" id="8311003">else</span>&nbsp;<span class="op" id="8311008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311012">f</span><span class="op" id="8311013">.</span><span class="ident" id="8311014">Close</span><span class="op" id="8311019">(</span><span class="op" id="8311020">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311027">defer</span>&nbsp;<span class="keyword" id="8311033">func</span><span class="op" id="8311037">(</span><span class="op" id="8311038">)</span>&nbsp;<span class="op" id="8311040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311044">if</span>&nbsp;<span class="ident" id="8311047">p</span>&nbsp;<span class="op" id="8311049">:=</span>&nbsp;<span class="builtinfunc" id="8311052">recover</span><span class="op" id="8311059">(</span><span class="op" id="8311060">)</span><span class="op" id="8311061">;</span>&nbsp;<span class="ident" id="8311063">p</span>&nbsp;<span class="op" id="8311065">!=</span>&nbsp;<span class="ident" id="8311068">nil</span>&nbsp;<span class="op" id="8311072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311077">t</span><span class="op" id="8311078">.</span><span class="ident" id="8311079">Fatalf</span><span class="op" id="8311085">(</span><span class="string" id="8311086">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8311131">,</span>&nbsp;<span class="ident" id="8311133">p</span><span class="op" id="8311134">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311141">}</span><span class="op" id="8311142">(</span><span class="op" id="8311143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311147">c</span><span class="op" id="8311148">.</span><span class="ident" id="8311149">WriteToIP</span><span class="op" id="8311158">(</span><span class="ident" id="8311159">wb</span><span class="op" id="8311161">,</span>&nbsp;<span class="ident" id="8311163">nil</span><span class="op" id="8311166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311169">c</span><span class="op" id="8311170">.</span><span class="ident" id="8311171">WriteMsgIP</span><span class="op" id="8311181">(</span><span class="ident" id="8311182">wb</span><span class="op" id="8311184">,</span>&nbsp;<span class="ident" id="8311186">nil</span><span class="op" id="8311189">,</span>&nbsp;<span class="ident" id="8311191">nil</span><span class="op" id="8311194">)</span><br>
<span class="lineno">235</span><span class="op" id="8311196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8311199">func</span>&nbsp;<span class="ident" id="8311204">TestUnixListenerSpecificMethods</span><span class="op" id="8311235">(</span><span class="ident" id="8311236">t</span>&nbsp;<span class="op" id="8311238">*</span><span class="ident" id="8311239">testing</span><span class="op" id="8311246">.</span><span class="ident" id="8311247">T</span><span class="op" id="8311248">)</span>&nbsp;<span class="op" id="8311250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311253">switch</span>&nbsp;<span class="ident" id="8311260">runtime</span><span class="op" id="8311267">.</span><span class="ident" id="8311268">GOOS</span>&nbsp;<span class="op" id="8311273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311276">case</span>&nbsp;<span class="string" id="8311281">&#34;nacl&#34;</span><span class="op" id="8311287">,</span>&nbsp;<span class="string" id="8311289">&#34;plan9&#34;</span><span class="op" id="8311296">,</span>&nbsp;<span class="string" id="8311298">&#34;windows&#34;</span><span class="op" id="8311307">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311311">t</span><span class="op" id="8311312">.</span><span class="ident" id="8311313">Skipf</span><span class="op" id="8311318">(</span><span class="string" id="8311319">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8311340">,</span>&nbsp;<span class="ident" id="8311342">runtime</span><span class="op" id="8311349">.</span><span class="ident" id="8311350">GOOS</span><span class="op" id="8311354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311361">addr</span>&nbsp;<span class="op" id="8311366">:=</span>&nbsp;<span class="ident" id="8311369">testUnixAddr</span><span class="op" id="8311381">(</span><span class="op" id="8311382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311385">la</span><span class="op" id="8311387">,</span>&nbsp;<span class="ident" id="8311389">err</span>&nbsp;<span class="op" id="8311393">:=</span>&nbsp;<span class="ident" id="8311396">ResolveUnixAddr</span><span class="op" id="8311411">(</span><span class="string" id="8311412">&#34;unix&#34;</span><span class="op" id="8311418">,</span>&nbsp;<span class="ident" id="8311420">addr</span><span class="op" id="8311424">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311427">if</span>&nbsp;<span class="ident" id="8311430">err</span>&nbsp;<span class="op" id="8311434">!=</span>&nbsp;<span class="ident" id="8311437">nil</span>&nbsp;<span class="op" id="8311441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311445">t</span><span class="op" id="8311446">.</span><span class="ident" id="8311447">Fatalf</span><span class="op" id="8311453">(</span><span class="string" id="8311454">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8311482">,</span>&nbsp;<span class="ident" id="8311484">err</span><span class="op" id="8311487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311493">ln</span><span class="op" id="8311495">,</span>&nbsp;<span class="ident" id="8311497">err</span>&nbsp;<span class="op" id="8311501">:=</span>&nbsp;<span class="ident" id="8311504">ListenUnix</span><span class="op" id="8311514">(</span><span class="string" id="8311515">&#34;unix&#34;</span><span class="op" id="8311521">,</span>&nbsp;<span class="ident" id="8311523">la</span><span class="op" id="8311525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311528">if</span>&nbsp;<span class="ident" id="8311531">err</span>&nbsp;<span class="op" id="8311535">!=</span>&nbsp;<span class="ident" id="8311538">nil</span>&nbsp;<span class="op" id="8311542">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311546">t</span><span class="op" id="8311547">.</span><span class="ident" id="8311548">Fatalf</span><span class="op" id="8311554">(</span><span class="string" id="8311555">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8311578">,</span>&nbsp;<span class="ident" id="8311580">err</span><span class="op" id="8311583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311589">defer</span>&nbsp;<span class="ident" id="8311595">ln</span><span class="op" id="8311597">.</span><span class="ident" id="8311598">Close</span><span class="op" id="8311603">(</span><span class="op" id="8311604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311607">defer</span>&nbsp;<span class="ident" id="8311613">os</span><span class="op" id="8311615">.</span><span class="ident" id="8311616">Remove</span><span class="op" id="8311622">(</span><span class="ident" id="8311623">addr</span><span class="op" id="8311627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311630">ln</span><span class="op" id="8311632">.</span><span class="ident" id="8311633">Addr</span><span class="op" id="8311637">(</span><span class="op" id="8311638">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311641">ln</span><span class="op" id="8311643">.</span><span class="ident" id="8311644">SetDeadline</span><span class="op" id="8311655">(</span><span class="ident" id="8311656">time</span><span class="op" id="8311660">.</span><span class="ident" id="8311661">Now</span><span class="op" id="8311664">(</span><span class="op" id="8311665">)</span><span class="op" id="8311666">.</span><span class="ident" id="8311667">Add</span><span class="op" id="8311670">(</span><span class="num" id="8311671">30</span>&nbsp;<span class="op" id="8311674">*</span>&nbsp;<span class="ident" id="8311676">time</span><span class="op" id="8311680">.</span><span class="ident" id="8311681">Nanosecond</span><span class="op" id="8311691">)</span><span class="op" id="8311692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311696">if</span>&nbsp;<span class="ident" id="8311699">c</span><span class="op" id="8311700">,</span>&nbsp;<span class="ident" id="8311702">err</span>&nbsp;<span class="op" id="8311706">:=</span>&nbsp;<span class="ident" id="8311709">ln</span><span class="op" id="8311711">.</span><span class="ident" id="8311712">Accept</span><span class="op" id="8311718">(</span><span class="op" id="8311719">)</span><span class="op" id="8311720">;</span>&nbsp;<span class="ident" id="8311722">err</span>&nbsp;<span class="op" id="8311726">!=</span>&nbsp;<span class="ident" id="8311729">nil</span>&nbsp;<span class="op" id="8311733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311737">if</span>&nbsp;<span class="op" id="8311740">!</span><span class="ident" id="8311741">err</span><span class="op" id="8311744">.</span><span class="op" id="8311745">(</span><span class="ident" id="8311746">Error</span><span class="op" id="8311751">)</span><span class="op" id="8311752">.</span><span class="ident" id="8311753">Timeout</span><span class="op" id="8311760">(</span><span class="op" id="8311761">)</span>&nbsp;<span class="op" id="8311763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311768">t</span><span class="op" id="8311769">.</span><span class="ident" id="8311770">Fatalf</span><span class="op" id="8311776">(</span><span class="string" id="8311777">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8311809">,</span>&nbsp;<span class="ident" id="8311811">err</span><span class="op" id="8311814">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311821">}</span>&nbsp;<span class="keyword" id="8311823">else</span>&nbsp;<span class="op" id="8311828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311832">c</span><span class="op" id="8311833">.</span><span class="ident" id="8311834">Close</span><span class="op" id="8311839">(</span><span class="op" id="8311840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311846">if</span>&nbsp;<span class="ident" id="8311849">c</span><span class="op" id="8311850">,</span>&nbsp;<span class="ident" id="8311852">err</span>&nbsp;<span class="op" id="8311856">:=</span>&nbsp;<span class="ident" id="8311859">ln</span><span class="op" id="8311861">.</span><span class="ident" id="8311862">AcceptUnix</span><span class="op" id="8311872">(</span><span class="op" id="8311873">)</span><span class="op" id="8311874">;</span>&nbsp;<span class="ident" id="8311876">err</span>&nbsp;<span class="op" id="8311880">!=</span>&nbsp;<span class="ident" id="8311883">nil</span>&nbsp;<span class="op" id="8311887">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311891">if</span>&nbsp;<span class="op" id="8311894">!</span><span class="ident" id="8311895">err</span><span class="op" id="8311898">.</span><span class="op" id="8311899">(</span><span class="ident" id="8311900">Error</span><span class="op" id="8311905">)</span><span class="op" id="8311906">.</span><span class="ident" id="8311907">Timeout</span><span class="op" id="8311914">(</span><span class="op" id="8311915">)</span>&nbsp;<span class="op" id="8311917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311922">t</span><span class="op" id="8311923">.</span><span class="ident" id="8311924">Fatalf</span><span class="op" id="8311930">(</span><span class="string" id="8311931">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8311967">,</span>&nbsp;<span class="ident" id="8311969">err</span><span class="op" id="8311972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311979">}</span>&nbsp;<span class="keyword" id="8311981">else</span>&nbsp;<span class="op" id="8311986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311990">c</span><span class="op" id="8311991">.</span><span class="ident" id="8311992">Close</span><span class="op" id="8311997">(</span><span class="op" id="8311998">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312005">if</span>&nbsp;<span class="ident" id="8312008">f</span><span class="op" id="8312009">,</span>&nbsp;<span class="ident" id="8312011">err</span>&nbsp;<span class="op" id="8312015">:=</span>&nbsp;<span class="ident" id="8312018">ln</span><span class="op" id="8312020">.</span><span class="ident" id="8312021">File</span><span class="op" id="8312025">(</span><span class="op" id="8312026">)</span><span class="op" id="8312027">;</span>&nbsp;<span class="ident" id="8312029">err</span>&nbsp;<span class="op" id="8312033">!=</span>&nbsp;<span class="ident" id="8312036">nil</span>&nbsp;<span class="op" id="8312040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312044">t</span><span class="op" id="8312045">.</span><span class="ident" id="8312046">Fatalf</span><span class="op" id="8312052">(</span><span class="string" id="8312053">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8312083">,</span>&nbsp;<span class="ident" id="8312085">err</span><span class="op" id="8312088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312091">}</span>&nbsp;<span class="keyword" id="8312093">else</span>&nbsp;<span class="op" id="8312098">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312102">f</span><span class="op" id="8312103">.</span><span class="ident" id="8312104">Close</span><span class="op" id="8312109">(</span><span class="op" id="8312110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312113">}</span><br>
<span class="lineno"></span><span class="op" id="8312115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8312118">func</span>&nbsp;<span class="ident" id="8312123">TestUnixConnSpecificMethods</span><span class="op" id="8312150">(</span><span class="ident" id="8312151">t</span>&nbsp;<span class="op" id="8312153">*</span><span class="ident" id="8312154">testing</span><span class="op" id="8312161">.</span><span class="ident" id="8312162">T</span><span class="op" id="8312163">)</span>&nbsp;<span class="op" id="8312165">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312168">switch</span>&nbsp;<span class="ident" id="8312175">runtime</span><span class="op" id="8312182">.</span><span class="ident" id="8312183">GOOS</span>&nbsp;<span class="op" id="8312188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312191">case</span>&nbsp;<span class="string" id="8312196">&#34;nacl&#34;</span><span class="op" id="8312202">,</span>&nbsp;<span class="string" id="8312204">&#34;plan9&#34;</span><span class="op" id="8312211">,</span>&nbsp;<span class="string" id="8312213">&#34;windows&#34;</span><span class="op" id="8312222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312226">t</span><span class="op" id="8312227">.</span><span class="ident" id="8312228">Skipf</span><span class="op" id="8312233">(</span><span class="string" id="8312234">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8312255">,</span>&nbsp;<span class="ident" id="8312257">runtime</span><span class="op" id="8312264">.</span><span class="ident" id="8312265">GOOS</span><span class="op" id="8312269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312276">addr1</span><span class="op" id="8312281">,</span>&nbsp;<span class="ident" id="8312283">addr2</span><span class="op" id="8312288">,</span>&nbsp;<span class="ident" id="8312290">addr3</span>&nbsp;<span class="op" id="8312296">:=</span>&nbsp;<span class="ident" id="8312299">testUnixAddr</span><span class="op" id="8312311">(</span><span class="op" id="8312312">)</span><span class="op" id="8312313">,</span>&nbsp;<span class="ident" id="8312315">testUnixAddr</span><span class="op" id="8312327">(</span><span class="op" id="8312328">)</span><span class="op" id="8312329">,</span>&nbsp;<span class="ident" id="8312331">testUnixAddr</span><span class="op" id="8312343">(</span><span class="op" id="8312344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312348">a1</span><span class="op" id="8312350">,</span>&nbsp;<span class="ident" id="8312352">err</span>&nbsp;<span class="op" id="8312356">:=</span>&nbsp;<span class="ident" id="8312359">ResolveUnixAddr</span><span class="op" id="8312374">(</span><span class="string" id="8312375">&#34;unixgram&#34;</span><span class="op" id="8312385">,</span>&nbsp;<span class="ident" id="8312387">addr1</span><span class="op" id="8312392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312395">if</span>&nbsp;<span class="ident" id="8312398">err</span>&nbsp;<span class="op" id="8312402">!=</span>&nbsp;<span class="ident" id="8312405">nil</span>&nbsp;<span class="op" id="8312409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312413">t</span><span class="op" id="8312414">.</span><span class="ident" id="8312415">Fatalf</span><span class="op" id="8312421">(</span><span class="string" id="8312422">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8312450">,</span>&nbsp;<span class="ident" id="8312452">err</span><span class="op" id="8312455">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312461">c1</span><span class="op" id="8312463">,</span>&nbsp;<span class="ident" id="8312465">err</span>&nbsp;<span class="op" id="8312469">:=</span>&nbsp;<span class="ident" id="8312472">DialUnix</span><span class="op" id="8312480">(</span><span class="string" id="8312481">&#34;unixgram&#34;</span><span class="op" id="8312491">,</span>&nbsp;<span class="ident" id="8312493">a1</span><span class="op" id="8312495">,</span>&nbsp;<span class="ident" id="8312497">nil</span><span class="op" id="8312500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312503">if</span>&nbsp;<span class="ident" id="8312506">err</span>&nbsp;<span class="op" id="8312510">!=</span>&nbsp;<span class="ident" id="8312513">nil</span>&nbsp;<span class="op" id="8312517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312521">t</span><span class="op" id="8312522">.</span><span class="ident" id="8312523">Fatalf</span><span class="op" id="8312529">(</span><span class="string" id="8312530">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8312551">,</span>&nbsp;<span class="ident" id="8312553">err</span><span class="op" id="8312556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312559">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312562">defer</span>&nbsp;<span class="ident" id="8312568">c1</span><span class="op" id="8312570">.</span><span class="ident" id="8312571">Close</span><span class="op" id="8312576">(</span><span class="op" id="8312577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312580">defer</span>&nbsp;<span class="ident" id="8312586">os</span><span class="op" id="8312588">.</span><span class="ident" id="8312589">Remove</span><span class="op" id="8312595">(</span><span class="ident" id="8312596">addr1</span><span class="op" id="8312601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312604">c1</span><span class="op" id="8312606">.</span><span class="ident" id="8312607">LocalAddr</span><span class="op" id="8312616">(</span><span class="op" id="8312617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312620">c1</span><span class="op" id="8312622">.</span><span class="ident" id="8312623">RemoteAddr</span><span class="op" id="8312633">(</span><span class="op" id="8312634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312637">c1</span><span class="op" id="8312639">.</span><span class="ident" id="8312640">SetDeadline</span><span class="op" id="8312651">(</span><span class="ident" id="8312652">time</span><span class="op" id="8312656">.</span><span class="ident" id="8312657">Now</span><span class="op" id="8312660">(</span><span class="op" id="8312661">)</span><span class="op" id="8312662">.</span><span class="ident" id="8312663">Add</span><span class="op" id="8312666">(</span><span class="ident" id="8312667">someTimeout</span><span class="op" id="8312678">)</span><span class="op" id="8312679">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312682">c1</span><span class="op" id="8312684">.</span><span class="ident" id="8312685">SetReadDeadline</span><span class="op" id="8312700">(</span><span class="ident" id="8312701">time</span><span class="op" id="8312705">.</span><span class="ident" id="8312706">Now</span><span class="op" id="8312709">(</span><span class="op" id="8312710">)</span><span class="op" id="8312711">.</span><span class="ident" id="8312712">Add</span><span class="op" id="8312715">(</span><span class="ident" id="8312716">someTimeout</span><span class="op" id="8312727">)</span><span class="op" id="8312728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312731">c1</span><span class="op" id="8312733">.</span><span class="ident" id="8312734">SetWriteDeadline</span><span class="op" id="8312750">(</span><span class="ident" id="8312751">time</span><span class="op" id="8312755">.</span><span class="ident" id="8312756">Now</span><span class="op" id="8312759">(</span><span class="op" id="8312760">)</span><span class="op" id="8312761">.</span><span class="ident" id="8312762">Add</span><span class="op" id="8312765">(</span><span class="ident" id="8312766">someTimeout</span><span class="op" id="8312777">)</span><span class="op" id="8312778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312781">c1</span><span class="op" id="8312783">.</span><span class="ident" id="8312784">SetReadBuffer</span><span class="op" id="8312797">(</span><span class="num" id="8312798">2048</span><span class="op" id="8312802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312805">c1</span><span class="op" id="8312807">.</span><span class="ident" id="8312808">SetWriteBuffer</span><span class="op" id="8312822">(</span><span class="num" id="8312823">2048</span><span class="op" id="8312827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312831">a2</span><span class="op" id="8312833">,</span>&nbsp;<span class="ident" id="8312835">err</span>&nbsp;<span class="op" id="8312839">:=</span>&nbsp;<span class="ident" id="8312842">ResolveUnixAddr</span><span class="op" id="8312857">(</span><span class="string" id="8312858">&#34;unixgram&#34;</span><span class="op" id="8312868">,</span>&nbsp;<span class="ident" id="8312870">addr2</span><span class="op" id="8312875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312878">if</span>&nbsp;<span class="ident" id="8312881">err</span>&nbsp;<span class="op" id="8312885">!=</span>&nbsp;<span class="ident" id="8312888">nil</span>&nbsp;<span class="op" id="8312892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312896">t</span><span class="op" id="8312897">.</span><span class="ident" id="8312898">Fatalf</span><span class="op" id="8312904">(</span><span class="string" id="8312905">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8312933">,</span>&nbsp;<span class="ident" id="8312935">err</span><span class="op" id="8312938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8312941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8312944">c2</span><span class="op" id="8312946">,</span>&nbsp;<span class="ident" id="8312948">err</span>&nbsp;<span class="op" id="8312952">:=</span>&nbsp;<span class="ident" id="8312955">DialUnix</span><span class="op" id="8312963">(</span><span class="string" id="8312964">&#34;unixgram&#34;</span><span class="op" id="8312974">,</span>&nbsp;<span class="ident" id="8312976">a2</span><span class="op" id="8312978">,</span>&nbsp;<span class="ident" id="8312980">nil</span><span class="op" id="8312983">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8312986">if</span>&nbsp;<span class="ident" id="8312989">err</span>&nbsp;<span class="op" id="8312993">!=</span>&nbsp;<span class="ident" id="8312996">nil</span>&nbsp;<span class="op" id="8313000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313004">t</span><span class="op" id="8313005">.</span><span class="ident" id="8313006">Fatalf</span><span class="op" id="8313012">(</span><span class="string" id="8313013">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8313034">,</span>&nbsp;<span class="ident" id="8313036">err</span><span class="op" id="8313039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8313042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313045">defer</span>&nbsp;<span class="ident" id="8313051">c2</span><span class="op" id="8313053">.</span><span class="ident" id="8313054">Close</span><span class="op" id="8313059">(</span><span class="op" id="8313060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313063">defer</span>&nbsp;<span class="ident" id="8313069">os</span><span class="op" id="8313071">.</span><span class="ident" id="8313072">Remove</span><span class="op" id="8313078">(</span><span class="ident" id="8313079">addr2</span><span class="op" id="8313084">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313087">c2</span><span class="op" id="8313089">.</span><span class="ident" id="8313090">LocalAddr</span><span class="op" id="8313099">(</span><span class="op" id="8313100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313103">c2</span><span class="op" id="8313105">.</span><span class="ident" id="8313106">RemoteAddr</span><span class="op" id="8313116">(</span><span class="op" id="8313117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313120">c2</span><span class="op" id="8313122">.</span><span class="ident" id="8313123">SetDeadline</span><span class="op" id="8313134">(</span><span class="ident" id="8313135">time</span><span class="op" id="8313139">.</span><span class="ident" id="8313140">Now</span><span class="op" id="8313143">(</span><span class="op" id="8313144">)</span><span class="op" id="8313145">.</span><span class="ident" id="8313146">Add</span><span class="op" id="8313149">(</span><span class="ident" id="8313150">someTimeout</span><span class="op" id="8313161">)</span><span class="op" id="8313162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313165">c2</span><span class="op" id="8313167">.</span><span class="ident" id="8313168">SetReadDeadline</span><span class="op" id="8313183">(</span><span class="ident" id="8313184">time</span><span class="op" id="8313188">.</span><span class="ident" id="8313189">Now</span><span class="op" id="8313192">(</span><span class="op" id="8313193">)</span><span class="op" id="8313194">.</span><span class="ident" id="8313195">Add</span><span class="op" id="8313198">(</span><span class="ident" id="8313199">someTimeout</span><span class="op" id="8313210">)</span><span class="op" id="8313211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313214">c2</span><span class="op" id="8313216">.</span><span class="ident" id="8313217">SetWriteDeadline</span><span class="op" id="8313233">(</span><span class="ident" id="8313234">time</span><span class="op" id="8313238">.</span><span class="ident" id="8313239">Now</span><span class="op" id="8313242">(</span><span class="op" id="8313243">)</span><span class="op" id="8313244">.</span><span class="ident" id="8313245">Add</span><span class="op" id="8313248">(</span><span class="ident" id="8313249">someTimeout</span><span class="op" id="8313260">)</span><span class="op" id="8313261">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313264">c2</span><span class="op" id="8313266">.</span><span class="ident" id="8313267">SetReadBuffer</span><span class="op" id="8313280">(</span><span class="num" id="8313281">2048</span><span class="op" id="8313285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313288">c2</span><span class="op" id="8313290">.</span><span class="ident" id="8313291">SetWriteBuffer</span><span class="op" id="8313305">(</span><span class="num" id="8313306">2048</span><span class="op" id="8313310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313314">a3</span><span class="op" id="8313316">,</span>&nbsp;<span class="ident" id="8313318">err</span>&nbsp;<span class="op" id="8313322">:=</span>&nbsp;<span class="ident" id="8313325">ResolveUnixAddr</span><span class="op" id="8313340">(</span><span class="string" id="8313341">&#34;unixgram&#34;</span><span class="op" id="8313351">,</span>&nbsp;<span class="ident" id="8313353">addr3</span><span class="op" id="8313358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313361">if</span>&nbsp;<span class="ident" id="8313364">err</span>&nbsp;<span class="op" id="8313368">!=</span>&nbsp;<span class="ident" id="8313371">nil</span>&nbsp;<span class="op" id="8313375">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313379">t</span><span class="op" id="8313380">.</span><span class="ident" id="8313381">Fatalf</span><span class="op" id="8313387">(</span><span class="string" id="8313388">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8313416">,</span>&nbsp;<span class="ident" id="8313418">err</span><span class="op" id="8313421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8313424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313427">c3</span><span class="op" id="8313429">,</span>&nbsp;<span class="ident" id="8313431">err</span>&nbsp;<span class="op" id="8313435">:=</span>&nbsp;<span class="ident" id="8313438">ListenUnixgram</span><span class="op" id="8313452">(</span><span class="string" id="8313453">&#34;unixgram&#34;</span><span class="op" id="8313463">,</span>&nbsp;<span class="ident" id="8313465">a3</span><span class="op" id="8313467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313470">if</span>&nbsp;<span class="ident" id="8313473">err</span>&nbsp;<span class="op" id="8313477">!=</span>&nbsp;<span class="ident" id="8313480">nil</span>&nbsp;<span class="op" id="8313484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313488">t</span><span class="op" id="8313489">.</span><span class="ident" id="8313490">Fatalf</span><span class="op" id="8313496">(</span><span class="string" id="8313497">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8313524">,</span>&nbsp;<span class="ident" id="8313526">err</span><span class="op" id="8313529">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8313532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313535">defer</span>&nbsp;<span class="ident" id="8313541">c3</span><span class="op" id="8313543">.</span><span class="ident" id="8313544">Close</span><span class="op" id="8313549">(</span><span class="op" id="8313550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313553">defer</span>&nbsp;<span class="ident" id="8313559">os</span><span class="op" id="8313561">.</span><span class="ident" id="8313562">Remove</span><span class="op" id="8313568">(</span><span class="ident" id="8313569">addr3</span><span class="op" id="8313574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313577">c3</span><span class="op" id="8313579">.</span><span class="ident" id="8313580">LocalAddr</span><span class="op" id="8313589">(</span><span class="op" id="8313590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313593">c3</span><span class="op" id="8313595">.</span><span class="ident" id="8313596">RemoteAddr</span><span class="op" id="8313606">(</span><span class="op" id="8313607">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313610">c3</span><span class="op" id="8313612">.</span><span class="ident" id="8313613">SetDeadline</span><span class="op" id="8313624">(</span><span class="ident" id="8313625">time</span><span class="op" id="8313629">.</span><span class="ident" id="8313630">Now</span><span class="op" id="8313633">(</span><span class="op" id="8313634">)</span><span class="op" id="8313635">.</span><span class="ident" id="8313636">Add</span><span class="op" id="8313639">(</span><span class="ident" id="8313640">someTimeout</span><span class="op" id="8313651">)</span><span class="op" id="8313652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313655">c3</span><span class="op" id="8313657">.</span><span class="ident" id="8313658">SetReadDeadline</span><span class="op" id="8313673">(</span><span class="ident" id="8313674">time</span><span class="op" id="8313678">.</span><span class="ident" id="8313679">Now</span><span class="op" id="8313682">(</span><span class="op" id="8313683">)</span><span class="op" id="8313684">.</span><span class="ident" id="8313685">Add</span><span class="op" id="8313688">(</span><span class="ident" id="8313689">someTimeout</span><span class="op" id="8313700">)</span><span class="op" id="8313701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313704">c3</span><span class="op" id="8313706">.</span><span class="ident" id="8313707">SetWriteDeadline</span><span class="op" id="8313723">(</span><span class="ident" id="8313724">time</span><span class="op" id="8313728">.</span><span class="ident" id="8313729">Now</span><span class="op" id="8313732">(</span><span class="op" id="8313733">)</span><span class="op" id="8313734">.</span><span class="ident" id="8313735">Add</span><span class="op" id="8313738">(</span><span class="ident" id="8313739">someTimeout</span><span class="op" id="8313750">)</span><span class="op" id="8313751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313754">c3</span><span class="op" id="8313756">.</span><span class="ident" id="8313757">SetReadBuffer</span><span class="op" id="8313770">(</span><span class="num" id="8313771">2048</span><span class="op" id="8313775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313778">c3</span><span class="op" id="8313780">.</span><span class="ident" id="8313781">SetWriteBuffer</span><span class="op" id="8313795">(</span><span class="num" id="8313796">2048</span><span class="op" id="8313800">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313804">wb</span>&nbsp;<span class="op" id="8313807">:=</span>&nbsp;<span class="op" id="8313810">[</span><span class="op" id="8313811">]</span><span class="builtintype" id="8313812">byte</span><span class="op" id="8313816">(</span><span class="string" id="8313817">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="8313832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313835">rb1</span>&nbsp;<span class="op" id="8313839">:=</span>&nbsp;<span class="builtinfunc" id="8313842">make</span><span class="op" id="8313846">(</span><span class="op" id="8313847">[</span><span class="op" id="8313848">]</span><span class="builtintype" id="8313849">byte</span><span class="op" id="8313853">,</span>&nbsp;<span class="num" id="8313855">128</span><span class="op" id="8313858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313861">rb2</span>&nbsp;<span class="op" id="8313865">:=</span>&nbsp;<span class="builtinfunc" id="8313868">make</span><span class="op" id="8313872">(</span><span class="op" id="8313873">[</span><span class="op" id="8313874">]</span><span class="builtintype" id="8313875">byte</span><span class="op" id="8313879">,</span>&nbsp;<span class="num" id="8313881">128</span><span class="op" id="8313884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313887">rb3</span>&nbsp;<span class="op" id="8313891">:=</span>&nbsp;<span class="builtinfunc" id="8313894">make</span><span class="op" id="8313898">(</span><span class="op" id="8313899">[</span><span class="op" id="8313900">]</span><span class="builtintype" id="8313901">byte</span><span class="op" id="8313905">,</span>&nbsp;<span class="num" id="8313907">128</span><span class="op" id="8313910">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8313913">if</span>&nbsp;<span class="ident" id="8313916">_</span><span class="op" id="8313917">,</span>&nbsp;<span class="ident" id="8313919">_</span><span class="op" id="8313920">,</span>&nbsp;<span class="ident" id="8313922">err</span>&nbsp;<span class="op" id="8313926">:=</span>&nbsp;<span class="ident" id="8313929">c1</span><span class="op" id="8313931">.</span><span class="ident" id="8313932">WriteMsgUnix</span><span class="op" id="8313944">(</span><span class="ident" id="8313945">wb</span><span class="op" id="8313947">,</span>&nbsp;<span class="ident" id="8313949">nil</span><span class="op" id="8313952">,</span>&nbsp;<span class="ident" id="8313954">a2</span><span class="op" id="8313956">)</span><span class="op" id="8313957">;</span>&nbsp;<span class="ident" id="8313959">err</span>&nbsp;<span class="op" id="8313963">!=</span>&nbsp;<span class="ident" id="8313966">nil</span>&nbsp;<span class="op" id="8313970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8313974">t</span><span class="op" id="8313975">.</span><span class="ident" id="8313976">Fatalf</span><span class="op" id="8313982">(</span><span class="string" id="8313983">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314017">,</span>&nbsp;<span class="ident" id="8314019">err</span><span class="op" id="8314022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314028">if</span>&nbsp;<span class="ident" id="8314031">_</span><span class="op" id="8314032">,</span>&nbsp;<span class="ident" id="8314034">_</span><span class="op" id="8314035">,</span>&nbsp;<span class="ident" id="8314037">_</span><span class="op" id="8314038">,</span>&nbsp;<span class="ident" id="8314040">_</span><span class="op" id="8314041">,</span>&nbsp;<span class="ident" id="8314043">err</span>&nbsp;<span class="op" id="8314047">:=</span>&nbsp;<span class="ident" id="8314050">c2</span><span class="op" id="8314052">.</span><span class="ident" id="8314053">ReadMsgUnix</span><span class="op" id="8314064">(</span><span class="ident" id="8314065">rb2</span><span class="op" id="8314068">,</span>&nbsp;<span class="ident" id="8314070">nil</span><span class="op" id="8314073">)</span><span class="op" id="8314074">;</span>&nbsp;<span class="ident" id="8314076">err</span>&nbsp;<span class="op" id="8314080">!=</span>&nbsp;<span class="ident" id="8314083">nil</span>&nbsp;<span class="op" id="8314087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314091">t</span><span class="op" id="8314092">.</span><span class="ident" id="8314093">Fatalf</span><span class="op" id="8314099">(</span><span class="string" id="8314100">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314133">,</span>&nbsp;<span class="ident" id="8314135">err</span><span class="op" id="8314138">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314144">if</span>&nbsp;<span class="ident" id="8314147">_</span><span class="op" id="8314148">,</span>&nbsp;<span class="ident" id="8314150">err</span>&nbsp;<span class="op" id="8314154">:=</span>&nbsp;<span class="ident" id="8314157">c2</span><span class="op" id="8314159">.</span><span class="ident" id="8314160">WriteToUnix</span><span class="op" id="8314171">(</span><span class="ident" id="8314172">wb</span><span class="op" id="8314174">,</span>&nbsp;<span class="ident" id="8314176">a1</span><span class="op" id="8314178">)</span><span class="op" id="8314179">;</span>&nbsp;<span class="ident" id="8314181">err</span>&nbsp;<span class="op" id="8314185">!=</span>&nbsp;<span class="ident" id="8314188">nil</span>&nbsp;<span class="op" id="8314192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314196">t</span><span class="op" id="8314197">.</span><span class="ident" id="8314198">Fatalf</span><span class="op" id="8314204">(</span><span class="string" id="8314205">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314238">,</span>&nbsp;<span class="ident" id="8314240">err</span><span class="op" id="8314243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314249">if</span>&nbsp;<span class="ident" id="8314252">_</span><span class="op" id="8314253">,</span>&nbsp;<span class="ident" id="8314255">_</span><span class="op" id="8314256">,</span>&nbsp;<span class="ident" id="8314258">err</span>&nbsp;<span class="op" id="8314262">:=</span>&nbsp;<span class="ident" id="8314265">c1</span><span class="op" id="8314267">.</span><span class="ident" id="8314268">ReadFromUnix</span><span class="op" id="8314280">(</span><span class="ident" id="8314281">rb1</span><span class="op" id="8314284">)</span><span class="op" id="8314285">;</span>&nbsp;<span class="ident" id="8314287">err</span>&nbsp;<span class="op" id="8314291">!=</span>&nbsp;<span class="ident" id="8314294">nil</span>&nbsp;<span class="op" id="8314298">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314302">t</span><span class="op" id="8314303">.</span><span class="ident" id="8314304">Fatalf</span><span class="op" id="8314310">(</span><span class="string" id="8314311">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314345">,</span>&nbsp;<span class="ident" id="8314347">err</span><span class="op" id="8314350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314356">if</span>&nbsp;<span class="ident" id="8314359">_</span><span class="op" id="8314360">,</span>&nbsp;<span class="ident" id="8314362">err</span>&nbsp;<span class="op" id="8314366">:=</span>&nbsp;<span class="ident" id="8314369">c3</span><span class="op" id="8314371">.</span><span class="ident" id="8314372">WriteToUnix</span><span class="op" id="8314383">(</span><span class="ident" id="8314384">wb</span><span class="op" id="8314386">,</span>&nbsp;<span class="ident" id="8314388">a1</span><span class="op" id="8314390">)</span><span class="op" id="8314391">;</span>&nbsp;<span class="ident" id="8314393">err</span>&nbsp;<span class="op" id="8314397">!=</span>&nbsp;<span class="ident" id="8314400">nil</span>&nbsp;<span class="op" id="8314404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314408">t</span><span class="op" id="8314409">.</span><span class="ident" id="8314410">Fatalf</span><span class="op" id="8314416">(</span><span class="string" id="8314417">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314450">,</span>&nbsp;<span class="ident" id="8314452">err</span><span class="op" id="8314455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314458">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314461">if</span>&nbsp;<span class="ident" id="8314464">_</span><span class="op" id="8314465">,</span>&nbsp;<span class="ident" id="8314467">_</span><span class="op" id="8314468">,</span>&nbsp;<span class="ident" id="8314470">err</span>&nbsp;<span class="op" id="8314474">:=</span>&nbsp;<span class="ident" id="8314477">c1</span><span class="op" id="8314479">.</span><span class="ident" id="8314480">ReadFromUnix</span><span class="op" id="8314492">(</span><span class="ident" id="8314493">rb1</span><span class="op" id="8314496">)</span><span class="op" id="8314497">;</span>&nbsp;<span class="ident" id="8314499">err</span>&nbsp;<span class="op" id="8314503">!=</span>&nbsp;<span class="ident" id="8314506">nil</span>&nbsp;<span class="op" id="8314510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314514">t</span><span class="op" id="8314515">.</span><span class="ident" id="8314516">Fatalf</span><span class="op" id="8314522">(</span><span class="string" id="8314523">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314557">,</span>&nbsp;<span class="ident" id="8314559">err</span><span class="op" id="8314562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314568">if</span>&nbsp;<span class="ident" id="8314571">_</span><span class="op" id="8314572">,</span>&nbsp;<span class="ident" id="8314574">err</span>&nbsp;<span class="op" id="8314578">:=</span>&nbsp;<span class="ident" id="8314581">c2</span><span class="op" id="8314583">.</span><span class="ident" id="8314584">WriteToUnix</span><span class="op" id="8314595">(</span><span class="ident" id="8314596">wb</span><span class="op" id="8314598">,</span>&nbsp;<span class="ident" id="8314600">a3</span><span class="op" id="8314602">)</span><span class="op" id="8314603">;</span>&nbsp;<span class="ident" id="8314605">err</span>&nbsp;<span class="op" id="8314609">!=</span>&nbsp;<span class="ident" id="8314612">nil</span>&nbsp;<span class="op" id="8314616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314620">t</span><span class="op" id="8314621">.</span><span class="ident" id="8314622">Fatalf</span><span class="op" id="8314628">(</span><span class="string" id="8314629">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314662">,</span>&nbsp;<span class="ident" id="8314664">err</span><span class="op" id="8314667">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314673">if</span>&nbsp;<span class="ident" id="8314676">_</span><span class="op" id="8314677">,</span>&nbsp;<span class="ident" id="8314679">_</span><span class="op" id="8314680">,</span>&nbsp;<span class="ident" id="8314682">err</span>&nbsp;<span class="op" id="8314686">:=</span>&nbsp;<span class="ident" id="8314689">c3</span><span class="op" id="8314691">.</span><span class="ident" id="8314692">ReadFromUnix</span><span class="op" id="8314704">(</span><span class="ident" id="8314705">rb3</span><span class="op" id="8314708">)</span><span class="op" id="8314709">;</span>&nbsp;<span class="ident" id="8314711">err</span>&nbsp;<span class="op" id="8314715">!=</span>&nbsp;<span class="ident" id="8314718">nil</span>&nbsp;<span class="op" id="8314722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314726">t</span><span class="op" id="8314727">.</span><span class="ident" id="8314728">Fatalf</span><span class="op" id="8314734">(</span><span class="string" id="8314735">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314769">,</span>&nbsp;<span class="ident" id="8314771">err</span><span class="op" id="8314774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314781">if</span>&nbsp;<span class="ident" id="8314784">f</span><span class="op" id="8314785">,</span>&nbsp;<span class="ident" id="8314787">err</span>&nbsp;<span class="op" id="8314791">:=</span>&nbsp;<span class="ident" id="8314794">c1</span><span class="op" id="8314796">.</span><span class="ident" id="8314797">File</span><span class="op" id="8314801">(</span><span class="op" id="8314802">)</span><span class="op" id="8314803">;</span>&nbsp;<span class="ident" id="8314805">err</span>&nbsp;<span class="op" id="8314809">!=</span>&nbsp;<span class="ident" id="8314812">nil</span>&nbsp;<span class="op" id="8314816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314820">t</span><span class="op" id="8314821">.</span><span class="ident" id="8314822">Fatalf</span><span class="op" id="8314828">(</span><span class="string" id="8314829">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8314855">,</span>&nbsp;<span class="ident" id="8314857">err</span><span class="op" id="8314860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314863">}</span>&nbsp;<span class="keyword" id="8314865">else</span>&nbsp;<span class="op" id="8314870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314874">f</span><span class="op" id="8314875">.</span><span class="ident" id="8314876">Close</span><span class="op" id="8314881">(</span><span class="op" id="8314882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8314885">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314889">defer</span>&nbsp;<span class="keyword" id="8314895">func</span><span class="op" id="8314899">(</span><span class="op" id="8314900">)</span>&nbsp;<span class="op" id="8314902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8314906">if</span>&nbsp;<span class="ident" id="8314909">p</span>&nbsp;<span class="op" id="8314911">:=</span>&nbsp;<span class="builtinfunc" id="8314914">recover</span><span class="op" id="8314921">(</span><span class="op" id="8314922">)</span><span class="op" id="8314923">;</span>&nbsp;<span class="ident" id="8314925">p</span>&nbsp;<span class="op" id="8314927">!=</span>&nbsp;<span class="ident" id="8314930">nil</span>&nbsp;<span class="op" id="8314934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8314939">t</span><span class="op" id="8314940">.</span><span class="ident" id="8314941">Fatalf</span><span class="op" id="8314947">(</span><span class="string" id="8314948">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8314999">,</span>&nbsp;<span class="ident" id="8315001">p</span><span class="op" id="8315002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8315006">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8315009">}</span><span class="op" id="8315010">(</span><span class="op" id="8315011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8315015">c1</span><span class="op" id="8315017">.</span><span class="ident" id="8315018">WriteToUnix</span><span class="op" id="8315029">(</span><span class="ident" id="8315030">wb</span><span class="op" id="8315032">,</span>&nbsp;<span class="ident" id="8315034">nil</span><span class="op" id="8315037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8315040">c1</span><span class="op" id="8315042">.</span><span class="ident" id="8315043">WriteMsgUnix</span><span class="op" id="8315055">(</span><span class="ident" id="8315056">wb</span><span class="op" id="8315058">,</span>&nbsp;<span class="ident" id="8315060">nil</span><span class="op" id="8315063">,</span>&nbsp;<span class="ident" id="8315065">nil</span><span class="op" id="8315068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8315071">c3</span><span class="op" id="8315073">.</span><span class="ident" id="8315074">WriteToUnix</span><span class="op" id="8315085">(</span><span class="ident" id="8315086">wb</span><span class="op" id="8315088">,</span>&nbsp;<span class="ident" id="8315090">nil</span><span class="op" id="8315093">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8315096">c3</span><span class="op" id="8315098">.</span><span class="ident" id="8315099">WriteMsgUnix</span><span class="op" id="8315111">(</span><span class="ident" id="8315112">wb</span><span class="op" id="8315114">,</span>&nbsp;<span class="ident" id="8315116">nil</span><span class="op" id="8315119">,</span>&nbsp;<span class="ident" id="8315121">nil</span><span class="op" id="8315124">)</span><br>
<span class="lineno"></span><span class="op" id="8315126">}</span>
</div>
</body>
</html>
