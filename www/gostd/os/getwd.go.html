<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html" class="current">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2355058">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2355113">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2355167">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2355218">package</span>&nbsp;<span class="ident" id="2355226">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2355230">import</span>&nbsp;<span class="op" id="2355237">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2355240">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2355251">&#34;sync&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2355259">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2355269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2355272">var</span>&nbsp;<span class="ident" id="2355276">getwdCache</span>&nbsp;<span class="keyword" id="2355287">struct</span>&nbsp;<span class="op" id="2355294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2355297">sync</span><span class="op" id="2355301">.</span><span class="ident" id="2355302">Mutex</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2355309">dir</span>&nbsp;<span class="builtintype" id="2355313">string</span><br>
<span class="lineno"></span><span class="op" id="2355320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2355323">//&nbsp;useSyscallwd&nbsp;determines&nbsp;whether&nbsp;to&nbsp;use&nbsp;the&nbsp;return&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2355385">//&nbsp;syscall.Getwd&nbsp;based&nbsp;on&nbsp;its&nbsp;error.</span><br>
<span class="lineno">20</span><span class="keyword" id="2355422">var</span>&nbsp;<span class="ident" id="2355426">useSyscallwd</span>&nbsp;<span class="op" id="2355439">=</span>&nbsp;<span class="keyword" id="2355441">func</span><span class="op" id="2355445">(</span><span class="builtintype" id="2355446">error</span><span class="op" id="2355451">)</span>&nbsp;<span class="builtintype" id="2355453">bool</span>&nbsp;<span class="op" id="2355458">{</span>&nbsp;<span class="keyword" id="2355460">return</span>&nbsp;<span class="builtintype" id="2355467">true</span>&nbsp;<span class="op" id="2355472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2355475">//&nbsp;Getwd&nbsp;returns&nbsp;a&nbsp;rooted&nbsp;path&nbsp;name&nbsp;corresponding&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2355532">//&nbsp;current&nbsp;directory.&nbsp;&nbsp;If&nbsp;the&nbsp;current&nbsp;directory&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2355587">//&nbsp;reached&nbsp;via&nbsp;multiple&nbsp;paths&nbsp;(due&nbsp;to&nbsp;symbolic&nbsp;links),</span><br>
<span class="lineno">25</span><span class="comment" id="2355642">//&nbsp;Getwd&nbsp;may&nbsp;return&nbsp;any&nbsp;one&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="2355679">func</span>&nbsp;<span class="ident" id="2355684">Getwd</span><span class="op" id="2355689">(</span><span class="op" id="2355690">)</span>&nbsp;<span class="op" id="2355692">(</span><span class="ident" id="2355693">dir</span>&nbsp;<span class="builtintype" id="2355697">string</span><span class="op" id="2355703">,</span>&nbsp;<span class="ident" id="2355705">err</span>&nbsp;<span class="builtintype" id="2355709">error</span><span class="op" id="2355714">)</span>&nbsp;<span class="op" id="2355716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355719">if</span>&nbsp;<span class="ident" id="2355722">runtime</span><span class="op" id="2355729">.</span><span class="ident" id="2355730">GOOS</span>&nbsp;<span class="op" id="2355735">==</span>&nbsp;<span class="string" id="2355738">&#34;windows&#34;</span>&nbsp;<span class="op" id="2355748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355752">return</span>&nbsp;<span class="ident" id="2355759">syscall</span><span class="op" id="2355766">.</span><span class="ident" id="2355767">Getwd</span><span class="op" id="2355772">(</span><span class="op" id="2355773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2355776">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2355780">//&nbsp;Clumsy&nbsp;but&nbsp;widespread&nbsp;kludge:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2355814">//&nbsp;if&nbsp;$PWD&nbsp;is&nbsp;set&nbsp;and&nbsp;matches&nbsp;&#34;.&#34;,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2355858">dot</span><span class="op" id="2355861">,</span>&nbsp;<span class="ident" id="2355863">err</span>&nbsp;<span class="op" id="2355867">:=</span>&nbsp;<span class="ident" id="2355870">Stat</span><span class="op" id="2355874">(</span><span class="string" id="2355875">&#34;.&#34;</span><span class="op" id="2355878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355881">if</span>&nbsp;<span class="ident" id="2355884">err</span>&nbsp;<span class="op" id="2355888">!=</span>&nbsp;<span class="builtintype" id="2355891">nil</span>&nbsp;<span class="op" id="2355895">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355899">return</span>&nbsp;<span class="string" id="2355906">&#34;&#34;</span><span class="op" id="2355908">,</span>&nbsp;<span class="ident" id="2355910">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2355915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2355918">dir</span>&nbsp;<span class="op" id="2355922">=</span>&nbsp;<span class="ident" id="2355924">Getenv</span><span class="op" id="2355930">(</span><span class="string" id="2355931">&#34;PWD&#34;</span><span class="op" id="2355936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355939">if</span>&nbsp;<span class="builtinfunc" id="2355942">len</span><span class="op" id="2355945">(</span><span class="ident" id="2355946">dir</span><span class="op" id="2355949">)</span>&nbsp;<span class="op" id="2355951">&gt;</span>&nbsp;<span class="num" id="2355953">0</span>&nbsp;<span class="op" id="2355955">&amp;&amp;</span>&nbsp;<span class="ident" id="2355958">dir</span><span class="op" id="2355961">[</span><span class="num" id="2355962">0</span><span class="op" id="2355963">]</span>&nbsp;<span class="op" id="2355965">==</span>&nbsp;<span class="string" id="2355968">&#39;/&#39;</span>&nbsp;<span class="op" id="2355972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2355976">d</span><span class="op" id="2355977">,</span>&nbsp;<span class="ident" id="2355979">err</span>&nbsp;<span class="op" id="2355983">:=</span>&nbsp;<span class="ident" id="2355986">Stat</span><span class="op" id="2355990">(</span><span class="ident" id="2355991">dir</span><span class="op" id="2355994">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355998">if</span>&nbsp;<span class="ident" id="2356001">err</span>&nbsp;<span class="op" id="2356005">==</span>&nbsp;<span class="builtintype" id="2356008">nil</span>&nbsp;<span class="op" id="2356012">&amp;&amp;</span>&nbsp;<span class="ident" id="2356015">SameFile</span><span class="op" id="2356023">(</span><span class="ident" id="2356024">dot</span><span class="op" id="2356027">,</span>&nbsp;<span class="ident" id="2356029">d</span><span class="op" id="2356030">)</span>&nbsp;<span class="op" id="2356032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356037">return</span>&nbsp;<span class="ident" id="2356044">dir</span><span class="op" id="2356047">,</span>&nbsp;<span class="builtintype" id="2356049">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356062">//&nbsp;If&nbsp;the&nbsp;operating&nbsp;system&nbsp;provides&nbsp;a&nbsp;Getwd&nbsp;call,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356121">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;our&nbsp;way&nbsp;back&nbsp;to&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356178">if</span>&nbsp;<span class="ident" id="2356181">syscall</span><span class="op" id="2356188">.</span><span class="ident" id="2356189">ImplementsGetwd</span>&nbsp;<span class="op" id="2356205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356209">s</span><span class="op" id="2356210">,</span>&nbsp;<span class="ident" id="2356212">e</span>&nbsp;<span class="op" id="2356214">:=</span>&nbsp;<span class="ident" id="2356217">syscall</span><span class="op" id="2356224">.</span><span class="ident" id="2356225">Getwd</span><span class="op" id="2356230">(</span><span class="op" id="2356231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356235">if</span>&nbsp;<span class="ident" id="2356238">useSyscallwd</span><span class="op" id="2356250">(</span><span class="ident" id="2356251">e</span><span class="op" id="2356252">)</span>&nbsp;<span class="op" id="2356254">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356259">return</span>&nbsp;<span class="ident" id="2356266">s</span><span class="op" id="2356267">,</span>&nbsp;<span class="ident" id="2356269">NewSyscallError</span><span class="op" id="2356284">(</span><span class="string" id="2356285">&#34;getwd&#34;</span><span class="op" id="2356292">,</span>&nbsp;<span class="ident" id="2356294">e</span><span class="op" id="2356295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356306">//&nbsp;Apply&nbsp;same&nbsp;kludge&nbsp;but&nbsp;to&nbsp;cached&nbsp;dir&nbsp;instead&nbsp;of&nbsp;$PWD.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356363">getwdCache</span><span class="op" id="2356373">.</span><span class="ident" id="2356374">Lock</span><span class="op" id="2356378">(</span><span class="op" id="2356379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356382">dir</span>&nbsp;<span class="op" id="2356386">=</span>&nbsp;<span class="ident" id="2356388">getwdCache</span><span class="op" id="2356398">.</span><span class="ident" id="2356399">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356404">getwdCache</span><span class="op" id="2356414">.</span><span class="ident" id="2356415">Unlock</span><span class="op" id="2356421">(</span><span class="op" id="2356422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356425">if</span>&nbsp;<span class="builtinfunc" id="2356428">len</span><span class="op" id="2356431">(</span><span class="ident" id="2356432">dir</span><span class="op" id="2356435">)</span>&nbsp;<span class="op" id="2356437">&gt;</span>&nbsp;<span class="num" id="2356439">0</span>&nbsp;<span class="op" id="2356441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356445">d</span><span class="op" id="2356446">,</span>&nbsp;<span class="ident" id="2356448">err</span>&nbsp;<span class="op" id="2356452">:=</span>&nbsp;<span class="ident" id="2356455">Stat</span><span class="op" id="2356459">(</span><span class="ident" id="2356460">dir</span><span class="op" id="2356463">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356467">if</span>&nbsp;<span class="ident" id="2356470">err</span>&nbsp;<span class="op" id="2356474">==</span>&nbsp;<span class="builtintype" id="2356477">nil</span>&nbsp;<span class="op" id="2356481">&amp;&amp;</span>&nbsp;<span class="ident" id="2356484">SameFile</span><span class="op" id="2356492">(</span><span class="ident" id="2356493">dot</span><span class="op" id="2356496">,</span>&nbsp;<span class="ident" id="2356498">d</span><span class="op" id="2356499">)</span>&nbsp;<span class="op" id="2356501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356506">return</span>&nbsp;<span class="ident" id="2356513">dir</span><span class="op" id="2356516">,</span>&nbsp;<span class="builtintype" id="2356518">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356531">//&nbsp;Root&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;because&nbsp;it&nbsp;has&nbsp;no&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356583">//&nbsp;and&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356608">root</span><span class="op" id="2356612">,</span>&nbsp;<span class="ident" id="2356614">err</span>&nbsp;<span class="op" id="2356618">:=</span>&nbsp;<span class="ident" id="2356621">Stat</span><span class="op" id="2356625">(</span><span class="string" id="2356626">&#34;/&#34;</span><span class="op" id="2356629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356632">if</span>&nbsp;<span class="ident" id="2356635">err</span>&nbsp;<span class="op" id="2356639">!=</span>&nbsp;<span class="builtintype" id="2356642">nil</span>&nbsp;<span class="op" id="2356646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356650">//&nbsp;Can&#39;t&nbsp;stat&nbsp;root&nbsp;-&nbsp;no&nbsp;hope.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356682">return</span>&nbsp;<span class="string" id="2356689">&#34;&#34;</span><span class="op" id="2356691">,</span>&nbsp;<span class="ident" id="2356693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356701">if</span>&nbsp;<span class="ident" id="2356704">SameFile</span><span class="op" id="2356712">(</span><span class="ident" id="2356713">root</span><span class="op" id="2356717">,</span>&nbsp;<span class="ident" id="2356719">dot</span><span class="op" id="2356722">)</span>&nbsp;<span class="op" id="2356724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356728">return</span>&nbsp;<span class="string" id="2356735">&#34;/&#34;</span><span class="op" id="2356738">,</span>&nbsp;<span class="builtintype" id="2356740">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2356745">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356749">//&nbsp;General&nbsp;algorithm:&nbsp;find&nbsp;name&nbsp;in&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356792">//&nbsp;and&nbsp;then&nbsp;find&nbsp;name&nbsp;of&nbsp;parent.&nbsp;&nbsp;Each&nbsp;iteration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2356842">//&nbsp;adds&nbsp;/name&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2356882">dir</span>&nbsp;<span class="op" id="2356886">=</span>&nbsp;<span class="string" id="2356888">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356892">for</span>&nbsp;<span class="ident" id="2356896">parent</span>&nbsp;<span class="op" id="2356903">:=</span>&nbsp;<span class="string" id="2356906">&#34;..&#34;</span><span class="op" id="2356910">;</span>&nbsp;<span class="op" id="2356912">;</span>&nbsp;<span class="ident" id="2356914">parent</span>&nbsp;<span class="op" id="2356921">=</span>&nbsp;<span class="string" id="2356923">&#34;../&#34;</span>&nbsp;<span class="op" id="2356929">+</span>&nbsp;<span class="ident" id="2356931">parent</span>&nbsp;<span class="op" id="2356938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356942">if</span>&nbsp;<span class="builtinfunc" id="2356945">len</span><span class="op" id="2356948">(</span><span class="ident" id="2356949">parent</span><span class="op" id="2356955">)</span>&nbsp;<span class="op" id="2356957">&gt;=</span>&nbsp;<span class="num" id="2356960">1024</span>&nbsp;<span class="op" id="2356965">{</span>&nbsp;<span class="comment" id="2356967">//&nbsp;Sanity&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2356986">return</span>&nbsp;<span class="string" id="2356993">&#34;&#34;</span><span class="op" id="2356995">,</span>&nbsp;<span class="ident" id="2356997">syscall</span><span class="op" id="2357004">.</span><span class="ident" id="2357005">ENAMETOOLONG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357024">fd</span><span class="op" id="2357026">,</span>&nbsp;<span class="ident" id="2357028">err</span>&nbsp;<span class="op" id="2357032">:=</span>&nbsp;<span class="ident" id="2357035">Open</span><span class="op" id="2357039">(</span><span class="ident" id="2357040">parent</span><span class="op" id="2357046">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357050">if</span>&nbsp;<span class="ident" id="2357053">err</span>&nbsp;<span class="op" id="2357057">!=</span>&nbsp;<span class="builtintype" id="2357060">nil</span>&nbsp;<span class="op" id="2357064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357069">return</span>&nbsp;<span class="string" id="2357076">&#34;&#34;</span><span class="op" id="2357078">,</span>&nbsp;<span class="ident" id="2357080">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357091">for</span>&nbsp;<span class="op" id="2357095">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357100">names</span><span class="op" id="2357105">,</span>&nbsp;<span class="ident" id="2357107">err</span>&nbsp;<span class="op" id="2357111">:=</span>&nbsp;<span class="ident" id="2357114">fd</span><span class="op" id="2357116">.</span><span class="ident" id="2357117">Readdirnames</span><span class="op" id="2357129">(</span><span class="num" id="2357130">100</span><span class="op" id="2357133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357138">if</span>&nbsp;<span class="ident" id="2357141">err</span>&nbsp;<span class="op" id="2357145">!=</span>&nbsp;<span class="builtintype" id="2357148">nil</span>&nbsp;<span class="op" id="2357152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357158">fd</span><span class="op" id="2357160">.</span><span class="ident" id="2357161">Close</span><span class="op" id="2357166">(</span><span class="op" id="2357167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357173">return</span>&nbsp;<span class="string" id="2357180">&#34;&#34;</span><span class="op" id="2357182">,</span>&nbsp;<span class="ident" id="2357184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357191">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357196">for</span>&nbsp;<span class="ident" id="2357200">_</span><span class="op" id="2357201">,</span>&nbsp;<span class="ident" id="2357203">name</span>&nbsp;<span class="op" id="2357208">:=</span>&nbsp;<span class="keyword" id="2357211">range</span>&nbsp;<span class="ident" id="2357217">names</span>&nbsp;<span class="op" id="2357223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357229">d</span><span class="op" id="2357230">,</span>&nbsp;<span class="ident" id="2357232">_</span>&nbsp;<span class="op" id="2357234">:=</span>&nbsp;<span class="ident" id="2357237">Lstat</span><span class="op" id="2357242">(</span><span class="ident" id="2357243">parent</span>&nbsp;<span class="op" id="2357250">+</span>&nbsp;<span class="string" id="2357252">&#34;/&#34;</span>&nbsp;<span class="op" id="2357256">+</span>&nbsp;<span class="ident" id="2357258">name</span><span class="op" id="2357262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357268">if</span>&nbsp;<span class="ident" id="2357271">SameFile</span><span class="op" id="2357279">(</span><span class="ident" id="2357280">d</span><span class="op" id="2357281">,</span>&nbsp;<span class="ident" id="2357283">dot</span><span class="op" id="2357286">)</span>&nbsp;<span class="op" id="2357288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357295">dir</span>&nbsp;<span class="op" id="2357299">=</span>&nbsp;<span class="string" id="2357301">&#34;/&#34;</span>&nbsp;<span class="op" id="2357305">+</span>&nbsp;<span class="ident" id="2357307">name</span>&nbsp;<span class="op" id="2357312">+</span>&nbsp;<span class="ident" id="2357314">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357323">goto</span>&nbsp;<span class="ident" id="2357328">Found</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357351">Found</span><span class="op" id="2357356">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357360">pd</span><span class="op" id="2357362">,</span>&nbsp;<span class="ident" id="2357364">err</span>&nbsp;<span class="op" id="2357368">:=</span>&nbsp;<span class="ident" id="2357371">fd</span><span class="op" id="2357373">.</span><span class="ident" id="2357374">Stat</span><span class="op" id="2357378">(</span><span class="op" id="2357379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357383">if</span>&nbsp;<span class="ident" id="2357386">err</span>&nbsp;<span class="op" id="2357390">!=</span>&nbsp;<span class="builtintype" id="2357393">nil</span>&nbsp;<span class="op" id="2357397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357402">return</span>&nbsp;<span class="string" id="2357409">&#34;&#34;</span><span class="op" id="2357411">,</span>&nbsp;<span class="ident" id="2357413">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357423">fd</span><span class="op" id="2357425">.</span><span class="ident" id="2357426">Close</span><span class="op" id="2357431">(</span><span class="op" id="2357432">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357436">if</span>&nbsp;<span class="ident" id="2357439">SameFile</span><span class="op" id="2357447">(</span><span class="ident" id="2357448">pd</span><span class="op" id="2357450">,</span>&nbsp;<span class="ident" id="2357452">root</span><span class="op" id="2357456">)</span>&nbsp;<span class="op" id="2357458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357463">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2357475">//&nbsp;Set&nbsp;up&nbsp;for&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357503">dot</span>&nbsp;<span class="op" id="2357507">=</span>&nbsp;<span class="ident" id="2357509">pd</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2357513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2357517">//&nbsp;Save&nbsp;answer&nbsp;as&nbsp;hint&nbsp;to&nbsp;avoid&nbsp;the&nbsp;expensive&nbsp;path&nbsp;next&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357580">getwdCache</span><span class="op" id="2357590">.</span><span class="ident" id="2357591">Lock</span><span class="op" id="2357595">(</span><span class="op" id="2357596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357599">getwdCache</span><span class="op" id="2357609">.</span><span class="ident" id="2357610">dir</span>&nbsp;<span class="op" id="2357614">=</span>&nbsp;<span class="ident" id="2357616">dir</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357621">getwdCache</span><span class="op" id="2357631">.</span><span class="ident" id="2357632">Unlock</span><span class="op" id="2357638">(</span><span class="op" id="2357639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2357643">return</span>&nbsp;<span class="ident" id="2357650">dir</span><span class="op" id="2357653">,</span>&nbsp;<span class="builtintype" id="2357655">nil</span><br>
<span class="lineno"></span><span class="op" id="2357659">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
