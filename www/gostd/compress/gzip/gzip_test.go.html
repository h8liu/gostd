<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7329546">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7329601">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7329655">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7329706">package</span>&nbsp;<span class="ident" id="7329714">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7329720">import</span>&nbsp;<span class="op" id="7329727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329730">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329739">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329748">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329761">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329772">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7329779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="7329782">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7329856">func</span>&nbsp;<span class="ident" id="7329861">TestEmpty</span><span class="op" id="7329870">(</span><span class="ident" id="7329871">t</span>&nbsp;<span class="op" id="7329873">*</span><span class="ident" id="7329874">testing</span><span class="op" id="7329881">.</span><span class="ident" id="7329882">T</span><span class="op" id="7329883">)</span>&nbsp;<span class="op" id="7329885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7329888">buf</span>&nbsp;<span class="op" id="7329892">:=</span>&nbsp;<span class="builtinfunc" id="7329895">new</span><span class="op" id="7329898">(</span><span class="ident" id="7329899">bytes</span><span class="op" id="7329904">.</span><span class="ident" id="7329905">Buffer</span><span class="op" id="7329911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7329915">if</span>&nbsp;<span class="ident" id="7329918">err</span>&nbsp;<span class="op" id="7329922">:=</span>&nbsp;<span class="ident" id="7329925">NewWriter</span><span class="op" id="7329934">(</span><span class="ident" id="7329935">buf</span><span class="op" id="7329938">)</span><span class="op" id="7329939">.</span><span class="ident" id="7329940">Close</span><span class="op" id="7329945">(</span><span class="op" id="7329946">)</span><span class="op" id="7329947">;</span>&nbsp;<span class="ident" id="7329949">err</span>&nbsp;<span class="op" id="7329953">!=</span>&nbsp;<span class="builtintype" id="7329956">nil</span>&nbsp;<span class="op" id="7329960">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7329964">t</span><span class="op" id="7329965">.</span><span class="ident" id="7329966">Fatalf</span><span class="op" id="7329972">(</span><span class="string" id="7329973">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7329991">,</span>&nbsp;<span class="ident" id="7329993">err</span><span class="op" id="7329996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7329999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330003">r</span><span class="op" id="7330004">,</span>&nbsp;<span class="ident" id="7330006">err</span>&nbsp;<span class="op" id="7330010">:=</span>&nbsp;<span class="ident" id="7330013">NewReader</span><span class="op" id="7330022">(</span><span class="ident" id="7330023">buf</span><span class="op" id="7330026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330029">if</span>&nbsp;<span class="ident" id="7330032">err</span>&nbsp;<span class="op" id="7330036">!=</span>&nbsp;<span class="builtintype" id="7330039">nil</span>&nbsp;<span class="op" id="7330043">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330047">t</span><span class="op" id="7330048">.</span><span class="ident" id="7330049">Fatalf</span><span class="op" id="7330055">(</span><span class="string" id="7330056">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7330071">,</span>&nbsp;<span class="ident" id="7330073">err</span><span class="op" id="7330076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330082">b</span><span class="op" id="7330083">,</span>&nbsp;<span class="ident" id="7330085">err</span>&nbsp;<span class="op" id="7330089">:=</span>&nbsp;<span class="ident" id="7330092">ioutil</span><span class="op" id="7330098">.</span><span class="ident" id="7330099">ReadAll</span><span class="op" id="7330106">(</span><span class="ident" id="7330107">r</span><span class="op" id="7330108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330111">if</span>&nbsp;<span class="ident" id="7330114">err</span>&nbsp;<span class="op" id="7330118">!=</span>&nbsp;<span class="builtintype" id="7330121">nil</span>&nbsp;<span class="op" id="7330125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330129">t</span><span class="op" id="7330130">.</span><span class="ident" id="7330131">Fatalf</span><span class="op" id="7330137">(</span><span class="string" id="7330138">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7330151">,</span>&nbsp;<span class="ident" id="7330153">err</span><span class="op" id="7330156">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330162">if</span>&nbsp;<span class="builtinfunc" id="7330165">len</span><span class="op" id="7330168">(</span><span class="ident" id="7330169">b</span><span class="op" id="7330170">)</span>&nbsp;<span class="op" id="7330172">!=</span>&nbsp;<span class="num" id="7330175">0</span>&nbsp;<span class="op" id="7330177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330181">t</span><span class="op" id="7330182">.</span><span class="ident" id="7330183">Fatalf</span><span class="op" id="7330189">(</span><span class="string" id="7330190">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7330212">,</span>&nbsp;<span class="builtinfunc" id="7330214">len</span><span class="op" id="7330217">(</span><span class="ident" id="7330218">b</span><span class="op" id="7330219">)</span><span class="op" id="7330220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330226">if</span>&nbsp;<span class="ident" id="7330229">err</span>&nbsp;<span class="op" id="7330233">:=</span>&nbsp;<span class="ident" id="7330236">r</span><span class="op" id="7330237">.</span><span class="ident" id="7330238">Close</span><span class="op" id="7330243">(</span><span class="op" id="7330244">)</span><span class="op" id="7330245">;</span>&nbsp;<span class="ident" id="7330247">err</span>&nbsp;<span class="op" id="7330251">!=</span>&nbsp;<span class="builtintype" id="7330254">nil</span>&nbsp;<span class="op" id="7330258">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330262">t</span><span class="op" id="7330263">.</span><span class="ident" id="7330264">Fatalf</span><span class="op" id="7330270">(</span><span class="string" id="7330271">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7330289">,</span>&nbsp;<span class="ident" id="7330291">err</span><span class="op" id="7330294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330297">}</span><br>
<span class="lineno"></span><span class="op" id="7330299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7330302">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="7330375">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="7330388">func</span>&nbsp;<span class="ident" id="7330393">TestRoundTrip</span><span class="op" id="7330406">(</span><span class="ident" id="7330407">t</span>&nbsp;<span class="op" id="7330409">*</span><span class="ident" id="7330410">testing</span><span class="op" id="7330417">.</span><span class="ident" id="7330418">T</span><span class="op" id="7330419">)</span>&nbsp;<span class="op" id="7330421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330424">buf</span>&nbsp;<span class="op" id="7330428">:=</span>&nbsp;<span class="builtinfunc" id="7330431">new</span><span class="op" id="7330434">(</span><span class="ident" id="7330435">bytes</span><span class="op" id="7330440">.</span><span class="ident" id="7330441">Buffer</span><span class="op" id="7330447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330451">w</span>&nbsp;<span class="op" id="7330453">:=</span>&nbsp;<span class="ident" id="7330456">NewWriter</span><span class="op" id="7330465">(</span><span class="ident" id="7330466">buf</span><span class="op" id="7330469">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330472">w</span><span class="op" id="7330473">.</span><span class="ident" id="7330474">Comment</span>&nbsp;<span class="op" id="7330482">=</span>&nbsp;<span class="string" id="7330484">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330495">w</span><span class="op" id="7330496">.</span><span class="ident" id="7330497">Extra</span>&nbsp;<span class="op" id="7330503">=</span>&nbsp;<span class="op" id="7330505">[</span><span class="op" id="7330506">]</span><span class="builtintype" id="7330507">byte</span><span class="op" id="7330511">(</span><span class="string" id="7330512">&#34;extra&#34;</span><span class="op" id="7330519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330522">w</span><span class="op" id="7330523">.</span><span class="ident" id="7330524">ModTime</span>&nbsp;<span class="op" id="7330532">=</span>&nbsp;<span class="ident" id="7330534">time</span><span class="op" id="7330538">.</span><span class="ident" id="7330539">Unix</span><span class="op" id="7330543">(</span><span class="num" id="7330544">1e8</span><span class="op" id="7330547">,</span>&nbsp;<span class="num" id="7330549">0</span><span class="op" id="7330550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330553">w</span><span class="op" id="7330554">.</span><span class="ident" id="7330555">Name</span>&nbsp;<span class="op" id="7330560">=</span>&nbsp;<span class="string" id="7330562">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330570">if</span>&nbsp;<span class="ident" id="7330573">_</span><span class="op" id="7330574">,</span>&nbsp;<span class="ident" id="7330576">err</span>&nbsp;<span class="op" id="7330580">:=</span>&nbsp;<span class="ident" id="7330583">w</span><span class="op" id="7330584">.</span><span class="ident" id="7330585">Write</span><span class="op" id="7330590">(</span><span class="op" id="7330591">[</span><span class="op" id="7330592">]</span><span class="builtintype" id="7330593">byte</span><span class="op" id="7330597">(</span><span class="string" id="7330598">&#34;payload&#34;</span><span class="op" id="7330607">)</span><span class="op" id="7330608">)</span><span class="op" id="7330609">;</span>&nbsp;<span class="ident" id="7330611">err</span>&nbsp;<span class="op" id="7330615">!=</span>&nbsp;<span class="builtintype" id="7330618">nil</span>&nbsp;<span class="op" id="7330622">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330626">t</span><span class="op" id="7330627">.</span><span class="ident" id="7330628">Fatalf</span><span class="op" id="7330634">(</span><span class="string" id="7330635">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7330646">,</span>&nbsp;<span class="ident" id="7330648">err</span><span class="op" id="7330651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330657">if</span>&nbsp;<span class="ident" id="7330660">err</span>&nbsp;<span class="op" id="7330664">:=</span>&nbsp;<span class="ident" id="7330667">w</span><span class="op" id="7330668">.</span><span class="ident" id="7330669">Close</span><span class="op" id="7330674">(</span><span class="op" id="7330675">)</span><span class="op" id="7330676">;</span>&nbsp;<span class="ident" id="7330678">err</span>&nbsp;<span class="op" id="7330682">!=</span>&nbsp;<span class="builtintype" id="7330685">nil</span>&nbsp;<span class="op" id="7330689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330693">t</span><span class="op" id="7330694">.</span><span class="ident" id="7330695">Fatalf</span><span class="op" id="7330701">(</span><span class="string" id="7330702">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7330720">,</span>&nbsp;<span class="ident" id="7330722">err</span><span class="op" id="7330725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330728">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330732">r</span><span class="op" id="7330733">,</span>&nbsp;<span class="ident" id="7330735">err</span>&nbsp;<span class="op" id="7330739">:=</span>&nbsp;<span class="ident" id="7330742">NewReader</span><span class="op" id="7330751">(</span><span class="ident" id="7330752">buf</span><span class="op" id="7330755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330758">if</span>&nbsp;<span class="ident" id="7330761">err</span>&nbsp;<span class="op" id="7330765">!=</span>&nbsp;<span class="builtintype" id="7330768">nil</span>&nbsp;<span class="op" id="7330772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330776">t</span><span class="op" id="7330777">.</span><span class="ident" id="7330778">Fatalf</span><span class="op" id="7330784">(</span><span class="string" id="7330785">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7330800">,</span>&nbsp;<span class="ident" id="7330802">err</span><span class="op" id="7330805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330808">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330811">b</span><span class="op" id="7330812">,</span>&nbsp;<span class="ident" id="7330814">err</span>&nbsp;<span class="op" id="7330818">:=</span>&nbsp;<span class="ident" id="7330821">ioutil</span><span class="op" id="7330827">.</span><span class="ident" id="7330828">ReadAll</span><span class="op" id="7330835">(</span><span class="ident" id="7330836">r</span><span class="op" id="7330837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330840">if</span>&nbsp;<span class="ident" id="7330843">err</span>&nbsp;<span class="op" id="7330847">!=</span>&nbsp;<span class="builtintype" id="7330850">nil</span>&nbsp;<span class="op" id="7330854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330858">t</span><span class="op" id="7330859">.</span><span class="ident" id="7330860">Fatalf</span><span class="op" id="7330866">(</span><span class="string" id="7330867">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7330880">,</span>&nbsp;<span class="ident" id="7330882">err</span><span class="op" id="7330885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330891">if</span>&nbsp;<span class="builtintype" id="7330894">string</span><span class="op" id="7330900">(</span><span class="ident" id="7330901">b</span><span class="op" id="7330902">)</span>&nbsp;<span class="op" id="7330904">!=</span>&nbsp;<span class="string" id="7330907">&#34;payload&#34;</span>&nbsp;<span class="op" id="7330917">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330921">t</span><span class="op" id="7330922">.</span><span class="ident" id="7330923">Fatalf</span><span class="op" id="7330929">(</span><span class="string" id="7330930">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7330954">,</span>&nbsp;<span class="builtintype" id="7330956">string</span><span class="op" id="7330962">(</span><span class="ident" id="7330963">b</span><span class="op" id="7330964">)</span><span class="op" id="7330965">,</span>&nbsp;<span class="string" id="7330967">&#34;payload&#34;</span><span class="op" id="7330976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7330979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7330982">if</span>&nbsp;<span class="ident" id="7330985">r</span><span class="op" id="7330986">.</span><span class="ident" id="7330987">Comment</span>&nbsp;<span class="op" id="7330995">!=</span>&nbsp;<span class="string" id="7330998">&#34;comment&#34;</span>&nbsp;<span class="op" id="7331008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331012">t</span><span class="op" id="7331013">.</span><span class="ident" id="7331014">Fatalf</span><span class="op" id="7331020">(</span><span class="string" id="7331021">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7331045">,</span>&nbsp;<span class="ident" id="7331047">r</span><span class="op" id="7331048">.</span><span class="ident" id="7331049">Comment</span><span class="op" id="7331056">,</span>&nbsp;<span class="string" id="7331058">&#34;comment&#34;</span><span class="op" id="7331067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331070">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331073">if</span>&nbsp;<span class="builtintype" id="7331076">string</span><span class="op" id="7331082">(</span><span class="ident" id="7331083">r</span><span class="op" id="7331084">.</span><span class="ident" id="7331085">Extra</span><span class="op" id="7331090">)</span>&nbsp;<span class="op" id="7331092">!=</span>&nbsp;<span class="string" id="7331095">&#34;extra&#34;</span>&nbsp;<span class="op" id="7331103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331107">t</span><span class="op" id="7331108">.</span><span class="ident" id="7331109">Fatalf</span><span class="op" id="7331115">(</span><span class="string" id="7331116">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7331138">,</span>&nbsp;<span class="ident" id="7331140">r</span><span class="op" id="7331141">.</span><span class="ident" id="7331142">Extra</span><span class="op" id="7331147">,</span>&nbsp;<span class="string" id="7331149">&#34;extra&#34;</span><span class="op" id="7331156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331162">if</span>&nbsp;<span class="ident" id="7331165">r</span><span class="op" id="7331166">.</span><span class="ident" id="7331167">ModTime</span><span class="op" id="7331174">.</span><span class="ident" id="7331175">Unix</span><span class="op" id="7331179">(</span><span class="op" id="7331180">)</span>&nbsp;<span class="op" id="7331182">!=</span>&nbsp;<span class="num" id="7331185">1e8</span>&nbsp;<span class="op" id="7331189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331193">t</span><span class="op" id="7331194">.</span><span class="ident" id="7331195">Fatalf</span><span class="op" id="7331201">(</span><span class="string" id="7331202">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7331224">,</span>&nbsp;<span class="ident" id="7331226">r</span><span class="op" id="7331227">.</span><span class="ident" id="7331228">ModTime</span><span class="op" id="7331235">.</span><span class="ident" id="7331236">Unix</span><span class="op" id="7331240">(</span><span class="op" id="7331241">)</span><span class="op" id="7331242">,</span>&nbsp;<span class="builtintype" id="7331244">uint32</span><span class="op" id="7331250">(</span><span class="num" id="7331251">1e8</span><span class="op" id="7331254">)</span><span class="op" id="7331255">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331261">if</span>&nbsp;<span class="ident" id="7331264">r</span><span class="op" id="7331265">.</span><span class="ident" id="7331266">Name</span>&nbsp;<span class="op" id="7331271">!=</span>&nbsp;<span class="string" id="7331274">&#34;name&#34;</span>&nbsp;<span class="op" id="7331281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331285">t</span><span class="op" id="7331286">.</span><span class="ident" id="7331287">Fatalf</span><span class="op" id="7331293">(</span><span class="string" id="7331294">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7331315">,</span>&nbsp;<span class="ident" id="7331317">r</span><span class="op" id="7331318">.</span><span class="ident" id="7331319">Name</span><span class="op" id="7331323">,</span>&nbsp;<span class="string" id="7331325">&#34;name&#34;</span><span class="op" id="7331331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331337">if</span>&nbsp;<span class="ident" id="7331340">err</span>&nbsp;<span class="op" id="7331344">:=</span>&nbsp;<span class="ident" id="7331347">r</span><span class="op" id="7331348">.</span><span class="ident" id="7331349">Close</span><span class="op" id="7331354">(</span><span class="op" id="7331355">)</span><span class="op" id="7331356">;</span>&nbsp;<span class="ident" id="7331358">err</span>&nbsp;<span class="op" id="7331362">!=</span>&nbsp;<span class="builtintype" id="7331365">nil</span>&nbsp;<span class="op" id="7331369">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331373">t</span><span class="op" id="7331374">.</span><span class="ident" id="7331375">Fatalf</span><span class="op" id="7331381">(</span><span class="string" id="7331382">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7331400">,</span>&nbsp;<span class="ident" id="7331402">err</span><span class="op" id="7331405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331408">}</span><br>
<span class="lineno"></span><span class="op" id="7331410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7331413">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="7331492">func</span>&nbsp;<span class="ident" id="7331497">TestLatin1</span><span class="op" id="7331507">(</span><span class="ident" id="7331508">t</span>&nbsp;<span class="op" id="7331510">*</span><span class="ident" id="7331511">testing</span><span class="op" id="7331518">.</span><span class="ident" id="7331519">T</span><span class="op" id="7331520">)</span>&nbsp;<span class="op" id="7331522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331525">latin1</span>&nbsp;<span class="op" id="7331532">:=</span>&nbsp;<span class="op" id="7331535">[</span><span class="op" id="7331536">]</span><span class="builtintype" id="7331537">byte</span><span class="op" id="7331541">{</span><span class="num" id="7331542">0xc4</span><span class="op" id="7331546">,</span>&nbsp;<span class="string" id="7331548">&#39;u&#39;</span><span class="op" id="7331551">,</span>&nbsp;<span class="num" id="7331553">0xdf</span><span class="op" id="7331557">,</span>&nbsp;<span class="string" id="7331559">&#39;e&#39;</span><span class="op" id="7331562">,</span>&nbsp;<span class="string" id="7331564">&#39;r&#39;</span><span class="op" id="7331567">,</span>&nbsp;<span class="string" id="7331569">&#39;u&#39;</span><span class="op" id="7331572">,</span>&nbsp;<span class="string" id="7331574">&#39;n&#39;</span><span class="op" id="7331577">,</span>&nbsp;<span class="string" id="7331579">&#39;g&#39;</span><span class="op" id="7331582">,</span>&nbsp;<span class="num" id="7331584">0</span><span class="op" id="7331585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331588">utf8</span>&nbsp;<span class="op" id="7331593">:=</span>&nbsp;<span class="string" id="7331596">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331610">z</span>&nbsp;<span class="op" id="7331612">:=</span>&nbsp;<span class="ident" id="7331615">Reader</span><span class="op" id="7331621">{</span><span class="ident" id="7331622">r</span><span class="op" id="7331623">:</span>&nbsp;<span class="ident" id="7331625">bufio</span><span class="op" id="7331630">.</span><span class="ident" id="7331631">NewReader</span><span class="op" id="7331640">(</span><span class="ident" id="7331641">bytes</span><span class="op" id="7331646">.</span><span class="ident" id="7331647">NewReader</span><span class="op" id="7331656">(</span><span class="ident" id="7331657">latin1</span><span class="op" id="7331663">)</span><span class="op" id="7331664">)</span><span class="op" id="7331665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331668">s</span><span class="op" id="7331669">,</span>&nbsp;<span class="ident" id="7331671">err</span>&nbsp;<span class="op" id="7331675">:=</span>&nbsp;<span class="ident" id="7331678">z</span><span class="op" id="7331679">.</span><span class="ident" id="7331680">readString</span><span class="op" id="7331690">(</span><span class="op" id="7331691">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331694">if</span>&nbsp;<span class="ident" id="7331697">err</span>&nbsp;<span class="op" id="7331701">!=</span>&nbsp;<span class="builtintype" id="7331704">nil</span>&nbsp;<span class="op" id="7331708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331712">t</span><span class="op" id="7331713">.</span><span class="ident" id="7331714">Fatalf</span><span class="op" id="7331720">(</span><span class="string" id="7331721">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="7331737">,</span>&nbsp;<span class="ident" id="7331739">err</span><span class="op" id="7331742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331748">if</span>&nbsp;<span class="ident" id="7331751">s</span>&nbsp;<span class="op" id="7331753">!=</span>&nbsp;<span class="ident" id="7331756">utf8</span>&nbsp;<span class="op" id="7331761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331765">t</span><span class="op" id="7331766">.</span><span class="ident" id="7331767">Fatalf</span><span class="op" id="7331773">(</span><span class="string" id="7331774">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7331805">,</span>&nbsp;<span class="ident" id="7331807">s</span><span class="op" id="7331808">,</span>&nbsp;<span class="ident" id="7331810">utf8</span><span class="op" id="7331814">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331821">buf</span>&nbsp;<span class="op" id="7331825">:=</span>&nbsp;<span class="ident" id="7331828">bytes</span><span class="op" id="7331833">.</span><span class="ident" id="7331834">NewBuffer</span><span class="op" id="7331843">(</span><span class="builtinfunc" id="7331844">make</span><span class="op" id="7331848">(</span><span class="op" id="7331849">[</span><span class="op" id="7331850">]</span><span class="builtintype" id="7331851">byte</span><span class="op" id="7331855">,</span>&nbsp;<span class="num" id="7331857">0</span><span class="op" id="7331858">,</span>&nbsp;<span class="builtinfunc" id="7331860">len</span><span class="op" id="7331863">(</span><span class="ident" id="7331864">latin1</span><span class="op" id="7331870">)</span><span class="op" id="7331871">)</span><span class="op" id="7331872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331875">c</span>&nbsp;<span class="op" id="7331877">:=</span>&nbsp;<span class="ident" id="7331880">Writer</span><span class="op" id="7331886">{</span><span class="ident" id="7331887">w</span><span class="op" id="7331888">:</span>&nbsp;<span class="ident" id="7331890">buf</span><span class="op" id="7331893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331896">if</span>&nbsp;<span class="ident" id="7331899">err</span>&nbsp;<span class="op" id="7331903">=</span>&nbsp;<span class="ident" id="7331905">c</span><span class="op" id="7331906">.</span><span class="ident" id="7331907">writeString</span><span class="op" id="7331918">(</span><span class="ident" id="7331919">utf8</span><span class="op" id="7331923">)</span><span class="op" id="7331924">;</span>&nbsp;<span class="ident" id="7331926">err</span>&nbsp;<span class="op" id="7331930">!=</span>&nbsp;<span class="builtintype" id="7331933">nil</span>&nbsp;<span class="op" id="7331937">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331941">t</span><span class="op" id="7331942">.</span><span class="ident" id="7331943">Fatalf</span><span class="op" id="7331949">(</span><span class="string" id="7331950">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="7331967">,</span>&nbsp;<span class="ident" id="7331969">err</span><span class="op" id="7331972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7331975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331978">s</span>&nbsp;<span class="op" id="7331980">=</span>&nbsp;<span class="ident" id="7331982">buf</span><span class="op" id="7331985">.</span><span class="ident" id="7331986">String</span><span class="op" id="7331992">(</span><span class="op" id="7331993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7331996">if</span>&nbsp;<span class="ident" id="7331999">s</span>&nbsp;<span class="op" id="7332001">!=</span>&nbsp;<span class="builtintype" id="7332004">string</span><span class="op" id="7332010">(</span><span class="ident" id="7332011">latin1</span><span class="op" id="7332017">)</span>&nbsp;<span class="op" id="7332019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332023">t</span><span class="op" id="7332024">.</span><span class="ident" id="7332025">Fatalf</span><span class="op" id="7332031">(</span><span class="string" id="7332032">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7332062">,</span>&nbsp;<span class="ident" id="7332064">s</span><span class="op" id="7332065">,</span>&nbsp;<span class="builtintype" id="7332067">string</span><span class="op" id="7332073">(</span><span class="ident" id="7332074">latin1</span><span class="op" id="7332080">)</span><span class="op" id="7332081">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332084">}</span><br>
<span class="lineno"></span><span class="op" id="7332086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7332089">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="7332165">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="7332191">func</span>&nbsp;<span class="ident" id="7332196">TestLatin1RoundTrip</span><span class="op" id="7332215">(</span><span class="ident" id="7332216">t</span>&nbsp;<span class="op" id="7332218">*</span><span class="ident" id="7332219">testing</span><span class="op" id="7332226">.</span><span class="ident" id="7332227">T</span><span class="op" id="7332228">)</span>&nbsp;<span class="op" id="7332230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332233">testCases</span>&nbsp;<span class="op" id="7332243">:=</span>&nbsp;<span class="op" id="7332246">[</span><span class="op" id="7332247">]</span><span class="keyword" id="7332248">struct</span>&nbsp;<span class="op" id="7332255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332259">name</span>&nbsp;<span class="builtintype" id="7332264">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332273">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7332278">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332284">}</span><span class="op" id="7332285">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332289">{</span><span class="string" id="7332290">&#34;&#34;</span><span class="op" id="7332292">,</span>&nbsp;<span class="builtintype" id="7332294">true</span><span class="op" id="7332298">}</span><span class="op" id="7332299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332303">{</span><span class="string" id="7332304">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="7332317">,</span>&nbsp;<span class="builtintype" id="7332319">true</span><span class="op" id="7332323">}</span><span class="op" id="7332324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332328">{</span><span class="string" id="7332329">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="7332359">,</span>&nbsp;<span class="builtintype" id="7332361">false</span><span class="op" id="7332366">}</span><span class="op" id="7332367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332371">{</span><span class="string" id="7332372">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="7332401">,</span>&nbsp;<span class="builtintype" id="7332403">false</span><span class="op" id="7332408">}</span><span class="op" id="7332409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332413">{</span><span class="string" id="7332414">&#34;\x00\x00\x00&#34;</span><span class="op" id="7332428">,</span>&nbsp;<span class="builtintype" id="7332430">false</span><span class="op" id="7332435">}</span><span class="op" id="7332436">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332440">{</span><span class="string" id="7332441">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="7332472">,</span>&nbsp;<span class="builtintype" id="7332474">true</span><span class="op" id="7332478">}</span><span class="op" id="7332479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332483">{</span><span class="string" id="7332484">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="7332525">,</span>&nbsp;<span class="builtintype" id="7332527">false</span><span class="op" id="7332532">}</span><span class="op" id="7332533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332537">{</span><span class="string" id="7332538">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="7332562">,</span>&nbsp;<span class="builtintype" id="7332564">false</span><span class="op" id="7332569">}</span><span class="op" id="7332570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332574">{</span><span class="string" id="7332575">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="7332604">,</span>&nbsp;<span class="builtintype" id="7332606">false</span><span class="op" id="7332611">}</span><span class="op" id="7332612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332616">{</span><span class="string" id="7332617">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="7332649">,</span>&nbsp;<span class="builtintype" id="7332651">false</span><span class="op" id="7332656">}</span><span class="op" id="7332657">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332663">for</span>&nbsp;<span class="ident" id="7332667">_</span><span class="op" id="7332668">,</span>&nbsp;<span class="ident" id="7332670">tc</span>&nbsp;<span class="op" id="7332673">:=</span>&nbsp;<span class="keyword" id="7332676">range</span>&nbsp;<span class="ident" id="7332682">testCases</span>&nbsp;<span class="op" id="7332692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332696">buf</span>&nbsp;<span class="op" id="7332700">:=</span>&nbsp;<span class="builtinfunc" id="7332703">new</span><span class="op" id="7332706">(</span><span class="ident" id="7332707">bytes</span><span class="op" id="7332712">.</span><span class="ident" id="7332713">Buffer</span><span class="op" id="7332719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332724">w</span>&nbsp;<span class="op" id="7332726">:=</span>&nbsp;<span class="ident" id="7332729">NewWriter</span><span class="op" id="7332738">(</span><span class="ident" id="7332739">buf</span><span class="op" id="7332742">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332746">w</span><span class="op" id="7332747">.</span><span class="ident" id="7332748">Name</span>&nbsp;<span class="op" id="7332753">=</span>&nbsp;<span class="ident" id="7332755">tc</span><span class="op" id="7332757">.</span><span class="ident" id="7332758">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332765">err</span>&nbsp;<span class="op" id="7332769">:=</span>&nbsp;<span class="ident" id="7332772">w</span><span class="op" id="7332773">.</span><span class="ident" id="7332774">Close</span><span class="op" id="7332779">(</span><span class="op" id="7332780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332784">if</span>&nbsp;<span class="op" id="7332787">(</span><span class="ident" id="7332788">err</span>&nbsp;<span class="op" id="7332792">==</span>&nbsp;<span class="builtintype" id="7332795">nil</span><span class="op" id="7332798">)</span>&nbsp;<span class="op" id="7332800">!=</span>&nbsp;<span class="ident" id="7332803">tc</span><span class="op" id="7332805">.</span><span class="ident" id="7332806">ok</span>&nbsp;<span class="op" id="7332809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332814">t</span><span class="op" id="7332815">.</span><span class="ident" id="7332816">Errorf</span><span class="op" id="7332822">(</span><span class="string" id="7332823">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7332858">,</span>&nbsp;<span class="ident" id="7332860">tc</span><span class="op" id="7332862">.</span><span class="ident" id="7332863">name</span><span class="op" id="7332867">,</span>&nbsp;<span class="ident" id="7332869">err</span><span class="op" id="7332872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332877">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332892">if</span>&nbsp;<span class="op" id="7332895">!</span><span class="ident" id="7332896">tc</span><span class="op" id="7332898">.</span><span class="ident" id="7332899">ok</span>&nbsp;<span class="op" id="7332902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332907">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7332918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332923">r</span><span class="op" id="7332924">,</span>&nbsp;<span class="ident" id="7332926">err</span>&nbsp;<span class="op" id="7332930">:=</span>&nbsp;<span class="ident" id="7332933">NewReader</span><span class="op" id="7332942">(</span><span class="ident" id="7332943">buf</span><span class="op" id="7332946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7332950">if</span>&nbsp;<span class="ident" id="7332953">err</span>&nbsp;<span class="op" id="7332957">!=</span>&nbsp;<span class="builtintype" id="7332960">nil</span>&nbsp;<span class="op" id="7332964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7332969">t</span><span class="op" id="7332970">.</span><span class="ident" id="7332971">Errorf</span><span class="op" id="7332977">(</span><span class="string" id="7332978">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7332993">,</span>&nbsp;<span class="ident" id="7332995">err</span><span class="op" id="7332998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333003">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333014">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333018">_</span><span class="op" id="7333019">,</span>&nbsp;<span class="ident" id="7333021">err</span>&nbsp;<span class="op" id="7333025">=</span>&nbsp;<span class="ident" id="7333027">ioutil</span><span class="op" id="7333033">.</span><span class="ident" id="7333034">ReadAll</span><span class="op" id="7333041">(</span><span class="ident" id="7333042">r</span><span class="op" id="7333043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333047">if</span>&nbsp;<span class="ident" id="7333050">err</span>&nbsp;<span class="op" id="7333054">!=</span>&nbsp;<span class="builtintype" id="7333057">nil</span>&nbsp;<span class="op" id="7333061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333066">t</span><span class="op" id="7333067">.</span><span class="ident" id="7333068">Errorf</span><span class="op" id="7333074">(</span><span class="string" id="7333075">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7333088">,</span>&nbsp;<span class="ident" id="7333090">err</span><span class="op" id="7333093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333109">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333113">if</span>&nbsp;<span class="ident" id="7333116">r</span><span class="op" id="7333117">.</span><span class="ident" id="7333118">Name</span>&nbsp;<span class="op" id="7333123">!=</span>&nbsp;<span class="ident" id="7333126">tc</span><span class="op" id="7333128">.</span><span class="ident" id="7333129">name</span>&nbsp;<span class="op" id="7333134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333139">t</span><span class="op" id="7333140">.</span><span class="ident" id="7333141">Errorf</span><span class="op" id="7333147">(</span><span class="string" id="7333148">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7333169">,</span>&nbsp;<span class="ident" id="7333171">r</span><span class="op" id="7333172">.</span><span class="ident" id="7333173">Name</span><span class="op" id="7333177">,</span>&nbsp;<span class="ident" id="7333179">tc</span><span class="op" id="7333181">.</span><span class="ident" id="7333182">name</span><span class="op" id="7333186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333191">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333206">if</span>&nbsp;<span class="ident" id="7333209">err</span>&nbsp;<span class="op" id="7333213">:=</span>&nbsp;<span class="ident" id="7333216">r</span><span class="op" id="7333217">.</span><span class="ident" id="7333218">Close</span><span class="op" id="7333223">(</span><span class="op" id="7333224">)</span><span class="op" id="7333225">;</span>&nbsp;<span class="ident" id="7333227">err</span>&nbsp;<span class="op" id="7333231">!=</span>&nbsp;<span class="builtintype" id="7333234">nil</span>&nbsp;<span class="op" id="7333238">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333243">t</span><span class="op" id="7333244">.</span><span class="ident" id="7333245">Errorf</span><span class="op" id="7333251">(</span><span class="string" id="7333252">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7333270">,</span>&nbsp;<span class="ident" id="7333272">err</span><span class="op" id="7333275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333280">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333294">}</span><br>
<span class="lineno"></span><span class="op" id="7333296">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7333299">func</span>&nbsp;<span class="ident" id="7333304">TestWriterFlush</span><span class="op" id="7333319">(</span><span class="ident" id="7333320">t</span>&nbsp;<span class="op" id="7333322">*</span><span class="ident" id="7333323">testing</span><span class="op" id="7333330">.</span><span class="ident" id="7333331">T</span><span class="op" id="7333332">)</span>&nbsp;<span class="op" id="7333334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333337">buf</span>&nbsp;<span class="op" id="7333341">:=</span>&nbsp;<span class="builtinfunc" id="7333344">new</span><span class="op" id="7333347">(</span><span class="ident" id="7333348">bytes</span><span class="op" id="7333353">.</span><span class="ident" id="7333354">Buffer</span><span class="op" id="7333360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333364">w</span>&nbsp;<span class="op" id="7333366">:=</span>&nbsp;<span class="ident" id="7333369">NewWriter</span><span class="op" id="7333378">(</span><span class="ident" id="7333379">buf</span><span class="op" id="7333382">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333385">w</span><span class="op" id="7333386">.</span><span class="ident" id="7333387">Comment</span>&nbsp;<span class="op" id="7333395">=</span>&nbsp;<span class="string" id="7333397">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333408">w</span><span class="op" id="7333409">.</span><span class="ident" id="7333410">Extra</span>&nbsp;<span class="op" id="7333416">=</span>&nbsp;<span class="op" id="7333418">[</span><span class="op" id="7333419">]</span><span class="builtintype" id="7333420">byte</span><span class="op" id="7333424">(</span><span class="string" id="7333425">&#34;extra&#34;</span><span class="op" id="7333432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333435">w</span><span class="op" id="7333436">.</span><span class="ident" id="7333437">ModTime</span>&nbsp;<span class="op" id="7333445">=</span>&nbsp;<span class="ident" id="7333447">time</span><span class="op" id="7333451">.</span><span class="ident" id="7333452">Unix</span><span class="op" id="7333456">(</span><span class="num" id="7333457">1e8</span><span class="op" id="7333460">,</span>&nbsp;<span class="num" id="7333462">0</span><span class="op" id="7333463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333466">w</span><span class="op" id="7333467">.</span><span class="ident" id="7333468">Name</span>&nbsp;<span class="op" id="7333473">=</span>&nbsp;<span class="string" id="7333475">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333484">n0</span>&nbsp;<span class="op" id="7333487">:=</span>&nbsp;<span class="ident" id="7333490">buf</span><span class="op" id="7333493">.</span><span class="ident" id="7333494">Len</span><span class="op" id="7333497">(</span><span class="op" id="7333498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333501">if</span>&nbsp;<span class="ident" id="7333504">n0</span>&nbsp;<span class="op" id="7333507">!=</span>&nbsp;<span class="num" id="7333510">0</span>&nbsp;<span class="op" id="7333512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333516">t</span><span class="op" id="7333517">.</span><span class="ident" id="7333518">Fatalf</span><span class="op" id="7333524">(</span><span class="string" id="7333525">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7333565">,</span>&nbsp;<span class="ident" id="7333567">n0</span><span class="op" id="7333569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333576">if</span>&nbsp;<span class="ident" id="7333579">err</span>&nbsp;<span class="op" id="7333583">:=</span>&nbsp;<span class="ident" id="7333586">w</span><span class="op" id="7333587">.</span><span class="ident" id="7333588">Flush</span><span class="op" id="7333593">(</span><span class="op" id="7333594">)</span><span class="op" id="7333595">;</span>&nbsp;<span class="ident" id="7333597">err</span>&nbsp;<span class="op" id="7333601">!=</span>&nbsp;<span class="builtintype" id="7333604">nil</span>&nbsp;<span class="op" id="7333608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333612">t</span><span class="op" id="7333613">.</span><span class="ident" id="7333614">Fatal</span><span class="op" id="7333619">(</span><span class="ident" id="7333620">err</span><span class="op" id="7333623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333630">n1</span>&nbsp;<span class="op" id="7333633">:=</span>&nbsp;<span class="ident" id="7333636">buf</span><span class="op" id="7333639">.</span><span class="ident" id="7333640">Len</span><span class="op" id="7333643">(</span><span class="op" id="7333644">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333647">if</span>&nbsp;<span class="ident" id="7333650">n1</span>&nbsp;<span class="op" id="7333653">==</span>&nbsp;<span class="num" id="7333656">0</span>&nbsp;<span class="op" id="7333658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333662">t</span><span class="op" id="7333663">.</span><span class="ident" id="7333664">Fatal</span><span class="op" id="7333669">(</span><span class="string" id="7333670">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="7333697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333704">w</span><span class="op" id="7333705">.</span><span class="ident" id="7333706">Write</span><span class="op" id="7333711">(</span><span class="op" id="7333712">[</span><span class="op" id="7333713">]</span><span class="builtintype" id="7333714">byte</span><span class="op" id="7333718">(</span><span class="string" id="7333719">&#34;x&#34;</span><span class="op" id="7333722">)</span><span class="op" id="7333723">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333727">n2</span>&nbsp;<span class="op" id="7333730">:=</span>&nbsp;<span class="ident" id="7333733">buf</span><span class="op" id="7333736">.</span><span class="ident" id="7333737">Len</span><span class="op" id="7333740">(</span><span class="op" id="7333741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333744">if</span>&nbsp;<span class="ident" id="7333747">n1</span>&nbsp;<span class="op" id="7333750">!=</span>&nbsp;<span class="ident" id="7333753">n2</span>&nbsp;<span class="op" id="7333756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333760">t</span><span class="op" id="7333761">.</span><span class="ident" id="7333762">Fatalf</span><span class="op" id="7333768">(</span><span class="string" id="7333769">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="7333842">,</span>&nbsp;<span class="ident" id="7333844">n1</span><span class="op" id="7333846">,</span>&nbsp;<span class="ident" id="7333848">n2</span><span class="op" id="7333850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333853">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333857">if</span>&nbsp;<span class="ident" id="7333860">err</span>&nbsp;<span class="op" id="7333864">:=</span>&nbsp;<span class="ident" id="7333867">w</span><span class="op" id="7333868">.</span><span class="ident" id="7333869">Flush</span><span class="op" id="7333874">(</span><span class="op" id="7333875">)</span><span class="op" id="7333876">;</span>&nbsp;<span class="ident" id="7333878">err</span>&nbsp;<span class="op" id="7333882">!=</span>&nbsp;<span class="builtintype" id="7333885">nil</span>&nbsp;<span class="op" id="7333889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333893">t</span><span class="op" id="7333894">.</span><span class="ident" id="7333895">Fatal</span><span class="op" id="7333900">(</span><span class="ident" id="7333901">err</span><span class="op" id="7333904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333911">n3</span>&nbsp;<span class="op" id="7333914">:=</span>&nbsp;<span class="ident" id="7333917">buf</span><span class="op" id="7333920">.</span><span class="ident" id="7333921">Len</span><span class="op" id="7333924">(</span><span class="op" id="7333925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7333928">if</span>&nbsp;<span class="ident" id="7333931">n2</span>&nbsp;<span class="op" id="7333934">==</span>&nbsp;<span class="ident" id="7333937">n3</span>&nbsp;<span class="op" id="7333940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7333944">t</span><span class="op" id="7333945">.</span><span class="ident" id="7333946">Fatal</span><span class="op" id="7333951">(</span><span class="string" id="7333952">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="7333981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7333984">}</span><br>
<span class="lineno"></span><span class="op" id="7333986">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="7333989">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="7334049">func</span>&nbsp;<span class="ident" id="7334054">TestConcat</span><span class="op" id="7334064">(</span><span class="ident" id="7334065">t</span>&nbsp;<span class="op" id="7334067">*</span><span class="ident" id="7334068">testing</span><span class="op" id="7334075">.</span><span class="ident" id="7334076">T</span><span class="op" id="7334077">)</span>&nbsp;<span class="op" id="7334079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7334082">var</span>&nbsp;<span class="ident" id="7334086">buf</span>&nbsp;<span class="ident" id="7334090">bytes</span><span class="op" id="7334095">.</span><span class="ident" id="7334096">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334104">w</span>&nbsp;<span class="op" id="7334106">:=</span>&nbsp;<span class="ident" id="7334109">NewWriter</span><span class="op" id="7334118">(</span><span class="op" id="7334119">&amp;</span><span class="ident" id="7334120">buf</span><span class="op" id="7334123">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334126">w</span><span class="op" id="7334127">.</span><span class="ident" id="7334128">Write</span><span class="op" id="7334133">(</span><span class="op" id="7334134">[</span><span class="op" id="7334135">]</span><span class="builtintype" id="7334136">byte</span><span class="op" id="7334140">(</span><span class="string" id="7334141">&#34;hello&nbsp;&#34;</span><span class="op" id="7334149">)</span><span class="op" id="7334150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334153">w</span><span class="op" id="7334154">.</span><span class="ident" id="7334155">Close</span><span class="op" id="7334160">(</span><span class="op" id="7334161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334164">w</span>&nbsp;<span class="op" id="7334166">=</span>&nbsp;<span class="ident" id="7334168">NewWriter</span><span class="op" id="7334177">(</span><span class="op" id="7334178">&amp;</span><span class="ident" id="7334179">buf</span><span class="op" id="7334182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334185">w</span><span class="op" id="7334186">.</span><span class="ident" id="7334187">Write</span><span class="op" id="7334192">(</span><span class="op" id="7334193">[</span><span class="op" id="7334194">]</span><span class="builtintype" id="7334195">byte</span><span class="op" id="7334199">(</span><span class="string" id="7334200">&#34;world\n&#34;</span><span class="op" id="7334209">)</span><span class="op" id="7334210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334213">w</span><span class="op" id="7334214">.</span><span class="ident" id="7334215">Close</span><span class="op" id="7334220">(</span><span class="op" id="7334221">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334225">r</span><span class="op" id="7334226">,</span>&nbsp;<span class="ident" id="7334228">err</span>&nbsp;<span class="op" id="7334232">:=</span>&nbsp;<span class="ident" id="7334235">NewReader</span><span class="op" id="7334244">(</span><span class="op" id="7334245">&amp;</span><span class="ident" id="7334246">buf</span><span class="op" id="7334249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334252">data</span><span class="op" id="7334256">,</span>&nbsp;<span class="ident" id="7334258">err</span>&nbsp;<span class="op" id="7334262">:=</span>&nbsp;<span class="ident" id="7334265">ioutil</span><span class="op" id="7334271">.</span><span class="ident" id="7334272">ReadAll</span><span class="op" id="7334279">(</span><span class="ident" id="7334280">r</span><span class="op" id="7334281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7334284">if</span>&nbsp;<span class="builtintype" id="7334287">string</span><span class="op" id="7334293">(</span><span class="ident" id="7334294">data</span><span class="op" id="7334298">)</span>&nbsp;<span class="op" id="7334300">!=</span>&nbsp;<span class="string" id="7334303">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="7334319">||</span>&nbsp;<span class="ident" id="7334322">err</span>&nbsp;<span class="op" id="7334326">!=</span>&nbsp;<span class="builtintype" id="7334329">nil</span>&nbsp;<span class="op" id="7334333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334337">t</span><span class="op" id="7334338">.</span><span class="ident" id="7334339">Fatalf</span><span class="op" id="7334345">(</span><span class="string" id="7334346">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="7334378">,</span>&nbsp;<span class="ident" id="7334380">data</span><span class="op" id="7334384">,</span>&nbsp;<span class="ident" id="7334386">err</span><span class="op" id="7334389">,</span>&nbsp;<span class="string" id="7334391">&#34;hello&nbsp;world&#34;</span><span class="op" id="7334404">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7334407">}</span><br>
<span class="lineno"></span><span class="op" id="7334409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7334412">func</span>&nbsp;<span class="ident" id="7334417">TestWriterReset</span><span class="op" id="7334432">(</span><span class="ident" id="7334433">t</span>&nbsp;<span class="op" id="7334435">*</span><span class="ident" id="7334436">testing</span><span class="op" id="7334443">.</span><span class="ident" id="7334444">T</span><span class="op" id="7334445">)</span>&nbsp;<span class="op" id="7334447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334450">buf</span>&nbsp;<span class="op" id="7334454">:=</span>&nbsp;<span class="builtinfunc" id="7334457">new</span><span class="op" id="7334460">(</span><span class="ident" id="7334461">bytes</span><span class="op" id="7334466">.</span><span class="ident" id="7334467">Buffer</span><span class="op" id="7334473">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334476">buf2</span>&nbsp;<span class="op" id="7334481">:=</span>&nbsp;<span class="builtinfunc" id="7334484">new</span><span class="op" id="7334487">(</span><span class="ident" id="7334488">bytes</span><span class="op" id="7334493">.</span><span class="ident" id="7334494">Buffer</span><span class="op" id="7334500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334503">z</span>&nbsp;<span class="op" id="7334505">:=</span>&nbsp;<span class="ident" id="7334508">NewWriter</span><span class="op" id="7334517">(</span><span class="ident" id="7334518">buf</span><span class="op" id="7334521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334524">msg</span>&nbsp;<span class="op" id="7334528">:=</span>&nbsp;<span class="op" id="7334531">[</span><span class="op" id="7334532">]</span><span class="builtintype" id="7334533">byte</span><span class="op" id="7334537">(</span><span class="string" id="7334538">&#34;hello&nbsp;world&#34;</span><span class="op" id="7334551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334554">z</span><span class="op" id="7334555">.</span><span class="ident" id="7334556">Write</span><span class="op" id="7334561">(</span><span class="ident" id="7334562">msg</span><span class="op" id="7334565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334568">z</span><span class="op" id="7334569">.</span><span class="ident" id="7334570">Close</span><span class="op" id="7334575">(</span><span class="op" id="7334576">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334579">z</span><span class="op" id="7334580">.</span><span class="ident" id="7334581">Reset</span><span class="op" id="7334586">(</span><span class="ident" id="7334587">buf2</span><span class="op" id="7334591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334594">z</span><span class="op" id="7334595">.</span><span class="ident" id="7334596">Write</span><span class="op" id="7334601">(</span><span class="ident" id="7334602">msg</span><span class="op" id="7334605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334608">z</span><span class="op" id="7334609">.</span><span class="ident" id="7334610">Close</span><span class="op" id="7334615">(</span><span class="op" id="7334616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7334619">if</span>&nbsp;<span class="ident" id="7334622">buf</span><span class="op" id="7334625">.</span><span class="ident" id="7334626">String</span><span class="op" id="7334632">(</span><span class="op" id="7334633">)</span>&nbsp;<span class="op" id="7334635">!=</span>&nbsp;<span class="ident" id="7334638">buf2</span><span class="op" id="7334642">.</span><span class="ident" id="7334643">String</span><span class="op" id="7334649">(</span><span class="op" id="7334650">)</span>&nbsp;<span class="op" id="7334652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7334656">t</span><span class="op" id="7334657">.</span><span class="ident" id="7334658">Errorf</span><span class="op" id="7334664">(</span><span class="string" id="7334665">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7334696">,</span>&nbsp;<span class="ident" id="7334698">buf2</span><span class="op" id="7334702">.</span><span class="ident" id="7334703">String</span><span class="op" id="7334709">(</span><span class="op" id="7334710">)</span><span class="op" id="7334711">,</span>&nbsp;<span class="ident" id="7334713">buf</span><span class="op" id="7334716">.</span><span class="ident" id="7334717">String</span><span class="op" id="7334723">(</span><span class="op" id="7334724">)</span><span class="op" id="7334725">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7334728">}</span><br>
<span class="lineno"></span><span class="op" id="7334730">}</span>
</div>
</body>
</html>
