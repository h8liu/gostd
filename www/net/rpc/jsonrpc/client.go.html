<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6134045">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6134101">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6134155">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6134206">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="6134275">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6134299">package</span>&nbsp;<span class="ident" id="6134307">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6134316">import</span>&nbsp;<span class="op" id="6134323">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134326">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134343">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134350">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134356">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134363">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6134374">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6134381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6134384">type</span>&nbsp;<span class="ident" id="6134389">clientCodec</span>&nbsp;<span class="keyword" id="6134401">struct</span>&nbsp;<span class="op" id="6134408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134411">dec</span>&nbsp;<span class="op" id="6134415">*</span><span class="ident" id="6134416">json</span><span class="op" id="6134420">.</span><span class="ident" id="6134421">Decoder</span>&nbsp;<span class="comment" id="6134429">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134457">enc</span>&nbsp;<span class="op" id="6134461">*</span><span class="ident" id="6134462">json</span><span class="op" id="6134466">.</span><span class="ident" id="6134467">Encoder</span>&nbsp;<span class="comment" id="6134475">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134503">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6134507">io</span><span class="op" id="6134509">.</span><span class="ident" id="6134510">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134519">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134544">req</span>&nbsp;&nbsp;<span class="ident" id="6134549">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134564">resp</span>&nbsp;<span class="ident" id="6134569">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134586">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134660">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134690">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134755">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134828">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6134836">sync</span><span class="op" id="6134840">.</span><span class="ident" id="6134841">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6134854">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134875">pending</span>&nbsp;<span class="keyword" id="6134883">map</span><span class="op" id="6134886">[</span><span class="ident" id="6134887">uint64</span><span class="op" id="6134893">]</span><span class="builtintype" id="6134894">string</span>&nbsp;<span class="comment" id="6134901">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="6134934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6134937">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="6135009">func</span>&nbsp;<span class="ident" id="6135014">NewClientCodec</span><span class="op" id="6135028">(</span><span class="ident" id="6135029">conn</span>&nbsp;<span class="ident" id="6135034">io</span><span class="op" id="6135036">.</span><span class="ident" id="6135037">ReadWriteCloser</span><span class="op" id="6135052">)</span>&nbsp;<span class="ident" id="6135054">rpc</span><span class="op" id="6135057">.</span><span class="ident" id="6135058">ClientCodec</span>&nbsp;<span class="op" id="6135070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135073">return</span>&nbsp;<span class="op" id="6135080">&amp;</span><span class="ident" id="6135081">clientCodec</span><span class="op" id="6135092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135096">dec</span><span class="op" id="6135099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135105">json</span><span class="op" id="6135109">.</span><span class="ident" id="6135110">NewDecoder</span><span class="op" id="6135120">(</span><span class="ident" id="6135121">conn</span><span class="op" id="6135125">)</span><span class="op" id="6135126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135130">enc</span><span class="op" id="6135133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135139">json</span><span class="op" id="6135143">.</span><span class="ident" id="6135144">NewEncoder</span><span class="op" id="6135154">(</span><span class="ident" id="6135155">conn</span><span class="op" id="6135159">)</span><span class="op" id="6135160">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135164">c</span><span class="op" id="6135165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135173">conn</span><span class="op" id="6135177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135181">pending</span><span class="op" id="6135188">:</span>&nbsp;<span class="builtinfunc" id="6135190">make</span><span class="op" id="6135194">(</span><span class="keyword" id="6135195">map</span><span class="op" id="6135198">[</span><span class="ident" id="6135199">uint64</span><span class="op" id="6135205">]</span><span class="builtintype" id="6135206">string</span><span class="op" id="6135212">)</span><span class="op" id="6135213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6135216">}</span><br>
<span class="lineno"></span><span class="op" id="6135218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6135221">type</span>&nbsp;<span class="ident" id="6135226">clientRequest</span>&nbsp;<span class="keyword" id="6135240">struct</span>&nbsp;<span class="op" id="6135247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135250">Method</span>&nbsp;<span class="builtintype" id="6135257">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135272">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135289">Params</span>&nbsp;<span class="op" id="6135296">[</span><span class="num" id="6135297">1</span><span class="op" id="6135298">]</span><span class="keyword" id="6135299">interface</span><span class="op" id="6135308">{</span><span class="op" id="6135309">}</span>&nbsp;<span class="string" id="6135311">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135328">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135335">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135350">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6135362">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6135365">func</span>&nbsp;<span class="op" id="6135370">(</span><span class="ident" id="6135371">c</span>&nbsp;<span class="op" id="6135373">*</span><span class="ident" id="6135374">clientCodec</span><span class="op" id="6135385">)</span>&nbsp;<span class="ident" id="6135387">WriteRequest</span><span class="op" id="6135399">(</span><span class="ident" id="6135400">r</span>&nbsp;<span class="op" id="6135402">*</span><span class="ident" id="6135403">rpc</span><span class="op" id="6135406">.</span><span class="ident" id="6135407">Request</span><span class="op" id="6135414">,</span>&nbsp;<span class="ident" id="6135416">param</span>&nbsp;<span class="keyword" id="6135422">interface</span><span class="op" id="6135431">{</span><span class="op" id="6135432">}</span><span class="op" id="6135433">)</span>&nbsp;<span class="builtintype" id="6135435">error</span>&nbsp;<span class="op" id="6135441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135444">c</span><span class="op" id="6135445">.</span><span class="ident" id="6135446">mutex</span><span class="op" id="6135451">.</span><span class="ident" id="6135452">Lock</span><span class="op" id="6135456">(</span><span class="op" id="6135457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135460">c</span><span class="op" id="6135461">.</span><span class="ident" id="6135462">pending</span><span class="op" id="6135469">[</span><span class="ident" id="6135470">r</span><span class="op" id="6135471">.</span><span class="ident" id="6135472">Seq</span><span class="op" id="6135475">]</span>&nbsp;<span class="op" id="6135477">=</span>&nbsp;<span class="ident" id="6135479">r</span><span class="op" id="6135480">.</span><span class="ident" id="6135481">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135496">c</span><span class="op" id="6135497">.</span><span class="ident" id="6135498">mutex</span><span class="op" id="6135503">.</span><span class="ident" id="6135504">Unlock</span><span class="op" id="6135510">(</span><span class="op" id="6135511">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135514">c</span><span class="op" id="6135515">.</span><span class="ident" id="6135516">req</span><span class="op" id="6135519">.</span><span class="ident" id="6135520">Method</span>&nbsp;<span class="op" id="6135527">=</span>&nbsp;<span class="ident" id="6135529">r</span><span class="op" id="6135530">.</span><span class="ident" id="6135531">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135546">c</span><span class="op" id="6135547">.</span><span class="ident" id="6135548">req</span><span class="op" id="6135551">.</span><span class="ident" id="6135552">Params</span><span class="op" id="6135558">[</span><span class="num" id="6135559">0</span><span class="op" id="6135560">]</span>&nbsp;<span class="op" id="6135562">=</span>&nbsp;<span class="ident" id="6135564">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135571">c</span><span class="op" id="6135572">.</span><span class="ident" id="6135573">req</span><span class="op" id="6135576">.</span><span class="ident" id="6135577">Id</span>&nbsp;<span class="op" id="6135580">=</span>&nbsp;<span class="ident" id="6135582">r</span><span class="op" id="6135583">.</span><span class="ident" id="6135584">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135589">return</span>&nbsp;<span class="ident" id="6135596">c</span><span class="op" id="6135597">.</span><span class="ident" id="6135598">enc</span><span class="op" id="6135601">.</span><span class="ident" id="6135602">Encode</span><span class="op" id="6135608">(</span><span class="op" id="6135609">&amp;</span><span class="ident" id="6135610">c</span><span class="op" id="6135611">.</span><span class="ident" id="6135612">req</span><span class="op" id="6135615">)</span><br>
<span class="lineno"></span><span class="op" id="6135617">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6135620">type</span>&nbsp;<span class="ident" id="6135625">clientResponse</span>&nbsp;<span class="keyword" id="6135640">struct</span>&nbsp;<span class="op" id="6135647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135650">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6135657">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135674">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135687">Result</span>&nbsp;<span class="op" id="6135694">*</span><span class="ident" id="6135695">json</span><span class="op" id="6135699">.</span><span class="ident" id="6135700">RawMessage</span>&nbsp;<span class="string" id="6135711">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135728">Error</span>&nbsp;&nbsp;<span class="keyword" id="6135735">interface</span><span class="op" id="6135744">{</span><span class="op" id="6135745">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135752">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="6135767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6135770">func</span>&nbsp;<span class="op" id="6135775">(</span><span class="ident" id="6135776">r</span>&nbsp;<span class="op" id="6135778">*</span><span class="ident" id="6135779">clientResponse</span><span class="op" id="6135793">)</span>&nbsp;<span class="ident" id="6135795">reset</span><span class="op" id="6135800">(</span><span class="op" id="6135801">)</span>&nbsp;<span class="op" id="6135803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135806">r</span><span class="op" id="6135807">.</span><span class="ident" id="6135808">Id</span>&nbsp;<span class="op" id="6135811">=</span>&nbsp;<span class="num" id="6135813">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135816">r</span><span class="op" id="6135817">.</span><span class="ident" id="6135818">Result</span>&nbsp;<span class="op" id="6135825">=</span>&nbsp;<span class="ident" id="6135827">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135832">r</span><span class="op" id="6135833">.</span><span class="ident" id="6135834">Error</span>&nbsp;<span class="op" id="6135840">=</span>&nbsp;<span class="ident" id="6135842">nil</span><br>
<span class="lineno"></span><span class="op" id="6135846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6135849">func</span>&nbsp;<span class="op" id="6135854">(</span><span class="ident" id="6135855">c</span>&nbsp;<span class="op" id="6135857">*</span><span class="ident" id="6135858">clientCodec</span><span class="op" id="6135869">)</span>&nbsp;<span class="ident" id="6135871">ReadResponseHeader</span><span class="op" id="6135889">(</span><span class="ident" id="6135890">r</span>&nbsp;<span class="op" id="6135892">*</span><span class="ident" id="6135893">rpc</span><span class="op" id="6135896">.</span><span class="ident" id="6135897">Response</span><span class="op" id="6135905">)</span>&nbsp;<span class="builtintype" id="6135907">error</span>&nbsp;<span class="op" id="6135913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135916">c</span><span class="op" id="6135917">.</span><span class="ident" id="6135918">resp</span><span class="op" id="6135922">.</span><span class="ident" id="6135923">reset</span><span class="op" id="6135928">(</span><span class="op" id="6135929">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135932">if</span>&nbsp;<span class="ident" id="6135935">err</span>&nbsp;<span class="op" id="6135939">:=</span>&nbsp;<span class="ident" id="6135942">c</span><span class="op" id="6135943">.</span><span class="ident" id="6135944">dec</span><span class="op" id="6135947">.</span><span class="ident" id="6135948">Decode</span><span class="op" id="6135954">(</span><span class="op" id="6135955">&amp;</span><span class="ident" id="6135956">c</span><span class="op" id="6135957">.</span><span class="ident" id="6135958">resp</span><span class="op" id="6135962">)</span><span class="op" id="6135963">;</span>&nbsp;<span class="ident" id="6135965">err</span>&nbsp;<span class="op" id="6135969">!=</span>&nbsp;<span class="ident" id="6135972">nil</span>&nbsp;<span class="op" id="6135976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135980">return</span>&nbsp;<span class="ident" id="6135987">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6135992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135996">c</span><span class="op" id="6135997">.</span><span class="ident" id="6135998">mutex</span><span class="op" id="6136003">.</span><span class="ident" id="6136004">Lock</span><span class="op" id="6136008">(</span><span class="op" id="6136009">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136012">r</span><span class="op" id="6136013">.</span><span class="ident" id="6136014">ServiceMethod</span>&nbsp;<span class="op" id="6136028">=</span>&nbsp;<span class="ident" id="6136030">c</span><span class="op" id="6136031">.</span><span class="ident" id="6136032">pending</span><span class="op" id="6136039">[</span><span class="ident" id="6136040">c</span><span class="op" id="6136041">.</span><span class="ident" id="6136042">resp</span><span class="op" id="6136046">.</span><span class="ident" id="6136047">Id</span><span class="op" id="6136049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6136052">delete</span><span class="op" id="6136058">(</span><span class="ident" id="6136059">c</span><span class="op" id="6136060">.</span><span class="ident" id="6136061">pending</span><span class="op" id="6136068">,</span>&nbsp;<span class="ident" id="6136070">c</span><span class="op" id="6136071">.</span><span class="ident" id="6136072">resp</span><span class="op" id="6136076">.</span><span class="ident" id="6136077">Id</span><span class="op" id="6136079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136082">c</span><span class="op" id="6136083">.</span><span class="ident" id="6136084">mutex</span><span class="op" id="6136089">.</span><span class="ident" id="6136090">Unlock</span><span class="op" id="6136096">(</span><span class="op" id="6136097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136101">r</span><span class="op" id="6136102">.</span><span class="ident" id="6136103">Error</span>&nbsp;<span class="op" id="6136109">=</span>&nbsp;<span class="string" id="6136111">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136115">r</span><span class="op" id="6136116">.</span><span class="ident" id="6136117">Seq</span>&nbsp;<span class="op" id="6136121">=</span>&nbsp;<span class="ident" id="6136123">c</span><span class="op" id="6136124">.</span><span class="ident" id="6136125">resp</span><span class="op" id="6136129">.</span><span class="ident" id="6136130">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136134">if</span>&nbsp;<span class="ident" id="6136137">c</span><span class="op" id="6136138">.</span><span class="ident" id="6136139">resp</span><span class="op" id="6136143">.</span><span class="ident" id="6136144">Error</span>&nbsp;<span class="op" id="6136150">!=</span>&nbsp;<span class="ident" id="6136153">nil</span>&nbsp;<span class="op" id="6136157">||</span>&nbsp;<span class="ident" id="6136160">c</span><span class="op" id="6136161">.</span><span class="ident" id="6136162">resp</span><span class="op" id="6136166">.</span><span class="ident" id="6136167">Result</span>&nbsp;<span class="op" id="6136174">==</span>&nbsp;<span class="ident" id="6136177">nil</span>&nbsp;<span class="op" id="6136181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136185">x</span><span class="op" id="6136186">,</span>&nbsp;<span class="ident" id="6136188">ok</span>&nbsp;<span class="op" id="6136191">:=</span>&nbsp;<span class="ident" id="6136194">c</span><span class="op" id="6136195">.</span><span class="ident" id="6136196">resp</span><span class="op" id="6136200">.</span><span class="ident" id="6136201">Error</span><span class="op" id="6136206">.</span><span class="op" id="6136207">(</span><span class="builtintype" id="6136208">string</span><span class="op" id="6136214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136218">if</span>&nbsp;<span class="op" id="6136221">!</span><span class="ident" id="6136222">ok</span>&nbsp;<span class="op" id="6136225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136230">return</span>&nbsp;<span class="ident" id="6136237">fmt</span><span class="op" id="6136240">.</span><span class="ident" id="6136241">Errorf</span><span class="op" id="6136247">(</span><span class="string" id="6136248">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="6136266">,</span>&nbsp;<span class="ident" id="6136268">c</span><span class="op" id="6136269">.</span><span class="ident" id="6136270">resp</span><span class="op" id="6136274">.</span><span class="ident" id="6136275">Error</span><span class="op" id="6136280">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136288">if</span>&nbsp;<span class="ident" id="6136291">x</span>&nbsp;<span class="op" id="6136293">==</span>&nbsp;<span class="string" id="6136296">&#34;&#34;</span>&nbsp;<span class="op" id="6136299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136304">x</span>&nbsp;<span class="op" id="6136306">=</span>&nbsp;<span class="string" id="6136308">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136334">r</span><span class="op" id="6136335">.</span><span class="ident" id="6136336">Error</span>&nbsp;<span class="op" id="6136342">=</span>&nbsp;<span class="ident" id="6136344">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136350">return</span>&nbsp;<span class="ident" id="6136357">nil</span><br>
<span class="lineno"></span><span class="op" id="6136361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6136364">func</span>&nbsp;<span class="op" id="6136369">(</span><span class="ident" id="6136370">c</span>&nbsp;<span class="op" id="6136372">*</span><span class="ident" id="6136373">clientCodec</span><span class="op" id="6136384">)</span>&nbsp;<span class="ident" id="6136386">ReadResponseBody</span><span class="op" id="6136402">(</span><span class="ident" id="6136403">x</span>&nbsp;<span class="keyword" id="6136405">interface</span><span class="op" id="6136414">{</span><span class="op" id="6136415">}</span><span class="op" id="6136416">)</span>&nbsp;<span class="builtintype" id="6136418">error</span>&nbsp;<span class="op" id="6136424">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136427">if</span>&nbsp;<span class="ident" id="6136430">x</span>&nbsp;<span class="op" id="6136432">==</span>&nbsp;<span class="ident" id="6136435">nil</span>&nbsp;<span class="op" id="6136439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136443">return</span>&nbsp;<span class="ident" id="6136450">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136458">return</span>&nbsp;<span class="ident" id="6136465">json</span><span class="op" id="6136469">.</span><span class="ident" id="6136470">Unmarshal</span><span class="op" id="6136479">(</span><span class="op" id="6136480">*</span><span class="ident" id="6136481">c</span><span class="op" id="6136482">.</span><span class="ident" id="6136483">resp</span><span class="op" id="6136487">.</span><span class="ident" id="6136488">Result</span><span class="op" id="6136494">,</span>&nbsp;<span class="ident" id="6136496">x</span><span class="op" id="6136497">)</span><br>
<span class="lineno"></span><span class="op" id="6136499">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6136502">func</span>&nbsp;<span class="op" id="6136507">(</span><span class="ident" id="6136508">c</span>&nbsp;<span class="op" id="6136510">*</span><span class="ident" id="6136511">clientCodec</span><span class="op" id="6136522">)</span>&nbsp;<span class="ident" id="6136524">Close</span><span class="op" id="6136529">(</span><span class="op" id="6136530">)</span>&nbsp;<span class="builtintype" id="6136532">error</span>&nbsp;<span class="op" id="6136538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136541">return</span>&nbsp;<span class="ident" id="6136548">c</span><span class="op" id="6136549">.</span><span class="ident" id="6136550">c</span><span class="op" id="6136551">.</span><span class="ident" id="6136552">Close</span><span class="op" id="6136557">(</span><span class="op" id="6136558">)</span><br>
<span class="lineno"></span><span class="op" id="6136560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6136563">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6136627">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6136682">func</span>&nbsp;<span class="ident" id="6136687">NewClient</span><span class="op" id="6136696">(</span><span class="ident" id="6136697">conn</span>&nbsp;<span class="ident" id="6136702">io</span><span class="op" id="6136704">.</span><span class="ident" id="6136705">ReadWriteCloser</span><span class="op" id="6136720">)</span>&nbsp;<span class="op" id="6136722">*</span><span class="ident" id="6136723">rpc</span><span class="op" id="6136726">.</span><span class="ident" id="6136727">Client</span>&nbsp;<span class="op" id="6136734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136737">return</span>&nbsp;<span class="ident" id="6136744">rpc</span><span class="op" id="6136747">.</span><span class="ident" id="6136748">NewClientWithCodec</span><span class="op" id="6136766">(</span><span class="ident" id="6136767">NewClientCodec</span><span class="op" id="6136781">(</span><span class="ident" id="6136782">conn</span><span class="op" id="6136786">)</span><span class="op" id="6136787">)</span><br>
<span class="lineno"></span><span class="op" id="6136789">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6136792">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6136864">func</span>&nbsp;<span class="ident" id="6136869">Dial</span><span class="op" id="6136873">(</span><span class="ident" id="6136874">network</span><span class="op" id="6136881">,</span>&nbsp;<span class="ident" id="6136883">address</span>&nbsp;<span class="builtintype" id="6136891">string</span><span class="op" id="6136897">)</span>&nbsp;<span class="op" id="6136899">(</span><span class="op" id="6136900">*</span><span class="ident" id="6136901">rpc</span><span class="op" id="6136904">.</span><span class="ident" id="6136905">Client</span><span class="op" id="6136911">,</span>&nbsp;<span class="builtintype" id="6136913">error</span><span class="op" id="6136918">)</span>&nbsp;<span class="op" id="6136920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136923">conn</span><span class="op" id="6136927">,</span>&nbsp;<span class="ident" id="6136929">err</span>&nbsp;<span class="op" id="6136933">:=</span>&nbsp;<span class="ident" id="6136936">net</span><span class="op" id="6136939">.</span><span class="ident" id="6136940">Dial</span><span class="op" id="6136944">(</span><span class="ident" id="6136945">network</span><span class="op" id="6136952">,</span>&nbsp;<span class="ident" id="6136954">address</span><span class="op" id="6136961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136964">if</span>&nbsp;<span class="ident" id="6136967">err</span>&nbsp;<span class="op" id="6136971">!=</span>&nbsp;<span class="ident" id="6136974">nil</span>&nbsp;<span class="op" id="6136978">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136982">return</span>&nbsp;<span class="ident" id="6136989">nil</span><span class="op" id="6136992">,</span>&nbsp;<span class="ident" id="6136994">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6137002">return</span>&nbsp;<span class="ident" id="6137009">NewClient</span><span class="op" id="6137018">(</span><span class="ident" id="6137019">conn</span><span class="op" id="6137023">)</span><span class="op" id="6137024">,</span>&nbsp;<span class="ident" id="6137026">err</span><br>
<span class="lineno"></span><span class="op" id="6137030">}</span>
</div>
</body>
</html>
