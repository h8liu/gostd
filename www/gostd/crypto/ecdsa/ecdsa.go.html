<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3912557">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3912612">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3912666">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3912717">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3912796">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="3912822">package</span>&nbsp;<span class="ident" id="3912830">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3912837">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="3912852">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="3912907">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="3912953">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="3912977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3913034">import</span>&nbsp;<span class="op" id="3913041">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3913044">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3913054">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3913073">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3913090">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3913096">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3913107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3913110">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3913155">type</span>&nbsp;<span class="ident" id="3913160">PublicKey</span>&nbsp;<span class="keyword" id="3913170">struct</span>&nbsp;<span class="op" id="3913177">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913180">elliptic</span><span class="op" id="3913188">.</span><span class="ident" id="3913189">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913196">X</span><span class="op" id="3913197">,</span>&nbsp;<span class="ident" id="3913199">Y</span>&nbsp;<span class="op" id="3913201">*</span><span class="ident" id="3913202">big</span><span class="op" id="3913205">.</span><span class="ident" id="3913206">Int</span><br>
<span class="lineno"></span><span class="op" id="3913210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3913213">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="3913259">type</span>&nbsp;<span class="ident" id="3913264">PrivateKey</span>&nbsp;<span class="keyword" id="3913275">struct</span>&nbsp;<span class="op" id="3913282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913285">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913296">D</span>&nbsp;<span class="op" id="3913298">*</span><span class="ident" id="3913299">big</span><span class="op" id="3913302">.</span><span class="ident" id="3913303">Int</span><br>
<span class="lineno"></span><span class="op" id="3913307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3913310">type</span>&nbsp;<span class="ident" id="3913315">ecdsaSignature</span>&nbsp;<span class="keyword" id="3913330">struct</span>&nbsp;<span class="op" id="3913337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913340">R</span><span class="op" id="3913341">,</span>&nbsp;<span class="ident" id="3913343">S</span>&nbsp;<span class="op" id="3913345">*</span><span class="ident" id="3913346">big</span><span class="op" id="3913349">.</span><span class="ident" id="3913350">Int</span><br>
<span class="lineno"></span><span class="op" id="3913354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3913357">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="3913413">func</span>&nbsp;<span class="op" id="3913418">(</span><span class="ident" id="3913419">priv</span>&nbsp;<span class="op" id="3913424">*</span><span class="ident" id="3913425">PrivateKey</span><span class="op" id="3913435">)</span>&nbsp;<span class="ident" id="3913437">Public</span><span class="op" id="3913443">(</span><span class="op" id="3913444">)</span>&nbsp;<span class="ident" id="3913446">crypto</span><span class="op" id="3913452">.</span><span class="ident" id="3913453">PublicKey</span>&nbsp;<span class="op" id="3913463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913466">return</span>&nbsp;<span class="op" id="3913473">&amp;</span><span class="ident" id="3913474">priv</span><span class="op" id="3913478">.</span><span class="ident" id="3913479">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="3913489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3913492">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="3913566">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3913644">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3913721">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3913734">func</span>&nbsp;<span class="op" id="3913739">(</span><span class="ident" id="3913740">priv</span>&nbsp;<span class="op" id="3913745">*</span><span class="ident" id="3913746">PrivateKey</span><span class="op" id="3913756">)</span>&nbsp;<span class="ident" id="3913758">Sign</span><span class="op" id="3913762">(</span><span class="ident" id="3913763">rand</span>&nbsp;<span class="ident" id="3913768">io</span><span class="op" id="3913770">.</span><span class="ident" id="3913771">Reader</span><span class="op" id="3913777">,</span>&nbsp;<span class="ident" id="3913779">msg</span>&nbsp;<span class="op" id="3913783">[</span><span class="op" id="3913784">]</span><span class="builtintype" id="3913785">byte</span><span class="op" id="3913789">,</span>&nbsp;<span class="ident" id="3913791">opts</span>&nbsp;<span class="ident" id="3913796">crypto</span><span class="op" id="3913802">.</span><span class="ident" id="3913803">SignerOpts</span><span class="op" id="3913813">)</span>&nbsp;<span class="op" id="3913815">(</span><span class="op" id="3913816">[</span><span class="op" id="3913817">]</span><span class="builtintype" id="3913818">byte</span><span class="op" id="3913822">,</span>&nbsp;<span class="builtintype" id="3913824">error</span><span class="op" id="3913829">)</span>&nbsp;<span class="op" id="3913831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913834">r</span><span class="op" id="3913835">,</span>&nbsp;<span class="ident" id="3913837">s</span><span class="op" id="3913838">,</span>&nbsp;<span class="ident" id="3913840">err</span>&nbsp;<span class="op" id="3913844">:=</span>&nbsp;<span class="ident" id="3913847">Sign</span><span class="op" id="3913851">(</span><span class="ident" id="3913852">rand</span><span class="op" id="3913856">,</span>&nbsp;<span class="ident" id="3913858">priv</span><span class="op" id="3913862">,</span>&nbsp;<span class="ident" id="3913864">msg</span><span class="op" id="3913867">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913870">if</span>&nbsp;<span class="ident" id="3913873">err</span>&nbsp;<span class="op" id="3913877">!=</span>&nbsp;<span class="ident" id="3913880">nil</span>&nbsp;<span class="op" id="3913884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913888">return</span>&nbsp;<span class="ident" id="3913895">nil</span><span class="op" id="3913898">,</span>&nbsp;<span class="ident" id="3913900">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913909">return</span>&nbsp;<span class="ident" id="3913916">asn1</span><span class="op" id="3913920">.</span><span class="ident" id="3913921">Marshal</span><span class="op" id="3913928">(</span><span class="ident" id="3913929">ecdsaSignature</span><span class="op" id="3913943">{</span><span class="ident" id="3913944">r</span><span class="op" id="3913945">,</span>&nbsp;<span class="ident" id="3913947">s</span><span class="op" id="3913948">}</span><span class="op" id="3913949">)</span><br>
<span class="lineno">55</span><span class="op" id="3913951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3913954">var</span>&nbsp;<span class="ident" id="3913958">one</span>&nbsp;<span class="op" id="3913962">=</span>&nbsp;<span class="builtinfunc" id="3913964">new</span><span class="op" id="3913967">(</span><span class="ident" id="3913968">big</span><span class="op" id="3913971">.</span><span class="ident" id="3913972">Int</span><span class="op" id="3913975">)</span><span class="op" id="3913976">.</span><span class="ident" id="3913977">SetInt64</span><span class="op" id="3913985">(</span><span class="num" id="3913986">1</span><span class="op" id="3913987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3913990">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="3914069">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3914120">func</span>&nbsp;<span class="ident" id="3914125">randFieldElement</span><span class="op" id="3914141">(</span><span class="ident" id="3914142">c</span>&nbsp;<span class="ident" id="3914144">elliptic</span><span class="op" id="3914152">.</span><span class="ident" id="3914153">Curve</span><span class="op" id="3914158">,</span>&nbsp;<span class="ident" id="3914160">rand</span>&nbsp;<span class="ident" id="3914165">io</span><span class="op" id="3914167">.</span><span class="ident" id="3914168">Reader</span><span class="op" id="3914174">)</span>&nbsp;<span class="op" id="3914176">(</span><span class="ident" id="3914177">k</span>&nbsp;<span class="op" id="3914179">*</span><span class="ident" id="3914180">big</span><span class="op" id="3914183">.</span><span class="ident" id="3914184">Int</span><span class="op" id="3914187">,</span>&nbsp;<span class="ident" id="3914189">err</span>&nbsp;<span class="builtintype" id="3914193">error</span><span class="op" id="3914198">)</span>&nbsp;<span class="op" id="3914200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914203">params</span>&nbsp;<span class="op" id="3914210">:=</span>&nbsp;<span class="ident" id="3914213">c</span><span class="op" id="3914214">.</span><span class="ident" id="3914215">Params</span><span class="op" id="3914221">(</span><span class="op" id="3914222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914225">b</span>&nbsp;<span class="op" id="3914227">:=</span>&nbsp;<span class="builtinfunc" id="3914230">make</span><span class="op" id="3914234">(</span><span class="op" id="3914235">[</span><span class="op" id="3914236">]</span><span class="builtintype" id="3914237">byte</span><span class="op" id="3914241">,</span>&nbsp;<span class="ident" id="3914243">params</span><span class="op" id="3914249">.</span><span class="ident" id="3914250">BitSize</span><span class="op" id="3914257">/</span><span class="num" id="3914258">8</span><span class="op" id="3914259">+</span><span class="num" id="3914260">8</span><span class="op" id="3914261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914264">_</span><span class="op" id="3914265">,</span>&nbsp;<span class="ident" id="3914267">err</span>&nbsp;<span class="op" id="3914271">=</span>&nbsp;<span class="ident" id="3914273">io</span><span class="op" id="3914275">.</span><span class="ident" id="3914276">ReadFull</span><span class="op" id="3914284">(</span><span class="ident" id="3914285">rand</span><span class="op" id="3914289">,</span>&nbsp;<span class="ident" id="3914291">b</span><span class="op" id="3914292">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914295">if</span>&nbsp;<span class="ident" id="3914298">err</span>&nbsp;<span class="op" id="3914302">!=</span>&nbsp;<span class="ident" id="3914305">nil</span>&nbsp;<span class="op" id="3914309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914325">k</span>&nbsp;<span class="op" id="3914327">=</span>&nbsp;<span class="builtinfunc" id="3914329">new</span><span class="op" id="3914332">(</span><span class="ident" id="3914333">big</span><span class="op" id="3914336">.</span><span class="ident" id="3914337">Int</span><span class="op" id="3914340">)</span><span class="op" id="3914341">.</span><span class="ident" id="3914342">SetBytes</span><span class="op" id="3914350">(</span><span class="ident" id="3914351">b</span><span class="op" id="3914352">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914355">n</span>&nbsp;<span class="op" id="3914357">:=</span>&nbsp;<span class="builtinfunc" id="3914360">new</span><span class="op" id="3914363">(</span><span class="ident" id="3914364">big</span><span class="op" id="3914367">.</span><span class="ident" id="3914368">Int</span><span class="op" id="3914371">)</span><span class="op" id="3914372">.</span><span class="ident" id="3914373">Sub</span><span class="op" id="3914376">(</span><span class="ident" id="3914377">params</span><span class="op" id="3914383">.</span><span class="ident" id="3914384">N</span><span class="op" id="3914385">,</span>&nbsp;<span class="ident" id="3914387">one</span><span class="op" id="3914390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914393">k</span><span class="op" id="3914394">.</span><span class="ident" id="3914395">Mod</span><span class="op" id="3914398">(</span><span class="ident" id="3914399">k</span><span class="op" id="3914400">,</span>&nbsp;<span class="ident" id="3914402">n</span><span class="op" id="3914403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914406">k</span><span class="op" id="3914407">.</span><span class="ident" id="3914408">Add</span><span class="op" id="3914411">(</span><span class="ident" id="3914412">k</span><span class="op" id="3914413">,</span>&nbsp;<span class="ident" id="3914415">one</span><span class="op" id="3914418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914421">return</span><br>
<span class="lineno"></span><span class="op" id="3914428">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3914431">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="3914487">func</span>&nbsp;<span class="ident" id="3914492">GenerateKey</span><span class="op" id="3914503">(</span><span class="ident" id="3914504">c</span>&nbsp;<span class="ident" id="3914506">elliptic</span><span class="op" id="3914514">.</span><span class="ident" id="3914515">Curve</span><span class="op" id="3914520">,</span>&nbsp;<span class="ident" id="3914522">rand</span>&nbsp;<span class="ident" id="3914527">io</span><span class="op" id="3914529">.</span><span class="ident" id="3914530">Reader</span><span class="op" id="3914536">)</span>&nbsp;<span class="op" id="3914538">(</span><span class="ident" id="3914539">priv</span>&nbsp;<span class="op" id="3914544">*</span><span class="ident" id="3914545">PrivateKey</span><span class="op" id="3914555">,</span>&nbsp;<span class="ident" id="3914557">err</span>&nbsp;<span class="builtintype" id="3914561">error</span><span class="op" id="3914566">)</span>&nbsp;<span class="op" id="3914568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914571">k</span><span class="op" id="3914572">,</span>&nbsp;<span class="ident" id="3914574">err</span>&nbsp;<span class="op" id="3914578">:=</span>&nbsp;<span class="ident" id="3914581">randFieldElement</span><span class="op" id="3914597">(</span><span class="ident" id="3914598">c</span><span class="op" id="3914599">,</span>&nbsp;<span class="ident" id="3914601">rand</span><span class="op" id="3914605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914608">if</span>&nbsp;<span class="ident" id="3914611">err</span>&nbsp;<span class="op" id="3914615">!=</span>&nbsp;<span class="ident" id="3914618">nil</span>&nbsp;<span class="op" id="3914622">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914626">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914638">priv</span>&nbsp;<span class="op" id="3914643">=</span>&nbsp;<span class="builtinfunc" id="3914645">new</span><span class="op" id="3914648">(</span><span class="ident" id="3914649">PrivateKey</span><span class="op" id="3914659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914662">priv</span><span class="op" id="3914666">.</span><span class="ident" id="3914667">PublicKey</span><span class="op" id="3914676">.</span><span class="ident" id="3914677">Curve</span>&nbsp;<span class="op" id="3914683">=</span>&nbsp;<span class="ident" id="3914685">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914688">priv</span><span class="op" id="3914692">.</span><span class="ident" id="3914693">D</span>&nbsp;<span class="op" id="3914695">=</span>&nbsp;<span class="ident" id="3914697">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914700">priv</span><span class="op" id="3914704">.</span><span class="ident" id="3914705">PublicKey</span><span class="op" id="3914714">.</span><span class="ident" id="3914715">X</span><span class="op" id="3914716">,</span>&nbsp;<span class="ident" id="3914718">priv</span><span class="op" id="3914722">.</span><span class="ident" id="3914723">PublicKey</span><span class="op" id="3914732">.</span><span class="ident" id="3914733">Y</span>&nbsp;<span class="op" id="3914735">=</span>&nbsp;<span class="ident" id="3914737">c</span><span class="op" id="3914738">.</span><span class="ident" id="3914739">ScalarBaseMult</span><span class="op" id="3914753">(</span><span class="ident" id="3914754">k</span><span class="op" id="3914755">.</span><span class="ident" id="3914756">Bytes</span><span class="op" id="3914761">(</span><span class="op" id="3914762">)</span><span class="op" id="3914763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914766">return</span><br>
<span class="lineno"></span><span class="op" id="3914773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3914776">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="3914853">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="3914928">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="3915006">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="3915081">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="3915158">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="3915185">func</span>&nbsp;<span class="ident" id="3915190">hashToInt</span><span class="op" id="3915199">(</span><span class="ident" id="3915200">hash</span>&nbsp;<span class="op" id="3915205">[</span><span class="op" id="3915206">]</span><span class="builtintype" id="3915207">byte</span><span class="op" id="3915211">,</span>&nbsp;<span class="ident" id="3915213">c</span>&nbsp;<span class="ident" id="3915215">elliptic</span><span class="op" id="3915223">.</span><span class="ident" id="3915224">Curve</span><span class="op" id="3915229">)</span>&nbsp;<span class="op" id="3915231">*</span><span class="ident" id="3915232">big</span><span class="op" id="3915235">.</span><span class="ident" id="3915236">Int</span>&nbsp;<span class="op" id="3915240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915243">orderBits</span>&nbsp;<span class="op" id="3915253">:=</span>&nbsp;<span class="ident" id="3915256">c</span><span class="op" id="3915257">.</span><span class="ident" id="3915258">Params</span><span class="op" id="3915264">(</span><span class="op" id="3915265">)</span><span class="op" id="3915266">.</span><span class="ident" id="3915267">N</span><span class="op" id="3915268">.</span><span class="ident" id="3915269">BitLen</span><span class="op" id="3915275">(</span><span class="op" id="3915276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915279">orderBytes</span>&nbsp;<span class="op" id="3915290">:=</span>&nbsp;<span class="op" id="3915293">(</span><span class="ident" id="3915294">orderBits</span>&nbsp;<span class="op" id="3915304">+</span>&nbsp;<span class="num" id="3915306">7</span><span class="op" id="3915307">)</span>&nbsp;<span class="op" id="3915309">/</span>&nbsp;<span class="num" id="3915311">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3915314">if</span>&nbsp;<span class="builtinfunc" id="3915317">len</span><span class="op" id="3915320">(</span><span class="ident" id="3915321">hash</span><span class="op" id="3915325">)</span>&nbsp;<span class="op" id="3915327">&gt;</span>&nbsp;<span class="ident" id="3915329">orderBytes</span>&nbsp;<span class="op" id="3915340">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915344">hash</span>&nbsp;<span class="op" id="3915349">=</span>&nbsp;<span class="ident" id="3915351">hash</span><span class="op" id="3915355">[</span><span class="op" id="3915356">:</span><span class="ident" id="3915357">orderBytes</span><span class="op" id="3915367">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3915370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915374">ret</span>&nbsp;<span class="op" id="3915378">:=</span>&nbsp;<span class="builtinfunc" id="3915381">new</span><span class="op" id="3915384">(</span><span class="ident" id="3915385">big</span><span class="op" id="3915388">.</span><span class="ident" id="3915389">Int</span><span class="op" id="3915392">)</span><span class="op" id="3915393">.</span><span class="ident" id="3915394">SetBytes</span><span class="op" id="3915402">(</span><span class="ident" id="3915403">hash</span><span class="op" id="3915407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915410">excess</span>&nbsp;<span class="op" id="3915417">:=</span>&nbsp;<span class="builtinfunc" id="3915420">len</span><span class="op" id="3915423">(</span><span class="ident" id="3915424">hash</span><span class="op" id="3915428">)</span><span class="op" id="3915429">*</span><span class="num" id="3915430">8</span>&nbsp;<span class="op" id="3915432">-</span>&nbsp;<span class="ident" id="3915434">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3915445">if</span>&nbsp;<span class="ident" id="3915448">excess</span>&nbsp;<span class="op" id="3915455">&gt;</span>&nbsp;<span class="num" id="3915457">0</span>&nbsp;<span class="op" id="3915459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915463">ret</span><span class="op" id="3915466">.</span><span class="ident" id="3915467">Rsh</span><span class="op" id="3915470">(</span><span class="ident" id="3915471">ret</span><span class="op" id="3915474">,</span>&nbsp;<span class="builtintype" id="3915476">uint</span><span class="op" id="3915480">(</span><span class="ident" id="3915481">excess</span><span class="op" id="3915487">)</span><span class="op" id="3915488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3915491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3915494">return</span>&nbsp;<span class="ident" id="3915501">ret</span><br>
<span class="lineno"></span><span class="op" id="3915505">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="3915508">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="3915585">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="3915663">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="3915734">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="3915772">func</span>&nbsp;<span class="ident" id="3915777">fermatInverse</span><span class="op" id="3915790">(</span><span class="ident" id="3915791">k</span><span class="op" id="3915792">,</span>&nbsp;<span class="ident" id="3915794">N</span>&nbsp;<span class="op" id="3915796">*</span><span class="ident" id="3915797">big</span><span class="op" id="3915800">.</span><span class="ident" id="3915801">Int</span><span class="op" id="3915804">)</span>&nbsp;<span class="op" id="3915806">*</span><span class="ident" id="3915807">big</span><span class="op" id="3915810">.</span><span class="ident" id="3915811">Int</span>&nbsp;<span class="op" id="3915815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915818">two</span>&nbsp;<span class="op" id="3915822">:=</span>&nbsp;<span class="ident" id="3915825">big</span><span class="op" id="3915828">.</span><span class="ident" id="3915829">NewInt</span><span class="op" id="3915835">(</span><span class="num" id="3915836">2</span><span class="op" id="3915837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915840">nMinus2</span>&nbsp;<span class="op" id="3915848">:=</span>&nbsp;<span class="builtinfunc" id="3915851">new</span><span class="op" id="3915854">(</span><span class="ident" id="3915855">big</span><span class="op" id="3915858">.</span><span class="ident" id="3915859">Int</span><span class="op" id="3915862">)</span><span class="op" id="3915863">.</span><span class="ident" id="3915864">Sub</span><span class="op" id="3915867">(</span><span class="ident" id="3915868">N</span><span class="op" id="3915869">,</span>&nbsp;<span class="ident" id="3915871">two</span><span class="op" id="3915874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3915877">return</span>&nbsp;<span class="builtinfunc" id="3915884">new</span><span class="op" id="3915887">(</span><span class="ident" id="3915888">big</span><span class="op" id="3915891">.</span><span class="ident" id="3915892">Int</span><span class="op" id="3915895">)</span><span class="op" id="3915896">.</span><span class="ident" id="3915897">Exp</span><span class="op" id="3915900">(</span><span class="ident" id="3915901">k</span><span class="op" id="3915902">,</span>&nbsp;<span class="ident" id="3915904">nMinus2</span><span class="op" id="3915911">,</span>&nbsp;<span class="ident" id="3915913">N</span><span class="op" id="3915914">)</span><br>
<span class="lineno"></span><span class="op" id="3915916">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3915919">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3915999">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3916077">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3916156">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="3916165">func</span>&nbsp;<span class="ident" id="3916170">Sign</span><span class="op" id="3916174">(</span><span class="ident" id="3916175">rand</span>&nbsp;<span class="ident" id="3916180">io</span><span class="op" id="3916182">.</span><span class="ident" id="3916183">Reader</span><span class="op" id="3916189">,</span>&nbsp;<span class="ident" id="3916191">priv</span>&nbsp;<span class="op" id="3916196">*</span><span class="ident" id="3916197">PrivateKey</span><span class="op" id="3916207">,</span>&nbsp;<span class="ident" id="3916209">hash</span>&nbsp;<span class="op" id="3916214">[</span><span class="op" id="3916215">]</span><span class="builtintype" id="3916216">byte</span><span class="op" id="3916220">)</span>&nbsp;<span class="op" id="3916222">(</span><span class="ident" id="3916223">r</span><span class="op" id="3916224">,</span>&nbsp;<span class="ident" id="3916226">s</span>&nbsp;<span class="op" id="3916228">*</span><span class="ident" id="3916229">big</span><span class="op" id="3916232">.</span><span class="ident" id="3916233">Int</span><span class="op" id="3916236">,</span>&nbsp;<span class="ident" id="3916238">err</span>&nbsp;<span class="builtintype" id="3916242">error</span><span class="op" id="3916247">)</span>&nbsp;<span class="op" id="3916249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916252">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916272">c</span>&nbsp;<span class="op" id="3916274">:=</span>&nbsp;<span class="ident" id="3916277">priv</span><span class="op" id="3916281">.</span><span class="ident" id="3916282">PublicKey</span><span class="op" id="3916291">.</span><span class="ident" id="3916292">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916299">N</span>&nbsp;<span class="op" id="3916301">:=</span>&nbsp;<span class="ident" id="3916304">c</span><span class="op" id="3916305">.</span><span class="ident" id="3916306">Params</span><span class="op" id="3916312">(</span><span class="op" id="3916313">)</span><span class="op" id="3916314">.</span><span class="ident" id="3916315">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916319">var</span>&nbsp;<span class="ident" id="3916323">k</span><span class="op" id="3916324">,</span>&nbsp;<span class="ident" id="3916326">kInv</span>&nbsp;<span class="op" id="3916331">*</span><span class="ident" id="3916332">big</span><span class="op" id="3916335">.</span><span class="ident" id="3916336">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916341">for</span>&nbsp;<span class="op" id="3916345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916349">for</span>&nbsp;<span class="op" id="3916353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916358">k</span><span class="op" id="3916359">,</span>&nbsp;<span class="ident" id="3916361">err</span>&nbsp;<span class="op" id="3916365">=</span>&nbsp;<span class="ident" id="3916367">randFieldElement</span><span class="op" id="3916383">(</span><span class="ident" id="3916384">c</span><span class="op" id="3916385">,</span>&nbsp;<span class="ident" id="3916387">rand</span><span class="op" id="3916391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916396">if</span>&nbsp;<span class="ident" id="3916399">err</span>&nbsp;<span class="op" id="3916403">!=</span>&nbsp;<span class="ident" id="3916406">nil</span>&nbsp;<span class="op" id="3916410">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916416">r</span>&nbsp;<span class="op" id="3916418">=</span>&nbsp;<span class="ident" id="3916420">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916444">kInv</span>&nbsp;<span class="op" id="3916449">=</span>&nbsp;<span class="ident" id="3916451">fermatInverse</span><span class="op" id="3916464">(</span><span class="ident" id="3916465">k</span><span class="op" id="3916466">,</span>&nbsp;<span class="ident" id="3916468">N</span><span class="op" id="3916469">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916474">r</span><span class="op" id="3916475">,</span>&nbsp;<span class="ident" id="3916477">_</span>&nbsp;<span class="op" id="3916479">=</span>&nbsp;<span class="ident" id="3916481">priv</span><span class="op" id="3916485">.</span><span class="ident" id="3916486">Curve</span><span class="op" id="3916491">.</span><span class="ident" id="3916492">ScalarBaseMult</span><span class="op" id="3916506">(</span><span class="ident" id="3916507">k</span><span class="op" id="3916508">.</span><span class="ident" id="3916509">Bytes</span><span class="op" id="3916514">(</span><span class="op" id="3916515">)</span><span class="op" id="3916516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916521">r</span><span class="op" id="3916522">.</span><span class="ident" id="3916523">Mod</span><span class="op" id="3916526">(</span><span class="ident" id="3916527">r</span><span class="op" id="3916528">,</span>&nbsp;<span class="ident" id="3916530">N</span><span class="op" id="3916531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916536">if</span>&nbsp;<span class="ident" id="3916539">r</span><span class="op" id="3916540">.</span><span class="ident" id="3916541">Sign</span><span class="op" id="3916545">(</span><span class="op" id="3916546">)</span>&nbsp;<span class="op" id="3916548">!=</span>&nbsp;<span class="num" id="3916551">0</span>&nbsp;<span class="op" id="3916553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916559">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916568">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916577">e</span>&nbsp;<span class="op" id="3916579">:=</span>&nbsp;<span class="ident" id="3916582">hashToInt</span><span class="op" id="3916591">(</span><span class="ident" id="3916592">hash</span><span class="op" id="3916596">,</span>&nbsp;<span class="ident" id="3916598">c</span><span class="op" id="3916599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916603">s</span>&nbsp;<span class="op" id="3916605">=</span>&nbsp;<span class="builtinfunc" id="3916607">new</span><span class="op" id="3916610">(</span><span class="ident" id="3916611">big</span><span class="op" id="3916614">.</span><span class="ident" id="3916615">Int</span><span class="op" id="3916618">)</span><span class="op" id="3916619">.</span><span class="ident" id="3916620">Mul</span><span class="op" id="3916623">(</span><span class="ident" id="3916624">priv</span><span class="op" id="3916628">.</span><span class="ident" id="3916629">D</span><span class="op" id="3916630">,</span>&nbsp;<span class="ident" id="3916632">r</span><span class="op" id="3916633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916637">s</span><span class="op" id="3916638">.</span><span class="ident" id="3916639">Add</span><span class="op" id="3916642">(</span><span class="ident" id="3916643">s</span><span class="op" id="3916644">,</span>&nbsp;<span class="ident" id="3916646">e</span><span class="op" id="3916647">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916651">s</span><span class="op" id="3916652">.</span><span class="ident" id="3916653">Mul</span><span class="op" id="3916656">(</span><span class="ident" id="3916657">s</span><span class="op" id="3916658">,</span>&nbsp;<span class="ident" id="3916660">kInv</span><span class="op" id="3916664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916668">s</span><span class="op" id="3916669">.</span><span class="ident" id="3916670">Mod</span><span class="op" id="3916673">(</span><span class="ident" id="3916674">s</span><span class="op" id="3916675">,</span>&nbsp;<span class="ident" id="3916677">N</span><span class="op" id="3916678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916682">if</span>&nbsp;<span class="ident" id="3916685">s</span><span class="op" id="3916686">.</span><span class="ident" id="3916687">Sign</span><span class="op" id="3916691">(</span><span class="op" id="3916692">)</span>&nbsp;<span class="op" id="3916694">!=</span>&nbsp;<span class="num" id="3916697">0</span>&nbsp;<span class="op" id="3916699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916704">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916712">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3916715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916719">return</span><br>
<span class="lineno"></span><span class="op" id="3916726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3916729">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="3916809">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3916865">func</span>&nbsp;<span class="ident" id="3916870">Verify</span><span class="op" id="3916876">(</span><span class="ident" id="3916877">pub</span>&nbsp;<span class="op" id="3916881">*</span><span class="ident" id="3916882">PublicKey</span><span class="op" id="3916891">,</span>&nbsp;<span class="ident" id="3916893">hash</span>&nbsp;<span class="op" id="3916898">[</span><span class="op" id="3916899">]</span><span class="builtintype" id="3916900">byte</span><span class="op" id="3916904">,</span>&nbsp;<span class="ident" id="3916906">r</span><span class="op" id="3916907">,</span>&nbsp;<span class="ident" id="3916909">s</span>&nbsp;<span class="op" id="3916911">*</span><span class="ident" id="3916912">big</span><span class="op" id="3916915">.</span><span class="ident" id="3916916">Int</span><span class="op" id="3916919">)</span>&nbsp;<span class="builtintype" id="3916921">bool</span>&nbsp;<span class="op" id="3916926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916929">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916949">c</span>&nbsp;<span class="op" id="3916951">:=</span>&nbsp;<span class="ident" id="3916954">pub</span><span class="op" id="3916957">.</span><span class="ident" id="3916958">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916965">N</span>&nbsp;<span class="op" id="3916967">:=</span>&nbsp;<span class="ident" id="3916970">c</span><span class="op" id="3916971">.</span><span class="ident" id="3916972">Params</span><span class="op" id="3916978">(</span><span class="op" id="3916979">)</span><span class="op" id="3916980">.</span><span class="ident" id="3916981">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3916985">if</span>&nbsp;<span class="ident" id="3916988">r</span><span class="op" id="3916989">.</span><span class="ident" id="3916990">Sign</span><span class="op" id="3916994">(</span><span class="op" id="3916995">)</span>&nbsp;<span class="op" id="3916997">==</span>&nbsp;<span class="num" id="3917000">0</span>&nbsp;<span class="op" id="3917002">||</span>&nbsp;<span class="ident" id="3917005">s</span><span class="op" id="3917006">.</span><span class="ident" id="3917007">Sign</span><span class="op" id="3917011">(</span><span class="op" id="3917012">)</span>&nbsp;<span class="op" id="3917014">==</span>&nbsp;<span class="num" id="3917017">0</span>&nbsp;<span class="op" id="3917019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917023">return</span>&nbsp;<span class="builtintype" id="3917030">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917037">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917040">if</span>&nbsp;<span class="ident" id="3917043">r</span><span class="op" id="3917044">.</span><span class="ident" id="3917045">Cmp</span><span class="op" id="3917048">(</span><span class="ident" id="3917049">N</span><span class="op" id="3917050">)</span>&nbsp;<span class="op" id="3917052">&gt;=</span>&nbsp;<span class="num" id="3917055">0</span>&nbsp;<span class="op" id="3917057">||</span>&nbsp;<span class="ident" id="3917060">s</span><span class="op" id="3917061">.</span><span class="ident" id="3917062">Cmp</span><span class="op" id="3917065">(</span><span class="ident" id="3917066">N</span><span class="op" id="3917067">)</span>&nbsp;<span class="op" id="3917069">&gt;=</span>&nbsp;<span class="num" id="3917072">0</span>&nbsp;<span class="op" id="3917074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917078">return</span>&nbsp;<span class="builtintype" id="3917085">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917095">e</span>&nbsp;<span class="op" id="3917097">:=</span>&nbsp;<span class="ident" id="3917100">hashToInt</span><span class="op" id="3917109">(</span><span class="ident" id="3917110">hash</span><span class="op" id="3917114">,</span>&nbsp;<span class="ident" id="3917116">c</span><span class="op" id="3917117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917120">w</span>&nbsp;<span class="op" id="3917122">:=</span>&nbsp;<span class="builtinfunc" id="3917125">new</span><span class="op" id="3917128">(</span><span class="ident" id="3917129">big</span><span class="op" id="3917132">.</span><span class="ident" id="3917133">Int</span><span class="op" id="3917136">)</span><span class="op" id="3917137">.</span><span class="ident" id="3917138">ModInverse</span><span class="op" id="3917148">(</span><span class="ident" id="3917149">s</span><span class="op" id="3917150">,</span>&nbsp;<span class="ident" id="3917152">N</span><span class="op" id="3917153">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917157">u1</span>&nbsp;<span class="op" id="3917160">:=</span>&nbsp;<span class="ident" id="3917163">e</span><span class="op" id="3917164">.</span><span class="ident" id="3917165">Mul</span><span class="op" id="3917168">(</span><span class="ident" id="3917169">e</span><span class="op" id="3917170">,</span>&nbsp;<span class="ident" id="3917172">w</span><span class="op" id="3917173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917176">u1</span><span class="op" id="3917178">.</span><span class="ident" id="3917179">Mod</span><span class="op" id="3917182">(</span><span class="ident" id="3917183">u1</span><span class="op" id="3917185">,</span>&nbsp;<span class="ident" id="3917187">N</span><span class="op" id="3917188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917191">u2</span>&nbsp;<span class="op" id="3917194">:=</span>&nbsp;<span class="ident" id="3917197">w</span><span class="op" id="3917198">.</span><span class="ident" id="3917199">Mul</span><span class="op" id="3917202">(</span><span class="ident" id="3917203">r</span><span class="op" id="3917204">,</span>&nbsp;<span class="ident" id="3917206">w</span><span class="op" id="3917207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917210">u2</span><span class="op" id="3917212">.</span><span class="ident" id="3917213">Mod</span><span class="op" id="3917216">(</span><span class="ident" id="3917217">u2</span><span class="op" id="3917219">,</span>&nbsp;<span class="ident" id="3917221">N</span><span class="op" id="3917222">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917226">x1</span><span class="op" id="3917228">,</span>&nbsp;<span class="ident" id="3917230">y1</span>&nbsp;<span class="op" id="3917233">:=</span>&nbsp;<span class="ident" id="3917236">c</span><span class="op" id="3917237">.</span><span class="ident" id="3917238">ScalarBaseMult</span><span class="op" id="3917252">(</span><span class="ident" id="3917253">u1</span><span class="op" id="3917255">.</span><span class="ident" id="3917256">Bytes</span><span class="op" id="3917261">(</span><span class="op" id="3917262">)</span><span class="op" id="3917263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917266">x2</span><span class="op" id="3917268">,</span>&nbsp;<span class="ident" id="3917270">y2</span>&nbsp;<span class="op" id="3917273">:=</span>&nbsp;<span class="ident" id="3917276">c</span><span class="op" id="3917277">.</span><span class="ident" id="3917278">ScalarMult</span><span class="op" id="3917288">(</span><span class="ident" id="3917289">pub</span><span class="op" id="3917292">.</span><span class="ident" id="3917293">X</span><span class="op" id="3917294">,</span>&nbsp;<span class="ident" id="3917296">pub</span><span class="op" id="3917299">.</span><span class="ident" id="3917300">Y</span><span class="op" id="3917301">,</span>&nbsp;<span class="ident" id="3917303">u2</span><span class="op" id="3917305">.</span><span class="ident" id="3917306">Bytes</span><span class="op" id="3917311">(</span><span class="op" id="3917312">)</span><span class="op" id="3917313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917316">x</span><span class="op" id="3917317">,</span>&nbsp;<span class="ident" id="3917319">y</span>&nbsp;<span class="op" id="3917321">:=</span>&nbsp;<span class="ident" id="3917324">c</span><span class="op" id="3917325">.</span><span class="ident" id="3917326">Add</span><span class="op" id="3917329">(</span><span class="ident" id="3917330">x1</span><span class="op" id="3917332">,</span>&nbsp;<span class="ident" id="3917334">y1</span><span class="op" id="3917336">,</span>&nbsp;<span class="ident" id="3917338">x2</span><span class="op" id="3917340">,</span>&nbsp;<span class="ident" id="3917342">y2</span><span class="op" id="3917344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917347">if</span>&nbsp;<span class="ident" id="3917350">x</span><span class="op" id="3917351">.</span><span class="ident" id="3917352">Sign</span><span class="op" id="3917356">(</span><span class="op" id="3917357">)</span>&nbsp;<span class="op" id="3917359">==</span>&nbsp;<span class="num" id="3917362">0</span>&nbsp;<span class="op" id="3917364">&amp;&amp;</span>&nbsp;<span class="ident" id="3917367">y</span><span class="op" id="3917368">.</span><span class="ident" id="3917369">Sign</span><span class="op" id="3917373">(</span><span class="op" id="3917374">)</span>&nbsp;<span class="op" id="3917376">==</span>&nbsp;<span class="num" id="3917379">0</span>&nbsp;<span class="op" id="3917381">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917385">return</span>&nbsp;<span class="builtintype" id="3917392">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3917399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917402">x</span><span class="op" id="3917403">.</span><span class="ident" id="3917404">Mod</span><span class="op" id="3917407">(</span><span class="ident" id="3917408">x</span><span class="op" id="3917409">,</span>&nbsp;<span class="ident" id="3917411">N</span><span class="op" id="3917412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3917415">return</span>&nbsp;<span class="ident" id="3917422">x</span><span class="op" id="3917423">.</span><span class="ident" id="3917424">Cmp</span><span class="op" id="3917427">(</span><span class="ident" id="3917428">r</span><span class="op" id="3917429">)</span>&nbsp;<span class="op" id="3917431">==</span>&nbsp;<span class="num" id="3917434">0</span><br>
<span class="lineno"></span><span class="op" id="3917436">}</span>
</div>
</body>
</html>
