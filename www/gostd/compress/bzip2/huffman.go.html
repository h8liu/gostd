<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4916275">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4916330">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4916384">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4916435">package</span>&nbsp;<span class="ident" id="4916443">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4916450">import</span>&nbsp;<span class="string" id="4916457">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4916465">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="4916541">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="4916552">type</span>&nbsp;<span class="ident" id="4916557">huffmanTree</span>&nbsp;<span class="keyword" id="4916569">struct</span>&nbsp;<span class="op" id="4916576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4916579">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4916650">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4916723">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916779">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916788">[</span><span class="op" id="4916789">]</span><span class="ident" id="4916790">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916803">nextNode</span>&nbsp;<span class="builtintype" id="4916812">int</span><br>
<span class="lineno"></span><span class="op" id="4916816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4916819">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="4916899">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="4916979">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="4917039">//</span><br>
<span class="lineno"></span><span class="comment" id="4917042">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4917119">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="4917197">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="4917247">type</span>&nbsp;<span class="ident" id="4917252">huffmanNode</span>&nbsp;<span class="keyword" id="4917264">struct</span>&nbsp;<span class="op" id="4917271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917274">left</span><span class="op" id="4917278">,</span>&nbsp;<span class="ident" id="4917280">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4917296">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917304">leftValue</span><span class="op" id="4917313">,</span>&nbsp;<span class="ident" id="4917315">rightValue</span>&nbsp;<span class="builtintype" id="4917326">uint16</span><br>
<span class="lineno"></span><span class="op" id="4917333">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4917336">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4917413">const</span>&nbsp;<span class="ident" id="4917419">invalidNodeValue</span>&nbsp;<span class="op" id="4917436">=</span>&nbsp;<span class="num" id="4917438">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4917446">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="4917523">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4917543">func</span>&nbsp;<span class="op" id="4917548">(</span><span class="ident" id="4917549">t</span>&nbsp;<span class="op" id="4917551">*</span><span class="ident" id="4917552">huffmanTree</span><span class="op" id="4917563">)</span>&nbsp;<span class="ident" id="4917565">Decode</span><span class="op" id="4917571">(</span><span class="ident" id="4917572">br</span>&nbsp;<span class="op" id="4917575">*</span><span class="ident" id="4917576">bitReader</span><span class="op" id="4917585">)</span>&nbsp;<span class="op" id="4917587">(</span><span class="ident" id="4917588">v</span>&nbsp;<span class="builtintype" id="4917590">uint16</span><span class="op" id="4917596">)</span>&nbsp;<span class="op" id="4917598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917601">nodeIndex</span>&nbsp;<span class="op" id="4917611">:=</span>&nbsp;<span class="builtintype" id="4917614">uint16</span><span class="op" id="4917620">(</span><span class="num" id="4917621">0</span><span class="op" id="4917622">)</span>&nbsp;<span class="comment" id="4917624">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917661">for</span>&nbsp;<span class="op" id="4917665">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917669">node</span>&nbsp;<span class="op" id="4917674">:=</span>&nbsp;<span class="op" id="4917677">&amp;</span><span class="ident" id="4917678">t</span><span class="op" id="4917679">.</span><span class="ident" id="4917680">nodes</span><span class="op" id="4917685">[</span><span class="ident" id="4917686">nodeIndex</span><span class="op" id="4917695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917699">bit</span><span class="op" id="4917702">,</span>&nbsp;<span class="ident" id="4917704">ok</span>&nbsp;<span class="op" id="4917707">:=</span>&nbsp;<span class="ident" id="4917710">br</span><span class="op" id="4917712">.</span><span class="ident" id="4917713">TryReadBit</span><span class="op" id="4917723">(</span><span class="op" id="4917724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917728">if</span>&nbsp;<span class="op" id="4917731">!</span><span class="ident" id="4917732">ok</span>&nbsp;<span class="op" id="4917735">&amp;&amp;</span>&nbsp;<span class="ident" id="4917738">br</span><span class="op" id="4917740">.</span><span class="ident" id="4917741">ReadBit</span><span class="op" id="4917748">(</span><span class="op" id="4917749">)</span>&nbsp;<span class="op" id="4917751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917756">bit</span>&nbsp;<span class="op" id="4917760">=</span>&nbsp;<span class="num" id="4917762">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917766">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917770">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917809">if</span>&nbsp;<span class="ident" id="4917812">bit</span>&nbsp;<span class="op" id="4917816">!=</span>&nbsp;<span class="num" id="4917819">0</span>&nbsp;<span class="op" id="4917821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917826">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917837">if</span>&nbsp;<span class="ident" id="4917840">node</span><span class="op" id="4917844">.</span><span class="ident" id="4917845">left</span>&nbsp;<span class="op" id="4917850">==</span>&nbsp;<span class="ident" id="4917853">invalidNodeValue</span>&nbsp;<span class="op" id="4917870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917876">return</span>&nbsp;<span class="ident" id="4917883">node</span><span class="op" id="4917887">.</span><span class="ident" id="4917888">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917906">nodeIndex</span>&nbsp;<span class="op" id="4917916">=</span>&nbsp;<span class="ident" id="4917918">node</span><span class="op" id="4917922">.</span><span class="ident" id="4917923">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917930">}</span>&nbsp;<span class="keyword" id="4917932">else</span>&nbsp;<span class="op" id="4917937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917942">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917954">if</span>&nbsp;<span class="ident" id="4917957">node</span><span class="op" id="4917961">.</span><span class="ident" id="4917962">right</span>&nbsp;<span class="op" id="4917968">==</span>&nbsp;<span class="ident" id="4917971">invalidNodeValue</span>&nbsp;<span class="op" id="4917988">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917994">return</span>&nbsp;<span class="ident" id="4918001">node</span><span class="op" id="4918005">.</span><span class="ident" id="4918006">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918025">nodeIndex</span>&nbsp;<span class="op" id="4918035">=</span>&nbsp;<span class="ident" id="4918037">node</span><span class="op" id="4918041">.</span><span class="ident" id="4918042">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918053">}</span><br>
<span class="lineno">60</span><span class="op" id="4918055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4918058">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4918131">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4918194">func</span>&nbsp;<span class="ident" id="4918199">newHuffmanTree</span><span class="op" id="4918213">(</span><span class="ident" id="4918214">lengths</span>&nbsp;<span class="op" id="4918222">[</span><span class="op" id="4918223">]</span><span class="builtintype" id="4918224">uint8</span><span class="op" id="4918229">)</span>&nbsp;<span class="op" id="4918231">(</span><span class="ident" id="4918232">huffmanTree</span><span class="op" id="4918243">,</span>&nbsp;<span class="builtintype" id="4918245">error</span><span class="op" id="4918250">)</span>&nbsp;<span class="op" id="4918252">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918255">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918325">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918390">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918452">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918520">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918591">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918661">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918700">if</span>&nbsp;<span class="builtinfunc" id="4918703">len</span><span class="op" id="4918706">(</span><span class="ident" id="4918707">lengths</span><span class="op" id="4918714">)</span>&nbsp;<span class="op" id="4918716">&lt;</span>&nbsp;<span class="num" id="4918718">2</span>&nbsp;<span class="op" id="4918720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4918724">panic</span><span class="op" id="4918729">(</span><span class="string" id="4918730">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="4918763">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918770">var</span>&nbsp;<span class="ident" id="4918774">t</span>&nbsp;<span class="ident" id="4918776">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918790">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918862">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918904">pairs</span>&nbsp;<span class="op" id="4918910">:=</span>&nbsp;<span class="ident" id="4918913">huffmanSymbolLengthPairs</span><span class="op" id="4918937">(</span><span class="builtinfunc" id="4918938">make</span><span class="op" id="4918942">(</span><span class="op" id="4918943">[</span><span class="op" id="4918944">]</span><span class="ident" id="4918945">huffmanSymbolLengthPair</span><span class="op" id="4918968">,</span>&nbsp;<span class="builtinfunc" id="4918970">len</span><span class="op" id="4918973">(</span><span class="ident" id="4918974">lengths</span><span class="op" id="4918981">)</span><span class="op" id="4918982">)</span><span class="op" id="4918983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918986">for</span>&nbsp;<span class="ident" id="4918990">i</span><span class="op" id="4918991">,</span>&nbsp;<span class="ident" id="4918993">length</span>&nbsp;<span class="op" id="4919000">:=</span>&nbsp;<span class="keyword" id="4919003">range</span>&nbsp;<span class="ident" id="4919009">lengths</span>&nbsp;<span class="op" id="4919017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919021">pairs</span><span class="op" id="4919026">[</span><span class="ident" id="4919027">i</span><span class="op" id="4919028">]</span><span class="op" id="4919029">.</span><span class="ident" id="4919030">value</span>&nbsp;<span class="op" id="4919036">=</span>&nbsp;<span class="builtintype" id="4919038">uint16</span><span class="op" id="4919044">(</span><span class="ident" id="4919045">i</span><span class="op" id="4919046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919050">pairs</span><span class="op" id="4919055">[</span><span class="ident" id="4919056">i</span><span class="op" id="4919057">]</span><span class="op" id="4919058">.</span><span class="ident" id="4919059">length</span>&nbsp;<span class="op" id="4919066">=</span>&nbsp;<span class="ident" id="4919068">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919080">sort</span><span class="op" id="4919084">.</span><span class="ident" id="4919085">Sort</span><span class="op" id="4919089">(</span><span class="ident" id="4919090">pairs</span><span class="op" id="4919095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919099">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919171">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919244">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919316">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919337">code</span>&nbsp;<span class="op" id="4919342">:=</span>&nbsp;<span class="builtintype" id="4919345">uint32</span><span class="op" id="4919351">(</span><span class="num" id="4919352">0</span><span class="op" id="4919353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919356">length</span>&nbsp;<span class="op" id="4919363">:=</span>&nbsp;<span class="builtintype" id="4919366">uint8</span><span class="op" id="4919371">(</span><span class="num" id="4919372">32</span><span class="op" id="4919374">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919378">codes</span>&nbsp;<span class="op" id="4919384">:=</span>&nbsp;<span class="ident" id="4919387">huffmanCodes</span><span class="op" id="4919399">(</span><span class="builtinfunc" id="4919400">make</span><span class="op" id="4919404">(</span><span class="op" id="4919405">[</span><span class="op" id="4919406">]</span><span class="ident" id="4919407">huffmanCode</span><span class="op" id="4919418">,</span>&nbsp;<span class="builtinfunc" id="4919420">len</span><span class="op" id="4919423">(</span><span class="ident" id="4919424">lengths</span><span class="op" id="4919431">)</span><span class="op" id="4919432">)</span><span class="op" id="4919433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919436">for</span>&nbsp;<span class="ident" id="4919440">i</span>&nbsp;<span class="op" id="4919442">:=</span>&nbsp;<span class="builtinfunc" id="4919445">len</span><span class="op" id="4919448">(</span><span class="ident" id="4919449">pairs</span><span class="op" id="4919454">)</span>&nbsp;<span class="op" id="4919456">-</span>&nbsp;<span class="num" id="4919458">1</span><span class="op" id="4919459">;</span>&nbsp;<span class="ident" id="4919461">i</span>&nbsp;<span class="op" id="4919463">&gt;=</span>&nbsp;<span class="num" id="4919466">0</span><span class="op" id="4919467">;</span>&nbsp;<span class="ident" id="4919469">i</span><span class="op" id="4919470">--</span>&nbsp;<span class="op" id="4919473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919477">if</span>&nbsp;<span class="ident" id="4919480">length</span>&nbsp;<span class="op" id="4919487">&gt;</span>&nbsp;<span class="ident" id="4919489">pairs</span><span class="op" id="4919494">[</span><span class="ident" id="4919495">i</span><span class="op" id="4919496">]</span><span class="op" id="4919497">.</span><span class="ident" id="4919498">length</span>&nbsp;<span class="op" id="4919505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919510">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919566">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919614">length</span>&nbsp;<span class="op" id="4919621">&gt;&gt;=</span>&nbsp;<span class="num" id="4919625">32</span>&nbsp;<span class="op" id="4919628">-</span>&nbsp;<span class="ident" id="4919630">pairs</span><span class="op" id="4919635">[</span><span class="ident" id="4919636">i</span><span class="op" id="4919637">]</span><span class="op" id="4919638">.</span><span class="ident" id="4919639">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919649">length</span>&nbsp;<span class="op" id="4919656">&lt;&lt;=</span>&nbsp;<span class="num" id="4919660">32</span>&nbsp;<span class="op" id="4919663">-</span>&nbsp;<span class="ident" id="4919665">pairs</span><span class="op" id="4919670">[</span><span class="ident" id="4919671">i</span><span class="op" id="4919672">]</span><span class="op" id="4919673">.</span><span class="ident" id="4919674">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919684">length</span>&nbsp;<span class="op" id="4919691">=</span>&nbsp;<span class="ident" id="4919693">pairs</span><span class="op" id="4919698">[</span><span class="ident" id="4919699">i</span><span class="op" id="4919700">]</span><span class="op" id="4919701">.</span><span class="ident" id="4919702">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919711">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919715">codes</span><span class="op" id="4919720">[</span><span class="ident" id="4919721">i</span><span class="op" id="4919722">]</span><span class="op" id="4919723">.</span><span class="ident" id="4919724">code</span>&nbsp;<span class="op" id="4919729">=</span>&nbsp;<span class="ident" id="4919731">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919738">codes</span><span class="op" id="4919743">[</span><span class="ident" id="4919744">i</span><span class="op" id="4919745">]</span><span class="op" id="4919746">.</span><span class="ident" id="4919747">codeLen</span>&nbsp;<span class="op" id="4919755">=</span>&nbsp;<span class="ident" id="4919757">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919766">codes</span><span class="op" id="4919771">[</span><span class="ident" id="4919772">i</span><span class="op" id="4919773">]</span><span class="op" id="4919774">.</span><span class="ident" id="4919775">value</span>&nbsp;<span class="op" id="4919781">=</span>&nbsp;<span class="ident" id="4919783">pairs</span><span class="op" id="4919788">[</span><span class="ident" id="4919789">i</span><span class="op" id="4919790">]</span><span class="op" id="4919791">.</span><span class="ident" id="4919792">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919800">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919866">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919899">code</span>&nbsp;<span class="op" id="4919904">+=</span>&nbsp;<span class="num" id="4919907">1</span>&nbsp;<span class="op" id="4919909">&lt;&lt;</span>&nbsp;<span class="op" id="4919912">(</span><span class="num" id="4919913">32</span>&nbsp;<span class="op" id="4919916">-</span>&nbsp;<span class="ident" id="4919918">length</span><span class="op" id="4919924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919931">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920004">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920039">sort</span><span class="op" id="4920043">.</span><span class="ident" id="4920044">Sort</span><span class="op" id="4920048">(</span><span class="ident" id="4920049">codes</span><span class="op" id="4920054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920058">t</span><span class="op" id="4920059">.</span><span class="ident" id="4920060">nodes</span>&nbsp;<span class="op" id="4920066">=</span>&nbsp;<span class="builtinfunc" id="4920068">make</span><span class="op" id="4920072">(</span><span class="op" id="4920073">[</span><span class="op" id="4920074">]</span><span class="ident" id="4920075">huffmanNode</span><span class="op" id="4920086">,</span>&nbsp;<span class="builtinfunc" id="4920088">len</span><span class="op" id="4920091">(</span><span class="ident" id="4920092">codes</span><span class="op" id="4920097">)</span><span class="op" id="4920098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920101">_</span><span class="op" id="4920102">,</span>&nbsp;<span class="ident" id="4920104">err</span>&nbsp;<span class="op" id="4920108">:=</span>&nbsp;<span class="ident" id="4920111">buildHuffmanNode</span><span class="op" id="4920127">(</span><span class="op" id="4920128">&amp;</span><span class="ident" id="4920129">t</span><span class="op" id="4920130">,</span>&nbsp;<span class="ident" id="4920132">codes</span><span class="op" id="4920137">,</span>&nbsp;<span class="num" id="4920139">0</span><span class="op" id="4920140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920143">return</span>&nbsp;<span class="ident" id="4920150">t</span><span class="op" id="4920151">,</span>&nbsp;<span class="ident" id="4920153">err</span><br>
<span class="lineno">120</span><span class="op" id="4920157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4920160">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4920226">type</span>&nbsp;<span class="ident" id="4920231">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="4920255">struct</span>&nbsp;<span class="op" id="4920262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920265">value</span>&nbsp;&nbsp;<span class="builtintype" id="4920272">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920280">length</span>&nbsp;<span class="builtintype" id="4920287">uint8</span><br>
<span class="lineno"></span><span class="op" id="4920293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4920296">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="4920368">type</span>&nbsp;<span class="ident" id="4920373">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="4920398">[</span><span class="op" id="4920399">]</span><span class="ident" id="4920400">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="4920425">func</span>&nbsp;<span class="op" id="4920430">(</span><span class="ident" id="4920431">h</span>&nbsp;<span class="ident" id="4920433">huffmanSymbolLengthPairs</span><span class="op" id="4920457">)</span>&nbsp;<span class="ident" id="4920459">Len</span><span class="op" id="4920462">(</span><span class="op" id="4920463">)</span>&nbsp;<span class="builtintype" id="4920465">int</span>&nbsp;<span class="op" id="4920469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920472">return</span>&nbsp;<span class="builtinfunc" id="4920479">len</span><span class="op" id="4920482">(</span><span class="ident" id="4920483">h</span><span class="op" id="4920484">)</span><br>
<span class="lineno"></span><span class="op" id="4920486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="4920489">func</span>&nbsp;<span class="op" id="4920494">(</span><span class="ident" id="4920495">h</span>&nbsp;<span class="ident" id="4920497">huffmanSymbolLengthPairs</span><span class="op" id="4920521">)</span>&nbsp;<span class="ident" id="4920523">Less</span><span class="op" id="4920527">(</span><span class="ident" id="4920528">i</span><span class="op" id="4920529">,</span>&nbsp;<span class="ident" id="4920531">j</span>&nbsp;<span class="builtintype" id="4920533">int</span><span class="op" id="4920536">)</span>&nbsp;<span class="builtintype" id="4920538">bool</span>&nbsp;<span class="op" id="4920543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920546">if</span>&nbsp;<span class="ident" id="4920549">h</span><span class="op" id="4920550">[</span><span class="ident" id="4920551">i</span><span class="op" id="4920552">]</span><span class="op" id="4920553">.</span><span class="ident" id="4920554">length</span>&nbsp;<span class="op" id="4920561">&lt;</span>&nbsp;<span class="ident" id="4920563">h</span><span class="op" id="4920564">[</span><span class="ident" id="4920565">j</span><span class="op" id="4920566">]</span><span class="op" id="4920567">.</span><span class="ident" id="4920568">length</span>&nbsp;<span class="op" id="4920575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920579">return</span>&nbsp;<span class="builtintype" id="4920586">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920595">if</span>&nbsp;<span class="ident" id="4920598">h</span><span class="op" id="4920599">[</span><span class="ident" id="4920600">i</span><span class="op" id="4920601">]</span><span class="op" id="4920602">.</span><span class="ident" id="4920603">length</span>&nbsp;<span class="op" id="4920610">&gt;</span>&nbsp;<span class="ident" id="4920612">h</span><span class="op" id="4920613">[</span><span class="ident" id="4920614">j</span><span class="op" id="4920615">]</span><span class="op" id="4920616">.</span><span class="ident" id="4920617">length</span>&nbsp;<span class="op" id="4920624">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920628">return</span>&nbsp;<span class="builtintype" id="4920635">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920645">if</span>&nbsp;<span class="ident" id="4920648">h</span><span class="op" id="4920649">[</span><span class="ident" id="4920650">i</span><span class="op" id="4920651">]</span><span class="op" id="4920652">.</span><span class="ident" id="4920653">value</span>&nbsp;<span class="op" id="4920659">&lt;</span>&nbsp;<span class="ident" id="4920661">h</span><span class="op" id="4920662">[</span><span class="ident" id="4920663">j</span><span class="op" id="4920664">]</span><span class="op" id="4920665">.</span><span class="ident" id="4920666">value</span>&nbsp;<span class="op" id="4920672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920676">return</span>&nbsp;<span class="builtintype" id="4920683">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920689">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920692">return</span>&nbsp;<span class="builtintype" id="4920699">false</span><br>
<span class="lineno"></span><span class="op" id="4920705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4920708">func</span>&nbsp;<span class="op" id="4920713">(</span><span class="ident" id="4920714">h</span>&nbsp;<span class="ident" id="4920716">huffmanSymbolLengthPairs</span><span class="op" id="4920740">)</span>&nbsp;<span class="ident" id="4920742">Swap</span><span class="op" id="4920746">(</span><span class="ident" id="4920747">i</span><span class="op" id="4920748">,</span>&nbsp;<span class="ident" id="4920750">j</span>&nbsp;<span class="builtintype" id="4920752">int</span><span class="op" id="4920755">)</span>&nbsp;<span class="op" id="4920757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920760">h</span><span class="op" id="4920761">[</span><span class="ident" id="4920762">i</span><span class="op" id="4920763">]</span><span class="op" id="4920764">,</span>&nbsp;<span class="ident" id="4920766">h</span><span class="op" id="4920767">[</span><span class="ident" id="4920768">j</span><span class="op" id="4920769">]</span>&nbsp;<span class="op" id="4920771">=</span>&nbsp;<span class="ident" id="4920773">h</span><span class="op" id="4920774">[</span><span class="ident" id="4920775">j</span><span class="op" id="4920776">]</span><span class="op" id="4920777">,</span>&nbsp;<span class="ident" id="4920779">h</span><span class="op" id="4920780">[</span><span class="ident" id="4920781">i</span><span class="op" id="4920782">]</span><br>
<span class="lineno">150</span><span class="op" id="4920784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4920787">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4920847">type</span>&nbsp;<span class="ident" id="4920852">huffmanCode</span>&nbsp;<span class="keyword" id="4920864">struct</span>&nbsp;<span class="op" id="4920871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920874">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4920882">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920890">codeLen</span>&nbsp;<span class="builtintype" id="4920898">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920905">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4920913">uint16</span><br>
<span class="lineno"></span><span class="op" id="4920920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4920923">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="4920984">type</span>&nbsp;<span class="ident" id="4920989">huffmanCodes</span>&nbsp;<span class="op" id="4921002">[</span><span class="op" id="4921003">]</span><span class="ident" id="4921004">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921017">func</span>&nbsp;<span class="op" id="4921022">(</span><span class="ident" id="4921023">n</span>&nbsp;<span class="ident" id="4921025">huffmanCodes</span><span class="op" id="4921037">)</span>&nbsp;<span class="ident" id="4921039">Len</span><span class="op" id="4921042">(</span><span class="op" id="4921043">)</span>&nbsp;<span class="builtintype" id="4921045">int</span>&nbsp;<span class="op" id="4921049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921052">return</span>&nbsp;<span class="builtinfunc" id="4921059">len</span><span class="op" id="4921062">(</span><span class="ident" id="4921063">n</span><span class="op" id="4921064">)</span><br>
<span class="lineno"></span><span class="op" id="4921066">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4921069">func</span>&nbsp;<span class="op" id="4921074">(</span><span class="ident" id="4921075">n</span>&nbsp;<span class="ident" id="4921077">huffmanCodes</span><span class="op" id="4921089">)</span>&nbsp;<span class="ident" id="4921091">Less</span><span class="op" id="4921095">(</span><span class="ident" id="4921096">i</span><span class="op" id="4921097">,</span>&nbsp;<span class="ident" id="4921099">j</span>&nbsp;<span class="builtintype" id="4921101">int</span><span class="op" id="4921104">)</span>&nbsp;<span class="builtintype" id="4921106">bool</span>&nbsp;<span class="op" id="4921111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921114">return</span>&nbsp;<span class="ident" id="4921121">n</span><span class="op" id="4921122">[</span><span class="ident" id="4921123">i</span><span class="op" id="4921124">]</span><span class="op" id="4921125">.</span><span class="ident" id="4921126">code</span>&nbsp;<span class="op" id="4921131">&lt;</span>&nbsp;<span class="ident" id="4921133">n</span><span class="op" id="4921134">[</span><span class="ident" id="4921135">j</span><span class="op" id="4921136">]</span><span class="op" id="4921137">.</span><span class="ident" id="4921138">code</span><br>
<span class="lineno"></span><span class="op" id="4921143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4921146">func</span>&nbsp;<span class="op" id="4921151">(</span><span class="ident" id="4921152">n</span>&nbsp;<span class="ident" id="4921154">huffmanCodes</span><span class="op" id="4921166">)</span>&nbsp;<span class="ident" id="4921168">Swap</span><span class="op" id="4921172">(</span><span class="ident" id="4921173">i</span><span class="op" id="4921174">,</span>&nbsp;<span class="ident" id="4921176">j</span>&nbsp;<span class="builtintype" id="4921178">int</span><span class="op" id="4921181">)</span>&nbsp;<span class="op" id="4921183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921186">n</span><span class="op" id="4921187">[</span><span class="ident" id="4921188">i</span><span class="op" id="4921189">]</span><span class="op" id="4921190">,</span>&nbsp;<span class="ident" id="4921192">n</span><span class="op" id="4921193">[</span><span class="ident" id="4921194">j</span><span class="op" id="4921195">]</span>&nbsp;<span class="op" id="4921197">=</span>&nbsp;<span class="ident" id="4921199">n</span><span class="op" id="4921200">[</span><span class="ident" id="4921201">j</span><span class="op" id="4921202">]</span><span class="op" id="4921203">,</span>&nbsp;<span class="ident" id="4921205">n</span><span class="op" id="4921206">[</span><span class="ident" id="4921207">i</span><span class="op" id="4921208">]</span><br>
<span class="lineno"></span><span class="op" id="4921210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4921213">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="4921291">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="4921365">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4921386">func</span>&nbsp;<span class="ident" id="4921391">buildHuffmanNode</span><span class="op" id="4921407">(</span><span class="ident" id="4921408">t</span>&nbsp;<span class="op" id="4921410">*</span><span class="ident" id="4921411">huffmanTree</span><span class="op" id="4921422">,</span>&nbsp;<span class="ident" id="4921424">codes</span>&nbsp;<span class="op" id="4921430">[</span><span class="op" id="4921431">]</span><span class="ident" id="4921432">huffmanCode</span><span class="op" id="4921443">,</span>&nbsp;<span class="ident" id="4921445">level</span>&nbsp;<span class="builtintype" id="4921451">uint32</span><span class="op" id="4921457">)</span>&nbsp;<span class="op" id="4921459">(</span><span class="ident" id="4921460">nodeIndex</span>&nbsp;<span class="builtintype" id="4921470">uint16</span><span class="op" id="4921476">,</span>&nbsp;<span class="ident" id="4921478">err</span>&nbsp;<span class="builtintype" id="4921482">error</span><span class="op" id="4921487">)</span>&nbsp;<span class="op" id="4921489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921492">test</span>&nbsp;<span class="op" id="4921497">:=</span>&nbsp;<span class="builtintype" id="4921500">uint32</span><span class="op" id="4921506">(</span><span class="num" id="4921507">1</span><span class="op" id="4921508">)</span>&nbsp;<span class="op" id="4921510">&lt;&lt;</span>&nbsp;<span class="op" id="4921513">(</span><span class="num" id="4921514">31</span>&nbsp;<span class="op" id="4921517">-</span>&nbsp;<span class="ident" id="4921519">level</span><span class="op" id="4921524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921528">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921621">firstRightIndex</span>&nbsp;<span class="op" id="4921637">:=</span>&nbsp;<span class="builtinfunc" id="4921640">len</span><span class="op" id="4921643">(</span><span class="ident" id="4921644">codes</span><span class="op" id="4921649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921652">for</span>&nbsp;<span class="ident" id="4921656">i</span><span class="op" id="4921657">,</span>&nbsp;<span class="ident" id="4921659">code</span>&nbsp;<span class="op" id="4921664">:=</span>&nbsp;<span class="keyword" id="4921667">range</span>&nbsp;<span class="ident" id="4921673">codes</span>&nbsp;<span class="op" id="4921679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921683">if</span>&nbsp;<span class="ident" id="4921686">code</span><span class="op" id="4921690">.</span><span class="ident" id="4921691">code</span><span class="op" id="4921695">&amp;</span><span class="ident" id="4921696">test</span>&nbsp;<span class="op" id="4921701">!=</span>&nbsp;<span class="num" id="4921704">0</span>&nbsp;<span class="op" id="4921706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921711">firstRightIndex</span>&nbsp;<span class="op" id="4921727">=</span>&nbsp;<span class="ident" id="4921729">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921734">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921749">left</span>&nbsp;<span class="op" id="4921754">:=</span>&nbsp;<span class="ident" id="4921757">codes</span><span class="op" id="4921762">[</span><span class="op" id="4921763">:</span><span class="ident" id="4921764">firstRightIndex</span><span class="op" id="4921779">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921782">right</span>&nbsp;<span class="op" id="4921788">:=</span>&nbsp;<span class="ident" id="4921791">codes</span><span class="op" id="4921796">[</span><span class="ident" id="4921797">firstRightIndex</span><span class="op" id="4921812">:</span><span class="op" id="4921813">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921817">if</span>&nbsp;<span class="builtinfunc" id="4921820">len</span><span class="op" id="4921823">(</span><span class="ident" id="4921824">left</span><span class="op" id="4921828">)</span>&nbsp;<span class="op" id="4921830">==</span>&nbsp;<span class="num" id="4921833">0</span>&nbsp;<span class="op" id="4921835">||</span>&nbsp;<span class="builtinfunc" id="4921838">len</span><span class="op" id="4921841">(</span><span class="ident" id="4921842">right</span><span class="op" id="4921847">)</span>&nbsp;<span class="op" id="4921849">==</span>&nbsp;<span class="num" id="4921852">0</span>&nbsp;<span class="op" id="4921854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921858">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921923">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4921989">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922021">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922084">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922147">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922195">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922200">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922265">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922331">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922393">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922448">if</span>&nbsp;<span class="builtinfunc" id="4922451">len</span><span class="op" id="4922454">(</span><span class="ident" id="4922455">codes</span><span class="op" id="4922460">)</span>&nbsp;<span class="op" id="4922462">&lt;</span>&nbsp;<span class="num" id="4922464">2</span>&nbsp;<span class="op" id="4922466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922471">return</span>&nbsp;<span class="num" id="4922478">0</span><span class="op" id="4922479">,</span>&nbsp;<span class="ident" id="4922481">StructuralError</span><span class="op" id="4922496">(</span><span class="string" id="4922497">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="4922517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922526">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922591">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922650">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922666">if</span>&nbsp;<span class="ident" id="4922669">level</span>&nbsp;<span class="op" id="4922675">==</span>&nbsp;<span class="num" id="4922678">31</span>&nbsp;<span class="op" id="4922681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922686">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922743">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922802">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922853">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922879">return</span>&nbsp;<span class="num" id="4922886">0</span><span class="op" id="4922887">,</span>&nbsp;<span class="ident" id="4922889">StructuralError</span><span class="op" id="4922904">(</span><span class="string" id="4922905">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="4922936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922945">if</span>&nbsp;<span class="builtinfunc" id="4922948">len</span><span class="op" id="4922951">(</span><span class="ident" id="4922952">left</span><span class="op" id="4922956">)</span>&nbsp;<span class="op" id="4922958">==</span>&nbsp;<span class="num" id="4922961">0</span>&nbsp;<span class="op" id="4922963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922968">return</span>&nbsp;<span class="ident" id="4922975">buildHuffmanNode</span><span class="op" id="4922991">(</span><span class="ident" id="4922992">t</span><span class="op" id="4922993">,</span>&nbsp;<span class="ident" id="4922995">right</span><span class="op" id="4923000">,</span>&nbsp;<span class="ident" id="4923002">level</span><span class="op" id="4923007">+</span><span class="num" id="4923008">1</span><span class="op" id="4923009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923017">return</span>&nbsp;<span class="ident" id="4923024">buildHuffmanNode</span><span class="op" id="4923040">(</span><span class="ident" id="4923041">t</span><span class="op" id="4923042">,</span>&nbsp;<span class="ident" id="4923044">left</span><span class="op" id="4923048">,</span>&nbsp;<span class="ident" id="4923050">level</span><span class="op" id="4923055">+</span><span class="num" id="4923056">1</span><span class="op" id="4923057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923060">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923064">nodeIndex</span>&nbsp;<span class="op" id="4923074">=</span>&nbsp;<span class="builtintype" id="4923076">uint16</span><span class="op" id="4923082">(</span><span class="ident" id="4923083">t</span><span class="op" id="4923084">.</span><span class="ident" id="4923085">nextNode</span><span class="op" id="4923093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923096">node</span>&nbsp;<span class="op" id="4923101">:=</span>&nbsp;<span class="op" id="4923104">&amp;</span><span class="ident" id="4923105">t</span><span class="op" id="4923106">.</span><span class="ident" id="4923107">nodes</span><span class="op" id="4923112">[</span><span class="ident" id="4923113">t</span><span class="op" id="4923114">.</span><span class="ident" id="4923115">nextNode</span><span class="op" id="4923123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923126">t</span><span class="op" id="4923127">.</span><span class="ident" id="4923128">nextNode</span><span class="op" id="4923136">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923141">if</span>&nbsp;<span class="builtinfunc" id="4923144">len</span><span class="op" id="4923147">(</span><span class="ident" id="4923148">left</span><span class="op" id="4923152">)</span>&nbsp;<span class="op" id="4923154">==</span>&nbsp;<span class="num" id="4923157">1</span>&nbsp;<span class="op" id="4923159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923163">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923178">node</span><span class="op" id="4923182">.</span><span class="ident" id="4923183">left</span>&nbsp;<span class="op" id="4923188">=</span>&nbsp;<span class="ident" id="4923190">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923209">node</span><span class="op" id="4923213">.</span><span class="ident" id="4923214">leftValue</span>&nbsp;<span class="op" id="4923224">=</span>&nbsp;<span class="ident" id="4923226">left</span><span class="op" id="4923230">[</span><span class="num" id="4923231">0</span><span class="op" id="4923232">]</span><span class="op" id="4923233">.</span><span class="ident" id="4923234">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923241">}</span>&nbsp;<span class="keyword" id="4923243">else</span>&nbsp;<span class="op" id="4923248">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923252">node</span><span class="op" id="4923256">.</span><span class="ident" id="4923257">left</span><span class="op" id="4923261">,</span>&nbsp;<span class="ident" id="4923263">err</span>&nbsp;<span class="op" id="4923267">=</span>&nbsp;<span class="ident" id="4923269">buildHuffmanNode</span><span class="op" id="4923285">(</span><span class="ident" id="4923286">t</span><span class="op" id="4923287">,</span>&nbsp;<span class="ident" id="4923289">left</span><span class="op" id="4923293">,</span>&nbsp;<span class="ident" id="4923295">level</span><span class="op" id="4923300">+</span><span class="num" id="4923301">1</span><span class="op" id="4923302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923309">if</span>&nbsp;<span class="ident" id="4923312">err</span>&nbsp;<span class="op" id="4923316">!=</span>&nbsp;<span class="ident" id="4923319">nil</span>&nbsp;<span class="op" id="4923323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923327">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923339">if</span>&nbsp;<span class="builtinfunc" id="4923342">len</span><span class="op" id="4923345">(</span><span class="ident" id="4923346">right</span><span class="op" id="4923351">)</span>&nbsp;<span class="op" id="4923353">==</span>&nbsp;<span class="num" id="4923356">1</span>&nbsp;<span class="op" id="4923358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923362">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923377">node</span><span class="op" id="4923381">.</span><span class="ident" id="4923382">right</span>&nbsp;<span class="op" id="4923388">=</span>&nbsp;<span class="ident" id="4923390">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923409">node</span><span class="op" id="4923413">.</span><span class="ident" id="4923414">rightValue</span>&nbsp;<span class="op" id="4923425">=</span>&nbsp;<span class="ident" id="4923427">right</span><span class="op" id="4923432">[</span><span class="num" id="4923433">0</span><span class="op" id="4923434">]</span><span class="op" id="4923435">.</span><span class="ident" id="4923436">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923443">}</span>&nbsp;<span class="keyword" id="4923445">else</span>&nbsp;<span class="op" id="4923450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923454">node</span><span class="op" id="4923458">.</span><span class="ident" id="4923459">right</span><span class="op" id="4923464">,</span>&nbsp;<span class="ident" id="4923466">err</span>&nbsp;<span class="op" id="4923470">=</span>&nbsp;<span class="ident" id="4923472">buildHuffmanNode</span><span class="op" id="4923488">(</span><span class="ident" id="4923489">t</span><span class="op" id="4923490">,</span>&nbsp;<span class="ident" id="4923492">right</span><span class="op" id="4923497">,</span>&nbsp;<span class="ident" id="4923499">level</span><span class="op" id="4923504">+</span><span class="num" id="4923505">1</span><span class="op" id="4923506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923513">return</span><br>
<span class="lineno"></span><span class="op" id="4923520">}</span>
</div>
</body>
</html>
