<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7417890">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7417946">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7418000">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7418051">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7418116">package</span>&nbsp;<span class="ident" id="7418124">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7418130">import</span>&nbsp;<span class="op" id="7418137">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7418140">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7418153">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7418159">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7418169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7418172">func</span>&nbsp;<span class="ident" id="7418177">TestLookPathUnixEmptyPath</span><span class="op" id="7418202">(</span><span class="ident" id="7418203">t</span>&nbsp;<span class="op" id="7418205">*</span><span class="ident" id="7418206">testing</span><span class="op" id="7418213">.</span><span class="ident" id="7418214">T</span><span class="op" id="7418215">)</span>&nbsp;<span class="op" id="7418217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418220">tmp</span><span class="op" id="7418223">,</span>&nbsp;<span class="ident" id="7418225">err</span>&nbsp;<span class="op" id="7418229">:=</span>&nbsp;<span class="ident" id="7418232">ioutil</span><span class="op" id="7418238">.</span><span class="ident" id="7418239">TempDir</span><span class="op" id="7418246">(</span><span class="string" id="7418247">&#34;&#34;</span><span class="op" id="7418249">,</span>&nbsp;<span class="string" id="7418251">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7418278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418281">if</span>&nbsp;<span class="ident" id="7418284">err</span>&nbsp;<span class="op" id="7418288">!=</span>&nbsp;<span class="ident" id="7418291">nil</span>&nbsp;<span class="op" id="7418295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418299">t</span><span class="op" id="7418300">.</span><span class="ident" id="7418301">Fatal</span><span class="op" id="7418306">(</span><span class="string" id="7418307">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418325">,</span>&nbsp;<span class="ident" id="7418327">err</span><span class="op" id="7418330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418333">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418336">defer</span>&nbsp;<span class="ident" id="7418342">os</span><span class="op" id="7418344">.</span><span class="ident" id="7418345">RemoveAll</span><span class="op" id="7418354">(</span><span class="ident" id="7418355">tmp</span><span class="op" id="7418358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418361">wd</span><span class="op" id="7418363">,</span>&nbsp;<span class="ident" id="7418365">err</span>&nbsp;<span class="op" id="7418369">:=</span>&nbsp;<span class="ident" id="7418372">os</span><span class="op" id="7418374">.</span><span class="ident" id="7418375">Getwd</span><span class="op" id="7418380">(</span><span class="op" id="7418381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418384">if</span>&nbsp;<span class="ident" id="7418387">err</span>&nbsp;<span class="op" id="7418391">!=</span>&nbsp;<span class="ident" id="7418394">nil</span>&nbsp;<span class="op" id="7418398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418402">t</span><span class="op" id="7418403">.</span><span class="ident" id="7418404">Fatal</span><span class="op" id="7418409">(</span><span class="string" id="7418410">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418426">,</span>&nbsp;<span class="ident" id="7418428">err</span><span class="op" id="7418431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418434">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418437">err</span>&nbsp;<span class="op" id="7418441">=</span>&nbsp;<span class="ident" id="7418443">os</span><span class="op" id="7418445">.</span><span class="ident" id="7418446">Chdir</span><span class="op" id="7418451">(</span><span class="ident" id="7418452">tmp</span><span class="op" id="7418455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418458">if</span>&nbsp;<span class="ident" id="7418461">err</span>&nbsp;<span class="op" id="7418465">!=</span>&nbsp;<span class="ident" id="7418468">nil</span>&nbsp;<span class="op" id="7418472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418476">t</span><span class="op" id="7418477">.</span><span class="ident" id="7418478">Fatal</span><span class="op" id="7418483">(</span><span class="string" id="7418484">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418500">,</span>&nbsp;<span class="ident" id="7418502">err</span><span class="op" id="7418505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418511">defer</span>&nbsp;<span class="ident" id="7418517">os</span><span class="op" id="7418519">.</span><span class="ident" id="7418520">Chdir</span><span class="op" id="7418525">(</span><span class="ident" id="7418526">wd</span><span class="op" id="7418528">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418532">f</span><span class="op" id="7418533">,</span>&nbsp;<span class="ident" id="7418535">err</span>&nbsp;<span class="op" id="7418539">:=</span>&nbsp;<span class="ident" id="7418542">os</span><span class="op" id="7418544">.</span><span class="ident" id="7418545">OpenFile</span><span class="op" id="7418553">(</span><span class="string" id="7418554">&#34;exec_me&#34;</span><span class="op" id="7418563">,</span>&nbsp;<span class="ident" id="7418565">os</span><span class="op" id="7418567">.</span><span class="ident" id="7418568">O_CREATE</span><span class="op" id="7418576">|</span><span class="ident" id="7418577">os</span><span class="op" id="7418579">.</span><span class="ident" id="7418580">O_EXCL</span><span class="op" id="7418586">,</span>&nbsp;<span class="num" id="7418588">0700</span><span class="op" id="7418592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418595">if</span>&nbsp;<span class="ident" id="7418598">err</span>&nbsp;<span class="op" id="7418602">!=</span>&nbsp;<span class="ident" id="7418605">nil</span>&nbsp;<span class="op" id="7418609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418613">t</span><span class="op" id="7418614">.</span><span class="ident" id="7418615">Fatal</span><span class="op" id="7418620">(</span><span class="string" id="7418621">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418640">,</span>&nbsp;<span class="ident" id="7418642">err</span><span class="op" id="7418645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418648">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418651">err</span>&nbsp;<span class="op" id="7418655">=</span>&nbsp;<span class="ident" id="7418657">f</span><span class="op" id="7418658">.</span><span class="ident" id="7418659">Close</span><span class="op" id="7418664">(</span><span class="op" id="7418665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418668">if</span>&nbsp;<span class="ident" id="7418671">err</span>&nbsp;<span class="op" id="7418675">!=</span>&nbsp;<span class="ident" id="7418678">nil</span>&nbsp;<span class="op" id="7418682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418686">t</span><span class="op" id="7418687">.</span><span class="ident" id="7418688">Fatal</span><span class="op" id="7418693">(</span><span class="string" id="7418694">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418710">,</span>&nbsp;<span class="ident" id="7418712">err</span><span class="op" id="7418715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418722">pathenv</span>&nbsp;<span class="op" id="7418730">:=</span>&nbsp;<span class="ident" id="7418733">os</span><span class="op" id="7418735">.</span><span class="ident" id="7418736">Getenv</span><span class="op" id="7418742">(</span><span class="string" id="7418743">&#34;PATH&#34;</span><span class="op" id="7418749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418752">defer</span>&nbsp;<span class="ident" id="7418758">os</span><span class="op" id="7418760">.</span><span class="ident" id="7418761">Setenv</span><span class="op" id="7418767">(</span><span class="string" id="7418768">&#34;PATH&#34;</span><span class="op" id="7418774">,</span>&nbsp;<span class="ident" id="7418776">pathenv</span><span class="op" id="7418783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418787">err</span>&nbsp;<span class="op" id="7418791">=</span>&nbsp;<span class="ident" id="7418793">os</span><span class="op" id="7418795">.</span><span class="ident" id="7418796">Setenv</span><span class="op" id="7418802">(</span><span class="string" id="7418803">&#34;PATH&#34;</span><span class="op" id="7418809">,</span>&nbsp;<span class="string" id="7418811">&#34;&#34;</span><span class="op" id="7418813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418816">if</span>&nbsp;<span class="ident" id="7418819">err</span>&nbsp;<span class="op" id="7418823">!=</span>&nbsp;<span class="ident" id="7418826">nil</span>&nbsp;<span class="op" id="7418830">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418834">t</span><span class="op" id="7418835">.</span><span class="ident" id="7418836">Fatal</span><span class="op" id="7418841">(</span><span class="string" id="7418842">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7418859">,</span>&nbsp;<span class="ident" id="7418861">err</span><span class="op" id="7418864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418871">path</span><span class="op" id="7418875">,</span>&nbsp;<span class="ident" id="7418877">err</span>&nbsp;<span class="op" id="7418881">:=</span>&nbsp;<span class="ident" id="7418884">LookPath</span><span class="op" id="7418892">(</span><span class="string" id="7418893">&#34;exec_me&#34;</span><span class="op" id="7418902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418905">if</span>&nbsp;<span class="ident" id="7418908">err</span>&nbsp;<span class="op" id="7418912">==</span>&nbsp;<span class="ident" id="7418915">nil</span>&nbsp;<span class="op" id="7418919">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418923">t</span><span class="op" id="7418924">.</span><span class="ident" id="7418925">Fatal</span><span class="op" id="7418930">(</span><span class="string" id="7418931">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7418970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7418973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7418976">if</span>&nbsp;<span class="ident" id="7418979">path</span>&nbsp;<span class="op" id="7418984">!=</span>&nbsp;<span class="string" id="7418987">&#34;&#34;</span>&nbsp;<span class="op" id="7418990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7418994">t</span><span class="op" id="7418995">.</span><span class="ident" id="7418996">Fatalf</span><span class="op" id="7419002">(</span><span class="string" id="7419003">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7419040">,</span>&nbsp;<span class="ident" id="7419042">path</span><span class="op" id="7419046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7419049">}</span><br>
<span class="lineno">55</span><span class="op" id="7419051">}</span>
</div>
</body>
</html>
