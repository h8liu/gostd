<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6235200">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6235255">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6235309">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6235360">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6235432">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6235506">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6235581">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6235639">//</span><br>
<span class="lineno">10</span><span class="keyword" id="6235642">package</span>&nbsp;<span class="ident" id="6235650">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6235658">import</span>&nbsp;<span class="op" id="6235665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235668">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235675">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235685">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235699">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235711">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235722">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6235733">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6235743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6235746">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="6235805">type</span>&nbsp;<span class="ident" id="6235810">parser</span>&nbsp;<span class="keyword" id="6235817">struct</span>&nbsp;<span class="op" id="6235824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235827">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6235835">*</span><span class="ident" id="6235836">token</span><span class="op" id="6235841">.</span><span class="ident" id="6235842">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235848">errors</span>&nbsp;&nbsp;<span class="ident" id="6235856">scanner</span><span class="op" id="6235863">.</span><span class="ident" id="6235864">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235875">scanner</span>&nbsp;<span class="ident" id="6235883">scanner</span><span class="op" id="6235890">.</span><span class="ident" id="6235891">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235901">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235923">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6235930">Mode</span>&nbsp;<span class="comment" id="6235935">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235952">trace</span>&nbsp;&nbsp;<span class="builtintype" id="6235959">bool</span>&nbsp;<span class="comment" id="6235964">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235991">indent</span>&nbsp;<span class="builtintype" id="6235998">int</span>&nbsp;&nbsp;<span class="comment" id="6236003">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236044">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236057">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6236069">[</span><span class="op" id="6236070">]</span><span class="op" id="6236071">*</span><span class="ident" id="6236072">ast</span><span class="op" id="6236075">.</span><span class="ident" id="6236076">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236090">leadComment</span>&nbsp;<span class="op" id="6236102">*</span><span class="ident" id="6236103">ast</span><span class="op" id="6236106">.</span><span class="ident" id="6236107">CommentGroup</span>&nbsp;<span class="comment" id="6236120">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236142">lineComment</span>&nbsp;<span class="op" id="6236154">*</span><span class="ident" id="6236155">ast</span><span class="op" id="6236158">.</span><span class="ident" id="6236159">CommentGroup</span>&nbsp;<span class="comment" id="6236172">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236195">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236210">pos</span>&nbsp;<span class="ident" id="6236214">token</span><span class="op" id="6236219">.</span><span class="ident" id="6236220">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6236226">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236245">tok</span>&nbsp;<span class="ident" id="6236249">token</span><span class="op" id="6236254">.</span><span class="ident" id="6236255">Token</span>&nbsp;<span class="comment" id="6236261">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236286">lit</span>&nbsp;<span class="builtintype" id="6236290">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6236302">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236321">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236340">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236400">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236460">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236526">syncPos</span>&nbsp;<span class="ident" id="6236534">token</span><span class="op" id="6236539">.</span><span class="ident" id="6236540">Pos</span>&nbsp;<span class="comment" id="6236544">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236578">syncCnt</span>&nbsp;<span class="builtintype" id="6236586">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6236596">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236645">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236678">exprLev</span>&nbsp;<span class="builtintype" id="6236686">int</span>&nbsp;&nbsp;<span class="comment" id="6236691">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236739">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6236747">bool</span>&nbsp;<span class="comment" id="6236752">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236804">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236835">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6236846">*</span><span class="ident" id="6236847">ast</span><span class="op" id="6236850">.</span><span class="ident" id="6236851">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6236864">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236890">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6236901">*</span><span class="ident" id="6236902">ast</span><span class="op" id="6236905">.</span><span class="ident" id="6236906">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6236919">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236955">unresolved</span>&nbsp;<span class="op" id="6236966">[</span><span class="op" id="6236967">]</span><span class="op" id="6236968">*</span><span class="ident" id="6236969">ast</span><span class="op" id="6236972">.</span><span class="ident" id="6236973">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6236984">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237011">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6237022">[</span><span class="op" id="6237023">]</span><span class="op" id="6237024">*</span><span class="ident" id="6237025">ast</span><span class="op" id="6237028">.</span><span class="ident" id="6237029">ImportSpec</span>&nbsp;<span class="comment" id="6237040">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237061">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237078">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237120">labelScope</span>&nbsp;&nbsp;<span class="op" id="6237132">*</span><span class="ident" id="6237133">ast</span><span class="op" id="6237136">.</span><span class="ident" id="6237137">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6237147">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237184">targetStack</span>&nbsp;<span class="op" id="6237196">[</span><span class="op" id="6237197">]</span><span class="op" id="6237198">[</span><span class="op" id="6237199">]</span><span class="op" id="6237200">*</span><span class="ident" id="6237201">ast</span><span class="op" id="6237204">.</span><span class="ident" id="6237205">Ident</span>&nbsp;<span class="comment" id="6237211">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="6237241">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6237244">func</span>&nbsp;<span class="op" id="6237249">(</span><span class="ident" id="6237250">p</span>&nbsp;<span class="op" id="6237252">*</span><span class="ident" id="6237253">parser</span><span class="op" id="6237259">)</span>&nbsp;<span class="ident" id="6237261">init</span><span class="op" id="6237265">(</span><span class="ident" id="6237266">fset</span>&nbsp;<span class="op" id="6237271">*</span><span class="ident" id="6237272">token</span><span class="op" id="6237277">.</span><span class="ident" id="6237278">FileSet</span><span class="op" id="6237285">,</span>&nbsp;<span class="ident" id="6237287">filename</span>&nbsp;<span class="builtintype" id="6237296">string</span><span class="op" id="6237302">,</span>&nbsp;<span class="ident" id="6237304">src</span>&nbsp;<span class="op" id="6237308">[</span><span class="op" id="6237309">]</span><span class="builtintype" id="6237310">byte</span><span class="op" id="6237314">,</span>&nbsp;<span class="ident" id="6237316">mode</span>&nbsp;<span class="ident" id="6237321">Mode</span><span class="op" id="6237325">)</span>&nbsp;<span class="op" id="6237327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237330">p</span><span class="op" id="6237331">.</span><span class="ident" id="6237332">file</span>&nbsp;<span class="op" id="6237337">=</span>&nbsp;<span class="ident" id="6237339">fset</span><span class="op" id="6237343">.</span><span class="ident" id="6237344">AddFile</span><span class="op" id="6237351">(</span><span class="ident" id="6237352">filename</span><span class="op" id="6237360">,</span>&nbsp;<span class="op" id="6237362">-</span><span class="num" id="6237363">1</span><span class="op" id="6237364">,</span>&nbsp;<span class="builtinfunc" id="6237366">len</span><span class="op" id="6237369">(</span><span class="ident" id="6237370">src</span><span class="op" id="6237373">)</span><span class="op" id="6237374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237377">var</span>&nbsp;<span class="ident" id="6237381">m</span>&nbsp;<span class="ident" id="6237383">scanner</span><span class="op" id="6237390">.</span><span class="ident" id="6237391">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237397">if</span>&nbsp;<span class="ident" id="6237400">mode</span><span class="op" id="6237404">&amp;</span><span class="ident" id="6237405">ParseComments</span>&nbsp;<span class="op" id="6237419">!=</span>&nbsp;<span class="num" id="6237422">0</span>&nbsp;<span class="op" id="6237424">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237428">m</span>&nbsp;<span class="op" id="6237430">=</span>&nbsp;<span class="ident" id="6237432">scanner</span><span class="op" id="6237439">.</span><span class="ident" id="6237440">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237457">eh</span>&nbsp;<span class="op" id="6237460">:=</span>&nbsp;<span class="keyword" id="6237463">func</span><span class="op" id="6237467">(</span><span class="ident" id="6237468">pos</span>&nbsp;<span class="ident" id="6237472">token</span><span class="op" id="6237477">.</span><span class="ident" id="6237478">Position</span><span class="op" id="6237486">,</span>&nbsp;<span class="ident" id="6237488">msg</span>&nbsp;<span class="builtintype" id="6237492">string</span><span class="op" id="6237498">)</span>&nbsp;<span class="op" id="6237500">{</span>&nbsp;<span class="ident" id="6237502">p</span><span class="op" id="6237503">.</span><span class="ident" id="6237504">errors</span><span class="op" id="6237510">.</span><span class="ident" id="6237511">Add</span><span class="op" id="6237514">(</span><span class="ident" id="6237515">pos</span><span class="op" id="6237518">,</span>&nbsp;<span class="ident" id="6237520">msg</span><span class="op" id="6237523">)</span>&nbsp;<span class="op" id="6237525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237528">p</span><span class="op" id="6237529">.</span><span class="ident" id="6237530">scanner</span><span class="op" id="6237537">.</span><span class="ident" id="6237538">Init</span><span class="op" id="6237542">(</span><span class="ident" id="6237543">p</span><span class="op" id="6237544">.</span><span class="ident" id="6237545">file</span><span class="op" id="6237549">,</span>&nbsp;<span class="ident" id="6237551">src</span><span class="op" id="6237554">,</span>&nbsp;<span class="ident" id="6237556">eh</span><span class="op" id="6237558">,</span>&nbsp;<span class="ident" id="6237560">m</span><span class="op" id="6237561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237565">p</span><span class="op" id="6237566">.</span><span class="ident" id="6237567">mode</span>&nbsp;<span class="op" id="6237572">=</span>&nbsp;<span class="ident" id="6237574">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237580">p</span><span class="op" id="6237581">.</span><span class="ident" id="6237582">trace</span>&nbsp;<span class="op" id="6237588">=</span>&nbsp;<span class="ident" id="6237590">mode</span><span class="op" id="6237594">&amp;</span><span class="ident" id="6237595">Trace</span>&nbsp;<span class="op" id="6237601">!=</span>&nbsp;<span class="num" id="6237604">0</span>&nbsp;<span class="comment" id="6237606">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237656">p</span><span class="op" id="6237657">.</span><span class="ident" id="6237658">next</span><span class="op" id="6237662">(</span><span class="op" id="6237663">)</span><br>
<span class="lineno"></span><span class="op" id="6237665">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6237668">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6237748">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6237768">func</span>&nbsp;<span class="op" id="6237773">(</span><span class="ident" id="6237774">p</span>&nbsp;<span class="op" id="6237776">*</span><span class="ident" id="6237777">parser</span><span class="op" id="6237783">)</span>&nbsp;<span class="ident" id="6237785">openScope</span><span class="op" id="6237794">(</span><span class="op" id="6237795">)</span>&nbsp;<span class="op" id="6237797">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237800">p</span><span class="op" id="6237801">.</span><span class="ident" id="6237802">topScope</span>&nbsp;<span class="op" id="6237811">=</span>&nbsp;<span class="ident" id="6237813">ast</span><span class="op" id="6237816">.</span><span class="ident" id="6237817">NewScope</span><span class="op" id="6237825">(</span><span class="ident" id="6237826">p</span><span class="op" id="6237827">.</span><span class="ident" id="6237828">topScope</span><span class="op" id="6237836">)</span><br>
<span class="lineno"></span><span class="op" id="6237838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6237841">func</span>&nbsp;<span class="op" id="6237846">(</span><span class="ident" id="6237847">p</span>&nbsp;<span class="op" id="6237849">*</span><span class="ident" id="6237850">parser</span><span class="op" id="6237856">)</span>&nbsp;<span class="ident" id="6237858">closeScope</span><span class="op" id="6237868">(</span><span class="op" id="6237869">)</span>&nbsp;<span class="op" id="6237871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237874">p</span><span class="op" id="6237875">.</span><span class="ident" id="6237876">topScope</span>&nbsp;<span class="op" id="6237885">=</span>&nbsp;<span class="ident" id="6237887">p</span><span class="op" id="6237888">.</span><span class="ident" id="6237889">topScope</span><span class="op" id="6237897">.</span><span class="ident" id="6237898">Outer</span><br>
<span class="lineno">90</span><span class="op" id="6237904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6237907">func</span>&nbsp;<span class="op" id="6237912">(</span><span class="ident" id="6237913">p</span>&nbsp;<span class="op" id="6237915">*</span><span class="ident" id="6237916">parser</span><span class="op" id="6237922">)</span>&nbsp;<span class="ident" id="6237924">openLabelScope</span><span class="op" id="6237938">(</span><span class="op" id="6237939">)</span>&nbsp;<span class="op" id="6237941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237944">p</span><span class="op" id="6237945">.</span><span class="ident" id="6237946">labelScope</span>&nbsp;<span class="op" id="6237957">=</span>&nbsp;<span class="ident" id="6237959">ast</span><span class="op" id="6237962">.</span><span class="ident" id="6237963">NewScope</span><span class="op" id="6237971">(</span><span class="ident" id="6237972">p</span><span class="op" id="6237973">.</span><span class="ident" id="6237974">labelScope</span><span class="op" id="6237984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237987">p</span><span class="op" id="6237988">.</span><span class="ident" id="6237989">targetStack</span>&nbsp;<span class="op" id="6238001">=</span>&nbsp;<span class="builtinfunc" id="6238003">append</span><span class="op" id="6238009">(</span><span class="ident" id="6238010">p</span><span class="op" id="6238011">.</span><span class="ident" id="6238012">targetStack</span><span class="op" id="6238023">,</span>&nbsp;<span class="ident" id="6238025">nil</span><span class="op" id="6238028">)</span><br>
<span class="lineno">95</span><span class="op" id="6238030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6238033">func</span>&nbsp;<span class="op" id="6238038">(</span><span class="ident" id="6238039">p</span>&nbsp;<span class="op" id="6238041">*</span><span class="ident" id="6238042">parser</span><span class="op" id="6238048">)</span>&nbsp;<span class="ident" id="6238050">closeLabelScope</span><span class="op" id="6238065">(</span><span class="op" id="6238066">)</span>&nbsp;<span class="op" id="6238068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238071">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238090">n</span>&nbsp;<span class="op" id="6238092">:=</span>&nbsp;<span class="builtinfunc" id="6238095">len</span><span class="op" id="6238098">(</span><span class="ident" id="6238099">p</span><span class="op" id="6238100">.</span><span class="ident" id="6238101">targetStack</span><span class="op" id="6238112">)</span>&nbsp;<span class="op" id="6238114">-</span>&nbsp;<span class="num" id="6238116">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238119">scope</span>&nbsp;<span class="op" id="6238125">:=</span>&nbsp;<span class="ident" id="6238128">p</span><span class="op" id="6238129">.</span><span class="ident" id="6238130">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238142">for</span>&nbsp;<span class="ident" id="6238146">_</span><span class="op" id="6238147">,</span>&nbsp;<span class="ident" id="6238149">ident</span>&nbsp;<span class="op" id="6238155">:=</span>&nbsp;<span class="keyword" id="6238158">range</span>&nbsp;<span class="ident" id="6238164">p</span><span class="op" id="6238165">.</span><span class="ident" id="6238166">targetStack</span><span class="op" id="6238177">[</span><span class="ident" id="6238178">n</span><span class="op" id="6238179">]</span>&nbsp;<span class="op" id="6238181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238185">ident</span><span class="op" id="6238190">.</span><span class="ident" id="6238191">Obj</span>&nbsp;<span class="op" id="6238195">=</span>&nbsp;<span class="ident" id="6238197">scope</span><span class="op" id="6238202">.</span><span class="ident" id="6238203">Lookup</span><span class="op" id="6238209">(</span><span class="ident" id="6238210">ident</span><span class="op" id="6238215">.</span><span class="ident" id="6238216">Name</span><span class="op" id="6238220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238224">if</span>&nbsp;<span class="ident" id="6238227">ident</span><span class="op" id="6238232">.</span><span class="ident" id="6238233">Obj</span>&nbsp;<span class="op" id="6238237">==</span>&nbsp;<span class="ident" id="6238240">nil</span>&nbsp;<span class="op" id="6238244">&amp;&amp;</span>&nbsp;<span class="ident" id="6238247">p</span><span class="op" id="6238248">.</span><span class="ident" id="6238249">mode</span><span class="op" id="6238253">&amp;</span><span class="ident" id="6238254">DeclarationErrors</span>&nbsp;<span class="op" id="6238272">!=</span>&nbsp;<span class="num" id="6238275">0</span>&nbsp;<span class="op" id="6238277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238282">p</span><span class="op" id="6238283">.</span><span class="builtintype" id="6238284">error</span><span class="op" id="6238289">(</span><span class="ident" id="6238290">ident</span><span class="op" id="6238295">.</span><span class="ident" id="6238296">Pos</span><span class="op" id="6238299">(</span><span class="op" id="6238300">)</span><span class="op" id="6238301">,</span>&nbsp;<span class="ident" id="6238303">fmt</span><span class="op" id="6238306">.</span><span class="ident" id="6238307">Sprintf</span><span class="op" id="6238314">(</span><span class="string" id="6238315">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="6238335">,</span>&nbsp;<span class="ident" id="6238337">ident</span><span class="op" id="6238342">.</span><span class="ident" id="6238343">Name</span><span class="op" id="6238347">)</span><span class="op" id="6238348">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238358">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238378">p</span><span class="op" id="6238379">.</span><span class="ident" id="6238380">targetStack</span>&nbsp;<span class="op" id="6238392">=</span>&nbsp;<span class="ident" id="6238394">p</span><span class="op" id="6238395">.</span><span class="ident" id="6238396">targetStack</span><span class="op" id="6238407">[</span><span class="num" id="6238408">0</span><span class="op" id="6238409">:</span><span class="ident" id="6238410">n</span><span class="op" id="6238411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238414">p</span><span class="op" id="6238415">.</span><span class="ident" id="6238416">labelScope</span>&nbsp;<span class="op" id="6238427">=</span>&nbsp;<span class="ident" id="6238429">p</span><span class="op" id="6238430">.</span><span class="ident" id="6238431">labelScope</span><span class="op" id="6238441">.</span><span class="ident" id="6238442">Outer</span><br>
<span class="lineno">110</span><span class="op" id="6238448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6238451">func</span>&nbsp;<span class="op" id="6238456">(</span><span class="ident" id="6238457">p</span>&nbsp;<span class="op" id="6238459">*</span><span class="ident" id="6238460">parser</span><span class="op" id="6238466">)</span>&nbsp;<span class="ident" id="6238468">declare</span><span class="op" id="6238475">(</span><span class="ident" id="6238476">decl</span><span class="op" id="6238480">,</span>&nbsp;<span class="ident" id="6238482">data</span>&nbsp;<span class="keyword" id="6238487">interface</span><span class="op" id="6238496">{</span><span class="op" id="6238497">}</span><span class="op" id="6238498">,</span>&nbsp;<span class="ident" id="6238500">scope</span>&nbsp;<span class="op" id="6238506">*</span><span class="ident" id="6238507">ast</span><span class="op" id="6238510">.</span><span class="ident" id="6238511">Scope</span><span class="op" id="6238516">,</span>&nbsp;<span class="ident" id="6238518">kind</span>&nbsp;<span class="ident" id="6238523">ast</span><span class="op" id="6238526">.</span><span class="ident" id="6238527">ObjKind</span><span class="op" id="6238534">,</span>&nbsp;<span class="ident" id="6238536">idents</span>&nbsp;<span class="op" id="6238543">...</span><span class="op" id="6238546">*</span><span class="ident" id="6238547">ast</span><span class="op" id="6238550">.</span><span class="ident" id="6238551">Ident</span><span class="op" id="6238556">)</span>&nbsp;<span class="op" id="6238558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238561">for</span>&nbsp;<span class="ident" id="6238565">_</span><span class="op" id="6238566">,</span>&nbsp;<span class="ident" id="6238568">ident</span>&nbsp;<span class="op" id="6238574">:=</span>&nbsp;<span class="keyword" id="6238577">range</span>&nbsp;<span class="ident" id="6238583">idents</span>&nbsp;<span class="op" id="6238590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238594">assert</span><span class="op" id="6238600">(</span><span class="ident" id="6238601">ident</span><span class="op" id="6238606">.</span><span class="ident" id="6238607">Obj</span>&nbsp;<span class="op" id="6238611">==</span>&nbsp;<span class="ident" id="6238614">nil</span><span class="op" id="6238617">,</span>&nbsp;<span class="string" id="6238619">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="6238660">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238664">obj</span>&nbsp;<span class="op" id="6238668">:=</span>&nbsp;<span class="ident" id="6238671">ast</span><span class="op" id="6238674">.</span><span class="ident" id="6238675">NewObj</span><span class="op" id="6238681">(</span><span class="ident" id="6238682">kind</span><span class="op" id="6238686">,</span>&nbsp;<span class="ident" id="6238688">ident</span><span class="op" id="6238693">.</span><span class="ident" id="6238694">Name</span><span class="op" id="6238698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238702">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238764">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238826">obj</span><span class="op" id="6238829">.</span><span class="ident" id="6238830">Decl</span>&nbsp;<span class="op" id="6238835">=</span>&nbsp;<span class="ident" id="6238837">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238844">obj</span><span class="op" id="6238847">.</span><span class="ident" id="6238848">Data</span>&nbsp;<span class="op" id="6238853">=</span>&nbsp;<span class="ident" id="6238855">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238862">ident</span><span class="op" id="6238867">.</span><span class="ident" id="6238868">Obj</span>&nbsp;<span class="op" id="6238872">=</span>&nbsp;<span class="ident" id="6238874">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238880">if</span>&nbsp;<span class="ident" id="6238883">ident</span><span class="op" id="6238888">.</span><span class="ident" id="6238889">Name</span>&nbsp;<span class="op" id="6238894">!=</span>&nbsp;<span class="string" id="6238897">&#34;_&#34;</span>&nbsp;<span class="op" id="6238901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238906">if</span>&nbsp;<span class="ident" id="6238909">alt</span>&nbsp;<span class="op" id="6238913">:=</span>&nbsp;<span class="ident" id="6238916">scope</span><span class="op" id="6238921">.</span><span class="ident" id="6238922">Insert</span><span class="op" id="6238928">(</span><span class="ident" id="6238929">obj</span><span class="op" id="6238932">)</span><span class="op" id="6238933">;</span>&nbsp;<span class="ident" id="6238935">alt</span>&nbsp;<span class="op" id="6238939">!=</span>&nbsp;<span class="ident" id="6238942">nil</span>&nbsp;<span class="op" id="6238946">&amp;&amp;</span>&nbsp;<span class="ident" id="6238949">p</span><span class="op" id="6238950">.</span><span class="ident" id="6238951">mode</span><span class="op" id="6238955">&amp;</span><span class="ident" id="6238956">DeclarationErrors</span>&nbsp;<span class="op" id="6238974">!=</span>&nbsp;<span class="num" id="6238977">0</span>&nbsp;<span class="op" id="6238979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238985">prevDecl</span>&nbsp;<span class="op" id="6238994">:=</span>&nbsp;<span class="string" id="6238997">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239004">if</span>&nbsp;<span class="ident" id="6239007">pos</span>&nbsp;<span class="op" id="6239011">:=</span>&nbsp;<span class="ident" id="6239014">alt</span><span class="op" id="6239017">.</span><span class="ident" id="6239018">Pos</span><span class="op" id="6239021">(</span><span class="op" id="6239022">)</span><span class="op" id="6239023">;</span>&nbsp;<span class="ident" id="6239025">pos</span><span class="op" id="6239028">.</span><span class="ident" id="6239029">IsValid</span><span class="op" id="6239036">(</span><span class="op" id="6239037">)</span>&nbsp;<span class="op" id="6239039">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239046">prevDecl</span>&nbsp;<span class="op" id="6239055">=</span>&nbsp;<span class="ident" id="6239057">fmt</span><span class="op" id="6239060">.</span><span class="ident" id="6239061">Sprintf</span><span class="op" id="6239068">(</span><span class="string" id="6239069">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="6239101">,</span>&nbsp;<span class="ident" id="6239103">p</span><span class="op" id="6239104">.</span><span class="ident" id="6239105">file</span><span class="op" id="6239109">.</span><span class="ident" id="6239110">Position</span><span class="op" id="6239118">(</span><span class="ident" id="6239119">pos</span><span class="op" id="6239122">)</span><span class="op" id="6239123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239135">p</span><span class="op" id="6239136">.</span><span class="builtintype" id="6239137">error</span><span class="op" id="6239142">(</span><span class="ident" id="6239143">ident</span><span class="op" id="6239148">.</span><span class="ident" id="6239149">Pos</span><span class="op" id="6239152">(</span><span class="op" id="6239153">)</span><span class="op" id="6239154">,</span>&nbsp;<span class="ident" id="6239156">fmt</span><span class="op" id="6239159">.</span><span class="ident" id="6239160">Sprintf</span><span class="op" id="6239167">(</span><span class="string" id="6239168">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="6239199">,</span>&nbsp;<span class="ident" id="6239201">ident</span><span class="op" id="6239206">.</span><span class="ident" id="6239207">Name</span><span class="op" id="6239211">,</span>&nbsp;<span class="ident" id="6239213">prevDecl</span><span class="op" id="6239221">)</span><span class="op" id="6239222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239231">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239234">}</span><br>
<span class="lineno"></span><span class="op" id="6239236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6239239">func</span>&nbsp;<span class="op" id="6239244">(</span><span class="ident" id="6239245">p</span>&nbsp;<span class="op" id="6239247">*</span><span class="ident" id="6239248">parser</span><span class="op" id="6239254">)</span>&nbsp;<span class="ident" id="6239256">shortVarDecl</span><span class="op" id="6239268">(</span><span class="ident" id="6239269">decl</span>&nbsp;<span class="op" id="6239274">*</span><span class="ident" id="6239275">ast</span><span class="op" id="6239278">.</span><span class="ident" id="6239279">AssignStmt</span><span class="op" id="6239289">,</span>&nbsp;<span class="ident" id="6239291">list</span>&nbsp;<span class="op" id="6239296">[</span><span class="op" id="6239297">]</span><span class="ident" id="6239298">ast</span><span class="op" id="6239301">.</span><span class="ident" id="6239302">Expr</span><span class="op" id="6239306">)</span>&nbsp;<span class="op" id="6239308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239311">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239377">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239443">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239514">n</span>&nbsp;<span class="op" id="6239516">:=</span>&nbsp;<span class="num" id="6239519">0</span>&nbsp;<span class="comment" id="6239521">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239549">for</span>&nbsp;<span class="ident" id="6239553">_</span><span class="op" id="6239554">,</span>&nbsp;<span class="ident" id="6239556">x</span>&nbsp;<span class="op" id="6239558">:=</span>&nbsp;<span class="keyword" id="6239561">range</span>&nbsp;<span class="ident" id="6239567">list</span>&nbsp;<span class="op" id="6239572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239576">if</span>&nbsp;<span class="ident" id="6239579">ident</span><span class="op" id="6239584">,</span>&nbsp;<span class="ident" id="6239586">isIdent</span>&nbsp;<span class="op" id="6239594">:=</span>&nbsp;<span class="ident" id="6239597">x</span><span class="op" id="6239598">.</span><span class="op" id="6239599">(</span><span class="op" id="6239600">*</span><span class="ident" id="6239601">ast</span><span class="op" id="6239604">.</span><span class="ident" id="6239605">Ident</span><span class="op" id="6239610">)</span><span class="op" id="6239611">;</span>&nbsp;<span class="ident" id="6239613">isIdent</span>&nbsp;<span class="op" id="6239621">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239626">assert</span><span class="op" id="6239632">(</span><span class="ident" id="6239633">ident</span><span class="op" id="6239638">.</span><span class="ident" id="6239639">Obj</span>&nbsp;<span class="op" id="6239643">==</span>&nbsp;<span class="ident" id="6239646">nil</span><span class="op" id="6239649">,</span>&nbsp;<span class="string" id="6239651">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="6239692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239697">obj</span>&nbsp;<span class="op" id="6239701">:=</span>&nbsp;<span class="ident" id="6239704">ast</span><span class="op" id="6239707">.</span><span class="ident" id="6239708">NewObj</span><span class="op" id="6239714">(</span><span class="ident" id="6239715">ast</span><span class="op" id="6239718">.</span><span class="ident" id="6239719">Var</span><span class="op" id="6239722">,</span>&nbsp;<span class="ident" id="6239724">ident</span><span class="op" id="6239729">.</span><span class="ident" id="6239730">Name</span><span class="op" id="6239734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239739">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239795">obj</span><span class="op" id="6239798">.</span><span class="ident" id="6239799">Decl</span>&nbsp;<span class="op" id="6239804">=</span>&nbsp;<span class="ident" id="6239806">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239814">ident</span><span class="op" id="6239819">.</span><span class="ident" id="6239820">Obj</span>&nbsp;<span class="op" id="6239824">=</span>&nbsp;<span class="ident" id="6239826">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239833">if</span>&nbsp;<span class="ident" id="6239836">ident</span><span class="op" id="6239841">.</span><span class="ident" id="6239842">Name</span>&nbsp;<span class="op" id="6239847">!=</span>&nbsp;<span class="string" id="6239850">&#34;_&#34;</span>&nbsp;<span class="op" id="6239854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239860">if</span>&nbsp;<span class="ident" id="6239863">alt</span>&nbsp;<span class="op" id="6239867">:=</span>&nbsp;<span class="ident" id="6239870">p</span><span class="op" id="6239871">.</span><span class="ident" id="6239872">topScope</span><span class="op" id="6239880">.</span><span class="ident" id="6239881">Insert</span><span class="op" id="6239887">(</span><span class="ident" id="6239888">obj</span><span class="op" id="6239891">)</span><span class="op" id="6239892">;</span>&nbsp;<span class="ident" id="6239894">alt</span>&nbsp;<span class="op" id="6239898">!=</span>&nbsp;<span class="ident" id="6239901">nil</span>&nbsp;<span class="op" id="6239905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239912">ident</span><span class="op" id="6239917">.</span><span class="ident" id="6239918">Obj</span>&nbsp;<span class="op" id="6239922">=</span>&nbsp;<span class="ident" id="6239924">alt</span>&nbsp;<span class="comment" id="6239928">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239949">}</span>&nbsp;<span class="keyword" id="6239951">else</span>&nbsp;<span class="op" id="6239956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239963">n</span><span class="op" id="6239964">++</span>&nbsp;<span class="comment" id="6239967">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239999">}</span>&nbsp;<span class="keyword" id="6240001">else</span>&nbsp;<span class="op" id="6240006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240011">p</span><span class="op" id="6240012">.</span><span class="ident" id="6240013">errorExpected</span><span class="op" id="6240026">(</span><span class="ident" id="6240027">x</span><span class="op" id="6240028">.</span><span class="ident" id="6240029">Pos</span><span class="op" id="6240032">(</span><span class="op" id="6240033">)</span><span class="op" id="6240034">,</span>&nbsp;<span class="string" id="6240036">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="6240067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240071">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240077">if</span>&nbsp;<span class="ident" id="6240080">n</span>&nbsp;<span class="op" id="6240082">==</span>&nbsp;<span class="num" id="6240085">0</span>&nbsp;<span class="op" id="6240087">&amp;&amp;</span>&nbsp;<span class="ident" id="6240090">p</span><span class="op" id="6240091">.</span><span class="ident" id="6240092">mode</span><span class="op" id="6240096">&amp;</span><span class="ident" id="6240097">DeclarationErrors</span>&nbsp;<span class="op" id="6240115">!=</span>&nbsp;<span class="num" id="6240118">0</span>&nbsp;<span class="op" id="6240120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240124">p</span><span class="op" id="6240125">.</span><span class="builtintype" id="6240126">error</span><span class="op" id="6240131">(</span><span class="ident" id="6240132">list</span><span class="op" id="6240136">[</span><span class="num" id="6240137">0</span><span class="op" id="6240138">]</span><span class="op" id="6240139">.</span><span class="ident" id="6240140">Pos</span><span class="op" id="6240143">(</span><span class="op" id="6240144">)</span><span class="op" id="6240145">,</span>&nbsp;<span class="string" id="6240147">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="6240184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240187">}</span><br>
<span class="lineno"></span><span class="op" id="6240189">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="6240192">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="6240272">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="6240354">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="6240379">var</span>&nbsp;<span class="ident" id="6240383">unresolved</span>&nbsp;<span class="op" id="6240394">=</span>&nbsp;<span class="builtinfunc" id="6240396">new</span><span class="op" id="6240399">(</span><span class="ident" id="6240400">ast</span><span class="op" id="6240403">.</span><span class="ident" id="6240404">Object</span><span class="op" id="6240410">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="6240413">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="6240486">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6240559">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="6240633">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="6240649">//</span><br>
<span class="lineno"></span><span class="keyword" id="6240652">func</span>&nbsp;<span class="op" id="6240657">(</span><span class="ident" id="6240658">p</span>&nbsp;<span class="op" id="6240660">*</span><span class="ident" id="6240661">parser</span><span class="op" id="6240667">)</span>&nbsp;<span class="ident" id="6240669">tryResolve</span><span class="op" id="6240679">(</span><span class="ident" id="6240680">x</span>&nbsp;<span class="ident" id="6240682">ast</span><span class="op" id="6240685">.</span><span class="ident" id="6240686">Expr</span><span class="op" id="6240690">,</span>&nbsp;<span class="ident" id="6240692">collectUnresolved</span>&nbsp;<span class="builtintype" id="6240710">bool</span><span class="op" id="6240714">)</span>&nbsp;<span class="op" id="6240716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240719">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240787">ident</span><span class="op" id="6240792">,</span>&nbsp;<span class="ident" id="6240794">_</span>&nbsp;<span class="op" id="6240796">:=</span>&nbsp;<span class="ident" id="6240799">x</span><span class="op" id="6240800">.</span><span class="op" id="6240801">(</span><span class="op" id="6240802">*</span><span class="ident" id="6240803">ast</span><span class="op" id="6240806">.</span><span class="ident" id="6240807">Ident</span><span class="op" id="6240812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240815">if</span>&nbsp;<span class="ident" id="6240818">ident</span>&nbsp;<span class="op" id="6240824">==</span>&nbsp;<span class="ident" id="6240827">nil</span>&nbsp;<span class="op" id="6240831">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240835">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240846">assert</span><span class="op" id="6240852">(</span><span class="ident" id="6240853">ident</span><span class="op" id="6240858">.</span><span class="ident" id="6240859">Obj</span>&nbsp;<span class="op" id="6240863">==</span>&nbsp;<span class="ident" id="6240866">nil</span><span class="op" id="6240869">,</span>&nbsp;<span class="string" id="6240871">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="6240912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240915">if</span>&nbsp;<span class="ident" id="6240918">ident</span><span class="op" id="6240923">.</span><span class="ident" id="6240924">Name</span>&nbsp;<span class="op" id="6240929">==</span>&nbsp;<span class="string" id="6240932">&#34;_&#34;</span>&nbsp;<span class="op" id="6240936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240940">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240951">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240985">for</span>&nbsp;<span class="ident" id="6240989">s</span>&nbsp;<span class="op" id="6240991">:=</span>&nbsp;<span class="ident" id="6240994">p</span><span class="op" id="6240995">.</span><span class="ident" id="6240996">topScope</span><span class="op" id="6241004">;</span>&nbsp;<span class="ident" id="6241006">s</span>&nbsp;<span class="op" id="6241008">!=</span>&nbsp;<span class="ident" id="6241011">nil</span><span class="op" id="6241014">;</span>&nbsp;<span class="ident" id="6241016">s</span>&nbsp;<span class="op" id="6241018">=</span>&nbsp;<span class="ident" id="6241020">s</span><span class="op" id="6241021">.</span><span class="ident" id="6241022">Outer</span>&nbsp;<span class="op" id="6241028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241032">if</span>&nbsp;<span class="ident" id="6241035">obj</span>&nbsp;<span class="op" id="6241039">:=</span>&nbsp;<span class="ident" id="6241042">s</span><span class="op" id="6241043">.</span><span class="ident" id="6241044">Lookup</span><span class="op" id="6241050">(</span><span class="ident" id="6241051">ident</span><span class="op" id="6241056">.</span><span class="ident" id="6241057">Name</span><span class="op" id="6241061">)</span><span class="op" id="6241062">;</span>&nbsp;<span class="ident" id="6241064">obj</span>&nbsp;<span class="op" id="6241068">!=</span>&nbsp;<span class="ident" id="6241071">nil</span>&nbsp;<span class="op" id="6241075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241080">ident</span><span class="op" id="6241085">.</span><span class="ident" id="6241086">Obj</span>&nbsp;<span class="op" id="6241090">=</span>&nbsp;<span class="ident" id="6241092">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241114">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241175">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241233">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241294">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241338">if</span>&nbsp;<span class="ident" id="6241341">collectUnresolved</span>&nbsp;<span class="op" id="6241359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241363">ident</span><span class="op" id="6241368">.</span><span class="ident" id="6241369">Obj</span>&nbsp;<span class="op" id="6241373">=</span>&nbsp;<span class="ident" id="6241375">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241388">p</span><span class="op" id="6241389">.</span><span class="ident" id="6241390">unresolved</span>&nbsp;<span class="op" id="6241401">=</span>&nbsp;<span class="builtinfunc" id="6241403">append</span><span class="op" id="6241409">(</span><span class="ident" id="6241410">p</span><span class="op" id="6241411">.</span><span class="ident" id="6241412">unresolved</span><span class="op" id="6241422">,</span>&nbsp;<span class="ident" id="6241424">ident</span><span class="op" id="6241429">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241432">}</span><br>
<span class="lineno"></span><span class="op" id="6241434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6241437">func</span>&nbsp;<span class="op" id="6241442">(</span><span class="ident" id="6241443">p</span>&nbsp;<span class="op" id="6241445">*</span><span class="ident" id="6241446">parser</span><span class="op" id="6241452">)</span>&nbsp;<span class="ident" id="6241454">resolve</span><span class="op" id="6241461">(</span><span class="ident" id="6241462">x</span>&nbsp;<span class="ident" id="6241464">ast</span><span class="op" id="6241467">.</span><span class="ident" id="6241468">Expr</span><span class="op" id="6241472">)</span>&nbsp;<span class="op" id="6241474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241477">p</span><span class="op" id="6241478">.</span><span class="ident" id="6241479">tryResolve</span><span class="op" id="6241489">(</span><span class="ident" id="6241490">x</span><span class="op" id="6241491">,</span>&nbsp;<span class="builtintype" id="6241493">true</span><span class="op" id="6241497">)</span><br>
<span class="lineno">200</span><span class="op" id="6241499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6241502">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6241582">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="6241602">func</span>&nbsp;<span class="op" id="6241607">(</span><span class="ident" id="6241608">p</span>&nbsp;<span class="op" id="6241610">*</span><span class="ident" id="6241611">parser</span><span class="op" id="6241617">)</span>&nbsp;<span class="ident" id="6241619">printTrace</span><span class="op" id="6241629">(</span><span class="ident" id="6241630">a</span>&nbsp;<span class="op" id="6241632">...</span><span class="keyword" id="6241635">interface</span><span class="op" id="6241644">{</span><span class="op" id="6241645">}</span><span class="op" id="6241646">)</span>&nbsp;<span class="op" id="6241648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241651">const</span>&nbsp;<span class="ident" id="6241657">dots</span>&nbsp;<span class="op" id="6241662">=</span>&nbsp;<span class="string" id="6241664">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241732">const</span>&nbsp;<span class="ident" id="6241738">n</span>&nbsp;<span class="op" id="6241740">=</span>&nbsp;<span class="builtinfunc" id="6241742">len</span><span class="op" id="6241745">(</span><span class="ident" id="6241746">dots</span><span class="op" id="6241750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241753">pos</span>&nbsp;<span class="op" id="6241757">:=</span>&nbsp;<span class="ident" id="6241760">p</span><span class="op" id="6241761">.</span><span class="ident" id="6241762">file</span><span class="op" id="6241766">.</span><span class="ident" id="6241767">Position</span><span class="op" id="6241775">(</span><span class="ident" id="6241776">p</span><span class="op" id="6241777">.</span><span class="ident" id="6241778">pos</span><span class="op" id="6241781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241784">fmt</span><span class="op" id="6241787">.</span><span class="ident" id="6241788">Printf</span><span class="op" id="6241794">(</span><span class="string" id="6241795">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="6241806">,</span>&nbsp;<span class="ident" id="6241808">pos</span><span class="op" id="6241811">.</span><span class="ident" id="6241812">Line</span><span class="op" id="6241816">,</span>&nbsp;<span class="ident" id="6241818">pos</span><span class="op" id="6241821">.</span><span class="ident" id="6241822">Column</span><span class="op" id="6241828">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241831">i</span>&nbsp;<span class="op" id="6241833">:=</span>&nbsp;<span class="num" id="6241836">2</span>&nbsp;<span class="op" id="6241838">*</span>&nbsp;<span class="ident" id="6241840">p</span><span class="op" id="6241841">.</span><span class="ident" id="6241842">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241850">for</span>&nbsp;<span class="ident" id="6241854">i</span>&nbsp;<span class="op" id="6241856">&gt;</span>&nbsp;<span class="ident" id="6241858">n</span>&nbsp;<span class="op" id="6241860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241864">fmt</span><span class="op" id="6241867">.</span><span class="ident" id="6241868">Print</span><span class="op" id="6241873">(</span><span class="ident" id="6241874">dots</span><span class="op" id="6241878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241882">i</span>&nbsp;<span class="op" id="6241884">-=</span>&nbsp;<span class="ident" id="6241887">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241890">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241893">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241904">fmt</span><span class="op" id="6241907">.</span><span class="ident" id="6241908">Print</span><span class="op" id="6241913">(</span><span class="ident" id="6241914">dots</span><span class="op" id="6241918">[</span><span class="num" id="6241919">0</span><span class="op" id="6241920">:</span><span class="ident" id="6241921">i</span><span class="op" id="6241922">]</span><span class="op" id="6241923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241926">fmt</span><span class="op" id="6241929">.</span><span class="ident" id="6241930">Println</span><span class="op" id="6241937">(</span><span class="ident" id="6241938">a</span><span class="op" id="6241939">...</span><span class="op" id="6241942">)</span><br>
<span class="lineno"></span><span class="op" id="6241944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="6241947">func</span>&nbsp;<span class="ident" id="6241952">trace</span><span class="op" id="6241957">(</span><span class="ident" id="6241958">p</span>&nbsp;<span class="op" id="6241960">*</span><span class="ident" id="6241961">parser</span><span class="op" id="6241967">,</span>&nbsp;<span class="ident" id="6241969">msg</span>&nbsp;<span class="builtintype" id="6241973">string</span><span class="op" id="6241979">)</span>&nbsp;<span class="op" id="6241981">*</span><span class="ident" id="6241982">parser</span>&nbsp;<span class="op" id="6241989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241992">p</span><span class="op" id="6241993">.</span><span class="ident" id="6241994">printTrace</span><span class="op" id="6242004">(</span><span class="ident" id="6242005">msg</span><span class="op" id="6242008">,</span>&nbsp;<span class="string" id="6242010">&#34;(&#34;</span><span class="op" id="6242013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242016">p</span><span class="op" id="6242017">.</span><span class="ident" id="6242018">indent</span><span class="op" id="6242024">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242028">return</span>&nbsp;<span class="ident" id="6242035">p</span><br>
<span class="lineno"></span><span class="op" id="6242037">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="6242040">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="6242084">func</span>&nbsp;<span class="ident" id="6242089">un</span><span class="op" id="6242091">(</span><span class="ident" id="6242092">p</span>&nbsp;<span class="op" id="6242094">*</span><span class="ident" id="6242095">parser</span><span class="op" id="6242101">)</span>&nbsp;<span class="op" id="6242103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242106">p</span><span class="op" id="6242107">.</span><span class="ident" id="6242108">indent</span><span class="op" id="6242114">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242118">p</span><span class="op" id="6242119">.</span><span class="ident" id="6242120">printTrace</span><span class="op" id="6242130">(</span><span class="string" id="6242131">&#34;)&#34;</span><span class="op" id="6242134">)</span><br>
<span class="lineno">230</span><span class="op" id="6242136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6242139">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="6242169">func</span>&nbsp;<span class="op" id="6242174">(</span><span class="ident" id="6242175">p</span>&nbsp;<span class="op" id="6242177">*</span><span class="ident" id="6242178">parser</span><span class="op" id="6242184">)</span>&nbsp;<span class="ident" id="6242186">next0</span><span class="op" id="6242191">(</span><span class="op" id="6242192">)</span>&nbsp;<span class="op" id="6242194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242197">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242259">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242319">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242378">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242425">if</span>&nbsp;<span class="ident" id="6242428">p</span><span class="op" id="6242429">.</span><span class="ident" id="6242430">trace</span>&nbsp;<span class="op" id="6242436">&amp;&amp;</span>&nbsp;<span class="ident" id="6242439">p</span><span class="op" id="6242440">.</span><span class="ident" id="6242441">pos</span><span class="op" id="6242444">.</span><span class="ident" id="6242445">IsValid</span><span class="op" id="6242452">(</span><span class="op" id="6242453">)</span>&nbsp;<span class="op" id="6242455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242459">s</span>&nbsp;<span class="op" id="6242461">:=</span>&nbsp;<span class="ident" id="6242464">p</span><span class="op" id="6242465">.</span><span class="ident" id="6242466">tok</span><span class="op" id="6242469">.</span><span class="ident" id="6242470">String</span><span class="op" id="6242476">(</span><span class="op" id="6242477">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242481">switch</span>&nbsp;<span class="op" id="6242488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242492">case</span>&nbsp;<span class="ident" id="6242497">p</span><span class="op" id="6242498">.</span><span class="ident" id="6242499">tok</span><span class="op" id="6242502">.</span><span class="ident" id="6242503">IsLiteral</span><span class="op" id="6242512">(</span><span class="op" id="6242513">)</span><span class="op" id="6242514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242519">p</span><span class="op" id="6242520">.</span><span class="ident" id="6242521">printTrace</span><span class="op" id="6242531">(</span><span class="ident" id="6242532">s</span><span class="op" id="6242533">,</span>&nbsp;<span class="ident" id="6242535">p</span><span class="op" id="6242536">.</span><span class="ident" id="6242537">lit</span><span class="op" id="6242540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242544">case</span>&nbsp;<span class="ident" id="6242549">p</span><span class="op" id="6242550">.</span><span class="ident" id="6242551">tok</span><span class="op" id="6242554">.</span><span class="ident" id="6242555">IsOperator</span><span class="op" id="6242565">(</span><span class="op" id="6242566">)</span><span class="op" id="6242567">,</span>&nbsp;<span class="ident" id="6242569">p</span><span class="op" id="6242570">.</span><span class="ident" id="6242571">tok</span><span class="op" id="6242574">.</span><span class="ident" id="6242575">IsKeyword</span><span class="op" id="6242584">(</span><span class="op" id="6242585">)</span><span class="op" id="6242586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242591">p</span><span class="op" id="6242592">.</span><span class="ident" id="6242593">printTrace</span><span class="op" id="6242603">(</span><span class="string" id="6242604">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="6242609">+</span>&nbsp;<span class="ident" id="6242611">s</span>&nbsp;<span class="op" id="6242613">+</span>&nbsp;<span class="string" id="6242615">&#34;\&#34;&#34;</span><span class="op" id="6242619">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242623">default</span><span class="op" id="6242630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242635">p</span><span class="op" id="6242636">.</span><span class="ident" id="6242637">printTrace</span><span class="op" id="6242647">(</span><span class="ident" id="6242648">s</span><span class="op" id="6242649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242660">p</span><span class="op" id="6242661">.</span><span class="ident" id="6242662">pos</span><span class="op" id="6242665">,</span>&nbsp;<span class="ident" id="6242667">p</span><span class="op" id="6242668">.</span><span class="ident" id="6242669">tok</span><span class="op" id="6242672">,</span>&nbsp;<span class="ident" id="6242674">p</span><span class="op" id="6242675">.</span><span class="ident" id="6242676">lit</span>&nbsp;<span class="op" id="6242680">=</span>&nbsp;<span class="ident" id="6242682">p</span><span class="op" id="6242683">.</span><span class="ident" id="6242684">scanner</span><span class="op" id="6242691">.</span><span class="ident" id="6242692">Scan</span><span class="op" id="6242696">(</span><span class="op" id="6242697">)</span><br>
<span class="lineno"></span><span class="op" id="6242699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6242702">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="6242768">func</span>&nbsp;<span class="op" id="6242773">(</span><span class="ident" id="6242774">p</span>&nbsp;<span class="op" id="6242776">*</span><span class="ident" id="6242777">parser</span><span class="op" id="6242783">)</span>&nbsp;<span class="ident" id="6242785">consumeComment</span><span class="op" id="6242799">(</span><span class="op" id="6242800">)</span>&nbsp;<span class="op" id="6242802">(</span><span class="ident" id="6242803">comment</span>&nbsp;<span class="op" id="6242811">*</span><span class="ident" id="6242812">ast</span><span class="op" id="6242815">.</span><span class="ident" id="6242816">Comment</span><span class="op" id="6242823">,</span>&nbsp;<span class="ident" id="6242825">endline</span>&nbsp;<span class="builtintype" id="6242833">int</span><span class="op" id="6242836">)</span>&nbsp;<span class="op" id="6242838">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242841">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242914">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242982">endline</span>&nbsp;<span class="op" id="6242990">=</span>&nbsp;<span class="ident" id="6242992">p</span><span class="op" id="6242993">.</span><span class="ident" id="6242994">file</span><span class="op" id="6242998">.</span><span class="ident" id="6242999">Line</span><span class="op" id="6243003">(</span><span class="ident" id="6243004">p</span><span class="op" id="6243005">.</span><span class="ident" id="6243006">pos</span><span class="op" id="6243009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243012">if</span>&nbsp;<span class="ident" id="6243015">p</span><span class="op" id="6243016">.</span><span class="ident" id="6243017">lit</span><span class="op" id="6243020">[</span><span class="num" id="6243021">1</span><span class="op" id="6243022">]</span>&nbsp;<span class="op" id="6243024">==</span>&nbsp;<span class="string" id="6243027">&#39;*&#39;</span>&nbsp;<span class="op" id="6243031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6243035">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243101">for</span>&nbsp;<span class="ident" id="6243105">i</span>&nbsp;<span class="op" id="6243107">:=</span>&nbsp;<span class="num" id="6243110">0</span><span class="op" id="6243111">;</span>&nbsp;<span class="ident" id="6243113">i</span>&nbsp;<span class="op" id="6243115">&lt;</span>&nbsp;<span class="builtinfunc" id="6243117">len</span><span class="op" id="6243120">(</span><span class="ident" id="6243121">p</span><span class="op" id="6243122">.</span><span class="ident" id="6243123">lit</span><span class="op" id="6243126">)</span><span class="op" id="6243127">;</span>&nbsp;<span class="ident" id="6243129">i</span><span class="op" id="6243130">++</span>&nbsp;<span class="op" id="6243133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243138">if</span>&nbsp;<span class="ident" id="6243141">p</span><span class="op" id="6243142">.</span><span class="ident" id="6243143">lit</span><span class="op" id="6243146">[</span><span class="ident" id="6243147">i</span><span class="op" id="6243148">]</span>&nbsp;<span class="op" id="6243150">==</span>&nbsp;<span class="string" id="6243153">&#39;\n&#39;</span>&nbsp;<span class="op" id="6243158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243164">endline</span><span class="op" id="6243171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243181">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243188">comment</span>&nbsp;<span class="op" id="6243196">=</span>&nbsp;<span class="op" id="6243198">&amp;</span><span class="ident" id="6243199">ast</span><span class="op" id="6243202">.</span><span class="ident" id="6243203">Comment</span><span class="op" id="6243210">{</span><span class="ident" id="6243211">Slash</span><span class="op" id="6243216">:</span>&nbsp;<span class="ident" id="6243218">p</span><span class="op" id="6243219">.</span><span class="ident" id="6243220">pos</span><span class="op" id="6243223">,</span>&nbsp;<span class="ident" id="6243225">Text</span><span class="op" id="6243229">:</span>&nbsp;<span class="ident" id="6243231">p</span><span class="op" id="6243232">.</span><span class="ident" id="6243233">lit</span><span class="op" id="6243236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243239">p</span><span class="op" id="6243240">.</span><span class="ident" id="6243241">next0</span><span class="op" id="6243246">(</span><span class="op" id="6243247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243251">return</span><br>
<span class="lineno"></span><span class="op" id="6243258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6243261">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6243325">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="6243389">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="6243453">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="6243495">//</span><br>
<span class="lineno"></span><span class="keyword" id="6243498">func</span>&nbsp;<span class="op" id="6243503">(</span><span class="ident" id="6243504">p</span>&nbsp;<span class="op" id="6243506">*</span><span class="ident" id="6243507">parser</span><span class="op" id="6243513">)</span>&nbsp;<span class="ident" id="6243515">consumeCommentGroup</span><span class="op" id="6243534">(</span><span class="ident" id="6243535">n</span>&nbsp;<span class="builtintype" id="6243537">int</span><span class="op" id="6243540">)</span>&nbsp;<span class="op" id="6243542">(</span><span class="ident" id="6243543">comments</span>&nbsp;<span class="op" id="6243552">*</span><span class="ident" id="6243553">ast</span><span class="op" id="6243556">.</span><span class="ident" id="6243557">CommentGroup</span><span class="op" id="6243569">,</span>&nbsp;<span class="ident" id="6243571">endline</span>&nbsp;<span class="builtintype" id="6243579">int</span><span class="op" id="6243582">)</span>&nbsp;<span class="op" id="6243584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243587">var</span>&nbsp;<span class="ident" id="6243591">list</span>&nbsp;<span class="op" id="6243596">[</span><span class="op" id="6243597">]</span><span class="op" id="6243598">*</span><span class="ident" id="6243599">ast</span><span class="op" id="6243602">.</span><span class="ident" id="6243603">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243612">endline</span>&nbsp;<span class="op" id="6243620">=</span>&nbsp;<span class="ident" id="6243622">p</span><span class="op" id="6243623">.</span><span class="ident" id="6243624">file</span><span class="op" id="6243628">.</span><span class="ident" id="6243629">Line</span><span class="op" id="6243633">(</span><span class="ident" id="6243634">p</span><span class="op" id="6243635">.</span><span class="ident" id="6243636">pos</span><span class="op" id="6243639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243642">for</span>&nbsp;<span class="ident" id="6243646">p</span><span class="op" id="6243647">.</span><span class="ident" id="6243648">tok</span>&nbsp;<span class="op" id="6243652">==</span>&nbsp;<span class="ident" id="6243655">token</span><span class="op" id="6243660">.</span><span class="ident" id="6243661">COMMENT</span>&nbsp;<span class="op" id="6243669">&amp;&amp;</span>&nbsp;<span class="ident" id="6243672">p</span><span class="op" id="6243673">.</span><span class="ident" id="6243674">file</span><span class="op" id="6243678">.</span><span class="ident" id="6243679">Line</span><span class="op" id="6243683">(</span><span class="ident" id="6243684">p</span><span class="op" id="6243685">.</span><span class="ident" id="6243686">pos</span><span class="op" id="6243689">)</span>&nbsp;<span class="op" id="6243691">&lt;=</span>&nbsp;<span class="ident" id="6243694">endline</span><span class="op" id="6243701">+</span><span class="ident" id="6243702">n</span>&nbsp;<span class="op" id="6243704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243708">var</span>&nbsp;<span class="ident" id="6243712">comment</span>&nbsp;<span class="op" id="6243720">*</span><span class="ident" id="6243721">ast</span><span class="op" id="6243724">.</span><span class="ident" id="6243725">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243735">comment</span><span class="op" id="6243742">,</span>&nbsp;<span class="ident" id="6243744">endline</span>&nbsp;<span class="op" id="6243752">=</span>&nbsp;<span class="ident" id="6243754">p</span><span class="op" id="6243755">.</span><span class="ident" id="6243756">consumeComment</span><span class="op" id="6243770">(</span><span class="op" id="6243771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243775">list</span>&nbsp;<span class="op" id="6243780">=</span>&nbsp;<span class="builtinfunc" id="6243782">append</span><span class="op" id="6243788">(</span><span class="ident" id="6243789">list</span><span class="op" id="6243793">,</span>&nbsp;<span class="ident" id="6243795">comment</span><span class="op" id="6243802">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6243809">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243852">comments</span>&nbsp;<span class="op" id="6243861">=</span>&nbsp;<span class="op" id="6243863">&amp;</span><span class="ident" id="6243864">ast</span><span class="op" id="6243867">.</span><span class="ident" id="6243868">CommentGroup</span><span class="op" id="6243880">{</span><span class="ident" id="6243881">List</span><span class="op" id="6243885">:</span>&nbsp;<span class="ident" id="6243887">list</span><span class="op" id="6243891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243894">p</span><span class="op" id="6243895">.</span><span class="ident" id="6243896">comments</span>&nbsp;<span class="op" id="6243905">=</span>&nbsp;<span class="builtinfunc" id="6243907">append</span><span class="op" id="6243913">(</span><span class="ident" id="6243914">p</span><span class="op" id="6243915">.</span><span class="ident" id="6243916">comments</span><span class="op" id="6243924">,</span>&nbsp;<span class="ident" id="6243926">comments</span><span class="op" id="6243934">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243938">return</span><br>
<span class="lineno"></span><span class="op" id="6243945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6243948">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="6244014">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6244080">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6244102">//</span><br>
<span class="lineno"></span><span class="comment" id="6244105">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6244168">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="6244239">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="6244297">//</span><br>
<span class="lineno"></span><span class="comment" id="6244300">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="6244364">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="6244435">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="6244453">//</span><br>
<span class="lineno"></span><span class="comment" id="6244456">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6244522">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="6244544">//</span><br>
<span class="lineno"></span><span class="keyword" id="6244547">func</span>&nbsp;<span class="op" id="6244552">(</span><span class="ident" id="6244553">p</span>&nbsp;<span class="op" id="6244555">*</span><span class="ident" id="6244556">parser</span><span class="op" id="6244562">)</span>&nbsp;<span class="ident" id="6244564">next</span><span class="op" id="6244568">(</span><span class="op" id="6244569">)</span>&nbsp;<span class="op" id="6244571">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244574">p</span><span class="op" id="6244575">.</span><span class="ident" id="6244576">leadComment</span>&nbsp;<span class="op" id="6244588">=</span>&nbsp;<span class="ident" id="6244590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244595">p</span><span class="op" id="6244596">.</span><span class="ident" id="6244597">lineComment</span>&nbsp;<span class="op" id="6244609">=</span>&nbsp;<span class="ident" id="6244611">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244616">prev</span>&nbsp;<span class="op" id="6244621">:=</span>&nbsp;<span class="ident" id="6244624">p</span><span class="op" id="6244625">.</span><span class="ident" id="6244626">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244631">p</span><span class="op" id="6244632">.</span><span class="ident" id="6244633">next0</span><span class="op" id="6244638">(</span><span class="op" id="6244639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244643">if</span>&nbsp;<span class="ident" id="6244646">p</span><span class="op" id="6244647">.</span><span class="ident" id="6244648">tok</span>&nbsp;<span class="op" id="6244652">==</span>&nbsp;<span class="ident" id="6244655">token</span><span class="op" id="6244660">.</span><span class="ident" id="6244661">COMMENT</span>&nbsp;<span class="op" id="6244669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244673">var</span>&nbsp;<span class="ident" id="6244677">comment</span>&nbsp;<span class="op" id="6244685">*</span><span class="ident" id="6244686">ast</span><span class="op" id="6244689">.</span><span class="ident" id="6244690">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244705">var</span>&nbsp;<span class="ident" id="6244709">endline</span>&nbsp;<span class="builtintype" id="6244717">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244724">if</span>&nbsp;<span class="ident" id="6244727">p</span><span class="op" id="6244728">.</span><span class="ident" id="6244729">file</span><span class="op" id="6244733">.</span><span class="ident" id="6244734">Line</span><span class="op" id="6244738">(</span><span class="ident" id="6244739">p</span><span class="op" id="6244740">.</span><span class="ident" id="6244741">pos</span><span class="op" id="6244744">)</span>&nbsp;<span class="op" id="6244746">==</span>&nbsp;<span class="ident" id="6244749">p</span><span class="op" id="6244750">.</span><span class="ident" id="6244751">file</span><span class="op" id="6244755">.</span><span class="ident" id="6244756">Line</span><span class="op" id="6244760">(</span><span class="ident" id="6244761">prev</span><span class="op" id="6244765">)</span>&nbsp;<span class="op" id="6244767">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244772">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244832">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244890">comment</span><span class="op" id="6244897">,</span>&nbsp;<span class="ident" id="6244899">endline</span>&nbsp;<span class="op" id="6244907">=</span>&nbsp;<span class="ident" id="6244909">p</span><span class="op" id="6244910">.</span><span class="ident" id="6244911">consumeCommentGroup</span><span class="op" id="6244930">(</span><span class="num" id="6244931">0</span><span class="op" id="6244932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244937">if</span>&nbsp;<span class="ident" id="6244940">p</span><span class="op" id="6244941">.</span><span class="ident" id="6244942">file</span><span class="op" id="6244946">.</span><span class="ident" id="6244947">Line</span><span class="op" id="6244951">(</span><span class="ident" id="6244952">p</span><span class="op" id="6244953">.</span><span class="ident" id="6244954">pos</span><span class="op" id="6244957">)</span>&nbsp;<span class="op" id="6244959">!=</span>&nbsp;<span class="ident" id="6244962">endline</span>&nbsp;<span class="op" id="6244970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244976">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245027">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245076">p</span><span class="op" id="6245077">.</span><span class="ident" id="6245078">lineComment</span>&nbsp;<span class="op" id="6245090">=</span>&nbsp;<span class="ident" id="6245092">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245112">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245152">endline</span>&nbsp;<span class="op" id="6245160">=</span>&nbsp;<span class="op" id="6245162">-</span><span class="num" id="6245163">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245167">for</span>&nbsp;<span class="ident" id="6245171">p</span><span class="op" id="6245172">.</span><span class="ident" id="6245173">tok</span>&nbsp;<span class="op" id="6245177">==</span>&nbsp;<span class="ident" id="6245180">token</span><span class="op" id="6245185">.</span><span class="ident" id="6245186">COMMENT</span>&nbsp;<span class="op" id="6245194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245199">comment</span><span class="op" id="6245206">,</span>&nbsp;<span class="ident" id="6245208">endline</span>&nbsp;<span class="op" id="6245216">=</span>&nbsp;<span class="ident" id="6245218">p</span><span class="op" id="6245219">.</span><span class="ident" id="6245220">consumeCommentGroup</span><span class="op" id="6245239">(</span><span class="num" id="6245240">1</span><span class="op" id="6245241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245245">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245250">if</span>&nbsp;<span class="ident" id="6245253">endline</span><span class="op" id="6245260">+</span><span class="num" id="6245261">1</span>&nbsp;<span class="op" id="6245263">==</span>&nbsp;<span class="ident" id="6245266">p</span><span class="op" id="6245267">.</span><span class="ident" id="6245268">file</span><span class="op" id="6245272">.</span><span class="ident" id="6245273">Line</span><span class="op" id="6245277">(</span><span class="ident" id="6245278">p</span><span class="op" id="6245279">.</span><span class="ident" id="6245280">pos</span><span class="op" id="6245283">)</span>&nbsp;<span class="op" id="6245285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245290">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245358">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245426">p</span><span class="op" id="6245427">.</span><span class="ident" id="6245428">leadComment</span>&nbsp;<span class="op" id="6245440">=</span>&nbsp;<span class="ident" id="6245442">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245455">}</span><br>
<span class="lineno"></span><span class="op" id="6245457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6245460">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="6245520">type</span>&nbsp;<span class="ident" id="6245525">bailout</span>&nbsp;<span class="keyword" id="6245533">struct</span><span class="op" id="6245539">{</span><span class="op" id="6245540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6245543">func</span>&nbsp;<span class="op" id="6245548">(</span><span class="ident" id="6245549">p</span>&nbsp;<span class="op" id="6245551">*</span><span class="ident" id="6245552">parser</span><span class="op" id="6245558">)</span>&nbsp;<span class="builtintype" id="6245560">error</span><span class="op" id="6245565">(</span><span class="ident" id="6245566">pos</span>&nbsp;<span class="ident" id="6245570">token</span><span class="op" id="6245575">.</span><span class="ident" id="6245576">Pos</span><span class="op" id="6245579">,</span>&nbsp;<span class="ident" id="6245581">msg</span>&nbsp;<span class="builtintype" id="6245585">string</span><span class="op" id="6245591">)</span>&nbsp;<span class="op" id="6245593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245596">epos</span>&nbsp;<span class="op" id="6245601">:=</span>&nbsp;<span class="ident" id="6245604">p</span><span class="op" id="6245605">.</span><span class="ident" id="6245606">file</span><span class="op" id="6245610">.</span><span class="ident" id="6245611">Position</span><span class="op" id="6245619">(</span><span class="ident" id="6245620">pos</span><span class="op" id="6245623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245627">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245697">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245768">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245783">if</span>&nbsp;<span class="ident" id="6245786">p</span><span class="op" id="6245787">.</span><span class="ident" id="6245788">mode</span><span class="op" id="6245792">&amp;</span><span class="ident" id="6245793">AllErrors</span>&nbsp;<span class="op" id="6245803">==</span>&nbsp;<span class="num" id="6245806">0</span>&nbsp;<span class="op" id="6245808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245812">n</span>&nbsp;<span class="op" id="6245814">:=</span>&nbsp;<span class="builtinfunc" id="6245817">len</span><span class="op" id="6245820">(</span><span class="ident" id="6245821">p</span><span class="op" id="6245822">.</span><span class="ident" id="6245823">errors</span><span class="op" id="6245829">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245833">if</span>&nbsp;<span class="ident" id="6245836">n</span>&nbsp;<span class="op" id="6245838">&gt;</span>&nbsp;<span class="num" id="6245840">0</span>&nbsp;<span class="op" id="6245842">&amp;&amp;</span>&nbsp;<span class="ident" id="6245845">p</span><span class="op" id="6245846">.</span><span class="ident" id="6245847">errors</span><span class="op" id="6245853">[</span><span class="ident" id="6245854">n</span><span class="op" id="6245855">-</span><span class="num" id="6245856">1</span><span class="op" id="6245857">]</span><span class="op" id="6245858">.</span><span class="ident" id="6245859">Pos</span><span class="op" id="6245862">.</span><span class="ident" id="6245863">Line</span>&nbsp;<span class="op" id="6245868">==</span>&nbsp;<span class="ident" id="6245871">epos</span><span class="op" id="6245875">.</span><span class="ident" id="6245876">Line</span>&nbsp;<span class="op" id="6245881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245886">return</span>&nbsp;<span class="comment" id="6245893">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245936">if</span>&nbsp;<span class="ident" id="6245939">n</span>&nbsp;<span class="op" id="6245941">&gt;</span>&nbsp;<span class="num" id="6245943">10</span>&nbsp;<span class="op" id="6245946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6245951">panic</span><span class="op" id="6245956">(</span><span class="ident" id="6245957">bailout</span><span class="op" id="6245964">{</span><span class="op" id="6245965">}</span><span class="op" id="6245966">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245977">p</span><span class="op" id="6245978">.</span><span class="ident" id="6245979">errors</span><span class="op" id="6245985">.</span><span class="ident" id="6245986">Add</span><span class="op" id="6245989">(</span><span class="ident" id="6245990">epos</span><span class="op" id="6245994">,</span>&nbsp;<span class="ident" id="6245996">msg</span><span class="op" id="6245999">)</span><br>
<span class="lineno"></span><span class="op" id="6246001">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6246004">func</span>&nbsp;<span class="op" id="6246009">(</span><span class="ident" id="6246010">p</span>&nbsp;<span class="op" id="6246012">*</span><span class="ident" id="6246013">parser</span><span class="op" id="6246019">)</span>&nbsp;<span class="ident" id="6246021">errorExpected</span><span class="op" id="6246034">(</span><span class="ident" id="6246035">pos</span>&nbsp;<span class="ident" id="6246039">token</span><span class="op" id="6246044">.</span><span class="ident" id="6246045">Pos</span><span class="op" id="6246048">,</span>&nbsp;<span class="ident" id="6246050">msg</span>&nbsp;<span class="builtintype" id="6246054">string</span><span class="op" id="6246060">)</span>&nbsp;<span class="op" id="6246062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246065">msg</span>&nbsp;<span class="op" id="6246069">=</span>&nbsp;<span class="string" id="6246071">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="6246083">+</span>&nbsp;<span class="ident" id="6246085">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246090">if</span>&nbsp;<span class="ident" id="6246093">pos</span>&nbsp;<span class="op" id="6246097">==</span>&nbsp;<span class="ident" id="6246100">p</span><span class="op" id="6246101">.</span><span class="ident" id="6246102">pos</span>&nbsp;<span class="op" id="6246106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246110">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246159">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246201">if</span>&nbsp;<span class="ident" id="6246204">p</span><span class="op" id="6246205">.</span><span class="ident" id="6246206">tok</span>&nbsp;<span class="op" id="6246210">==</span>&nbsp;<span class="ident" id="6246213">token</span><span class="op" id="6246218">.</span><span class="ident" id="6246219">SEMICOLON</span>&nbsp;<span class="op" id="6246229">&amp;&amp;</span>&nbsp;<span class="ident" id="6246232">p</span><span class="op" id="6246233">.</span><span class="ident" id="6246234">lit</span>&nbsp;<span class="op" id="6246238">==</span>&nbsp;<span class="string" id="6246241">&#34;\n&#34;</span>&nbsp;<span class="op" id="6246246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246251">msg</span>&nbsp;<span class="op" id="6246255">+=</span>&nbsp;<span class="string" id="6246258">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246278">}</span>&nbsp;<span class="keyword" id="6246280">else</span>&nbsp;<span class="op" id="6246285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246290">msg</span>&nbsp;<span class="op" id="6246294">+=</span>&nbsp;<span class="string" id="6246297">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="6246309">+</span>&nbsp;<span class="ident" id="6246311">p</span><span class="op" id="6246312">.</span><span class="ident" id="6246313">tok</span><span class="op" id="6246316">.</span><span class="ident" id="6246317">String</span><span class="op" id="6246323">(</span><span class="op" id="6246324">)</span>&nbsp;<span class="op" id="6246326">+</span>&nbsp;<span class="string" id="6246328">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246335">if</span>&nbsp;<span class="ident" id="6246338">p</span><span class="op" id="6246339">.</span><span class="ident" id="6246340">tok</span><span class="op" id="6246343">.</span><span class="ident" id="6246344">IsLiteral</span><span class="op" id="6246353">(</span><span class="op" id="6246354">)</span>&nbsp;<span class="op" id="6246356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246362">msg</span>&nbsp;<span class="op" id="6246366">+=</span>&nbsp;<span class="string" id="6246369">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="6246373">+</span>&nbsp;<span class="ident" id="6246375">p</span><span class="op" id="6246376">.</span><span class="ident" id="6246377">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246391">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246394">p</span><span class="op" id="6246395">.</span><span class="builtintype" id="6246396">error</span><span class="op" id="6246401">(</span><span class="ident" id="6246402">pos</span><span class="op" id="6246405">,</span>&nbsp;<span class="ident" id="6246407">msg</span><span class="op" id="6246410">)</span><br>
<span class="lineno"></span><span class="op" id="6246412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6246415">func</span>&nbsp;<span class="op" id="6246420">(</span><span class="ident" id="6246421">p</span>&nbsp;<span class="op" id="6246423">*</span><span class="ident" id="6246424">parser</span><span class="op" id="6246430">)</span>&nbsp;<span class="ident" id="6246432">expect</span><span class="op" id="6246438">(</span><span class="ident" id="6246439">tok</span>&nbsp;<span class="ident" id="6246443">token</span><span class="op" id="6246448">.</span><span class="ident" id="6246449">Token</span><span class="op" id="6246454">)</span>&nbsp;<span class="ident" id="6246456">token</span><span class="op" id="6246461">.</span><span class="ident" id="6246462">Pos</span>&nbsp;<span class="op" id="6246466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246469">pos</span>&nbsp;<span class="op" id="6246473">:=</span>&nbsp;<span class="ident" id="6246476">p</span><span class="op" id="6246477">.</span><span class="ident" id="6246478">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246483">if</span>&nbsp;<span class="ident" id="6246486">p</span><span class="op" id="6246487">.</span><span class="ident" id="6246488">tok</span>&nbsp;<span class="op" id="6246492">!=</span>&nbsp;<span class="ident" id="6246495">tok</span>&nbsp;<span class="op" id="6246499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246503">p</span><span class="op" id="6246504">.</span><span class="ident" id="6246505">errorExpected</span><span class="op" id="6246518">(</span><span class="ident" id="6246519">pos</span><span class="op" id="6246522">,</span>&nbsp;<span class="string" id="6246524">&#34;&#39;&#34;</span><span class="op" id="6246527">+</span><span class="ident" id="6246528">tok</span><span class="op" id="6246531">.</span><span class="ident" id="6246532">String</span><span class="op" id="6246538">(</span><span class="op" id="6246539">)</span><span class="op" id="6246540">+</span><span class="string" id="6246541">&#34;&#39;&#34;</span><span class="op" id="6246544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246550">p</span><span class="op" id="6246551">.</span><span class="ident" id="6246552">next</span><span class="op" id="6246556">(</span><span class="op" id="6246557">)</span>&nbsp;<span class="comment" id="6246559">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246577">return</span>&nbsp;<span class="ident" id="6246584">pos</span><br>
<span class="lineno">390</span><span class="op" id="6246588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6246591">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="6246659">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="6246719">//</span><br>
<span class="lineno">395</span><span class="keyword" id="6246722">func</span>&nbsp;<span class="op" id="6246727">(</span><span class="ident" id="6246728">p</span>&nbsp;<span class="op" id="6246730">*</span><span class="ident" id="6246731">parser</span><span class="op" id="6246737">)</span>&nbsp;<span class="ident" id="6246739">expectClosing</span><span class="op" id="6246752">(</span><span class="ident" id="6246753">tok</span>&nbsp;<span class="ident" id="6246757">token</span><span class="op" id="6246762">.</span><span class="ident" id="6246763">Token</span><span class="op" id="6246768">,</span>&nbsp;<span class="ident" id="6246770">context</span>&nbsp;<span class="builtintype" id="6246778">string</span><span class="op" id="6246784">)</span>&nbsp;<span class="ident" id="6246786">token</span><span class="op" id="6246791">.</span><span class="ident" id="6246792">Pos</span>&nbsp;<span class="op" id="6246796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246799">if</span>&nbsp;<span class="ident" id="6246802">p</span><span class="op" id="6246803">.</span><span class="ident" id="6246804">tok</span>&nbsp;<span class="op" id="6246808">!=</span>&nbsp;<span class="ident" id="6246811">tok</span>&nbsp;<span class="op" id="6246815">&amp;&amp;</span>&nbsp;<span class="ident" id="6246818">p</span><span class="op" id="6246819">.</span><span class="ident" id="6246820">tok</span>&nbsp;<span class="op" id="6246824">==</span>&nbsp;<span class="ident" id="6246827">token</span><span class="op" id="6246832">.</span><span class="ident" id="6246833">SEMICOLON</span>&nbsp;<span class="op" id="6246843">&amp;&amp;</span>&nbsp;<span class="ident" id="6246846">p</span><span class="op" id="6246847">.</span><span class="ident" id="6246848">lit</span>&nbsp;<span class="op" id="6246852">==</span>&nbsp;<span class="string" id="6246855">&#34;\n&#34;</span>&nbsp;<span class="op" id="6246860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246864">p</span><span class="op" id="6246865">.</span><span class="builtintype" id="6246866">error</span><span class="op" id="6246871">(</span><span class="ident" id="6246872">p</span><span class="op" id="6246873">.</span><span class="ident" id="6246874">pos</span><span class="op" id="6246877">,</span>&nbsp;<span class="string" id="6246879">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="6246911">+</span><span class="ident" id="6246912">context</span><span class="op" id="6246919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246923">p</span><span class="op" id="6246924">.</span><span class="ident" id="6246925">next</span><span class="op" id="6246929">(</span><span class="op" id="6246930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246933">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246936">return</span>&nbsp;<span class="ident" id="6246943">p</span><span class="op" id="6246944">.</span><span class="ident" id="6246945">expect</span><span class="op" id="6246951">(</span><span class="ident" id="6246952">tok</span><span class="op" id="6246955">)</span><br>
<span class="lineno"></span><span class="op" id="6246957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6246960">func</span>&nbsp;<span class="op" id="6246965">(</span><span class="ident" id="6246966">p</span>&nbsp;<span class="op" id="6246968">*</span><span class="ident" id="6246969">parser</span><span class="op" id="6246975">)</span>&nbsp;<span class="ident" id="6246977">expectSemi</span><span class="op" id="6246987">(</span><span class="op" id="6246988">)</span>&nbsp;<span class="op" id="6246990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246993">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247047">if</span>&nbsp;<span class="ident" id="6247050">p</span><span class="op" id="6247051">.</span><span class="ident" id="6247052">tok</span>&nbsp;<span class="op" id="6247056">!=</span>&nbsp;<span class="ident" id="6247059">token</span><span class="op" id="6247064">.</span><span class="ident" id="6247065">RPAREN</span>&nbsp;<span class="op" id="6247072">&amp;&amp;</span>&nbsp;<span class="ident" id="6247075">p</span><span class="op" id="6247076">.</span><span class="ident" id="6247077">tok</span>&nbsp;<span class="op" id="6247081">!=</span>&nbsp;<span class="ident" id="6247084">token</span><span class="op" id="6247089">.</span><span class="ident" id="6247090">RBRACE</span>&nbsp;<span class="op" id="6247097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247101">if</span>&nbsp;<span class="ident" id="6247104">p</span><span class="op" id="6247105">.</span><span class="ident" id="6247106">tok</span>&nbsp;<span class="op" id="6247110">==</span>&nbsp;<span class="ident" id="6247113">token</span><span class="op" id="6247118">.</span><span class="ident" id="6247119">SEMICOLON</span>&nbsp;<span class="op" id="6247129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247134">p</span><span class="op" id="6247135">.</span><span class="ident" id="6247136">next</span><span class="op" id="6247140">(</span><span class="op" id="6247141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247145">}</span>&nbsp;<span class="keyword" id="6247147">else</span>&nbsp;<span class="op" id="6247152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247157">p</span><span class="op" id="6247158">.</span><span class="ident" id="6247159">errorExpected</span><span class="op" id="6247172">(</span><span class="ident" id="6247173">p</span><span class="op" id="6247174">.</span><span class="ident" id="6247175">pos</span><span class="op" id="6247178">,</span>&nbsp;<span class="string" id="6247180">&#34;&#39;;&#39;&#34;</span><span class="op" id="6247185">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247190">syncStmt</span><span class="op" id="6247198">(</span><span class="ident" id="6247199">p</span><span class="op" id="6247200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247207">}</span><br>
<span class="lineno"></span><span class="op" id="6247209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6247212">func</span>&nbsp;<span class="op" id="6247217">(</span><span class="ident" id="6247218">p</span>&nbsp;<span class="op" id="6247220">*</span><span class="ident" id="6247221">parser</span><span class="op" id="6247227">)</span>&nbsp;<span class="ident" id="6247229">atComma</span><span class="op" id="6247236">(</span><span class="ident" id="6247237">context</span>&nbsp;<span class="builtintype" id="6247245">string</span><span class="op" id="6247251">)</span>&nbsp;<span class="builtintype" id="6247253">bool</span>&nbsp;<span class="op" id="6247258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247261">if</span>&nbsp;<span class="ident" id="6247264">p</span><span class="op" id="6247265">.</span><span class="ident" id="6247266">tok</span>&nbsp;<span class="op" id="6247270">==</span>&nbsp;<span class="ident" id="6247273">token</span><span class="op" id="6247278">.</span><span class="ident" id="6247279">COMMA</span>&nbsp;<span class="op" id="6247285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247289">return</span>&nbsp;<span class="builtintype" id="6247296">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247305">if</span>&nbsp;<span class="ident" id="6247308">p</span><span class="op" id="6247309">.</span><span class="ident" id="6247310">tok</span>&nbsp;<span class="op" id="6247314">==</span>&nbsp;<span class="ident" id="6247317">token</span><span class="op" id="6247322">.</span><span class="ident" id="6247323">SEMICOLON</span>&nbsp;<span class="op" id="6247333">&amp;&amp;</span>&nbsp;<span class="ident" id="6247336">p</span><span class="op" id="6247337">.</span><span class="ident" id="6247338">lit</span>&nbsp;<span class="op" id="6247342">==</span>&nbsp;<span class="string" id="6247345">&#34;\n&#34;</span>&nbsp;<span class="op" id="6247350">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247354">p</span><span class="op" id="6247355">.</span><span class="builtintype" id="6247356">error</span><span class="op" id="6247361">(</span><span class="ident" id="6247362">p</span><span class="op" id="6247363">.</span><span class="ident" id="6247364">pos</span><span class="op" id="6247367">,</span>&nbsp;<span class="string" id="6247369">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="6247401">+</span><span class="ident" id="6247402">context</span><span class="op" id="6247409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247413">return</span>&nbsp;<span class="builtintype" id="6247420">true</span>&nbsp;<span class="comment" id="6247425">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247465">return</span>&nbsp;<span class="builtintype" id="6247472">false</span><br>
<span class="lineno">425</span><span class="op" id="6247478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6247481">func</span>&nbsp;<span class="ident" id="6247486">assert</span><span class="op" id="6247492">(</span><span class="ident" id="6247493">cond</span>&nbsp;<span class="builtintype" id="6247498">bool</span><span class="op" id="6247502">,</span>&nbsp;<span class="ident" id="6247504">msg</span>&nbsp;<span class="builtintype" id="6247508">string</span><span class="op" id="6247514">)</span>&nbsp;<span class="op" id="6247516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247519">if</span>&nbsp;<span class="op" id="6247522">!</span><span class="ident" id="6247523">cond</span>&nbsp;<span class="op" id="6247528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6247532">panic</span><span class="op" id="6247537">(</span><span class="string" id="6247538">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="6247567">+</span>&nbsp;<span class="ident" id="6247569">msg</span><span class="op" id="6247572">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247575">}</span><br>
<span class="lineno"></span><span class="op" id="6247577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6247580">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="6247624">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="6247668">//</span><br>
<span class="lineno"></span><span class="keyword" id="6247671">func</span>&nbsp;<span class="ident" id="6247676">syncStmt</span><span class="op" id="6247684">(</span><span class="ident" id="6247685">p</span>&nbsp;<span class="op" id="6247687">*</span><span class="ident" id="6247688">parser</span><span class="op" id="6247694">)</span>&nbsp;<span class="op" id="6247696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247699">for</span>&nbsp;<span class="op" id="6247703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247707">switch</span>&nbsp;<span class="ident" id="6247714">p</span><span class="op" id="6247715">.</span><span class="ident" id="6247716">tok</span>&nbsp;<span class="op" id="6247720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247724">case</span>&nbsp;<span class="ident" id="6247729">token</span><span class="op" id="6247734">.</span><span class="ident" id="6247735">BREAK</span><span class="op" id="6247740">,</span>&nbsp;<span class="ident" id="6247742">token</span><span class="op" id="6247747">.</span><span class="ident" id="6247748">CONST</span><span class="op" id="6247753">,</span>&nbsp;<span class="ident" id="6247755">token</span><span class="op" id="6247760">.</span><span class="ident" id="6247761">CONTINUE</span><span class="op" id="6247769">,</span>&nbsp;<span class="ident" id="6247771">token</span><span class="op" id="6247776">.</span><span class="ident" id="6247777">DEFER</span><span class="op" id="6247782">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247787">token</span><span class="op" id="6247792">.</span><span class="ident" id="6247793">FALLTHROUGH</span><span class="op" id="6247804">,</span>&nbsp;<span class="ident" id="6247806">token</span><span class="op" id="6247811">.</span><span class="ident" id="6247812">FOR</span><span class="op" id="6247815">,</span>&nbsp;<span class="ident" id="6247817">token</span><span class="op" id="6247822">.</span><span class="ident" id="6247823">GO</span><span class="op" id="6247825">,</span>&nbsp;<span class="ident" id="6247827">token</span><span class="op" id="6247832">.</span><span class="ident" id="6247833">GOTO</span><span class="op" id="6247837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247842">token</span><span class="op" id="6247847">.</span><span class="ident" id="6247848">IF</span><span class="op" id="6247850">,</span>&nbsp;<span class="ident" id="6247852">token</span><span class="op" id="6247857">.</span><span class="ident" id="6247858">RETURN</span><span class="op" id="6247864">,</span>&nbsp;<span class="ident" id="6247866">token</span><span class="op" id="6247871">.</span><span class="ident" id="6247872">SELECT</span><span class="op" id="6247878">,</span>&nbsp;<span class="ident" id="6247880">token</span><span class="op" id="6247885">.</span><span class="ident" id="6247886">SWITCH</span><span class="op" id="6247892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247897">token</span><span class="op" id="6247902">.</span><span class="ident" id="6247903">TYPE</span><span class="op" id="6247907">,</span>&nbsp;<span class="ident" id="6247909">token</span><span class="op" id="6247914">.</span><span class="ident" id="6247915">VAR</span><span class="op" id="6247918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247923">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247981">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248039">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248095">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248151">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248207">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248261">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248296">if</span>&nbsp;<span class="ident" id="6248299">p</span><span class="op" id="6248300">.</span><span class="ident" id="6248301">pos</span>&nbsp;<span class="op" id="6248305">==</span>&nbsp;<span class="ident" id="6248308">p</span><span class="op" id="6248309">.</span><span class="ident" id="6248310">syncPos</span>&nbsp;<span class="op" id="6248318">&amp;&amp;</span>&nbsp;<span class="ident" id="6248321">p</span><span class="op" id="6248322">.</span><span class="ident" id="6248323">syncCnt</span>&nbsp;<span class="op" id="6248331">&lt;</span>&nbsp;<span class="num" id="6248333">10</span>&nbsp;<span class="op" id="6248336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248342">p</span><span class="op" id="6248343">.</span><span class="ident" id="6248344">syncCnt</span><span class="op" id="6248351">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248358">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248373">if</span>&nbsp;<span class="ident" id="6248376">p</span><span class="op" id="6248377">.</span><span class="ident" id="6248378">pos</span>&nbsp;<span class="op" id="6248382">&gt;</span>&nbsp;<span class="ident" id="6248384">p</span><span class="op" id="6248385">.</span><span class="ident" id="6248386">syncPos</span>&nbsp;<span class="op" id="6248394">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248400">p</span><span class="op" id="6248401">.</span><span class="ident" id="6248402">syncPos</span>&nbsp;<span class="op" id="6248410">=</span>&nbsp;<span class="ident" id="6248412">p</span><span class="op" id="6248413">.</span><span class="ident" id="6248414">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248422">p</span><span class="op" id="6248423">.</span><span class="ident" id="6248424">syncCnt</span>&nbsp;<span class="op" id="6248432">=</span>&nbsp;<span class="num" id="6248434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248440">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248455">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248509">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248566">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248620">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248675">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248710">case</span>&nbsp;<span class="ident" id="6248715">token</span><span class="op" id="6248720">.</span><span class="ident" id="6248721">EOF</span><span class="op" id="6248724">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248742">p</span><span class="op" id="6248743">.</span><span class="ident" id="6248744">next</span><span class="op" id="6248748">(</span><span class="op" id="6248749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248752">}</span><br>
<span class="lineno"></span><span class="op" id="6248754">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="6248757">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="6248803">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="6248847">//</span><br>
<span class="lineno"></span><span class="keyword" id="6248850">func</span>&nbsp;<span class="ident" id="6248855">syncDecl</span><span class="op" id="6248863">(</span><span class="ident" id="6248864">p</span>&nbsp;<span class="op" id="6248866">*</span><span class="ident" id="6248867">parser</span><span class="op" id="6248873">)</span>&nbsp;<span class="op" id="6248875">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248878">for</span>&nbsp;<span class="op" id="6248882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248886">switch</span>&nbsp;<span class="ident" id="6248893">p</span><span class="op" id="6248894">.</span><span class="ident" id="6248895">tok</span>&nbsp;<span class="op" id="6248899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248903">case</span>&nbsp;<span class="ident" id="6248908">token</span><span class="op" id="6248913">.</span><span class="ident" id="6248914">CONST</span><span class="op" id="6248919">,</span>&nbsp;<span class="ident" id="6248921">token</span><span class="op" id="6248926">.</span><span class="ident" id="6248927">TYPE</span><span class="op" id="6248931">,</span>&nbsp;<span class="ident" id="6248933">token</span><span class="op" id="6248938">.</span><span class="ident" id="6248939">VAR</span><span class="op" id="6248942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248947">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248978">if</span>&nbsp;<span class="ident" id="6248981">p</span><span class="op" id="6248982">.</span><span class="ident" id="6248983">pos</span>&nbsp;<span class="op" id="6248987">==</span>&nbsp;<span class="ident" id="6248990">p</span><span class="op" id="6248991">.</span><span class="ident" id="6248992">syncPos</span>&nbsp;<span class="op" id="6249000">&amp;&amp;</span>&nbsp;<span class="ident" id="6249003">p</span><span class="op" id="6249004">.</span><span class="ident" id="6249005">syncCnt</span>&nbsp;<span class="op" id="6249013">&lt;</span>&nbsp;<span class="num" id="6249015">10</span>&nbsp;<span class="op" id="6249018">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249024">p</span><span class="op" id="6249025">.</span><span class="ident" id="6249026">syncCnt</span><span class="op" id="6249033">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249040">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249055">if</span>&nbsp;<span class="ident" id="6249058">p</span><span class="op" id="6249059">.</span><span class="ident" id="6249060">pos</span>&nbsp;<span class="op" id="6249064">&gt;</span>&nbsp;<span class="ident" id="6249066">p</span><span class="op" id="6249067">.</span><span class="ident" id="6249068">syncPos</span>&nbsp;<span class="op" id="6249076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249082">p</span><span class="op" id="6249083">.</span><span class="ident" id="6249084">syncPos</span>&nbsp;<span class="op" id="6249092">=</span>&nbsp;<span class="ident" id="6249094">p</span><span class="op" id="6249095">.</span><span class="ident" id="6249096">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249104">p</span><span class="op" id="6249105">.</span><span class="ident" id="6249106">syncCnt</span>&nbsp;<span class="op" id="6249114">=</span>&nbsp;<span class="num" id="6249116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249136">case</span>&nbsp;<span class="ident" id="6249141">token</span><span class="op" id="6249146">.</span><span class="ident" id="6249147">EOF</span><span class="op" id="6249150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249155">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249168">p</span><span class="op" id="6249169">.</span><span class="ident" id="6249170">next</span><span class="op" id="6249174">(</span><span class="op" id="6249175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249178">}</span><br>
<span class="lineno"></span><span class="op" id="6249180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="6249183">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="6249253">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="6249325">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6249362">//</span><br>
<span class="lineno"></span><span class="comment" id="6249365">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="6249440">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6249514">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="6249593">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="6249668">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="6249681">//</span><br>
<span class="lineno">505</span><span class="keyword" id="6249684">func</span>&nbsp;<span class="op" id="6249689">(</span><span class="ident" id="6249690">p</span>&nbsp;<span class="op" id="6249692">*</span><span class="ident" id="6249693">parser</span><span class="op" id="6249699">)</span>&nbsp;<span class="ident" id="6249701">safePos</span><span class="op" id="6249708">(</span><span class="ident" id="6249709">pos</span>&nbsp;<span class="ident" id="6249713">token</span><span class="op" id="6249718">.</span><span class="ident" id="6249719">Pos</span><span class="op" id="6249722">)</span>&nbsp;<span class="op" id="6249724">(</span><span class="ident" id="6249725">res</span>&nbsp;<span class="ident" id="6249729">token</span><span class="op" id="6249734">.</span><span class="ident" id="6249735">Pos</span><span class="op" id="6249738">)</span>&nbsp;<span class="op" id="6249740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249743">defer</span>&nbsp;<span class="keyword" id="6249749">func</span><span class="op" id="6249753">(</span><span class="op" id="6249754">)</span>&nbsp;<span class="op" id="6249756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249760">if</span>&nbsp;<span class="builtinfunc" id="6249763">recover</span><span class="op" id="6249770">(</span><span class="op" id="6249771">)</span>&nbsp;<span class="op" id="6249773">!=</span>&nbsp;<span class="ident" id="6249776">nil</span>&nbsp;<span class="op" id="6249780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249785">res</span>&nbsp;<span class="op" id="6249789">=</span>&nbsp;<span class="ident" id="6249791">token</span><span class="op" id="6249796">.</span><span class="ident" id="6249797">Pos</span><span class="op" id="6249800">(</span><span class="ident" id="6249801">p</span><span class="op" id="6249802">.</span><span class="ident" id="6249803">file</span><span class="op" id="6249807">.</span><span class="ident" id="6249808">Base</span><span class="op" id="6249812">(</span><span class="op" id="6249813">)</span>&nbsp;<span class="op" id="6249815">+</span>&nbsp;<span class="ident" id="6249817">p</span><span class="op" id="6249818">.</span><span class="ident" id="6249819">file</span><span class="op" id="6249823">.</span><span class="ident" id="6249824">Size</span><span class="op" id="6249828">(</span><span class="op" id="6249829">)</span><span class="op" id="6249830">)</span>&nbsp;<span class="comment" id="6249832">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249850">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249853">}</span><span class="op" id="6249854">(</span><span class="op" id="6249855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249858">_</span>&nbsp;<span class="op" id="6249860">=</span>&nbsp;<span class="ident" id="6249862">p</span><span class="op" id="6249863">.</span><span class="ident" id="6249864">file</span><span class="op" id="6249868">.</span><span class="ident" id="6249869">Offset</span><span class="op" id="6249875">(</span><span class="ident" id="6249876">pos</span><span class="op" id="6249879">)</span>&nbsp;<span class="comment" id="6249881">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249929">return</span>&nbsp;<span class="ident" id="6249936">pos</span><br>
<span class="lineno"></span><span class="op" id="6249940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="6249943">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6250023">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6250039">func</span>&nbsp;<span class="op" id="6250044">(</span><span class="ident" id="6250045">p</span>&nbsp;<span class="op" id="6250047">*</span><span class="ident" id="6250048">parser</span><span class="op" id="6250054">)</span>&nbsp;<span class="ident" id="6250056">parseIdent</span><span class="op" id="6250066">(</span><span class="op" id="6250067">)</span>&nbsp;<span class="op" id="6250069">*</span><span class="ident" id="6250070">ast</span><span class="op" id="6250073">.</span><span class="ident" id="6250074">Ident</span>&nbsp;<span class="op" id="6250080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250083">pos</span>&nbsp;<span class="op" id="6250087">:=</span>&nbsp;<span class="ident" id="6250090">p</span><span class="op" id="6250091">.</span><span class="ident" id="6250092">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250097">name</span>&nbsp;<span class="op" id="6250102">:=</span>&nbsp;<span class="string" id="6250105">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250110">if</span>&nbsp;<span class="ident" id="6250113">p</span><span class="op" id="6250114">.</span><span class="ident" id="6250115">tok</span>&nbsp;<span class="op" id="6250119">==</span>&nbsp;<span class="ident" id="6250122">token</span><span class="op" id="6250127">.</span><span class="ident" id="6250128">IDENT</span>&nbsp;<span class="op" id="6250134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250138">name</span>&nbsp;<span class="op" id="6250143">=</span>&nbsp;<span class="ident" id="6250145">p</span><span class="op" id="6250146">.</span><span class="ident" id="6250147">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250153">p</span><span class="op" id="6250154">.</span><span class="ident" id="6250155">next</span><span class="op" id="6250159">(</span><span class="op" id="6250160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250163">}</span>&nbsp;<span class="keyword" id="6250165">else</span>&nbsp;<span class="op" id="6250170">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250174">p</span><span class="op" id="6250175">.</span><span class="ident" id="6250176">expect</span><span class="op" id="6250182">(</span><span class="ident" id="6250183">token</span><span class="op" id="6250188">.</span><span class="ident" id="6250189">IDENT</span><span class="op" id="6250194">)</span>&nbsp;<span class="comment" id="6250196">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250231">return</span>&nbsp;<span class="op" id="6250238">&amp;</span><span class="ident" id="6250239">ast</span><span class="op" id="6250242">.</span><span class="ident" id="6250243">Ident</span><span class="op" id="6250248">{</span><span class="ident" id="6250249">NamePos</span><span class="op" id="6250256">:</span>&nbsp;<span class="ident" id="6250258">pos</span><span class="op" id="6250261">,</span>&nbsp;<span class="ident" id="6250263">Name</span><span class="op" id="6250267">:</span>&nbsp;<span class="ident" id="6250269">name</span><span class="op" id="6250273">}</span><br>
<span class="lineno"></span><span class="op" id="6250275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="6250278">func</span>&nbsp;<span class="op" id="6250283">(</span><span class="ident" id="6250284">p</span>&nbsp;<span class="op" id="6250286">*</span><span class="ident" id="6250287">parser</span><span class="op" id="6250293">)</span>&nbsp;<span class="ident" id="6250295">parseIdentList</span><span class="op" id="6250309">(</span><span class="op" id="6250310">)</span>&nbsp;<span class="op" id="6250312">(</span><span class="ident" id="6250313">list</span>&nbsp;<span class="op" id="6250318">[</span><span class="op" id="6250319">]</span><span class="op" id="6250320">*</span><span class="ident" id="6250321">ast</span><span class="op" id="6250324">.</span><span class="ident" id="6250325">Ident</span><span class="op" id="6250330">)</span>&nbsp;<span class="op" id="6250332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250335">if</span>&nbsp;<span class="ident" id="6250338">p</span><span class="op" id="6250339">.</span><span class="ident" id="6250340">trace</span>&nbsp;<span class="op" id="6250346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250350">defer</span>&nbsp;<span class="ident" id="6250356">un</span><span class="op" id="6250358">(</span><span class="ident" id="6250359">trace</span><span class="op" id="6250364">(</span><span class="ident" id="6250365">p</span><span class="op" id="6250366">,</span>&nbsp;<span class="string" id="6250368">&#34;IdentList&#34;</span><span class="op" id="6250379">)</span><span class="op" id="6250380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250387">list</span>&nbsp;<span class="op" id="6250392">=</span>&nbsp;<span class="builtinfunc" id="6250394">append</span><span class="op" id="6250400">(</span><span class="ident" id="6250401">list</span><span class="op" id="6250405">,</span>&nbsp;<span class="ident" id="6250407">p</span><span class="op" id="6250408">.</span><span class="ident" id="6250409">parseIdent</span><span class="op" id="6250419">(</span><span class="op" id="6250420">)</span><span class="op" id="6250421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250424">for</span>&nbsp;<span class="ident" id="6250428">p</span><span class="op" id="6250429">.</span><span class="ident" id="6250430">tok</span>&nbsp;<span class="op" id="6250434">==</span>&nbsp;<span class="ident" id="6250437">token</span><span class="op" id="6250442">.</span><span class="ident" id="6250443">COMMA</span>&nbsp;<span class="op" id="6250449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250453">p</span><span class="op" id="6250454">.</span><span class="ident" id="6250455">next</span><span class="op" id="6250459">(</span><span class="op" id="6250460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250464">list</span>&nbsp;<span class="op" id="6250469">=</span>&nbsp;<span class="builtinfunc" id="6250471">append</span><span class="op" id="6250477">(</span><span class="ident" id="6250478">list</span><span class="op" id="6250482">,</span>&nbsp;<span class="ident" id="6250484">p</span><span class="op" id="6250485">.</span><span class="ident" id="6250486">parseIdent</span><span class="op" id="6250496">(</span><span class="op" id="6250497">)</span><span class="op" id="6250498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250501">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250505">return</span><br>
<span class="lineno"></span><span class="op" id="6250512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6250515">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="6250595">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6250618">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6250697">func</span>&nbsp;<span class="op" id="6250702">(</span><span class="ident" id="6250703">p</span>&nbsp;<span class="op" id="6250705">*</span><span class="ident" id="6250706">parser</span><span class="op" id="6250712">)</span>&nbsp;<span class="ident" id="6250714">parseExprList</span><span class="op" id="6250727">(</span><span class="ident" id="6250728">lhs</span>&nbsp;<span class="builtintype" id="6250732">bool</span><span class="op" id="6250736">)</span>&nbsp;<span class="op" id="6250738">(</span><span class="ident" id="6250739">list</span>&nbsp;<span class="op" id="6250744">[</span><span class="op" id="6250745">]</span><span class="ident" id="6250746">ast</span><span class="op" id="6250749">.</span><span class="ident" id="6250750">Expr</span><span class="op" id="6250754">)</span>&nbsp;<span class="op" id="6250756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250759">if</span>&nbsp;<span class="ident" id="6250762">p</span><span class="op" id="6250763">.</span><span class="ident" id="6250764">trace</span>&nbsp;<span class="op" id="6250770">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250774">defer</span>&nbsp;<span class="ident" id="6250780">un</span><span class="op" id="6250782">(</span><span class="ident" id="6250783">trace</span><span class="op" id="6250788">(</span><span class="ident" id="6250789">p</span><span class="op" id="6250790">,</span>&nbsp;<span class="string" id="6250792">&#34;ExpressionList&#34;</span><span class="op" id="6250808">)</span><span class="op" id="6250809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250816">list</span>&nbsp;<span class="op" id="6250821">=</span>&nbsp;<span class="builtinfunc" id="6250823">append</span><span class="op" id="6250829">(</span><span class="ident" id="6250830">list</span><span class="op" id="6250834">,</span>&nbsp;<span class="ident" id="6250836">p</span><span class="op" id="6250837">.</span><span class="ident" id="6250838">checkExpr</span><span class="op" id="6250847">(</span><span class="ident" id="6250848">p</span><span class="op" id="6250849">.</span><span class="ident" id="6250850">parseExpr</span><span class="op" id="6250859">(</span><span class="ident" id="6250860">lhs</span><span class="op" id="6250863">)</span><span class="op" id="6250864">)</span><span class="op" id="6250865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250868">for</span>&nbsp;<span class="ident" id="6250872">p</span><span class="op" id="6250873">.</span><span class="ident" id="6250874">tok</span>&nbsp;<span class="op" id="6250878">==</span>&nbsp;<span class="ident" id="6250881">token</span><span class="op" id="6250886">.</span><span class="ident" id="6250887">COMMA</span>&nbsp;<span class="op" id="6250893">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250897">p</span><span class="op" id="6250898">.</span><span class="ident" id="6250899">next</span><span class="op" id="6250903">(</span><span class="op" id="6250904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250908">list</span>&nbsp;<span class="op" id="6250913">=</span>&nbsp;<span class="builtinfunc" id="6250915">append</span><span class="op" id="6250921">(</span><span class="ident" id="6250922">list</span><span class="op" id="6250926">,</span>&nbsp;<span class="ident" id="6250928">p</span><span class="op" id="6250929">.</span><span class="ident" id="6250930">checkExpr</span><span class="op" id="6250939">(</span><span class="ident" id="6250940">p</span><span class="op" id="6250941">.</span><span class="ident" id="6250942">parseExpr</span><span class="op" id="6250951">(</span><span class="ident" id="6250952">lhs</span><span class="op" id="6250955">)</span><span class="op" id="6250956">)</span><span class="op" id="6250957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250964">return</span><br>
<span class="lineno">560</span><span class="op" id="6250971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6250974">func</span>&nbsp;<span class="op" id="6250979">(</span><span class="ident" id="6250980">p</span>&nbsp;<span class="op" id="6250982">*</span><span class="ident" id="6250983">parser</span><span class="op" id="6250989">)</span>&nbsp;<span class="ident" id="6250991">parseLhsList</span><span class="op" id="6251003">(</span><span class="op" id="6251004">)</span>&nbsp;<span class="op" id="6251006">[</span><span class="op" id="6251007">]</span><span class="ident" id="6251008">ast</span><span class="op" id="6251011">.</span><span class="ident" id="6251012">Expr</span>&nbsp;<span class="op" id="6251017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251020">old</span>&nbsp;<span class="op" id="6251024">:=</span>&nbsp;<span class="ident" id="6251027">p</span><span class="op" id="6251028">.</span><span class="ident" id="6251029">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251036">p</span><span class="op" id="6251037">.</span><span class="ident" id="6251038">inRhs</span>&nbsp;<span class="op" id="6251044">=</span>&nbsp;<span class="builtintype" id="6251046">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251053">list</span>&nbsp;<span class="op" id="6251058">:=</span>&nbsp;<span class="ident" id="6251061">p</span><span class="op" id="6251062">.</span><span class="ident" id="6251063">parseExprList</span><span class="op" id="6251076">(</span><span class="builtintype" id="6251077">true</span><span class="op" id="6251081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251084">switch</span>&nbsp;<span class="ident" id="6251091">p</span><span class="op" id="6251092">.</span><span class="ident" id="6251093">tok</span>&nbsp;<span class="op" id="6251097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251100">case</span>&nbsp;<span class="ident" id="6251105">token</span><span class="op" id="6251110">.</span><span class="ident" id="6251111">DEFINE</span><span class="op" id="6251117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251121">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251162">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251204">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251264">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251289">case</span>&nbsp;<span class="ident" id="6251294">token</span><span class="op" id="6251299">.</span><span class="ident" id="6251300">COLON</span><span class="op" id="6251305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251309">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251379">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251451">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251480">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251537">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251608">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251677">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251722">default</span><span class="op" id="6251729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251733">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251777">for</span>&nbsp;<span class="ident" id="6251781">_</span><span class="op" id="6251782">,</span>&nbsp;<span class="ident" id="6251784">x</span>&nbsp;<span class="op" id="6251786">:=</span>&nbsp;<span class="keyword" id="6251789">range</span>&nbsp;<span class="ident" id="6251795">list</span>&nbsp;<span class="op" id="6251800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251805">p</span><span class="op" id="6251806">.</span><span class="ident" id="6251807">resolve</span><span class="op" id="6251814">(</span><span class="ident" id="6251815">x</span><span class="op" id="6251816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251820">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251826">p</span><span class="op" id="6251827">.</span><span class="ident" id="6251828">inRhs</span>&nbsp;<span class="op" id="6251834">=</span>&nbsp;<span class="ident" id="6251836">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251841">return</span>&nbsp;<span class="ident" id="6251848">list</span><br>
<span class="lineno"></span><span class="op" id="6251853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="6251856">func</span>&nbsp;<span class="op" id="6251861">(</span><span class="ident" id="6251862">p</span>&nbsp;<span class="op" id="6251864">*</span><span class="ident" id="6251865">parser</span><span class="op" id="6251871">)</span>&nbsp;<span class="ident" id="6251873">parseRhsList</span><span class="op" id="6251885">(</span><span class="op" id="6251886">)</span>&nbsp;<span class="op" id="6251888">[</span><span class="op" id="6251889">]</span><span class="ident" id="6251890">ast</span><span class="op" id="6251893">.</span><span class="ident" id="6251894">Expr</span>&nbsp;<span class="op" id="6251899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251902">old</span>&nbsp;<span class="op" id="6251906">:=</span>&nbsp;<span class="ident" id="6251909">p</span><span class="op" id="6251910">.</span><span class="ident" id="6251911">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251918">p</span><span class="op" id="6251919">.</span><span class="ident" id="6251920">inRhs</span>&nbsp;<span class="op" id="6251926">=</span>&nbsp;<span class="builtintype" id="6251928">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251934">list</span>&nbsp;<span class="op" id="6251939">:=</span>&nbsp;<span class="ident" id="6251942">p</span><span class="op" id="6251943">.</span><span class="ident" id="6251944">parseExprList</span><span class="op" id="6251957">(</span><span class="builtintype" id="6251958">false</span><span class="op" id="6251963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251966">p</span><span class="op" id="6251967">.</span><span class="ident" id="6251968">inRhs</span>&nbsp;<span class="op" id="6251974">=</span>&nbsp;<span class="ident" id="6251976">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251981">return</span>&nbsp;<span class="ident" id="6251988">list</span><br>
<span class="lineno"></span><span class="op" id="6251993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6251996">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6252076">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="6252086">func</span>&nbsp;<span class="op" id="6252091">(</span><span class="ident" id="6252092">p</span>&nbsp;<span class="op" id="6252094">*</span><span class="ident" id="6252095">parser</span><span class="op" id="6252101">)</span>&nbsp;<span class="ident" id="6252103">parseType</span><span class="op" id="6252112">(</span><span class="op" id="6252113">)</span>&nbsp;<span class="ident" id="6252115">ast</span><span class="op" id="6252118">.</span><span class="ident" id="6252119">Expr</span>&nbsp;<span class="op" id="6252124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252127">if</span>&nbsp;<span class="ident" id="6252130">p</span><span class="op" id="6252131">.</span><span class="ident" id="6252132">trace</span>&nbsp;<span class="op" id="6252138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252142">defer</span>&nbsp;<span class="ident" id="6252148">un</span><span class="op" id="6252150">(</span><span class="ident" id="6252151">trace</span><span class="op" id="6252156">(</span><span class="ident" id="6252157">p</span><span class="op" id="6252158">,</span>&nbsp;<span class="string" id="6252160">&#34;Type&#34;</span><span class="op" id="6252166">)</span><span class="op" id="6252167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252170">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252174">typ</span>&nbsp;<span class="op" id="6252178">:=</span>&nbsp;<span class="ident" id="6252181">p</span><span class="op" id="6252182">.</span><span class="ident" id="6252183">tryType</span><span class="op" id="6252190">(</span><span class="op" id="6252191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252195">if</span>&nbsp;<span class="ident" id="6252198">typ</span>&nbsp;<span class="op" id="6252202">==</span>&nbsp;<span class="ident" id="6252205">nil</span>&nbsp;<span class="op" id="6252209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252213">pos</span>&nbsp;<span class="op" id="6252217">:=</span>&nbsp;<span class="ident" id="6252220">p</span><span class="op" id="6252221">.</span><span class="ident" id="6252222">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252228">p</span><span class="op" id="6252229">.</span><span class="ident" id="6252230">errorExpected</span><span class="op" id="6252243">(</span><span class="ident" id="6252244">pos</span><span class="op" id="6252247">,</span>&nbsp;<span class="string" id="6252249">&#34;type&#34;</span><span class="op" id="6252255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252259">p</span><span class="op" id="6252260">.</span><span class="ident" id="6252261">next</span><span class="op" id="6252265">(</span><span class="op" id="6252266">)</span>&nbsp;<span class="comment" id="6252268">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252287">return</span>&nbsp;<span class="op" id="6252294">&amp;</span><span class="ident" id="6252295">ast</span><span class="op" id="6252298">.</span><span class="ident" id="6252299">BadExpr</span><span class="op" id="6252306">{</span><span class="ident" id="6252307">From</span><span class="op" id="6252311">:</span>&nbsp;<span class="ident" id="6252313">pos</span><span class="op" id="6252316">,</span>&nbsp;<span class="ident" id="6252318">To</span><span class="op" id="6252320">:</span>&nbsp;<span class="ident" id="6252322">p</span><span class="op" id="6252323">.</span><span class="ident" id="6252324">pos</span><span class="op" id="6252327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252334">return</span>&nbsp;<span class="ident" id="6252341">typ</span><br>
<span class="lineno"></span><span class="op" id="6252345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6252348">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6252403">func</span>&nbsp;<span class="op" id="6252408">(</span><span class="ident" id="6252409">p</span>&nbsp;<span class="op" id="6252411">*</span><span class="ident" id="6252412">parser</span><span class="op" id="6252418">)</span>&nbsp;<span class="ident" id="6252420">parseTypeName</span><span class="op" id="6252433">(</span><span class="op" id="6252434">)</span>&nbsp;<span class="ident" id="6252436">ast</span><span class="op" id="6252439">.</span><span class="ident" id="6252440">Expr</span>&nbsp;<span class="op" id="6252445">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252448">if</span>&nbsp;<span class="ident" id="6252451">p</span><span class="op" id="6252452">.</span><span class="ident" id="6252453">trace</span>&nbsp;<span class="op" id="6252459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252463">defer</span>&nbsp;<span class="ident" id="6252469">un</span><span class="op" id="6252471">(</span><span class="ident" id="6252472">trace</span><span class="op" id="6252477">(</span><span class="ident" id="6252478">p</span><span class="op" id="6252479">,</span>&nbsp;<span class="string" id="6252481">&#34;TypeName&#34;</span><span class="op" id="6252491">)</span><span class="op" id="6252492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252499">ident</span>&nbsp;<span class="op" id="6252505">:=</span>&nbsp;<span class="ident" id="6252508">p</span><span class="op" id="6252509">.</span><span class="ident" id="6252510">parseIdent</span><span class="op" id="6252520">(</span><span class="op" id="6252521">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6252524">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252591">if</span>&nbsp;<span class="ident" id="6252594">p</span><span class="op" id="6252595">.</span><span class="ident" id="6252596">tok</span>&nbsp;<span class="op" id="6252600">==</span>&nbsp;<span class="ident" id="6252603">token</span><span class="op" id="6252608">.</span><span class="ident" id="6252609">PERIOD</span>&nbsp;<span class="op" id="6252616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6252620">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252649">p</span><span class="op" id="6252650">.</span><span class="ident" id="6252651">next</span><span class="op" id="6252655">(</span><span class="op" id="6252656">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252660">p</span><span class="op" id="6252661">.</span><span class="ident" id="6252662">resolve</span><span class="op" id="6252669">(</span><span class="ident" id="6252670">ident</span><span class="op" id="6252675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252679">sel</span>&nbsp;<span class="op" id="6252683">:=</span>&nbsp;<span class="ident" id="6252686">p</span><span class="op" id="6252687">.</span><span class="ident" id="6252688">parseIdent</span><span class="op" id="6252698">(</span><span class="op" id="6252699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252703">return</span>&nbsp;<span class="op" id="6252710">&amp;</span><span class="ident" id="6252711">ast</span><span class="op" id="6252714">.</span><span class="ident" id="6252715">SelectorExpr</span><span class="op" id="6252727">{</span><span class="ident" id="6252728">X</span><span class="op" id="6252729">:</span>&nbsp;<span class="ident" id="6252731">ident</span><span class="op" id="6252736">,</span>&nbsp;<span class="ident" id="6252738">Sel</span><span class="op" id="6252741">:</span>&nbsp;<span class="ident" id="6252743">sel</span><span class="op" id="6252746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252753">return</span>&nbsp;<span class="ident" id="6252760">ident</span><br>
<span class="lineno"></span><span class="op" id="6252766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6252769">func</span>&nbsp;<span class="op" id="6252774">(</span><span class="ident" id="6252775">p</span>&nbsp;<span class="op" id="6252777">*</span><span class="ident" id="6252778">parser</span><span class="op" id="6252784">)</span>&nbsp;<span class="ident" id="6252786">parseArrayType</span><span class="op" id="6252800">(</span><span class="op" id="6252801">)</span>&nbsp;<span class="ident" id="6252803">ast</span><span class="op" id="6252806">.</span><span class="ident" id="6252807">Expr</span>&nbsp;<span class="op" id="6252812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252815">if</span>&nbsp;<span class="ident" id="6252818">p</span><span class="op" id="6252819">.</span><span class="ident" id="6252820">trace</span>&nbsp;<span class="op" id="6252826">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252830">defer</span>&nbsp;<span class="ident" id="6252836">un</span><span class="op" id="6252838">(</span><span class="ident" id="6252839">trace</span><span class="op" id="6252844">(</span><span class="ident" id="6252845">p</span><span class="op" id="6252846">,</span>&nbsp;<span class="string" id="6252848">&#34;ArrayType&#34;</span><span class="op" id="6252859">)</span><span class="op" id="6252860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252867">lbrack</span>&nbsp;<span class="op" id="6252874">:=</span>&nbsp;<span class="ident" id="6252877">p</span><span class="op" id="6252878">.</span><span class="ident" id="6252879">expect</span><span class="op" id="6252885">(</span><span class="ident" id="6252886">token</span><span class="op" id="6252891">.</span><span class="ident" id="6252892">LBRACK</span><span class="op" id="6252898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252901">p</span><span class="op" id="6252902">.</span><span class="ident" id="6252903">exprLev</span><span class="op" id="6252910">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252914">var</span>&nbsp;<span class="builtinfunc" id="6252918">len</span>&nbsp;<span class="ident" id="6252922">ast</span><span class="op" id="6252925">.</span><span class="ident" id="6252926">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6252932">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252991">if</span>&nbsp;<span class="ident" id="6252994">p</span><span class="op" id="6252995">.</span><span class="ident" id="6252996">tok</span>&nbsp;<span class="op" id="6253000">==</span>&nbsp;<span class="ident" id="6253003">token</span><span class="op" id="6253008">.</span><span class="ident" id="6253009">ELLIPSIS</span>&nbsp;<span class="op" id="6253018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6253022">len</span>&nbsp;<span class="op" id="6253026">=</span>&nbsp;<span class="op" id="6253028">&amp;</span><span class="ident" id="6253029">ast</span><span class="op" id="6253032">.</span><span class="ident" id="6253033">Ellipsis</span><span class="op" id="6253041">{</span><span class="ident" id="6253042">Ellipsis</span><span class="op" id="6253050">:</span>&nbsp;<span class="ident" id="6253052">p</span><span class="op" id="6253053">.</span><span class="ident" id="6253054">pos</span><span class="op" id="6253057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253061">p</span><span class="op" id="6253062">.</span><span class="ident" id="6253063">next</span><span class="op" id="6253067">(</span><span class="op" id="6253068">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253071">}</span>&nbsp;<span class="keyword" id="6253073">else</span>&nbsp;<span class="keyword" id="6253078">if</span>&nbsp;<span class="ident" id="6253081">p</span><span class="op" id="6253082">.</span><span class="ident" id="6253083">tok</span>&nbsp;<span class="op" id="6253087">!=</span>&nbsp;<span class="ident" id="6253090">token</span><span class="op" id="6253095">.</span><span class="ident" id="6253096">RBRACK</span>&nbsp;<span class="op" id="6253103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6253107">len</span>&nbsp;<span class="op" id="6253111">=</span>&nbsp;<span class="ident" id="6253113">p</span><span class="op" id="6253114">.</span><span class="ident" id="6253115">parseRhs</span><span class="op" id="6253123">(</span><span class="op" id="6253124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253130">p</span><span class="op" id="6253131">.</span><span class="ident" id="6253132">exprLev</span><span class="op" id="6253139">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253143">p</span><span class="op" id="6253144">.</span><span class="ident" id="6253145">expect</span><span class="op" id="6253151">(</span><span class="ident" id="6253152">token</span><span class="op" id="6253157">.</span><span class="ident" id="6253158">RBRACK</span><span class="op" id="6253164">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253167">elt</span>&nbsp;<span class="op" id="6253171">:=</span>&nbsp;<span class="ident" id="6253174">p</span><span class="op" id="6253175">.</span><span class="ident" id="6253176">parseType</span><span class="op" id="6253185">(</span><span class="op" id="6253186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253190">return</span>&nbsp;<span class="op" id="6253197">&amp;</span><span class="ident" id="6253198">ast</span><span class="op" id="6253201">.</span><span class="ident" id="6253202">ArrayType</span><span class="op" id="6253211">{</span><span class="ident" id="6253212">Lbrack</span><span class="op" id="6253218">:</span>&nbsp;<span class="ident" id="6253220">lbrack</span><span class="op" id="6253226">,</span>&nbsp;<span class="ident" id="6253228">Len</span><span class="op" id="6253231">:</span>&nbsp;<span class="builtinfunc" id="6253233">len</span><span class="op" id="6253236">,</span>&nbsp;<span class="ident" id="6253238">Elt</span><span class="op" id="6253241">:</span>&nbsp;<span class="ident" id="6253243">elt</span><span class="op" id="6253246">}</span><br>
<span class="lineno"></span><span class="op" id="6253248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="6253251">func</span>&nbsp;<span class="op" id="6253256">(</span><span class="ident" id="6253257">p</span>&nbsp;<span class="op" id="6253259">*</span><span class="ident" id="6253260">parser</span><span class="op" id="6253266">)</span>&nbsp;<span class="ident" id="6253268">makeIdentList</span><span class="op" id="6253281">(</span><span class="ident" id="6253282">list</span>&nbsp;<span class="op" id="6253287">[</span><span class="op" id="6253288">]</span><span class="ident" id="6253289">ast</span><span class="op" id="6253292">.</span><span class="ident" id="6253293">Expr</span><span class="op" id="6253297">)</span>&nbsp;<span class="op" id="6253299">[</span><span class="op" id="6253300">]</span><span class="op" id="6253301">*</span><span class="ident" id="6253302">ast</span><span class="op" id="6253305">.</span><span class="ident" id="6253306">Ident</span>&nbsp;<span class="op" id="6253312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253315">idents</span>&nbsp;<span class="op" id="6253322">:=</span>&nbsp;<span class="builtinfunc" id="6253325">make</span><span class="op" id="6253329">(</span><span class="op" id="6253330">[</span><span class="op" id="6253331">]</span><span class="op" id="6253332">*</span><span class="ident" id="6253333">ast</span><span class="op" id="6253336">.</span><span class="ident" id="6253337">Ident</span><span class="op" id="6253342">,</span>&nbsp;<span class="builtinfunc" id="6253344">len</span><span class="op" id="6253347">(</span><span class="ident" id="6253348">list</span><span class="op" id="6253352">)</span><span class="op" id="6253353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253356">for</span>&nbsp;<span class="ident" id="6253360">i</span><span class="op" id="6253361">,</span>&nbsp;<span class="ident" id="6253363">x</span>&nbsp;<span class="op" id="6253365">:=</span>&nbsp;<span class="keyword" id="6253368">range</span>&nbsp;<span class="ident" id="6253374">list</span>&nbsp;<span class="op" id="6253379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253383">ident</span><span class="op" id="6253388">,</span>&nbsp;<span class="ident" id="6253390">isIdent</span>&nbsp;<span class="op" id="6253398">:=</span>&nbsp;<span class="ident" id="6253401">x</span><span class="op" id="6253402">.</span><span class="op" id="6253403">(</span><span class="op" id="6253404">*</span><span class="ident" id="6253405">ast</span><span class="op" id="6253408">.</span><span class="ident" id="6253409">Ident</span><span class="op" id="6253414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253418">if</span>&nbsp;<span class="op" id="6253421">!</span><span class="ident" id="6253422">isIdent</span>&nbsp;<span class="op" id="6253430">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253435">if</span>&nbsp;<span class="ident" id="6253438">_</span><span class="op" id="6253439">,</span>&nbsp;<span class="ident" id="6253441">isBad</span>&nbsp;<span class="op" id="6253447">:=</span>&nbsp;<span class="ident" id="6253450">x</span><span class="op" id="6253451">.</span><span class="op" id="6253452">(</span><span class="op" id="6253453">*</span><span class="ident" id="6253454">ast</span><span class="op" id="6253457">.</span><span class="ident" id="6253458">BadExpr</span><span class="op" id="6253465">)</span><span class="op" id="6253466">;</span>&nbsp;<span class="op" id="6253468">!</span><span class="ident" id="6253469">isBad</span>&nbsp;<span class="op" id="6253475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253481">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253524">p</span><span class="op" id="6253525">.</span><span class="ident" id="6253526">errorExpected</span><span class="op" id="6253539">(</span><span class="ident" id="6253540">x</span><span class="op" id="6253541">.</span><span class="ident" id="6253542">Pos</span><span class="op" id="6253545">(</span><span class="op" id="6253546">)</span><span class="op" id="6253547">,</span>&nbsp;<span class="string" id="6253549">&#34;identifier&#34;</span><span class="op" id="6253561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253571">ident</span>&nbsp;<span class="op" id="6253577">=</span>&nbsp;<span class="op" id="6253579">&amp;</span><span class="ident" id="6253580">ast</span><span class="op" id="6253583">.</span><span class="ident" id="6253584">Ident</span><span class="op" id="6253589">{</span><span class="ident" id="6253590">NamePos</span><span class="op" id="6253597">:</span>&nbsp;<span class="ident" id="6253599">x</span><span class="op" id="6253600">.</span><span class="ident" id="6253601">Pos</span><span class="op" id="6253604">(</span><span class="op" id="6253605">)</span><span class="op" id="6253606">,</span>&nbsp;<span class="ident" id="6253608">Name</span><span class="op" id="6253612">:</span>&nbsp;<span class="string" id="6253614">&#34;_&#34;</span><span class="op" id="6253617">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253625">idents</span><span class="op" id="6253631">[</span><span class="ident" id="6253632">i</span><span class="op" id="6253633">]</span>&nbsp;<span class="op" id="6253635">=</span>&nbsp;<span class="ident" id="6253637">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253647">return</span>&nbsp;<span class="ident" id="6253654">idents</span><br>
<span class="lineno"></span><span class="op" id="6253661">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="6253664">func</span>&nbsp;<span class="op" id="6253669">(</span><span class="ident" id="6253670">p</span>&nbsp;<span class="op" id="6253672">*</span><span class="ident" id="6253673">parser</span><span class="op" id="6253679">)</span>&nbsp;<span class="ident" id="6253681">parseFieldDecl</span><span class="op" id="6253695">(</span><span class="ident" id="6253696">scope</span>&nbsp;<span class="op" id="6253702">*</span><span class="ident" id="6253703">ast</span><span class="op" id="6253706">.</span><span class="ident" id="6253707">Scope</span><span class="op" id="6253712">)</span>&nbsp;<span class="op" id="6253714">*</span><span class="ident" id="6253715">ast</span><span class="op" id="6253718">.</span><span class="ident" id="6253719">Field</span>&nbsp;<span class="op" id="6253725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253728">if</span>&nbsp;<span class="ident" id="6253731">p</span><span class="op" id="6253732">.</span><span class="ident" id="6253733">trace</span>&nbsp;<span class="op" id="6253739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253743">defer</span>&nbsp;<span class="ident" id="6253749">un</span><span class="op" id="6253751">(</span><span class="ident" id="6253752">trace</span><span class="op" id="6253757">(</span><span class="ident" id="6253758">p</span><span class="op" id="6253759">,</span>&nbsp;<span class="string" id="6253761">&#34;FieldDecl&#34;</span><span class="op" id="6253772">)</span><span class="op" id="6253773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253776">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253780">doc</span>&nbsp;<span class="op" id="6253784">:=</span>&nbsp;<span class="ident" id="6253787">p</span><span class="op" id="6253788">.</span><span class="ident" id="6253789">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253803">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253817">list</span><span class="op" id="6253821">,</span>&nbsp;<span class="ident" id="6253823">typ</span>&nbsp;<span class="op" id="6253827">:=</span>&nbsp;<span class="ident" id="6253830">p</span><span class="op" id="6253831">.</span><span class="ident" id="6253832">parseVarList</span><span class="op" id="6253844">(</span><span class="builtintype" id="6253845">false</span><span class="op" id="6253850">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253854">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253862">var</span>&nbsp;<span class="ident" id="6253866">tag</span>&nbsp;<span class="op" id="6253870">*</span><span class="ident" id="6253871">ast</span><span class="op" id="6253874">.</span><span class="ident" id="6253875">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253885">if</span>&nbsp;<span class="ident" id="6253888">p</span><span class="op" id="6253889">.</span><span class="ident" id="6253890">tok</span>&nbsp;<span class="op" id="6253894">==</span>&nbsp;<span class="ident" id="6253897">token</span><span class="op" id="6253902">.</span><span class="ident" id="6253903">STRING</span>&nbsp;<span class="op" id="6253910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253914">tag</span>&nbsp;<span class="op" id="6253918">=</span>&nbsp;<span class="op" id="6253920">&amp;</span><span class="ident" id="6253921">ast</span><span class="op" id="6253924">.</span><span class="ident" id="6253925">BasicLit</span><span class="op" id="6253933">{</span><span class="ident" id="6253934">ValuePos</span><span class="op" id="6253942">:</span>&nbsp;<span class="ident" id="6253944">p</span><span class="op" id="6253945">.</span><span class="ident" id="6253946">pos</span><span class="op" id="6253949">,</span>&nbsp;<span class="ident" id="6253951">Kind</span><span class="op" id="6253955">:</span>&nbsp;<span class="ident" id="6253957">p</span><span class="op" id="6253958">.</span><span class="ident" id="6253959">tok</span><span class="op" id="6253962">,</span>&nbsp;<span class="ident" id="6253964">Value</span><span class="op" id="6253969">:</span>&nbsp;<span class="ident" id="6253971">p</span><span class="op" id="6253972">.</span><span class="ident" id="6253973">lit</span><span class="op" id="6253976">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253980">p</span><span class="op" id="6253981">.</span><span class="ident" id="6253982">next</span><span class="op" id="6253986">(</span><span class="op" id="6253987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253994">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254011">var</span>&nbsp;<span class="ident" id="6254015">idents</span>&nbsp;<span class="op" id="6254022">[</span><span class="op" id="6254023">]</span><span class="op" id="6254024">*</span><span class="ident" id="6254025">ast</span><span class="op" id="6254028">.</span><span class="ident" id="6254029">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254036">if</span>&nbsp;<span class="ident" id="6254039">typ</span>&nbsp;<span class="op" id="6254043">!=</span>&nbsp;<span class="ident" id="6254046">nil</span>&nbsp;<span class="op" id="6254050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254054">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254079">idents</span>&nbsp;<span class="op" id="6254086">=</span>&nbsp;<span class="ident" id="6254088">p</span><span class="op" id="6254089">.</span><span class="ident" id="6254090">makeIdentList</span><span class="op" id="6254103">(</span><span class="ident" id="6254104">list</span><span class="op" id="6254108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254111">}</span>&nbsp;<span class="keyword" id="6254113">else</span>&nbsp;<span class="op" id="6254118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254122">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254159">typ</span>&nbsp;<span class="op" id="6254163">=</span>&nbsp;<span class="ident" id="6254165">list</span><span class="op" id="6254169">[</span><span class="num" id="6254170">0</span><span class="op" id="6254171">]</span>&nbsp;<span class="comment" id="6254173">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254214">if</span>&nbsp;<span class="ident" id="6254217">n</span>&nbsp;<span class="op" id="6254219">:=</span>&nbsp;<span class="builtinfunc" id="6254222">len</span><span class="op" id="6254225">(</span><span class="ident" id="6254226">list</span><span class="op" id="6254230">)</span><span class="op" id="6254231">;</span>&nbsp;<span class="ident" id="6254233">n</span>&nbsp;<span class="op" id="6254235">&gt;</span>&nbsp;<span class="num" id="6254237">1</span>&nbsp;<span class="op" id="6254239">||</span>&nbsp;<span class="op" id="6254242">!</span><span class="ident" id="6254243">isTypeName</span><span class="op" id="6254253">(</span><span class="ident" id="6254254">deref</span><span class="op" id="6254259">(</span><span class="ident" id="6254260">typ</span><span class="op" id="6254263">)</span><span class="op" id="6254264">)</span>&nbsp;<span class="op" id="6254266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254271">pos</span>&nbsp;<span class="op" id="6254275">:=</span>&nbsp;<span class="ident" id="6254278">typ</span><span class="op" id="6254281">.</span><span class="ident" id="6254282">Pos</span><span class="op" id="6254285">(</span><span class="op" id="6254286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254291">p</span><span class="op" id="6254292">.</span><span class="ident" id="6254293">errorExpected</span><span class="op" id="6254306">(</span><span class="ident" id="6254307">pos</span><span class="op" id="6254310">,</span>&nbsp;<span class="string" id="6254312">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="6254329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254334">typ</span>&nbsp;<span class="op" id="6254338">=</span>&nbsp;<span class="op" id="6254340">&amp;</span><span class="ident" id="6254341">ast</span><span class="op" id="6254344">.</span><span class="ident" id="6254345">BadExpr</span><span class="op" id="6254352">{</span><span class="ident" id="6254353">From</span><span class="op" id="6254357">:</span>&nbsp;<span class="ident" id="6254359">pos</span><span class="op" id="6254362">,</span>&nbsp;<span class="ident" id="6254364">To</span><span class="op" id="6254366">:</span>&nbsp;<span class="ident" id="6254368">p</span><span class="op" id="6254369">.</span><span class="ident" id="6254370">safePos</span><span class="op" id="6254377">(</span><span class="ident" id="6254378">list</span><span class="op" id="6254382">[</span><span class="ident" id="6254383">n</span><span class="op" id="6254384">-</span><span class="num" id="6254385">1</span><span class="op" id="6254386">]</span><span class="op" id="6254387">.</span><span class="ident" id="6254388">End</span><span class="op" id="6254391">(</span><span class="op" id="6254392">)</span><span class="op" id="6254393">)</span><span class="op" id="6254394">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254405">p</span><span class="op" id="6254406">.</span><span class="ident" id="6254407">expectSemi</span><span class="op" id="6254417">(</span><span class="op" id="6254418">)</span>&nbsp;<span class="comment" id="6254420">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254461">field</span>&nbsp;<span class="op" id="6254467">:=</span>&nbsp;<span class="op" id="6254470">&amp;</span><span class="ident" id="6254471">ast</span><span class="op" id="6254474">.</span><span class="ident" id="6254475">Field</span><span class="op" id="6254480">{</span><span class="ident" id="6254481">Doc</span><span class="op" id="6254484">:</span>&nbsp;<span class="ident" id="6254486">doc</span><span class="op" id="6254489">,</span>&nbsp;<span class="ident" id="6254491">Names</span><span class="op" id="6254496">:</span>&nbsp;<span class="ident" id="6254498">idents</span><span class="op" id="6254504">,</span>&nbsp;<span class="ident" id="6254506">Type</span><span class="op" id="6254510">:</span>&nbsp;<span class="ident" id="6254512">typ</span><span class="op" id="6254515">,</span>&nbsp;<span class="ident" id="6254517">Tag</span><span class="op" id="6254520">:</span>&nbsp;<span class="ident" id="6254522">tag</span><span class="op" id="6254525">,</span>&nbsp;<span class="ident" id="6254527">Comment</span><span class="op" id="6254534">:</span>&nbsp;<span class="ident" id="6254536">p</span><span class="op" id="6254537">.</span><span class="ident" id="6254538">lineComment</span><span class="op" id="6254549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254552">p</span><span class="op" id="6254553">.</span><span class="ident" id="6254554">declare</span><span class="op" id="6254561">(</span><span class="ident" id="6254562">field</span><span class="op" id="6254567">,</span>&nbsp;<span class="ident" id="6254569">nil</span><span class="op" id="6254572">,</span>&nbsp;<span class="ident" id="6254574">scope</span><span class="op" id="6254579">,</span>&nbsp;<span class="ident" id="6254581">ast</span><span class="op" id="6254584">.</span><span class="ident" id="6254585">Var</span><span class="op" id="6254588">,</span>&nbsp;<span class="ident" id="6254590">idents</span><span class="op" id="6254596">...</span><span class="op" id="6254599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254602">p</span><span class="op" id="6254603">.</span><span class="ident" id="6254604">resolve</span><span class="op" id="6254611">(</span><span class="ident" id="6254612">typ</span><span class="op" id="6254615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254619">return</span>&nbsp;<span class="ident" id="6254626">field</span><br>
<span class="lineno">715</span><span class="op" id="6254632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6254635">func</span>&nbsp;<span class="op" id="6254640">(</span><span class="ident" id="6254641">p</span>&nbsp;<span class="op" id="6254643">*</span><span class="ident" id="6254644">parser</span><span class="op" id="6254650">)</span>&nbsp;<span class="ident" id="6254652">parseStructType</span><span class="op" id="6254667">(</span><span class="op" id="6254668">)</span>&nbsp;<span class="op" id="6254670">*</span><span class="ident" id="6254671">ast</span><span class="op" id="6254674">.</span><span class="ident" id="6254675">StructType</span>&nbsp;<span class="op" id="6254686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254689">if</span>&nbsp;<span class="ident" id="6254692">p</span><span class="op" id="6254693">.</span><span class="ident" id="6254694">trace</span>&nbsp;<span class="op" id="6254700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254704">defer</span>&nbsp;<span class="ident" id="6254710">un</span><span class="op" id="6254712">(</span><span class="ident" id="6254713">trace</span><span class="op" id="6254718">(</span><span class="ident" id="6254719">p</span><span class="op" id="6254720">,</span>&nbsp;<span class="string" id="6254722">&#34;StructType&#34;</span><span class="op" id="6254734">)</span><span class="op" id="6254735">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254742">pos</span>&nbsp;<span class="op" id="6254746">:=</span>&nbsp;<span class="ident" id="6254749">p</span><span class="op" id="6254750">.</span><span class="ident" id="6254751">expect</span><span class="op" id="6254757">(</span><span class="ident" id="6254758">token</span><span class="op" id="6254763">.</span><span class="ident" id="6254764">STRUCT</span><span class="op" id="6254770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254773">lbrace</span>&nbsp;<span class="op" id="6254780">:=</span>&nbsp;<span class="ident" id="6254783">p</span><span class="op" id="6254784">.</span><span class="ident" id="6254785">expect</span><span class="op" id="6254791">(</span><span class="ident" id="6254792">token</span><span class="op" id="6254797">.</span><span class="ident" id="6254798">LBRACE</span><span class="op" id="6254804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254807">scope</span>&nbsp;<span class="op" id="6254813">:=</span>&nbsp;<span class="ident" id="6254816">ast</span><span class="op" id="6254819">.</span><span class="ident" id="6254820">NewScope</span><span class="op" id="6254828">(</span><span class="ident" id="6254829">nil</span><span class="op" id="6254832">)</span>&nbsp;<span class="comment" id="6254834">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254851">var</span>&nbsp;<span class="ident" id="6254855">list</span>&nbsp;<span class="op" id="6254860">[</span><span class="op" id="6254861">]</span><span class="op" id="6254862">*</span><span class="ident" id="6254863">ast</span><span class="op" id="6254866">.</span><span class="ident" id="6254867">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254874">for</span>&nbsp;<span class="ident" id="6254878">p</span><span class="op" id="6254879">.</span><span class="ident" id="6254880">tok</span>&nbsp;<span class="op" id="6254884">==</span>&nbsp;<span class="ident" id="6254887">token</span><span class="op" id="6254892">.</span><span class="ident" id="6254893">IDENT</span>&nbsp;<span class="op" id="6254899">||</span>&nbsp;<span class="ident" id="6254902">p</span><span class="op" id="6254903">.</span><span class="ident" id="6254904">tok</span>&nbsp;<span class="op" id="6254908">==</span>&nbsp;<span class="ident" id="6254911">token</span><span class="op" id="6254916">.</span><span class="ident" id="6254917">MUL</span>&nbsp;<span class="op" id="6254921">||</span>&nbsp;<span class="ident" id="6254924">p</span><span class="op" id="6254925">.</span><span class="ident" id="6254926">tok</span>&nbsp;<span class="op" id="6254930">==</span>&nbsp;<span class="ident" id="6254933">token</span><span class="op" id="6254938">.</span><span class="ident" id="6254939">LPAREN</span>&nbsp;<span class="op" id="6254946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254950">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6255013">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6255076">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255135">list</span>&nbsp;<span class="op" id="6255140">=</span>&nbsp;<span class="builtinfunc" id="6255142">append</span><span class="op" id="6255148">(</span><span class="ident" id="6255149">list</span><span class="op" id="6255153">,</span>&nbsp;<span class="ident" id="6255155">p</span><span class="op" id="6255156">.</span><span class="ident" id="6255157">parseFieldDecl</span><span class="op" id="6255171">(</span><span class="ident" id="6255172">scope</span><span class="op" id="6255177">)</span><span class="op" id="6255178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255184">rbrace</span>&nbsp;<span class="op" id="6255191">:=</span>&nbsp;<span class="ident" id="6255194">p</span><span class="op" id="6255195">.</span><span class="ident" id="6255196">expect</span><span class="op" id="6255202">(</span><span class="ident" id="6255203">token</span><span class="op" id="6255208">.</span><span class="ident" id="6255209">RBRACE</span><span class="op" id="6255215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255219">return</span>&nbsp;<span class="op" id="6255226">&amp;</span><span class="ident" id="6255227">ast</span><span class="op" id="6255230">.</span><span class="ident" id="6255231">StructType</span><span class="op" id="6255241">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255245">Struct</span><span class="op" id="6255251">:</span>&nbsp;<span class="ident" id="6255253">pos</span><span class="op" id="6255256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255260">Fields</span><span class="op" id="6255266">:</span>&nbsp;<span class="op" id="6255268">&amp;</span><span class="ident" id="6255269">ast</span><span class="op" id="6255272">.</span><span class="ident" id="6255273">FieldList</span><span class="op" id="6255282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255287">Opening</span><span class="op" id="6255294">:</span>&nbsp;<span class="ident" id="6255296">lbrace</span><span class="op" id="6255302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255307">List</span><span class="op" id="6255311">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255316">list</span><span class="op" id="6255320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255325">Closing</span><span class="op" id="6255332">:</span>&nbsp;<span class="ident" id="6255334">rbrace</span><span class="op" id="6255340">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255344">}</span><span class="op" id="6255345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255348">}</span><br>
<span class="lineno"></span><span class="op" id="6255350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6255353">func</span>&nbsp;<span class="op" id="6255358">(</span><span class="ident" id="6255359">p</span>&nbsp;<span class="op" id="6255361">*</span><span class="ident" id="6255362">parser</span><span class="op" id="6255368">)</span>&nbsp;<span class="ident" id="6255370">parsePointerType</span><span class="op" id="6255386">(</span><span class="op" id="6255387">)</span>&nbsp;<span class="op" id="6255389">*</span><span class="ident" id="6255390">ast</span><span class="op" id="6255393">.</span><span class="ident" id="6255394">StarExpr</span>&nbsp;<span class="op" id="6255403">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255406">if</span>&nbsp;<span class="ident" id="6255409">p</span><span class="op" id="6255410">.</span><span class="ident" id="6255411">trace</span>&nbsp;<span class="op" id="6255417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255421">defer</span>&nbsp;<span class="ident" id="6255427">un</span><span class="op" id="6255429">(</span><span class="ident" id="6255430">trace</span><span class="op" id="6255435">(</span><span class="ident" id="6255436">p</span><span class="op" id="6255437">,</span>&nbsp;<span class="string" id="6255439">&#34;PointerType&#34;</span><span class="op" id="6255452">)</span><span class="op" id="6255453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255460">star</span>&nbsp;<span class="op" id="6255465">:=</span>&nbsp;<span class="ident" id="6255468">p</span><span class="op" id="6255469">.</span><span class="ident" id="6255470">expect</span><span class="op" id="6255476">(</span><span class="ident" id="6255477">token</span><span class="op" id="6255482">.</span><span class="ident" id="6255483">MUL</span><span class="op" id="6255486">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255489">base</span>&nbsp;<span class="op" id="6255494">:=</span>&nbsp;<span class="ident" id="6255497">p</span><span class="op" id="6255498">.</span><span class="ident" id="6255499">parseType</span><span class="op" id="6255508">(</span><span class="op" id="6255509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255513">return</span>&nbsp;<span class="op" id="6255520">&amp;</span><span class="ident" id="6255521">ast</span><span class="op" id="6255524">.</span><span class="ident" id="6255525">StarExpr</span><span class="op" id="6255533">{</span><span class="ident" id="6255534">Star</span><span class="op" id="6255538">:</span>&nbsp;<span class="ident" id="6255540">star</span><span class="op" id="6255544">,</span>&nbsp;<span class="ident" id="6255546">X</span><span class="op" id="6255547">:</span>&nbsp;<span class="ident" id="6255549">base</span><span class="op" id="6255553">}</span><br>
<span class="lineno"></span><span class="op" id="6255555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="6255558">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6255613">func</span>&nbsp;<span class="op" id="6255618">(</span><span class="ident" id="6255619">p</span>&nbsp;<span class="op" id="6255621">*</span><span class="ident" id="6255622">parser</span><span class="op" id="6255628">)</span>&nbsp;<span class="ident" id="6255630">tryVarType</span><span class="op" id="6255640">(</span><span class="ident" id="6255641">isParam</span>&nbsp;<span class="builtintype" id="6255649">bool</span><span class="op" id="6255653">)</span>&nbsp;<span class="ident" id="6255655">ast</span><span class="op" id="6255658">.</span><span class="ident" id="6255659">Expr</span>&nbsp;<span class="op" id="6255664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255667">if</span>&nbsp;<span class="ident" id="6255670">isParam</span>&nbsp;<span class="op" id="6255678">&amp;&amp;</span>&nbsp;<span class="ident" id="6255681">p</span><span class="op" id="6255682">.</span><span class="ident" id="6255683">tok</span>&nbsp;<span class="op" id="6255687">==</span>&nbsp;<span class="ident" id="6255690">token</span><span class="op" id="6255695">.</span><span class="ident" id="6255696">ELLIPSIS</span>&nbsp;<span class="op" id="6255705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255709">pos</span>&nbsp;<span class="op" id="6255713">:=</span>&nbsp;<span class="ident" id="6255716">p</span><span class="op" id="6255717">.</span><span class="ident" id="6255718">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255724">p</span><span class="op" id="6255725">.</span><span class="ident" id="6255726">next</span><span class="op" id="6255730">(</span><span class="op" id="6255731">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255735">typ</span>&nbsp;<span class="op" id="6255739">:=</span>&nbsp;<span class="ident" id="6255742">p</span><span class="op" id="6255743">.</span><span class="ident" id="6255744">tryIdentOrType</span><span class="op" id="6255758">(</span><span class="op" id="6255759">)</span>&nbsp;<span class="comment" id="6255761">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255825">if</span>&nbsp;<span class="ident" id="6255828">typ</span>&nbsp;<span class="op" id="6255832">!=</span>&nbsp;<span class="ident" id="6255835">nil</span>&nbsp;<span class="op" id="6255839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255844">p</span><span class="op" id="6255845">.</span><span class="ident" id="6255846">resolve</span><span class="op" id="6255853">(</span><span class="ident" id="6255854">typ</span><span class="op" id="6255857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255861">}</span>&nbsp;<span class="keyword" id="6255863">else</span>&nbsp;<span class="op" id="6255868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255873">p</span><span class="op" id="6255874">.</span><span class="builtintype" id="6255875">error</span><span class="op" id="6255880">(</span><span class="ident" id="6255881">pos</span><span class="op" id="6255884">,</span>&nbsp;<span class="string" id="6255886">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="6255919">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255924">typ</span>&nbsp;<span class="op" id="6255928">=</span>&nbsp;<span class="op" id="6255930">&amp;</span><span class="ident" id="6255931">ast</span><span class="op" id="6255934">.</span><span class="ident" id="6255935">BadExpr</span><span class="op" id="6255942">{</span><span class="ident" id="6255943">From</span><span class="op" id="6255947">:</span>&nbsp;<span class="ident" id="6255949">pos</span><span class="op" id="6255952">,</span>&nbsp;<span class="ident" id="6255954">To</span><span class="op" id="6255956">:</span>&nbsp;<span class="ident" id="6255958">p</span><span class="op" id="6255959">.</span><span class="ident" id="6255960">pos</span><span class="op" id="6255963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255971">return</span>&nbsp;<span class="op" id="6255978">&amp;</span><span class="ident" id="6255979">ast</span><span class="op" id="6255982">.</span><span class="ident" id="6255983">Ellipsis</span><span class="op" id="6255991">{</span><span class="ident" id="6255992">Ellipsis</span><span class="op" id="6256000">:</span>&nbsp;<span class="ident" id="6256002">pos</span><span class="op" id="6256005">,</span>&nbsp;<span class="ident" id="6256007">Elt</span><span class="op" id="6256010">:</span>&nbsp;<span class="ident" id="6256012">typ</span><span class="op" id="6256015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256021">return</span>&nbsp;<span class="ident" id="6256028">p</span><span class="op" id="6256029">.</span><span class="ident" id="6256030">tryIdentOrType</span><span class="op" id="6256044">(</span><span class="op" id="6256045">)</span><br>
<span class="lineno">770</span><span class="op" id="6256047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6256050">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6256105">func</span>&nbsp;<span class="op" id="6256110">(</span><span class="ident" id="6256111">p</span>&nbsp;<span class="op" id="6256113">*</span><span class="ident" id="6256114">parser</span><span class="op" id="6256120">)</span>&nbsp;<span class="ident" id="6256122">parseVarType</span><span class="op" id="6256134">(</span><span class="ident" id="6256135">isParam</span>&nbsp;<span class="builtintype" id="6256143">bool</span><span class="op" id="6256147">)</span>&nbsp;<span class="ident" id="6256149">ast</span><span class="op" id="6256152">.</span><span class="ident" id="6256153">Expr</span>&nbsp;<span class="op" id="6256158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256161">typ</span>&nbsp;<span class="op" id="6256165">:=</span>&nbsp;<span class="ident" id="6256168">p</span><span class="op" id="6256169">.</span><span class="ident" id="6256170">tryVarType</span><span class="op" id="6256180">(</span><span class="ident" id="6256181">isParam</span><span class="op" id="6256188">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256191">if</span>&nbsp;<span class="ident" id="6256194">typ</span>&nbsp;<span class="op" id="6256198">==</span>&nbsp;<span class="ident" id="6256201">nil</span>&nbsp;<span class="op" id="6256205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256209">pos</span>&nbsp;<span class="op" id="6256213">:=</span>&nbsp;<span class="ident" id="6256216">p</span><span class="op" id="6256217">.</span><span class="ident" id="6256218">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256224">p</span><span class="op" id="6256225">.</span><span class="ident" id="6256226">errorExpected</span><span class="op" id="6256239">(</span><span class="ident" id="6256240">pos</span><span class="op" id="6256243">,</span>&nbsp;<span class="string" id="6256245">&#34;type&#34;</span><span class="op" id="6256251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256255">p</span><span class="op" id="6256256">.</span><span class="ident" id="6256257">next</span><span class="op" id="6256261">(</span><span class="op" id="6256262">)</span>&nbsp;<span class="comment" id="6256264">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256283">typ</span>&nbsp;<span class="op" id="6256287">=</span>&nbsp;<span class="op" id="6256289">&amp;</span><span class="ident" id="6256290">ast</span><span class="op" id="6256293">.</span><span class="ident" id="6256294">BadExpr</span><span class="op" id="6256301">{</span><span class="ident" id="6256302">From</span><span class="op" id="6256306">:</span>&nbsp;<span class="ident" id="6256308">pos</span><span class="op" id="6256311">,</span>&nbsp;<span class="ident" id="6256313">To</span><span class="op" id="6256315">:</span>&nbsp;<span class="ident" id="6256317">p</span><span class="op" id="6256318">.</span><span class="ident" id="6256319">pos</span><span class="op" id="6256322">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256328">return</span>&nbsp;<span class="ident" id="6256335">typ</span><br>
<span class="lineno"></span><span class="op" id="6256339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6256342">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="6256407">func</span>&nbsp;<span class="op" id="6256412">(</span><span class="ident" id="6256413">p</span>&nbsp;<span class="op" id="6256415">*</span><span class="ident" id="6256416">parser</span><span class="op" id="6256422">)</span>&nbsp;<span class="ident" id="6256424">parseVarList</span><span class="op" id="6256436">(</span><span class="ident" id="6256437">isParam</span>&nbsp;<span class="builtintype" id="6256445">bool</span><span class="op" id="6256449">)</span>&nbsp;<span class="op" id="6256451">(</span><span class="ident" id="6256452">list</span>&nbsp;<span class="op" id="6256457">[</span><span class="op" id="6256458">]</span><span class="ident" id="6256459">ast</span><span class="op" id="6256462">.</span><span class="ident" id="6256463">Expr</span><span class="op" id="6256467">,</span>&nbsp;<span class="ident" id="6256469">typ</span>&nbsp;<span class="ident" id="6256473">ast</span><span class="op" id="6256476">.</span><span class="ident" id="6256477">Expr</span><span class="op" id="6256481">)</span>&nbsp;<span class="op" id="6256483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256486">if</span>&nbsp;<span class="ident" id="6256489">p</span><span class="op" id="6256490">.</span><span class="ident" id="6256491">trace</span>&nbsp;<span class="op" id="6256497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256501">defer</span>&nbsp;<span class="ident" id="6256507">un</span><span class="op" id="6256509">(</span><span class="ident" id="6256510">trace</span><span class="op" id="6256515">(</span><span class="ident" id="6256516">p</span><span class="op" id="6256517">,</span>&nbsp;<span class="string" id="6256519">&#34;VarList&#34;</span><span class="op" id="6256528">)</span><span class="op" id="6256529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256536">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256594">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256598">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256661">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256724">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256787">for</span>&nbsp;<span class="ident" id="6256791">typ</span>&nbsp;<span class="op" id="6256795">:=</span>&nbsp;<span class="ident" id="6256798">p</span><span class="op" id="6256799">.</span><span class="ident" id="6256800">parseVarType</span><span class="op" id="6256812">(</span><span class="ident" id="6256813">isParam</span><span class="op" id="6256820">)</span><span class="op" id="6256821">;</span>&nbsp;<span class="ident" id="6256823">typ</span>&nbsp;<span class="op" id="6256827">!=</span>&nbsp;<span class="ident" id="6256830">nil</span><span class="op" id="6256833">;</span>&nbsp;<span class="op" id="6256835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256839">list</span>&nbsp;<span class="op" id="6256844">=</span>&nbsp;<span class="builtinfunc" id="6256846">append</span><span class="op" id="6256852">(</span><span class="ident" id="6256853">list</span><span class="op" id="6256857">,</span>&nbsp;<span class="ident" id="6256859">typ</span><span class="op" id="6256862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256866">if</span>&nbsp;<span class="ident" id="6256869">p</span><span class="op" id="6256870">.</span><span class="ident" id="6256871">tok</span>&nbsp;<span class="op" id="6256875">!=</span>&nbsp;<span class="ident" id="6256878">token</span><span class="op" id="6256883">.</span><span class="ident" id="6256884">COMMA</span>&nbsp;<span class="op" id="6256890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256895">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256903">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256907">p</span><span class="op" id="6256908">.</span><span class="ident" id="6256909">next</span><span class="op" id="6256913">(</span><span class="op" id="6256914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256918">typ</span>&nbsp;<span class="op" id="6256922">=</span>&nbsp;<span class="ident" id="6256924">p</span><span class="op" id="6256925">.</span><span class="ident" id="6256926">tryVarType</span><span class="op" id="6256936">(</span><span class="ident" id="6256937">isParam</span><span class="op" id="6256944">)</span>&nbsp;<span class="comment" id="6256946">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256987">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257054">typ</span>&nbsp;<span class="op" id="6257058">=</span>&nbsp;<span class="ident" id="6257060">p</span><span class="op" id="6257061">.</span><span class="ident" id="6257062">tryVarType</span><span class="op" id="6257072">(</span><span class="ident" id="6257073">isParam</span><span class="op" id="6257080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257084">return</span><br>
<span class="lineno"></span><span class="op" id="6257091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="6257094">func</span>&nbsp;<span class="op" id="6257099">(</span><span class="ident" id="6257100">p</span>&nbsp;<span class="op" id="6257102">*</span><span class="ident" id="6257103">parser</span><span class="op" id="6257109">)</span>&nbsp;<span class="ident" id="6257111">parseParameterList</span><span class="op" id="6257129">(</span><span class="ident" id="6257130">scope</span>&nbsp;<span class="op" id="6257136">*</span><span class="ident" id="6257137">ast</span><span class="op" id="6257140">.</span><span class="ident" id="6257141">Scope</span><span class="op" id="6257146">,</span>&nbsp;<span class="ident" id="6257148">ellipsisOk</span>&nbsp;<span class="builtintype" id="6257159">bool</span><span class="op" id="6257163">)</span>&nbsp;<span class="op" id="6257165">(</span><span class="ident" id="6257166">params</span>&nbsp;<span class="op" id="6257173">[</span><span class="op" id="6257174">]</span><span class="op" id="6257175">*</span><span class="ident" id="6257176">ast</span><span class="op" id="6257179">.</span><span class="ident" id="6257180">Field</span><span class="op" id="6257185">)</span>&nbsp;<span class="op" id="6257187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257190">if</span>&nbsp;<span class="ident" id="6257193">p</span><span class="op" id="6257194">.</span><span class="ident" id="6257195">trace</span>&nbsp;<span class="op" id="6257201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257205">defer</span>&nbsp;<span class="ident" id="6257211">un</span><span class="op" id="6257213">(</span><span class="ident" id="6257214">trace</span><span class="op" id="6257219">(</span><span class="ident" id="6257220">p</span><span class="op" id="6257221">,</span>&nbsp;<span class="string" id="6257223">&#34;ParameterList&#34;</span><span class="op" id="6257238">)</span><span class="op" id="6257239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257246">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257264">list</span><span class="op" id="6257268">,</span>&nbsp;<span class="ident" id="6257270">typ</span>&nbsp;<span class="op" id="6257274">:=</span>&nbsp;<span class="ident" id="6257277">p</span><span class="op" id="6257278">.</span><span class="ident" id="6257279">parseVarList</span><span class="op" id="6257291">(</span><span class="ident" id="6257292">ellipsisOk</span><span class="op" id="6257302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257306">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257323">if</span>&nbsp;<span class="ident" id="6257326">typ</span>&nbsp;<span class="op" id="6257330">!=</span>&nbsp;<span class="ident" id="6257333">nil</span>&nbsp;<span class="op" id="6257337">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257341">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257366">idents</span>&nbsp;<span class="op" id="6257373">:=</span>&nbsp;<span class="ident" id="6257376">p</span><span class="op" id="6257377">.</span><span class="ident" id="6257378">makeIdentList</span><span class="op" id="6257391">(</span><span class="ident" id="6257392">list</span><span class="op" id="6257396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257400">field</span>&nbsp;<span class="op" id="6257406">:=</span>&nbsp;<span class="op" id="6257409">&amp;</span><span class="ident" id="6257410">ast</span><span class="op" id="6257413">.</span><span class="ident" id="6257414">Field</span><span class="op" id="6257419">{</span><span class="ident" id="6257420">Names</span><span class="op" id="6257425">:</span>&nbsp;<span class="ident" id="6257427">idents</span><span class="op" id="6257433">,</span>&nbsp;<span class="ident" id="6257435">Type</span><span class="op" id="6257439">:</span>&nbsp;<span class="ident" id="6257441">typ</span><span class="op" id="6257444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257448">params</span>&nbsp;<span class="op" id="6257455">=</span>&nbsp;<span class="builtinfunc" id="6257457">append</span><span class="op" id="6257463">(</span><span class="ident" id="6257464">params</span><span class="op" id="6257470">,</span>&nbsp;<span class="ident" id="6257472">field</span><span class="op" id="6257477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257481">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257542">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257598">p</span><span class="op" id="6257599">.</span><span class="ident" id="6257600">declare</span><span class="op" id="6257607">(</span><span class="ident" id="6257608">field</span><span class="op" id="6257613">,</span>&nbsp;<span class="ident" id="6257615">nil</span><span class="op" id="6257618">,</span>&nbsp;<span class="ident" id="6257620">scope</span><span class="op" id="6257625">,</span>&nbsp;<span class="ident" id="6257627">ast</span><span class="op" id="6257630">.</span><span class="ident" id="6257631">Var</span><span class="op" id="6257634">,</span>&nbsp;<span class="ident" id="6257636">idents</span><span class="op" id="6257642">...</span><span class="op" id="6257645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257649">p</span><span class="op" id="6257650">.</span><span class="ident" id="6257651">resolve</span><span class="op" id="6257658">(</span><span class="ident" id="6257659">typ</span><span class="op" id="6257662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257666">if</span>&nbsp;<span class="op" id="6257669">!</span><span class="ident" id="6257670">p</span><span class="op" id="6257671">.</span><span class="ident" id="6257672">atComma</span><span class="op" id="6257679">(</span><span class="string" id="6257680">&#34;parameter&nbsp;list&#34;</span><span class="op" id="6257696">)</span>&nbsp;<span class="op" id="6257698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257703">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257716">p</span><span class="op" id="6257717">.</span><span class="ident" id="6257718">next</span><span class="op" id="6257722">(</span><span class="op" id="6257723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257727">for</span>&nbsp;<span class="ident" id="6257731">p</span><span class="op" id="6257732">.</span><span class="ident" id="6257733">tok</span>&nbsp;<span class="op" id="6257737">!=</span>&nbsp;<span class="ident" id="6257740">token</span><span class="op" id="6257745">.</span><span class="ident" id="6257746">RPAREN</span>&nbsp;<span class="op" id="6257753">&amp;&amp;</span>&nbsp;<span class="ident" id="6257756">p</span><span class="op" id="6257757">.</span><span class="ident" id="6257758">tok</span>&nbsp;<span class="op" id="6257762">!=</span>&nbsp;<span class="ident" id="6257765">token</span><span class="op" id="6257770">.</span><span class="ident" id="6257771">EOF</span>&nbsp;<span class="op" id="6257775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257780">idents</span>&nbsp;<span class="op" id="6257787">:=</span>&nbsp;<span class="ident" id="6257790">p</span><span class="op" id="6257791">.</span><span class="ident" id="6257792">parseIdentList</span><span class="op" id="6257806">(</span><span class="op" id="6257807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257812">typ</span>&nbsp;<span class="op" id="6257816">:=</span>&nbsp;<span class="ident" id="6257819">p</span><span class="op" id="6257820">.</span><span class="ident" id="6257821">parseVarType</span><span class="op" id="6257833">(</span><span class="ident" id="6257834">ellipsisOk</span><span class="op" id="6257844">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257849">field</span>&nbsp;<span class="op" id="6257855">:=</span>&nbsp;<span class="op" id="6257858">&amp;</span><span class="ident" id="6257859">ast</span><span class="op" id="6257862">.</span><span class="ident" id="6257863">Field</span><span class="op" id="6257868">{</span><span class="ident" id="6257869">Names</span><span class="op" id="6257874">:</span>&nbsp;<span class="ident" id="6257876">idents</span><span class="op" id="6257882">,</span>&nbsp;<span class="ident" id="6257884">Type</span><span class="op" id="6257888">:</span>&nbsp;<span class="ident" id="6257890">typ</span><span class="op" id="6257893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257898">params</span>&nbsp;<span class="op" id="6257905">=</span>&nbsp;<span class="builtinfunc" id="6257907">append</span><span class="op" id="6257913">(</span><span class="ident" id="6257914">params</span><span class="op" id="6257920">,</span>&nbsp;<span class="ident" id="6257922">field</span><span class="op" id="6257927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257932">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257994">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258051">p</span><span class="op" id="6258052">.</span><span class="ident" id="6258053">declare</span><span class="op" id="6258060">(</span><span class="ident" id="6258061">field</span><span class="op" id="6258066">,</span>&nbsp;<span class="ident" id="6258068">nil</span><span class="op" id="6258071">,</span>&nbsp;<span class="ident" id="6258073">scope</span><span class="op" id="6258078">,</span>&nbsp;<span class="ident" id="6258080">ast</span><span class="op" id="6258083">.</span><span class="ident" id="6258084">Var</span><span class="op" id="6258087">,</span>&nbsp;<span class="ident" id="6258089">idents</span><span class="op" id="6258095">...</span><span class="op" id="6258098">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258103">p</span><span class="op" id="6258104">.</span><span class="ident" id="6258105">resolve</span><span class="op" id="6258112">(</span><span class="ident" id="6258113">typ</span><span class="op" id="6258116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258121">if</span>&nbsp;<span class="op" id="6258124">!</span><span class="ident" id="6258125">p</span><span class="op" id="6258126">.</span><span class="ident" id="6258127">atComma</span><span class="op" id="6258134">(</span><span class="string" id="6258135">&#34;parameter&nbsp;list&#34;</span><span class="op" id="6258151">)</span>&nbsp;<span class="op" id="6258153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258159">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258173">p</span><span class="op" id="6258174">.</span><span class="ident" id="6258175">next</span><span class="op" id="6258179">(</span><span class="op" id="6258180">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258200">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258245">params</span>&nbsp;<span class="op" id="6258252">=</span>&nbsp;<span class="builtinfunc" id="6258254">make</span><span class="op" id="6258258">(</span><span class="op" id="6258259">[</span><span class="op" id="6258260">]</span><span class="op" id="6258261">*</span><span class="ident" id="6258262">ast</span><span class="op" id="6258265">.</span><span class="ident" id="6258266">Field</span><span class="op" id="6258271">,</span>&nbsp;<span class="builtinfunc" id="6258273">len</span><span class="op" id="6258276">(</span><span class="ident" id="6258277">list</span><span class="op" id="6258281">)</span><span class="op" id="6258282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258285">for</span>&nbsp;<span class="ident" id="6258289">i</span><span class="op" id="6258290">,</span>&nbsp;<span class="ident" id="6258292">typ</span>&nbsp;<span class="op" id="6258296">:=</span>&nbsp;<span class="keyword" id="6258299">range</span>&nbsp;<span class="ident" id="6258305">list</span>&nbsp;<span class="op" id="6258310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258314">p</span><span class="op" id="6258315">.</span><span class="ident" id="6258316">resolve</span><span class="op" id="6258323">(</span><span class="ident" id="6258324">typ</span><span class="op" id="6258327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258331">params</span><span class="op" id="6258337">[</span><span class="ident" id="6258338">i</span><span class="op" id="6258339">]</span>&nbsp;<span class="op" id="6258341">=</span>&nbsp;<span class="op" id="6258343">&amp;</span><span class="ident" id="6258344">ast</span><span class="op" id="6258347">.</span><span class="ident" id="6258348">Field</span><span class="op" id="6258353">{</span><span class="ident" id="6258354">Type</span><span class="op" id="6258358">:</span>&nbsp;<span class="ident" id="6258360">typ</span><span class="op" id="6258363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258366">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258369">return</span><br>
<span class="lineno"></span><span class="op" id="6258376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6258379">func</span>&nbsp;<span class="op" id="6258384">(</span><span class="ident" id="6258385">p</span>&nbsp;<span class="op" id="6258387">*</span><span class="ident" id="6258388">parser</span><span class="op" id="6258394">)</span>&nbsp;<span class="ident" id="6258396">parseParameters</span><span class="op" id="6258411">(</span><span class="ident" id="6258412">scope</span>&nbsp;<span class="op" id="6258418">*</span><span class="ident" id="6258419">ast</span><span class="op" id="6258422">.</span><span class="ident" id="6258423">Scope</span><span class="op" id="6258428">,</span>&nbsp;<span class="ident" id="6258430">ellipsisOk</span>&nbsp;<span class="builtintype" id="6258441">bool</span><span class="op" id="6258445">)</span>&nbsp;<span class="op" id="6258447">*</span><span class="ident" id="6258448">ast</span><span class="op" id="6258451">.</span><span class="ident" id="6258452">FieldList</span>&nbsp;<span class="op" id="6258462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258465">if</span>&nbsp;<span class="ident" id="6258468">p</span><span class="op" id="6258469">.</span><span class="ident" id="6258470">trace</span>&nbsp;<span class="op" id="6258476">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258480">defer</span>&nbsp;<span class="ident" id="6258486">un</span><span class="op" id="6258488">(</span><span class="ident" id="6258489">trace</span><span class="op" id="6258494">(</span><span class="ident" id="6258495">p</span><span class="op" id="6258496">,</span>&nbsp;<span class="string" id="6258498">&#34;Parameters&#34;</span><span class="op" id="6258510">)</span><span class="op" id="6258511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258518">var</span>&nbsp;<span class="ident" id="6258522">params</span>&nbsp;<span class="op" id="6258529">[</span><span class="op" id="6258530">]</span><span class="op" id="6258531">*</span><span class="ident" id="6258532">ast</span><span class="op" id="6258535">.</span><span class="ident" id="6258536">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258543">lparen</span>&nbsp;<span class="op" id="6258550">:=</span>&nbsp;<span class="ident" id="6258553">p</span><span class="op" id="6258554">.</span><span class="ident" id="6258555">expect</span><span class="op" id="6258561">(</span><span class="ident" id="6258562">token</span><span class="op" id="6258567">.</span><span class="ident" id="6258568">LPAREN</span><span class="op" id="6258574">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258577">if</span>&nbsp;<span class="ident" id="6258580">p</span><span class="op" id="6258581">.</span><span class="ident" id="6258582">tok</span>&nbsp;<span class="op" id="6258586">!=</span>&nbsp;<span class="ident" id="6258589">token</span><span class="op" id="6258594">.</span><span class="ident" id="6258595">RPAREN</span>&nbsp;<span class="op" id="6258602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258606">params</span>&nbsp;<span class="op" id="6258613">=</span>&nbsp;<span class="ident" id="6258615">p</span><span class="op" id="6258616">.</span><span class="ident" id="6258617">parseParameterList</span><span class="op" id="6258635">(</span><span class="ident" id="6258636">scope</span><span class="op" id="6258641">,</span>&nbsp;<span class="ident" id="6258643">ellipsisOk</span><span class="op" id="6258653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258659">rparen</span>&nbsp;<span class="op" id="6258666">:=</span>&nbsp;<span class="ident" id="6258669">p</span><span class="op" id="6258670">.</span><span class="ident" id="6258671">expect</span><span class="op" id="6258677">(</span><span class="ident" id="6258678">token</span><span class="op" id="6258683">.</span><span class="ident" id="6258684">RPAREN</span><span class="op" id="6258690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258694">return</span>&nbsp;<span class="op" id="6258701">&amp;</span><span class="ident" id="6258702">ast</span><span class="op" id="6258705">.</span><span class="ident" id="6258706">FieldList</span><span class="op" id="6258715">{</span><span class="ident" id="6258716">Opening</span><span class="op" id="6258723">:</span>&nbsp;<span class="ident" id="6258725">lparen</span><span class="op" id="6258731">,</span>&nbsp;<span class="ident" id="6258733">List</span><span class="op" id="6258737">:</span>&nbsp;<span class="ident" id="6258739">params</span><span class="op" id="6258745">,</span>&nbsp;<span class="ident" id="6258747">Closing</span><span class="op" id="6258754">:</span>&nbsp;<span class="ident" id="6258756">rparen</span><span class="op" id="6258762">}</span><br>
<span class="lineno"></span><span class="op" id="6258764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6258767">func</span>&nbsp;<span class="op" id="6258772">(</span><span class="ident" id="6258773">p</span>&nbsp;<span class="op" id="6258775">*</span><span class="ident" id="6258776">parser</span><span class="op" id="6258782">)</span>&nbsp;<span class="ident" id="6258784">parseResult</span><span class="op" id="6258795">(</span><span class="ident" id="6258796">scope</span>&nbsp;<span class="op" id="6258802">*</span><span class="ident" id="6258803">ast</span><span class="op" id="6258806">.</span><span class="ident" id="6258807">Scope</span><span class="op" id="6258812">)</span>&nbsp;<span class="op" id="6258814">*</span><span class="ident" id="6258815">ast</span><span class="op" id="6258818">.</span><span class="ident" id="6258819">FieldList</span>&nbsp;<span class="op" id="6258829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258832">if</span>&nbsp;<span class="ident" id="6258835">p</span><span class="op" id="6258836">.</span><span class="ident" id="6258837">trace</span>&nbsp;<span class="op" id="6258843">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258847">defer</span>&nbsp;<span class="ident" id="6258853">un</span><span class="op" id="6258855">(</span><span class="ident" id="6258856">trace</span><span class="op" id="6258861">(</span><span class="ident" id="6258862">p</span><span class="op" id="6258863">,</span>&nbsp;<span class="string" id="6258865">&#34;Result&#34;</span><span class="op" id="6258873">)</span><span class="op" id="6258874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258881">if</span>&nbsp;<span class="ident" id="6258884">p</span><span class="op" id="6258885">.</span><span class="ident" id="6258886">tok</span>&nbsp;<span class="op" id="6258890">==</span>&nbsp;<span class="ident" id="6258893">token</span><span class="op" id="6258898">.</span><span class="ident" id="6258899">LPAREN</span>&nbsp;<span class="op" id="6258906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258910">return</span>&nbsp;<span class="ident" id="6258917">p</span><span class="op" id="6258918">.</span><span class="ident" id="6258919">parseParameters</span><span class="op" id="6258934">(</span><span class="ident" id="6258935">scope</span><span class="op" id="6258940">,</span>&nbsp;<span class="builtintype" id="6258942">false</span><span class="op" id="6258947">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258954">typ</span>&nbsp;<span class="op" id="6258958">:=</span>&nbsp;<span class="ident" id="6258961">p</span><span class="op" id="6258962">.</span><span class="ident" id="6258963">tryType</span><span class="op" id="6258970">(</span><span class="op" id="6258971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258974">if</span>&nbsp;<span class="ident" id="6258977">typ</span>&nbsp;<span class="op" id="6258981">!=</span>&nbsp;<span class="ident" id="6258984">nil</span>&nbsp;<span class="op" id="6258988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258992">list</span>&nbsp;<span class="op" id="6258997">:=</span>&nbsp;<span class="builtinfunc" id="6259000">make</span><span class="op" id="6259004">(</span><span class="op" id="6259005">[</span><span class="op" id="6259006">]</span><span class="op" id="6259007">*</span><span class="ident" id="6259008">ast</span><span class="op" id="6259011">.</span><span class="ident" id="6259012">Field</span><span class="op" id="6259017">,</span>&nbsp;<span class="num" id="6259019">1</span><span class="op" id="6259020">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259024">list</span><span class="op" id="6259028">[</span><span class="num" id="6259029">0</span><span class="op" id="6259030">]</span>&nbsp;<span class="op" id="6259032">=</span>&nbsp;<span class="op" id="6259034">&amp;</span><span class="ident" id="6259035">ast</span><span class="op" id="6259038">.</span><span class="ident" id="6259039">Field</span><span class="op" id="6259044">{</span><span class="ident" id="6259045">Type</span><span class="op" id="6259049">:</span>&nbsp;<span class="ident" id="6259051">typ</span><span class="op" id="6259054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259058">return</span>&nbsp;<span class="op" id="6259065">&amp;</span><span class="ident" id="6259066">ast</span><span class="op" id="6259069">.</span><span class="ident" id="6259070">FieldList</span><span class="op" id="6259079">{</span><span class="ident" id="6259080">List</span><span class="op" id="6259084">:</span>&nbsp;<span class="ident" id="6259086">list</span><span class="op" id="6259090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259097">return</span>&nbsp;<span class="ident" id="6259104">nil</span><br>
<span class="lineno">890</span><span class="op" id="6259108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6259111">func</span>&nbsp;<span class="op" id="6259116">(</span><span class="ident" id="6259117">p</span>&nbsp;<span class="op" id="6259119">*</span><span class="ident" id="6259120">parser</span><span class="op" id="6259126">)</span>&nbsp;<span class="ident" id="6259128">parseSignature</span><span class="op" id="6259142">(</span><span class="ident" id="6259143">scope</span>&nbsp;<span class="op" id="6259149">*</span><span class="ident" id="6259150">ast</span><span class="op" id="6259153">.</span><span class="ident" id="6259154">Scope</span><span class="op" id="6259159">)</span>&nbsp;<span class="op" id="6259161">(</span><span class="ident" id="6259162">params</span><span class="op" id="6259168">,</span>&nbsp;<span class="ident" id="6259170">results</span>&nbsp;<span class="op" id="6259178">*</span><span class="ident" id="6259179">ast</span><span class="op" id="6259182">.</span><span class="ident" id="6259183">FieldList</span><span class="op" id="6259192">)</span>&nbsp;<span class="op" id="6259194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259197">if</span>&nbsp;<span class="ident" id="6259200">p</span><span class="op" id="6259201">.</span><span class="ident" id="6259202">trace</span>&nbsp;<span class="op" id="6259208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259212">defer</span>&nbsp;<span class="ident" id="6259218">un</span><span class="op" id="6259220">(</span><span class="ident" id="6259221">trace</span><span class="op" id="6259226">(</span><span class="ident" id="6259227">p</span><span class="op" id="6259228">,</span>&nbsp;<span class="string" id="6259230">&#34;Signature&#34;</span><span class="op" id="6259241">)</span><span class="op" id="6259242">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259249">params</span>&nbsp;<span class="op" id="6259256">=</span>&nbsp;<span class="ident" id="6259258">p</span><span class="op" id="6259259">.</span><span class="ident" id="6259260">parseParameters</span><span class="op" id="6259275">(</span><span class="ident" id="6259276">scope</span><span class="op" id="6259281">,</span>&nbsp;<span class="builtintype" id="6259283">true</span><span class="op" id="6259287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259290">results</span>&nbsp;<span class="op" id="6259298">=</span>&nbsp;<span class="ident" id="6259300">p</span><span class="op" id="6259301">.</span><span class="ident" id="6259302">parseResult</span><span class="op" id="6259313">(</span><span class="ident" id="6259314">scope</span><span class="op" id="6259319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259323">return</span><br>
<span class="lineno"></span><span class="op" id="6259330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6259333">func</span>&nbsp;<span class="op" id="6259338">(</span><span class="ident" id="6259339">p</span>&nbsp;<span class="op" id="6259341">*</span><span class="ident" id="6259342">parser</span><span class="op" id="6259348">)</span>&nbsp;<span class="ident" id="6259350">parseFuncType</span><span class="op" id="6259363">(</span><span class="op" id="6259364">)</span>&nbsp;<span class="op" id="6259366">(</span><span class="op" id="6259367">*</span><span class="ident" id="6259368">ast</span><span class="op" id="6259371">.</span><span class="ident" id="6259372">FuncType</span><span class="op" id="6259380">,</span>&nbsp;<span class="op" id="6259382">*</span><span class="ident" id="6259383">ast</span><span class="op" id="6259386">.</span><span class="ident" id="6259387">Scope</span><span class="op" id="6259392">)</span>&nbsp;<span class="op" id="6259394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259397">if</span>&nbsp;<span class="ident" id="6259400">p</span><span class="op" id="6259401">.</span><span class="ident" id="6259402">trace</span>&nbsp;<span class="op" id="6259408">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259412">defer</span>&nbsp;<span class="ident" id="6259418">un</span><span class="op" id="6259420">(</span><span class="ident" id="6259421">trace</span><span class="op" id="6259426">(</span><span class="ident" id="6259427">p</span><span class="op" id="6259428">,</span>&nbsp;<span class="string" id="6259430">&#34;FuncType&#34;</span><span class="op" id="6259440">)</span><span class="op" id="6259441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259448">pos</span>&nbsp;<span class="op" id="6259452">:=</span>&nbsp;<span class="ident" id="6259455">p</span><span class="op" id="6259456">.</span><span class="ident" id="6259457">expect</span><span class="op" id="6259463">(</span><span class="ident" id="6259464">token</span><span class="op" id="6259469">.</span><span class="ident" id="6259470">FUNC</span><span class="op" id="6259474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259477">scope</span>&nbsp;<span class="op" id="6259483">:=</span>&nbsp;<span class="ident" id="6259486">ast</span><span class="op" id="6259489">.</span><span class="ident" id="6259490">NewScope</span><span class="op" id="6259498">(</span><span class="ident" id="6259499">p</span><span class="op" id="6259500">.</span><span class="ident" id="6259501">topScope</span><span class="op" id="6259509">)</span>&nbsp;<span class="comment" id="6259511">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259530">params</span><span class="op" id="6259536">,</span>&nbsp;<span class="ident" id="6259538">results</span>&nbsp;<span class="op" id="6259546">:=</span>&nbsp;<span class="ident" id="6259549">p</span><span class="op" id="6259550">.</span><span class="ident" id="6259551">parseSignature</span><span class="op" id="6259565">(</span><span class="ident" id="6259566">scope</span><span class="op" id="6259571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259575">return</span>&nbsp;<span class="op" id="6259582">&amp;</span><span class="ident" id="6259583">ast</span><span class="op" id="6259586">.</span><span class="ident" id="6259587">FuncType</span><span class="op" id="6259595">{</span><span class="ident" id="6259596">Func</span><span class="op" id="6259600">:</span>&nbsp;<span class="ident" id="6259602">pos</span><span class="op" id="6259605">,</span>&nbsp;<span class="ident" id="6259607">Params</span><span class="op" id="6259613">:</span>&nbsp;<span class="ident" id="6259615">params</span><span class="op" id="6259621">,</span>&nbsp;<span class="ident" id="6259623">Results</span><span class="op" id="6259630">:</span>&nbsp;<span class="ident" id="6259632">results</span><span class="op" id="6259639">}</span><span class="op" id="6259640">,</span>&nbsp;<span class="ident" id="6259642">scope</span><br>
<span class="lineno"></span><span class="op" id="6259648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="6259651">func</span>&nbsp;<span class="op" id="6259656">(</span><span class="ident" id="6259657">p</span>&nbsp;<span class="op" id="6259659">*</span><span class="ident" id="6259660">parser</span><span class="op" id="6259666">)</span>&nbsp;<span class="ident" id="6259668">parseMethodSpec</span><span class="op" id="6259683">(</span><span class="ident" id="6259684">scope</span>&nbsp;<span class="op" id="6259690">*</span><span class="ident" id="6259691">ast</span><span class="op" id="6259694">.</span><span class="ident" id="6259695">Scope</span><span class="op" id="6259700">)</span>&nbsp;<span class="op" id="6259702">*</span><span class="ident" id="6259703">ast</span><span class="op" id="6259706">.</span><span class="ident" id="6259707">Field</span>&nbsp;<span class="op" id="6259713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259716">if</span>&nbsp;<span class="ident" id="6259719">p</span><span class="op" id="6259720">.</span><span class="ident" id="6259721">trace</span>&nbsp;<span class="op" id="6259727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259731">defer</span>&nbsp;<span class="ident" id="6259737">un</span><span class="op" id="6259739">(</span><span class="ident" id="6259740">trace</span><span class="op" id="6259745">(</span><span class="ident" id="6259746">p</span><span class="op" id="6259747">,</span>&nbsp;<span class="string" id="6259749">&#34;MethodSpec&#34;</span><span class="op" id="6259761">)</span><span class="op" id="6259762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259769">doc</span>&nbsp;<span class="op" id="6259773">:=</span>&nbsp;<span class="ident" id="6259776">p</span><span class="op" id="6259777">.</span><span class="ident" id="6259778">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259791">var</span>&nbsp;<span class="ident" id="6259795">idents</span>&nbsp;<span class="op" id="6259802">[</span><span class="op" id="6259803">]</span><span class="op" id="6259804">*</span><span class="ident" id="6259805">ast</span><span class="op" id="6259808">.</span><span class="ident" id="6259809">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259816">var</span>&nbsp;<span class="ident" id="6259820">typ</span>&nbsp;<span class="ident" id="6259824">ast</span><span class="op" id="6259827">.</span><span class="ident" id="6259828">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259834">x</span>&nbsp;<span class="op" id="6259836">:=</span>&nbsp;<span class="ident" id="6259839">p</span><span class="op" id="6259840">.</span><span class="ident" id="6259841">parseTypeName</span><span class="op" id="6259854">(</span><span class="op" id="6259855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259858">if</span>&nbsp;<span class="ident" id="6259861">ident</span><span class="op" id="6259866">,</span>&nbsp;<span class="ident" id="6259868">isIdent</span>&nbsp;<span class="op" id="6259876">:=</span>&nbsp;<span class="ident" id="6259879">x</span><span class="op" id="6259880">.</span><span class="op" id="6259881">(</span><span class="op" id="6259882">*</span><span class="ident" id="6259883">ast</span><span class="op" id="6259886">.</span><span class="ident" id="6259887">Ident</span><span class="op" id="6259892">)</span><span class="op" id="6259893">;</span>&nbsp;<span class="ident" id="6259895">isIdent</span>&nbsp;<span class="op" id="6259903">&amp;&amp;</span>&nbsp;<span class="ident" id="6259906">p</span><span class="op" id="6259907">.</span><span class="ident" id="6259908">tok</span>&nbsp;<span class="op" id="6259912">==</span>&nbsp;<span class="ident" id="6259915">token</span><span class="op" id="6259920">.</span><span class="ident" id="6259921">LPAREN</span>&nbsp;<span class="op" id="6259928">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259932">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259944">idents</span>&nbsp;<span class="op" id="6259951">=</span>&nbsp;<span class="op" id="6259953">[</span><span class="op" id="6259954">]</span><span class="op" id="6259955">*</span><span class="ident" id="6259956">ast</span><span class="op" id="6259959">.</span><span class="ident" id="6259960">Ident</span><span class="op" id="6259965">{</span><span class="ident" id="6259966">ident</span><span class="op" id="6259971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259975">scope</span>&nbsp;<span class="op" id="6259981">:=</span>&nbsp;<span class="ident" id="6259984">ast</span><span class="op" id="6259987">.</span><span class="ident" id="6259988">NewScope</span><span class="op" id="6259996">(</span><span class="ident" id="6259997">nil</span><span class="op" id="6260000">)</span>&nbsp;<span class="comment" id="6260002">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260020">params</span><span class="op" id="6260026">,</span>&nbsp;<span class="ident" id="6260028">results</span>&nbsp;<span class="op" id="6260036">:=</span>&nbsp;<span class="ident" id="6260039">p</span><span class="op" id="6260040">.</span><span class="ident" id="6260041">parseSignature</span><span class="op" id="6260055">(</span><span class="ident" id="6260056">scope</span><span class="op" id="6260061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260065">typ</span>&nbsp;<span class="op" id="6260069">=</span>&nbsp;<span class="op" id="6260071">&amp;</span><span class="ident" id="6260072">ast</span><span class="op" id="6260075">.</span><span class="ident" id="6260076">FuncType</span><span class="op" id="6260084">{</span><span class="ident" id="6260085">Func</span><span class="op" id="6260089">:</span>&nbsp;<span class="ident" id="6260091">token</span><span class="op" id="6260096">.</span><span class="ident" id="6260097">NoPos</span><span class="op" id="6260102">,</span>&nbsp;<span class="ident" id="6260104">Params</span><span class="op" id="6260110">:</span>&nbsp;<span class="ident" id="6260112">params</span><span class="op" id="6260118">,</span>&nbsp;<span class="ident" id="6260120">Results</span><span class="op" id="6260127">:</span>&nbsp;<span class="ident" id="6260129">results</span><span class="op" id="6260136">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260139">}</span>&nbsp;<span class="keyword" id="6260141">else</span>&nbsp;<span class="op" id="6260146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260150">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260174">typ</span>&nbsp;<span class="op" id="6260178">=</span>&nbsp;<span class="ident" id="6260180">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260184">p</span><span class="op" id="6260185">.</span><span class="ident" id="6260186">resolve</span><span class="op" id="6260193">(</span><span class="ident" id="6260194">typ</span><span class="op" id="6260197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260200">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260203">p</span><span class="op" id="6260204">.</span><span class="ident" id="6260205">expectSemi</span><span class="op" id="6260215">(</span><span class="op" id="6260216">)</span>&nbsp;<span class="comment" id="6260218">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260259">spec</span>&nbsp;<span class="op" id="6260264">:=</span>&nbsp;<span class="op" id="6260267">&amp;</span><span class="ident" id="6260268">ast</span><span class="op" id="6260271">.</span><span class="ident" id="6260272">Field</span><span class="op" id="6260277">{</span><span class="ident" id="6260278">Doc</span><span class="op" id="6260281">:</span>&nbsp;<span class="ident" id="6260283">doc</span><span class="op" id="6260286">,</span>&nbsp;<span class="ident" id="6260288">Names</span><span class="op" id="6260293">:</span>&nbsp;<span class="ident" id="6260295">idents</span><span class="op" id="6260301">,</span>&nbsp;<span class="ident" id="6260303">Type</span><span class="op" id="6260307">:</span>&nbsp;<span class="ident" id="6260309">typ</span><span class="op" id="6260312">,</span>&nbsp;<span class="ident" id="6260314">Comment</span><span class="op" id="6260321">:</span>&nbsp;<span class="ident" id="6260323">p</span><span class="op" id="6260324">.</span><span class="ident" id="6260325">lineComment</span><span class="op" id="6260336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260339">p</span><span class="op" id="6260340">.</span><span class="ident" id="6260341">declare</span><span class="op" id="6260348">(</span><span class="ident" id="6260349">spec</span><span class="op" id="6260353">,</span>&nbsp;<span class="ident" id="6260355">nil</span><span class="op" id="6260358">,</span>&nbsp;<span class="ident" id="6260360">scope</span><span class="op" id="6260365">,</span>&nbsp;<span class="ident" id="6260367">ast</span><span class="op" id="6260370">.</span><span class="ident" id="6260371">Fun</span><span class="op" id="6260374">,</span>&nbsp;<span class="ident" id="6260376">idents</span><span class="op" id="6260382">...</span><span class="op" id="6260385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260389">return</span>&nbsp;<span class="ident" id="6260396">spec</span><br>
<span class="lineno"></span><span class="op" id="6260401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6260404">func</span>&nbsp;<span class="op" id="6260409">(</span><span class="ident" id="6260410">p</span>&nbsp;<span class="op" id="6260412">*</span><span class="ident" id="6260413">parser</span><span class="op" id="6260419">)</span>&nbsp;<span class="ident" id="6260421">parseInterfaceType</span><span class="op" id="6260439">(</span><span class="op" id="6260440">)</span>&nbsp;<span class="op" id="6260442">*</span><span class="ident" id="6260443">ast</span><span class="op" id="6260446">.</span><span class="ident" id="6260447">InterfaceType</span>&nbsp;<span class="op" id="6260461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260464">if</span>&nbsp;<span class="ident" id="6260467">p</span><span class="op" id="6260468">.</span><span class="ident" id="6260469">trace</span>&nbsp;<span class="op" id="6260475">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260479">defer</span>&nbsp;<span class="ident" id="6260485">un</span><span class="op" id="6260487">(</span><span class="ident" id="6260488">trace</span><span class="op" id="6260493">(</span><span class="ident" id="6260494">p</span><span class="op" id="6260495">,</span>&nbsp;<span class="string" id="6260497">&#34;InterfaceType&#34;</span><span class="op" id="6260512">)</span><span class="op" id="6260513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260520">pos</span>&nbsp;<span class="op" id="6260524">:=</span>&nbsp;<span class="ident" id="6260527">p</span><span class="op" id="6260528">.</span><span class="ident" id="6260529">expect</span><span class="op" id="6260535">(</span><span class="ident" id="6260536">token</span><span class="op" id="6260541">.</span><span class="ident" id="6260542">INTERFACE</span><span class="op" id="6260551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260554">lbrace</span>&nbsp;<span class="op" id="6260561">:=</span>&nbsp;<span class="ident" id="6260564">p</span><span class="op" id="6260565">.</span><span class="ident" id="6260566">expect</span><span class="op" id="6260572">(</span><span class="ident" id="6260573">token</span><span class="op" id="6260578">.</span><span class="ident" id="6260579">LBRACE</span><span class="op" id="6260585">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260588">scope</span>&nbsp;<span class="op" id="6260594">:=</span>&nbsp;<span class="ident" id="6260597">ast</span><span class="op" id="6260600">.</span><span class="ident" id="6260601">NewScope</span><span class="op" id="6260609">(</span><span class="ident" id="6260610">nil</span><span class="op" id="6260613">)</span>&nbsp;<span class="comment" id="6260615">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260635">var</span>&nbsp;<span class="ident" id="6260639">list</span>&nbsp;<span class="op" id="6260644">[</span><span class="op" id="6260645">]</span><span class="op" id="6260646">*</span><span class="ident" id="6260647">ast</span><span class="op" id="6260650">.</span><span class="ident" id="6260651">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260658">for</span>&nbsp;<span class="ident" id="6260662">p</span><span class="op" id="6260663">.</span><span class="ident" id="6260664">tok</span>&nbsp;<span class="op" id="6260668">==</span>&nbsp;<span class="ident" id="6260671">token</span><span class="op" id="6260676">.</span><span class="ident" id="6260677">IDENT</span>&nbsp;<span class="op" id="6260683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260687">list</span>&nbsp;<span class="op" id="6260692">=</span>&nbsp;<span class="builtinfunc" id="6260694">append</span><span class="op" id="6260700">(</span><span class="ident" id="6260701">list</span><span class="op" id="6260705">,</span>&nbsp;<span class="ident" id="6260707">p</span><span class="op" id="6260708">.</span><span class="ident" id="6260709">parseMethodSpec</span><span class="op" id="6260724">(</span><span class="ident" id="6260725">scope</span><span class="op" id="6260730">)</span><span class="op" id="6260731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260734">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260737">rbrace</span>&nbsp;<span class="op" id="6260744">:=</span>&nbsp;<span class="ident" id="6260747">p</span><span class="op" id="6260748">.</span><span class="ident" id="6260749">expect</span><span class="op" id="6260755">(</span><span class="ident" id="6260756">token</span><span class="op" id="6260761">.</span><span class="ident" id="6260762">RBRACE</span><span class="op" id="6260768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260772">return</span>&nbsp;<span class="op" id="6260779">&amp;</span><span class="ident" id="6260780">ast</span><span class="op" id="6260783">.</span><span class="ident" id="6260784">InterfaceType</span><span class="op" id="6260797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260801">Interface</span><span class="op" id="6260810">:</span>&nbsp;<span class="ident" id="6260812">pos</span><span class="op" id="6260815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260819">Methods</span><span class="op" id="6260826">:</span>&nbsp;<span class="op" id="6260828">&amp;</span><span class="ident" id="6260829">ast</span><span class="op" id="6260832">.</span><span class="ident" id="6260833">FieldList</span><span class="op" id="6260842">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260847">Opening</span><span class="op" id="6260854">:</span>&nbsp;<span class="ident" id="6260856">lbrace</span><span class="op" id="6260862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260867">List</span><span class="op" id="6260871">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6260876">list</span><span class="op" id="6260880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260885">Closing</span><span class="op" id="6260892">:</span>&nbsp;<span class="ident" id="6260894">rbrace</span><span class="op" id="6260900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260904">}</span><span class="op" id="6260905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260908">}</span><br>
<span class="lineno">965</span><span class="op" id="6260910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6260913">func</span>&nbsp;<span class="op" id="6260918">(</span><span class="ident" id="6260919">p</span>&nbsp;<span class="op" id="6260921">*</span><span class="ident" id="6260922">parser</span><span class="op" id="6260928">)</span>&nbsp;<span class="ident" id="6260930">parseMapType</span><span class="op" id="6260942">(</span><span class="op" id="6260943">)</span>&nbsp;<span class="op" id="6260945">*</span><span class="ident" id="6260946">ast</span><span class="op" id="6260949">.</span><span class="ident" id="6260950">MapType</span>&nbsp;<span class="op" id="6260958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260961">if</span>&nbsp;<span class="ident" id="6260964">p</span><span class="op" id="6260965">.</span><span class="ident" id="6260966">trace</span>&nbsp;<span class="op" id="6260972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260976">defer</span>&nbsp;<span class="ident" id="6260982">un</span><span class="op" id="6260984">(</span><span class="ident" id="6260985">trace</span><span class="op" id="6260990">(</span><span class="ident" id="6260991">p</span><span class="op" id="6260992">,</span>&nbsp;<span class="string" id="6260994">&#34;MapType&#34;</span><span class="op" id="6261003">)</span><span class="op" id="6261004">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261011">pos</span>&nbsp;<span class="op" id="6261015">:=</span>&nbsp;<span class="ident" id="6261018">p</span><span class="op" id="6261019">.</span><span class="ident" id="6261020">expect</span><span class="op" id="6261026">(</span><span class="ident" id="6261027">token</span><span class="op" id="6261032">.</span><span class="ident" id="6261033">MAP</span><span class="op" id="6261036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261039">p</span><span class="op" id="6261040">.</span><span class="ident" id="6261041">expect</span><span class="op" id="6261047">(</span><span class="ident" id="6261048">token</span><span class="op" id="6261053">.</span><span class="ident" id="6261054">LBRACK</span><span class="op" id="6261060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261063">key</span>&nbsp;<span class="op" id="6261067">:=</span>&nbsp;<span class="ident" id="6261070">p</span><span class="op" id="6261071">.</span><span class="ident" id="6261072">parseType</span><span class="op" id="6261081">(</span><span class="op" id="6261082">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261085">p</span><span class="op" id="6261086">.</span><span class="ident" id="6261087">expect</span><span class="op" id="6261093">(</span><span class="ident" id="6261094">token</span><span class="op" id="6261099">.</span><span class="ident" id="6261100">RBRACK</span><span class="op" id="6261106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261109">value</span>&nbsp;<span class="op" id="6261115">:=</span>&nbsp;<span class="ident" id="6261118">p</span><span class="op" id="6261119">.</span><span class="ident" id="6261120">parseType</span><span class="op" id="6261129">(</span><span class="op" id="6261130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261134">return</span>&nbsp;<span class="op" id="6261141">&amp;</span><span class="ident" id="6261142">ast</span><span class="op" id="6261145">.</span><span class="ident" id="6261146">MapType</span><span class="op" id="6261153">{</span><span class="ident" id="6261154">Map</span><span class="op" id="6261157">:</span>&nbsp;<span class="ident" id="6261159">pos</span><span class="op" id="6261162">,</span>&nbsp;<span class="ident" id="6261164">Key</span><span class="op" id="6261167">:</span>&nbsp;<span class="ident" id="6261169">key</span><span class="op" id="6261172">,</span>&nbsp;<span class="ident" id="6261174">Value</span><span class="op" id="6261179">:</span>&nbsp;<span class="ident" id="6261181">value</span><span class="op" id="6261186">}</span><br>
<span class="lineno"></span><span class="op" id="6261188">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="6261191">func</span>&nbsp;<span class="op" id="6261196">(</span><span class="ident" id="6261197">p</span>&nbsp;<span class="op" id="6261199">*</span><span class="ident" id="6261200">parser</span><span class="op" id="6261206">)</span>&nbsp;<span class="ident" id="6261208">parseChanType</span><span class="op" id="6261221">(</span><span class="op" id="6261222">)</span>&nbsp;<span class="op" id="6261224">*</span><span class="ident" id="6261225">ast</span><span class="op" id="6261228">.</span><span class="ident" id="6261229">ChanType</span>&nbsp;<span class="op" id="6261238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261241">if</span>&nbsp;<span class="ident" id="6261244">p</span><span class="op" id="6261245">.</span><span class="ident" id="6261246">trace</span>&nbsp;<span class="op" id="6261252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261256">defer</span>&nbsp;<span class="ident" id="6261262">un</span><span class="op" id="6261264">(</span><span class="ident" id="6261265">trace</span><span class="op" id="6261270">(</span><span class="ident" id="6261271">p</span><span class="op" id="6261272">,</span>&nbsp;<span class="string" id="6261274">&#34;ChanType&#34;</span><span class="op" id="6261284">)</span><span class="op" id="6261285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261288">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261292">pos</span>&nbsp;<span class="op" id="6261296">:=</span>&nbsp;<span class="ident" id="6261299">p</span><span class="op" id="6261300">.</span><span class="ident" id="6261301">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261306">dir</span>&nbsp;<span class="op" id="6261310">:=</span>&nbsp;<span class="ident" id="6261313">ast</span><span class="op" id="6261316">.</span><span class="ident" id="6261317">SEND</span>&nbsp;<span class="op" id="6261322">|</span>&nbsp;<span class="ident" id="6261324">ast</span><span class="op" id="6261327">.</span><span class="ident" id="6261328">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261334">var</span>&nbsp;<span class="ident" id="6261338">arrow</span>&nbsp;<span class="ident" id="6261344">token</span><span class="op" id="6261349">.</span><span class="ident" id="6261350">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261355">if</span>&nbsp;<span class="ident" id="6261358">p</span><span class="op" id="6261359">.</span><span class="ident" id="6261360">tok</span>&nbsp;<span class="op" id="6261364">==</span>&nbsp;<span class="ident" id="6261367">token</span><span class="op" id="6261372">.</span><span class="ident" id="6261373">CHAN</span>&nbsp;<span class="op" id="6261378">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261382">p</span><span class="op" id="6261383">.</span><span class="ident" id="6261384">next</span><span class="op" id="6261388">(</span><span class="op" id="6261389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261393">if</span>&nbsp;<span class="ident" id="6261396">p</span><span class="op" id="6261397">.</span><span class="ident" id="6261398">tok</span>&nbsp;<span class="op" id="6261402">==</span>&nbsp;<span class="ident" id="6261405">token</span><span class="op" id="6261410">.</span><span class="ident" id="6261411">ARROW</span>&nbsp;<span class="op" id="6261417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261422">arrow</span>&nbsp;<span class="op" id="6261428">=</span>&nbsp;<span class="ident" id="6261430">p</span><span class="op" id="6261431">.</span><span class="ident" id="6261432">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261439">p</span><span class="op" id="6261440">.</span><span class="ident" id="6261441">next</span><span class="op" id="6261445">(</span><span class="op" id="6261446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261451">dir</span>&nbsp;<span class="op" id="6261455">=</span>&nbsp;<span class="ident" id="6261457">ast</span><span class="op" id="6261460">.</span><span class="ident" id="6261461">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261471">}</span>&nbsp;<span class="keyword" id="6261473">else</span>&nbsp;<span class="op" id="6261478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261482">arrow</span>&nbsp;<span class="op" id="6261488">=</span>&nbsp;<span class="ident" id="6261490">p</span><span class="op" id="6261491">.</span><span class="ident" id="6261492">expect</span><span class="op" id="6261498">(</span><span class="ident" id="6261499">token</span><span class="op" id="6261504">.</span><span class="ident" id="6261505">ARROW</span><span class="op" id="6261510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261514">p</span><span class="op" id="6261515">.</span><span class="ident" id="6261516">expect</span><span class="op" id="6261522">(</span><span class="ident" id="6261523">token</span><span class="op" id="6261528">.</span><span class="ident" id="6261529">CHAN</span><span class="op" id="6261533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261537">dir</span>&nbsp;<span class="op" id="6261541">=</span>&nbsp;<span class="ident" id="6261543">ast</span><span class="op" id="6261546">.</span><span class="ident" id="6261547">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261556">value</span>&nbsp;<span class="op" id="6261562">:=</span>&nbsp;<span class="ident" id="6261565">p</span><span class="op" id="6261566">.</span><span class="ident" id="6261567">parseType</span><span class="op" id="6261576">(</span><span class="op" id="6261577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261581">return</span>&nbsp;<span class="op" id="6261588">&amp;</span><span class="ident" id="6261589">ast</span><span class="op" id="6261592">.</span><span class="ident" id="6261593">ChanType</span><span class="op" id="6261601">{</span><span class="ident" id="6261602">Begin</span><span class="op" id="6261607">:</span>&nbsp;<span class="ident" id="6261609">pos</span><span class="op" id="6261612">,</span>&nbsp;<span class="ident" id="6261614">Arrow</span><span class="op" id="6261619">:</span>&nbsp;<span class="ident" id="6261621">arrow</span><span class="op" id="6261626">,</span>&nbsp;<span class="ident" id="6261628">Dir</span><span class="op" id="6261631">:</span>&nbsp;<span class="ident" id="6261633">dir</span><span class="op" id="6261636">,</span>&nbsp;<span class="ident" id="6261638">Value</span><span class="op" id="6261643">:</span>&nbsp;<span class="ident" id="6261645">value</span><span class="op" id="6261650">}</span><br>
<span class="lineno"></span><span class="op" id="6261652">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="6261655">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6261710">func</span>&nbsp;<span class="op" id="6261715">(</span><span class="ident" id="6261716">p</span>&nbsp;<span class="op" id="6261718">*</span><span class="ident" id="6261719">parser</span><span class="op" id="6261725">)</span>&nbsp;<span class="ident" id="6261727">tryIdentOrType</span><span class="op" id="6261741">(</span><span class="op" id="6261742">)</span>&nbsp;<span class="ident" id="6261744">ast</span><span class="op" id="6261747">.</span><span class="ident" id="6261748">Expr</span>&nbsp;<span class="op" id="6261753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261756">switch</span>&nbsp;<span class="ident" id="6261763">p</span><span class="op" id="6261764">.</span><span class="ident" id="6261765">tok</span>&nbsp;<span class="op" id="6261769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261772">case</span>&nbsp;<span class="ident" id="6261777">token</span><span class="op" id="6261782">.</span><span class="ident" id="6261783">IDENT</span><span class="op" id="6261788">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261792">return</span>&nbsp;<span class="ident" id="6261799">p</span><span class="op" id="6261800">.</span><span class="ident" id="6261801">parseTypeName</span><span class="op" id="6261814">(</span><span class="op" id="6261815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261818">case</span>&nbsp;<span class="ident" id="6261823">token</span><span class="op" id="6261828">.</span><span class="ident" id="6261829">LBRACK</span><span class="op" id="6261835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261839">return</span>&nbsp;<span class="ident" id="6261846">p</span><span class="op" id="6261847">.</span><span class="ident" id="6261848">parseArrayType</span><span class="op" id="6261862">(</span><span class="op" id="6261863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261866">case</span>&nbsp;<span class="ident" id="6261871">token</span><span class="op" id="6261876">.</span><span class="ident" id="6261877">STRUCT</span><span class="op" id="6261883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261887">return</span>&nbsp;<span class="ident" id="6261894">p</span><span class="op" id="6261895">.</span><span class="ident" id="6261896">parseStructType</span><span class="op" id="6261911">(</span><span class="op" id="6261912">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261915">case</span>&nbsp;<span class="ident" id="6261920">token</span><span class="op" id="6261925">.</span><span class="ident" id="6261926">MUL</span><span class="op" id="6261929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261933">return</span>&nbsp;<span class="ident" id="6261940">p</span><span class="op" id="6261941">.</span><span class="ident" id="6261942">parsePointerType</span><span class="op" id="6261958">(</span><span class="op" id="6261959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261962">case</span>&nbsp;<span class="ident" id="6261967">token</span><span class="op" id="6261972">.</span><span class="ident" id="6261973">FUNC</span><span class="op" id="6261977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261981">typ</span><span class="op" id="6261984">,</span>&nbsp;<span class="ident" id="6261986">_</span>&nbsp;<span class="op" id="6261988">:=</span>&nbsp;<span class="ident" id="6261991">p</span><span class="op" id="6261992">.</span><span class="ident" id="6261993">parseFuncType</span><span class="op" id="6262006">(</span><span class="op" id="6262007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262011">return</span>&nbsp;<span class="ident" id="6262018">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262023">case</span>&nbsp;<span class="ident" id="6262028">token</span><span class="op" id="6262033">.</span><span class="ident" id="6262034">INTERFACE</span><span class="op" id="6262043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262047">return</span>&nbsp;<span class="ident" id="6262054">p</span><span class="op" id="6262055">.</span><span class="ident" id="6262056">parseInterfaceType</span><span class="op" id="6262074">(</span><span class="op" id="6262075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262078">case</span>&nbsp;<span class="ident" id="6262083">token</span><span class="op" id="6262088">.</span><span class="ident" id="6262089">MAP</span><span class="op" id="6262092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262096">return</span>&nbsp;<span class="ident" id="6262103">p</span><span class="op" id="6262104">.</span><span class="ident" id="6262105">parseMapType</span><span class="op" id="6262117">(</span><span class="op" id="6262118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262121">case</span>&nbsp;<span class="ident" id="6262126">token</span><span class="op" id="6262131">.</span><span class="ident" id="6262132">CHAN</span><span class="op" id="6262136">,</span>&nbsp;<span class="ident" id="6262138">token</span><span class="op" id="6262143">.</span><span class="ident" id="6262144">ARROW</span><span class="op" id="6262149">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262153">return</span>&nbsp;<span class="ident" id="6262160">p</span><span class="op" id="6262161">.</span><span class="ident" id="6262162">parseChanType</span><span class="op" id="6262175">(</span><span class="op" id="6262176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262179">case</span>&nbsp;<span class="ident" id="6262184">token</span><span class="op" id="6262189">.</span><span class="ident" id="6262190">LPAREN</span><span class="op" id="6262196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262200">lparen</span>&nbsp;<span class="op" id="6262207">:=</span>&nbsp;<span class="ident" id="6262210">p</span><span class="op" id="6262211">.</span><span class="ident" id="6262212">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262218">p</span><span class="op" id="6262219">.</span><span class="ident" id="6262220">next</span><span class="op" id="6262224">(</span><span class="op" id="6262225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262229">typ</span>&nbsp;<span class="op" id="6262233">:=</span>&nbsp;<span class="ident" id="6262236">p</span><span class="op" id="6262237">.</span><span class="ident" id="6262238">parseType</span><span class="op" id="6262247">(</span><span class="op" id="6262248">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262252">rparen</span>&nbsp;<span class="op" id="6262259">:=</span>&nbsp;<span class="ident" id="6262262">p</span><span class="op" id="6262263">.</span><span class="ident" id="6262264">expect</span><span class="op" id="6262270">(</span><span class="ident" id="6262271">token</span><span class="op" id="6262276">.</span><span class="ident" id="6262277">RPAREN</span><span class="op" id="6262283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262287">return</span>&nbsp;<span class="op" id="6262294">&amp;</span><span class="ident" id="6262295">ast</span><span class="op" id="6262298">.</span><span class="ident" id="6262299">ParenExpr</span><span class="op" id="6262308">{</span><span class="ident" id="6262309">Lparen</span><span class="op" id="6262315">:</span>&nbsp;<span class="ident" id="6262317">lparen</span><span class="op" id="6262323">,</span>&nbsp;<span class="ident" id="6262325">X</span><span class="op" id="6262326">:</span>&nbsp;<span class="ident" id="6262328">typ</span><span class="op" id="6262331">,</span>&nbsp;<span class="ident" id="6262333">Rparen</span><span class="op" id="6262339">:</span>&nbsp;<span class="ident" id="6262341">rparen</span><span class="op" id="6262347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262354">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262372">return</span>&nbsp;<span class="ident" id="6262379">nil</span><br>
<span class="lineno"></span><span class="op" id="6262383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6262386">func</span>&nbsp;<span class="op" id="6262391">(</span><span class="ident" id="6262392">p</span>&nbsp;<span class="op" id="6262394">*</span><span class="ident" id="6262395">parser</span><span class="op" id="6262401">)</span>&nbsp;<span class="ident" id="6262403">tryType</span><span class="op" id="6262410">(</span><span class="op" id="6262411">)</span>&nbsp;<span class="ident" id="6262413">ast</span><span class="op" id="6262416">.</span><span class="ident" id="6262417">Expr</span>&nbsp;<span class="op" id="6262422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262425">typ</span>&nbsp;<span class="op" id="6262429">:=</span>&nbsp;<span class="ident" id="6262432">p</span><span class="op" id="6262433">.</span><span class="ident" id="6262434">tryIdentOrType</span><span class="op" id="6262448">(</span><span class="op" id="6262449">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262452">if</span>&nbsp;<span class="ident" id="6262455">typ</span>&nbsp;<span class="op" id="6262459">!=</span>&nbsp;<span class="ident" id="6262462">nil</span>&nbsp;<span class="op" id="6262466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262470">p</span><span class="op" id="6262471">.</span><span class="ident" id="6262472">resolve</span><span class="op" id="6262479">(</span><span class="ident" id="6262480">typ</span><span class="op" id="6262483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262489">return</span>&nbsp;<span class="ident" id="6262496">typ</span><br>
<span class="lineno"></span><span class="op" id="6262500">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="6262503">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6262583">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6262594">func</span>&nbsp;<span class="op" id="6262599">(</span><span class="ident" id="6262600">p</span>&nbsp;<span class="op" id="6262602">*</span><span class="ident" id="6262603">parser</span><span class="op" id="6262609">)</span>&nbsp;<span class="ident" id="6262611">parseStmtList</span><span class="op" id="6262624">(</span><span class="op" id="6262625">)</span>&nbsp;<span class="op" id="6262627">(</span><span class="ident" id="6262628">list</span>&nbsp;<span class="op" id="6262633">[</span><span class="op" id="6262634">]</span><span class="ident" id="6262635">ast</span><span class="op" id="6262638">.</span><span class="ident" id="6262639">Stmt</span><span class="op" id="6262643">)</span>&nbsp;<span class="op" id="6262645">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262648">if</span>&nbsp;<span class="ident" id="6262651">p</span><span class="op" id="6262652">.</span><span class="ident" id="6262653">trace</span>&nbsp;<span class="op" id="6262659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262663">defer</span>&nbsp;<span class="ident" id="6262669">un</span><span class="op" id="6262671">(</span><span class="ident" id="6262672">trace</span><span class="op" id="6262677">(</span><span class="ident" id="6262678">p</span><span class="op" id="6262679">,</span>&nbsp;<span class="string" id="6262681">&#34;StatementList&#34;</span><span class="op" id="6262696">)</span><span class="op" id="6262697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262704">for</span>&nbsp;<span class="ident" id="6262708">p</span><span class="op" id="6262709">.</span><span class="ident" id="6262710">tok</span>&nbsp;<span class="op" id="6262714">!=</span>&nbsp;<span class="ident" id="6262717">token</span><span class="op" id="6262722">.</span><span class="ident" id="6262723">CASE</span>&nbsp;<span class="op" id="6262728">&amp;&amp;</span>&nbsp;<span class="ident" id="6262731">p</span><span class="op" id="6262732">.</span><span class="ident" id="6262733">tok</span>&nbsp;<span class="op" id="6262737">!=</span>&nbsp;<span class="ident" id="6262740">token</span><span class="op" id="6262745">.</span><span class="ident" id="6262746">DEFAULT</span>&nbsp;<span class="op" id="6262754">&amp;&amp;</span>&nbsp;<span class="ident" id="6262757">p</span><span class="op" id="6262758">.</span><span class="ident" id="6262759">tok</span>&nbsp;<span class="op" id="6262763">!=</span>&nbsp;<span class="ident" id="6262766">token</span><span class="op" id="6262771">.</span><span class="ident" id="6262772">RBRACE</span>&nbsp;<span class="op" id="6262779">&amp;&amp;</span>&nbsp;<span class="ident" id="6262782">p</span><span class="op" id="6262783">.</span><span class="ident" id="6262784">tok</span>&nbsp;<span class="op" id="6262788">!=</span>&nbsp;<span class="ident" id="6262791">token</span><span class="op" id="6262796">.</span><span class="ident" id="6262797">EOF</span>&nbsp;<span class="op" id="6262801">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262805">list</span>&nbsp;<span class="op" id="6262810">=</span>&nbsp;<span class="builtinfunc" id="6262812">append</span><span class="op" id="6262818">(</span><span class="ident" id="6262819">list</span><span class="op" id="6262823">,</span>&nbsp;<span class="ident" id="6262825">p</span><span class="op" id="6262826">.</span><span class="ident" id="6262827">parseStmt</span><span class="op" id="6262836">(</span><span class="op" id="6262837">)</span><span class="op" id="6262838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262845">return</span><br>
<span class="lineno"></span><span class="op" id="6262852">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="6262855">func</span>&nbsp;<span class="op" id="6262860">(</span><span class="ident" id="6262861">p</span>&nbsp;<span class="op" id="6262863">*</span><span class="ident" id="6262864">parser</span><span class="op" id="6262870">)</span>&nbsp;<span class="ident" id="6262872">parseBody</span><span class="op" id="6262881">(</span><span class="ident" id="6262882">scope</span>&nbsp;<span class="op" id="6262888">*</span><span class="ident" id="6262889">ast</span><span class="op" id="6262892">.</span><span class="ident" id="6262893">Scope</span><span class="op" id="6262898">)</span>&nbsp;<span class="op" id="6262900">*</span><span class="ident" id="6262901">ast</span><span class="op" id="6262904">.</span><span class="ident" id="6262905">BlockStmt</span>&nbsp;<span class="op" id="6262915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262918">if</span>&nbsp;<span class="ident" id="6262921">p</span><span class="op" id="6262922">.</span><span class="ident" id="6262923">trace</span>&nbsp;<span class="op" id="6262929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262933">defer</span>&nbsp;<span class="ident" id="6262939">un</span><span class="op" id="6262941">(</span><span class="ident" id="6262942">trace</span><span class="op" id="6262947">(</span><span class="ident" id="6262948">p</span><span class="op" id="6262949">,</span>&nbsp;<span class="string" id="6262951">&#34;Body&#34;</span><span class="op" id="6262957">)</span><span class="op" id="6262958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262961">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262965">lbrace</span>&nbsp;<span class="op" id="6262972">:=</span>&nbsp;<span class="ident" id="6262975">p</span><span class="op" id="6262976">.</span><span class="ident" id="6262977">expect</span><span class="op" id="6262983">(</span><span class="ident" id="6262984">token</span><span class="op" id="6262989">.</span><span class="ident" id="6262990">LBRACE</span><span class="op" id="6262996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262999">p</span><span class="op" id="6263000">.</span><span class="ident" id="6263001">topScope</span>&nbsp;<span class="op" id="6263010">=</span>&nbsp;<span class="ident" id="6263012">scope</span>&nbsp;<span class="comment" id="6263018">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263042">p</span><span class="op" id="6263043">.</span><span class="ident" id="6263044">openLabelScope</span><span class="op" id="6263058">(</span><span class="op" id="6263059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263062">list</span>&nbsp;<span class="op" id="6263067">:=</span>&nbsp;<span class="ident" id="6263070">p</span><span class="op" id="6263071">.</span><span class="ident" id="6263072">parseStmtList</span><span class="op" id="6263085">(</span><span class="op" id="6263086">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263089">p</span><span class="op" id="6263090">.</span><span class="ident" id="6263091">closeLabelScope</span><span class="op" id="6263106">(</span><span class="op" id="6263107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263110">p</span><span class="op" id="6263111">.</span><span class="ident" id="6263112">closeScope</span><span class="op" id="6263122">(</span><span class="op" id="6263123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263126">rbrace</span>&nbsp;<span class="op" id="6263133">:=</span>&nbsp;<span class="ident" id="6263136">p</span><span class="op" id="6263137">.</span><span class="ident" id="6263138">expect</span><span class="op" id="6263144">(</span><span class="ident" id="6263145">token</span><span class="op" id="6263150">.</span><span class="ident" id="6263151">RBRACE</span><span class="op" id="6263157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263161">return</span>&nbsp;<span class="op" id="6263168">&amp;</span><span class="ident" id="6263169">ast</span><span class="op" id="6263172">.</span><span class="ident" id="6263173">BlockStmt</span><span class="op" id="6263182">{</span><span class="ident" id="6263183">Lbrace</span><span class="op" id="6263189">:</span>&nbsp;<span class="ident" id="6263191">lbrace</span><span class="op" id="6263197">,</span>&nbsp;<span class="ident" id="6263199">List</span><span class="op" id="6263203">:</span>&nbsp;<span class="ident" id="6263205">list</span><span class="op" id="6263209">,</span>&nbsp;<span class="ident" id="6263211">Rbrace</span><span class="op" id="6263217">:</span>&nbsp;<span class="ident" id="6263219">rbrace</span><span class="op" id="6263225">}</span><br>
<span class="lineno">1075</span><span class="op" id="6263227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6263230">func</span>&nbsp;<span class="op" id="6263235">(</span><span class="ident" id="6263236">p</span>&nbsp;<span class="op" id="6263238">*</span><span class="ident" id="6263239">parser</span><span class="op" id="6263245">)</span>&nbsp;<span class="ident" id="6263247">parseBlockStmt</span><span class="op" id="6263261">(</span><span class="op" id="6263262">)</span>&nbsp;<span class="op" id="6263264">*</span><span class="ident" id="6263265">ast</span><span class="op" id="6263268">.</span><span class="ident" id="6263269">BlockStmt</span>&nbsp;<span class="op" id="6263279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263282">if</span>&nbsp;<span class="ident" id="6263285">p</span><span class="op" id="6263286">.</span><span class="ident" id="6263287">trace</span>&nbsp;<span class="op" id="6263293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263297">defer</span>&nbsp;<span class="ident" id="6263303">un</span><span class="op" id="6263305">(</span><span class="ident" id="6263306">trace</span><span class="op" id="6263311">(</span><span class="ident" id="6263312">p</span><span class="op" id="6263313">,</span>&nbsp;<span class="string" id="6263315">&#34;BlockStmt&#34;</span><span class="op" id="6263326">)</span><span class="op" id="6263327">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263334">lbrace</span>&nbsp;<span class="op" id="6263341">:=</span>&nbsp;<span class="ident" id="6263344">p</span><span class="op" id="6263345">.</span><span class="ident" id="6263346">expect</span><span class="op" id="6263352">(</span><span class="ident" id="6263353">token</span><span class="op" id="6263358">.</span><span class="ident" id="6263359">LBRACE</span><span class="op" id="6263365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263368">p</span><span class="op" id="6263369">.</span><span class="ident" id="6263370">openScope</span><span class="op" id="6263379">(</span><span class="op" id="6263380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263383">list</span>&nbsp;<span class="op" id="6263388">:=</span>&nbsp;<span class="ident" id="6263391">p</span><span class="op" id="6263392">.</span><span class="ident" id="6263393">parseStmtList</span><span class="op" id="6263406">(</span><span class="op" id="6263407">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263410">p</span><span class="op" id="6263411">.</span><span class="ident" id="6263412">closeScope</span><span class="op" id="6263422">(</span><span class="op" id="6263423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263426">rbrace</span>&nbsp;<span class="op" id="6263433">:=</span>&nbsp;<span class="ident" id="6263436">p</span><span class="op" id="6263437">.</span><span class="ident" id="6263438">expect</span><span class="op" id="6263444">(</span><span class="ident" id="6263445">token</span><span class="op" id="6263450">.</span><span class="ident" id="6263451">RBRACE</span><span class="op" id="6263457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263461">return</span>&nbsp;<span class="op" id="6263468">&amp;</span><span class="ident" id="6263469">ast</span><span class="op" id="6263472">.</span><span class="ident" id="6263473">BlockStmt</span><span class="op" id="6263482">{</span><span class="ident" id="6263483">Lbrace</span><span class="op" id="6263489">:</span>&nbsp;<span class="ident" id="6263491">lbrace</span><span class="op" id="6263497">,</span>&nbsp;<span class="ident" id="6263499">List</span><span class="op" id="6263503">:</span>&nbsp;<span class="ident" id="6263505">list</span><span class="op" id="6263509">,</span>&nbsp;<span class="ident" id="6263511">Rbrace</span><span class="op" id="6263517">:</span>&nbsp;<span class="ident" id="6263519">rbrace</span><span class="op" id="6263525">}</span><br>
<span class="lineno"></span><span class="op" id="6263527">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="6263530">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6263610">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6263626">func</span>&nbsp;<span class="op" id="6263631">(</span><span class="ident" id="6263632">p</span>&nbsp;<span class="op" id="6263634">*</span><span class="ident" id="6263635">parser</span><span class="op" id="6263641">)</span>&nbsp;<span class="ident" id="6263643">parseFuncTypeOrLit</span><span class="op" id="6263661">(</span><span class="op" id="6263662">)</span>&nbsp;<span class="ident" id="6263664">ast</span><span class="op" id="6263667">.</span><span class="ident" id="6263668">Expr</span>&nbsp;<span class="op" id="6263673">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263676">if</span>&nbsp;<span class="ident" id="6263679">p</span><span class="op" id="6263680">.</span><span class="ident" id="6263681">trace</span>&nbsp;<span class="op" id="6263687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263691">defer</span>&nbsp;<span class="ident" id="6263697">un</span><span class="op" id="6263699">(</span><span class="ident" id="6263700">trace</span><span class="op" id="6263705">(</span><span class="ident" id="6263706">p</span><span class="op" id="6263707">,</span>&nbsp;<span class="string" id="6263709">&#34;FuncTypeOrLit&#34;</span><span class="op" id="6263724">)</span><span class="op" id="6263725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263732">typ</span><span class="op" id="6263735">,</span>&nbsp;<span class="ident" id="6263737">scope</span>&nbsp;<span class="op" id="6263743">:=</span>&nbsp;<span class="ident" id="6263746">p</span><span class="op" id="6263747">.</span><span class="ident" id="6263748">parseFuncType</span><span class="op" id="6263761">(</span><span class="op" id="6263762">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263765">if</span>&nbsp;<span class="ident" id="6263768">p</span><span class="op" id="6263769">.</span><span class="ident" id="6263770">tok</span>&nbsp;<span class="op" id="6263774">!=</span>&nbsp;<span class="ident" id="6263777">token</span><span class="op" id="6263782">.</span><span class="ident" id="6263783">LBRACE</span>&nbsp;<span class="op" id="6263790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6263794">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263818">return</span>&nbsp;<span class="ident" id="6263825">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263834">p</span><span class="op" id="6263835">.</span><span class="ident" id="6263836">exprLev</span><span class="op" id="6263843">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263847">body</span>&nbsp;<span class="op" id="6263852">:=</span>&nbsp;<span class="ident" id="6263855">p</span><span class="op" id="6263856">.</span><span class="ident" id="6263857">parseBody</span><span class="op" id="6263866">(</span><span class="ident" id="6263867">scope</span><span class="op" id="6263872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263875">p</span><span class="op" id="6263876">.</span><span class="ident" id="6263877">exprLev</span><span class="op" id="6263884">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263889">return</span>&nbsp;<span class="op" id="6263896">&amp;</span><span class="ident" id="6263897">ast</span><span class="op" id="6263900">.</span><span class="ident" id="6263901">FuncLit</span><span class="op" id="6263908">{</span><span class="ident" id="6263909">Type</span><span class="op" id="6263913">:</span>&nbsp;<span class="ident" id="6263915">typ</span><span class="op" id="6263918">,</span>&nbsp;<span class="ident" id="6263920">Body</span><span class="op" id="6263924">:</span>&nbsp;<span class="ident" id="6263926">body</span><span class="op" id="6263930">}</span><br>
<span class="lineno">1110</span><span class="op" id="6263932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6263935">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="6264003">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="6264064">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="6264134">//</span><br>
<span class="lineno"></span><span class="keyword" id="6264137">func</span>&nbsp;<span class="op" id="6264142">(</span><span class="ident" id="6264143">p</span>&nbsp;<span class="op" id="6264145">*</span><span class="ident" id="6264146">parser</span><span class="op" id="6264152">)</span>&nbsp;<span class="ident" id="6264154">parseOperand</span><span class="op" id="6264166">(</span><span class="ident" id="6264167">lhs</span>&nbsp;<span class="builtintype" id="6264171">bool</span><span class="op" id="6264175">)</span>&nbsp;<span class="ident" id="6264177">ast</span><span class="op" id="6264180">.</span><span class="ident" id="6264181">Expr</span>&nbsp;<span class="op" id="6264186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264189">if</span>&nbsp;<span class="ident" id="6264192">p</span><span class="op" id="6264193">.</span><span class="ident" id="6264194">trace</span>&nbsp;<span class="op" id="6264200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264204">defer</span>&nbsp;<span class="ident" id="6264210">un</span><span class="op" id="6264212">(</span><span class="ident" id="6264213">trace</span><span class="op" id="6264218">(</span><span class="ident" id="6264219">p</span><span class="op" id="6264220">,</span>&nbsp;<span class="string" id="6264222">&#34;Operand&#34;</span><span class="op" id="6264231">)</span><span class="op" id="6264232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264235">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264239">switch</span>&nbsp;<span class="ident" id="6264246">p</span><span class="op" id="6264247">.</span><span class="ident" id="6264248">tok</span>&nbsp;<span class="op" id="6264252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264255">case</span>&nbsp;<span class="ident" id="6264260">token</span><span class="op" id="6264265">.</span><span class="ident" id="6264266">IDENT</span><span class="op" id="6264271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264275">x</span>&nbsp;<span class="op" id="6264277">:=</span>&nbsp;<span class="ident" id="6264280">p</span><span class="op" id="6264281">.</span><span class="ident" id="6264282">parseIdent</span><span class="op" id="6264292">(</span><span class="op" id="6264293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264297">if</span>&nbsp;<span class="op" id="6264300">!</span><span class="ident" id="6264301">lhs</span>&nbsp;<span class="op" id="6264305">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264310">p</span><span class="op" id="6264311">.</span><span class="ident" id="6264312">resolve</span><span class="op" id="6264319">(</span><span class="ident" id="6264320">x</span><span class="op" id="6264321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264329">return</span>&nbsp;<span class="ident" id="6264336">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264340">case</span>&nbsp;<span class="ident" id="6264345">token</span><span class="op" id="6264350">.</span><span class="ident" id="6264351">INT</span><span class="op" id="6264354">,</span>&nbsp;<span class="ident" id="6264356">token</span><span class="op" id="6264361">.</span><span class="ident" id="6264362">FLOAT</span><span class="op" id="6264367">,</span>&nbsp;<span class="ident" id="6264369">token</span><span class="op" id="6264374">.</span><span class="ident" id="6264375">IMAG</span><span class="op" id="6264379">,</span>&nbsp;<span class="ident" id="6264381">token</span><span class="op" id="6264386">.</span><span class="ident" id="6264387">CHAR</span><span class="op" id="6264391">,</span>&nbsp;<span class="ident" id="6264393">token</span><span class="op" id="6264398">.</span><span class="ident" id="6264399">STRING</span><span class="op" id="6264405">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264409">x</span>&nbsp;<span class="op" id="6264411">:=</span>&nbsp;<span class="op" id="6264414">&amp;</span><span class="ident" id="6264415">ast</span><span class="op" id="6264418">.</span><span class="ident" id="6264419">BasicLit</span><span class="op" id="6264427">{</span><span class="ident" id="6264428">ValuePos</span><span class="op" id="6264436">:</span>&nbsp;<span class="ident" id="6264438">p</span><span class="op" id="6264439">.</span><span class="ident" id="6264440">pos</span><span class="op" id="6264443">,</span>&nbsp;<span class="ident" id="6264445">Kind</span><span class="op" id="6264449">:</span>&nbsp;<span class="ident" id="6264451">p</span><span class="op" id="6264452">.</span><span class="ident" id="6264453">tok</span><span class="op" id="6264456">,</span>&nbsp;<span class="ident" id="6264458">Value</span><span class="op" id="6264463">:</span>&nbsp;<span class="ident" id="6264465">p</span><span class="op" id="6264466">.</span><span class="ident" id="6264467">lit</span><span class="op" id="6264470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264474">p</span><span class="op" id="6264475">.</span><span class="ident" id="6264476">next</span><span class="op" id="6264480">(</span><span class="op" id="6264481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264485">return</span>&nbsp;<span class="ident" id="6264492">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264496">case</span>&nbsp;<span class="ident" id="6264501">token</span><span class="op" id="6264506">.</span><span class="ident" id="6264507">LPAREN</span><span class="op" id="6264513">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264517">lparen</span>&nbsp;<span class="op" id="6264524">:=</span>&nbsp;<span class="ident" id="6264527">p</span><span class="op" id="6264528">.</span><span class="ident" id="6264529">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264535">p</span><span class="op" id="6264536">.</span><span class="ident" id="6264537">next</span><span class="op" id="6264541">(</span><span class="op" id="6264542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264546">p</span><span class="op" id="6264547">.</span><span class="ident" id="6264548">exprLev</span><span class="op" id="6264555">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264560">x</span>&nbsp;<span class="op" id="6264562">:=</span>&nbsp;<span class="ident" id="6264565">p</span><span class="op" id="6264566">.</span><span class="ident" id="6264567">parseRhsOrType</span><span class="op" id="6264581">(</span><span class="op" id="6264582">)</span>&nbsp;<span class="comment" id="6264584">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264629">p</span><span class="op" id="6264630">.</span><span class="ident" id="6264631">exprLev</span><span class="op" id="6264638">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264643">rparen</span>&nbsp;<span class="op" id="6264650">:=</span>&nbsp;<span class="ident" id="6264653">p</span><span class="op" id="6264654">.</span><span class="ident" id="6264655">expect</span><span class="op" id="6264661">(</span><span class="ident" id="6264662">token</span><span class="op" id="6264667">.</span><span class="ident" id="6264668">RPAREN</span><span class="op" id="6264674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264678">return</span>&nbsp;<span class="op" id="6264685">&amp;</span><span class="ident" id="6264686">ast</span><span class="op" id="6264689">.</span><span class="ident" id="6264690">ParenExpr</span><span class="op" id="6264699">{</span><span class="ident" id="6264700">Lparen</span><span class="op" id="6264706">:</span>&nbsp;<span class="ident" id="6264708">lparen</span><span class="op" id="6264714">,</span>&nbsp;<span class="ident" id="6264716">X</span><span class="op" id="6264717">:</span>&nbsp;<span class="ident" id="6264719">x</span><span class="op" id="6264720">,</span>&nbsp;<span class="ident" id="6264722">Rparen</span><span class="op" id="6264728">:</span>&nbsp;<span class="ident" id="6264730">rparen</span><span class="op" id="6264736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264740">case</span>&nbsp;<span class="ident" id="6264745">token</span><span class="op" id="6264750">.</span><span class="ident" id="6264751">FUNC</span><span class="op" id="6264755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264759">return</span>&nbsp;<span class="ident" id="6264766">p</span><span class="op" id="6264767">.</span><span class="ident" id="6264768">parseFuncTypeOrLit</span><span class="op" id="6264786">(</span><span class="op" id="6264787">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264794">if</span>&nbsp;<span class="ident" id="6264797">typ</span>&nbsp;<span class="op" id="6264801">:=</span>&nbsp;<span class="ident" id="6264804">p</span><span class="op" id="6264805">.</span><span class="ident" id="6264806">tryIdentOrType</span><span class="op" id="6264820">(</span><span class="op" id="6264821">)</span><span class="op" id="6264822">;</span>&nbsp;<span class="ident" id="6264824">typ</span>&nbsp;<span class="op" id="6264828">!=</span>&nbsp;<span class="ident" id="6264831">nil</span>&nbsp;<span class="op" id="6264835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6264839">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264894">_</span><span class="op" id="6264895">,</span>&nbsp;<span class="ident" id="6264897">isIdent</span>&nbsp;<span class="op" id="6264905">:=</span>&nbsp;<span class="ident" id="6264908">typ</span><span class="op" id="6264911">.</span><span class="op" id="6264912">(</span><span class="op" id="6264913">*</span><span class="ident" id="6264914">ast</span><span class="op" id="6264917">.</span><span class="ident" id="6264918">Ident</span><span class="op" id="6264923">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264927">assert</span><span class="op" id="6264933">(</span><span class="op" id="6264934">!</span><span class="ident" id="6264935">isIdent</span><span class="op" id="6264942">,</span>&nbsp;<span class="string" id="6264944">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="6264971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264975">return</span>&nbsp;<span class="ident" id="6264982">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6264991">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265012">pos</span>&nbsp;<span class="op" id="6265016">:=</span>&nbsp;<span class="ident" id="6265019">p</span><span class="op" id="6265020">.</span><span class="ident" id="6265021">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265026">p</span><span class="op" id="6265027">.</span><span class="ident" id="6265028">errorExpected</span><span class="op" id="6265041">(</span><span class="ident" id="6265042">pos</span><span class="op" id="6265045">,</span>&nbsp;<span class="string" id="6265047">&#34;operand&#34;</span><span class="op" id="6265056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265059">syncStmt</span><span class="op" id="6265067">(</span><span class="ident" id="6265068">p</span><span class="op" id="6265069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265072">return</span>&nbsp;<span class="op" id="6265079">&amp;</span><span class="ident" id="6265080">ast</span><span class="op" id="6265083">.</span><span class="ident" id="6265084">BadExpr</span><span class="op" id="6265091">{</span><span class="ident" id="6265092">From</span><span class="op" id="6265096">:</span>&nbsp;<span class="ident" id="6265098">pos</span><span class="op" id="6265101">,</span>&nbsp;<span class="ident" id="6265103">To</span><span class="op" id="6265105">:</span>&nbsp;<span class="ident" id="6265107">p</span><span class="op" id="6265108">.</span><span class="ident" id="6265109">pos</span><span class="op" id="6265112">}</span><br>
<span class="lineno"></span><span class="op" id="6265114">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="6265117">func</span>&nbsp;<span class="op" id="6265122">(</span><span class="ident" id="6265123">p</span>&nbsp;<span class="op" id="6265125">*</span><span class="ident" id="6265126">parser</span><span class="op" id="6265132">)</span>&nbsp;<span class="ident" id="6265134">parseSelector</span><span class="op" id="6265147">(</span><span class="ident" id="6265148">x</span>&nbsp;<span class="ident" id="6265150">ast</span><span class="op" id="6265153">.</span><span class="ident" id="6265154">Expr</span><span class="op" id="6265158">)</span>&nbsp;<span class="ident" id="6265160">ast</span><span class="op" id="6265163">.</span><span class="ident" id="6265164">Expr</span>&nbsp;<span class="op" id="6265169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265172">if</span>&nbsp;<span class="ident" id="6265175">p</span><span class="op" id="6265176">.</span><span class="ident" id="6265177">trace</span>&nbsp;<span class="op" id="6265183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265187">defer</span>&nbsp;<span class="ident" id="6265193">un</span><span class="op" id="6265195">(</span><span class="ident" id="6265196">trace</span><span class="op" id="6265201">(</span><span class="ident" id="6265202">p</span><span class="op" id="6265203">,</span>&nbsp;<span class="string" id="6265205">&#34;Selector&#34;</span><span class="op" id="6265215">)</span><span class="op" id="6265216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265219">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265223">sel</span>&nbsp;<span class="op" id="6265227">:=</span>&nbsp;<span class="ident" id="6265230">p</span><span class="op" id="6265231">.</span><span class="ident" id="6265232">parseIdent</span><span class="op" id="6265242">(</span><span class="op" id="6265243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265247">return</span>&nbsp;<span class="op" id="6265254">&amp;</span><span class="ident" id="6265255">ast</span><span class="op" id="6265258">.</span><span class="ident" id="6265259">SelectorExpr</span><span class="op" id="6265271">{</span><span class="ident" id="6265272">X</span><span class="op" id="6265273">:</span>&nbsp;<span class="ident" id="6265275">x</span><span class="op" id="6265276">,</span>&nbsp;<span class="ident" id="6265278">Sel</span><span class="op" id="6265281">:</span>&nbsp;<span class="ident" id="6265283">sel</span><span class="op" id="6265286">}</span><br>
<span class="lineno"></span><span class="op" id="6265288">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="6265291">func</span>&nbsp;<span class="op" id="6265296">(</span><span class="ident" id="6265297">p</span>&nbsp;<span class="op" id="6265299">*</span><span class="ident" id="6265300">parser</span><span class="op" id="6265306">)</span>&nbsp;<span class="ident" id="6265308">parseTypeAssertion</span><span class="op" id="6265326">(</span><span class="ident" id="6265327">x</span>&nbsp;<span class="ident" id="6265329">ast</span><span class="op" id="6265332">.</span><span class="ident" id="6265333">Expr</span><span class="op" id="6265337">)</span>&nbsp;<span class="ident" id="6265339">ast</span><span class="op" id="6265342">.</span><span class="ident" id="6265343">Expr</span>&nbsp;<span class="op" id="6265348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265351">if</span>&nbsp;<span class="ident" id="6265354">p</span><span class="op" id="6265355">.</span><span class="ident" id="6265356">trace</span>&nbsp;<span class="op" id="6265362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265366">defer</span>&nbsp;<span class="ident" id="6265372">un</span><span class="op" id="6265374">(</span><span class="ident" id="6265375">trace</span><span class="op" id="6265380">(</span><span class="ident" id="6265381">p</span><span class="op" id="6265382">,</span>&nbsp;<span class="string" id="6265384">&#34;TypeAssertion&#34;</span><span class="op" id="6265399">)</span><span class="op" id="6265400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265403">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265407">lparen</span>&nbsp;<span class="op" id="6265414">:=</span>&nbsp;<span class="ident" id="6265417">p</span><span class="op" id="6265418">.</span><span class="ident" id="6265419">expect</span><span class="op" id="6265425">(</span><span class="ident" id="6265426">token</span><span class="op" id="6265431">.</span><span class="ident" id="6265432">LPAREN</span><span class="op" id="6265438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265441">var</span>&nbsp;<span class="ident" id="6265445">typ</span>&nbsp;<span class="ident" id="6265449">ast</span><span class="op" id="6265452">.</span><span class="ident" id="6265453">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265459">if</span>&nbsp;<span class="ident" id="6265462">p</span><span class="op" id="6265463">.</span><span class="ident" id="6265464">tok</span>&nbsp;<span class="op" id="6265468">==</span>&nbsp;<span class="ident" id="6265471">token</span><span class="op" id="6265476">.</span><span class="ident" id="6265477">TYPE</span>&nbsp;<span class="op" id="6265482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265486">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265515">p</span><span class="op" id="6265516">.</span><span class="ident" id="6265517">next</span><span class="op" id="6265521">(</span><span class="op" id="6265522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265525">}</span>&nbsp;<span class="keyword" id="6265527">else</span>&nbsp;<span class="op" id="6265532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265536">typ</span>&nbsp;<span class="op" id="6265540">=</span>&nbsp;<span class="ident" id="6265542">p</span><span class="op" id="6265543">.</span><span class="ident" id="6265544">parseType</span><span class="op" id="6265553">(</span><span class="op" id="6265554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265560">rparen</span>&nbsp;<span class="op" id="6265567">:=</span>&nbsp;<span class="ident" id="6265570">p</span><span class="op" id="6265571">.</span><span class="ident" id="6265572">expect</span><span class="op" id="6265578">(</span><span class="ident" id="6265579">token</span><span class="op" id="6265584">.</span><span class="ident" id="6265585">RPAREN</span><span class="op" id="6265591">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265595">return</span>&nbsp;<span class="op" id="6265602">&amp;</span><span class="ident" id="6265603">ast</span><span class="op" id="6265606">.</span><span class="ident" id="6265607">TypeAssertExpr</span><span class="op" id="6265621">{</span><span class="ident" id="6265622">X</span><span class="op" id="6265623">:</span>&nbsp;<span class="ident" id="6265625">x</span><span class="op" id="6265626">,</span>&nbsp;<span class="ident" id="6265628">Type</span><span class="op" id="6265632">:</span>&nbsp;<span class="ident" id="6265634">typ</span><span class="op" id="6265637">,</span>&nbsp;<span class="ident" id="6265639">Lparen</span><span class="op" id="6265645">:</span>&nbsp;<span class="ident" id="6265647">lparen</span><span class="op" id="6265653">,</span>&nbsp;<span class="ident" id="6265655">Rparen</span><span class="op" id="6265661">:</span>&nbsp;<span class="ident" id="6265663">rparen</span><span class="op" id="6265669">}</span><br>
<span class="lineno"></span><span class="op" id="6265671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6265674">func</span>&nbsp;<span class="op" id="6265679">(</span><span class="ident" id="6265680">p</span>&nbsp;<span class="op" id="6265682">*</span><span class="ident" id="6265683">parser</span><span class="op" id="6265689">)</span>&nbsp;<span class="ident" id="6265691">parseIndexOrSlice</span><span class="op" id="6265708">(</span><span class="ident" id="6265709">x</span>&nbsp;<span class="ident" id="6265711">ast</span><span class="op" id="6265714">.</span><span class="ident" id="6265715">Expr</span><span class="op" id="6265719">)</span>&nbsp;<span class="ident" id="6265721">ast</span><span class="op" id="6265724">.</span><span class="ident" id="6265725">Expr</span>&nbsp;<span class="op" id="6265730">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265733">if</span>&nbsp;<span class="ident" id="6265736">p</span><span class="op" id="6265737">.</span><span class="ident" id="6265738">trace</span>&nbsp;<span class="op" id="6265744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265748">defer</span>&nbsp;<span class="ident" id="6265754">un</span><span class="op" id="6265756">(</span><span class="ident" id="6265757">trace</span><span class="op" id="6265762">(</span><span class="ident" id="6265763">p</span><span class="op" id="6265764">,</span>&nbsp;<span class="string" id="6265766">&#34;IndexOrSlice&#34;</span><span class="op" id="6265780">)</span><span class="op" id="6265781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265788">const</span>&nbsp;<span class="ident" id="6265794">N</span>&nbsp;<span class="op" id="6265796">=</span>&nbsp;<span class="num" id="6265798">3</span>&nbsp;<span class="comment" id="6265800">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265848">lbrack</span>&nbsp;<span class="op" id="6265855">:=</span>&nbsp;<span class="ident" id="6265858">p</span><span class="op" id="6265859">.</span><span class="ident" id="6265860">expect</span><span class="op" id="6265866">(</span><span class="ident" id="6265867">token</span><span class="op" id="6265872">.</span><span class="ident" id="6265873">LBRACK</span><span class="op" id="6265879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265882">p</span><span class="op" id="6265883">.</span><span class="ident" id="6265884">exprLev</span><span class="op" id="6265891">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265895">var</span>&nbsp;<span class="ident" id="6265899">index</span>&nbsp;<span class="op" id="6265905">[</span><span class="ident" id="6265906">N</span><span class="op" id="6265907">]</span><span class="ident" id="6265908">ast</span><span class="op" id="6265911">.</span><span class="ident" id="6265912">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265918">var</span>&nbsp;<span class="ident" id="6265922">colons</span>&nbsp;<span class="op" id="6265929">[</span><span class="ident" id="6265930">N</span>&nbsp;<span class="op" id="6265932">-</span>&nbsp;<span class="num" id="6265934">1</span><span class="op" id="6265935">]</span><span class="ident" id="6265936">token</span><span class="op" id="6265941">.</span><span class="ident" id="6265942">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265947">if</span>&nbsp;<span class="ident" id="6265950">p</span><span class="op" id="6265951">.</span><span class="ident" id="6265952">tok</span>&nbsp;<span class="op" id="6265956">!=</span>&nbsp;<span class="ident" id="6265959">token</span><span class="op" id="6265964">.</span><span class="ident" id="6265965">COLON</span>&nbsp;<span class="op" id="6265971">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265975">index</span><span class="op" id="6265980">[</span><span class="num" id="6265981">0</span><span class="op" id="6265982">]</span>&nbsp;<span class="op" id="6265984">=</span>&nbsp;<span class="ident" id="6265986">p</span><span class="op" id="6265987">.</span><span class="ident" id="6265988">parseRhs</span><span class="op" id="6265996">(</span><span class="op" id="6265997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266003">ncolons</span>&nbsp;<span class="op" id="6266011">:=</span>&nbsp;<span class="num" id="6266014">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266017">for</span>&nbsp;<span class="ident" id="6266021">p</span><span class="op" id="6266022">.</span><span class="ident" id="6266023">tok</span>&nbsp;<span class="op" id="6266027">==</span>&nbsp;<span class="ident" id="6266030">token</span><span class="op" id="6266035">.</span><span class="ident" id="6266036">COLON</span>&nbsp;<span class="op" id="6266042">&amp;&amp;</span>&nbsp;<span class="ident" id="6266045">ncolons</span>&nbsp;<span class="op" id="6266053">&lt;</span>&nbsp;<span class="builtinfunc" id="6266055">len</span><span class="op" id="6266058">(</span><span class="ident" id="6266059">colons</span><span class="op" id="6266065">)</span>&nbsp;<span class="op" id="6266067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266071">colons</span><span class="op" id="6266077">[</span><span class="ident" id="6266078">ncolons</span><span class="op" id="6266085">]</span>&nbsp;<span class="op" id="6266087">=</span>&nbsp;<span class="ident" id="6266089">p</span><span class="op" id="6266090">.</span><span class="ident" id="6266091">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266097">ncolons</span><span class="op" id="6266104">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266109">p</span><span class="op" id="6266110">.</span><span class="ident" id="6266111">next</span><span class="op" id="6266115">(</span><span class="op" id="6266116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266120">if</span>&nbsp;<span class="ident" id="6266123">p</span><span class="op" id="6266124">.</span><span class="ident" id="6266125">tok</span>&nbsp;<span class="op" id="6266129">!=</span>&nbsp;<span class="ident" id="6266132">token</span><span class="op" id="6266137">.</span><span class="ident" id="6266138">COLON</span>&nbsp;<span class="op" id="6266144">&amp;&amp;</span>&nbsp;<span class="ident" id="6266147">p</span><span class="op" id="6266148">.</span><span class="ident" id="6266149">tok</span>&nbsp;<span class="op" id="6266153">!=</span>&nbsp;<span class="ident" id="6266156">token</span><span class="op" id="6266161">.</span><span class="ident" id="6266162">RBRACK</span>&nbsp;<span class="op" id="6266169">&amp;&amp;</span>&nbsp;<span class="ident" id="6266172">p</span><span class="op" id="6266173">.</span><span class="ident" id="6266174">tok</span>&nbsp;<span class="op" id="6266178">!=</span>&nbsp;<span class="ident" id="6266181">token</span><span class="op" id="6266186">.</span><span class="ident" id="6266187">EOF</span>&nbsp;<span class="op" id="6266191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266196">index</span><span class="op" id="6266201">[</span><span class="ident" id="6266202">ncolons</span><span class="op" id="6266209">]</span>&nbsp;<span class="op" id="6266211">=</span>&nbsp;<span class="ident" id="6266213">p</span><span class="op" id="6266214">.</span><span class="ident" id="6266215">parseRhs</span><span class="op" id="6266223">(</span><span class="op" id="6266224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266228">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266234">p</span><span class="op" id="6266235">.</span><span class="ident" id="6266236">exprLev</span><span class="op" id="6266243">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266247">rbrack</span>&nbsp;<span class="op" id="6266254">:=</span>&nbsp;<span class="ident" id="6266257">p</span><span class="op" id="6266258">.</span><span class="ident" id="6266259">expect</span><span class="op" id="6266265">(</span><span class="ident" id="6266266">token</span><span class="op" id="6266271">.</span><span class="ident" id="6266272">RBRACK</span><span class="op" id="6266278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266282">if</span>&nbsp;<span class="ident" id="6266285">ncolons</span>&nbsp;<span class="op" id="6266293">&gt;</span>&nbsp;<span class="num" id="6266295">0</span>&nbsp;<span class="op" id="6266297">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266301">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266323">slice3</span>&nbsp;<span class="op" id="6266330">:=</span>&nbsp;<span class="builtintype" id="6266333">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266341">if</span>&nbsp;<span class="ident" id="6266344">ncolons</span>&nbsp;<span class="op" id="6266352">==</span>&nbsp;<span class="num" id="6266355">2</span>&nbsp;<span class="op" id="6266357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266362">slice3</span>&nbsp;<span class="op" id="6266369">=</span>&nbsp;<span class="builtintype" id="6266371">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266379">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266459">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266540">if</span>&nbsp;<span class="ident" id="6266543">index</span><span class="op" id="6266548">[</span><span class="num" id="6266549">1</span><span class="op" id="6266550">]</span>&nbsp;<span class="op" id="6266552">==</span>&nbsp;<span class="ident" id="6266555">nil</span>&nbsp;<span class="op" id="6266559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266565">p</span><span class="op" id="6266566">.</span><span class="builtintype" id="6266567">error</span><span class="op" id="6266572">(</span><span class="ident" id="6266573">colons</span><span class="op" id="6266579">[</span><span class="num" id="6266580">0</span><span class="op" id="6266581">]</span><span class="op" id="6266582">,</span>&nbsp;<span class="string" id="6266584">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="6266621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266627">index</span><span class="op" id="6266632">[</span><span class="num" id="6266633">1</span><span class="op" id="6266634">]</span>&nbsp;<span class="op" id="6266636">=</span>&nbsp;<span class="op" id="6266638">&amp;</span><span class="ident" id="6266639">ast</span><span class="op" id="6266642">.</span><span class="ident" id="6266643">BadExpr</span><span class="op" id="6266650">{</span><span class="ident" id="6266651">From</span><span class="op" id="6266655">:</span>&nbsp;<span class="ident" id="6266657">colons</span><span class="op" id="6266663">[</span><span class="num" id="6266664">0</span><span class="op" id="6266665">]</span>&nbsp;<span class="op" id="6266667">+</span>&nbsp;<span class="num" id="6266669">1</span><span class="op" id="6266670">,</span>&nbsp;<span class="ident" id="6266672">To</span><span class="op" id="6266674">:</span>&nbsp;<span class="ident" id="6266676">colons</span><span class="op" id="6266682">[</span><span class="num" id="6266683">1</span><span class="op" id="6266684">]</span><span class="op" id="6266685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266690">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266695">if</span>&nbsp;<span class="ident" id="6266698">index</span><span class="op" id="6266703">[</span><span class="num" id="6266704">2</span><span class="op" id="6266705">]</span>&nbsp;<span class="op" id="6266707">==</span>&nbsp;<span class="ident" id="6266710">nil</span>&nbsp;<span class="op" id="6266714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266720">p</span><span class="op" id="6266721">.</span><span class="builtintype" id="6266722">error</span><span class="op" id="6266727">(</span><span class="ident" id="6266728">colons</span><span class="op" id="6266734">[</span><span class="num" id="6266735">1</span><span class="op" id="6266736">]</span><span class="op" id="6266737">,</span>&nbsp;<span class="string" id="6266739">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="6266776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266782">index</span><span class="op" id="6266787">[</span><span class="num" id="6266788">2</span><span class="op" id="6266789">]</span>&nbsp;<span class="op" id="6266791">=</span>&nbsp;<span class="op" id="6266793">&amp;</span><span class="ident" id="6266794">ast</span><span class="op" id="6266797">.</span><span class="ident" id="6266798">BadExpr</span><span class="op" id="6266805">{</span><span class="ident" id="6266806">From</span><span class="op" id="6266810">:</span>&nbsp;<span class="ident" id="6266812">colons</span><span class="op" id="6266818">[</span><span class="num" id="6266819">1</span><span class="op" id="6266820">]</span>&nbsp;<span class="op" id="6266822">+</span>&nbsp;<span class="num" id="6266824">1</span><span class="op" id="6266825">,</span>&nbsp;<span class="ident" id="6266827">To</span><span class="op" id="6266829">:</span>&nbsp;<span class="ident" id="6266831">rbrack</span><span class="op" id="6266837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266846">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266850">return</span>&nbsp;<span class="op" id="6266857">&amp;</span><span class="ident" id="6266858">ast</span><span class="op" id="6266861">.</span><span class="ident" id="6266862">SliceExpr</span><span class="op" id="6266871">{</span><span class="ident" id="6266872">X</span><span class="op" id="6266873">:</span>&nbsp;<span class="ident" id="6266875">x</span><span class="op" id="6266876">,</span>&nbsp;<span class="ident" id="6266878">Lbrack</span><span class="op" id="6266884">:</span>&nbsp;<span class="ident" id="6266886">lbrack</span><span class="op" id="6266892">,</span>&nbsp;<span class="ident" id="6266894">Low</span><span class="op" id="6266897">:</span>&nbsp;<span class="ident" id="6266899">index</span><span class="op" id="6266904">[</span><span class="num" id="6266905">0</span><span class="op" id="6266906">]</span><span class="op" id="6266907">,</span>&nbsp;<span class="ident" id="6266909">High</span><span class="op" id="6266913">:</span>&nbsp;<span class="ident" id="6266915">index</span><span class="op" id="6266920">[</span><span class="num" id="6266921">1</span><span class="op" id="6266922">]</span><span class="op" id="6266923">,</span>&nbsp;<span class="ident" id="6266925">Max</span><span class="op" id="6266928">:</span>&nbsp;<span class="ident" id="6266930">index</span><span class="op" id="6266935">[</span><span class="num" id="6266936">2</span><span class="op" id="6266937">]</span><span class="op" id="6266938">,</span>&nbsp;<span class="ident" id="6266940">Slice3</span><span class="op" id="6266946">:</span>&nbsp;<span class="ident" id="6266948">slice3</span><span class="op" id="6266954">,</span>&nbsp;<span class="ident" id="6266956">Rbrack</span><span class="op" id="6266962">:</span>&nbsp;<span class="ident" id="6266964">rbrack</span><span class="op" id="6266970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266977">return</span>&nbsp;<span class="op" id="6266984">&amp;</span><span class="ident" id="6266985">ast</span><span class="op" id="6266988">.</span><span class="ident" id="6266989">IndexExpr</span><span class="op" id="6266998">{</span><span class="ident" id="6266999">X</span><span class="op" id="6267000">:</span>&nbsp;<span class="ident" id="6267002">x</span><span class="op" id="6267003">,</span>&nbsp;<span class="ident" id="6267005">Lbrack</span><span class="op" id="6267011">:</span>&nbsp;<span class="ident" id="6267013">lbrack</span><span class="op" id="6267019">,</span>&nbsp;<span class="ident" id="6267021">Index</span><span class="op" id="6267026">:</span>&nbsp;<span class="ident" id="6267028">index</span><span class="op" id="6267033">[</span><span class="num" id="6267034">0</span><span class="op" id="6267035">]</span><span class="op" id="6267036">,</span>&nbsp;<span class="ident" id="6267038">Rbrack</span><span class="op" id="6267044">:</span>&nbsp;<span class="ident" id="6267046">rbrack</span><span class="op" id="6267052">}</span><br>
<span class="lineno"></span><span class="op" id="6267054">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="6267057">func</span>&nbsp;<span class="op" id="6267062">(</span><span class="ident" id="6267063">p</span>&nbsp;<span class="op" id="6267065">*</span><span class="ident" id="6267066">parser</span><span class="op" id="6267072">)</span>&nbsp;<span class="ident" id="6267074">parseCallOrConversion</span><span class="op" id="6267095">(</span><span class="ident" id="6267096">fun</span>&nbsp;<span class="ident" id="6267100">ast</span><span class="op" id="6267103">.</span><span class="ident" id="6267104">Expr</span><span class="op" id="6267108">)</span>&nbsp;<span class="op" id="6267110">*</span><span class="ident" id="6267111">ast</span><span class="op" id="6267114">.</span><span class="ident" id="6267115">CallExpr</span>&nbsp;<span class="op" id="6267124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267127">if</span>&nbsp;<span class="ident" id="6267130">p</span><span class="op" id="6267131">.</span><span class="ident" id="6267132">trace</span>&nbsp;<span class="op" id="6267138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267142">defer</span>&nbsp;<span class="ident" id="6267148">un</span><span class="op" id="6267150">(</span><span class="ident" id="6267151">trace</span><span class="op" id="6267156">(</span><span class="ident" id="6267157">p</span><span class="op" id="6267158">,</span>&nbsp;<span class="string" id="6267160">&#34;CallOrConversion&#34;</span><span class="op" id="6267178">)</span><span class="op" id="6267179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267182">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267186">lparen</span>&nbsp;<span class="op" id="6267193">:=</span>&nbsp;<span class="ident" id="6267196">p</span><span class="op" id="6267197">.</span><span class="ident" id="6267198">expect</span><span class="op" id="6267204">(</span><span class="ident" id="6267205">token</span><span class="op" id="6267210">.</span><span class="ident" id="6267211">LPAREN</span><span class="op" id="6267217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267220">p</span><span class="op" id="6267221">.</span><span class="ident" id="6267222">exprLev</span><span class="op" id="6267229">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267233">var</span>&nbsp;<span class="ident" id="6267237">list</span>&nbsp;<span class="op" id="6267242">[</span><span class="op" id="6267243">]</span><span class="ident" id="6267244">ast</span><span class="op" id="6267247">.</span><span class="ident" id="6267248">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267254">var</span>&nbsp;<span class="ident" id="6267258">ellipsis</span>&nbsp;<span class="ident" id="6267267">token</span><span class="op" id="6267272">.</span><span class="ident" id="6267273">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267278">for</span>&nbsp;<span class="ident" id="6267282">p</span><span class="op" id="6267283">.</span><span class="ident" id="6267284">tok</span>&nbsp;<span class="op" id="6267288">!=</span>&nbsp;<span class="ident" id="6267291">token</span><span class="op" id="6267296">.</span><span class="ident" id="6267297">RPAREN</span>&nbsp;<span class="op" id="6267304">&amp;&amp;</span>&nbsp;<span class="ident" id="6267307">p</span><span class="op" id="6267308">.</span><span class="ident" id="6267309">tok</span>&nbsp;<span class="op" id="6267313">!=</span>&nbsp;<span class="ident" id="6267316">token</span><span class="op" id="6267321">.</span><span class="ident" id="6267322">EOF</span>&nbsp;<span class="op" id="6267326">&amp;&amp;</span>&nbsp;<span class="op" id="6267329">!</span><span class="ident" id="6267330">ellipsis</span><span class="op" id="6267338">.</span><span class="ident" id="6267339">IsValid</span><span class="op" id="6267346">(</span><span class="op" id="6267347">)</span>&nbsp;<span class="op" id="6267349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267353">list</span>&nbsp;<span class="op" id="6267358">=</span>&nbsp;<span class="builtinfunc" id="6267360">append</span><span class="op" id="6267366">(</span><span class="ident" id="6267367">list</span><span class="op" id="6267371">,</span>&nbsp;<span class="ident" id="6267373">p</span><span class="op" id="6267374">.</span><span class="ident" id="6267375">parseRhsOrType</span><span class="op" id="6267389">(</span><span class="op" id="6267390">)</span><span class="op" id="6267391">)</span>&nbsp;<span class="comment" id="6267393">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267447">if</span>&nbsp;<span class="ident" id="6267450">p</span><span class="op" id="6267451">.</span><span class="ident" id="6267452">tok</span>&nbsp;<span class="op" id="6267456">==</span>&nbsp;<span class="ident" id="6267459">token</span><span class="op" id="6267464">.</span><span class="ident" id="6267465">ELLIPSIS</span>&nbsp;<span class="op" id="6267474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267479">ellipsis</span>&nbsp;<span class="op" id="6267488">=</span>&nbsp;<span class="ident" id="6267490">p</span><span class="op" id="6267491">.</span><span class="ident" id="6267492">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267499">p</span><span class="op" id="6267500">.</span><span class="ident" id="6267501">next</span><span class="op" id="6267505">(</span><span class="op" id="6267506">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267514">if</span>&nbsp;<span class="op" id="6267517">!</span><span class="ident" id="6267518">p</span><span class="op" id="6267519">.</span><span class="ident" id="6267520">atComma</span><span class="op" id="6267527">(</span><span class="string" id="6267528">&#34;argument&nbsp;list&#34;</span><span class="op" id="6267543">)</span>&nbsp;<span class="op" id="6267545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267550">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267562">p</span><span class="op" id="6267563">.</span><span class="ident" id="6267564">next</span><span class="op" id="6267568">(</span><span class="op" id="6267569">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267575">p</span><span class="op" id="6267576">.</span><span class="ident" id="6267577">exprLev</span><span class="op" id="6267584">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267588">rparen</span>&nbsp;<span class="op" id="6267595">:=</span>&nbsp;<span class="ident" id="6267598">p</span><span class="op" id="6267599">.</span><span class="ident" id="6267600">expectClosing</span><span class="op" id="6267613">(</span><span class="ident" id="6267614">token</span><span class="op" id="6267619">.</span><span class="ident" id="6267620">RPAREN</span><span class="op" id="6267626">,</span>&nbsp;<span class="string" id="6267628">&#34;argument&nbsp;list&#34;</span><span class="op" id="6267643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267647">return</span>&nbsp;<span class="op" id="6267654">&amp;</span><span class="ident" id="6267655">ast</span><span class="op" id="6267658">.</span><span class="ident" id="6267659">CallExpr</span><span class="op" id="6267667">{</span><span class="ident" id="6267668">Fun</span><span class="op" id="6267671">:</span>&nbsp;<span class="ident" id="6267673">fun</span><span class="op" id="6267676">,</span>&nbsp;<span class="ident" id="6267678">Lparen</span><span class="op" id="6267684">:</span>&nbsp;<span class="ident" id="6267686">lparen</span><span class="op" id="6267692">,</span>&nbsp;<span class="ident" id="6267694">Args</span><span class="op" id="6267698">:</span>&nbsp;<span class="ident" id="6267700">list</span><span class="op" id="6267704">,</span>&nbsp;<span class="ident" id="6267706">Ellipsis</span><span class="op" id="6267714">:</span>&nbsp;<span class="ident" id="6267716">ellipsis</span><span class="op" id="6267724">,</span>&nbsp;<span class="ident" id="6267726">Rparen</span><span class="op" id="6267732">:</span>&nbsp;<span class="ident" id="6267734">rparen</span><span class="op" id="6267740">}</span><br>
<span class="lineno">1260</span><span class="op" id="6267742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6267745">func</span>&nbsp;<span class="op" id="6267750">(</span><span class="ident" id="6267751">p</span>&nbsp;<span class="op" id="6267753">*</span><span class="ident" id="6267754">parser</span><span class="op" id="6267760">)</span>&nbsp;<span class="ident" id="6267762">parseElement</span><span class="op" id="6267774">(</span><span class="ident" id="6267775">keyOk</span>&nbsp;<span class="builtintype" id="6267781">bool</span><span class="op" id="6267785">)</span>&nbsp;<span class="ident" id="6267787">ast</span><span class="op" id="6267790">.</span><span class="ident" id="6267791">Expr</span>&nbsp;<span class="op" id="6267796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267799">if</span>&nbsp;<span class="ident" id="6267802">p</span><span class="op" id="6267803">.</span><span class="ident" id="6267804">trace</span>&nbsp;<span class="op" id="6267810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267814">defer</span>&nbsp;<span class="ident" id="6267820">un</span><span class="op" id="6267822">(</span><span class="ident" id="6267823">trace</span><span class="op" id="6267828">(</span><span class="ident" id="6267829">p</span><span class="op" id="6267830">,</span>&nbsp;<span class="string" id="6267832">&#34;Element&#34;</span><span class="op" id="6267841">)</span><span class="op" id="6267842">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267849">if</span>&nbsp;<span class="ident" id="6267852">p</span><span class="op" id="6267853">.</span><span class="ident" id="6267854">tok</span>&nbsp;<span class="op" id="6267858">==</span>&nbsp;<span class="ident" id="6267861">token</span><span class="op" id="6267866">.</span><span class="ident" id="6267867">LBRACE</span>&nbsp;<span class="op" id="6267874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267878">return</span>&nbsp;<span class="ident" id="6267885">p</span><span class="op" id="6267886">.</span><span class="ident" id="6267887">parseLiteralValue</span><span class="op" id="6267904">(</span><span class="ident" id="6267905">nil</span><span class="op" id="6267908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267911">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267915">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267989">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268061">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268131">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268145">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268149">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268219">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268288">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268359">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268427">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268494">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268498">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268564">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268637">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268710">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268783">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268812">x</span>&nbsp;<span class="op" id="6268814">:=</span>&nbsp;<span class="ident" id="6268817">p</span><span class="op" id="6268818">.</span><span class="ident" id="6268819">checkExpr</span><span class="op" id="6268828">(</span><span class="ident" id="6268829">p</span><span class="op" id="6268830">.</span><span class="ident" id="6268831">parseExpr</span><span class="op" id="6268840">(</span><span class="ident" id="6268841">keyOk</span><span class="op" id="6268846">)</span><span class="op" id="6268847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268850">if</span>&nbsp;<span class="ident" id="6268853">keyOk</span>&nbsp;<span class="op" id="6268859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268863">if</span>&nbsp;<span class="ident" id="6268866">p</span><span class="op" id="6268867">.</span><span class="ident" id="6268868">tok</span>&nbsp;<span class="op" id="6268872">==</span>&nbsp;<span class="ident" id="6268875">token</span><span class="op" id="6268880">.</span><span class="ident" id="6268881">COLON</span>&nbsp;<span class="op" id="6268887">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268892">colon</span>&nbsp;<span class="op" id="6268898">:=</span>&nbsp;<span class="ident" id="6268901">p</span><span class="op" id="6268902">.</span><span class="ident" id="6268903">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268910">p</span><span class="op" id="6268911">.</span><span class="ident" id="6268912">next</span><span class="op" id="6268916">(</span><span class="op" id="6268917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268922">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268972">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269023">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269072">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269096">p</span><span class="op" id="6269097">.</span><span class="ident" id="6269098">tryResolve</span><span class="op" id="6269108">(</span><span class="ident" id="6269109">x</span><span class="op" id="6269110">,</span>&nbsp;<span class="builtintype" id="6269112">false</span><span class="op" id="6269117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269122">return</span>&nbsp;<span class="op" id="6269129">&amp;</span><span class="ident" id="6269130">ast</span><span class="op" id="6269133">.</span><span class="ident" id="6269134">KeyValueExpr</span><span class="op" id="6269146">{</span><span class="ident" id="6269147">Key</span><span class="op" id="6269150">:</span>&nbsp;<span class="ident" id="6269152">x</span><span class="op" id="6269153">,</span>&nbsp;<span class="ident" id="6269155">Colon</span><span class="op" id="6269160">:</span>&nbsp;<span class="ident" id="6269162">colon</span><span class="op" id="6269167">,</span>&nbsp;<span class="ident" id="6269169">Value</span><span class="op" id="6269174">:</span>&nbsp;<span class="ident" id="6269176">p</span><span class="op" id="6269177">.</span><span class="ident" id="6269178">parseElement</span><span class="op" id="6269190">(</span><span class="builtintype" id="6269191">false</span><span class="op" id="6269196">)</span><span class="op" id="6269197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269205">p</span><span class="op" id="6269206">.</span><span class="ident" id="6269207">resolve</span><span class="op" id="6269214">(</span><span class="ident" id="6269215">x</span><span class="op" id="6269216">)</span>&nbsp;<span class="comment" id="6269218">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269236">return</span>&nbsp;<span class="ident" id="6269243">x</span><br>
<span class="lineno"></span><span class="op" id="6269245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="6269248">func</span>&nbsp;<span class="op" id="6269253">(</span><span class="ident" id="6269254">p</span>&nbsp;<span class="op" id="6269256">*</span><span class="ident" id="6269257">parser</span><span class="op" id="6269263">)</span>&nbsp;<span class="ident" id="6269265">parseElementList</span><span class="op" id="6269281">(</span><span class="op" id="6269282">)</span>&nbsp;<span class="op" id="6269284">(</span><span class="ident" id="6269285">list</span>&nbsp;<span class="op" id="6269290">[</span><span class="op" id="6269291">]</span><span class="ident" id="6269292">ast</span><span class="op" id="6269295">.</span><span class="ident" id="6269296">Expr</span><span class="op" id="6269300">)</span>&nbsp;<span class="op" id="6269302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269305">if</span>&nbsp;<span class="ident" id="6269308">p</span><span class="op" id="6269309">.</span><span class="ident" id="6269310">trace</span>&nbsp;<span class="op" id="6269316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269320">defer</span>&nbsp;<span class="ident" id="6269326">un</span><span class="op" id="6269328">(</span><span class="ident" id="6269329">trace</span><span class="op" id="6269334">(</span><span class="ident" id="6269335">p</span><span class="op" id="6269336">,</span>&nbsp;<span class="string" id="6269338">&#34;ElementList&#34;</span><span class="op" id="6269351">)</span><span class="op" id="6269352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269359">for</span>&nbsp;<span class="ident" id="6269363">p</span><span class="op" id="6269364">.</span><span class="ident" id="6269365">tok</span>&nbsp;<span class="op" id="6269369">!=</span>&nbsp;<span class="ident" id="6269372">token</span><span class="op" id="6269377">.</span><span class="ident" id="6269378">RBRACE</span>&nbsp;<span class="op" id="6269385">&amp;&amp;</span>&nbsp;<span class="ident" id="6269388">p</span><span class="op" id="6269389">.</span><span class="ident" id="6269390">tok</span>&nbsp;<span class="op" id="6269394">!=</span>&nbsp;<span class="ident" id="6269397">token</span><span class="op" id="6269402">.</span><span class="ident" id="6269403">EOF</span>&nbsp;<span class="op" id="6269407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269411">list</span>&nbsp;<span class="op" id="6269416">=</span>&nbsp;<span class="builtinfunc" id="6269418">append</span><span class="op" id="6269424">(</span><span class="ident" id="6269425">list</span><span class="op" id="6269429">,</span>&nbsp;<span class="ident" id="6269431">p</span><span class="op" id="6269432">.</span><span class="ident" id="6269433">parseElement</span><span class="op" id="6269445">(</span><span class="builtintype" id="6269446">true</span><span class="op" id="6269450">)</span><span class="op" id="6269451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269455">if</span>&nbsp;<span class="op" id="6269458">!</span><span class="ident" id="6269459">p</span><span class="op" id="6269460">.</span><span class="ident" id="6269461">atComma</span><span class="op" id="6269468">(</span><span class="string" id="6269469">&#34;composite&nbsp;literal&#34;</span><span class="op" id="6269488">)</span>&nbsp;<span class="op" id="6269490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269495">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269503">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269507">p</span><span class="op" id="6269508">.</span><span class="ident" id="6269509">next</span><span class="op" id="6269513">(</span><span class="op" id="6269514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269521">return</span><br>
<span class="lineno"></span><span class="op" id="6269528">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="6269531">func</span>&nbsp;<span class="op" id="6269536">(</span><span class="ident" id="6269537">p</span>&nbsp;<span class="op" id="6269539">*</span><span class="ident" id="6269540">parser</span><span class="op" id="6269546">)</span>&nbsp;<span class="ident" id="6269548">parseLiteralValue</span><span class="op" id="6269565">(</span><span class="ident" id="6269566">typ</span>&nbsp;<span class="ident" id="6269570">ast</span><span class="op" id="6269573">.</span><span class="ident" id="6269574">Expr</span><span class="op" id="6269578">)</span>&nbsp;<span class="ident" id="6269580">ast</span><span class="op" id="6269583">.</span><span class="ident" id="6269584">Expr</span>&nbsp;<span class="op" id="6269589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269592">if</span>&nbsp;<span class="ident" id="6269595">p</span><span class="op" id="6269596">.</span><span class="ident" id="6269597">trace</span>&nbsp;<span class="op" id="6269603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269607">defer</span>&nbsp;<span class="ident" id="6269613">un</span><span class="op" id="6269615">(</span><span class="ident" id="6269616">trace</span><span class="op" id="6269621">(</span><span class="ident" id="6269622">p</span><span class="op" id="6269623">,</span>&nbsp;<span class="string" id="6269625">&#34;LiteralValue&#34;</span><span class="op" id="6269639">)</span><span class="op" id="6269640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269643">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269647">lbrace</span>&nbsp;<span class="op" id="6269654">:=</span>&nbsp;<span class="ident" id="6269657">p</span><span class="op" id="6269658">.</span><span class="ident" id="6269659">expect</span><span class="op" id="6269665">(</span><span class="ident" id="6269666">token</span><span class="op" id="6269671">.</span><span class="ident" id="6269672">LBRACE</span><span class="op" id="6269678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269681">var</span>&nbsp;<span class="ident" id="6269685">elts</span>&nbsp;<span class="op" id="6269690">[</span><span class="op" id="6269691">]</span><span class="ident" id="6269692">ast</span><span class="op" id="6269695">.</span><span class="ident" id="6269696">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269702">p</span><span class="op" id="6269703">.</span><span class="ident" id="6269704">exprLev</span><span class="op" id="6269711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269715">if</span>&nbsp;<span class="ident" id="6269718">p</span><span class="op" id="6269719">.</span><span class="ident" id="6269720">tok</span>&nbsp;<span class="op" id="6269724">!=</span>&nbsp;<span class="ident" id="6269727">token</span><span class="op" id="6269732">.</span><span class="ident" id="6269733">RBRACE</span>&nbsp;<span class="op" id="6269740">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269744">elts</span>&nbsp;<span class="op" id="6269749">=</span>&nbsp;<span class="ident" id="6269751">p</span><span class="op" id="6269752">.</span><span class="ident" id="6269753">parseElementList</span><span class="op" id="6269769">(</span><span class="op" id="6269770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269776">p</span><span class="op" id="6269777">.</span><span class="ident" id="6269778">exprLev</span><span class="op" id="6269785">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269789">rbrace</span>&nbsp;<span class="op" id="6269796">:=</span>&nbsp;<span class="ident" id="6269799">p</span><span class="op" id="6269800">.</span><span class="ident" id="6269801">expectClosing</span><span class="op" id="6269814">(</span><span class="ident" id="6269815">token</span><span class="op" id="6269820">.</span><span class="ident" id="6269821">RBRACE</span><span class="op" id="6269827">,</span>&nbsp;<span class="string" id="6269829">&#34;composite&nbsp;literal&#34;</span><span class="op" id="6269848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269851">return</span>&nbsp;<span class="op" id="6269858">&amp;</span><span class="ident" id="6269859">ast</span><span class="op" id="6269862">.</span><span class="ident" id="6269863">CompositeLit</span><span class="op" id="6269875">{</span><span class="ident" id="6269876">Type</span><span class="op" id="6269880">:</span>&nbsp;<span class="ident" id="6269882">typ</span><span class="op" id="6269885">,</span>&nbsp;<span class="ident" id="6269887">Lbrace</span><span class="op" id="6269893">:</span>&nbsp;<span class="ident" id="6269895">lbrace</span><span class="op" id="6269901">,</span>&nbsp;<span class="ident" id="6269903">Elts</span><span class="op" id="6269907">:</span>&nbsp;<span class="ident" id="6269909">elts</span><span class="op" id="6269913">,</span>&nbsp;<span class="ident" id="6269915">Rbrace</span><span class="op" id="6269921">:</span>&nbsp;<span class="ident" id="6269923">rbrace</span><span class="op" id="6269929">}</span><br>
<span class="lineno">1335</span><span class="op" id="6269931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6269934">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="6269996">func</span>&nbsp;<span class="op" id="6270001">(</span><span class="ident" id="6270002">p</span>&nbsp;<span class="op" id="6270004">*</span><span class="ident" id="6270005">parser</span><span class="op" id="6270011">)</span>&nbsp;<span class="ident" id="6270013">checkExpr</span><span class="op" id="6270022">(</span><span class="ident" id="6270023">x</span>&nbsp;<span class="ident" id="6270025">ast</span><span class="op" id="6270028">.</span><span class="ident" id="6270029">Expr</span><span class="op" id="6270033">)</span>&nbsp;<span class="ident" id="6270035">ast</span><span class="op" id="6270038">.</span><span class="ident" id="6270039">Expr</span>&nbsp;<span class="op" id="6270044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270047">switch</span>&nbsp;<span class="ident" id="6270054">unparen</span><span class="op" id="6270061">(</span><span class="ident" id="6270062">x</span><span class="op" id="6270063">)</span><span class="op" id="6270064">.</span><span class="op" id="6270065">(</span><span class="keyword" id="6270066">type</span><span class="op" id="6270070">)</span>&nbsp;<span class="op" id="6270072">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270075">case</span>&nbsp;<span class="op" id="6270080">*</span><span class="ident" id="6270081">ast</span><span class="op" id="6270084">.</span><span class="ident" id="6270085">BadExpr</span><span class="op" id="6270092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270095">case</span>&nbsp;<span class="op" id="6270100">*</span><span class="ident" id="6270101">ast</span><span class="op" id="6270104">.</span><span class="ident" id="6270105">Ident</span><span class="op" id="6270110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270113">case</span>&nbsp;<span class="op" id="6270118">*</span><span class="ident" id="6270119">ast</span><span class="op" id="6270122">.</span><span class="ident" id="6270123">BasicLit</span><span class="op" id="6270131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270134">case</span>&nbsp;<span class="op" id="6270139">*</span><span class="ident" id="6270140">ast</span><span class="op" id="6270143">.</span><span class="ident" id="6270144">FuncLit</span><span class="op" id="6270151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270154">case</span>&nbsp;<span class="op" id="6270159">*</span><span class="ident" id="6270160">ast</span><span class="op" id="6270163">.</span><span class="ident" id="6270164">CompositeLit</span><span class="op" id="6270176">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270179">case</span>&nbsp;<span class="op" id="6270184">*</span><span class="ident" id="6270185">ast</span><span class="op" id="6270188">.</span><span class="ident" id="6270189">ParenExpr</span><span class="op" id="6270198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6270202">panic</span><span class="op" id="6270207">(</span><span class="string" id="6270208">&#34;unreachable&#34;</span><span class="op" id="6270221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270224">case</span>&nbsp;<span class="op" id="6270229">*</span><span class="ident" id="6270230">ast</span><span class="op" id="6270233">.</span><span class="ident" id="6270234">SelectorExpr</span><span class="op" id="6270246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270249">case</span>&nbsp;<span class="op" id="6270254">*</span><span class="ident" id="6270255">ast</span><span class="op" id="6270258">.</span><span class="ident" id="6270259">IndexExpr</span><span class="op" id="6270268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270271">case</span>&nbsp;<span class="op" id="6270276">*</span><span class="ident" id="6270277">ast</span><span class="op" id="6270280">.</span><span class="ident" id="6270281">SliceExpr</span><span class="op" id="6270290">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270293">case</span>&nbsp;<span class="op" id="6270298">*</span><span class="ident" id="6270299">ast</span><span class="op" id="6270302">.</span><span class="ident" id="6270303">TypeAssertExpr</span><span class="op" id="6270317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270321">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270380">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270445">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270510">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270575">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270588">case</span>&nbsp;<span class="op" id="6270593">*</span><span class="ident" id="6270594">ast</span><span class="op" id="6270597">.</span><span class="ident" id="6270598">CallExpr</span><span class="op" id="6270606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270609">case</span>&nbsp;<span class="op" id="6270614">*</span><span class="ident" id="6270615">ast</span><span class="op" id="6270618">.</span><span class="ident" id="6270619">StarExpr</span><span class="op" id="6270627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270630">case</span>&nbsp;<span class="op" id="6270635">*</span><span class="ident" id="6270636">ast</span><span class="op" id="6270639">.</span><span class="ident" id="6270640">UnaryExpr</span><span class="op" id="6270649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270652">case</span>&nbsp;<span class="op" id="6270657">*</span><span class="ident" id="6270658">ast</span><span class="op" id="6270661">.</span><span class="ident" id="6270662">BinaryExpr</span><span class="op" id="6270672">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270675">default</span><span class="op" id="6270682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270686">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270734">p</span><span class="op" id="6270735">.</span><span class="ident" id="6270736">errorExpected</span><span class="op" id="6270749">(</span><span class="ident" id="6270750">x</span><span class="op" id="6270751">.</span><span class="ident" id="6270752">Pos</span><span class="op" id="6270755">(</span><span class="op" id="6270756">)</span><span class="op" id="6270757">,</span>&nbsp;<span class="string" id="6270759">&#34;expression&#34;</span><span class="op" id="6270771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270775">x</span>&nbsp;<span class="op" id="6270777">=</span>&nbsp;<span class="op" id="6270779">&amp;</span><span class="ident" id="6270780">ast</span><span class="op" id="6270783">.</span><span class="ident" id="6270784">BadExpr</span><span class="op" id="6270791">{</span><span class="ident" id="6270792">From</span><span class="op" id="6270796">:</span>&nbsp;<span class="ident" id="6270798">x</span><span class="op" id="6270799">.</span><span class="ident" id="6270800">Pos</span><span class="op" id="6270803">(</span><span class="op" id="6270804">)</span><span class="op" id="6270805">,</span>&nbsp;<span class="ident" id="6270807">To</span><span class="op" id="6270809">:</span>&nbsp;<span class="ident" id="6270811">p</span><span class="op" id="6270812">.</span><span class="ident" id="6270813">safePos</span><span class="op" id="6270820">(</span><span class="ident" id="6270821">x</span><span class="op" id="6270822">.</span><span class="ident" id="6270823">End</span><span class="op" id="6270826">(</span><span class="op" id="6270827">)</span><span class="op" id="6270828">)</span><span class="op" id="6270829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270832">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270835">return</span>&nbsp;<span class="ident" id="6270842">x</span><br>
<span class="lineno"></span><span class="op" id="6270844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6270847">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="6270907">func</span>&nbsp;<span class="ident" id="6270912">isTypeName</span><span class="op" id="6270922">(</span><span class="ident" id="6270923">x</span>&nbsp;<span class="ident" id="6270925">ast</span><span class="op" id="6270928">.</span><span class="ident" id="6270929">Expr</span><span class="op" id="6270933">)</span>&nbsp;<span class="builtintype" id="6270935">bool</span>&nbsp;<span class="op" id="6270940">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270943">switch</span>&nbsp;<span class="ident" id="6270950">t</span>&nbsp;<span class="op" id="6270952">:=</span>&nbsp;<span class="ident" id="6270955">x</span><span class="op" id="6270956">.</span><span class="op" id="6270957">(</span><span class="keyword" id="6270958">type</span><span class="op" id="6270962">)</span>&nbsp;<span class="op" id="6270964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270967">case</span>&nbsp;<span class="op" id="6270972">*</span><span class="ident" id="6270973">ast</span><span class="op" id="6270976">.</span><span class="ident" id="6270977">BadExpr</span><span class="op" id="6270984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270987">case</span>&nbsp;<span class="op" id="6270992">*</span><span class="ident" id="6270993">ast</span><span class="op" id="6270996">.</span><span class="ident" id="6270997">Ident</span><span class="op" id="6271002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271005">case</span>&nbsp;<span class="op" id="6271010">*</span><span class="ident" id="6271011">ast</span><span class="op" id="6271014">.</span><span class="ident" id="6271015">SelectorExpr</span><span class="op" id="6271027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271031">_</span><span class="op" id="6271032">,</span>&nbsp;<span class="ident" id="6271034">isIdent</span>&nbsp;<span class="op" id="6271042">:=</span>&nbsp;<span class="ident" id="6271045">t</span><span class="op" id="6271046">.</span><span class="ident" id="6271047">X</span><span class="op" id="6271048">.</span><span class="op" id="6271049">(</span><span class="op" id="6271050">*</span><span class="ident" id="6271051">ast</span><span class="op" id="6271054">.</span><span class="ident" id="6271055">Ident</span><span class="op" id="6271060">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271064">return</span>&nbsp;<span class="ident" id="6271071">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271080">default</span><span class="op" id="6271087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271091">return</span>&nbsp;<span class="builtintype" id="6271098">false</span>&nbsp;<span class="comment" id="6271104">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271146">return</span>&nbsp;<span class="builtintype" id="6271153">true</span><br>
<span class="lineno">1380</span><span class="op" id="6271158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271161">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="6271232">func</span>&nbsp;<span class="ident" id="6271237">isLiteralType</span><span class="op" id="6271250">(</span><span class="ident" id="6271251">x</span>&nbsp;<span class="ident" id="6271253">ast</span><span class="op" id="6271256">.</span><span class="ident" id="6271257">Expr</span><span class="op" id="6271261">)</span>&nbsp;<span class="builtintype" id="6271263">bool</span>&nbsp;<span class="op" id="6271268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271271">switch</span>&nbsp;<span class="ident" id="6271278">t</span>&nbsp;<span class="op" id="6271280">:=</span>&nbsp;<span class="ident" id="6271283">x</span><span class="op" id="6271284">.</span><span class="op" id="6271285">(</span><span class="keyword" id="6271286">type</span><span class="op" id="6271290">)</span>&nbsp;<span class="op" id="6271292">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271295">case</span>&nbsp;<span class="op" id="6271300">*</span><span class="ident" id="6271301">ast</span><span class="op" id="6271304">.</span><span class="ident" id="6271305">BadExpr</span><span class="op" id="6271312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271315">case</span>&nbsp;<span class="op" id="6271320">*</span><span class="ident" id="6271321">ast</span><span class="op" id="6271324">.</span><span class="ident" id="6271325">Ident</span><span class="op" id="6271330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271333">case</span>&nbsp;<span class="op" id="6271338">*</span><span class="ident" id="6271339">ast</span><span class="op" id="6271342">.</span><span class="ident" id="6271343">SelectorExpr</span><span class="op" id="6271355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271359">_</span><span class="op" id="6271360">,</span>&nbsp;<span class="ident" id="6271362">isIdent</span>&nbsp;<span class="op" id="6271370">:=</span>&nbsp;<span class="ident" id="6271373">t</span><span class="op" id="6271374">.</span><span class="ident" id="6271375">X</span><span class="op" id="6271376">.</span><span class="op" id="6271377">(</span><span class="op" id="6271378">*</span><span class="ident" id="6271379">ast</span><span class="op" id="6271382">.</span><span class="ident" id="6271383">Ident</span><span class="op" id="6271388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271392">return</span>&nbsp;<span class="ident" id="6271399">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271408">case</span>&nbsp;<span class="op" id="6271413">*</span><span class="ident" id="6271414">ast</span><span class="op" id="6271417">.</span><span class="ident" id="6271418">ArrayType</span><span class="op" id="6271427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271430">case</span>&nbsp;<span class="op" id="6271435">*</span><span class="ident" id="6271436">ast</span><span class="op" id="6271439">.</span><span class="ident" id="6271440">StructType</span><span class="op" id="6271450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271453">case</span>&nbsp;<span class="op" id="6271458">*</span><span class="ident" id="6271459">ast</span><span class="op" id="6271462">.</span><span class="ident" id="6271463">MapType</span><span class="op" id="6271470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271473">default</span><span class="op" id="6271480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271484">return</span>&nbsp;<span class="builtintype" id="6271491">false</span>&nbsp;<span class="comment" id="6271497">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271558">return</span>&nbsp;<span class="builtintype" id="6271565">true</span><br>
<span class="lineno"></span><span class="op" id="6271570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271573">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="6271641">func</span>&nbsp;<span class="ident" id="6271646">deref</span><span class="op" id="6271651">(</span><span class="ident" id="6271652">x</span>&nbsp;<span class="ident" id="6271654">ast</span><span class="op" id="6271657">.</span><span class="ident" id="6271658">Expr</span><span class="op" id="6271662">)</span>&nbsp;<span class="ident" id="6271664">ast</span><span class="op" id="6271667">.</span><span class="ident" id="6271668">Expr</span>&nbsp;<span class="op" id="6271673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271676">if</span>&nbsp;<span class="ident" id="6271679">p</span><span class="op" id="6271680">,</span>&nbsp;<span class="ident" id="6271682">isPtr</span>&nbsp;<span class="op" id="6271688">:=</span>&nbsp;<span class="ident" id="6271691">x</span><span class="op" id="6271692">.</span><span class="op" id="6271693">(</span><span class="op" id="6271694">*</span><span class="ident" id="6271695">ast</span><span class="op" id="6271698">.</span><span class="ident" id="6271699">StarExpr</span><span class="op" id="6271707">)</span><span class="op" id="6271708">;</span>&nbsp;<span class="ident" id="6271710">isPtr</span>&nbsp;<span class="op" id="6271716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271720">x</span>&nbsp;<span class="op" id="6271722">=</span>&nbsp;<span class="ident" id="6271724">p</span><span class="op" id="6271725">.</span><span class="ident" id="6271726">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271732">return</span>&nbsp;<span class="ident" id="6271739">x</span><br>
<span class="lineno">1405</span><span class="op" id="6271741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6271744">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6271824">func</span>&nbsp;<span class="ident" id="6271829">unparen</span><span class="op" id="6271836">(</span><span class="ident" id="6271837">x</span>&nbsp;<span class="ident" id="6271839">ast</span><span class="op" id="6271842">.</span><span class="ident" id="6271843">Expr</span><span class="op" id="6271847">)</span>&nbsp;<span class="ident" id="6271849">ast</span><span class="op" id="6271852">.</span><span class="ident" id="6271853">Expr</span>&nbsp;<span class="op" id="6271858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271861">if</span>&nbsp;<span class="ident" id="6271864">p</span><span class="op" id="6271865">,</span>&nbsp;<span class="ident" id="6271867">isParen</span>&nbsp;<span class="op" id="6271875">:=</span>&nbsp;<span class="ident" id="6271878">x</span><span class="op" id="6271879">.</span><span class="op" id="6271880">(</span><span class="op" id="6271881">*</span><span class="ident" id="6271882">ast</span><span class="op" id="6271885">.</span><span class="ident" id="6271886">ParenExpr</span><span class="op" id="6271895">)</span><span class="op" id="6271896">;</span>&nbsp;<span class="ident" id="6271898">isParen</span>&nbsp;<span class="op" id="6271906">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271910">x</span>&nbsp;<span class="op" id="6271912">=</span>&nbsp;<span class="ident" id="6271914">unparen</span><span class="op" id="6271921">(</span><span class="ident" id="6271922">p</span><span class="op" id="6271923">.</span><span class="ident" id="6271924">X</span><span class="op" id="6271925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271931">return</span>&nbsp;<span class="ident" id="6271938">x</span><br>
<span class="lineno"></span><span class="op" id="6271940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="6271943">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="6272003">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="6272043">//</span><br>
<span class="lineno"></span><span class="keyword" id="6272046">func</span>&nbsp;<span class="op" id="6272051">(</span><span class="ident" id="6272052">p</span>&nbsp;<span class="op" id="6272054">*</span><span class="ident" id="6272055">parser</span><span class="op" id="6272061">)</span>&nbsp;<span class="ident" id="6272063">checkExprOrType</span><span class="op" id="6272078">(</span><span class="ident" id="6272079">x</span>&nbsp;<span class="ident" id="6272081">ast</span><span class="op" id="6272084">.</span><span class="ident" id="6272085">Expr</span><span class="op" id="6272089">)</span>&nbsp;<span class="ident" id="6272091">ast</span><span class="op" id="6272094">.</span><span class="ident" id="6272095">Expr</span>&nbsp;<span class="op" id="6272100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272103">switch</span>&nbsp;<span class="ident" id="6272110">t</span>&nbsp;<span class="op" id="6272112">:=</span>&nbsp;<span class="ident" id="6272115">unparen</span><span class="op" id="6272122">(</span><span class="ident" id="6272123">x</span><span class="op" id="6272124">)</span><span class="op" id="6272125">.</span><span class="op" id="6272126">(</span><span class="keyword" id="6272127">type</span><span class="op" id="6272131">)</span>&nbsp;<span class="op" id="6272133">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272136">case</span>&nbsp;<span class="op" id="6272141">*</span><span class="ident" id="6272142">ast</span><span class="op" id="6272145">.</span><span class="ident" id="6272146">ParenExpr</span><span class="op" id="6272155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6272159">panic</span><span class="op" id="6272164">(</span><span class="string" id="6272165">&#34;unreachable&#34;</span><span class="op" id="6272178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272181">case</span>&nbsp;<span class="op" id="6272186">*</span><span class="ident" id="6272187">ast</span><span class="op" id="6272190">.</span><span class="ident" id="6272191">UnaryExpr</span><span class="op" id="6272200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272203">case</span>&nbsp;<span class="op" id="6272208">*</span><span class="ident" id="6272209">ast</span><span class="op" id="6272212">.</span><span class="ident" id="6272213">ArrayType</span><span class="op" id="6272222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272226">if</span>&nbsp;<span class="builtinfunc" id="6272229">len</span><span class="op" id="6272232">,</span>&nbsp;<span class="ident" id="6272234">isEllipsis</span>&nbsp;<span class="op" id="6272245">:=</span>&nbsp;<span class="ident" id="6272248">t</span><span class="op" id="6272249">.</span><span class="ident" id="6272250">Len</span><span class="op" id="6272253">.</span><span class="op" id="6272254">(</span><span class="op" id="6272255">*</span><span class="ident" id="6272256">ast</span><span class="op" id="6272259">.</span><span class="ident" id="6272260">Ellipsis</span><span class="op" id="6272268">)</span><span class="op" id="6272269">;</span>&nbsp;<span class="ident" id="6272271">isEllipsis</span>&nbsp;<span class="op" id="6272282">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272287">p</span><span class="op" id="6272288">.</span><span class="builtintype" id="6272289">error</span><span class="op" id="6272294">(</span><span class="builtinfunc" id="6272295">len</span><span class="op" id="6272298">.</span><span class="ident" id="6272299">Pos</span><span class="op" id="6272302">(</span><span class="op" id="6272303">)</span><span class="op" id="6272304">,</span>&nbsp;<span class="string" id="6272306">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="6272342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272347">x</span>&nbsp;<span class="op" id="6272349">=</span>&nbsp;<span class="op" id="6272351">&amp;</span><span class="ident" id="6272352">ast</span><span class="op" id="6272355">.</span><span class="ident" id="6272356">BadExpr</span><span class="op" id="6272363">{</span><span class="ident" id="6272364">From</span><span class="op" id="6272368">:</span>&nbsp;<span class="ident" id="6272370">x</span><span class="op" id="6272371">.</span><span class="ident" id="6272372">Pos</span><span class="op" id="6272375">(</span><span class="op" id="6272376">)</span><span class="op" id="6272377">,</span>&nbsp;<span class="ident" id="6272379">To</span><span class="op" id="6272381">:</span>&nbsp;<span class="ident" id="6272383">p</span><span class="op" id="6272384">.</span><span class="ident" id="6272385">safePos</span><span class="op" id="6272392">(</span><span class="ident" id="6272393">x</span><span class="op" id="6272394">.</span><span class="ident" id="6272395">End</span><span class="op" id="6272398">(</span><span class="op" id="6272399">)</span><span class="op" id="6272400">)</span><span class="op" id="6272401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6272412">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272457">return</span>&nbsp;<span class="ident" id="6272464">x</span><br>
<span class="lineno"></span><span class="op" id="6272466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6272469">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="6272539">func</span>&nbsp;<span class="op" id="6272544">(</span><span class="ident" id="6272545">p</span>&nbsp;<span class="op" id="6272547">*</span><span class="ident" id="6272548">parser</span><span class="op" id="6272554">)</span>&nbsp;<span class="ident" id="6272556">parsePrimaryExpr</span><span class="op" id="6272572">(</span><span class="ident" id="6272573">lhs</span>&nbsp;<span class="builtintype" id="6272577">bool</span><span class="op" id="6272581">)</span>&nbsp;<span class="ident" id="6272583">ast</span><span class="op" id="6272586">.</span><span class="ident" id="6272587">Expr</span>&nbsp;<span class="op" id="6272592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272595">if</span>&nbsp;<span class="ident" id="6272598">p</span><span class="op" id="6272599">.</span><span class="ident" id="6272600">trace</span>&nbsp;<span class="op" id="6272606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272610">defer</span>&nbsp;<span class="ident" id="6272616">un</span><span class="op" id="6272618">(</span><span class="ident" id="6272619">trace</span><span class="op" id="6272624">(</span><span class="ident" id="6272625">p</span><span class="op" id="6272626">,</span>&nbsp;<span class="string" id="6272628">&#34;PrimaryExpr&#34;</span><span class="op" id="6272641">)</span><span class="op" id="6272642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272649">x</span>&nbsp;<span class="op" id="6272651">:=</span>&nbsp;<span class="ident" id="6272654">p</span><span class="op" id="6272655">.</span><span class="ident" id="6272656">parseOperand</span><span class="op" id="6272668">(</span><span class="ident" id="6272669">lhs</span><span class="op" id="6272672">)</span><br>
<span class="lineno"></span><span class="ident" id="6272674">L</span><span class="op" id="6272675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272678">for</span>&nbsp;<span class="op" id="6272682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272686">switch</span>&nbsp;<span class="ident" id="6272693">p</span><span class="op" id="6272694">.</span><span class="ident" id="6272695">tok</span>&nbsp;<span class="op" id="6272699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272703">case</span>&nbsp;<span class="ident" id="6272708">token</span><span class="op" id="6272713">.</span><span class="ident" id="6272714">PERIOD</span><span class="op" id="6272720">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272725">p</span><span class="op" id="6272726">.</span><span class="ident" id="6272727">next</span><span class="op" id="6272731">(</span><span class="op" id="6272732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272737">if</span>&nbsp;<span class="ident" id="6272740">lhs</span>&nbsp;<span class="op" id="6272744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272750">p</span><span class="op" id="6272751">.</span><span class="ident" id="6272752">resolve</span><span class="op" id="6272759">(</span><span class="ident" id="6272760">x</span><span class="op" id="6272761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272771">switch</span>&nbsp;<span class="ident" id="6272778">p</span><span class="op" id="6272779">.</span><span class="ident" id="6272780">tok</span>&nbsp;<span class="op" id="6272784">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272789">case</span>&nbsp;<span class="ident" id="6272794">token</span><span class="op" id="6272799">.</span><span class="ident" id="6272800">IDENT</span><span class="op" id="6272805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272811">x</span>&nbsp;<span class="op" id="6272813">=</span>&nbsp;<span class="ident" id="6272815">p</span><span class="op" id="6272816">.</span><span class="ident" id="6272817">parseSelector</span><span class="op" id="6272830">(</span><span class="ident" id="6272831">p</span><span class="op" id="6272832">.</span><span class="ident" id="6272833">checkExprOrType</span><span class="op" id="6272848">(</span><span class="ident" id="6272849">x</span><span class="op" id="6272850">)</span><span class="op" id="6272851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272856">case</span>&nbsp;<span class="ident" id="6272861">token</span><span class="op" id="6272866">.</span><span class="ident" id="6272867">LPAREN</span><span class="op" id="6272873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272879">x</span>&nbsp;<span class="op" id="6272881">=</span>&nbsp;<span class="ident" id="6272883">p</span><span class="op" id="6272884">.</span><span class="ident" id="6272885">parseTypeAssertion</span><span class="op" id="6272903">(</span><span class="ident" id="6272904">p</span><span class="op" id="6272905">.</span><span class="ident" id="6272906">checkExpr</span><span class="op" id="6272915">(</span><span class="ident" id="6272916">x</span><span class="op" id="6272917">)</span><span class="op" id="6272918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272923">default</span><span class="op" id="6272930">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272936">pos</span>&nbsp;<span class="op" id="6272940">:=</span>&nbsp;<span class="ident" id="6272943">p</span><span class="op" id="6272944">.</span><span class="ident" id="6272945">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272953">p</span><span class="op" id="6272954">.</span><span class="ident" id="6272955">errorExpected</span><span class="op" id="6272968">(</span><span class="ident" id="6272969">pos</span><span class="op" id="6272972">,</span>&nbsp;<span class="string" id="6272974">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="6273002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273008">p</span><span class="op" id="6273009">.</span><span class="ident" id="6273010">next</span><span class="op" id="6273014">(</span><span class="op" id="6273015">)</span>&nbsp;<span class="comment" id="6273017">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273038">x</span>&nbsp;<span class="op" id="6273040">=</span>&nbsp;<span class="op" id="6273042">&amp;</span><span class="ident" id="6273043">ast</span><span class="op" id="6273046">.</span><span class="ident" id="6273047">BadExpr</span><span class="op" id="6273054">{</span><span class="ident" id="6273055">From</span><span class="op" id="6273059">:</span>&nbsp;<span class="ident" id="6273061">pos</span><span class="op" id="6273064">,</span>&nbsp;<span class="ident" id="6273066">To</span><span class="op" id="6273068">:</span>&nbsp;<span class="ident" id="6273070">p</span><span class="op" id="6273071">.</span><span class="ident" id="6273072">pos</span><span class="op" id="6273075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273080">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273084">case</span>&nbsp;<span class="ident" id="6273089">token</span><span class="op" id="6273094">.</span><span class="ident" id="6273095">LBRACK</span><span class="op" id="6273101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273106">if</span>&nbsp;<span class="ident" id="6273109">lhs</span>&nbsp;<span class="op" id="6273113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273119">p</span><span class="op" id="6273120">.</span><span class="ident" id="6273121">resolve</span><span class="op" id="6273128">(</span><span class="ident" id="6273129">x</span><span class="op" id="6273130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273140">x</span>&nbsp;<span class="op" id="6273142">=</span>&nbsp;<span class="ident" id="6273144">p</span><span class="op" id="6273145">.</span><span class="ident" id="6273146">parseIndexOrSlice</span><span class="op" id="6273163">(</span><span class="ident" id="6273164">p</span><span class="op" id="6273165">.</span><span class="ident" id="6273166">checkExpr</span><span class="op" id="6273175">(</span><span class="ident" id="6273176">x</span><span class="op" id="6273177">)</span><span class="op" id="6273178">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273182">case</span>&nbsp;<span class="ident" id="6273187">token</span><span class="op" id="6273192">.</span><span class="ident" id="6273193">LPAREN</span><span class="op" id="6273199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273204">if</span>&nbsp;<span class="ident" id="6273207">lhs</span>&nbsp;<span class="op" id="6273211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273217">p</span><span class="op" id="6273218">.</span><span class="ident" id="6273219">resolve</span><span class="op" id="6273226">(</span><span class="ident" id="6273227">x</span><span class="op" id="6273228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273238">x</span>&nbsp;<span class="op" id="6273240">=</span>&nbsp;<span class="ident" id="6273242">p</span><span class="op" id="6273243">.</span><span class="ident" id="6273244">parseCallOrConversion</span><span class="op" id="6273265">(</span><span class="ident" id="6273266">p</span><span class="op" id="6273267">.</span><span class="ident" id="6273268">checkExprOrType</span><span class="op" id="6273283">(</span><span class="ident" id="6273284">x</span><span class="op" id="6273285">)</span><span class="op" id="6273286">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273290">case</span>&nbsp;<span class="ident" id="6273295">token</span><span class="op" id="6273300">.</span><span class="ident" id="6273301">LBRACE</span><span class="op" id="6273307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273312">if</span>&nbsp;<span class="ident" id="6273315">isLiteralType</span><span class="op" id="6273328">(</span><span class="ident" id="6273329">x</span><span class="op" id="6273330">)</span>&nbsp;<span class="op" id="6273332">&amp;&amp;</span>&nbsp;<span class="op" id="6273335">(</span><span class="ident" id="6273336">p</span><span class="op" id="6273337">.</span><span class="ident" id="6273338">exprLev</span>&nbsp;<span class="op" id="6273346">&gt;=</span>&nbsp;<span class="num" id="6273349">0</span>&nbsp;<span class="op" id="6273351">||</span>&nbsp;<span class="op" id="6273354">!</span><span class="ident" id="6273355">isTypeName</span><span class="op" id="6273365">(</span><span class="ident" id="6273366">x</span><span class="op" id="6273367">)</span><span class="op" id="6273368">)</span>&nbsp;<span class="op" id="6273370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273376">if</span>&nbsp;<span class="ident" id="6273379">lhs</span>&nbsp;<span class="op" id="6273383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273390">p</span><span class="op" id="6273391">.</span><span class="ident" id="6273392">resolve</span><span class="op" id="6273399">(</span><span class="ident" id="6273400">x</span><span class="op" id="6273401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273407">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273413">x</span>&nbsp;<span class="op" id="6273415">=</span>&nbsp;<span class="ident" id="6273417">p</span><span class="op" id="6273418">.</span><span class="ident" id="6273419">parseLiteralValue</span><span class="op" id="6273436">(</span><span class="ident" id="6273437">x</span><span class="op" id="6273438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273443">}</span>&nbsp;<span class="keyword" id="6273445">else</span>&nbsp;<span class="op" id="6273450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273456">break</span>&nbsp;<span class="ident" id="6273462">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273471">default</span><span class="op" id="6273478">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273483">break</span>&nbsp;<span class="ident" id="6273489">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273497">lhs</span>&nbsp;<span class="op" id="6273501">=</span>&nbsp;<span class="builtintype" id="6273503">false</span>&nbsp;<span class="comment" id="6273509">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273549">return</span>&nbsp;<span class="ident" id="6273556">x</span><br>
<span class="lineno"></span><span class="op" id="6273558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6273561">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6273631">func</span>&nbsp;<span class="op" id="6273636">(</span><span class="ident" id="6273637">p</span>&nbsp;<span class="op" id="6273639">*</span><span class="ident" id="6273640">parser</span><span class="op" id="6273646">)</span>&nbsp;<span class="ident" id="6273648">parseUnaryExpr</span><span class="op" id="6273662">(</span><span class="ident" id="6273663">lhs</span>&nbsp;<span class="builtintype" id="6273667">bool</span><span class="op" id="6273671">)</span>&nbsp;<span class="ident" id="6273673">ast</span><span class="op" id="6273676">.</span><span class="ident" id="6273677">Expr</span>&nbsp;<span class="op" id="6273682">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273685">if</span>&nbsp;<span class="ident" id="6273688">p</span><span class="op" id="6273689">.</span><span class="ident" id="6273690">trace</span>&nbsp;<span class="op" id="6273696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273700">defer</span>&nbsp;<span class="ident" id="6273706">un</span><span class="op" id="6273708">(</span><span class="ident" id="6273709">trace</span><span class="op" id="6273714">(</span><span class="ident" id="6273715">p</span><span class="op" id="6273716">,</span>&nbsp;<span class="string" id="6273718">&#34;UnaryExpr&#34;</span><span class="op" id="6273729">)</span><span class="op" id="6273730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273737">switch</span>&nbsp;<span class="ident" id="6273744">p</span><span class="op" id="6273745">.</span><span class="ident" id="6273746">tok</span>&nbsp;<span class="op" id="6273750">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273753">case</span>&nbsp;<span class="ident" id="6273758">token</span><span class="op" id="6273763">.</span><span class="ident" id="6273764">ADD</span><span class="op" id="6273767">,</span>&nbsp;<span class="ident" id="6273769">token</span><span class="op" id="6273774">.</span><span class="ident" id="6273775">SUB</span><span class="op" id="6273778">,</span>&nbsp;<span class="ident" id="6273780">token</span><span class="op" id="6273785">.</span><span class="ident" id="6273786">NOT</span><span class="op" id="6273789">,</span>&nbsp;<span class="ident" id="6273791">token</span><span class="op" id="6273796">.</span><span class="ident" id="6273797">XOR</span><span class="op" id="6273800">,</span>&nbsp;<span class="ident" id="6273802">token</span><span class="op" id="6273807">.</span><span class="ident" id="6273808">AND</span><span class="op" id="6273811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273815">pos</span><span class="op" id="6273818">,</span>&nbsp;<span class="ident" id="6273820">op</span>&nbsp;<span class="op" id="6273823">:=</span>&nbsp;<span class="ident" id="6273826">p</span><span class="op" id="6273827">.</span><span class="ident" id="6273828">pos</span><span class="op" id="6273831">,</span>&nbsp;<span class="ident" id="6273833">p</span><span class="op" id="6273834">.</span><span class="ident" id="6273835">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273841">p</span><span class="op" id="6273842">.</span><span class="ident" id="6273843">next</span><span class="op" id="6273847">(</span><span class="op" id="6273848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273852">x</span>&nbsp;<span class="op" id="6273854">:=</span>&nbsp;<span class="ident" id="6273857">p</span><span class="op" id="6273858">.</span><span class="ident" id="6273859">parseUnaryExpr</span><span class="op" id="6273873">(</span><span class="builtintype" id="6273874">false</span><span class="op" id="6273879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273883">return</span>&nbsp;<span class="op" id="6273890">&amp;</span><span class="ident" id="6273891">ast</span><span class="op" id="6273894">.</span><span class="ident" id="6273895">UnaryExpr</span><span class="op" id="6273904">{</span><span class="ident" id="6273905">OpPos</span><span class="op" id="6273910">:</span>&nbsp;<span class="ident" id="6273912">pos</span><span class="op" id="6273915">,</span>&nbsp;<span class="ident" id="6273917">Op</span><span class="op" id="6273919">:</span>&nbsp;<span class="ident" id="6273921">op</span><span class="op" id="6273923">,</span>&nbsp;<span class="ident" id="6273925">X</span><span class="op" id="6273926">:</span>&nbsp;<span class="ident" id="6273928">p</span><span class="op" id="6273929">.</span><span class="ident" id="6273930">checkExpr</span><span class="op" id="6273939">(</span><span class="ident" id="6273940">x</span><span class="op" id="6273941">)</span><span class="op" id="6273942">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273946">case</span>&nbsp;<span class="ident" id="6273951">token</span><span class="op" id="6273956">.</span><span class="ident" id="6273957">ARROW</span><span class="op" id="6273962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6273966">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274006">arrow</span>&nbsp;<span class="op" id="6274012">:=</span>&nbsp;<span class="ident" id="6274015">p</span><span class="op" id="6274016">.</span><span class="ident" id="6274017">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274023">p</span><span class="op" id="6274024">.</span><span class="ident" id="6274025">next</span><span class="op" id="6274029">(</span><span class="op" id="6274030">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274035">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274098">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274159">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274222">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274242">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274247">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274296">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274356">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274361">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274422">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274460">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274465">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274508">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274556">x</span>&nbsp;<span class="op" id="6274558">:=</span>&nbsp;<span class="ident" id="6274561">p</span><span class="op" id="6274562">.</span><span class="ident" id="6274563">parseUnaryExpr</span><span class="op" id="6274577">(</span><span class="builtintype" id="6274578">false</span><span class="op" id="6274583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274588">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6274622">if</span>&nbsp;<span class="ident" id="6274625">typ</span><span class="op" id="6274628">,</span>&nbsp;<span class="ident" id="6274630">ok</span>&nbsp;<span class="op" id="6274633">:=</span>&nbsp;<span class="ident" id="6274636">x</span><span class="op" id="6274637">.</span><span class="op" id="6274638">(</span><span class="op" id="6274639">*</span><span class="ident" id="6274640">ast</span><span class="op" id="6274643">.</span><span class="ident" id="6274644">ChanType</span><span class="op" id="6274652">)</span><span class="op" id="6274653">;</span>&nbsp;<span class="ident" id="6274655">ok</span>&nbsp;<span class="op" id="6274658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274663">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274679">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274719">dir</span>&nbsp;<span class="op" id="6274723">:=</span>&nbsp;<span class="ident" id="6274726">ast</span><span class="op" id="6274729">.</span><span class="ident" id="6274730">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6274738">for</span>&nbsp;<span class="ident" id="6274742">ok</span>&nbsp;<span class="op" id="6274745">&amp;&amp;</span>&nbsp;<span class="ident" id="6274748">dir</span>&nbsp;<span class="op" id="6274752">==</span>&nbsp;<span class="ident" id="6274755">ast</span><span class="op" id="6274758">.</span><span class="ident" id="6274759">SEND</span>&nbsp;<span class="op" id="6274764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6274770">if</span>&nbsp;<span class="ident" id="6274773">typ</span><span class="op" id="6274776">.</span><span class="ident" id="6274777">Dir</span>&nbsp;<span class="op" id="6274781">==</span>&nbsp;<span class="ident" id="6274784">ast</span><span class="op" id="6274787">.</span><span class="ident" id="6274788">RECV</span>&nbsp;<span class="op" id="6274793">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274800">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274842">p</span><span class="op" id="6274843">.</span><span class="ident" id="6274844">errorExpected</span><span class="op" id="6274857">(</span><span class="ident" id="6274858">typ</span><span class="op" id="6274861">.</span><span class="ident" id="6274862">Arrow</span><span class="op" id="6274867">,</span>&nbsp;<span class="string" id="6274869">&#34;&#39;chan&#39;&#34;</span><span class="op" id="6274877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6274883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274889">arrow</span><span class="op" id="6274894">,</span>&nbsp;<span class="ident" id="6274896">typ</span><span class="op" id="6274899">.</span><span class="ident" id="6274900">Begin</span><span class="op" id="6274905">,</span>&nbsp;<span class="ident" id="6274907">typ</span><span class="op" id="6274910">.</span><span class="ident" id="6274911">Arrow</span>&nbsp;<span class="op" id="6274917">=</span>&nbsp;<span class="ident" id="6274919">typ</span><span class="op" id="6274922">.</span><span class="ident" id="6274923">Arrow</span><span class="op" id="6274928">,</span>&nbsp;<span class="ident" id="6274930">arrow</span><span class="op" id="6274935">,</span>&nbsp;<span class="ident" id="6274937">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274947">dir</span><span class="op" id="6274950">,</span>&nbsp;<span class="ident" id="6274952">typ</span><span class="op" id="6274955">.</span><span class="ident" id="6274956">Dir</span>&nbsp;<span class="op" id="6274960">=</span>&nbsp;<span class="ident" id="6274962">typ</span><span class="op" id="6274965">.</span><span class="ident" id="6274966">Dir</span><span class="op" id="6274969">,</span>&nbsp;<span class="ident" id="6274971">ast</span><span class="op" id="6274974">.</span><span class="ident" id="6274975">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274984">typ</span><span class="op" id="6274987">,</span>&nbsp;<span class="ident" id="6274989">ok</span>&nbsp;<span class="op" id="6274992">=</span>&nbsp;<span class="ident" id="6274994">typ</span><span class="op" id="6274997">.</span><span class="ident" id="6274998">Value</span><span class="op" id="6275003">.</span><span class="op" id="6275004">(</span><span class="op" id="6275005">*</span><span class="ident" id="6275006">ast</span><span class="op" id="6275009">.</span><span class="ident" id="6275010">ChanType</span><span class="op" id="6275018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275028">if</span>&nbsp;<span class="ident" id="6275031">dir</span>&nbsp;<span class="op" id="6275035">==</span>&nbsp;<span class="ident" id="6275038">ast</span><span class="op" id="6275041">.</span><span class="ident" id="6275042">SEND</span>&nbsp;<span class="op" id="6275047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275053">p</span><span class="op" id="6275054">.</span><span class="ident" id="6275055">errorExpected</span><span class="op" id="6275068">(</span><span class="ident" id="6275069">arrow</span><span class="op" id="6275074">,</span>&nbsp;<span class="string" id="6275076">&#34;channel&nbsp;type&#34;</span><span class="op" id="6275090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275095">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275101">return</span>&nbsp;<span class="ident" id="6275108">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6275117">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275131">return</span>&nbsp;<span class="op" id="6275138">&amp;</span><span class="ident" id="6275139">ast</span><span class="op" id="6275142">.</span><span class="ident" id="6275143">UnaryExpr</span><span class="op" id="6275152">{</span><span class="ident" id="6275153">OpPos</span><span class="op" id="6275158">:</span>&nbsp;<span class="ident" id="6275160">arrow</span><span class="op" id="6275165">,</span>&nbsp;<span class="ident" id="6275167">Op</span><span class="op" id="6275169">:</span>&nbsp;<span class="ident" id="6275171">token</span><span class="op" id="6275176">.</span><span class="ident" id="6275177">ARROW</span><span class="op" id="6275182">,</span>&nbsp;<span class="ident" id="6275184">X</span><span class="op" id="6275185">:</span>&nbsp;<span class="ident" id="6275187">p</span><span class="op" id="6275188">.</span><span class="ident" id="6275189">checkExpr</span><span class="op" id="6275198">(</span><span class="ident" id="6275199">x</span><span class="op" id="6275200">)</span><span class="op" id="6275201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275205">case</span>&nbsp;<span class="ident" id="6275210">token</span><span class="op" id="6275215">.</span><span class="ident" id="6275216">MUL</span><span class="op" id="6275219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6275223">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275265">pos</span>&nbsp;<span class="op" id="6275269">:=</span>&nbsp;<span class="ident" id="6275272">p</span><span class="op" id="6275273">.</span><span class="ident" id="6275274">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275280">p</span><span class="op" id="6275281">.</span><span class="ident" id="6275282">next</span><span class="op" id="6275286">(</span><span class="op" id="6275287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275291">x</span>&nbsp;<span class="op" id="6275293">:=</span>&nbsp;<span class="ident" id="6275296">p</span><span class="op" id="6275297">.</span><span class="ident" id="6275298">parseUnaryExpr</span><span class="op" id="6275312">(</span><span class="builtintype" id="6275313">false</span><span class="op" id="6275318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275322">return</span>&nbsp;<span class="op" id="6275329">&amp;</span><span class="ident" id="6275330">ast</span><span class="op" id="6275333">.</span><span class="ident" id="6275334">StarExpr</span><span class="op" id="6275342">{</span><span class="ident" id="6275343">Star</span><span class="op" id="6275347">:</span>&nbsp;<span class="ident" id="6275349">pos</span><span class="op" id="6275352">,</span>&nbsp;<span class="ident" id="6275354">X</span><span class="op" id="6275355">:</span>&nbsp;<span class="ident" id="6275357">p</span><span class="op" id="6275358">.</span><span class="ident" id="6275359">checkExprOrType</span><span class="op" id="6275374">(</span><span class="ident" id="6275375">x</span><span class="op" id="6275376">)</span><span class="op" id="6275377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275384">return</span>&nbsp;<span class="ident" id="6275391">p</span><span class="op" id="6275392">.</span><span class="ident" id="6275393">parsePrimaryExpr</span><span class="op" id="6275409">(</span><span class="ident" id="6275410">lhs</span><span class="op" id="6275413">)</span><br>
<span class="lineno"></span><span class="op" id="6275415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6275418">func</span>&nbsp;<span class="op" id="6275423">(</span><span class="ident" id="6275424">p</span>&nbsp;<span class="op" id="6275426">*</span><span class="ident" id="6275427">parser</span><span class="op" id="6275433">)</span>&nbsp;<span class="ident" id="6275435">tokPrec</span><span class="op" id="6275442">(</span><span class="op" id="6275443">)</span>&nbsp;<span class="op" id="6275445">(</span><span class="ident" id="6275446">token</span><span class="op" id="6275451">.</span><span class="ident" id="6275452">Token</span><span class="op" id="6275457">,</span>&nbsp;<span class="builtintype" id="6275459">int</span><span class="op" id="6275462">)</span>&nbsp;<span class="op" id="6275464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275467">tok</span>&nbsp;<span class="op" id="6275471">:=</span>&nbsp;<span class="ident" id="6275474">p</span><span class="op" id="6275475">.</span><span class="ident" id="6275476">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275481">if</span>&nbsp;<span class="ident" id="6275484">p</span><span class="op" id="6275485">.</span><span class="ident" id="6275486">inRhs</span>&nbsp;<span class="op" id="6275492">&amp;&amp;</span>&nbsp;<span class="ident" id="6275495">tok</span>&nbsp;<span class="op" id="6275499">==</span>&nbsp;<span class="ident" id="6275502">token</span><span class="op" id="6275507">.</span><span class="ident" id="6275508">ASSIGN</span>&nbsp;<span class="op" id="6275515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275519">tok</span>&nbsp;<span class="op" id="6275523">=</span>&nbsp;<span class="ident" id="6275525">token</span><span class="op" id="6275530">.</span><span class="ident" id="6275531">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275539">return</span>&nbsp;<span class="ident" id="6275546">tok</span><span class="op" id="6275549">,</span>&nbsp;<span class="ident" id="6275551">tok</span><span class="op" id="6275554">.</span><span class="ident" id="6275555">Precedence</span><span class="op" id="6275565">(</span><span class="op" id="6275566">)</span><br>
<span class="lineno"></span><span class="op" id="6275568">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="6275571">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="6275641">func</span>&nbsp;<span class="op" id="6275646">(</span><span class="ident" id="6275647">p</span>&nbsp;<span class="op" id="6275649">*</span><span class="ident" id="6275650">parser</span><span class="op" id="6275656">)</span>&nbsp;<span class="ident" id="6275658">parseBinaryExpr</span><span class="op" id="6275673">(</span><span class="ident" id="6275674">lhs</span>&nbsp;<span class="builtintype" id="6275678">bool</span><span class="op" id="6275682">,</span>&nbsp;<span class="ident" id="6275684">prec1</span>&nbsp;<span class="builtintype" id="6275690">int</span><span class="op" id="6275693">)</span>&nbsp;<span class="ident" id="6275695">ast</span><span class="op" id="6275698">.</span><span class="ident" id="6275699">Expr</span>&nbsp;<span class="op" id="6275704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275707">if</span>&nbsp;<span class="ident" id="6275710">p</span><span class="op" id="6275711">.</span><span class="ident" id="6275712">trace</span>&nbsp;<span class="op" id="6275718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275722">defer</span>&nbsp;<span class="ident" id="6275728">un</span><span class="op" id="6275730">(</span><span class="ident" id="6275731">trace</span><span class="op" id="6275736">(</span><span class="ident" id="6275737">p</span><span class="op" id="6275738">,</span>&nbsp;<span class="string" id="6275740">&#34;BinaryExpr&#34;</span><span class="op" id="6275752">)</span><span class="op" id="6275753">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275760">x</span>&nbsp;<span class="op" id="6275762">:=</span>&nbsp;<span class="ident" id="6275765">p</span><span class="op" id="6275766">.</span><span class="ident" id="6275767">parseUnaryExpr</span><span class="op" id="6275781">(</span><span class="ident" id="6275782">lhs</span><span class="op" id="6275785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275788">for</span>&nbsp;<span class="ident" id="6275792">_</span><span class="op" id="6275793">,</span>&nbsp;<span class="ident" id="6275795">prec</span>&nbsp;<span class="op" id="6275800">:=</span>&nbsp;<span class="ident" id="6275803">p</span><span class="op" id="6275804">.</span><span class="ident" id="6275805">tokPrec</span><span class="op" id="6275812">(</span><span class="op" id="6275813">)</span><span class="op" id="6275814">;</span>&nbsp;<span class="ident" id="6275816">prec</span>&nbsp;<span class="op" id="6275821">&gt;=</span>&nbsp;<span class="ident" id="6275824">prec1</span><span class="op" id="6275829">;</span>&nbsp;<span class="ident" id="6275831">prec</span><span class="op" id="6275835">--</span>&nbsp;<span class="op" id="6275838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275842">for</span>&nbsp;<span class="op" id="6275846">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275851">op</span><span class="op" id="6275853">,</span>&nbsp;<span class="ident" id="6275855">oprec</span>&nbsp;<span class="op" id="6275861">:=</span>&nbsp;<span class="ident" id="6275864">p</span><span class="op" id="6275865">.</span><span class="ident" id="6275866">tokPrec</span><span class="op" id="6275873">(</span><span class="op" id="6275874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275879">if</span>&nbsp;<span class="ident" id="6275882">oprec</span>&nbsp;<span class="op" id="6275888">!=</span>&nbsp;<span class="ident" id="6275891">prec</span>&nbsp;<span class="op" id="6275896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275902">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275916">pos</span>&nbsp;<span class="op" id="6275920">:=</span>&nbsp;<span class="ident" id="6275923">p</span><span class="op" id="6275924">.</span><span class="ident" id="6275925">expect</span><span class="op" id="6275931">(</span><span class="ident" id="6275932">op</span><span class="op" id="6275934">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6275939">if</span>&nbsp;<span class="ident" id="6275942">lhs</span>&nbsp;<span class="op" id="6275946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275952">p</span><span class="op" id="6275953">.</span><span class="ident" id="6275954">resolve</span><span class="op" id="6275961">(</span><span class="ident" id="6275962">x</span><span class="op" id="6275963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275969">lhs</span>&nbsp;<span class="op" id="6275973">=</span>&nbsp;<span class="builtintype" id="6275975">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6275984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6275989">y</span>&nbsp;<span class="op" id="6275991">:=</span>&nbsp;<span class="ident" id="6275994">p</span><span class="op" id="6275995">.</span><span class="ident" id="6275996">parseBinaryExpr</span><span class="op" id="6276011">(</span><span class="builtintype" id="6276012">false</span><span class="op" id="6276017">,</span>&nbsp;<span class="ident" id="6276019">prec</span><span class="op" id="6276023">+</span><span class="num" id="6276024">1</span><span class="op" id="6276025">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276030">x</span>&nbsp;<span class="op" id="6276032">=</span>&nbsp;<span class="op" id="6276034">&amp;</span><span class="ident" id="6276035">ast</span><span class="op" id="6276038">.</span><span class="ident" id="6276039">BinaryExpr</span><span class="op" id="6276049">{</span><span class="ident" id="6276050">X</span><span class="op" id="6276051">:</span>&nbsp;<span class="ident" id="6276053">p</span><span class="op" id="6276054">.</span><span class="ident" id="6276055">checkExpr</span><span class="op" id="6276064">(</span><span class="ident" id="6276065">x</span><span class="op" id="6276066">)</span><span class="op" id="6276067">,</span>&nbsp;<span class="ident" id="6276069">OpPos</span><span class="op" id="6276074">:</span>&nbsp;<span class="ident" id="6276076">pos</span><span class="op" id="6276079">,</span>&nbsp;<span class="ident" id="6276081">Op</span><span class="op" id="6276083">:</span>&nbsp;<span class="ident" id="6276085">op</span><span class="op" id="6276087">,</span>&nbsp;<span class="ident" id="6276089">Y</span><span class="op" id="6276090">:</span>&nbsp;<span class="ident" id="6276092">p</span><span class="op" id="6276093">.</span><span class="ident" id="6276094">checkExpr</span><span class="op" id="6276103">(</span><span class="ident" id="6276104">y</span><span class="op" id="6276105">)</span><span class="op" id="6276106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276117">return</span>&nbsp;<span class="ident" id="6276124">x</span><br>
<span class="lineno">1590</span><span class="op" id="6276126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6276129">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="6276199">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="6276271">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="6276342">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="6276354">func</span>&nbsp;<span class="op" id="6276359">(</span><span class="ident" id="6276360">p</span>&nbsp;<span class="op" id="6276362">*</span><span class="ident" id="6276363">parser</span><span class="op" id="6276369">)</span>&nbsp;<span class="ident" id="6276371">parseExpr</span><span class="op" id="6276380">(</span><span class="ident" id="6276381">lhs</span>&nbsp;<span class="builtintype" id="6276385">bool</span><span class="op" id="6276389">)</span>&nbsp;<span class="ident" id="6276391">ast</span><span class="op" id="6276394">.</span><span class="ident" id="6276395">Expr</span>&nbsp;<span class="op" id="6276400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276403">if</span>&nbsp;<span class="ident" id="6276406">p</span><span class="op" id="6276407">.</span><span class="ident" id="6276408">trace</span>&nbsp;<span class="op" id="6276414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276418">defer</span>&nbsp;<span class="ident" id="6276424">un</span><span class="op" id="6276426">(</span><span class="ident" id="6276427">trace</span><span class="op" id="6276432">(</span><span class="ident" id="6276433">p</span><span class="op" id="6276434">,</span>&nbsp;<span class="string" id="6276436">&#34;Expression&#34;</span><span class="op" id="6276448">)</span><span class="op" id="6276449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6276452">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276456">return</span>&nbsp;<span class="ident" id="6276463">p</span><span class="op" id="6276464">.</span><span class="ident" id="6276465">parseBinaryExpr</span><span class="op" id="6276480">(</span><span class="ident" id="6276481">lhs</span><span class="op" id="6276484">,</span>&nbsp;<span class="ident" id="6276486">token</span><span class="op" id="6276491">.</span><span class="ident" id="6276492">LowestPrec</span><span class="op" id="6276502">+</span><span class="num" id="6276503">1</span><span class="op" id="6276504">)</span><br>
<span class="lineno"></span><span class="op" id="6276506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6276509">func</span>&nbsp;<span class="op" id="6276514">(</span><span class="ident" id="6276515">p</span>&nbsp;<span class="op" id="6276517">*</span><span class="ident" id="6276518">parser</span><span class="op" id="6276524">)</span>&nbsp;<span class="ident" id="6276526">parseRhs</span><span class="op" id="6276534">(</span><span class="op" id="6276535">)</span>&nbsp;<span class="ident" id="6276537">ast</span><span class="op" id="6276540">.</span><span class="ident" id="6276541">Expr</span>&nbsp;<span class="op" id="6276546">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276549">old</span>&nbsp;<span class="op" id="6276553">:=</span>&nbsp;<span class="ident" id="6276556">p</span><span class="op" id="6276557">.</span><span class="ident" id="6276558">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276565">p</span><span class="op" id="6276566">.</span><span class="ident" id="6276567">inRhs</span>&nbsp;<span class="op" id="6276573">=</span>&nbsp;<span class="builtintype" id="6276575">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276581">x</span>&nbsp;<span class="op" id="6276583">:=</span>&nbsp;<span class="ident" id="6276586">p</span><span class="op" id="6276587">.</span><span class="ident" id="6276588">checkExpr</span><span class="op" id="6276597">(</span><span class="ident" id="6276598">p</span><span class="op" id="6276599">.</span><span class="ident" id="6276600">parseExpr</span><span class="op" id="6276609">(</span><span class="builtintype" id="6276610">false</span><span class="op" id="6276615">)</span><span class="op" id="6276616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276619">p</span><span class="op" id="6276620">.</span><span class="ident" id="6276621">inRhs</span>&nbsp;<span class="op" id="6276627">=</span>&nbsp;<span class="ident" id="6276629">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276634">return</span>&nbsp;<span class="ident" id="6276641">x</span><br>
<span class="lineno">1610</span><span class="op" id="6276643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6276646">func</span>&nbsp;<span class="op" id="6276651">(</span><span class="ident" id="6276652">p</span>&nbsp;<span class="op" id="6276654">*</span><span class="ident" id="6276655">parser</span><span class="op" id="6276661">)</span>&nbsp;<span class="ident" id="6276663">parseRhsOrType</span><span class="op" id="6276677">(</span><span class="op" id="6276678">)</span>&nbsp;<span class="ident" id="6276680">ast</span><span class="op" id="6276683">.</span><span class="ident" id="6276684">Expr</span>&nbsp;<span class="op" id="6276689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276692">old</span>&nbsp;<span class="op" id="6276696">:=</span>&nbsp;<span class="ident" id="6276699">p</span><span class="op" id="6276700">.</span><span class="ident" id="6276701">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276708">p</span><span class="op" id="6276709">.</span><span class="ident" id="6276710">inRhs</span>&nbsp;<span class="op" id="6276716">=</span>&nbsp;<span class="builtintype" id="6276718">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276724">x</span>&nbsp;<span class="op" id="6276726">:=</span>&nbsp;<span class="ident" id="6276729">p</span><span class="op" id="6276730">.</span><span class="ident" id="6276731">checkExprOrType</span><span class="op" id="6276746">(</span><span class="ident" id="6276747">p</span><span class="op" id="6276748">.</span><span class="ident" id="6276749">parseExpr</span><span class="op" id="6276758">(</span><span class="builtintype" id="6276759">false</span><span class="op" id="6276764">)</span><span class="op" id="6276765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276768">p</span><span class="op" id="6276769">.</span><span class="ident" id="6276770">inRhs</span>&nbsp;<span class="op" id="6276776">=</span>&nbsp;<span class="ident" id="6276778">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6276783">return</span>&nbsp;<span class="ident" id="6276790">x</span><br>
<span class="lineno"></span><span class="op" id="6276792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="6276795">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6276875">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6276890">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="6276928">const</span>&nbsp;<span class="op" id="6276934">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276937">basic</span>&nbsp;<span class="op" id="6276943">=</span>&nbsp;<span class="ident" id="6276945">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276951">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6276960">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="6276968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="6276971">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="6277045">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6277119">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6277193">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="6277264">func</span>&nbsp;<span class="op" id="6277269">(</span><span class="ident" id="6277270">p</span>&nbsp;<span class="op" id="6277272">*</span><span class="ident" id="6277273">parser</span><span class="op" id="6277279">)</span>&nbsp;<span class="ident" id="6277281">parseSimpleStmt</span><span class="op" id="6277296">(</span><span class="ident" id="6277297">mode</span>&nbsp;<span class="builtintype" id="6277302">int</span><span class="op" id="6277305">)</span>&nbsp;<span class="op" id="6277307">(</span><span class="ident" id="6277308">ast</span><span class="op" id="6277311">.</span><span class="ident" id="6277312">Stmt</span><span class="op" id="6277316">,</span>&nbsp;<span class="builtintype" id="6277318">bool</span><span class="op" id="6277322">)</span>&nbsp;<span class="op" id="6277324">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277327">if</span>&nbsp;<span class="ident" id="6277330">p</span><span class="op" id="6277331">.</span><span class="ident" id="6277332">trace</span>&nbsp;<span class="op" id="6277338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277342">defer</span>&nbsp;<span class="ident" id="6277348">un</span><span class="op" id="6277350">(</span><span class="ident" id="6277351">trace</span><span class="op" id="6277356">(</span><span class="ident" id="6277357">p</span><span class="op" id="6277358">,</span>&nbsp;<span class="string" id="6277360">&#34;SimpleStmt&#34;</span><span class="op" id="6277372">)</span><span class="op" id="6277373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6277376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277380">x</span>&nbsp;<span class="op" id="6277382">:=</span>&nbsp;<span class="ident" id="6277385">p</span><span class="op" id="6277386">.</span><span class="ident" id="6277387">parseLhsList</span><span class="op" id="6277399">(</span><span class="op" id="6277400">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277404">switch</span>&nbsp;<span class="ident" id="6277411">p</span><span class="op" id="6277412">.</span><span class="ident" id="6277413">tok</span>&nbsp;<span class="op" id="6277417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277420">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277427">token</span><span class="op" id="6277432">.</span><span class="ident" id="6277433">DEFINE</span><span class="op" id="6277439">,</span>&nbsp;<span class="ident" id="6277441">token</span><span class="op" id="6277446">.</span><span class="ident" id="6277447">ASSIGN</span><span class="op" id="6277453">,</span>&nbsp;<span class="ident" id="6277455">token</span><span class="op" id="6277460">.</span><span class="ident" id="6277461">ADD_ASSIGN</span><span class="op" id="6277471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277475">token</span><span class="op" id="6277480">.</span><span class="ident" id="6277481">SUB_ASSIGN</span><span class="op" id="6277491">,</span>&nbsp;<span class="ident" id="6277493">token</span><span class="op" id="6277498">.</span><span class="ident" id="6277499">MUL_ASSIGN</span><span class="op" id="6277509">,</span>&nbsp;<span class="ident" id="6277511">token</span><span class="op" id="6277516">.</span><span class="ident" id="6277517">QUO_ASSIGN</span><span class="op" id="6277527">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277531">token</span><span class="op" id="6277536">.</span><span class="ident" id="6277537">REM_ASSIGN</span><span class="op" id="6277547">,</span>&nbsp;<span class="ident" id="6277549">token</span><span class="op" id="6277554">.</span><span class="ident" id="6277555">AND_ASSIGN</span><span class="op" id="6277565">,</span>&nbsp;<span class="ident" id="6277567">token</span><span class="op" id="6277572">.</span><span class="ident" id="6277573">OR_ASSIGN</span><span class="op" id="6277582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277586">token</span><span class="op" id="6277591">.</span><span class="ident" id="6277592">XOR_ASSIGN</span><span class="op" id="6277602">,</span>&nbsp;<span class="ident" id="6277604">token</span><span class="op" id="6277609">.</span><span class="ident" id="6277610">SHL_ASSIGN</span><span class="op" id="6277620">,</span>&nbsp;<span class="ident" id="6277622">token</span><span class="op" id="6277627">.</span><span class="ident" id="6277628">SHR_ASSIGN</span><span class="op" id="6277638">,</span>&nbsp;<span class="ident" id="6277640">token</span><span class="op" id="6277645">.</span><span class="ident" id="6277646">AND_NOT_ASSIGN</span><span class="op" id="6277660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6277664">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277723">pos</span><span class="op" id="6277726">,</span>&nbsp;<span class="ident" id="6277728">tok</span>&nbsp;<span class="op" id="6277732">:=</span>&nbsp;<span class="ident" id="6277735">p</span><span class="op" id="6277736">.</span><span class="ident" id="6277737">pos</span><span class="op" id="6277740">,</span>&nbsp;<span class="ident" id="6277742">p</span><span class="op" id="6277743">.</span><span class="ident" id="6277744">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277750">p</span><span class="op" id="6277751">.</span><span class="ident" id="6277752">next</span><span class="op" id="6277756">(</span><span class="op" id="6277757">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277761">var</span>&nbsp;<span class="ident" id="6277765">y</span>&nbsp;<span class="op" id="6277767">[</span><span class="op" id="6277768">]</span><span class="ident" id="6277769">ast</span><span class="op" id="6277772">.</span><span class="ident" id="6277773">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277780">isRange</span>&nbsp;<span class="op" id="6277788">:=</span>&nbsp;<span class="builtintype" id="6277791">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277799">if</span>&nbsp;<span class="ident" id="6277802">mode</span>&nbsp;<span class="op" id="6277807">==</span>&nbsp;<span class="ident" id="6277810">rangeOk</span>&nbsp;<span class="op" id="6277818">&amp;&amp;</span>&nbsp;<span class="ident" id="6277821">p</span><span class="op" id="6277822">.</span><span class="ident" id="6277823">tok</span>&nbsp;<span class="op" id="6277827">==</span>&nbsp;<span class="ident" id="6277830">token</span><span class="op" id="6277835">.</span><span class="ident" id="6277836">RANGE</span>&nbsp;<span class="op" id="6277842">&amp;&amp;</span>&nbsp;<span class="op" id="6277845">(</span><span class="ident" id="6277846">tok</span>&nbsp;<span class="op" id="6277850">==</span>&nbsp;<span class="ident" id="6277853">token</span><span class="op" id="6277858">.</span><span class="ident" id="6277859">DEFINE</span>&nbsp;<span class="op" id="6277866">||</span>&nbsp;<span class="ident" id="6277869">tok</span>&nbsp;<span class="op" id="6277873">==</span>&nbsp;<span class="ident" id="6277876">token</span><span class="op" id="6277881">.</span><span class="ident" id="6277882">ASSIGN</span><span class="op" id="6277888">)</span>&nbsp;<span class="op" id="6277890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277895">pos</span>&nbsp;<span class="op" id="6277899">:=</span>&nbsp;<span class="ident" id="6277902">p</span><span class="op" id="6277903">.</span><span class="ident" id="6277904">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277911">p</span><span class="op" id="6277912">.</span><span class="ident" id="6277913">next</span><span class="op" id="6277917">(</span><span class="op" id="6277918">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6277923">y</span>&nbsp;<span class="op" id="6277925">=</span>&nbsp;<span class="op" id="6277927">[</span><span class="op" id="6277928">]</span><span class="ident" id="6277929">ast</span><span class="op" id="6277932">.</span><span class="ident" id="6277933">Expr</span><span class="op" id="6277937">{</span><span class="op" id="6277938">&amp;</span><span class="ident" id="6277939">ast</span><span class="op" id="6277942">.</span><span class="ident" id="6277943">UnaryExpr</span><span class="op" id="6277952">{</span><span class="ident" id="6277953">OpPos</span><span class="op" id="6277958">:</span>&nbsp;<span class="ident" id="6277960">pos</span><span class="op" id="6277963">,</span>&nbsp;<span class="ident" id="6277965">Op</span><span class="op" id="6277967">:</span>&nbsp;<span class="ident" id="6277969">token</span><span class="op" id="6277974">.</span><span class="ident" id="6277975">RANGE</span><span class="op" id="6277980">,</span>&nbsp;<span class="ident" id="6277982">X</span><span class="op" id="6277983">:</span>&nbsp;<span class="ident" id="6277985">p</span><span class="op" id="6277986">.</span><span class="ident" id="6277987">parseRhs</span><span class="op" id="6277995">(</span><span class="op" id="6277996">)</span><span class="op" id="6277997">}</span><span class="op" id="6277998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278003">isRange</span>&nbsp;<span class="op" id="6278011">=</span>&nbsp;<span class="builtintype" id="6278013">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278020">}</span>&nbsp;<span class="keyword" id="6278022">else</span>&nbsp;<span class="op" id="6278027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278032">y</span>&nbsp;<span class="op" id="6278034">=</span>&nbsp;<span class="ident" id="6278036">p</span><span class="op" id="6278037">.</span><span class="ident" id="6278038">parseRhsList</span><span class="op" id="6278050">(</span><span class="op" id="6278051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278055">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278059">as</span>&nbsp;<span class="op" id="6278062">:=</span>&nbsp;<span class="op" id="6278065">&amp;</span><span class="ident" id="6278066">ast</span><span class="op" id="6278069">.</span><span class="ident" id="6278070">AssignStmt</span><span class="op" id="6278080">{</span><span class="ident" id="6278081">Lhs</span><span class="op" id="6278084">:</span>&nbsp;<span class="ident" id="6278086">x</span><span class="op" id="6278087">,</span>&nbsp;<span class="ident" id="6278089">TokPos</span><span class="op" id="6278095">:</span>&nbsp;<span class="ident" id="6278097">pos</span><span class="op" id="6278100">,</span>&nbsp;<span class="ident" id="6278102">Tok</span><span class="op" id="6278105">:</span>&nbsp;<span class="ident" id="6278107">tok</span><span class="op" id="6278110">,</span>&nbsp;<span class="ident" id="6278112">Rhs</span><span class="op" id="6278115">:</span>&nbsp;<span class="ident" id="6278117">y</span><span class="op" id="6278118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278122">if</span>&nbsp;<span class="ident" id="6278125">tok</span>&nbsp;<span class="op" id="6278129">==</span>&nbsp;<span class="ident" id="6278132">token</span><span class="op" id="6278137">.</span><span class="ident" id="6278138">DEFINE</span>&nbsp;<span class="op" id="6278145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278150">p</span><span class="op" id="6278151">.</span><span class="ident" id="6278152">shortVarDecl</span><span class="op" id="6278164">(</span><span class="ident" id="6278165">as</span><span class="op" id="6278167">,</span>&nbsp;<span class="ident" id="6278169">x</span><span class="op" id="6278170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278178">return</span>&nbsp;<span class="ident" id="6278185">as</span><span class="op" id="6278187">,</span>&nbsp;<span class="ident" id="6278189">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278202">if</span>&nbsp;<span class="builtinfunc" id="6278205">len</span><span class="op" id="6278208">(</span><span class="ident" id="6278209">x</span><span class="op" id="6278210">)</span>&nbsp;<span class="op" id="6278212">&gt;</span>&nbsp;<span class="num" id="6278214">1</span>&nbsp;<span class="op" id="6278216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278220">p</span><span class="op" id="6278221">.</span><span class="ident" id="6278222">errorExpected</span><span class="op" id="6278235">(</span><span class="ident" id="6278236">x</span><span class="op" id="6278237">[</span><span class="num" id="6278238">0</span><span class="op" id="6278239">]</span><span class="op" id="6278240">.</span><span class="ident" id="6278241">Pos</span><span class="op" id="6278244">(</span><span class="op" id="6278245">)</span><span class="op" id="6278246">,</span>&nbsp;<span class="string" id="6278248">&#34;1&nbsp;expression&#34;</span><span class="op" id="6278262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278266">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278305">switch</span>&nbsp;<span class="ident" id="6278312">p</span><span class="op" id="6278313">.</span><span class="ident" id="6278314">tok</span>&nbsp;<span class="op" id="6278318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278321">case</span>&nbsp;<span class="ident" id="6278326">token</span><span class="op" id="6278331">.</span><span class="ident" id="6278332">COLON</span><span class="op" id="6278337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278341">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278364">colon</span>&nbsp;<span class="op" id="6278370">:=</span>&nbsp;<span class="ident" id="6278373">p</span><span class="op" id="6278374">.</span><span class="ident" id="6278375">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278381">p</span><span class="op" id="6278382">.</span><span class="ident" id="6278383">next</span><span class="op" id="6278387">(</span><span class="op" id="6278388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278392">if</span>&nbsp;<span class="ident" id="6278395">label</span><span class="op" id="6278400">,</span>&nbsp;<span class="ident" id="6278402">isIdent</span>&nbsp;<span class="op" id="6278410">:=</span>&nbsp;<span class="ident" id="6278413">x</span><span class="op" id="6278414">[</span><span class="num" id="6278415">0</span><span class="op" id="6278416">]</span><span class="op" id="6278417">.</span><span class="op" id="6278418">(</span><span class="op" id="6278419">*</span><span class="ident" id="6278420">ast</span><span class="op" id="6278423">.</span><span class="ident" id="6278424">Ident</span><span class="op" id="6278429">)</span><span class="op" id="6278430">;</span>&nbsp;<span class="ident" id="6278432">mode</span>&nbsp;<span class="op" id="6278437">==</span>&nbsp;<span class="ident" id="6278440">labelOk</span>&nbsp;<span class="op" id="6278448">&amp;&amp;</span>&nbsp;<span class="ident" id="6278451">isIdent</span>&nbsp;<span class="op" id="6278459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278464">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278528">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278594">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278610">stmt</span>&nbsp;<span class="op" id="6278615">:=</span>&nbsp;<span class="op" id="6278618">&amp;</span><span class="ident" id="6278619">ast</span><span class="op" id="6278622">.</span><span class="ident" id="6278623">LabeledStmt</span><span class="op" id="6278634">{</span><span class="ident" id="6278635">Label</span><span class="op" id="6278640">:</span>&nbsp;<span class="ident" id="6278642">label</span><span class="op" id="6278647">,</span>&nbsp;<span class="ident" id="6278649">Colon</span><span class="op" id="6278654">:</span>&nbsp;<span class="ident" id="6278656">colon</span><span class="op" id="6278661">,</span>&nbsp;<span class="ident" id="6278663">Stmt</span><span class="op" id="6278667">:</span>&nbsp;<span class="ident" id="6278669">p</span><span class="op" id="6278670">.</span><span class="ident" id="6278671">parseStmt</span><span class="op" id="6278680">(</span><span class="op" id="6278681">)</span><span class="op" id="6278682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278687">p</span><span class="op" id="6278688">.</span><span class="ident" id="6278689">declare</span><span class="op" id="6278696">(</span><span class="ident" id="6278697">stmt</span><span class="op" id="6278701">,</span>&nbsp;<span class="ident" id="6278703">nil</span><span class="op" id="6278706">,</span>&nbsp;<span class="ident" id="6278708">p</span><span class="op" id="6278709">.</span><span class="ident" id="6278710">labelScope</span><span class="op" id="6278720">,</span>&nbsp;<span class="ident" id="6278722">ast</span><span class="op" id="6278725">.</span><span class="ident" id="6278726">Lbl</span><span class="op" id="6278729">,</span>&nbsp;<span class="ident" id="6278731">label</span><span class="op" id="6278736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6278741">return</span>&nbsp;<span class="ident" id="6278748">stmt</span><span class="op" id="6278752">,</span>&nbsp;<span class="builtintype" id="6278754">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6278762">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278766">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278839">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278913">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6278986">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279059">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279133">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279168">p</span><span class="op" id="6279169">.</span><span class="builtintype" id="6279170">error</span><span class="op" id="6279175">(</span><span class="ident" id="6279176">colon</span><span class="op" id="6279181">,</span>&nbsp;<span class="string" id="6279183">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="6279210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279214">return</span>&nbsp;<span class="op" id="6279221">&amp;</span><span class="ident" id="6279222">ast</span><span class="op" id="6279225">.</span><span class="ident" id="6279226">BadStmt</span><span class="op" id="6279233">{</span><span class="ident" id="6279234">From</span><span class="op" id="6279238">:</span>&nbsp;<span class="ident" id="6279240">x</span><span class="op" id="6279241">[</span><span class="num" id="6279242">0</span><span class="op" id="6279243">]</span><span class="op" id="6279244">.</span><span class="ident" id="6279245">Pos</span><span class="op" id="6279248">(</span><span class="op" id="6279249">)</span><span class="op" id="6279250">,</span>&nbsp;<span class="ident" id="6279252">To</span><span class="op" id="6279254">:</span>&nbsp;<span class="ident" id="6279256">colon</span>&nbsp;<span class="op" id="6279262">+</span>&nbsp;<span class="num" id="6279264">1</span><span class="op" id="6279265">}</span><span class="op" id="6279266">,</span>&nbsp;<span class="builtintype" id="6279268">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279276">case</span>&nbsp;<span class="ident" id="6279281">token</span><span class="op" id="6279286">.</span><span class="ident" id="6279287">ARROW</span><span class="op" id="6279292">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279296">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279316">arrow</span>&nbsp;<span class="op" id="6279322">:=</span>&nbsp;<span class="ident" id="6279325">p</span><span class="op" id="6279326">.</span><span class="ident" id="6279327">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279333">p</span><span class="op" id="6279334">.</span><span class="ident" id="6279335">next</span><span class="op" id="6279339">(</span><span class="op" id="6279340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279344">y</span>&nbsp;<span class="op" id="6279346">:=</span>&nbsp;<span class="ident" id="6279349">p</span><span class="op" id="6279350">.</span><span class="ident" id="6279351">parseRhs</span><span class="op" id="6279359">(</span><span class="op" id="6279360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279364">return</span>&nbsp;<span class="op" id="6279371">&amp;</span><span class="ident" id="6279372">ast</span><span class="op" id="6279375">.</span><span class="ident" id="6279376">SendStmt</span><span class="op" id="6279384">{</span><span class="ident" id="6279385">Chan</span><span class="op" id="6279389">:</span>&nbsp;<span class="ident" id="6279391">x</span><span class="op" id="6279392">[</span><span class="num" id="6279393">0</span><span class="op" id="6279394">]</span><span class="op" id="6279395">,</span>&nbsp;<span class="ident" id="6279397">Arrow</span><span class="op" id="6279402">:</span>&nbsp;<span class="ident" id="6279404">arrow</span><span class="op" id="6279409">,</span>&nbsp;<span class="ident" id="6279411">Value</span><span class="op" id="6279416">:</span>&nbsp;<span class="ident" id="6279418">y</span><span class="op" id="6279419">}</span><span class="op" id="6279420">,</span>&nbsp;<span class="builtintype" id="6279422">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279430">case</span>&nbsp;<span class="ident" id="6279435">token</span><span class="op" id="6279440">.</span><span class="ident" id="6279441">INC</span><span class="op" id="6279444">,</span>&nbsp;<span class="ident" id="6279446">token</span><span class="op" id="6279451">.</span><span class="ident" id="6279452">DEC</span><span class="op" id="6279455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279459">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279487">s</span>&nbsp;<span class="op" id="6279489">:=</span>&nbsp;<span class="op" id="6279492">&amp;</span><span class="ident" id="6279493">ast</span><span class="op" id="6279496">.</span><span class="ident" id="6279497">IncDecStmt</span><span class="op" id="6279507">{</span><span class="ident" id="6279508">X</span><span class="op" id="6279509">:</span>&nbsp;<span class="ident" id="6279511">x</span><span class="op" id="6279512">[</span><span class="num" id="6279513">0</span><span class="op" id="6279514">]</span><span class="op" id="6279515">,</span>&nbsp;<span class="ident" id="6279517">TokPos</span><span class="op" id="6279523">:</span>&nbsp;<span class="ident" id="6279525">p</span><span class="op" id="6279526">.</span><span class="ident" id="6279527">pos</span><span class="op" id="6279530">,</span>&nbsp;<span class="ident" id="6279532">Tok</span><span class="op" id="6279535">:</span>&nbsp;<span class="ident" id="6279537">p</span><span class="op" id="6279538">.</span><span class="ident" id="6279539">tok</span><span class="op" id="6279542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279546">p</span><span class="op" id="6279547">.</span><span class="ident" id="6279548">next</span><span class="op" id="6279552">(</span><span class="op" id="6279553">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279557">return</span>&nbsp;<span class="ident" id="6279564">s</span><span class="op" id="6279565">,</span>&nbsp;<span class="builtintype" id="6279567">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6279574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279578">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279593">return</span>&nbsp;<span class="op" id="6279600">&amp;</span><span class="ident" id="6279601">ast</span><span class="op" id="6279604">.</span><span class="ident" id="6279605">ExprStmt</span><span class="op" id="6279613">{</span><span class="ident" id="6279614">X</span><span class="op" id="6279615">:</span>&nbsp;<span class="ident" id="6279617">x</span><span class="op" id="6279618">[</span><span class="num" id="6279619">0</span><span class="op" id="6279620">]</span><span class="op" id="6279621">}</span><span class="op" id="6279622">,</span>&nbsp;<span class="builtintype" id="6279624">false</span><br>
<span class="lineno">1710</span><span class="op" id="6279630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6279633">func</span>&nbsp;<span class="op" id="6279638">(</span><span class="ident" id="6279639">p</span>&nbsp;<span class="op" id="6279641">*</span><span class="ident" id="6279642">parser</span><span class="op" id="6279648">)</span>&nbsp;<span class="ident" id="6279650">parseCallExpr</span><span class="op" id="6279663">(</span><span class="ident" id="6279664">callType</span>&nbsp;<span class="builtintype" id="6279673">string</span><span class="op" id="6279679">)</span>&nbsp;<span class="op" id="6279681">*</span><span class="ident" id="6279682">ast</span><span class="op" id="6279685">.</span><span class="ident" id="6279686">CallExpr</span>&nbsp;<span class="op" id="6279695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279698">x</span>&nbsp;<span class="op" id="6279700">:=</span>&nbsp;<span class="ident" id="6279703">p</span><span class="op" id="6279704">.</span><span class="ident" id="6279705">parseRhsOrType</span><span class="op" id="6279719">(</span><span class="op" id="6279720">)</span>&nbsp;<span class="comment" id="6279722">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279764">if</span>&nbsp;<span class="ident" id="6279767">call</span><span class="op" id="6279771">,</span>&nbsp;<span class="ident" id="6279773">isCall</span>&nbsp;<span class="op" id="6279780">:=</span>&nbsp;<span class="ident" id="6279783">x</span><span class="op" id="6279784">.</span><span class="op" id="6279785">(</span><span class="op" id="6279786">*</span><span class="ident" id="6279787">ast</span><span class="op" id="6279790">.</span><span class="ident" id="6279791">CallExpr</span><span class="op" id="6279799">)</span><span class="op" id="6279800">;</span>&nbsp;<span class="ident" id="6279802">isCall</span>&nbsp;<span class="op" id="6279809">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279813">return</span>&nbsp;<span class="ident" id="6279820">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6279826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279829">if</span>&nbsp;<span class="ident" id="6279832">_</span><span class="op" id="6279833">,</span>&nbsp;<span class="ident" id="6279835">isBad</span>&nbsp;<span class="op" id="6279841">:=</span>&nbsp;<span class="ident" id="6279844">x</span><span class="op" id="6279845">.</span><span class="op" id="6279846">(</span><span class="op" id="6279847">*</span><span class="ident" id="6279848">ast</span><span class="op" id="6279851">.</span><span class="ident" id="6279852">BadExpr</span><span class="op" id="6279859">)</span><span class="op" id="6279860">;</span>&nbsp;<span class="op" id="6279862">!</span><span class="ident" id="6279863">isBad</span>&nbsp;<span class="op" id="6279869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6279873">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279914">p</span><span class="op" id="6279915">.</span><span class="builtintype" id="6279916">error</span><span class="op" id="6279921">(</span><span class="ident" id="6279922">p</span><span class="op" id="6279923">.</span><span class="ident" id="6279924">safePos</span><span class="op" id="6279931">(</span><span class="ident" id="6279932">x</span><span class="op" id="6279933">.</span><span class="ident" id="6279934">End</span><span class="op" id="6279937">(</span><span class="op" id="6279938">)</span><span class="op" id="6279939">)</span><span class="op" id="6279940">,</span>&nbsp;<span class="ident" id="6279942">fmt</span><span class="op" id="6279945">.</span><span class="ident" id="6279946">Sprintf</span><span class="op" id="6279953">(</span><span class="string" id="6279954">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="6279996">,</span>&nbsp;<span class="ident" id="6279998">callType</span><span class="op" id="6280006">)</span><span class="op" id="6280007">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280013">return</span>&nbsp;<span class="ident" id="6280020">nil</span><br>
<span class="lineno"></span><span class="op" id="6280024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6280027">func</span>&nbsp;<span class="op" id="6280032">(</span><span class="ident" id="6280033">p</span>&nbsp;<span class="op" id="6280035">*</span><span class="ident" id="6280036">parser</span><span class="op" id="6280042">)</span>&nbsp;<span class="ident" id="6280044">parseGoStmt</span><span class="op" id="6280055">(</span><span class="op" id="6280056">)</span>&nbsp;<span class="ident" id="6280058">ast</span><span class="op" id="6280061">.</span><span class="ident" id="6280062">Stmt</span>&nbsp;<span class="op" id="6280067">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280070">if</span>&nbsp;<span class="ident" id="6280073">p</span><span class="op" id="6280074">.</span><span class="ident" id="6280075">trace</span>&nbsp;<span class="op" id="6280081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280085">defer</span>&nbsp;<span class="ident" id="6280091">un</span><span class="op" id="6280093">(</span><span class="ident" id="6280094">trace</span><span class="op" id="6280099">(</span><span class="ident" id="6280100">p</span><span class="op" id="6280101">,</span>&nbsp;<span class="string" id="6280103">&#34;GoStmt&#34;</span><span class="op" id="6280111">)</span><span class="op" id="6280112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280119">pos</span>&nbsp;<span class="op" id="6280123">:=</span>&nbsp;<span class="ident" id="6280126">p</span><span class="op" id="6280127">.</span><span class="ident" id="6280128">expect</span><span class="op" id="6280134">(</span><span class="ident" id="6280135">token</span><span class="op" id="6280140">.</span><span class="ident" id="6280141">GO</span><span class="op" id="6280143">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280146">call</span>&nbsp;<span class="op" id="6280151">:=</span>&nbsp;<span class="ident" id="6280154">p</span><span class="op" id="6280155">.</span><span class="ident" id="6280156">parseCallExpr</span><span class="op" id="6280169">(</span><span class="string" id="6280170">&#34;go&#34;</span><span class="op" id="6280174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280177">p</span><span class="op" id="6280178">.</span><span class="ident" id="6280179">expectSemi</span><span class="op" id="6280189">(</span><span class="op" id="6280190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280193">if</span>&nbsp;<span class="ident" id="6280196">call</span>&nbsp;<span class="op" id="6280201">==</span>&nbsp;<span class="ident" id="6280204">nil</span>&nbsp;<span class="op" id="6280208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280212">return</span>&nbsp;<span class="op" id="6280219">&amp;</span><span class="ident" id="6280220">ast</span><span class="op" id="6280223">.</span><span class="ident" id="6280224">BadStmt</span><span class="op" id="6280231">{</span><span class="ident" id="6280232">From</span><span class="op" id="6280236">:</span>&nbsp;<span class="ident" id="6280238">pos</span><span class="op" id="6280241">,</span>&nbsp;<span class="ident" id="6280243">To</span><span class="op" id="6280245">:</span>&nbsp;<span class="ident" id="6280247">pos</span>&nbsp;<span class="op" id="6280251">+</span>&nbsp;<span class="num" id="6280253">2</span><span class="op" id="6280254">}</span>&nbsp;<span class="comment" id="6280256">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280270">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280274">return</span>&nbsp;<span class="op" id="6280281">&amp;</span><span class="ident" id="6280282">ast</span><span class="op" id="6280285">.</span><span class="ident" id="6280286">GoStmt</span><span class="op" id="6280292">{</span><span class="ident" id="6280293">Go</span><span class="op" id="6280295">:</span>&nbsp;<span class="ident" id="6280297">pos</span><span class="op" id="6280300">,</span>&nbsp;<span class="ident" id="6280302">Call</span><span class="op" id="6280306">:</span>&nbsp;<span class="ident" id="6280308">call</span><span class="op" id="6280312">}</span><br>
<span class="lineno"></span><span class="op" id="6280314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6280317">func</span>&nbsp;<span class="op" id="6280322">(</span><span class="ident" id="6280323">p</span>&nbsp;<span class="op" id="6280325">*</span><span class="ident" id="6280326">parser</span><span class="op" id="6280332">)</span>&nbsp;<span class="ident" id="6280334">parseDeferStmt</span><span class="op" id="6280348">(</span><span class="op" id="6280349">)</span>&nbsp;<span class="ident" id="6280351">ast</span><span class="op" id="6280354">.</span><span class="ident" id="6280355">Stmt</span>&nbsp;<span class="op" id="6280360">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280363">if</span>&nbsp;<span class="ident" id="6280366">p</span><span class="op" id="6280367">.</span><span class="ident" id="6280368">trace</span>&nbsp;<span class="op" id="6280374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280378">defer</span>&nbsp;<span class="ident" id="6280384">un</span><span class="op" id="6280386">(</span><span class="ident" id="6280387">trace</span><span class="op" id="6280392">(</span><span class="ident" id="6280393">p</span><span class="op" id="6280394">,</span>&nbsp;<span class="string" id="6280396">&#34;DeferStmt&#34;</span><span class="op" id="6280407">)</span><span class="op" id="6280408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280415">pos</span>&nbsp;<span class="op" id="6280419">:=</span>&nbsp;<span class="ident" id="6280422">p</span><span class="op" id="6280423">.</span><span class="ident" id="6280424">expect</span><span class="op" id="6280430">(</span><span class="ident" id="6280431">token</span><span class="op" id="6280436">.</span><span class="ident" id="6280437">DEFER</span><span class="op" id="6280442">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280445">call</span>&nbsp;<span class="op" id="6280450">:=</span>&nbsp;<span class="ident" id="6280453">p</span><span class="op" id="6280454">.</span><span class="ident" id="6280455">parseCallExpr</span><span class="op" id="6280468">(</span><span class="string" id="6280469">&#34;defer&#34;</span><span class="op" id="6280476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280479">p</span><span class="op" id="6280480">.</span><span class="ident" id="6280481">expectSemi</span><span class="op" id="6280491">(</span><span class="op" id="6280492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280495">if</span>&nbsp;<span class="ident" id="6280498">call</span>&nbsp;<span class="op" id="6280503">==</span>&nbsp;<span class="ident" id="6280506">nil</span>&nbsp;<span class="op" id="6280510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280514">return</span>&nbsp;<span class="op" id="6280521">&amp;</span><span class="ident" id="6280522">ast</span><span class="op" id="6280525">.</span><span class="ident" id="6280526">BadStmt</span><span class="op" id="6280533">{</span><span class="ident" id="6280534">From</span><span class="op" id="6280538">:</span>&nbsp;<span class="ident" id="6280540">pos</span><span class="op" id="6280543">,</span>&nbsp;<span class="ident" id="6280545">To</span><span class="op" id="6280547">:</span>&nbsp;<span class="ident" id="6280549">pos</span>&nbsp;<span class="op" id="6280553">+</span>&nbsp;<span class="num" id="6280555">5</span><span class="op" id="6280556">}</span>&nbsp;<span class="comment" id="6280558">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280575">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280579">return</span>&nbsp;<span class="op" id="6280586">&amp;</span><span class="ident" id="6280587">ast</span><span class="op" id="6280590">.</span><span class="ident" id="6280591">DeferStmt</span><span class="op" id="6280600">{</span><span class="ident" id="6280601">Defer</span><span class="op" id="6280606">:</span>&nbsp;<span class="ident" id="6280608">pos</span><span class="op" id="6280611">,</span>&nbsp;<span class="ident" id="6280613">Call</span><span class="op" id="6280617">:</span>&nbsp;<span class="ident" id="6280619">call</span><span class="op" id="6280623">}</span><br>
<span class="lineno"></span><span class="op" id="6280625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6280628">func</span>&nbsp;<span class="op" id="6280633">(</span><span class="ident" id="6280634">p</span>&nbsp;<span class="op" id="6280636">*</span><span class="ident" id="6280637">parser</span><span class="op" id="6280643">)</span>&nbsp;<span class="ident" id="6280645">parseReturnStmt</span><span class="op" id="6280660">(</span><span class="op" id="6280661">)</span>&nbsp;<span class="op" id="6280663">*</span><span class="ident" id="6280664">ast</span><span class="op" id="6280667">.</span><span class="ident" id="6280668">ReturnStmt</span>&nbsp;<span class="op" id="6280679">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280682">if</span>&nbsp;<span class="ident" id="6280685">p</span><span class="op" id="6280686">.</span><span class="ident" id="6280687">trace</span>&nbsp;<span class="op" id="6280693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280697">defer</span>&nbsp;<span class="ident" id="6280703">un</span><span class="op" id="6280705">(</span><span class="ident" id="6280706">trace</span><span class="op" id="6280711">(</span><span class="ident" id="6280712">p</span><span class="op" id="6280713">,</span>&nbsp;<span class="string" id="6280715">&#34;ReturnStmt&#34;</span><span class="op" id="6280727">)</span><span class="op" id="6280728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280735">pos</span>&nbsp;<span class="op" id="6280739">:=</span>&nbsp;<span class="ident" id="6280742">p</span><span class="op" id="6280743">.</span><span class="ident" id="6280744">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280749">p</span><span class="op" id="6280750">.</span><span class="ident" id="6280751">expect</span><span class="op" id="6280757">(</span><span class="ident" id="6280758">token</span><span class="op" id="6280763">.</span><span class="ident" id="6280764">RETURN</span><span class="op" id="6280770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280773">var</span>&nbsp;<span class="ident" id="6280777">x</span>&nbsp;<span class="op" id="6280779">[</span><span class="op" id="6280780">]</span><span class="ident" id="6280781">ast</span><span class="op" id="6280784">.</span><span class="ident" id="6280785">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280791">if</span>&nbsp;<span class="ident" id="6280794">p</span><span class="op" id="6280795">.</span><span class="ident" id="6280796">tok</span>&nbsp;<span class="op" id="6280800">!=</span>&nbsp;<span class="ident" id="6280803">token</span><span class="op" id="6280808">.</span><span class="ident" id="6280809">SEMICOLON</span>&nbsp;<span class="op" id="6280819">&amp;&amp;</span>&nbsp;<span class="ident" id="6280822">p</span><span class="op" id="6280823">.</span><span class="ident" id="6280824">tok</span>&nbsp;<span class="op" id="6280828">!=</span>&nbsp;<span class="ident" id="6280831">token</span><span class="op" id="6280836">.</span><span class="ident" id="6280837">RBRACE</span>&nbsp;<span class="op" id="6280844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280848">x</span>&nbsp;<span class="op" id="6280850">=</span>&nbsp;<span class="ident" id="6280852">p</span><span class="op" id="6280853">.</span><span class="ident" id="6280854">parseRhsList</span><span class="op" id="6280866">(</span><span class="op" id="6280867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280870">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280873">p</span><span class="op" id="6280874">.</span><span class="ident" id="6280875">expectSemi</span><span class="op" id="6280885">(</span><span class="op" id="6280886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280890">return</span>&nbsp;<span class="op" id="6280897">&amp;</span><span class="ident" id="6280898">ast</span><span class="op" id="6280901">.</span><span class="ident" id="6280902">ReturnStmt</span><span class="op" id="6280912">{</span><span class="ident" id="6280913">Return</span><span class="op" id="6280919">:</span>&nbsp;<span class="ident" id="6280921">pos</span><span class="op" id="6280924">,</span>&nbsp;<span class="ident" id="6280926">Results</span><span class="op" id="6280933">:</span>&nbsp;<span class="ident" id="6280935">x</span><span class="op" id="6280936">}</span><br>
<span class="lineno"></span><span class="op" id="6280938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="6280941">func</span>&nbsp;<span class="op" id="6280946">(</span><span class="ident" id="6280947">p</span>&nbsp;<span class="op" id="6280949">*</span><span class="ident" id="6280950">parser</span><span class="op" id="6280956">)</span>&nbsp;<span class="ident" id="6280958">parseBranchStmt</span><span class="op" id="6280973">(</span><span class="ident" id="6280974">tok</span>&nbsp;<span class="ident" id="6280978">token</span><span class="op" id="6280983">.</span><span class="ident" id="6280984">Token</span><span class="op" id="6280989">)</span>&nbsp;<span class="op" id="6280991">*</span><span class="ident" id="6280992">ast</span><span class="op" id="6280995">.</span><span class="ident" id="6280996">BranchStmt</span>&nbsp;<span class="op" id="6281007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281010">if</span>&nbsp;<span class="ident" id="6281013">p</span><span class="op" id="6281014">.</span><span class="ident" id="6281015">trace</span>&nbsp;<span class="op" id="6281021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281025">defer</span>&nbsp;<span class="ident" id="6281031">un</span><span class="op" id="6281033">(</span><span class="ident" id="6281034">trace</span><span class="op" id="6281039">(</span><span class="ident" id="6281040">p</span><span class="op" id="6281041">,</span>&nbsp;<span class="string" id="6281043">&#34;BranchStmt&#34;</span><span class="op" id="6281055">)</span><span class="op" id="6281056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281063">pos</span>&nbsp;<span class="op" id="6281067">:=</span>&nbsp;<span class="ident" id="6281070">p</span><span class="op" id="6281071">.</span><span class="ident" id="6281072">expect</span><span class="op" id="6281078">(</span><span class="ident" id="6281079">tok</span><span class="op" id="6281082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281085">var</span>&nbsp;<span class="ident" id="6281089">label</span>&nbsp;<span class="op" id="6281095">*</span><span class="ident" id="6281096">ast</span><span class="op" id="6281099">.</span><span class="ident" id="6281100">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281107">if</span>&nbsp;<span class="ident" id="6281110">tok</span>&nbsp;<span class="op" id="6281114">!=</span>&nbsp;<span class="ident" id="6281117">token</span><span class="op" id="6281122">.</span><span class="ident" id="6281123">FALLTHROUGH</span>&nbsp;<span class="op" id="6281135">&amp;&amp;</span>&nbsp;<span class="ident" id="6281138">p</span><span class="op" id="6281139">.</span><span class="ident" id="6281140">tok</span>&nbsp;<span class="op" id="6281144">==</span>&nbsp;<span class="ident" id="6281147">token</span><span class="op" id="6281152">.</span><span class="ident" id="6281153">IDENT</span>&nbsp;<span class="op" id="6281159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281163">label</span>&nbsp;<span class="op" id="6281169">=</span>&nbsp;<span class="ident" id="6281171">p</span><span class="op" id="6281172">.</span><span class="ident" id="6281173">parseIdent</span><span class="op" id="6281183">(</span><span class="op" id="6281184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6281188">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281227">n</span>&nbsp;<span class="op" id="6281229">:=</span>&nbsp;<span class="builtinfunc" id="6281232">len</span><span class="op" id="6281235">(</span><span class="ident" id="6281236">p</span><span class="op" id="6281237">.</span><span class="ident" id="6281238">targetStack</span><span class="op" id="6281249">)</span>&nbsp;<span class="op" id="6281251">-</span>&nbsp;<span class="num" id="6281253">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281257">p</span><span class="op" id="6281258">.</span><span class="ident" id="6281259">targetStack</span><span class="op" id="6281270">[</span><span class="ident" id="6281271">n</span><span class="op" id="6281272">]</span>&nbsp;<span class="op" id="6281274">=</span>&nbsp;<span class="builtinfunc" id="6281276">append</span><span class="op" id="6281282">(</span><span class="ident" id="6281283">p</span><span class="op" id="6281284">.</span><span class="ident" id="6281285">targetStack</span><span class="op" id="6281296">[</span><span class="ident" id="6281297">n</span><span class="op" id="6281298">]</span><span class="op" id="6281299">,</span>&nbsp;<span class="ident" id="6281301">label</span><span class="op" id="6281306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281312">p</span><span class="op" id="6281313">.</span><span class="ident" id="6281314">expectSemi</span><span class="op" id="6281324">(</span><span class="op" id="6281325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281329">return</span>&nbsp;<span class="op" id="6281336">&amp;</span><span class="ident" id="6281337">ast</span><span class="op" id="6281340">.</span><span class="ident" id="6281341">BranchStmt</span><span class="op" id="6281351">{</span><span class="ident" id="6281352">TokPos</span><span class="op" id="6281358">:</span>&nbsp;<span class="ident" id="6281360">pos</span><span class="op" id="6281363">,</span>&nbsp;<span class="ident" id="6281365">Tok</span><span class="op" id="6281368">:</span>&nbsp;<span class="ident" id="6281370">tok</span><span class="op" id="6281373">,</span>&nbsp;<span class="ident" id="6281375">Label</span><span class="op" id="6281380">:</span>&nbsp;<span class="ident" id="6281382">label</span><span class="op" id="6281387">}</span><br>
<span class="lineno"></span><span class="op" id="6281389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6281392">func</span>&nbsp;<span class="op" id="6281397">(</span><span class="ident" id="6281398">p</span>&nbsp;<span class="op" id="6281400">*</span><span class="ident" id="6281401">parser</span><span class="op" id="6281407">)</span>&nbsp;<span class="ident" id="6281409">makeExpr</span><span class="op" id="6281417">(</span><span class="ident" id="6281418">s</span>&nbsp;<span class="ident" id="6281420">ast</span><span class="op" id="6281423">.</span><span class="ident" id="6281424">Stmt</span><span class="op" id="6281428">,</span>&nbsp;<span class="ident" id="6281430">kind</span>&nbsp;<span class="builtintype" id="6281435">string</span><span class="op" id="6281441">)</span>&nbsp;<span class="ident" id="6281443">ast</span><span class="op" id="6281446">.</span><span class="ident" id="6281447">Expr</span>&nbsp;<span class="op" id="6281452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281455">if</span>&nbsp;<span class="ident" id="6281458">s</span>&nbsp;<span class="op" id="6281460">==</span>&nbsp;<span class="ident" id="6281463">nil</span>&nbsp;<span class="op" id="6281467">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281471">return</span>&nbsp;<span class="ident" id="6281478">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281486">if</span>&nbsp;<span class="ident" id="6281489">es</span><span class="op" id="6281491">,</span>&nbsp;<span class="ident" id="6281493">isExpr</span>&nbsp;<span class="op" id="6281500">:=</span>&nbsp;<span class="ident" id="6281503">s</span><span class="op" id="6281504">.</span><span class="op" id="6281505">(</span><span class="op" id="6281506">*</span><span class="ident" id="6281507">ast</span><span class="op" id="6281510">.</span><span class="ident" id="6281511">ExprStmt</span><span class="op" id="6281519">)</span><span class="op" id="6281520">;</span>&nbsp;<span class="ident" id="6281522">isExpr</span>&nbsp;<span class="op" id="6281529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281533">return</span>&nbsp;<span class="ident" id="6281540">p</span><span class="op" id="6281541">.</span><span class="ident" id="6281542">checkExpr</span><span class="op" id="6281551">(</span><span class="ident" id="6281552">es</span><span class="op" id="6281554">.</span><span class="ident" id="6281555">X</span><span class="op" id="6281556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281559">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281562">p</span><span class="op" id="6281563">.</span><span class="builtintype" id="6281564">error</span><span class="op" id="6281569">(</span><span class="ident" id="6281570">s</span><span class="op" id="6281571">.</span><span class="ident" id="6281572">Pos</span><span class="op" id="6281575">(</span><span class="op" id="6281576">)</span><span class="op" id="6281577">,</span>&nbsp;<span class="ident" id="6281579">fmt</span><span class="op" id="6281582">.</span><span class="ident" id="6281583">Sprintf</span><span class="op" id="6281590">(</span><span class="string" id="6281591">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="6281676">,</span>&nbsp;<span class="ident" id="6281678">kind</span><span class="op" id="6281682">)</span><span class="op" id="6281683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281686">return</span>&nbsp;<span class="op" id="6281693">&amp;</span><span class="ident" id="6281694">ast</span><span class="op" id="6281697">.</span><span class="ident" id="6281698">BadExpr</span><span class="op" id="6281705">{</span><span class="ident" id="6281706">From</span><span class="op" id="6281710">:</span>&nbsp;<span class="ident" id="6281712">s</span><span class="op" id="6281713">.</span><span class="ident" id="6281714">Pos</span><span class="op" id="6281717">(</span><span class="op" id="6281718">)</span><span class="op" id="6281719">,</span>&nbsp;<span class="ident" id="6281721">To</span><span class="op" id="6281723">:</span>&nbsp;<span class="ident" id="6281725">p</span><span class="op" id="6281726">.</span><span class="ident" id="6281727">safePos</span><span class="op" id="6281734">(</span><span class="ident" id="6281735">s</span><span class="op" id="6281736">.</span><span class="ident" id="6281737">End</span><span class="op" id="6281740">(</span><span class="op" id="6281741">)</span><span class="op" id="6281742">)</span><span class="op" id="6281743">}</span><br>
<span class="lineno"></span><span class="op" id="6281745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6281748">func</span>&nbsp;<span class="op" id="6281753">(</span><span class="ident" id="6281754">p</span>&nbsp;<span class="op" id="6281756">*</span><span class="ident" id="6281757">parser</span><span class="op" id="6281763">)</span>&nbsp;<span class="ident" id="6281765">parseIfStmt</span><span class="op" id="6281776">(</span><span class="op" id="6281777">)</span>&nbsp;<span class="op" id="6281779">*</span><span class="ident" id="6281780">ast</span><span class="op" id="6281783">.</span><span class="ident" id="6281784">IfStmt</span>&nbsp;<span class="op" id="6281791">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281794">if</span>&nbsp;<span class="ident" id="6281797">p</span><span class="op" id="6281798">.</span><span class="ident" id="6281799">trace</span>&nbsp;<span class="op" id="6281805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281809">defer</span>&nbsp;<span class="ident" id="6281815">un</span><span class="op" id="6281817">(</span><span class="ident" id="6281818">trace</span><span class="op" id="6281823">(</span><span class="ident" id="6281824">p</span><span class="op" id="6281825">,</span>&nbsp;<span class="string" id="6281827">&#34;IfStmt&#34;</span><span class="op" id="6281835">)</span><span class="op" id="6281836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281843">pos</span>&nbsp;<span class="op" id="6281847">:=</span>&nbsp;<span class="ident" id="6281850">p</span><span class="op" id="6281851">.</span><span class="ident" id="6281852">expect</span><span class="op" id="6281858">(</span><span class="ident" id="6281859">token</span><span class="op" id="6281864">.</span><span class="ident" id="6281865">IF</span><span class="op" id="6281867">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281870">p</span><span class="op" id="6281871">.</span><span class="ident" id="6281872">openScope</span><span class="op" id="6281881">(</span><span class="op" id="6281882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281885">defer</span>&nbsp;<span class="ident" id="6281891">p</span><span class="op" id="6281892">.</span><span class="ident" id="6281893">closeScope</span><span class="op" id="6281903">(</span><span class="op" id="6281904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281908">var</span>&nbsp;<span class="ident" id="6281912">s</span>&nbsp;<span class="ident" id="6281914">ast</span><span class="op" id="6281917">.</span><span class="ident" id="6281918">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281924">var</span>&nbsp;<span class="ident" id="6281928">x</span>&nbsp;<span class="ident" id="6281930">ast</span><span class="op" id="6281933">.</span><span class="ident" id="6281934">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281944">prevLev</span>&nbsp;<span class="op" id="6281952">:=</span>&nbsp;<span class="ident" id="6281955">p</span><span class="op" id="6281956">.</span><span class="ident" id="6281957">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281967">p</span><span class="op" id="6281968">.</span><span class="ident" id="6281969">exprLev</span>&nbsp;<span class="op" id="6281977">=</span>&nbsp;<span class="op" id="6281979">-</span><span class="num" id="6281980">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281984">if</span>&nbsp;<span class="ident" id="6281987">p</span><span class="op" id="6281988">.</span><span class="ident" id="6281989">tok</span>&nbsp;<span class="op" id="6281993">==</span>&nbsp;<span class="ident" id="6281996">token</span><span class="op" id="6282001">.</span><span class="ident" id="6282002">SEMICOLON</span>&nbsp;<span class="op" id="6282012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282017">p</span><span class="op" id="6282018">.</span><span class="ident" id="6282019">next</span><span class="op" id="6282023">(</span><span class="op" id="6282024">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282029">x</span>&nbsp;<span class="op" id="6282031">=</span>&nbsp;<span class="ident" id="6282033">p</span><span class="op" id="6282034">.</span><span class="ident" id="6282035">parseRhs</span><span class="op" id="6282043">(</span><span class="op" id="6282044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282048">}</span>&nbsp;<span class="keyword" id="6282050">else</span>&nbsp;<span class="op" id="6282055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282060">s</span><span class="op" id="6282061">,</span>&nbsp;<span class="ident" id="6282063">_</span>&nbsp;<span class="op" id="6282065">=</span>&nbsp;<span class="ident" id="6282067">p</span><span class="op" id="6282068">.</span><span class="ident" id="6282069">parseSimpleStmt</span><span class="op" id="6282084">(</span><span class="ident" id="6282085">basic</span><span class="op" id="6282090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282095">if</span>&nbsp;<span class="ident" id="6282098">p</span><span class="op" id="6282099">.</span><span class="ident" id="6282100">tok</span>&nbsp;<span class="op" id="6282104">==</span>&nbsp;<span class="ident" id="6282107">token</span><span class="op" id="6282112">.</span><span class="ident" id="6282113">SEMICOLON</span>&nbsp;<span class="op" id="6282123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282129">p</span><span class="op" id="6282130">.</span><span class="ident" id="6282131">next</span><span class="op" id="6282135">(</span><span class="op" id="6282136">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282142">x</span>&nbsp;<span class="op" id="6282144">=</span>&nbsp;<span class="ident" id="6282146">p</span><span class="op" id="6282147">.</span><span class="ident" id="6282148">parseRhs</span><span class="op" id="6282156">(</span><span class="op" id="6282157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282162">}</span>&nbsp;<span class="keyword" id="6282164">else</span>&nbsp;<span class="op" id="6282169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282175">x</span>&nbsp;<span class="op" id="6282177">=</span>&nbsp;<span class="ident" id="6282179">p</span><span class="op" id="6282180">.</span><span class="ident" id="6282181">makeExpr</span><span class="op" id="6282189">(</span><span class="ident" id="6282190">s</span><span class="op" id="6282191">,</span>&nbsp;<span class="string" id="6282193">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="6282213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282219">s</span>&nbsp;<span class="op" id="6282221">=</span>&nbsp;<span class="ident" id="6282223">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282230">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282238">p</span><span class="op" id="6282239">.</span><span class="ident" id="6282240">exprLev</span>&nbsp;<span class="op" id="6282248">=</span>&nbsp;<span class="ident" id="6282250">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282263">body</span>&nbsp;<span class="op" id="6282268">:=</span>&nbsp;<span class="ident" id="6282271">p</span><span class="op" id="6282272">.</span><span class="ident" id="6282273">parseBlockStmt</span><span class="op" id="6282287">(</span><span class="op" id="6282288">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282291">var</span>&nbsp;<span class="ident" id="6282295">else_</span>&nbsp;<span class="ident" id="6282301">ast</span><span class="op" id="6282304">.</span><span class="ident" id="6282305">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282311">if</span>&nbsp;<span class="ident" id="6282314">p</span><span class="op" id="6282315">.</span><span class="ident" id="6282316">tok</span>&nbsp;<span class="op" id="6282320">==</span>&nbsp;<span class="ident" id="6282323">token</span><span class="op" id="6282328">.</span><span class="ident" id="6282329">ELSE</span>&nbsp;<span class="op" id="6282334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282338">p</span><span class="op" id="6282339">.</span><span class="ident" id="6282340">next</span><span class="op" id="6282344">(</span><span class="op" id="6282345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282349">else_</span>&nbsp;<span class="op" id="6282355">=</span>&nbsp;<span class="ident" id="6282357">p</span><span class="op" id="6282358">.</span><span class="ident" id="6282359">parseStmt</span><span class="op" id="6282368">(</span><span class="op" id="6282369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282372">}</span>&nbsp;<span class="keyword" id="6282374">else</span>&nbsp;<span class="op" id="6282379">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282383">p</span><span class="op" id="6282384">.</span><span class="ident" id="6282385">expectSemi</span><span class="op" id="6282395">(</span><span class="op" id="6282396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282403">return</span>&nbsp;<span class="op" id="6282410">&amp;</span><span class="ident" id="6282411">ast</span><span class="op" id="6282414">.</span><span class="ident" id="6282415">IfStmt</span><span class="op" id="6282421">{</span><span class="ident" id="6282422">If</span><span class="op" id="6282424">:</span>&nbsp;<span class="ident" id="6282426">pos</span><span class="op" id="6282429">,</span>&nbsp;<span class="ident" id="6282431">Init</span><span class="op" id="6282435">:</span>&nbsp;<span class="ident" id="6282437">s</span><span class="op" id="6282438">,</span>&nbsp;<span class="ident" id="6282440">Cond</span><span class="op" id="6282444">:</span>&nbsp;<span class="ident" id="6282446">x</span><span class="op" id="6282447">,</span>&nbsp;<span class="ident" id="6282449">Body</span><span class="op" id="6282453">:</span>&nbsp;<span class="ident" id="6282455">body</span><span class="op" id="6282459">,</span>&nbsp;<span class="ident" id="6282461">Else</span><span class="op" id="6282465">:</span>&nbsp;<span class="ident" id="6282467">else_</span><span class="op" id="6282472">}</span><br>
<span class="lineno"></span><span class="op" id="6282474">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="6282477">func</span>&nbsp;<span class="op" id="6282482">(</span><span class="ident" id="6282483">p</span>&nbsp;<span class="op" id="6282485">*</span><span class="ident" id="6282486">parser</span><span class="op" id="6282492">)</span>&nbsp;<span class="ident" id="6282494">parseTypeList</span><span class="op" id="6282507">(</span><span class="op" id="6282508">)</span>&nbsp;<span class="op" id="6282510">(</span><span class="ident" id="6282511">list</span>&nbsp;<span class="op" id="6282516">[</span><span class="op" id="6282517">]</span><span class="ident" id="6282518">ast</span><span class="op" id="6282521">.</span><span class="ident" id="6282522">Expr</span><span class="op" id="6282526">)</span>&nbsp;<span class="op" id="6282528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282531">if</span>&nbsp;<span class="ident" id="6282534">p</span><span class="op" id="6282535">.</span><span class="ident" id="6282536">trace</span>&nbsp;<span class="op" id="6282542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282546">defer</span>&nbsp;<span class="ident" id="6282552">un</span><span class="op" id="6282554">(</span><span class="ident" id="6282555">trace</span><span class="op" id="6282560">(</span><span class="ident" id="6282561">p</span><span class="op" id="6282562">,</span>&nbsp;<span class="string" id="6282564">&#34;TypeList&#34;</span><span class="op" id="6282574">)</span><span class="op" id="6282575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282578">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282582">list</span>&nbsp;<span class="op" id="6282587">=</span>&nbsp;<span class="builtinfunc" id="6282589">append</span><span class="op" id="6282595">(</span><span class="ident" id="6282596">list</span><span class="op" id="6282600">,</span>&nbsp;<span class="ident" id="6282602">p</span><span class="op" id="6282603">.</span><span class="ident" id="6282604">parseType</span><span class="op" id="6282613">(</span><span class="op" id="6282614">)</span><span class="op" id="6282615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282618">for</span>&nbsp;<span class="ident" id="6282622">p</span><span class="op" id="6282623">.</span><span class="ident" id="6282624">tok</span>&nbsp;<span class="op" id="6282628">==</span>&nbsp;<span class="ident" id="6282631">token</span><span class="op" id="6282636">.</span><span class="ident" id="6282637">COMMA</span>&nbsp;<span class="op" id="6282643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282647">p</span><span class="op" id="6282648">.</span><span class="ident" id="6282649">next</span><span class="op" id="6282653">(</span><span class="op" id="6282654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282658">list</span>&nbsp;<span class="op" id="6282663">=</span>&nbsp;<span class="builtinfunc" id="6282665">append</span><span class="op" id="6282671">(</span><span class="ident" id="6282672">list</span><span class="op" id="6282676">,</span>&nbsp;<span class="ident" id="6282678">p</span><span class="op" id="6282679">.</span><span class="ident" id="6282680">parseType</span><span class="op" id="6282689">(</span><span class="op" id="6282690">)</span><span class="op" id="6282691">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282698">return</span><br>
<span class="lineno"></span><span class="op" id="6282705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="6282708">func</span>&nbsp;<span class="op" id="6282713">(</span><span class="ident" id="6282714">p</span>&nbsp;<span class="op" id="6282716">*</span><span class="ident" id="6282717">parser</span><span class="op" id="6282723">)</span>&nbsp;<span class="ident" id="6282725">parseCaseClause</span><span class="op" id="6282740">(</span><span class="ident" id="6282741">typeSwitch</span>&nbsp;<span class="builtintype" id="6282752">bool</span><span class="op" id="6282756">)</span>&nbsp;<span class="op" id="6282758">*</span><span class="ident" id="6282759">ast</span><span class="op" id="6282762">.</span><span class="ident" id="6282763">CaseClause</span>&nbsp;<span class="op" id="6282774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282777">if</span>&nbsp;<span class="ident" id="6282780">p</span><span class="op" id="6282781">.</span><span class="ident" id="6282782">trace</span>&nbsp;<span class="op" id="6282788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282792">defer</span>&nbsp;<span class="ident" id="6282798">un</span><span class="op" id="6282800">(</span><span class="ident" id="6282801">trace</span><span class="op" id="6282806">(</span><span class="ident" id="6282807">p</span><span class="op" id="6282808">,</span>&nbsp;<span class="string" id="6282810">&#34;CaseClause&#34;</span><span class="op" id="6282822">)</span><span class="op" id="6282823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282830">pos</span>&nbsp;<span class="op" id="6282834">:=</span>&nbsp;<span class="ident" id="6282837">p</span><span class="op" id="6282838">.</span><span class="ident" id="6282839">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282844">var</span>&nbsp;<span class="ident" id="6282848">list</span>&nbsp;<span class="op" id="6282853">[</span><span class="op" id="6282854">]</span><span class="ident" id="6282855">ast</span><span class="op" id="6282858">.</span><span class="ident" id="6282859">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282865">if</span>&nbsp;<span class="ident" id="6282868">p</span><span class="op" id="6282869">.</span><span class="ident" id="6282870">tok</span>&nbsp;<span class="op" id="6282874">==</span>&nbsp;<span class="ident" id="6282877">token</span><span class="op" id="6282882">.</span><span class="ident" id="6282883">CASE</span>&nbsp;<span class="op" id="6282888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282892">p</span><span class="op" id="6282893">.</span><span class="ident" id="6282894">next</span><span class="op" id="6282898">(</span><span class="op" id="6282899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282903">if</span>&nbsp;<span class="ident" id="6282906">typeSwitch</span>&nbsp;<span class="op" id="6282917">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282922">list</span>&nbsp;<span class="op" id="6282927">=</span>&nbsp;<span class="ident" id="6282929">p</span><span class="op" id="6282930">.</span><span class="ident" id="6282931">parseTypeList</span><span class="op" id="6282944">(</span><span class="op" id="6282945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282949">}</span>&nbsp;<span class="keyword" id="6282951">else</span>&nbsp;<span class="op" id="6282956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282961">list</span>&nbsp;<span class="op" id="6282966">=</span>&nbsp;<span class="ident" id="6282968">p</span><span class="op" id="6282969">.</span><span class="ident" id="6282970">parseRhsList</span><span class="op" id="6282982">(</span><span class="op" id="6282983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282990">}</span>&nbsp;<span class="keyword" id="6282992">else</span>&nbsp;<span class="op" id="6282997">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283001">p</span><span class="op" id="6283002">.</span><span class="ident" id="6283003">expect</span><span class="op" id="6283009">(</span><span class="ident" id="6283010">token</span><span class="op" id="6283015">.</span><span class="ident" id="6283016">DEFAULT</span><span class="op" id="6283023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283030">colon</span>&nbsp;<span class="op" id="6283036">:=</span>&nbsp;<span class="ident" id="6283039">p</span><span class="op" id="6283040">.</span><span class="ident" id="6283041">expect</span><span class="op" id="6283047">(</span><span class="ident" id="6283048">token</span><span class="op" id="6283053">.</span><span class="ident" id="6283054">COLON</span><span class="op" id="6283059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283062">p</span><span class="op" id="6283063">.</span><span class="ident" id="6283064">openScope</span><span class="op" id="6283073">(</span><span class="op" id="6283074">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283077">body</span>&nbsp;<span class="op" id="6283082">:=</span>&nbsp;<span class="ident" id="6283085">p</span><span class="op" id="6283086">.</span><span class="ident" id="6283087">parseStmtList</span><span class="op" id="6283100">(</span><span class="op" id="6283101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283104">p</span><span class="op" id="6283105">.</span><span class="ident" id="6283106">closeScope</span><span class="op" id="6283116">(</span><span class="op" id="6283117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283121">return</span>&nbsp;<span class="op" id="6283128">&amp;</span><span class="ident" id="6283129">ast</span><span class="op" id="6283132">.</span><span class="ident" id="6283133">CaseClause</span><span class="op" id="6283143">{</span><span class="ident" id="6283144">Case</span><span class="op" id="6283148">:</span>&nbsp;<span class="ident" id="6283150">pos</span><span class="op" id="6283153">,</span>&nbsp;<span class="ident" id="6283155">List</span><span class="op" id="6283159">:</span>&nbsp;<span class="ident" id="6283161">list</span><span class="op" id="6283165">,</span>&nbsp;<span class="ident" id="6283167">Colon</span><span class="op" id="6283172">:</span>&nbsp;<span class="ident" id="6283174">colon</span><span class="op" id="6283179">,</span>&nbsp;<span class="ident" id="6283181">Body</span><span class="op" id="6283185">:</span>&nbsp;<span class="ident" id="6283187">body</span><span class="op" id="6283191">}</span><br>
<span class="lineno"></span><span class="op" id="6283193">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="6283196">func</span>&nbsp;<span class="ident" id="6283201">isTypeSwitchAssert</span><span class="op" id="6283219">(</span><span class="ident" id="6283220">x</span>&nbsp;<span class="ident" id="6283222">ast</span><span class="op" id="6283225">.</span><span class="ident" id="6283226">Expr</span><span class="op" id="6283230">)</span>&nbsp;<span class="builtintype" id="6283232">bool</span>&nbsp;<span class="op" id="6283237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283240">a</span><span class="op" id="6283241">,</span>&nbsp;<span class="ident" id="6283243">ok</span>&nbsp;<span class="op" id="6283246">:=</span>&nbsp;<span class="ident" id="6283249">x</span><span class="op" id="6283250">.</span><span class="op" id="6283251">(</span><span class="op" id="6283252">*</span><span class="ident" id="6283253">ast</span><span class="op" id="6283256">.</span><span class="ident" id="6283257">TypeAssertExpr</span><span class="op" id="6283271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283274">return</span>&nbsp;<span class="ident" id="6283281">ok</span>&nbsp;<span class="op" id="6283284">&amp;&amp;</span>&nbsp;<span class="ident" id="6283287">a</span><span class="op" id="6283288">.</span><span class="ident" id="6283289">Type</span>&nbsp;<span class="op" id="6283294">==</span>&nbsp;<span class="ident" id="6283297">nil</span><br>
<span class="lineno"></span><span class="op" id="6283301">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="6283304">func</span>&nbsp;<span class="ident" id="6283309">isTypeSwitchGuard</span><span class="op" id="6283326">(</span><span class="ident" id="6283327">s</span>&nbsp;<span class="ident" id="6283329">ast</span><span class="op" id="6283332">.</span><span class="ident" id="6283333">Stmt</span><span class="op" id="6283337">)</span>&nbsp;<span class="builtintype" id="6283339">bool</span>&nbsp;<span class="op" id="6283344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283347">switch</span>&nbsp;<span class="ident" id="6283354">t</span>&nbsp;<span class="op" id="6283356">:=</span>&nbsp;<span class="ident" id="6283359">s</span><span class="op" id="6283360">.</span><span class="op" id="6283361">(</span><span class="keyword" id="6283362">type</span><span class="op" id="6283366">)</span>&nbsp;<span class="op" id="6283368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283371">case</span>&nbsp;<span class="op" id="6283376">*</span><span class="ident" id="6283377">ast</span><span class="op" id="6283380">.</span><span class="ident" id="6283381">ExprStmt</span><span class="op" id="6283389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283393">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283406">return</span>&nbsp;<span class="ident" id="6283413">isTypeSwitchAssert</span><span class="op" id="6283431">(</span><span class="ident" id="6283432">t</span><span class="op" id="6283433">.</span><span class="ident" id="6283434">X</span><span class="op" id="6283435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283438">case</span>&nbsp;<span class="op" id="6283443">*</span><span class="ident" id="6283444">ast</span><span class="op" id="6283447">.</span><span class="ident" id="6283448">AssignStmt</span><span class="op" id="6283458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283462">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283480">return</span>&nbsp;<span class="builtinfunc" id="6283487">len</span><span class="op" id="6283490">(</span><span class="ident" id="6283491">t</span><span class="op" id="6283492">.</span><span class="ident" id="6283493">Lhs</span><span class="op" id="6283496">)</span>&nbsp;<span class="op" id="6283498">==</span>&nbsp;<span class="num" id="6283501">1</span>&nbsp;<span class="op" id="6283503">&amp;&amp;</span>&nbsp;<span class="ident" id="6283506">t</span><span class="op" id="6283507">.</span><span class="ident" id="6283508">Tok</span>&nbsp;<span class="op" id="6283512">==</span>&nbsp;<span class="ident" id="6283515">token</span><span class="op" id="6283520">.</span><span class="ident" id="6283521">DEFINE</span>&nbsp;<span class="op" id="6283528">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6283531">len</span><span class="op" id="6283534">(</span><span class="ident" id="6283535">t</span><span class="op" id="6283536">.</span><span class="ident" id="6283537">Rhs</span><span class="op" id="6283540">)</span>&nbsp;<span class="op" id="6283542">==</span>&nbsp;<span class="num" id="6283545">1</span>&nbsp;<span class="op" id="6283547">&amp;&amp;</span>&nbsp;<span class="ident" id="6283550">isTypeSwitchAssert</span><span class="op" id="6283568">(</span><span class="ident" id="6283569">t</span><span class="op" id="6283570">.</span><span class="ident" id="6283571">Rhs</span><span class="op" id="6283574">[</span><span class="num" id="6283575">0</span><span class="op" id="6283576">]</span><span class="op" id="6283577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283580">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283583">return</span>&nbsp;<span class="builtintype" id="6283590">false</span><br>
<span class="lineno"></span><span class="op" id="6283596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6283599">func</span>&nbsp;<span class="op" id="6283604">(</span><span class="ident" id="6283605">p</span>&nbsp;<span class="op" id="6283607">*</span><span class="ident" id="6283608">parser</span><span class="op" id="6283614">)</span>&nbsp;<span class="ident" id="6283616">parseSwitchStmt</span><span class="op" id="6283631">(</span><span class="op" id="6283632">)</span>&nbsp;<span class="ident" id="6283634">ast</span><span class="op" id="6283637">.</span><span class="ident" id="6283638">Stmt</span>&nbsp;<span class="op" id="6283643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283646">if</span>&nbsp;<span class="ident" id="6283649">p</span><span class="op" id="6283650">.</span><span class="ident" id="6283651">trace</span>&nbsp;<span class="op" id="6283657">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283661">defer</span>&nbsp;<span class="ident" id="6283667">un</span><span class="op" id="6283669">(</span><span class="ident" id="6283670">trace</span><span class="op" id="6283675">(</span><span class="ident" id="6283676">p</span><span class="op" id="6283677">,</span>&nbsp;<span class="string" id="6283679">&#34;SwitchStmt&#34;</span><span class="op" id="6283691">)</span><span class="op" id="6283692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283699">pos</span>&nbsp;<span class="op" id="6283703">:=</span>&nbsp;<span class="ident" id="6283706">p</span><span class="op" id="6283707">.</span><span class="ident" id="6283708">expect</span><span class="op" id="6283714">(</span><span class="ident" id="6283715">token</span><span class="op" id="6283720">.</span><span class="ident" id="6283721">SWITCH</span><span class="op" id="6283727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283730">p</span><span class="op" id="6283731">.</span><span class="ident" id="6283732">openScope</span><span class="op" id="6283741">(</span><span class="op" id="6283742">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283745">defer</span>&nbsp;<span class="ident" id="6283751">p</span><span class="op" id="6283752">.</span><span class="ident" id="6283753">closeScope</span><span class="op" id="6283763">(</span><span class="op" id="6283764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283768">var</span>&nbsp;<span class="ident" id="6283772">s1</span><span class="op" id="6283774">,</span>&nbsp;<span class="ident" id="6283776">s2</span>&nbsp;<span class="ident" id="6283779">ast</span><span class="op" id="6283782">.</span><span class="ident" id="6283783">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283789">if</span>&nbsp;<span class="ident" id="6283792">p</span><span class="op" id="6283793">.</span><span class="ident" id="6283794">tok</span>&nbsp;<span class="op" id="6283798">!=</span>&nbsp;<span class="ident" id="6283801">token</span><span class="op" id="6283806">.</span><span class="ident" id="6283807">LBRACE</span>&nbsp;<span class="op" id="6283814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283818">prevLev</span>&nbsp;<span class="op" id="6283826">:=</span>&nbsp;<span class="ident" id="6283829">p</span><span class="op" id="6283830">.</span><span class="ident" id="6283831">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283841">p</span><span class="op" id="6283842">.</span><span class="ident" id="6283843">exprLev</span>&nbsp;<span class="op" id="6283851">=</span>&nbsp;<span class="op" id="6283853">-</span><span class="num" id="6283854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283858">if</span>&nbsp;<span class="ident" id="6283861">p</span><span class="op" id="6283862">.</span><span class="ident" id="6283863">tok</span>&nbsp;<span class="op" id="6283867">!=</span>&nbsp;<span class="ident" id="6283870">token</span><span class="op" id="6283875">.</span><span class="ident" id="6283876">SEMICOLON</span>&nbsp;<span class="op" id="6283886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283891">s2</span><span class="op" id="6283893">,</span>&nbsp;<span class="ident" id="6283895">_</span>&nbsp;<span class="op" id="6283897">=</span>&nbsp;<span class="ident" id="6283899">p</span><span class="op" id="6283900">.</span><span class="ident" id="6283901">parseSimpleStmt</span><span class="op" id="6283916">(</span><span class="ident" id="6283917">basic</span><span class="op" id="6283922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283930">if</span>&nbsp;<span class="ident" id="6283933">p</span><span class="op" id="6283934">.</span><span class="ident" id="6283935">tok</span>&nbsp;<span class="op" id="6283939">==</span>&nbsp;<span class="ident" id="6283942">token</span><span class="op" id="6283947">.</span><span class="ident" id="6283948">SEMICOLON</span>&nbsp;<span class="op" id="6283958">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283963">p</span><span class="op" id="6283964">.</span><span class="ident" id="6283965">next</span><span class="op" id="6283969">(</span><span class="op" id="6283970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283975">s1</span>&nbsp;<span class="op" id="6283978">=</span>&nbsp;<span class="ident" id="6283980">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283986">s2</span>&nbsp;<span class="op" id="6283989">=</span>&nbsp;<span class="ident" id="6283991">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283998">if</span>&nbsp;<span class="ident" id="6284001">p</span><span class="op" id="6284002">.</span><span class="ident" id="6284003">tok</span>&nbsp;<span class="op" id="6284007">!=</span>&nbsp;<span class="ident" id="6284010">token</span><span class="op" id="6284015">.</span><span class="ident" id="6284016">LBRACE</span>&nbsp;<span class="op" id="6284023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284029">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284089">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284148">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284208">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284215">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284256">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284263">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284317">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284377">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284432">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284439">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284504">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284568">p</span><span class="op" id="6284569">.</span><span class="ident" id="6284570">openScope</span><span class="op" id="6284579">(</span><span class="op" id="6284580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284586">defer</span>&nbsp;<span class="ident" id="6284592">p</span><span class="op" id="6284593">.</span><span class="ident" id="6284594">closeScope</span><span class="op" id="6284604">(</span><span class="op" id="6284605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284611">s2</span><span class="op" id="6284613">,</span>&nbsp;<span class="ident" id="6284615">_</span>&nbsp;<span class="op" id="6284617">=</span>&nbsp;<span class="ident" id="6284619">p</span><span class="op" id="6284620">.</span><span class="ident" id="6284621">parseSimpleStmt</span><span class="op" id="6284636">(</span><span class="ident" id="6284637">basic</span><span class="op" id="6284642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284647">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284655">p</span><span class="op" id="6284656">.</span><span class="ident" id="6284657">exprLev</span>&nbsp;<span class="op" id="6284665">=</span>&nbsp;<span class="ident" id="6284667">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284680">typeSwitch</span>&nbsp;<span class="op" id="6284691">:=</span>&nbsp;<span class="ident" id="6284694">isTypeSwitchGuard</span><span class="op" id="6284711">(</span><span class="ident" id="6284712">s2</span><span class="op" id="6284714">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284717">lbrace</span>&nbsp;<span class="op" id="6284724">:=</span>&nbsp;<span class="ident" id="6284727">p</span><span class="op" id="6284728">.</span><span class="ident" id="6284729">expect</span><span class="op" id="6284735">(</span><span class="ident" id="6284736">token</span><span class="op" id="6284741">.</span><span class="ident" id="6284742">LBRACE</span><span class="op" id="6284748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284751">var</span>&nbsp;<span class="ident" id="6284755">list</span>&nbsp;<span class="op" id="6284760">[</span><span class="op" id="6284761">]</span><span class="ident" id="6284762">ast</span><span class="op" id="6284765">.</span><span class="ident" id="6284766">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284772">for</span>&nbsp;<span class="ident" id="6284776">p</span><span class="op" id="6284777">.</span><span class="ident" id="6284778">tok</span>&nbsp;<span class="op" id="6284782">==</span>&nbsp;<span class="ident" id="6284785">token</span><span class="op" id="6284790">.</span><span class="ident" id="6284791">CASE</span>&nbsp;<span class="op" id="6284796">||</span>&nbsp;<span class="ident" id="6284799">p</span><span class="op" id="6284800">.</span><span class="ident" id="6284801">tok</span>&nbsp;<span class="op" id="6284805">==</span>&nbsp;<span class="ident" id="6284808">token</span><span class="op" id="6284813">.</span><span class="ident" id="6284814">DEFAULT</span>&nbsp;<span class="op" id="6284822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284826">list</span>&nbsp;<span class="op" id="6284831">=</span>&nbsp;<span class="builtinfunc" id="6284833">append</span><span class="op" id="6284839">(</span><span class="ident" id="6284840">list</span><span class="op" id="6284844">,</span>&nbsp;<span class="ident" id="6284846">p</span><span class="op" id="6284847">.</span><span class="ident" id="6284848">parseCaseClause</span><span class="op" id="6284863">(</span><span class="ident" id="6284864">typeSwitch</span><span class="op" id="6284874">)</span><span class="op" id="6284875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284878">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284881">rbrace</span>&nbsp;<span class="op" id="6284888">:=</span>&nbsp;<span class="ident" id="6284891">p</span><span class="op" id="6284892">.</span><span class="ident" id="6284893">expect</span><span class="op" id="6284899">(</span><span class="ident" id="6284900">token</span><span class="op" id="6284905">.</span><span class="ident" id="6284906">RBRACE</span><span class="op" id="6284912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284915">p</span><span class="op" id="6284916">.</span><span class="ident" id="6284917">expectSemi</span><span class="op" id="6284927">(</span><span class="op" id="6284928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284931">body</span>&nbsp;<span class="op" id="6284936">:=</span>&nbsp;<span class="op" id="6284939">&amp;</span><span class="ident" id="6284940">ast</span><span class="op" id="6284943">.</span><span class="ident" id="6284944">BlockStmt</span><span class="op" id="6284953">{</span><span class="ident" id="6284954">Lbrace</span><span class="op" id="6284960">:</span>&nbsp;<span class="ident" id="6284962">lbrace</span><span class="op" id="6284968">,</span>&nbsp;<span class="ident" id="6284970">List</span><span class="op" id="6284974">:</span>&nbsp;<span class="ident" id="6284976">list</span><span class="op" id="6284980">,</span>&nbsp;<span class="ident" id="6284982">Rbrace</span><span class="op" id="6284988">:</span>&nbsp;<span class="ident" id="6284990">rbrace</span><span class="op" id="6284996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285000">if</span>&nbsp;<span class="ident" id="6285003">typeSwitch</span>&nbsp;<span class="op" id="6285014">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285018">return</span>&nbsp;<span class="op" id="6285025">&amp;</span><span class="ident" id="6285026">ast</span><span class="op" id="6285029">.</span><span class="ident" id="6285030">TypeSwitchStmt</span><span class="op" id="6285044">{</span><span class="ident" id="6285045">Switch</span><span class="op" id="6285051">:</span>&nbsp;<span class="ident" id="6285053">pos</span><span class="op" id="6285056">,</span>&nbsp;<span class="ident" id="6285058">Init</span><span class="op" id="6285062">:</span>&nbsp;<span class="ident" id="6285064">s1</span><span class="op" id="6285066">,</span>&nbsp;<span class="ident" id="6285068">Assign</span><span class="op" id="6285074">:</span>&nbsp;<span class="ident" id="6285076">s2</span><span class="op" id="6285078">,</span>&nbsp;<span class="ident" id="6285080">Body</span><span class="op" id="6285084">:</span>&nbsp;<span class="ident" id="6285086">body</span><span class="op" id="6285090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285097">return</span>&nbsp;<span class="op" id="6285104">&amp;</span><span class="ident" id="6285105">ast</span><span class="op" id="6285108">.</span><span class="ident" id="6285109">SwitchStmt</span><span class="op" id="6285119">{</span><span class="ident" id="6285120">Switch</span><span class="op" id="6285126">:</span>&nbsp;<span class="ident" id="6285128">pos</span><span class="op" id="6285131">,</span>&nbsp;<span class="ident" id="6285133">Init</span><span class="op" id="6285137">:</span>&nbsp;<span class="ident" id="6285139">s1</span><span class="op" id="6285141">,</span>&nbsp;<span class="ident" id="6285143">Tag</span><span class="op" id="6285146">:</span>&nbsp;<span class="ident" id="6285148">p</span><span class="op" id="6285149">.</span><span class="ident" id="6285150">makeExpr</span><span class="op" id="6285158">(</span><span class="ident" id="6285159">s2</span><span class="op" id="6285161">,</span>&nbsp;<span class="string" id="6285163">&#34;switch&nbsp;expression&#34;</span><span class="op" id="6285182">)</span><span class="op" id="6285183">,</span>&nbsp;<span class="ident" id="6285185">Body</span><span class="op" id="6285189">:</span>&nbsp;<span class="ident" id="6285191">body</span><span class="op" id="6285195">}</span><br>
<span class="lineno"></span><span class="op" id="6285197">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="6285200">func</span>&nbsp;<span class="op" id="6285205">(</span><span class="ident" id="6285206">p</span>&nbsp;<span class="op" id="6285208">*</span><span class="ident" id="6285209">parser</span><span class="op" id="6285215">)</span>&nbsp;<span class="ident" id="6285217">parseCommClause</span><span class="op" id="6285232">(</span><span class="op" id="6285233">)</span>&nbsp;<span class="op" id="6285235">*</span><span class="ident" id="6285236">ast</span><span class="op" id="6285239">.</span><span class="ident" id="6285240">CommClause</span>&nbsp;<span class="op" id="6285251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285254">if</span>&nbsp;<span class="ident" id="6285257">p</span><span class="op" id="6285258">.</span><span class="ident" id="6285259">trace</span>&nbsp;<span class="op" id="6285265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285269">defer</span>&nbsp;<span class="ident" id="6285275">un</span><span class="op" id="6285277">(</span><span class="ident" id="6285278">trace</span><span class="op" id="6285283">(</span><span class="ident" id="6285284">p</span><span class="op" id="6285285">,</span>&nbsp;<span class="string" id="6285287">&#34;CommClause&#34;</span><span class="op" id="6285299">)</span><span class="op" id="6285300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285303">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285307">p</span><span class="op" id="6285308">.</span><span class="ident" id="6285309">openScope</span><span class="op" id="6285318">(</span><span class="op" id="6285319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285322">pos</span>&nbsp;<span class="op" id="6285326">:=</span>&nbsp;<span class="ident" id="6285329">p</span><span class="op" id="6285330">.</span><span class="ident" id="6285331">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285336">var</span>&nbsp;<span class="ident" id="6285340">comm</span>&nbsp;<span class="ident" id="6285345">ast</span><span class="op" id="6285348">.</span><span class="ident" id="6285349">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285355">if</span>&nbsp;<span class="ident" id="6285358">p</span><span class="op" id="6285359">.</span><span class="ident" id="6285360">tok</span>&nbsp;<span class="op" id="6285364">==</span>&nbsp;<span class="ident" id="6285367">token</span><span class="op" id="6285372">.</span><span class="ident" id="6285373">CASE</span>&nbsp;<span class="op" id="6285378">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285382">p</span><span class="op" id="6285383">.</span><span class="ident" id="6285384">next</span><span class="op" id="6285388">(</span><span class="op" id="6285389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285393">lhs</span>&nbsp;<span class="op" id="6285397">:=</span>&nbsp;<span class="ident" id="6285400">p</span><span class="op" id="6285401">.</span><span class="ident" id="6285402">parseLhsList</span><span class="op" id="6285414">(</span><span class="op" id="6285415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285419">if</span>&nbsp;<span class="ident" id="6285422">p</span><span class="op" id="6285423">.</span><span class="ident" id="6285424">tok</span>&nbsp;<span class="op" id="6285428">==</span>&nbsp;<span class="ident" id="6285431">token</span><span class="op" id="6285436">.</span><span class="ident" id="6285437">ARROW</span>&nbsp;<span class="op" id="6285443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6285448">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285463">if</span>&nbsp;<span class="builtinfunc" id="6285466">len</span><span class="op" id="6285469">(</span><span class="ident" id="6285470">lhs</span><span class="op" id="6285473">)</span>&nbsp;<span class="op" id="6285475">&gt;</span>&nbsp;<span class="num" id="6285477">1</span>&nbsp;<span class="op" id="6285479">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285485">p</span><span class="op" id="6285486">.</span><span class="ident" id="6285487">errorExpected</span><span class="op" id="6285500">(</span><span class="ident" id="6285501">lhs</span><span class="op" id="6285504">[</span><span class="num" id="6285505">0</span><span class="op" id="6285506">]</span><span class="op" id="6285507">.</span><span class="ident" id="6285508">Pos</span><span class="op" id="6285511">(</span><span class="op" id="6285512">)</span><span class="op" id="6285513">,</span>&nbsp;<span class="string" id="6285515">&#34;1&nbsp;expression&#34;</span><span class="op" id="6285529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6285535">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285577">arrow</span>&nbsp;<span class="op" id="6285583">:=</span>&nbsp;<span class="ident" id="6285586">p</span><span class="op" id="6285587">.</span><span class="ident" id="6285588">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285595">p</span><span class="op" id="6285596">.</span><span class="ident" id="6285597">next</span><span class="op" id="6285601">(</span><span class="op" id="6285602">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285607">rhs</span>&nbsp;<span class="op" id="6285611">:=</span>&nbsp;<span class="ident" id="6285614">p</span><span class="op" id="6285615">.</span><span class="ident" id="6285616">parseRhs</span><span class="op" id="6285624">(</span><span class="op" id="6285625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285630">comm</span>&nbsp;<span class="op" id="6285635">=</span>&nbsp;<span class="op" id="6285637">&amp;</span><span class="ident" id="6285638">ast</span><span class="op" id="6285641">.</span><span class="ident" id="6285642">SendStmt</span><span class="op" id="6285650">{</span><span class="ident" id="6285651">Chan</span><span class="op" id="6285655">:</span>&nbsp;<span class="ident" id="6285657">lhs</span><span class="op" id="6285660">[</span><span class="num" id="6285661">0</span><span class="op" id="6285662">]</span><span class="op" id="6285663">,</span>&nbsp;<span class="ident" id="6285665">Arrow</span><span class="op" id="6285670">:</span>&nbsp;<span class="ident" id="6285672">arrow</span><span class="op" id="6285677">,</span>&nbsp;<span class="ident" id="6285679">Value</span><span class="op" id="6285684">:</span>&nbsp;<span class="ident" id="6285686">rhs</span><span class="op" id="6285689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285693">}</span>&nbsp;<span class="keyword" id="6285695">else</span>&nbsp;<span class="op" id="6285700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6285705">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285720">if</span>&nbsp;<span class="ident" id="6285723">tok</span>&nbsp;<span class="op" id="6285727">:=</span>&nbsp;<span class="ident" id="6285730">p</span><span class="op" id="6285731">.</span><span class="ident" id="6285732">tok</span><span class="op" id="6285735">;</span>&nbsp;<span class="ident" id="6285737">tok</span>&nbsp;<span class="op" id="6285741">==</span>&nbsp;<span class="ident" id="6285744">token</span><span class="op" id="6285749">.</span><span class="ident" id="6285750">ASSIGN</span>&nbsp;<span class="op" id="6285757">||</span>&nbsp;<span class="ident" id="6285760">tok</span>&nbsp;<span class="op" id="6285764">==</span>&nbsp;<span class="ident" id="6285767">token</span><span class="op" id="6285772">.</span><span class="ident" id="6285773">DEFINE</span>&nbsp;<span class="op" id="6285780">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6285786">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285818">if</span>&nbsp;<span class="builtinfunc" id="6285821">len</span><span class="op" id="6285824">(</span><span class="ident" id="6285825">lhs</span><span class="op" id="6285828">)</span>&nbsp;<span class="op" id="6285830">&gt;</span>&nbsp;<span class="num" id="6285832">2</span>&nbsp;<span class="op" id="6285834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285841">p</span><span class="op" id="6285842">.</span><span class="ident" id="6285843">errorExpected</span><span class="op" id="6285856">(</span><span class="ident" id="6285857">lhs</span><span class="op" id="6285860">[</span><span class="num" id="6285861">0</span><span class="op" id="6285862">]</span><span class="op" id="6285863">.</span><span class="ident" id="6285864">Pos</span><span class="op" id="6285867">(</span><span class="op" id="6285868">)</span><span class="op" id="6285869">,</span>&nbsp;<span class="string" id="6285871">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="6285891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6285898">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285942">lhs</span>&nbsp;<span class="op" id="6285946">=</span>&nbsp;<span class="ident" id="6285948">lhs</span><span class="op" id="6285951">[</span><span class="num" id="6285952">0</span><span class="op" id="6285953">:</span><span class="num" id="6285954">2</span><span class="op" id="6285955">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285967">pos</span>&nbsp;<span class="op" id="6285971">:=</span>&nbsp;<span class="ident" id="6285974">p</span><span class="op" id="6285975">.</span><span class="ident" id="6285976">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285984">p</span><span class="op" id="6285985">.</span><span class="ident" id="6285986">next</span><span class="op" id="6285990">(</span><span class="op" id="6285991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285997">rhs</span>&nbsp;<span class="op" id="6286001">:=</span>&nbsp;<span class="ident" id="6286004">p</span><span class="op" id="6286005">.</span><span class="ident" id="6286006">parseRhs</span><span class="op" id="6286014">(</span><span class="op" id="6286015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286021">as</span>&nbsp;<span class="op" id="6286024">:=</span>&nbsp;<span class="op" id="6286027">&amp;</span><span class="ident" id="6286028">ast</span><span class="op" id="6286031">.</span><span class="ident" id="6286032">AssignStmt</span><span class="op" id="6286042">{</span><span class="ident" id="6286043">Lhs</span><span class="op" id="6286046">:</span>&nbsp;<span class="ident" id="6286048">lhs</span><span class="op" id="6286051">,</span>&nbsp;<span class="ident" id="6286053">TokPos</span><span class="op" id="6286059">:</span>&nbsp;<span class="ident" id="6286061">pos</span><span class="op" id="6286064">,</span>&nbsp;<span class="ident" id="6286066">Tok</span><span class="op" id="6286069">:</span>&nbsp;<span class="ident" id="6286071">tok</span><span class="op" id="6286074">,</span>&nbsp;<span class="ident" id="6286076">Rhs</span><span class="op" id="6286079">:</span>&nbsp;<span class="op" id="6286081">[</span><span class="op" id="6286082">]</span><span class="ident" id="6286083">ast</span><span class="op" id="6286086">.</span><span class="ident" id="6286087">Expr</span><span class="op" id="6286091">{</span><span class="ident" id="6286092">rhs</span><span class="op" id="6286095">}</span><span class="op" id="6286096">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286102">if</span>&nbsp;<span class="ident" id="6286105">tok</span>&nbsp;<span class="op" id="6286109">==</span>&nbsp;<span class="ident" id="6286112">token</span><span class="op" id="6286117">.</span><span class="ident" id="6286118">DEFINE</span>&nbsp;<span class="op" id="6286125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286132">p</span><span class="op" id="6286133">.</span><span class="ident" id="6286134">shortVarDecl</span><span class="op" id="6286146">(</span><span class="ident" id="6286147">as</span><span class="op" id="6286149">,</span>&nbsp;<span class="ident" id="6286151">lhs</span><span class="op" id="6286154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286166">comm</span>&nbsp;<span class="op" id="6286171">=</span>&nbsp;<span class="ident" id="6286173">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286179">}</span>&nbsp;<span class="keyword" id="6286181">else</span>&nbsp;<span class="op" id="6286186">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286192">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286236">if</span>&nbsp;<span class="builtinfunc" id="6286239">len</span><span class="op" id="6286242">(</span><span class="ident" id="6286243">lhs</span><span class="op" id="6286246">)</span>&nbsp;<span class="op" id="6286248">&gt;</span>&nbsp;<span class="num" id="6286250">1</span>&nbsp;<span class="op" id="6286252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286259">p</span><span class="op" id="6286260">.</span><span class="ident" id="6286261">errorExpected</span><span class="op" id="6286274">(</span><span class="ident" id="6286275">lhs</span><span class="op" id="6286278">[</span><span class="num" id="6286279">0</span><span class="op" id="6286280">]</span><span class="op" id="6286281">.</span><span class="ident" id="6286282">Pos</span><span class="op" id="6286285">(</span><span class="op" id="6286286">)</span><span class="op" id="6286287">,</span>&nbsp;<span class="string" id="6286289">&#34;1&nbsp;expression&#34;</span><span class="op" id="6286303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286310">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286348">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286354">comm</span>&nbsp;<span class="op" id="6286359">=</span>&nbsp;<span class="op" id="6286361">&amp;</span><span class="ident" id="6286362">ast</span><span class="op" id="6286365">.</span><span class="ident" id="6286366">ExprStmt</span><span class="op" id="6286374">{</span><span class="ident" id="6286375">X</span><span class="op" id="6286376">:</span>&nbsp;<span class="ident" id="6286378">lhs</span><span class="op" id="6286381">[</span><span class="num" id="6286382">0</span><span class="op" id="6286383">]</span><span class="op" id="6286384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286396">}</span>&nbsp;<span class="keyword" id="6286398">else</span>&nbsp;<span class="op" id="6286403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286407">p</span><span class="op" id="6286408">.</span><span class="ident" id="6286409">expect</span><span class="op" id="6286415">(</span><span class="ident" id="6286416">token</span><span class="op" id="6286421">.</span><span class="ident" id="6286422">DEFAULT</span><span class="op" id="6286429">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286436">colon</span>&nbsp;<span class="op" id="6286442">:=</span>&nbsp;<span class="ident" id="6286445">p</span><span class="op" id="6286446">.</span><span class="ident" id="6286447">expect</span><span class="op" id="6286453">(</span><span class="ident" id="6286454">token</span><span class="op" id="6286459">.</span><span class="ident" id="6286460">COLON</span><span class="op" id="6286465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286468">body</span>&nbsp;<span class="op" id="6286473">:=</span>&nbsp;<span class="ident" id="6286476">p</span><span class="op" id="6286477">.</span><span class="ident" id="6286478">parseStmtList</span><span class="op" id="6286491">(</span><span class="op" id="6286492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286495">p</span><span class="op" id="6286496">.</span><span class="ident" id="6286497">closeScope</span><span class="op" id="6286507">(</span><span class="op" id="6286508">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286512">return</span>&nbsp;<span class="op" id="6286519">&amp;</span><span class="ident" id="6286520">ast</span><span class="op" id="6286523">.</span><span class="ident" id="6286524">CommClause</span><span class="op" id="6286534">{</span><span class="ident" id="6286535">Case</span><span class="op" id="6286539">:</span>&nbsp;<span class="ident" id="6286541">pos</span><span class="op" id="6286544">,</span>&nbsp;<span class="ident" id="6286546">Comm</span><span class="op" id="6286550">:</span>&nbsp;<span class="ident" id="6286552">comm</span><span class="op" id="6286556">,</span>&nbsp;<span class="ident" id="6286558">Colon</span><span class="op" id="6286563">:</span>&nbsp;<span class="ident" id="6286565">colon</span><span class="op" id="6286570">,</span>&nbsp;<span class="ident" id="6286572">Body</span><span class="op" id="6286576">:</span>&nbsp;<span class="ident" id="6286578">body</span><span class="op" id="6286582">}</span><br>
<span class="lineno"></span><span class="op" id="6286584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6286587">func</span>&nbsp;<span class="op" id="6286592">(</span><span class="ident" id="6286593">p</span>&nbsp;<span class="op" id="6286595">*</span><span class="ident" id="6286596">parser</span><span class="op" id="6286602">)</span>&nbsp;<span class="ident" id="6286604">parseSelectStmt</span><span class="op" id="6286619">(</span><span class="op" id="6286620">)</span>&nbsp;<span class="op" id="6286622">*</span><span class="ident" id="6286623">ast</span><span class="op" id="6286626">.</span><span class="ident" id="6286627">SelectStmt</span>&nbsp;<span class="op" id="6286638">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286641">if</span>&nbsp;<span class="ident" id="6286644">p</span><span class="op" id="6286645">.</span><span class="ident" id="6286646">trace</span>&nbsp;<span class="op" id="6286652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286656">defer</span>&nbsp;<span class="ident" id="6286662">un</span><span class="op" id="6286664">(</span><span class="ident" id="6286665">trace</span><span class="op" id="6286670">(</span><span class="ident" id="6286671">p</span><span class="op" id="6286672">,</span>&nbsp;<span class="string" id="6286674">&#34;SelectStmt&#34;</span><span class="op" id="6286686">)</span><span class="op" id="6286687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286694">pos</span>&nbsp;<span class="op" id="6286698">:=</span>&nbsp;<span class="ident" id="6286701">p</span><span class="op" id="6286702">.</span><span class="ident" id="6286703">expect</span><span class="op" id="6286709">(</span><span class="ident" id="6286710">token</span><span class="op" id="6286715">.</span><span class="ident" id="6286716">SELECT</span><span class="op" id="6286722">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286725">lbrace</span>&nbsp;<span class="op" id="6286732">:=</span>&nbsp;<span class="ident" id="6286735">p</span><span class="op" id="6286736">.</span><span class="ident" id="6286737">expect</span><span class="op" id="6286743">(</span><span class="ident" id="6286744">token</span><span class="op" id="6286749">.</span><span class="ident" id="6286750">LBRACE</span><span class="op" id="6286756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286759">var</span>&nbsp;<span class="ident" id="6286763">list</span>&nbsp;<span class="op" id="6286768">[</span><span class="op" id="6286769">]</span><span class="ident" id="6286770">ast</span><span class="op" id="6286773">.</span><span class="ident" id="6286774">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286780">for</span>&nbsp;<span class="ident" id="6286784">p</span><span class="op" id="6286785">.</span><span class="ident" id="6286786">tok</span>&nbsp;<span class="op" id="6286790">==</span>&nbsp;<span class="ident" id="6286793">token</span><span class="op" id="6286798">.</span><span class="ident" id="6286799">CASE</span>&nbsp;<span class="op" id="6286804">||</span>&nbsp;<span class="ident" id="6286807">p</span><span class="op" id="6286808">.</span><span class="ident" id="6286809">tok</span>&nbsp;<span class="op" id="6286813">==</span>&nbsp;<span class="ident" id="6286816">token</span><span class="op" id="6286821">.</span><span class="ident" id="6286822">DEFAULT</span>&nbsp;<span class="op" id="6286830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286834">list</span>&nbsp;<span class="op" id="6286839">=</span>&nbsp;<span class="builtinfunc" id="6286841">append</span><span class="op" id="6286847">(</span><span class="ident" id="6286848">list</span><span class="op" id="6286852">,</span>&nbsp;<span class="ident" id="6286854">p</span><span class="op" id="6286855">.</span><span class="ident" id="6286856">parseCommClause</span><span class="op" id="6286871">(</span><span class="op" id="6286872">)</span><span class="op" id="6286873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286876">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286879">rbrace</span>&nbsp;<span class="op" id="6286886">:=</span>&nbsp;<span class="ident" id="6286889">p</span><span class="op" id="6286890">.</span><span class="ident" id="6286891">expect</span><span class="op" id="6286897">(</span><span class="ident" id="6286898">token</span><span class="op" id="6286903">.</span><span class="ident" id="6286904">RBRACE</span><span class="op" id="6286910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286913">p</span><span class="op" id="6286914">.</span><span class="ident" id="6286915">expectSemi</span><span class="op" id="6286925">(</span><span class="op" id="6286926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286929">body</span>&nbsp;<span class="op" id="6286934">:=</span>&nbsp;<span class="op" id="6286937">&amp;</span><span class="ident" id="6286938">ast</span><span class="op" id="6286941">.</span><span class="ident" id="6286942">BlockStmt</span><span class="op" id="6286951">{</span><span class="ident" id="6286952">Lbrace</span><span class="op" id="6286958">:</span>&nbsp;<span class="ident" id="6286960">lbrace</span><span class="op" id="6286966">,</span>&nbsp;<span class="ident" id="6286968">List</span><span class="op" id="6286972">:</span>&nbsp;<span class="ident" id="6286974">list</span><span class="op" id="6286978">,</span>&nbsp;<span class="ident" id="6286980">Rbrace</span><span class="op" id="6286986">:</span>&nbsp;<span class="ident" id="6286988">rbrace</span><span class="op" id="6286994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286998">return</span>&nbsp;<span class="op" id="6287005">&amp;</span><span class="ident" id="6287006">ast</span><span class="op" id="6287009">.</span><span class="ident" id="6287010">SelectStmt</span><span class="op" id="6287020">{</span><span class="ident" id="6287021">Select</span><span class="op" id="6287027">:</span>&nbsp;<span class="ident" id="6287029">pos</span><span class="op" id="6287032">,</span>&nbsp;<span class="ident" id="6287034">Body</span><span class="op" id="6287038">:</span>&nbsp;<span class="ident" id="6287040">body</span><span class="op" id="6287044">}</span><br>
<span class="lineno">2030</span><span class="op" id="6287046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6287049">func</span>&nbsp;<span class="op" id="6287054">(</span><span class="ident" id="6287055">p</span>&nbsp;<span class="op" id="6287057">*</span><span class="ident" id="6287058">parser</span><span class="op" id="6287064">)</span>&nbsp;<span class="ident" id="6287066">parseForStmt</span><span class="op" id="6287078">(</span><span class="op" id="6287079">)</span>&nbsp;<span class="ident" id="6287081">ast</span><span class="op" id="6287084">.</span><span class="ident" id="6287085">Stmt</span>&nbsp;<span class="op" id="6287090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287093">if</span>&nbsp;<span class="ident" id="6287096">p</span><span class="op" id="6287097">.</span><span class="ident" id="6287098">trace</span>&nbsp;<span class="op" id="6287104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287108">defer</span>&nbsp;<span class="ident" id="6287114">un</span><span class="op" id="6287116">(</span><span class="ident" id="6287117">trace</span><span class="op" id="6287122">(</span><span class="ident" id="6287123">p</span><span class="op" id="6287124">,</span>&nbsp;<span class="string" id="6287126">&#34;ForStmt&#34;</span><span class="op" id="6287135">)</span><span class="op" id="6287136">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287143">pos</span>&nbsp;<span class="op" id="6287147">:=</span>&nbsp;<span class="ident" id="6287150">p</span><span class="op" id="6287151">.</span><span class="ident" id="6287152">expect</span><span class="op" id="6287158">(</span><span class="ident" id="6287159">token</span><span class="op" id="6287164">.</span><span class="ident" id="6287165">FOR</span><span class="op" id="6287168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287171">p</span><span class="op" id="6287172">.</span><span class="ident" id="6287173">openScope</span><span class="op" id="6287182">(</span><span class="op" id="6287183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287186">defer</span>&nbsp;<span class="ident" id="6287192">p</span><span class="op" id="6287193">.</span><span class="ident" id="6287194">closeScope</span><span class="op" id="6287204">(</span><span class="op" id="6287205">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287209">var</span>&nbsp;<span class="ident" id="6287213">s1</span><span class="op" id="6287215">,</span>&nbsp;<span class="ident" id="6287217">s2</span><span class="op" id="6287219">,</span>&nbsp;<span class="ident" id="6287221">s3</span>&nbsp;<span class="ident" id="6287224">ast</span><span class="op" id="6287227">.</span><span class="ident" id="6287228">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287234">var</span>&nbsp;<span class="ident" id="6287238">isRange</span>&nbsp;<span class="builtintype" id="6287246">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287252">if</span>&nbsp;<span class="ident" id="6287255">p</span><span class="op" id="6287256">.</span><span class="ident" id="6287257">tok</span>&nbsp;<span class="op" id="6287261">!=</span>&nbsp;<span class="ident" id="6287264">token</span><span class="op" id="6287269">.</span><span class="ident" id="6287270">LBRACE</span>&nbsp;<span class="op" id="6287277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287281">prevLev</span>&nbsp;<span class="op" id="6287289">:=</span>&nbsp;<span class="ident" id="6287292">p</span><span class="op" id="6287293">.</span><span class="ident" id="6287294">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287304">p</span><span class="op" id="6287305">.</span><span class="ident" id="6287306">exprLev</span>&nbsp;<span class="op" id="6287314">=</span>&nbsp;<span class="op" id="6287316">-</span><span class="num" id="6287317">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287321">if</span>&nbsp;<span class="ident" id="6287324">p</span><span class="op" id="6287325">.</span><span class="ident" id="6287326">tok</span>&nbsp;<span class="op" id="6287330">!=</span>&nbsp;<span class="ident" id="6287333">token</span><span class="op" id="6287338">.</span><span class="ident" id="6287339">SEMICOLON</span>&nbsp;<span class="op" id="6287349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287354">if</span>&nbsp;<span class="ident" id="6287357">p</span><span class="op" id="6287358">.</span><span class="ident" id="6287359">tok</span>&nbsp;<span class="op" id="6287363">==</span>&nbsp;<span class="ident" id="6287366">token</span><span class="op" id="6287371">.</span><span class="ident" id="6287372">RANGE</span>&nbsp;<span class="op" id="6287378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287384">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287429">pos</span>&nbsp;<span class="op" id="6287433">:=</span>&nbsp;<span class="ident" id="6287436">p</span><span class="op" id="6287437">.</span><span class="ident" id="6287438">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287446">p</span><span class="op" id="6287447">.</span><span class="ident" id="6287448">next</span><span class="op" id="6287452">(</span><span class="op" id="6287453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287459">y</span>&nbsp;<span class="op" id="6287461">:=</span>&nbsp;<span class="op" id="6287464">[</span><span class="op" id="6287465">]</span><span class="ident" id="6287466">ast</span><span class="op" id="6287469">.</span><span class="ident" id="6287470">Expr</span><span class="op" id="6287474">{</span><span class="op" id="6287475">&amp;</span><span class="ident" id="6287476">ast</span><span class="op" id="6287479">.</span><span class="ident" id="6287480">UnaryExpr</span><span class="op" id="6287489">{</span><span class="ident" id="6287490">OpPos</span><span class="op" id="6287495">:</span>&nbsp;<span class="ident" id="6287497">pos</span><span class="op" id="6287500">,</span>&nbsp;<span class="ident" id="6287502">Op</span><span class="op" id="6287504">:</span>&nbsp;<span class="ident" id="6287506">token</span><span class="op" id="6287511">.</span><span class="ident" id="6287512">RANGE</span><span class="op" id="6287517">,</span>&nbsp;<span class="ident" id="6287519">X</span><span class="op" id="6287520">:</span>&nbsp;<span class="ident" id="6287522">p</span><span class="op" id="6287523">.</span><span class="ident" id="6287524">parseRhs</span><span class="op" id="6287532">(</span><span class="op" id="6287533">)</span><span class="op" id="6287534">}</span><span class="op" id="6287535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287541">s2</span>&nbsp;<span class="op" id="6287544">=</span>&nbsp;<span class="op" id="6287546">&amp;</span><span class="ident" id="6287547">ast</span><span class="op" id="6287550">.</span><span class="ident" id="6287551">AssignStmt</span><span class="op" id="6287561">{</span><span class="ident" id="6287562">Rhs</span><span class="op" id="6287565">:</span>&nbsp;<span class="ident" id="6287567">y</span><span class="op" id="6287568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287574">isRange</span>&nbsp;<span class="op" id="6287582">=</span>&nbsp;<span class="builtintype" id="6287584">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287592">}</span>&nbsp;<span class="keyword" id="6287594">else</span>&nbsp;<span class="op" id="6287599">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287605">s2</span><span class="op" id="6287607">,</span>&nbsp;<span class="ident" id="6287609">isRange</span>&nbsp;<span class="op" id="6287617">=</span>&nbsp;<span class="ident" id="6287619">p</span><span class="op" id="6287620">.</span><span class="ident" id="6287621">parseSimpleStmt</span><span class="op" id="6287636">(</span><span class="ident" id="6287637">rangeOk</span><span class="op" id="6287644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287657">if</span>&nbsp;<span class="op" id="6287660">!</span><span class="ident" id="6287661">isRange</span>&nbsp;<span class="op" id="6287669">&amp;&amp;</span>&nbsp;<span class="ident" id="6287672">p</span><span class="op" id="6287673">.</span><span class="ident" id="6287674">tok</span>&nbsp;<span class="op" id="6287678">==</span>&nbsp;<span class="ident" id="6287681">token</span><span class="op" id="6287686">.</span><span class="ident" id="6287687">SEMICOLON</span>&nbsp;<span class="op" id="6287697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287702">p</span><span class="op" id="6287703">.</span><span class="ident" id="6287704">next</span><span class="op" id="6287708">(</span><span class="op" id="6287709">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287714">s1</span>&nbsp;<span class="op" id="6287717">=</span>&nbsp;<span class="ident" id="6287719">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287725">s2</span>&nbsp;<span class="op" id="6287728">=</span>&nbsp;<span class="ident" id="6287730">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287737">if</span>&nbsp;<span class="ident" id="6287740">p</span><span class="op" id="6287741">.</span><span class="ident" id="6287742">tok</span>&nbsp;<span class="op" id="6287746">!=</span>&nbsp;<span class="ident" id="6287749">token</span><span class="op" id="6287754">.</span><span class="ident" id="6287755">SEMICOLON</span>&nbsp;<span class="op" id="6287765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287771">s2</span><span class="op" id="6287773">,</span>&nbsp;<span class="ident" id="6287775">_</span>&nbsp;<span class="op" id="6287777">=</span>&nbsp;<span class="ident" id="6287779">p</span><span class="op" id="6287780">.</span><span class="ident" id="6287781">parseSimpleStmt</span><span class="op" id="6287796">(</span><span class="ident" id="6287797">basic</span><span class="op" id="6287802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287807">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287812">p</span><span class="op" id="6287813">.</span><span class="ident" id="6287814">expectSemi</span><span class="op" id="6287824">(</span><span class="op" id="6287825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287830">if</span>&nbsp;<span class="ident" id="6287833">p</span><span class="op" id="6287834">.</span><span class="ident" id="6287835">tok</span>&nbsp;<span class="op" id="6287839">!=</span>&nbsp;<span class="ident" id="6287842">token</span><span class="op" id="6287847">.</span><span class="ident" id="6287848">LBRACE</span>&nbsp;<span class="op" id="6287855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287861">s3</span><span class="op" id="6287863">,</span>&nbsp;<span class="ident" id="6287865">_</span>&nbsp;<span class="op" id="6287867">=</span>&nbsp;<span class="ident" id="6287869">p</span><span class="op" id="6287870">.</span><span class="ident" id="6287871">parseSimpleStmt</span><span class="op" id="6287886">(</span><span class="ident" id="6287887">basic</span><span class="op" id="6287892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287901">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287905">p</span><span class="op" id="6287906">.</span><span class="ident" id="6287907">exprLev</span>&nbsp;<span class="op" id="6287915">=</span>&nbsp;<span class="ident" id="6287917">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287930">body</span>&nbsp;<span class="op" id="6287935">:=</span>&nbsp;<span class="ident" id="6287938">p</span><span class="op" id="6287939">.</span><span class="ident" id="6287940">parseBlockStmt</span><span class="op" id="6287954">(</span><span class="op" id="6287955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287958">p</span><span class="op" id="6287959">.</span><span class="ident" id="6287960">expectSemi</span><span class="op" id="6287970">(</span><span class="op" id="6287971">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287975">if</span>&nbsp;<span class="ident" id="6287978">isRange</span>&nbsp;<span class="op" id="6287986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287990">as</span>&nbsp;<span class="op" id="6287993">:=</span>&nbsp;<span class="ident" id="6287996">s2</span><span class="op" id="6287998">.</span><span class="op" id="6287999">(</span><span class="op" id="6288000">*</span><span class="ident" id="6288001">ast</span><span class="op" id="6288004">.</span><span class="ident" id="6288005">AssignStmt</span><span class="op" id="6288015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288019">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288034">var</span>&nbsp;<span class="ident" id="6288038">key</span><span class="op" id="6288041">,</span>&nbsp;<span class="ident" id="6288043">value</span>&nbsp;<span class="ident" id="6288049">ast</span><span class="op" id="6288052">.</span><span class="ident" id="6288053">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288060">switch</span>&nbsp;<span class="builtinfunc" id="6288067">len</span><span class="op" id="6288070">(</span><span class="ident" id="6288071">as</span><span class="op" id="6288073">.</span><span class="ident" id="6288074">Lhs</span><span class="op" id="6288077">)</span>&nbsp;<span class="op" id="6288079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288083">case</span>&nbsp;<span class="num" id="6288088">0</span><span class="op" id="6288089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288094">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288113">case</span>&nbsp;<span class="num" id="6288118">1</span><span class="op" id="6288119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288124">key</span>&nbsp;<span class="op" id="6288128">=</span>&nbsp;<span class="ident" id="6288130">as</span><span class="op" id="6288132">.</span><span class="ident" id="6288133">Lhs</span><span class="op" id="6288136">[</span><span class="num" id="6288137">0</span><span class="op" id="6288138">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288142">case</span>&nbsp;<span class="num" id="6288147">2</span><span class="op" id="6288148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288153">key</span><span class="op" id="6288156">,</span>&nbsp;<span class="ident" id="6288158">value</span>&nbsp;<span class="op" id="6288164">=</span>&nbsp;<span class="ident" id="6288166">as</span><span class="op" id="6288168">.</span><span class="ident" id="6288169">Lhs</span><span class="op" id="6288172">[</span><span class="num" id="6288173">0</span><span class="op" id="6288174">]</span><span class="op" id="6288175">,</span>&nbsp;<span class="ident" id="6288177">as</span><span class="op" id="6288179">.</span><span class="ident" id="6288180">Lhs</span><span class="op" id="6288183">[</span><span class="num" id="6288184">1</span><span class="op" id="6288185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288189">default</span><span class="op" id="6288196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288201">p</span><span class="op" id="6288202">.</span><span class="ident" id="6288203">errorExpected</span><span class="op" id="6288216">(</span><span class="ident" id="6288217">as</span><span class="op" id="6288219">.</span><span class="ident" id="6288220">Lhs</span><span class="op" id="6288223">[</span><span class="builtinfunc" id="6288224">len</span><span class="op" id="6288227">(</span><span class="ident" id="6288228">as</span><span class="op" id="6288230">.</span><span class="ident" id="6288231">Lhs</span><span class="op" id="6288234">)</span><span class="op" id="6288235">-</span><span class="num" id="6288236">1</span><span class="op" id="6288237">]</span><span class="op" id="6288238">.</span><span class="ident" id="6288239">Pos</span><span class="op" id="6288242">(</span><span class="op" id="6288243">)</span><span class="op" id="6288244">,</span>&nbsp;<span class="string" id="6288246">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="6288269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288274">return</span>&nbsp;<span class="op" id="6288281">&amp;</span><span class="ident" id="6288282">ast</span><span class="op" id="6288285">.</span><span class="ident" id="6288286">BadStmt</span><span class="op" id="6288293">{</span><span class="ident" id="6288294">From</span><span class="op" id="6288298">:</span>&nbsp;<span class="ident" id="6288300">pos</span><span class="op" id="6288303">,</span>&nbsp;<span class="ident" id="6288305">To</span><span class="op" id="6288307">:</span>&nbsp;<span class="ident" id="6288309">p</span><span class="op" id="6288310">.</span><span class="ident" id="6288311">safePos</span><span class="op" id="6288318">(</span><span class="ident" id="6288319">body</span><span class="op" id="6288323">.</span><span class="ident" id="6288324">End</span><span class="op" id="6288327">(</span><span class="op" id="6288328">)</span><span class="op" id="6288329">)</span><span class="op" id="6288330">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288338">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288391">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288447">x</span>&nbsp;<span class="op" id="6288449">:=</span>&nbsp;<span class="ident" id="6288452">as</span><span class="op" id="6288454">.</span><span class="ident" id="6288455">Rhs</span><span class="op" id="6288458">[</span><span class="num" id="6288459">0</span><span class="op" id="6288460">]</span><span class="op" id="6288461">.</span><span class="op" id="6288462">(</span><span class="op" id="6288463">*</span><span class="ident" id="6288464">ast</span><span class="op" id="6288467">.</span><span class="ident" id="6288468">UnaryExpr</span><span class="op" id="6288477">)</span><span class="op" id="6288478">.</span><span class="ident" id="6288479">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288483">return</span>&nbsp;<span class="op" id="6288490">&amp;</span><span class="ident" id="6288491">ast</span><span class="op" id="6288494">.</span><span class="ident" id="6288495">RangeStmt</span><span class="op" id="6288504">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288509">For</span><span class="op" id="6288512">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288517">pos</span><span class="op" id="6288520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288525">Key</span><span class="op" id="6288528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288533">key</span><span class="op" id="6288536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288541">Value</span><span class="op" id="6288546">:</span>&nbsp;&nbsp;<span class="ident" id="6288549">value</span><span class="op" id="6288554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288559">TokPos</span><span class="op" id="6288565">:</span>&nbsp;<span class="ident" id="6288567">as</span><span class="op" id="6288569">.</span><span class="ident" id="6288570">TokPos</span><span class="op" id="6288576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288581">Tok</span><span class="op" id="6288584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288589">as</span><span class="op" id="6288591">.</span><span class="ident" id="6288592">Tok</span><span class="op" id="6288595">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288600">X</span><span class="op" id="6288601">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288608">x</span><span class="op" id="6288609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288614">Body</span><span class="op" id="6288618">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6288622">body</span><span class="op" id="6288626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288637">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288663">return</span>&nbsp;<span class="op" id="6288670">&amp;</span><span class="ident" id="6288671">ast</span><span class="op" id="6288674">.</span><span class="ident" id="6288675">ForStmt</span><span class="op" id="6288682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288686">For</span><span class="op" id="6288689">:</span>&nbsp;&nbsp;<span class="ident" id="6288692">pos</span><span class="op" id="6288695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288699">Init</span><span class="op" id="6288703">:</span>&nbsp;<span class="ident" id="6288705">s1</span><span class="op" id="6288707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288711">Cond</span><span class="op" id="6288715">:</span>&nbsp;<span class="ident" id="6288717">p</span><span class="op" id="6288718">.</span><span class="ident" id="6288719">makeExpr</span><span class="op" id="6288727">(</span><span class="ident" id="6288728">s2</span><span class="op" id="6288730">,</span>&nbsp;<span class="string" id="6288732">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="6288761">)</span><span class="op" id="6288762">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288766">Post</span><span class="op" id="6288770">:</span>&nbsp;<span class="ident" id="6288772">s3</span><span class="op" id="6288774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288778">Body</span><span class="op" id="6288782">:</span>&nbsp;<span class="ident" id="6288784">body</span><span class="op" id="6288788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288791">}</span><br>
<span class="lineno"></span><span class="op" id="6288793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="6288796">func</span>&nbsp;<span class="op" id="6288801">(</span><span class="ident" id="6288802">p</span>&nbsp;<span class="op" id="6288804">*</span><span class="ident" id="6288805">parser</span><span class="op" id="6288811">)</span>&nbsp;<span class="ident" id="6288813">parseStmt</span><span class="op" id="6288822">(</span><span class="op" id="6288823">)</span>&nbsp;<span class="op" id="6288825">(</span><span class="ident" id="6288826">s</span>&nbsp;<span class="ident" id="6288828">ast</span><span class="op" id="6288831">.</span><span class="ident" id="6288832">Stmt</span><span class="op" id="6288836">)</span>&nbsp;<span class="op" id="6288838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288841">if</span>&nbsp;<span class="ident" id="6288844">p</span><span class="op" id="6288845">.</span><span class="ident" id="6288846">trace</span>&nbsp;<span class="op" id="6288852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288856">defer</span>&nbsp;<span class="ident" id="6288862">un</span><span class="op" id="6288864">(</span><span class="ident" id="6288865">trace</span><span class="op" id="6288870">(</span><span class="ident" id="6288871">p</span><span class="op" id="6288872">,</span>&nbsp;<span class="string" id="6288874">&#34;Statement&#34;</span><span class="op" id="6288885">)</span><span class="op" id="6288886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288893">switch</span>&nbsp;<span class="ident" id="6288900">p</span><span class="op" id="6288901">.</span><span class="ident" id="6288902">tok</span>&nbsp;<span class="op" id="6288906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288909">case</span>&nbsp;<span class="ident" id="6288914">token</span><span class="op" id="6288919">.</span><span class="ident" id="6288920">CONST</span><span class="op" id="6288925">,</span>&nbsp;<span class="ident" id="6288927">token</span><span class="op" id="6288932">.</span><span class="ident" id="6288933">TYPE</span><span class="op" id="6288937">,</span>&nbsp;<span class="ident" id="6288939">token</span><span class="op" id="6288944">.</span><span class="ident" id="6288945">VAR</span><span class="op" id="6288948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288952">s</span>&nbsp;<span class="op" id="6288954">=</span>&nbsp;<span class="op" id="6288956">&amp;</span><span class="ident" id="6288957">ast</span><span class="op" id="6288960">.</span><span class="ident" id="6288961">DeclStmt</span><span class="op" id="6288969">{</span><span class="ident" id="6288970">Decl</span><span class="op" id="6288974">:</span>&nbsp;<span class="ident" id="6288976">p</span><span class="op" id="6288977">.</span><span class="ident" id="6288978">parseDecl</span><span class="op" id="6288987">(</span><span class="ident" id="6288988">syncStmt</span><span class="op" id="6288996">)</span><span class="op" id="6288997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289000">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289007">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289048">token</span><span class="op" id="6289053">.</span><span class="ident" id="6289054">IDENT</span><span class="op" id="6289059">,</span>&nbsp;<span class="ident" id="6289061">token</span><span class="op" id="6289066">.</span><span class="ident" id="6289067">INT</span><span class="op" id="6289070">,</span>&nbsp;<span class="ident" id="6289072">token</span><span class="op" id="6289077">.</span><span class="ident" id="6289078">FLOAT</span><span class="op" id="6289083">,</span>&nbsp;<span class="ident" id="6289085">token</span><span class="op" id="6289090">.</span><span class="ident" id="6289091">IMAG</span><span class="op" id="6289095">,</span>&nbsp;<span class="ident" id="6289097">token</span><span class="op" id="6289102">.</span><span class="ident" id="6289103">CHAR</span><span class="op" id="6289107">,</span>&nbsp;<span class="ident" id="6289109">token</span><span class="op" id="6289114">.</span><span class="ident" id="6289115">STRING</span><span class="op" id="6289121">,</span>&nbsp;<span class="ident" id="6289123">token</span><span class="op" id="6289128">.</span><span class="ident" id="6289129">FUNC</span><span class="op" id="6289133">,</span>&nbsp;<span class="ident" id="6289135">token</span><span class="op" id="6289140">.</span><span class="ident" id="6289141">LPAREN</span><span class="op" id="6289147">,</span>&nbsp;<span class="comment" id="6289149">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289163">token</span><span class="op" id="6289168">.</span><span class="ident" id="6289169">LBRACK</span><span class="op" id="6289175">,</span>&nbsp;<span class="ident" id="6289177">token</span><span class="op" id="6289182">.</span><span class="ident" id="6289183">STRUCT</span><span class="op" id="6289189">,</span>&nbsp;<span class="comment" id="6289191">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289212">token</span><span class="op" id="6289217">.</span><span class="ident" id="6289218">ADD</span><span class="op" id="6289221">,</span>&nbsp;<span class="ident" id="6289223">token</span><span class="op" id="6289228">.</span><span class="ident" id="6289229">SUB</span><span class="op" id="6289232">,</span>&nbsp;<span class="ident" id="6289234">token</span><span class="op" id="6289239">.</span><span class="ident" id="6289240">MUL</span><span class="op" id="6289243">,</span>&nbsp;<span class="ident" id="6289245">token</span><span class="op" id="6289250">.</span><span class="ident" id="6289251">AND</span><span class="op" id="6289254">,</span>&nbsp;<span class="ident" id="6289256">token</span><span class="op" id="6289261">.</span><span class="ident" id="6289262">XOR</span><span class="op" id="6289265">,</span>&nbsp;<span class="ident" id="6289267">token</span><span class="op" id="6289272">.</span><span class="ident" id="6289273">ARROW</span><span class="op" id="6289278">,</span>&nbsp;<span class="ident" id="6289280">token</span><span class="op" id="6289285">.</span><span class="ident" id="6289286">NOT</span><span class="op" id="6289289">:</span>&nbsp;<span class="comment" id="6289291">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289312">s</span><span class="op" id="6289313">,</span>&nbsp;<span class="ident" id="6289315">_</span>&nbsp;<span class="op" id="6289317">=</span>&nbsp;<span class="ident" id="6289319">p</span><span class="op" id="6289320">.</span><span class="ident" id="6289321">parseSimpleStmt</span><span class="op" id="6289336">(</span><span class="ident" id="6289337">labelOk</span><span class="op" id="6289344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289348">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289412">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289476">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289486">if</span>&nbsp;<span class="ident" id="6289489">_</span><span class="op" id="6289490">,</span>&nbsp;<span class="ident" id="6289492">isLabeledStmt</span>&nbsp;<span class="op" id="6289506">:=</span>&nbsp;<span class="ident" id="6289509">s</span><span class="op" id="6289510">.</span><span class="op" id="6289511">(</span><span class="op" id="6289512">*</span><span class="ident" id="6289513">ast</span><span class="op" id="6289516">.</span><span class="ident" id="6289517">LabeledStmt</span><span class="op" id="6289528">)</span><span class="op" id="6289529">;</span>&nbsp;<span class="op" id="6289531">!</span><span class="ident" id="6289532">isLabeledStmt</span>&nbsp;<span class="op" id="6289546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289551">p</span><span class="op" id="6289552">.</span><span class="ident" id="6289553">expectSemi</span><span class="op" id="6289563">(</span><span class="op" id="6289564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289568">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289571">case</span>&nbsp;<span class="ident" id="6289576">token</span><span class="op" id="6289581">.</span><span class="ident" id="6289582">GO</span><span class="op" id="6289584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289588">s</span>&nbsp;<span class="op" id="6289590">=</span>&nbsp;<span class="ident" id="6289592">p</span><span class="op" id="6289593">.</span><span class="ident" id="6289594">parseGoStmt</span><span class="op" id="6289605">(</span><span class="op" id="6289606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289609">case</span>&nbsp;<span class="ident" id="6289614">token</span><span class="op" id="6289619">.</span><span class="ident" id="6289620">DEFER</span><span class="op" id="6289625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289629">s</span>&nbsp;<span class="op" id="6289631">=</span>&nbsp;<span class="ident" id="6289633">p</span><span class="op" id="6289634">.</span><span class="ident" id="6289635">parseDeferStmt</span><span class="op" id="6289649">(</span><span class="op" id="6289650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289653">case</span>&nbsp;<span class="ident" id="6289658">token</span><span class="op" id="6289663">.</span><span class="ident" id="6289664">RETURN</span><span class="op" id="6289670">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289674">s</span>&nbsp;<span class="op" id="6289676">=</span>&nbsp;<span class="ident" id="6289678">p</span><span class="op" id="6289679">.</span><span class="ident" id="6289680">parseReturnStmt</span><span class="op" id="6289695">(</span><span class="op" id="6289696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289699">case</span>&nbsp;<span class="ident" id="6289704">token</span><span class="op" id="6289709">.</span><span class="ident" id="6289710">BREAK</span><span class="op" id="6289715">,</span>&nbsp;<span class="ident" id="6289717">token</span><span class="op" id="6289722">.</span><span class="ident" id="6289723">CONTINUE</span><span class="op" id="6289731">,</span>&nbsp;<span class="ident" id="6289733">token</span><span class="op" id="6289738">.</span><span class="ident" id="6289739">GOTO</span><span class="op" id="6289743">,</span>&nbsp;<span class="ident" id="6289745">token</span><span class="op" id="6289750">.</span><span class="ident" id="6289751">FALLTHROUGH</span><span class="op" id="6289762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289766">s</span>&nbsp;<span class="op" id="6289768">=</span>&nbsp;<span class="ident" id="6289770">p</span><span class="op" id="6289771">.</span><span class="ident" id="6289772">parseBranchStmt</span><span class="op" id="6289787">(</span><span class="ident" id="6289788">p</span><span class="op" id="6289789">.</span><span class="ident" id="6289790">tok</span><span class="op" id="6289793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289796">case</span>&nbsp;<span class="ident" id="6289801">token</span><span class="op" id="6289806">.</span><span class="ident" id="6289807">LBRACE</span><span class="op" id="6289813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289817">s</span>&nbsp;<span class="op" id="6289819">=</span>&nbsp;<span class="ident" id="6289821">p</span><span class="op" id="6289822">.</span><span class="ident" id="6289823">parseBlockStmt</span><span class="op" id="6289837">(</span><span class="op" id="6289838">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289842">p</span><span class="op" id="6289843">.</span><span class="ident" id="6289844">expectSemi</span><span class="op" id="6289854">(</span><span class="op" id="6289855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289858">case</span>&nbsp;<span class="ident" id="6289863">token</span><span class="op" id="6289868">.</span><span class="ident" id="6289869">IF</span><span class="op" id="6289871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289875">s</span>&nbsp;<span class="op" id="6289877">=</span>&nbsp;<span class="ident" id="6289879">p</span><span class="op" id="6289880">.</span><span class="ident" id="6289881">parseIfStmt</span><span class="op" id="6289892">(</span><span class="op" id="6289893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289896">case</span>&nbsp;<span class="ident" id="6289901">token</span><span class="op" id="6289906">.</span><span class="ident" id="6289907">SWITCH</span><span class="op" id="6289913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289917">s</span>&nbsp;<span class="op" id="6289919">=</span>&nbsp;<span class="ident" id="6289921">p</span><span class="op" id="6289922">.</span><span class="ident" id="6289923">parseSwitchStmt</span><span class="op" id="6289938">(</span><span class="op" id="6289939">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289942">case</span>&nbsp;<span class="ident" id="6289947">token</span><span class="op" id="6289952">.</span><span class="ident" id="6289953">SELECT</span><span class="op" id="6289959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289963">s</span>&nbsp;<span class="op" id="6289965">=</span>&nbsp;<span class="ident" id="6289967">p</span><span class="op" id="6289968">.</span><span class="ident" id="6289969">parseSelectStmt</span><span class="op" id="6289984">(</span><span class="op" id="6289985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289988">case</span>&nbsp;<span class="ident" id="6289993">token</span><span class="op" id="6289998">.</span><span class="ident" id="6289999">FOR</span><span class="op" id="6290002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290006">s</span>&nbsp;<span class="op" id="6290008">=</span>&nbsp;<span class="ident" id="6290010">p</span><span class="op" id="6290011">.</span><span class="ident" id="6290012">parseForStmt</span><span class="op" id="6290024">(</span><span class="op" id="6290025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290028">case</span>&nbsp;<span class="ident" id="6290033">token</span><span class="op" id="6290038">.</span><span class="ident" id="6290039">SEMICOLON</span><span class="op" id="6290048">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290052">s</span>&nbsp;<span class="op" id="6290054">=</span>&nbsp;<span class="op" id="6290056">&amp;</span><span class="ident" id="6290057">ast</span><span class="op" id="6290060">.</span><span class="ident" id="6290061">EmptyStmt</span><span class="op" id="6290070">{</span><span class="ident" id="6290071">Semicolon</span><span class="op" id="6290080">:</span>&nbsp;<span class="ident" id="6290082">p</span><span class="op" id="6290083">.</span><span class="ident" id="6290084">pos</span><span class="op" id="6290087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290091">p</span><span class="op" id="6290092">.</span><span class="ident" id="6290093">next</span><span class="op" id="6290097">(</span><span class="op" id="6290098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290101">case</span>&nbsp;<span class="ident" id="6290106">token</span><span class="op" id="6290111">.</span><span class="ident" id="6290112">RBRACE</span><span class="op" id="6290118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290122">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290175">s</span>&nbsp;<span class="op" id="6290177">=</span>&nbsp;<span class="op" id="6290179">&amp;</span><span class="ident" id="6290180">ast</span><span class="op" id="6290183">.</span><span class="ident" id="6290184">EmptyStmt</span><span class="op" id="6290193">{</span><span class="ident" id="6290194">Semicolon</span><span class="op" id="6290203">:</span>&nbsp;<span class="ident" id="6290205">p</span><span class="op" id="6290206">.</span><span class="ident" id="6290207">pos</span><span class="op" id="6290210">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290213">default</span><span class="op" id="6290220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290224">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290248">pos</span>&nbsp;<span class="op" id="6290252">:=</span>&nbsp;<span class="ident" id="6290255">p</span><span class="op" id="6290256">.</span><span class="ident" id="6290257">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290263">p</span><span class="op" id="6290264">.</span><span class="ident" id="6290265">errorExpected</span><span class="op" id="6290278">(</span><span class="ident" id="6290279">pos</span><span class="op" id="6290282">,</span>&nbsp;<span class="string" id="6290284">&#34;statement&#34;</span><span class="op" id="6290295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290299">syncStmt</span><span class="op" id="6290307">(</span><span class="ident" id="6290308">p</span><span class="op" id="6290309">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290313">s</span>&nbsp;<span class="op" id="6290315">=</span>&nbsp;<span class="op" id="6290317">&amp;</span><span class="ident" id="6290318">ast</span><span class="op" id="6290321">.</span><span class="ident" id="6290322">BadStmt</span><span class="op" id="6290329">{</span><span class="ident" id="6290330">From</span><span class="op" id="6290334">:</span>&nbsp;<span class="ident" id="6290336">pos</span><span class="op" id="6290339">,</span>&nbsp;<span class="ident" id="6290341">To</span><span class="op" id="6290343">:</span>&nbsp;<span class="ident" id="6290345">p</span><span class="op" id="6290346">.</span><span class="ident" id="6290347">pos</span><span class="op" id="6290350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290357">return</span><br>
<span class="lineno"></span><span class="op" id="6290364">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="6290367">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6290447">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6290464">type</span>&nbsp;<span class="ident" id="6290469">parseSpecFunction</span>&nbsp;<span class="keyword" id="6290487">func</span><span class="op" id="6290491">(</span><span class="ident" id="6290492">doc</span>&nbsp;<span class="op" id="6290496">*</span><span class="ident" id="6290497">ast</span><span class="op" id="6290500">.</span><span class="ident" id="6290501">CommentGroup</span><span class="op" id="6290513">,</span>&nbsp;<span class="ident" id="6290515">keyword</span>&nbsp;<span class="ident" id="6290523">token</span><span class="op" id="6290528">.</span><span class="ident" id="6290529">Token</span><span class="op" id="6290534">,</span>&nbsp;<span class="ident" id="6290536">iota</span>&nbsp;<span class="builtintype" id="6290541">int</span><span class="op" id="6290544">)</span>&nbsp;<span class="ident" id="6290546">ast</span><span class="op" id="6290549">.</span><span class="ident" id="6290550">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="6290556">func</span>&nbsp;<span class="ident" id="6290561">isValidImport</span><span class="op" id="6290574">(</span><span class="ident" id="6290575">lit</span>&nbsp;<span class="builtintype" id="6290579">string</span><span class="op" id="6290585">)</span>&nbsp;<span class="builtintype" id="6290587">bool</span>&nbsp;<span class="op" id="6290592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290595">const</span>&nbsp;<span class="ident" id="6290601">illegalChars</span>&nbsp;<span class="op" id="6290614">=</span>&nbsp;<span class="string" id="6290616">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="6290643">+</span>&nbsp;<span class="string" id="6290645">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290656">s</span><span class="op" id="6290657">,</span>&nbsp;<span class="ident" id="6290659">_</span>&nbsp;<span class="op" id="6290661">:=</span>&nbsp;<span class="ident" id="6290664">strconv</span><span class="op" id="6290671">.</span><span class="ident" id="6290672">Unquote</span><span class="op" id="6290679">(</span><span class="ident" id="6290680">lit</span><span class="op" id="6290683">)</span>&nbsp;<span class="comment" id="6290685">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290731">for</span>&nbsp;<span class="ident" id="6290735">_</span><span class="op" id="6290736">,</span>&nbsp;<span class="ident" id="6290738">r</span>&nbsp;<span class="op" id="6290740">:=</span>&nbsp;<span class="keyword" id="6290743">range</span>&nbsp;<span class="ident" id="6290749">s</span>&nbsp;<span class="op" id="6290751">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290755">if</span>&nbsp;<span class="op" id="6290758">!</span><span class="ident" id="6290759">unicode</span><span class="op" id="6290766">.</span><span class="ident" id="6290767">IsGraphic</span><span class="op" id="6290776">(</span><span class="ident" id="6290777">r</span><span class="op" id="6290778">)</span>&nbsp;<span class="op" id="6290780">||</span>&nbsp;<span class="ident" id="6290783">unicode</span><span class="op" id="6290790">.</span><span class="ident" id="6290791">IsSpace</span><span class="op" id="6290798">(</span><span class="ident" id="6290799">r</span><span class="op" id="6290800">)</span>&nbsp;<span class="op" id="6290802">||</span>&nbsp;<span class="ident" id="6290805">strings</span><span class="op" id="6290812">.</span><span class="ident" id="6290813">ContainsRune</span><span class="op" id="6290825">(</span><span class="ident" id="6290826">illegalChars</span><span class="op" id="6290838">,</span>&nbsp;<span class="ident" id="6290840">r</span><span class="op" id="6290841">)</span>&nbsp;<span class="op" id="6290843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290848">return</span>&nbsp;<span class="builtintype" id="6290855">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290869">return</span>&nbsp;<span class="ident" id="6290876">s</span>&nbsp;<span class="op" id="6290878">!=</span>&nbsp;<span class="string" id="6290881">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="6290884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6290887">func</span>&nbsp;<span class="op" id="6290892">(</span><span class="ident" id="6290893">p</span>&nbsp;<span class="op" id="6290895">*</span><span class="ident" id="6290896">parser</span><span class="op" id="6290902">)</span>&nbsp;<span class="ident" id="6290904">parseImportSpec</span><span class="op" id="6290919">(</span><span class="ident" id="6290920">doc</span>&nbsp;<span class="op" id="6290924">*</span><span class="ident" id="6290925">ast</span><span class="op" id="6290928">.</span><span class="ident" id="6290929">CommentGroup</span><span class="op" id="6290941">,</span>&nbsp;<span class="ident" id="6290943">_</span>&nbsp;<span class="ident" id="6290945">token</span><span class="op" id="6290950">.</span><span class="ident" id="6290951">Token</span><span class="op" id="6290956">,</span>&nbsp;<span class="ident" id="6290958">_</span>&nbsp;<span class="builtintype" id="6290960">int</span><span class="op" id="6290963">)</span>&nbsp;<span class="ident" id="6290965">ast</span><span class="op" id="6290968">.</span><span class="ident" id="6290969">Spec</span>&nbsp;<span class="op" id="6290974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290977">if</span>&nbsp;<span class="ident" id="6290980">p</span><span class="op" id="6290981">.</span><span class="ident" id="6290982">trace</span>&nbsp;<span class="op" id="6290988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290992">defer</span>&nbsp;<span class="ident" id="6290998">un</span><span class="op" id="6291000">(</span><span class="ident" id="6291001">trace</span><span class="op" id="6291006">(</span><span class="ident" id="6291007">p</span><span class="op" id="6291008">,</span>&nbsp;<span class="string" id="6291010">&#34;ImportSpec&#34;</span><span class="op" id="6291022">)</span><span class="op" id="6291023">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291030">var</span>&nbsp;<span class="ident" id="6291034">ident</span>&nbsp;<span class="op" id="6291040">*</span><span class="ident" id="6291041">ast</span><span class="op" id="6291044">.</span><span class="ident" id="6291045">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291052">switch</span>&nbsp;<span class="ident" id="6291059">p</span><span class="op" id="6291060">.</span><span class="ident" id="6291061">tok</span>&nbsp;<span class="op" id="6291065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291068">case</span>&nbsp;<span class="ident" id="6291073">token</span><span class="op" id="6291078">.</span><span class="ident" id="6291079">PERIOD</span><span class="op" id="6291085">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291089">ident</span>&nbsp;<span class="op" id="6291095">=</span>&nbsp;<span class="op" id="6291097">&amp;</span><span class="ident" id="6291098">ast</span><span class="op" id="6291101">.</span><span class="ident" id="6291102">Ident</span><span class="op" id="6291107">{</span><span class="ident" id="6291108">NamePos</span><span class="op" id="6291115">:</span>&nbsp;<span class="ident" id="6291117">p</span><span class="op" id="6291118">.</span><span class="ident" id="6291119">pos</span><span class="op" id="6291122">,</span>&nbsp;<span class="ident" id="6291124">Name</span><span class="op" id="6291128">:</span>&nbsp;<span class="string" id="6291130">&#34;.&#34;</span><span class="op" id="6291133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291137">p</span><span class="op" id="6291138">.</span><span class="ident" id="6291139">next</span><span class="op" id="6291143">(</span><span class="op" id="6291144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291147">case</span>&nbsp;<span class="ident" id="6291152">token</span><span class="op" id="6291157">.</span><span class="ident" id="6291158">IDENT</span><span class="op" id="6291163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291167">ident</span>&nbsp;<span class="op" id="6291173">=</span>&nbsp;<span class="ident" id="6291175">p</span><span class="op" id="6291176">.</span><span class="ident" id="6291177">parseIdent</span><span class="op" id="6291187">(</span><span class="op" id="6291188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291191">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291195">pos</span>&nbsp;<span class="op" id="6291199">:=</span>&nbsp;<span class="ident" id="6291202">p</span><span class="op" id="6291203">.</span><span class="ident" id="6291204">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291209">var</span>&nbsp;<span class="ident" id="6291213">path</span>&nbsp;<span class="builtintype" id="6291218">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291226">if</span>&nbsp;<span class="ident" id="6291229">p</span><span class="op" id="6291230">.</span><span class="ident" id="6291231">tok</span>&nbsp;<span class="op" id="6291235">==</span>&nbsp;<span class="ident" id="6291238">token</span><span class="op" id="6291243">.</span><span class="ident" id="6291244">STRING</span>&nbsp;<span class="op" id="6291251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291255">path</span>&nbsp;<span class="op" id="6291260">=</span>&nbsp;<span class="ident" id="6291262">p</span><span class="op" id="6291263">.</span><span class="ident" id="6291264">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291270">if</span>&nbsp;<span class="op" id="6291273">!</span><span class="ident" id="6291274">isValidImport</span><span class="op" id="6291287">(</span><span class="ident" id="6291288">path</span><span class="op" id="6291292">)</span>&nbsp;<span class="op" id="6291294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291299">p</span><span class="op" id="6291300">.</span><span class="builtintype" id="6291301">error</span><span class="op" id="6291306">(</span><span class="ident" id="6291307">pos</span><span class="op" id="6291310">,</span>&nbsp;<span class="string" id="6291312">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="6291335">+</span><span class="ident" id="6291336">path</span><span class="op" id="6291340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291348">p</span><span class="op" id="6291349">.</span><span class="ident" id="6291350">next</span><span class="op" id="6291354">(</span><span class="op" id="6291355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291358">}</span>&nbsp;<span class="keyword" id="6291360">else</span>&nbsp;<span class="op" id="6291365">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291369">p</span><span class="op" id="6291370">.</span><span class="ident" id="6291371">expect</span><span class="op" id="6291377">(</span><span class="ident" id="6291378">token</span><span class="op" id="6291383">.</span><span class="ident" id="6291384">STRING</span><span class="op" id="6291390">)</span>&nbsp;<span class="comment" id="6291392">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291427">p</span><span class="op" id="6291428">.</span><span class="ident" id="6291429">expectSemi</span><span class="op" id="6291439">(</span><span class="op" id="6291440">)</span>&nbsp;<span class="comment" id="6291442">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291483">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291503">spec</span>&nbsp;<span class="op" id="6291508">:=</span>&nbsp;<span class="op" id="6291511">&amp;</span><span class="ident" id="6291512">ast</span><span class="op" id="6291515">.</span><span class="ident" id="6291516">ImportSpec</span><span class="op" id="6291526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291530">Doc</span><span class="op" id="6291533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6291539">doc</span><span class="op" id="6291542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291546">Name</span><span class="op" id="6291550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6291555">ident</span><span class="op" id="6291560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291564">Path</span><span class="op" id="6291568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6291573">&amp;</span><span class="ident" id="6291574">ast</span><span class="op" id="6291577">.</span><span class="ident" id="6291578">BasicLit</span><span class="op" id="6291586">{</span><span class="ident" id="6291587">ValuePos</span><span class="op" id="6291595">:</span>&nbsp;<span class="ident" id="6291597">pos</span><span class="op" id="6291600">,</span>&nbsp;<span class="ident" id="6291602">Kind</span><span class="op" id="6291606">:</span>&nbsp;<span class="ident" id="6291608">token</span><span class="op" id="6291613">.</span><span class="ident" id="6291614">STRING</span><span class="op" id="6291620">,</span>&nbsp;<span class="ident" id="6291622">Value</span><span class="op" id="6291627">:</span>&nbsp;<span class="ident" id="6291629">path</span><span class="op" id="6291633">}</span><span class="op" id="6291634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291638">Comment</span><span class="op" id="6291645">:</span>&nbsp;<span class="ident" id="6291647">p</span><span class="op" id="6291648">.</span><span class="ident" id="6291649">lineComment</span><span class="op" id="6291660">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291666">p</span><span class="op" id="6291667">.</span><span class="ident" id="6291668">imports</span>&nbsp;<span class="op" id="6291676">=</span>&nbsp;<span class="builtinfunc" id="6291678">append</span><span class="op" id="6291684">(</span><span class="ident" id="6291685">p</span><span class="op" id="6291686">.</span><span class="ident" id="6291687">imports</span><span class="op" id="6291694">,</span>&nbsp;<span class="ident" id="6291696">spec</span><span class="op" id="6291700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291704">return</span>&nbsp;<span class="ident" id="6291711">spec</span><br>
<span class="lineno"></span><span class="op" id="6291716">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="6291719">func</span>&nbsp;<span class="op" id="6291724">(</span><span class="ident" id="6291725">p</span>&nbsp;<span class="op" id="6291727">*</span><span class="ident" id="6291728">parser</span><span class="op" id="6291734">)</span>&nbsp;<span class="ident" id="6291736">parseValueSpec</span><span class="op" id="6291750">(</span><span class="ident" id="6291751">doc</span>&nbsp;<span class="op" id="6291755">*</span><span class="ident" id="6291756">ast</span><span class="op" id="6291759">.</span><span class="ident" id="6291760">CommentGroup</span><span class="op" id="6291772">,</span>&nbsp;<span class="ident" id="6291774">keyword</span>&nbsp;<span class="ident" id="6291782">token</span><span class="op" id="6291787">.</span><span class="ident" id="6291788">Token</span><span class="op" id="6291793">,</span>&nbsp;<span class="ident" id="6291795">iota</span>&nbsp;<span class="builtintype" id="6291800">int</span><span class="op" id="6291803">)</span>&nbsp;<span class="ident" id="6291805">ast</span><span class="op" id="6291808">.</span><span class="ident" id="6291809">Spec</span>&nbsp;<span class="op" id="6291814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291817">if</span>&nbsp;<span class="ident" id="6291820">p</span><span class="op" id="6291821">.</span><span class="ident" id="6291822">trace</span>&nbsp;<span class="op" id="6291828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291832">defer</span>&nbsp;<span class="ident" id="6291838">un</span><span class="op" id="6291840">(</span><span class="ident" id="6291841">trace</span><span class="op" id="6291846">(</span><span class="ident" id="6291847">p</span><span class="op" id="6291848">,</span>&nbsp;<span class="ident" id="6291850">keyword</span><span class="op" id="6291857">.</span><span class="ident" id="6291858">String</span><span class="op" id="6291864">(</span><span class="op" id="6291865">)</span><span class="op" id="6291866">+</span><span class="string" id="6291867">&#34;Spec&#34;</span><span class="op" id="6291873">)</span><span class="op" id="6291874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291877">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291881">idents</span>&nbsp;<span class="op" id="6291888">:=</span>&nbsp;<span class="ident" id="6291891">p</span><span class="op" id="6291892">.</span><span class="ident" id="6291893">parseIdentList</span><span class="op" id="6291907">(</span><span class="op" id="6291908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291911">typ</span>&nbsp;<span class="op" id="6291915">:=</span>&nbsp;<span class="ident" id="6291918">p</span><span class="op" id="6291919">.</span><span class="ident" id="6291920">tryType</span><span class="op" id="6291927">(</span><span class="op" id="6291928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291931">var</span>&nbsp;<span class="ident" id="6291935">values</span>&nbsp;<span class="op" id="6291942">[</span><span class="op" id="6291943">]</span><span class="ident" id="6291944">ast</span><span class="op" id="6291947">.</span><span class="ident" id="6291948">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291954">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292022">if</span>&nbsp;<span class="ident" id="6292025">p</span><span class="op" id="6292026">.</span><span class="ident" id="6292027">tok</span>&nbsp;<span class="op" id="6292031">==</span>&nbsp;<span class="ident" id="6292034">token</span><span class="op" id="6292039">.</span><span class="ident" id="6292040">ASSIGN</span>&nbsp;<span class="op" id="6292047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292051">p</span><span class="op" id="6292052">.</span><span class="ident" id="6292053">next</span><span class="op" id="6292057">(</span><span class="op" id="6292058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292062">values</span>&nbsp;<span class="op" id="6292069">=</span>&nbsp;<span class="ident" id="6292071">p</span><span class="op" id="6292072">.</span><span class="ident" id="6292073">parseRhsList</span><span class="op" id="6292085">(</span><span class="op" id="6292086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292092">p</span><span class="op" id="6292093">.</span><span class="ident" id="6292094">expectSemi</span><span class="op" id="6292104">(</span><span class="op" id="6292105">)</span>&nbsp;<span class="comment" id="6292107">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292148">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292224">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292297">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292344">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292417">spec</span>&nbsp;<span class="op" id="6292422">:=</span>&nbsp;<span class="op" id="6292425">&amp;</span><span class="ident" id="6292426">ast</span><span class="op" id="6292429">.</span><span class="ident" id="6292430">ValueSpec</span><span class="op" id="6292439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292443">Doc</span><span class="op" id="6292446">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292452">doc</span><span class="op" id="6292455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292459">Names</span><span class="op" id="6292464">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6292468">idents</span><span class="op" id="6292474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292478">Type</span><span class="op" id="6292482">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292487">typ</span><span class="op" id="6292490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292494">Values</span><span class="op" id="6292500">:</span>&nbsp;&nbsp;<span class="ident" id="6292503">values</span><span class="op" id="6292509">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292513">Comment</span><span class="op" id="6292520">:</span>&nbsp;<span class="ident" id="6292522">p</span><span class="op" id="6292523">.</span><span class="ident" id="6292524">lineComment</span><span class="op" id="6292535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292541">kind</span>&nbsp;<span class="op" id="6292546">:=</span>&nbsp;<span class="ident" id="6292549">ast</span><span class="op" id="6292552">.</span><span class="ident" id="6292553">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292558">if</span>&nbsp;<span class="ident" id="6292561">keyword</span>&nbsp;<span class="op" id="6292569">==</span>&nbsp;<span class="ident" id="6292572">token</span><span class="op" id="6292577">.</span><span class="ident" id="6292578">VAR</span>&nbsp;<span class="op" id="6292582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292586">kind</span>&nbsp;<span class="op" id="6292591">=</span>&nbsp;<span class="ident" id="6292593">ast</span><span class="op" id="6292596">.</span><span class="ident" id="6292597">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292605">p</span><span class="op" id="6292606">.</span><span class="ident" id="6292607">declare</span><span class="op" id="6292614">(</span><span class="ident" id="6292615">spec</span><span class="op" id="6292619">,</span>&nbsp;<span class="ident" id="6292621">iota</span><span class="op" id="6292625">,</span>&nbsp;<span class="ident" id="6292627">p</span><span class="op" id="6292628">.</span><span class="ident" id="6292629">topScope</span><span class="op" id="6292637">,</span>&nbsp;<span class="ident" id="6292639">kind</span><span class="op" id="6292643">,</span>&nbsp;<span class="ident" id="6292645">idents</span><span class="op" id="6292651">...</span><span class="op" id="6292654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292658">return</span>&nbsp;<span class="ident" id="6292665">spec</span><br>
<span class="lineno"></span><span class="op" id="6292670">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="6292673">func</span>&nbsp;<span class="op" id="6292678">(</span><span class="ident" id="6292679">p</span>&nbsp;<span class="op" id="6292681">*</span><span class="ident" id="6292682">parser</span><span class="op" id="6292688">)</span>&nbsp;<span class="ident" id="6292690">parseTypeSpec</span><span class="op" id="6292703">(</span><span class="ident" id="6292704">doc</span>&nbsp;<span class="op" id="6292708">*</span><span class="ident" id="6292709">ast</span><span class="op" id="6292712">.</span><span class="ident" id="6292713">CommentGroup</span><span class="op" id="6292725">,</span>&nbsp;<span class="ident" id="6292727">_</span>&nbsp;<span class="ident" id="6292729">token</span><span class="op" id="6292734">.</span><span class="ident" id="6292735">Token</span><span class="op" id="6292740">,</span>&nbsp;<span class="ident" id="6292742">_</span>&nbsp;<span class="builtintype" id="6292744">int</span><span class="op" id="6292747">)</span>&nbsp;<span class="ident" id="6292749">ast</span><span class="op" id="6292752">.</span><span class="ident" id="6292753">Spec</span>&nbsp;<span class="op" id="6292758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292761">if</span>&nbsp;<span class="ident" id="6292764">p</span><span class="op" id="6292765">.</span><span class="ident" id="6292766">trace</span>&nbsp;<span class="op" id="6292772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292776">defer</span>&nbsp;<span class="ident" id="6292782">un</span><span class="op" id="6292784">(</span><span class="ident" id="6292785">trace</span><span class="op" id="6292790">(</span><span class="ident" id="6292791">p</span><span class="op" id="6292792">,</span>&nbsp;<span class="string" id="6292794">&#34;TypeSpec&#34;</span><span class="op" id="6292804">)</span><span class="op" id="6292805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292808">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292812">ident</span>&nbsp;<span class="op" id="6292818">:=</span>&nbsp;<span class="ident" id="6292821">p</span><span class="op" id="6292822">.</span><span class="ident" id="6292823">parseIdent</span><span class="op" id="6292833">(</span><span class="op" id="6292834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292838">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292916">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292991">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293013">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293086">spec</span>&nbsp;<span class="op" id="6293091">:=</span>&nbsp;<span class="op" id="6293094">&amp;</span><span class="ident" id="6293095">ast</span><span class="op" id="6293098">.</span><span class="ident" id="6293099">TypeSpec</span><span class="op" id="6293107">{</span><span class="ident" id="6293108">Doc</span><span class="op" id="6293111">:</span>&nbsp;<span class="ident" id="6293113">doc</span><span class="op" id="6293116">,</span>&nbsp;<span class="ident" id="6293118">Name</span><span class="op" id="6293122">:</span>&nbsp;<span class="ident" id="6293124">ident</span><span class="op" id="6293129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293132">p</span><span class="op" id="6293133">.</span><span class="ident" id="6293134">declare</span><span class="op" id="6293141">(</span><span class="ident" id="6293142">spec</span><span class="op" id="6293146">,</span>&nbsp;<span class="ident" id="6293148">nil</span><span class="op" id="6293151">,</span>&nbsp;<span class="ident" id="6293153">p</span><span class="op" id="6293154">.</span><span class="ident" id="6293155">topScope</span><span class="op" id="6293163">,</span>&nbsp;<span class="ident" id="6293165">ast</span><span class="op" id="6293168">.</span><span class="ident" id="6293169">Typ</span><span class="op" id="6293172">,</span>&nbsp;<span class="ident" id="6293174">ident</span><span class="op" id="6293179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293183">spec</span><span class="op" id="6293187">.</span><span class="ident" id="6293188">Type</span>&nbsp;<span class="op" id="6293193">=</span>&nbsp;<span class="ident" id="6293195">p</span><span class="op" id="6293196">.</span><span class="ident" id="6293197">parseType</span><span class="op" id="6293206">(</span><span class="op" id="6293207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293210">p</span><span class="op" id="6293211">.</span><span class="ident" id="6293212">expectSemi</span><span class="op" id="6293222">(</span><span class="op" id="6293223">)</span>&nbsp;<span class="comment" id="6293225">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293265">spec</span><span class="op" id="6293269">.</span><span class="ident" id="6293270">Comment</span>&nbsp;<span class="op" id="6293278">=</span>&nbsp;<span class="ident" id="6293280">p</span><span class="op" id="6293281">.</span><span class="ident" id="6293282">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293296">return</span>&nbsp;<span class="ident" id="6293303">spec</span><br>
<span class="lineno">2280</span><span class="op" id="6293308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6293311">func</span>&nbsp;<span class="op" id="6293316">(</span><span class="ident" id="6293317">p</span>&nbsp;<span class="op" id="6293319">*</span><span class="ident" id="6293320">parser</span><span class="op" id="6293326">)</span>&nbsp;<span class="ident" id="6293328">parseGenDecl</span><span class="op" id="6293340">(</span><span class="ident" id="6293341">keyword</span>&nbsp;<span class="ident" id="6293349">token</span><span class="op" id="6293354">.</span><span class="ident" id="6293355">Token</span><span class="op" id="6293360">,</span>&nbsp;<span class="ident" id="6293362">f</span>&nbsp;<span class="ident" id="6293364">parseSpecFunction</span><span class="op" id="6293381">)</span>&nbsp;<span class="op" id="6293383">*</span><span class="ident" id="6293384">ast</span><span class="op" id="6293387">.</span><span class="ident" id="6293388">GenDecl</span>&nbsp;<span class="op" id="6293396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293399">if</span>&nbsp;<span class="ident" id="6293402">p</span><span class="op" id="6293403">.</span><span class="ident" id="6293404">trace</span>&nbsp;<span class="op" id="6293410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293414">defer</span>&nbsp;<span class="ident" id="6293420">un</span><span class="op" id="6293422">(</span><span class="ident" id="6293423">trace</span><span class="op" id="6293428">(</span><span class="ident" id="6293429">p</span><span class="op" id="6293430">,</span>&nbsp;<span class="string" id="6293432">&#34;GenDecl(&#34;</span><span class="op" id="6293442">+</span><span class="ident" id="6293443">keyword</span><span class="op" id="6293450">.</span><span class="ident" id="6293451">String</span><span class="op" id="6293457">(</span><span class="op" id="6293458">)</span><span class="op" id="6293459">+</span><span class="string" id="6293460">&#34;)&#34;</span><span class="op" id="6293463">)</span><span class="op" id="6293464">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293471">doc</span>&nbsp;<span class="op" id="6293475">:=</span>&nbsp;<span class="ident" id="6293478">p</span><span class="op" id="6293479">.</span><span class="ident" id="6293480">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293493">pos</span>&nbsp;<span class="op" id="6293497">:=</span>&nbsp;<span class="ident" id="6293500">p</span><span class="op" id="6293501">.</span><span class="ident" id="6293502">expect</span><span class="op" id="6293508">(</span><span class="ident" id="6293509">keyword</span><span class="op" id="6293516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293519">var</span>&nbsp;<span class="ident" id="6293523">lparen</span><span class="op" id="6293529">,</span>&nbsp;<span class="ident" id="6293531">rparen</span>&nbsp;<span class="ident" id="6293538">token</span><span class="op" id="6293543">.</span><span class="ident" id="6293544">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293549">var</span>&nbsp;<span class="ident" id="6293553">list</span>&nbsp;<span class="op" id="6293558">[</span><span class="op" id="6293559">]</span><span class="ident" id="6293560">ast</span><span class="op" id="6293563">.</span><span class="ident" id="6293564">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293570">if</span>&nbsp;<span class="ident" id="6293573">p</span><span class="op" id="6293574">.</span><span class="ident" id="6293575">tok</span>&nbsp;<span class="op" id="6293579">==</span>&nbsp;<span class="ident" id="6293582">token</span><span class="op" id="6293587">.</span><span class="ident" id="6293588">LPAREN</span>&nbsp;<span class="op" id="6293595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293599">lparen</span>&nbsp;<span class="op" id="6293606">=</span>&nbsp;<span class="ident" id="6293608">p</span><span class="op" id="6293609">.</span><span class="ident" id="6293610">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293616">p</span><span class="op" id="6293617">.</span><span class="ident" id="6293618">next</span><span class="op" id="6293622">(</span><span class="op" id="6293623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293627">for</span>&nbsp;<span class="ident" id="6293631">iota</span>&nbsp;<span class="op" id="6293636">:=</span>&nbsp;<span class="num" id="6293639">0</span><span class="op" id="6293640">;</span>&nbsp;<span class="ident" id="6293642">p</span><span class="op" id="6293643">.</span><span class="ident" id="6293644">tok</span>&nbsp;<span class="op" id="6293648">!=</span>&nbsp;<span class="ident" id="6293651">token</span><span class="op" id="6293656">.</span><span class="ident" id="6293657">RPAREN</span>&nbsp;<span class="op" id="6293664">&amp;&amp;</span>&nbsp;<span class="ident" id="6293667">p</span><span class="op" id="6293668">.</span><span class="ident" id="6293669">tok</span>&nbsp;<span class="op" id="6293673">!=</span>&nbsp;<span class="ident" id="6293676">token</span><span class="op" id="6293681">.</span><span class="ident" id="6293682">EOF</span><span class="op" id="6293685">;</span>&nbsp;<span class="ident" id="6293687">iota</span><span class="op" id="6293691">++</span>&nbsp;<span class="op" id="6293694">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293699">list</span>&nbsp;<span class="op" id="6293704">=</span>&nbsp;<span class="builtinfunc" id="6293706">append</span><span class="op" id="6293712">(</span><span class="ident" id="6293713">list</span><span class="op" id="6293717">,</span>&nbsp;<span class="ident" id="6293719">f</span><span class="op" id="6293720">(</span><span class="ident" id="6293721">p</span><span class="op" id="6293722">.</span><span class="ident" id="6293723">leadComment</span><span class="op" id="6293734">,</span>&nbsp;<span class="ident" id="6293736">keyword</span><span class="op" id="6293743">,</span>&nbsp;<span class="ident" id="6293745">iota</span><span class="op" id="6293749">)</span><span class="op" id="6293750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293758">rparen</span>&nbsp;<span class="op" id="6293765">=</span>&nbsp;<span class="ident" id="6293767">p</span><span class="op" id="6293768">.</span><span class="ident" id="6293769">expect</span><span class="op" id="6293775">(</span><span class="ident" id="6293776">token</span><span class="op" id="6293781">.</span><span class="ident" id="6293782">RPAREN</span><span class="op" id="6293788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293792">p</span><span class="op" id="6293793">.</span><span class="ident" id="6293794">expectSemi</span><span class="op" id="6293804">(</span><span class="op" id="6293805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293808">}</span>&nbsp;<span class="keyword" id="6293810">else</span>&nbsp;<span class="op" id="6293815">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293819">list</span>&nbsp;<span class="op" id="6293824">=</span>&nbsp;<span class="builtinfunc" id="6293826">append</span><span class="op" id="6293832">(</span><span class="ident" id="6293833">list</span><span class="op" id="6293837">,</span>&nbsp;<span class="ident" id="6293839">f</span><span class="op" id="6293840">(</span><span class="ident" id="6293841">nil</span><span class="op" id="6293844">,</span>&nbsp;<span class="ident" id="6293846">keyword</span><span class="op" id="6293853">,</span>&nbsp;<span class="num" id="6293855">0</span><span class="op" id="6293856">)</span><span class="op" id="6293857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293864">return</span>&nbsp;<span class="op" id="6293871">&amp;</span><span class="ident" id="6293872">ast</span><span class="op" id="6293875">.</span><span class="ident" id="6293876">GenDecl</span><span class="op" id="6293883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293887">Doc</span><span class="op" id="6293890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293895">doc</span><span class="op" id="6293898">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293902">TokPos</span><span class="op" id="6293908">:</span>&nbsp;<span class="ident" id="6293910">pos</span><span class="op" id="6293913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293917">Tok</span><span class="op" id="6293920">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293925">keyword</span><span class="op" id="6293932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293936">Lparen</span><span class="op" id="6293942">:</span>&nbsp;<span class="ident" id="6293944">lparen</span><span class="op" id="6293950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293954">Specs</span><span class="op" id="6293959">:</span>&nbsp;&nbsp;<span class="ident" id="6293962">list</span><span class="op" id="6293966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293970">Rparen</span><span class="op" id="6293976">:</span>&nbsp;<span class="ident" id="6293978">rparen</span><span class="op" id="6293984">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293987">}</span><br>
<span class="lineno"></span><span class="op" id="6293989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6293992">func</span>&nbsp;<span class="op" id="6293997">(</span><span class="ident" id="6293998">p</span>&nbsp;<span class="op" id="6294000">*</span><span class="ident" id="6294001">parser</span><span class="op" id="6294007">)</span>&nbsp;<span class="ident" id="6294009">parseFuncDecl</span><span class="op" id="6294022">(</span><span class="op" id="6294023">)</span>&nbsp;<span class="op" id="6294025">*</span><span class="ident" id="6294026">ast</span><span class="op" id="6294029">.</span><span class="ident" id="6294030">FuncDecl</span>&nbsp;<span class="op" id="6294039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294042">if</span>&nbsp;<span class="ident" id="6294045">p</span><span class="op" id="6294046">.</span><span class="ident" id="6294047">trace</span>&nbsp;<span class="op" id="6294053">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294057">defer</span>&nbsp;<span class="ident" id="6294063">un</span><span class="op" id="6294065">(</span><span class="ident" id="6294066">trace</span><span class="op" id="6294071">(</span><span class="ident" id="6294072">p</span><span class="op" id="6294073">,</span>&nbsp;<span class="string" id="6294075">&#34;FunctionDecl&#34;</span><span class="op" id="6294089">)</span><span class="op" id="6294090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294097">doc</span>&nbsp;<span class="op" id="6294101">:=</span>&nbsp;<span class="ident" id="6294104">p</span><span class="op" id="6294105">.</span><span class="ident" id="6294106">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294119">pos</span>&nbsp;<span class="op" id="6294123">:=</span>&nbsp;<span class="ident" id="6294126">p</span><span class="op" id="6294127">.</span><span class="ident" id="6294128">expect</span><span class="op" id="6294134">(</span><span class="ident" id="6294135">token</span><span class="op" id="6294140">.</span><span class="ident" id="6294141">FUNC</span><span class="op" id="6294145">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294148">scope</span>&nbsp;<span class="op" id="6294154">:=</span>&nbsp;<span class="ident" id="6294157">ast</span><span class="op" id="6294160">.</span><span class="ident" id="6294161">NewScope</span><span class="op" id="6294169">(</span><span class="ident" id="6294170">p</span><span class="op" id="6294171">.</span><span class="ident" id="6294172">topScope</span><span class="op" id="6294180">)</span>&nbsp;<span class="comment" id="6294182">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294202">var</span>&nbsp;<span class="ident" id="6294206">recv</span>&nbsp;<span class="op" id="6294211">*</span><span class="ident" id="6294212">ast</span><span class="op" id="6294215">.</span><span class="ident" id="6294216">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294227">if</span>&nbsp;<span class="ident" id="6294230">p</span><span class="op" id="6294231">.</span><span class="ident" id="6294232">tok</span>&nbsp;<span class="op" id="6294236">==</span>&nbsp;<span class="ident" id="6294239">token</span><span class="op" id="6294244">.</span><span class="ident" id="6294245">LPAREN</span>&nbsp;<span class="op" id="6294252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294256">recv</span>&nbsp;<span class="op" id="6294261">=</span>&nbsp;<span class="ident" id="6294263">p</span><span class="op" id="6294264">.</span><span class="ident" id="6294265">parseParameters</span><span class="op" id="6294280">(</span><span class="ident" id="6294281">scope</span><span class="op" id="6294286">,</span>&nbsp;<span class="builtintype" id="6294288">false</span><span class="op" id="6294293">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294300">ident</span>&nbsp;<span class="op" id="6294306">:=</span>&nbsp;<span class="ident" id="6294309">p</span><span class="op" id="6294310">.</span><span class="ident" id="6294311">parseIdent</span><span class="op" id="6294321">(</span><span class="op" id="6294322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294326">params</span><span class="op" id="6294332">,</span>&nbsp;<span class="ident" id="6294334">results</span>&nbsp;<span class="op" id="6294342">:=</span>&nbsp;<span class="ident" id="6294345">p</span><span class="op" id="6294346">.</span><span class="ident" id="6294347">parseSignature</span><span class="op" id="6294361">(</span><span class="ident" id="6294362">scope</span><span class="op" id="6294367">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294371">var</span>&nbsp;<span class="ident" id="6294375">body</span>&nbsp;<span class="op" id="6294380">*</span><span class="ident" id="6294381">ast</span><span class="op" id="6294384">.</span><span class="ident" id="6294385">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294396">if</span>&nbsp;<span class="ident" id="6294399">p</span><span class="op" id="6294400">.</span><span class="ident" id="6294401">tok</span>&nbsp;<span class="op" id="6294405">==</span>&nbsp;<span class="ident" id="6294408">token</span><span class="op" id="6294413">.</span><span class="ident" id="6294414">LBRACE</span>&nbsp;<span class="op" id="6294421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294425">body</span>&nbsp;<span class="op" id="6294430">=</span>&nbsp;<span class="ident" id="6294432">p</span><span class="op" id="6294433">.</span><span class="ident" id="6294434">parseBody</span><span class="op" id="6294443">(</span><span class="ident" id="6294444">scope</span><span class="op" id="6294449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294452">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294455">p</span><span class="op" id="6294456">.</span><span class="ident" id="6294457">expectSemi</span><span class="op" id="6294467">(</span><span class="op" id="6294468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294472">decl</span>&nbsp;<span class="op" id="6294477">:=</span>&nbsp;<span class="op" id="6294480">&amp;</span><span class="ident" id="6294481">ast</span><span class="op" id="6294484">.</span><span class="ident" id="6294485">FuncDecl</span><span class="op" id="6294493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294497">Doc</span><span class="op" id="6294500">:</span>&nbsp;&nbsp;<span class="ident" id="6294503">doc</span><span class="op" id="6294506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294510">Recv</span><span class="op" id="6294514">:</span>&nbsp;<span class="ident" id="6294516">recv</span><span class="op" id="6294520">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294524">Name</span><span class="op" id="6294528">:</span>&nbsp;<span class="ident" id="6294530">ident</span><span class="op" id="6294535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294539">Type</span><span class="op" id="6294543">:</span>&nbsp;<span class="op" id="6294545">&amp;</span><span class="ident" id="6294546">ast</span><span class="op" id="6294549">.</span><span class="ident" id="6294550">FuncType</span><span class="op" id="6294558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294563">Func</span><span class="op" id="6294567">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294572">pos</span><span class="op" id="6294575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294580">Params</span><span class="op" id="6294586">:</span>&nbsp;&nbsp;<span class="ident" id="6294589">params</span><span class="op" id="6294595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294600">Results</span><span class="op" id="6294607">:</span>&nbsp;<span class="ident" id="6294609">results</span><span class="op" id="6294616">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294620">}</span><span class="op" id="6294621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294625">Body</span><span class="op" id="6294629">:</span>&nbsp;<span class="ident" id="6294631">body</span><span class="op" id="6294635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294641">if</span>&nbsp;<span class="ident" id="6294644">recv</span>&nbsp;<span class="op" id="6294649">==</span>&nbsp;<span class="ident" id="6294652">nil</span>&nbsp;<span class="op" id="6294656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294660">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294728">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294794">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294844">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294849">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294907">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294962">if</span>&nbsp;<span class="ident" id="6294965">ident</span><span class="op" id="6294970">.</span><span class="ident" id="6294971">Name</span>&nbsp;<span class="op" id="6294976">!=</span>&nbsp;<span class="string" id="6294979">&#34;init&#34;</span>&nbsp;<span class="op" id="6294986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294991">p</span><span class="op" id="6294992">.</span><span class="ident" id="6294993">declare</span><span class="op" id="6295000">(</span><span class="ident" id="6295001">decl</span><span class="op" id="6295005">,</span>&nbsp;<span class="ident" id="6295007">nil</span><span class="op" id="6295010">,</span>&nbsp;<span class="ident" id="6295012">p</span><span class="op" id="6295013">.</span><span class="ident" id="6295014">pkgScope</span><span class="op" id="6295022">,</span>&nbsp;<span class="ident" id="6295024">ast</span><span class="op" id="6295027">.</span><span class="ident" id="6295028">Fun</span><span class="op" id="6295031">,</span>&nbsp;<span class="ident" id="6295033">ident</span><span class="op" id="6295038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295049">return</span>&nbsp;<span class="ident" id="6295056">decl</span><br>
<span class="lineno"></span><span class="op" id="6295061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6295064">func</span>&nbsp;<span class="op" id="6295069">(</span><span class="ident" id="6295070">p</span>&nbsp;<span class="op" id="6295072">*</span><span class="ident" id="6295073">parser</span><span class="op" id="6295079">)</span>&nbsp;<span class="ident" id="6295081">parseDecl</span><span class="op" id="6295090">(</span><span class="ident" id="6295091">sync</span>&nbsp;<span class="keyword" id="6295096">func</span><span class="op" id="6295100">(</span><span class="op" id="6295101">*</span><span class="ident" id="6295102">parser</span><span class="op" id="6295108">)</span><span class="op" id="6295109">)</span>&nbsp;<span class="ident" id="6295111">ast</span><span class="op" id="6295114">.</span><span class="ident" id="6295115">Decl</span>&nbsp;<span class="op" id="6295120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295123">if</span>&nbsp;<span class="ident" id="6295126">p</span><span class="op" id="6295127">.</span><span class="ident" id="6295128">trace</span>&nbsp;<span class="op" id="6295134">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295138">defer</span>&nbsp;<span class="ident" id="6295144">un</span><span class="op" id="6295146">(</span><span class="ident" id="6295147">trace</span><span class="op" id="6295152">(</span><span class="ident" id="6295153">p</span><span class="op" id="6295154">,</span>&nbsp;<span class="string" id="6295156">&#34;Declaration&#34;</span><span class="op" id="6295169">)</span><span class="op" id="6295170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295177">var</span>&nbsp;<span class="ident" id="6295181">f</span>&nbsp;<span class="ident" id="6295183">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295202">switch</span>&nbsp;<span class="ident" id="6295209">p</span><span class="op" id="6295210">.</span><span class="ident" id="6295211">tok</span>&nbsp;<span class="op" id="6295215">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295218">case</span>&nbsp;<span class="ident" id="6295223">token</span><span class="op" id="6295228">.</span><span class="ident" id="6295229">CONST</span><span class="op" id="6295234">,</span>&nbsp;<span class="ident" id="6295236">token</span><span class="op" id="6295241">.</span><span class="ident" id="6295242">VAR</span><span class="op" id="6295245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295249">f</span>&nbsp;<span class="op" id="6295251">=</span>&nbsp;<span class="ident" id="6295253">p</span><span class="op" id="6295254">.</span><span class="ident" id="6295255">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295272">case</span>&nbsp;<span class="ident" id="6295277">token</span><span class="op" id="6295282">.</span><span class="ident" id="6295283">TYPE</span><span class="op" id="6295287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295291">f</span>&nbsp;<span class="op" id="6295293">=</span>&nbsp;<span class="ident" id="6295295">p</span><span class="op" id="6295296">.</span><span class="ident" id="6295297">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295313">case</span>&nbsp;<span class="ident" id="6295318">token</span><span class="op" id="6295323">.</span><span class="ident" id="6295324">FUNC</span><span class="op" id="6295328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295332">return</span>&nbsp;<span class="ident" id="6295339">p</span><span class="op" id="6295340">.</span><span class="ident" id="6295341">parseFuncDecl</span><span class="op" id="6295354">(</span><span class="op" id="6295355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295359">default</span><span class="op" id="6295366">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295370">pos</span>&nbsp;<span class="op" id="6295374">:=</span>&nbsp;<span class="ident" id="6295377">p</span><span class="op" id="6295378">.</span><span class="ident" id="6295379">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295385">p</span><span class="op" id="6295386">.</span><span class="ident" id="6295387">errorExpected</span><span class="op" id="6295400">(</span><span class="ident" id="6295401">pos</span><span class="op" id="6295404">,</span>&nbsp;<span class="string" id="6295406">&#34;declaration&#34;</span><span class="op" id="6295419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295423">sync</span><span class="op" id="6295427">(</span><span class="ident" id="6295428">p</span><span class="op" id="6295429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295433">return</span>&nbsp;<span class="op" id="6295440">&amp;</span><span class="ident" id="6295441">ast</span><span class="op" id="6295444">.</span><span class="ident" id="6295445">BadDecl</span><span class="op" id="6295452">{</span><span class="ident" id="6295453">From</span><span class="op" id="6295457">:</span>&nbsp;<span class="ident" id="6295459">pos</span><span class="op" id="6295462">,</span>&nbsp;<span class="ident" id="6295464">To</span><span class="op" id="6295466">:</span>&nbsp;<span class="ident" id="6295468">p</span><span class="op" id="6295469">.</span><span class="ident" id="6295470">pos</span><span class="op" id="6295473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295476">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295480">return</span>&nbsp;<span class="ident" id="6295487">p</span><span class="op" id="6295488">.</span><span class="ident" id="6295489">parseGenDecl</span><span class="op" id="6295501">(</span><span class="ident" id="6295502">p</span><span class="op" id="6295503">.</span><span class="ident" id="6295504">tok</span><span class="op" id="6295507">,</span>&nbsp;<span class="ident" id="6295509">f</span><span class="op" id="6295510">)</span><br>
<span class="lineno"></span><span class="op" id="6295512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6295515">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="6295595">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6295612">func</span>&nbsp;<span class="op" id="6295617">(</span><span class="ident" id="6295618">p</span>&nbsp;<span class="op" id="6295620">*</span><span class="ident" id="6295621">parser</span><span class="op" id="6295627">)</span>&nbsp;<span class="ident" id="6295629">parseFile</span><span class="op" id="6295638">(</span><span class="op" id="6295639">)</span>&nbsp;<span class="op" id="6295641">*</span><span class="ident" id="6295642">ast</span><span class="op" id="6295645">.</span><span class="ident" id="6295646">File</span>&nbsp;<span class="op" id="6295651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295654">if</span>&nbsp;<span class="ident" id="6295657">p</span><span class="op" id="6295658">.</span><span class="ident" id="6295659">trace</span>&nbsp;<span class="op" id="6295665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295669">defer</span>&nbsp;<span class="ident" id="6295675">un</span><span class="op" id="6295677">(</span><span class="ident" id="6295678">trace</span><span class="op" id="6295683">(</span><span class="ident" id="6295684">p</span><span class="op" id="6295685">,</span>&nbsp;<span class="string" id="6295687">&#34;File&#34;</span><span class="op" id="6295693">)</span><span class="op" id="6295694">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295701">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295778">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295818">if</span>&nbsp;<span class="ident" id="6295821">p</span><span class="op" id="6295822">.</span><span class="ident" id="6295823">errors</span><span class="op" id="6295829">.</span><span class="ident" id="6295830">Len</span><span class="op" id="6295833">(</span><span class="op" id="6295834">)</span>&nbsp;<span class="op" id="6295836">!=</span>&nbsp;<span class="num" id="6295839">0</span>&nbsp;<span class="op" id="6295841">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295845">return</span>&nbsp;<span class="ident" id="6295852">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295861">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295880">doc</span>&nbsp;<span class="op" id="6295884">:=</span>&nbsp;<span class="ident" id="6295887">p</span><span class="op" id="6295888">.</span><span class="ident" id="6295889">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295902">pos</span>&nbsp;<span class="op" id="6295906">:=</span>&nbsp;<span class="ident" id="6295909">p</span><span class="op" id="6295910">.</span><span class="ident" id="6295911">expect</span><span class="op" id="6295917">(</span><span class="ident" id="6295918">token</span><span class="op" id="6295923">.</span><span class="ident" id="6295924">PACKAGE</span><span class="op" id="6295931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295934">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295988">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296039">ident</span>&nbsp;<span class="op" id="6296045">:=</span>&nbsp;<span class="ident" id="6296048">p</span><span class="op" id="6296049">.</span><span class="ident" id="6296050">parseIdent</span><span class="op" id="6296060">(</span><span class="op" id="6296061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296064">if</span>&nbsp;<span class="ident" id="6296067">ident</span><span class="op" id="6296072">.</span><span class="ident" id="6296073">Name</span>&nbsp;<span class="op" id="6296078">==</span>&nbsp;<span class="string" id="6296081">&#34;_&#34;</span>&nbsp;<span class="op" id="6296085">&amp;&amp;</span>&nbsp;<span class="ident" id="6296088">p</span><span class="op" id="6296089">.</span><span class="ident" id="6296090">mode</span><span class="op" id="6296094">&amp;</span><span class="ident" id="6296095">DeclarationErrors</span>&nbsp;<span class="op" id="6296113">!=</span>&nbsp;<span class="num" id="6296116">0</span>&nbsp;<span class="op" id="6296118">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296122">p</span><span class="op" id="6296123">.</span><span class="builtintype" id="6296124">error</span><span class="op" id="6296129">(</span><span class="ident" id="6296130">p</span><span class="op" id="6296131">.</span><span class="ident" id="6296132">pos</span><span class="op" id="6296135">,</span>&nbsp;<span class="string" id="6296137">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="6296161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296167">p</span><span class="op" id="6296168">.</span><span class="ident" id="6296169">expectSemi</span><span class="op" id="6296179">(</span><span class="op" id="6296180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296184">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296263">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296303">if</span>&nbsp;<span class="ident" id="6296306">p</span><span class="op" id="6296307">.</span><span class="ident" id="6296308">errors</span><span class="op" id="6296314">.</span><span class="ident" id="6296315">Len</span><span class="op" id="6296318">(</span><span class="op" id="6296319">)</span>&nbsp;<span class="op" id="6296321">!=</span>&nbsp;<span class="num" id="6296324">0</span>&nbsp;<span class="op" id="6296326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296330">return</span>&nbsp;<span class="ident" id="6296337">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296346">p</span><span class="op" id="6296347">.</span><span class="ident" id="6296348">openScope</span><span class="op" id="6296357">(</span><span class="op" id="6296358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296361">p</span><span class="op" id="6296362">.</span><span class="ident" id="6296363">pkgScope</span>&nbsp;<span class="op" id="6296372">=</span>&nbsp;<span class="ident" id="6296374">p</span><span class="op" id="6296375">.</span><span class="ident" id="6296376">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296386">var</span>&nbsp;<span class="ident" id="6296390">decls</span>&nbsp;<span class="op" id="6296396">[</span><span class="op" id="6296397">]</span><span class="ident" id="6296398">ast</span><span class="op" id="6296401">.</span><span class="ident" id="6296402">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296408">if</span>&nbsp;<span class="ident" id="6296411">p</span><span class="op" id="6296412">.</span><span class="ident" id="6296413">mode</span><span class="op" id="6296417">&amp;</span><span class="ident" id="6296418">PackageClauseOnly</span>&nbsp;<span class="op" id="6296436">==</span>&nbsp;<span class="num" id="6296439">0</span>&nbsp;<span class="op" id="6296441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296445">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296463">for</span>&nbsp;<span class="ident" id="6296467">p</span><span class="op" id="6296468">.</span><span class="ident" id="6296469">tok</span>&nbsp;<span class="op" id="6296473">==</span>&nbsp;<span class="ident" id="6296476">token</span><span class="op" id="6296481">.</span><span class="ident" id="6296482">IMPORT</span>&nbsp;<span class="op" id="6296489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296494">decls</span>&nbsp;<span class="op" id="6296500">=</span>&nbsp;<span class="builtinfunc" id="6296502">append</span><span class="op" id="6296508">(</span><span class="ident" id="6296509">decls</span><span class="op" id="6296514">,</span>&nbsp;<span class="ident" id="6296516">p</span><span class="op" id="6296517">.</span><span class="ident" id="6296518">parseGenDecl</span><span class="op" id="6296530">(</span><span class="ident" id="6296531">token</span><span class="op" id="6296536">.</span><span class="ident" id="6296537">IMPORT</span><span class="op" id="6296543">,</span>&nbsp;<span class="ident" id="6296545">p</span><span class="op" id="6296546">.</span><span class="ident" id="6296547">parseImportSpec</span><span class="op" id="6296562">)</span><span class="op" id="6296563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296572">if</span>&nbsp;<span class="ident" id="6296575">p</span><span class="op" id="6296576">.</span><span class="ident" id="6296577">mode</span><span class="op" id="6296581">&amp;</span><span class="ident" id="6296582">ImportsOnly</span>&nbsp;<span class="op" id="6296594">==</span>&nbsp;<span class="num" id="6296597">0</span>&nbsp;<span class="op" id="6296599">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296604">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296631">for</span>&nbsp;<span class="ident" id="6296635">p</span><span class="op" id="6296636">.</span><span class="ident" id="6296637">tok</span>&nbsp;<span class="op" id="6296641">!=</span>&nbsp;<span class="ident" id="6296644">token</span><span class="op" id="6296649">.</span><span class="ident" id="6296650">EOF</span>&nbsp;<span class="op" id="6296654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296660">decls</span>&nbsp;<span class="op" id="6296666">=</span>&nbsp;<span class="builtinfunc" id="6296668">append</span><span class="op" id="6296674">(</span><span class="ident" id="6296675">decls</span><span class="op" id="6296680">,</span>&nbsp;<span class="ident" id="6296682">p</span><span class="op" id="6296683">.</span><span class="ident" id="6296684">parseDecl</span><span class="op" id="6296693">(</span><span class="ident" id="6296694">syncDecl</span><span class="op" id="6296702">)</span><span class="op" id="6296703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296712">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296718">p</span><span class="op" id="6296719">.</span><span class="ident" id="6296720">closeScope</span><span class="op" id="6296730">(</span><span class="op" id="6296731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296734">assert</span><span class="op" id="6296740">(</span><span class="ident" id="6296741">p</span><span class="op" id="6296742">.</span><span class="ident" id="6296743">topScope</span>&nbsp;<span class="op" id="6296752">==</span>&nbsp;<span class="ident" id="6296755">nil</span><span class="op" id="6296758">,</span>&nbsp;<span class="string" id="6296760">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="6296779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296782">assert</span><span class="op" id="6296788">(</span><span class="ident" id="6296789">p</span><span class="op" id="6296790">.</span><span class="ident" id="6296791">labelScope</span>&nbsp;<span class="op" id="6296802">==</span>&nbsp;<span class="ident" id="6296805">nil</span><span class="op" id="6296808">,</span>&nbsp;<span class="string" id="6296810">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="6296835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296839">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296891">i</span>&nbsp;<span class="op" id="6296893">:=</span>&nbsp;<span class="num" id="6296896">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296899">for</span>&nbsp;<span class="ident" id="6296903">_</span><span class="op" id="6296904">,</span>&nbsp;<span class="ident" id="6296906">ident</span>&nbsp;<span class="op" id="6296912">:=</span>&nbsp;<span class="keyword" id="6296915">range</span>&nbsp;<span class="ident" id="6296921">p</span><span class="op" id="6296922">.</span><span class="ident" id="6296923">unresolved</span>&nbsp;<span class="op" id="6296934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296938">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296972">assert</span><span class="op" id="6296978">(</span><span class="ident" id="6296979">ident</span><span class="op" id="6296984">.</span><span class="ident" id="6296985">Obj</span>&nbsp;<span class="op" id="6296989">==</span>&nbsp;<span class="ident" id="6296992">unresolved</span><span class="op" id="6297002">,</span>&nbsp;<span class="string" id="6297004">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="6297029">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297033">ident</span><span class="op" id="6297038">.</span><span class="ident" id="6297039">Obj</span>&nbsp;<span class="op" id="6297043">=</span>&nbsp;<span class="ident" id="6297045">p</span><span class="op" id="6297046">.</span><span class="ident" id="6297047">pkgScope</span><span class="op" id="6297055">.</span><span class="ident" id="6297056">Lookup</span><span class="op" id="6297062">(</span><span class="ident" id="6297063">ident</span><span class="op" id="6297068">.</span><span class="ident" id="6297069">Name</span><span class="op" id="6297073">)</span>&nbsp;<span class="comment" id="6297075">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297113">if</span>&nbsp;<span class="ident" id="6297116">ident</span><span class="op" id="6297121">.</span><span class="ident" id="6297122">Obj</span>&nbsp;<span class="op" id="6297126">==</span>&nbsp;<span class="ident" id="6297129">nil</span>&nbsp;<span class="op" id="6297133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297138">p</span><span class="op" id="6297139">.</span><span class="ident" id="6297140">unresolved</span><span class="op" id="6297150">[</span><span class="ident" id="6297151">i</span><span class="op" id="6297152">]</span>&nbsp;<span class="op" id="6297154">=</span>&nbsp;<span class="ident" id="6297156">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297165">i</span><span class="op" id="6297166">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297171">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297178">return</span>&nbsp;<span class="op" id="6297185">&amp;</span><span class="ident" id="6297186">ast</span><span class="op" id="6297189">.</span><span class="ident" id="6297190">File</span><span class="op" id="6297194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297198">Doc</span><span class="op" id="6297201">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297210">doc</span><span class="op" id="6297213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297217">Package</span><span class="op" id="6297224">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297229">pos</span><span class="op" id="6297232">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297236">Name</span><span class="op" id="6297240">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297248">ident</span><span class="op" id="6297253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297257">Decls</span><span class="op" id="6297262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297269">decls</span><span class="op" id="6297274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297278">Scope</span><span class="op" id="6297283">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297290">p</span><span class="op" id="6297291">.</span><span class="ident" id="6297292">pkgScope</span><span class="op" id="6297300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297304">Imports</span><span class="op" id="6297311">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297316">p</span><span class="op" id="6297317">.</span><span class="ident" id="6297318">imports</span><span class="op" id="6297325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297329">Unresolved</span><span class="op" id="6297339">:</span>&nbsp;<span class="ident" id="6297341">p</span><span class="op" id="6297342">.</span><span class="ident" id="6297343">unresolved</span><span class="op" id="6297353">[</span><span class="num" id="6297354">0</span><span class="op" id="6297355">:</span><span class="ident" id="6297356">i</span><span class="op" id="6297357">]</span><span class="op" id="6297358">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297362">Comments</span><span class="op" id="6297370">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6297374">p</span><span class="op" id="6297375">.</span><span class="ident" id="6297376">comments</span><span class="op" id="6297384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297387">}</span><br>
<span class="lineno"></span><span class="op" id="6297389">}</span>
</div>
</body>
</html>
