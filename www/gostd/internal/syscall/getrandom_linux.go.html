<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3572335">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3572391">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3572445">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3572496">package</span>&nbsp;<span class="ident" id="3572504">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3572513">import</span>&nbsp;<span class="op" id="3572520">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572523">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572534">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572549">stdsyscall</span>&nbsp;<span class="string" id="3572560">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572571">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3572580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3572583">var</span>&nbsp;<span class="ident" id="3572587">randomTrap</span>&nbsp;<span class="op" id="3572598">=</span>&nbsp;<span class="keyword" id="3572600">map</span><span class="op" id="3572603">[</span><span class="builtintype" id="3572604">string</span><span class="op" id="3572610">]</span><span class="builtintype" id="3572611">uintptr</span><span class="op" id="3572618">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572621">&#34;386&#34;</span><span class="op" id="3572626">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3572630">355</span><span class="op" id="3572633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572636">&#34;amd64&#34;</span><span class="op" id="3572643">:</span>&nbsp;<span class="num" id="3572645">318</span><span class="op" id="3572648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3572651">&#34;arm&#34;</span><span class="op" id="3572656">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3572660">384</span><span class="op" id="3572663">,</span><br>
<span class="lineno"></span><span class="op" id="3572665">}</span><span class="op" id="3572666">[</span><span class="ident" id="3572667">runtime</span><span class="op" id="3572674">.</span><span class="ident" id="3572675">GOARCH</span><span class="op" id="3572681">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3572684">var</span>&nbsp;<span class="ident" id="3572688">randomUnsupported</span>&nbsp;<span class="builtintype" id="3572706">int32</span>&nbsp;<span class="comment" id="3572712">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3572723">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3572790">type</span>&nbsp;<span class="ident" id="3572795">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3572809">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3572818">const</span>&nbsp;<span class="op" id="3572824">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572827">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572887">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3572901">GetRandomFlag</span>&nbsp;<span class="op" id="3572915">=</span>&nbsp;<span class="num" id="3572917">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572926">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572998">GRND_RANDOM</span>&nbsp;<span class="ident" id="3573010">GetRandomFlag</span>&nbsp;<span class="op" id="3573024">=</span>&nbsp;<span class="num" id="3573026">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3573033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573036">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3573088">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3573211">func</span>&nbsp;<span class="ident" id="3573216">GetRandom</span><span class="op" id="3573225">(</span><span class="ident" id="3573226">p</span>&nbsp;<span class="op" id="3573228">[</span><span class="op" id="3573229">]</span><span class="builtintype" id="3573230">byte</span><span class="op" id="3573234">,</span>&nbsp;<span class="ident" id="3573236">flags</span>&nbsp;<span class="ident" id="3573242">GetRandomFlag</span><span class="op" id="3573255">)</span>&nbsp;<span class="op" id="3573257">(</span><span class="ident" id="3573258">n</span>&nbsp;<span class="builtintype" id="3573260">int</span><span class="op" id="3573263">,</span>&nbsp;<span class="ident" id="3573265">err</span>&nbsp;<span class="builtintype" id="3573269">error</span><span class="op" id="3573274">)</span>&nbsp;<span class="op" id="3573276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573279">if</span>&nbsp;<span class="ident" id="3573282">randomTrap</span>&nbsp;<span class="op" id="3573293">==</span>&nbsp;<span class="num" id="3573296">0</span>&nbsp;<span class="op" id="3573298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573302">return</span>&nbsp;<span class="num" id="3573309">0</span><span class="op" id="3573310">,</span>&nbsp;<span class="ident" id="3573312">stdsyscall</span><span class="op" id="3573322">.</span><span class="ident" id="3573323">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573334">if</span>&nbsp;<span class="builtinfunc" id="3573337">len</span><span class="op" id="3573340">(</span><span class="ident" id="3573341">p</span><span class="op" id="3573342">)</span>&nbsp;<span class="op" id="3573344">==</span>&nbsp;<span class="num" id="3573347">0</span>&nbsp;<span class="op" id="3573349">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573353">return</span>&nbsp;<span class="num" id="3573360">0</span><span class="op" id="3573361">,</span>&nbsp;<span class="ident" id="3573363">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573371">if</span>&nbsp;<span class="ident" id="3573374">atomic</span><span class="op" id="3573380">.</span><span class="ident" id="3573381">LoadInt32</span><span class="op" id="3573390">(</span><span class="op" id="3573391">&amp;</span><span class="ident" id="3573392">randomUnsupported</span><span class="op" id="3573409">)</span>&nbsp;<span class="op" id="3573411">!=</span>&nbsp;<span class="num" id="3573414">0</span>&nbsp;<span class="op" id="3573416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573420">return</span>&nbsp;<span class="num" id="3573427">0</span><span class="op" id="3573428">,</span>&nbsp;<span class="ident" id="3573430">stdsyscall</span><span class="op" id="3573440">.</span><span class="ident" id="3573441">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573449">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573452">r1</span><span class="op" id="3573454">,</span>&nbsp;<span class="ident" id="3573456">_</span><span class="op" id="3573457">,</span>&nbsp;<span class="ident" id="3573459">errno</span>&nbsp;<span class="op" id="3573465">:=</span>&nbsp;<span class="ident" id="3573468">stdsyscall</span><span class="op" id="3573478">.</span><span class="ident" id="3573479">Syscall</span><span class="op" id="3573486">(</span><span class="ident" id="3573487">randomTrap</span><span class="op" id="3573497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3573501">uintptr</span><span class="op" id="3573508">(</span><span class="ident" id="3573509">unsafe</span><span class="op" id="3573515">.</span><span class="ident" id="3573516">Pointer</span><span class="op" id="3573523">(</span><span class="op" id="3573524">&amp;</span><span class="ident" id="3573525">p</span><span class="op" id="3573526">[</span><span class="num" id="3573527">0</span><span class="op" id="3573528">]</span><span class="op" id="3573529">)</span><span class="op" id="3573530">)</span><span class="op" id="3573531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3573535">uintptr</span><span class="op" id="3573542">(</span><span class="builtinfunc" id="3573543">len</span><span class="op" id="3573546">(</span><span class="ident" id="3573547">p</span><span class="op" id="3573548">)</span><span class="op" id="3573549">)</span><span class="op" id="3573550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3573554">uintptr</span><span class="op" id="3573561">(</span><span class="ident" id="3573562">flags</span><span class="op" id="3573567">)</span><span class="op" id="3573568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573571">if</span>&nbsp;<span class="ident" id="3573574">errno</span>&nbsp;<span class="op" id="3573580">!=</span>&nbsp;<span class="num" id="3573583">0</span>&nbsp;<span class="op" id="3573585">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573589">if</span>&nbsp;<span class="ident" id="3573592">errno</span>&nbsp;<span class="op" id="3573598">==</span>&nbsp;<span class="ident" id="3573601">stdsyscall</span><span class="op" id="3573611">.</span><span class="ident" id="3573612">ENOSYS</span>&nbsp;<span class="op" id="3573619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573624">atomic</span><span class="op" id="3573630">.</span><span class="ident" id="3573631">StoreInt32</span><span class="op" id="3573641">(</span><span class="op" id="3573642">&amp;</span><span class="ident" id="3573643">randomUnsupported</span><span class="op" id="3573660">,</span>&nbsp;<span class="num" id="3573662">1</span><span class="op" id="3573663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573671">return</span>&nbsp;<span class="num" id="3573678">0</span><span class="op" id="3573679">,</span>&nbsp;<span class="ident" id="3573681">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573688">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573691">return</span>&nbsp;<span class="builtintype" id="3573698">int</span><span class="op" id="3573701">(</span><span class="ident" id="3573702">r1</span><span class="op" id="3573704">)</span><span class="op" id="3573705">,</span>&nbsp;<span class="ident" id="3573707">nil</span><br>
<span class="lineno"></span><span class="op" id="3573711">}</span>
</div>
</body>
</html>
