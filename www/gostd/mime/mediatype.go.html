<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html" class="current">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3436918">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3436973">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3437027">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3437078">package</span>&nbsp;<span class="ident" id="3437086">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3437092">import</span>&nbsp;<span class="op" id="3437099">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437102">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437111">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437121">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437128">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437136">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3437147">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="3437157">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3437160">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="3437221">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3437283">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="3437342">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="3437407">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3437452">func</span>&nbsp;<span class="ident" id="3437457">FormatMediaType</span><span class="op" id="3437472">(</span><span class="ident" id="3437473">t</span>&nbsp;<span class="builtintype" id="3437475">string</span><span class="op" id="3437481">,</span>&nbsp;<span class="ident" id="3437483">param</span>&nbsp;<span class="keyword" id="3437489">map</span><span class="op" id="3437492">[</span><span class="builtintype" id="3437493">string</span><span class="op" id="3437499">]</span><span class="builtintype" id="3437500">string</span><span class="op" id="3437506">)</span>&nbsp;<span class="builtintype" id="3437508">string</span>&nbsp;<span class="op" id="3437515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437518">slash</span>&nbsp;<span class="op" id="3437524">:=</span>&nbsp;<span class="ident" id="3437527">strings</span><span class="op" id="3437534">.</span><span class="ident" id="3437535">Index</span><span class="op" id="3437540">(</span><span class="ident" id="3437541">t</span><span class="op" id="3437542">,</span>&nbsp;<span class="string" id="3437544">&#34;/&#34;</span><span class="op" id="3437547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437550">if</span>&nbsp;<span class="ident" id="3437553">slash</span>&nbsp;<span class="op" id="3437559">==</span>&nbsp;<span class="op" id="3437562">-</span><span class="num" id="3437563">1</span>&nbsp;<span class="op" id="3437565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437569">return</span>&nbsp;<span class="string" id="3437576">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3437580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437583">major</span><span class="op" id="3437588">,</span>&nbsp;<span class="ident" id="3437590">sub</span>&nbsp;<span class="op" id="3437594">:=</span>&nbsp;<span class="ident" id="3437597">t</span><span class="op" id="3437598">[</span><span class="op" id="3437599">:</span><span class="ident" id="3437600">slash</span><span class="op" id="3437605">]</span><span class="op" id="3437606">,</span>&nbsp;<span class="ident" id="3437608">t</span><span class="op" id="3437609">[</span><span class="ident" id="3437610">slash</span><span class="op" id="3437615">+</span><span class="num" id="3437616">1</span><span class="op" id="3437617">:</span><span class="op" id="3437618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437621">if</span>&nbsp;<span class="op" id="3437624">!</span><span class="ident" id="3437625">isToken</span><span class="op" id="3437632">(</span><span class="ident" id="3437633">major</span><span class="op" id="3437638">)</span>&nbsp;<span class="op" id="3437640">||</span>&nbsp;<span class="op" id="3437643">!</span><span class="ident" id="3437644">isToken</span><span class="op" id="3437651">(</span><span class="ident" id="3437652">sub</span><span class="op" id="3437655">)</span>&nbsp;<span class="op" id="3437657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437661">return</span>&nbsp;<span class="string" id="3437668">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3437672">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437675">var</span>&nbsp;<span class="ident" id="3437679">b</span>&nbsp;<span class="ident" id="3437681">bytes</span><span class="op" id="3437686">.</span><span class="ident" id="3437687">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437695">b</span><span class="op" id="3437696">.</span><span class="ident" id="3437697">WriteString</span><span class="op" id="3437708">(</span><span class="ident" id="3437709">strings</span><span class="op" id="3437716">.</span><span class="ident" id="3437717">ToLower</span><span class="op" id="3437724">(</span><span class="ident" id="3437725">major</span><span class="op" id="3437730">)</span><span class="op" id="3437731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437734">b</span><span class="op" id="3437735">.</span><span class="ident" id="3437736">WriteByte</span><span class="op" id="3437745">(</span><span class="string" id="3437746">&#39;/&#39;</span><span class="op" id="3437749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437752">b</span><span class="op" id="3437753">.</span><span class="ident" id="3437754">WriteString</span><span class="op" id="3437765">(</span><span class="ident" id="3437766">strings</span><span class="op" id="3437773">.</span><span class="ident" id="3437774">ToLower</span><span class="op" id="3437781">(</span><span class="ident" id="3437782">sub</span><span class="op" id="3437785">)</span><span class="op" id="3437786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437790">attrs</span>&nbsp;<span class="op" id="3437796">:=</span>&nbsp;<span class="builtinfunc" id="3437799">make</span><span class="op" id="3437803">(</span><span class="op" id="3437804">[</span><span class="op" id="3437805">]</span><span class="builtintype" id="3437806">string</span><span class="op" id="3437812">,</span>&nbsp;<span class="num" id="3437814">0</span><span class="op" id="3437815">,</span>&nbsp;<span class="builtinfunc" id="3437817">len</span><span class="op" id="3437820">(</span><span class="ident" id="3437821">param</span><span class="op" id="3437826">)</span><span class="op" id="3437827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437830">for</span>&nbsp;<span class="ident" id="3437834">a</span>&nbsp;<span class="op" id="3437836">:=</span>&nbsp;<span class="keyword" id="3437839">range</span>&nbsp;<span class="ident" id="3437845">param</span>&nbsp;<span class="op" id="3437851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437855">attrs</span>&nbsp;<span class="op" id="3437861">=</span>&nbsp;<span class="builtinfunc" id="3437863">append</span><span class="op" id="3437869">(</span><span class="ident" id="3437870">attrs</span><span class="op" id="3437875">,</span>&nbsp;<span class="ident" id="3437877">a</span><span class="op" id="3437878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3437881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437884">sort</span><span class="op" id="3437888">.</span><span class="ident" id="3437889">Strings</span><span class="op" id="3437896">(</span><span class="ident" id="3437897">attrs</span><span class="op" id="3437902">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3437906">for</span>&nbsp;<span class="ident" id="3437910">_</span><span class="op" id="3437911">,</span>&nbsp;<span class="ident" id="3437913">attribute</span>&nbsp;<span class="op" id="3437923">:=</span>&nbsp;<span class="keyword" id="3437926">range</span>&nbsp;<span class="ident" id="3437932">attrs</span>&nbsp;<span class="op" id="3437938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437942">value</span>&nbsp;<span class="op" id="3437948">:=</span>&nbsp;<span class="ident" id="3437951">param</span><span class="op" id="3437956">[</span><span class="ident" id="3437957">attribute</span><span class="op" id="3437966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437970">b</span><span class="op" id="3437971">.</span><span class="ident" id="3437972">WriteByte</span><span class="op" id="3437981">(</span><span class="string" id="3437982">&#39;;&#39;</span><span class="op" id="3437985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3437989">b</span><span class="op" id="3437990">.</span><span class="ident" id="3437991">WriteByte</span><span class="op" id="3438000">(</span><span class="string" id="3438001">&#39;&nbsp;&#39;</span><span class="op" id="3438004">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438008">if</span>&nbsp;<span class="op" id="3438011">!</span><span class="ident" id="3438012">isToken</span><span class="op" id="3438019">(</span><span class="ident" id="3438020">attribute</span><span class="op" id="3438029">)</span>&nbsp;<span class="op" id="3438031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438036">return</span>&nbsp;<span class="string" id="3438043">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438052">b</span><span class="op" id="3438053">.</span><span class="ident" id="3438054">WriteString</span><span class="op" id="3438065">(</span><span class="ident" id="3438066">strings</span><span class="op" id="3438073">.</span><span class="ident" id="3438074">ToLower</span><span class="op" id="3438081">(</span><span class="ident" id="3438082">attribute</span><span class="op" id="3438091">)</span><span class="op" id="3438092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438096">b</span><span class="op" id="3438097">.</span><span class="ident" id="3438098">WriteByte</span><span class="op" id="3438107">(</span><span class="string" id="3438108">&#39;=&#39;</span><span class="op" id="3438111">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438115">if</span>&nbsp;<span class="ident" id="3438118">isToken</span><span class="op" id="3438125">(</span><span class="ident" id="3438126">value</span><span class="op" id="3438131">)</span>&nbsp;<span class="op" id="3438133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438138">b</span><span class="op" id="3438139">.</span><span class="ident" id="3438140">WriteString</span><span class="op" id="3438151">(</span><span class="ident" id="3438152">value</span><span class="op" id="3438157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438162">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438178">b</span><span class="op" id="3438179">.</span><span class="ident" id="3438180">WriteByte</span><span class="op" id="3438189">(</span><span class="string" id="3438190">&#39;&#34;&#39;</span><span class="op" id="3438193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438197">offset</span>&nbsp;<span class="op" id="3438204">:=</span>&nbsp;<span class="num" id="3438207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438211">for</span>&nbsp;<span class="ident" id="3438215">index</span><span class="op" id="3438220">,</span>&nbsp;<span class="ident" id="3438222">character</span>&nbsp;<span class="op" id="3438232">:=</span>&nbsp;<span class="keyword" id="3438235">range</span>&nbsp;<span class="ident" id="3438241">value</span>&nbsp;<span class="op" id="3438247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438252">if</span>&nbsp;<span class="ident" id="3438255">character</span>&nbsp;<span class="op" id="3438265">==</span>&nbsp;<span class="string" id="3438268">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3438272">||</span>&nbsp;<span class="ident" id="3438275">character</span>&nbsp;<span class="op" id="3438285">==</span>&nbsp;<span class="string" id="3438288">&#39;\\&#39;</span>&nbsp;<span class="op" id="3438293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438299">b</span><span class="op" id="3438300">.</span><span class="ident" id="3438301">WriteString</span><span class="op" id="3438312">(</span><span class="ident" id="3438313">value</span><span class="op" id="3438318">[</span><span class="ident" id="3438319">offset</span><span class="op" id="3438325">:</span><span class="ident" id="3438326">index</span><span class="op" id="3438331">]</span><span class="op" id="3438332">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438338">offset</span>&nbsp;<span class="op" id="3438345">=</span>&nbsp;<span class="ident" id="3438347">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438357">b</span><span class="op" id="3438358">.</span><span class="ident" id="3438359">WriteByte</span><span class="op" id="3438368">(</span><span class="string" id="3438369">&#39;\\&#39;</span><span class="op" id="3438373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438383">if</span>&nbsp;<span class="ident" id="3438386">character</span><span class="op" id="3438395">&amp;</span><span class="num" id="3438396">0x80</span>&nbsp;<span class="op" id="3438401">!=</span>&nbsp;<span class="num" id="3438404">0</span>&nbsp;<span class="op" id="3438406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438412">return</span>&nbsp;<span class="string" id="3438419">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438433">b</span><span class="op" id="3438434">.</span><span class="ident" id="3438435">WriteString</span><span class="op" id="3438446">(</span><span class="ident" id="3438447">value</span><span class="op" id="3438452">[</span><span class="ident" id="3438453">offset</span><span class="op" id="3438459">:</span><span class="op" id="3438460">]</span><span class="op" id="3438461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438465">b</span><span class="op" id="3438466">.</span><span class="ident" id="3438467">WriteByte</span><span class="op" id="3438476">(</span><span class="string" id="3438477">&#39;&#34;&#39;</span><span class="op" id="3438480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438483">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438486">return</span>&nbsp;<span class="ident" id="3438493">b</span><span class="op" id="3438494">.</span><span class="ident" id="3438495">String</span><span class="op" id="3438501">(</span><span class="op" id="3438502">)</span><br>
<span class="lineno"></span><span class="op" id="3438504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3438507">func</span>&nbsp;<span class="ident" id="3438512">checkMediaTypeDisposition</span><span class="op" id="3438537">(</span><span class="ident" id="3438538">s</span>&nbsp;<span class="builtintype" id="3438540">string</span><span class="op" id="3438546">)</span>&nbsp;<span class="builtintype" id="3438548">error</span>&nbsp;<span class="op" id="3438554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438557">typ</span><span class="op" id="3438560">,</span>&nbsp;<span class="ident" id="3438562">rest</span>&nbsp;<span class="op" id="3438567">:=</span>&nbsp;<span class="ident" id="3438570">consumeToken</span><span class="op" id="3438582">(</span><span class="ident" id="3438583">s</span><span class="op" id="3438584">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438587">if</span>&nbsp;<span class="ident" id="3438590">typ</span>&nbsp;<span class="op" id="3438594">==</span>&nbsp;<span class="string" id="3438597">&#34;&#34;</span>&nbsp;<span class="op" id="3438600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438604">return</span>&nbsp;<span class="ident" id="3438611">errors</span><span class="op" id="3438617">.</span><span class="ident" id="3438618">New</span><span class="op" id="3438621">(</span><span class="string" id="3438622">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="3438643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438649">if</span>&nbsp;<span class="ident" id="3438652">rest</span>&nbsp;<span class="op" id="3438657">==</span>&nbsp;<span class="string" id="3438660">&#34;&#34;</span>&nbsp;<span class="op" id="3438663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438667">return</span>&nbsp;<span class="builtintype" id="3438674">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438682">if</span>&nbsp;<span class="op" id="3438685">!</span><span class="ident" id="3438686">strings</span><span class="op" id="3438693">.</span><span class="ident" id="3438694">HasPrefix</span><span class="op" id="3438703">(</span><span class="ident" id="3438704">rest</span><span class="op" id="3438708">,</span>&nbsp;<span class="string" id="3438710">&#34;/&#34;</span><span class="op" id="3438713">)</span>&nbsp;<span class="op" id="3438715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438719">return</span>&nbsp;<span class="ident" id="3438726">errors</span><span class="op" id="3438732">.</span><span class="ident" id="3438733">New</span><span class="op" id="3438736">(</span><span class="string" id="3438737">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="3438777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3438783">subtype</span><span class="op" id="3438790">,</span>&nbsp;<span class="ident" id="3438792">rest</span>&nbsp;<span class="op" id="3438797">:=</span>&nbsp;<span class="ident" id="3438800">consumeToken</span><span class="op" id="3438812">(</span><span class="ident" id="3438813">rest</span><span class="op" id="3438817">[</span><span class="num" id="3438818">1</span><span class="op" id="3438819">:</span><span class="op" id="3438820">]</span><span class="op" id="3438821">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438824">if</span>&nbsp;<span class="ident" id="3438827">subtype</span>&nbsp;<span class="op" id="3438835">==</span>&nbsp;<span class="string" id="3438838">&#34;&#34;</span>&nbsp;<span class="op" id="3438841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438845">return</span>&nbsp;<span class="ident" id="3438852">errors</span><span class="op" id="3438858">.</span><span class="ident" id="3438859">New</span><span class="op" id="3438862">(</span><span class="string" id="3438863">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="3438897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438903">if</span>&nbsp;<span class="ident" id="3438906">rest</span>&nbsp;<span class="op" id="3438911">!=</span>&nbsp;<span class="string" id="3438914">&#34;&#34;</span>&nbsp;<span class="op" id="3438917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438921">return</span>&nbsp;<span class="ident" id="3438928">errors</span><span class="op" id="3438934">.</span><span class="ident" id="3438935">New</span><span class="op" id="3438938">(</span><span class="string" id="3438939">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="3438985">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3438988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3438991">return</span>&nbsp;<span class="builtintype" id="3438998">nil</span><br>
<span class="lineno"></span><span class="op" id="3439002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3439005">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="3439066">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3439126">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="3439186">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3439249">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3439311">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="3439364">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="3439425">func</span>&nbsp;<span class="ident" id="3439430">ParseMediaType</span><span class="op" id="3439444">(</span><span class="ident" id="3439445">v</span>&nbsp;<span class="builtintype" id="3439447">string</span><span class="op" id="3439453">)</span>&nbsp;<span class="op" id="3439455">(</span><span class="ident" id="3439456">mediatype</span>&nbsp;<span class="builtintype" id="3439466">string</span><span class="op" id="3439472">,</span>&nbsp;<span class="ident" id="3439474">params</span>&nbsp;<span class="keyword" id="3439481">map</span><span class="op" id="3439484">[</span><span class="builtintype" id="3439485">string</span><span class="op" id="3439491">]</span><span class="builtintype" id="3439492">string</span><span class="op" id="3439498">,</span>&nbsp;<span class="ident" id="3439500">err</span>&nbsp;<span class="builtintype" id="3439504">error</span><span class="op" id="3439509">)</span>&nbsp;<span class="op" id="3439511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439514">i</span>&nbsp;<span class="op" id="3439516">:=</span>&nbsp;<span class="ident" id="3439519">strings</span><span class="op" id="3439526">.</span><span class="ident" id="3439527">Index</span><span class="op" id="3439532">(</span><span class="ident" id="3439533">v</span><span class="op" id="3439534">,</span>&nbsp;<span class="string" id="3439536">&#34;;&#34;</span><span class="op" id="3439539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3439542">if</span>&nbsp;<span class="ident" id="3439545">i</span>&nbsp;<span class="op" id="3439547">==</span>&nbsp;<span class="op" id="3439550">-</span><span class="num" id="3439551">1</span>&nbsp;<span class="op" id="3439553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439557">i</span>&nbsp;<span class="op" id="3439559">=</span>&nbsp;<span class="builtinfunc" id="3439561">len</span><span class="op" id="3439564">(</span><span class="ident" id="3439565">v</span><span class="op" id="3439566">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3439569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439572">mediatype</span>&nbsp;<span class="op" id="3439582">=</span>&nbsp;<span class="ident" id="3439584">strings</span><span class="op" id="3439591">.</span><span class="ident" id="3439592">TrimSpace</span><span class="op" id="3439601">(</span><span class="ident" id="3439602">strings</span><span class="op" id="3439609">.</span><span class="ident" id="3439610">ToLower</span><span class="op" id="3439617">(</span><span class="ident" id="3439618">v</span><span class="op" id="3439619">[</span><span class="num" id="3439620">0</span><span class="op" id="3439621">:</span><span class="ident" id="3439622">i</span><span class="op" id="3439623">]</span><span class="op" id="3439624">)</span><span class="op" id="3439625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439629">err</span>&nbsp;<span class="op" id="3439633">=</span>&nbsp;<span class="ident" id="3439635">checkMediaTypeDisposition</span><span class="op" id="3439660">(</span><span class="ident" id="3439661">mediatype</span><span class="op" id="3439670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3439673">if</span>&nbsp;<span class="ident" id="3439676">err</span>&nbsp;<span class="op" id="3439680">!=</span>&nbsp;<span class="builtintype" id="3439683">nil</span>&nbsp;<span class="op" id="3439687">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3439691">return</span>&nbsp;<span class="string" id="3439698">&#34;&#34;</span><span class="op" id="3439700">,</span>&nbsp;<span class="builtintype" id="3439702">nil</span><span class="op" id="3439705">,</span>&nbsp;<span class="ident" id="3439707">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3439712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439716">params</span>&nbsp;<span class="op" id="3439723">=</span>&nbsp;<span class="builtinfunc" id="3439725">make</span><span class="op" id="3439729">(</span><span class="keyword" id="3439730">map</span><span class="op" id="3439733">[</span><span class="builtintype" id="3439734">string</span><span class="op" id="3439740">]</span><span class="builtintype" id="3439741">string</span><span class="op" id="3439747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3439751">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3439809">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3439856">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3439880">var</span>&nbsp;<span class="ident" id="3439884">continuation</span>&nbsp;<span class="keyword" id="3439897">map</span><span class="op" id="3439900">[</span><span class="builtintype" id="3439901">string</span><span class="op" id="3439907">]</span><span class="keyword" id="3439908">map</span><span class="op" id="3439911">[</span><span class="builtintype" id="3439912">string</span><span class="op" id="3439918">]</span><span class="builtintype" id="3439919">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439928">v</span>&nbsp;<span class="op" id="3439930">=</span>&nbsp;<span class="ident" id="3439932">v</span><span class="op" id="3439933">[</span><span class="ident" id="3439934">i</span><span class="op" id="3439935">:</span><span class="op" id="3439936">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3439939">for</span>&nbsp;<span class="builtinfunc" id="3439943">len</span><span class="op" id="3439946">(</span><span class="ident" id="3439947">v</span><span class="op" id="3439948">)</span>&nbsp;<span class="op" id="3439950">&gt;</span>&nbsp;<span class="num" id="3439952">0</span>&nbsp;<span class="op" id="3439954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3439958">v</span>&nbsp;<span class="op" id="3439960">=</span>&nbsp;<span class="ident" id="3439962">strings</span><span class="op" id="3439969">.</span><span class="ident" id="3439970">TrimLeftFunc</span><span class="op" id="3439982">(</span><span class="ident" id="3439983">v</span><span class="op" id="3439984">,</span>&nbsp;<span class="ident" id="3439986">unicode</span><span class="op" id="3439993">.</span><span class="ident" id="3439994">IsSpace</span><span class="op" id="3440001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440005">if</span>&nbsp;<span class="builtinfunc" id="3440008">len</span><span class="op" id="3440011">(</span><span class="ident" id="3440012">v</span><span class="op" id="3440013">)</span>&nbsp;<span class="op" id="3440015">==</span>&nbsp;<span class="num" id="3440018">0</span>&nbsp;<span class="op" id="3440020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440025">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440037">key</span><span class="op" id="3440040">,</span>&nbsp;<span class="ident" id="3440042">value</span><span class="op" id="3440047">,</span>&nbsp;<span class="ident" id="3440049">rest</span>&nbsp;<span class="op" id="3440054">:=</span>&nbsp;<span class="ident" id="3440057">consumeMediaParam</span><span class="op" id="3440074">(</span><span class="ident" id="3440075">v</span><span class="op" id="3440076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440080">if</span>&nbsp;<span class="ident" id="3440083">key</span>&nbsp;<span class="op" id="3440087">==</span>&nbsp;<span class="string" id="3440090">&#34;&#34;</span>&nbsp;<span class="op" id="3440093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440098">if</span>&nbsp;<span class="ident" id="3440101">strings</span><span class="op" id="3440108">.</span><span class="ident" id="3440109">TrimSpace</span><span class="op" id="3440118">(</span><span class="ident" id="3440119">rest</span><span class="op" id="3440123">)</span>&nbsp;<span class="op" id="3440125">==</span>&nbsp;<span class="string" id="3440128">&#34;;&#34;</span>&nbsp;<span class="op" id="3440132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440138">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440173">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440194">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440209">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440228">return</span>&nbsp;<span class="string" id="3440235">&#34;&#34;</span><span class="op" id="3440237">,</span>&nbsp;<span class="builtintype" id="3440239">nil</span><span class="op" id="3440242">,</span>&nbsp;<span class="ident" id="3440244">errors</span><span class="op" id="3440250">.</span><span class="ident" id="3440251">New</span><span class="op" id="3440254">(</span><span class="string" id="3440255">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="3440286">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440295">pmap</span>&nbsp;<span class="op" id="3440300">:=</span>&nbsp;<span class="ident" id="3440303">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440312">if</span>&nbsp;<span class="ident" id="3440315">idx</span>&nbsp;<span class="op" id="3440319">:=</span>&nbsp;<span class="ident" id="3440322">strings</span><span class="op" id="3440329">.</span><span class="ident" id="3440330">Index</span><span class="op" id="3440335">(</span><span class="ident" id="3440336">key</span><span class="op" id="3440339">,</span>&nbsp;<span class="string" id="3440341">&#34;*&#34;</span><span class="op" id="3440344">)</span><span class="op" id="3440345">;</span>&nbsp;<span class="ident" id="3440347">idx</span>&nbsp;<span class="op" id="3440351">!=</span>&nbsp;<span class="op" id="3440354">-</span><span class="num" id="3440355">1</span>&nbsp;<span class="op" id="3440357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440362">baseName</span>&nbsp;<span class="op" id="3440371">:=</span>&nbsp;<span class="ident" id="3440374">key</span><span class="op" id="3440377">[</span><span class="op" id="3440378">:</span><span class="ident" id="3440379">idx</span><span class="op" id="3440382">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440387">if</span>&nbsp;<span class="ident" id="3440390">continuation</span>&nbsp;<span class="op" id="3440403">==</span>&nbsp;<span class="builtintype" id="3440406">nil</span>&nbsp;<span class="op" id="3440410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440416">continuation</span>&nbsp;<span class="op" id="3440429">=</span>&nbsp;<span class="builtinfunc" id="3440431">make</span><span class="op" id="3440435">(</span><span class="keyword" id="3440436">map</span><span class="op" id="3440439">[</span><span class="builtintype" id="3440440">string</span><span class="op" id="3440446">]</span><span class="keyword" id="3440447">map</span><span class="op" id="3440450">[</span><span class="builtintype" id="3440451">string</span><span class="op" id="3440457">]</span><span class="builtintype" id="3440458">string</span><span class="op" id="3440464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440474">var</span>&nbsp;<span class="ident" id="3440478">ok</span>&nbsp;<span class="builtintype" id="3440481">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440489">if</span>&nbsp;<span class="ident" id="3440492">pmap</span><span class="op" id="3440496">,</span>&nbsp;<span class="ident" id="3440498">ok</span>&nbsp;<span class="op" id="3440501">=</span>&nbsp;<span class="ident" id="3440503">continuation</span><span class="op" id="3440515">[</span><span class="ident" id="3440516">baseName</span><span class="op" id="3440524">]</span><span class="op" id="3440525">;</span>&nbsp;<span class="op" id="3440527">!</span><span class="ident" id="3440528">ok</span>&nbsp;<span class="op" id="3440531">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440537">continuation</span><span class="op" id="3440549">[</span><span class="ident" id="3440550">baseName</span><span class="op" id="3440558">]</span>&nbsp;<span class="op" id="3440560">=</span>&nbsp;<span class="builtinfunc" id="3440562">make</span><span class="op" id="3440566">(</span><span class="keyword" id="3440567">map</span><span class="op" id="3440570">[</span><span class="builtintype" id="3440571">string</span><span class="op" id="3440577">]</span><span class="builtintype" id="3440578">string</span><span class="op" id="3440584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440590">pmap</span>&nbsp;<span class="op" id="3440595">=</span>&nbsp;<span class="ident" id="3440597">continuation</span><span class="op" id="3440609">[</span><span class="ident" id="3440610">baseName</span><span class="op" id="3440618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440631">if</span>&nbsp;<span class="ident" id="3440634">_</span><span class="op" id="3440635">,</span>&nbsp;<span class="ident" id="3440637">exists</span>&nbsp;<span class="op" id="3440644">:=</span>&nbsp;<span class="ident" id="3440647">pmap</span><span class="op" id="3440651">[</span><span class="ident" id="3440652">key</span><span class="op" id="3440655">]</span><span class="op" id="3440656">;</span>&nbsp;<span class="ident" id="3440658">exists</span>&nbsp;<span class="op" id="3440665">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440670">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440711">return</span>&nbsp;<span class="string" id="3440718">&#34;&#34;</span><span class="op" id="3440720">,</span>&nbsp;<span class="builtintype" id="3440722">nil</span><span class="op" id="3440725">,</span>&nbsp;<span class="ident" id="3440727">errors</span><span class="op" id="3440733">.</span><span class="ident" id="3440734">New</span><span class="op" id="3440737">(</span><span class="string" id="3440738">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="3440770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440778">pmap</span><span class="op" id="3440782">[</span><span class="ident" id="3440783">key</span><span class="op" id="3440786">]</span>&nbsp;<span class="op" id="3440788">=</span>&nbsp;<span class="ident" id="3440790">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440798">v</span>&nbsp;<span class="op" id="3440800">=</span>&nbsp;<span class="ident" id="3440802">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440812">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3440871">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440928">var</span>&nbsp;<span class="ident" id="3440932">buf</span>&nbsp;<span class="ident" id="3440936">bytes</span><span class="op" id="3440941">.</span><span class="ident" id="3440942">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440950">for</span>&nbsp;<span class="ident" id="3440954">key</span><span class="op" id="3440957">,</span>&nbsp;<span class="ident" id="3440959">pieceMap</span>&nbsp;<span class="op" id="3440968">:=</span>&nbsp;<span class="keyword" id="3440971">range</span>&nbsp;<span class="ident" id="3440977">continuation</span>&nbsp;<span class="op" id="3440990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440994">singlePartKey</span>&nbsp;<span class="op" id="3441008">:=</span>&nbsp;<span class="ident" id="3441011">key</span>&nbsp;<span class="op" id="3441015">+</span>&nbsp;<span class="string" id="3441017">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441023">if</span>&nbsp;<span class="ident" id="3441026">v</span><span class="op" id="3441027">,</span>&nbsp;<span class="ident" id="3441029">ok</span>&nbsp;<span class="op" id="3441032">:=</span>&nbsp;<span class="ident" id="3441035">pieceMap</span><span class="op" id="3441043">[</span><span class="ident" id="3441044">singlePartKey</span><span class="op" id="3441057">]</span><span class="op" id="3441058">;</span>&nbsp;<span class="ident" id="3441060">ok</span>&nbsp;<span class="op" id="3441063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441068">decv</span>&nbsp;<span class="op" id="3441073">:=</span>&nbsp;<span class="ident" id="3441076">decode2231Enc</span><span class="op" id="3441089">(</span><span class="ident" id="3441090">v</span><span class="op" id="3441091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441096">params</span><span class="op" id="3441102">[</span><span class="ident" id="3441103">key</span><span class="op" id="3441106">]</span>&nbsp;<span class="op" id="3441108">=</span>&nbsp;<span class="ident" id="3441110">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441118">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441134">buf</span><span class="op" id="3441137">.</span><span class="ident" id="3441138">Reset</span><span class="op" id="3441143">(</span><span class="op" id="3441144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441148">valid</span>&nbsp;<span class="op" id="3441154">:=</span>&nbsp;<span class="builtintype" id="3441157">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441165">for</span>&nbsp;<span class="ident" id="3441169">n</span>&nbsp;<span class="op" id="3441171">:=</span>&nbsp;<span class="num" id="3441174">0</span><span class="op" id="3441175">;</span>&nbsp;<span class="op" id="3441177">;</span>&nbsp;<span class="ident" id="3441179">n</span><span class="op" id="3441180">++</span>&nbsp;<span class="op" id="3441183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441188">simplePart</span>&nbsp;<span class="op" id="3441199">:=</span>&nbsp;<span class="ident" id="3441202">fmt</span><span class="op" id="3441205">.</span><span class="ident" id="3441206">Sprintf</span><span class="op" id="3441213">(</span><span class="string" id="3441214">&#34;%s*%d&#34;</span><span class="op" id="3441221">,</span>&nbsp;<span class="ident" id="3441223">key</span><span class="op" id="3441226">,</span>&nbsp;<span class="ident" id="3441228">n</span><span class="op" id="3441229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441234">if</span>&nbsp;<span class="ident" id="3441237">v</span><span class="op" id="3441238">,</span>&nbsp;<span class="ident" id="3441240">ok</span>&nbsp;<span class="op" id="3441243">:=</span>&nbsp;<span class="ident" id="3441246">pieceMap</span><span class="op" id="3441254">[</span><span class="ident" id="3441255">simplePart</span><span class="op" id="3441265">]</span><span class="op" id="3441266">;</span>&nbsp;<span class="ident" id="3441268">ok</span>&nbsp;<span class="op" id="3441271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441277">valid</span>&nbsp;<span class="op" id="3441283">=</span>&nbsp;<span class="builtintype" id="3441285">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441294">buf</span><span class="op" id="3441297">.</span><span class="ident" id="3441298">WriteString</span><span class="op" id="3441309">(</span><span class="ident" id="3441310">v</span><span class="op" id="3441311">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441317">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441334">encodedPart</span>&nbsp;<span class="op" id="3441346">:=</span>&nbsp;<span class="ident" id="3441349">simplePart</span>&nbsp;<span class="op" id="3441360">+</span>&nbsp;<span class="string" id="3441362">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441369">if</span>&nbsp;<span class="ident" id="3441372">v</span><span class="op" id="3441373">,</span>&nbsp;<span class="ident" id="3441375">ok</span>&nbsp;<span class="op" id="3441378">:=</span>&nbsp;<span class="ident" id="3441381">pieceMap</span><span class="op" id="3441389">[</span><span class="ident" id="3441390">encodedPart</span><span class="op" id="3441401">]</span><span class="op" id="3441402">;</span>&nbsp;<span class="ident" id="3441404">ok</span>&nbsp;<span class="op" id="3441407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441413">valid</span>&nbsp;<span class="op" id="3441419">=</span>&nbsp;<span class="builtintype" id="3441421">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441430">if</span>&nbsp;<span class="ident" id="3441433">n</span>&nbsp;<span class="op" id="3441435">==</span>&nbsp;<span class="num" id="3441438">0</span>&nbsp;<span class="op" id="3441440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441447">buf</span><span class="op" id="3441450">.</span><span class="ident" id="3441451">WriteString</span><span class="op" id="3441462">(</span><span class="ident" id="3441463">decode2231Enc</span><span class="op" id="3441476">(</span><span class="ident" id="3441477">v</span><span class="op" id="3441478">)</span><span class="op" id="3441479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441485">}</span>&nbsp;<span class="keyword" id="3441487">else</span>&nbsp;<span class="op" id="3441492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441499">decv</span><span class="op" id="3441503">,</span>&nbsp;<span class="ident" id="3441505">_</span>&nbsp;<span class="op" id="3441507">:=</span>&nbsp;<span class="ident" id="3441510">percentHexUnescape</span><span class="op" id="3441528">(</span><span class="ident" id="3441529">v</span><span class="op" id="3441530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441537">buf</span><span class="op" id="3441540">.</span><span class="ident" id="3441541">WriteString</span><span class="op" id="3441552">(</span><span class="ident" id="3441553">decv</span><span class="op" id="3441557">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441568">}</span>&nbsp;<span class="keyword" id="3441570">else</span>&nbsp;<span class="op" id="3441575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441581">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441594">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441598">if</span>&nbsp;<span class="ident" id="3441601">valid</span>&nbsp;<span class="op" id="3441607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441612">params</span><span class="op" id="3441618">[</span><span class="ident" id="3441619">key</span><span class="op" id="3441622">]</span>&nbsp;<span class="op" id="3441624">=</span>&nbsp;<span class="ident" id="3441626">buf</span><span class="op" id="3441629">.</span><span class="ident" id="3441630">String</span><span class="op" id="3441636">(</span><span class="op" id="3441637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441648">return</span><br>
<span class="lineno"></span><span class="op" id="3441655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3441658">func</span>&nbsp;<span class="ident" id="3441663">decode2231Enc</span><span class="op" id="3441676">(</span><span class="ident" id="3441677">v</span>&nbsp;<span class="builtintype" id="3441679">string</span><span class="op" id="3441685">)</span>&nbsp;<span class="builtintype" id="3441687">string</span>&nbsp;<span class="op" id="3441694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441697">sv</span>&nbsp;<span class="op" id="3441700">:=</span>&nbsp;<span class="ident" id="3441703">strings</span><span class="op" id="3441710">.</span><span class="ident" id="3441711">SplitN</span><span class="op" id="3441717">(</span><span class="ident" id="3441718">v</span><span class="op" id="3441719">,</span>&nbsp;<span class="string" id="3441721">&#34;&#39;&#34;</span><span class="op" id="3441724">,</span>&nbsp;<span class="num" id="3441726">3</span><span class="op" id="3441727">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441730">if</span>&nbsp;<span class="builtinfunc" id="3441733">len</span><span class="op" id="3441736">(</span><span class="ident" id="3441737">sv</span><span class="op" id="3441739">)</span>&nbsp;<span class="op" id="3441741">!=</span>&nbsp;<span class="num" id="3441744">3</span>&nbsp;<span class="op" id="3441746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441750">return</span>&nbsp;<span class="string" id="3441757">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441764">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441832">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441897">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441930">charset</span>&nbsp;<span class="op" id="3441938">:=</span>&nbsp;<span class="ident" id="3441941">strings</span><span class="op" id="3441948">.</span><span class="ident" id="3441949">ToLower</span><span class="op" id="3441956">(</span><span class="ident" id="3441957">sv</span><span class="op" id="3441959">[</span><span class="num" id="3441960">0</span><span class="op" id="3441961">]</span><span class="op" id="3441962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441965">if</span>&nbsp;<span class="ident" id="3441968">charset</span>&nbsp;<span class="op" id="3441976">!=</span>&nbsp;<span class="string" id="3441979">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="3441990">&amp;&amp;</span>&nbsp;<span class="ident" id="3441993">charset</span>&nbsp;<span class="op" id="3442001">!=</span>&nbsp;<span class="string" id="3442004">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="3442012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3442016">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442048">return</span>&nbsp;<span class="string" id="3442055">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442062">encv</span><span class="op" id="3442066">,</span>&nbsp;<span class="ident" id="3442068">_</span>&nbsp;<span class="op" id="3442070">:=</span>&nbsp;<span class="ident" id="3442073">percentHexUnescape</span><span class="op" id="3442091">(</span><span class="ident" id="3442092">sv</span><span class="op" id="3442094">[</span><span class="num" id="3442095">2</span><span class="op" id="3442096">]</span><span class="op" id="3442097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442100">return</span>&nbsp;<span class="ident" id="3442107">encv</span><br>
<span class="lineno"></span><span class="op" id="3442112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3442115">func</span>&nbsp;<span class="ident" id="3442120">isNotTokenChar</span><span class="op" id="3442134">(</span><span class="ident" id="3442135">r</span>&nbsp;<span class="builtintype" id="3442137">rune</span><span class="op" id="3442141">)</span>&nbsp;<span class="builtintype" id="3442143">bool</span>&nbsp;<span class="op" id="3442148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442151">return</span>&nbsp;<span class="op" id="3442158">!</span><span class="ident" id="3442159">isTokenChar</span><span class="op" id="3442170">(</span><span class="ident" id="3442171">r</span><span class="op" id="3442172">)</span><br>
<span class="lineno"></span><span class="op" id="3442174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3442177">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="3442241">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3442312">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3442382">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="3442428">func</span>&nbsp;<span class="ident" id="3442433">consumeToken</span><span class="op" id="3442445">(</span><span class="ident" id="3442446">v</span>&nbsp;<span class="builtintype" id="3442448">string</span><span class="op" id="3442454">)</span>&nbsp;<span class="op" id="3442456">(</span><span class="ident" id="3442457">token</span><span class="op" id="3442462">,</span>&nbsp;<span class="ident" id="3442464">rest</span>&nbsp;<span class="builtintype" id="3442469">string</span><span class="op" id="3442475">)</span>&nbsp;<span class="op" id="3442477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442480">notPos</span>&nbsp;<span class="op" id="3442487">:=</span>&nbsp;<span class="ident" id="3442490">strings</span><span class="op" id="3442497">.</span><span class="ident" id="3442498">IndexFunc</span><span class="op" id="3442507">(</span><span class="ident" id="3442508">v</span><span class="op" id="3442509">,</span>&nbsp;<span class="ident" id="3442511">isNotTokenChar</span><span class="op" id="3442525">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442528">if</span>&nbsp;<span class="ident" id="3442531">notPos</span>&nbsp;<span class="op" id="3442538">==</span>&nbsp;<span class="op" id="3442541">-</span><span class="num" id="3442542">1</span>&nbsp;<span class="op" id="3442544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442548">return</span>&nbsp;<span class="ident" id="3442555">v</span><span class="op" id="3442556">,</span>&nbsp;<span class="string" id="3442558">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442565">if</span>&nbsp;<span class="ident" id="3442568">notPos</span>&nbsp;<span class="op" id="3442575">==</span>&nbsp;<span class="num" id="3442578">0</span>&nbsp;<span class="op" id="3442580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442584">return</span>&nbsp;<span class="string" id="3442591">&#34;&#34;</span><span class="op" id="3442593">,</span>&nbsp;<span class="ident" id="3442595">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442601">return</span>&nbsp;<span class="ident" id="3442608">v</span><span class="op" id="3442609">[</span><span class="num" id="3442610">0</span><span class="op" id="3442611">:</span><span class="ident" id="3442612">notPos</span><span class="op" id="3442618">]</span><span class="op" id="3442619">,</span>&nbsp;<span class="ident" id="3442621">v</span><span class="op" id="3442622">[</span><span class="ident" id="3442623">notPos</span><span class="op" id="3442629">:</span><span class="op" id="3442630">]</span><br>
<span class="lineno"></span><span class="op" id="3442632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3442635">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="3442701">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="3442769">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3442828">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3442895">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="3442907">func</span>&nbsp;<span class="ident" id="3442912">consumeValue</span><span class="op" id="3442924">(</span><span class="ident" id="3442925">v</span>&nbsp;<span class="builtintype" id="3442927">string</span><span class="op" id="3442933">)</span>&nbsp;<span class="op" id="3442935">(</span><span class="ident" id="3442936">value</span><span class="op" id="3442941">,</span>&nbsp;<span class="ident" id="3442943">rest</span>&nbsp;<span class="builtintype" id="3442948">string</span><span class="op" id="3442954">)</span>&nbsp;<span class="op" id="3442956">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442959">if</span>&nbsp;<span class="op" id="3442962">!</span><span class="ident" id="3442963">strings</span><span class="op" id="3442970">.</span><span class="ident" id="3442971">HasPrefix</span><span class="op" id="3442980">(</span><span class="ident" id="3442981">v</span><span class="op" id="3442982">,</span>&nbsp;<span class="string" id="3442984">`&#34;`</span><span class="op" id="3442987">)</span>&nbsp;<span class="op" id="3442989">&amp;&amp;</span>&nbsp;<span class="op" id="3442992">!</span><span class="ident" id="3442993">strings</span><span class="op" id="3443000">.</span><span class="ident" id="3443001">HasPrefix</span><span class="op" id="3443010">(</span><span class="ident" id="3443011">v</span><span class="op" id="3443012">,</span>&nbsp;<span class="string" id="3443014">`&#39;`</span><span class="op" id="3443017">)</span>&nbsp;<span class="op" id="3443019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443023">return</span>&nbsp;<span class="ident" id="3443030">consumeToken</span><span class="op" id="3443042">(</span><span class="ident" id="3443043">v</span><span class="op" id="3443044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443051">leadQuote</span>&nbsp;<span class="op" id="3443061">:=</span>&nbsp;<span class="builtintype" id="3443064">rune</span><span class="op" id="3443068">(</span><span class="ident" id="3443069">v</span><span class="op" id="3443070">[</span><span class="num" id="3443071">0</span><span class="op" id="3443072">]</span><span class="op" id="3443073">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3443077">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443103">rest</span>&nbsp;<span class="op" id="3443108">=</span>&nbsp;<span class="ident" id="3443110">v</span><span class="op" id="3443111">[</span><span class="num" id="3443112">1</span><span class="op" id="3443113">:</span><span class="op" id="3443114">]</span>&nbsp;<span class="comment" id="3443116">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443146">buffer</span>&nbsp;<span class="op" id="3443153">:=</span>&nbsp;<span class="builtinfunc" id="3443156">new</span><span class="op" id="3443159">(</span><span class="ident" id="3443160">bytes</span><span class="op" id="3443165">.</span><span class="ident" id="3443166">Buffer</span><span class="op" id="3443172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443175">var</span>&nbsp;<span class="ident" id="3443179">idx</span>&nbsp;<span class="builtintype" id="3443183">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443188">var</span>&nbsp;<span class="ident" id="3443192">r</span>&nbsp;<span class="builtintype" id="3443194">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443200">var</span>&nbsp;<span class="ident" id="3443204">nextIsLiteral</span>&nbsp;<span class="builtintype" id="3443218">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443224">for</span>&nbsp;<span class="ident" id="3443228">idx</span><span class="op" id="3443231">,</span>&nbsp;<span class="ident" id="3443233">r</span>&nbsp;<span class="op" id="3443235">=</span>&nbsp;<span class="keyword" id="3443237">range</span>&nbsp;<span class="ident" id="3443243">rest</span>&nbsp;<span class="op" id="3443248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443252">switch</span>&nbsp;<span class="op" id="3443259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443263">case</span>&nbsp;<span class="ident" id="3443268">nextIsLiteral</span><span class="op" id="3443281">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443286">buffer</span><span class="op" id="3443292">.</span><span class="ident" id="3443293">WriteRune</span><span class="op" id="3443302">(</span><span class="ident" id="3443303">r</span><span class="op" id="3443304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443309">nextIsLiteral</span>&nbsp;<span class="op" id="3443323">=</span>&nbsp;<span class="builtintype" id="3443325">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443333">case</span>&nbsp;<span class="ident" id="3443338">r</span>&nbsp;<span class="op" id="3443340">==</span>&nbsp;<span class="ident" id="3443343">leadQuote</span><span class="op" id="3443352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443357">return</span>&nbsp;<span class="ident" id="3443364">buffer</span><span class="op" id="3443370">.</span><span class="ident" id="3443371">String</span><span class="op" id="3443377">(</span><span class="op" id="3443378">)</span><span class="op" id="3443379">,</span>&nbsp;<span class="ident" id="3443381">rest</span><span class="op" id="3443385">[</span><span class="ident" id="3443386">idx</span><span class="op" id="3443389">+</span><span class="num" id="3443390">1</span><span class="op" id="3443391">:</span><span class="op" id="3443392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443396">case</span>&nbsp;<span class="ident" id="3443401">r</span>&nbsp;<span class="op" id="3443403">==</span>&nbsp;<span class="string" id="3443406">&#39;\\&#39;</span><span class="op" id="3443410">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443415">nextIsLiteral</span>&nbsp;<span class="op" id="3443429">=</span>&nbsp;<span class="builtintype" id="3443431">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443438">case</span>&nbsp;<span class="ident" id="3443443">r</span>&nbsp;<span class="op" id="3443445">!=</span>&nbsp;<span class="string" id="3443448">&#39;\r&#39;</span>&nbsp;<span class="op" id="3443453">&amp;&amp;</span>&nbsp;<span class="ident" id="3443456">r</span>&nbsp;<span class="op" id="3443458">!=</span>&nbsp;<span class="string" id="3443461">&#39;\n&#39;</span><span class="op" id="3443465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443470">buffer</span><span class="op" id="3443476">.</span><span class="ident" id="3443477">WriteRune</span><span class="op" id="3443486">(</span><span class="ident" id="3443487">r</span><span class="op" id="3443488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443492">default</span><span class="op" id="3443499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443504">return</span>&nbsp;<span class="string" id="3443511">&#34;&#34;</span><span class="op" id="3443513">,</span>&nbsp;<span class="ident" id="3443515">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443525">return</span>&nbsp;<span class="string" id="3443532">&#34;&#34;</span><span class="op" id="3443534">,</span>&nbsp;<span class="ident" id="3443536">v</span><br>
<span class="lineno"></span><span class="op" id="3443538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="3443541">func</span>&nbsp;<span class="ident" id="3443546">consumeMediaParam</span><span class="op" id="3443563">(</span><span class="ident" id="3443564">v</span>&nbsp;<span class="builtintype" id="3443566">string</span><span class="op" id="3443572">)</span>&nbsp;<span class="op" id="3443574">(</span><span class="ident" id="3443575">param</span><span class="op" id="3443580">,</span>&nbsp;<span class="ident" id="3443582">value</span><span class="op" id="3443587">,</span>&nbsp;<span class="ident" id="3443589">rest</span>&nbsp;<span class="builtintype" id="3443594">string</span><span class="op" id="3443600">)</span>&nbsp;<span class="op" id="3443602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443605">rest</span>&nbsp;<span class="op" id="3443610">=</span>&nbsp;<span class="ident" id="3443612">strings</span><span class="op" id="3443619">.</span><span class="ident" id="3443620">TrimLeftFunc</span><span class="op" id="3443632">(</span><span class="ident" id="3443633">v</span><span class="op" id="3443634">,</span>&nbsp;<span class="ident" id="3443636">unicode</span><span class="op" id="3443643">.</span><span class="ident" id="3443644">IsSpace</span><span class="op" id="3443651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443654">if</span>&nbsp;<span class="op" id="3443657">!</span><span class="ident" id="3443658">strings</span><span class="op" id="3443665">.</span><span class="ident" id="3443666">HasPrefix</span><span class="op" id="3443675">(</span><span class="ident" id="3443676">rest</span><span class="op" id="3443680">,</span>&nbsp;<span class="string" id="3443682">&#34;;&#34;</span><span class="op" id="3443685">)</span>&nbsp;<span class="op" id="3443687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443691">return</span>&nbsp;<span class="string" id="3443698">&#34;&#34;</span><span class="op" id="3443700">,</span>&nbsp;<span class="string" id="3443702">&#34;&#34;</span><span class="op" id="3443704">,</span>&nbsp;<span class="ident" id="3443706">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443709">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443713">rest</span>&nbsp;<span class="op" id="3443718">=</span>&nbsp;<span class="ident" id="3443720">rest</span><span class="op" id="3443724">[</span><span class="num" id="3443725">1</span><span class="op" id="3443726">:</span><span class="op" id="3443727">]</span>&nbsp;<span class="comment" id="3443729">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443751">rest</span>&nbsp;<span class="op" id="3443756">=</span>&nbsp;<span class="ident" id="3443758">strings</span><span class="op" id="3443765">.</span><span class="ident" id="3443766">TrimLeftFunc</span><span class="op" id="3443778">(</span><span class="ident" id="3443779">rest</span><span class="op" id="3443783">,</span>&nbsp;<span class="ident" id="3443785">unicode</span><span class="op" id="3443792">.</span><span class="ident" id="3443793">IsSpace</span><span class="op" id="3443800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443803">param</span><span class="op" id="3443808">,</span>&nbsp;<span class="ident" id="3443810">rest</span>&nbsp;<span class="op" id="3443815">=</span>&nbsp;<span class="ident" id="3443817">consumeToken</span><span class="op" id="3443829">(</span><span class="ident" id="3443830">rest</span><span class="op" id="3443834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443837">param</span>&nbsp;<span class="op" id="3443843">=</span>&nbsp;<span class="ident" id="3443845">strings</span><span class="op" id="3443852">.</span><span class="ident" id="3443853">ToLower</span><span class="op" id="3443860">(</span><span class="ident" id="3443861">param</span><span class="op" id="3443866">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443869">if</span>&nbsp;<span class="ident" id="3443872">param</span>&nbsp;<span class="op" id="3443878">==</span>&nbsp;<span class="string" id="3443881">&#34;&#34;</span>&nbsp;<span class="op" id="3443884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443888">return</span>&nbsp;<span class="string" id="3443895">&#34;&#34;</span><span class="op" id="3443897">,</span>&nbsp;<span class="string" id="3443899">&#34;&#34;</span><span class="op" id="3443901">,</span>&nbsp;<span class="ident" id="3443903">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443910">rest</span>&nbsp;<span class="op" id="3443915">=</span>&nbsp;<span class="ident" id="3443917">strings</span><span class="op" id="3443924">.</span><span class="ident" id="3443925">TrimLeftFunc</span><span class="op" id="3443937">(</span><span class="ident" id="3443938">rest</span><span class="op" id="3443942">,</span>&nbsp;<span class="ident" id="3443944">unicode</span><span class="op" id="3443951">.</span><span class="ident" id="3443952">IsSpace</span><span class="op" id="3443959">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443962">if</span>&nbsp;<span class="op" id="3443965">!</span><span class="ident" id="3443966">strings</span><span class="op" id="3443973">.</span><span class="ident" id="3443974">HasPrefix</span><span class="op" id="3443983">(</span><span class="ident" id="3443984">rest</span><span class="op" id="3443988">,</span>&nbsp;<span class="string" id="3443990">&#34;=&#34;</span><span class="op" id="3443993">)</span>&nbsp;<span class="op" id="3443995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443999">return</span>&nbsp;<span class="string" id="3444006">&#34;&#34;</span><span class="op" id="3444008">,</span>&nbsp;<span class="string" id="3444010">&#34;&#34;</span><span class="op" id="3444012">,</span>&nbsp;<span class="ident" id="3444014">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444020">rest</span>&nbsp;<span class="op" id="3444025">=</span>&nbsp;<span class="ident" id="3444027">rest</span><span class="op" id="3444031">[</span><span class="num" id="3444032">1</span><span class="op" id="3444033">:</span><span class="op" id="3444034">]</span>&nbsp;<span class="comment" id="3444036">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444060">rest</span>&nbsp;<span class="op" id="3444065">=</span>&nbsp;<span class="ident" id="3444067">strings</span><span class="op" id="3444074">.</span><span class="ident" id="3444075">TrimLeftFunc</span><span class="op" id="3444087">(</span><span class="ident" id="3444088">rest</span><span class="op" id="3444092">,</span>&nbsp;<span class="ident" id="3444094">unicode</span><span class="op" id="3444101">.</span><span class="ident" id="3444102">IsSpace</span><span class="op" id="3444109">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444112">value</span><span class="op" id="3444117">,</span>&nbsp;<span class="ident" id="3444119">rest</span>&nbsp;<span class="op" id="3444124">=</span>&nbsp;<span class="ident" id="3444126">consumeValue</span><span class="op" id="3444138">(</span><span class="ident" id="3444139">rest</span><span class="op" id="3444143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444146">if</span>&nbsp;<span class="ident" id="3444149">value</span>&nbsp;<span class="op" id="3444155">==</span>&nbsp;<span class="string" id="3444158">&#34;&#34;</span>&nbsp;<span class="op" id="3444161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444165">return</span>&nbsp;<span class="string" id="3444172">&#34;&#34;</span><span class="op" id="3444174">,</span>&nbsp;<span class="string" id="3444176">&#34;&#34;</span><span class="op" id="3444178">,</span>&nbsp;<span class="ident" id="3444180">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444186">return</span>&nbsp;<span class="ident" id="3444193">param</span><span class="op" id="3444198">,</span>&nbsp;<span class="ident" id="3444200">value</span><span class="op" id="3444205">,</span>&nbsp;<span class="ident" id="3444207">rest</span><br>
<span class="lineno">295</span><span class="op" id="3444212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3444215">func</span>&nbsp;<span class="ident" id="3444220">percentHexUnescape</span><span class="op" id="3444238">(</span><span class="ident" id="3444239">s</span>&nbsp;<span class="builtintype" id="3444241">string</span><span class="op" id="3444247">)</span>&nbsp;<span class="op" id="3444249">(</span><span class="builtintype" id="3444250">string</span><span class="op" id="3444256">,</span>&nbsp;<span class="builtintype" id="3444258">error</span><span class="op" id="3444263">)</span>&nbsp;<span class="op" id="3444265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3444268">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444313">percents</span>&nbsp;<span class="op" id="3444322">:=</span>&nbsp;<span class="num" id="3444325">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444328">for</span>&nbsp;<span class="ident" id="3444332">i</span>&nbsp;<span class="op" id="3444334">:=</span>&nbsp;<span class="num" id="3444337">0</span><span class="op" id="3444338">;</span>&nbsp;<span class="ident" id="3444340">i</span>&nbsp;<span class="op" id="3444342">&lt;</span>&nbsp;<span class="builtinfunc" id="3444344">len</span><span class="op" id="3444347">(</span><span class="ident" id="3444348">s</span><span class="op" id="3444349">)</span><span class="op" id="3444350">;</span>&nbsp;<span class="op" id="3444352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444356">if</span>&nbsp;<span class="ident" id="3444359">s</span><span class="op" id="3444360">[</span><span class="ident" id="3444361">i</span><span class="op" id="3444362">]</span>&nbsp;<span class="op" id="3444364">!=</span>&nbsp;<span class="string" id="3444367">&#39;%&#39;</span>&nbsp;<span class="op" id="3444371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444376">i</span><span class="op" id="3444377">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444383">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444394">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444398">percents</span><span class="op" id="3444406">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444411">if</span>&nbsp;<span class="ident" id="3444414">i</span><span class="op" id="3444415">+</span><span class="num" id="3444416">2</span>&nbsp;<span class="op" id="3444418">&gt;=</span>&nbsp;<span class="builtinfunc" id="3444421">len</span><span class="op" id="3444424">(</span><span class="ident" id="3444425">s</span><span class="op" id="3444426">)</span>&nbsp;<span class="op" id="3444428">||</span>&nbsp;<span class="op" id="3444431">!</span><span class="ident" id="3444432">ishex</span><span class="op" id="3444437">(</span><span class="ident" id="3444438">s</span><span class="op" id="3444439">[</span><span class="ident" id="3444440">i</span><span class="op" id="3444441">+</span><span class="num" id="3444442">1</span><span class="op" id="3444443">]</span><span class="op" id="3444444">)</span>&nbsp;<span class="op" id="3444446">||</span>&nbsp;<span class="op" id="3444449">!</span><span class="ident" id="3444450">ishex</span><span class="op" id="3444455">(</span><span class="ident" id="3444456">s</span><span class="op" id="3444457">[</span><span class="ident" id="3444458">i</span><span class="op" id="3444459">+</span><span class="num" id="3444460">2</span><span class="op" id="3444461">]</span><span class="op" id="3444462">)</span>&nbsp;<span class="op" id="3444464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444469">s</span>&nbsp;<span class="op" id="3444471">=</span>&nbsp;<span class="ident" id="3444473">s</span><span class="op" id="3444474">[</span><span class="ident" id="3444475">i</span><span class="op" id="3444476">:</span><span class="op" id="3444477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444482">if</span>&nbsp;<span class="builtinfunc" id="3444485">len</span><span class="op" id="3444488">(</span><span class="ident" id="3444489">s</span><span class="op" id="3444490">)</span>&nbsp;<span class="op" id="3444492">&gt;</span>&nbsp;<span class="num" id="3444494">3</span>&nbsp;<span class="op" id="3444496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444502">s</span>&nbsp;<span class="op" id="3444504">=</span>&nbsp;<span class="ident" id="3444506">s</span><span class="op" id="3444507">[</span><span class="num" id="3444508">0</span><span class="op" id="3444509">:</span><span class="num" id="3444510">3</span><span class="op" id="3444511">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444521">return</span>&nbsp;<span class="string" id="3444528">&#34;&#34;</span><span class="op" id="3444530">,</span>&nbsp;<span class="ident" id="3444532">fmt</span><span class="op" id="3444535">.</span><span class="ident" id="3444536">Errorf</span><span class="op" id="3444542">(</span><span class="string" id="3444543">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="3444580">,</span>&nbsp;<span class="ident" id="3444582">s</span><span class="op" id="3444583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444591">i</span>&nbsp;<span class="op" id="3444593">+=</span>&nbsp;<span class="num" id="3444596">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444599">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444602">if</span>&nbsp;<span class="ident" id="3444605">percents</span>&nbsp;<span class="op" id="3444614">==</span>&nbsp;<span class="num" id="3444617">0</span>&nbsp;<span class="op" id="3444619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444623">return</span>&nbsp;<span class="ident" id="3444630">s</span><span class="op" id="3444631">,</span>&nbsp;<span class="builtintype" id="3444633">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444642">t</span>&nbsp;<span class="op" id="3444644">:=</span>&nbsp;<span class="builtinfunc" id="3444647">make</span><span class="op" id="3444651">(</span><span class="op" id="3444652">[</span><span class="op" id="3444653">]</span><span class="builtintype" id="3444654">byte</span><span class="op" id="3444658">,</span>&nbsp;<span class="builtinfunc" id="3444660">len</span><span class="op" id="3444663">(</span><span class="ident" id="3444664">s</span><span class="op" id="3444665">)</span><span class="op" id="3444666">-</span><span class="num" id="3444667">2</span><span class="op" id="3444668">*</span><span class="ident" id="3444669">percents</span><span class="op" id="3444677">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444680">j</span>&nbsp;<span class="op" id="3444682">:=</span>&nbsp;<span class="num" id="3444685">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444688">for</span>&nbsp;<span class="ident" id="3444692">i</span>&nbsp;<span class="op" id="3444694">:=</span>&nbsp;<span class="num" id="3444697">0</span><span class="op" id="3444698">;</span>&nbsp;<span class="ident" id="3444700">i</span>&nbsp;<span class="op" id="3444702">&lt;</span>&nbsp;<span class="builtinfunc" id="3444704">len</span><span class="op" id="3444707">(</span><span class="ident" id="3444708">s</span><span class="op" id="3444709">)</span><span class="op" id="3444710">;</span>&nbsp;<span class="op" id="3444712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444716">switch</span>&nbsp;<span class="ident" id="3444723">s</span><span class="op" id="3444724">[</span><span class="ident" id="3444725">i</span><span class="op" id="3444726">]</span>&nbsp;<span class="op" id="3444728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444732">case</span>&nbsp;<span class="string" id="3444737">&#39;%&#39;</span><span class="op" id="3444740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444745">t</span><span class="op" id="3444746">[</span><span class="ident" id="3444747">j</span><span class="op" id="3444748">]</span>&nbsp;<span class="op" id="3444750">=</span>&nbsp;<span class="ident" id="3444752">unhex</span><span class="op" id="3444757">(</span><span class="ident" id="3444758">s</span><span class="op" id="3444759">[</span><span class="ident" id="3444760">i</span><span class="op" id="3444761">+</span><span class="num" id="3444762">1</span><span class="op" id="3444763">]</span><span class="op" id="3444764">)</span><span class="op" id="3444765">&lt;&lt;</span><span class="num" id="3444767">4</span>&nbsp;<span class="op" id="3444769">|</span>&nbsp;<span class="ident" id="3444771">unhex</span><span class="op" id="3444776">(</span><span class="ident" id="3444777">s</span><span class="op" id="3444778">[</span><span class="ident" id="3444779">i</span><span class="op" id="3444780">+</span><span class="num" id="3444781">2</span><span class="op" id="3444782">]</span><span class="op" id="3444783">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444788">j</span><span class="op" id="3444789">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444795">i</span>&nbsp;<span class="op" id="3444797">+=</span>&nbsp;<span class="num" id="3444800">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444804">default</span><span class="op" id="3444811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444816">t</span><span class="op" id="3444817">[</span><span class="ident" id="3444818">j</span><span class="op" id="3444819">]</span>&nbsp;<span class="op" id="3444821">=</span>&nbsp;<span class="ident" id="3444823">s</span><span class="op" id="3444824">[</span><span class="ident" id="3444825">i</span><span class="op" id="3444826">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444831">j</span><span class="op" id="3444832">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444838">i</span><span class="op" id="3444839">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3444847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444850">return</span>&nbsp;<span class="builtintype" id="3444857">string</span><span class="op" id="3444863">(</span><span class="ident" id="3444864">t</span><span class="op" id="3444865">)</span><span class="op" id="3444866">,</span>&nbsp;<span class="builtintype" id="3444868">nil</span><br>
<span class="lineno"></span><span class="op" id="3444872">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="3444875">func</span>&nbsp;<span class="ident" id="3444880">ishex</span><span class="op" id="3444885">(</span><span class="ident" id="3444886">c</span>&nbsp;<span class="builtintype" id="3444888">byte</span><span class="op" id="3444892">)</span>&nbsp;<span class="builtintype" id="3444894">bool</span>&nbsp;<span class="op" id="3444899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444902">switch</span>&nbsp;<span class="op" id="3444909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444912">case</span>&nbsp;<span class="string" id="3444917">&#39;0&#39;</span>&nbsp;<span class="op" id="3444921">&lt;=</span>&nbsp;<span class="ident" id="3444924">c</span>&nbsp;<span class="op" id="3444926">&amp;&amp;</span>&nbsp;<span class="ident" id="3444929">c</span>&nbsp;<span class="op" id="3444931">&lt;=</span>&nbsp;<span class="string" id="3444934">&#39;9&#39;</span><span class="op" id="3444937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444941">return</span>&nbsp;<span class="builtintype" id="3444948">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444954">case</span>&nbsp;<span class="string" id="3444959">&#39;a&#39;</span>&nbsp;<span class="op" id="3444963">&lt;=</span>&nbsp;<span class="ident" id="3444966">c</span>&nbsp;<span class="op" id="3444968">&amp;&amp;</span>&nbsp;<span class="ident" id="3444971">c</span>&nbsp;<span class="op" id="3444973">&lt;=</span>&nbsp;<span class="string" id="3444976">&#39;f&#39;</span><span class="op" id="3444979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444983">return</span>&nbsp;<span class="builtintype" id="3444990">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444996">case</span>&nbsp;<span class="string" id="3445001">&#39;A&#39;</span>&nbsp;<span class="op" id="3445005">&lt;=</span>&nbsp;<span class="ident" id="3445008">c</span>&nbsp;<span class="op" id="3445010">&amp;&amp;</span>&nbsp;<span class="ident" id="3445013">c</span>&nbsp;<span class="op" id="3445015">&lt;=</span>&nbsp;<span class="string" id="3445018">&#39;F&#39;</span><span class="op" id="3445021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445025">return</span>&nbsp;<span class="builtintype" id="3445032">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445038">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445041">return</span>&nbsp;<span class="builtintype" id="3445048">false</span><br>
<span class="lineno"></span><span class="op" id="3445054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3445057">func</span>&nbsp;<span class="ident" id="3445062">unhex</span><span class="op" id="3445067">(</span><span class="ident" id="3445068">c</span>&nbsp;<span class="builtintype" id="3445070">byte</span><span class="op" id="3445074">)</span>&nbsp;<span class="builtintype" id="3445076">byte</span>&nbsp;<span class="op" id="3445081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445084">switch</span>&nbsp;<span class="op" id="3445091">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445094">case</span>&nbsp;<span class="string" id="3445099">&#39;0&#39;</span>&nbsp;<span class="op" id="3445103">&lt;=</span>&nbsp;<span class="ident" id="3445106">c</span>&nbsp;<span class="op" id="3445108">&amp;&amp;</span>&nbsp;<span class="ident" id="3445111">c</span>&nbsp;<span class="op" id="3445113">&lt;=</span>&nbsp;<span class="string" id="3445116">&#39;9&#39;</span><span class="op" id="3445119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445123">return</span>&nbsp;<span class="ident" id="3445130">c</span>&nbsp;<span class="op" id="3445132">-</span>&nbsp;<span class="string" id="3445134">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445139">case</span>&nbsp;<span class="string" id="3445144">&#39;a&#39;</span>&nbsp;<span class="op" id="3445148">&lt;=</span>&nbsp;<span class="ident" id="3445151">c</span>&nbsp;<span class="op" id="3445153">&amp;&amp;</span>&nbsp;<span class="ident" id="3445156">c</span>&nbsp;<span class="op" id="3445158">&lt;=</span>&nbsp;<span class="string" id="3445161">&#39;f&#39;</span><span class="op" id="3445164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445168">return</span>&nbsp;<span class="ident" id="3445175">c</span>&nbsp;<span class="op" id="3445177">-</span>&nbsp;<span class="string" id="3445179">&#39;a&#39;</span>&nbsp;<span class="op" id="3445183">+</span>&nbsp;<span class="num" id="3445185">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445189">case</span>&nbsp;<span class="string" id="3445194">&#39;A&#39;</span>&nbsp;<span class="op" id="3445198">&lt;=</span>&nbsp;<span class="ident" id="3445201">c</span>&nbsp;<span class="op" id="3445203">&amp;&amp;</span>&nbsp;<span class="ident" id="3445206">c</span>&nbsp;<span class="op" id="3445208">&lt;=</span>&nbsp;<span class="string" id="3445211">&#39;F&#39;</span><span class="op" id="3445214">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445218">return</span>&nbsp;<span class="ident" id="3445225">c</span>&nbsp;<span class="op" id="3445227">-</span>&nbsp;<span class="string" id="3445229">&#39;A&#39;</span>&nbsp;<span class="op" id="3445233">+</span>&nbsp;<span class="num" id="3445235">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445242">return</span>&nbsp;<span class="num" id="3445249">0</span><br>
<span class="lineno"></span><span class="op" id="3445251">}</span>
</div>
</body>
</html>
