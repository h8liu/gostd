<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3486925">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3486980">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3487034">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3487085">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="3487163">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3487238">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3487309">package</span>&nbsp;<span class="ident" id="3487317">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3487324">import</span>&nbsp;<span class="op" id="3487331">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3487334">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3487343">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3487353">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3487359">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3487374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3487377">const</span>&nbsp;<span class="op" id="3487383">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487386">defaultBufSize</span>&nbsp;<span class="op" id="3487401">=</span>&nbsp;<span class="num" id="3487403">4096</span><br>
<span class="lineno"></span><span class="op" id="3487408">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3487411">var</span>&nbsp;<span class="op" id="3487415">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487418">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="3487439">=</span>&nbsp;<span class="ident" id="3487441">errors</span><span class="op" id="3487447">.</span><span class="ident" id="3487448">New</span><span class="op" id="3487451">(</span><span class="string" id="3487452">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="3487486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487489">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="3487510">=</span>&nbsp;<span class="ident" id="3487512">errors</span><span class="op" id="3487518">.</span><span class="ident" id="3487519">New</span><span class="op" id="3487522">(</span><span class="string" id="3487523">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="3487557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487560">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487581">=</span>&nbsp;<span class="ident" id="3487583">errors</span><span class="op" id="3487589">.</span><span class="ident" id="3487590">New</span><span class="op" id="3487593">(</span><span class="string" id="3487594">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="3487614">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487617">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487638">=</span>&nbsp;<span class="ident" id="3487640">errors</span><span class="op" id="3487646">.</span><span class="ident" id="3487647">New</span><span class="op" id="3487650">(</span><span class="string" id="3487651">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="3487674">)</span><br>
<span class="lineno"></span><span class="op" id="3487676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3487679">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3487699">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="3487755">type</span>&nbsp;<span class="ident" id="3487760">Reader</span>&nbsp;<span class="keyword" id="3487767">struct</span>&nbsp;<span class="op" id="3487774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487777">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487790">[</span><span class="op" id="3487791">]</span><span class="builtintype" id="3487792">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487798">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487811">io</span><span class="op" id="3487813">.</span><span class="ident" id="3487814">Reader</span>&nbsp;<span class="comment" id="3487821">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487855">r</span><span class="op" id="3487856">,</span>&nbsp;<span class="ident" id="3487858">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3487868">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3487878">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487911">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3487924">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487931">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3487944">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487949">lastRuneSize</span>&nbsp;<span class="builtintype" id="3487962">int</span><br>
<span class="lineno"></span><span class="op" id="3487966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3487969">const</span>&nbsp;<span class="ident" id="3487975">minReadBufferSize</span>&nbsp;<span class="op" id="3487993">=</span>&nbsp;<span class="num" id="3487995">16</span><br>
<span class="lineno"></span><span class="keyword" id="3487998">const</span>&nbsp;<span class="ident" id="3488004">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3488029">=</span>&nbsp;<span class="num" id="3488031">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3488036">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3488114">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="3488187">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="3488230">func</span>&nbsp;<span class="ident" id="3488235">NewReaderSize</span><span class="op" id="3488248">(</span><span class="ident" id="3488249">rd</span>&nbsp;<span class="ident" id="3488252">io</span><span class="op" id="3488254">.</span><span class="ident" id="3488255">Reader</span><span class="op" id="3488261">,</span>&nbsp;<span class="ident" id="3488263">size</span>&nbsp;<span class="builtintype" id="3488268">int</span><span class="op" id="3488271">)</span>&nbsp;<span class="op" id="3488273">*</span><span class="ident" id="3488274">Reader</span>&nbsp;<span class="op" id="3488281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3488284">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488312">b</span><span class="op" id="3488313">,</span>&nbsp;<span class="ident" id="3488315">ok</span>&nbsp;<span class="op" id="3488318">:=</span>&nbsp;<span class="ident" id="3488321">rd</span><span class="op" id="3488323">.</span><span class="op" id="3488324">(</span><span class="op" id="3488325">*</span><span class="ident" id="3488326">Reader</span><span class="op" id="3488332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488335">if</span>&nbsp;<span class="ident" id="3488338">ok</span>&nbsp;<span class="op" id="3488341">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3488344">len</span><span class="op" id="3488347">(</span><span class="ident" id="3488348">b</span><span class="op" id="3488349">.</span><span class="ident" id="3488350">buf</span><span class="op" id="3488353">)</span>&nbsp;<span class="op" id="3488355">&gt;=</span>&nbsp;<span class="ident" id="3488358">size</span>&nbsp;<span class="op" id="3488363">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488367">return</span>&nbsp;<span class="ident" id="3488374">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488380">if</span>&nbsp;<span class="ident" id="3488383">size</span>&nbsp;<span class="op" id="3488388">&lt;</span>&nbsp;<span class="ident" id="3488390">minReadBufferSize</span>&nbsp;<span class="op" id="3488408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488412">size</span>&nbsp;<span class="op" id="3488417">=</span>&nbsp;<span class="ident" id="3488419">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488438">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488441">r</span>&nbsp;<span class="op" id="3488443">:=</span>&nbsp;<span class="builtinfunc" id="3488446">new</span><span class="op" id="3488449">(</span><span class="ident" id="3488450">Reader</span><span class="op" id="3488456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488459">r</span><span class="op" id="3488460">.</span><span class="ident" id="3488461">reset</span><span class="op" id="3488466">(</span><span class="builtinfunc" id="3488467">make</span><span class="op" id="3488471">(</span><span class="op" id="3488472">[</span><span class="op" id="3488473">]</span><span class="builtintype" id="3488474">byte</span><span class="op" id="3488478">,</span>&nbsp;<span class="ident" id="3488480">size</span><span class="op" id="3488484">)</span><span class="op" id="3488485">,</span>&nbsp;<span class="ident" id="3488487">rd</span><span class="op" id="3488489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488492">return</span>&nbsp;<span class="ident" id="3488499">r</span><br>
<span class="lineno"></span><span class="op" id="3488501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3488504">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3488573">func</span>&nbsp;<span class="ident" id="3488578">NewReader</span><span class="op" id="3488587">(</span><span class="ident" id="3488588">rd</span>&nbsp;<span class="ident" id="3488591">io</span><span class="op" id="3488593">.</span><span class="ident" id="3488594">Reader</span><span class="op" id="3488600">)</span>&nbsp;<span class="op" id="3488602">*</span><span class="ident" id="3488603">Reader</span>&nbsp;<span class="op" id="3488610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488613">return</span>&nbsp;<span class="ident" id="3488620">NewReaderSize</span><span class="op" id="3488633">(</span><span class="ident" id="3488634">rd</span><span class="op" id="3488636">,</span>&nbsp;<span class="ident" id="3488638">defaultBufSize</span><span class="op" id="3488652">)</span><br>
<span class="lineno"></span><span class="op" id="3488654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3488657">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="3488725">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3488764">func</span>&nbsp;<span class="op" id="3488769">(</span><span class="ident" id="3488770">b</span>&nbsp;<span class="op" id="3488772">*</span><span class="ident" id="3488773">Reader</span><span class="op" id="3488779">)</span>&nbsp;<span class="ident" id="3488781">Reset</span><span class="op" id="3488786">(</span><span class="ident" id="3488787">r</span>&nbsp;<span class="ident" id="3488789">io</span><span class="op" id="3488791">.</span><span class="ident" id="3488792">Reader</span><span class="op" id="3488798">)</span>&nbsp;<span class="op" id="3488800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488803">b</span><span class="op" id="3488804">.</span><span class="ident" id="3488805">reset</span><span class="op" id="3488810">(</span><span class="ident" id="3488811">b</span><span class="op" id="3488812">.</span><span class="ident" id="3488813">buf</span><span class="op" id="3488816">,</span>&nbsp;<span class="ident" id="3488818">r</span><span class="op" id="3488819">)</span><br>
<span class="lineno"></span><span class="op" id="3488821">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3488824">func</span>&nbsp;<span class="op" id="3488829">(</span><span class="ident" id="3488830">b</span>&nbsp;<span class="op" id="3488832">*</span><span class="ident" id="3488833">Reader</span><span class="op" id="3488839">)</span>&nbsp;<span class="ident" id="3488841">reset</span><span class="op" id="3488846">(</span><span class="ident" id="3488847">buf</span>&nbsp;<span class="op" id="3488851">[</span><span class="op" id="3488852">]</span><span class="builtintype" id="3488853">byte</span><span class="op" id="3488857">,</span>&nbsp;<span class="ident" id="3488859">r</span>&nbsp;<span class="ident" id="3488861">io</span><span class="op" id="3488863">.</span><span class="ident" id="3488864">Reader</span><span class="op" id="3488870">)</span>&nbsp;<span class="op" id="3488872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488875">*</span><span class="ident" id="3488876">b</span>&nbsp;<span class="op" id="3488878">=</span>&nbsp;<span class="ident" id="3488880">Reader</span><span class="op" id="3488886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488890">buf</span><span class="op" id="3488893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488904">buf</span><span class="op" id="3488907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488911">rd</span><span class="op" id="3488913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488925">r</span><span class="op" id="3488926">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488930">lastByte</span><span class="op" id="3488938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3488944">-</span><span class="num" id="3488945">1</span><span class="op" id="3488946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488950">lastRuneSize</span><span class="op" id="3488962">:</span>&nbsp;<span class="op" id="3488964">-</span><span class="num" id="3488965">1</span><span class="op" id="3488966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488969">}</span><br>
<span class="lineno"></span><span class="op" id="3488971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3488974">var</span>&nbsp;<span class="ident" id="3488978">errNegativeRead</span>&nbsp;<span class="op" id="3488994">=</span>&nbsp;<span class="ident" id="3488996">errors</span><span class="op" id="3489002">.</span><span class="ident" id="3489003">New</span><span class="op" id="3489006">(</span><span class="string" id="3489007">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="3489056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3489059">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3489102">func</span>&nbsp;<span class="op" id="3489107">(</span><span class="ident" id="3489108">b</span>&nbsp;<span class="op" id="3489110">*</span><span class="ident" id="3489111">Reader</span><span class="op" id="3489117">)</span>&nbsp;<span class="ident" id="3489119">fill</span><span class="op" id="3489123">(</span><span class="op" id="3489124">)</span>&nbsp;<span class="op" id="3489126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489129">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489167">if</span>&nbsp;<span class="ident" id="3489170">b</span><span class="op" id="3489171">.</span><span class="ident" id="3489172">r</span>&nbsp;<span class="op" id="3489174">&gt;</span>&nbsp;<span class="num" id="3489176">0</span>&nbsp;<span class="op" id="3489178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3489182">copy</span><span class="op" id="3489186">(</span><span class="ident" id="3489187">b</span><span class="op" id="3489188">.</span><span class="ident" id="3489189">buf</span><span class="op" id="3489192">,</span>&nbsp;<span class="ident" id="3489194">b</span><span class="op" id="3489195">.</span><span class="ident" id="3489196">buf</span><span class="op" id="3489199">[</span><span class="ident" id="3489200">b</span><span class="op" id="3489201">.</span><span class="ident" id="3489202">r</span><span class="op" id="3489203">:</span><span class="ident" id="3489204">b</span><span class="op" id="3489205">.</span><span class="ident" id="3489206">w</span><span class="op" id="3489207">]</span><span class="op" id="3489208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489212">b</span><span class="op" id="3489213">.</span><span class="ident" id="3489214">w</span>&nbsp;<span class="op" id="3489216">-=</span>&nbsp;<span class="ident" id="3489219">b</span><span class="op" id="3489220">.</span><span class="ident" id="3489221">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489225">b</span><span class="op" id="3489226">.</span><span class="ident" id="3489227">r</span>&nbsp;<span class="op" id="3489229">=</span>&nbsp;<span class="num" id="3489231">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489234">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489238">if</span>&nbsp;<span class="ident" id="3489241">b</span><span class="op" id="3489242">.</span><span class="ident" id="3489243">w</span>&nbsp;<span class="op" id="3489245">&gt;=</span>&nbsp;<span class="builtinfunc" id="3489248">len</span><span class="op" id="3489251">(</span><span class="ident" id="3489252">b</span><span class="op" id="3489253">.</span><span class="ident" id="3489254">buf</span><span class="op" id="3489257">)</span>&nbsp;<span class="op" id="3489259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3489263">panic</span><span class="op" id="3489268">(</span><span class="string" id="3489269">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="3489303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489310">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489360">for</span>&nbsp;<span class="ident" id="3489364">i</span>&nbsp;<span class="op" id="3489366">:=</span>&nbsp;<span class="ident" id="3489369">maxConsecutiveEmptyReads</span><span class="op" id="3489393">;</span>&nbsp;<span class="ident" id="3489395">i</span>&nbsp;<span class="op" id="3489397">&gt;</span>&nbsp;<span class="num" id="3489399">0</span><span class="op" id="3489400">;</span>&nbsp;<span class="ident" id="3489402">i</span><span class="op" id="3489403">--</span>&nbsp;<span class="op" id="3489406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489410">n</span><span class="op" id="3489411">,</span>&nbsp;<span class="ident" id="3489413">err</span>&nbsp;<span class="op" id="3489417">:=</span>&nbsp;<span class="ident" id="3489420">b</span><span class="op" id="3489421">.</span><span class="ident" id="3489422">rd</span><span class="op" id="3489424">.</span><span class="ident" id="3489425">Read</span><span class="op" id="3489429">(</span><span class="ident" id="3489430">b</span><span class="op" id="3489431">.</span><span class="ident" id="3489432">buf</span><span class="op" id="3489435">[</span><span class="ident" id="3489436">b</span><span class="op" id="3489437">.</span><span class="ident" id="3489438">w</span><span class="op" id="3489439">:</span><span class="op" id="3489440">]</span><span class="op" id="3489441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489445">if</span>&nbsp;<span class="ident" id="3489448">n</span>&nbsp;<span class="op" id="3489450">&lt;</span>&nbsp;<span class="num" id="3489452">0</span>&nbsp;<span class="op" id="3489454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3489459">panic</span><span class="op" id="3489464">(</span><span class="ident" id="3489465">errNegativeRead</span><span class="op" id="3489480">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489488">b</span><span class="op" id="3489489">.</span><span class="ident" id="3489490">w</span>&nbsp;<span class="op" id="3489492">+=</span>&nbsp;<span class="ident" id="3489495">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489499">if</span>&nbsp;<span class="ident" id="3489502">err</span>&nbsp;<span class="op" id="3489506">!=</span>&nbsp;<span class="ident" id="3489509">nil</span>&nbsp;<span class="op" id="3489513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489518">b</span><span class="op" id="3489519">.</span><span class="ident" id="3489520">err</span>&nbsp;<span class="op" id="3489524">=</span>&nbsp;<span class="ident" id="3489526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489533">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489546">if</span>&nbsp;<span class="ident" id="3489549">n</span>&nbsp;<span class="op" id="3489551">&gt;</span>&nbsp;<span class="num" id="3489553">0</span>&nbsp;<span class="op" id="3489555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489572">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489575">b</span><span class="op" id="3489576">.</span><span class="ident" id="3489577">err</span>&nbsp;<span class="op" id="3489581">=</span>&nbsp;<span class="ident" id="3489583">io</span><span class="op" id="3489585">.</span><span class="ident" id="3489586">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="3489600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3489603">func</span>&nbsp;<span class="op" id="3489608">(</span><span class="ident" id="3489609">b</span>&nbsp;<span class="op" id="3489611">*</span><span class="ident" id="3489612">Reader</span><span class="op" id="3489618">)</span>&nbsp;<span class="ident" id="3489620">readErr</span><span class="op" id="3489627">(</span><span class="op" id="3489628">)</span>&nbsp;<span class="builtintype" id="3489630">error</span>&nbsp;<span class="op" id="3489636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489639">err</span>&nbsp;<span class="op" id="3489643">:=</span>&nbsp;<span class="ident" id="3489646">b</span><span class="op" id="3489647">.</span><span class="ident" id="3489648">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489653">b</span><span class="op" id="3489654">.</span><span class="ident" id="3489655">err</span>&nbsp;<span class="op" id="3489659">=</span>&nbsp;<span class="ident" id="3489661">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489666">return</span>&nbsp;<span class="ident" id="3489673">err</span><br>
<span class="lineno"></span><span class="op" id="3489677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3489680">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="3489758">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3489835">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3489907">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3489961">func</span>&nbsp;<span class="op" id="3489966">(</span><span class="ident" id="3489967">b</span>&nbsp;<span class="op" id="3489969">*</span><span class="ident" id="3489970">Reader</span><span class="op" id="3489976">)</span>&nbsp;<span class="ident" id="3489978">Peek</span><span class="op" id="3489982">(</span><span class="ident" id="3489983">n</span>&nbsp;<span class="builtintype" id="3489985">int</span><span class="op" id="3489988">)</span>&nbsp;<span class="op" id="3489990">(</span><span class="op" id="3489991">[</span><span class="op" id="3489992">]</span><span class="builtintype" id="3489993">byte</span><span class="op" id="3489997">,</span>&nbsp;<span class="builtintype" id="3489999">error</span><span class="op" id="3490004">)</span>&nbsp;<span class="op" id="3490006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490009">if</span>&nbsp;<span class="ident" id="3490012">n</span>&nbsp;<span class="op" id="3490014">&lt;</span>&nbsp;<span class="num" id="3490016">0</span>&nbsp;<span class="op" id="3490018">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490022">return</span>&nbsp;<span class="ident" id="3490029">nil</span><span class="op" id="3490032">,</span>&nbsp;<span class="ident" id="3490034">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490055">if</span>&nbsp;<span class="ident" id="3490058">n</span>&nbsp;<span class="op" id="3490060">&gt;</span>&nbsp;<span class="builtinfunc" id="3490062">len</span><span class="op" id="3490065">(</span><span class="ident" id="3490066">b</span><span class="op" id="3490067">.</span><span class="ident" id="3490068">buf</span><span class="op" id="3490071">)</span>&nbsp;<span class="op" id="3490073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490077">return</span>&nbsp;<span class="ident" id="3490084">nil</span><span class="op" id="3490087">,</span>&nbsp;<span class="ident" id="3490089">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490104">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3490107">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490132">for</span>&nbsp;<span class="ident" id="3490136">b</span><span class="op" id="3490137">.</span><span class="ident" id="3490138">w</span><span class="op" id="3490139">-</span><span class="ident" id="3490140">b</span><span class="op" id="3490141">.</span><span class="ident" id="3490142">r</span>&nbsp;<span class="op" id="3490144">&lt;</span>&nbsp;<span class="ident" id="3490146">n</span>&nbsp;<span class="op" id="3490148">&amp;&amp;</span>&nbsp;<span class="ident" id="3490151">b</span><span class="op" id="3490152">.</span><span class="ident" id="3490153">err</span>&nbsp;<span class="op" id="3490157">==</span>&nbsp;<span class="ident" id="3490160">nil</span>&nbsp;<span class="op" id="3490164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490168">b</span><span class="op" id="3490169">.</span><span class="ident" id="3490170">fill</span><span class="op" id="3490174">(</span><span class="op" id="3490175">)</span>&nbsp;<span class="comment" id="3490177">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490228">var</span>&nbsp;<span class="ident" id="3490232">err</span>&nbsp;<span class="builtintype" id="3490236">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490243">if</span>&nbsp;<span class="ident" id="3490246">avail</span>&nbsp;<span class="op" id="3490252">:=</span>&nbsp;<span class="ident" id="3490255">b</span><span class="op" id="3490256">.</span><span class="ident" id="3490257">w</span>&nbsp;<span class="op" id="3490259">-</span>&nbsp;<span class="ident" id="3490261">b</span><span class="op" id="3490262">.</span><span class="ident" id="3490263">r</span><span class="op" id="3490264">;</span>&nbsp;<span class="ident" id="3490266">avail</span>&nbsp;<span class="op" id="3490272">&lt;</span>&nbsp;<span class="ident" id="3490274">n</span>&nbsp;<span class="op" id="3490276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3490280">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490311">n</span>&nbsp;<span class="op" id="3490313">=</span>&nbsp;<span class="ident" id="3490315">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490323">err</span>&nbsp;<span class="op" id="3490327">=</span>&nbsp;<span class="ident" id="3490329">b</span><span class="op" id="3490330">.</span><span class="ident" id="3490331">readErr</span><span class="op" id="3490338">(</span><span class="op" id="3490339">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490343">if</span>&nbsp;<span class="ident" id="3490346">err</span>&nbsp;<span class="op" id="3490350">==</span>&nbsp;<span class="ident" id="3490353">nil</span>&nbsp;<span class="op" id="3490357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490362">err</span>&nbsp;<span class="op" id="3490366">=</span>&nbsp;<span class="ident" id="3490368">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490390">return</span>&nbsp;<span class="ident" id="3490397">b</span><span class="op" id="3490398">.</span><span class="ident" id="3490399">buf</span><span class="op" id="3490402">[</span><span class="ident" id="3490403">b</span><span class="op" id="3490404">.</span><span class="ident" id="3490405">r</span>&nbsp;<span class="op" id="3490407">:</span>&nbsp;<span class="ident" id="3490409">b</span><span class="op" id="3490410">.</span><span class="ident" id="3490411">r</span><span class="op" id="3490412">+</span><span class="ident" id="3490413">n</span><span class="op" id="3490414">]</span><span class="op" id="3490415">,</span>&nbsp;<span class="ident" id="3490417">err</span><br>
<span class="lineno">145</span><span class="op" id="3490421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490424">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3490451">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3490498">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="3490554">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="3490590">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3490648">func</span>&nbsp;<span class="op" id="3490653">(</span><span class="ident" id="3490654">b</span>&nbsp;<span class="op" id="3490656">*</span><span class="ident" id="3490657">Reader</span><span class="op" id="3490663">)</span>&nbsp;<span class="ident" id="3490665">Read</span><span class="op" id="3490669">(</span><span class="ident" id="3490670">p</span>&nbsp;<span class="op" id="3490672">[</span><span class="op" id="3490673">]</span><span class="builtintype" id="3490674">byte</span><span class="op" id="3490678">)</span>&nbsp;<span class="op" id="3490680">(</span><span class="ident" id="3490681">n</span>&nbsp;<span class="builtintype" id="3490683">int</span><span class="op" id="3490686">,</span>&nbsp;<span class="ident" id="3490688">err</span>&nbsp;<span class="builtintype" id="3490692">error</span><span class="op" id="3490697">)</span>&nbsp;<span class="op" id="3490699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490702">n</span>&nbsp;<span class="op" id="3490704">=</span>&nbsp;<span class="builtinfunc" id="3490706">len</span><span class="op" id="3490709">(</span><span class="ident" id="3490710">p</span><span class="op" id="3490711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490714">if</span>&nbsp;<span class="ident" id="3490717">n</span>&nbsp;<span class="op" id="3490719">==</span>&nbsp;<span class="num" id="3490722">0</span>&nbsp;<span class="op" id="3490724">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490728">return</span>&nbsp;<span class="num" id="3490735">0</span><span class="op" id="3490736">,</span>&nbsp;<span class="ident" id="3490738">b</span><span class="op" id="3490739">.</span><span class="ident" id="3490740">readErr</span><span class="op" id="3490747">(</span><span class="op" id="3490748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490754">if</span>&nbsp;<span class="ident" id="3490757">b</span><span class="op" id="3490758">.</span><span class="ident" id="3490759">r</span>&nbsp;<span class="op" id="3490761">==</span>&nbsp;<span class="ident" id="3490764">b</span><span class="op" id="3490765">.</span><span class="ident" id="3490766">w</span>&nbsp;<span class="op" id="3490768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490772">if</span>&nbsp;<span class="ident" id="3490775">b</span><span class="op" id="3490776">.</span><span class="ident" id="3490777">err</span>&nbsp;<span class="op" id="3490781">!=</span>&nbsp;<span class="ident" id="3490784">nil</span>&nbsp;<span class="op" id="3490788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490793">return</span>&nbsp;<span class="num" id="3490800">0</span><span class="op" id="3490801">,</span>&nbsp;<span class="ident" id="3490803">b</span><span class="op" id="3490804">.</span><span class="ident" id="3490805">readErr</span><span class="op" id="3490812">(</span><span class="op" id="3490813">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490821">if</span>&nbsp;<span class="builtinfunc" id="3490824">len</span><span class="op" id="3490827">(</span><span class="ident" id="3490828">p</span><span class="op" id="3490829">)</span>&nbsp;<span class="op" id="3490831">&gt;=</span>&nbsp;<span class="builtinfunc" id="3490834">len</span><span class="op" id="3490837">(</span><span class="ident" id="3490838">b</span><span class="op" id="3490839">.</span><span class="ident" id="3490840">buf</span><span class="op" id="3490843">)</span>&nbsp;<span class="op" id="3490845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3490850">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3490882">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490924">n</span><span class="op" id="3490925">,</span>&nbsp;<span class="ident" id="3490927">b</span><span class="op" id="3490928">.</span><span class="ident" id="3490929">err</span>&nbsp;<span class="op" id="3490933">=</span>&nbsp;<span class="ident" id="3490935">b</span><span class="op" id="3490936">.</span><span class="ident" id="3490937">rd</span><span class="op" id="3490939">.</span><span class="ident" id="3490940">Read</span><span class="op" id="3490944">(</span><span class="ident" id="3490945">p</span><span class="op" id="3490946">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490951">if</span>&nbsp;<span class="ident" id="3490954">n</span>&nbsp;<span class="op" id="3490956">&lt;</span>&nbsp;<span class="num" id="3490958">0</span>&nbsp;<span class="op" id="3490960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3490966">panic</span><span class="op" id="3490971">(</span><span class="ident" id="3490972">errNegativeRead</span><span class="op" id="3490987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490997">if</span>&nbsp;<span class="ident" id="3491000">n</span>&nbsp;<span class="op" id="3491002">&gt;</span>&nbsp;<span class="num" id="3491004">0</span>&nbsp;<span class="op" id="3491006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491012">b</span><span class="op" id="3491013">.</span><span class="ident" id="3491014">lastByte</span>&nbsp;<span class="op" id="3491023">=</span>&nbsp;<span class="builtintype" id="3491025">int</span><span class="op" id="3491028">(</span><span class="ident" id="3491029">p</span><span class="op" id="3491030">[</span><span class="ident" id="3491031">n</span><span class="op" id="3491032">-</span><span class="num" id="3491033">1</span><span class="op" id="3491034">]</span><span class="op" id="3491035">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491041">b</span><span class="op" id="3491042">.</span><span class="ident" id="3491043">lastRuneSize</span>&nbsp;<span class="op" id="3491056">=</span>&nbsp;<span class="op" id="3491058">-</span><span class="num" id="3491059">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491069">return</span>&nbsp;<span class="ident" id="3491076">n</span><span class="op" id="3491077">,</span>&nbsp;<span class="ident" id="3491079">b</span><span class="op" id="3491080">.</span><span class="ident" id="3491081">readErr</span><span class="op" id="3491088">(</span><span class="op" id="3491089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491097">b</span><span class="op" id="3491098">.</span><span class="ident" id="3491099">fill</span><span class="op" id="3491103">(</span><span class="op" id="3491104">)</span>&nbsp;<span class="comment" id="3491106">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491127">if</span>&nbsp;<span class="ident" id="3491130">b</span><span class="op" id="3491131">.</span><span class="ident" id="3491132">r</span>&nbsp;<span class="op" id="3491134">==</span>&nbsp;<span class="ident" id="3491137">b</span><span class="op" id="3491138">.</span><span class="ident" id="3491139">w</span>&nbsp;<span class="op" id="3491141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491146">return</span>&nbsp;<span class="num" id="3491153">0</span><span class="op" id="3491154">,</span>&nbsp;<span class="ident" id="3491156">b</span><span class="op" id="3491157">.</span><span class="ident" id="3491158">readErr</span><span class="op" id="3491165">(</span><span class="op" id="3491166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491177">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491204">n</span>&nbsp;<span class="op" id="3491206">=</span>&nbsp;<span class="builtinfunc" id="3491208">copy</span><span class="op" id="3491212">(</span><span class="ident" id="3491213">p</span><span class="op" id="3491214">,</span>&nbsp;<span class="ident" id="3491216">b</span><span class="op" id="3491217">.</span><span class="ident" id="3491218">buf</span><span class="op" id="3491221">[</span><span class="ident" id="3491222">b</span><span class="op" id="3491223">.</span><span class="ident" id="3491224">r</span><span class="op" id="3491225">:</span><span class="ident" id="3491226">b</span><span class="op" id="3491227">.</span><span class="ident" id="3491228">w</span><span class="op" id="3491229">]</span><span class="op" id="3491230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491233">b</span><span class="op" id="3491234">.</span><span class="ident" id="3491235">r</span>&nbsp;<span class="op" id="3491237">+=</span>&nbsp;<span class="ident" id="3491240">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491243">b</span><span class="op" id="3491244">.</span><span class="ident" id="3491245">lastByte</span>&nbsp;<span class="op" id="3491254">=</span>&nbsp;<span class="builtintype" id="3491256">int</span><span class="op" id="3491259">(</span><span class="ident" id="3491260">b</span><span class="op" id="3491261">.</span><span class="ident" id="3491262">buf</span><span class="op" id="3491265">[</span><span class="ident" id="3491266">b</span><span class="op" id="3491267">.</span><span class="ident" id="3491268">r</span><span class="op" id="3491269">-</span><span class="num" id="3491270">1</span><span class="op" id="3491271">]</span><span class="op" id="3491272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491275">b</span><span class="op" id="3491276">.</span><span class="ident" id="3491277">lastRuneSize</span>&nbsp;<span class="op" id="3491290">=</span>&nbsp;<span class="op" id="3491292">-</span><span class="num" id="3491293">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491296">return</span>&nbsp;<span class="ident" id="3491303">n</span><span class="op" id="3491304">,</span>&nbsp;<span class="ident" id="3491306">nil</span><br>
<span class="lineno"></span><span class="op" id="3491310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491313">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="3491358">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="3491404">func</span>&nbsp;<span class="op" id="3491409">(</span><span class="ident" id="3491410">b</span>&nbsp;<span class="op" id="3491412">*</span><span class="ident" id="3491413">Reader</span><span class="op" id="3491419">)</span>&nbsp;<span class="ident" id="3491421">ReadByte</span><span class="op" id="3491429">(</span><span class="op" id="3491430">)</span>&nbsp;<span class="op" id="3491432">(</span><span class="ident" id="3491433">c</span>&nbsp;<span class="builtintype" id="3491435">byte</span><span class="op" id="3491439">,</span>&nbsp;<span class="ident" id="3491441">err</span>&nbsp;<span class="builtintype" id="3491445">error</span><span class="op" id="3491450">)</span>&nbsp;<span class="op" id="3491452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491455">b</span><span class="op" id="3491456">.</span><span class="ident" id="3491457">lastRuneSize</span>&nbsp;<span class="op" id="3491470">=</span>&nbsp;<span class="op" id="3491472">-</span><span class="num" id="3491473">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491476">for</span>&nbsp;<span class="ident" id="3491480">b</span><span class="op" id="3491481">.</span><span class="ident" id="3491482">r</span>&nbsp;<span class="op" id="3491484">==</span>&nbsp;<span class="ident" id="3491487">b</span><span class="op" id="3491488">.</span><span class="ident" id="3491489">w</span>&nbsp;<span class="op" id="3491491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491495">if</span>&nbsp;<span class="ident" id="3491498">b</span><span class="op" id="3491499">.</span><span class="ident" id="3491500">err</span>&nbsp;<span class="op" id="3491504">!=</span>&nbsp;<span class="ident" id="3491507">nil</span>&nbsp;<span class="op" id="3491511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491516">return</span>&nbsp;<span class="num" id="3491523">0</span><span class="op" id="3491524">,</span>&nbsp;<span class="ident" id="3491526">b</span><span class="op" id="3491527">.</span><span class="ident" id="3491528">readErr</span><span class="op" id="3491535">(</span><span class="op" id="3491536">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491544">b</span><span class="op" id="3491545">.</span><span class="ident" id="3491546">fill</span><span class="op" id="3491550">(</span><span class="op" id="3491551">)</span>&nbsp;<span class="comment" id="3491553">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491576">c</span>&nbsp;<span class="op" id="3491578">=</span>&nbsp;<span class="ident" id="3491580">b</span><span class="op" id="3491581">.</span><span class="ident" id="3491582">buf</span><span class="op" id="3491585">[</span><span class="ident" id="3491586">b</span><span class="op" id="3491587">.</span><span class="ident" id="3491588">r</span><span class="op" id="3491589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491592">b</span><span class="op" id="3491593">.</span><span class="ident" id="3491594">r</span><span class="op" id="3491595">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491599">b</span><span class="op" id="3491600">.</span><span class="ident" id="3491601">lastByte</span>&nbsp;<span class="op" id="3491610">=</span>&nbsp;<span class="builtintype" id="3491612">int</span><span class="op" id="3491615">(</span><span class="ident" id="3491616">c</span><span class="op" id="3491617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491620">return</span>&nbsp;<span class="ident" id="3491627">c</span><span class="op" id="3491628">,</span>&nbsp;<span class="ident" id="3491630">nil</span><br>
<span class="lineno"></span><span class="op" id="3491634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491637">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="3491723">func</span>&nbsp;<span class="op" id="3491728">(</span><span class="ident" id="3491729">b</span>&nbsp;<span class="op" id="3491731">*</span><span class="ident" id="3491732">Reader</span><span class="op" id="3491738">)</span>&nbsp;<span class="ident" id="3491740">UnreadByte</span><span class="op" id="3491750">(</span><span class="op" id="3491751">)</span>&nbsp;<span class="builtintype" id="3491753">error</span>&nbsp;<span class="op" id="3491759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491762">if</span>&nbsp;<span class="ident" id="3491765">b</span><span class="op" id="3491766">.</span><span class="ident" id="3491767">lastByte</span>&nbsp;<span class="op" id="3491776">&lt;</span>&nbsp;<span class="num" id="3491778">0</span>&nbsp;<span class="op" id="3491780">||</span>&nbsp;<span class="ident" id="3491783">b</span><span class="op" id="3491784">.</span><span class="ident" id="3491785">r</span>&nbsp;<span class="op" id="3491787">==</span>&nbsp;<span class="num" id="3491790">0</span>&nbsp;<span class="op" id="3491792">&amp;&amp;</span>&nbsp;<span class="ident" id="3491795">b</span><span class="op" id="3491796">.</span><span class="ident" id="3491797">w</span>&nbsp;<span class="op" id="3491799">&gt;</span>&nbsp;<span class="num" id="3491801">0</span>&nbsp;<span class="op" id="3491803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491807">return</span>&nbsp;<span class="ident" id="3491814">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491839">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491863">if</span>&nbsp;<span class="ident" id="3491866">b</span><span class="op" id="3491867">.</span><span class="ident" id="3491868">r</span>&nbsp;<span class="op" id="3491870">&gt;</span>&nbsp;<span class="num" id="3491872">0</span>&nbsp;<span class="op" id="3491874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491878">b</span><span class="op" id="3491879">.</span><span class="ident" id="3491880">r</span><span class="op" id="3491881">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491885">}</span>&nbsp;<span class="keyword" id="3491887">else</span>&nbsp;<span class="op" id="3491892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3491896">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491922">b</span><span class="op" id="3491923">.</span><span class="ident" id="3491924">w</span>&nbsp;<span class="op" id="3491926">=</span>&nbsp;<span class="num" id="3491928">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491934">b</span><span class="op" id="3491935">.</span><span class="ident" id="3491936">buf</span><span class="op" id="3491939">[</span><span class="ident" id="3491940">b</span><span class="op" id="3491941">.</span><span class="ident" id="3491942">r</span><span class="op" id="3491943">]</span>&nbsp;<span class="op" id="3491945">=</span>&nbsp;<span class="builtintype" id="3491947">byte</span><span class="op" id="3491951">(</span><span class="ident" id="3491952">b</span><span class="op" id="3491953">.</span><span class="ident" id="3491954">lastByte</span><span class="op" id="3491962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491965">b</span><span class="op" id="3491966">.</span><span class="ident" id="3491967">lastByte</span>&nbsp;<span class="op" id="3491976">=</span>&nbsp;<span class="op" id="3491978">-</span><span class="num" id="3491979">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3491982">b</span><span class="op" id="3491983">.</span><span class="ident" id="3491984">lastRuneSize</span>&nbsp;<span class="op" id="3491997">=</span>&nbsp;<span class="op" id="3491999">-</span><span class="num" id="3492000">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492003">return</span>&nbsp;<span class="ident" id="3492010">nil</span><br>
<span class="lineno">220</span><span class="op" id="3492014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3492017">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3492092">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3492176">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="3492242">func</span>&nbsp;<span class="op" id="3492247">(</span><span class="ident" id="3492248">b</span>&nbsp;<span class="op" id="3492250">*</span><span class="ident" id="3492251">Reader</span><span class="op" id="3492257">)</span>&nbsp;<span class="ident" id="3492259">ReadRune</span><span class="op" id="3492267">(</span><span class="op" id="3492268">)</span>&nbsp;<span class="op" id="3492270">(</span><span class="ident" id="3492271">r</span>&nbsp;<span class="builtintype" id="3492273">rune</span><span class="op" id="3492277">,</span>&nbsp;<span class="ident" id="3492279">size</span>&nbsp;<span class="builtintype" id="3492284">int</span><span class="op" id="3492287">,</span>&nbsp;<span class="ident" id="3492289">err</span>&nbsp;<span class="builtintype" id="3492293">error</span><span class="op" id="3492298">)</span>&nbsp;<span class="op" id="3492300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492303">for</span>&nbsp;<span class="ident" id="3492307">b</span><span class="op" id="3492308">.</span><span class="ident" id="3492309">r</span><span class="op" id="3492310">+</span><span class="ident" id="3492311">utf8</span><span class="op" id="3492315">.</span><span class="ident" id="3492316">UTFMax</span>&nbsp;<span class="op" id="3492323">&gt;</span>&nbsp;<span class="ident" id="3492325">b</span><span class="op" id="3492326">.</span><span class="ident" id="3492327">w</span>&nbsp;<span class="op" id="3492329">&amp;&amp;</span>&nbsp;<span class="op" id="3492332">!</span><span class="ident" id="3492333">utf8</span><span class="op" id="3492337">.</span><span class="ident" id="3492338">FullRune</span><span class="op" id="3492346">(</span><span class="ident" id="3492347">b</span><span class="op" id="3492348">.</span><span class="ident" id="3492349">buf</span><span class="op" id="3492352">[</span><span class="ident" id="3492353">b</span><span class="op" id="3492354">.</span><span class="ident" id="3492355">r</span><span class="op" id="3492356">:</span><span class="ident" id="3492357">b</span><span class="op" id="3492358">.</span><span class="ident" id="3492359">w</span><span class="op" id="3492360">]</span><span class="op" id="3492361">)</span>&nbsp;<span class="op" id="3492363">&amp;&amp;</span>&nbsp;<span class="ident" id="3492366">b</span><span class="op" id="3492367">.</span><span class="ident" id="3492368">err</span>&nbsp;<span class="op" id="3492372">==</span>&nbsp;<span class="ident" id="3492375">nil</span>&nbsp;<span class="op" id="3492379">&amp;&amp;</span>&nbsp;<span class="ident" id="3492382">b</span><span class="op" id="3492383">.</span><span class="ident" id="3492384">w</span><span class="op" id="3492385">-</span><span class="ident" id="3492386">b</span><span class="op" id="3492387">.</span><span class="ident" id="3492388">r</span>&nbsp;<span class="op" id="3492390">&lt;</span>&nbsp;<span class="builtinfunc" id="3492392">len</span><span class="op" id="3492395">(</span><span class="ident" id="3492396">b</span><span class="op" id="3492397">.</span><span class="ident" id="3492398">buf</span><span class="op" id="3492401">)</span>&nbsp;<span class="op" id="3492403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492407">b</span><span class="op" id="3492408">.</span><span class="ident" id="3492409">fill</span><span class="op" id="3492413">(</span><span class="op" id="3492414">)</span>&nbsp;<span class="comment" id="3492416">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492464">b</span><span class="op" id="3492465">.</span><span class="ident" id="3492466">lastRuneSize</span>&nbsp;<span class="op" id="3492479">=</span>&nbsp;<span class="op" id="3492481">-</span><span class="num" id="3492482">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492485">if</span>&nbsp;<span class="ident" id="3492488">b</span><span class="op" id="3492489">.</span><span class="ident" id="3492490">r</span>&nbsp;<span class="op" id="3492492">==</span>&nbsp;<span class="ident" id="3492495">b</span><span class="op" id="3492496">.</span><span class="ident" id="3492497">w</span>&nbsp;<span class="op" id="3492499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492503">return</span>&nbsp;<span class="num" id="3492510">0</span><span class="op" id="3492511">,</span>&nbsp;<span class="num" id="3492513">0</span><span class="op" id="3492514">,</span>&nbsp;<span class="ident" id="3492516">b</span><span class="op" id="3492517">.</span><span class="ident" id="3492518">readErr</span><span class="op" id="3492525">(</span><span class="op" id="3492526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492532">r</span><span class="op" id="3492533">,</span>&nbsp;<span class="ident" id="3492535">size</span>&nbsp;<span class="op" id="3492540">=</span>&nbsp;<span class="builtintype" id="3492542">rune</span><span class="op" id="3492546">(</span><span class="ident" id="3492547">b</span><span class="op" id="3492548">.</span><span class="ident" id="3492549">buf</span><span class="op" id="3492552">[</span><span class="ident" id="3492553">b</span><span class="op" id="3492554">.</span><span class="ident" id="3492555">r</span><span class="op" id="3492556">]</span><span class="op" id="3492557">)</span><span class="op" id="3492558">,</span>&nbsp;<span class="num" id="3492560">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492563">if</span>&nbsp;<span class="ident" id="3492566">r</span>&nbsp;<span class="op" id="3492568">&gt;=</span>&nbsp;<span class="num" id="3492571">0x80</span>&nbsp;<span class="op" id="3492576">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492580">r</span><span class="op" id="3492581">,</span>&nbsp;<span class="ident" id="3492583">size</span>&nbsp;<span class="op" id="3492588">=</span>&nbsp;<span class="ident" id="3492590">utf8</span><span class="op" id="3492594">.</span><span class="ident" id="3492595">DecodeRune</span><span class="op" id="3492605">(</span><span class="ident" id="3492606">b</span><span class="op" id="3492607">.</span><span class="ident" id="3492608">buf</span><span class="op" id="3492611">[</span><span class="ident" id="3492612">b</span><span class="op" id="3492613">.</span><span class="ident" id="3492614">r</span><span class="op" id="3492615">:</span><span class="ident" id="3492616">b</span><span class="op" id="3492617">.</span><span class="ident" id="3492618">w</span><span class="op" id="3492619">]</span><span class="op" id="3492620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492626">b</span><span class="op" id="3492627">.</span><span class="ident" id="3492628">r</span>&nbsp;<span class="op" id="3492630">+=</span>&nbsp;<span class="ident" id="3492633">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492639">b</span><span class="op" id="3492640">.</span><span class="ident" id="3492641">lastByte</span>&nbsp;<span class="op" id="3492650">=</span>&nbsp;<span class="builtintype" id="3492652">int</span><span class="op" id="3492655">(</span><span class="ident" id="3492656">b</span><span class="op" id="3492657">.</span><span class="ident" id="3492658">buf</span><span class="op" id="3492661">[</span><span class="ident" id="3492662">b</span><span class="op" id="3492663">.</span><span class="ident" id="3492664">r</span><span class="op" id="3492665">-</span><span class="num" id="3492666">1</span><span class="op" id="3492667">]</span><span class="op" id="3492668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492671">b</span><span class="op" id="3492672">.</span><span class="ident" id="3492673">lastRuneSize</span>&nbsp;<span class="op" id="3492686">=</span>&nbsp;<span class="ident" id="3492688">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492694">return</span>&nbsp;<span class="ident" id="3492701">r</span><span class="op" id="3492702">,</span>&nbsp;<span class="ident" id="3492704">size</span><span class="op" id="3492708">,</span>&nbsp;<span class="ident" id="3492710">nil</span><br>
<span class="lineno"></span><span class="op" id="3492714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3492717">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3492792">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="3492865">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3492939">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="3492968">func</span>&nbsp;<span class="op" id="3492973">(</span><span class="ident" id="3492974">b</span>&nbsp;<span class="op" id="3492976">*</span><span class="ident" id="3492977">Reader</span><span class="op" id="3492983">)</span>&nbsp;<span class="ident" id="3492985">UnreadRune</span><span class="op" id="3492995">(</span><span class="op" id="3492996">)</span>&nbsp;<span class="builtintype" id="3492998">error</span>&nbsp;<span class="op" id="3493004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493007">if</span>&nbsp;<span class="ident" id="3493010">b</span><span class="op" id="3493011">.</span><span class="ident" id="3493012">lastRuneSize</span>&nbsp;<span class="op" id="3493025">&lt;</span>&nbsp;<span class="num" id="3493027">0</span>&nbsp;<span class="op" id="3493029">||</span>&nbsp;<span class="ident" id="3493032">b</span><span class="op" id="3493033">.</span><span class="ident" id="3493034">r</span>&nbsp;<span class="op" id="3493036">&lt;</span>&nbsp;<span class="ident" id="3493038">b</span><span class="op" id="3493039">.</span><span class="ident" id="3493040">lastRuneSize</span>&nbsp;<span class="op" id="3493053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493057">return</span>&nbsp;<span class="ident" id="3493064">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493089">b</span><span class="op" id="3493090">.</span><span class="ident" id="3493091">r</span>&nbsp;<span class="op" id="3493093">-=</span>&nbsp;<span class="ident" id="3493096">b</span><span class="op" id="3493097">.</span><span class="ident" id="3493098">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493112">b</span><span class="op" id="3493113">.</span><span class="ident" id="3493114">lastByte</span>&nbsp;<span class="op" id="3493123">=</span>&nbsp;<span class="op" id="3493125">-</span><span class="num" id="3493126">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493129">b</span><span class="op" id="3493130">.</span><span class="ident" id="3493131">lastRuneSize</span>&nbsp;<span class="op" id="3493144">=</span>&nbsp;<span class="op" id="3493146">-</span><span class="num" id="3493147">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493150">return</span>&nbsp;<span class="ident" id="3493157">nil</span><br>
<span class="lineno">255</span><span class="op" id="3493161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3493164">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3493246">func</span>&nbsp;<span class="op" id="3493251">(</span><span class="ident" id="3493252">b</span>&nbsp;<span class="op" id="3493254">*</span><span class="ident" id="3493255">Reader</span><span class="op" id="3493261">)</span>&nbsp;<span class="ident" id="3493263">Buffered</span><span class="op" id="3493271">(</span><span class="op" id="3493272">)</span>&nbsp;<span class="builtintype" id="3493274">int</span>&nbsp;<span class="op" id="3493278">{</span>&nbsp;<span class="keyword" id="3493280">return</span>&nbsp;<span class="ident" id="3493287">b</span><span class="op" id="3493288">.</span><span class="ident" id="3493289">w</span>&nbsp;<span class="op" id="3493291">-</span>&nbsp;<span class="ident" id="3493293">b</span><span class="op" id="3493294">.</span><span class="ident" id="3493295">r</span>&nbsp;<span class="op" id="3493297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3493300">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3493369">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3493427">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="3493475">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3493539">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="3493617">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3493698">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="3493762">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3493816">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3493852">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="3493927">func</span>&nbsp;<span class="op" id="3493932">(</span><span class="ident" id="3493933">b</span>&nbsp;<span class="op" id="3493935">*</span><span class="ident" id="3493936">Reader</span><span class="op" id="3493942">)</span>&nbsp;<span class="ident" id="3493944">ReadSlice</span><span class="op" id="3493953">(</span><span class="ident" id="3493954">delim</span>&nbsp;<span class="builtintype" id="3493960">byte</span><span class="op" id="3493964">)</span>&nbsp;<span class="op" id="3493966">(</span><span class="ident" id="3493967">line</span>&nbsp;<span class="op" id="3493972">[</span><span class="op" id="3493973">]</span><span class="builtintype" id="3493974">byte</span><span class="op" id="3493978">,</span>&nbsp;<span class="ident" id="3493980">err</span>&nbsp;<span class="builtintype" id="3493984">error</span><span class="op" id="3493989">)</span>&nbsp;<span class="op" id="3493991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493994">for</span>&nbsp;<span class="op" id="3493998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494002">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494022">if</span>&nbsp;<span class="ident" id="3494025">i</span>&nbsp;<span class="op" id="3494027">:=</span>&nbsp;<span class="ident" id="3494030">bytes</span><span class="op" id="3494035">.</span><span class="ident" id="3494036">IndexByte</span><span class="op" id="3494045">(</span><span class="ident" id="3494046">b</span><span class="op" id="3494047">.</span><span class="ident" id="3494048">buf</span><span class="op" id="3494051">[</span><span class="ident" id="3494052">b</span><span class="op" id="3494053">.</span><span class="ident" id="3494054">r</span><span class="op" id="3494055">:</span><span class="ident" id="3494056">b</span><span class="op" id="3494057">.</span><span class="ident" id="3494058">w</span><span class="op" id="3494059">]</span><span class="op" id="3494060">,</span>&nbsp;<span class="ident" id="3494062">delim</span><span class="op" id="3494067">)</span><span class="op" id="3494068">;</span>&nbsp;<span class="ident" id="3494070">i</span>&nbsp;<span class="op" id="3494072">&gt;=</span>&nbsp;<span class="num" id="3494075">0</span>&nbsp;<span class="op" id="3494077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494082">line</span>&nbsp;<span class="op" id="3494087">=</span>&nbsp;<span class="ident" id="3494089">b</span><span class="op" id="3494090">.</span><span class="ident" id="3494091">buf</span><span class="op" id="3494094">[</span><span class="ident" id="3494095">b</span><span class="op" id="3494096">.</span><span class="ident" id="3494097">r</span>&nbsp;<span class="op" id="3494099">:</span>&nbsp;<span class="ident" id="3494101">b</span><span class="op" id="3494102">.</span><span class="ident" id="3494103">r</span><span class="op" id="3494104">+</span><span class="ident" id="3494105">i</span><span class="op" id="3494106">+</span><span class="num" id="3494107">1</span><span class="op" id="3494108">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494113">b</span><span class="op" id="3494114">.</span><span class="ident" id="3494115">r</span>&nbsp;<span class="op" id="3494117">+=</span>&nbsp;<span class="ident" id="3494120">i</span>&nbsp;<span class="op" id="3494122">+</span>&nbsp;<span class="num" id="3494124">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494129">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494142">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494162">if</span>&nbsp;<span class="ident" id="3494165">b</span><span class="op" id="3494166">.</span><span class="ident" id="3494167">err</span>&nbsp;<span class="op" id="3494171">!=</span>&nbsp;<span class="ident" id="3494174">nil</span>&nbsp;<span class="op" id="3494178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494183">line</span>&nbsp;<span class="op" id="3494188">=</span>&nbsp;<span class="ident" id="3494190">b</span><span class="op" id="3494191">.</span><span class="ident" id="3494192">buf</span><span class="op" id="3494195">[</span><span class="ident" id="3494196">b</span><span class="op" id="3494197">.</span><span class="ident" id="3494198">r</span><span class="op" id="3494199">:</span><span class="ident" id="3494200">b</span><span class="op" id="3494201">.</span><span class="ident" id="3494202">w</span><span class="op" id="3494203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494208">b</span><span class="op" id="3494209">.</span><span class="ident" id="3494210">r</span>&nbsp;<span class="op" id="3494212">=</span>&nbsp;<span class="ident" id="3494214">b</span><span class="op" id="3494215">.</span><span class="ident" id="3494216">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494221">err</span>&nbsp;<span class="op" id="3494225">=</span>&nbsp;<span class="ident" id="3494227">b</span><span class="op" id="3494228">.</span><span class="ident" id="3494229">readErr</span><span class="op" id="3494236">(</span><span class="op" id="3494237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494242">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494255">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494273">if</span>&nbsp;<span class="ident" id="3494276">b</span><span class="op" id="3494277">.</span><span class="ident" id="3494278">Buffered</span><span class="op" id="3494286">(</span><span class="op" id="3494287">)</span>&nbsp;<span class="op" id="3494289">&gt;=</span>&nbsp;<span class="builtinfunc" id="3494292">len</span><span class="op" id="3494295">(</span><span class="ident" id="3494296">b</span><span class="op" id="3494297">.</span><span class="ident" id="3494298">buf</span><span class="op" id="3494301">)</span>&nbsp;<span class="op" id="3494303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494308">b</span><span class="op" id="3494309">.</span><span class="ident" id="3494310">r</span>&nbsp;<span class="op" id="3494312">=</span>&nbsp;<span class="ident" id="3494314">b</span><span class="op" id="3494315">.</span><span class="ident" id="3494316">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494321">line</span>&nbsp;<span class="op" id="3494326">=</span>&nbsp;<span class="ident" id="3494328">b</span><span class="op" id="3494329">.</span><span class="ident" id="3494330">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494337">err</span>&nbsp;<span class="op" id="3494341">=</span>&nbsp;<span class="ident" id="3494343">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494360">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494373">b</span><span class="op" id="3494374">.</span><span class="ident" id="3494375">fill</span><span class="op" id="3494379">(</span><span class="op" id="3494380">)</span>&nbsp;<span class="comment" id="3494382">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494409">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494439">if</span>&nbsp;<span class="ident" id="3494442">i</span>&nbsp;<span class="op" id="3494444">:=</span>&nbsp;<span class="builtinfunc" id="3494447">len</span><span class="op" id="3494450">(</span><span class="ident" id="3494451">line</span><span class="op" id="3494455">)</span>&nbsp;<span class="op" id="3494457">-</span>&nbsp;<span class="num" id="3494459">1</span><span class="op" id="3494460">;</span>&nbsp;<span class="ident" id="3494462">i</span>&nbsp;<span class="op" id="3494464">&gt;=</span>&nbsp;<span class="num" id="3494467">0</span>&nbsp;<span class="op" id="3494469">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494473">b</span><span class="op" id="3494474">.</span><span class="ident" id="3494475">lastByte</span>&nbsp;<span class="op" id="3494484">=</span>&nbsp;<span class="builtintype" id="3494486">int</span><span class="op" id="3494489">(</span><span class="ident" id="3494490">line</span><span class="op" id="3494494">[</span><span class="ident" id="3494495">i</span><span class="op" id="3494496">]</span><span class="op" id="3494497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494501">b</span><span class="op" id="3494502">.</span><span class="ident" id="3494503">lastRuneSize</span>&nbsp;<span class="op" id="3494516">=</span>&nbsp;<span class="op" id="3494518">-</span><span class="num" id="3494519">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494526">return</span><br>
<span class="lineno">305</span><span class="op" id="3494533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3494536">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3494611">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="3494676">//</span><br>
<span class="lineno">310</span><span class="comment" id="3494679">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3494759">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3494831">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3494907">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="3494985">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="3495058">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="3495134">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="3495149">//</span><br>
<span class="lineno"></span><span class="comment" id="3495152">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="3495235">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="3495314">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3495389">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3495466">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="3495508">func</span>&nbsp;<span class="op" id="3495513">(</span><span class="ident" id="3495514">b</span>&nbsp;<span class="op" id="3495516">*</span><span class="ident" id="3495517">Reader</span><span class="op" id="3495523">)</span>&nbsp;<span class="ident" id="3495525">ReadLine</span><span class="op" id="3495533">(</span><span class="op" id="3495534">)</span>&nbsp;<span class="op" id="3495536">(</span><span class="ident" id="3495537">line</span>&nbsp;<span class="op" id="3495542">[</span><span class="op" id="3495543">]</span><span class="builtintype" id="3495544">byte</span><span class="op" id="3495548">,</span>&nbsp;<span class="ident" id="3495550">isPrefix</span>&nbsp;<span class="builtintype" id="3495559">bool</span><span class="op" id="3495563">,</span>&nbsp;<span class="ident" id="3495565">err</span>&nbsp;<span class="builtintype" id="3495569">error</span><span class="op" id="3495574">)</span>&nbsp;<span class="op" id="3495576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495579">line</span><span class="op" id="3495583">,</span>&nbsp;<span class="ident" id="3495585">err</span>&nbsp;<span class="op" id="3495589">=</span>&nbsp;<span class="ident" id="3495591">b</span><span class="op" id="3495592">.</span><span class="ident" id="3495593">ReadSlice</span><span class="op" id="3495602">(</span><span class="string" id="3495603">&#39;\n&#39;</span><span class="op" id="3495607">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495610">if</span>&nbsp;<span class="ident" id="3495613">err</span>&nbsp;<span class="op" id="3495617">==</span>&nbsp;<span class="ident" id="3495620">ErrBufferFull</span>&nbsp;<span class="op" id="3495634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495638">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495694">if</span>&nbsp;<span class="builtinfunc" id="3495697">len</span><span class="op" id="3495700">(</span><span class="ident" id="3495701">line</span><span class="op" id="3495705">)</span>&nbsp;<span class="op" id="3495707">&gt;</span>&nbsp;<span class="num" id="3495709">0</span>&nbsp;<span class="op" id="3495711">&amp;&amp;</span>&nbsp;<span class="ident" id="3495714">line</span><span class="op" id="3495718">[</span><span class="builtinfunc" id="3495719">len</span><span class="op" id="3495722">(</span><span class="ident" id="3495723">line</span><span class="op" id="3495727">)</span><span class="op" id="3495728">-</span><span class="num" id="3495729">1</span><span class="op" id="3495730">]</span>&nbsp;<span class="op" id="3495732">==</span>&nbsp;<span class="string" id="3495735">&#39;\r&#39;</span>&nbsp;<span class="op" id="3495740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495745">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495799">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495853">if</span>&nbsp;<span class="ident" id="3495856">b</span><span class="op" id="3495857">.</span><span class="ident" id="3495858">r</span>&nbsp;<span class="op" id="3495860">==</span>&nbsp;<span class="num" id="3495863">0</span>&nbsp;<span class="op" id="3495865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495871">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3495900">panic</span><span class="op" id="3495905">(</span><span class="string" id="3495906">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="3495951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495961">b</span><span class="op" id="3495962">.</span><span class="ident" id="3495963">r</span><span class="op" id="3495964">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495970">line</span>&nbsp;<span class="op" id="3495975">=</span>&nbsp;<span class="ident" id="3495977">line</span><span class="op" id="3495981">[</span><span class="op" id="3495982">:</span><span class="builtinfunc" id="3495983">len</span><span class="op" id="3495986">(</span><span class="ident" id="3495987">line</span><span class="op" id="3495991">)</span><span class="op" id="3495992">-</span><span class="num" id="3495993">1</span><span class="op" id="3495994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496002">return</span>&nbsp;<span class="ident" id="3496009">line</span><span class="op" id="3496013">,</span>&nbsp;<span class="builtintype" id="3496015">true</span><span class="op" id="3496019">,</span>&nbsp;<span class="ident" id="3496021">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496030">if</span>&nbsp;<span class="builtinfunc" id="3496033">len</span><span class="op" id="3496036">(</span><span class="ident" id="3496037">line</span><span class="op" id="3496041">)</span>&nbsp;<span class="op" id="3496043">==</span>&nbsp;<span class="num" id="3496046">0</span>&nbsp;<span class="op" id="3496048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496052">if</span>&nbsp;<span class="ident" id="3496055">err</span>&nbsp;<span class="op" id="3496059">!=</span>&nbsp;<span class="ident" id="3496062">nil</span>&nbsp;<span class="op" id="3496066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496071">line</span>&nbsp;<span class="op" id="3496076">=</span>&nbsp;<span class="ident" id="3496078">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496088">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496099">err</span>&nbsp;<span class="op" id="3496103">=</span>&nbsp;<span class="ident" id="3496105">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496111">if</span>&nbsp;<span class="ident" id="3496114">line</span><span class="op" id="3496118">[</span><span class="builtinfunc" id="3496119">len</span><span class="op" id="3496122">(</span><span class="ident" id="3496123">line</span><span class="op" id="3496127">)</span><span class="op" id="3496128">-</span><span class="num" id="3496129">1</span><span class="op" id="3496130">]</span>&nbsp;<span class="op" id="3496132">==</span>&nbsp;<span class="string" id="3496135">&#39;\n&#39;</span>&nbsp;<span class="op" id="3496140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496144">drop</span>&nbsp;<span class="op" id="3496149">:=</span>&nbsp;<span class="num" id="3496152">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496156">if</span>&nbsp;<span class="builtinfunc" id="3496159">len</span><span class="op" id="3496162">(</span><span class="ident" id="3496163">line</span><span class="op" id="3496167">)</span>&nbsp;<span class="op" id="3496169">&gt;</span>&nbsp;<span class="num" id="3496171">1</span>&nbsp;<span class="op" id="3496173">&amp;&amp;</span>&nbsp;<span class="ident" id="3496176">line</span><span class="op" id="3496180">[</span><span class="builtinfunc" id="3496181">len</span><span class="op" id="3496184">(</span><span class="ident" id="3496185">line</span><span class="op" id="3496189">)</span><span class="op" id="3496190">-</span><span class="num" id="3496191">2</span><span class="op" id="3496192">]</span>&nbsp;<span class="op" id="3496194">==</span>&nbsp;<span class="string" id="3496197">&#39;\r&#39;</span>&nbsp;<span class="op" id="3496202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496207">drop</span>&nbsp;<span class="op" id="3496212">=</span>&nbsp;<span class="num" id="3496214">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496222">line</span>&nbsp;<span class="op" id="3496227">=</span>&nbsp;<span class="ident" id="3496229">line</span><span class="op" id="3496233">[</span><span class="op" id="3496234">:</span><span class="builtinfunc" id="3496235">len</span><span class="op" id="3496238">(</span><span class="ident" id="3496239">line</span><span class="op" id="3496243">)</span><span class="op" id="3496244">-</span><span class="ident" id="3496245">drop</span><span class="op" id="3496249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496252">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496255">return</span><br>
<span class="lineno"></span><span class="op" id="3496262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496265">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3496334">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="3496410">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3496474">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3496556">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3496637">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3496647">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="3496701">func</span>&nbsp;<span class="op" id="3496706">(</span><span class="ident" id="3496707">b</span>&nbsp;<span class="op" id="3496709">*</span><span class="ident" id="3496710">Reader</span><span class="op" id="3496716">)</span>&nbsp;<span class="ident" id="3496718">ReadBytes</span><span class="op" id="3496727">(</span><span class="ident" id="3496728">delim</span>&nbsp;<span class="builtintype" id="3496734">byte</span><span class="op" id="3496738">)</span>&nbsp;<span class="op" id="3496740">(</span><span class="ident" id="3496741">line</span>&nbsp;<span class="op" id="3496746">[</span><span class="op" id="3496747">]</span><span class="builtintype" id="3496748">byte</span><span class="op" id="3496752">,</span>&nbsp;<span class="ident" id="3496754">err</span>&nbsp;<span class="builtintype" id="3496758">error</span><span class="op" id="3496763">)</span>&nbsp;<span class="op" id="3496765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3496768">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3496805">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496836">var</span>&nbsp;<span class="ident" id="3496840">frag</span>&nbsp;<span class="op" id="3496845">[</span><span class="op" id="3496846">]</span><span class="builtintype" id="3496847">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496853">var</span>&nbsp;<span class="ident" id="3496857">full</span>&nbsp;<span class="op" id="3496862">[</span><span class="op" id="3496863">]</span><span class="op" id="3496864">[</span><span class="op" id="3496865">]</span><span class="builtintype" id="3496866">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496872">err</span>&nbsp;<span class="op" id="3496876">=</span>&nbsp;<span class="ident" id="3496878">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496884">for</span>&nbsp;<span class="op" id="3496888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496892">var</span>&nbsp;<span class="ident" id="3496896">e</span>&nbsp;<span class="builtintype" id="3496898">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496906">frag</span><span class="op" id="3496910">,</span>&nbsp;<span class="ident" id="3496912">e</span>&nbsp;<span class="op" id="3496914">=</span>&nbsp;<span class="ident" id="3496916">b</span><span class="op" id="3496917">.</span><span class="ident" id="3496918">ReadSlice</span><span class="op" id="3496927">(</span><span class="ident" id="3496928">delim</span><span class="op" id="3496933">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496937">if</span>&nbsp;<span class="ident" id="3496940">e</span>&nbsp;<span class="op" id="3496942">==</span>&nbsp;<span class="ident" id="3496945">nil</span>&nbsp;<span class="op" id="3496949">{</span>&nbsp;<span class="comment" id="3496951">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496976">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496988">if</span>&nbsp;<span class="ident" id="3496991">e</span>&nbsp;<span class="op" id="3496993">!=</span>&nbsp;<span class="ident" id="3496996">ErrBufferFull</span>&nbsp;<span class="op" id="3497010">{</span>&nbsp;<span class="comment" id="3497012">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497035">err</span>&nbsp;<span class="op" id="3497039">=</span>&nbsp;<span class="ident" id="3497041">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497059">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497091">buf</span>&nbsp;<span class="op" id="3497095">:=</span>&nbsp;<span class="builtinfunc" id="3497098">make</span><span class="op" id="3497102">(</span><span class="op" id="3497103">[</span><span class="op" id="3497104">]</span><span class="builtintype" id="3497105">byte</span><span class="op" id="3497109">,</span>&nbsp;<span class="builtinfunc" id="3497111">len</span><span class="op" id="3497114">(</span><span class="ident" id="3497115">frag</span><span class="op" id="3497119">)</span><span class="op" id="3497120">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3497124">copy</span><span class="op" id="3497128">(</span><span class="ident" id="3497129">buf</span><span class="op" id="3497132">,</span>&nbsp;<span class="ident" id="3497134">frag</span><span class="op" id="3497138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497142">full</span>&nbsp;<span class="op" id="3497147">=</span>&nbsp;<span class="builtinfunc" id="3497149">append</span><span class="op" id="3497155">(</span><span class="ident" id="3497156">full</span><span class="op" id="3497160">,</span>&nbsp;<span class="ident" id="3497162">buf</span><span class="op" id="3497165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497172">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497238">n</span>&nbsp;<span class="op" id="3497240">:=</span>&nbsp;<span class="num" id="3497243">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497246">for</span>&nbsp;<span class="ident" id="3497250">i</span>&nbsp;<span class="op" id="3497252">:=</span>&nbsp;<span class="keyword" id="3497255">range</span>&nbsp;<span class="ident" id="3497261">full</span>&nbsp;<span class="op" id="3497266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497270">n</span>&nbsp;<span class="op" id="3497272">+=</span>&nbsp;<span class="builtinfunc" id="3497275">len</span><span class="op" id="3497278">(</span><span class="ident" id="3497279">full</span><span class="op" id="3497283">[</span><span class="ident" id="3497284">i</span><span class="op" id="3497285">]</span><span class="op" id="3497286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497292">n</span>&nbsp;<span class="op" id="3497294">+=</span>&nbsp;<span class="builtinfunc" id="3497297">len</span><span class="op" id="3497300">(</span><span class="ident" id="3497301">frag</span><span class="op" id="3497305">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3497309">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497347">buf</span>&nbsp;<span class="op" id="3497351">:=</span>&nbsp;<span class="builtinfunc" id="3497354">make</span><span class="op" id="3497358">(</span><span class="op" id="3497359">[</span><span class="op" id="3497360">]</span><span class="builtintype" id="3497361">byte</span><span class="op" id="3497365">,</span>&nbsp;<span class="ident" id="3497367">n</span><span class="op" id="3497368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497371">n</span>&nbsp;<span class="op" id="3497373">=</span>&nbsp;<span class="num" id="3497375">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497378">for</span>&nbsp;<span class="ident" id="3497382">i</span>&nbsp;<span class="op" id="3497384">:=</span>&nbsp;<span class="keyword" id="3497387">range</span>&nbsp;<span class="ident" id="3497393">full</span>&nbsp;<span class="op" id="3497398">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497402">n</span>&nbsp;<span class="op" id="3497404">+=</span>&nbsp;<span class="builtinfunc" id="3497407">copy</span><span class="op" id="3497411">(</span><span class="ident" id="3497412">buf</span><span class="op" id="3497415">[</span><span class="ident" id="3497416">n</span><span class="op" id="3497417">:</span><span class="op" id="3497418">]</span><span class="op" id="3497419">,</span>&nbsp;<span class="ident" id="3497421">full</span><span class="op" id="3497425">[</span><span class="ident" id="3497426">i</span><span class="op" id="3497427">]</span><span class="op" id="3497428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3497434">copy</span><span class="op" id="3497438">(</span><span class="ident" id="3497439">buf</span><span class="op" id="3497442">[</span><span class="ident" id="3497443">n</span><span class="op" id="3497444">:</span><span class="op" id="3497445">]</span><span class="op" id="3497446">,</span>&nbsp;<span class="ident" id="3497448">frag</span><span class="op" id="3497452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497455">return</span>&nbsp;<span class="ident" id="3497462">buf</span><span class="op" id="3497465">,</span>&nbsp;<span class="ident" id="3497467">err</span><br>
<span class="lineno"></span><span class="op" id="3497471">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3497474">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3497544">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3497621">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3497686">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="3497768">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3497850">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3497860">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="3497914">func</span>&nbsp;<span class="op" id="3497919">(</span><span class="ident" id="3497920">b</span>&nbsp;<span class="op" id="3497922">*</span><span class="ident" id="3497923">Reader</span><span class="op" id="3497929">)</span>&nbsp;<span class="ident" id="3497931">ReadString</span><span class="op" id="3497941">(</span><span class="ident" id="3497942">delim</span>&nbsp;<span class="builtintype" id="3497948">byte</span><span class="op" id="3497952">)</span>&nbsp;<span class="op" id="3497954">(</span><span class="ident" id="3497955">line</span>&nbsp;<span class="builtintype" id="3497960">string</span><span class="op" id="3497966">,</span>&nbsp;<span class="ident" id="3497968">err</span>&nbsp;<span class="builtintype" id="3497972">error</span><span class="op" id="3497977">)</span>&nbsp;<span class="op" id="3497979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497982">bytes</span><span class="op" id="3497987">,</span>&nbsp;<span class="ident" id="3497989">err</span>&nbsp;<span class="op" id="3497993">:=</span>&nbsp;<span class="ident" id="3497996">b</span><span class="op" id="3497997">.</span><span class="ident" id="3497998">ReadBytes</span><span class="op" id="3498007">(</span><span class="ident" id="3498008">delim</span><span class="op" id="3498013">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498016">line</span>&nbsp;<span class="op" id="3498021">=</span>&nbsp;<span class="builtintype" id="3498023">string</span><span class="op" id="3498029">(</span><span class="ident" id="3498030">bytes</span><span class="op" id="3498035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498038">return</span>&nbsp;<span class="ident" id="3498045">line</span><span class="op" id="3498049">,</span>&nbsp;<span class="ident" id="3498051">err</span><br>
<span class="lineno"></span><span class="op" id="3498055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498058">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="3498093">func</span>&nbsp;<span class="op" id="3498098">(</span><span class="ident" id="3498099">b</span>&nbsp;<span class="op" id="3498101">*</span><span class="ident" id="3498102">Reader</span><span class="op" id="3498108">)</span>&nbsp;<span class="ident" id="3498110">WriteTo</span><span class="op" id="3498117">(</span><span class="ident" id="3498118">w</span>&nbsp;<span class="ident" id="3498120">io</span><span class="op" id="3498122">.</span><span class="ident" id="3498123">Writer</span><span class="op" id="3498129">)</span>&nbsp;<span class="op" id="3498131">(</span><span class="ident" id="3498132">n</span>&nbsp;<span class="ident" id="3498134">int64</span><span class="op" id="3498139">,</span>&nbsp;<span class="ident" id="3498141">err</span>&nbsp;<span class="builtintype" id="3498145">error</span><span class="op" id="3498150">)</span>&nbsp;<span class="op" id="3498152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498155">n</span><span class="op" id="3498156">,</span>&nbsp;<span class="ident" id="3498158">err</span>&nbsp;<span class="op" id="3498162">=</span>&nbsp;<span class="ident" id="3498164">b</span><span class="op" id="3498165">.</span><span class="ident" id="3498166">writeBuf</span><span class="op" id="3498174">(</span><span class="ident" id="3498175">w</span><span class="op" id="3498176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498179">if</span>&nbsp;<span class="ident" id="3498182">err</span>&nbsp;<span class="op" id="3498186">!=</span>&nbsp;<span class="ident" id="3498189">nil</span>&nbsp;<span class="op" id="3498193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498197">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498205">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498209">if</span>&nbsp;<span class="ident" id="3498212">r</span><span class="op" id="3498213">,</span>&nbsp;<span class="ident" id="3498215">ok</span>&nbsp;<span class="op" id="3498218">:=</span>&nbsp;<span class="ident" id="3498221">b</span><span class="op" id="3498222">.</span><span class="ident" id="3498223">rd</span><span class="op" id="3498225">.</span><span class="op" id="3498226">(</span><span class="ident" id="3498227">io</span><span class="op" id="3498229">.</span><span class="ident" id="3498230">WriterTo</span><span class="op" id="3498238">)</span><span class="op" id="3498239">;</span>&nbsp;<span class="ident" id="3498241">ok</span>&nbsp;<span class="op" id="3498244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498248">m</span><span class="op" id="3498249">,</span>&nbsp;<span class="ident" id="3498251">err</span>&nbsp;<span class="op" id="3498255">:=</span>&nbsp;<span class="ident" id="3498258">r</span><span class="op" id="3498259">.</span><span class="ident" id="3498260">WriteTo</span><span class="op" id="3498267">(</span><span class="ident" id="3498268">w</span><span class="op" id="3498269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498273">n</span>&nbsp;<span class="op" id="3498275">+=</span>&nbsp;<span class="ident" id="3498278">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498282">return</span>&nbsp;<span class="ident" id="3498289">n</span><span class="op" id="3498290">,</span>&nbsp;<span class="ident" id="3498292">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498301">if</span>&nbsp;<span class="ident" id="3498304">w</span><span class="op" id="3498305">,</span>&nbsp;<span class="ident" id="3498307">ok</span>&nbsp;<span class="op" id="3498310">:=</span>&nbsp;<span class="ident" id="3498313">w</span><span class="op" id="3498314">.</span><span class="op" id="3498315">(</span><span class="ident" id="3498316">io</span><span class="op" id="3498318">.</span><span class="ident" id="3498319">ReaderFrom</span><span class="op" id="3498329">)</span><span class="op" id="3498330">;</span>&nbsp;<span class="ident" id="3498332">ok</span>&nbsp;<span class="op" id="3498335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498339">m</span><span class="op" id="3498340">,</span>&nbsp;<span class="ident" id="3498342">err</span>&nbsp;<span class="op" id="3498346">:=</span>&nbsp;<span class="ident" id="3498349">w</span><span class="op" id="3498350">.</span><span class="ident" id="3498351">ReadFrom</span><span class="op" id="3498359">(</span><span class="ident" id="3498360">b</span><span class="op" id="3498361">.</span><span class="ident" id="3498362">rd</span><span class="op" id="3498364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498368">n</span>&nbsp;<span class="op" id="3498370">+=</span>&nbsp;<span class="ident" id="3498373">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498377">return</span>&nbsp;<span class="ident" id="3498384">n</span><span class="op" id="3498385">,</span>&nbsp;<span class="ident" id="3498387">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498396">if</span>&nbsp;<span class="ident" id="3498399">b</span><span class="op" id="3498400">.</span><span class="ident" id="3498401">w</span><span class="op" id="3498402">-</span><span class="ident" id="3498403">b</span><span class="op" id="3498404">.</span><span class="ident" id="3498405">r</span>&nbsp;<span class="op" id="3498407">&lt;</span>&nbsp;<span class="builtinfunc" id="3498409">len</span><span class="op" id="3498412">(</span><span class="ident" id="3498413">b</span><span class="op" id="3498414">.</span><span class="ident" id="3498415">buf</span><span class="op" id="3498418">)</span>&nbsp;<span class="op" id="3498420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498424">b</span><span class="op" id="3498425">.</span><span class="ident" id="3498426">fill</span><span class="op" id="3498430">(</span><span class="op" id="3498431">)</span>&nbsp;<span class="comment" id="3498433">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498457">for</span>&nbsp;<span class="ident" id="3498461">b</span><span class="op" id="3498462">.</span><span class="ident" id="3498463">r</span>&nbsp;<span class="op" id="3498465">&lt;</span>&nbsp;<span class="ident" id="3498467">b</span><span class="op" id="3498468">.</span><span class="ident" id="3498469">w</span>&nbsp;<span class="op" id="3498471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3498475">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498513">m</span><span class="op" id="3498514">,</span>&nbsp;<span class="ident" id="3498516">err</span>&nbsp;<span class="op" id="3498520">:=</span>&nbsp;<span class="ident" id="3498523">b</span><span class="op" id="3498524">.</span><span class="ident" id="3498525">writeBuf</span><span class="op" id="3498533">(</span><span class="ident" id="3498534">w</span><span class="op" id="3498535">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498539">n</span>&nbsp;<span class="op" id="3498541">+=</span>&nbsp;<span class="ident" id="3498544">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498548">if</span>&nbsp;<span class="ident" id="3498551">err</span>&nbsp;<span class="op" id="3498555">!=</span>&nbsp;<span class="ident" id="3498558">nil</span>&nbsp;<span class="op" id="3498562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498567">return</span>&nbsp;<span class="ident" id="3498574">n</span><span class="op" id="3498575">,</span>&nbsp;<span class="ident" id="3498577">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498587">b</span><span class="op" id="3498588">.</span><span class="ident" id="3498589">fill</span><span class="op" id="3498593">(</span><span class="op" id="3498594">)</span>&nbsp;<span class="comment" id="3498596">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498620">if</span>&nbsp;<span class="ident" id="3498623">b</span><span class="op" id="3498624">.</span><span class="ident" id="3498625">err</span>&nbsp;<span class="op" id="3498629">==</span>&nbsp;<span class="ident" id="3498632">io</span><span class="op" id="3498634">.</span><span class="ident" id="3498635">EOF</span>&nbsp;<span class="op" id="3498639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498643">b</span><span class="op" id="3498644">.</span><span class="ident" id="3498645">err</span>&nbsp;<span class="op" id="3498649">=</span>&nbsp;<span class="ident" id="3498651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498656">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498660">return</span>&nbsp;<span class="ident" id="3498667">n</span><span class="op" id="3498668">,</span>&nbsp;<span class="ident" id="3498670">b</span><span class="op" id="3498671">.</span><span class="ident" id="3498672">readErr</span><span class="op" id="3498679">(</span><span class="op" id="3498680">)</span><br>
<span class="lineno"></span><span class="op" id="3498682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3498685">var</span>&nbsp;<span class="ident" id="3498689">errNegativeWrite</span>&nbsp;<span class="op" id="3498706">=</span>&nbsp;<span class="ident" id="3498708">errors</span><span class="op" id="3498714">.</span><span class="ident" id="3498715">New</span><span class="op" id="3498718">(</span><span class="string" id="3498719">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="3498769">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3498772">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3498826">func</span>&nbsp;<span class="op" id="3498831">(</span><span class="ident" id="3498832">b</span>&nbsp;<span class="op" id="3498834">*</span><span class="ident" id="3498835">Reader</span><span class="op" id="3498841">)</span>&nbsp;<span class="ident" id="3498843">writeBuf</span><span class="op" id="3498851">(</span><span class="ident" id="3498852">w</span>&nbsp;<span class="ident" id="3498854">io</span><span class="op" id="3498856">.</span><span class="ident" id="3498857">Writer</span><span class="op" id="3498863">)</span>&nbsp;<span class="op" id="3498865">(</span><span class="ident" id="3498866">int64</span><span class="op" id="3498871">,</span>&nbsp;<span class="builtintype" id="3498873">error</span><span class="op" id="3498878">)</span>&nbsp;<span class="op" id="3498880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498883">n</span><span class="op" id="3498884">,</span>&nbsp;<span class="ident" id="3498886">err</span>&nbsp;<span class="op" id="3498890">:=</span>&nbsp;<span class="ident" id="3498893">w</span><span class="op" id="3498894">.</span><span class="ident" id="3498895">Write</span><span class="op" id="3498900">(</span><span class="ident" id="3498901">b</span><span class="op" id="3498902">.</span><span class="ident" id="3498903">buf</span><span class="op" id="3498906">[</span><span class="ident" id="3498907">b</span><span class="op" id="3498908">.</span><span class="ident" id="3498909">r</span><span class="op" id="3498910">:</span><span class="ident" id="3498911">b</span><span class="op" id="3498912">.</span><span class="ident" id="3498913">w</span><span class="op" id="3498914">]</span><span class="op" id="3498915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498918">if</span>&nbsp;<span class="ident" id="3498921">n</span>&nbsp;<span class="op" id="3498923">&lt;</span>&nbsp;<span class="num" id="3498925">0</span>&nbsp;<span class="op" id="3498927">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3498931">panic</span><span class="op" id="3498936">(</span><span class="ident" id="3498937">errNegativeWrite</span><span class="op" id="3498953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498959">b</span><span class="op" id="3498960">.</span><span class="ident" id="3498961">r</span>&nbsp;<span class="op" id="3498963">+=</span>&nbsp;<span class="ident" id="3498966">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498969">return</span>&nbsp;<span class="ident" id="3498976">int64</span><span class="op" id="3498981">(</span><span class="ident" id="3498982">n</span><span class="op" id="3498983">)</span><span class="op" id="3498984">,</span>&nbsp;<span class="ident" id="3498986">err</span><br>
<span class="lineno"></span><span class="op" id="3498990">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3498993">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3499013">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3499069">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="3499133">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3499194">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3499257">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3499317">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3499346">type</span>&nbsp;<span class="ident" id="3499351">Writer</span>&nbsp;<span class="keyword" id="3499358">struct</span>&nbsp;<span class="op" id="3499365">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499368">err</span>&nbsp;<span class="builtintype" id="3499372">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499379">buf</span>&nbsp;<span class="op" id="3499383">[</span><span class="op" id="3499384">]</span><span class="builtintype" id="3499385">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499391">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3499395">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499400">wr</span>&nbsp;&nbsp;<span class="ident" id="3499404">io</span><span class="op" id="3499406">.</span><span class="ident" id="3499407">Writer</span><br>
<span class="lineno"></span><span class="op" id="3499414">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="3499417">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3499495">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="3499568">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3499611">func</span>&nbsp;<span class="ident" id="3499616">NewWriterSize</span><span class="op" id="3499629">(</span><span class="ident" id="3499630">w</span>&nbsp;<span class="ident" id="3499632">io</span><span class="op" id="3499634">.</span><span class="ident" id="3499635">Writer</span><span class="op" id="3499641">,</span>&nbsp;<span class="ident" id="3499643">size</span>&nbsp;<span class="builtintype" id="3499648">int</span><span class="op" id="3499651">)</span>&nbsp;<span class="op" id="3499653">*</span><span class="ident" id="3499654">Writer</span>&nbsp;<span class="op" id="3499661">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3499664">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499692">b</span><span class="op" id="3499693">,</span>&nbsp;<span class="ident" id="3499695">ok</span>&nbsp;<span class="op" id="3499698">:=</span>&nbsp;<span class="ident" id="3499701">w</span><span class="op" id="3499702">.</span><span class="op" id="3499703">(</span><span class="op" id="3499704">*</span><span class="ident" id="3499705">Writer</span><span class="op" id="3499711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499714">if</span>&nbsp;<span class="ident" id="3499717">ok</span>&nbsp;<span class="op" id="3499720">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3499723">len</span><span class="op" id="3499726">(</span><span class="ident" id="3499727">b</span><span class="op" id="3499728">.</span><span class="ident" id="3499729">buf</span><span class="op" id="3499732">)</span>&nbsp;<span class="op" id="3499734">&gt;=</span>&nbsp;<span class="ident" id="3499737">size</span>&nbsp;<span class="op" id="3499742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499746">return</span>&nbsp;<span class="ident" id="3499753">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499756">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499759">if</span>&nbsp;<span class="ident" id="3499762">size</span>&nbsp;<span class="op" id="3499767">&lt;=</span>&nbsp;<span class="num" id="3499770">0</span>&nbsp;<span class="op" id="3499772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499776">size</span>&nbsp;<span class="op" id="3499781">=</span>&nbsp;<span class="ident" id="3499783">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499802">return</span>&nbsp;<span class="op" id="3499809">&amp;</span><span class="ident" id="3499810">Writer</span><span class="op" id="3499816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499820">buf</span><span class="op" id="3499823">:</span>&nbsp;<span class="builtinfunc" id="3499825">make</span><span class="op" id="3499829">(</span><span class="op" id="3499830">[</span><span class="op" id="3499831">]</span><span class="builtintype" id="3499832">byte</span><span class="op" id="3499836">,</span>&nbsp;<span class="ident" id="3499838">size</span><span class="op" id="3499842">)</span><span class="op" id="3499843">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3499847">wr</span><span class="op" id="3499849">:</span>&nbsp;&nbsp;<span class="ident" id="3499852">w</span><span class="op" id="3499853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3499856">}</span><br>
<span class="lineno"></span><span class="op" id="3499858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3499861">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="3499930">func</span>&nbsp;<span class="ident" id="3499935">NewWriter</span><span class="op" id="3499944">(</span><span class="ident" id="3499945">w</span>&nbsp;<span class="ident" id="3499947">io</span><span class="op" id="3499949">.</span><span class="ident" id="3499950">Writer</span><span class="op" id="3499956">)</span>&nbsp;<span class="op" id="3499958">*</span><span class="ident" id="3499959">Writer</span>&nbsp;<span class="op" id="3499966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3499969">return</span>&nbsp;<span class="ident" id="3499976">NewWriterSize</span><span class="op" id="3499989">(</span><span class="ident" id="3499990">w</span><span class="op" id="3499991">,</span>&nbsp;<span class="ident" id="3499993">defaultBufSize</span><span class="op" id="3500007">)</span><br>
<span class="lineno"></span><span class="op" id="3500009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500012">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="3500081">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3500119">func</span>&nbsp;<span class="op" id="3500124">(</span><span class="ident" id="3500125">b</span>&nbsp;<span class="op" id="3500127">*</span><span class="ident" id="3500128">Writer</span><span class="op" id="3500134">)</span>&nbsp;<span class="ident" id="3500136">Reset</span><span class="op" id="3500141">(</span><span class="ident" id="3500142">w</span>&nbsp;<span class="ident" id="3500144">io</span><span class="op" id="3500146">.</span><span class="ident" id="3500147">Writer</span><span class="op" id="3500153">)</span>&nbsp;<span class="op" id="3500155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500158">b</span><span class="op" id="3500159">.</span><span class="ident" id="3500160">err</span>&nbsp;<span class="op" id="3500164">=</span>&nbsp;<span class="ident" id="3500166">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500171">b</span><span class="op" id="3500172">.</span><span class="ident" id="3500173">n</span>&nbsp;<span class="op" id="3500175">=</span>&nbsp;<span class="num" id="3500177">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500180">b</span><span class="op" id="3500181">.</span><span class="ident" id="3500182">wr</span>&nbsp;<span class="op" id="3500185">=</span>&nbsp;<span class="ident" id="3500187">w</span><br>
<span class="lineno">515</span><span class="op" id="3500189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500192">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3500255">func</span>&nbsp;<span class="op" id="3500260">(</span><span class="ident" id="3500261">b</span>&nbsp;<span class="op" id="3500263">*</span><span class="ident" id="3500264">Writer</span><span class="op" id="3500270">)</span>&nbsp;<span class="ident" id="3500272">Flush</span><span class="op" id="3500277">(</span><span class="op" id="3500278">)</span>&nbsp;<span class="builtintype" id="3500280">error</span>&nbsp;<span class="op" id="3500286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500289">err</span>&nbsp;<span class="op" id="3500293">:=</span>&nbsp;<span class="ident" id="3500296">b</span><span class="op" id="3500297">.</span><span class="ident" id="3500298">flush</span><span class="op" id="3500303">(</span><span class="op" id="3500304">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500307">return</span>&nbsp;<span class="ident" id="3500314">err</span><br>
<span class="lineno"></span><span class="op" id="3500318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3500321">func</span>&nbsp;<span class="op" id="3500326">(</span><span class="ident" id="3500327">b</span>&nbsp;<span class="op" id="3500329">*</span><span class="ident" id="3500330">Writer</span><span class="op" id="3500336">)</span>&nbsp;<span class="ident" id="3500338">flush</span><span class="op" id="3500343">(</span><span class="op" id="3500344">)</span>&nbsp;<span class="builtintype" id="3500346">error</span>&nbsp;<span class="op" id="3500352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500355">if</span>&nbsp;<span class="ident" id="3500358">b</span><span class="op" id="3500359">.</span><span class="ident" id="3500360">err</span>&nbsp;<span class="op" id="3500364">!=</span>&nbsp;<span class="ident" id="3500367">nil</span>&nbsp;<span class="op" id="3500371">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500375">return</span>&nbsp;<span class="ident" id="3500382">b</span><span class="op" id="3500383">.</span><span class="ident" id="3500384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500392">if</span>&nbsp;<span class="ident" id="3500395">b</span><span class="op" id="3500396">.</span><span class="ident" id="3500397">n</span>&nbsp;<span class="op" id="3500399">==</span>&nbsp;<span class="num" id="3500402">0</span>&nbsp;<span class="op" id="3500404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500408">return</span>&nbsp;<span class="ident" id="3500415">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500420">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500423">n</span><span class="op" id="3500424">,</span>&nbsp;<span class="ident" id="3500426">err</span>&nbsp;<span class="op" id="3500430">:=</span>&nbsp;<span class="ident" id="3500433">b</span><span class="op" id="3500434">.</span><span class="ident" id="3500435">wr</span><span class="op" id="3500437">.</span><span class="ident" id="3500438">Write</span><span class="op" id="3500443">(</span><span class="ident" id="3500444">b</span><span class="op" id="3500445">.</span><span class="ident" id="3500446">buf</span><span class="op" id="3500449">[</span><span class="num" id="3500450">0</span><span class="op" id="3500451">:</span><span class="ident" id="3500452">b</span><span class="op" id="3500453">.</span><span class="ident" id="3500454">n</span><span class="op" id="3500455">]</span><span class="op" id="3500456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500459">if</span>&nbsp;<span class="ident" id="3500462">n</span>&nbsp;<span class="op" id="3500464">&lt;</span>&nbsp;<span class="ident" id="3500466">b</span><span class="op" id="3500467">.</span><span class="ident" id="3500468">n</span>&nbsp;<span class="op" id="3500470">&amp;&amp;</span>&nbsp;<span class="ident" id="3500473">err</span>&nbsp;<span class="op" id="3500477">==</span>&nbsp;<span class="ident" id="3500480">nil</span>&nbsp;<span class="op" id="3500484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500488">err</span>&nbsp;<span class="op" id="3500492">=</span>&nbsp;<span class="ident" id="3500494">io</span><span class="op" id="3500496">.</span><span class="ident" id="3500497">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500515">if</span>&nbsp;<span class="ident" id="3500518">err</span>&nbsp;<span class="op" id="3500522">!=</span>&nbsp;<span class="ident" id="3500525">nil</span>&nbsp;<span class="op" id="3500529">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500533">if</span>&nbsp;<span class="ident" id="3500536">n</span>&nbsp;<span class="op" id="3500538">&gt;</span>&nbsp;<span class="num" id="3500540">0</span>&nbsp;<span class="op" id="3500542">&amp;&amp;</span>&nbsp;<span class="ident" id="3500545">n</span>&nbsp;<span class="op" id="3500547">&lt;</span>&nbsp;<span class="ident" id="3500549">b</span><span class="op" id="3500550">.</span><span class="ident" id="3500551">n</span>&nbsp;<span class="op" id="3500553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3500558">copy</span><span class="op" id="3500562">(</span><span class="ident" id="3500563">b</span><span class="op" id="3500564">.</span><span class="ident" id="3500565">buf</span><span class="op" id="3500568">[</span><span class="num" id="3500569">0</span><span class="op" id="3500570">:</span><span class="ident" id="3500571">b</span><span class="op" id="3500572">.</span><span class="ident" id="3500573">n</span><span class="op" id="3500574">-</span><span class="ident" id="3500575">n</span><span class="op" id="3500576">]</span><span class="op" id="3500577">,</span>&nbsp;<span class="ident" id="3500579">b</span><span class="op" id="3500580">.</span><span class="ident" id="3500581">buf</span><span class="op" id="3500584">[</span><span class="ident" id="3500585">n</span><span class="op" id="3500586">:</span><span class="ident" id="3500587">b</span><span class="op" id="3500588">.</span><span class="ident" id="3500589">n</span><span class="op" id="3500590">]</span><span class="op" id="3500591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500599">b</span><span class="op" id="3500600">.</span><span class="ident" id="3500601">n</span>&nbsp;<span class="op" id="3500603">-=</span>&nbsp;<span class="ident" id="3500606">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500610">b</span><span class="op" id="3500611">.</span><span class="ident" id="3500612">err</span>&nbsp;<span class="op" id="3500616">=</span>&nbsp;<span class="ident" id="3500618">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500624">return</span>&nbsp;<span class="ident" id="3500631">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3500636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3500639">b</span><span class="op" id="3500640">.</span><span class="ident" id="3500641">n</span>&nbsp;<span class="op" id="3500643">=</span>&nbsp;<span class="num" id="3500645">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3500648">return</span>&nbsp;<span class="ident" id="3500655">nil</span><br>
<span class="lineno"></span><span class="op" id="3500659">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3500662">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3500724">func</span>&nbsp;<span class="op" id="3500729">(</span><span class="ident" id="3500730">b</span>&nbsp;<span class="op" id="3500732">*</span><span class="ident" id="3500733">Writer</span><span class="op" id="3500739">)</span>&nbsp;<span class="ident" id="3500741">Available</span><span class="op" id="3500750">(</span><span class="op" id="3500751">)</span>&nbsp;<span class="builtintype" id="3500753">int</span>&nbsp;<span class="op" id="3500757">{</span>&nbsp;<span class="keyword" id="3500759">return</span>&nbsp;<span class="builtinfunc" id="3500766">len</span><span class="op" id="3500769">(</span><span class="ident" id="3500770">b</span><span class="op" id="3500771">.</span><span class="ident" id="3500772">buf</span><span class="op" id="3500775">)</span>&nbsp;<span class="op" id="3500777">-</span>&nbsp;<span class="ident" id="3500779">b</span><span class="op" id="3500780">.</span><span class="ident" id="3500781">n</span>&nbsp;<span class="op" id="3500783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500786">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="3500874">func</span>&nbsp;<span class="op" id="3500879">(</span><span class="ident" id="3500880">b</span>&nbsp;<span class="op" id="3500882">*</span><span class="ident" id="3500883">Writer</span><span class="op" id="3500889">)</span>&nbsp;<span class="ident" id="3500891">Buffered</span><span class="op" id="3500899">(</span><span class="op" id="3500900">)</span>&nbsp;<span class="builtintype" id="3500902">int</span>&nbsp;<span class="op" id="3500906">{</span>&nbsp;<span class="keyword" id="3500908">return</span>&nbsp;<span class="ident" id="3500915">b</span><span class="op" id="3500916">.</span><span class="ident" id="3500917">n</span>&nbsp;<span class="op" id="3500919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500922">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3500973">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3501016">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="3501071">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3501098">func</span>&nbsp;<span class="op" id="3501103">(</span><span class="ident" id="3501104">b</span>&nbsp;<span class="op" id="3501106">*</span><span class="ident" id="3501107">Writer</span><span class="op" id="3501113">)</span>&nbsp;<span class="ident" id="3501115">Write</span><span class="op" id="3501120">(</span><span class="ident" id="3501121">p</span>&nbsp;<span class="op" id="3501123">[</span><span class="op" id="3501124">]</span><span class="builtintype" id="3501125">byte</span><span class="op" id="3501129">)</span>&nbsp;<span class="op" id="3501131">(</span><span class="ident" id="3501132">nn</span>&nbsp;<span class="builtintype" id="3501135">int</span><span class="op" id="3501138">,</span>&nbsp;<span class="ident" id="3501140">err</span>&nbsp;<span class="builtintype" id="3501144">error</span><span class="op" id="3501149">)</span>&nbsp;<span class="op" id="3501151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501154">for</span>&nbsp;<span class="builtinfunc" id="3501158">len</span><span class="op" id="3501161">(</span><span class="ident" id="3501162">p</span><span class="op" id="3501163">)</span>&nbsp;<span class="op" id="3501165">&gt;</span>&nbsp;<span class="ident" id="3501167">b</span><span class="op" id="3501168">.</span><span class="ident" id="3501169">Available</span><span class="op" id="3501178">(</span><span class="op" id="3501179">)</span>&nbsp;<span class="op" id="3501181">&amp;&amp;</span>&nbsp;<span class="ident" id="3501184">b</span><span class="op" id="3501185">.</span><span class="ident" id="3501186">err</span>&nbsp;<span class="op" id="3501190">==</span>&nbsp;<span class="ident" id="3501193">nil</span>&nbsp;<span class="op" id="3501197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501201">var</span>&nbsp;<span class="ident" id="3501205">n</span>&nbsp;<span class="builtintype" id="3501207">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501213">if</span>&nbsp;<span class="ident" id="3501216">b</span><span class="op" id="3501217">.</span><span class="ident" id="3501218">Buffered</span><span class="op" id="3501226">(</span><span class="op" id="3501227">)</span>&nbsp;<span class="op" id="3501229">==</span>&nbsp;<span class="num" id="3501232">0</span>&nbsp;<span class="op" id="3501234">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501239">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3501272">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501315">n</span><span class="op" id="3501316">,</span>&nbsp;<span class="ident" id="3501318">b</span><span class="op" id="3501319">.</span><span class="ident" id="3501320">err</span>&nbsp;<span class="op" id="3501324">=</span>&nbsp;<span class="ident" id="3501326">b</span><span class="op" id="3501327">.</span><span class="ident" id="3501328">wr</span><span class="op" id="3501330">.</span><span class="ident" id="3501331">Write</span><span class="op" id="3501336">(</span><span class="ident" id="3501337">p</span><span class="op" id="3501338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501342">}</span>&nbsp;<span class="keyword" id="3501344">else</span>&nbsp;<span class="op" id="3501349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501354">n</span>&nbsp;<span class="op" id="3501356">=</span>&nbsp;<span class="builtinfunc" id="3501358">copy</span><span class="op" id="3501362">(</span><span class="ident" id="3501363">b</span><span class="op" id="3501364">.</span><span class="ident" id="3501365">buf</span><span class="op" id="3501368">[</span><span class="ident" id="3501369">b</span><span class="op" id="3501370">.</span><span class="ident" id="3501371">n</span><span class="op" id="3501372">:</span><span class="op" id="3501373">]</span><span class="op" id="3501374">,</span>&nbsp;<span class="ident" id="3501376">p</span><span class="op" id="3501377">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501382">b</span><span class="op" id="3501383">.</span><span class="ident" id="3501384">n</span>&nbsp;<span class="op" id="3501386">+=</span>&nbsp;<span class="ident" id="3501389">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501394">b</span><span class="op" id="3501395">.</span><span class="ident" id="3501396">flush</span><span class="op" id="3501401">(</span><span class="op" id="3501402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501410">nn</span>&nbsp;<span class="op" id="3501413">+=</span>&nbsp;<span class="ident" id="3501416">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501420">p</span>&nbsp;<span class="op" id="3501422">=</span>&nbsp;<span class="ident" id="3501424">p</span><span class="op" id="3501425">[</span><span class="ident" id="3501426">n</span><span class="op" id="3501427">:</span><span class="op" id="3501428">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501434">if</span>&nbsp;<span class="ident" id="3501437">b</span><span class="op" id="3501438">.</span><span class="ident" id="3501439">err</span>&nbsp;<span class="op" id="3501443">!=</span>&nbsp;<span class="ident" id="3501446">nil</span>&nbsp;<span class="op" id="3501450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501454">return</span>&nbsp;<span class="ident" id="3501461">nn</span><span class="op" id="3501463">,</span>&nbsp;<span class="ident" id="3501465">b</span><span class="op" id="3501466">.</span><span class="ident" id="3501467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501475">n</span>&nbsp;<span class="op" id="3501477">:=</span>&nbsp;<span class="builtinfunc" id="3501480">copy</span><span class="op" id="3501484">(</span><span class="ident" id="3501485">b</span><span class="op" id="3501486">.</span><span class="ident" id="3501487">buf</span><span class="op" id="3501490">[</span><span class="ident" id="3501491">b</span><span class="op" id="3501492">.</span><span class="ident" id="3501493">n</span><span class="op" id="3501494">:</span><span class="op" id="3501495">]</span><span class="op" id="3501496">,</span>&nbsp;<span class="ident" id="3501498">p</span><span class="op" id="3501499">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501502">b</span><span class="op" id="3501503">.</span><span class="ident" id="3501504">n</span>&nbsp;<span class="op" id="3501506">+=</span>&nbsp;<span class="ident" id="3501509">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501512">nn</span>&nbsp;<span class="op" id="3501515">+=</span>&nbsp;<span class="ident" id="3501518">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501521">return</span>&nbsp;<span class="ident" id="3501528">nn</span><span class="op" id="3501530">,</span>&nbsp;<span class="ident" id="3501532">nil</span><br>
<span class="lineno"></span><span class="op" id="3501536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3501539">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3501574">func</span>&nbsp;<span class="op" id="3501579">(</span><span class="ident" id="3501580">b</span>&nbsp;<span class="op" id="3501582">*</span><span class="ident" id="3501583">Writer</span><span class="op" id="3501589">)</span>&nbsp;<span class="ident" id="3501591">WriteByte</span><span class="op" id="3501600">(</span><span class="ident" id="3501601">c</span>&nbsp;<span class="builtintype" id="3501603">byte</span><span class="op" id="3501607">)</span>&nbsp;<span class="builtintype" id="3501609">error</span>&nbsp;<span class="op" id="3501615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501618">if</span>&nbsp;<span class="ident" id="3501621">b</span><span class="op" id="3501622">.</span><span class="ident" id="3501623">err</span>&nbsp;<span class="op" id="3501627">!=</span>&nbsp;<span class="ident" id="3501630">nil</span>&nbsp;<span class="op" id="3501634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501638">return</span>&nbsp;<span class="ident" id="3501645">b</span><span class="op" id="3501646">.</span><span class="ident" id="3501647">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501652">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501655">if</span>&nbsp;<span class="ident" id="3501658">b</span><span class="op" id="3501659">.</span><span class="ident" id="3501660">Available</span><span class="op" id="3501669">(</span><span class="op" id="3501670">)</span>&nbsp;<span class="op" id="3501672">&lt;=</span>&nbsp;<span class="num" id="3501675">0</span>&nbsp;<span class="op" id="3501677">&amp;&amp;</span>&nbsp;<span class="ident" id="3501680">b</span><span class="op" id="3501681">.</span><span class="ident" id="3501682">flush</span><span class="op" id="3501687">(</span><span class="op" id="3501688">)</span>&nbsp;<span class="op" id="3501690">!=</span>&nbsp;<span class="ident" id="3501693">nil</span>&nbsp;<span class="op" id="3501697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501701">return</span>&nbsp;<span class="ident" id="3501708">b</span><span class="op" id="3501709">.</span><span class="ident" id="3501710">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3501715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501718">b</span><span class="op" id="3501719">.</span><span class="ident" id="3501720">buf</span><span class="op" id="3501723">[</span><span class="ident" id="3501724">b</span><span class="op" id="3501725">.</span><span class="ident" id="3501726">n</span><span class="op" id="3501727">]</span>&nbsp;<span class="op" id="3501729">=</span>&nbsp;<span class="ident" id="3501731">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501734">b</span><span class="op" id="3501735">.</span><span class="ident" id="3501736">n</span><span class="op" id="3501737">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501741">return</span>&nbsp;<span class="ident" id="3501748">nil</span><br>
<span class="lineno"></span><span class="op" id="3501752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3501755">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="3501814">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="3501860">func</span>&nbsp;<span class="op" id="3501865">(</span><span class="ident" id="3501866">b</span>&nbsp;<span class="op" id="3501868">*</span><span class="ident" id="3501869">Writer</span><span class="op" id="3501875">)</span>&nbsp;<span class="ident" id="3501877">WriteRune</span><span class="op" id="3501886">(</span><span class="ident" id="3501887">r</span>&nbsp;<span class="builtintype" id="3501889">rune</span><span class="op" id="3501893">)</span>&nbsp;<span class="op" id="3501895">(</span><span class="ident" id="3501896">size</span>&nbsp;<span class="builtintype" id="3501901">int</span><span class="op" id="3501904">,</span>&nbsp;<span class="ident" id="3501906">err</span>&nbsp;<span class="builtintype" id="3501910">error</span><span class="op" id="3501915">)</span>&nbsp;<span class="op" id="3501917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501920">if</span>&nbsp;<span class="ident" id="3501923">r</span>&nbsp;<span class="op" id="3501925">&lt;</span>&nbsp;<span class="ident" id="3501927">utf8</span><span class="op" id="3501931">.</span><span class="ident" id="3501932">RuneSelf</span>&nbsp;<span class="op" id="3501941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3501945">err</span>&nbsp;<span class="op" id="3501949">=</span>&nbsp;<span class="ident" id="3501951">b</span><span class="op" id="3501952">.</span><span class="ident" id="3501953">WriteByte</span><span class="op" id="3501962">(</span><span class="builtintype" id="3501963">byte</span><span class="op" id="3501967">(</span><span class="ident" id="3501968">r</span><span class="op" id="3501969">)</span><span class="op" id="3501970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501974">if</span>&nbsp;<span class="ident" id="3501977">err</span>&nbsp;<span class="op" id="3501981">!=</span>&nbsp;<span class="ident" id="3501984">nil</span>&nbsp;<span class="op" id="3501988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3501993">return</span>&nbsp;<span class="num" id="3502000">0</span><span class="op" id="3502001">,</span>&nbsp;<span class="ident" id="3502003">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502013">return</span>&nbsp;<span class="num" id="3502020">1</span><span class="op" id="3502021">,</span>&nbsp;<span class="ident" id="3502023">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502031">if</span>&nbsp;<span class="ident" id="3502034">b</span><span class="op" id="3502035">.</span><span class="ident" id="3502036">err</span>&nbsp;<span class="op" id="3502040">!=</span>&nbsp;<span class="ident" id="3502043">nil</span>&nbsp;<span class="op" id="3502047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502051">return</span>&nbsp;<span class="num" id="3502058">0</span><span class="op" id="3502059">,</span>&nbsp;<span class="ident" id="3502061">b</span><span class="op" id="3502062">.</span><span class="ident" id="3502063">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502071">n</span>&nbsp;<span class="op" id="3502073">:=</span>&nbsp;<span class="ident" id="3502076">b</span><span class="op" id="3502077">.</span><span class="ident" id="3502078">Available</span><span class="op" id="3502087">(</span><span class="op" id="3502088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502091">if</span>&nbsp;<span class="ident" id="3502094">n</span>&nbsp;<span class="op" id="3502096">&lt;</span>&nbsp;<span class="ident" id="3502098">utf8</span><span class="op" id="3502102">.</span><span class="ident" id="3502103">UTFMax</span>&nbsp;<span class="op" id="3502110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502114">if</span>&nbsp;<span class="ident" id="3502117">b</span><span class="op" id="3502118">.</span><span class="ident" id="3502119">flush</span><span class="op" id="3502124">(</span><span class="op" id="3502125">)</span><span class="op" id="3502126">;</span>&nbsp;<span class="ident" id="3502128">b</span><span class="op" id="3502129">.</span><span class="ident" id="3502130">err</span>&nbsp;<span class="op" id="3502134">!=</span>&nbsp;<span class="ident" id="3502137">nil</span>&nbsp;<span class="op" id="3502141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502146">return</span>&nbsp;<span class="num" id="3502153">0</span><span class="op" id="3502154">,</span>&nbsp;<span class="ident" id="3502156">b</span><span class="op" id="3502157">.</span><span class="ident" id="3502158">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502168">n</span>&nbsp;<span class="op" id="3502170">=</span>&nbsp;<span class="ident" id="3502172">b</span><span class="op" id="3502173">.</span><span class="ident" id="3502174">Available</span><span class="op" id="3502183">(</span><span class="op" id="3502184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502188">if</span>&nbsp;<span class="ident" id="3502191">n</span>&nbsp;<span class="op" id="3502193">&lt;</span>&nbsp;<span class="ident" id="3502195">utf8</span><span class="op" id="3502199">.</span><span class="ident" id="3502200">UTFMax</span>&nbsp;<span class="op" id="3502207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3502212">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502260">return</span>&nbsp;<span class="ident" id="3502267">b</span><span class="op" id="3502268">.</span><span class="ident" id="3502269">WriteString</span><span class="op" id="3502280">(</span><span class="builtintype" id="3502281">string</span><span class="op" id="3502287">(</span><span class="ident" id="3502288">r</span><span class="op" id="3502289">)</span><span class="op" id="3502290">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502300">size</span>&nbsp;<span class="op" id="3502305">=</span>&nbsp;<span class="ident" id="3502307">utf8</span><span class="op" id="3502311">.</span><span class="ident" id="3502312">EncodeRune</span><span class="op" id="3502322">(</span><span class="ident" id="3502323">b</span><span class="op" id="3502324">.</span><span class="ident" id="3502325">buf</span><span class="op" id="3502328">[</span><span class="ident" id="3502329">b</span><span class="op" id="3502330">.</span><span class="ident" id="3502331">n</span><span class="op" id="3502332">:</span><span class="op" id="3502333">]</span><span class="op" id="3502334">,</span>&nbsp;<span class="ident" id="3502336">r</span><span class="op" id="3502337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502340">b</span><span class="op" id="3502341">.</span><span class="ident" id="3502342">n</span>&nbsp;<span class="op" id="3502344">+=</span>&nbsp;<span class="ident" id="3502347">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502353">return</span>&nbsp;<span class="ident" id="3502360">size</span><span class="op" id="3502364">,</span>&nbsp;<span class="ident" id="3502366">nil</span><br>
<span class="lineno">620</span><span class="op" id="3502370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3502373">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3502405">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3502448">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="3502521">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3502548">func</span>&nbsp;<span class="op" id="3502553">(</span><span class="ident" id="3502554">b</span>&nbsp;<span class="op" id="3502556">*</span><span class="ident" id="3502557">Writer</span><span class="op" id="3502563">)</span>&nbsp;<span class="ident" id="3502565">WriteString</span><span class="op" id="3502576">(</span><span class="ident" id="3502577">s</span>&nbsp;<span class="builtintype" id="3502579">string</span><span class="op" id="3502585">)</span>&nbsp;<span class="op" id="3502587">(</span><span class="builtintype" id="3502588">int</span><span class="op" id="3502591">,</span>&nbsp;<span class="builtintype" id="3502593">error</span><span class="op" id="3502598">)</span>&nbsp;<span class="op" id="3502600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502603">nn</span>&nbsp;<span class="op" id="3502606">:=</span>&nbsp;<span class="num" id="3502609">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502612">for</span>&nbsp;<span class="builtinfunc" id="3502616">len</span><span class="op" id="3502619">(</span><span class="ident" id="3502620">s</span><span class="op" id="3502621">)</span>&nbsp;<span class="op" id="3502623">&gt;</span>&nbsp;<span class="ident" id="3502625">b</span><span class="op" id="3502626">.</span><span class="ident" id="3502627">Available</span><span class="op" id="3502636">(</span><span class="op" id="3502637">)</span>&nbsp;<span class="op" id="3502639">&amp;&amp;</span>&nbsp;<span class="ident" id="3502642">b</span><span class="op" id="3502643">.</span><span class="ident" id="3502644">err</span>&nbsp;<span class="op" id="3502648">==</span>&nbsp;<span class="ident" id="3502651">nil</span>&nbsp;<span class="op" id="3502655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502659">n</span>&nbsp;<span class="op" id="3502661">:=</span>&nbsp;<span class="builtinfunc" id="3502664">copy</span><span class="op" id="3502668">(</span><span class="ident" id="3502669">b</span><span class="op" id="3502670">.</span><span class="ident" id="3502671">buf</span><span class="op" id="3502674">[</span><span class="ident" id="3502675">b</span><span class="op" id="3502676">.</span><span class="ident" id="3502677">n</span><span class="op" id="3502678">:</span><span class="op" id="3502679">]</span><span class="op" id="3502680">,</span>&nbsp;<span class="ident" id="3502682">s</span><span class="op" id="3502683">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502687">b</span><span class="op" id="3502688">.</span><span class="ident" id="3502689">n</span>&nbsp;<span class="op" id="3502691">+=</span>&nbsp;<span class="ident" id="3502694">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502698">nn</span>&nbsp;<span class="op" id="3502701">+=</span>&nbsp;<span class="ident" id="3502704">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502708">s</span>&nbsp;<span class="op" id="3502710">=</span>&nbsp;<span class="ident" id="3502712">s</span><span class="op" id="3502713">[</span><span class="ident" id="3502714">n</span><span class="op" id="3502715">:</span><span class="op" id="3502716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502720">b</span><span class="op" id="3502721">.</span><span class="ident" id="3502722">flush</span><span class="op" id="3502727">(</span><span class="op" id="3502728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502731">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502734">if</span>&nbsp;<span class="ident" id="3502737">b</span><span class="op" id="3502738">.</span><span class="ident" id="3502739">err</span>&nbsp;<span class="op" id="3502743">!=</span>&nbsp;<span class="ident" id="3502746">nil</span>&nbsp;<span class="op" id="3502750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502754">return</span>&nbsp;<span class="ident" id="3502761">nn</span><span class="op" id="3502763">,</span>&nbsp;<span class="ident" id="3502765">b</span><span class="op" id="3502766">.</span><span class="ident" id="3502767">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3502772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502775">n</span>&nbsp;<span class="op" id="3502777">:=</span>&nbsp;<span class="builtinfunc" id="3502780">copy</span><span class="op" id="3502784">(</span><span class="ident" id="3502785">b</span><span class="op" id="3502786">.</span><span class="ident" id="3502787">buf</span><span class="op" id="3502790">[</span><span class="ident" id="3502791">b</span><span class="op" id="3502792">.</span><span class="ident" id="3502793">n</span><span class="op" id="3502794">:</span><span class="op" id="3502795">]</span><span class="op" id="3502796">,</span>&nbsp;<span class="ident" id="3502798">s</span><span class="op" id="3502799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502802">b</span><span class="op" id="3502803">.</span><span class="ident" id="3502804">n</span>&nbsp;<span class="op" id="3502806">+=</span>&nbsp;<span class="ident" id="3502809">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3502812">nn</span>&nbsp;<span class="op" id="3502815">+=</span>&nbsp;<span class="ident" id="3502818">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502821">return</span>&nbsp;<span class="ident" id="3502828">nn</span><span class="op" id="3502830">,</span>&nbsp;<span class="ident" id="3502832">nil</span><br>
<span class="lineno"></span><span class="op" id="3502836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3502839">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="3502877">func</span>&nbsp;<span class="op" id="3502882">(</span><span class="ident" id="3502883">b</span>&nbsp;<span class="op" id="3502885">*</span><span class="ident" id="3502886">Writer</span><span class="op" id="3502892">)</span>&nbsp;<span class="ident" id="3502894">ReadFrom</span><span class="op" id="3502902">(</span><span class="ident" id="3502903">r</span>&nbsp;<span class="ident" id="3502905">io</span><span class="op" id="3502907">.</span><span class="ident" id="3502908">Reader</span><span class="op" id="3502914">)</span>&nbsp;<span class="op" id="3502916">(</span><span class="ident" id="3502917">n</span>&nbsp;<span class="ident" id="3502919">int64</span><span class="op" id="3502924">,</span>&nbsp;<span class="ident" id="3502926">err</span>&nbsp;<span class="builtintype" id="3502930">error</span><span class="op" id="3502935">)</span>&nbsp;<span class="op" id="3502937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502940">if</span>&nbsp;<span class="ident" id="3502943">b</span><span class="op" id="3502944">.</span><span class="ident" id="3502945">Buffered</span><span class="op" id="3502953">(</span><span class="op" id="3502954">)</span>&nbsp;<span class="op" id="3502956">==</span>&nbsp;<span class="num" id="3502959">0</span>&nbsp;<span class="op" id="3502961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3502965">if</span>&nbsp;<span class="ident" id="3502968">w</span><span class="op" id="3502969">,</span>&nbsp;<span class="ident" id="3502971">ok</span>&nbsp;<span class="op" id="3502974">:=</span>&nbsp;<span class="ident" id="3502977">b</span><span class="op" id="3502978">.</span><span class="ident" id="3502979">wr</span><span class="op" id="3502981">.</span><span class="op" id="3502982">(</span><span class="ident" id="3502983">io</span><span class="op" id="3502985">.</span><span class="ident" id="3502986">ReaderFrom</span><span class="op" id="3502996">)</span><span class="op" id="3502997">;</span>&nbsp;<span class="ident" id="3502999">ok</span>&nbsp;<span class="op" id="3503002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503007">return</span>&nbsp;<span class="ident" id="3503014">w</span><span class="op" id="3503015">.</span><span class="ident" id="3503016">ReadFrom</span><span class="op" id="3503024">(</span><span class="ident" id="3503025">r</span><span class="op" id="3503026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503030">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503036">var</span>&nbsp;<span class="ident" id="3503040">m</span>&nbsp;<span class="builtintype" id="3503042">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503047">for</span>&nbsp;<span class="op" id="3503051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503055">if</span>&nbsp;<span class="ident" id="3503058">b</span><span class="op" id="3503059">.</span><span class="ident" id="3503060">Available</span><span class="op" id="3503069">(</span><span class="op" id="3503070">)</span>&nbsp;<span class="op" id="3503072">==</span>&nbsp;<span class="num" id="3503075">0</span>&nbsp;<span class="op" id="3503077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503082">if</span>&nbsp;<span class="ident" id="3503085">err1</span>&nbsp;<span class="op" id="3503090">:=</span>&nbsp;<span class="ident" id="3503093">b</span><span class="op" id="3503094">.</span><span class="ident" id="3503095">flush</span><span class="op" id="3503100">(</span><span class="op" id="3503101">)</span><span class="op" id="3503102">;</span>&nbsp;<span class="ident" id="3503104">err1</span>&nbsp;<span class="op" id="3503109">!=</span>&nbsp;<span class="ident" id="3503112">nil</span>&nbsp;<span class="op" id="3503116">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503122">return</span>&nbsp;<span class="ident" id="3503129">n</span><span class="op" id="3503130">,</span>&nbsp;<span class="ident" id="3503132">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503148">nr</span>&nbsp;<span class="op" id="3503151">:=</span>&nbsp;<span class="num" id="3503154">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503158">for</span>&nbsp;<span class="ident" id="3503162">nr</span>&nbsp;<span class="op" id="3503165">&lt;</span>&nbsp;<span class="ident" id="3503167">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3503192">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503197">m</span><span class="op" id="3503198">,</span>&nbsp;<span class="ident" id="3503200">err</span>&nbsp;<span class="op" id="3503204">=</span>&nbsp;<span class="ident" id="3503206">r</span><span class="op" id="3503207">.</span><span class="ident" id="3503208">Read</span><span class="op" id="3503212">(</span><span class="ident" id="3503213">b</span><span class="op" id="3503214">.</span><span class="ident" id="3503215">buf</span><span class="op" id="3503218">[</span><span class="ident" id="3503219">b</span><span class="op" id="3503220">.</span><span class="ident" id="3503221">n</span><span class="op" id="3503222">:</span><span class="op" id="3503223">]</span><span class="op" id="3503224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503229">if</span>&nbsp;<span class="ident" id="3503232">m</span>&nbsp;<span class="op" id="3503234">!=</span>&nbsp;<span class="num" id="3503237">0</span>&nbsp;<span class="op" id="3503239">||</span>&nbsp;<span class="ident" id="3503242">err</span>&nbsp;<span class="op" id="3503246">!=</span>&nbsp;<span class="ident" id="3503249">nil</span>&nbsp;<span class="op" id="3503253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503259">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503273">nr</span><span class="op" id="3503275">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503284">if</span>&nbsp;<span class="ident" id="3503287">nr</span>&nbsp;<span class="op" id="3503290">==</span>&nbsp;<span class="ident" id="3503293">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3503318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503323">return</span>&nbsp;<span class="ident" id="3503330">n</span><span class="op" id="3503331">,</span>&nbsp;<span class="ident" id="3503333">io</span><span class="op" id="3503335">.</span><span class="ident" id="3503336">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503356">b</span><span class="op" id="3503357">.</span><span class="ident" id="3503358">n</span>&nbsp;<span class="op" id="3503360">+=</span>&nbsp;<span class="ident" id="3503363">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503367">n</span>&nbsp;<span class="op" id="3503369">+=</span>&nbsp;<span class="ident" id="3503372">int64</span><span class="op" id="3503377">(</span><span class="ident" id="3503378">m</span><span class="op" id="3503379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503383">if</span>&nbsp;<span class="ident" id="3503386">err</span>&nbsp;<span class="op" id="3503390">!=</span>&nbsp;<span class="ident" id="3503393">nil</span>&nbsp;<span class="op" id="3503397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503402">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503413">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503416">if</span>&nbsp;<span class="ident" id="3503419">err</span>&nbsp;<span class="op" id="3503423">==</span>&nbsp;<span class="ident" id="3503426">io</span><span class="op" id="3503428">.</span><span class="ident" id="3503429">EOF</span>&nbsp;<span class="op" id="3503433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3503437">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503496">if</span>&nbsp;<span class="ident" id="3503499">b</span><span class="op" id="3503500">.</span><span class="ident" id="3503501">Available</span><span class="op" id="3503510">(</span><span class="op" id="3503511">)</span>&nbsp;<span class="op" id="3503513">==</span>&nbsp;<span class="num" id="3503516">0</span>&nbsp;<span class="op" id="3503518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503523">err</span>&nbsp;<span class="op" id="3503527">=</span>&nbsp;<span class="ident" id="3503529">b</span><span class="op" id="3503530">.</span><span class="ident" id="3503531">flush</span><span class="op" id="3503536">(</span><span class="op" id="3503537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503541">}</span>&nbsp;<span class="keyword" id="3503543">else</span>&nbsp;<span class="op" id="3503548">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3503553">err</span>&nbsp;<span class="op" id="3503557">=</span>&nbsp;<span class="ident" id="3503559">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503571">return</span>&nbsp;<span class="ident" id="3503578">n</span><span class="op" id="3503579">,</span>&nbsp;<span class="ident" id="3503581">err</span><br>
<span class="lineno"></span><span class="op" id="3503585">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3503588">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3503618">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3503674">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="3503706">type</span>&nbsp;<span class="ident" id="3503711">ReadWriter</span>&nbsp;<span class="keyword" id="3503722">struct</span>&nbsp;<span class="op" id="3503729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503732">*</span><span class="ident" id="3503733">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3503741">*</span><span class="ident" id="3503742">Writer</span><br>
<span class="lineno"></span><span class="op" id="3503749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3503752">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3503824">func</span>&nbsp;<span class="ident" id="3503829">NewReadWriter</span><span class="op" id="3503842">(</span><span class="ident" id="3503843">r</span>&nbsp;<span class="op" id="3503845">*</span><span class="ident" id="3503846">Reader</span><span class="op" id="3503852">,</span>&nbsp;<span class="ident" id="3503854">w</span>&nbsp;<span class="op" id="3503856">*</span><span class="ident" id="3503857">Writer</span><span class="op" id="3503863">)</span>&nbsp;<span class="op" id="3503865">*</span><span class="ident" id="3503866">ReadWriter</span>&nbsp;<span class="op" id="3503877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3503880">return</span>&nbsp;<span class="op" id="3503887">&amp;</span><span class="ident" id="3503888">ReadWriter</span><span class="op" id="3503898">{</span><span class="ident" id="3503899">r</span><span class="op" id="3503900">,</span>&nbsp;<span class="ident" id="3503902">w</span><span class="op" id="3503903">}</span><br>
<span class="lineno"></span><span class="op" id="3503905">}</span>
</div>
</body>
</html>
