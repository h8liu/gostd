<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html" class="current">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3803326">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3803381">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3803435">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3803486">package</span>&nbsp;<span class="ident" id="3803494">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803500">import</span>&nbsp;<span class="op" id="3803507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803510">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803519">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803526">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803533">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803540">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803551">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3803562">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3803569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803572">//&nbsp;This&nbsp;implementation&nbsp;is&nbsp;done&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265:</span><br>
<span class="lineno"></span><span class="comment" id="3803626">//</span><br>
<span class="lineno"></span><span class="comment" id="3803629">//&nbsp;&nbsp;&nbsp;&nbsp;http://tools.ietf.org/html/rfc6265</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3803671">//&nbsp;A&nbsp;Cookie&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;cookie&nbsp;as&nbsp;sent&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;header&nbsp;of&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3803748">//&nbsp;HTTP&nbsp;response&nbsp;or&nbsp;the&nbsp;Cookie&nbsp;header&nbsp;of&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3803806">type</span>&nbsp;<span class="ident" id="3803811">Cookie</span>&nbsp;<span class="keyword" id="3803818">struct</span>&nbsp;<span class="op" id="3803825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803828">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3803839">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803847">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3803858">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803866">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3803877">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803885">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3803896">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803904">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803915">time</span><span class="op" id="3803919">.</span><span class="ident" id="3803920">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803926">RawExpires</span>&nbsp;<span class="builtintype" id="3803937">string</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803946">//&nbsp;MaxAge=0&nbsp;means&nbsp;no&nbsp;&#39;Max-Age&#39;&nbsp;attribute&nbsp;specified.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3803999">//&nbsp;MaxAge&lt;0&nbsp;means&nbsp;delete&nbsp;cookie&nbsp;now,&nbsp;equivalently&nbsp;&#39;Max-Age:&nbsp;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804063">//&nbsp;MaxAge&gt;0&nbsp;means&nbsp;Max-Age&nbsp;attribute&nbsp;present&nbsp;and&nbsp;given&nbsp;in&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804129">MaxAge</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3804138">int</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804143">Secure</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3804152">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804158">HttpOnly</span>&nbsp;<span class="builtintype" id="3804167">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804173">Raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3804182">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804190">Unparsed</span>&nbsp;<span class="op" id="3804199">[</span><span class="op" id="3804200">]</span><span class="builtintype" id="3804201">string</span>&nbsp;<span class="comment" id="3804208">//&nbsp;Raw&nbsp;text&nbsp;of&nbsp;unparsed&nbsp;attribute-value&nbsp;pairs</span><br>
<span class="lineno"></span><span class="op" id="3804254">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3804257">//&nbsp;readSetCookies&nbsp;parses&nbsp;all&nbsp;&#34;Set-Cookie&#34;&nbsp;values&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3804311">//&nbsp;the&nbsp;header&nbsp;h&nbsp;and&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="keyword" id="3804372">func</span>&nbsp;<span class="ident" id="3804377">readSetCookies</span><span class="op" id="3804391">(</span><span class="ident" id="3804392">h</span>&nbsp;<span class="ident" id="3804394">Header</span><span class="op" id="3804400">)</span>&nbsp;<span class="op" id="3804402">[</span><span class="op" id="3804403">]</span><span class="op" id="3804404">*</span><span class="ident" id="3804405">Cookie</span>&nbsp;<span class="op" id="3804412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804415">cookies</span>&nbsp;<span class="op" id="3804423">:=</span>&nbsp;<span class="op" id="3804426">[</span><span class="op" id="3804427">]</span><span class="op" id="3804428">*</span><span class="ident" id="3804429">Cookie</span><span class="op" id="3804435">{</span><span class="op" id="3804436">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804439">for</span>&nbsp;<span class="ident" id="3804443">_</span><span class="op" id="3804444">,</span>&nbsp;<span class="ident" id="3804446">line</span>&nbsp;<span class="op" id="3804451">:=</span>&nbsp;<span class="keyword" id="3804454">range</span>&nbsp;<span class="ident" id="3804460">h</span><span class="op" id="3804461">[</span><span class="string" id="3804462">&#34;Set-Cookie&#34;</span><span class="op" id="3804474">]</span>&nbsp;<span class="op" id="3804476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804480">parts</span>&nbsp;<span class="op" id="3804486">:=</span>&nbsp;<span class="ident" id="3804489">strings</span><span class="op" id="3804496">.</span><span class="ident" id="3804497">Split</span><span class="op" id="3804502">(</span><span class="ident" id="3804503">strings</span><span class="op" id="3804510">.</span><span class="ident" id="3804511">TrimSpace</span><span class="op" id="3804520">(</span><span class="ident" id="3804521">line</span><span class="op" id="3804525">)</span><span class="op" id="3804526">,</span>&nbsp;<span class="string" id="3804528">&#34;;&#34;</span><span class="op" id="3804531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804535">if</span>&nbsp;<span class="builtinfunc" id="3804538">len</span><span class="op" id="3804541">(</span><span class="ident" id="3804542">parts</span><span class="op" id="3804547">)</span>&nbsp;<span class="op" id="3804549">==</span>&nbsp;<span class="num" id="3804552">1</span>&nbsp;<span class="op" id="3804554">&amp;&amp;</span>&nbsp;<span class="ident" id="3804557">parts</span><span class="op" id="3804562">[</span><span class="num" id="3804563">0</span><span class="op" id="3804564">]</span>&nbsp;<span class="op" id="3804566">==</span>&nbsp;<span class="string" id="3804569">&#34;&#34;</span>&nbsp;<span class="op" id="3804572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804577">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804588">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804592">parts</span><span class="op" id="3804597">[</span><span class="num" id="3804598">0</span><span class="op" id="3804599">]</span>&nbsp;<span class="op" id="3804601">=</span>&nbsp;<span class="ident" id="3804603">strings</span><span class="op" id="3804610">.</span><span class="ident" id="3804611">TrimSpace</span><span class="op" id="3804620">(</span><span class="ident" id="3804621">parts</span><span class="op" id="3804626">[</span><span class="num" id="3804627">0</span><span class="op" id="3804628">]</span><span class="op" id="3804629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804633">j</span>&nbsp;<span class="op" id="3804635">:=</span>&nbsp;<span class="ident" id="3804638">strings</span><span class="op" id="3804645">.</span><span class="ident" id="3804646">Index</span><span class="op" id="3804651">(</span><span class="ident" id="3804652">parts</span><span class="op" id="3804657">[</span><span class="num" id="3804658">0</span><span class="op" id="3804659">]</span><span class="op" id="3804660">,</span>&nbsp;<span class="string" id="3804662">&#34;=&#34;</span><span class="op" id="3804665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804669">if</span>&nbsp;<span class="ident" id="3804672">j</span>&nbsp;<span class="op" id="3804674">&lt;</span>&nbsp;<span class="num" id="3804676">0</span>&nbsp;<span class="op" id="3804678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804683">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804694">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804698">name</span><span class="op" id="3804702">,</span>&nbsp;<span class="ident" id="3804704">value</span>&nbsp;<span class="op" id="3804710">:=</span>&nbsp;<span class="ident" id="3804713">parts</span><span class="op" id="3804718">[</span><span class="num" id="3804719">0</span><span class="op" id="3804720">]</span><span class="op" id="3804721">[</span><span class="op" id="3804722">:</span><span class="ident" id="3804723">j</span><span class="op" id="3804724">]</span><span class="op" id="3804725">,</span>&nbsp;<span class="ident" id="3804727">parts</span><span class="op" id="3804732">[</span><span class="num" id="3804733">0</span><span class="op" id="3804734">]</span><span class="op" id="3804735">[</span><span class="ident" id="3804736">j</span><span class="op" id="3804737">+</span><span class="num" id="3804738">1</span><span class="op" id="3804739">:</span><span class="op" id="3804740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804744">if</span>&nbsp;<span class="op" id="3804747">!</span><span class="ident" id="3804748">isCookieNameValid</span><span class="op" id="3804765">(</span><span class="ident" id="3804766">name</span><span class="op" id="3804770">)</span>&nbsp;<span class="op" id="3804772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804777">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804792">value</span><span class="op" id="3804797">,</span>&nbsp;<span class="ident" id="3804799">success</span>&nbsp;<span class="op" id="3804807">:=</span>&nbsp;<span class="ident" id="3804810">parseCookieValue</span><span class="op" id="3804826">(</span><span class="ident" id="3804827">value</span><span class="op" id="3804832">,</span>&nbsp;<span class="builtintype" id="3804834">true</span><span class="op" id="3804838">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804842">if</span>&nbsp;<span class="op" id="3804845">!</span><span class="ident" id="3804846">success</span>&nbsp;<span class="op" id="3804854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804859">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804874">c</span>&nbsp;<span class="op" id="3804876">:=</span>&nbsp;<span class="op" id="3804879">&amp;</span><span class="ident" id="3804880">Cookie</span><span class="op" id="3804886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804891">Name</span><span class="op" id="3804895">:</span>&nbsp;&nbsp;<span class="ident" id="3804898">name</span><span class="op" id="3804902">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804907">Value</span><span class="op" id="3804912">:</span>&nbsp;<span class="ident" id="3804914">value</span><span class="op" id="3804919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804924">Raw</span><span class="op" id="3804927">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3804931">line</span><span class="op" id="3804935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804943">for</span>&nbsp;<span class="ident" id="3804947">i</span>&nbsp;<span class="op" id="3804949">:=</span>&nbsp;<span class="num" id="3804952">1</span><span class="op" id="3804953">;</span>&nbsp;<span class="ident" id="3804955">i</span>&nbsp;<span class="op" id="3804957">&lt;</span>&nbsp;<span class="builtinfunc" id="3804959">len</span><span class="op" id="3804962">(</span><span class="ident" id="3804963">parts</span><span class="op" id="3804968">)</span><span class="op" id="3804969">;</span>&nbsp;<span class="ident" id="3804971">i</span><span class="op" id="3804972">++</span>&nbsp;<span class="op" id="3804975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804980">parts</span><span class="op" id="3804985">[</span><span class="ident" id="3804986">i</span><span class="op" id="3804987">]</span>&nbsp;<span class="op" id="3804989">=</span>&nbsp;<span class="ident" id="3804991">strings</span><span class="op" id="3804998">.</span><span class="ident" id="3804999">TrimSpace</span><span class="op" id="3805008">(</span><span class="ident" id="3805009">parts</span><span class="op" id="3805014">[</span><span class="ident" id="3805015">i</span><span class="op" id="3805016">]</span><span class="op" id="3805017">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805022">if</span>&nbsp;<span class="builtinfunc" id="3805025">len</span><span class="op" id="3805028">(</span><span class="ident" id="3805029">parts</span><span class="op" id="3805034">[</span><span class="ident" id="3805035">i</span><span class="op" id="3805036">]</span><span class="op" id="3805037">)</span>&nbsp;<span class="op" id="3805039">==</span>&nbsp;<span class="num" id="3805042">0</span>&nbsp;<span class="op" id="3805044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805050">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805068">attr</span><span class="op" id="3805072">,</span>&nbsp;<span class="ident" id="3805074">val</span>&nbsp;<span class="op" id="3805078">:=</span>&nbsp;<span class="ident" id="3805081">parts</span><span class="op" id="3805086">[</span><span class="ident" id="3805087">i</span><span class="op" id="3805088">]</span><span class="op" id="3805089">,</span>&nbsp;<span class="string" id="3805091">&#34;&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805097">if</span>&nbsp;<span class="ident" id="3805100">j</span>&nbsp;<span class="op" id="3805102">:=</span>&nbsp;<span class="ident" id="3805105">strings</span><span class="op" id="3805112">.</span><span class="ident" id="3805113">Index</span><span class="op" id="3805118">(</span><span class="ident" id="3805119">attr</span><span class="op" id="3805123">,</span>&nbsp;<span class="string" id="3805125">&#34;=&#34;</span><span class="op" id="3805128">)</span><span class="op" id="3805129">;</span>&nbsp;<span class="ident" id="3805131">j</span>&nbsp;<span class="op" id="3805133">&gt;=</span>&nbsp;<span class="num" id="3805136">0</span>&nbsp;<span class="op" id="3805138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805144">attr</span><span class="op" id="3805148">,</span>&nbsp;<span class="ident" id="3805150">val</span>&nbsp;<span class="op" id="3805154">=</span>&nbsp;<span class="ident" id="3805156">attr</span><span class="op" id="3805160">[</span><span class="op" id="3805161">:</span><span class="ident" id="3805162">j</span><span class="op" id="3805163">]</span><span class="op" id="3805164">,</span>&nbsp;<span class="ident" id="3805166">attr</span><span class="op" id="3805170">[</span><span class="ident" id="3805171">j</span><span class="op" id="3805172">+</span><span class="num" id="3805173">1</span><span class="op" id="3805174">:</span><span class="op" id="3805175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805185">lowerAttr</span>&nbsp;<span class="op" id="3805195">:=</span>&nbsp;<span class="ident" id="3805198">strings</span><span class="op" id="3805205">.</span><span class="ident" id="3805206">ToLower</span><span class="op" id="3805213">(</span><span class="ident" id="3805214">attr</span><span class="op" id="3805218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805223">val</span><span class="op" id="3805226">,</span>&nbsp;<span class="ident" id="3805228">success</span>&nbsp;<span class="op" id="3805236">=</span>&nbsp;<span class="ident" id="3805238">parseCookieValue</span><span class="op" id="3805254">(</span><span class="ident" id="3805255">val</span><span class="op" id="3805258">,</span>&nbsp;<span class="builtintype" id="3805260">false</span><span class="op" id="3805265">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805270">if</span>&nbsp;<span class="op" id="3805273">!</span><span class="ident" id="3805274">success</span>&nbsp;<span class="op" id="3805282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805288">c</span><span class="op" id="3805289">.</span><span class="ident" id="3805290">Unparsed</span>&nbsp;<span class="op" id="3805299">=</span>&nbsp;<span class="builtinfunc" id="3805301">append</span><span class="op" id="3805307">(</span><span class="ident" id="3805308">c</span><span class="op" id="3805309">.</span><span class="ident" id="3805310">Unparsed</span><span class="op" id="3805318">,</span>&nbsp;<span class="ident" id="3805320">parts</span><span class="op" id="3805325">[</span><span class="ident" id="3805326">i</span><span class="op" id="3805327">]</span><span class="op" id="3805328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805334">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805351">switch</span>&nbsp;<span class="ident" id="3805358">lowerAttr</span>&nbsp;<span class="op" id="3805368">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805373">case</span>&nbsp;<span class="string" id="3805378">&#34;secure&#34;</span><span class="op" id="3805386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805392">c</span><span class="op" id="3805393">.</span><span class="ident" id="3805394">Secure</span>&nbsp;<span class="op" id="3805401">=</span>&nbsp;<span class="builtintype" id="3805403">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805412">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805424">case</span>&nbsp;<span class="string" id="3805429">&#34;httponly&#34;</span><span class="op" id="3805439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805445">c</span><span class="op" id="3805446">.</span><span class="ident" id="3805447">HttpOnly</span>&nbsp;<span class="op" id="3805456">=</span>&nbsp;<span class="builtintype" id="3805458">true</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805467">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805479">case</span>&nbsp;<span class="string" id="3805484">&#34;domain&#34;</span><span class="op" id="3805492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805498">c</span><span class="op" id="3805499">.</span><span class="ident" id="3805500">Domain</span>&nbsp;<span class="op" id="3805507">=</span>&nbsp;<span class="ident" id="3805509">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805517">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805529">case</span>&nbsp;<span class="string" id="3805534">&#34;max-age&#34;</span><span class="op" id="3805543">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805549">secs</span><span class="op" id="3805553">,</span>&nbsp;<span class="ident" id="3805555">err</span>&nbsp;<span class="op" id="3805559">:=</span>&nbsp;<span class="ident" id="3805562">strconv</span><span class="op" id="3805569">.</span><span class="ident" id="3805570">Atoi</span><span class="op" id="3805574">(</span><span class="ident" id="3805575">val</span><span class="op" id="3805578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805584">if</span>&nbsp;<span class="ident" id="3805587">err</span>&nbsp;<span class="op" id="3805591">!=</span>&nbsp;<span class="ident" id="3805594">nil</span>&nbsp;<span class="op" id="3805598">||</span>&nbsp;<span class="ident" id="3805601">secs</span>&nbsp;<span class="op" id="3805606">!=</span>&nbsp;<span class="num" id="3805609">0</span>&nbsp;<span class="op" id="3805611">&amp;&amp;</span>&nbsp;<span class="ident" id="3805614">val</span><span class="op" id="3805617">[</span><span class="num" id="3805618">0</span><span class="op" id="3805619">]</span>&nbsp;<span class="op" id="3805621">==</span>&nbsp;<span class="string" id="3805624">&#39;0&#39;</span>&nbsp;<span class="op" id="3805628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805635">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805651">if</span>&nbsp;<span class="ident" id="3805654">secs</span>&nbsp;<span class="op" id="3805659">&lt;=</span>&nbsp;<span class="num" id="3805662">0</span>&nbsp;<span class="op" id="3805664">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805671">c</span><span class="op" id="3805672">.</span><span class="ident" id="3805673">MaxAge</span>&nbsp;<span class="op" id="3805680">=</span>&nbsp;<span class="op" id="3805682">-</span><span class="num" id="3805683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805689">}</span>&nbsp;<span class="keyword" id="3805691">else</span>&nbsp;<span class="op" id="3805696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805703">c</span><span class="op" id="3805704">.</span><span class="ident" id="3805705">MaxAge</span>&nbsp;<span class="op" id="3805712">=</span>&nbsp;<span class="ident" id="3805714">secs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805729">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805741">case</span>&nbsp;<span class="string" id="3805746">&#34;expires&#34;</span><span class="op" id="3805755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805761">c</span><span class="op" id="3805762">.</span><span class="ident" id="3805763">RawExpires</span>&nbsp;<span class="op" id="3805774">=</span>&nbsp;<span class="ident" id="3805776">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805784">exptime</span><span class="op" id="3805791">,</span>&nbsp;<span class="ident" id="3805793">err</span>&nbsp;<span class="op" id="3805797">:=</span>&nbsp;<span class="ident" id="3805800">time</span><span class="op" id="3805804">.</span><span class="ident" id="3805805">Parse</span><span class="op" id="3805810">(</span><span class="ident" id="3805811">time</span><span class="op" id="3805815">.</span><span class="ident" id="3805816">RFC1123</span><span class="op" id="3805823">,</span>&nbsp;<span class="ident" id="3805825">val</span><span class="op" id="3805828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805834">if</span>&nbsp;<span class="ident" id="3805837">err</span>&nbsp;<span class="op" id="3805841">!=</span>&nbsp;<span class="ident" id="3805844">nil</span>&nbsp;<span class="op" id="3805848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805855">exptime</span><span class="op" id="3805862">,</span>&nbsp;<span class="ident" id="3805864">err</span>&nbsp;<span class="op" id="3805868">=</span>&nbsp;<span class="ident" id="3805870">time</span><span class="op" id="3805874">.</span><span class="ident" id="3805875">Parse</span><span class="op" id="3805880">(</span><span class="string" id="3805881">&#34;Mon,&nbsp;02-Jan-2006&nbsp;15:04:05&nbsp;MST&#34;</span><span class="op" id="3805912">,</span>&nbsp;<span class="ident" id="3805914">val</span><span class="op" id="3805917">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805924">if</span>&nbsp;<span class="ident" id="3805927">err</span>&nbsp;<span class="op" id="3805931">!=</span>&nbsp;<span class="ident" id="3805934">nil</span>&nbsp;<span class="op" id="3805938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805946">c</span><span class="op" id="3805947">.</span><span class="ident" id="3805948">Expires</span>&nbsp;<span class="op" id="3805956">=</span>&nbsp;<span class="ident" id="3805958">time</span><span class="op" id="3805962">.</span><span class="ident" id="3805963">Time</span><span class="op" id="3805967">{</span><span class="op" id="3805968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805976">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805993">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805999">c</span><span class="op" id="3806000">.</span><span class="ident" id="3806001">Expires</span>&nbsp;<span class="op" id="3806009">=</span>&nbsp;<span class="ident" id="3806011">exptime</span><span class="op" id="3806018">.</span><span class="ident" id="3806019">UTC</span><span class="op" id="3806022">(</span><span class="op" id="3806023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806041">case</span>&nbsp;<span class="string" id="3806046">&#34;path&#34;</span><span class="op" id="3806052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806058">c</span><span class="op" id="3806059">.</span><span class="ident" id="3806060">Path</span>&nbsp;<span class="op" id="3806065">=</span>&nbsp;<span class="ident" id="3806067">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806075">continue</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806092">c</span><span class="op" id="3806093">.</span><span class="ident" id="3806094">Unparsed</span>&nbsp;<span class="op" id="3806103">=</span>&nbsp;<span class="builtinfunc" id="3806105">append</span><span class="op" id="3806111">(</span><span class="ident" id="3806112">c</span><span class="op" id="3806113">.</span><span class="ident" id="3806114">Unparsed</span><span class="op" id="3806122">,</span>&nbsp;<span class="ident" id="3806124">parts</span><span class="op" id="3806129">[</span><span class="ident" id="3806130">i</span><span class="op" id="3806131">]</span><span class="op" id="3806132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806140">cookies</span>&nbsp;<span class="op" id="3806148">=</span>&nbsp;<span class="builtinfunc" id="3806150">append</span><span class="op" id="3806156">(</span><span class="ident" id="3806157">cookies</span><span class="op" id="3806164">,</span>&nbsp;<span class="ident" id="3806166">c</span><span class="op" id="3806167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806170">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806173">return</span>&nbsp;<span class="ident" id="3806180">cookies</span><br>
<span class="lineno"></span><span class="op" id="3806188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3806191">//&nbsp;SetCookie&nbsp;adds&nbsp;a&nbsp;Set-Cookie&nbsp;header&nbsp;to&nbsp;the&nbsp;provided&nbsp;ResponseWriter&#39;s&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3806271">func</span>&nbsp;<span class="ident" id="3806276">SetCookie</span><span class="op" id="3806285">(</span><span class="ident" id="3806286">w</span>&nbsp;<span class="ident" id="3806288">ResponseWriter</span><span class="op" id="3806302">,</span>&nbsp;<span class="ident" id="3806304">cookie</span>&nbsp;<span class="op" id="3806311">*</span><span class="ident" id="3806312">Cookie</span><span class="op" id="3806318">)</span>&nbsp;<span class="op" id="3806320">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806323">w</span><span class="op" id="3806324">.</span><span class="ident" id="3806325">Header</span><span class="op" id="3806331">(</span><span class="op" id="3806332">)</span><span class="op" id="3806333">.</span><span class="ident" id="3806334">Add</span><span class="op" id="3806337">(</span><span class="string" id="3806338">&#34;Set-Cookie&#34;</span><span class="op" id="3806350">,</span>&nbsp;<span class="ident" id="3806352">cookie</span><span class="op" id="3806358">.</span><span class="ident" id="3806359">String</span><span class="op" id="3806365">(</span><span class="op" id="3806366">)</span><span class="op" id="3806367">)</span><br>
<span class="lineno"></span><span class="op" id="3806369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3806372">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;serialization&nbsp;of&nbsp;the&nbsp;cookie&nbsp;for&nbsp;use&nbsp;in&nbsp;a&nbsp;Cookie</span><br>
<span class="lineno"></span><span class="comment" id="3806442">//&nbsp;header&nbsp;(if&nbsp;only&nbsp;Name&nbsp;and&nbsp;Value&nbsp;are&nbsp;set)&nbsp;or&nbsp;a&nbsp;Set-Cookie&nbsp;response</span><br>
<span class="lineno">135</span><span class="comment" id="3806510">//&nbsp;header&nbsp;(if&nbsp;other&nbsp;fields&nbsp;are&nbsp;set).</span><br>
<span class="lineno"></span><span class="keyword" id="3806547">func</span>&nbsp;<span class="op" id="3806552">(</span><span class="ident" id="3806553">c</span>&nbsp;<span class="op" id="3806555">*</span><span class="ident" id="3806556">Cookie</span><span class="op" id="3806562">)</span>&nbsp;<span class="ident" id="3806564">String</span><span class="op" id="3806570">(</span><span class="op" id="3806571">)</span>&nbsp;<span class="builtintype" id="3806573">string</span>&nbsp;<span class="op" id="3806580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806583">var</span>&nbsp;<span class="ident" id="3806587">b</span>&nbsp;<span class="ident" id="3806589">bytes</span><span class="op" id="3806594">.</span><span class="ident" id="3806595">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806603">fmt</span><span class="op" id="3806606">.</span><span class="ident" id="3806607">Fprintf</span><span class="op" id="3806614">(</span><span class="op" id="3806615">&amp;</span><span class="ident" id="3806616">b</span><span class="op" id="3806617">,</span>&nbsp;<span class="string" id="3806619">&#34;%s=%s&#34;</span><span class="op" id="3806626">,</span>&nbsp;<span class="ident" id="3806628">sanitizeCookieName</span><span class="op" id="3806646">(</span><span class="ident" id="3806647">c</span><span class="op" id="3806648">.</span><span class="ident" id="3806649">Name</span><span class="op" id="3806653">)</span><span class="op" id="3806654">,</span>&nbsp;<span class="ident" id="3806656">sanitizeCookieValue</span><span class="op" id="3806675">(</span><span class="ident" id="3806676">c</span><span class="op" id="3806677">.</span><span class="ident" id="3806678">Value</span><span class="op" id="3806683">)</span><span class="op" id="3806684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806687">if</span>&nbsp;<span class="builtinfunc" id="3806690">len</span><span class="op" id="3806693">(</span><span class="ident" id="3806694">c</span><span class="op" id="3806695">.</span><span class="ident" id="3806696">Path</span><span class="op" id="3806700">)</span>&nbsp;<span class="op" id="3806702">&gt;</span>&nbsp;<span class="num" id="3806704">0</span>&nbsp;<span class="op" id="3806706">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806710">fmt</span><span class="op" id="3806713">.</span><span class="ident" id="3806714">Fprintf</span><span class="op" id="3806721">(</span><span class="op" id="3806722">&amp;</span><span class="ident" id="3806723">b</span><span class="op" id="3806724">,</span>&nbsp;<span class="string" id="3806726">&#34;;&nbsp;Path=%s&#34;</span><span class="op" id="3806737">,</span>&nbsp;<span class="ident" id="3806739">sanitizeCookiePath</span><span class="op" id="3806757">(</span><span class="ident" id="3806758">c</span><span class="op" id="3806759">.</span><span class="ident" id="3806760">Path</span><span class="op" id="3806764">)</span><span class="op" id="3806765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806771">if</span>&nbsp;<span class="builtinfunc" id="3806774">len</span><span class="op" id="3806777">(</span><span class="ident" id="3806778">c</span><span class="op" id="3806779">.</span><span class="ident" id="3806780">Domain</span><span class="op" id="3806786">)</span>&nbsp;<span class="op" id="3806788">&gt;</span>&nbsp;<span class="num" id="3806790">0</span>&nbsp;<span class="op" id="3806792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806796">if</span>&nbsp;<span class="ident" id="3806799">validCookieDomain</span><span class="op" id="3806816">(</span><span class="ident" id="3806817">c</span><span class="op" id="3806818">.</span><span class="ident" id="3806819">Domain</span><span class="op" id="3806825">)</span>&nbsp;<span class="op" id="3806827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806832">//&nbsp;A&nbsp;c.Domain&nbsp;containing&nbsp;illegal&nbsp;characters&nbsp;is&nbsp;not</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806886">//&nbsp;sanitized&nbsp;but&nbsp;simply&nbsp;dropped&nbsp;which&nbsp;turns&nbsp;the&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806944">//&nbsp;into&nbsp;a&nbsp;host-only&nbsp;cookie.&nbsp;A&nbsp;leading&nbsp;dot&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806997">//&nbsp;but&nbsp;won&#39;t&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807022">d</span>&nbsp;<span class="op" id="3807024">:=</span>&nbsp;<span class="ident" id="3807027">c</span><span class="op" id="3807028">.</span><span class="ident" id="3807029">Domain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807039">if</span>&nbsp;<span class="ident" id="3807042">d</span><span class="op" id="3807043">[</span><span class="num" id="3807044">0</span><span class="op" id="3807045">]</span>&nbsp;<span class="op" id="3807047">==</span>&nbsp;<span class="string" id="3807050">&#39;.&#39;</span>&nbsp;<span class="op" id="3807054">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807060">d</span>&nbsp;<span class="op" id="3807062">=</span>&nbsp;<span class="ident" id="3807064">d</span><span class="op" id="3807065">[</span><span class="num" id="3807066">1</span><span class="op" id="3807067">:</span><span class="op" id="3807068">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807078">fmt</span><span class="op" id="3807081">.</span><span class="ident" id="3807082">Fprintf</span><span class="op" id="3807089">(</span><span class="op" id="3807090">&amp;</span><span class="ident" id="3807091">b</span><span class="op" id="3807092">,</span>&nbsp;<span class="string" id="3807094">&#34;;&nbsp;Domain=%s&#34;</span><span class="op" id="3807107">,</span>&nbsp;<span class="ident" id="3807109">d</span><span class="op" id="3807110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807114">}</span>&nbsp;<span class="keyword" id="3807116">else</span>&nbsp;<span class="op" id="3807121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807126">log</span><span class="op" id="3807129">.</span><span class="ident" id="3807130">Printf</span><span class="op" id="3807136">(</span><span class="string" id="3807137">&#34;net/http:&nbsp;invalid&nbsp;Cookie.Domain&nbsp;%q;&nbsp;dropping&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="3807200">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807206">c</span><span class="op" id="3807207">.</span><span class="ident" id="3807208">Domain</span><span class="op" id="3807214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807224">if</span>&nbsp;<span class="ident" id="3807227">c</span><span class="op" id="3807228">.</span><span class="ident" id="3807229">Expires</span><span class="op" id="3807236">.</span><span class="ident" id="3807237">Unix</span><span class="op" id="3807241">(</span><span class="op" id="3807242">)</span>&nbsp;<span class="op" id="3807244">&gt;</span>&nbsp;<span class="num" id="3807246">0</span>&nbsp;<span class="op" id="3807248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807252">fmt</span><span class="op" id="3807255">.</span><span class="ident" id="3807256">Fprintf</span><span class="op" id="3807263">(</span><span class="op" id="3807264">&amp;</span><span class="ident" id="3807265">b</span><span class="op" id="3807266">,</span>&nbsp;<span class="string" id="3807268">&#34;;&nbsp;Expires=%s&#34;</span><span class="op" id="3807282">,</span>&nbsp;<span class="ident" id="3807284">c</span><span class="op" id="3807285">.</span><span class="ident" id="3807286">Expires</span><span class="op" id="3807293">.</span><span class="ident" id="3807294">UTC</span><span class="op" id="3807297">(</span><span class="op" id="3807298">)</span><span class="op" id="3807299">.</span><span class="ident" id="3807300">Format</span><span class="op" id="3807306">(</span><span class="ident" id="3807307">time</span><span class="op" id="3807311">.</span><span class="ident" id="3807312">RFC1123</span><span class="op" id="3807319">)</span><span class="op" id="3807320">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807326">if</span>&nbsp;<span class="ident" id="3807329">c</span><span class="op" id="3807330">.</span><span class="ident" id="3807331">MaxAge</span>&nbsp;<span class="op" id="3807338">&gt;</span>&nbsp;<span class="num" id="3807340">0</span>&nbsp;<span class="op" id="3807342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807346">fmt</span><span class="op" id="3807349">.</span><span class="ident" id="3807350">Fprintf</span><span class="op" id="3807357">(</span><span class="op" id="3807358">&amp;</span><span class="ident" id="3807359">b</span><span class="op" id="3807360">,</span>&nbsp;<span class="string" id="3807362">&#34;;&nbsp;Max-Age=%d&#34;</span><span class="op" id="3807376">,</span>&nbsp;<span class="ident" id="3807378">c</span><span class="op" id="3807379">.</span><span class="ident" id="3807380">MaxAge</span><span class="op" id="3807386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807389">}</span>&nbsp;<span class="keyword" id="3807391">else</span>&nbsp;<span class="keyword" id="3807396">if</span>&nbsp;<span class="ident" id="3807399">c</span><span class="op" id="3807400">.</span><span class="ident" id="3807401">MaxAge</span>&nbsp;<span class="op" id="3807408">&lt;</span>&nbsp;<span class="num" id="3807410">0</span>&nbsp;<span class="op" id="3807412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807416">fmt</span><span class="op" id="3807419">.</span><span class="ident" id="3807420">Fprintf</span><span class="op" id="3807427">(</span><span class="op" id="3807428">&amp;</span><span class="ident" id="3807429">b</span><span class="op" id="3807430">,</span>&nbsp;<span class="string" id="3807432">&#34;;&nbsp;Max-Age=0&#34;</span><span class="op" id="3807445">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807451">if</span>&nbsp;<span class="ident" id="3807454">c</span><span class="op" id="3807455">.</span><span class="ident" id="3807456">HttpOnly</span>&nbsp;<span class="op" id="3807465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807469">fmt</span><span class="op" id="3807472">.</span><span class="ident" id="3807473">Fprintf</span><span class="op" id="3807480">(</span><span class="op" id="3807481">&amp;</span><span class="ident" id="3807482">b</span><span class="op" id="3807483">,</span>&nbsp;<span class="string" id="3807485">&#34;;&nbsp;HttpOnly&#34;</span><span class="op" id="3807497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807503">if</span>&nbsp;<span class="ident" id="3807506">c</span><span class="op" id="3807507">.</span><span class="ident" id="3807508">Secure</span>&nbsp;<span class="op" id="3807515">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807519">fmt</span><span class="op" id="3807522">.</span><span class="ident" id="3807523">Fprintf</span><span class="op" id="3807530">(</span><span class="op" id="3807531">&amp;</span><span class="ident" id="3807532">b</span><span class="op" id="3807533">,</span>&nbsp;<span class="string" id="3807535">&#34;;&nbsp;Secure&#34;</span><span class="op" id="3807545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807551">return</span>&nbsp;<span class="ident" id="3807558">b</span><span class="op" id="3807559">.</span><span class="ident" id="3807560">String</span><span class="op" id="3807566">(</span><span class="op" id="3807567">)</span><br>
<span class="lineno"></span><span class="op" id="3807569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3807572">//&nbsp;readCookies&nbsp;parses&nbsp;all&nbsp;&#34;Cookie&#34;&nbsp;values&nbsp;from&nbsp;the&nbsp;header&nbsp;h&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3807636">//&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="comment" id="3807680">//</span><br>
<span class="lineno"></span><span class="comment" id="3807683">//&nbsp;if&nbsp;filter&nbsp;isn&#39;t&nbsp;empty,&nbsp;only&nbsp;cookies&nbsp;of&nbsp;that&nbsp;name&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="3807748">func</span>&nbsp;<span class="ident" id="3807753">readCookies</span><span class="op" id="3807764">(</span><span class="ident" id="3807765">h</span>&nbsp;<span class="ident" id="3807767">Header</span><span class="op" id="3807773">,</span>&nbsp;<span class="ident" id="3807775">filter</span>&nbsp;<span class="builtintype" id="3807782">string</span><span class="op" id="3807788">)</span>&nbsp;<span class="op" id="3807790">[</span><span class="op" id="3807791">]</span><span class="op" id="3807792">*</span><span class="ident" id="3807793">Cookie</span>&nbsp;<span class="op" id="3807800">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807803">cookies</span>&nbsp;<span class="op" id="3807811">:=</span>&nbsp;<span class="op" id="3807814">[</span><span class="op" id="3807815">]</span><span class="op" id="3807816">*</span><span class="ident" id="3807817">Cookie</span><span class="op" id="3807823">{</span><span class="op" id="3807824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807827">lines</span><span class="op" id="3807832">,</span>&nbsp;<span class="ident" id="3807834">ok</span>&nbsp;<span class="op" id="3807837">:=</span>&nbsp;<span class="ident" id="3807840">h</span><span class="op" id="3807841">[</span><span class="string" id="3807842">&#34;Cookie&#34;</span><span class="op" id="3807850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807853">if</span>&nbsp;<span class="op" id="3807856">!</span><span class="ident" id="3807857">ok</span>&nbsp;<span class="op" id="3807860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807864">return</span>&nbsp;<span class="ident" id="3807871">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807880">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807884">for</span>&nbsp;<span class="ident" id="3807888">_</span><span class="op" id="3807889">,</span>&nbsp;<span class="ident" id="3807891">line</span>&nbsp;<span class="op" id="3807896">:=</span>&nbsp;<span class="keyword" id="3807899">range</span>&nbsp;<span class="ident" id="3807905">lines</span>&nbsp;<span class="op" id="3807911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807915">parts</span>&nbsp;<span class="op" id="3807921">:=</span>&nbsp;<span class="ident" id="3807924">strings</span><span class="op" id="3807931">.</span><span class="ident" id="3807932">Split</span><span class="op" id="3807937">(</span><span class="ident" id="3807938">strings</span><span class="op" id="3807945">.</span><span class="ident" id="3807946">TrimSpace</span><span class="op" id="3807955">(</span><span class="ident" id="3807956">line</span><span class="op" id="3807960">)</span><span class="op" id="3807961">,</span>&nbsp;<span class="string" id="3807963">&#34;;&#34;</span><span class="op" id="3807966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807970">if</span>&nbsp;<span class="builtinfunc" id="3807973">len</span><span class="op" id="3807976">(</span><span class="ident" id="3807977">parts</span><span class="op" id="3807982">)</span>&nbsp;<span class="op" id="3807984">==</span>&nbsp;<span class="num" id="3807987">1</span>&nbsp;<span class="op" id="3807989">&amp;&amp;</span>&nbsp;<span class="ident" id="3807992">parts</span><span class="op" id="3807997">[</span><span class="num" id="3807998">0</span><span class="op" id="3807999">]</span>&nbsp;<span class="op" id="3808001">==</span>&nbsp;<span class="string" id="3808004">&#34;&#34;</span>&nbsp;<span class="op" id="3808007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808012">continue</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3808027">//&nbsp;Per-line&nbsp;attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808052">parsedPairs</span>&nbsp;<span class="op" id="3808064">:=</span>&nbsp;<span class="num" id="3808067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808071">for</span>&nbsp;<span class="ident" id="3808075">i</span>&nbsp;<span class="op" id="3808077">:=</span>&nbsp;<span class="num" id="3808080">0</span><span class="op" id="3808081">;</span>&nbsp;<span class="ident" id="3808083">i</span>&nbsp;<span class="op" id="3808085">&lt;</span>&nbsp;<span class="builtinfunc" id="3808087">len</span><span class="op" id="3808090">(</span><span class="ident" id="3808091">parts</span><span class="op" id="3808096">)</span><span class="op" id="3808097">;</span>&nbsp;<span class="ident" id="3808099">i</span><span class="op" id="3808100">++</span>&nbsp;<span class="op" id="3808103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808108">parts</span><span class="op" id="3808113">[</span><span class="ident" id="3808114">i</span><span class="op" id="3808115">]</span>&nbsp;<span class="op" id="3808117">=</span>&nbsp;<span class="ident" id="3808119">strings</span><span class="op" id="3808126">.</span><span class="ident" id="3808127">TrimSpace</span><span class="op" id="3808136">(</span><span class="ident" id="3808137">parts</span><span class="op" id="3808142">[</span><span class="ident" id="3808143">i</span><span class="op" id="3808144">]</span><span class="op" id="3808145">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808150">if</span>&nbsp;<span class="builtinfunc" id="3808153">len</span><span class="op" id="3808156">(</span><span class="ident" id="3808157">parts</span><span class="op" id="3808162">[</span><span class="ident" id="3808163">i</span><span class="op" id="3808164">]</span><span class="op" id="3808165">)</span>&nbsp;<span class="op" id="3808167">==</span>&nbsp;<span class="num" id="3808170">0</span>&nbsp;<span class="op" id="3808172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808195">name</span><span class="op" id="3808199">,</span>&nbsp;<span class="ident" id="3808201">val</span>&nbsp;<span class="op" id="3808205">:=</span>&nbsp;<span class="ident" id="3808208">parts</span><span class="op" id="3808213">[</span><span class="ident" id="3808214">i</span><span class="op" id="3808215">]</span><span class="op" id="3808216">,</span>&nbsp;<span class="string" id="3808218">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808224">if</span>&nbsp;<span class="ident" id="3808227">j</span>&nbsp;<span class="op" id="3808229">:=</span>&nbsp;<span class="ident" id="3808232">strings</span><span class="op" id="3808239">.</span><span class="ident" id="3808240">Index</span><span class="op" id="3808245">(</span><span class="ident" id="3808246">name</span><span class="op" id="3808250">,</span>&nbsp;<span class="string" id="3808252">&#34;=&#34;</span><span class="op" id="3808255">)</span><span class="op" id="3808256">;</span>&nbsp;<span class="ident" id="3808258">j</span>&nbsp;<span class="op" id="3808260">&gt;=</span>&nbsp;<span class="num" id="3808263">0</span>&nbsp;<span class="op" id="3808265">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808271">name</span><span class="op" id="3808275">,</span>&nbsp;<span class="ident" id="3808277">val</span>&nbsp;<span class="op" id="3808281">=</span>&nbsp;<span class="ident" id="3808283">name</span><span class="op" id="3808287">[</span><span class="op" id="3808288">:</span><span class="ident" id="3808289">j</span><span class="op" id="3808290">]</span><span class="op" id="3808291">,</span>&nbsp;<span class="ident" id="3808293">name</span><span class="op" id="3808297">[</span><span class="ident" id="3808298">j</span><span class="op" id="3808299">+</span><span class="num" id="3808300">1</span><span class="op" id="3808301">:</span><span class="op" id="3808302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808312">if</span>&nbsp;<span class="op" id="3808315">!</span><span class="ident" id="3808316">isCookieNameValid</span><span class="op" id="3808333">(</span><span class="ident" id="3808334">name</span><span class="op" id="3808338">)</span>&nbsp;<span class="op" id="3808340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808346">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808358">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808363">if</span>&nbsp;<span class="ident" id="3808366">filter</span>&nbsp;<span class="op" id="3808373">!=</span>&nbsp;<span class="string" id="3808376">&#34;&#34;</span>&nbsp;<span class="op" id="3808379">&amp;&amp;</span>&nbsp;<span class="ident" id="3808382">filter</span>&nbsp;<span class="op" id="3808389">!=</span>&nbsp;<span class="ident" id="3808392">name</span>&nbsp;<span class="op" id="3808397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808403">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808420">val</span><span class="op" id="3808423">,</span>&nbsp;<span class="ident" id="3808425">success</span>&nbsp;<span class="op" id="3808433">:=</span>&nbsp;<span class="ident" id="3808436">parseCookieValue</span><span class="op" id="3808452">(</span><span class="ident" id="3808453">val</span><span class="op" id="3808456">,</span>&nbsp;<span class="builtintype" id="3808458">true</span><span class="op" id="3808462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808467">if</span>&nbsp;<span class="op" id="3808470">!</span><span class="ident" id="3808471">success</span>&nbsp;<span class="op" id="3808479">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808485">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808502">cookies</span>&nbsp;<span class="op" id="3808510">=</span>&nbsp;<span class="builtinfunc" id="3808512">append</span><span class="op" id="3808518">(</span><span class="ident" id="3808519">cookies</span><span class="op" id="3808526">,</span>&nbsp;<span class="op" id="3808528">&amp;</span><span class="ident" id="3808529">Cookie</span><span class="op" id="3808535">{</span><span class="ident" id="3808536">Name</span><span class="op" id="3808540">:</span>&nbsp;<span class="ident" id="3808542">name</span><span class="op" id="3808546">,</span>&nbsp;<span class="ident" id="3808548">Value</span><span class="op" id="3808553">:</span>&nbsp;<span class="ident" id="3808555">val</span><span class="op" id="3808558">}</span><span class="op" id="3808559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808564">parsedPairs</span><span class="op" id="3808575">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808580">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808586">return</span>&nbsp;<span class="ident" id="3808593">cookies</span><br>
<span class="lineno"></span><span class="op" id="3808601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3808604">//&nbsp;validCookieDomain&nbsp;returns&nbsp;wheter&nbsp;v&nbsp;is&nbsp;a&nbsp;valid&nbsp;cookie&nbsp;domain-value.</span><br>
<span class="lineno">220</span><span class="keyword" id="3808674">func</span>&nbsp;<span class="ident" id="3808679">validCookieDomain</span><span class="op" id="3808696">(</span><span class="ident" id="3808697">v</span>&nbsp;<span class="builtintype" id="3808699">string</span><span class="op" id="3808705">)</span>&nbsp;<span class="builtintype" id="3808707">bool</span>&nbsp;<span class="op" id="3808712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808715">if</span>&nbsp;<span class="ident" id="3808718">isCookieDomainName</span><span class="op" id="3808736">(</span><span class="ident" id="3808737">v</span><span class="op" id="3808738">)</span>&nbsp;<span class="op" id="3808740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808744">return</span>&nbsp;<span class="builtintype" id="3808751">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808760">if</span>&nbsp;<span class="ident" id="3808763">net</span><span class="op" id="3808766">.</span><span class="ident" id="3808767">ParseIP</span><span class="op" id="3808774">(</span><span class="ident" id="3808775">v</span><span class="op" id="3808776">)</span>&nbsp;<span class="op" id="3808778">!=</span>&nbsp;<span class="ident" id="3808781">nil</span>&nbsp;<span class="op" id="3808785">&amp;&amp;</span>&nbsp;<span class="op" id="3808788">!</span><span class="ident" id="3808789">strings</span><span class="op" id="3808796">.</span><span class="ident" id="3808797">Contains</span><span class="op" id="3808805">(</span><span class="ident" id="3808806">v</span><span class="op" id="3808807">,</span>&nbsp;<span class="string" id="3808809">&#34;:&#34;</span><span class="op" id="3808812">)</span>&nbsp;<span class="op" id="3808814">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808818">return</span>&nbsp;<span class="builtintype" id="3808825">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808834">return</span>&nbsp;<span class="builtintype" id="3808841">false</span><br>
<span class="lineno"></span><span class="op" id="3808847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3808850">//&nbsp;isCookieDomainName&nbsp;returns&nbsp;whether&nbsp;s&nbsp;is&nbsp;a&nbsp;valid&nbsp;domain&nbsp;name&nbsp;or&nbsp;a&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="3808924">//&nbsp;domain&nbsp;name&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot&nbsp;&#39;.&#39;.&nbsp;&nbsp;It&nbsp;is&nbsp;almost&nbsp;a&nbsp;direct&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3808994">//&nbsp;package&nbsp;net&#39;s&nbsp;isDomainName.</span><br>
<span class="lineno"></span><span class="keyword" id="3809025">func</span>&nbsp;<span class="ident" id="3809030">isCookieDomainName</span><span class="op" id="3809048">(</span><span class="ident" id="3809049">s</span>&nbsp;<span class="builtintype" id="3809051">string</span><span class="op" id="3809057">)</span>&nbsp;<span class="builtintype" id="3809059">bool</span>&nbsp;<span class="op" id="3809064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809067">if</span>&nbsp;<span class="builtinfunc" id="3809070">len</span><span class="op" id="3809073">(</span><span class="ident" id="3809074">s</span><span class="op" id="3809075">)</span>&nbsp;<span class="op" id="3809077">==</span>&nbsp;<span class="num" id="3809080">0</span>&nbsp;<span class="op" id="3809082">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809086">return</span>&nbsp;<span class="builtintype" id="3809093">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809103">if</span>&nbsp;<span class="builtinfunc" id="3809106">len</span><span class="op" id="3809109">(</span><span class="ident" id="3809110">s</span><span class="op" id="3809111">)</span>&nbsp;<span class="op" id="3809113">&gt;</span>&nbsp;<span class="num" id="3809115">255</span>&nbsp;<span class="op" id="3809119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809123">return</span>&nbsp;<span class="builtintype" id="3809130">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809137">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809141">if</span>&nbsp;<span class="ident" id="3809144">s</span><span class="op" id="3809145">[</span><span class="num" id="3809146">0</span><span class="op" id="3809147">]</span>&nbsp;<span class="op" id="3809149">==</span>&nbsp;<span class="string" id="3809152">&#39;.&#39;</span>&nbsp;<span class="op" id="3809156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809160">//&nbsp;A&nbsp;cookie&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;may&nbsp;start&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809223">s</span>&nbsp;<span class="op" id="3809225">=</span>&nbsp;<span class="ident" id="3809227">s</span><span class="op" id="3809228">[</span><span class="num" id="3809229">1</span><span class="op" id="3809230">:</span><span class="op" id="3809231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809234">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809237">last</span>&nbsp;<span class="op" id="3809242">:=</span>&nbsp;<span class="builtintype" id="3809245">byte</span><span class="op" id="3809249">(</span><span class="string" id="3809250">&#39;.&#39;</span><span class="op" id="3809253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809256">ok</span>&nbsp;<span class="op" id="3809259">:=</span>&nbsp;<span class="builtintype" id="3809262">false</span>&nbsp;<span class="comment" id="3809268">//&nbsp;Ok&nbsp;once&nbsp;we&#39;ve&nbsp;seen&nbsp;a&nbsp;letter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809301">partlen</span>&nbsp;<span class="op" id="3809309">:=</span>&nbsp;<span class="num" id="3809312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809315">for</span>&nbsp;<span class="ident" id="3809319">i</span>&nbsp;<span class="op" id="3809321">:=</span>&nbsp;<span class="num" id="3809324">0</span><span class="op" id="3809325">;</span>&nbsp;<span class="ident" id="3809327">i</span>&nbsp;<span class="op" id="3809329">&lt;</span>&nbsp;<span class="builtinfunc" id="3809331">len</span><span class="op" id="3809334">(</span><span class="ident" id="3809335">s</span><span class="op" id="3809336">)</span><span class="op" id="3809337">;</span>&nbsp;<span class="ident" id="3809339">i</span><span class="op" id="3809340">++</span>&nbsp;<span class="op" id="3809343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809347">c</span>&nbsp;<span class="op" id="3809349">:=</span>&nbsp;<span class="ident" id="3809352">s</span><span class="op" id="3809353">[</span><span class="ident" id="3809354">i</span><span class="op" id="3809355">]</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809359">switch</span>&nbsp;<span class="op" id="3809366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809370">default</span><span class="op" id="3809377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809382">return</span>&nbsp;<span class="builtintype" id="3809389">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809397">case</span>&nbsp;<span class="string" id="3809402">&#39;a&#39;</span>&nbsp;<span class="op" id="3809406">&lt;=</span>&nbsp;<span class="ident" id="3809409">c</span>&nbsp;<span class="op" id="3809411">&amp;&amp;</span>&nbsp;<span class="ident" id="3809414">c</span>&nbsp;<span class="op" id="3809416">&lt;=</span>&nbsp;<span class="string" id="3809419">&#39;z&#39;</span>&nbsp;<span class="op" id="3809423">||</span>&nbsp;<span class="string" id="3809426">&#39;A&#39;</span>&nbsp;<span class="op" id="3809430">&lt;=</span>&nbsp;<span class="ident" id="3809433">c</span>&nbsp;<span class="op" id="3809435">&amp;&amp;</span>&nbsp;<span class="ident" id="3809438">c</span>&nbsp;<span class="op" id="3809440">&lt;=</span>&nbsp;<span class="string" id="3809443">&#39;Z&#39;</span><span class="op" id="3809446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809451">//&nbsp;No&nbsp;&#39;_&#39;&nbsp;allowed&nbsp;here&nbsp;(in&nbsp;contrast&nbsp;to&nbsp;package&nbsp;net).</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809507">ok</span>&nbsp;<span class="op" id="3809510">=</span>&nbsp;<span class="builtintype" id="3809512">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809520">partlen</span><span class="op" id="3809527">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809532">case</span>&nbsp;<span class="string" id="3809537">&#39;0&#39;</span>&nbsp;<span class="op" id="3809541">&lt;=</span>&nbsp;<span class="ident" id="3809544">c</span>&nbsp;<span class="op" id="3809546">&amp;&amp;</span>&nbsp;<span class="ident" id="3809549">c</span>&nbsp;<span class="op" id="3809551">&lt;=</span>&nbsp;<span class="string" id="3809554">&#39;9&#39;</span><span class="op" id="3809557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809562">//&nbsp;fine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809573">partlen</span><span class="op" id="3809580">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809585">case</span>&nbsp;<span class="ident" id="3809590">c</span>&nbsp;<span class="op" id="3809592">==</span>&nbsp;<span class="string" id="3809595">&#39;-&#39;</span><span class="op" id="3809598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809603">//&nbsp;Byte&nbsp;before&nbsp;dash&nbsp;cannot&nbsp;be&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809641">if</span>&nbsp;<span class="ident" id="3809644">last</span>&nbsp;<span class="op" id="3809649">==</span>&nbsp;<span class="string" id="3809652">&#39;.&#39;</span>&nbsp;<span class="op" id="3809656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809662">return</span>&nbsp;<span class="builtintype" id="3809669">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809678">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809683">partlen</span><span class="op" id="3809690">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809695">case</span>&nbsp;<span class="ident" id="3809700">c</span>&nbsp;<span class="op" id="3809702">==</span>&nbsp;<span class="string" id="3809705">&#39;.&#39;</span><span class="op" id="3809708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3809713">//&nbsp;Byte&nbsp;before&nbsp;dot&nbsp;cannot&nbsp;be&nbsp;dot,&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809756">if</span>&nbsp;<span class="ident" id="3809759">last</span>&nbsp;<span class="op" id="3809764">==</span>&nbsp;<span class="string" id="3809767">&#39;.&#39;</span>&nbsp;<span class="op" id="3809771">||</span>&nbsp;<span class="ident" id="3809774">last</span>&nbsp;<span class="op" id="3809779">==</span>&nbsp;<span class="string" id="3809782">&#39;-&#39;</span>&nbsp;<span class="op" id="3809786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809792">return</span>&nbsp;<span class="builtintype" id="3809799">false</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809813">if</span>&nbsp;<span class="ident" id="3809816">partlen</span>&nbsp;<span class="op" id="3809824">&gt;</span>&nbsp;<span class="num" id="3809826">63</span>&nbsp;<span class="op" id="3809829">||</span>&nbsp;<span class="ident" id="3809832">partlen</span>&nbsp;<span class="op" id="3809840">==</span>&nbsp;<span class="num" id="3809843">0</span>&nbsp;<span class="op" id="3809845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809851">return</span>&nbsp;<span class="builtintype" id="3809858">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809872">partlen</span>&nbsp;<span class="op" id="3809880">=</span>&nbsp;<span class="num" id="3809882">0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3809890">last</span>&nbsp;<span class="op" id="3809895">=</span>&nbsp;<span class="ident" id="3809897">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809903">if</span>&nbsp;<span class="ident" id="3809906">last</span>&nbsp;<span class="op" id="3809911">==</span>&nbsp;<span class="string" id="3809914">&#39;-&#39;</span>&nbsp;<span class="op" id="3809918">||</span>&nbsp;<span class="ident" id="3809921">partlen</span>&nbsp;<span class="op" id="3809929">&gt;</span>&nbsp;<span class="num" id="3809931">63</span>&nbsp;<span class="op" id="3809934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809938">return</span>&nbsp;<span class="builtintype" id="3809945">false</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3809952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3809956">return</span>&nbsp;<span class="ident" id="3809963">ok</span><br>
<span class="lineno"></span><span class="op" id="3809966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="3809969">var</span>&nbsp;<span class="ident" id="3809973">cookieNameSanitizer</span>&nbsp;<span class="op" id="3809993">=</span>&nbsp;<span class="ident" id="3809995">strings</span><span class="op" id="3810002">.</span><span class="ident" id="3810003">NewReplacer</span><span class="op" id="3810014">(</span><span class="string" id="3810015">&#34;\n&#34;</span><span class="op" id="3810019">,</span>&nbsp;<span class="string" id="3810021">&#34;-&#34;</span><span class="op" id="3810024">,</span>&nbsp;<span class="string" id="3810026">&#34;\r&#34;</span><span class="op" id="3810030">,</span>&nbsp;<span class="string" id="3810032">&#34;-&#34;</span><span class="op" id="3810035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3810038">func</span>&nbsp;<span class="ident" id="3810043">sanitizeCookieName</span><span class="op" id="3810061">(</span><span class="ident" id="3810062">n</span>&nbsp;<span class="builtintype" id="3810064">string</span><span class="op" id="3810070">)</span>&nbsp;<span class="builtintype" id="3810072">string</span>&nbsp;<span class="op" id="3810079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810082">return</span>&nbsp;<span class="ident" id="3810089">cookieNameSanitizer</span><span class="op" id="3810108">.</span><span class="ident" id="3810109">Replace</span><span class="op" id="3810116">(</span><span class="ident" id="3810117">n</span><span class="op" id="3810118">)</span><br>
<span class="lineno"></span><span class="op" id="3810120">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3810123">//&nbsp;http://tools.ietf.org/html/rfc6265#section-4.1.1</span><br>
<span class="lineno"></span><span class="comment" id="3810175">//&nbsp;cookie-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;*cookie-octet&nbsp;/&nbsp;(&nbsp;DQUOTE&nbsp;*cookie-octet&nbsp;DQUOTE&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="3810246">//&nbsp;cookie-octet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;%x21&nbsp;/&nbsp;%x23-2B&nbsp;/&nbsp;%x2D-3A&nbsp;/&nbsp;%x3C-5B&nbsp;/&nbsp;%x5D-7E</span><br>
<span class="lineno"></span><span class="comment" id="3810314">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;US-ASCII&nbsp;characters&nbsp;excluding&nbsp;CTLs,</span><br>
<span class="lineno">295</span><span class="comment" id="3810365">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;whitespace&nbsp;DQUOTE,&nbsp;comma,&nbsp;semicolon,</span><br>
<span class="lineno"></span><span class="comment" id="3810417">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;backslash</span><br>
<span class="lineno"></span><span class="comment" id="3810446">//&nbsp;We&nbsp;loosen&nbsp;this&nbsp;as&nbsp;spaces&nbsp;and&nbsp;commas&nbsp;are&nbsp;common&nbsp;in&nbsp;cookie&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3810513">//&nbsp;but&nbsp;we&nbsp;produce&nbsp;a&nbsp;quoted&nbsp;cookie-value&nbsp;in&nbsp;when&nbsp;value&nbsp;starts&nbsp;or&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="3810582">//&nbsp;with&nbsp;a&nbsp;comma&nbsp;or&nbsp;space.</span><br>
<span class="lineno">300</span><span class="comment" id="3810608">//&nbsp;See&nbsp;http://golang.org/issue/7243&nbsp;for&nbsp;the&nbsp;discussion.</span><br>
<span class="lineno"></span><span class="keyword" id="3810664">func</span>&nbsp;<span class="ident" id="3810669">sanitizeCookieValue</span><span class="op" id="3810688">(</span><span class="ident" id="3810689">v</span>&nbsp;<span class="builtintype" id="3810691">string</span><span class="op" id="3810697">)</span>&nbsp;<span class="builtintype" id="3810699">string</span>&nbsp;<span class="op" id="3810706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810709">v</span>&nbsp;<span class="op" id="3810711">=</span>&nbsp;<span class="ident" id="3810713">sanitizeOrWarn</span><span class="op" id="3810727">(</span><span class="string" id="3810728">&#34;Cookie.Value&#34;</span><span class="op" id="3810742">,</span>&nbsp;<span class="ident" id="3810744">validCookieValueByte</span><span class="op" id="3810764">,</span>&nbsp;<span class="ident" id="3810766">v</span><span class="op" id="3810767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810770">if</span>&nbsp;<span class="builtinfunc" id="3810773">len</span><span class="op" id="3810776">(</span><span class="ident" id="3810777">v</span><span class="op" id="3810778">)</span>&nbsp;<span class="op" id="3810780">==</span>&nbsp;<span class="num" id="3810783">0</span>&nbsp;<span class="op" id="3810785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810789">return</span>&nbsp;<span class="ident" id="3810796">v</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810802">if</span>&nbsp;<span class="ident" id="3810805">v</span><span class="op" id="3810806">[</span><span class="num" id="3810807">0</span><span class="op" id="3810808">]</span>&nbsp;<span class="op" id="3810810">==</span>&nbsp;<span class="string" id="3810813">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3810817">||</span>&nbsp;<span class="ident" id="3810820">v</span><span class="op" id="3810821">[</span><span class="num" id="3810822">0</span><span class="op" id="3810823">]</span>&nbsp;<span class="op" id="3810825">==</span>&nbsp;<span class="string" id="3810828">&#39;,&#39;</span>&nbsp;<span class="op" id="3810832">||</span>&nbsp;<span class="ident" id="3810835">v</span><span class="op" id="3810836">[</span><span class="builtinfunc" id="3810837">len</span><span class="op" id="3810840">(</span><span class="ident" id="3810841">v</span><span class="op" id="3810842">)</span><span class="op" id="3810843">-</span><span class="num" id="3810844">1</span><span class="op" id="3810845">]</span>&nbsp;<span class="op" id="3810847">==</span>&nbsp;<span class="string" id="3810850">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3810854">||</span>&nbsp;<span class="ident" id="3810857">v</span><span class="op" id="3810858">[</span><span class="builtinfunc" id="3810859">len</span><span class="op" id="3810862">(</span><span class="ident" id="3810863">v</span><span class="op" id="3810864">)</span><span class="op" id="3810865">-</span><span class="num" id="3810866">1</span><span class="op" id="3810867">]</span>&nbsp;<span class="op" id="3810869">==</span>&nbsp;<span class="string" id="3810872">&#39;,&#39;</span>&nbsp;<span class="op" id="3810876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810880">return</span>&nbsp;<span class="string" id="3810887">`&#34;`</span>&nbsp;<span class="op" id="3810891">+</span>&nbsp;<span class="ident" id="3810893">v</span>&nbsp;<span class="op" id="3810895">+</span>&nbsp;<span class="string" id="3810897">`&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810905">return</span>&nbsp;<span class="ident" id="3810912">v</span><br>
<span class="lineno">310</span><span class="op" id="3810914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3810917">func</span>&nbsp;<span class="ident" id="3810922">validCookieValueByte</span><span class="op" id="3810942">(</span><span class="ident" id="3810943">b</span>&nbsp;<span class="builtintype" id="3810945">byte</span><span class="op" id="3810949">)</span>&nbsp;<span class="builtintype" id="3810951">bool</span>&nbsp;<span class="op" id="3810956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810959">return</span>&nbsp;<span class="num" id="3810966">0x20</span>&nbsp;<span class="op" id="3810971">&lt;=</span>&nbsp;<span class="ident" id="3810974">b</span>&nbsp;<span class="op" id="3810976">&amp;&amp;</span>&nbsp;<span class="ident" id="3810979">b</span>&nbsp;<span class="op" id="3810981">&lt;</span>&nbsp;<span class="num" id="3810983">0x7f</span>&nbsp;<span class="op" id="3810988">&amp;&amp;</span>&nbsp;<span class="ident" id="3810991">b</span>&nbsp;<span class="op" id="3810993">!=</span>&nbsp;<span class="string" id="3810996">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3811000">&amp;&amp;</span>&nbsp;<span class="ident" id="3811003">b</span>&nbsp;<span class="op" id="3811005">!=</span>&nbsp;<span class="string" id="3811008">&#39;;&#39;</span>&nbsp;<span class="op" id="3811012">&amp;&amp;</span>&nbsp;<span class="ident" id="3811015">b</span>&nbsp;<span class="op" id="3811017">!=</span>&nbsp;<span class="string" id="3811020">&#39;\\&#39;</span><br>
<span class="lineno"></span><span class="op" id="3811025">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3811028">//&nbsp;path-av&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&#34;Path=&#34;&nbsp;path-value</span><br>
<span class="lineno"></span><span class="comment" id="3811070">//&nbsp;path-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;any&nbsp;CHAR&nbsp;except&nbsp;CTLs&nbsp;or&nbsp;&#34;;&#34;&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="3811123">func</span>&nbsp;<span class="ident" id="3811128">sanitizeCookiePath</span><span class="op" id="3811146">(</span><span class="ident" id="3811147">v</span>&nbsp;<span class="builtintype" id="3811149">string</span><span class="op" id="3811155">)</span>&nbsp;<span class="builtintype" id="3811157">string</span>&nbsp;<span class="op" id="3811164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811167">return</span>&nbsp;<span class="ident" id="3811174">sanitizeOrWarn</span><span class="op" id="3811188">(</span><span class="string" id="3811189">&#34;Cookie.Path&#34;</span><span class="op" id="3811202">,</span>&nbsp;<span class="ident" id="3811204">validCookiePathByte</span><span class="op" id="3811223">,</span>&nbsp;<span class="ident" id="3811225">v</span><span class="op" id="3811226">)</span><br>
<span class="lineno">320</span><span class="op" id="3811228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3811231">func</span>&nbsp;<span class="ident" id="3811236">validCookiePathByte</span><span class="op" id="3811255">(</span><span class="ident" id="3811256">b</span>&nbsp;<span class="builtintype" id="3811258">byte</span><span class="op" id="3811262">)</span>&nbsp;<span class="builtintype" id="3811264">bool</span>&nbsp;<span class="op" id="3811269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811272">return</span>&nbsp;<span class="num" id="3811279">0x20</span>&nbsp;<span class="op" id="3811284">&lt;=</span>&nbsp;<span class="ident" id="3811287">b</span>&nbsp;<span class="op" id="3811289">&amp;&amp;</span>&nbsp;<span class="ident" id="3811292">b</span>&nbsp;<span class="op" id="3811294">&lt;</span>&nbsp;<span class="num" id="3811296">0x7f</span>&nbsp;<span class="op" id="3811301">&amp;&amp;</span>&nbsp;<span class="ident" id="3811304">b</span>&nbsp;<span class="op" id="3811306">!=</span>&nbsp;<span class="string" id="3811309">&#39;;&#39;</span><br>
<span class="lineno"></span><span class="op" id="3811313">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="3811316">func</span>&nbsp;<span class="ident" id="3811321">sanitizeOrWarn</span><span class="op" id="3811335">(</span><span class="ident" id="3811336">fieldName</span>&nbsp;<span class="builtintype" id="3811346">string</span><span class="op" id="3811352">,</span>&nbsp;<span class="ident" id="3811354">valid</span>&nbsp;<span class="keyword" id="3811360">func</span><span class="op" id="3811364">(</span><span class="builtintype" id="3811365">byte</span><span class="op" id="3811369">)</span>&nbsp;<span class="builtintype" id="3811371">bool</span><span class="op" id="3811375">,</span>&nbsp;<span class="ident" id="3811377">v</span>&nbsp;<span class="builtintype" id="3811379">string</span><span class="op" id="3811385">)</span>&nbsp;<span class="builtintype" id="3811387">string</span>&nbsp;<span class="op" id="3811394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811397">ok</span>&nbsp;<span class="op" id="3811400">:=</span>&nbsp;<span class="builtintype" id="3811403">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811409">for</span>&nbsp;<span class="ident" id="3811413">i</span>&nbsp;<span class="op" id="3811415">:=</span>&nbsp;<span class="num" id="3811418">0</span><span class="op" id="3811419">;</span>&nbsp;<span class="ident" id="3811421">i</span>&nbsp;<span class="op" id="3811423">&lt;</span>&nbsp;<span class="builtinfunc" id="3811425">len</span><span class="op" id="3811428">(</span><span class="ident" id="3811429">v</span><span class="op" id="3811430">)</span><span class="op" id="3811431">;</span>&nbsp;<span class="ident" id="3811433">i</span><span class="op" id="3811434">++</span>&nbsp;<span class="op" id="3811437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811441">if</span>&nbsp;<span class="ident" id="3811444">valid</span><span class="op" id="3811449">(</span><span class="ident" id="3811450">v</span><span class="op" id="3811451">[</span><span class="ident" id="3811452">i</span><span class="op" id="3811453">]</span><span class="op" id="3811454">)</span>&nbsp;<span class="op" id="3811456">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811461">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811476">log</span><span class="op" id="3811479">.</span><span class="ident" id="3811480">Printf</span><span class="op" id="3811486">(</span><span class="string" id="3811487">&#34;net/http:&nbsp;invalid&nbsp;byte&nbsp;%q&nbsp;in&nbsp;%s;&nbsp;dropping&nbsp;invalid&nbsp;bytes&#34;</span><span class="op" id="3811544">,</span>&nbsp;<span class="ident" id="3811546">v</span><span class="op" id="3811547">[</span><span class="ident" id="3811548">i</span><span class="op" id="3811549">]</span><span class="op" id="3811550">,</span>&nbsp;<span class="ident" id="3811552">fieldName</span><span class="op" id="3811561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811565">ok</span>&nbsp;<span class="op" id="3811568">=</span>&nbsp;<span class="builtintype" id="3811570">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811578">break</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811588">if</span>&nbsp;<span class="ident" id="3811591">ok</span>&nbsp;<span class="op" id="3811594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811598">return</span>&nbsp;<span class="ident" id="3811605">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811611">buf</span>&nbsp;<span class="op" id="3811615">:=</span>&nbsp;<span class="builtinfunc" id="3811618">make</span><span class="op" id="3811622">(</span><span class="op" id="3811623">[</span><span class="op" id="3811624">]</span><span class="builtintype" id="3811625">byte</span><span class="op" id="3811629">,</span>&nbsp;<span class="num" id="3811631">0</span><span class="op" id="3811632">,</span>&nbsp;<span class="builtinfunc" id="3811634">len</span><span class="op" id="3811637">(</span><span class="ident" id="3811638">v</span><span class="op" id="3811639">)</span><span class="op" id="3811640">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811643">for</span>&nbsp;<span class="ident" id="3811647">i</span>&nbsp;<span class="op" id="3811649">:=</span>&nbsp;<span class="num" id="3811652">0</span><span class="op" id="3811653">;</span>&nbsp;<span class="ident" id="3811655">i</span>&nbsp;<span class="op" id="3811657">&lt;</span>&nbsp;<span class="builtinfunc" id="3811659">len</span><span class="op" id="3811662">(</span><span class="ident" id="3811663">v</span><span class="op" id="3811664">)</span><span class="op" id="3811665">;</span>&nbsp;<span class="ident" id="3811667">i</span><span class="op" id="3811668">++</span>&nbsp;<span class="op" id="3811671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811675">if</span>&nbsp;<span class="ident" id="3811678">b</span>&nbsp;<span class="op" id="3811680">:=</span>&nbsp;<span class="ident" id="3811683">v</span><span class="op" id="3811684">[</span><span class="ident" id="3811685">i</span><span class="op" id="3811686">]</span><span class="op" id="3811687">;</span>&nbsp;<span class="ident" id="3811689">valid</span><span class="op" id="3811694">(</span><span class="ident" id="3811695">b</span><span class="op" id="3811696">)</span>&nbsp;<span class="op" id="3811698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811703">buf</span>&nbsp;<span class="op" id="3811707">=</span>&nbsp;<span class="builtinfunc" id="3811709">append</span><span class="op" id="3811715">(</span><span class="ident" id="3811716">buf</span><span class="op" id="3811719">,</span>&nbsp;<span class="ident" id="3811721">b</span><span class="op" id="3811722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811729">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811732">return</span>&nbsp;<span class="builtintype" id="3811739">string</span><span class="op" id="3811745">(</span><span class="ident" id="3811746">buf</span><span class="op" id="3811749">)</span><br>
<span class="lineno"></span><span class="op" id="3811751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3811754">func</span>&nbsp;<span class="ident" id="3811759">parseCookieValue</span><span class="op" id="3811775">(</span><span class="ident" id="3811776">raw</span>&nbsp;<span class="builtintype" id="3811780">string</span><span class="op" id="3811786">,</span>&nbsp;<span class="ident" id="3811788">allowDoubleQuote</span>&nbsp;<span class="builtintype" id="3811805">bool</span><span class="op" id="3811809">)</span>&nbsp;<span class="op" id="3811811">(</span><span class="builtintype" id="3811812">string</span><span class="op" id="3811818">,</span>&nbsp;<span class="builtintype" id="3811820">bool</span><span class="op" id="3811824">)</span>&nbsp;<span class="op" id="3811826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3811829">//&nbsp;Strip&nbsp;the&nbsp;quotes,&nbsp;if&nbsp;present.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811863">if</span>&nbsp;<span class="ident" id="3811866">allowDoubleQuote</span>&nbsp;<span class="op" id="3811883">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3811886">len</span><span class="op" id="3811889">(</span><span class="ident" id="3811890">raw</span><span class="op" id="3811893">)</span>&nbsp;<span class="op" id="3811895">&gt;</span>&nbsp;<span class="num" id="3811897">1</span>&nbsp;<span class="op" id="3811899">&amp;&amp;</span>&nbsp;<span class="ident" id="3811902">raw</span><span class="op" id="3811905">[</span><span class="num" id="3811906">0</span><span class="op" id="3811907">]</span>&nbsp;<span class="op" id="3811909">==</span>&nbsp;<span class="string" id="3811912">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3811916">&amp;&amp;</span>&nbsp;<span class="ident" id="3811919">raw</span><span class="op" id="3811922">[</span><span class="builtinfunc" id="3811923">len</span><span class="op" id="3811926">(</span><span class="ident" id="3811927">raw</span><span class="op" id="3811930">)</span><span class="op" id="3811931">-</span><span class="num" id="3811932">1</span><span class="op" id="3811933">]</span>&nbsp;<span class="op" id="3811935">==</span>&nbsp;<span class="string" id="3811938">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3811942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811946">raw</span>&nbsp;<span class="op" id="3811950">=</span>&nbsp;<span class="ident" id="3811952">raw</span><span class="op" id="3811955">[</span><span class="num" id="3811956">1</span>&nbsp;<span class="op" id="3811958">:</span>&nbsp;<span class="builtinfunc" id="3811960">len</span><span class="op" id="3811963">(</span><span class="ident" id="3811964">raw</span><span class="op" id="3811967">)</span><span class="op" id="3811968">-</span><span class="num" id="3811969">1</span><span class="op" id="3811970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811976">for</span>&nbsp;<span class="ident" id="3811980">i</span>&nbsp;<span class="op" id="3811982">:=</span>&nbsp;<span class="num" id="3811985">0</span><span class="op" id="3811986">;</span>&nbsp;<span class="ident" id="3811988">i</span>&nbsp;<span class="op" id="3811990">&lt;</span>&nbsp;<span class="builtinfunc" id="3811992">len</span><span class="op" id="3811995">(</span><span class="ident" id="3811996">raw</span><span class="op" id="3811999">)</span><span class="op" id="3812000">;</span>&nbsp;<span class="ident" id="3812002">i</span><span class="op" id="3812003">++</span>&nbsp;<span class="op" id="3812006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812010">if</span>&nbsp;<span class="op" id="3812013">!</span><span class="ident" id="3812014">validCookieValueByte</span><span class="op" id="3812034">(</span><span class="ident" id="3812035">raw</span><span class="op" id="3812038">[</span><span class="ident" id="3812039">i</span><span class="op" id="3812040">]</span><span class="op" id="3812041">)</span>&nbsp;<span class="op" id="3812043">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812048">return</span>&nbsp;<span class="string" id="3812055">&#34;&#34;</span><span class="op" id="3812057">,</span>&nbsp;<span class="builtintype" id="3812059">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812073">return</span>&nbsp;<span class="ident" id="3812080">raw</span><span class="op" id="3812083">,</span>&nbsp;<span class="builtintype" id="3812085">true</span><br>
<span class="lineno"></span><span class="op" id="3812090">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="3812093">func</span>&nbsp;<span class="ident" id="3812098">isCookieNameValid</span><span class="op" id="3812115">(</span><span class="ident" id="3812116">raw</span>&nbsp;<span class="builtintype" id="3812120">string</span><span class="op" id="3812126">)</span>&nbsp;<span class="builtintype" id="3812128">bool</span>&nbsp;<span class="op" id="3812133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812136">return</span>&nbsp;<span class="ident" id="3812143">strings</span><span class="op" id="3812150">.</span><span class="ident" id="3812151">IndexFunc</span><span class="op" id="3812160">(</span><span class="ident" id="3812161">raw</span><span class="op" id="3812164">,</span>&nbsp;<span class="ident" id="3812166">isNotToken</span><span class="op" id="3812176">)</span>&nbsp;<span class="op" id="3812178">&lt;</span>&nbsp;<span class="num" id="3812180">0</span><br>
<span class="lineno"></span><span class="op" id="3812182">}</span>
</div>
</body>
</html>
