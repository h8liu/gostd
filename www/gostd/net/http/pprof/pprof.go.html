<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6165675">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6165731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6165785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6165836">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6165903">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="6165962">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6166003">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="6166050">//</span><br>
<span class="lineno">10</span><span class="comment" id="6166053">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6166118">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="6166152">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="6166203">//</span><br>
<span class="lineno"></span><span class="comment" id="6166206">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="6166260">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6166289">//</span><br>
<span class="lineno"></span><span class="comment" id="6166292">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="6166358">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6166426">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="6166471">//</span><br>
<span class="lineno"></span><span class="comment" id="6166474">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6166490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="6166551">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="6166559">//</span><br>
<span class="lineno">25</span><span class="comment" id="6166562">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6166618">//</span><br>
<span class="lineno"></span><span class="comment" id="6166621">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="6166677">//</span><br>
<span class="lineno"></span><span class="comment" id="6166680">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="6166722">//</span><br>
<span class="lineno"></span><span class="comment" id="6166725">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="6166784">//</span><br>
<span class="lineno"></span><span class="comment" id="6166787">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6166836">//</span><br>
<span class="lineno">35</span><span class="comment" id="6166839">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="6166896">//</span><br>
<span class="lineno"></span><span class="comment" id="6166899">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="6166974">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="6166994">//</span><br>
<span class="lineno">40</span><span class="comment" id="6166997">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="6167045">//</span><br>
<span class="lineno"></span><span class="comment" id="6167048">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="6167109">//</span><br>
<span class="lineno"></span><span class="keyword" id="6167112">package</span>&nbsp;<span class="ident" id="6167120">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6167127">import</span>&nbsp;<span class="op" id="6167134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167137">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167146">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167155">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167162">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167179">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167185">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167192">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167204">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167210">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167221">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167238">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167249">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6167260">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="6167267">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6167270">func</span>&nbsp;<span class="ident" id="6167275">init</span><span class="op" id="6167279">(</span><span class="op" id="6167280">)</span>&nbsp;<span class="op" id="6167282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167285">http</span><span class="op" id="6167289">.</span><span class="ident" id="6167290">Handle</span><span class="op" id="6167296">(</span><span class="string" id="6167297">&#34;/debug/pprof/&#34;</span><span class="op" id="6167312">,</span>&nbsp;<span class="ident" id="6167314">http</span><span class="op" id="6167318">.</span><span class="ident" id="6167319">HandlerFunc</span><span class="op" id="6167330">(</span><span class="ident" id="6167331">Index</span><span class="op" id="6167336">)</span><span class="op" id="6167337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167340">http</span><span class="op" id="6167344">.</span><span class="ident" id="6167345">Handle</span><span class="op" id="6167351">(</span><span class="string" id="6167352">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="6167374">,</span>&nbsp;<span class="ident" id="6167376">http</span><span class="op" id="6167380">.</span><span class="ident" id="6167381">HandlerFunc</span><span class="op" id="6167392">(</span><span class="ident" id="6167393">Cmdline</span><span class="op" id="6167400">)</span><span class="op" id="6167401">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167404">http</span><span class="op" id="6167408">.</span><span class="ident" id="6167409">Handle</span><span class="op" id="6167415">(</span><span class="string" id="6167416">&#34;/debug/pprof/profile&#34;</span><span class="op" id="6167438">,</span>&nbsp;<span class="ident" id="6167440">http</span><span class="op" id="6167444">.</span><span class="ident" id="6167445">HandlerFunc</span><span class="op" id="6167456">(</span><span class="ident" id="6167457">Profile</span><span class="op" id="6167464">)</span><span class="op" id="6167465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167468">http</span><span class="op" id="6167472">.</span><span class="ident" id="6167473">Handle</span><span class="op" id="6167479">(</span><span class="string" id="6167480">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="6167501">,</span>&nbsp;<span class="ident" id="6167503">http</span><span class="op" id="6167507">.</span><span class="ident" id="6167508">HandlerFunc</span><span class="op" id="6167519">(</span><span class="ident" id="6167520">Symbol</span><span class="op" id="6167526">)</span><span class="op" id="6167527">)</span><br>
<span class="lineno"></span><span class="op" id="6167529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167532">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="6167579">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="6167635">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="6167703">func</span>&nbsp;<span class="ident" id="6167708">Cmdline</span><span class="op" id="6167715">(</span><span class="ident" id="6167716">w</span>&nbsp;<span class="ident" id="6167718">http</span><span class="op" id="6167722">.</span><span class="ident" id="6167723">ResponseWriter</span><span class="op" id="6167737">,</span>&nbsp;<span class="ident" id="6167739">r</span>&nbsp;<span class="op" id="6167741">*</span><span class="ident" id="6167742">http</span><span class="op" id="6167746">.</span><span class="ident" id="6167747">Request</span><span class="op" id="6167754">)</span>&nbsp;<span class="op" id="6167756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167759">w</span><span class="op" id="6167760">.</span><span class="ident" id="6167761">Header</span><span class="op" id="6167767">(</span><span class="op" id="6167768">)</span><span class="op" id="6167769">.</span><span class="ident" id="6167770">Set</span><span class="op" id="6167773">(</span><span class="string" id="6167774">&#34;Content-Type&#34;</span><span class="op" id="6167788">,</span>&nbsp;<span class="string" id="6167790">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6167817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167820">fmt</span><span class="op" id="6167823">.</span><span class="ident" id="6167824">Fprintf</span><span class="op" id="6167831">(</span><span class="ident" id="6167832">w</span><span class="op" id="6167833">,</span>&nbsp;<span class="ident" id="6167835">strings</span><span class="op" id="6167842">.</span><span class="ident" id="6167843">Join</span><span class="op" id="6167847">(</span><span class="ident" id="6167848">os</span><span class="op" id="6167850">.</span><span class="ident" id="6167851">Args</span><span class="op" id="6167855">,</span>&nbsp;<span class="string" id="6167857">&#34;\x00&#34;</span><span class="op" id="6167863">)</span><span class="op" id="6167864">)</span><br>
<span class="lineno">75</span><span class="op" id="6167866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167869">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="6167927">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6167995">func</span>&nbsp;<span class="ident" id="6168000">Profile</span><span class="op" id="6168007">(</span><span class="ident" id="6168008">w</span>&nbsp;<span class="ident" id="6168010">http</span><span class="op" id="6168014">.</span><span class="ident" id="6168015">ResponseWriter</span><span class="op" id="6168029">,</span>&nbsp;<span class="ident" id="6168031">r</span>&nbsp;<span class="op" id="6168033">*</span><span class="ident" id="6168034">http</span><span class="op" id="6168038">.</span><span class="ident" id="6168039">Request</span><span class="op" id="6168046">)</span>&nbsp;<span class="op" id="6168048">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168051">sec</span><span class="op" id="6168054">,</span>&nbsp;<span class="ident" id="6168056">_</span>&nbsp;<span class="op" id="6168058">:=</span>&nbsp;<span class="ident" id="6168061">strconv</span><span class="op" id="6168068">.</span><span class="ident" id="6168069">ParseInt</span><span class="op" id="6168077">(</span><span class="ident" id="6168078">r</span><span class="op" id="6168079">.</span><span class="ident" id="6168080">FormValue</span><span class="op" id="6168089">(</span><span class="string" id="6168090">&#34;seconds&#34;</span><span class="op" id="6168099">)</span><span class="op" id="6168100">,</span>&nbsp;<span class="num" id="6168102">10</span><span class="op" id="6168104">,</span>&nbsp;<span class="num" id="6168106">64</span><span class="op" id="6168108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168111">if</span>&nbsp;<span class="ident" id="6168114">sec</span>&nbsp;<span class="op" id="6168118">==</span>&nbsp;<span class="num" id="6168121">0</span>&nbsp;<span class="op" id="6168123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168127">sec</span>&nbsp;<span class="op" id="6168131">=</span>&nbsp;<span class="num" id="6168133">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168141">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168198">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168240">w</span><span class="op" id="6168241">.</span><span class="ident" id="6168242">Header</span><span class="op" id="6168248">(</span><span class="op" id="6168249">)</span><span class="op" id="6168250">.</span><span class="ident" id="6168251">Set</span><span class="op" id="6168254">(</span><span class="string" id="6168255">&#34;Content-Type&#34;</span><span class="op" id="6168269">,</span>&nbsp;<span class="string" id="6168271">&#34;application/octet-stream&#34;</span><span class="op" id="6168297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168300">if</span>&nbsp;<span class="ident" id="6168303">err</span>&nbsp;<span class="op" id="6168307">:=</span>&nbsp;<span class="ident" id="6168310">pprof</span><span class="op" id="6168315">.</span><span class="ident" id="6168316">StartCPUProfile</span><span class="op" id="6168331">(</span><span class="ident" id="6168332">w</span><span class="op" id="6168333">)</span><span class="op" id="6168334">;</span>&nbsp;<span class="ident" id="6168336">err</span>&nbsp;<span class="op" id="6168340">!=</span>&nbsp;<span class="ident" id="6168343">nil</span>&nbsp;<span class="op" id="6168347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168351">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168398">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6168442">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168468">w</span><span class="op" id="6168469">.</span><span class="ident" id="6168470">Header</span><span class="op" id="6168476">(</span><span class="op" id="6168477">)</span><span class="op" id="6168478">.</span><span class="ident" id="6168479">Set</span><span class="op" id="6168482">(</span><span class="string" id="6168483">&#34;Content-Type&#34;</span><span class="op" id="6168497">,</span>&nbsp;<span class="string" id="6168499">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6168526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168530">w</span><span class="op" id="6168531">.</span><span class="ident" id="6168532">WriteHeader</span><span class="op" id="6168543">(</span><span class="ident" id="6168544">http</span><span class="op" id="6168548">.</span><span class="ident" id="6168549">StatusInternalServerError</span><span class="op" id="6168574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168578">fmt</span><span class="op" id="6168581">.</span><span class="ident" id="6168582">Fprintf</span><span class="op" id="6168589">(</span><span class="ident" id="6168590">w</span><span class="op" id="6168591">,</span>&nbsp;<span class="string" id="6168593">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="6168631">,</span>&nbsp;<span class="ident" id="6168633">err</span><span class="op" id="6168636">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168651">time</span><span class="op" id="6168655">.</span><span class="ident" id="6168656">Sleep</span><span class="op" id="6168661">(</span><span class="ident" id="6168662">time</span><span class="op" id="6168666">.</span><span class="ident" id="6168667">Duration</span><span class="op" id="6168675">(</span><span class="ident" id="6168676">sec</span><span class="op" id="6168679">)</span>&nbsp;<span class="op" id="6168681">*</span>&nbsp;<span class="ident" id="6168683">time</span><span class="op" id="6168687">.</span><span class="ident" id="6168688">Second</span><span class="op" id="6168694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168697">pprof</span><span class="op" id="6168702">.</span><span class="ident" id="6168703">StopCPUProfile</span><span class="op" id="6168717">(</span><span class="op" id="6168718">)</span><br>
<span class="lineno"></span><span class="op" id="6168720">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="6168723">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="6168786">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="6168857">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6168924">func</span>&nbsp;<span class="ident" id="6168929">Symbol</span><span class="op" id="6168935">(</span><span class="ident" id="6168936">w</span>&nbsp;<span class="ident" id="6168938">http</span><span class="op" id="6168942">.</span><span class="ident" id="6168943">ResponseWriter</span><span class="op" id="6168957">,</span>&nbsp;<span class="ident" id="6168959">r</span>&nbsp;<span class="op" id="6168961">*</span><span class="ident" id="6168962">http</span><span class="op" id="6168966">.</span><span class="ident" id="6168967">Request</span><span class="op" id="6168974">)</span>&nbsp;<span class="op" id="6168976">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168979">w</span><span class="op" id="6168980">.</span><span class="ident" id="6168981">Header</span><span class="op" id="6168987">(</span><span class="op" id="6168988">)</span><span class="op" id="6168989">.</span><span class="ident" id="6168990">Set</span><span class="op" id="6168993">(</span><span class="string" id="6168994">&#34;Content-Type&#34;</span><span class="op" id="6169008">,</span>&nbsp;<span class="string" id="6169010">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6169037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169041">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169088">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169137">var</span>&nbsp;<span class="ident" id="6169141">buf</span>&nbsp;<span class="ident" id="6169145">bytes</span><span class="op" id="6169150">.</span><span class="ident" id="6169151">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169160">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169211">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169269">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169321">fmt</span><span class="op" id="6169324">.</span><span class="ident" id="6169325">Fprintf</span><span class="op" id="6169332">(</span><span class="op" id="6169333">&amp;</span><span class="ident" id="6169334">buf</span><span class="op" id="6169337">,</span>&nbsp;<span class="string" id="6169339">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="6169357">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169361">var</span>&nbsp;<span class="ident" id="6169365">b</span>&nbsp;<span class="op" id="6169367">*</span><span class="ident" id="6169368">bufio</span><span class="op" id="6169373">.</span><span class="ident" id="6169374">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169382">if</span>&nbsp;<span class="ident" id="6169385">r</span><span class="op" id="6169386">.</span><span class="ident" id="6169387">Method</span>&nbsp;<span class="op" id="6169394">==</span>&nbsp;<span class="string" id="6169397">&#34;POST&#34;</span>&nbsp;<span class="op" id="6169404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169408">b</span>&nbsp;<span class="op" id="6169410">=</span>&nbsp;<span class="ident" id="6169412">bufio</span><span class="op" id="6169417">.</span><span class="ident" id="6169418">NewReader</span><span class="op" id="6169427">(</span><span class="ident" id="6169428">r</span><span class="op" id="6169429">.</span><span class="ident" id="6169430">Body</span><span class="op" id="6169434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169437">}</span>&nbsp;<span class="keyword" id="6169439">else</span>&nbsp;<span class="op" id="6169444">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169448">b</span>&nbsp;<span class="op" id="6169450">=</span>&nbsp;<span class="ident" id="6169452">bufio</span><span class="op" id="6169457">.</span><span class="ident" id="6169458">NewReader</span><span class="op" id="6169467">(</span><span class="ident" id="6169468">strings</span><span class="op" id="6169475">.</span><span class="ident" id="6169476">NewReader</span><span class="op" id="6169485">(</span><span class="ident" id="6169486">r</span><span class="op" id="6169487">.</span><span class="ident" id="6169488">URL</span><span class="op" id="6169491">.</span><span class="ident" id="6169492">RawQuery</span><span class="op" id="6169500">)</span><span class="op" id="6169501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169508">for</span>&nbsp;<span class="op" id="6169512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169516">word</span><span class="op" id="6169520">,</span>&nbsp;<span class="ident" id="6169522">err</span>&nbsp;<span class="op" id="6169526">:=</span>&nbsp;<span class="ident" id="6169529">b</span><span class="op" id="6169530">.</span><span class="ident" id="6169531">ReadSlice</span><span class="op" id="6169540">(</span><span class="string" id="6169541">&#39;+&#39;</span><span class="op" id="6169544">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169548">if</span>&nbsp;<span class="ident" id="6169551">err</span>&nbsp;<span class="op" id="6169555">==</span>&nbsp;<span class="ident" id="6169558">nil</span>&nbsp;<span class="op" id="6169562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169567">word</span>&nbsp;<span class="op" id="6169572">=</span>&nbsp;<span class="ident" id="6169574">word</span><span class="op" id="6169578">[</span><span class="num" id="6169579">0</span>&nbsp;<span class="op" id="6169581">:</span>&nbsp;<span class="builtinfunc" id="6169583">len</span><span class="op" id="6169586">(</span><span class="ident" id="6169587">word</span><span class="op" id="6169591">)</span><span class="op" id="6169592">-</span><span class="num" id="6169593">1</span><span class="op" id="6169594">]</span>&nbsp;<span class="comment" id="6169596">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169612">pc</span><span class="op" id="6169614">,</span>&nbsp;<span class="ident" id="6169616">_</span>&nbsp;<span class="op" id="6169618">:=</span>&nbsp;<span class="ident" id="6169621">strconv</span><span class="op" id="6169628">.</span><span class="ident" id="6169629">ParseUint</span><span class="op" id="6169638">(</span><span class="builtintype" id="6169639">string</span><span class="op" id="6169645">(</span><span class="ident" id="6169646">word</span><span class="op" id="6169650">)</span><span class="op" id="6169651">,</span>&nbsp;<span class="num" id="6169653">0</span><span class="op" id="6169654">,</span>&nbsp;<span class="num" id="6169656">64</span><span class="op" id="6169658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169662">if</span>&nbsp;<span class="ident" id="6169665">pc</span>&nbsp;<span class="op" id="6169668">!=</span>&nbsp;<span class="num" id="6169671">0</span>&nbsp;<span class="op" id="6169673">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169678">f</span>&nbsp;<span class="op" id="6169680">:=</span>&nbsp;<span class="ident" id="6169683">runtime</span><span class="op" id="6169690">.</span><span class="ident" id="6169691">FuncForPC</span><span class="op" id="6169700">(</span><span class="builtintype" id="6169701">uintptr</span><span class="op" id="6169708">(</span><span class="ident" id="6169709">pc</span><span class="op" id="6169711">)</span><span class="op" id="6169712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169717">if</span>&nbsp;<span class="ident" id="6169720">f</span>&nbsp;<span class="op" id="6169722">!=</span>&nbsp;<span class="ident" id="6169725">nil</span>&nbsp;<span class="op" id="6169729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169735">fmt</span><span class="op" id="6169738">.</span><span class="ident" id="6169739">Fprintf</span><span class="op" id="6169746">(</span><span class="op" id="6169747">&amp;</span><span class="ident" id="6169748">buf</span><span class="op" id="6169751">,</span>&nbsp;<span class="string" id="6169753">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="6169763">,</span>&nbsp;<span class="ident" id="6169765">pc</span><span class="op" id="6169767">,</span>&nbsp;<span class="ident" id="6169769">f</span><span class="op" id="6169770">.</span><span class="ident" id="6169771">Name</span><span class="op" id="6169775">(</span><span class="op" id="6169776">)</span><span class="op" id="6169777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169786">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169791">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169839">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169897">if</span>&nbsp;<span class="ident" id="6169900">err</span>&nbsp;<span class="op" id="6169904">!=</span>&nbsp;<span class="ident" id="6169907">nil</span>&nbsp;<span class="op" id="6169911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169916">if</span>&nbsp;<span class="ident" id="6169919">err</span>&nbsp;<span class="op" id="6169923">!=</span>&nbsp;<span class="ident" id="6169926">io</span><span class="op" id="6169928">.</span><span class="ident" id="6169929">EOF</span>&nbsp;<span class="op" id="6169933">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169939">fmt</span><span class="op" id="6169942">.</span><span class="ident" id="6169943">Fprintf</span><span class="op" id="6169950">(</span><span class="op" id="6169951">&amp;</span><span class="ident" id="6169952">buf</span><span class="op" id="6169955">,</span>&nbsp;<span class="string" id="6169957">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="6169980">,</span>&nbsp;<span class="ident" id="6169982">err</span><span class="op" id="6169985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169995">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170006">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170010">w</span><span class="op" id="6170011">.</span><span class="ident" id="6170012">Write</span><span class="op" id="6170017">(</span><span class="ident" id="6170018">buf</span><span class="op" id="6170021">.</span><span class="ident" id="6170022">Bytes</span><span class="op" id="6170027">(</span><span class="op" id="6170028">)</span><span class="op" id="6170029">)</span><br>
<span class="lineno"></span><span class="op" id="6170031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170034">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="6170100">func</span>&nbsp;<span class="ident" id="6170105">Handler</span><span class="op" id="6170112">(</span><span class="ident" id="6170113">name</span>&nbsp;<span class="builtintype" id="6170118">string</span><span class="op" id="6170124">)</span>&nbsp;<span class="ident" id="6170126">http</span><span class="op" id="6170130">.</span><span class="ident" id="6170131">Handler</span>&nbsp;<span class="op" id="6170139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170142">return</span>&nbsp;<span class="ident" id="6170149">handler</span><span class="op" id="6170156">(</span><span class="ident" id="6170157">name</span><span class="op" id="6170161">)</span><br>
<span class="lineno"></span><span class="op" id="6170163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6170166">type</span>&nbsp;<span class="ident" id="6170171">handler</span>&nbsp;<span class="builtintype" id="6170179">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6170187">func</span>&nbsp;<span class="op" id="6170192">(</span><span class="ident" id="6170193">name</span>&nbsp;<span class="ident" id="6170198">handler</span><span class="op" id="6170205">)</span>&nbsp;<span class="ident" id="6170207">ServeHTTP</span><span class="op" id="6170216">(</span><span class="ident" id="6170217">w</span>&nbsp;<span class="ident" id="6170219">http</span><span class="op" id="6170223">.</span><span class="ident" id="6170224">ResponseWriter</span><span class="op" id="6170238">,</span>&nbsp;<span class="ident" id="6170240">r</span>&nbsp;<span class="op" id="6170242">*</span><span class="ident" id="6170243">http</span><span class="op" id="6170247">.</span><span class="ident" id="6170248">Request</span><span class="op" id="6170255">)</span>&nbsp;<span class="op" id="6170257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170260">w</span><span class="op" id="6170261">.</span><span class="ident" id="6170262">Header</span><span class="op" id="6170268">(</span><span class="op" id="6170269">)</span><span class="op" id="6170270">.</span><span class="ident" id="6170271">Set</span><span class="op" id="6170274">(</span><span class="string" id="6170275">&#34;Content-Type&#34;</span><span class="op" id="6170289">,</span>&nbsp;<span class="string" id="6170291">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6170318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170321">debug</span><span class="op" id="6170326">,</span>&nbsp;<span class="ident" id="6170328">_</span>&nbsp;<span class="op" id="6170330">:=</span>&nbsp;<span class="ident" id="6170333">strconv</span><span class="op" id="6170340">.</span><span class="ident" id="6170341">Atoi</span><span class="op" id="6170345">(</span><span class="ident" id="6170346">r</span><span class="op" id="6170347">.</span><span class="ident" id="6170348">FormValue</span><span class="op" id="6170357">(</span><span class="string" id="6170358">&#34;debug&#34;</span><span class="op" id="6170365">)</span><span class="op" id="6170366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170369">p</span>&nbsp;<span class="op" id="6170371">:=</span>&nbsp;<span class="ident" id="6170374">pprof</span><span class="op" id="6170379">.</span><span class="ident" id="6170380">Lookup</span><span class="op" id="6170386">(</span><span class="builtintype" id="6170387">string</span><span class="op" id="6170393">(</span><span class="ident" id="6170394">name</span><span class="op" id="6170398">)</span><span class="op" id="6170399">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170402">if</span>&nbsp;<span class="ident" id="6170405">p</span>&nbsp;<span class="op" id="6170407">==</span>&nbsp;<span class="ident" id="6170410">nil</span>&nbsp;<span class="op" id="6170414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170418">w</span><span class="op" id="6170419">.</span><span class="ident" id="6170420">WriteHeader</span><span class="op" id="6170431">(</span><span class="num" id="6170432">404</span><span class="op" id="6170435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170439">fmt</span><span class="op" id="6170442">.</span><span class="ident" id="6170443">Fprintf</span><span class="op" id="6170450">(</span><span class="ident" id="6170451">w</span><span class="op" id="6170452">,</span>&nbsp;<span class="string" id="6170454">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="6170477">,</span>&nbsp;<span class="ident" id="6170479">name</span><span class="op" id="6170483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170495">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170498">gc</span><span class="op" id="6170500">,</span>&nbsp;<span class="ident" id="6170502">_</span>&nbsp;<span class="op" id="6170504">:=</span>&nbsp;<span class="ident" id="6170507">strconv</span><span class="op" id="6170514">.</span><span class="ident" id="6170515">Atoi</span><span class="op" id="6170519">(</span><span class="ident" id="6170520">r</span><span class="op" id="6170521">.</span><span class="ident" id="6170522">FormValue</span><span class="op" id="6170531">(</span><span class="string" id="6170532">&#34;gc&#34;</span><span class="op" id="6170536">)</span><span class="op" id="6170537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170540">if</span>&nbsp;<span class="ident" id="6170543">name</span>&nbsp;<span class="op" id="6170548">==</span>&nbsp;<span class="string" id="6170551">&#34;heap&#34;</span>&nbsp;<span class="op" id="6170558">&amp;&amp;</span>&nbsp;<span class="ident" id="6170561">gc</span>&nbsp;<span class="op" id="6170564">&gt;</span>&nbsp;<span class="num" id="6170566">0</span>&nbsp;<span class="op" id="6170568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170572">runtime</span><span class="op" id="6170579">.</span><span class="ident" id="6170580">GC</span><span class="op" id="6170582">(</span><span class="op" id="6170583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170589">p</span><span class="op" id="6170590">.</span><span class="ident" id="6170591">WriteTo</span><span class="op" id="6170598">(</span><span class="ident" id="6170599">w</span><span class="op" id="6170600">,</span>&nbsp;<span class="ident" id="6170602">debug</span><span class="op" id="6170607">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170610">return</span><br>
<span class="lineno"></span><span class="op" id="6170617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170620">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="6170693">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="6170756">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="6170825">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="6170860">func</span>&nbsp;<span class="ident" id="6170865">Index</span><span class="op" id="6170870">(</span><span class="ident" id="6170871">w</span>&nbsp;<span class="ident" id="6170873">http</span><span class="op" id="6170877">.</span><span class="ident" id="6170878">ResponseWriter</span><span class="op" id="6170892">,</span>&nbsp;<span class="ident" id="6170894">r</span>&nbsp;<span class="op" id="6170896">*</span><span class="ident" id="6170897">http</span><span class="op" id="6170901">.</span><span class="ident" id="6170902">Request</span><span class="op" id="6170909">)</span>&nbsp;<span class="op" id="6170911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170914">if</span>&nbsp;<span class="ident" id="6170917">strings</span><span class="op" id="6170924">.</span><span class="ident" id="6170925">HasPrefix</span><span class="op" id="6170934">(</span><span class="ident" id="6170935">r</span><span class="op" id="6170936">.</span><span class="ident" id="6170937">URL</span><span class="op" id="6170940">.</span><span class="ident" id="6170941">Path</span><span class="op" id="6170945">,</span>&nbsp;<span class="string" id="6170947">&#34;/debug/pprof/&#34;</span><span class="op" id="6170962">)</span>&nbsp;<span class="op" id="6170964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170968">name</span>&nbsp;<span class="op" id="6170973">:=</span>&nbsp;<span class="ident" id="6170976">strings</span><span class="op" id="6170983">.</span><span class="ident" id="6170984">TrimPrefix</span><span class="op" id="6170994">(</span><span class="ident" id="6170995">r</span><span class="op" id="6170996">.</span><span class="ident" id="6170997">URL</span><span class="op" id="6171000">.</span><span class="ident" id="6171001">Path</span><span class="op" id="6171005">,</span>&nbsp;<span class="string" id="6171007">&#34;/debug/pprof/&#34;</span><span class="op" id="6171022">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171026">if</span>&nbsp;<span class="ident" id="6171029">name</span>&nbsp;<span class="op" id="6171034">!=</span>&nbsp;<span class="string" id="6171037">&#34;&#34;</span>&nbsp;<span class="op" id="6171040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171045">handler</span><span class="op" id="6171052">(</span><span class="ident" id="6171053">name</span><span class="op" id="6171057">)</span><span class="op" id="6171058">.</span><span class="ident" id="6171059">ServeHTTP</span><span class="op" id="6171068">(</span><span class="ident" id="6171069">w</span><span class="op" id="6171070">,</span>&nbsp;<span class="ident" id="6171072">r</span><span class="op" id="6171073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171078">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171090">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171094">profiles</span>&nbsp;<span class="op" id="6171103">:=</span>&nbsp;<span class="ident" id="6171106">pprof</span><span class="op" id="6171111">.</span><span class="ident" id="6171112">Profiles</span><span class="op" id="6171120">(</span><span class="op" id="6171121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171124">if</span>&nbsp;<span class="ident" id="6171127">err</span>&nbsp;<span class="op" id="6171131">:=</span>&nbsp;<span class="ident" id="6171134">indexTmpl</span><span class="op" id="6171143">.</span><span class="ident" id="6171144">Execute</span><span class="op" id="6171151">(</span><span class="ident" id="6171152">w</span><span class="op" id="6171153">,</span>&nbsp;<span class="ident" id="6171155">profiles</span><span class="op" id="6171163">)</span><span class="op" id="6171164">;</span>&nbsp;<span class="ident" id="6171166">err</span>&nbsp;<span class="op" id="6171170">!=</span>&nbsp;<span class="ident" id="6171173">nil</span>&nbsp;<span class="op" id="6171177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171181">log</span><span class="op" id="6171184">.</span><span class="ident" id="6171185">Print</span><span class="op" id="6171190">(</span><span class="ident" id="6171191">err</span><span class="op" id="6171194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171197">}</span><br>
<span class="lineno">190</span><span class="op" id="6171199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6171202">var</span>&nbsp;<span class="ident" id="6171206">indexTmpl</span>&nbsp;<span class="op" id="6171216">=</span>&nbsp;<span class="ident" id="6171218">template</span><span class="op" id="6171226">.</span><span class="ident" id="6171227">Must</span><span class="op" id="6171231">(</span><span class="ident" id="6171232">template</span><span class="op" id="6171240">.</span><span class="ident" id="6171241">New</span><span class="op" id="6171244">(</span><span class="string" id="6171245">&#34;index&#34;</span><span class="op" id="6171252">)</span><span class="op" id="6171253">.</span><span class="ident" id="6171254">Parse</span><span class="op" id="6171259">(</span><span class="string" id="6171260">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="6171579">)</span><span class="op" id="6171580">)</span>
</div>
</body>
</html>
