<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html" class="current">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6621140">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6621195">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6621249">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6621300">package</span>&nbsp;<span class="ident" id="6621308">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6621313">import</span>&nbsp;<span class="op" id="6621320">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621323">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621332">&#34;flag&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621340">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621347">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621353">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621359">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621370">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621381">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621391">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621402">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621413">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621421">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621432">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6621439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6621442">func</span>&nbsp;<span class="ident" id="6621447">newLocalListener</span><span class="op" id="6621463">(</span><span class="ident" id="6621464">t</span>&nbsp;<span class="op" id="6621466">*</span><span class="ident" id="6621467"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6621474">.</span><span class="ident" id="6621475"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6621476">)</span>&nbsp;<span class="ident" id="6621478"><a href="/gostd/net/net.go.html#3340703">Listener</a></span>&nbsp;<span class="op" id="6621487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621490">ln</span><span class="op" id="6621492">,</span>&nbsp;<span class="ident" id="6621494">err</span>&nbsp;<span class="op" id="6621498">:=</span>&nbsp;<span class="ident" id="6621501"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6621507">(</span><span class="string" id="6621508">&#34;tcp&#34;</span><span class="op" id="6621513">,</span>&nbsp;<span class="string" id="6621515">&#34;127.0.0.1:0&#34;</span><span class="op" id="6621528">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621531">if</span>&nbsp;<span class="ident" id="6621534"><a href="/gostd/net/dial_test.go.html#6621494">err</a></span>&nbsp;<span class="op" id="6621538">!=</span>&nbsp;<span class="builtintype" id="6621541">nil</span>&nbsp;<span class="op" id="6621545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621549"><a href="/gostd/net/dial_test.go.html#6621490">ln</a></span><span class="op" id="6621551">,</span>&nbsp;<span class="ident" id="6621553"><a href="/gostd/net/dial_test.go.html#6621494">err</a></span>&nbsp;<span class="op" id="6621557">=</span>&nbsp;<span class="ident" id="6621559"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6621565">(</span><span class="string" id="6621566">&#34;tcp6&#34;</span><span class="op" id="6621572">,</span>&nbsp;<span class="string" id="6621574">&#34;[::1]:0&#34;</span><span class="op" id="6621583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621589">if</span>&nbsp;<span class="ident" id="6621592"><a href="/gostd/net/dial_test.go.html#6621494">err</a></span>&nbsp;<span class="op" id="6621596">!=</span>&nbsp;<span class="builtintype" id="6621599">nil</span>&nbsp;<span class="op" id="6621603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621607"><a href="/gostd/net/dial_test.go.html#6621464">t</a></span><span class="op" id="6621608">.</span><span class="ident" id="6621609"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6621614">(</span><span class="ident" id="6621615"><a href="/gostd/net/dial_test.go.html#6621494">err</a></span><span class="op" id="6621618">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621624">return</span>&nbsp;<span class="ident" id="6621631"><a href="/gostd/net/dial_test.go.html#6621490">ln</a></span><br>
<span class="lineno"></span><span class="op" id="6621634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6621637">func</span>&nbsp;<span class="ident" id="6621642">TestDialTimeout</span><span class="op" id="6621657">(</span><span class="ident" id="6621658">t</span>&nbsp;<span class="op" id="6621660">*</span><span class="ident" id="6621661"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6621668">.</span><span class="ident" id="6621669"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6621670">)</span>&nbsp;<span class="op" id="6621672">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621675">origBacklog</span>&nbsp;<span class="op" id="6621687">:=</span>&nbsp;<span class="ident" id="6621690"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621707">defer</span>&nbsp;<span class="keyword" id="6621713">func</span><span class="op" id="6621717">(</span><span class="op" id="6621718">)</span>&nbsp;<span class="op" id="6621720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621724"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span>&nbsp;<span class="op" id="6621740">=</span>&nbsp;<span class="ident" id="6621742"><a href="/gostd/net/dial_test.go.html#6621675">origBacklog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621755">}</span><span class="op" id="6621756">(</span><span class="op" id="6621757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621760"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span>&nbsp;<span class="op" id="6621776">=</span>&nbsp;<span class="num" id="6621778">1</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621782">ln</span>&nbsp;<span class="op" id="6621785">:=</span>&nbsp;<span class="ident" id="6621788"><a href="/gostd/net/dial_test.go.html#6621447">newLocalListener</a></span><span class="op" id="6621804">(</span><span class="ident" id="6621805"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6621806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621809">defer</span>&nbsp;<span class="ident" id="6621815"><a href="/gostd/net/dial_test.go.html#6621782">ln</a></span><span class="op" id="6621817">.</span><span class="ident" id="6621818"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6621823">(</span><span class="op" id="6621824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621828">errc</span>&nbsp;<span class="op" id="6621833">:=</span>&nbsp;<span class="builtinfunc" id="6621836">make</span><span class="op" id="6621840">(</span><span class="keyword" id="6621841">chan</span>&nbsp;<span class="builtintype" id="6621846">error</span><span class="op" id="6621851">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621855">numConns</span>&nbsp;<span class="op" id="6621864">:=</span>&nbsp;<span class="ident" id="6621867"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span>&nbsp;<span class="op" id="6621883">+</span>&nbsp;<span class="num" id="6621885">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6621891">//&nbsp;TODO(bradfitz):&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;test&nbsp;this&nbsp;in&nbsp;a&nbsp;portable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6621948">//&nbsp;way.&nbsp;This&nbsp;is&nbsp;unfortunate,&nbsp;but&nbsp;works&nbsp;for&nbsp;now.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621997">switch</span>&nbsp;<span class="ident" id="6622004"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6622011">.</span><span class="ident" id="6622012"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6622017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622020">case</span>&nbsp;<span class="string" id="6622025">&#34;linux&#34;</span><span class="op" id="6622032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622036">//&nbsp;The&nbsp;kernel&nbsp;will&nbsp;start&nbsp;accepting&nbsp;TCP&nbsp;connections&nbsp;before&nbsp;userspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622106">//&nbsp;gets&nbsp;a&nbsp;chance&nbsp;to&nbsp;not&nbsp;accept&nbsp;them,&nbsp;so&nbsp;fire&nbsp;off&nbsp;a&nbsp;bunch&nbsp;to&nbsp;fill&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622176">//&nbsp;the&nbsp;kernel&#39;s&nbsp;backlog.&nbsp;&nbsp;Then&nbsp;we&nbsp;test&nbsp;we&nbsp;get&nbsp;a&nbsp;failure&nbsp;after&nbsp;that.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622246">for</span>&nbsp;<span class="ident" id="6622250">i</span>&nbsp;<span class="op" id="6622252">:=</span>&nbsp;<span class="num" id="6622255">0</span><span class="op" id="6622256">;</span>&nbsp;<span class="ident" id="6622258"><a href="/gostd/net/dial_test.go.html#6622250">i</a></span>&nbsp;<span class="op" id="6622260">&lt;</span>&nbsp;<span class="ident" id="6622262"><a href="/gostd/net/dial_test.go.html#6621855">numConns</a></span><span class="op" id="6622270">;</span>&nbsp;<span class="ident" id="6622272"><a href="/gostd/net/dial_test.go.html#6622250">i</a></span><span class="op" id="6622273">++</span>&nbsp;<span class="op" id="6622276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622281">go</span>&nbsp;<span class="keyword" id="6622284">func</span><span class="op" id="6622288">(</span><span class="op" id="6622289">)</span>&nbsp;<span class="op" id="6622291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622297">_</span><span class="op" id="6622298">,</span>&nbsp;<span class="ident" id="6622300">err</span>&nbsp;<span class="op" id="6622304">:=</span>&nbsp;<span class="ident" id="6622307"><a href="/gostd/net/dial.go.html#3203665">DialTimeout</a></span><span class="op" id="6622318">(</span><span class="string" id="6622319">&#34;tcp&#34;</span><span class="op" id="6622324">,</span>&nbsp;<span class="ident" id="6622326"><a href="/gostd/net/dial_test.go.html#6621782">ln</a></span><span class="op" id="6622328">.</span><span class="ident" id="6622329"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6622333">(</span><span class="op" id="6622334">)</span><span class="op" id="6622335">.</span><span class="ident" id="6622336"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6622342">(</span><span class="op" id="6622343">)</span><span class="op" id="6622344">,</span>&nbsp;<span class="num" id="6622346">200</span><span class="op" id="6622349">*</span><span class="ident" id="6622350"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6622354">.</span><span class="ident" id="6622355"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6622366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622372"><a href="/gostd/net/dial_test.go.html#6621828">errc</a></span>&nbsp;<span class="op" id="6622377">&lt;-</span>&nbsp;<span class="ident" id="6622380"><a href="/gostd/net/dial_test.go.html#6622300">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622387">}</span><span class="op" id="6622388">(</span><span class="op" id="6622389">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622396">case</span>&nbsp;<span class="string" id="6622401">&#34;darwin&#34;</span><span class="op" id="6622409">,</span>&nbsp;<span class="string" id="6622411">&#34;plan9&#34;</span><span class="op" id="6622418">,</span>&nbsp;<span class="string" id="6622420">&#34;windows&#34;</span><span class="op" id="6622429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622433">//&nbsp;At&nbsp;least&nbsp;OS&nbsp;X&nbsp;10.7&nbsp;seems&nbsp;to&nbsp;accept&nbsp;any&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622487">//&nbsp;connections,&nbsp;ignoring&nbsp;listen&#39;s&nbsp;backlog,&nbsp;so&nbsp;resort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622542">//&nbsp;to&nbsp;connecting&nbsp;to&nbsp;a&nbsp;hopefully-dead&nbsp;127/8&nbsp;address.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622596">//&nbsp;Same&nbsp;for&nbsp;windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622619">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622624">//&nbsp;Use&nbsp;an&nbsp;IANA&nbsp;reserved&nbsp;port&nbsp;(49151)&nbsp;instead&nbsp;of&nbsp;80,&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622686">//&nbsp;on&nbsp;our&nbsp;386&nbsp;builder,&nbsp;this&nbsp;Dial&nbsp;succeeds,&nbsp;connecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622742">//&nbsp;to&nbsp;an&nbsp;IIS&nbsp;web&nbsp;server&nbsp;somewhere.&nbsp;&nbsp;The&nbsp;data&nbsp;center</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622796">//&nbsp;or&nbsp;VM&nbsp;or&nbsp;firewall&nbsp;must&nbsp;be&nbsp;stealing&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622856">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622861">//&nbsp;IANA&nbsp;Service&nbsp;Name&nbsp;and&nbsp;Transport&nbsp;Protocol&nbsp;Port&nbsp;Number&nbsp;Registry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622928">//&nbsp;&lt;http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xml&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623025">go</span>&nbsp;<span class="keyword" id="6623028">func</span><span class="op" id="6623032">(</span><span class="op" id="6623033">)</span>&nbsp;<span class="op" id="6623035">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623040">c</span><span class="op" id="6623041">,</span>&nbsp;<span class="ident" id="6623043">err</span>&nbsp;<span class="op" id="6623047">:=</span>&nbsp;<span class="ident" id="6623050"><a href="/gostd/net/dial.go.html#3203665">DialTimeout</a></span><span class="op" id="6623061">(</span><span class="string" id="6623062">&#34;tcp&#34;</span><span class="op" id="6623067">,</span>&nbsp;<span class="string" id="6623069">&#34;127.0.71.111:49151&#34;</span><span class="op" id="6623089">,</span>&nbsp;<span class="num" id="6623091">200</span><span class="op" id="6623094">*</span><span class="ident" id="6623095"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6623099">.</span><span class="ident" id="6623100"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6623111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623116">if</span>&nbsp;<span class="ident" id="6623119"><a href="/gostd/net/dial_test.go.html#6623043">err</a></span>&nbsp;<span class="op" id="6623123">==</span>&nbsp;<span class="builtintype" id="6623126">nil</span>&nbsp;<span class="op" id="6623130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623136"><a href="/gostd/net/dial_test.go.html#6623043">err</a></span>&nbsp;<span class="op" id="6623140">=</span>&nbsp;<span class="ident" id="6623142"><a href="/gostd/net/dial_test.go.html#6621340">fmt</a></span><span class="op" id="6623145">.</span><span class="ident" id="6623146"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="6623152">(</span><span class="string" id="6623153">&#34;unexpected:&nbsp;connected&nbsp;to&nbsp;%s!&#34;</span><span class="op" id="6623183">,</span>&nbsp;<span class="ident" id="6623185"><a href="/gostd/net/dial_test.go.html#6623040">c</a></span><span class="op" id="6623186">.</span><span class="ident" id="6623187"><a href="/gostd/net/net.go.html#3335122">RemoteAddr</a></span><span class="op" id="6623197">(</span><span class="op" id="6623198">)</span><span class="op" id="6623199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623205"><a href="/gostd/net/dial_test.go.html#6623040">c</a></span><span class="op" id="6623206">.</span><span class="ident" id="6623207"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6623212">(</span><span class="op" id="6623213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623218">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623223"><a href="/gostd/net/dial_test.go.html#6621828">errc</a></span>&nbsp;<span class="op" id="6623228">&lt;-</span>&nbsp;<span class="ident" id="6623231"><a href="/gostd/net/dial_test.go.html#6623043">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623237">}</span><span class="op" id="6623238">(</span><span class="op" id="6623239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623242">default</span><span class="op" id="6623249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623253">//&nbsp;TODO(bradfitz):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623274">//&nbsp;OpenBSD&nbsp;may&nbsp;have&nbsp;a&nbsp;reject&nbsp;route&nbsp;to&nbsp;127/8&nbsp;except&nbsp;127.0.0.1/32</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623340">//&nbsp;by&nbsp;default.&nbsp;FreeBSD&nbsp;likely&nbsp;works,&nbsp;but&nbsp;is&nbsp;untested.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623396">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623412">//&nbsp;The&nbsp;timeout&nbsp;never&nbsp;happens&nbsp;on&nbsp;Windows.&nbsp;&nbsp;Why?&nbsp;&nbsp;Issue&nbsp;3016.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623474"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6623475">.</span><span class="ident" id="6623476"><a href="/gostd/testing/testing.go.html#5480718">Skipf</a></span><span class="op" id="6623481">(</span><span class="string" id="6623482">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q;&nbsp;untested.&#34;</span><span class="op" id="6623514">,</span>&nbsp;<span class="ident" id="6623516"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6623523">.</span><span class="ident" id="6623524"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span><span class="op" id="6623528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623531">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623535">connected</span>&nbsp;<span class="op" id="6623545">:=</span>&nbsp;<span class="num" id="6623548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623551">for</span>&nbsp;<span class="op" id="6623555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623559">select</span>&nbsp;<span class="op" id="6623566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623570">case</span>&nbsp;<span class="op" id="6623575">&lt;-</span><span class="ident" id="6623577"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6623581">.</span><span class="ident" id="6623582"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="6623587">(</span><span class="num" id="6623588">15</span>&nbsp;<span class="op" id="6623591">*</span>&nbsp;<span class="ident" id="6623593"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6623597">.</span><span class="ident" id="6623598"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="6623604">)</span><span class="op" id="6623605">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623610"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6623611">.</span><span class="ident" id="6623612"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6623617">(</span><span class="string" id="6623618">&#34;too&nbsp;slow&#34;</span><span class="op" id="6623628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623632">case</span>&nbsp;<span class="ident" id="6623637">err</span>&nbsp;<span class="op" id="6623641">:=</span>&nbsp;<span class="op" id="6623644">&lt;-</span><span class="ident" id="6623646"><a href="/gostd/net/dial_test.go.html#6621828">errc</a></span><span class="op" id="6623650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623655">if</span>&nbsp;<span class="ident" id="6623658"><a href="/gostd/net/dial_test.go.html#6623637">err</a></span>&nbsp;<span class="op" id="6623662">==</span>&nbsp;<span class="builtintype" id="6623665">nil</span>&nbsp;<span class="op" id="6623669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623675"><a href="/gostd/net/dial_test.go.html#6623535">connected</a></span><span class="op" id="6623684">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623691">if</span>&nbsp;<span class="ident" id="6623694"><a href="/gostd/net/dial_test.go.html#6623535">connected</a></span>&nbsp;<span class="op" id="6623704">==</span>&nbsp;<span class="ident" id="6623707"><a href="/gostd/net/dial_test.go.html#6621855">numConns</a></span>&nbsp;<span class="op" id="6623716">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623723"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6623724">.</span><span class="ident" id="6623725"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6623730">(</span><span class="string" id="6623731">&#34;all&nbsp;connections&nbsp;connected;&nbsp;expected&nbsp;some&nbsp;to&nbsp;time&nbsp;out&#34;</span><span class="op" id="6623785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623796">}</span>&nbsp;<span class="keyword" id="6623798">else</span>&nbsp;<span class="op" id="6623803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623809">terr</span><span class="op" id="6623813">,</span>&nbsp;<span class="ident" id="6623815">ok</span>&nbsp;<span class="op" id="6623818">:=</span>&nbsp;<span class="ident" id="6623821"><a href="/gostd/net/dial_test.go.html#6623637">err</a></span><span class="op" id="6623824">.</span><span class="op" id="6623825">(</span><span class="ident" id="6623826"><a href="/gostd/net/net.go.html#3342307">timeout</a></span><span class="op" id="6623833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623839">if</span>&nbsp;<span class="op" id="6623842">!</span><span class="ident" id="6623843"><a href="/gostd/net/dial_test.go.html#6623815">ok</a></span>&nbsp;<span class="op" id="6623846">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623853"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6623854">.</span><span class="ident" id="6623855"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6623861">(</span><span class="string" id="6623862">&#34;got&nbsp;error&nbsp;%q;&nbsp;want&nbsp;error&nbsp;with&nbsp;timeout&nbsp;interface&#34;</span><span class="op" id="6623911">,</span>&nbsp;<span class="ident" id="6623913"><a href="/gostd/net/dial_test.go.html#6623637">err</a></span><span class="op" id="6623916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623928">if</span>&nbsp;<span class="op" id="6623931">!</span><span class="ident" id="6623932"><a href="/gostd/net/dial_test.go.html#6623809">terr</a></span><span class="op" id="6623936">.</span><span class="ident" id="6623937"><a href="/gostd/net/net.go.html#3342328">Timeout</a></span><span class="op" id="6623944">(</span><span class="op" id="6623945">)</span>&nbsp;<span class="op" id="6623947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623954"><a href="/gostd/net/dial_test.go.html#6621658">t</a></span><span class="op" id="6623955">.</span><span class="ident" id="6623956"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6623962">(</span><span class="string" id="6623963">&#34;got&nbsp;error&nbsp;%q;&nbsp;not&nbsp;a&nbsp;timeout&#34;</span><span class="op" id="6623992">,</span>&nbsp;<span class="ident" id="6623994"><a href="/gostd/net/dial_test.go.html#6623637">err</a></span><span class="op" id="6623997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624003">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624009">//&nbsp;Pass.&nbsp;We&nbsp;saw&nbsp;a&nbsp;timeout&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624063">}</span><br>
<span class="lineno">115</span><span class="op" id="6624065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6624068">func</span>&nbsp;<span class="ident" id="6624073">TestSelfConnect</span><span class="op" id="6624088">(</span><span class="ident" id="6624089">t</span>&nbsp;<span class="op" id="6624091">*</span><span class="ident" id="6624092"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6624099">.</span><span class="ident" id="6624100"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6624101">)</span>&nbsp;<span class="op" id="6624103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624106">if</span>&nbsp;<span class="ident" id="6624109"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6624116">.</span><span class="ident" id="6624117"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6624122">==</span>&nbsp;<span class="string" id="6624125">&#34;windows&#34;</span>&nbsp;<span class="op" id="6624135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624139">//&nbsp;TODO(brainman):&nbsp;do&nbsp;not&nbsp;know&nbsp;why&nbsp;it&nbsp;hangs.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624186"><a href="/gostd/net/dial_test.go.html#6624089">t</a></span><span class="op" id="6624187">.</span><span class="ident" id="6624188"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6624192">(</span><span class="string" id="6624193">&#34;skipping&nbsp;known-broken&nbsp;test&nbsp;on&nbsp;windows&#34;</span><span class="op" id="6624232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624239">//&nbsp;Test&nbsp;that&nbsp;Dial&nbsp;does&nbsp;not&nbsp;honor&nbsp;self-connects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624288">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;DialTCP.</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624321">//&nbsp;Find&nbsp;a&nbsp;port&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;local&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624376">l</span><span class="op" id="6624377">,</span>&nbsp;<span class="ident" id="6624379">err</span>&nbsp;<span class="op" id="6624383">:=</span>&nbsp;<span class="ident" id="6624386"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6624392">(</span><span class="string" id="6624393">&#34;tcp&#34;</span><span class="op" id="6624398">,</span>&nbsp;<span class="string" id="6624400">&#34;127.0.0.1:0&#34;</span><span class="op" id="6624413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624416">if</span>&nbsp;<span class="ident" id="6624419"><a href="/gostd/net/dial_test.go.html#6624379">err</a></span>&nbsp;<span class="op" id="6624423">!=</span>&nbsp;<span class="builtintype" id="6624426">nil</span>&nbsp;<span class="op" id="6624430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624434"><a href="/gostd/net/dial_test.go.html#6624089">t</a></span><span class="op" id="6624435">.</span><span class="ident" id="6624436"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6624441">(</span><span class="ident" id="6624442"><a href="/gostd/net/dial_test.go.html#6624379">err</a></span><span class="op" id="6624445">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624451">c</span><span class="op" id="6624452">,</span>&nbsp;<span class="ident" id="6624454"><a href="/gostd/net/dial_test.go.html#6624379">err</a></span>&nbsp;<span class="op" id="6624458">:=</span>&nbsp;<span class="ident" id="6624461"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6624465">(</span><span class="string" id="6624466">&#34;tcp&#34;</span><span class="op" id="6624471">,</span>&nbsp;<span class="ident" id="6624473"><a href="/gostd/net/dial_test.go.html#6624376">l</a></span><span class="op" id="6624474">.</span><span class="ident" id="6624475"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6624479">(</span><span class="op" id="6624480">)</span><span class="op" id="6624481">.</span><span class="ident" id="6624482"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6624488">(</span><span class="op" id="6624489">)</span><span class="op" id="6624490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624493">if</span>&nbsp;<span class="ident" id="6624496"><a href="/gostd/net/dial_test.go.html#6624379">err</a></span>&nbsp;<span class="op" id="6624500">!=</span>&nbsp;<span class="builtintype" id="6624503">nil</span>&nbsp;<span class="op" id="6624507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624511"><a href="/gostd/net/dial_test.go.html#6624089">t</a></span><span class="op" id="6624512">.</span><span class="ident" id="6624513"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6624518">(</span><span class="ident" id="6624519"><a href="/gostd/net/dial_test.go.html#6624379">err</a></span><span class="op" id="6624522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624525">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624528">addr</span>&nbsp;<span class="op" id="6624533">:=</span>&nbsp;<span class="ident" id="6624536"><a href="/gostd/net/dial_test.go.html#6624451">c</a></span><span class="op" id="6624537">.</span><span class="ident" id="6624538"><a href="/gostd/net/net.go.html#3335052">LocalAddr</a></span><span class="op" id="6624547">(</span><span class="op" id="6624548">)</span><span class="op" id="6624549">.</span><span class="ident" id="6624550"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6624556">(</span><span class="op" id="6624557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624560"><a href="/gostd/net/dial_test.go.html#6624451">c</a></span><span class="op" id="6624561">.</span><span class="ident" id="6624562"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6624567">(</span><span class="op" id="6624568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624571"><a href="/gostd/net/dial_test.go.html#6624376">l</a></span><span class="op" id="6624572">.</span><span class="ident" id="6624573"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6624578">(</span><span class="op" id="6624579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624583">//&nbsp;Try&nbsp;to&nbsp;connect&nbsp;to&nbsp;that&nbsp;address&nbsp;repeatedly.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624630">n</span>&nbsp;<span class="op" id="6624632">:=</span>&nbsp;<span class="num" id="6624635">100000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624643">if</span>&nbsp;<span class="ident" id="6624646"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6624653">.</span><span class="ident" id="6624654"><a href="/gostd/testing/testing.go.html#5475359">Short</a></span><span class="op" id="6624659">(</span><span class="op" id="6624660">)</span>&nbsp;<span class="op" id="6624662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624666"><a href="/gostd/net/dial_test.go.html#6624630">n</a></span>&nbsp;<span class="op" id="6624668">=</span>&nbsp;<span class="num" id="6624670">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624679">switch</span>&nbsp;<span class="ident" id="6624686"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6624693">.</span><span class="ident" id="6624694"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6624699">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624702">case</span>&nbsp;<span class="string" id="6624707">&#34;darwin&#34;</span><span class="op" id="6624715">,</span>&nbsp;<span class="string" id="6624717">&#34;dragonfly&#34;</span><span class="op" id="6624728">,</span>&nbsp;<span class="string" id="6624730">&#34;freebsd&#34;</span><span class="op" id="6624739">,</span>&nbsp;<span class="string" id="6624741">&#34;netbsd&#34;</span><span class="op" id="6624749">,</span>&nbsp;<span class="string" id="6624751">&#34;openbsd&#34;</span><span class="op" id="6624760">,</span>&nbsp;<span class="string" id="6624762">&#34;plan9&#34;</span><span class="op" id="6624769">,</span>&nbsp;<span class="string" id="6624771">&#34;solaris&#34;</span><span class="op" id="6624780">,</span>&nbsp;<span class="string" id="6624782">&#34;windows&#34;</span><span class="op" id="6624791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624795">//&nbsp;Non-Linux&nbsp;systems&nbsp;take&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;figure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624845">//&nbsp;out&nbsp;that&nbsp;there&nbsp;is&nbsp;nothing&nbsp;listening&nbsp;on&nbsp;localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624900"><a href="/gostd/net/dial_test.go.html#6624630">n</a></span>&nbsp;<span class="op" id="6624902">=</span>&nbsp;<span class="num" id="6624904">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624909">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624912">for</span>&nbsp;<span class="ident" id="6624916">i</span>&nbsp;<span class="op" id="6624918">:=</span>&nbsp;<span class="num" id="6624921">0</span><span class="op" id="6624922">;</span>&nbsp;<span class="ident" id="6624924"><a href="/gostd/net/dial_test.go.html#6624916">i</a></span>&nbsp;<span class="op" id="6624926">&lt;</span>&nbsp;<span class="ident" id="6624928"><a href="/gostd/net/dial_test.go.html#6624630">n</a></span><span class="op" id="6624929">;</span>&nbsp;<span class="ident" id="6624931"><a href="/gostd/net/dial_test.go.html#6624916">i</a></span><span class="op" id="6624932">++</span>&nbsp;<span class="op" id="6624935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624939">c</span><span class="op" id="6624940">,</span>&nbsp;<span class="ident" id="6624942">err</span>&nbsp;<span class="op" id="6624946">:=</span>&nbsp;<span class="ident" id="6624949"><a href="/gostd/net/dial.go.html#3203665">DialTimeout</a></span><span class="op" id="6624960">(</span><span class="string" id="6624961">&#34;tcp&#34;</span><span class="op" id="6624966">,</span>&nbsp;<span class="ident" id="6624968"><a href="/gostd/net/dial_test.go.html#6624528">addr</a></span><span class="op" id="6624972">,</span>&nbsp;<span class="ident" id="6624974"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6624978">.</span><span class="ident" id="6624979"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6624990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624994">if</span>&nbsp;<span class="ident" id="6624997"><a href="/gostd/net/dial_test.go.html#6624942">err</a></span>&nbsp;<span class="op" id="6625001">==</span>&nbsp;<span class="builtintype" id="6625004">nil</span>&nbsp;<span class="op" id="6625008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625013">if</span>&nbsp;<span class="ident" id="6625016"><a href="/gostd/net/dial_test.go.html#6624939">c</a></span><span class="op" id="6625017">.</span><span class="ident" id="6625018"><a href="/gostd/net/net.go.html#3335052">LocalAddr</a></span><span class="op" id="6625027">(</span><span class="op" id="6625028">)</span><span class="op" id="6625029">.</span><span class="ident" id="6625030"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6625036">(</span><span class="op" id="6625037">)</span>&nbsp;<span class="op" id="6625039">==</span>&nbsp;<span class="ident" id="6625042"><a href="/gostd/net/dial_test.go.html#6624528">addr</a></span>&nbsp;<span class="op" id="6625047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625053"><a href="/gostd/net/dial_test.go.html#6624089">t</a></span><span class="op" id="6625054">.</span><span class="ident" id="6625055"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6625061">(</span><span class="string" id="6625062">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;self-connect&#34;</span><span class="op" id="6625089">,</span>&nbsp;<span class="ident" id="6625091"><a href="/gostd/net/dial_test.go.html#6624916">i</a></span><span class="op" id="6625092">,</span>&nbsp;<span class="ident" id="6625094"><a href="/gostd/net/dial_test.go.html#6624528">addr</a></span><span class="op" id="6625098">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625103">}</span>&nbsp;<span class="keyword" id="6625105">else</span>&nbsp;<span class="op" id="6625110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625116"><a href="/gostd/net/dial_test.go.html#6624089">t</a></span><span class="op" id="6625117">.</span><span class="ident" id="6625118"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6625122">(</span><span class="string" id="6625123">&#34;#%d:&nbsp;Dial&nbsp;%q&nbsp;succeeded&nbsp;-&nbsp;possibly&nbsp;racing&nbsp;with&nbsp;other&nbsp;listener&#34;</span><span class="op" id="6625185">,</span>&nbsp;<span class="ident" id="6625187"><a href="/gostd/net/dial_test.go.html#6624916">i</a></span><span class="op" id="6625188">,</span>&nbsp;<span class="ident" id="6625190"><a href="/gostd/net/dial_test.go.html#6624528">addr</a></span><span class="op" id="6625194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625204"><a href="/gostd/net/dial_test.go.html#6624939">c</a></span><span class="op" id="6625205">.</span><span class="ident" id="6625206"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6625211">(</span><span class="op" id="6625212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625216">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625219">}</span><br>
<span class="lineno"></span><span class="op" id="6625221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625224">var</span>&nbsp;<span class="ident" id="6625228">runErrorTest</span>&nbsp;<span class="op" id="6625241">=</span>&nbsp;<span class="ident" id="6625243"><a href="/gostd/net/dial_test.go.html#6621332">flag</a></span><span class="op" id="6625247">.</span><span class="ident" id="6625248"><a href="/gostd/flag/flag.go.html#3948389">Bool</a></span><span class="op" id="6625252">(</span><span class="string" id="6625253">&#34;run_error_test&#34;</span><span class="op" id="6625269">,</span>&nbsp;<span class="builtintype" id="6625271">false</span><span class="op" id="6625276">,</span>&nbsp;<span class="string" id="6625278">&#34;let&nbsp;TestDialError&nbsp;check&nbsp;for&nbsp;dns&nbsp;errors&#34;</span><span class="op" id="6625318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="6625321">type</span>&nbsp;<span class="ident" id="6625326">DialErrorTest</span>&nbsp;<span class="keyword" id="6625340">struct</span>&nbsp;<span class="op" id="6625347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625350">Net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6625358">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625366">Raddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6625374">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625382">Pattern</span>&nbsp;<span class="builtintype" id="6625390">string</span><br>
<span class="lineno"></span><span class="op" id="6625397">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6625400">var</span>&nbsp;<span class="ident" id="6625404">dialErrorTests</span>&nbsp;<span class="op" id="6625419">=</span>&nbsp;<span class="op" id="6625421">[</span><span class="op" id="6625422">]</span><span class="ident" id="6625423"><a href="/gostd/net/dial_test.go.html#6625326">DialErrorTest</a></span><span class="op" id="6625436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625443">&#34;datakit&#34;</span><span class="op" id="6625452">,</span>&nbsp;<span class="string" id="6625454">&#34;mh/astro/r70&#34;</span><span class="op" id="6625468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625472">&#34;dial&nbsp;datakit&nbsp;mh/astro/r70:&nbsp;unknown&nbsp;network&nbsp;datakit&#34;</span><span class="op" id="6625524">,</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625527">}</span><span class="op" id="6625528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625535">&#34;tcp&#34;</span><span class="op" id="6625540">,</span>&nbsp;<span class="string" id="6625542">&#34;127.0.0.1:&#34;</span><span class="op" id="6625557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625561">&#34;dial&nbsp;tcp&nbsp;127.0.0.1::&nbsp;unknown&nbsp;port&nbsp;tcp/&#34;</span><span class="op" id="6625607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625610">}</span><span class="op" id="6625611">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625618">&#34;tcp&#34;</span><span class="op" id="6625623">,</span>&nbsp;<span class="string" id="6625625">&#34;no-such-name.google.com.:80&#34;</span><span class="op" id="6625654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625658">&#34;dial&nbsp;tcp&nbsp;no-such-name.google.com.:80:&nbsp;lookup&nbsp;no-such-name.google.com.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="6625747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625750">}</span><span class="op" id="6625751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625754">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625758">&#34;tcp&#34;</span><span class="op" id="6625763">,</span>&nbsp;<span class="string" id="6625765">&#34;no-such-name.no-such-top-level-domain.:80&#34;</span><span class="op" id="6625808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625812">&#34;dial&nbsp;tcp&nbsp;no-such-name.no-such-top-level-domain.:80:&nbsp;lookup&nbsp;no-such-name.no-such-top-level-domain.(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)&#34;</span><span class="op" id="6625929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625932">}</span><span class="op" id="6625933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625940">&#34;tcp&#34;</span><span class="op" id="6625945">,</span>&nbsp;<span class="string" id="6625947">&#34;no-such-name:80&#34;</span><span class="op" id="6625964">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6625968">`dial&nbsp;tcp&nbsp;no-such-name:80:&nbsp;lookup&nbsp;no-such-name\.(.*\.)?(&nbsp;on&nbsp;.*)?:&nbsp;no&nbsp;(.*)`</span><span class="op" id="6626042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626045">}</span><span class="op" id="6626046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626053">&#34;tcp&#34;</span><span class="op" id="6626058">,</span>&nbsp;<span class="string" id="6626060">&#34;mh/astro/r70:http&#34;</span><span class="op" id="6626079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626083">&#34;dial&nbsp;tcp&nbsp;mh/astro/r70:http:&nbsp;lookup&nbsp;mh/astro/r70:&nbsp;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="6626153">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626156">}</span><span class="op" id="6626157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626164">&#34;unix&#34;</span><span class="op" id="6626170">,</span>&nbsp;<span class="string" id="6626172">&#34;/etc/file-not-found&#34;</span><span class="op" id="6626193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626197">&#34;dial&nbsp;unix&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="6626255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626258">}</span><span class="op" id="6626259">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626266">&#34;unix&#34;</span><span class="op" id="6626272">,</span>&nbsp;<span class="string" id="6626274">&#34;/etc/&#34;</span><span class="op" id="6626281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626285">&#34;dial&nbsp;unix&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="6626373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626376">}</span><span class="op" id="6626377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626380">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626384">&#34;unixpacket&#34;</span><span class="op" id="6626396">,</span>&nbsp;<span class="string" id="6626398">&#34;/etc/file-not-found&#34;</span><span class="op" id="6626419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626423">&#34;dial&nbsp;unixpacket&nbsp;/etc/file-not-found:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&#34;</span><span class="op" id="6626487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626490">}</span><span class="op" id="6626491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626498">&#34;unixpacket&#34;</span><span class="op" id="6626510">,</span>&nbsp;<span class="string" id="6626512">&#34;/etc/&#34;</span><span class="op" id="6626519">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6626523">&#34;dial&nbsp;unixpacket&nbsp;/etc/:&nbsp;(permission&nbsp;denied|socket&nbsp;operation&nbsp;on&nbsp;non-socket|connection&nbsp;refused)&#34;</span><span class="op" id="6626617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626620">}</span><span class="op" id="6626621">,</span><br>
<span class="lineno"></span><span class="op" id="6626623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6626626">var</span>&nbsp;<span class="ident" id="6626630">duplicateErrorPattern</span>&nbsp;<span class="op" id="6626652">=</span>&nbsp;<span class="string" id="6626654">`dial&nbsp;(.*)&nbsp;dial&nbsp;(.*)`</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6626677">func</span>&nbsp;<span class="ident" id="6626682">TestDialError</span><span class="op" id="6626695">(</span><span class="ident" id="6626696">t</span>&nbsp;<span class="op" id="6626698">*</span><span class="ident" id="6626699"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6626706">.</span><span class="ident" id="6626707"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6626708">)</span>&nbsp;<span class="op" id="6626710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626713">if</span>&nbsp;<span class="op" id="6626716">!</span><span class="op" id="6626717">*</span><span class="ident" id="6626718"><a href="/gostd/net/dial_test.go.html#6625228">runErrorTest</a></span>&nbsp;<span class="op" id="6626731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626735"><a href="/gostd/net/dial_test.go.html#6626696">t</a></span><span class="op" id="6626736">.</span><span class="ident" id="6626737"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6626741">(</span><span class="string" id="6626742">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-run_error_test&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6626788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626792">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626803">for</span>&nbsp;<span class="ident" id="6626807">i</span><span class="op" id="6626808">,</span>&nbsp;<span class="ident" id="6626810">tt</span>&nbsp;<span class="op" id="6626813">:=</span>&nbsp;<span class="keyword" id="6626816">range</span>&nbsp;<span class="ident" id="6626822"><a href="/gostd/net/dial_test.go.html#6625404">dialErrorTests</a></span>&nbsp;<span class="op" id="6626837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626841">c</span><span class="op" id="6626842">,</span>&nbsp;<span class="ident" id="6626844">err</span>&nbsp;<span class="op" id="6626848">:=</span>&nbsp;<span class="ident" id="6626851"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6626855">(</span><span class="ident" id="6626856"><a href="/gostd/net/dial_test.go.html#6626810">tt</a></span><span class="op" id="6626858">.</span><span class="ident" id="6626859"><a href="/gostd/net/dial_test.go.html#6625350">Net</a></span><span class="op" id="6626862">,</span>&nbsp;<span class="ident" id="6626864"><a href="/gostd/net/dial_test.go.html#6626810">tt</a></span><span class="op" id="6626866">.</span><span class="ident" id="6626867"><a href="/gostd/net/dial_test.go.html#6625366">Raddr</a></span><span class="op" id="6626872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626876">if</span>&nbsp;<span class="ident" id="6626879"><a href="/gostd/net/dial_test.go.html#6626841">c</a></span>&nbsp;<span class="op" id="6626881">!=</span>&nbsp;<span class="builtintype" id="6626884">nil</span>&nbsp;<span class="op" id="6626888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626893"><a href="/gostd/net/dial_test.go.html#6626841">c</a></span><span class="op" id="6626894">.</span><span class="ident" id="6626895"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6626900">(</span><span class="op" id="6626901">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626909">if</span>&nbsp;<span class="ident" id="6626912"><a href="/gostd/net/dial_test.go.html#6626844">err</a></span>&nbsp;<span class="op" id="6626916">==</span>&nbsp;<span class="builtintype" id="6626919">nil</span>&nbsp;<span class="op" id="6626923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626928"><a href="/gostd/net/dial_test.go.html#6626696">t</a></span><span class="op" id="6626929">.</span><span class="ident" id="6626930"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6626936">(</span><span class="string" id="6626937">&#34;#%d:&nbsp;nil&nbsp;error,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="6626973">,</span>&nbsp;<span class="ident" id="6626975"><a href="/gostd/net/dial_test.go.html#6626807">i</a></span><span class="op" id="6626976">,</span>&nbsp;<span class="ident" id="6626978"><a href="/gostd/net/dial_test.go.html#6626810">tt</a></span><span class="op" id="6626980">.</span><span class="ident" id="6626981"><a href="/gostd/net/dial_test.go.html#6625382">Pattern</a></span><span class="op" id="6626988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626993">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627004">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627008">s</span>&nbsp;<span class="op" id="6627010">:=</span>&nbsp;<span class="ident" id="6627013"><a href="/gostd/net/dial_test.go.html#6626844">err</a></span><span class="op" id="6627016">.</span><span class="ident" id="6627017">Error</span><span class="op" id="6627022">(</span><span class="op" id="6627023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627027">match</span><span class="op" id="6627032">,</span>&nbsp;<span class="ident" id="6627034">_</span>&nbsp;<span class="op" id="6627036">:=</span>&nbsp;<span class="ident" id="6627039"><a href="/gostd/net/dial_test.go.html#6621381">regexp</a></span><span class="op" id="6627045">.</span><span class="ident" id="6627046"><a href="/gostd/regexp/regexp.go.html#3577074">MatchString</a></span><span class="op" id="6627057">(</span><span class="ident" id="6627058"><a href="/gostd/net/dial_test.go.html#6626810">tt</a></span><span class="op" id="6627060">.</span><span class="ident" id="6627061"><a href="/gostd/net/dial_test.go.html#6625382">Pattern</a></span><span class="op" id="6627068">,</span>&nbsp;<span class="ident" id="6627070"><a href="/gostd/net/dial_test.go.html#6627008">s</a></span><span class="op" id="6627071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627075">if</span>&nbsp;<span class="op" id="6627078">!</span><span class="ident" id="6627079"><a href="/gostd/net/dial_test.go.html#6627027">match</a></span>&nbsp;<span class="op" id="6627085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627090"><a href="/gostd/net/dial_test.go.html#6626696">t</a></span><span class="op" id="6627091">.</span><span class="ident" id="6627092"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6627098">(</span><span class="string" id="6627099">&#34;#%d:&nbsp;%q,&nbsp;want&nbsp;match&nbsp;for&nbsp;%#q&#34;</span><span class="op" id="6627128">,</span>&nbsp;<span class="ident" id="6627130"><a href="/gostd/net/dial_test.go.html#6626807">i</a></span><span class="op" id="6627131">,</span>&nbsp;<span class="ident" id="6627133"><a href="/gostd/net/dial_test.go.html#6627008">s</a></span><span class="op" id="6627134">,</span>&nbsp;<span class="ident" id="6627136"><a href="/gostd/net/dial_test.go.html#6626810">tt</a></span><span class="op" id="6627138">.</span><span class="ident" id="6627139"><a href="/gostd/net/dial_test.go.html#6625382">Pattern</a></span><span class="op" id="6627146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627150">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627154"><a href="/gostd/net/dial_test.go.html#6627027">match</a></span><span class="op" id="6627159">,</span>&nbsp;<span class="ident" id="6627161">_</span>&nbsp;<span class="op" id="6627163">=</span>&nbsp;<span class="ident" id="6627165"><a href="/gostd/net/dial_test.go.html#6621381">regexp</a></span><span class="op" id="6627171">.</span><span class="ident" id="6627172"><a href="/gostd/regexp/regexp.go.html#3577074">MatchString</a></span><span class="op" id="6627183">(</span><span class="ident" id="6627184"><a href="/gostd/net/dial_test.go.html#6626630">duplicateErrorPattern</a></span><span class="op" id="6627205">,</span>&nbsp;<span class="ident" id="6627207"><a href="/gostd/net/dial_test.go.html#6627008">s</a></span><span class="op" id="6627208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627212">if</span>&nbsp;<span class="ident" id="6627215"><a href="/gostd/net/dial_test.go.html#6627027">match</a></span>&nbsp;<span class="op" id="6627221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627226"><a href="/gostd/net/dial_test.go.html#6626696">t</a></span><span class="op" id="6627227">.</span><span class="ident" id="6627228"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6627234">(</span><span class="string" id="6627235">&#34;#%d:&nbsp;%q,&nbsp;duplicate&nbsp;error&nbsp;return&nbsp;from&nbsp;Dial&#34;</span><span class="op" id="6627278">,</span>&nbsp;<span class="ident" id="6627280"><a href="/gostd/net/dial_test.go.html#6626807">i</a></span><span class="op" id="6627281">,</span>&nbsp;<span class="ident" id="6627283"><a href="/gostd/net/dial_test.go.html#6627008">s</a></span><span class="op" id="6627284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627291">}</span><br>
<span class="lineno">240</span><span class="op" id="6627293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627296">var</span>&nbsp;<span class="ident" id="6627300">invalidDialAndListenArgTests</span>&nbsp;<span class="op" id="6627329">=</span>&nbsp;<span class="op" id="6627331">[</span><span class="op" id="6627332">]</span><span class="keyword" id="6627333">struct</span>&nbsp;<span class="op" id="6627340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627343">net</span>&nbsp;&nbsp;<span class="builtintype" id="6627348">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627356">addr</span>&nbsp;<span class="builtintype" id="6627361">string</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627369">err</span>&nbsp;&nbsp;<span class="builtintype" id="6627374">error</span><br>
<span class="lineno"></span><span class="op" id="6627380">}</span><span class="op" id="6627381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627384">{</span><span class="string" id="6627385">&#34;foo&#34;</span><span class="op" id="6627390">,</span>&nbsp;<span class="string" id="6627392">&#34;bar&#34;</span><span class="op" id="6627397">,</span>&nbsp;<span class="op" id="6627399">&amp;</span><span class="ident" id="6627400"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="6627407">{</span><span class="ident" id="6627408"><a href="/gostd/net/net.go.html#3341659">Op</a></span><span class="op" id="6627410">:</span>&nbsp;<span class="string" id="6627412">&#34;dial&#34;</span><span class="op" id="6627418">,</span>&nbsp;<span class="ident" id="6627420"><a href="/gostd/net/net.go.html#3341758">Net</a></span><span class="op" id="6627423">:</span>&nbsp;<span class="string" id="6627425">&#34;foo&#34;</span><span class="op" id="6627430">,</span>&nbsp;<span class="ident" id="6627432"><a href="/gostd/net/net.go.html#3341833">Addr</a></span><span class="op" id="6627436">:</span>&nbsp;<span class="builtintype" id="6627438">nil</span><span class="op" id="6627441">,</span>&nbsp;<span class="ident" id="6627443"><a href="/gostd/net/net.go.html#3341902">Err</a></span><span class="op" id="6627446">:</span>&nbsp;<span class="ident" id="6627448"><a href="/gostd/net/net.go.html#3342949">UnknownNetworkError</a></span><span class="op" id="6627467">(</span><span class="string" id="6627468">&#34;foo&#34;</span><span class="op" id="6627473">)</span><span class="op" id="6627474">}</span><span class="op" id="6627475">}</span><span class="op" id="6627476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627479">{</span><span class="string" id="6627480">&#34;baz&#34;</span><span class="op" id="6627485">,</span>&nbsp;<span class="string" id="6627487">&#34;&#34;</span><span class="op" id="6627489">,</span>&nbsp;<span class="op" id="6627491">&amp;</span><span class="ident" id="6627492"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="6627499">{</span><span class="ident" id="6627500"><a href="/gostd/net/net.go.html#3341659">Op</a></span><span class="op" id="6627502">:</span>&nbsp;<span class="string" id="6627504">&#34;listen&#34;</span><span class="op" id="6627512">,</span>&nbsp;<span class="ident" id="6627514"><a href="/gostd/net/net.go.html#3341758">Net</a></span><span class="op" id="6627517">:</span>&nbsp;<span class="string" id="6627519">&#34;baz&#34;</span><span class="op" id="6627524">,</span>&nbsp;<span class="ident" id="6627526"><a href="/gostd/net/net.go.html#3341833">Addr</a></span><span class="op" id="6627530">:</span>&nbsp;<span class="builtintype" id="6627532">nil</span><span class="op" id="6627535">,</span>&nbsp;<span class="ident" id="6627537"><a href="/gostd/net/net.go.html#3341902">Err</a></span><span class="op" id="6627540">:</span>&nbsp;<span class="ident" id="6627542"><a href="/gostd/net/net.go.html#3342949">UnknownNetworkError</a></span><span class="op" id="6627561">(</span><span class="string" id="6627562">&#34;baz&#34;</span><span class="op" id="6627567">)</span><span class="op" id="6627568">}</span><span class="op" id="6627569">}</span><span class="op" id="6627570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627573">{</span><span class="string" id="6627574">&#34;tcp&#34;</span><span class="op" id="6627579">,</span>&nbsp;<span class="string" id="6627581">&#34;&#34;</span><span class="op" id="6627583">,</span>&nbsp;<span class="op" id="6627585">&amp;</span><span class="ident" id="6627586"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="6627593">{</span><span class="ident" id="6627594"><a href="/gostd/net/net.go.html#3341659">Op</a></span><span class="op" id="6627596">:</span>&nbsp;<span class="string" id="6627598">&#34;dial&#34;</span><span class="op" id="6627604">,</span>&nbsp;<span class="ident" id="6627606"><a href="/gostd/net/net.go.html#3341758">Net</a></span><span class="op" id="6627609">:</span>&nbsp;<span class="string" id="6627611">&#34;tcp&#34;</span><span class="op" id="6627616">,</span>&nbsp;<span class="ident" id="6627618"><a href="/gostd/net/net.go.html#3341833">Addr</a></span><span class="op" id="6627622">:</span>&nbsp;<span class="builtintype" id="6627624">nil</span><span class="op" id="6627627">,</span>&nbsp;<span class="ident" id="6627629"><a href="/gostd/net/net.go.html#3341902">Err</a></span><span class="op" id="6627632">:</span>&nbsp;<span class="ident" id="6627634"><a href="/gostd/net/net.go.html#3341102">errMissingAddress</a></span><span class="op" id="6627651">}</span><span class="op" id="6627652">}</span><span class="op" id="6627653">,</span><br>
<span class="lineno">250</span><span class="op" id="6627655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627658">func</span>&nbsp;<span class="ident" id="6627663">TestInvalidDialAndListenArgs</span><span class="op" id="6627691">(</span><span class="ident" id="6627692">t</span>&nbsp;<span class="op" id="6627694">*</span><span class="ident" id="6627695"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6627702">.</span><span class="ident" id="6627703"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6627704">)</span>&nbsp;<span class="op" id="6627706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627709">for</span>&nbsp;<span class="ident" id="6627713">_</span><span class="op" id="6627714">,</span>&nbsp;<span class="ident" id="6627716">tt</span>&nbsp;<span class="op" id="6627719">:=</span>&nbsp;<span class="keyword" id="6627722">range</span>&nbsp;<span class="ident" id="6627728"><a href="/gostd/net/dial_test.go.html#6627300">invalidDialAndListenArgTests</a></span>&nbsp;<span class="op" id="6627757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627761">var</span>&nbsp;<span class="ident" id="6627765">err</span>&nbsp;<span class="builtintype" id="6627769">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627777">switch</span>&nbsp;<span class="ident" id="6627784"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627786">.</span><span class="ident" id="6627787"><a href="/gostd/net/dial_test.go.html#6627369">err</a></span><span class="op" id="6627790">.</span><span class="op" id="6627791">(</span><span class="op" id="6627792">*</span><span class="ident" id="6627793"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="6627800">)</span><span class="op" id="6627801">.</span><span class="ident" id="6627802"><a href="/gostd/net/net.go.html#3341659">Op</a></span>&nbsp;<span class="op" id="6627805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627809">case</span>&nbsp;<span class="string" id="6627814">&#34;dial&#34;</span><span class="op" id="6627820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627825">_</span><span class="op" id="6627826">,</span>&nbsp;<span class="ident" id="6627828"><a href="/gostd/net/dial_test.go.html#6627765">err</a></span>&nbsp;<span class="op" id="6627832">=</span>&nbsp;<span class="ident" id="6627834"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="6627838">(</span><span class="ident" id="6627839"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627841">.</span><span class="ident" id="6627842"><a href="/gostd/net/dial_test.go.html#6627343">net</a></span><span class="op" id="6627845">,</span>&nbsp;<span class="ident" id="6627847"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627849">.</span><span class="ident" id="6627850"><a href="/gostd/net/dial_test.go.html#6627356">addr</a></span><span class="op" id="6627854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627858">case</span>&nbsp;<span class="string" id="6627863">&#34;listen&#34;</span><span class="op" id="6627871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627876">_</span><span class="op" id="6627877">,</span>&nbsp;<span class="ident" id="6627879"><a href="/gostd/net/dial_test.go.html#6627765">err</a></span>&nbsp;<span class="op" id="6627883">=</span>&nbsp;<span class="ident" id="6627885"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6627891">(</span><span class="ident" id="6627892"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627894">.</span><span class="ident" id="6627895"><a href="/gostd/net/dial_test.go.html#6627343">net</a></span><span class="op" id="6627898">,</span>&nbsp;<span class="ident" id="6627900"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627902">.</span><span class="ident" id="6627903"><a href="/gostd/net/dial_test.go.html#6627356">addr</a></span><span class="op" id="6627907">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627915">if</span>&nbsp;<span class="op" id="6627918">!</span><span class="ident" id="6627919"><a href="/gostd/net/dial_test.go.html#6621370">reflect</a></span><span class="op" id="6627926">.</span><span class="ident" id="6627927"><a href="/gostd/reflect/deepequal.go.html#2775472">DeepEqual</a></span><span class="op" id="6627936">(</span><span class="ident" id="6627937"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627939">.</span><span class="ident" id="6627940"><a href="/gostd/net/dial_test.go.html#6627369">err</a></span><span class="op" id="6627943">,</span>&nbsp;<span class="ident" id="6627945"><a href="/gostd/net/dial_test.go.html#6627765">err</a></span><span class="op" id="6627948">)</span>&nbsp;<span class="op" id="6627950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627955"><a href="/gostd/net/dial_test.go.html#6627692">t</a></span><span class="op" id="6627956">.</span><span class="ident" id="6627957"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6627963">(</span><span class="string" id="6627964">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6627987">,</span>&nbsp;<span class="ident" id="6627989"><a href="/gostd/net/dial_test.go.html#6627765">err</a></span><span class="op" id="6627992">,</span>&nbsp;<span class="ident" id="6627994"><a href="/gostd/net/dial_test.go.html#6627716">tt</a></span><span class="op" id="6627996">.</span><span class="ident" id="6627997"><a href="/gostd/net/dial_test.go.html#6627369">err</a></span><span class="op" id="6628000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628007">}</span><br>
<span class="lineno">265</span><span class="op" id="6628009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6628012">func</span>&nbsp;<span class="ident" id="6628017">TestDialTimeoutFDLeak</span><span class="op" id="6628038">(</span><span class="ident" id="6628039">t</span>&nbsp;<span class="op" id="6628041">*</span><span class="ident" id="6628042"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6628049">.</span><span class="ident" id="6628050"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6628051">)</span>&nbsp;<span class="op" id="6628053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628056">if</span>&nbsp;<span class="ident" id="6628059"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6628066">.</span><span class="ident" id="6628067"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6628072">!=</span>&nbsp;<span class="string" id="6628075">&#34;linux&#34;</span>&nbsp;<span class="op" id="6628083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6628087">//&nbsp;TODO(bradfitz):&nbsp;test&nbsp;on&nbsp;other&nbsp;platforms</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628132"><a href="/gostd/net/dial_test.go.html#6628039">t</a></span><span class="op" id="6628133">.</span><span class="ident" id="6628134"><a href="/gostd/testing/testing.go.html#5480718">Skipf</a></span><span class="op" id="6628139">(</span><span class="string" id="6628140">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6628161">,</span>&nbsp;<span class="ident" id="6628163"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6628170">.</span><span class="ident" id="6628171"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span><span class="op" id="6628175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628182">ln</span>&nbsp;<span class="op" id="6628185">:=</span>&nbsp;<span class="ident" id="6628188"><a href="/gostd/net/dial_test.go.html#6621447">newLocalListener</a></span><span class="op" id="6628204">(</span><span class="ident" id="6628205"><a href="/gostd/net/dial_test.go.html#6628039">t</a></span><span class="op" id="6628206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628209">defer</span>&nbsp;<span class="ident" id="6628215"><a href="/gostd/net/dial_test.go.html#6628182">ln</a></span><span class="op" id="6628217">.</span><span class="ident" id="6628218"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6628223">(</span><span class="op" id="6628224">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628228">type</span>&nbsp;<span class="ident" id="6628233">connErr</span>&nbsp;<span class="keyword" id="6628241">struct</span>&nbsp;<span class="op" id="6628248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628252">conn</span>&nbsp;<span class="ident" id="6628257"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628264">err</span>&nbsp;&nbsp;<span class="builtintype" id="6628269">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628276">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628279">dials</span>&nbsp;<span class="op" id="6628285">:=</span>&nbsp;<span class="ident" id="6628288"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span>&nbsp;<span class="op" id="6628304">+</span>&nbsp;<span class="num" id="6628306">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6628311">//&nbsp;used&nbsp;to&nbsp;be&nbsp;listenerBacklog&nbsp;+&nbsp;5,&nbsp;but&nbsp;was&nbsp;found&nbsp;to&nbsp;be&nbsp;unreliable,&nbsp;issue&nbsp;4384.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628391">maxGoodConnect</span>&nbsp;<span class="op" id="6628406">:=</span>&nbsp;<span class="ident" id="6628409"><a href="/gostd/net/net.go.html#3340508">listenerBacklog</a></span>&nbsp;<span class="op" id="6628425">+</span>&nbsp;<span class="ident" id="6628427"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6628434">.</span><span class="ident" id="6628435"><a href="/gostd/runtime/debug.go.html#1521836">NumCPU</a></span><span class="op" id="6628441">(</span><span class="op" id="6628442">)</span><span class="op" id="6628443">*</span><span class="num" id="6628444">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628448">resc</span>&nbsp;<span class="op" id="6628453">:=</span>&nbsp;<span class="builtinfunc" id="6628456">make</span><span class="op" id="6628460">(</span><span class="keyword" id="6628461">chan</span>&nbsp;<span class="ident" id="6628466"><a href="/gostd/net/dial_test.go.html#6628233">connErr</a></span><span class="op" id="6628473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628476">for</span>&nbsp;<span class="ident" id="6628480">i</span>&nbsp;<span class="op" id="6628482">:=</span>&nbsp;<span class="num" id="6628485">0</span><span class="op" id="6628486">;</span>&nbsp;<span class="ident" id="6628488"><a href="/gostd/net/dial_test.go.html#6628480">i</a></span>&nbsp;<span class="op" id="6628490">&lt;</span>&nbsp;<span class="ident" id="6628492"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span><span class="op" id="6628497">;</span>&nbsp;<span class="ident" id="6628499"><a href="/gostd/net/dial_test.go.html#6628480">i</a></span><span class="op" id="6628500">++</span>&nbsp;<span class="op" id="6628503">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628507">go</span>&nbsp;<span class="keyword" id="6628510">func</span><span class="op" id="6628514">(</span><span class="op" id="6628515">)</span>&nbsp;<span class="op" id="6628517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628522">conn</span><span class="op" id="6628526">,</span>&nbsp;<span class="ident" id="6628528">err</span>&nbsp;<span class="op" id="6628532">:=</span>&nbsp;<span class="ident" id="6628535"><a href="/gostd/net/dial.go.html#3203665">DialTimeout</a></span><span class="op" id="6628546">(</span><span class="string" id="6628547">&#34;tcp&#34;</span><span class="op" id="6628552">,</span>&nbsp;<span class="ident" id="6628554"><a href="/gostd/net/dial_test.go.html#6628182">ln</a></span><span class="op" id="6628556">.</span><span class="ident" id="6628557"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6628561">(</span><span class="op" id="6628562">)</span><span class="op" id="6628563">.</span><span class="ident" id="6628564"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6628570">(</span><span class="op" id="6628571">)</span><span class="op" id="6628572">,</span>&nbsp;<span class="num" id="6628574">500</span><span class="op" id="6628577">*</span><span class="ident" id="6628578"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6628582">.</span><span class="ident" id="6628583"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6628594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628599"><a href="/gostd/net/dial_test.go.html#6628448">resc</a></span>&nbsp;<span class="op" id="6628604">&lt;-</span>&nbsp;<span class="ident" id="6628607"><a href="/gostd/net/dial_test.go.html#6628233">connErr</a></span><span class="op" id="6628614">{</span><span class="ident" id="6628615"><a href="/gostd/net/dial_test.go.html#6628522">conn</a></span><span class="op" id="6628619">,</span>&nbsp;<span class="ident" id="6628621"><a href="/gostd/net/dial_test.go.html#6628528">err</a></span><span class="op" id="6628624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628628">}</span><span class="op" id="6628629">(</span><span class="op" id="6628630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628633">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628637">var</span>&nbsp;<span class="ident" id="6628641">firstErr</span>&nbsp;<span class="builtintype" id="6628650">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628658">var</span>&nbsp;<span class="ident" id="6628662">ngood</span>&nbsp;<span class="builtintype" id="6628668">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628673">var</span>&nbsp;<span class="ident" id="6628677">toClose</span>&nbsp;<span class="op" id="6628685">[</span><span class="op" id="6628686">]</span><span class="ident" id="6628687"><a href="/gostd/net/dial_test.go.html#6621347">io</a></span><span class="op" id="6628689">.</span><span class="ident" id="6628690"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628698">for</span>&nbsp;<span class="ident" id="6628702">i</span>&nbsp;<span class="op" id="6628704">:=</span>&nbsp;<span class="num" id="6628707">0</span><span class="op" id="6628708">;</span>&nbsp;<span class="ident" id="6628710"><a href="/gostd/net/dial_test.go.html#6628702">i</a></span>&nbsp;<span class="op" id="6628712">&lt;</span>&nbsp;<span class="ident" id="6628714"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span><span class="op" id="6628719">;</span>&nbsp;<span class="ident" id="6628721"><a href="/gostd/net/dial_test.go.html#6628702">i</a></span><span class="op" id="6628722">++</span>&nbsp;<span class="op" id="6628725">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628729">ce</span>&nbsp;<span class="op" id="6628732">:=</span>&nbsp;<span class="op" id="6628735">&lt;-</span><span class="ident" id="6628737"><a href="/gostd/net/dial_test.go.html#6628448">resc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628744">if</span>&nbsp;<span class="ident" id="6628747"><a href="/gostd/net/dial_test.go.html#6628729">ce</a></span><span class="op" id="6628749">.</span><span class="ident" id="6628750"><a href="/gostd/net/dial_test.go.html#6628264">err</a></span>&nbsp;<span class="op" id="6628754">==</span>&nbsp;<span class="builtintype" id="6628757">nil</span>&nbsp;<span class="op" id="6628761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628766"><a href="/gostd/net/dial_test.go.html#6628662">ngood</a></span><span class="op" id="6628771">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628777">if</span>&nbsp;<span class="ident" id="6628780"><a href="/gostd/net/dial_test.go.html#6628662">ngood</a></span>&nbsp;<span class="op" id="6628786">&gt;</span>&nbsp;<span class="ident" id="6628788"><a href="/gostd/net/dial_test.go.html#6628391">maxGoodConnect</a></span>&nbsp;<span class="op" id="6628803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628809"><a href="/gostd/net/dial_test.go.html#6628039">t</a></span><span class="op" id="6628810">.</span><span class="ident" id="6628811"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6628817">(</span><span class="string" id="6628818">&#34;%d&nbsp;good&nbsp;connects;&nbsp;expected&nbsp;at&nbsp;most&nbsp;%d&#34;</span><span class="op" id="6628857">,</span>&nbsp;<span class="ident" id="6628859"><a href="/gostd/net/dial_test.go.html#6628662">ngood</a></span><span class="op" id="6628864">,</span>&nbsp;<span class="ident" id="6628866"><a href="/gostd/net/dial_test.go.html#6628391">maxGoodConnect</a></span><span class="op" id="6628880">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628890"><a href="/gostd/net/dial_test.go.html#6628677">toClose</a></span>&nbsp;<span class="op" id="6628898">=</span>&nbsp;<span class="builtinfunc" id="6628900">append</span><span class="op" id="6628906">(</span><span class="ident" id="6628907"><a href="/gostd/net/dial_test.go.html#6628677">toClose</a></span><span class="op" id="6628914">,</span>&nbsp;<span class="ident" id="6628916"><a href="/gostd/net/dial_test.go.html#6628729">ce</a></span><span class="op" id="6628918">.</span><span class="ident" id="6628919"><a href="/gostd/net/dial_test.go.html#6628252">conn</a></span><span class="op" id="6628923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628928">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628943">err</span>&nbsp;<span class="op" id="6628947">:=</span>&nbsp;<span class="ident" id="6628950"><a href="/gostd/net/dial_test.go.html#6628729">ce</a></span><span class="op" id="6628952">.</span><span class="ident" id="6628953"><a href="/gostd/net/dial_test.go.html#6628264">err</a></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628959">if</span>&nbsp;<span class="ident" id="6628962"><a href="/gostd/net/dial_test.go.html#6628641">firstErr</a></span>&nbsp;<span class="op" id="6628971">==</span>&nbsp;<span class="string" id="6628974">&#34;&#34;</span>&nbsp;<span class="op" id="6628977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628982"><a href="/gostd/net/dial_test.go.html#6628641">firstErr</a></span>&nbsp;<span class="op" id="6628991">=</span>&nbsp;<span class="ident" id="6628993"><a href="/gostd/net/dial_test.go.html#6628943">err</a></span><span class="op" id="6628996">.</span><span class="ident" id="6628997">Error</span><span class="op" id="6629002">(</span><span class="op" id="6629003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629007">}</span>&nbsp;<span class="keyword" id="6629009">else</span>&nbsp;<span class="keyword" id="6629014">if</span>&nbsp;<span class="ident" id="6629017"><a href="/gostd/net/dial_test.go.html#6628943">err</a></span><span class="op" id="6629020">.</span><span class="ident" id="6629021">Error</span><span class="op" id="6629026">(</span><span class="op" id="6629027">)</span>&nbsp;<span class="op" id="6629029">!=</span>&nbsp;<span class="ident" id="6629032"><a href="/gostd/net/dial_test.go.html#6628641">firstErr</a></span>&nbsp;<span class="op" id="6629041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629046"><a href="/gostd/net/dial_test.go.html#6628039">t</a></span><span class="op" id="6629047">.</span><span class="ident" id="6629048"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6629054">(</span><span class="string" id="6629055">&#34;inconsistent&nbsp;error&nbsp;messages:&nbsp;first&nbsp;was&nbsp;%q,&nbsp;then&nbsp;later&nbsp;%q&#34;</span><span class="op" id="6629113">,</span>&nbsp;<span class="ident" id="6629115"><a href="/gostd/net/dial_test.go.html#6628641">firstErr</a></span><span class="op" id="6629123">,</span>&nbsp;<span class="ident" id="6629125"><a href="/gostd/net/dial_test.go.html#6628943">err</a></span><span class="op" id="6629128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629132">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629138">for</span>&nbsp;<span class="ident" id="6629142">_</span><span class="op" id="6629143">,</span>&nbsp;<span class="ident" id="6629145">c</span>&nbsp;<span class="op" id="6629147">:=</span>&nbsp;<span class="keyword" id="6629150">range</span>&nbsp;<span class="ident" id="6629156"><a href="/gostd/net/dial_test.go.html#6628677">toClose</a></span>&nbsp;<span class="op" id="6629164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629168"><a href="/gostd/net/dial_test.go.html#6629145">c</a></span><span class="op" id="6629169">.</span><span class="ident" id="6629170"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6629175">(</span><span class="op" id="6629176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629182">for</span>&nbsp;<span class="ident" id="6629186">i</span>&nbsp;<span class="op" id="6629188">:=</span>&nbsp;<span class="num" id="6629191">0</span><span class="op" id="6629192">;</span>&nbsp;<span class="ident" id="6629194"><a href="/gostd/net/dial_test.go.html#6629186">i</a></span>&nbsp;<span class="op" id="6629196">&lt;</span>&nbsp;<span class="num" id="6629198">100</span><span class="op" id="6629201">;</span>&nbsp;<span class="ident" id="6629203"><a href="/gostd/net/dial_test.go.html#6629186">i</a></span><span class="op" id="6629204">++</span>&nbsp;<span class="op" id="6629207">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629211">if</span>&nbsp;<span class="ident" id="6629214">got</span>&nbsp;<span class="op" id="6629218">:=</span>&nbsp;<span class="ident" id="6629221"><a href="/gostd/net/dial_test.go.html#6631994">numFD</a></span><span class="op" id="6629226">(</span><span class="op" id="6629227">)</span><span class="op" id="6629228">;</span>&nbsp;<span class="ident" id="6629230"><a href="/gostd/net/dial_test.go.html#6629214">got</a></span>&nbsp;<span class="op" id="6629234">&lt;</span>&nbsp;<span class="ident" id="6629236"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span>&nbsp;<span class="op" id="6629242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6629247">//&nbsp;Test&nbsp;passes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629266">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629279"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6629283">.</span><span class="ident" id="6629284"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="6629289">(</span><span class="num" id="6629290">10</span>&nbsp;<span class="op" id="6629293">*</span>&nbsp;<span class="ident" id="6629295"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6629299">.</span><span class="ident" id="6629300"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="6629311">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629317">if</span>&nbsp;<span class="ident" id="6629320">got</span>&nbsp;<span class="op" id="6629324">:=</span>&nbsp;<span class="ident" id="6629327"><a href="/gostd/net/dial_test.go.html#6631994">numFD</a></span><span class="op" id="6629332">(</span><span class="op" id="6629333">)</span><span class="op" id="6629334">;</span>&nbsp;<span class="ident" id="6629336"><a href="/gostd/net/dial_test.go.html#6629320">got</a></span>&nbsp;<span class="op" id="6629340">&gt;=</span>&nbsp;<span class="ident" id="6629343"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span>&nbsp;<span class="op" id="6629349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629353"><a href="/gostd/net/dial_test.go.html#6628039">t</a></span><span class="op" id="6629354">.</span><span class="ident" id="6629355"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6629361">(</span><span class="string" id="6629362">&#34;num&nbsp;fds&nbsp;after&nbsp;%d&nbsp;timeouts&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;%d&#34;</span><span class="op" id="6629404">,</span>&nbsp;<span class="ident" id="6629406"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span><span class="op" id="6629411">,</span>&nbsp;<span class="ident" id="6629413"><a href="/gostd/net/dial_test.go.html#6629320">got</a></span><span class="op" id="6629416">,</span>&nbsp;<span class="ident" id="6629418"><a href="/gostd/net/dial_test.go.html#6628279">dials</a></span><span class="op" id="6629423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629426">}</span><br>
<span class="lineno"></span><span class="op" id="6629428">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6629431">func</span>&nbsp;<span class="ident" id="6629436">numTCP</span><span class="op" id="6629442">(</span><span class="op" id="6629443">)</span>&nbsp;<span class="op" id="6629445">(</span><span class="ident" id="6629446">ntcp</span><span class="op" id="6629450">,</span>&nbsp;<span class="ident" id="6629452">nopen</span><span class="op" id="6629457">,</span>&nbsp;<span class="ident" id="6629459">nclose</span>&nbsp;<span class="builtintype" id="6629466">int</span><span class="op" id="6629469">,</span>&nbsp;<span class="ident" id="6629471">err</span>&nbsp;<span class="builtintype" id="6629475">error</span><span class="op" id="6629480">)</span>&nbsp;<span class="op" id="6629482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629485">lsof</span><span class="op" id="6629489">,</span>&nbsp;<span class="ident" id="6629491"><a href="/gostd/net/dial_test.go.html#6629471">err</a></span>&nbsp;<span class="op" id="6629495">:=</span>&nbsp;<span class="ident" id="6629498"><a href="/gostd/net/dial_test.go.html#6621359">exec</a></span><span class="op" id="6629502">.</span><span class="ident" id="6629503"><a href="/gostd/os/exec/exec.go.html#5581161">Command</a></span><span class="op" id="6629510">(</span><span class="string" id="6629511">&#34;lsof&#34;</span><span class="op" id="6629517">,</span>&nbsp;<span class="string" id="6629519">&#34;-n&#34;</span><span class="op" id="6629523">,</span>&nbsp;<span class="string" id="6629525">&#34;-p&#34;</span><span class="op" id="6629529">,</span>&nbsp;<span class="ident" id="6629531"><a href="/gostd/net/dial_test.go.html#6621402">strconv</a></span><span class="op" id="6629538">.</span><span class="ident" id="6629539"><a href="/gostd/strconv/itoa.go.html#2407288">Itoa</a></span><span class="op" id="6629543">(</span><span class="ident" id="6629544"><a href="/gostd/net/dial_test.go.html#6621353">os</a></span><span class="op" id="6629546">.</span><span class="ident" id="6629547"><a href="/gostd/os/exec.go.html#2435259">Getpid</a></span><span class="op" id="6629553">(</span><span class="op" id="6629554">)</span><span class="op" id="6629555">)</span><span class="op" id="6629556">)</span><span class="op" id="6629557">.</span><span class="ident" id="6629558"><a href="/gostd/os/exec/exec.go.html#5587246">Output</a></span><span class="op" id="6629564">(</span><span class="op" id="6629565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629568">if</span>&nbsp;<span class="ident" id="6629571"><a href="/gostd/net/dial_test.go.html#6629471">err</a></span>&nbsp;<span class="op" id="6629575">!=</span>&nbsp;<span class="builtintype" id="6629578">nil</span>&nbsp;<span class="op" id="6629582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629586">return</span>&nbsp;<span class="num" id="6629593">0</span><span class="op" id="6629594">,</span>&nbsp;<span class="num" id="6629596">0</span><span class="op" id="6629597">,</span>&nbsp;<span class="num" id="6629599">0</span><span class="op" id="6629600">,</span>&nbsp;<span class="ident" id="6629602"><a href="/gostd/net/dial_test.go.html#6629471">err</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629610"><a href="/gostd/net/dial_test.go.html#6629446">ntcp</a></span>&nbsp;<span class="op" id="6629615">+=</span>&nbsp;<span class="ident" id="6629618"><a href="/gostd/net/dial_test.go.html#6621323">bytes</a></span><span class="op" id="6629623">.</span><span class="ident" id="6629624"><a href="/gostd/bytes/bytes.go.html#1397050">Count</a></span><span class="op" id="6629629">(</span><span class="ident" id="6629630"><a href="/gostd/net/dial_test.go.html#6629485">lsof</a></span><span class="op" id="6629634">,</span>&nbsp;<span class="op" id="6629636">[</span><span class="op" id="6629637">]</span><span class="builtintype" id="6629638">byte</span><span class="op" id="6629642">(</span><span class="string" id="6629643">&#34;TCP&#34;</span><span class="op" id="6629648">)</span><span class="op" id="6629649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629652">for</span>&nbsp;<span class="ident" id="6629656">_</span><span class="op" id="6629657">,</span>&nbsp;<span class="ident" id="6629659">state</span>&nbsp;<span class="op" id="6629665">:=</span>&nbsp;<span class="keyword" id="6629668">range</span>&nbsp;<span class="op" id="6629674">[</span><span class="op" id="6629675">]</span><span class="builtintype" id="6629676">string</span><span class="op" id="6629682">{</span><span class="string" id="6629683">&#34;LISTEN&#34;</span><span class="op" id="6629691">,</span>&nbsp;<span class="string" id="6629693">&#34;SYN_SENT&#34;</span><span class="op" id="6629703">,</span>&nbsp;<span class="string" id="6629705">&#34;SYN_RECEIVED&#34;</span><span class="op" id="6629719">,</span>&nbsp;<span class="string" id="6629721">&#34;ESTABLISHED&#34;</span><span class="op" id="6629734">}</span>&nbsp;<span class="op" id="6629736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629740"><a href="/gostd/net/dial_test.go.html#6629452">nopen</a></span>&nbsp;<span class="op" id="6629746">+=</span>&nbsp;<span class="ident" id="6629749"><a href="/gostd/net/dial_test.go.html#6621323">bytes</a></span><span class="op" id="6629754">.</span><span class="ident" id="6629755"><a href="/gostd/bytes/bytes.go.html#1397050">Count</a></span><span class="op" id="6629760">(</span><span class="ident" id="6629761"><a href="/gostd/net/dial_test.go.html#6629485">lsof</a></span><span class="op" id="6629765">,</span>&nbsp;<span class="op" id="6629767">[</span><span class="op" id="6629768">]</span><span class="builtintype" id="6629769">byte</span><span class="op" id="6629773">(</span><span class="ident" id="6629774"><a href="/gostd/net/dial_test.go.html#6629659">state</a></span><span class="op" id="6629779">)</span><span class="op" id="6629780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629783">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629786">for</span>&nbsp;<span class="ident" id="6629790">_</span><span class="op" id="6629791">,</span>&nbsp;<span class="ident" id="6629793">state</span>&nbsp;<span class="op" id="6629799">:=</span>&nbsp;<span class="keyword" id="6629802">range</span>&nbsp;<span class="op" id="6629808">[</span><span class="op" id="6629809">]</span><span class="builtintype" id="6629810">string</span><span class="op" id="6629816">{</span><span class="string" id="6629817">&#34;CLOSED&#34;</span><span class="op" id="6629825">,</span>&nbsp;<span class="string" id="6629827">&#34;CLOSE_WAIT&#34;</span><span class="op" id="6629839">,</span>&nbsp;<span class="string" id="6629841">&#34;LAST_ACK&#34;</span><span class="op" id="6629851">,</span>&nbsp;<span class="string" id="6629853">&#34;FIN_WAIT_1&#34;</span><span class="op" id="6629865">,</span>&nbsp;<span class="string" id="6629867">&#34;FIN_WAIT_2&#34;</span><span class="op" id="6629879">,</span>&nbsp;<span class="string" id="6629881">&#34;CLOSING&#34;</span><span class="op" id="6629890">,</span>&nbsp;<span class="string" id="6629892">&#34;TIME_WAIT&#34;</span><span class="op" id="6629903">}</span>&nbsp;<span class="op" id="6629905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629909"><a href="/gostd/net/dial_test.go.html#6629459">nclose</a></span>&nbsp;<span class="op" id="6629916">+=</span>&nbsp;<span class="ident" id="6629919"><a href="/gostd/net/dial_test.go.html#6621323">bytes</a></span><span class="op" id="6629924">.</span><span class="ident" id="6629925"><a href="/gostd/bytes/bytes.go.html#1397050">Count</a></span><span class="op" id="6629930">(</span><span class="ident" id="6629931"><a href="/gostd/net/dial_test.go.html#6629485">lsof</a></span><span class="op" id="6629935">,</span>&nbsp;<span class="op" id="6629937">[</span><span class="op" id="6629938">]</span><span class="builtintype" id="6629939">byte</span><span class="op" id="6629943">(</span><span class="ident" id="6629944"><a href="/gostd/net/dial_test.go.html#6629793">state</a></span><span class="op" id="6629949">)</span><span class="op" id="6629950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629956">return</span>&nbsp;<span class="ident" id="6629963"><a href="/gostd/net/dial_test.go.html#6629446">ntcp</a></span><span class="op" id="6629967">,</span>&nbsp;<span class="ident" id="6629969"><a href="/gostd/net/dial_test.go.html#6629452">nopen</a></span><span class="op" id="6629974">,</span>&nbsp;<span class="ident" id="6629976"><a href="/gostd/net/dial_test.go.html#6629459">nclose</a></span><span class="op" id="6629982">,</span>&nbsp;<span class="builtintype" id="6629984">nil</span><br>
<span class="lineno"></span><span class="op" id="6629988">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="6629991">func</span>&nbsp;<span class="ident" id="6629996">TestDialMultiFDLeak</span><span class="op" id="6630015">(</span><span class="ident" id="6630016">t</span>&nbsp;<span class="op" id="6630018">*</span><span class="ident" id="6630019"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6630026">.</span><span class="ident" id="6630027"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6630028">)</span>&nbsp;<span class="op" id="6630030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630033"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6630034">.</span><span class="ident" id="6630035"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6630039">(</span><span class="string" id="6630040">&#34;flaky&nbsp;test&nbsp;-&nbsp;golang.org/issue/8764&#34;</span><span class="op" id="6630076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630080">if</span>&nbsp;<span class="op" id="6630083">!</span><span class="ident" id="6630084"><a href="/gostd/net/ipsock.go.html#3309600">supportsIPv4</a></span>&nbsp;<span class="op" id="6630097">||</span>&nbsp;<span class="op" id="6630100">!</span><span class="ident" id="6630101"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6630114">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630118"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6630119">.</span><span class="ident" id="6630120"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6630124">(</span><span class="string" id="6630125">&#34;neither&nbsp;ipv4&nbsp;nor&nbsp;ipv6&nbsp;is&nbsp;supported&#34;</span><span class="op" id="6630161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630168">halfDeadServer</span>&nbsp;<span class="op" id="6630183">:=</span>&nbsp;<span class="keyword" id="6630186">func</span><span class="op" id="6630190">(</span><span class="ident" id="6630191">dss</span>&nbsp;<span class="op" id="6630195">*</span><span class="ident" id="6630196"><a href="/gostd/net/mockserver_test.go.html#6718157">dualStackServer</a></span><span class="op" id="6630211">,</span>&nbsp;<span class="ident" id="6630213">ln</span>&nbsp;<span class="ident" id="6630216"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="6630224">)</span>&nbsp;<span class="op" id="6630226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630230">for</span>&nbsp;<span class="op" id="6630234">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630239">if</span>&nbsp;<span class="ident" id="6630242">c</span><span class="op" id="6630243">,</span>&nbsp;<span class="ident" id="6630245">err</span>&nbsp;<span class="op" id="6630249">:=</span>&nbsp;<span class="ident" id="6630252"><a href="/gostd/net/dial_test.go.html#6630213">ln</a></span><span class="op" id="6630254">.</span><span class="ident" id="6630255"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6630261">(</span><span class="op" id="6630262">)</span><span class="op" id="6630263">;</span>&nbsp;<span class="ident" id="6630265"><a href="/gostd/net/dial_test.go.html#6630245">err</a></span>&nbsp;<span class="op" id="6630269">!=</span>&nbsp;<span class="builtintype" id="6630272">nil</span>&nbsp;<span class="op" id="6630276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630282">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630292">}</span>&nbsp;<span class="keyword" id="6630294">else</span>&nbsp;<span class="op" id="6630299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6630305">//&nbsp;It&nbsp;just&nbsp;keeps&nbsp;established</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6630338">//&nbsp;connections&nbsp;like&nbsp;a&nbsp;half-dead&nbsp;server</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6630381">//&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630394"><a href="/gostd/net/dial_test.go.html#6630191">dss</a></span><span class="op" id="6630397">.</span><span class="ident" id="6630398"><a href="/gostd/net/mockserver_test.go.html#6718512">putConn</a></span><span class="op" id="6630405">(</span><span class="ident" id="6630406"><a href="/gostd/net/dial_test.go.html#6630242">c</a></span><span class="op" id="6630407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630419">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630422">dss</span><span class="op" id="6630425">,</span>&nbsp;<span class="ident" id="6630427">err</span>&nbsp;<span class="op" id="6630431">:=</span>&nbsp;<span class="ident" id="6630434"><a href="/gostd/net/mockserver_test.go.html#6719128">newDualStackServer</a></span><span class="op" id="6630452">(</span><span class="op" id="6630453">[</span><span class="op" id="6630454">]</span><span class="ident" id="6630455"><a href="/gostd/net/mockserver_test.go.html#6718087">streamListener</a></span><span class="op" id="6630469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630473">{</span><span class="ident" id="6630474"><a href="/gostd/net/mockserver_test.go.html#6718112">net</a></span><span class="op" id="6630477">:</span>&nbsp;<span class="string" id="6630479">&#34;tcp4&#34;</span><span class="op" id="6630485">,</span>&nbsp;<span class="ident" id="6630487"><a href="/gostd/net/mockserver_test.go.html#6718117">addr</a></span><span class="op" id="6630491">:</span>&nbsp;<span class="string" id="6630493">&#34;127.0.0.1&#34;</span><span class="op" id="6630504">}</span><span class="op" id="6630505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630509">{</span><span class="ident" id="6630510"><a href="/gostd/net/mockserver_test.go.html#6718112">net</a></span><span class="op" id="6630513">:</span>&nbsp;<span class="string" id="6630515">&#34;tcp6&#34;</span><span class="op" id="6630521">,</span>&nbsp;<span class="ident" id="6630523"><a href="/gostd/net/mockserver_test.go.html#6718117">addr</a></span><span class="op" id="6630527">:</span>&nbsp;<span class="string" id="6630529">&#34;[::1]&#34;</span><span class="op" id="6630536">}</span><span class="op" id="6630537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630540">}</span><span class="op" id="6630541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630544">if</span>&nbsp;<span class="ident" id="6630547"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span>&nbsp;<span class="op" id="6630551">!=</span>&nbsp;<span class="builtintype" id="6630554">nil</span>&nbsp;<span class="op" id="6630558">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630562"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6630563">.</span><span class="ident" id="6630564"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6630570">(</span><span class="string" id="6630571">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6630602">,</span>&nbsp;<span class="ident" id="6630604"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span><span class="op" id="6630607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630613">defer</span>&nbsp;<span class="ident" id="6630619"><a href="/gostd/net/dial_test.go.html#6630422">dss</a></span><span class="op" id="6630622">.</span><span class="ident" id="6630623"><a href="/gostd/net/mockserver_test.go.html#6718890">teardown</a></span><span class="op" id="6630631">(</span><span class="op" id="6630632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630635">if</span>&nbsp;<span class="ident" id="6630638">err</span>&nbsp;<span class="op" id="6630642">:=</span>&nbsp;<span class="ident" id="6630645"><a href="/gostd/net/dial_test.go.html#6630422">dss</a></span><span class="op" id="6630648">.</span><span class="ident" id="6630649"><a href="/gostd/net/mockserver_test.go.html#6718351">buildup</a></span><span class="op" id="6630656">(</span><span class="ident" id="6630657"><a href="/gostd/net/dial_test.go.html#6630168">halfDeadServer</a></span><span class="op" id="6630671">)</span><span class="op" id="6630672">;</span>&nbsp;<span class="ident" id="6630674"><a href="/gostd/net/dial_test.go.html#6630638">err</a></span>&nbsp;<span class="op" id="6630678">!=</span>&nbsp;<span class="builtintype" id="6630681">nil</span>&nbsp;<span class="op" id="6630685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630689"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6630690">.</span><span class="ident" id="6630691"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6630697">(</span><span class="string" id="6630698">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6630734">,</span>&nbsp;<span class="ident" id="6630736"><a href="/gostd/net/dial_test.go.html#6630638">err</a></span><span class="op" id="6630739">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630746">_</span><span class="op" id="6630747">,</span>&nbsp;<span class="ident" id="6630749">before</span><span class="op" id="6630755">,</span>&nbsp;<span class="ident" id="6630757">_</span><span class="op" id="6630758">,</span>&nbsp;<span class="ident" id="6630760"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span>&nbsp;<span class="op" id="6630764">:=</span>&nbsp;<span class="ident" id="6630767"><a href="/gostd/net/dial_test.go.html#6629436">numTCP</a></span><span class="op" id="6630773">(</span><span class="op" id="6630774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630777">if</span>&nbsp;<span class="ident" id="6630780"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span>&nbsp;<span class="op" id="6630784">!=</span>&nbsp;<span class="builtintype" id="6630787">nil</span>&nbsp;<span class="op" id="6630791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630795"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6630796">.</span><span class="ident" id="6630797"><a href="/gostd/testing/testing.go.html#5480718">Skipf</a></span><span class="op" id="6630802">(</span><span class="string" id="6630803">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="6630853">,</span>&nbsp;<span class="ident" id="6630855"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span><span class="op" id="6630858">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630865">var</span>&nbsp;<span class="ident" id="6630869">wg</span>&nbsp;<span class="ident" id="6630872"><a href="/gostd/net/dial_test.go.html#6621413">sync</a></span><span class="op" id="6630876">.</span><span class="ident" id="6630877"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630888">portnum</span><span class="op" id="6630895">,</span>&nbsp;<span class="ident" id="6630897">_</span><span class="op" id="6630898">,</span>&nbsp;<span class="ident" id="6630900">_</span>&nbsp;<span class="op" id="6630902">:=</span>&nbsp;<span class="ident" id="6630905"><a href="/gostd/net/parse.go.html#3346952">dtoi</a></span><span class="op" id="6630909">(</span><span class="ident" id="6630910"><a href="/gostd/net/dial_test.go.html#6630422">dss</a></span><span class="op" id="6630913">.</span><span class="ident" id="6630914"><a href="/gostd/net/mockserver_test.go.html#6718225">port</a></span><span class="op" id="6630918">,</span>&nbsp;<span class="num" id="6630920">0</span><span class="op" id="6630921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630924">ras</span>&nbsp;<span class="op" id="6630928">:=</span>&nbsp;<span class="ident" id="6630931"><a href="/gostd/net/ipsock.go.html#3310371">addrList</a></span><span class="op" id="6630939">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6630943">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;fail&nbsp;to&nbsp;connect,&nbsp;see&nbsp;RFC&nbsp;6890.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630996">&amp;</span><span class="ident" id="6630997"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631004">{</span><span class="ident" id="6631005"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631007">:</span>&nbsp;<span class="ident" id="6631009"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6631013">(</span><span class="num" id="6631014">198</span><span class="op" id="6631017">,</span>&nbsp;<span class="num" id="6631019">18</span><span class="op" id="6631021">,</span>&nbsp;<span class="num" id="6631023">0</span><span class="op" id="6631024">,</span>&nbsp;<span class="num" id="6631026">254</span><span class="op" id="6631029">)</span><span class="op" id="6631030">,</span>&nbsp;<span class="ident" id="6631032"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631036">:</span>&nbsp;<span class="ident" id="6631038"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631045">}</span><span class="op" id="6631046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631050">&amp;</span><span class="ident" id="6631051"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631058">{</span><span class="ident" id="6631059"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631061">:</span>&nbsp;<span class="ident" id="6631063"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="6631070">(</span><span class="string" id="6631071">&#34;2001:2::254&#34;</span><span class="op" id="6631084">)</span><span class="op" id="6631085">,</span>&nbsp;<span class="ident" id="6631087"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631091">:</span>&nbsp;<span class="ident" id="6631093"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631100">}</span><span class="op" id="6631101">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6631106">//&nbsp;Winner&nbsp;candidates&nbsp;of&nbsp;this&nbsp;race.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631143">&amp;</span><span class="ident" id="6631144"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631151">{</span><span class="ident" id="6631152"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631154">:</span>&nbsp;<span class="ident" id="6631156"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6631160">(</span><span class="num" id="6631161">127</span><span class="op" id="6631164">,</span>&nbsp;<span class="num" id="6631166">0</span><span class="op" id="6631167">,</span>&nbsp;<span class="num" id="6631169">0</span><span class="op" id="6631170">,</span>&nbsp;<span class="num" id="6631172">1</span><span class="op" id="6631173">)</span><span class="op" id="6631174">,</span>&nbsp;<span class="ident" id="6631176"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631180">:</span>&nbsp;<span class="ident" id="6631182"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631189">}</span><span class="op" id="6631190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631194">&amp;</span><span class="ident" id="6631195"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631202">{</span><span class="ident" id="6631203"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631205">:</span>&nbsp;<span class="ident" id="6631207"><a href="/gostd/net/ip.go.html#3287912">IPv6loopback</a></span><span class="op" id="6631219">,</span>&nbsp;<span class="ident" id="6631221"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631225">:</span>&nbsp;<span class="ident" id="6631227"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631234">}</span><span class="op" id="6631235">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6631240">//&nbsp;Losers&nbsp;that&nbsp;will&nbsp;have&nbsp;established&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631292">&amp;</span><span class="ident" id="6631293"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631300">{</span><span class="ident" id="6631301"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631303">:</span>&nbsp;<span class="ident" id="6631305"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="6631309">(</span><span class="num" id="6631310">127</span><span class="op" id="6631313">,</span>&nbsp;<span class="num" id="6631315">0</span><span class="op" id="6631316">,</span>&nbsp;<span class="num" id="6631318">0</span><span class="op" id="6631319">,</span>&nbsp;<span class="num" id="6631321">1</span><span class="op" id="6631322">)</span><span class="op" id="6631323">,</span>&nbsp;<span class="ident" id="6631325"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631329">:</span>&nbsp;<span class="ident" id="6631331"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631338">}</span><span class="op" id="6631339">,</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631343">&amp;</span><span class="ident" id="6631344"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6631351">{</span><span class="ident" id="6631352"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6631354">:</span>&nbsp;<span class="ident" id="6631356"><a href="/gostd/net/ip.go.html#3287912">IPv6loopback</a></span><span class="op" id="6631368">,</span>&nbsp;<span class="ident" id="6631370"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="6631374">:</span>&nbsp;<span class="ident" id="6631376"><a href="/gostd/net/dial_test.go.html#6630888">portnum</a></span><span class="op" id="6631383">}</span><span class="op" id="6631384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631390">const</span>&nbsp;<span class="ident" id="6631396">T1</span>&nbsp;<span class="op" id="6631399">=</span>&nbsp;<span class="num" id="6631401">10</span>&nbsp;<span class="op" id="6631404">*</span>&nbsp;<span class="ident" id="6631406"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6631410">.</span><span class="ident" id="6631411"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631424">const</span>&nbsp;<span class="ident" id="6631430">T2</span>&nbsp;<span class="op" id="6631433">=</span>&nbsp;<span class="num" id="6631435">2</span>&nbsp;<span class="op" id="6631437">*</span>&nbsp;<span class="ident" id="6631439"><a href="/gostd/net/dial_test.go.html#6631396">T1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631443">const</span>&nbsp;<span class="ident" id="6631449">N</span>&nbsp;<span class="op" id="6631451">=</span>&nbsp;<span class="num" id="6631453">10</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631457">for</span>&nbsp;<span class="ident" id="6631461">i</span>&nbsp;<span class="op" id="6631463">:=</span>&nbsp;<span class="num" id="6631466">0</span><span class="op" id="6631467">;</span>&nbsp;<span class="ident" id="6631469"><a href="/gostd/net/dial_test.go.html#6631461">i</a></span>&nbsp;<span class="op" id="6631471">&lt;</span>&nbsp;<span class="ident" id="6631473"><a href="/gostd/net/dial_test.go.html#6631449">N</a></span><span class="op" id="6631474">;</span>&nbsp;<span class="ident" id="6631476"><a href="/gostd/net/dial_test.go.html#6631461">i</a></span><span class="op" id="6631477">++</span>&nbsp;<span class="op" id="6631480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631484"><a href="/gostd/net/dial_test.go.html#6630869">wg</a></span><span class="op" id="6631486">.</span><span class="ident" id="6631487"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="6631490">(</span><span class="num" id="6631491">1</span><span class="op" id="6631492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631496">go</span>&nbsp;<span class="keyword" id="6631499">func</span><span class="op" id="6631503">(</span><span class="op" id="6631504">)</span>&nbsp;<span class="op" id="6631506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631511">defer</span>&nbsp;<span class="ident" id="6631517"><a href="/gostd/net/dial_test.go.html#6630869">wg</a></span><span class="op" id="6631519">.</span><span class="ident" id="6631520"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="6631524">(</span><span class="op" id="6631525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631530">if</span>&nbsp;<span class="ident" id="6631533">c</span><span class="op" id="6631534">,</span>&nbsp;<span class="ident" id="6631536">err</span>&nbsp;<span class="op" id="6631540">:=</span>&nbsp;<span class="ident" id="6631543"><a href="/gostd/net/dial.go.html#3205028">dialMulti</a></span><span class="op" id="6631552">(</span><span class="string" id="6631553">&#34;tcp&#34;</span><span class="op" id="6631558">,</span>&nbsp;<span class="string" id="6631560">&#34;fast&nbsp;failover&nbsp;test&#34;</span><span class="op" id="6631580">,</span>&nbsp;<span class="builtintype" id="6631582">nil</span><span class="op" id="6631585">,</span>&nbsp;<span class="ident" id="6631587"><a href="/gostd/net/dial_test.go.html#6630924">ras</a></span><span class="op" id="6631590">,</span>&nbsp;<span class="ident" id="6631592"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6631596">.</span><span class="ident" id="6631597"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="6631600">(</span><span class="op" id="6631601">)</span><span class="op" id="6631602">.</span><span class="ident" id="6631603"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="6631606">(</span><span class="ident" id="6631607"><a href="/gostd/net/dial_test.go.html#6631396">T1</a></span><span class="op" id="6631609">)</span><span class="op" id="6631610">)</span><span class="op" id="6631611">;</span>&nbsp;<span class="ident" id="6631613"><a href="/gostd/net/dial_test.go.html#6631536">err</a></span>&nbsp;<span class="op" id="6631617">==</span>&nbsp;<span class="builtintype" id="6631620">nil</span>&nbsp;<span class="op" id="6631624">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631630"><a href="/gostd/net/dial_test.go.html#6631533">c</a></span><span class="op" id="6631631">.</span><span class="ident" id="6631632"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6631637">(</span><span class="op" id="6631638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631647">}</span><span class="op" id="6631648">(</span><span class="op" id="6631649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631655"><a href="/gostd/net/dial_test.go.html#6630869">wg</a></span><span class="op" id="6631657">.</span><span class="ident" id="6631658"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="6631662">(</span><span class="op" id="6631663">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631666"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6631670">.</span><span class="ident" id="6631671"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="6631676">(</span><span class="ident" id="6631677"><a href="/gostd/net/dial_test.go.html#6631430">T2</a></span><span class="op" id="6631679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631683">ntcp</span><span class="op" id="6631687">,</span>&nbsp;<span class="ident" id="6631689">after</span><span class="op" id="6631694">,</span>&nbsp;<span class="ident" id="6631696">nclose</span><span class="op" id="6631702">,</span>&nbsp;<span class="ident" id="6631704"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span>&nbsp;<span class="op" id="6631708">:=</span>&nbsp;<span class="ident" id="6631711"><a href="/gostd/net/dial_test.go.html#6629436">numTCP</a></span><span class="op" id="6631717">(</span><span class="op" id="6631718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631721">if</span>&nbsp;<span class="ident" id="6631724"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span>&nbsp;<span class="op" id="6631728">!=</span>&nbsp;<span class="builtintype" id="6631731">nil</span>&nbsp;<span class="op" id="6631735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631739"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6631740">.</span><span class="ident" id="6631741"><a href="/gostd/testing/testing.go.html#5480718">Skipf</a></span><span class="op" id="6631746">(</span><span class="string" id="6631747">&#34;skipping&nbsp;test;&nbsp;error&nbsp;finding&nbsp;or&nbsp;running&nbsp;lsof:&nbsp;%v&#34;</span><span class="op" id="6631797">,</span>&nbsp;<span class="ident" id="6631799"><a href="/gostd/net/dial_test.go.html#6630427">err</a></span><span class="op" id="6631802">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631808"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6631809">.</span><span class="ident" id="6631810"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="6631814">(</span><span class="string" id="6631815">&#34;tcp&nbsp;sessions:&nbsp;%v,&nbsp;open&nbsp;sessions:&nbsp;%v,&nbsp;closing&nbsp;sessions:&nbsp;%v&#34;</span><span class="op" id="6631874">,</span>&nbsp;<span class="ident" id="6631876"><a href="/gostd/net/dial_test.go.html#6631683">ntcp</a></span><span class="op" id="6631880">,</span>&nbsp;<span class="ident" id="6631882"><a href="/gostd/net/dial_test.go.html#6631689">after</a></span><span class="op" id="6631887">,</span>&nbsp;<span class="ident" id="6631889"><a href="/gostd/net/dial_test.go.html#6631696">nclose</a></span><span class="op" id="6631895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631899">if</span>&nbsp;<span class="ident" id="6631902"><a href="/gostd/net/dial_test.go.html#6631689">after</a></span>&nbsp;<span class="op" id="6631908">!=</span>&nbsp;<span class="ident" id="6631911"><a href="/gostd/net/dial_test.go.html#6630749">before</a></span>&nbsp;<span class="op" id="6631918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631922"><a href="/gostd/net/dial_test.go.html#6630016">t</a></span><span class="op" id="6631923">.</span><span class="ident" id="6631924"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6631930">(</span><span class="string" id="6631931">&#34;got&nbsp;%v&nbsp;open&nbsp;sessions;&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6631966">,</span>&nbsp;<span class="ident" id="6631968"><a href="/gostd/net/dial_test.go.html#6631689">after</a></span><span class="op" id="6631973">,</span>&nbsp;<span class="ident" id="6631975"><a href="/gostd/net/dial_test.go.html#6630749">before</a></span><span class="op" id="6631981">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631984">}</span><br>
<span class="lineno"></span><span class="op" id="6631986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6631989">func</span>&nbsp;<span class="ident" id="6631994">numFD</span><span class="op" id="6631999">(</span><span class="op" id="6632000">)</span>&nbsp;<span class="builtintype" id="6632002">int</span>&nbsp;<span class="op" id="6632006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632009">if</span>&nbsp;<span class="ident" id="6632012"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6632019">.</span><span class="ident" id="6632020"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6632025">==</span>&nbsp;<span class="string" id="6632028">&#34;linux&#34;</span>&nbsp;<span class="op" id="6632036">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632040">f</span><span class="op" id="6632041">,</span>&nbsp;<span class="ident" id="6632043">err</span>&nbsp;<span class="op" id="6632047">:=</span>&nbsp;<span class="ident" id="6632050"><a href="/gostd/net/dial_test.go.html#6621353">os</a></span><span class="op" id="6632052">.</span><span class="ident" id="6632053"><a href="/gostd/os/file.go.html#2446863">Open</a></span><span class="op" id="6632057">(</span><span class="string" id="6632058">&#34;/proc/self/fd&#34;</span><span class="op" id="6632073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632077">if</span>&nbsp;<span class="ident" id="6632080"><a href="/gostd/net/dial_test.go.html#6632043">err</a></span>&nbsp;<span class="op" id="6632084">!=</span>&nbsp;<span class="builtintype" id="6632087">nil</span>&nbsp;<span class="op" id="6632091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6632096">panic</span><span class="op" id="6632101">(</span><span class="ident" id="6632102"><a href="/gostd/net/dial_test.go.html#6632043">err</a></span><span class="op" id="6632105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632113">defer</span>&nbsp;<span class="ident" id="6632119"><a href="/gostd/net/dial_test.go.html#6632040">f</a></span><span class="op" id="6632120">.</span><span class="ident" id="6632121"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="6632126">(</span><span class="op" id="6632127">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632131">names</span><span class="op" id="6632136">,</span>&nbsp;<span class="ident" id="6632138"><a href="/gostd/net/dial_test.go.html#6632043">err</a></span>&nbsp;<span class="op" id="6632142">:=</span>&nbsp;<span class="ident" id="6632145"><a href="/gostd/net/dial_test.go.html#6632040">f</a></span><span class="op" id="6632146">.</span><span class="ident" id="6632147"><a href="/gostd/os/doc.go.html#2427225">Readdirnames</a></span><span class="op" id="6632159">(</span><span class="num" id="6632160">0</span><span class="op" id="6632161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632165">if</span>&nbsp;<span class="ident" id="6632168"><a href="/gostd/net/dial_test.go.html#6632043">err</a></span>&nbsp;<span class="op" id="6632172">!=</span>&nbsp;<span class="builtintype" id="6632175">nil</span>&nbsp;<span class="op" id="6632179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6632184">panic</span><span class="op" id="6632189">(</span><span class="ident" id="6632190"><a href="/gostd/net/dial_test.go.html#6632043">err</a></span><span class="op" id="6632193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632201">return</span>&nbsp;<span class="builtinfunc" id="6632208">len</span><span class="op" id="6632211">(</span><span class="ident" id="6632212"><a href="/gostd/net/dial_test.go.html#6632131">names</a></span><span class="op" id="6632217">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6632223">//&nbsp;All&nbsp;tests&nbsp;using&nbsp;this&nbsp;should&nbsp;be&nbsp;skipped&nbsp;anyway,&nbsp;but:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6632279">panic</span><span class="op" id="6632284">(</span><span class="string" id="6632285">&#34;numFDs&nbsp;not&nbsp;implemented&nbsp;on&nbsp;&#34;</span>&nbsp;<span class="op" id="6632314">+</span>&nbsp;<span class="ident" id="6632316"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6632323">.</span><span class="ident" id="6632324"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span><span class="op" id="6632328">)</span><br>
<span class="lineno"></span><span class="op" id="6632330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6632333">func</span>&nbsp;<span class="ident" id="6632338">TestDialer</span><span class="op" id="6632348">(</span><span class="ident" id="6632349">t</span>&nbsp;<span class="op" id="6632351">*</span><span class="ident" id="6632352"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6632359">.</span><span class="ident" id="6632360"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6632361">)</span>&nbsp;<span class="op" id="6632363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632366">ln</span><span class="op" id="6632368">,</span>&nbsp;<span class="ident" id="6632370">err</span>&nbsp;<span class="op" id="6632374">:=</span>&nbsp;<span class="ident" id="6632377"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="6632383">(</span><span class="string" id="6632384">&#34;tcp4&#34;</span><span class="op" id="6632390">,</span>&nbsp;<span class="string" id="6632392">&#34;127.0.0.1:0&#34;</span><span class="op" id="6632405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632408">if</span>&nbsp;<span class="ident" id="6632411"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632415">!=</span>&nbsp;<span class="builtintype" id="6632418">nil</span>&nbsp;<span class="op" id="6632422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632426"><a href="/gostd/net/dial_test.go.html#6632349">t</a></span><span class="op" id="6632427">.</span><span class="ident" id="6632428"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6632434">(</span><span class="string" id="6632435">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6632454">,</span>&nbsp;<span class="ident" id="6632456"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span><span class="op" id="6632459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632462">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632465">defer</span>&nbsp;<span class="ident" id="6632471"><a href="/gostd/net/dial_test.go.html#6632366">ln</a></span><span class="op" id="6632473">.</span><span class="ident" id="6632474"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6632479">(</span><span class="op" id="6632480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632483">ch</span>&nbsp;<span class="op" id="6632486">:=</span>&nbsp;<span class="builtinfunc" id="6632489">make</span><span class="op" id="6632493">(</span><span class="keyword" id="6632494">chan</span>&nbsp;<span class="builtintype" id="6632499">error</span><span class="op" id="6632504">,</span>&nbsp;<span class="num" id="6632506">1</span><span class="op" id="6632507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632510">go</span>&nbsp;<span class="keyword" id="6632513">func</span><span class="op" id="6632517">(</span><span class="op" id="6632518">)</span>&nbsp;<span class="op" id="6632520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632524">c</span><span class="op" id="6632525">,</span>&nbsp;<span class="ident" id="6632527">err</span>&nbsp;<span class="op" id="6632531">:=</span>&nbsp;<span class="ident" id="6632534"><a href="/gostd/net/dial_test.go.html#6632366">ln</a></span><span class="op" id="6632536">.</span><span class="ident" id="6632537"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6632543">(</span><span class="op" id="6632544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632548">if</span>&nbsp;<span class="ident" id="6632551"><a href="/gostd/net/dial_test.go.html#6632527">err</a></span>&nbsp;<span class="op" id="6632555">!=</span>&nbsp;<span class="builtintype" id="6632558">nil</span>&nbsp;<span class="op" id="6632562">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632567"><a href="/gostd/net/dial_test.go.html#6632483">ch</a></span>&nbsp;<span class="op" id="6632570">&lt;-</span>&nbsp;<span class="ident" id="6632573"><a href="/gostd/net/dial_test.go.html#6621340">fmt</a></span><span class="op" id="6632576">.</span><span class="ident" id="6632577"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="6632583">(</span><span class="string" id="6632584">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6632603">,</span>&nbsp;<span class="ident" id="6632605"><a href="/gostd/net/dial_test.go.html#6632527">err</a></span><span class="op" id="6632608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632613">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632626">defer</span>&nbsp;<span class="ident" id="6632632"><a href="/gostd/net/dial_test.go.html#6632524">c</a></span><span class="op" id="6632633">.</span><span class="ident" id="6632634"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6632639">(</span><span class="op" id="6632640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632644"><a href="/gostd/net/dial_test.go.html#6632483">ch</a></span>&nbsp;<span class="op" id="6632647">&lt;-</span>&nbsp;<span class="builtintype" id="6632650">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632655">}</span><span class="op" id="6632656">(</span><span class="op" id="6632657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632661">laddr</span><span class="op" id="6632666">,</span>&nbsp;<span class="ident" id="6632668"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632672">:=</span>&nbsp;<span class="ident" id="6632675"><a href="/gostd/net/tcpsock.go.html#3374317">ResolveTCPAddr</a></span><span class="op" id="6632689">(</span><span class="string" id="6632690">&#34;tcp4&#34;</span><span class="op" id="6632696">,</span>&nbsp;<span class="string" id="6632698">&#34;127.0.0.1:0&#34;</span><span class="op" id="6632711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632714">if</span>&nbsp;<span class="ident" id="6632717"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632721">!=</span>&nbsp;<span class="builtintype" id="6632724">nil</span>&nbsp;<span class="op" id="6632728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632732"><a href="/gostd/net/dial_test.go.html#6632349">t</a></span><span class="op" id="6632733">.</span><span class="ident" id="6632734"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6632740">(</span><span class="string" id="6632741">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6632768">,</span>&nbsp;<span class="ident" id="6632770"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span><span class="op" id="6632773">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632779">d</span>&nbsp;<span class="op" id="6632781">:=</span>&nbsp;<span class="op" id="6632784">&amp;</span><span class="ident" id="6632785"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="6632791">{</span><span class="ident" id="6632792"><a href="/gostd/net/dial.go.html#3200560">LocalAddr</a></span><span class="op" id="6632801">:</span>&nbsp;<span class="ident" id="6632803"><a href="/gostd/net/dial_test.go.html#6632661">laddr</a></span><span class="op" id="6632808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632811">c</span><span class="op" id="6632812">,</span>&nbsp;<span class="ident" id="6632814"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632818">:=</span>&nbsp;<span class="ident" id="6632821"><a href="/gostd/net/dial_test.go.html#6632779">d</a></span><span class="op" id="6632822">.</span><span class="ident" id="6632823"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="6632827">(</span><span class="string" id="6632828">&#34;tcp4&#34;</span><span class="op" id="6632834">,</span>&nbsp;<span class="ident" id="6632836"><a href="/gostd/net/dial_test.go.html#6632366">ln</a></span><span class="op" id="6632838">.</span><span class="ident" id="6632839"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6632843">(</span><span class="op" id="6632844">)</span><span class="op" id="6632845">.</span><span class="ident" id="6632846"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6632852">(</span><span class="op" id="6632853">)</span><span class="op" id="6632854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632857">if</span>&nbsp;<span class="ident" id="6632860"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632864">!=</span>&nbsp;<span class="builtintype" id="6632867">nil</span>&nbsp;<span class="op" id="6632871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632875"><a href="/gostd/net/dial_test.go.html#6632349">t</a></span><span class="op" id="6632876">.</span><span class="ident" id="6632877"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6632883">(</span><span class="string" id="6632884">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6632901">,</span>&nbsp;<span class="ident" id="6632903"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span><span class="op" id="6632906">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632912">defer</span>&nbsp;<span class="ident" id="6632918"><a href="/gostd/net/dial_test.go.html#6632811">c</a></span><span class="op" id="6632919">.</span><span class="ident" id="6632920"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6632925">(</span><span class="op" id="6632926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632929"><a href="/gostd/net/dial_test.go.html#6632811">c</a></span><span class="op" id="6632930">.</span><span class="ident" id="6632931"><a href="/gostd/net/net.go.html#3334618">Read</a></span><span class="op" id="6632935">(</span><span class="builtinfunc" id="6632936">make</span><span class="op" id="6632940">(</span><span class="op" id="6632941">[</span><span class="op" id="6632942">]</span><span class="builtintype" id="6632943">byte</span><span class="op" id="6632947">,</span>&nbsp;<span class="num" id="6632949">1</span><span class="op" id="6632950">)</span><span class="op" id="6632951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632954"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632958">=</span>&nbsp;<span class="op" id="6632960">&lt;-</span><span class="ident" id="6632962"><a href="/gostd/net/dial_test.go.html#6632483">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632966">if</span>&nbsp;<span class="ident" id="6632969"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span>&nbsp;<span class="op" id="6632973">!=</span>&nbsp;<span class="builtintype" id="6632976">nil</span>&nbsp;<span class="op" id="6632980">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632984"><a href="/gostd/net/dial_test.go.html#6632349">t</a></span><span class="op" id="6632985">.</span><span class="ident" id="6632986"><a href="/gostd/testing/testing.go.html#5479963">Error</a></span><span class="op" id="6632991">(</span><span class="ident" id="6632992"><a href="/gostd/net/dial_test.go.html#6632370">err</a></span><span class="op" id="6632995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632998">}</span><br>
<span class="lineno"></span><span class="op" id="6633000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6633003">func</span>&nbsp;<span class="ident" id="6633008">TestDialDualStackLocalhost</span><span class="op" id="6633034">(</span><span class="ident" id="6633035">t</span>&nbsp;<span class="op" id="6633037">*</span><span class="ident" id="6633038"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6633045">.</span><span class="ident" id="6633046"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6633047">)</span>&nbsp;<span class="op" id="6633049">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633052">switch</span>&nbsp;<span class="ident" id="6633059"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6633066">.</span><span class="ident" id="6633067"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="6633072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633075">case</span>&nbsp;<span class="string" id="6633080">&#34;nacl&#34;</span><span class="op" id="6633086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633090"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633091">.</span><span class="ident" id="6633092"><a href="/gostd/testing/testing.go.html#5480718">Skipf</a></span><span class="op" id="6633097">(</span><span class="string" id="6633098">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6633119">,</span>&nbsp;<span class="ident" id="6633121"><a href="/gostd/net/dial_test.go.html#6621391">runtime</a></span><span class="op" id="6633128">.</span><span class="ident" id="6633129"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span><span class="op" id="6633133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633140">if</span>&nbsp;<span class="ident" id="6633143">ips</span><span class="op" id="6633146">,</span>&nbsp;<span class="ident" id="6633148">err</span>&nbsp;<span class="op" id="6633152">:=</span>&nbsp;<span class="ident" id="6633155"><a href="/gostd/net/lookup.go.html#3324041">LookupIP</a></span><span class="op" id="6633163">(</span><span class="string" id="6633164">&#34;localhost&#34;</span><span class="op" id="6633175">)</span><span class="op" id="6633176">;</span>&nbsp;<span class="ident" id="6633178"><a href="/gostd/net/dial_test.go.html#6633148">err</a></span>&nbsp;<span class="op" id="6633182">!=</span>&nbsp;<span class="builtintype" id="6633185">nil</span>&nbsp;<span class="op" id="6633189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633193"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633194">.</span><span class="ident" id="6633195"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6633201">(</span><span class="string" id="6633202">&#34;LookupIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633223">,</span>&nbsp;<span class="ident" id="6633225"><a href="/gostd/net/dial_test.go.html#6633148">err</a></span><span class="op" id="6633228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633231">}</span>&nbsp;<span class="keyword" id="6633233">else</span>&nbsp;<span class="keyword" id="6633238">if</span>&nbsp;<span class="builtinfunc" id="6633241">len</span><span class="op" id="6633244">(</span><span class="ident" id="6633245"><a href="/gostd/net/dial_test.go.html#6633143">ips</a></span><span class="op" id="6633248">)</span>&nbsp;<span class="op" id="6633250">&lt;</span>&nbsp;<span class="num" id="6633252">2</span>&nbsp;<span class="op" id="6633254">||</span>&nbsp;<span class="op" id="6633257">!</span><span class="ident" id="6633258"><a href="/gostd/net/ipsock.go.html#3309600">supportsIPv4</a></span>&nbsp;<span class="op" id="6633271">||</span>&nbsp;<span class="op" id="6633274">!</span><span class="ident" id="6633275"><a href="/gostd/net/ipsock.go.html#3309710">supportsIPv6</a></span>&nbsp;<span class="op" id="6633288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633292"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633293">.</span><span class="ident" id="6633294"><a href="/gostd/testing/testing.go.html#5480575">Skip</a></span><span class="op" id="6633298">(</span><span class="string" id="6633299">&#34;localhost&nbsp;doesn&#39;t&nbsp;have&nbsp;a&nbsp;pair&nbsp;of&nbsp;different&nbsp;address&nbsp;family&nbsp;IP&nbsp;addresses&#34;</span><span class="op" id="6633371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633374">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633378">touchAndByeServer</span>&nbsp;<span class="op" id="6633396">:=</span>&nbsp;<span class="keyword" id="6633399">func</span><span class="op" id="6633403">(</span><span class="ident" id="6633404">dss</span>&nbsp;<span class="op" id="6633408">*</span><span class="ident" id="6633409"><a href="/gostd/net/mockserver_test.go.html#6718157">dualStackServer</a></span><span class="op" id="6633424">,</span>&nbsp;<span class="ident" id="6633426">ln</span>&nbsp;<span class="ident" id="6633429"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="6633437">)</span>&nbsp;<span class="op" id="6633439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633443">for</span>&nbsp;<span class="op" id="6633447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633452">if</span>&nbsp;<span class="ident" id="6633455">c</span><span class="op" id="6633456">,</span>&nbsp;<span class="ident" id="6633458">err</span>&nbsp;<span class="op" id="6633462">:=</span>&nbsp;<span class="ident" id="6633465"><a href="/gostd/net/dial_test.go.html#6633426">ln</a></span><span class="op" id="6633467">.</span><span class="ident" id="6633468"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6633474">(</span><span class="op" id="6633475">)</span><span class="op" id="6633476">;</span>&nbsp;<span class="ident" id="6633478"><a href="/gostd/net/dial_test.go.html#6633458">err</a></span>&nbsp;<span class="op" id="6633482">!=</span>&nbsp;<span class="builtintype" id="6633485">nil</span>&nbsp;<span class="op" id="6633489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633495">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633505">}</span>&nbsp;<span class="keyword" id="6633507">else</span>&nbsp;<span class="op" id="6633512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633518"><a href="/gostd/net/dial_test.go.html#6633455">c</a></span><span class="op" id="6633519">.</span><span class="ident" id="6633520"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6633525">(</span><span class="op" id="6633526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633538">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633541">dss</span><span class="op" id="6633544">,</span>&nbsp;<span class="ident" id="6633546">err</span>&nbsp;<span class="op" id="6633550">:=</span>&nbsp;<span class="ident" id="6633553"><a href="/gostd/net/mockserver_test.go.html#6719128">newDualStackServer</a></span><span class="op" id="6633571">(</span><span class="op" id="6633572">[</span><span class="op" id="6633573">]</span><span class="ident" id="6633574"><a href="/gostd/net/mockserver_test.go.html#6718087">streamListener</a></span><span class="op" id="6633588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633592">{</span><span class="ident" id="6633593"><a href="/gostd/net/mockserver_test.go.html#6718112">net</a></span><span class="op" id="6633596">:</span>&nbsp;<span class="string" id="6633598">&#34;tcp4&#34;</span><span class="op" id="6633604">,</span>&nbsp;<span class="ident" id="6633606"><a href="/gostd/net/mockserver_test.go.html#6718117">addr</a></span><span class="op" id="6633610">:</span>&nbsp;<span class="string" id="6633612">&#34;127.0.0.1&#34;</span><span class="op" id="6633623">}</span><span class="op" id="6633624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633628">{</span><span class="ident" id="6633629"><a href="/gostd/net/mockserver_test.go.html#6718112">net</a></span><span class="op" id="6633632">:</span>&nbsp;<span class="string" id="6633634">&#34;tcp6&#34;</span><span class="op" id="6633640">,</span>&nbsp;<span class="ident" id="6633642"><a href="/gostd/net/mockserver_test.go.html#6718117">addr</a></span><span class="op" id="6633646">:</span>&nbsp;<span class="string" id="6633648">&#34;[::1]&#34;</span><span class="op" id="6633655">}</span><span class="op" id="6633656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633659">}</span><span class="op" id="6633660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633663">if</span>&nbsp;<span class="ident" id="6633666"><a href="/gostd/net/dial_test.go.html#6633546">err</a></span>&nbsp;<span class="op" id="6633670">!=</span>&nbsp;<span class="builtintype" id="6633673">nil</span>&nbsp;<span class="op" id="6633677">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633681"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633682">.</span><span class="ident" id="6633683"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6633689">(</span><span class="string" id="6633690">&#34;newDualStackServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633721">,</span>&nbsp;<span class="ident" id="6633723"><a href="/gostd/net/dial_test.go.html#6633546">err</a></span><span class="op" id="6633726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633732">defer</span>&nbsp;<span class="ident" id="6633738"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6633741">.</span><span class="ident" id="6633742"><a href="/gostd/net/mockserver_test.go.html#6718890">teardown</a></span><span class="op" id="6633750">(</span><span class="op" id="6633751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633754">if</span>&nbsp;<span class="ident" id="6633757">err</span>&nbsp;<span class="op" id="6633761">:=</span>&nbsp;<span class="ident" id="6633764"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6633767">.</span><span class="ident" id="6633768"><a href="/gostd/net/mockserver_test.go.html#6718351">buildup</a></span><span class="op" id="6633775">(</span><span class="ident" id="6633776"><a href="/gostd/net/dial_test.go.html#6633378">touchAndByeServer</a></span><span class="op" id="6633793">)</span><span class="op" id="6633794">;</span>&nbsp;<span class="ident" id="6633796"><a href="/gostd/net/dial_test.go.html#6633757">err</a></span>&nbsp;<span class="op" id="6633800">!=</span>&nbsp;<span class="builtintype" id="6633803">nil</span>&nbsp;<span class="op" id="6633807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633811"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633812">.</span><span class="ident" id="6633813"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="6633819">(</span><span class="string" id="6633820">&#34;dualStackServer.buildup&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6633856">,</span>&nbsp;<span class="ident" id="6633858"><a href="/gostd/net/dial_test.go.html#6633757">err</a></span><span class="op" id="6633861">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6633864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633868">d</span>&nbsp;<span class="op" id="6633870">:=</span>&nbsp;<span class="op" id="6633873">&amp;</span><span class="ident" id="6633874"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="6633880">{</span><span class="ident" id="6633881"><a href="/gostd/net/dial.go.html#3200841">DualStack</a></span><span class="op" id="6633890">:</span>&nbsp;<span class="builtintype" id="6633892">true</span><span class="op" id="6633896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633899">for</span>&nbsp;<span class="keyword" id="6633903">range</span>&nbsp;<span class="ident" id="6633909"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6633912">.</span><span class="ident" id="6633913"><a href="/gostd/net/mockserver_test.go.html#6718202">lns</a></span>&nbsp;<span class="op" id="6633917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6633921">if</span>&nbsp;<span class="ident" id="6633924">c</span><span class="op" id="6633925">,</span>&nbsp;<span class="ident" id="6633927">err</span>&nbsp;<span class="op" id="6633931">:=</span>&nbsp;<span class="ident" id="6633934"><a href="/gostd/net/dial_test.go.html#6633868">d</a></span><span class="op" id="6633935">.</span><span class="ident" id="6633936"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="6633940">(</span><span class="string" id="6633941">&#34;tcp&#34;</span><span class="op" id="6633946">,</span>&nbsp;<span class="string" id="6633948">&#34;localhost:&#34;</span><span class="op" id="6633960">+</span><span class="ident" id="6633961"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6633964">.</span><span class="ident" id="6633965"><a href="/gostd/net/mockserver_test.go.html#6718225">port</a></span><span class="op" id="6633969">)</span><span class="op" id="6633970">;</span>&nbsp;<span class="ident" id="6633972"><a href="/gostd/net/dial_test.go.html#6633927">err</a></span>&nbsp;<span class="op" id="6633976">!=</span>&nbsp;<span class="builtintype" id="6633979">nil</span>&nbsp;<span class="op" id="6633983">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6633988"><a href="/gostd/net/dial_test.go.html#6633035">t</a></span><span class="op" id="6633989">.</span><span class="ident" id="6633990"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6633996">(</span><span class="string" id="6633997">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6634014">,</span>&nbsp;<span class="ident" id="6634016"><a href="/gostd/net/dial_test.go.html#6633927">err</a></span><span class="op" id="6634019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634023">}</span>&nbsp;<span class="keyword" id="6634025">else</span>&nbsp;<span class="op" id="6634030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634035">if</span>&nbsp;<span class="ident" id="6634038">addr</span>&nbsp;<span class="op" id="6634043">:=</span>&nbsp;<span class="ident" id="6634046"><a href="/gostd/net/dial_test.go.html#6633924">c</a></span><span class="op" id="6634047">.</span><span class="ident" id="6634048"><a href="/gostd/net/net.go.html#3335052">LocalAddr</a></span><span class="op" id="6634057">(</span><span class="op" id="6634058">)</span><span class="op" id="6634059">.</span><span class="op" id="6634060">(</span><span class="op" id="6634061">*</span><span class="ident" id="6634062"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="6634069">)</span><span class="op" id="6634070">;</span>&nbsp;<span class="ident" id="6634072"><a href="/gostd/net/dial_test.go.html#6634038">addr</a></span><span class="op" id="6634076">.</span><span class="ident" id="6634077"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6634079">.</span><span class="ident" id="6634080"><a href="/gostd/net/ip.go.html#3290039">To4</a></span><span class="op" id="6634083">(</span><span class="op" id="6634084">)</span>&nbsp;<span class="op" id="6634086">!=</span>&nbsp;<span class="builtintype" id="6634089">nil</span>&nbsp;<span class="op" id="6634093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634099"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6634102">.</span><span class="ident" id="6634103"><a href="/gostd/net/mockserver_test.go.html#6718641">teardownNetwork</a></span><span class="op" id="6634118">(</span><span class="string" id="6634119">&#34;tcp4&#34;</span><span class="op" id="6634125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634130">}</span>&nbsp;<span class="keyword" id="6634132">else</span>&nbsp;<span class="keyword" id="6634137">if</span>&nbsp;<span class="ident" id="6634140"><a href="/gostd/net/dial_test.go.html#6634038">addr</a></span><span class="op" id="6634144">.</span><span class="ident" id="6634145"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6634147">.</span><span class="ident" id="6634148"><a href="/gostd/net/ip.go.html#3290366">To16</a></span><span class="op" id="6634152">(</span><span class="op" id="6634153">)</span>&nbsp;<span class="op" id="6634155">!=</span>&nbsp;<span class="builtintype" id="6634158">nil</span>&nbsp;<span class="op" id="6634162">&amp;&amp;</span>&nbsp;<span class="ident" id="6634165"><a href="/gostd/net/dial_test.go.html#6634038">addr</a></span><span class="op" id="6634169">.</span><span class="ident" id="6634170"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="6634172">.</span><span class="ident" id="6634173"><a href="/gostd/net/ip.go.html#3290039">To4</a></span><span class="op" id="6634176">(</span><span class="op" id="6634177">)</span>&nbsp;<span class="op" id="6634179">==</span>&nbsp;<span class="builtintype" id="6634182">nil</span>&nbsp;<span class="op" id="6634186">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634192"><a href="/gostd/net/dial_test.go.html#6633541">dss</a></span><span class="op" id="6634195">.</span><span class="ident" id="6634196"><a href="/gostd/net/mockserver_test.go.html#6718641">teardownNetwork</a></span><span class="op" id="6634211">(</span><span class="string" id="6634212">&#34;tcp6&#34;</span><span class="op" id="6634218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634228"><a href="/gostd/net/dial_test.go.html#6633924">c</a></span><span class="op" id="6634229">.</span><span class="ident" id="6634230"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6634235">(</span><span class="op" id="6634236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634243">}</span><br>
<span class="lineno">515</span><span class="op" id="6634245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6634248">func</span>&nbsp;<span class="ident" id="6634253">TestDialerKeepAlive</span><span class="op" id="6634272">(</span><span class="ident" id="6634273">t</span>&nbsp;<span class="op" id="6634275">*</span><span class="ident" id="6634276"><a href="/gostd/net/dial_test.go.html#6621421">testing</a></span><span class="op" id="6634283">.</span><span class="ident" id="6634284"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="6634285">)</span>&nbsp;<span class="op" id="6634287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634290">ln</span>&nbsp;<span class="op" id="6634293">:=</span>&nbsp;<span class="ident" id="6634296"><a href="/gostd/net/dial_test.go.html#6621447">newLocalListener</a></span><span class="op" id="6634312">(</span><span class="ident" id="6634313"><a href="/gostd/net/dial_test.go.html#6634273">t</a></span><span class="op" id="6634314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634317">defer</span>&nbsp;<span class="ident" id="6634323"><a href="/gostd/net/dial_test.go.html#6634290">ln</a></span><span class="op" id="6634325">.</span><span class="ident" id="6634326"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6634331">(</span><span class="op" id="6634332">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634335">defer</span>&nbsp;<span class="keyword" id="6634341">func</span><span class="op" id="6634345">(</span><span class="op" id="6634346">)</span>&nbsp;<span class="op" id="6634348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634352"><a href="/gostd/net/dial.go.html#3204731">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="6634373">=</span>&nbsp;<span class="keyword" id="6634375">func</span><span class="op" id="6634379">(</span><span class="op" id="6634380">)</span>&nbsp;<span class="op" id="6634382">{</span><span class="op" id="6634383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634386">}</span><span class="op" id="6634387">(</span><span class="op" id="6634388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634391">go</span>&nbsp;<span class="keyword" id="6634394">func</span><span class="op" id="6634398">(</span><span class="op" id="6634399">)</span>&nbsp;<span class="op" id="6634401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634405">for</span>&nbsp;<span class="op" id="6634409">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634414">c</span><span class="op" id="6634415">,</span>&nbsp;<span class="ident" id="6634417">err</span>&nbsp;<span class="op" id="6634421">:=</span>&nbsp;<span class="ident" id="6634424"><a href="/gostd/net/dial_test.go.html#6634290">ln</a></span><span class="op" id="6634426">.</span><span class="ident" id="6634427"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6634433">(</span><span class="op" id="6634434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634439">if</span>&nbsp;<span class="ident" id="6634442"><a href="/gostd/net/dial_test.go.html#6634417">err</a></span>&nbsp;<span class="op" id="6634446">!=</span>&nbsp;<span class="builtintype" id="6634449">nil</span>&nbsp;<span class="op" id="6634453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634459">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634474"><a href="/gostd/net/dial_test.go.html#6634414">c</a></span><span class="op" id="6634475">.</span><span class="ident" id="6634476"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6634481">(</span><span class="op" id="6634482">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634489">}</span><span class="op" id="6634490">(</span><span class="op" id="6634491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634494">for</span>&nbsp;<span class="ident" id="6634498">_</span><span class="op" id="6634499">,</span>&nbsp;<span class="ident" id="6634501">keepAlive</span>&nbsp;<span class="op" id="6634511">:=</span>&nbsp;<span class="keyword" id="6634514">range</span>&nbsp;<span class="op" id="6634520">[</span><span class="op" id="6634521">]</span><span class="builtintype" id="6634522">bool</span><span class="op" id="6634526">{</span><span class="builtintype" id="6634527">false</span><span class="op" id="6634532">,</span>&nbsp;<span class="builtintype" id="6634534">true</span><span class="op" id="6634538">}</span>&nbsp;<span class="op" id="6634540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634544">got</span>&nbsp;<span class="op" id="6634548">:=</span>&nbsp;<span class="builtintype" id="6634551">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634559"><a href="/gostd/net/dial.go.html#3204731">testHookSetKeepAlive</a></span>&nbsp;<span class="op" id="6634580">=</span>&nbsp;<span class="keyword" id="6634582">func</span><span class="op" id="6634586">(</span><span class="op" id="6634587">)</span>&nbsp;<span class="op" id="6634589">{</span>&nbsp;<span class="ident" id="6634591"><a href="/gostd/net/dial_test.go.html#6634544">got</a></span>&nbsp;<span class="op" id="6634595">=</span>&nbsp;<span class="builtintype" id="6634597">true</span>&nbsp;<span class="op" id="6634602">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634606">var</span>&nbsp;<span class="ident" id="6634610">d</span>&nbsp;<span class="ident" id="6634612"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634621">if</span>&nbsp;<span class="ident" id="6634624"><a href="/gostd/net/dial_test.go.html#6634501">keepAlive</a></span>&nbsp;<span class="op" id="6634634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634639"><a href="/gostd/net/dial_test.go.html#6634610">d</a></span><span class="op" id="6634640">.</span><span class="ident" id="6634641"><a href="/gostd/net/dial.go.html#3201057">KeepAlive</a></span>&nbsp;<span class="op" id="6634651">=</span>&nbsp;<span class="num" id="6634653">30</span>&nbsp;<span class="op" id="6634656">*</span>&nbsp;<span class="ident" id="6634658"><a href="/gostd/net/dial_test.go.html#6621432">time</a></span><span class="op" id="6634662">.</span><span class="ident" id="6634663"><a href="/gostd/time/time.go.html#2734862">Second</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634676">c</span><span class="op" id="6634677">,</span>&nbsp;<span class="ident" id="6634679">err</span>&nbsp;<span class="op" id="6634683">:=</span>&nbsp;<span class="ident" id="6634686"><a href="/gostd/net/dial_test.go.html#6634610">d</a></span><span class="op" id="6634687">.</span><span class="ident" id="6634688"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="6634692">(</span><span class="string" id="6634693">&#34;tcp&#34;</span><span class="op" id="6634698">,</span>&nbsp;<span class="ident" id="6634700"><a href="/gostd/net/dial_test.go.html#6634290">ln</a></span><span class="op" id="6634702">.</span><span class="ident" id="6634703"><a href="/gostd/net/net.go.html#3340993">Addr</a></span><span class="op" id="6634707">(</span><span class="op" id="6634708">)</span><span class="op" id="6634709">.</span><span class="ident" id="6634710"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="6634716">(</span><span class="op" id="6634717">)</span><span class="op" id="6634718">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634722">if</span>&nbsp;<span class="ident" id="6634725"><a href="/gostd/net/dial_test.go.html#6634679">err</a></span>&nbsp;<span class="op" id="6634729">!=</span>&nbsp;<span class="builtintype" id="6634732">nil</span>&nbsp;<span class="op" id="6634736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634741"><a href="/gostd/net/dial_test.go.html#6634273">t</a></span><span class="op" id="6634742">.</span><span class="ident" id="6634743"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="6634748">(</span><span class="ident" id="6634749"><a href="/gostd/net/dial_test.go.html#6634679">err</a></span><span class="op" id="6634752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634760"><a href="/gostd/net/dial_test.go.html#6634676">c</a></span><span class="op" id="6634761">.</span><span class="ident" id="6634762"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6634767">(</span><span class="op" id="6634768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634772">if</span>&nbsp;<span class="ident" id="6634775"><a href="/gostd/net/dial_test.go.html#6634544">got</a></span>&nbsp;<span class="op" id="6634779">!=</span>&nbsp;<span class="ident" id="6634782"><a href="/gostd/net/dial_test.go.html#6634501">keepAlive</a></span>&nbsp;<span class="op" id="6634792">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634797"><a href="/gostd/net/dial_test.go.html#6634273">t</a></span><span class="op" id="6634798">.</span><span class="ident" id="6634799"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="6634805">(</span><span class="string" id="6634806">&#34;Dialer.KeepAlive&nbsp;=&nbsp;%v:&nbsp;SetKeepAlive&nbsp;called&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6634864">,</span>&nbsp;<span class="ident" id="6634866"><a href="/gostd/net/dial_test.go.html#6634610">d</a></span><span class="op" id="6634867">.</span><span class="ident" id="6634868"><a href="/gostd/net/dial.go.html#3201057">KeepAlive</a></span><span class="op" id="6634877">,</span>&nbsp;<span class="ident" id="6634879"><a href="/gostd/net/dial_test.go.html#6634544">got</a></span><span class="op" id="6634882">,</span>&nbsp;<span class="op" id="6634884">!</span><span class="ident" id="6634885"><a href="/gostd/net/dial_test.go.html#6634544">got</a></span><span class="op" id="6634888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634895">}</span><br>
<span class="lineno"></span><span class="op" id="6634897">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
