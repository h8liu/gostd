<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6230955">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6231010">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6231064">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6231115">//&nbsp;Package&nbsp;bzip2&nbsp;implements&nbsp;bzip2&nbsp;decompression.</span><br>
<span class="lineno"></span><span class="keyword" id="6231164">package</span>&nbsp;<span class="ident" id="6231172">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6231179">import</span>&nbsp;<span class="string" id="6231186">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6231192">//&nbsp;There&#39;s&nbsp;no&nbsp;RFC&nbsp;for&nbsp;bzip2.&nbsp;I&nbsp;used&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for&nbsp;reference&nbsp;and&nbsp;a&nbsp;lot</span><br>
<span class="lineno"></span><span class="comment" id="6231271">//&nbsp;of&nbsp;guessing:&nbsp;http://en.wikipedia.org/wiki/Bzip2</span><br>
<span class="lineno"></span><span class="comment" id="6231322">//&nbsp;The&nbsp;source&nbsp;code&nbsp;to&nbsp;pyflate&nbsp;was&nbsp;useful&nbsp;for&nbsp;debugging:</span><br>
<span class="lineno"></span><span class="comment" id="6231378">//&nbsp;http://www.paul.sladen.org/projects/pyflate</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6231426">//&nbsp;A&nbsp;StructuralError&nbsp;is&nbsp;returned&nbsp;when&nbsp;the&nbsp;bzip2&nbsp;data&nbsp;is&nbsp;found&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6231494">//&nbsp;syntactically&nbsp;invalid.</span><br>
<span class="lineno"></span><span class="keyword" id="6231520">type</span>&nbsp;<span class="ident" id="6231525">StructuralError</span>&nbsp;<span class="builtintype" id="6231541">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6231549">func</span>&nbsp;<span class="op" id="6231554">(</span><span class="ident" id="6231555">s</span>&nbsp;<span class="ident" id="6231557"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6231572">)</span>&nbsp;<span class="ident" id="6231574">Error</span><span class="op" id="6231579">(</span><span class="op" id="6231580">)</span>&nbsp;<span class="builtintype" id="6231582">string</span>&nbsp;<span class="op" id="6231589">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6231592">return</span>&nbsp;<span class="string" id="6231599">&#34;bzip2&nbsp;data&nbsp;invalid:&nbsp;&#34;</span>&nbsp;<span class="op" id="6231622">+</span>&nbsp;<span class="builtintype" id="6231624">string</span><span class="op" id="6231630">(</span><span class="ident" id="6231631"><a href="/compress/bzip2/bzip2.go.html#6231555">s</a></span><span class="op" id="6231632">)</span><br>
<span class="lineno"></span><span class="op" id="6231634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6231637">//&nbsp;A&nbsp;reader&nbsp;decompresses&nbsp;bzip2&nbsp;compressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6231685">type</span>&nbsp;<span class="ident" id="6231690">reader</span>&nbsp;<span class="keyword" id="6231697">struct</span>&nbsp;<span class="op" id="6231704">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231707">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231720"><a href="/compress/bzip2/bit_reader.go.html#6229239">bitReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231731">fileCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6231744">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231752">blockCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6231765">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231773">wantBlockCRC</span>&nbsp;<span class="builtintype" id="6231786">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231794">setupDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6231807">bool</span>&nbsp;<span class="comment" id="6231812">//&nbsp;true&nbsp;if&nbsp;we&nbsp;have&nbsp;parsed&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231857">blockSize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6231870">int</span>&nbsp;&nbsp;<span class="comment" id="6231875">//&nbsp;blockSize&nbsp;in&nbsp;bytes,&nbsp;i.e.&nbsp;900&nbsp;*&nbsp;1024.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231916">eof</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6231929">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6231935">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231948">[</span><span class="op" id="6231949">]</span><span class="builtintype" id="6231950">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6231958">//&nbsp;stores&nbsp;Burrows-Wheeler&nbsp;transformed&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232003">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232016">[</span><span class="num" id="6232017">256</span><span class="op" id="6232020">]</span><span class="builtintype" id="6232021">uint</span>&nbsp;<span class="comment" id="6232026">//&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;for&nbsp;the&nbsp;inverse&nbsp;BWT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232065">tt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232078">[</span><span class="op" id="6232079">]</span><span class="builtintype" id="6232080">uint32</span>&nbsp;&nbsp;<span class="comment" id="6232088">//&nbsp;mirrors&nbsp;the&nbsp;`tt&#39;&nbsp;array&nbsp;in&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;and&nbsp;contains&nbsp;the&nbsp;P&nbsp;array&nbsp;in&nbsp;the&nbsp;upper&nbsp;24&nbsp;bits.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232182">tPos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6232195">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232205">//&nbsp;Index&nbsp;of&nbsp;the&nbsp;next&nbsp;output&nbsp;byte&nbsp;in&nbsp;tt.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232247">preRLE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232259">[</span><span class="op" id="6232260">]</span><span class="builtintype" id="6232261">uint32</span>&nbsp;<span class="comment" id="6232268">//&nbsp;contains&nbsp;the&nbsp;RLE&nbsp;data&nbsp;still&nbsp;to&nbsp;be&nbsp;processed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232317">preRLEUsed</span>&nbsp;&nbsp;<span class="builtintype" id="6232329">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232338">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;of&nbsp;preRLE&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232376">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6232388">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232397">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;value&nbsp;seen.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232427">byteRepeats</span>&nbsp;<span class="builtintype" id="6232439">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232448">//&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;lastByte&nbsp;seen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232492">repeats</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6232504">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232513">//&nbsp;the&nbsp;number&nbsp;of&nbsp;copies&nbsp;of&nbsp;lastByte&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="op" id="6232560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6232563">//&nbsp;NewReader&nbsp;returns&nbsp;an&nbsp;io.Reader&nbsp;which&nbsp;decompresses&nbsp;bzip2&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">45</span><span class="comment" id="6232635">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="6232682">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="6232744">func</span>&nbsp;<span class="ident" id="6232749">NewReader</span><span class="op" id="6232758">(</span><span class="ident" id="6232759">r</span>&nbsp;<span class="ident" id="6232761"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6232763">.</span><span class="ident" id="6232764">Reader</span><span class="op" id="6232770">)</span>&nbsp;<span class="ident" id="6232772"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6232774">.</span><span class="ident" id="6232775">Reader</span>&nbsp;<span class="op" id="6232782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232785">bz2</span>&nbsp;<span class="op" id="6232789">:=</span>&nbsp;<span class="builtinfunc" id="6232792">new</span><span class="op" id="6232795">(</span><span class="ident" id="6232796"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6232802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6232805"><a href="/compress/bzip2/bzip2.go.html#6232785">bz2</a></span><span class="op" id="6232808">.</span><span class="ident" id="6232809">br</span>&nbsp;<span class="op" id="6232812">=</span>&nbsp;<span class="ident" id="6232814"><a href="/compress/bzip2/bit_reader.go.html#6229460">newBitReader</a></span><span class="op" id="6232826">(</span><span class="ident" id="6232827"><a href="/compress/bzip2/bzip2.go.html#6232759">r</a></span><span class="op" id="6232828">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6232831">return</span>&nbsp;<span class="ident" id="6232838"><a href="/compress/bzip2/bzip2.go.html#6232785">bz2</a></span><br>
<span class="lineno"></span><span class="op" id="6232842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6232845">const</span>&nbsp;<span class="ident" id="6232851">bzip2FileMagic</span>&nbsp;<span class="op" id="6232866">=</span>&nbsp;<span class="num" id="6232868">0x425a</span>&nbsp;<span class="comment" id="6232875">//&nbsp;&#34;BZ&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="6232883">const</span>&nbsp;<span class="ident" id="6232889">bzip2BlockMagic</span>&nbsp;<span class="op" id="6232905">=</span>&nbsp;<span class="num" id="6232907">0x314159265359</span><br>
<span class="lineno">55</span><span class="keyword" id="6232922">const</span>&nbsp;<span class="ident" id="6232928">bzip2FinalMagic</span>&nbsp;<span class="op" id="6232944">=</span>&nbsp;<span class="num" id="6232946">0x177245385090</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6232962">//&nbsp;setup&nbsp;parses&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6232996">func</span>&nbsp;<span class="op" id="6233001">(</span><span class="ident" id="6233002">bz2</span>&nbsp;<span class="op" id="6233006">*</span><span class="ident" id="6233007"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6233013">)</span>&nbsp;<span class="ident" id="6233015">setup</span><span class="op" id="6233020">(</span><span class="ident" id="6233021">needMagic</span>&nbsp;<span class="builtintype" id="6233031">bool</span><span class="op" id="6233035">)</span>&nbsp;<span class="builtintype" id="6233037">error</span>&nbsp;<span class="op" id="6233043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233046">br</span>&nbsp;<span class="op" id="6233049">:=</span>&nbsp;<span class="op" id="6233052">&amp;</span><span class="ident" id="6233053"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233056">.</span><span class="ident" id="6233057">br</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233062">if</span>&nbsp;<span class="ident" id="6233065"><a href="/compress/bzip2/bzip2.go.html#6233021">needMagic</a></span>&nbsp;<span class="op" id="6233075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233079">magic</span>&nbsp;<span class="op" id="6233085">:=</span>&nbsp;<span class="ident" id="6233088"><a href="/compress/bzip2/bzip2.go.html#6233046">br</a></span><span class="op" id="6233090">.</span><span class="ident" id="6233091">ReadBits</span><span class="op" id="6233099">(</span><span class="num" id="6233100">16</span><span class="op" id="6233102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233106">if</span>&nbsp;<span class="ident" id="6233109"><a href="/compress/bzip2/bzip2.go.html#6233079">magic</a></span>&nbsp;<span class="op" id="6233115">!=</span>&nbsp;<span class="ident" id="6233118"><a href="/compress/bzip2/bzip2.go.html#6232851">bzip2FileMagic</a></span>&nbsp;<span class="op" id="6233133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233138">return</span>&nbsp;<span class="ident" id="6233145"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6233160">(</span><span class="string" id="6233161">&#34;bad&nbsp;magic&nbsp;value&#34;</span><span class="op" id="6233178">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233189">t</span>&nbsp;<span class="op" id="6233191">:=</span>&nbsp;<span class="ident" id="6233194"><a href="/compress/bzip2/bzip2.go.html#6233046">br</a></span><span class="op" id="6233196">.</span><span class="ident" id="6233197">ReadBits</span><span class="op" id="6233205">(</span><span class="num" id="6233206">8</span><span class="op" id="6233207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233210">if</span>&nbsp;<span class="ident" id="6233213"><a href="/compress/bzip2/bzip2.go.html#6233189">t</a></span>&nbsp;<span class="op" id="6233215">!=</span>&nbsp;<span class="string" id="6233218">&#39;h&#39;</span>&nbsp;<span class="op" id="6233222">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233226">return</span>&nbsp;<span class="ident" id="6233233"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6233248">(</span><span class="string" id="6233249">&#34;non-Huffman&nbsp;entropy&nbsp;encoding&#34;</span><span class="op" id="6233279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233286">level</span>&nbsp;<span class="op" id="6233292">:=</span>&nbsp;<span class="ident" id="6233295"><a href="/compress/bzip2/bzip2.go.html#6233046">br</a></span><span class="op" id="6233297">.</span><span class="ident" id="6233298">ReadBits</span><span class="op" id="6233306">(</span><span class="num" id="6233307">8</span><span class="op" id="6233308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233311">if</span>&nbsp;<span class="ident" id="6233314"><a href="/compress/bzip2/bzip2.go.html#6233286">level</a></span>&nbsp;<span class="op" id="6233320">&lt;</span>&nbsp;<span class="string" id="6233322">&#39;1&#39;</span>&nbsp;<span class="op" id="6233326">||</span>&nbsp;<span class="ident" id="6233329"><a href="/compress/bzip2/bzip2.go.html#6233286">level</a></span>&nbsp;<span class="op" id="6233335">&gt;</span>&nbsp;<span class="string" id="6233337">&#39;9&#39;</span>&nbsp;<span class="op" id="6233341">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233345">return</span>&nbsp;<span class="ident" id="6233352"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6233367">(</span><span class="string" id="6233368">&#34;invalid&nbsp;compression&nbsp;level&#34;</span><span class="op" id="6233395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233402"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233405">.</span><span class="ident" id="6233406">fileCRC</span>&nbsp;<span class="op" id="6233414">=</span>&nbsp;<span class="num" id="6233416">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233419"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233422">.</span><span class="ident" id="6233423">blockSize</span>&nbsp;<span class="op" id="6233433">=</span>&nbsp;<span class="num" id="6233435">100</span>&nbsp;<span class="op" id="6233439">*</span>&nbsp;<span class="num" id="6233441">1024</span>&nbsp;<span class="op" id="6233446">*</span>&nbsp;<span class="op" id="6233448">(</span><span class="builtintype" id="6233449">int</span><span class="op" id="6233452">(</span><span class="ident" id="6233453"><a href="/compress/bzip2/bzip2.go.html#6233286">level</a></span><span class="op" id="6233458">)</span>&nbsp;<span class="op" id="6233460">-</span>&nbsp;<span class="string" id="6233462">&#39;0&#39;</span><span class="op" id="6233465">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233468">if</span>&nbsp;<span class="ident" id="6233471"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233474">.</span><span class="ident" id="6233475">blockSize</span>&nbsp;<span class="op" id="6233485">&gt;</span>&nbsp;<span class="builtinfunc" id="6233487">len</span><span class="op" id="6233490">(</span><span class="ident" id="6233491"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233494">.</span><span class="ident" id="6233495">tt</span><span class="op" id="6233497">)</span>&nbsp;<span class="op" id="6233499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233503"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233506">.</span><span class="ident" id="6233507">tt</span>&nbsp;<span class="op" id="6233510">=</span>&nbsp;<span class="builtinfunc" id="6233512">make</span><span class="op" id="6233516">(</span><span class="op" id="6233517">[</span><span class="op" id="6233518">]</span><span class="builtintype" id="6233519">uint32</span><span class="op" id="6233525">,</span>&nbsp;<span class="ident" id="6233527"><a href="/compress/bzip2/bzip2.go.html#6233002">bz2</a></span><span class="op" id="6233530">.</span><span class="ident" id="6233531">blockSize</span><span class="op" id="6233540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233546">return</span>&nbsp;<span class="ident" id="6233553">nil</span><br>
<span class="lineno"></span><span class="op" id="6233557">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6233560">func</span>&nbsp;<span class="op" id="6233565">(</span><span class="ident" id="6233566">bz2</span>&nbsp;<span class="op" id="6233570">*</span><span class="ident" id="6233571"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6233577">)</span>&nbsp;<span class="ident" id="6233579">Read</span><span class="op" id="6233583">(</span><span class="ident" id="6233584">buf</span>&nbsp;<span class="op" id="6233588">[</span><span class="op" id="6233589">]</span><span class="builtintype" id="6233590">byte</span><span class="op" id="6233594">)</span>&nbsp;<span class="op" id="6233596">(</span><span class="ident" id="6233597">n</span>&nbsp;<span class="builtintype" id="6233599">int</span><span class="op" id="6233602">,</span>&nbsp;<span class="ident" id="6233604">err</span>&nbsp;<span class="builtintype" id="6233608">error</span><span class="op" id="6233613">)</span>&nbsp;<span class="op" id="6233615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233618">if</span>&nbsp;<span class="ident" id="6233621"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233624">.</span><span class="ident" id="6233625">eof</span>&nbsp;<span class="op" id="6233629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233633">return</span>&nbsp;<span class="num" id="6233640">0</span><span class="op" id="6233641">,</span>&nbsp;<span class="ident" id="6233643"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6233645">.</span><span class="ident" id="6233646">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233651">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233655">if</span>&nbsp;<span class="op" id="6233658">!</span><span class="ident" id="6233659"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233662">.</span><span class="ident" id="6233663">setupDone</span>&nbsp;<span class="op" id="6233673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233677"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span>&nbsp;<span class="op" id="6233681">=</span>&nbsp;<span class="ident" id="6233683"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233686">.</span><span class="ident" id="6233687">setup</span><span class="op" id="6233692">(</span><span class="builtintype" id="6233693">true</span><span class="op" id="6233697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233701">brErr</span>&nbsp;<span class="op" id="6233707">:=</span>&nbsp;<span class="ident" id="6233710"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233713">.</span><span class="ident" id="6233714">br</span><span class="op" id="6233716">.</span><span class="ident" id="6233717">Err</span><span class="op" id="6233720">(</span><span class="op" id="6233721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233725">if</span>&nbsp;<span class="ident" id="6233728"><a href="/compress/bzip2/bzip2.go.html#6233701">brErr</a></span>&nbsp;<span class="op" id="6233734">!=</span>&nbsp;<span class="ident" id="6233737">nil</span>&nbsp;<span class="op" id="6233741">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233746"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span>&nbsp;<span class="op" id="6233750">=</span>&nbsp;<span class="ident" id="6233752"><a href="/compress/bzip2/bzip2.go.html#6233701">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233764">if</span>&nbsp;<span class="ident" id="6233767"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span>&nbsp;<span class="op" id="6233771">!=</span>&nbsp;<span class="ident" id="6233774">nil</span>&nbsp;<span class="op" id="6233778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233783">return</span>&nbsp;<span class="num" id="6233790">0</span><span class="op" id="6233791">,</span>&nbsp;<span class="ident" id="6233793"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233799">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233803"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233806">.</span><span class="ident" id="6233807">setupDone</span>&nbsp;<span class="op" id="6233817">=</span>&nbsp;<span class="builtintype" id="6233819">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233829"><a href="/compress/bzip2/bzip2.go.html#6233597">n</a></span><span class="op" id="6233830">,</span>&nbsp;<span class="ident" id="6233832"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span>&nbsp;<span class="op" id="6233836">=</span>&nbsp;<span class="ident" id="6233838"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233841">.</span><span class="ident" id="6233842">read</span><span class="op" id="6233846">(</span><span class="ident" id="6233847"><a href="/compress/bzip2/bzip2.go.html#6233584">buf</a></span><span class="op" id="6233850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233853">brErr</span>&nbsp;<span class="op" id="6233859">:=</span>&nbsp;<span class="ident" id="6233862"><a href="/compress/bzip2/bzip2.go.html#6233566">bz2</a></span><span class="op" id="6233865">.</span><span class="ident" id="6233866">br</span><span class="op" id="6233868">.</span><span class="ident" id="6233869">Err</span><span class="op" id="6233872">(</span><span class="op" id="6233873">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233876">if</span>&nbsp;<span class="ident" id="6233879"><a href="/compress/bzip2/bzip2.go.html#6233853">brErr</a></span>&nbsp;<span class="op" id="6233885">!=</span>&nbsp;<span class="ident" id="6233888">nil</span>&nbsp;<span class="op" id="6233892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233896"><a href="/compress/bzip2/bzip2.go.html#6233604">err</a></span>&nbsp;<span class="op" id="6233900">=</span>&nbsp;<span class="ident" id="6233902"><a href="/compress/bzip2/bzip2.go.html#6233853">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233912">return</span><br>
<span class="lineno"></span><span class="op" id="6233919">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6233922">func</span>&nbsp;<span class="op" id="6233927">(</span><span class="ident" id="6233928">bz2</span>&nbsp;<span class="op" id="6233932">*</span><span class="ident" id="6233933"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6233939">)</span>&nbsp;<span class="ident" id="6233941">readFromBlock</span><span class="op" id="6233954">(</span><span class="ident" id="6233955">buf</span>&nbsp;<span class="op" id="6233959">[</span><span class="op" id="6233960">]</span><span class="builtintype" id="6233961">byte</span><span class="op" id="6233965">)</span>&nbsp;<span class="builtintype" id="6233967">int</span>&nbsp;<span class="op" id="6233971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6233974">//&nbsp;bzip2&nbsp;is&nbsp;a&nbsp;block&nbsp;based&nbsp;compressor,&nbsp;except&nbsp;that&nbsp;it&nbsp;has&nbsp;a&nbsp;run-length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234045">//&nbsp;preprocessing&nbsp;step.&nbsp;The&nbsp;block&nbsp;based&nbsp;nature&nbsp;means&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234110">//&nbsp;preallocate&nbsp;fixed-size&nbsp;buffers&nbsp;and&nbsp;reuse&nbsp;them.&nbsp;However,&nbsp;the&nbsp;RLE</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234178">//&nbsp;preprocessing&nbsp;would&nbsp;require&nbsp;allocating&nbsp;huge&nbsp;buffers&nbsp;to&nbsp;store&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234247">//&nbsp;maximum&nbsp;expansion.&nbsp;Thus&nbsp;we&nbsp;process&nbsp;blocks&nbsp;all&nbsp;at&nbsp;once,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234317">//&nbsp;the&nbsp;RLE&nbsp;which&nbsp;we&nbsp;decompress&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234362">n</span>&nbsp;<span class="op" id="6234364">:=</span>&nbsp;<span class="num" id="6234367">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234370">for</span>&nbsp;<span class="op" id="6234374">(</span><span class="ident" id="6234375"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234378">.</span><span class="ident" id="6234379">repeats</span>&nbsp;<span class="op" id="6234387">&gt;</span>&nbsp;<span class="num" id="6234389">0</span>&nbsp;<span class="op" id="6234391">||</span>&nbsp;<span class="ident" id="6234394"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234397">.</span><span class="ident" id="6234398">preRLEUsed</span>&nbsp;<span class="op" id="6234409">&lt;</span>&nbsp;<span class="builtinfunc" id="6234411">len</span><span class="op" id="6234414">(</span><span class="ident" id="6234415"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234418">.</span><span class="ident" id="6234419">preRLE</span><span class="op" id="6234425">)</span><span class="op" id="6234426">)</span>&nbsp;<span class="op" id="6234428">&amp;&amp;</span>&nbsp;<span class="ident" id="6234431"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span>&nbsp;<span class="op" id="6234433">&lt;</span>&nbsp;<span class="builtinfunc" id="6234435">len</span><span class="op" id="6234438">(</span><span class="ident" id="6234439"><a href="/compress/bzip2/bzip2.go.html#6233955">buf</a></span><span class="op" id="6234442">)</span>&nbsp;<span class="op" id="6234444">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234448">//&nbsp;We&nbsp;have&nbsp;RLE&nbsp;data&nbsp;pending.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234480">//&nbsp;The&nbsp;run-length&nbsp;encoding&nbsp;works&nbsp;like&nbsp;this:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234526">//&nbsp;Any&nbsp;sequence&nbsp;of&nbsp;four&nbsp;equal&nbsp;bytes&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234588">//&nbsp;byte&nbsp;which&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;that&nbsp;byte&nbsp;to</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234651">//&nbsp;include.&nbsp;(The&nbsp;number&nbsp;of&nbsp;repeats&nbsp;can&nbsp;be&nbsp;zero.)&nbsp;Because&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234717">//&nbsp;decompressing&nbsp;on-demand&nbsp;our&nbsp;state&nbsp;is&nbsp;kept&nbsp;in&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234778">//&nbsp;object.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234792">if</span>&nbsp;<span class="ident" id="6234795"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234798">.</span><span class="ident" id="6234799">repeats</span>&nbsp;<span class="op" id="6234807">&gt;</span>&nbsp;<span class="num" id="6234809">0</span>&nbsp;<span class="op" id="6234811">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234816"><a href="/compress/bzip2/bzip2.go.html#6233955">buf</a></span><span class="op" id="6234819">[</span><span class="ident" id="6234820"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span><span class="op" id="6234821">]</span>&nbsp;<span class="op" id="6234823">=</span>&nbsp;<span class="builtintype" id="6234825">byte</span><span class="op" id="6234829">(</span><span class="ident" id="6234830"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234833">.</span><span class="ident" id="6234834">lastByte</span><span class="op" id="6234842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234847"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span><span class="op" id="6234848">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234854"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234857">.</span><span class="ident" id="6234858">repeats</span><span class="op" id="6234865">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234871">if</span>&nbsp;<span class="ident" id="6234874"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234877">.</span><span class="ident" id="6234878">repeats</span>&nbsp;<span class="op" id="6234886">==</span>&nbsp;<span class="num" id="6234889">0</span>&nbsp;<span class="op" id="6234891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234897"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234900">.</span><span class="ident" id="6234901">lastByte</span>&nbsp;<span class="op" id="6234910">=</span>&nbsp;<span class="op" id="6234912">-</span><span class="num" id="6234913">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234923">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234939"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234942">.</span><span class="ident" id="6234943">tPos</span>&nbsp;<span class="op" id="6234948">=</span>&nbsp;<span class="ident" id="6234950"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234953">.</span><span class="ident" id="6234954">preRLE</span><span class="op" id="6234960">[</span><span class="ident" id="6234961"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234964">.</span><span class="ident" id="6234965">tPos</span><span class="op" id="6234969">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234973">b</span>&nbsp;<span class="op" id="6234975">:=</span>&nbsp;<span class="builtintype" id="6234978">byte</span><span class="op" id="6234982">(</span><span class="ident" id="6234983"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234986">.</span><span class="ident" id="6234987">tPos</span><span class="op" id="6234991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234995"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6234998">.</span><span class="ident" id="6234999">tPos</span>&nbsp;<span class="op" id="6235004">&gt;&gt;=</span>&nbsp;<span class="num" id="6235008">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235012"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235015">.</span><span class="ident" id="6235016">preRLEUsed</span><span class="op" id="6235026">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235032">if</span>&nbsp;<span class="ident" id="6235035"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235038">.</span><span class="ident" id="6235039">byteRepeats</span>&nbsp;<span class="op" id="6235051">==</span>&nbsp;<span class="num" id="6235054">3</span>&nbsp;<span class="op" id="6235056">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235061"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235064">.</span><span class="ident" id="6235065">repeats</span>&nbsp;<span class="op" id="6235073">=</span>&nbsp;<span class="builtintype" id="6235075">uint</span><span class="op" id="6235079">(</span><span class="ident" id="6235080"><a href="/compress/bzip2/bzip2.go.html#6234973">b</a></span><span class="op" id="6235081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235086"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235089">.</span><span class="ident" id="6235090">byteRepeats</span>&nbsp;<span class="op" id="6235102">=</span>&nbsp;<span class="num" id="6235104">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235109">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235125">if</span>&nbsp;<span class="ident" id="6235128"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235131">.</span><span class="ident" id="6235132">lastByte</span>&nbsp;<span class="op" id="6235141">==</span>&nbsp;<span class="builtintype" id="6235144">int</span><span class="op" id="6235147">(</span><span class="ident" id="6235148"><a href="/compress/bzip2/bzip2.go.html#6234973">b</a></span><span class="op" id="6235149">)</span>&nbsp;<span class="op" id="6235151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235156"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235159">.</span><span class="ident" id="6235160">byteRepeats</span><span class="op" id="6235171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235176">}</span>&nbsp;<span class="keyword" id="6235178">else</span>&nbsp;<span class="op" id="6235183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235188"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235191">.</span><span class="ident" id="6235192">byteRepeats</span>&nbsp;<span class="op" id="6235204">=</span>&nbsp;<span class="num" id="6235206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235210">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235214"><a href="/compress/bzip2/bzip2.go.html#6233928">bz2</a></span><span class="op" id="6235217">.</span><span class="ident" id="6235218">lastByte</span>&nbsp;<span class="op" id="6235227">=</span>&nbsp;<span class="builtintype" id="6235229">int</span><span class="op" id="6235232">(</span><span class="ident" id="6235233"><a href="/compress/bzip2/bzip2.go.html#6234973">b</a></span><span class="op" id="6235234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235239"><a href="/compress/bzip2/bzip2.go.html#6233955">buf</a></span><span class="op" id="6235242">[</span><span class="ident" id="6235243"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span><span class="op" id="6235244">]</span>&nbsp;<span class="op" id="6235246">=</span>&nbsp;<span class="ident" id="6235248"><a href="/compress/bzip2/bzip2.go.html#6234973">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235252"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span><span class="op" id="6235253">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235257">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235261">return</span>&nbsp;<span class="ident" id="6235268"><a href="/compress/bzip2/bzip2.go.html#6234362">n</a></span><br>
<span class="lineno"></span><span class="op" id="6235270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6235273">func</span>&nbsp;<span class="op" id="6235278">(</span><span class="ident" id="6235279">bz2</span>&nbsp;<span class="op" id="6235283">*</span><span class="ident" id="6235284"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6235290">)</span>&nbsp;<span class="ident" id="6235292">read</span><span class="op" id="6235296">(</span><span class="ident" id="6235297">buf</span>&nbsp;<span class="op" id="6235301">[</span><span class="op" id="6235302">]</span><span class="builtintype" id="6235303">byte</span><span class="op" id="6235307">)</span>&nbsp;<span class="op" id="6235309">(</span><span class="builtintype" id="6235310">int</span><span class="op" id="6235313">,</span>&nbsp;<span class="builtintype" id="6235315">error</span><span class="op" id="6235320">)</span>&nbsp;<span class="op" id="6235322">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235325">for</span>&nbsp;<span class="op" id="6235329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235333">n</span>&nbsp;<span class="op" id="6235335">:=</span>&nbsp;<span class="ident" id="6235338"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235341">.</span><span class="ident" id="6235342">readFromBlock</span><span class="op" id="6235355">(</span><span class="ident" id="6235356"><a href="/compress/bzip2/bzip2.go.html#6235297">buf</a></span><span class="op" id="6235359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235363">if</span>&nbsp;<span class="ident" id="6235366"><a href="/compress/bzip2/bzip2.go.html#6235333">n</a></span>&nbsp;<span class="op" id="6235368">&gt;</span>&nbsp;<span class="num" id="6235370">0</span>&nbsp;<span class="op" id="6235372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235377"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235380">.</span><span class="ident" id="6235381">blockCRC</span>&nbsp;<span class="op" id="6235390">=</span>&nbsp;<span class="ident" id="6235392"><a href="/compress/bzip2/bzip2.go.html#6244204">updateCRC</a></span><span class="op" id="6235401">(</span><span class="ident" id="6235402"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235405">.</span><span class="ident" id="6235406">blockCRC</span><span class="op" id="6235414">,</span>&nbsp;<span class="ident" id="6235416"><a href="/compress/bzip2/bzip2.go.html#6235297">buf</a></span><span class="op" id="6235419">[</span><span class="op" id="6235420">:</span><span class="ident" id="6235421"><a href="/compress/bzip2/bzip2.go.html#6235333">n</a></span><span class="op" id="6235422">]</span><span class="op" id="6235423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235428">return</span>&nbsp;<span class="ident" id="6235435"><a href="/compress/bzip2/bzip2.go.html#6235333">n</a></span><span class="op" id="6235436">,</span>&nbsp;<span class="ident" id="6235438">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235449">//&nbsp;End&nbsp;of&nbsp;block.&nbsp;Check&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235479">if</span>&nbsp;<span class="ident" id="6235482"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235485">.</span><span class="ident" id="6235486">blockCRC</span>&nbsp;<span class="op" id="6235495">!=</span>&nbsp;<span class="ident" id="6235498"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235501">.</span><span class="ident" id="6235502">wantBlockCRC</span>&nbsp;<span class="op" id="6235515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235520"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235523">.</span><span class="ident" id="6235524">br</span><span class="op" id="6235526">.</span><span class="ident" id="6235527">err</span>&nbsp;<span class="op" id="6235531">=</span>&nbsp;<span class="ident" id="6235533"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6235548">(</span><span class="string" id="6235549">&#34;block&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="6235574">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235579">return</span>&nbsp;<span class="num" id="6235586">0</span><span class="op" id="6235587">,</span>&nbsp;<span class="ident" id="6235589"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235592">.</span><span class="ident" id="6235593">br</span><span class="op" id="6235595">.</span><span class="ident" id="6235596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235607">//&nbsp;Find&nbsp;next&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235629">br</span>&nbsp;<span class="op" id="6235632">:=</span>&nbsp;<span class="op" id="6235635">&amp;</span><span class="ident" id="6235636"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235639">.</span><span class="ident" id="6235640">br</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235645">switch</span>&nbsp;<span class="ident" id="6235652"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6235654">.</span><span class="ident" id="6235655">ReadBits64</span><span class="op" id="6235665">(</span><span class="num" id="6235666">48</span><span class="op" id="6235668">)</span>&nbsp;<span class="op" id="6235670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235674">default</span><span class="op" id="6235681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235686">return</span>&nbsp;<span class="num" id="6235693">0</span><span class="op" id="6235694">,</span>&nbsp;<span class="ident" id="6235696"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6235711">(</span><span class="string" id="6235712">&#34;bad&nbsp;magic&nbsp;value&nbsp;found&#34;</span><span class="op" id="6235735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235740">case</span>&nbsp;<span class="ident" id="6235745"><a href="/compress/bzip2/bzip2.go.html#6232889">bzip2BlockMagic</a></span><span class="op" id="6235760">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235765">//&nbsp;Start&nbsp;of&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235787">err</span>&nbsp;<span class="op" id="6235791">:=</span>&nbsp;<span class="ident" id="6235794"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6235797">.</span><span class="ident" id="6235798">readBlock</span><span class="op" id="6235807">(</span><span class="op" id="6235808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235813">if</span>&nbsp;<span class="ident" id="6235816"><a href="/compress/bzip2/bzip2.go.html#6235787">err</a></span>&nbsp;<span class="op" id="6235820">!=</span>&nbsp;<span class="ident" id="6235823">nil</span>&nbsp;<span class="op" id="6235827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235833">return</span>&nbsp;<span class="num" id="6235840">0</span><span class="op" id="6235841">,</span>&nbsp;<span class="ident" id="6235843"><a href="/compress/bzip2/bzip2.go.html#6235787">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235850">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235855">case</span>&nbsp;<span class="ident" id="6235860"><a href="/compress/bzip2/bzip2.go.html#6232928">bzip2FinalMagic</a></span><span class="op" id="6235875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235880">//&nbsp;Check&nbsp;end-of-file&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235909">wantFileCRC</span>&nbsp;<span class="op" id="6235921">:=</span>&nbsp;<span class="builtintype" id="6235924">uint32</span><span class="op" id="6235930">(</span><span class="ident" id="6235931"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6235933">.</span><span class="ident" id="6235934">ReadBits64</span><span class="op" id="6235944">(</span><span class="num" id="6235945">32</span><span class="op" id="6235947">)</span><span class="op" id="6235948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235953">if</span>&nbsp;<span class="ident" id="6235956"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6235958">.</span><span class="ident" id="6235959">err</span>&nbsp;<span class="op" id="6235963">!=</span>&nbsp;<span class="ident" id="6235966">nil</span>&nbsp;<span class="op" id="6235970">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235976">return</span>&nbsp;<span class="num" id="6235983">0</span><span class="op" id="6235984">,</span>&nbsp;<span class="ident" id="6235986"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6235988">.</span><span class="ident" id="6235989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236001">if</span>&nbsp;<span class="ident" id="6236004"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6236007">.</span><span class="ident" id="6236008">fileCRC</span>&nbsp;<span class="op" id="6236016">!=</span>&nbsp;<span class="ident" id="6236019"><a href="/compress/bzip2/bzip2.go.html#6235909">wantFileCRC</a></span>&nbsp;<span class="op" id="6236031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236037"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236039">.</span><span class="ident" id="6236040">err</span>&nbsp;<span class="op" id="6236044">=</span>&nbsp;<span class="ident" id="6236046"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6236061">(</span><span class="string" id="6236062">&#34;file&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="6236086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236092">return</span>&nbsp;<span class="num" id="6236099">0</span><span class="op" id="6236100">,</span>&nbsp;<span class="ident" id="6236102"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236104">.</span><span class="ident" id="6236105">err</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236118">//&nbsp;Skip&nbsp;ahead&nbsp;to&nbsp;byte&nbsp;boundary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236153">//&nbsp;Is&nbsp;there&nbsp;a&nbsp;file&nbsp;concatenated&nbsp;to&nbsp;this&nbsp;one?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236201">//&nbsp;It&nbsp;would&nbsp;start&nbsp;with&nbsp;BZ.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236231">if</span>&nbsp;<span class="ident" id="6236234"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236236">.</span><span class="ident" id="6236237">bits</span><span class="op" id="6236241">%</span><span class="num" id="6236242">8</span>&nbsp;<span class="op" id="6236244">!=</span>&nbsp;<span class="num" id="6236247">0</span>&nbsp;<span class="op" id="6236249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236255"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236257">.</span><span class="ident" id="6236258">ReadBits</span><span class="op" id="6236266">(</span><span class="ident" id="6236267"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236269">.</span><span class="ident" id="6236270">bits</span>&nbsp;<span class="op" id="6236275">%</span>&nbsp;<span class="num" id="6236277">8</span><span class="op" id="6236278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236288">b</span><span class="op" id="6236289">,</span>&nbsp;<span class="ident" id="6236291">err</span>&nbsp;<span class="op" id="6236295">:=</span>&nbsp;<span class="ident" id="6236298"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236300">.</span><span class="ident" id="6236301">r</span><span class="op" id="6236302">.</span><span class="ident" id="6236303">ReadByte</span><span class="op" id="6236311">(</span><span class="op" id="6236312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236317">if</span>&nbsp;<span class="ident" id="6236320"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236324">==</span>&nbsp;<span class="ident" id="6236327"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6236329">.</span><span class="ident" id="6236330">EOF</span>&nbsp;<span class="op" id="6236334">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236340"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236342">.</span><span class="ident" id="6236343">err</span>&nbsp;<span class="op" id="6236347">=</span>&nbsp;<span class="ident" id="6236349"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6236351">.</span><span class="ident" id="6236352">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236360"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6236363">.</span><span class="ident" id="6236364">eof</span>&nbsp;<span class="op" id="6236368">=</span>&nbsp;<span class="builtintype" id="6236370">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236379">return</span>&nbsp;<span class="num" id="6236386">0</span><span class="op" id="6236387">,</span>&nbsp;<span class="ident" id="6236389"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6236391">.</span><span class="ident" id="6236392">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236404">if</span>&nbsp;<span class="ident" id="6236407"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236411">!=</span>&nbsp;<span class="ident" id="6236414">nil</span>&nbsp;<span class="op" id="6236418">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236424"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236426">.</span><span class="ident" id="6236427">err</span>&nbsp;<span class="op" id="6236431">=</span>&nbsp;<span class="ident" id="6236433"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236441">return</span>&nbsp;<span class="num" id="6236448">0</span><span class="op" id="6236449">,</span>&nbsp;<span class="ident" id="6236451"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236463">z</span><span class="op" id="6236464">,</span>&nbsp;<span class="ident" id="6236466"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236470">:=</span>&nbsp;<span class="ident" id="6236473"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236475">.</span><span class="ident" id="6236476">r</span><span class="op" id="6236477">.</span><span class="ident" id="6236478">ReadByte</span><span class="op" id="6236486">(</span><span class="op" id="6236487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236492">if</span>&nbsp;<span class="ident" id="6236495"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236499">!=</span>&nbsp;<span class="ident" id="6236502">nil</span>&nbsp;<span class="op" id="6236506">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236512">if</span>&nbsp;<span class="ident" id="6236515"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236519">==</span>&nbsp;<span class="ident" id="6236522"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6236524">.</span><span class="ident" id="6236525">EOF</span>&nbsp;<span class="op" id="6236529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236536"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span>&nbsp;<span class="op" id="6236540">=</span>&nbsp;<span class="ident" id="6236542"><a href="/compress/bzip2/bzip2.go.html#6231186">io</a></span><span class="op" id="6236544">.</span><span class="ident" id="6236545">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236572"><a href="/compress/bzip2/bzip2.go.html#6235629">br</a></span><span class="op" id="6236574">.</span><span class="ident" id="6236575">err</span>&nbsp;<span class="op" id="6236579">=</span>&nbsp;<span class="ident" id="6236581"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236589">return</span>&nbsp;<span class="num" id="6236596">0</span><span class="op" id="6236597">,</span>&nbsp;<span class="ident" id="6236599"><a href="/compress/bzip2/bzip2.go.html#6236291">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236611">if</span>&nbsp;<span class="ident" id="6236614"><a href="/compress/bzip2/bzip2.go.html#6236288">b</a></span>&nbsp;<span class="op" id="6236616">!=</span>&nbsp;<span class="string" id="6236619">&#39;B&#39;</span>&nbsp;<span class="op" id="6236623">||</span>&nbsp;<span class="ident" id="6236626"><a href="/compress/bzip2/bzip2.go.html#6236463">z</a></span>&nbsp;<span class="op" id="6236628">!=</span>&nbsp;<span class="string" id="6236631">&#39;Z&#39;</span>&nbsp;<span class="op" id="6236635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236641">return</span>&nbsp;<span class="num" id="6236648">0</span><span class="op" id="6236649">,</span>&nbsp;<span class="ident" id="6236651"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6236666">(</span><span class="string" id="6236667">&#34;bad&nbsp;magic&nbsp;value&nbsp;in&nbsp;continuation&nbsp;file&#34;</span><span class="op" id="6236705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236715">if</span>&nbsp;<span class="ident" id="6236718">err</span>&nbsp;<span class="op" id="6236722">:=</span>&nbsp;<span class="ident" id="6236725"><a href="/compress/bzip2/bzip2.go.html#6235279">bz2</a></span><span class="op" id="6236728">.</span><span class="ident" id="6236729">setup</span><span class="op" id="6236734">(</span><span class="builtintype" id="6236735">false</span><span class="op" id="6236740">)</span><span class="op" id="6236741">;</span>&nbsp;<span class="ident" id="6236743"><a href="/compress/bzip2/bzip2.go.html#6236718">err</a></span>&nbsp;<span class="op" id="6236747">!=</span>&nbsp;<span class="ident" id="6236750">nil</span>&nbsp;<span class="op" id="6236754">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236760">return</span>&nbsp;<span class="num" id="6236767">0</span><span class="op" id="6236768">,</span>&nbsp;<span class="ident" id="6236770"><a href="/compress/bzip2/bzip2.go.html#6236718">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236784">}</span><br>
<span class="lineno"></span><span class="op" id="6236786">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6236789">//&nbsp;readBlock&nbsp;reads&nbsp;a&nbsp;bzip2&nbsp;block.&nbsp;The&nbsp;magic&nbsp;number&nbsp;should&nbsp;already&nbsp;have&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span><span class="keyword" id="6236875">func</span>&nbsp;<span class="op" id="6236880">(</span><span class="ident" id="6236881">bz2</span>&nbsp;<span class="op" id="6236885">*</span><span class="ident" id="6236886"><a href="/compress/bzip2/bzip2.go.html#6231690">reader</a></span><span class="op" id="6236892">)</span>&nbsp;<span class="ident" id="6236894">readBlock</span><span class="op" id="6236903">(</span><span class="op" id="6236904">)</span>&nbsp;<span class="op" id="6236906">(</span><span class="ident" id="6236907">err</span>&nbsp;<span class="builtintype" id="6236911">error</span><span class="op" id="6236916">)</span>&nbsp;<span class="op" id="6236918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236921">br</span>&nbsp;<span class="op" id="6236924">:=</span>&nbsp;<span class="op" id="6236927">&amp;</span><span class="ident" id="6236928"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6236931">.</span><span class="ident" id="6236932">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236936"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6236939">.</span><span class="ident" id="6236940">wantBlockCRC</span>&nbsp;<span class="op" id="6236953">=</span>&nbsp;<span class="builtintype" id="6236955">uint32</span><span class="op" id="6236961">(</span><span class="ident" id="6236962"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6236964">.</span><span class="ident" id="6236965">ReadBits64</span><span class="op" id="6236975">(</span><span class="num" id="6236976">32</span><span class="op" id="6236978">)</span><span class="op" id="6236979">)</span>&nbsp;<span class="comment" id="6236981">//&nbsp;skip&nbsp;checksum.&nbsp;TODO:&nbsp;check&nbsp;it&nbsp;if&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;what&nbsp;it&nbsp;is.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237048"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6237051">.</span><span class="ident" id="6237052">blockCRC</span>&nbsp;<span class="op" id="6237061">=</span>&nbsp;<span class="num" id="6237063">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237066"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6237069">.</span><span class="ident" id="6237070">fileCRC</span>&nbsp;<span class="op" id="6237078">=</span>&nbsp;<span class="op" id="6237080">(</span><span class="ident" id="6237081"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6237084">.</span><span class="ident" id="6237085">fileCRC</span><span class="op" id="6237092">&lt;&lt;</span><span class="num" id="6237094">1</span>&nbsp;<span class="op" id="6237096">|</span>&nbsp;<span class="ident" id="6237098"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6237101">.</span><span class="ident" id="6237102">fileCRC</span><span class="op" id="6237109">&gt;&gt;</span><span class="num" id="6237111">31</span><span class="op" id="6237113">)</span>&nbsp;<span class="op" id="6237115">^</span>&nbsp;<span class="ident" id="6237117"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6237120">.</span><span class="ident" id="6237121">wantBlockCRC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237135">randomized</span>&nbsp;<span class="op" id="6237146">:=</span>&nbsp;<span class="ident" id="6237149"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6237151">.</span><span class="ident" id="6237152">ReadBits</span><span class="op" id="6237160">(</span><span class="num" id="6237161">1</span><span class="op" id="6237162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237165">if</span>&nbsp;<span class="ident" id="6237168"><a href="/compress/bzip2/bzip2.go.html#6237135">randomized</a></span>&nbsp;<span class="op" id="6237179">!=</span>&nbsp;<span class="num" id="6237182">0</span>&nbsp;<span class="op" id="6237184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237188">return</span>&nbsp;<span class="ident" id="6237195"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6237210">(</span><span class="string" id="6237211">&#34;deprecated&nbsp;randomized&nbsp;files&#34;</span><span class="op" id="6237240">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237246">origPtr</span>&nbsp;<span class="op" id="6237254">:=</span>&nbsp;<span class="builtintype" id="6237257">uint</span><span class="op" id="6237261">(</span><span class="ident" id="6237262"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6237264">.</span><span class="ident" id="6237265">ReadBits</span><span class="op" id="6237273">(</span><span class="num" id="6237274">24</span><span class="op" id="6237276">)</span><span class="op" id="6237277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237281">//&nbsp;If&nbsp;not&nbsp;every&nbsp;byte&nbsp;value&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;block&nbsp;(i.e.,&nbsp;it&#39;s&nbsp;text)&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237353">//&nbsp;the&nbsp;symbol&nbsp;set&nbsp;is&nbsp;reduced.&nbsp;The&nbsp;symbols&nbsp;used&nbsp;are&nbsp;stored&nbsp;as&nbsp;a</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237417">//&nbsp;two-level,&nbsp;16x16&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237446">symbolRangeUsedBitmap</span>&nbsp;<span class="op" id="6237468">:=</span>&nbsp;<span class="ident" id="6237471"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6237473">.</span><span class="ident" id="6237474">ReadBits</span><span class="op" id="6237482">(</span><span class="num" id="6237483">16</span><span class="op" id="6237485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237488">symbolPresent</span>&nbsp;<span class="op" id="6237502">:=</span>&nbsp;<span class="builtinfunc" id="6237505">make</span><span class="op" id="6237509">(</span><span class="op" id="6237510">[</span><span class="op" id="6237511">]</span><span class="builtintype" id="6237512">bool</span><span class="op" id="6237516">,</span>&nbsp;<span class="num" id="6237518">256</span><span class="op" id="6237521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237524">numSymbols</span>&nbsp;<span class="op" id="6237535">:=</span>&nbsp;<span class="num" id="6237538">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237541">for</span>&nbsp;<span class="ident" id="6237545">symRange</span>&nbsp;<span class="op" id="6237554">:=</span>&nbsp;<span class="builtintype" id="6237557">uint</span><span class="op" id="6237561">(</span><span class="num" id="6237562">0</span><span class="op" id="6237563">)</span><span class="op" id="6237564">;</span>&nbsp;<span class="ident" id="6237566"><a href="/compress/bzip2/bzip2.go.html#6237545">symRange</a></span>&nbsp;<span class="op" id="6237575">&lt;</span>&nbsp;<span class="num" id="6237577">16</span><span class="op" id="6237579">;</span>&nbsp;<span class="ident" id="6237581"><a href="/compress/bzip2/bzip2.go.html#6237545">symRange</a></span><span class="op" id="6237589">++</span>&nbsp;<span class="op" id="6237592">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237596">if</span>&nbsp;<span class="ident" id="6237599"><a href="/compress/bzip2/bzip2.go.html#6237446">symbolRangeUsedBitmap</a></span><span class="op" id="6237620">&amp;</span><span class="op" id="6237621">(</span><span class="num" id="6237622">1</span><span class="op" id="6237623">&lt;&lt;</span><span class="op" id="6237625">(</span><span class="num" id="6237626">15</span><span class="op" id="6237628">-</span><span class="ident" id="6237629"><a href="/compress/bzip2/bzip2.go.html#6237545">symRange</a></span><span class="op" id="6237637">)</span><span class="op" id="6237638">)</span>&nbsp;<span class="op" id="6237640">!=</span>&nbsp;<span class="num" id="6237643">0</span>&nbsp;<span class="op" id="6237645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237650">bits</span>&nbsp;<span class="op" id="6237655">:=</span>&nbsp;<span class="ident" id="6237658"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6237660">.</span><span class="ident" id="6237661">ReadBits</span><span class="op" id="6237669">(</span><span class="num" id="6237670">16</span><span class="op" id="6237672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237677">for</span>&nbsp;<span class="ident" id="6237681">symbol</span>&nbsp;<span class="op" id="6237688">:=</span>&nbsp;<span class="builtintype" id="6237691">uint</span><span class="op" id="6237695">(</span><span class="num" id="6237696">0</span><span class="op" id="6237697">)</span><span class="op" id="6237698">;</span>&nbsp;<span class="ident" id="6237700"><a href="/compress/bzip2/bzip2.go.html#6237681">symbol</a></span>&nbsp;<span class="op" id="6237707">&lt;</span>&nbsp;<span class="num" id="6237709">16</span><span class="op" id="6237711">;</span>&nbsp;<span class="ident" id="6237713"><a href="/compress/bzip2/bzip2.go.html#6237681">symbol</a></span><span class="op" id="6237719">++</span>&nbsp;<span class="op" id="6237722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237728">if</span>&nbsp;<span class="ident" id="6237731"><a href="/compress/bzip2/bzip2.go.html#6237650">bits</a></span><span class="op" id="6237735">&amp;</span><span class="op" id="6237736">(</span><span class="num" id="6237737">1</span><span class="op" id="6237738">&lt;&lt;</span><span class="op" id="6237740">(</span><span class="num" id="6237741">15</span><span class="op" id="6237743">-</span><span class="ident" id="6237744"><a href="/compress/bzip2/bzip2.go.html#6237681">symbol</a></span><span class="op" id="6237750">)</span><span class="op" id="6237751">)</span>&nbsp;<span class="op" id="6237753">!=</span>&nbsp;<span class="num" id="6237756">0</span>&nbsp;<span class="op" id="6237758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237765"><a href="/compress/bzip2/bzip2.go.html#6237488">symbolPresent</a></span><span class="op" id="6237778">[</span><span class="num" id="6237779">16</span><span class="op" id="6237781">*</span><span class="ident" id="6237782"><a href="/compress/bzip2/bzip2.go.html#6237545">symRange</a></span><span class="op" id="6237790">+</span><span class="ident" id="6237791"><a href="/compress/bzip2/bzip2.go.html#6237681">symbol</a></span><span class="op" id="6237797">]</span>&nbsp;<span class="op" id="6237799">=</span>&nbsp;<span class="builtintype" id="6237801">true</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237811"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span><span class="op" id="6237821">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237840">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237844">if</span>&nbsp;<span class="ident" id="6237847"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span>&nbsp;<span class="op" id="6237858">==</span>&nbsp;<span class="num" id="6237861">0</span>&nbsp;<span class="op" id="6237863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237867">//&nbsp;There&nbsp;must&nbsp;be&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237901">return</span>&nbsp;<span class="ident" id="6237908"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6237923">(</span><span class="string" id="6237924">&#34;no&nbsp;symbols&nbsp;in&nbsp;input&#34;</span><span class="op" id="6237945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237948">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237952">//&nbsp;A&nbsp;block&nbsp;uses&nbsp;between&nbsp;two&nbsp;and&nbsp;six&nbsp;different&nbsp;Huffman&nbsp;trees.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238014">numHuffmanTrees</span>&nbsp;<span class="op" id="6238030">:=</span>&nbsp;<span class="ident" id="6238033"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6238035">.</span><span class="ident" id="6238036">ReadBits</span><span class="op" id="6238044">(</span><span class="num" id="6238045">3</span><span class="op" id="6238046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238049">if</span>&nbsp;<span class="ident" id="6238052"><a href="/compress/bzip2/bzip2.go.html#6238014">numHuffmanTrees</a></span>&nbsp;<span class="op" id="6238068">&lt;</span>&nbsp;<span class="num" id="6238070">2</span>&nbsp;<span class="op" id="6238072">||</span>&nbsp;<span class="ident" id="6238075"><a href="/compress/bzip2/bzip2.go.html#6238014">numHuffmanTrees</a></span>&nbsp;<span class="op" id="6238091">&gt;</span>&nbsp;<span class="num" id="6238093">6</span>&nbsp;<span class="op" id="6238095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238099">return</span>&nbsp;<span class="ident" id="6238106"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6238121">(</span><span class="string" id="6238122">&#34;invalid&nbsp;number&nbsp;of&nbsp;Huffman&nbsp;trees&#34;</span><span class="op" id="6238155">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238162">//&nbsp;The&nbsp;Huffman&nbsp;tree&nbsp;can&nbsp;switch&nbsp;every&nbsp;50&nbsp;symbols&nbsp;so&nbsp;there&#39;s&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238232">//&nbsp;tree&nbsp;indexes&nbsp;telling&nbsp;us&nbsp;which&nbsp;tree&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;50&nbsp;symbol&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238304">numSelectors</span>&nbsp;<span class="op" id="6238317">:=</span>&nbsp;<span class="ident" id="6238320"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6238322">.</span><span class="ident" id="6238323">ReadBits</span><span class="op" id="6238331">(</span><span class="num" id="6238332">15</span><span class="op" id="6238334">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238337">treeIndexes</span>&nbsp;<span class="op" id="6238349">:=</span>&nbsp;<span class="builtinfunc" id="6238352">make</span><span class="op" id="6238356">(</span><span class="op" id="6238357">[</span><span class="op" id="6238358">]</span><span class="builtintype" id="6238359">uint8</span><span class="op" id="6238364">,</span>&nbsp;<span class="ident" id="6238366"><a href="/compress/bzip2/bzip2.go.html#6238304">numSelectors</a></span><span class="op" id="6238378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238382">//&nbsp;The&nbsp;tree&nbsp;indexes&nbsp;are&nbsp;move-to-front&nbsp;transformed&nbsp;and&nbsp;stored&nbsp;as&nbsp;unary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238453">//&nbsp;numbers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238466">mtfTreeDecoder</span>&nbsp;<span class="op" id="6238481">:=</span>&nbsp;<span class="ident" id="6238484"><a href="/compress/bzip2/move_to_front.go.html#6252690">newMTFDecoderWithRange</a></span><span class="op" id="6238506">(</span><span class="ident" id="6238507"><a href="/compress/bzip2/bzip2.go.html#6238014">numHuffmanTrees</a></span><span class="op" id="6238522">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238525">for</span>&nbsp;<span class="ident" id="6238529">i</span>&nbsp;<span class="op" id="6238531">:=</span>&nbsp;<span class="keyword" id="6238534">range</span>&nbsp;<span class="ident" id="6238540"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span>&nbsp;<span class="op" id="6238552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238556">c</span>&nbsp;<span class="op" id="6238558">:=</span>&nbsp;<span class="num" id="6238561">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238565">for</span>&nbsp;<span class="op" id="6238569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238574">inc</span>&nbsp;<span class="op" id="6238578">:=</span>&nbsp;<span class="ident" id="6238581"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6238583">.</span><span class="ident" id="6238584">ReadBits</span><span class="op" id="6238592">(</span><span class="num" id="6238593">1</span><span class="op" id="6238594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238599">if</span>&nbsp;<span class="ident" id="6238602"><a href="/compress/bzip2/bzip2.go.html#6238574">inc</a></span>&nbsp;<span class="op" id="6238606">==</span>&nbsp;<span class="num" id="6238609">0</span>&nbsp;<span class="op" id="6238611">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238617">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238631"><a href="/compress/bzip2/bzip2.go.html#6238556">c</a></span><span class="op" id="6238632">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238641">if</span>&nbsp;<span class="ident" id="6238644"><a href="/compress/bzip2/bzip2.go.html#6238556">c</a></span>&nbsp;<span class="op" id="6238646">&gt;=</span>&nbsp;<span class="ident" id="6238649"><a href="/compress/bzip2/bzip2.go.html#6238014">numHuffmanTrees</a></span>&nbsp;<span class="op" id="6238665">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238670">return</span>&nbsp;<span class="ident" id="6238677"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6238692">(</span><span class="string" id="6238693">&#34;tree&nbsp;index&nbsp;too&nbsp;large&#34;</span><span class="op" id="6238715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238723"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6238734">[</span><span class="ident" id="6238735"><a href="/compress/bzip2/bzip2.go.html#6238529">i</a></span><span class="op" id="6238736">]</span>&nbsp;<span class="op" id="6238738">=</span>&nbsp;<span class="builtintype" id="6238740">uint8</span><span class="op" id="6238745">(</span><span class="ident" id="6238746"><a href="/compress/bzip2/bzip2.go.html#6238466">mtfTreeDecoder</a></span><span class="op" id="6238760">.</span><span class="ident" id="6238761">Decode</span><span class="op" id="6238767">(</span><span class="ident" id="6238768"><a href="/compress/bzip2/bzip2.go.html#6238556">c</a></span><span class="op" id="6238769">)</span><span class="op" id="6238770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238777">//&nbsp;The&nbsp;list&nbsp;of&nbsp;symbols&nbsp;for&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;taken&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238847">//&nbsp;the&nbsp;previously&nbsp;decoded&nbsp;symbol&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238889">symbols</span>&nbsp;<span class="op" id="6238897">:=</span>&nbsp;<span class="builtinfunc" id="6238900">make</span><span class="op" id="6238904">(</span><span class="op" id="6238905">[</span><span class="op" id="6238906">]</span><span class="builtintype" id="6238907">byte</span><span class="op" id="6238911">,</span>&nbsp;<span class="ident" id="6238913"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span><span class="op" id="6238923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238926">nextSymbol</span>&nbsp;<span class="op" id="6238937">:=</span>&nbsp;<span class="num" id="6238940">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238943">for</span>&nbsp;<span class="ident" id="6238947">i</span>&nbsp;<span class="op" id="6238949">:=</span>&nbsp;<span class="num" id="6238952">0</span><span class="op" id="6238953">;</span>&nbsp;<span class="ident" id="6238955"><a href="/compress/bzip2/bzip2.go.html#6238947">i</a></span>&nbsp;<span class="op" id="6238957">&lt;</span>&nbsp;<span class="num" id="6238959">256</span><span class="op" id="6238962">;</span>&nbsp;<span class="ident" id="6238964"><a href="/compress/bzip2/bzip2.go.html#6238947">i</a></span><span class="op" id="6238965">++</span>&nbsp;<span class="op" id="6238968">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238972">if</span>&nbsp;<span class="ident" id="6238975"><a href="/compress/bzip2/bzip2.go.html#6237488">symbolPresent</a></span><span class="op" id="6238988">[</span><span class="ident" id="6238989"><a href="/compress/bzip2/bzip2.go.html#6238947">i</a></span><span class="op" id="6238990">]</span>&nbsp;<span class="op" id="6238992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238997"><a href="/compress/bzip2/bzip2.go.html#6238889">symbols</a></span><span class="op" id="6239004">[</span><span class="ident" id="6239005"><a href="/compress/bzip2/bzip2.go.html#6238926">nextSymbol</a></span><span class="op" id="6239015">]</span>&nbsp;<span class="op" id="6239017">=</span>&nbsp;<span class="builtintype" id="6239019">byte</span><span class="op" id="6239023">(</span><span class="ident" id="6239024"><a href="/compress/bzip2/bzip2.go.html#6238947">i</a></span><span class="op" id="6239025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239030"><a href="/compress/bzip2/bzip2.go.html#6238926">nextSymbol</a></span><span class="op" id="6239040">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239048">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239051">mtf</span>&nbsp;<span class="op" id="6239055">:=</span>&nbsp;<span class="ident" id="6239058"><a href="/compress/bzip2/move_to_front.go.html#6252438">newMTFDecoder</a></span><span class="op" id="6239071">(</span><span class="ident" id="6239072"><a href="/compress/bzip2/bzip2.go.html#6238889">symbols</a></span><span class="op" id="6239079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239083"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span>&nbsp;<span class="op" id="6239094">+=</span>&nbsp;<span class="num" id="6239097">2</span>&nbsp;<span class="comment" id="6239099">//&nbsp;to&nbsp;account&nbsp;for&nbsp;RUNA&nbsp;and&nbsp;RUNB&nbsp;symbols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239140">huffmanTrees</span>&nbsp;<span class="op" id="6239153">:=</span>&nbsp;<span class="builtinfunc" id="6239156">make</span><span class="op" id="6239160">(</span><span class="op" id="6239161">[</span><span class="op" id="6239162">]</span><span class="ident" id="6239163"><a href="/compress/bzip2/huffman.go.html#6244627">huffmanTree</a></span><span class="op" id="6239174">,</span>&nbsp;<span class="ident" id="6239176"><a href="/compress/bzip2/bzip2.go.html#6238014">numHuffmanTrees</a></span><span class="op" id="6239191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239195">//&nbsp;Now&nbsp;we&nbsp;decode&nbsp;the&nbsp;arrays&nbsp;of&nbsp;code-lengths&nbsp;for&nbsp;each&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239255">lengths</span>&nbsp;<span class="op" id="6239263">:=</span>&nbsp;<span class="builtinfunc" id="6239266">make</span><span class="op" id="6239270">(</span><span class="op" id="6239271">[</span><span class="op" id="6239272">]</span><span class="builtintype" id="6239273">uint8</span><span class="op" id="6239278">,</span>&nbsp;<span class="ident" id="6239280"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span><span class="op" id="6239290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239293">for</span>&nbsp;<span class="ident" id="6239297">i</span>&nbsp;<span class="op" id="6239299">:=</span>&nbsp;<span class="keyword" id="6239302">range</span>&nbsp;<span class="ident" id="6239308"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span>&nbsp;<span class="op" id="6239321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239325">//&nbsp;The&nbsp;code&nbsp;lengths&nbsp;are&nbsp;delta&nbsp;encoded&nbsp;from&nbsp;a&nbsp;5-bit&nbsp;base&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239390">length</span>&nbsp;<span class="op" id="6239397">:=</span>&nbsp;<span class="ident" id="6239400"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6239402">.</span><span class="ident" id="6239403">ReadBits</span><span class="op" id="6239411">(</span><span class="num" id="6239412">5</span><span class="op" id="6239413">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239417">for</span>&nbsp;<span class="ident" id="6239421">j</span>&nbsp;<span class="op" id="6239423">:=</span>&nbsp;<span class="keyword" id="6239426">range</span>&nbsp;<span class="ident" id="6239432"><a href="/compress/bzip2/bzip2.go.html#6239255">lengths</a></span>&nbsp;<span class="op" id="6239440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239445">for</span>&nbsp;<span class="op" id="6239449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239455">if</span>&nbsp;<span class="op" id="6239458">!</span><span class="ident" id="6239459"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6239461">.</span><span class="ident" id="6239462">ReadBit</span><span class="op" id="6239469">(</span><span class="op" id="6239470">)</span>&nbsp;<span class="op" id="6239472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239479">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239489">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239495">if</span>&nbsp;<span class="ident" id="6239498"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6239500">.</span><span class="ident" id="6239501">ReadBit</span><span class="op" id="6239508">(</span><span class="op" id="6239509">)</span>&nbsp;<span class="op" id="6239511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239518"><a href="/compress/bzip2/bzip2.go.html#6239390">length</a></span><span class="op" id="6239524">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239531">}</span>&nbsp;<span class="keyword" id="6239533">else</span>&nbsp;<span class="op" id="6239538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239545"><a href="/compress/bzip2/bzip2.go.html#6239390">length</a></span><span class="op" id="6239551">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239558">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239568">if</span>&nbsp;<span class="ident" id="6239571"><a href="/compress/bzip2/bzip2.go.html#6239390">length</a></span>&nbsp;<span class="op" id="6239578">&lt;</span>&nbsp;<span class="num" id="6239580">0</span>&nbsp;<span class="op" id="6239582">||</span>&nbsp;<span class="ident" id="6239585"><a href="/compress/bzip2/bzip2.go.html#6239390">length</a></span>&nbsp;<span class="op" id="6239592">&gt;</span>&nbsp;<span class="num" id="6239594">20</span>&nbsp;<span class="op" id="6239597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239603">return</span>&nbsp;<span class="ident" id="6239610"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6239625">(</span><span class="string" id="6239626">&#34;Huffman&nbsp;length&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6239655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239665"><a href="/compress/bzip2/bzip2.go.html#6239255">lengths</a></span><span class="op" id="6239672">[</span><span class="ident" id="6239673"><a href="/compress/bzip2/bzip2.go.html#6239421">j</a></span><span class="op" id="6239674">]</span>&nbsp;<span class="op" id="6239676">=</span>&nbsp;<span class="builtintype" id="6239678">uint8</span><span class="op" id="6239683">(</span><span class="ident" id="6239684"><a href="/compress/bzip2/bzip2.go.html#6239390">length</a></span><span class="op" id="6239690">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239698"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span><span class="op" id="6239710">[</span><span class="ident" id="6239711"><a href="/compress/bzip2/bzip2.go.html#6239297">i</a></span><span class="op" id="6239712">]</span><span class="op" id="6239713">,</span>&nbsp;<span class="ident" id="6239715"><a href="/compress/bzip2/bzip2.go.html#6236907">err</a></span>&nbsp;<span class="op" id="6239719">=</span>&nbsp;<span class="ident" id="6239721"><a href="/compress/bzip2/huffman.go.html#6246269">newHuffmanTree</a></span><span class="op" id="6239735">(</span><span class="ident" id="6239736"><a href="/compress/bzip2/bzip2.go.html#6239255">lengths</a></span><span class="op" id="6239743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239747">if</span>&nbsp;<span class="ident" id="6239750"><a href="/compress/bzip2/bzip2.go.html#6236907">err</a></span>&nbsp;<span class="op" id="6239754">!=</span>&nbsp;<span class="ident" id="6239757">nil</span>&nbsp;<span class="op" id="6239761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239766">return</span>&nbsp;<span class="ident" id="6239773"><a href="/compress/bzip2/bzip2.go.html#6236907">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239779">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239786">selectorIndex</span>&nbsp;<span class="op" id="6239800">:=</span>&nbsp;<span class="num" id="6239803">1</span>&nbsp;<span class="comment" id="6239805">//&nbsp;the&nbsp;next&nbsp;tree&nbsp;index&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239836">if</span>&nbsp;<span class="builtinfunc" id="6239839">len</span><span class="op" id="6239842">(</span><span class="ident" id="6239843"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6239854">)</span>&nbsp;<span class="op" id="6239856">==</span>&nbsp;<span class="num" id="6239859">0</span>&nbsp;<span class="op" id="6239861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239865">return</span>&nbsp;<span class="ident" id="6239872"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6239887">(</span><span class="string" id="6239888">&#34;no&nbsp;tree&nbsp;selectors&nbsp;given&#34;</span><span class="op" id="6239913">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239919">if</span>&nbsp;<span class="builtintype" id="6239922">int</span><span class="op" id="6239925">(</span><span class="ident" id="6239926"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6239937">[</span><span class="num" id="6239938">0</span><span class="op" id="6239939">]</span><span class="op" id="6239940">)</span>&nbsp;<span class="op" id="6239942">&gt;=</span>&nbsp;<span class="builtinfunc" id="6239945">len</span><span class="op" id="6239948">(</span><span class="ident" id="6239949"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span><span class="op" id="6239961">)</span>&nbsp;<span class="op" id="6239963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239967">return</span>&nbsp;<span class="ident" id="6239974"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6239989">(</span><span class="string" id="6239990">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6240018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240024">currentHuffmanTree</span>&nbsp;<span class="op" id="6240043">:=</span>&nbsp;<span class="ident" id="6240046"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span><span class="op" id="6240058">[</span><span class="ident" id="6240059"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6240070">[</span><span class="num" id="6240071">0</span><span class="op" id="6240072">]</span><span class="op" id="6240073">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240076">bufIndex</span>&nbsp;<span class="op" id="6240085">:=</span>&nbsp;<span class="num" id="6240088">0</span>&nbsp;<span class="comment" id="6240090">//&nbsp;indexes&nbsp;bz2.buf,&nbsp;the&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240130">//&nbsp;The&nbsp;output&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;run-length&nbsp;encoded&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240202">//&nbsp;we&nbsp;merge&nbsp;the&nbsp;decoding&nbsp;into&nbsp;the&nbsp;Huffman&nbsp;parsing&nbsp;loop.&nbsp;These&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240269">//&nbsp;variables&nbsp;accumulate&nbsp;the&nbsp;repeat&nbsp;count.&nbsp;See&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240339">//&nbsp;details.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240352">repeat</span>&nbsp;<span class="op" id="6240359">:=</span>&nbsp;<span class="num" id="6240362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240365">repeat_power</span>&nbsp;<span class="op" id="6240378">:=</span>&nbsp;<span class="num" id="6240381">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240385">//&nbsp;The&nbsp;`C&#39;&nbsp;array&nbsp;(used&nbsp;by&nbsp;the&nbsp;inverse&nbsp;BWT)&nbsp;needs&nbsp;to&nbsp;be&nbsp;zero&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240459">for</span>&nbsp;<span class="ident" id="6240463">i</span>&nbsp;<span class="op" id="6240465">:=</span>&nbsp;<span class="keyword" id="6240468">range</span>&nbsp;<span class="ident" id="6240474"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6240477">.</span><span class="ident" id="6240478">c</span>&nbsp;<span class="op" id="6240480">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240484"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6240487">.</span><span class="ident" id="6240488">c</span><span class="op" id="6240489">[</span><span class="ident" id="6240490"><a href="/compress/bzip2/bzip2.go.html#6240463">i</a></span><span class="op" id="6240491">]</span>&nbsp;<span class="op" id="6240493">=</span>&nbsp;<span class="num" id="6240495">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240502">decoded</span>&nbsp;<span class="op" id="6240510">:=</span>&nbsp;<span class="num" id="6240513">0</span>&nbsp;<span class="comment" id="6240515">//&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;symbols&nbsp;decoded&nbsp;by&nbsp;the&nbsp;current&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240577">for</span>&nbsp;<span class="op" id="6240581">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240585">if</span>&nbsp;<span class="ident" id="6240588"><a href="/compress/bzip2/bzip2.go.html#6240502">decoded</a></span>&nbsp;<span class="op" id="6240596">==</span>&nbsp;<span class="num" id="6240599">50</span>&nbsp;<span class="op" id="6240602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240607">if</span>&nbsp;<span class="ident" id="6240610"><a href="/compress/bzip2/bzip2.go.html#6239786">selectorIndex</a></span>&nbsp;<span class="op" id="6240624">&gt;=</span>&nbsp;<span class="ident" id="6240627"><a href="/compress/bzip2/bzip2.go.html#6238304">numSelectors</a></span>&nbsp;<span class="op" id="6240640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240646">return</span>&nbsp;<span class="ident" id="6240653"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6240668">(</span><span class="string" id="6240669">&#34;insufficient&nbsp;selector&nbsp;indices&nbsp;for&nbsp;number&nbsp;of&nbsp;symbols&#34;</span><span class="op" id="6240722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240732">if</span>&nbsp;<span class="builtintype" id="6240735">int</span><span class="op" id="6240738">(</span><span class="ident" id="6240739"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6240750">[</span><span class="ident" id="6240751"><a href="/compress/bzip2/bzip2.go.html#6239786">selectorIndex</a></span><span class="op" id="6240764">]</span><span class="op" id="6240765">)</span>&nbsp;<span class="op" id="6240767">&gt;=</span>&nbsp;<span class="builtinfunc" id="6240770">len</span><span class="op" id="6240773">(</span><span class="ident" id="6240774"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span><span class="op" id="6240786">)</span>&nbsp;<span class="op" id="6240788">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240794">return</span>&nbsp;<span class="ident" id="6240801"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6240816">(</span><span class="string" id="6240817">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6240845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240855"><a href="/compress/bzip2/bzip2.go.html#6240024">currentHuffmanTree</a></span>&nbsp;<span class="op" id="6240874">=</span>&nbsp;<span class="ident" id="6240876"><a href="/compress/bzip2/bzip2.go.html#6239140">huffmanTrees</a></span><span class="op" id="6240888">[</span><span class="ident" id="6240889"><a href="/compress/bzip2/bzip2.go.html#6238337">treeIndexes</a></span><span class="op" id="6240900">[</span><span class="ident" id="6240901"><a href="/compress/bzip2/bzip2.go.html#6239786">selectorIndex</a></span><span class="op" id="6240914">]</span><span class="op" id="6240915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240920"><a href="/compress/bzip2/bzip2.go.html#6239786">selectorIndex</a></span><span class="op" id="6240933">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240939"><a href="/compress/bzip2/bzip2.go.html#6240502">decoded</a></span>&nbsp;<span class="op" id="6240947">=</span>&nbsp;<span class="num" id="6240949">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240958">v</span>&nbsp;<span class="op" id="6240960">:=</span>&nbsp;<span class="ident" id="6240963"><a href="/compress/bzip2/bzip2.go.html#6240024">currentHuffmanTree</a></span><span class="op" id="6240981">.</span><span class="ident" id="6240982">Decode</span><span class="op" id="6240988">(</span><span class="ident" id="6240989"><a href="/compress/bzip2/bzip2.go.html#6236921">br</a></span><span class="op" id="6240991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240995"><a href="/compress/bzip2/bzip2.go.html#6240502">decoded</a></span><span class="op" id="6241002">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241008">if</span>&nbsp;<span class="ident" id="6241011"><a href="/compress/bzip2/bzip2.go.html#6240958">v</a></span>&nbsp;<span class="op" id="6241013">&lt;</span>&nbsp;<span class="num" id="6241015">2</span>&nbsp;<span class="op" id="6241017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241022">//&nbsp;This&nbsp;is&nbsp;either&nbsp;the&nbsp;RUNA&nbsp;or&nbsp;RUNB&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241068">if</span>&nbsp;<span class="ident" id="6241071"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241078">==</span>&nbsp;<span class="num" id="6241081">0</span>&nbsp;<span class="op" id="6241083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241089"><a href="/compress/bzip2/bzip2.go.html#6240365">repeat_power</a></span>&nbsp;<span class="op" id="6241102">=</span>&nbsp;<span class="num" id="6241104">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241109">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241114"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241121">+=</span>&nbsp;<span class="ident" id="6241124"><a href="/compress/bzip2/bzip2.go.html#6240365">repeat_power</a></span>&nbsp;<span class="op" id="6241137">&lt;&lt;</span>&nbsp;<span class="ident" id="6241140"><a href="/compress/bzip2/bzip2.go.html#6240958">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241145"><a href="/compress/bzip2/bzip2.go.html#6240365">repeat_power</a></span>&nbsp;<span class="op" id="6241158">&lt;&lt;=</span>&nbsp;<span class="num" id="6241162">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241168">//&nbsp;This&nbsp;limit&nbsp;of&nbsp;2&nbsp;million&nbsp;comes&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241226">//&nbsp;code.&nbsp;It&nbsp;prevents&nbsp;repeat&nbsp;from&nbsp;overflowing.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241275">if</span>&nbsp;<span class="ident" id="6241278"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241285">&gt;</span>&nbsp;<span class="num" id="6241287">2</span><span class="op" id="6241288">*</span><span class="num" id="6241289">1024</span><span class="op" id="6241293">*</span><span class="num" id="6241294">1024</span>&nbsp;<span class="op" id="6241299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241305">return</span>&nbsp;<span class="ident" id="6241312"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6241327">(</span><span class="string" id="6241328">&#34;repeat&nbsp;count&nbsp;too&nbsp;large&#34;</span><span class="op" id="6241352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241362">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241373">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241378">if</span>&nbsp;<span class="ident" id="6241381"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241388">&gt;</span>&nbsp;<span class="num" id="6241390">0</span>&nbsp;<span class="op" id="6241392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241397">//&nbsp;We&nbsp;have&nbsp;decoded&nbsp;a&nbsp;complete&nbsp;run-length&nbsp;so&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241455">//&nbsp;replicate&nbsp;the&nbsp;last&nbsp;output&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241495">if</span>&nbsp;<span class="ident" id="6241498"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241505">&gt;</span>&nbsp;<span class="ident" id="6241507"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6241510">.</span><span class="ident" id="6241511">blockSize</span><span class="op" id="6241520">-</span><span class="ident" id="6241521"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span>&nbsp;<span class="op" id="6241530">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241536">return</span>&nbsp;<span class="ident" id="6241543"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6241558">(</span><span class="string" id="6241559">&#34;repeats&nbsp;past&nbsp;end&nbsp;of&nbsp;block&#34;</span><span class="op" id="6241586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241596">for</span>&nbsp;<span class="ident" id="6241600">i</span>&nbsp;<span class="op" id="6241602">:=</span>&nbsp;<span class="num" id="6241605">0</span><span class="op" id="6241606">;</span>&nbsp;<span class="ident" id="6241608"><a href="/compress/bzip2/bzip2.go.html#6241600">i</a></span>&nbsp;<span class="op" id="6241610">&lt;</span>&nbsp;<span class="ident" id="6241612"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span><span class="op" id="6241618">;</span>&nbsp;<span class="ident" id="6241620"><a href="/compress/bzip2/bzip2.go.html#6241600">i</a></span><span class="op" id="6241621">++</span>&nbsp;<span class="op" id="6241624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241630">b</span>&nbsp;<span class="op" id="6241632">:=</span>&nbsp;<span class="builtintype" id="6241635">byte</span><span class="op" id="6241639">(</span><span class="ident" id="6241640"><a href="/compress/bzip2/bzip2.go.html#6239051">mtf</a></span><span class="op" id="6241643">.</span><span class="ident" id="6241644">First</span><span class="op" id="6241649">(</span><span class="op" id="6241650">)</span><span class="op" id="6241651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241657"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6241660">.</span><span class="ident" id="6241661">tt</span><span class="op" id="6241663">[</span><span class="ident" id="6241664"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6241672">]</span>&nbsp;<span class="op" id="6241674">=</span>&nbsp;<span class="builtintype" id="6241676">uint32</span><span class="op" id="6241682">(</span><span class="ident" id="6241683"><a href="/compress/bzip2/bzip2.go.html#6241630">b</a></span><span class="op" id="6241684">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241690"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6241693">.</span><span class="ident" id="6241694">c</span><span class="op" id="6241695">[</span><span class="ident" id="6241696"><a href="/compress/bzip2/bzip2.go.html#6241630">b</a></span><span class="op" id="6241697">]</span><span class="op" id="6241698">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241705"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6241713">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241724"><a href="/compress/bzip2/bzip2.go.html#6240352">repeat</a></span>&nbsp;<span class="op" id="6241731">=</span>&nbsp;<span class="num" id="6241733">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241737">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241742">if</span>&nbsp;<span class="builtintype" id="6241745">int</span><span class="op" id="6241748">(</span><span class="ident" id="6241749"><a href="/compress/bzip2/bzip2.go.html#6240958">v</a></span><span class="op" id="6241750">)</span>&nbsp;<span class="op" id="6241752">==</span>&nbsp;<span class="ident" id="6241755"><a href="/compress/bzip2/bzip2.go.html#6237524">numSymbols</a></span><span class="op" id="6241765">-</span><span class="num" id="6241766">1</span>&nbsp;<span class="op" id="6241768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241773">//&nbsp;This&nbsp;is&nbsp;the&nbsp;EOF&nbsp;symbol.&nbsp;Because&nbsp;it&#39;s&nbsp;always&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241830">//&nbsp;end&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;list,&nbsp;and&nbsp;never&nbsp;gets&nbsp;moved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241888">//&nbsp;to&nbsp;the&nbsp;front,&nbsp;it&nbsp;has&nbsp;this&nbsp;unique&nbsp;value.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241934">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6241947">//&nbsp;Since&nbsp;two&nbsp;metasymbols&nbsp;(RUNA&nbsp;and&nbsp;RUNB)&nbsp;have&nbsp;values&nbsp;0&nbsp;and&nbsp;1,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242011">//&nbsp;one&nbsp;would&nbsp;expect&nbsp;|v-2|&nbsp;to&nbsp;be&nbsp;passed&nbsp;to&nbsp;the&nbsp;MTF&nbsp;decoder.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242072">//&nbsp;However,&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;MTF&nbsp;list&nbsp;is&nbsp;never&nbsp;referenced&nbsp;as&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242138">//&nbsp;it&#39;s&nbsp;always&nbsp;referenced&nbsp;with&nbsp;a&nbsp;run-length&nbsp;of&nbsp;1.&nbsp;Thus&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242197">//&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;encoded&nbsp;and&nbsp;we&nbsp;have&nbsp;|v-1|&nbsp;in&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242259">//&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242270">b</span>&nbsp;<span class="op" id="6242272">:=</span>&nbsp;<span class="builtintype" id="6242275">byte</span><span class="op" id="6242279">(</span><span class="ident" id="6242280"><a href="/compress/bzip2/bzip2.go.html#6239051">mtf</a></span><span class="op" id="6242283">.</span><span class="ident" id="6242284">Decode</span><span class="op" id="6242290">(</span><span class="builtintype" id="6242291">int</span><span class="op" id="6242294">(</span><span class="ident" id="6242295"><a href="/compress/bzip2/bzip2.go.html#6240958">v</a></span>&nbsp;<span class="op" id="6242297">-</span>&nbsp;<span class="num" id="6242299">1</span><span class="op" id="6242300">)</span><span class="op" id="6242301">)</span><span class="op" id="6242302">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242306">if</span>&nbsp;<span class="ident" id="6242309"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span>&nbsp;<span class="op" id="6242318">&gt;=</span>&nbsp;<span class="ident" id="6242321"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242324">.</span><span class="ident" id="6242325">blockSize</span>&nbsp;<span class="op" id="6242335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242340">return</span>&nbsp;<span class="ident" id="6242347"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6242362">(</span><span class="string" id="6242363">&#34;data&nbsp;exceeds&nbsp;block&nbsp;size&#34;</span><span class="op" id="6242388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242396"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242399">.</span><span class="ident" id="6242400">tt</span><span class="op" id="6242402">[</span><span class="ident" id="6242403"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6242411">]</span>&nbsp;<span class="op" id="6242413">=</span>&nbsp;<span class="builtintype" id="6242415">uint32</span><span class="op" id="6242421">(</span><span class="ident" id="6242422"><a href="/compress/bzip2/bzip2.go.html#6242270">b</a></span><span class="op" id="6242423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242427"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242430">.</span><span class="ident" id="6242431">c</span><span class="op" id="6242432">[</span><span class="ident" id="6242433"><a href="/compress/bzip2/bzip2.go.html#6242270">b</a></span><span class="op" id="6242434">]</span><span class="op" id="6242435">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242440"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6242448">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242456">if</span>&nbsp;<span class="ident" id="6242459"><a href="/compress/bzip2/bzip2.go.html#6237246">origPtr</a></span>&nbsp;<span class="op" id="6242467">&gt;=</span>&nbsp;<span class="builtintype" id="6242470">uint</span><span class="op" id="6242474">(</span><span class="ident" id="6242475"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6242483">)</span>&nbsp;<span class="op" id="6242485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242489">return</span>&nbsp;<span class="ident" id="6242496"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6242511">(</span><span class="string" id="6242512">&#34;origPtr&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="6242535">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6242538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242542">//&nbsp;We&nbsp;have&nbsp;completed&nbsp;the&nbsp;entropy&nbsp;decoding.&nbsp;Now&nbsp;we&nbsp;can&nbsp;perform&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6242609">//&nbsp;inverse&nbsp;BWT&nbsp;and&nbsp;setup&nbsp;the&nbsp;RLE&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242651"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242654">.</span><span class="ident" id="6242655">preRLE</span>&nbsp;<span class="op" id="6242662">=</span>&nbsp;<span class="ident" id="6242664"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242667">.</span><span class="ident" id="6242668">tt</span><span class="op" id="6242670">[</span><span class="op" id="6242671">:</span><span class="ident" id="6242672"><a href="/compress/bzip2/bzip2.go.html#6240076">bufIndex</a></span><span class="op" id="6242680">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242683"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242686">.</span><span class="ident" id="6242687">preRLEUsed</span>&nbsp;<span class="op" id="6242698">=</span>&nbsp;<span class="num" id="6242700">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242703"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242706">.</span><span class="ident" id="6242707">tPos</span>&nbsp;<span class="op" id="6242712">=</span>&nbsp;<span class="ident" id="6242714"><a href="/compress/bzip2/bzip2.go.html#6243429">inverseBWT</a></span><span class="op" id="6242724">(</span><span class="ident" id="6242725"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242728">.</span><span class="ident" id="6242729">preRLE</span><span class="op" id="6242735">,</span>&nbsp;<span class="ident" id="6242737"><a href="/compress/bzip2/bzip2.go.html#6237246">origPtr</a></span><span class="op" id="6242744">,</span>&nbsp;<span class="ident" id="6242746"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242749">.</span><span class="ident" id="6242750">c</span><span class="op" id="6242751">[</span><span class="op" id="6242752">:</span><span class="op" id="6242753">]</span><span class="op" id="6242754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242757"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242760">.</span><span class="ident" id="6242761">lastByte</span>&nbsp;<span class="op" id="6242770">=</span>&nbsp;<span class="op" id="6242772">-</span><span class="num" id="6242773">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242776"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242779">.</span><span class="ident" id="6242780">byteRepeats</span>&nbsp;<span class="op" id="6242792">=</span>&nbsp;<span class="num" id="6242794">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6242797"><a href="/compress/bzip2/bzip2.go.html#6236881">bz2</a></span><span class="op" id="6242800">.</span><span class="ident" id="6242801">repeats</span>&nbsp;<span class="op" id="6242809">=</span>&nbsp;<span class="num" id="6242811">0</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6242815">return</span>&nbsp;<span class="ident" id="6242822">nil</span><br>
<span class="lineno"></span><span class="op" id="6242826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6242829">//&nbsp;inverseBWT&nbsp;implements&nbsp;the&nbsp;inverse&nbsp;Burrows-Wheeler&nbsp;transform&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno">450</span><span class="comment" id="6242908">//&nbsp;http://www.hpl.hp.com/techreports/Compaq-DEC/SRC-RR-124.pdf,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno"></span><span class="comment" id="6242985">//&nbsp;In&nbsp;that&nbsp;document,&nbsp;origPtr&nbsp;is&nbsp;called&nbsp;`I&#39;&nbsp;and&nbsp;c&nbsp;is&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6243061">//&nbsp;first&nbsp;pass&nbsp;over&nbsp;the&nbsp;data.&nbsp;It&#39;s&nbsp;an&nbsp;argument&nbsp;here&nbsp;because&nbsp;we&nbsp;merge&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6243139">//&nbsp;pass&nbsp;with&nbsp;the&nbsp;Huffman&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="comment" id="6243174">//</span><br>
<span class="lineno">455</span><span class="comment" id="6243177">//&nbsp;This&nbsp;also&nbsp;implements&nbsp;the&nbsp;`single&nbsp;array&#39;&nbsp;method&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6243254">//&nbsp;which&nbsp;leaves&nbsp;the&nbsp;output,&nbsp;still&nbsp;shuffled,&nbsp;in&nbsp;the&nbsp;bottom&nbsp;8&nbsp;bits&nbsp;of&nbsp;tt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6243334">//&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;top&nbsp;24-bits.&nbsp;The&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;byte&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6243411">//&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="6243424">func</span>&nbsp;<span class="ident" id="6243429">inverseBWT</span><span class="op" id="6243439">(</span><span class="ident" id="6243440">tt</span>&nbsp;<span class="op" id="6243443">[</span><span class="op" id="6243444">]</span><span class="builtintype" id="6243445">uint32</span><span class="op" id="6243451">,</span>&nbsp;<span class="ident" id="6243453">origPtr</span>&nbsp;<span class="builtintype" id="6243461">uint</span><span class="op" id="6243465">,</span>&nbsp;<span class="ident" id="6243467">c</span>&nbsp;<span class="op" id="6243469">[</span><span class="op" id="6243470">]</span><span class="builtintype" id="6243471">uint</span><span class="op" id="6243475">)</span>&nbsp;<span class="builtintype" id="6243477">uint32</span>&nbsp;<span class="op" id="6243484">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243487">sum</span>&nbsp;<span class="op" id="6243491">:=</span>&nbsp;<span class="builtintype" id="6243494">uint</span><span class="op" id="6243498">(</span><span class="num" id="6243499">0</span><span class="op" id="6243500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243503">for</span>&nbsp;<span class="ident" id="6243507">i</span>&nbsp;<span class="op" id="6243509">:=</span>&nbsp;<span class="num" id="6243512">0</span><span class="op" id="6243513">;</span>&nbsp;<span class="ident" id="6243515"><a href="/compress/bzip2/bzip2.go.html#6243507">i</a></span>&nbsp;<span class="op" id="6243517">&lt;</span>&nbsp;<span class="num" id="6243519">256</span><span class="op" id="6243522">;</span>&nbsp;<span class="ident" id="6243524"><a href="/compress/bzip2/bzip2.go.html#6243507">i</a></span><span class="op" id="6243525">++</span>&nbsp;<span class="op" id="6243528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243532"><a href="/compress/bzip2/bzip2.go.html#6243487">sum</a></span>&nbsp;<span class="op" id="6243536">+=</span>&nbsp;<span class="ident" id="6243539"><a href="/compress/bzip2/bzip2.go.html#6243467">c</a></span><span class="op" id="6243540">[</span><span class="ident" id="6243541"><a href="/compress/bzip2/bzip2.go.html#6243507">i</a></span><span class="op" id="6243542">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243546"><a href="/compress/bzip2/bzip2.go.html#6243467">c</a></span><span class="op" id="6243547">[</span><span class="ident" id="6243548"><a href="/compress/bzip2/bzip2.go.html#6243507">i</a></span><span class="op" id="6243549">]</span>&nbsp;<span class="op" id="6243551">=</span>&nbsp;<span class="ident" id="6243553"><a href="/compress/bzip2/bzip2.go.html#6243487">sum</a></span>&nbsp;<span class="op" id="6243557">-</span>&nbsp;<span class="ident" id="6243559"><a href="/compress/bzip2/bzip2.go.html#6243467">c</a></span><span class="op" id="6243560">[</span><span class="ident" id="6243561"><a href="/compress/bzip2/bzip2.go.html#6243507">i</a></span><span class="op" id="6243562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243565">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243569">for</span>&nbsp;<span class="ident" id="6243573">i</span>&nbsp;<span class="op" id="6243575">:=</span>&nbsp;<span class="keyword" id="6243578">range</span>&nbsp;<span class="ident" id="6243584"><a href="/compress/bzip2/bzip2.go.html#6243440">tt</a></span>&nbsp;<span class="op" id="6243587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243591">b</span>&nbsp;<span class="op" id="6243593">:=</span>&nbsp;<span class="ident" id="6243596"><a href="/compress/bzip2/bzip2.go.html#6243440">tt</a></span><span class="op" id="6243598">[</span><span class="ident" id="6243599"><a href="/compress/bzip2/bzip2.go.html#6243573">i</a></span><span class="op" id="6243600">]</span>&nbsp;<span class="op" id="6243602">&amp;</span>&nbsp;<span class="num" id="6243604">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243611"><a href="/compress/bzip2/bzip2.go.html#6243440">tt</a></span><span class="op" id="6243613">[</span><span class="ident" id="6243614"><a href="/compress/bzip2/bzip2.go.html#6243467">c</a></span><span class="op" id="6243615">[</span><span class="ident" id="6243616"><a href="/compress/bzip2/bzip2.go.html#6243591">b</a></span><span class="op" id="6243617">]</span><span class="op" id="6243618">]</span>&nbsp;<span class="op" id="6243620">|=</span>&nbsp;<span class="builtintype" id="6243623">uint32</span><span class="op" id="6243629">(</span><span class="ident" id="6243630"><a href="/compress/bzip2/bzip2.go.html#6243573">i</a></span><span class="op" id="6243631">)</span>&nbsp;<span class="op" id="6243633">&lt;&lt;</span>&nbsp;<span class="num" id="6243636">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243640"><a href="/compress/bzip2/bzip2.go.html#6243467">c</a></span><span class="op" id="6243641">[</span><span class="ident" id="6243642"><a href="/compress/bzip2/bzip2.go.html#6243591">b</a></span><span class="op" id="6243643">]</span><span class="op" id="6243644">++</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6243648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243652">return</span>&nbsp;<span class="ident" id="6243659"><a href="/compress/bzip2/bzip2.go.html#6243440">tt</a></span><span class="op" id="6243661">[</span><span class="ident" id="6243662"><a href="/compress/bzip2/bzip2.go.html#6243453">origPtr</a></span><span class="op" id="6243669">]</span>&nbsp;<span class="op" id="6243671">&gt;&gt;</span>&nbsp;<span class="num" id="6243674">8</span><br>
<span class="lineno"></span><span class="op" id="6243676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="comment" id="6243679">//&nbsp;This&nbsp;is&nbsp;a&nbsp;standard&nbsp;CRC32&nbsp;like&nbsp;in&nbsp;hash/crc32&nbsp;except&nbsp;that&nbsp;all&nbsp;the&nbsp;shifts&nbsp;are&nbsp;reversed,</span><br>
<span class="lineno"></span><span class="comment" id="6243767">//&nbsp;causing&nbsp;the&nbsp;bits&nbsp;in&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;processed&nbsp;in&nbsp;the&nbsp;reverse&nbsp;of&nbsp;the&nbsp;usual&nbsp;order.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6243852">var</span>&nbsp;<span class="ident" id="6243856">crctab</span>&nbsp;<span class="op" id="6243863">[</span><span class="num" id="6243864">256</span><span class="op" id="6243867">]</span><span class="builtintype" id="6243868">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6243876">func</span>&nbsp;<span class="ident" id="6243881">init</span><span class="op" id="6243885">(</span><span class="op" id="6243886">)</span>&nbsp;<span class="op" id="6243888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243891">const</span>&nbsp;<span class="ident" id="6243897">poly</span>&nbsp;<span class="op" id="6243902">=</span>&nbsp;<span class="num" id="6243904">0x04C11DB7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243916">for</span>&nbsp;<span class="ident" id="6243920">i</span>&nbsp;<span class="op" id="6243922">:=</span>&nbsp;<span class="keyword" id="6243925">range</span>&nbsp;<span class="ident" id="6243931"><a href="/compress/bzip2/bzip2.go.html#6243856">crctab</a></span>&nbsp;<span class="op" id="6243938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6243942">crc</span>&nbsp;<span class="op" id="6243946">:=</span>&nbsp;<span class="builtintype" id="6243949">uint32</span><span class="op" id="6243955">(</span><span class="ident" id="6243956"><a href="/compress/bzip2/bzip2.go.html#6243920">i</a></span><span class="op" id="6243957">)</span>&nbsp;<span class="op" id="6243959">&lt;&lt;</span>&nbsp;<span class="num" id="6243962">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243967">for</span>&nbsp;<span class="ident" id="6243971">j</span>&nbsp;<span class="op" id="6243973">:=</span>&nbsp;<span class="num" id="6243976">0</span><span class="op" id="6243977">;</span>&nbsp;<span class="ident" id="6243979"><a href="/compress/bzip2/bzip2.go.html#6243971">j</a></span>&nbsp;<span class="op" id="6243981">&lt;</span>&nbsp;<span class="num" id="6243983">8</span><span class="op" id="6243984">;</span>&nbsp;<span class="ident" id="6243986"><a href="/compress/bzip2/bzip2.go.html#6243971">j</a></span><span class="op" id="6243987">++</span>&nbsp;<span class="op" id="6243990">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6243995">if</span>&nbsp;<span class="ident" id="6243998"><a href="/compress/bzip2/bzip2.go.html#6243942">crc</a></span><span class="op" id="6244001">&amp;</span><span class="num" id="6244002">0x80000000</span>&nbsp;<span class="op" id="6244013">!=</span>&nbsp;<span class="num" id="6244016">0</span>&nbsp;<span class="op" id="6244018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244024"><a href="/compress/bzip2/bzip2.go.html#6243942">crc</a></span>&nbsp;<span class="op" id="6244028">=</span>&nbsp;<span class="op" id="6244030">(</span><span class="ident" id="6244031"><a href="/compress/bzip2/bzip2.go.html#6243942">crc</a></span>&nbsp;<span class="op" id="6244035">&lt;&lt;</span>&nbsp;<span class="num" id="6244038">1</span><span class="op" id="6244039">)</span>&nbsp;<span class="op" id="6244041">^</span>&nbsp;<span class="ident" id="6244043"><a href="/compress/bzip2/bzip2.go.html#6243897">poly</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6244051">}</span>&nbsp;<span class="keyword" id="6244053">else</span>&nbsp;<span class="op" id="6244058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244064"><a href="/compress/bzip2/bzip2.go.html#6243942">crc</a></span>&nbsp;<span class="op" id="6244068">&lt;&lt;=</span>&nbsp;<span class="num" id="6244072">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6244077">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6244081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244085"><a href="/compress/bzip2/bzip2.go.html#6243856">crctab</a></span><span class="op" id="6244091">[</span><span class="ident" id="6244092"><a href="/compress/bzip2/bzip2.go.html#6243920">i</a></span><span class="op" id="6244093">]</span>&nbsp;<span class="op" id="6244095">=</span>&nbsp;<span class="ident" id="6244097"><a href="/compress/bzip2/bzip2.go.html#6243942">crc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6244102">}</span><br>
<span class="lineno"></span><span class="op" id="6244104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="6244107">//&nbsp;updateCRC&nbsp;updates&nbsp;the&nbsp;crc&nbsp;value&nbsp;to&nbsp;incorporate&nbsp;the&nbsp;data&nbsp;in&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="6244172">//&nbsp;The&nbsp;initial&nbsp;value&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="6244199">func</span>&nbsp;<span class="ident" id="6244204">updateCRC</span><span class="op" id="6244213">(</span><span class="ident" id="6244214">val</span>&nbsp;<span class="builtintype" id="6244218">uint32</span><span class="op" id="6244224">,</span>&nbsp;<span class="ident" id="6244226">b</span>&nbsp;<span class="op" id="6244228">[</span><span class="op" id="6244229">]</span><span class="builtintype" id="6244230">byte</span><span class="op" id="6244234">)</span>&nbsp;<span class="builtintype" id="6244236">uint32</span>&nbsp;<span class="op" id="6244243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244246">crc</span>&nbsp;<span class="op" id="6244250">:=</span>&nbsp;<span class="op" id="6244253">^</span><span class="ident" id="6244254"><a href="/compress/bzip2/bzip2.go.html#6244214">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244259">for</span>&nbsp;<span class="ident" id="6244263">_</span><span class="op" id="6244264">,</span>&nbsp;<span class="ident" id="6244266">v</span>&nbsp;<span class="op" id="6244268">:=</span>&nbsp;<span class="keyword" id="6244271">range</span>&nbsp;<span class="ident" id="6244277"><a href="/compress/bzip2/bzip2.go.html#6244226">b</a></span>&nbsp;<span class="op" id="6244279">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244283"><a href="/compress/bzip2/bzip2.go.html#6244246">crc</a></span>&nbsp;<span class="op" id="6244287">=</span>&nbsp;<span class="ident" id="6244289"><a href="/compress/bzip2/bzip2.go.html#6243856">crctab</a></span><span class="op" id="6244295">[</span><span class="builtintype" id="6244296">byte</span><span class="op" id="6244300">(</span><span class="ident" id="6244301"><a href="/compress/bzip2/bzip2.go.html#6244246">crc</a></span><span class="op" id="6244304">&gt;&gt;</span><span class="num" id="6244306">24</span><span class="op" id="6244308">)</span><span class="op" id="6244309">^</span><span class="ident" id="6244310"><a href="/compress/bzip2/bzip2.go.html#6244266">v</a></span><span class="op" id="6244311">]</span>&nbsp;<span class="op" id="6244313">^</span>&nbsp;<span class="op" id="6244315">(</span><span class="ident" id="6244316"><a href="/compress/bzip2/bzip2.go.html#6244246">crc</a></span>&nbsp;<span class="op" id="6244320">&lt;&lt;</span>&nbsp;<span class="num" id="6244323">8</span><span class="op" id="6244324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6244327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6244330">return</span>&nbsp;<span class="op" id="6244337">^</span><span class="ident" id="6244338"><a href="/compress/bzip2/bzip2.go.html#6244246">crc</a></span><br>
<span class="lineno"></span><span class="op" id="6244342">}</span>
</div>
</body>
</html>
