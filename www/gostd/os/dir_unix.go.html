<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2452727">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2452782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2452836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2452887">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2452957">package</span>&nbsp;<span class="ident" id="2452965">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2452969">import</span>&nbsp;<span class="op" id="2452976">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2452979">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2452985">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2452995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2452998">const</span>&nbsp;<span class="op" id="2453004">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453007">blockSize</span>&nbsp;<span class="op" id="2453017">=</span>&nbsp;<span class="num" id="2453019">4096</span><br>
<span class="lineno"></span><span class="op" id="2453024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2453027">func</span>&nbsp;<span class="op" id="2453032">(</span><span class="ident" id="2453033">f</span>&nbsp;<span class="op" id="2453035">*</span><span class="ident" id="2453036">File</span><span class="op" id="2453040">)</span>&nbsp;<span class="ident" id="2453042">readdirnames</span><span class="op" id="2453054">(</span><span class="ident" id="2453055">n</span>&nbsp;<span class="builtintype" id="2453057">int</span><span class="op" id="2453060">)</span>&nbsp;<span class="op" id="2453062">(</span><span class="ident" id="2453063">names</span>&nbsp;<span class="op" id="2453069">[</span><span class="op" id="2453070">]</span><span class="builtintype" id="2453071">string</span><span class="op" id="2453077">,</span>&nbsp;<span class="ident" id="2453079">err</span>&nbsp;<span class="builtintype" id="2453083">error</span><span class="op" id="2453088">)</span>&nbsp;<span class="op" id="2453090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453093">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453138">if</span>&nbsp;<span class="ident" id="2453141">f</span><span class="op" id="2453142">.</span><span class="ident" id="2453143">dirinfo</span>&nbsp;<span class="op" id="2453151">==</span>&nbsp;<span class="ident" id="2453154">nil</span>&nbsp;<span class="op" id="2453158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453162">f</span><span class="op" id="2453163">.</span><span class="ident" id="2453164">dirinfo</span>&nbsp;<span class="op" id="2453172">=</span>&nbsp;<span class="builtinfunc" id="2453174">new</span><span class="op" id="2453177">(</span><span class="ident" id="2453178">dirInfo</span><span class="op" id="2453185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453189">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453236">f</span><span class="op" id="2453237">.</span><span class="ident" id="2453238">dirinfo</span><span class="op" id="2453245">.</span><span class="ident" id="2453246">buf</span>&nbsp;<span class="op" id="2453250">=</span>&nbsp;<span class="builtinfunc" id="2453252">make</span><span class="op" id="2453256">(</span><span class="op" id="2453257">[</span><span class="op" id="2453258">]</span><span class="builtintype" id="2453259">byte</span><span class="op" id="2453263">,</span>&nbsp;<span class="ident" id="2453265">blockSize</span><span class="op" id="2453274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453277">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453280">d</span>&nbsp;<span class="op" id="2453282">:=</span>&nbsp;<span class="ident" id="2453285">f</span><span class="op" id="2453286">.</span><span class="ident" id="2453287">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453297">size</span>&nbsp;<span class="op" id="2453302">:=</span>&nbsp;<span class="ident" id="2453305">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453308">if</span>&nbsp;<span class="ident" id="2453311">size</span>&nbsp;<span class="op" id="2453316">&lt;=</span>&nbsp;<span class="num" id="2453319">0</span>&nbsp;<span class="op" id="2453321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453325">size</span>&nbsp;<span class="op" id="2453330">=</span>&nbsp;<span class="num" id="2453332">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453338">n</span>&nbsp;<span class="op" id="2453340">=</span>&nbsp;<span class="op" id="2453342">-</span><span class="num" id="2453343">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453350">names</span>&nbsp;<span class="op" id="2453356">=</span>&nbsp;<span class="builtinfunc" id="2453358">make</span><span class="op" id="2453362">(</span><span class="op" id="2453363">[</span><span class="op" id="2453364">]</span><span class="builtintype" id="2453365">string</span><span class="op" id="2453371">,</span>&nbsp;<span class="num" id="2453373">0</span><span class="op" id="2453374">,</span>&nbsp;<span class="ident" id="2453376">size</span><span class="op" id="2453380">)</span>&nbsp;<span class="comment" id="2453382">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453411">for</span>&nbsp;<span class="ident" id="2453415">n</span>&nbsp;<span class="op" id="2453417">!=</span>&nbsp;<span class="num" id="2453420">0</span>&nbsp;<span class="op" id="2453422">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453426">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453462">if</span>&nbsp;<span class="ident" id="2453465">d</span><span class="op" id="2453466">.</span><span class="ident" id="2453467">bufp</span>&nbsp;<span class="op" id="2453472">&gt;=</span>&nbsp;<span class="ident" id="2453475">d</span><span class="op" id="2453476">.</span><span class="ident" id="2453477">nbuf</span>&nbsp;<span class="op" id="2453482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453487">d</span><span class="op" id="2453488">.</span><span class="ident" id="2453489">bufp</span>&nbsp;<span class="op" id="2453494">=</span>&nbsp;<span class="num" id="2453496">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453501">var</span>&nbsp;<span class="ident" id="2453505">errno</span>&nbsp;<span class="builtintype" id="2453511">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453520">d</span><span class="op" id="2453521">.</span><span class="ident" id="2453522">nbuf</span><span class="op" id="2453526">,</span>&nbsp;<span class="ident" id="2453528">errno</span>&nbsp;<span class="op" id="2453534">=</span>&nbsp;<span class="ident" id="2453536">fixCount</span><span class="op" id="2453544">(</span><span class="ident" id="2453545">syscall</span><span class="op" id="2453552">.</span><span class="ident" id="2453553">ReadDirent</span><span class="op" id="2453563">(</span><span class="ident" id="2453564">f</span><span class="op" id="2453565">.</span><span class="ident" id="2453566">fd</span><span class="op" id="2453568">,</span>&nbsp;<span class="ident" id="2453570">d</span><span class="op" id="2453571">.</span><span class="ident" id="2453572">buf</span><span class="op" id="2453575">)</span><span class="op" id="2453576">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453581">if</span>&nbsp;<span class="ident" id="2453584">errno</span>&nbsp;<span class="op" id="2453590">!=</span>&nbsp;<span class="ident" id="2453593">nil</span>&nbsp;<span class="op" id="2453597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453603">return</span>&nbsp;<span class="ident" id="2453610">names</span><span class="op" id="2453615">,</span>&nbsp;<span class="ident" id="2453617">NewSyscallError</span><span class="op" id="2453632">(</span><span class="string" id="2453633">&#34;readdirent&#34;</span><span class="op" id="2453645">,</span>&nbsp;<span class="ident" id="2453647">errno</span><span class="op" id="2453652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453662">if</span>&nbsp;<span class="ident" id="2453665">d</span><span class="op" id="2453666">.</span><span class="ident" id="2453667">nbuf</span>&nbsp;<span class="op" id="2453672">&lt;=</span>&nbsp;<span class="num" id="2453675">0</span>&nbsp;<span class="op" id="2453677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453683">break</span>&nbsp;<span class="comment" id="2453689">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453708">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453730">var</span>&nbsp;<span class="ident" id="2453734">nb</span><span class="op" id="2453736">,</span>&nbsp;<span class="ident" id="2453738">nc</span>&nbsp;<span class="builtintype" id="2453741">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453747">nb</span><span class="op" id="2453749">,</span>&nbsp;<span class="ident" id="2453751">nc</span><span class="op" id="2453753">,</span>&nbsp;<span class="ident" id="2453755">names</span>&nbsp;<span class="op" id="2453761">=</span>&nbsp;<span class="ident" id="2453763">syscall</span><span class="op" id="2453770">.</span><span class="ident" id="2453771">ParseDirent</span><span class="op" id="2453782">(</span><span class="ident" id="2453783">d</span><span class="op" id="2453784">.</span><span class="ident" id="2453785">buf</span><span class="op" id="2453788">[</span><span class="ident" id="2453789">d</span><span class="op" id="2453790">.</span><span class="ident" id="2453791">bufp</span><span class="op" id="2453795">:</span><span class="ident" id="2453796">d</span><span class="op" id="2453797">.</span><span class="ident" id="2453798">nbuf</span><span class="op" id="2453802">]</span><span class="op" id="2453803">,</span>&nbsp;<span class="ident" id="2453805">n</span><span class="op" id="2453806">,</span>&nbsp;<span class="ident" id="2453808">names</span><span class="op" id="2453813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453817">d</span><span class="op" id="2453818">.</span><span class="ident" id="2453819">bufp</span>&nbsp;<span class="op" id="2453824">+=</span>&nbsp;<span class="ident" id="2453827">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453832">n</span>&nbsp;<span class="op" id="2453834">-=</span>&nbsp;<span class="ident" id="2453837">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453844">if</span>&nbsp;<span class="ident" id="2453847">n</span>&nbsp;<span class="op" id="2453849">&gt;=</span>&nbsp;<span class="num" id="2453852">0</span>&nbsp;<span class="op" id="2453854">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2453857">len</span><span class="op" id="2453860">(</span><span class="ident" id="2453861">names</span><span class="op" id="2453866">)</span>&nbsp;<span class="op" id="2453868">==</span>&nbsp;<span class="num" id="2453871">0</span>&nbsp;<span class="op" id="2453873">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453877">return</span>&nbsp;<span class="ident" id="2453884">names</span><span class="op" id="2453889">,</span>&nbsp;<span class="ident" id="2453891">io</span><span class="op" id="2453893">.</span><span class="ident" id="2453894">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453902">return</span>&nbsp;<span class="ident" id="2453909">names</span><span class="op" id="2453914">,</span>&nbsp;<span class="ident" id="2453916">nil</span><br>
<span class="lineno"></span><span class="op" id="2453920">}</span>
</div>
</body>
</html>
