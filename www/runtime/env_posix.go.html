<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1752220">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1752275">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1752329">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1752380">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752458">package</span>&nbsp;<span class="ident" id="1752466">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752475">import</span>&nbsp;<span class="string" id="1752482">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1752492">func</span>&nbsp;<span class="ident" id="1752497">environ</span><span class="op" id="1752504">(</span><span class="op" id="1752505">)</span>&nbsp;<span class="op" id="1752507">[</span><span class="op" id="1752508">]</span><span class="builtintype" id="1752509">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752517">func</span>&nbsp;<span class="ident" id="1752522">getenv</span><span class="op" id="1752528">(</span><span class="ident" id="1752529">s</span>&nbsp;<span class="op" id="1752531">*</span><span class="builtintype" id="1752532">byte</span><span class="op" id="1752536">)</span>&nbsp;<span class="op" id="1752538">*</span><span class="builtintype" id="1752539">byte</span>&nbsp;<span class="op" id="1752544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752547">val</span>&nbsp;<span class="op" id="1752551">:=</span>&nbsp;<span class="ident" id="1752554"><a href="/runtime/env_posix.go.html#1752698">gogetenv</a></span><span class="op" id="1752562">(</span><span class="ident" id="1752563"><a href="/runtime/stubs.go.html#1974575">gostringnocopy</a></span><span class="op" id="1752577">(</span><span class="ident" id="1752578"><a href="/runtime/env_posix.go.html#1752529">s</a></span><span class="op" id="1752579">)</span><span class="op" id="1752580">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752583">if</span>&nbsp;<span class="ident" id="1752586"><a href="/runtime/env_posix.go.html#1752547">val</a></span>&nbsp;<span class="op" id="1752590">==</span>&nbsp;<span class="string" id="1752593">&#34;&#34;</span>&nbsp;<span class="op" id="1752596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752600">return</span>&nbsp;<span class="ident" id="1752607">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1752615">//&nbsp;Strings&nbsp;found&nbsp;in&nbsp;environment&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752668">return</span>&nbsp;<span class="op" id="1752675">&amp;</span><span class="ident" id="1752676"><a href="/runtime/print1.go.html#1894801">bytes</a></span><span class="op" id="1752681">(</span><span class="ident" id="1752682"><a href="/runtime/env_posix.go.html#1752547">val</a></span><span class="op" id="1752685">)</span><span class="op" id="1752686">[</span><span class="num" id="1752687">0</span><span class="op" id="1752688">]</span><br>
<span class="lineno">20</span><span class="op" id="1752690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752693">func</span>&nbsp;<span class="ident" id="1752698">gogetenv</span><span class="op" id="1752706">(</span><span class="ident" id="1752707">key</span>&nbsp;<span class="builtintype" id="1752711">string</span><span class="op" id="1752717">)</span>&nbsp;<span class="builtintype" id="1752719">string</span>&nbsp;<span class="op" id="1752726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752729">env</span>&nbsp;<span class="op" id="1752733">:=</span>&nbsp;<span class="ident" id="1752736"><a href="/runtime/env_posix.go.html#1752497">environ</a></span><span class="op" id="1752743">(</span><span class="op" id="1752744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752747">if</span>&nbsp;<span class="ident" id="1752750"><a href="/runtime/env_posix.go.html#1752729">env</a></span>&nbsp;<span class="op" id="1752754">==</span>&nbsp;<span class="ident" id="1752757">nil</span>&nbsp;<span class="op" id="1752761">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752765"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1752772">(</span><span class="string" id="1752773">&#34;getenv&nbsp;before&nbsp;env&nbsp;init&#34;</span><span class="op" id="1752797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752803">for</span>&nbsp;<span class="ident" id="1752807">_</span><span class="op" id="1752808">,</span>&nbsp;<span class="ident" id="1752810">s</span>&nbsp;<span class="op" id="1752812">:=</span>&nbsp;<span class="keyword" id="1752815">range</span>&nbsp;<span class="ident" id="1752821"><a href="/runtime/env_posix.go.html#1752497">environ</a></span><span class="op" id="1752828">(</span><span class="op" id="1752829">)</span>&nbsp;<span class="op" id="1752831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752835">if</span>&nbsp;<span class="builtinfunc" id="1752838">len</span><span class="op" id="1752841">(</span><span class="ident" id="1752842"><a href="/runtime/env_posix.go.html#1752810">s</a></span><span class="op" id="1752843">)</span>&nbsp;<span class="op" id="1752845">&gt;</span>&nbsp;<span class="builtinfunc" id="1752847">len</span><span class="op" id="1752850">(</span><span class="ident" id="1752851"><a href="/runtime/env_posix.go.html#1752707">key</a></span><span class="op" id="1752854">)</span>&nbsp;<span class="op" id="1752856">&amp;&amp;</span>&nbsp;<span class="ident" id="1752859"><a href="/runtime/env_posix.go.html#1752810">s</a></span><span class="op" id="1752860">[</span><span class="builtinfunc" id="1752861">len</span><span class="op" id="1752864">(</span><span class="ident" id="1752865"><a href="/runtime/env_posix.go.html#1752707">key</a></span><span class="op" id="1752868">)</span><span class="op" id="1752869">]</span>&nbsp;<span class="op" id="1752871">==</span>&nbsp;<span class="string" id="1752874">&#39;=&#39;</span>&nbsp;<span class="op" id="1752878">&amp;&amp;</span>&nbsp;<span class="ident" id="1752881"><a href="/runtime/env_posix.go.html#1752810">s</a></span><span class="op" id="1752882">[</span><span class="op" id="1752883">:</span><span class="builtinfunc" id="1752884">len</span><span class="op" id="1752887">(</span><span class="ident" id="1752888"><a href="/runtime/env_posix.go.html#1752707">key</a></span><span class="op" id="1752891">)</span><span class="op" id="1752892">]</span>&nbsp;<span class="op" id="1752894">==</span>&nbsp;<span class="ident" id="1752897"><a href="/runtime/env_posix.go.html#1752707">key</a></span>&nbsp;<span class="op" id="1752901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752906">return</span>&nbsp;<span class="ident" id="1752913"><a href="/runtime/env_posix.go.html#1752810">s</a></span><span class="op" id="1752914">[</span><span class="builtinfunc" id="1752915">len</span><span class="op" id="1752918">(</span><span class="ident" id="1752919"><a href="/runtime/env_posix.go.html#1752707">key</a></span><span class="op" id="1752922">)</span><span class="op" id="1752923">+</span><span class="num" id="1752924">1</span><span class="op" id="1752925">:</span><span class="op" id="1752926">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752936">return</span>&nbsp;<span class="string" id="1752943">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1752946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1752949">var</span>&nbsp;<span class="ident" id="1752953">_cgo_setenv</span>&nbsp;<span class="builtintype" id="1752965">uintptr</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1752975">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="1753000">var</span>&nbsp;<span class="ident" id="1753004">_cgo_unsetenv</span>&nbsp;<span class="builtintype" id="1753018">uintptr</span>&nbsp;<span class="comment" id="1753026">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1753052">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1753098">//&nbsp;Called&nbsp;from&nbsp;syscall.Setenv.</span><br>
<span class="lineno">40</span><span class="keyword" id="1753129">func</span>&nbsp;<span class="ident" id="1753134">syscall_setenv_c</span><span class="op" id="1753150">(</span><span class="ident" id="1753151">k</span>&nbsp;<span class="builtintype" id="1753153">string</span><span class="op" id="1753159">,</span>&nbsp;<span class="ident" id="1753161">v</span>&nbsp;<span class="builtintype" id="1753163">string</span><span class="op" id="1753169">)</span>&nbsp;<span class="op" id="1753171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753174">if</span>&nbsp;<span class="ident" id="1753177"><a href="/runtime/env_posix.go.html#1752953">_cgo_setenv</a></span>&nbsp;<span class="op" id="1753189">==</span>&nbsp;<span class="num" id="1753192">0</span>&nbsp;<span class="op" id="1753194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753209">arg</span>&nbsp;<span class="op" id="1753213">:=</span>&nbsp;<span class="op" id="1753216">[</span><span class="num" id="1753217">2</span><span class="op" id="1753218">]</span><span class="ident" id="1753219"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753225">.</span><span class="ident" id="1753226">Pointer</span><span class="op" id="1753233">{</span><span class="ident" id="1753234"><a href="/runtime/env_posix.go.html#1753587">cstring</a></span><span class="op" id="1753241">(</span><span class="ident" id="1753242"><a href="/runtime/env_posix.go.html#1753151">k</a></span><span class="op" id="1753243">)</span><span class="op" id="1753244">,</span>&nbsp;<span class="ident" id="1753246"><a href="/runtime/env_posix.go.html#1753587">cstring</a></span><span class="op" id="1753253">(</span><span class="ident" id="1753254"><a href="/runtime/env_posix.go.html#1753161">v</a></span><span class="op" id="1753255">)</span><span class="op" id="1753256">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753259"><a href="/runtime/stubs.go.html#1976486">asmcgocall</a></span><span class="op" id="1753269">(</span><span class="ident" id="1753270"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753276">.</span><span class="ident" id="1753277">Pointer</span><span class="op" id="1753284">(</span><span class="ident" id="1753285"><a href="/runtime/env_posix.go.html#1752953">_cgo_setenv</a></span><span class="op" id="1753296">)</span><span class="op" id="1753297">,</span>&nbsp;<span class="ident" id="1753299"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753305">.</span><span class="ident" id="1753306">Pointer</span><span class="op" id="1753313">(</span><span class="op" id="1753314">&amp;</span><span class="ident" id="1753315"><a href="/runtime/env_posix.go.html#1753209">arg</a></span><span class="op" id="1753318">)</span><span class="op" id="1753319">)</span><br>
<span class="lineno"></span><span class="op" id="1753321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1753324">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1753370">//&nbsp;Called&nbsp;from&nbsp;syscall.unsetenv.</span><br>
<span class="lineno">50</span><span class="keyword" id="1753403">func</span>&nbsp;<span class="ident" id="1753408">syscall_unsetenv_c</span><span class="op" id="1753426">(</span><span class="ident" id="1753427">k</span>&nbsp;<span class="builtintype" id="1753429">string</span><span class="op" id="1753435">)</span>&nbsp;<span class="op" id="1753437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753440">if</span>&nbsp;<span class="ident" id="1753443"><a href="/runtime/env_posix.go.html#1753004">_cgo_unsetenv</a></span>&nbsp;<span class="op" id="1753457">==</span>&nbsp;<span class="num" id="1753460">0</span>&nbsp;<span class="op" id="1753462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753466">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753477">arg</span>&nbsp;<span class="op" id="1753481">:=</span>&nbsp;<span class="op" id="1753484">[</span><span class="num" id="1753485">1</span><span class="op" id="1753486">]</span><span class="ident" id="1753487"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753493">.</span><span class="ident" id="1753494">Pointer</span><span class="op" id="1753501">{</span><span class="ident" id="1753502"><a href="/runtime/env_posix.go.html#1753587">cstring</a></span><span class="op" id="1753509">(</span><span class="ident" id="1753510"><a href="/runtime/env_posix.go.html#1753427">k</a></span><span class="op" id="1753511">)</span><span class="op" id="1753512">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753515"><a href="/runtime/stubs.go.html#1976486">asmcgocall</a></span><span class="op" id="1753525">(</span><span class="ident" id="1753526"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753532">.</span><span class="ident" id="1753533">Pointer</span><span class="op" id="1753540">(</span><span class="ident" id="1753541"><a href="/runtime/env_posix.go.html#1753004">_cgo_unsetenv</a></span><span class="op" id="1753554">)</span><span class="op" id="1753555">,</span>&nbsp;<span class="ident" id="1753557"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753563">.</span><span class="ident" id="1753564">Pointer</span><span class="op" id="1753571">(</span><span class="op" id="1753572">&amp;</span><span class="ident" id="1753573"><a href="/runtime/env_posix.go.html#1753477">arg</a></span><span class="op" id="1753576">)</span><span class="op" id="1753577">)</span><br>
<span class="lineno"></span><span class="op" id="1753579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1753582">func</span>&nbsp;<span class="ident" id="1753587">cstring</span><span class="op" id="1753594">(</span><span class="ident" id="1753595">s</span>&nbsp;<span class="builtintype" id="1753597">string</span><span class="op" id="1753603">)</span>&nbsp;<span class="ident" id="1753605"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753611">.</span><span class="ident" id="1753612">Pointer</span>&nbsp;<span class="op" id="1753620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753623">p</span>&nbsp;<span class="op" id="1753625">:=</span>&nbsp;<span class="builtinfunc" id="1753628">make</span><span class="op" id="1753632">(</span><span class="op" id="1753633">[</span><span class="op" id="1753634">]</span><span class="builtintype" id="1753635">byte</span><span class="op" id="1753639">,</span>&nbsp;<span class="builtinfunc" id="1753641">len</span><span class="op" id="1753644">(</span><span class="ident" id="1753645"><a href="/runtime/env_posix.go.html#1753595">s</a></span><span class="op" id="1753646">)</span><span class="op" id="1753647">+</span><span class="num" id="1753648">1</span><span class="op" id="1753649">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753652">sp</span>&nbsp;<span class="op" id="1753655">:=</span>&nbsp;<span class="op" id="1753658">(</span><span class="op" id="1753659">*</span><span class="ident" id="1753660"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016246">_string</a></span><span class="op" id="1753667">)</span><span class="op" id="1753668">(</span><span class="ident" id="1753669"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753675">.</span><span class="ident" id="1753676">Pointer</span><span class="op" id="1753683">(</span><span class="op" id="1753684">&amp;</span><span class="ident" id="1753685"><a href="/runtime/env_posix.go.html#1753595">s</a></span><span class="op" id="1753686">)</span><span class="op" id="1753687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753690"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1753697">(</span><span class="ident" id="1753698"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753704">.</span><span class="ident" id="1753705">Pointer</span><span class="op" id="1753712">(</span><span class="op" id="1753713">&amp;</span><span class="ident" id="1753714"><a href="/runtime/env_posix.go.html#1753623">p</a></span><span class="op" id="1753715">[</span><span class="num" id="1753716">0</span><span class="op" id="1753717">]</span><span class="op" id="1753718">)</span><span class="op" id="1753719">,</span>&nbsp;<span class="ident" id="1753721"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753727">.</span><span class="ident" id="1753728">Pointer</span><span class="op" id="1753735">(</span><span class="ident" id="1753736"><a href="/runtime/env_posix.go.html#1753652">sp</a></span><span class="op" id="1753738">.</span><span class="ident" id="1753739">str</span><span class="op" id="1753742">)</span><span class="op" id="1753743">,</span>&nbsp;<span class="builtintype" id="1753745">uintptr</span><span class="op" id="1753752">(</span><span class="builtinfunc" id="1753753">len</span><span class="op" id="1753756">(</span><span class="ident" id="1753757"><a href="/runtime/env_posix.go.html#1753595">s</a></span><span class="op" id="1753758">)</span><span class="op" id="1753759">)</span><span class="op" id="1753760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753763">return</span>&nbsp;<span class="ident" id="1753770"><a href="/runtime/env_posix.go.html#1752482">unsafe</a></span><span class="op" id="1753776">.</span><span class="ident" id="1753777">Pointer</span><span class="op" id="1753784">(</span><span class="op" id="1753785">&amp;</span><span class="ident" id="1753786"><a href="/runtime/env_posix.go.html#1753623">p</a></span><span class="op" id="1753787">[</span><span class="num" id="1753788">0</span><span class="op" id="1753789">]</span><span class="op" id="1753790">)</span><br>
<span class="lineno"></span><span class="op" id="1753792">}</span>
</div>
</body>
</html>
