<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5251528">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5251583">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5251637">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5251688">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="5251744">//</span><br>
<span class="lineno"></span><span class="comment" id="5251747">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5251809">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="5251870">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="5251939">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="5251999">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5252037">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="5252062">//</span><br>
<span class="lineno"></span><span class="comment" id="5252065">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="5252122">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5252184">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="5252242">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5252307">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5252335">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="5252380">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="5252418">//</span><br>
<span class="lineno"></span><span class="comment" id="5252421">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="5252470">//</span><br>
<span class="lineno"></span><span class="comment" id="5252473">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="5252552">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="5252626">//</span><br>
<span class="lineno"></span><span class="comment" id="5252629">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="5252671">//</span><br>
<span class="lineno"></span><span class="comment" id="5252674">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="5252745">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5252818">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5252895">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="5252973">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5253048">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="5253071">//</span><br>
<span class="lineno"></span><span class="comment" id="5253074">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5253151">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="5253207">//</span><br>
<span class="lineno"></span><span class="comment" id="5253210">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="5253283">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5253353">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5253429">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="5253500">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5253577">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="5253643">//</span><br>
<span class="lineno"></span><span class="comment" id="5253646">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="5253724">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5253802">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5253877">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="5253951">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5254022">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5254078">//</span><br>
<span class="lineno"></span><span class="comment" id="5254081">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="5254155">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="5254177">//</span><br>
<span class="lineno"></span><span class="comment" id="5254180">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="5254237">//</span><br>
<span class="lineno"></span><span class="comment" id="5254240">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5254312">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="5254385">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="5254457">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="5254478">//</span><br>
<span class="lineno"></span><span class="comment" id="5254481">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="5254548">//</span><br>
<span class="lineno">65</span><span class="keyword" id="5254551">package</span>&nbsp;<span class="ident" id="5254559">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5254567">import</span>&nbsp;<span class="op" id="5254574">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254577">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254586">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254592">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254609">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254620">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254631">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254639">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5254650">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5254665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5254668">var</span>&nbsp;<span class="ident" id="5254672">debug</span>&nbsp;<span class="op" id="5254678">=</span>&nbsp;<span class="builtintype" id="5254680">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5254687">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5254753">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5254816">type</span>&nbsp;<span class="ident" id="5254821">Regexp</span>&nbsp;<span class="keyword" id="5254828">struct</span>&nbsp;<span class="op" id="5254835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5254838">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254866">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5254881">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254896">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254921">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254936">*</span><span class="ident" id="5254937">syntax</span><span class="op" id="5254943">.</span><span class="ident" id="5254944">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5254951">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254972">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254987">*</span><span class="ident" id="5254988">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5255002">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255028">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5255043">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255058">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255100">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255115">[</span><span class="op" id="5255116">]</span><span class="builtintype" id="5255117">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255130">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255154">prefixComplete</span>&nbsp;<span class="builtintype" id="5255169">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255184">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255216">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5255231">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255246">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255271">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5255286">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255301">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255332">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255347">syntax</span><span class="op" id="5255353">.</span><span class="ident" id="5255354">EmptyOp</span>&nbsp;<span class="comment" id="5255362">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255416">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5255431">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255436">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255451">[</span><span class="op" id="5255452">]</span><span class="builtintype" id="5255453">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255461">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5255476">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5255483">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255524">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255532">sync</span><span class="op" id="5255536">.</span><span class="ident" id="5255537">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255544">machine</span>&nbsp;<span class="op" id="5255552">[</span><span class="op" id="5255553">]</span><span class="op" id="5255554">*</span><span class="ident" id="5255555">machine</span><br>
<span class="lineno">100</span><span class="op" id="5255563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5255566">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5255640">func</span>&nbsp;<span class="op" id="5255645">(</span><span class="ident" id="5255646">re</span>&nbsp;<span class="op" id="5255649">*</span><span class="ident" id="5255650">Regexp</span><span class="op" id="5255656">)</span>&nbsp;<span class="ident" id="5255658">String</span><span class="op" id="5255664">(</span><span class="op" id="5255665">)</span>&nbsp;<span class="builtintype" id="5255667">string</span>&nbsp;<span class="op" id="5255674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255677">return</span>&nbsp;<span class="ident" id="5255684">re</span><span class="op" id="5255686">.</span><span class="ident" id="5255687">expr</span><br>
<span class="lineno">105</span><span class="op" id="5255692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5255695">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="5255762">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5255821">//</span><br>
<span class="lineno">110</span><span class="comment" id="5255824">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5255887">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5255959">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="5256032">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5256096">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="5256163">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="5256225">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="5256283">func</span>&nbsp;<span class="ident" id="5256288">Compile</span><span class="op" id="5256295">(</span><span class="ident" id="5256296">expr</span>&nbsp;<span class="builtintype" id="5256301">string</span><span class="op" id="5256307">)</span>&nbsp;<span class="op" id="5256309">(</span><span class="op" id="5256310">*</span><span class="ident" id="5256311">Regexp</span><span class="op" id="5256317">,</span>&nbsp;<span class="builtintype" id="5256319">error</span><span class="op" id="5256324">)</span>&nbsp;<span class="op" id="5256326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256329">return</span>&nbsp;<span class="ident" id="5256336">compile</span><span class="op" id="5256343">(</span><span class="ident" id="5256344">expr</span><span class="op" id="5256348">,</span>&nbsp;<span class="ident" id="5256350">syntax</span><span class="op" id="5256356">.</span><span class="ident" id="5256357">Perl</span><span class="op" id="5256361">,</span>&nbsp;<span class="builtintype" id="5256363">false</span><span class="op" id="5256368">)</span><br>
<span class="lineno"></span><span class="op" id="5256370">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5256373">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5256442">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5256508">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="5256529">//</span><br>
<span class="lineno">125</span><span class="comment" id="5256532">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5256604">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5256676">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="5256727">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5256793">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="5256862">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="5256876">//</span><br>
<span class="lineno"></span><span class="comment" id="5256879">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="5256954">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="5257018">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="5257087">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="5257161">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5257235">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="5257300">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="5257376">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="5257444">func</span>&nbsp;<span class="ident" id="5257449">CompilePOSIX</span><span class="op" id="5257461">(</span><span class="ident" id="5257462">expr</span>&nbsp;<span class="builtintype" id="5257467">string</span><span class="op" id="5257473">)</span>&nbsp;<span class="op" id="5257475">(</span><span class="op" id="5257476">*</span><span class="ident" id="5257477">Regexp</span><span class="op" id="5257483">,</span>&nbsp;<span class="builtintype" id="5257485">error</span><span class="op" id="5257490">)</span>&nbsp;<span class="op" id="5257492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257495">return</span>&nbsp;<span class="ident" id="5257502">compile</span><span class="op" id="5257509">(</span><span class="ident" id="5257510">expr</span><span class="op" id="5257514">,</span>&nbsp;<span class="ident" id="5257516">syntax</span><span class="op" id="5257522">.</span><span class="ident" id="5257523">POSIX</span><span class="op" id="5257528">,</span>&nbsp;<span class="builtintype" id="5257530">true</span><span class="op" id="5257534">)</span><br>
<span class="lineno"></span><span class="op" id="5257536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5257539">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="5257607">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5257679">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5257751">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5257802">func</span>&nbsp;<span class="op" id="5257807">(</span><span class="ident" id="5257808">re</span>&nbsp;<span class="op" id="5257811">*</span><span class="ident" id="5257812">Regexp</span><span class="op" id="5257818">)</span>&nbsp;<span class="ident" id="5257820">Longest</span><span class="op" id="5257827">(</span><span class="op" id="5257828">)</span>&nbsp;<span class="op" id="5257830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257833">re</span><span class="op" id="5257835">.</span><span class="ident" id="5257836">longest</span>&nbsp;<span class="op" id="5257844">=</span>&nbsp;<span class="builtintype" id="5257846">true</span><br>
<span class="lineno">150</span><span class="op" id="5257851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5257854">func</span>&nbsp;<span class="ident" id="5257859">compile</span><span class="op" id="5257866">(</span><span class="ident" id="5257867">expr</span>&nbsp;<span class="builtintype" id="5257872">string</span><span class="op" id="5257878">,</span>&nbsp;<span class="ident" id="5257880">mode</span>&nbsp;<span class="ident" id="5257885">syntax</span><span class="op" id="5257891">.</span><span class="ident" id="5257892">Flags</span><span class="op" id="5257897">,</span>&nbsp;<span class="ident" id="5257899">longest</span>&nbsp;<span class="builtintype" id="5257907">bool</span><span class="op" id="5257911">)</span>&nbsp;<span class="op" id="5257913">(</span><span class="op" id="5257914">*</span><span class="ident" id="5257915">Regexp</span><span class="op" id="5257921">,</span>&nbsp;<span class="builtintype" id="5257923">error</span><span class="op" id="5257928">)</span>&nbsp;<span class="op" id="5257930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257933">re</span><span class="op" id="5257935">,</span>&nbsp;<span class="ident" id="5257937">err</span>&nbsp;<span class="op" id="5257941">:=</span>&nbsp;<span class="ident" id="5257944">syntax</span><span class="op" id="5257950">.</span><span class="ident" id="5257951">Parse</span><span class="op" id="5257956">(</span><span class="ident" id="5257957">expr</span><span class="op" id="5257961">,</span>&nbsp;<span class="ident" id="5257963">mode</span><span class="op" id="5257967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257970">if</span>&nbsp;<span class="ident" id="5257973">err</span>&nbsp;<span class="op" id="5257977">!=</span>&nbsp;<span class="ident" id="5257980">nil</span>&nbsp;<span class="op" id="5257984">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257988">return</span>&nbsp;<span class="ident" id="5257995">nil</span><span class="op" id="5257998">,</span>&nbsp;<span class="ident" id="5258000">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258008">maxCap</span>&nbsp;<span class="op" id="5258015">:=</span>&nbsp;<span class="ident" id="5258018">re</span><span class="op" id="5258020">.</span><span class="ident" id="5258021">MaxCap</span><span class="op" id="5258027">(</span><span class="op" id="5258028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258031">capNames</span>&nbsp;<span class="op" id="5258040">:=</span>&nbsp;<span class="ident" id="5258043">re</span><span class="op" id="5258045">.</span><span class="ident" id="5258046">CapNames</span><span class="op" id="5258054">(</span><span class="op" id="5258055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258059">re</span>&nbsp;<span class="op" id="5258062">=</span>&nbsp;<span class="ident" id="5258064">re</span><span class="op" id="5258066">.</span><span class="ident" id="5258067">Simplify</span><span class="op" id="5258075">(</span><span class="op" id="5258076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258079">prog</span><span class="op" id="5258083">,</span>&nbsp;<span class="ident" id="5258085">err</span>&nbsp;<span class="op" id="5258089">:=</span>&nbsp;<span class="ident" id="5258092">syntax</span><span class="op" id="5258098">.</span><span class="ident" id="5258099">Compile</span><span class="op" id="5258106">(</span><span class="ident" id="5258107">re</span><span class="op" id="5258109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258112">if</span>&nbsp;<span class="ident" id="5258115">err</span>&nbsp;<span class="op" id="5258119">!=</span>&nbsp;<span class="ident" id="5258122">nil</span>&nbsp;<span class="op" id="5258126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258130">return</span>&nbsp;<span class="ident" id="5258137">nil</span><span class="op" id="5258140">,</span>&nbsp;<span class="ident" id="5258142">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258147">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258150">regexp</span>&nbsp;<span class="op" id="5258157">:=</span>&nbsp;<span class="op" id="5258160">&amp;</span><span class="ident" id="5258161">Regexp</span><span class="op" id="5258167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258171">expr</span><span class="op" id="5258175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258184">expr</span><span class="op" id="5258188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258192">prog</span><span class="op" id="5258196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258205">prog</span><span class="op" id="5258209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258213">onepass</span><span class="op" id="5258220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258226">compileOnePass</span><span class="op" id="5258240">(</span><span class="ident" id="5258241">prog</span><span class="op" id="5258245">)</span><span class="op" id="5258246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258250">numSubexp</span><span class="op" id="5258259">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5258263">maxCap</span><span class="op" id="5258269">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258273">subexpNames</span><span class="op" id="5258284">:</span>&nbsp;<span class="ident" id="5258286">capNames</span><span class="op" id="5258294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258298">cond</span><span class="op" id="5258302">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258311">prog</span><span class="op" id="5258315">.</span><span class="ident" id="5258316">StartCond</span><span class="op" id="5258325">(</span><span class="op" id="5258326">)</span><span class="op" id="5258327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258331">longest</span><span class="op" id="5258338">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258344">longest</span><span class="op" id="5258351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258357">if</span>&nbsp;<span class="ident" id="5258360">regexp</span><span class="op" id="5258366">.</span><span class="ident" id="5258367">onepass</span>&nbsp;<span class="op" id="5258375">==</span>&nbsp;<span class="ident" id="5258378">notOnePass</span>&nbsp;<span class="op" id="5258389">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258393">regexp</span><span class="op" id="5258399">.</span><span class="ident" id="5258400">prefix</span><span class="op" id="5258406">,</span>&nbsp;<span class="ident" id="5258408">regexp</span><span class="op" id="5258414">.</span><span class="ident" id="5258415">prefixComplete</span>&nbsp;<span class="op" id="5258430">=</span>&nbsp;<span class="ident" id="5258432">prog</span><span class="op" id="5258436">.</span><span class="ident" id="5258437">Prefix</span><span class="op" id="5258443">(</span><span class="op" id="5258444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258447">}</span>&nbsp;<span class="keyword" id="5258449">else</span>&nbsp;<span class="op" id="5258454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258458">regexp</span><span class="op" id="5258464">.</span><span class="ident" id="5258465">prefix</span><span class="op" id="5258471">,</span>&nbsp;<span class="ident" id="5258473">regexp</span><span class="op" id="5258479">.</span><span class="ident" id="5258480">prefixComplete</span><span class="op" id="5258494">,</span>&nbsp;<span class="ident" id="5258496">regexp</span><span class="op" id="5258502">.</span><span class="ident" id="5258503">prefixEnd</span>&nbsp;<span class="op" id="5258513">=</span>&nbsp;<span class="ident" id="5258515">onePassPrefix</span><span class="op" id="5258528">(</span><span class="ident" id="5258529">prog</span><span class="op" id="5258533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258539">if</span>&nbsp;<span class="ident" id="5258542">regexp</span><span class="op" id="5258548">.</span><span class="ident" id="5258549">prefix</span>&nbsp;<span class="op" id="5258556">!=</span>&nbsp;<span class="string" id="5258559">&#34;&#34;</span>&nbsp;<span class="op" id="5258562">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258566">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258615">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258650">regexp</span><span class="op" id="5258656">.</span><span class="ident" id="5258657">prefixBytes</span>&nbsp;<span class="op" id="5258669">=</span>&nbsp;<span class="op" id="5258671">[</span><span class="op" id="5258672">]</span><span class="builtintype" id="5258673">byte</span><span class="op" id="5258677">(</span><span class="ident" id="5258678">regexp</span><span class="op" id="5258684">.</span><span class="ident" id="5258685">prefix</span><span class="op" id="5258691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258695">regexp</span><span class="op" id="5258701">.</span><span class="ident" id="5258702">prefixRune</span><span class="op" id="5258712">,</span>&nbsp;<span class="ident" id="5258714">_</span>&nbsp;<span class="op" id="5258716">=</span>&nbsp;<span class="ident" id="5258718">utf8</span><span class="op" id="5258722">.</span><span class="ident" id="5258723">DecodeRuneInString</span><span class="op" id="5258741">(</span><span class="ident" id="5258742">regexp</span><span class="op" id="5258748">.</span><span class="ident" id="5258749">prefix</span><span class="op" id="5258755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258758">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258761">return</span>&nbsp;<span class="ident" id="5258768">regexp</span><span class="op" id="5258774">,</span>&nbsp;<span class="ident" id="5258776">nil</span><br>
<span class="lineno"></span><span class="op" id="5258780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258783">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5258832">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="5258888">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5258915">func</span>&nbsp;<span class="op" id="5258920">(</span><span class="ident" id="5258921">re</span>&nbsp;<span class="op" id="5258924">*</span><span class="ident" id="5258925">Regexp</span><span class="op" id="5258931">)</span>&nbsp;<span class="ident" id="5258933">get</span><span class="op" id="5258936">(</span><span class="op" id="5258937">)</span>&nbsp;<span class="op" id="5258939">*</span><span class="ident" id="5258940">machine</span>&nbsp;<span class="op" id="5258948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258951">re</span><span class="op" id="5258953">.</span><span class="ident" id="5258954">mu</span><span class="op" id="5258956">.</span><span class="ident" id="5258957">Lock</span><span class="op" id="5258961">(</span><span class="op" id="5258962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258965">if</span>&nbsp;<span class="ident" id="5258968">n</span>&nbsp;<span class="op" id="5258970">:=</span>&nbsp;<span class="builtinfunc" id="5258973">len</span><span class="op" id="5258976">(</span><span class="ident" id="5258977">re</span><span class="op" id="5258979">.</span><span class="ident" id="5258980">machine</span><span class="op" id="5258987">)</span><span class="op" id="5258988">;</span>&nbsp;<span class="ident" id="5258990">n</span>&nbsp;<span class="op" id="5258992">&gt;</span>&nbsp;<span class="num" id="5258994">0</span>&nbsp;<span class="op" id="5258996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259000">z</span>&nbsp;<span class="op" id="5259002">:=</span>&nbsp;<span class="ident" id="5259005">re</span><span class="op" id="5259007">.</span><span class="ident" id="5259008">machine</span><span class="op" id="5259015">[</span><span class="ident" id="5259016">n</span><span class="op" id="5259017">-</span><span class="num" id="5259018">1</span><span class="op" id="5259019">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259023">re</span><span class="op" id="5259025">.</span><span class="ident" id="5259026">machine</span>&nbsp;<span class="op" id="5259034">=</span>&nbsp;<span class="ident" id="5259036">re</span><span class="op" id="5259038">.</span><span class="ident" id="5259039">machine</span><span class="op" id="5259046">[</span><span class="op" id="5259047">:</span><span class="ident" id="5259048">n</span><span class="op" id="5259049">-</span><span class="num" id="5259050">1</span><span class="op" id="5259051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259055">re</span><span class="op" id="5259057">.</span><span class="ident" id="5259058">mu</span><span class="op" id="5259060">.</span><span class="ident" id="5259061">Unlock</span><span class="op" id="5259067">(</span><span class="op" id="5259068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259072">return</span>&nbsp;<span class="ident" id="5259079">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259085">re</span><span class="op" id="5259087">.</span><span class="ident" id="5259088">mu</span><span class="op" id="5259090">.</span><span class="ident" id="5259091">Unlock</span><span class="op" id="5259097">(</span><span class="op" id="5259098">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259101">z</span>&nbsp;<span class="op" id="5259103">:=</span>&nbsp;<span class="ident" id="5259106">progMachine</span><span class="op" id="5259117">(</span><span class="ident" id="5259118">re</span><span class="op" id="5259120">.</span><span class="ident" id="5259121">prog</span><span class="op" id="5259125">,</span>&nbsp;<span class="ident" id="5259127">re</span><span class="op" id="5259129">.</span><span class="ident" id="5259130">onepass</span><span class="op" id="5259137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259140">z</span><span class="op" id="5259141">.</span><span class="ident" id="5259142">re</span>&nbsp;<span class="op" id="5259145">=</span>&nbsp;<span class="ident" id="5259147">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259151">return</span>&nbsp;<span class="ident" id="5259158">z</span><br>
<span class="lineno"></span><span class="op" id="5259160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5259163">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="5259215">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5259281">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5259335">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="5259405">func</span>&nbsp;<span class="op" id="5259410">(</span><span class="ident" id="5259411">re</span>&nbsp;<span class="op" id="5259414">*</span><span class="ident" id="5259415">Regexp</span><span class="op" id="5259421">)</span>&nbsp;<span class="ident" id="5259423">put</span><span class="op" id="5259426">(</span><span class="ident" id="5259427">z</span>&nbsp;<span class="op" id="5259429">*</span><span class="ident" id="5259430">machine</span><span class="op" id="5259437">)</span>&nbsp;<span class="op" id="5259439">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259442">re</span><span class="op" id="5259444">.</span><span class="ident" id="5259445">mu</span><span class="op" id="5259447">.</span><span class="ident" id="5259448">Lock</span><span class="op" id="5259452">(</span><span class="op" id="5259453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259456">re</span><span class="op" id="5259458">.</span><span class="ident" id="5259459">machine</span>&nbsp;<span class="op" id="5259467">=</span>&nbsp;<span class="builtinfunc" id="5259469">append</span><span class="op" id="5259475">(</span><span class="ident" id="5259476">re</span><span class="op" id="5259478">.</span><span class="ident" id="5259479">machine</span><span class="op" id="5259486">,</span>&nbsp;<span class="ident" id="5259488">z</span><span class="op" id="5259489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259492">re</span><span class="op" id="5259494">.</span><span class="ident" id="5259495">mu</span><span class="op" id="5259497">.</span><span class="ident" id="5259498">Unlock</span><span class="op" id="5259504">(</span><span class="op" id="5259505">)</span><br>
<span class="lineno"></span><span class="op" id="5259507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5259510">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5259588">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5259670">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5259686">func</span>&nbsp;<span class="ident" id="5259691">MustCompile</span><span class="op" id="5259702">(</span><span class="ident" id="5259703">str</span>&nbsp;<span class="builtintype" id="5259707">string</span><span class="op" id="5259713">)</span>&nbsp;<span class="op" id="5259715">*</span><span class="ident" id="5259716">Regexp</span>&nbsp;<span class="op" id="5259723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259726">regexp</span><span class="op" id="5259732">,</span>&nbsp;<span class="builtintype" id="5259734">error</span>&nbsp;<span class="op" id="5259740">:=</span>&nbsp;<span class="ident" id="5259743">Compile</span><span class="op" id="5259750">(</span><span class="ident" id="5259751">str</span><span class="op" id="5259754">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259757">if</span>&nbsp;<span class="builtintype" id="5259760">error</span>&nbsp;<span class="op" id="5259766">!=</span>&nbsp;<span class="ident" id="5259769">nil</span>&nbsp;<span class="op" id="5259773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5259777">panic</span><span class="op" id="5259782">(</span><span class="string" id="5259783">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="5259802">+</span>&nbsp;<span class="ident" id="5259804">quote</span><span class="op" id="5259809">(</span><span class="ident" id="5259810">str</span><span class="op" id="5259813">)</span>&nbsp;<span class="op" id="5259815">+</span>&nbsp;<span class="string" id="5259817">`):&nbsp;`</span>&nbsp;<span class="op" id="5259823">+</span>&nbsp;<span class="builtintype" id="5259825">error</span><span class="op" id="5259830">.</span><span class="ident" id="5259831">Error</span><span class="op" id="5259836">(</span><span class="op" id="5259837">)</span><span class="op" id="5259838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259844">return</span>&nbsp;<span class="ident" id="5259851">regexp</span><br>
<span class="lineno"></span><span class="op" id="5259858">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5259861">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5259949">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5260031">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5260047">func</span>&nbsp;<span class="ident" id="5260052">MustCompilePOSIX</span><span class="op" id="5260068">(</span><span class="ident" id="5260069">str</span>&nbsp;<span class="builtintype" id="5260073">string</span><span class="op" id="5260079">)</span>&nbsp;<span class="op" id="5260081">*</span><span class="ident" id="5260082">Regexp</span>&nbsp;<span class="op" id="5260089">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260092">regexp</span><span class="op" id="5260098">,</span>&nbsp;<span class="builtintype" id="5260100">error</span>&nbsp;<span class="op" id="5260106">:=</span>&nbsp;<span class="ident" id="5260109">CompilePOSIX</span><span class="op" id="5260121">(</span><span class="ident" id="5260122">str</span><span class="op" id="5260125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260128">if</span>&nbsp;<span class="builtintype" id="5260131">error</span>&nbsp;<span class="op" id="5260137">!=</span>&nbsp;<span class="ident" id="5260140">nil</span>&nbsp;<span class="op" id="5260144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5260148">panic</span><span class="op" id="5260153">(</span><span class="string" id="5260154">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="5260178">+</span>&nbsp;<span class="ident" id="5260180">quote</span><span class="op" id="5260185">(</span><span class="ident" id="5260186">str</span><span class="op" id="5260189">)</span>&nbsp;<span class="op" id="5260191">+</span>&nbsp;<span class="string" id="5260193">`):&nbsp;`</span>&nbsp;<span class="op" id="5260199">+</span>&nbsp;<span class="builtintype" id="5260201">error</span><span class="op" id="5260206">.</span><span class="ident" id="5260207">Error</span><span class="op" id="5260212">(</span><span class="op" id="5260213">)</span><span class="op" id="5260214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260220">return</span>&nbsp;<span class="ident" id="5260227">regexp</span><br>
<span class="lineno">235</span><span class="op" id="5260234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260237">func</span>&nbsp;<span class="ident" id="5260242">quote</span><span class="op" id="5260247">(</span><span class="ident" id="5260248">s</span>&nbsp;<span class="builtintype" id="5260250">string</span><span class="op" id="5260256">)</span>&nbsp;<span class="builtintype" id="5260258">string</span>&nbsp;<span class="op" id="5260265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260268">if</span>&nbsp;<span class="ident" id="5260271">strconv</span><span class="op" id="5260278">.</span><span class="ident" id="5260279">CanBackquote</span><span class="op" id="5260291">(</span><span class="ident" id="5260292">s</span><span class="op" id="5260293">)</span>&nbsp;<span class="op" id="5260295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260299">return</span>&nbsp;<span class="string" id="5260306">&#34;`&#34;</span>&nbsp;<span class="op" id="5260310">+</span>&nbsp;<span class="ident" id="5260312">s</span>&nbsp;<span class="op" id="5260314">+</span>&nbsp;<span class="string" id="5260316">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260324">return</span>&nbsp;<span class="ident" id="5260331">strconv</span><span class="op" id="5260338">.</span><span class="ident" id="5260339">Quote</span><span class="op" id="5260344">(</span><span class="ident" id="5260345">s</span><span class="op" id="5260346">)</span><br>
<span class="lineno"></span><span class="op" id="5260348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260351">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="5260431">func</span>&nbsp;<span class="op" id="5260436">(</span><span class="ident" id="5260437">re</span>&nbsp;<span class="op" id="5260440">*</span><span class="ident" id="5260441">Regexp</span><span class="op" id="5260447">)</span>&nbsp;<span class="ident" id="5260449">NumSubexp</span><span class="op" id="5260458">(</span><span class="op" id="5260459">)</span>&nbsp;<span class="builtintype" id="5260461">int</span>&nbsp;<span class="op" id="5260465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260468">return</span>&nbsp;<span class="ident" id="5260475">re</span><span class="op" id="5260477">.</span><span class="ident" id="5260478">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="5260488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260491">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="5260560">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="5260631">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="5260704">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="5260771">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="5260827">func</span>&nbsp;<span class="op" id="5260832">(</span><span class="ident" id="5260833">re</span>&nbsp;<span class="op" id="5260836">*</span><span class="ident" id="5260837">Regexp</span><span class="op" id="5260843">)</span>&nbsp;<span class="ident" id="5260845">SubexpNames</span><span class="op" id="5260856">(</span><span class="op" id="5260857">)</span>&nbsp;<span class="op" id="5260859">[</span><span class="op" id="5260860">]</span><span class="builtintype" id="5260861">string</span>&nbsp;<span class="op" id="5260868">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260871">return</span>&nbsp;<span class="ident" id="5260878">re</span><span class="op" id="5260880">.</span><span class="ident" id="5260881">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="5260893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260896">const</span>&nbsp;<span class="ident" id="5260902">endOfText</span>&nbsp;<span class="builtintype" id="5260912">rune</span>&nbsp;<span class="op" id="5260917">=</span>&nbsp;<span class="op" id="5260919">-</span><span class="num" id="5260920">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5260923">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="5260999">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="5261027">type</span>&nbsp;<span class="ident" id="5261032">input</span>&nbsp;<span class="keyword" id="5261038">interface</span>&nbsp;<span class="op" id="5261048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261051">step</span><span class="op" id="5261055">(</span><span class="ident" id="5261056">pos</span>&nbsp;<span class="builtintype" id="5261060">int</span><span class="op" id="5261063">)</span>&nbsp;<span class="op" id="5261065">(</span><span class="ident" id="5261066">r</span>&nbsp;<span class="builtintype" id="5261068">rune</span><span class="op" id="5261072">,</span>&nbsp;<span class="ident" id="5261074">width</span>&nbsp;<span class="builtintype" id="5261080">int</span><span class="op" id="5261083">)</span>&nbsp;<span class="comment" id="5261085">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261106">canCheckPrefix</span><span class="op" id="5261120">(</span><span class="op" id="5261121">)</span>&nbsp;<span class="builtintype" id="5261123">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5261140">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261183">hasPrefix</span><span class="op" id="5261192">(</span><span class="ident" id="5261193">re</span>&nbsp;<span class="op" id="5261196">*</span><span class="ident" id="5261197">Regexp</span><span class="op" id="5261203">)</span>&nbsp;<span class="builtintype" id="5261205">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261211">index</span><span class="op" id="5261216">(</span><span class="ident" id="5261217">re</span>&nbsp;<span class="op" id="5261220">*</span><span class="ident" id="5261221">Regexp</span><span class="op" id="5261227">,</span>&nbsp;<span class="ident" id="5261229">pos</span>&nbsp;<span class="builtintype" id="5261233">int</span><span class="op" id="5261236">)</span>&nbsp;<span class="builtintype" id="5261238">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261243">context</span><span class="op" id="5261250">(</span><span class="ident" id="5261251">pos</span>&nbsp;<span class="builtintype" id="5261255">int</span><span class="op" id="5261258">)</span>&nbsp;<span class="ident" id="5261260">syntax</span><span class="op" id="5261266">.</span><span class="ident" id="5261267">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="5261275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5261278">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5261309">type</span>&nbsp;<span class="ident" id="5261314">inputString</span>&nbsp;<span class="keyword" id="5261326">struct</span>&nbsp;<span class="op" id="5261333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261336">str</span>&nbsp;<span class="builtintype" id="5261340">string</span><br>
<span class="lineno"></span><span class="op" id="5261347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5261350">func</span>&nbsp;<span class="op" id="5261355">(</span><span class="ident" id="5261356">i</span>&nbsp;<span class="op" id="5261358">*</span><span class="ident" id="5261359">inputString</span><span class="op" id="5261370">)</span>&nbsp;<span class="ident" id="5261372">step</span><span class="op" id="5261376">(</span><span class="ident" id="5261377">pos</span>&nbsp;<span class="builtintype" id="5261381">int</span><span class="op" id="5261384">)</span>&nbsp;<span class="op" id="5261386">(</span><span class="builtintype" id="5261387">rune</span><span class="op" id="5261391">,</span>&nbsp;<span class="builtintype" id="5261393">int</span><span class="op" id="5261396">)</span>&nbsp;<span class="op" id="5261398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261401">if</span>&nbsp;<span class="ident" id="5261404">pos</span>&nbsp;<span class="op" id="5261408">&lt;</span>&nbsp;<span class="builtinfunc" id="5261410">len</span><span class="op" id="5261413">(</span><span class="ident" id="5261414">i</span><span class="op" id="5261415">.</span><span class="ident" id="5261416">str</span><span class="op" id="5261419">)</span>&nbsp;<span class="op" id="5261421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261425">c</span>&nbsp;<span class="op" id="5261427">:=</span>&nbsp;<span class="ident" id="5261430">i</span><span class="op" id="5261431">.</span><span class="ident" id="5261432">str</span><span class="op" id="5261435">[</span><span class="ident" id="5261436">pos</span><span class="op" id="5261439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261443">if</span>&nbsp;<span class="ident" id="5261446">c</span>&nbsp;<span class="op" id="5261448">&lt;</span>&nbsp;<span class="ident" id="5261450">utf8</span><span class="op" id="5261454">.</span><span class="ident" id="5261455">RuneSelf</span>&nbsp;<span class="op" id="5261464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261469">return</span>&nbsp;<span class="builtintype" id="5261476">rune</span><span class="op" id="5261480">(</span><span class="ident" id="5261481">c</span><span class="op" id="5261482">)</span><span class="op" id="5261483">,</span>&nbsp;<span class="num" id="5261485">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261493">return</span>&nbsp;<span class="ident" id="5261500">utf8</span><span class="op" id="5261504">.</span><span class="ident" id="5261505">DecodeRuneInString</span><span class="op" id="5261523">(</span><span class="ident" id="5261524">i</span><span class="op" id="5261525">.</span><span class="ident" id="5261526">str</span><span class="op" id="5261529">[</span><span class="ident" id="5261530">pos</span><span class="op" id="5261533">:</span><span class="op" id="5261534">]</span><span class="op" id="5261535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261541">return</span>&nbsp;<span class="ident" id="5261548">endOfText</span><span class="op" id="5261557">,</span>&nbsp;<span class="num" id="5261559">0</span><br>
<span class="lineno"></span><span class="op" id="5261561">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5261564">func</span>&nbsp;<span class="op" id="5261569">(</span><span class="ident" id="5261570">i</span>&nbsp;<span class="op" id="5261572">*</span><span class="ident" id="5261573">inputString</span><span class="op" id="5261584">)</span>&nbsp;<span class="ident" id="5261586">canCheckPrefix</span><span class="op" id="5261600">(</span><span class="op" id="5261601">)</span>&nbsp;<span class="builtintype" id="5261603">bool</span>&nbsp;<span class="op" id="5261608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261611">return</span>&nbsp;<span class="builtintype" id="5261618">true</span><br>
<span class="lineno"></span><span class="op" id="5261623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="5261626">func</span>&nbsp;<span class="op" id="5261631">(</span><span class="ident" id="5261632">i</span>&nbsp;<span class="op" id="5261634">*</span><span class="ident" id="5261635">inputString</span><span class="op" id="5261646">)</span>&nbsp;<span class="ident" id="5261648">hasPrefix</span><span class="op" id="5261657">(</span><span class="ident" id="5261658">re</span>&nbsp;<span class="op" id="5261661">*</span><span class="ident" id="5261662">Regexp</span><span class="op" id="5261668">)</span>&nbsp;<span class="builtintype" id="5261670">bool</span>&nbsp;<span class="op" id="5261675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261678">return</span>&nbsp;<span class="ident" id="5261685">strings</span><span class="op" id="5261692">.</span><span class="ident" id="5261693">HasPrefix</span><span class="op" id="5261702">(</span><span class="ident" id="5261703">i</span><span class="op" id="5261704">.</span><span class="ident" id="5261705">str</span><span class="op" id="5261708">,</span>&nbsp;<span class="ident" id="5261710">re</span><span class="op" id="5261712">.</span><span class="ident" id="5261713">prefix</span><span class="op" id="5261719">)</span><br>
<span class="lineno"></span><span class="op" id="5261721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5261724">func</span>&nbsp;<span class="op" id="5261729">(</span><span class="ident" id="5261730">i</span>&nbsp;<span class="op" id="5261732">*</span><span class="ident" id="5261733">inputString</span><span class="op" id="5261744">)</span>&nbsp;<span class="ident" id="5261746">index</span><span class="op" id="5261751">(</span><span class="ident" id="5261752">re</span>&nbsp;<span class="op" id="5261755">*</span><span class="ident" id="5261756">Regexp</span><span class="op" id="5261762">,</span>&nbsp;<span class="ident" id="5261764">pos</span>&nbsp;<span class="builtintype" id="5261768">int</span><span class="op" id="5261771">)</span>&nbsp;<span class="builtintype" id="5261773">int</span>&nbsp;<span class="op" id="5261777">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261780">return</span>&nbsp;<span class="ident" id="5261787">strings</span><span class="op" id="5261794">.</span><span class="ident" id="5261795">Index</span><span class="op" id="5261800">(</span><span class="ident" id="5261801">i</span><span class="op" id="5261802">.</span><span class="ident" id="5261803">str</span><span class="op" id="5261806">[</span><span class="ident" id="5261807">pos</span><span class="op" id="5261810">:</span><span class="op" id="5261811">]</span><span class="op" id="5261812">,</span>&nbsp;<span class="ident" id="5261814">re</span><span class="op" id="5261816">.</span><span class="ident" id="5261817">prefix</span><span class="op" id="5261823">)</span><br>
<span class="lineno"></span><span class="op" id="5261825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5261828">func</span>&nbsp;<span class="op" id="5261833">(</span><span class="ident" id="5261834">i</span>&nbsp;<span class="op" id="5261836">*</span><span class="ident" id="5261837">inputString</span><span class="op" id="5261848">)</span>&nbsp;<span class="ident" id="5261850">context</span><span class="op" id="5261857">(</span><span class="ident" id="5261858">pos</span>&nbsp;<span class="builtintype" id="5261862">int</span><span class="op" id="5261865">)</span>&nbsp;<span class="ident" id="5261867">syntax</span><span class="op" id="5261873">.</span><span class="ident" id="5261874">EmptyOp</span>&nbsp;<span class="op" id="5261882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261885">r1</span><span class="op" id="5261887">,</span>&nbsp;<span class="ident" id="5261889">r2</span>&nbsp;<span class="op" id="5261892">:=</span>&nbsp;<span class="ident" id="5261895">endOfText</span><span class="op" id="5261904">,</span>&nbsp;<span class="ident" id="5261906">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261917">if</span>&nbsp;<span class="ident" id="5261920">pos</span>&nbsp;<span class="op" id="5261924">&gt;</span>&nbsp;<span class="num" id="5261926">0</span>&nbsp;<span class="op" id="5261928">&amp;&amp;</span>&nbsp;<span class="ident" id="5261931">pos</span>&nbsp;<span class="op" id="5261935">&lt;=</span>&nbsp;<span class="builtinfunc" id="5261938">len</span><span class="op" id="5261941">(</span><span class="ident" id="5261942">i</span><span class="op" id="5261943">.</span><span class="ident" id="5261944">str</span><span class="op" id="5261947">)</span>&nbsp;<span class="op" id="5261949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261953">r1</span><span class="op" id="5261955">,</span>&nbsp;<span class="ident" id="5261957">_</span>&nbsp;<span class="op" id="5261959">=</span>&nbsp;<span class="ident" id="5261961">utf8</span><span class="op" id="5261965">.</span><span class="ident" id="5261966">DecodeLastRuneInString</span><span class="op" id="5261988">(</span><span class="ident" id="5261989">i</span><span class="op" id="5261990">.</span><span class="ident" id="5261991">str</span><span class="op" id="5261994">[</span><span class="op" id="5261995">:</span><span class="ident" id="5261996">pos</span><span class="op" id="5261999">]</span><span class="op" id="5262000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262006">if</span>&nbsp;<span class="ident" id="5262009">pos</span>&nbsp;<span class="op" id="5262013">&lt;</span>&nbsp;<span class="builtinfunc" id="5262015">len</span><span class="op" id="5262018">(</span><span class="ident" id="5262019">i</span><span class="op" id="5262020">.</span><span class="ident" id="5262021">str</span><span class="op" id="5262024">)</span>&nbsp;<span class="op" id="5262026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262030">r2</span><span class="op" id="5262032">,</span>&nbsp;<span class="ident" id="5262034">_</span>&nbsp;<span class="op" id="5262036">=</span>&nbsp;<span class="ident" id="5262038">utf8</span><span class="op" id="5262042">.</span><span class="ident" id="5262043">DecodeRuneInString</span><span class="op" id="5262061">(</span><span class="ident" id="5262062">i</span><span class="op" id="5262063">.</span><span class="ident" id="5262064">str</span><span class="op" id="5262067">[</span><span class="ident" id="5262068">pos</span><span class="op" id="5262071">:</span><span class="op" id="5262072">]</span><span class="op" id="5262073">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262079">return</span>&nbsp;<span class="ident" id="5262086">syntax</span><span class="op" id="5262092">.</span><span class="ident" id="5262093">EmptyOpContext</span><span class="op" id="5262107">(</span><span class="ident" id="5262108">r1</span><span class="op" id="5262110">,</span>&nbsp;<span class="ident" id="5262112">r2</span><span class="op" id="5262114">)</span><br>
<span class="lineno"></span><span class="op" id="5262116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262119">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="5262153">type</span>&nbsp;<span class="ident" id="5262158">inputBytes</span>&nbsp;<span class="keyword" id="5262169">struct</span>&nbsp;<span class="op" id="5262176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262179">str</span>&nbsp;<span class="op" id="5262183">[</span><span class="op" id="5262184">]</span><span class="builtintype" id="5262185">byte</span><br>
<span class="lineno"></span><span class="op" id="5262190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262193">func</span>&nbsp;<span class="op" id="5262198">(</span><span class="ident" id="5262199">i</span>&nbsp;<span class="op" id="5262201">*</span><span class="ident" id="5262202">inputBytes</span><span class="op" id="5262212">)</span>&nbsp;<span class="ident" id="5262214">step</span><span class="op" id="5262218">(</span><span class="ident" id="5262219">pos</span>&nbsp;<span class="builtintype" id="5262223">int</span><span class="op" id="5262226">)</span>&nbsp;<span class="op" id="5262228">(</span><span class="builtintype" id="5262229">rune</span><span class="op" id="5262233">,</span>&nbsp;<span class="builtintype" id="5262235">int</span><span class="op" id="5262238">)</span>&nbsp;<span class="op" id="5262240">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262243">if</span>&nbsp;<span class="ident" id="5262246">pos</span>&nbsp;<span class="op" id="5262250">&lt;</span>&nbsp;<span class="builtinfunc" id="5262252">len</span><span class="op" id="5262255">(</span><span class="ident" id="5262256">i</span><span class="op" id="5262257">.</span><span class="ident" id="5262258">str</span><span class="op" id="5262261">)</span>&nbsp;<span class="op" id="5262263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262267">c</span>&nbsp;<span class="op" id="5262269">:=</span>&nbsp;<span class="ident" id="5262272">i</span><span class="op" id="5262273">.</span><span class="ident" id="5262274">str</span><span class="op" id="5262277">[</span><span class="ident" id="5262278">pos</span><span class="op" id="5262281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262285">if</span>&nbsp;<span class="ident" id="5262288">c</span>&nbsp;<span class="op" id="5262290">&lt;</span>&nbsp;<span class="ident" id="5262292">utf8</span><span class="op" id="5262296">.</span><span class="ident" id="5262297">RuneSelf</span>&nbsp;<span class="op" id="5262306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262311">return</span>&nbsp;<span class="builtintype" id="5262318">rune</span><span class="op" id="5262322">(</span><span class="ident" id="5262323">c</span><span class="op" id="5262324">)</span><span class="op" id="5262325">,</span>&nbsp;<span class="num" id="5262327">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262331">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262335">return</span>&nbsp;<span class="ident" id="5262342">utf8</span><span class="op" id="5262346">.</span><span class="ident" id="5262347">DecodeRune</span><span class="op" id="5262357">(</span><span class="ident" id="5262358">i</span><span class="op" id="5262359">.</span><span class="ident" id="5262360">str</span><span class="op" id="5262363">[</span><span class="ident" id="5262364">pos</span><span class="op" id="5262367">:</span><span class="op" id="5262368">]</span><span class="op" id="5262369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262375">return</span>&nbsp;<span class="ident" id="5262382">endOfText</span><span class="op" id="5262391">,</span>&nbsp;<span class="num" id="5262393">0</span><br>
<span class="lineno"></span><span class="op" id="5262395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="5262398">func</span>&nbsp;<span class="op" id="5262403">(</span><span class="ident" id="5262404">i</span>&nbsp;<span class="op" id="5262406">*</span><span class="ident" id="5262407">inputBytes</span><span class="op" id="5262417">)</span>&nbsp;<span class="ident" id="5262419">canCheckPrefix</span><span class="op" id="5262433">(</span><span class="op" id="5262434">)</span>&nbsp;<span class="builtintype" id="5262436">bool</span>&nbsp;<span class="op" id="5262441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262444">return</span>&nbsp;<span class="builtintype" id="5262451">true</span><br>
<span class="lineno"></span><span class="op" id="5262456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262459">func</span>&nbsp;<span class="op" id="5262464">(</span><span class="ident" id="5262465">i</span>&nbsp;<span class="op" id="5262467">*</span><span class="ident" id="5262468">inputBytes</span><span class="op" id="5262478">)</span>&nbsp;<span class="ident" id="5262480">hasPrefix</span><span class="op" id="5262489">(</span><span class="ident" id="5262490">re</span>&nbsp;<span class="op" id="5262493">*</span><span class="ident" id="5262494">Regexp</span><span class="op" id="5262500">)</span>&nbsp;<span class="builtintype" id="5262502">bool</span>&nbsp;<span class="op" id="5262507">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262510">return</span>&nbsp;<span class="ident" id="5262517">bytes</span><span class="op" id="5262522">.</span><span class="ident" id="5262523">HasPrefix</span><span class="op" id="5262532">(</span><span class="ident" id="5262533">i</span><span class="op" id="5262534">.</span><span class="ident" id="5262535">str</span><span class="op" id="5262538">,</span>&nbsp;<span class="ident" id="5262540">re</span><span class="op" id="5262542">.</span><span class="ident" id="5262543">prefixBytes</span><span class="op" id="5262554">)</span><br>
<span class="lineno"></span><span class="op" id="5262556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262559">func</span>&nbsp;<span class="op" id="5262564">(</span><span class="ident" id="5262565">i</span>&nbsp;<span class="op" id="5262567">*</span><span class="ident" id="5262568">inputBytes</span><span class="op" id="5262578">)</span>&nbsp;<span class="ident" id="5262580">index</span><span class="op" id="5262585">(</span><span class="ident" id="5262586">re</span>&nbsp;<span class="op" id="5262589">*</span><span class="ident" id="5262590">Regexp</span><span class="op" id="5262596">,</span>&nbsp;<span class="ident" id="5262598">pos</span>&nbsp;<span class="builtintype" id="5262602">int</span><span class="op" id="5262605">)</span>&nbsp;<span class="builtintype" id="5262607">int</span>&nbsp;<span class="op" id="5262611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262614">return</span>&nbsp;<span class="ident" id="5262621">bytes</span><span class="op" id="5262626">.</span><span class="ident" id="5262627">Index</span><span class="op" id="5262632">(</span><span class="ident" id="5262633">i</span><span class="op" id="5262634">.</span><span class="ident" id="5262635">str</span><span class="op" id="5262638">[</span><span class="ident" id="5262639">pos</span><span class="op" id="5262642">:</span><span class="op" id="5262643">]</span><span class="op" id="5262644">,</span>&nbsp;<span class="ident" id="5262646">re</span><span class="op" id="5262648">.</span><span class="ident" id="5262649">prefixBytes</span><span class="op" id="5262660">)</span><br>
<span class="lineno">335</span><span class="op" id="5262662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262665">func</span>&nbsp;<span class="op" id="5262670">(</span><span class="ident" id="5262671">i</span>&nbsp;<span class="op" id="5262673">*</span><span class="ident" id="5262674">inputBytes</span><span class="op" id="5262684">)</span>&nbsp;<span class="ident" id="5262686">context</span><span class="op" id="5262693">(</span><span class="ident" id="5262694">pos</span>&nbsp;<span class="builtintype" id="5262698">int</span><span class="op" id="5262701">)</span>&nbsp;<span class="ident" id="5262703">syntax</span><span class="op" id="5262709">.</span><span class="ident" id="5262710">EmptyOp</span>&nbsp;<span class="op" id="5262718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262721">r1</span><span class="op" id="5262723">,</span>&nbsp;<span class="ident" id="5262725">r2</span>&nbsp;<span class="op" id="5262728">:=</span>&nbsp;<span class="ident" id="5262731">endOfText</span><span class="op" id="5262740">,</span>&nbsp;<span class="ident" id="5262742">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262753">if</span>&nbsp;<span class="ident" id="5262756">pos</span>&nbsp;<span class="op" id="5262760">&gt;</span>&nbsp;<span class="num" id="5262762">0</span>&nbsp;<span class="op" id="5262764">&amp;&amp;</span>&nbsp;<span class="ident" id="5262767">pos</span>&nbsp;<span class="op" id="5262771">&lt;=</span>&nbsp;<span class="builtinfunc" id="5262774">len</span><span class="op" id="5262777">(</span><span class="ident" id="5262778">i</span><span class="op" id="5262779">.</span><span class="ident" id="5262780">str</span><span class="op" id="5262783">)</span>&nbsp;<span class="op" id="5262785">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262789">r1</span><span class="op" id="5262791">,</span>&nbsp;<span class="ident" id="5262793">_</span>&nbsp;<span class="op" id="5262795">=</span>&nbsp;<span class="ident" id="5262797">utf8</span><span class="op" id="5262801">.</span><span class="ident" id="5262802">DecodeLastRune</span><span class="op" id="5262816">(</span><span class="ident" id="5262817">i</span><span class="op" id="5262818">.</span><span class="ident" id="5262819">str</span><span class="op" id="5262822">[</span><span class="op" id="5262823">:</span><span class="ident" id="5262824">pos</span><span class="op" id="5262827">]</span><span class="op" id="5262828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262834">if</span>&nbsp;<span class="ident" id="5262837">pos</span>&nbsp;<span class="op" id="5262841">&lt;</span>&nbsp;<span class="builtinfunc" id="5262843">len</span><span class="op" id="5262846">(</span><span class="ident" id="5262847">i</span><span class="op" id="5262848">.</span><span class="ident" id="5262849">str</span><span class="op" id="5262852">)</span>&nbsp;<span class="op" id="5262854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262858">r2</span><span class="op" id="5262860">,</span>&nbsp;<span class="ident" id="5262862">_</span>&nbsp;<span class="op" id="5262864">=</span>&nbsp;<span class="ident" id="5262866">utf8</span><span class="op" id="5262870">.</span><span class="ident" id="5262871">DecodeRune</span><span class="op" id="5262881">(</span><span class="ident" id="5262882">i</span><span class="op" id="5262883">.</span><span class="ident" id="5262884">str</span><span class="op" id="5262887">[</span><span class="ident" id="5262888">pos</span><span class="op" id="5262891">:</span><span class="op" id="5262892">]</span><span class="op" id="5262893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262896">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262899">return</span>&nbsp;<span class="ident" id="5262906">syntax</span><span class="op" id="5262912">.</span><span class="ident" id="5262913">EmptyOpContext</span><span class="op" id="5262927">(</span><span class="ident" id="5262928">r1</span><span class="op" id="5262930">,</span>&nbsp;<span class="ident" id="5262932">r2</span><span class="op" id="5262934">)</span><br>
<span class="lineno"></span><span class="op" id="5262936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262939">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5262974">type</span>&nbsp;<span class="ident" id="5262979">inputReader</span>&nbsp;<span class="keyword" id="5262991">struct</span>&nbsp;<span class="op" id="5262998">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263001">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263007">io</span><span class="op" id="5263009">.</span><span class="ident" id="5263010">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263022">atEOT</span>&nbsp;<span class="builtintype" id="5263028">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263034">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5263040">int</span><br>
<span class="lineno"></span><span class="op" id="5263044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5263047">func</span>&nbsp;<span class="op" id="5263052">(</span><span class="ident" id="5263053">i</span>&nbsp;<span class="op" id="5263055">*</span><span class="ident" id="5263056">inputReader</span><span class="op" id="5263067">)</span>&nbsp;<span class="ident" id="5263069">step</span><span class="op" id="5263073">(</span><span class="ident" id="5263074">pos</span>&nbsp;<span class="builtintype" id="5263078">int</span><span class="op" id="5263081">)</span>&nbsp;<span class="op" id="5263083">(</span><span class="builtintype" id="5263084">rune</span><span class="op" id="5263088">,</span>&nbsp;<span class="builtintype" id="5263090">int</span><span class="op" id="5263093">)</span>&nbsp;<span class="op" id="5263095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263098">if</span>&nbsp;<span class="op" id="5263101">!</span><span class="ident" id="5263102">i</span><span class="op" id="5263103">.</span><span class="ident" id="5263104">atEOT</span>&nbsp;<span class="op" id="5263110">&amp;&amp;</span>&nbsp;<span class="ident" id="5263113">pos</span>&nbsp;<span class="op" id="5263117">!=</span>&nbsp;<span class="ident" id="5263120">i</span><span class="op" id="5263121">.</span><span class="ident" id="5263122">pos</span>&nbsp;<span class="op" id="5263126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263130">return</span>&nbsp;<span class="ident" id="5263137">endOfText</span><span class="op" id="5263146">,</span>&nbsp;<span class="num" id="5263148">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263152">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263155">r</span><span class="op" id="5263156">,</span>&nbsp;<span class="ident" id="5263158">w</span><span class="op" id="5263159">,</span>&nbsp;<span class="ident" id="5263161">err</span>&nbsp;<span class="op" id="5263165">:=</span>&nbsp;<span class="ident" id="5263168">i</span><span class="op" id="5263169">.</span><span class="ident" id="5263170">r</span><span class="op" id="5263171">.</span><span class="ident" id="5263172">ReadRune</span><span class="op" id="5263180">(</span><span class="op" id="5263181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263184">if</span>&nbsp;<span class="ident" id="5263187">err</span>&nbsp;<span class="op" id="5263191">!=</span>&nbsp;<span class="ident" id="5263194">nil</span>&nbsp;<span class="op" id="5263198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263202">i</span><span class="op" id="5263203">.</span><span class="ident" id="5263204">atEOT</span>&nbsp;<span class="op" id="5263210">=</span>&nbsp;<span class="builtintype" id="5263212">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263219">return</span>&nbsp;<span class="ident" id="5263226">endOfText</span><span class="op" id="5263235">,</span>&nbsp;<span class="num" id="5263237">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263240">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263243">i</span><span class="op" id="5263244">.</span><span class="ident" id="5263245">pos</span>&nbsp;<span class="op" id="5263249">+=</span>&nbsp;<span class="ident" id="5263252">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263255">return</span>&nbsp;<span class="ident" id="5263262">r</span><span class="op" id="5263263">,</span>&nbsp;<span class="ident" id="5263265">w</span><br>
<span class="lineno"></span><span class="op" id="5263267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5263270">func</span>&nbsp;<span class="op" id="5263275">(</span><span class="ident" id="5263276">i</span>&nbsp;<span class="op" id="5263278">*</span><span class="ident" id="5263279">inputReader</span><span class="op" id="5263290">)</span>&nbsp;<span class="ident" id="5263292">canCheckPrefix</span><span class="op" id="5263306">(</span><span class="op" id="5263307">)</span>&nbsp;<span class="builtintype" id="5263309">bool</span>&nbsp;<span class="op" id="5263314">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263317">return</span>&nbsp;<span class="builtintype" id="5263324">false</span><br>
<span class="lineno"></span><span class="op" id="5263330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5263333">func</span>&nbsp;<span class="op" id="5263338">(</span><span class="ident" id="5263339">i</span>&nbsp;<span class="op" id="5263341">*</span><span class="ident" id="5263342">inputReader</span><span class="op" id="5263353">)</span>&nbsp;<span class="ident" id="5263355">hasPrefix</span><span class="op" id="5263364">(</span><span class="ident" id="5263365">re</span>&nbsp;<span class="op" id="5263368">*</span><span class="ident" id="5263369">Regexp</span><span class="op" id="5263375">)</span>&nbsp;<span class="builtintype" id="5263377">bool</span>&nbsp;<span class="op" id="5263382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263385">return</span>&nbsp;<span class="builtintype" id="5263392">false</span><br>
<span class="lineno">375</span><span class="op" id="5263398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5263401">func</span>&nbsp;<span class="op" id="5263406">(</span><span class="ident" id="5263407">i</span>&nbsp;<span class="op" id="5263409">*</span><span class="ident" id="5263410">inputReader</span><span class="op" id="5263421">)</span>&nbsp;<span class="ident" id="5263423">index</span><span class="op" id="5263428">(</span><span class="ident" id="5263429">re</span>&nbsp;<span class="op" id="5263432">*</span><span class="ident" id="5263433">Regexp</span><span class="op" id="5263439">,</span>&nbsp;<span class="ident" id="5263441">pos</span>&nbsp;<span class="builtintype" id="5263445">int</span><span class="op" id="5263448">)</span>&nbsp;<span class="builtintype" id="5263450">int</span>&nbsp;<span class="op" id="5263454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263457">return</span>&nbsp;<span class="op" id="5263464">-</span><span class="num" id="5263465">1</span><br>
<span class="lineno"></span><span class="op" id="5263467">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5263470">func</span>&nbsp;<span class="op" id="5263475">(</span><span class="ident" id="5263476">i</span>&nbsp;<span class="op" id="5263478">*</span><span class="ident" id="5263479">inputReader</span><span class="op" id="5263490">)</span>&nbsp;<span class="ident" id="5263492">context</span><span class="op" id="5263499">(</span><span class="ident" id="5263500">pos</span>&nbsp;<span class="builtintype" id="5263504">int</span><span class="op" id="5263507">)</span>&nbsp;<span class="ident" id="5263509">syntax</span><span class="op" id="5263515">.</span><span class="ident" id="5263516">EmptyOp</span>&nbsp;<span class="op" id="5263524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263527">return</span>&nbsp;<span class="num" id="5263534">0</span><br>
<span class="lineno"></span><span class="op" id="5263536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5263539">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5263607">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5263676">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5263735">func</span>&nbsp;<span class="op" id="5263740">(</span><span class="ident" id="5263741">re</span>&nbsp;<span class="op" id="5263744">*</span><span class="ident" id="5263745">Regexp</span><span class="op" id="5263751">)</span>&nbsp;<span class="ident" id="5263753">LiteralPrefix</span><span class="op" id="5263766">(</span><span class="op" id="5263767">)</span>&nbsp;<span class="op" id="5263769">(</span><span class="ident" id="5263770">prefix</span>&nbsp;<span class="builtintype" id="5263777">string</span><span class="op" id="5263783">,</span>&nbsp;<span class="ident" id="5263785">complete</span>&nbsp;<span class="builtintype" id="5263794">bool</span><span class="op" id="5263798">)</span>&nbsp;<span class="op" id="5263800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263803">return</span>&nbsp;<span class="ident" id="5263810">re</span><span class="op" id="5263812">.</span><span class="ident" id="5263813">prefix</span><span class="op" id="5263819">,</span>&nbsp;<span class="ident" id="5263821">re</span><span class="op" id="5263823">.</span><span class="ident" id="5263824">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="5263839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5263842">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5263913">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5263928">func</span>&nbsp;<span class="op" id="5263933">(</span><span class="ident" id="5263934">re</span>&nbsp;<span class="op" id="5263937">*</span><span class="ident" id="5263938">Regexp</span><span class="op" id="5263944">)</span>&nbsp;<span class="ident" id="5263946">MatchReader</span><span class="op" id="5263957">(</span><span class="ident" id="5263958">r</span>&nbsp;<span class="ident" id="5263960">io</span><span class="op" id="5263962">.</span><span class="ident" id="5263963">RuneReader</span><span class="op" id="5263973">)</span>&nbsp;<span class="builtintype" id="5263975">bool</span>&nbsp;<span class="op" id="5263980">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263983">return</span>&nbsp;<span class="ident" id="5263990">re</span><span class="op" id="5263992">.</span><span class="ident" id="5263993">doExecute</span><span class="op" id="5264002">(</span><span class="ident" id="5264003">r</span><span class="op" id="5264004">,</span>&nbsp;<span class="ident" id="5264006">nil</span><span class="op" id="5264009">,</span>&nbsp;<span class="string" id="5264011">&#34;&#34;</span><span class="op" id="5264013">,</span>&nbsp;<span class="num" id="5264015">0</span><span class="op" id="5264016">,</span>&nbsp;<span class="num" id="5264018">0</span><span class="op" id="5264019">)</span>&nbsp;<span class="op" id="5264021">!=</span>&nbsp;<span class="ident" id="5264024">nil</span><br>
<span class="lineno"></span><span class="op" id="5264028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264031">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5264095">func</span>&nbsp;<span class="op" id="5264100">(</span><span class="ident" id="5264101">re</span>&nbsp;<span class="op" id="5264104">*</span><span class="ident" id="5264105">Regexp</span><span class="op" id="5264111">)</span>&nbsp;<span class="ident" id="5264113">MatchString</span><span class="op" id="5264124">(</span><span class="ident" id="5264125">s</span>&nbsp;<span class="builtintype" id="5264127">string</span><span class="op" id="5264133">)</span>&nbsp;<span class="builtintype" id="5264135">bool</span>&nbsp;<span class="op" id="5264140">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264143">return</span>&nbsp;<span class="ident" id="5264150">re</span><span class="op" id="5264152">.</span><span class="ident" id="5264153">doExecute</span><span class="op" id="5264162">(</span><span class="ident" id="5264163">nil</span><span class="op" id="5264166">,</span>&nbsp;<span class="ident" id="5264168">nil</span><span class="op" id="5264171">,</span>&nbsp;<span class="ident" id="5264173">s</span><span class="op" id="5264174">,</span>&nbsp;<span class="num" id="5264176">0</span><span class="op" id="5264177">,</span>&nbsp;<span class="num" id="5264179">0</span><span class="op" id="5264180">)</span>&nbsp;<span class="op" id="5264182">!=</span>&nbsp;<span class="ident" id="5264185">nil</span><br>
<span class="lineno"></span><span class="op" id="5264189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264192">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5264254">func</span>&nbsp;<span class="op" id="5264259">(</span><span class="ident" id="5264260">re</span>&nbsp;<span class="op" id="5264263">*</span><span class="ident" id="5264264">Regexp</span><span class="op" id="5264270">)</span>&nbsp;<span class="ident" id="5264272">Match</span><span class="op" id="5264277">(</span><span class="ident" id="5264278">b</span>&nbsp;<span class="op" id="5264280">[</span><span class="op" id="5264281">]</span><span class="builtintype" id="5264282">byte</span><span class="op" id="5264286">)</span>&nbsp;<span class="builtintype" id="5264288">bool</span>&nbsp;<span class="op" id="5264293">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264296">return</span>&nbsp;<span class="ident" id="5264303">re</span><span class="op" id="5264305">.</span><span class="ident" id="5264306">doExecute</span><span class="op" id="5264315">(</span><span class="ident" id="5264316">nil</span><span class="op" id="5264319">,</span>&nbsp;<span class="ident" id="5264321">b</span><span class="op" id="5264322">,</span>&nbsp;<span class="string" id="5264324">&#34;&#34;</span><span class="op" id="5264326">,</span>&nbsp;<span class="num" id="5264328">0</span><span class="op" id="5264329">,</span>&nbsp;<span class="num" id="5264331">0</span><span class="op" id="5264332">)</span>&nbsp;<span class="op" id="5264334">!=</span>&nbsp;<span class="ident" id="5264337">nil</span><br>
<span class="lineno"></span><span class="op" id="5264341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264344">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="5264420">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="5264497">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5264527">func</span>&nbsp;<span class="ident" id="5264532">MatchReader</span><span class="op" id="5264543">(</span><span class="ident" id="5264544">pattern</span>&nbsp;<span class="builtintype" id="5264552">string</span><span class="op" id="5264558">,</span>&nbsp;<span class="ident" id="5264560">r</span>&nbsp;<span class="ident" id="5264562">io</span><span class="op" id="5264564">.</span><span class="ident" id="5264565">RuneReader</span><span class="op" id="5264575">)</span>&nbsp;<span class="op" id="5264577">(</span><span class="ident" id="5264578">matched</span>&nbsp;<span class="builtintype" id="5264586">bool</span><span class="op" id="5264590">,</span>&nbsp;<span class="ident" id="5264592">err</span>&nbsp;<span class="builtintype" id="5264596">error</span><span class="op" id="5264601">)</span>&nbsp;<span class="op" id="5264603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264606">re</span><span class="op" id="5264608">,</span>&nbsp;<span class="ident" id="5264610">err</span>&nbsp;<span class="op" id="5264614">:=</span>&nbsp;<span class="ident" id="5264617">Compile</span><span class="op" id="5264624">(</span><span class="ident" id="5264625">pattern</span><span class="op" id="5264632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264635">if</span>&nbsp;<span class="ident" id="5264638">err</span>&nbsp;<span class="op" id="5264642">!=</span>&nbsp;<span class="ident" id="5264645">nil</span>&nbsp;<span class="op" id="5264649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264653">return</span>&nbsp;<span class="builtintype" id="5264660">false</span><span class="op" id="5264665">,</span>&nbsp;<span class="ident" id="5264667">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264675">return</span>&nbsp;<span class="ident" id="5264682">re</span><span class="op" id="5264684">.</span><span class="ident" id="5264685">MatchReader</span><span class="op" id="5264696">(</span><span class="ident" id="5264697">r</span><span class="op" id="5264698">)</span><span class="op" id="5264699">,</span>&nbsp;<span class="ident" id="5264701">nil</span><br>
<span class="lineno"></span><span class="op" id="5264705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264708">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="5264767">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5264819">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5264868">func</span>&nbsp;<span class="ident" id="5264873">MatchString</span><span class="op" id="5264884">(</span><span class="ident" id="5264885">pattern</span>&nbsp;<span class="builtintype" id="5264893">string</span><span class="op" id="5264899">,</span>&nbsp;<span class="ident" id="5264901">s</span>&nbsp;<span class="builtintype" id="5264903">string</span><span class="op" id="5264909">)</span>&nbsp;<span class="op" id="5264911">(</span><span class="ident" id="5264912">matched</span>&nbsp;<span class="builtintype" id="5264920">bool</span><span class="op" id="5264924">,</span>&nbsp;<span class="ident" id="5264926">err</span>&nbsp;<span class="builtintype" id="5264930">error</span><span class="op" id="5264935">)</span>&nbsp;<span class="op" id="5264937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264940">re</span><span class="op" id="5264942">,</span>&nbsp;<span class="ident" id="5264944">err</span>&nbsp;<span class="op" id="5264948">:=</span>&nbsp;<span class="ident" id="5264951">Compile</span><span class="op" id="5264958">(</span><span class="ident" id="5264959">pattern</span><span class="op" id="5264966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264969">if</span>&nbsp;<span class="ident" id="5264972">err</span>&nbsp;<span class="op" id="5264976">!=</span>&nbsp;<span class="ident" id="5264979">nil</span>&nbsp;<span class="op" id="5264983">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264987">return</span>&nbsp;<span class="builtintype" id="5264994">false</span><span class="op" id="5264999">,</span>&nbsp;<span class="ident" id="5265001">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265009">return</span>&nbsp;<span class="ident" id="5265016">re</span><span class="op" id="5265018">.</span><span class="ident" id="5265019">MatchString</span><span class="op" id="5265030">(</span><span class="ident" id="5265031">s</span><span class="op" id="5265032">)</span><span class="op" id="5265033">,</span>&nbsp;<span class="ident" id="5265035">nil</span><br>
<span class="lineno"></span><span class="op" id="5265039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="5265042">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5265095">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5265151">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5265200">func</span>&nbsp;<span class="ident" id="5265205">Match</span><span class="op" id="5265210">(</span><span class="ident" id="5265211">pattern</span>&nbsp;<span class="builtintype" id="5265219">string</span><span class="op" id="5265225">,</span>&nbsp;<span class="ident" id="5265227">b</span>&nbsp;<span class="op" id="5265229">[</span><span class="op" id="5265230">]</span><span class="builtintype" id="5265231">byte</span><span class="op" id="5265235">)</span>&nbsp;<span class="op" id="5265237">(</span><span class="ident" id="5265238">matched</span>&nbsp;<span class="builtintype" id="5265246">bool</span><span class="op" id="5265250">,</span>&nbsp;<span class="ident" id="5265252">err</span>&nbsp;<span class="builtintype" id="5265256">error</span><span class="op" id="5265261">)</span>&nbsp;<span class="op" id="5265263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265266">re</span><span class="op" id="5265268">,</span>&nbsp;<span class="ident" id="5265270">err</span>&nbsp;<span class="op" id="5265274">:=</span>&nbsp;<span class="ident" id="5265277">Compile</span><span class="op" id="5265284">(</span><span class="ident" id="5265285">pattern</span><span class="op" id="5265292">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265295">if</span>&nbsp;<span class="ident" id="5265298">err</span>&nbsp;<span class="op" id="5265302">!=</span>&nbsp;<span class="ident" id="5265305">nil</span>&nbsp;<span class="op" id="5265309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265313">return</span>&nbsp;<span class="builtintype" id="5265320">false</span><span class="op" id="5265325">,</span>&nbsp;<span class="ident" id="5265327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265335">return</span>&nbsp;<span class="ident" id="5265342">re</span><span class="op" id="5265344">.</span><span class="ident" id="5265345">Match</span><span class="op" id="5265350">(</span><span class="ident" id="5265351">b</span><span class="op" id="5265352">)</span><span class="op" id="5265353">,</span>&nbsp;<span class="ident" id="5265355">nil</span><br>
<span class="lineno"></span><span class="op" id="5265359">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="5265362">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5265437">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5265515">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5265591">func</span>&nbsp;<span class="op" id="5265596">(</span><span class="ident" id="5265597">re</span>&nbsp;<span class="op" id="5265600">*</span><span class="ident" id="5265601">Regexp</span><span class="op" id="5265607">)</span>&nbsp;<span class="ident" id="5265609">ReplaceAllString</span><span class="op" id="5265625">(</span><span class="ident" id="5265626">src</span><span class="op" id="5265629">,</span>&nbsp;<span class="ident" id="5265631">repl</span>&nbsp;<span class="builtintype" id="5265636">string</span><span class="op" id="5265642">)</span>&nbsp;<span class="builtintype" id="5265644">string</span>&nbsp;<span class="op" id="5265651">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265654">n</span>&nbsp;<span class="op" id="5265656">:=</span>&nbsp;<span class="num" id="5265659">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265662">if</span>&nbsp;<span class="ident" id="5265665">strings</span><span class="op" id="5265672">.</span><span class="ident" id="5265673">Index</span><span class="op" id="5265678">(</span><span class="ident" id="5265679">repl</span><span class="op" id="5265683">,</span>&nbsp;<span class="string" id="5265685">&#34;$&#34;</span><span class="op" id="5265688">)</span>&nbsp;<span class="op" id="5265690">&gt;=</span>&nbsp;<span class="num" id="5265693">0</span>&nbsp;<span class="op" id="5265695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265699">n</span>&nbsp;<span class="op" id="5265701">=</span>&nbsp;<span class="num" id="5265703">2</span>&nbsp;<span class="op" id="5265705">*</span>&nbsp;<span class="op" id="5265707">(</span><span class="ident" id="5265708">re</span><span class="op" id="5265710">.</span><span class="ident" id="5265711">numSubexp</span>&nbsp;<span class="op" id="5265721">+</span>&nbsp;<span class="num" id="5265723">1</span><span class="op" id="5265724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265730">b</span>&nbsp;<span class="op" id="5265732">:=</span>&nbsp;<span class="ident" id="5265735">re</span><span class="op" id="5265737">.</span><span class="ident" id="5265738">replaceAll</span><span class="op" id="5265748">(</span><span class="ident" id="5265749">nil</span><span class="op" id="5265752">,</span>&nbsp;<span class="ident" id="5265754">src</span><span class="op" id="5265757">,</span>&nbsp;<span class="ident" id="5265759">n</span><span class="op" id="5265760">,</span>&nbsp;<span class="keyword" id="5265762">func</span><span class="op" id="5265766">(</span><span class="ident" id="5265767">dst</span>&nbsp;<span class="op" id="5265771">[</span><span class="op" id="5265772">]</span><span class="builtintype" id="5265773">byte</span><span class="op" id="5265777">,</span>&nbsp;<span class="ident" id="5265779">match</span>&nbsp;<span class="op" id="5265785">[</span><span class="op" id="5265786">]</span><span class="builtintype" id="5265787">int</span><span class="op" id="5265790">)</span>&nbsp;<span class="op" id="5265792">[</span><span class="op" id="5265793">]</span><span class="builtintype" id="5265794">byte</span>&nbsp;<span class="op" id="5265799">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265803">return</span>&nbsp;<span class="ident" id="5265810">re</span><span class="op" id="5265812">.</span><span class="ident" id="5265813">expand</span><span class="op" id="5265819">(</span><span class="ident" id="5265820">dst</span><span class="op" id="5265823">,</span>&nbsp;<span class="ident" id="5265825">repl</span><span class="op" id="5265829">,</span>&nbsp;<span class="ident" id="5265831">nil</span><span class="op" id="5265834">,</span>&nbsp;<span class="ident" id="5265836">src</span><span class="op" id="5265839">,</span>&nbsp;<span class="ident" id="5265841">match</span><span class="op" id="5265846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265849">}</span><span class="op" id="5265850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265853">return</span>&nbsp;<span class="builtintype" id="5265860">string</span><span class="op" id="5265866">(</span><span class="ident" id="5265867">b</span><span class="op" id="5265868">)</span><br>
<span class="lineno"></span><span class="op" id="5265870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="5265873">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5265955">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="5266039">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5266064">func</span>&nbsp;<span class="op" id="5266069">(</span><span class="ident" id="5266070">re</span>&nbsp;<span class="op" id="5266073">*</span><span class="ident" id="5266074">Regexp</span><span class="op" id="5266080">)</span>&nbsp;<span class="ident" id="5266082">ReplaceAllLiteralString</span><span class="op" id="5266105">(</span><span class="ident" id="5266106">src</span><span class="op" id="5266109">,</span>&nbsp;<span class="ident" id="5266111">repl</span>&nbsp;<span class="builtintype" id="5266116">string</span><span class="op" id="5266122">)</span>&nbsp;<span class="builtintype" id="5266124">string</span>&nbsp;<span class="op" id="5266131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266134">return</span>&nbsp;<span class="builtintype" id="5266141">string</span><span class="op" id="5266147">(</span><span class="ident" id="5266148">re</span><span class="op" id="5266150">.</span><span class="ident" id="5266151">replaceAll</span><span class="op" id="5266161">(</span><span class="ident" id="5266162">nil</span><span class="op" id="5266165">,</span>&nbsp;<span class="ident" id="5266167">src</span><span class="op" id="5266170">,</span>&nbsp;<span class="num" id="5266172">2</span><span class="op" id="5266173">,</span>&nbsp;<span class="keyword" id="5266175">func</span><span class="op" id="5266179">(</span><span class="ident" id="5266180">dst</span>&nbsp;<span class="op" id="5266184">[</span><span class="op" id="5266185">]</span><span class="builtintype" id="5266186">byte</span><span class="op" id="5266190">,</span>&nbsp;<span class="ident" id="5266192">match</span>&nbsp;<span class="op" id="5266198">[</span><span class="op" id="5266199">]</span><span class="builtintype" id="5266200">int</span><span class="op" id="5266203">)</span>&nbsp;<span class="op" id="5266205">[</span><span class="op" id="5266206">]</span><span class="builtintype" id="5266207">byte</span>&nbsp;<span class="op" id="5266212">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266216">return</span>&nbsp;<span class="builtinfunc" id="5266223">append</span><span class="op" id="5266229">(</span><span class="ident" id="5266230">dst</span><span class="op" id="5266233">,</span>&nbsp;<span class="ident" id="5266235">repl</span><span class="op" id="5266239">...</span><span class="op" id="5266242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266245">}</span><span class="op" id="5266246">)</span><span class="op" id="5266247">)</span><br>
<span class="lineno"></span><span class="op" id="5266249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5266252">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="5266326">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5266400">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="5266478">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5266513">func</span>&nbsp;<span class="op" id="5266518">(</span><span class="ident" id="5266519">re</span>&nbsp;<span class="op" id="5266522">*</span><span class="ident" id="5266523">Regexp</span><span class="op" id="5266529">)</span>&nbsp;<span class="ident" id="5266531">ReplaceAllStringFunc</span><span class="op" id="5266551">(</span><span class="ident" id="5266552">src</span>&nbsp;<span class="builtintype" id="5266556">string</span><span class="op" id="5266562">,</span>&nbsp;<span class="ident" id="5266564">repl</span>&nbsp;<span class="keyword" id="5266569">func</span><span class="op" id="5266573">(</span><span class="builtintype" id="5266574">string</span><span class="op" id="5266580">)</span>&nbsp;<span class="builtintype" id="5266582">string</span><span class="op" id="5266588">)</span>&nbsp;<span class="builtintype" id="5266590">string</span>&nbsp;<span class="op" id="5266597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266600">b</span>&nbsp;<span class="op" id="5266602">:=</span>&nbsp;<span class="ident" id="5266605">re</span><span class="op" id="5266607">.</span><span class="ident" id="5266608">replaceAll</span><span class="op" id="5266618">(</span><span class="ident" id="5266619">nil</span><span class="op" id="5266622">,</span>&nbsp;<span class="ident" id="5266624">src</span><span class="op" id="5266627">,</span>&nbsp;<span class="num" id="5266629">2</span><span class="op" id="5266630">,</span>&nbsp;<span class="keyword" id="5266632">func</span><span class="op" id="5266636">(</span><span class="ident" id="5266637">dst</span>&nbsp;<span class="op" id="5266641">[</span><span class="op" id="5266642">]</span><span class="builtintype" id="5266643">byte</span><span class="op" id="5266647">,</span>&nbsp;<span class="ident" id="5266649">match</span>&nbsp;<span class="op" id="5266655">[</span><span class="op" id="5266656">]</span><span class="builtintype" id="5266657">int</span><span class="op" id="5266660">)</span>&nbsp;<span class="op" id="5266662">[</span><span class="op" id="5266663">]</span><span class="builtintype" id="5266664">byte</span>&nbsp;<span class="op" id="5266669">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266673">return</span>&nbsp;<span class="builtinfunc" id="5266680">append</span><span class="op" id="5266686">(</span><span class="ident" id="5266687">dst</span><span class="op" id="5266690">,</span>&nbsp;<span class="ident" id="5266692">repl</span><span class="op" id="5266696">(</span><span class="ident" id="5266697">src</span><span class="op" id="5266700">[</span><span class="ident" id="5266701">match</span><span class="op" id="5266706">[</span><span class="num" id="5266707">0</span><span class="op" id="5266708">]</span><span class="op" id="5266709">:</span><span class="ident" id="5266710">match</span><span class="op" id="5266715">[</span><span class="num" id="5266716">1</span><span class="op" id="5266717">]</span><span class="op" id="5266718">]</span><span class="op" id="5266719">)</span><span class="op" id="5266720">...</span><span class="op" id="5266723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266726">}</span><span class="op" id="5266727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266730">return</span>&nbsp;<span class="builtintype" id="5266737">string</span><span class="op" id="5266743">(</span><span class="ident" id="5266744">b</span><span class="op" id="5266745">)</span><br>
<span class="lineno"></span><span class="op" id="5266747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="5266750">func</span>&nbsp;<span class="op" id="5266755">(</span><span class="ident" id="5266756">re</span>&nbsp;<span class="op" id="5266759">*</span><span class="ident" id="5266760">Regexp</span><span class="op" id="5266766">)</span>&nbsp;<span class="ident" id="5266768">replaceAll</span><span class="op" id="5266778">(</span><span class="ident" id="5266779">bsrc</span>&nbsp;<span class="op" id="5266784">[</span><span class="op" id="5266785">]</span><span class="builtintype" id="5266786">byte</span><span class="op" id="5266790">,</span>&nbsp;<span class="ident" id="5266792">src</span>&nbsp;<span class="builtintype" id="5266796">string</span><span class="op" id="5266802">,</span>&nbsp;<span class="ident" id="5266804">nmatch</span>&nbsp;<span class="builtintype" id="5266811">int</span><span class="op" id="5266814">,</span>&nbsp;<span class="ident" id="5266816">repl</span>&nbsp;<span class="keyword" id="5266821">func</span><span class="op" id="5266825">(</span><span class="ident" id="5266826">dst</span>&nbsp;<span class="op" id="5266830">[</span><span class="op" id="5266831">]</span><span class="builtintype" id="5266832">byte</span><span class="op" id="5266836">,</span>&nbsp;<span class="ident" id="5266838">m</span>&nbsp;<span class="op" id="5266840">[</span><span class="op" id="5266841">]</span><span class="builtintype" id="5266842">int</span><span class="op" id="5266845">)</span>&nbsp;<span class="op" id="5266847">[</span><span class="op" id="5266848">]</span><span class="builtintype" id="5266849">byte</span><span class="op" id="5266853">)</span>&nbsp;<span class="op" id="5266855">[</span><span class="op" id="5266856">]</span><span class="builtintype" id="5266857">byte</span>&nbsp;<span class="op" id="5266862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266865">lastMatchEnd</span>&nbsp;<span class="op" id="5266878">:=</span>&nbsp;<span class="num" id="5266881">0</span>&nbsp;<span class="comment" id="5266883">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266925">searchPos</span>&nbsp;<span class="op" id="5266935">:=</span>&nbsp;<span class="num" id="5266938">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5266943">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266987">var</span>&nbsp;<span class="ident" id="5266991">buf</span>&nbsp;<span class="op" id="5266995">[</span><span class="op" id="5266996">]</span><span class="builtintype" id="5266997">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267003">var</span>&nbsp;<span class="ident" id="5267007">endPos</span>&nbsp;<span class="builtintype" id="5267014">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267019">if</span>&nbsp;<span class="ident" id="5267022">bsrc</span>&nbsp;<span class="op" id="5267027">!=</span>&nbsp;<span class="ident" id="5267030">nil</span>&nbsp;<span class="op" id="5267034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267038">endPos</span>&nbsp;<span class="op" id="5267045">=</span>&nbsp;<span class="builtinfunc" id="5267047">len</span><span class="op" id="5267050">(</span><span class="ident" id="5267051">bsrc</span><span class="op" id="5267055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267058">}</span>&nbsp;<span class="keyword" id="5267060">else</span>&nbsp;<span class="op" id="5267065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267069">endPos</span>&nbsp;<span class="op" id="5267076">=</span>&nbsp;<span class="builtinfunc" id="5267078">len</span><span class="op" id="5267081">(</span><span class="ident" id="5267082">src</span><span class="op" id="5267085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267088">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267091">for</span>&nbsp;<span class="ident" id="5267095">searchPos</span>&nbsp;<span class="op" id="5267105">&lt;=</span>&nbsp;<span class="ident" id="5267108">endPos</span>&nbsp;<span class="op" id="5267115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267119">a</span>&nbsp;<span class="op" id="5267121">:=</span>&nbsp;<span class="ident" id="5267124">re</span><span class="op" id="5267126">.</span><span class="ident" id="5267127">doExecute</span><span class="op" id="5267136">(</span><span class="ident" id="5267137">nil</span><span class="op" id="5267140">,</span>&nbsp;<span class="ident" id="5267142">bsrc</span><span class="op" id="5267146">,</span>&nbsp;<span class="ident" id="5267148">src</span><span class="op" id="5267151">,</span>&nbsp;<span class="ident" id="5267153">searchPos</span><span class="op" id="5267162">,</span>&nbsp;<span class="ident" id="5267164">nmatch</span><span class="op" id="5267170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267174">if</span>&nbsp;<span class="builtinfunc" id="5267177">len</span><span class="op" id="5267180">(</span><span class="ident" id="5267181">a</span><span class="op" id="5267182">)</span>&nbsp;<span class="op" id="5267184">==</span>&nbsp;<span class="num" id="5267187">0</span>&nbsp;<span class="op" id="5267189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267194">break</span>&nbsp;<span class="comment" id="5267200">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267221">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267226">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267280">if</span>&nbsp;<span class="ident" id="5267283">bsrc</span>&nbsp;<span class="op" id="5267288">!=</span>&nbsp;<span class="ident" id="5267291">nil</span>&nbsp;<span class="op" id="5267295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267300">buf</span>&nbsp;<span class="op" id="5267304">=</span>&nbsp;<span class="builtinfunc" id="5267306">append</span><span class="op" id="5267312">(</span><span class="ident" id="5267313">buf</span><span class="op" id="5267316">,</span>&nbsp;<span class="ident" id="5267318">bsrc</span><span class="op" id="5267322">[</span><span class="ident" id="5267323">lastMatchEnd</span><span class="op" id="5267335">:</span><span class="ident" id="5267336">a</span><span class="op" id="5267337">[</span><span class="num" id="5267338">0</span><span class="op" id="5267339">]</span><span class="op" id="5267340">]</span><span class="op" id="5267341">...</span><span class="op" id="5267344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267348">}</span>&nbsp;<span class="keyword" id="5267350">else</span>&nbsp;<span class="op" id="5267355">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267360">buf</span>&nbsp;<span class="op" id="5267364">=</span>&nbsp;<span class="builtinfunc" id="5267366">append</span><span class="op" id="5267372">(</span><span class="ident" id="5267373">buf</span><span class="op" id="5267376">,</span>&nbsp;<span class="ident" id="5267378">src</span><span class="op" id="5267381">[</span><span class="ident" id="5267382">lastMatchEnd</span><span class="op" id="5267394">:</span><span class="ident" id="5267395">a</span><span class="op" id="5267396">[</span><span class="num" id="5267397">0</span><span class="op" id="5267398">]</span><span class="op" id="5267399">]</span><span class="op" id="5267400">...</span><span class="op" id="5267403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267412">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267476">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267540">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267601">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267646">if</span>&nbsp;<span class="ident" id="5267649">a</span><span class="op" id="5267650">[</span><span class="num" id="5267651">1</span><span class="op" id="5267652">]</span>&nbsp;<span class="op" id="5267654">&gt;</span>&nbsp;<span class="ident" id="5267656">lastMatchEnd</span>&nbsp;<span class="op" id="5267669">||</span>&nbsp;<span class="ident" id="5267672">a</span><span class="op" id="5267673">[</span><span class="num" id="5267674">0</span><span class="op" id="5267675">]</span>&nbsp;<span class="op" id="5267677">==</span>&nbsp;<span class="num" id="5267680">0</span>&nbsp;<span class="op" id="5267682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267687">buf</span>&nbsp;<span class="op" id="5267691">=</span>&nbsp;<span class="ident" id="5267693">repl</span><span class="op" id="5267697">(</span><span class="ident" id="5267698">buf</span><span class="op" id="5267701">,</span>&nbsp;<span class="ident" id="5267703">a</span><span class="op" id="5267704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267708">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267712">lastMatchEnd</span>&nbsp;<span class="op" id="5267725">=</span>&nbsp;<span class="ident" id="5267727">a</span><span class="op" id="5267728">[</span><span class="num" id="5267729">1</span><span class="op" id="5267730">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267735">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267804">var</span>&nbsp;<span class="ident" id="5267808">width</span>&nbsp;<span class="builtintype" id="5267814">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267820">if</span>&nbsp;<span class="ident" id="5267823">bsrc</span>&nbsp;<span class="op" id="5267828">!=</span>&nbsp;<span class="ident" id="5267831">nil</span>&nbsp;<span class="op" id="5267835">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267840">_</span><span class="op" id="5267841">,</span>&nbsp;<span class="ident" id="5267843">width</span>&nbsp;<span class="op" id="5267849">=</span>&nbsp;<span class="ident" id="5267851">utf8</span><span class="op" id="5267855">.</span><span class="ident" id="5267856">DecodeRune</span><span class="op" id="5267866">(</span><span class="ident" id="5267867">bsrc</span><span class="op" id="5267871">[</span><span class="ident" id="5267872">searchPos</span><span class="op" id="5267881">:</span><span class="op" id="5267882">]</span><span class="op" id="5267883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267887">}</span>&nbsp;<span class="keyword" id="5267889">else</span>&nbsp;<span class="op" id="5267894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267899">_</span><span class="op" id="5267900">,</span>&nbsp;<span class="ident" id="5267902">width</span>&nbsp;<span class="op" id="5267908">=</span>&nbsp;<span class="ident" id="5267910">utf8</span><span class="op" id="5267914">.</span><span class="ident" id="5267915">DecodeRuneInString</span><span class="op" id="5267933">(</span><span class="ident" id="5267934">src</span><span class="op" id="5267937">[</span><span class="ident" id="5267938">searchPos</span><span class="op" id="5267947">:</span><span class="op" id="5267948">]</span><span class="op" id="5267949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267957">if</span>&nbsp;<span class="ident" id="5267960">searchPos</span><span class="op" id="5267969">+</span><span class="ident" id="5267970">width</span>&nbsp;<span class="op" id="5267976">&gt;</span>&nbsp;<span class="ident" id="5267978">a</span><span class="op" id="5267979">[</span><span class="num" id="5267980">1</span><span class="op" id="5267981">]</span>&nbsp;<span class="op" id="5267983">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267988">searchPos</span>&nbsp;<span class="op" id="5267998">+=</span>&nbsp;<span class="ident" id="5268001">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268009">}</span>&nbsp;<span class="keyword" id="5268011">else</span>&nbsp;<span class="keyword" id="5268016">if</span>&nbsp;<span class="ident" id="5268019">searchPos</span><span class="op" id="5268028">+</span><span class="num" id="5268029">1</span>&nbsp;<span class="op" id="5268031">&gt;</span>&nbsp;<span class="ident" id="5268033">a</span><span class="op" id="5268034">[</span><span class="num" id="5268035">1</span><span class="op" id="5268036">]</span>&nbsp;<span class="op" id="5268038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268043">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268100">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268165">searchPos</span><span class="op" id="5268174">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268179">}</span>&nbsp;<span class="keyword" id="5268181">else</span>&nbsp;<span class="op" id="5268186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268191">searchPos</span>&nbsp;<span class="op" id="5268201">=</span>&nbsp;<span class="ident" id="5268203">a</span><span class="op" id="5268204">[</span><span class="num" id="5268205">1</span><span class="op" id="5268206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268217">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268273">if</span>&nbsp;<span class="ident" id="5268276">bsrc</span>&nbsp;<span class="op" id="5268281">!=</span>&nbsp;<span class="ident" id="5268284">nil</span>&nbsp;<span class="op" id="5268288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268292">buf</span>&nbsp;<span class="op" id="5268296">=</span>&nbsp;<span class="builtinfunc" id="5268298">append</span><span class="op" id="5268304">(</span><span class="ident" id="5268305">buf</span><span class="op" id="5268308">,</span>&nbsp;<span class="ident" id="5268310">bsrc</span><span class="op" id="5268314">[</span><span class="ident" id="5268315">lastMatchEnd</span><span class="op" id="5268327">:</span><span class="op" id="5268328">]</span><span class="op" id="5268329">...</span><span class="op" id="5268332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268335">}</span>&nbsp;<span class="keyword" id="5268337">else</span>&nbsp;<span class="op" id="5268342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268346">buf</span>&nbsp;<span class="op" id="5268350">=</span>&nbsp;<span class="builtinfunc" id="5268352">append</span><span class="op" id="5268358">(</span><span class="ident" id="5268359">buf</span><span class="op" id="5268362">,</span>&nbsp;<span class="ident" id="5268364">src</span><span class="op" id="5268367">[</span><span class="ident" id="5268368">lastMatchEnd</span><span class="op" id="5268380">:</span><span class="op" id="5268381">]</span><span class="op" id="5268382">...</span><span class="op" id="5268385">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268392">return</span>&nbsp;<span class="ident" id="5268399">buf</span><br>
<span class="lineno"></span><span class="op" id="5268403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="5268406">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5268475">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5268551">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5268627">func</span>&nbsp;<span class="op" id="5268632">(</span><span class="ident" id="5268633">re</span>&nbsp;<span class="op" id="5268636">*</span><span class="ident" id="5268637">Regexp</span><span class="op" id="5268643">)</span>&nbsp;<span class="ident" id="5268645">ReplaceAll</span><span class="op" id="5268655">(</span><span class="ident" id="5268656">src</span><span class="op" id="5268659">,</span>&nbsp;<span class="ident" id="5268661">repl</span>&nbsp;<span class="op" id="5268666">[</span><span class="op" id="5268667">]</span><span class="builtintype" id="5268668">byte</span><span class="op" id="5268672">)</span>&nbsp;<span class="op" id="5268674">[</span><span class="op" id="5268675">]</span><span class="builtintype" id="5268676">byte</span>&nbsp;<span class="op" id="5268681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268684">n</span>&nbsp;<span class="op" id="5268686">:=</span>&nbsp;<span class="num" id="5268689">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268692">if</span>&nbsp;<span class="ident" id="5268695">bytes</span><span class="op" id="5268700">.</span><span class="ident" id="5268701">IndexByte</span><span class="op" id="5268710">(</span><span class="ident" id="5268711">repl</span><span class="op" id="5268715">,</span>&nbsp;<span class="string" id="5268717">&#39;$&#39;</span><span class="op" id="5268720">)</span>&nbsp;<span class="op" id="5268722">&gt;=</span>&nbsp;<span class="num" id="5268725">0</span>&nbsp;<span class="op" id="5268727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268731">n</span>&nbsp;<span class="op" id="5268733">=</span>&nbsp;<span class="num" id="5268735">2</span>&nbsp;<span class="op" id="5268737">*</span>&nbsp;<span class="op" id="5268739">(</span><span class="ident" id="5268740">re</span><span class="op" id="5268742">.</span><span class="ident" id="5268743">numSubexp</span>&nbsp;<span class="op" id="5268753">+</span>&nbsp;<span class="num" id="5268755">1</span><span class="op" id="5268756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268762">srepl</span>&nbsp;<span class="op" id="5268768">:=</span>&nbsp;<span class="string" id="5268771">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268775">b</span>&nbsp;<span class="op" id="5268777">:=</span>&nbsp;<span class="ident" id="5268780">re</span><span class="op" id="5268782">.</span><span class="ident" id="5268783">replaceAll</span><span class="op" id="5268793">(</span><span class="ident" id="5268794">src</span><span class="op" id="5268797">,</span>&nbsp;<span class="string" id="5268799">&#34;&#34;</span><span class="op" id="5268801">,</span>&nbsp;<span class="ident" id="5268803">n</span><span class="op" id="5268804">,</span>&nbsp;<span class="keyword" id="5268806">func</span><span class="op" id="5268810">(</span><span class="ident" id="5268811">dst</span>&nbsp;<span class="op" id="5268815">[</span><span class="op" id="5268816">]</span><span class="builtintype" id="5268817">byte</span><span class="op" id="5268821">,</span>&nbsp;<span class="ident" id="5268823">match</span>&nbsp;<span class="op" id="5268829">[</span><span class="op" id="5268830">]</span><span class="builtintype" id="5268831">int</span><span class="op" id="5268834">)</span>&nbsp;<span class="op" id="5268836">[</span><span class="op" id="5268837">]</span><span class="builtintype" id="5268838">byte</span>&nbsp;<span class="op" id="5268843">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268847">if</span>&nbsp;<span class="builtinfunc" id="5268850">len</span><span class="op" id="5268853">(</span><span class="ident" id="5268854">srepl</span><span class="op" id="5268859">)</span>&nbsp;<span class="op" id="5268861">!=</span>&nbsp;<span class="builtinfunc" id="5268864">len</span><span class="op" id="5268867">(</span><span class="ident" id="5268868">repl</span><span class="op" id="5268872">)</span>&nbsp;<span class="op" id="5268874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268879">srepl</span>&nbsp;<span class="op" id="5268885">=</span>&nbsp;<span class="builtintype" id="5268887">string</span><span class="op" id="5268893">(</span><span class="ident" id="5268894">repl</span><span class="op" id="5268898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268906">return</span>&nbsp;<span class="ident" id="5268913">re</span><span class="op" id="5268915">.</span><span class="ident" id="5268916">expand</span><span class="op" id="5268922">(</span><span class="ident" id="5268923">dst</span><span class="op" id="5268926">,</span>&nbsp;<span class="ident" id="5268928">srepl</span><span class="op" id="5268933">,</span>&nbsp;<span class="ident" id="5268935">src</span><span class="op" id="5268938">,</span>&nbsp;<span class="string" id="5268940">&#34;&#34;</span><span class="op" id="5268942">,</span>&nbsp;<span class="ident" id="5268944">match</span><span class="op" id="5268949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268952">}</span><span class="op" id="5268953">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268956">return</span>&nbsp;<span class="ident" id="5268963">b</span><br>
<span class="lineno"></span><span class="op" id="5268965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5268968">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5269044">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="5269127">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5269152">func</span>&nbsp;<span class="op" id="5269157">(</span><span class="ident" id="5269158">re</span>&nbsp;<span class="op" id="5269161">*</span><span class="ident" id="5269162">Regexp</span><span class="op" id="5269168">)</span>&nbsp;<span class="ident" id="5269170">ReplaceAllLiteral</span><span class="op" id="5269187">(</span><span class="ident" id="5269188">src</span><span class="op" id="5269191">,</span>&nbsp;<span class="ident" id="5269193">repl</span>&nbsp;<span class="op" id="5269198">[</span><span class="op" id="5269199">]</span><span class="builtintype" id="5269200">byte</span><span class="op" id="5269204">)</span>&nbsp;<span class="op" id="5269206">[</span><span class="op" id="5269207">]</span><span class="builtintype" id="5269208">byte</span>&nbsp;<span class="op" id="5269213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269216">return</span>&nbsp;<span class="ident" id="5269223">re</span><span class="op" id="5269225">.</span><span class="ident" id="5269226">replaceAll</span><span class="op" id="5269236">(</span><span class="ident" id="5269237">src</span><span class="op" id="5269240">,</span>&nbsp;<span class="string" id="5269242">&#34;&#34;</span><span class="op" id="5269244">,</span>&nbsp;<span class="num" id="5269246">2</span><span class="op" id="5269247">,</span>&nbsp;<span class="keyword" id="5269249">func</span><span class="op" id="5269253">(</span><span class="ident" id="5269254">dst</span>&nbsp;<span class="op" id="5269258">[</span><span class="op" id="5269259">]</span><span class="builtintype" id="5269260">byte</span><span class="op" id="5269264">,</span>&nbsp;<span class="ident" id="5269266">match</span>&nbsp;<span class="op" id="5269272">[</span><span class="op" id="5269273">]</span><span class="builtintype" id="5269274">int</span><span class="op" id="5269277">)</span>&nbsp;<span class="op" id="5269279">[</span><span class="op" id="5269280">]</span><span class="builtintype" id="5269281">byte</span>&nbsp;<span class="op" id="5269286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269290">return</span>&nbsp;<span class="builtinfunc" id="5269297">append</span><span class="op" id="5269303">(</span><span class="ident" id="5269304">dst</span><span class="op" id="5269307">,</span>&nbsp;<span class="ident" id="5269309">repl</span><span class="op" id="5269313">...</span><span class="op" id="5269316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269319">}</span><span class="op" id="5269320">)</span><br>
<span class="lineno">560</span><span class="op" id="5269322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269325">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5269393">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5269467">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="5269546">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5269581">func</span>&nbsp;<span class="op" id="5269586">(</span><span class="ident" id="5269587">re</span>&nbsp;<span class="op" id="5269590">*</span><span class="ident" id="5269591">Regexp</span><span class="op" id="5269597">)</span>&nbsp;<span class="ident" id="5269599">ReplaceAllFunc</span><span class="op" id="5269613">(</span><span class="ident" id="5269614">src</span>&nbsp;<span class="op" id="5269618">[</span><span class="op" id="5269619">]</span><span class="builtintype" id="5269620">byte</span><span class="op" id="5269624">,</span>&nbsp;<span class="ident" id="5269626">repl</span>&nbsp;<span class="keyword" id="5269631">func</span><span class="op" id="5269635">(</span><span class="op" id="5269636">[</span><span class="op" id="5269637">]</span><span class="builtintype" id="5269638">byte</span><span class="op" id="5269642">)</span>&nbsp;<span class="op" id="5269644">[</span><span class="op" id="5269645">]</span><span class="builtintype" id="5269646">byte</span><span class="op" id="5269650">)</span>&nbsp;<span class="op" id="5269652">[</span><span class="op" id="5269653">]</span><span class="builtintype" id="5269654">byte</span>&nbsp;<span class="op" id="5269659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269662">return</span>&nbsp;<span class="ident" id="5269669">re</span><span class="op" id="5269671">.</span><span class="ident" id="5269672">replaceAll</span><span class="op" id="5269682">(</span><span class="ident" id="5269683">src</span><span class="op" id="5269686">,</span>&nbsp;<span class="string" id="5269688">&#34;&#34;</span><span class="op" id="5269690">,</span>&nbsp;<span class="num" id="5269692">2</span><span class="op" id="5269693">,</span>&nbsp;<span class="keyword" id="5269695">func</span><span class="op" id="5269699">(</span><span class="ident" id="5269700">dst</span>&nbsp;<span class="op" id="5269704">[</span><span class="op" id="5269705">]</span><span class="builtintype" id="5269706">byte</span><span class="op" id="5269710">,</span>&nbsp;<span class="ident" id="5269712">match</span>&nbsp;<span class="op" id="5269718">[</span><span class="op" id="5269719">]</span><span class="builtintype" id="5269720">int</span><span class="op" id="5269723">)</span>&nbsp;<span class="op" id="5269725">[</span><span class="op" id="5269726">]</span><span class="builtintype" id="5269727">byte</span>&nbsp;<span class="op" id="5269732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269736">return</span>&nbsp;<span class="builtinfunc" id="5269743">append</span><span class="op" id="5269749">(</span><span class="ident" id="5269750">dst</span><span class="op" id="5269753">,</span>&nbsp;<span class="ident" id="5269755">repl</span><span class="op" id="5269759">(</span><span class="ident" id="5269760">src</span><span class="op" id="5269763">[</span><span class="ident" id="5269764">match</span><span class="op" id="5269769">[</span><span class="num" id="5269770">0</span><span class="op" id="5269771">]</span><span class="op" id="5269772">:</span><span class="ident" id="5269773">match</span><span class="op" id="5269778">[</span><span class="num" id="5269779">1</span><span class="op" id="5269780">]</span><span class="op" id="5269781">]</span><span class="op" id="5269782">)</span><span class="op" id="5269783">...</span><span class="op" id="5269786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269789">}</span><span class="op" id="5269790">)</span><br>
<span class="lineno">570</span><span class="op" id="5269792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5269795">var</span>&nbsp;<span class="ident" id="5269799">specialBytes</span>&nbsp;<span class="op" id="5269812">=</span>&nbsp;<span class="op" id="5269814">[</span><span class="op" id="5269815">]</span><span class="builtintype" id="5269816">byte</span><span class="op" id="5269820">(</span><span class="string" id="5269821">`\.+*?()|[]{}^$`</span><span class="op" id="5269837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5269840">func</span>&nbsp;<span class="ident" id="5269845">special</span><span class="op" id="5269852">(</span><span class="ident" id="5269853">b</span>&nbsp;<span class="builtintype" id="5269855">byte</span><span class="op" id="5269859">)</span>&nbsp;<span class="builtintype" id="5269861">bool</span>&nbsp;<span class="op" id="5269866">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269869">return</span>&nbsp;<span class="ident" id="5269876">bytes</span><span class="op" id="5269881">.</span><span class="ident" id="5269882">IndexByte</span><span class="op" id="5269891">(</span><span class="ident" id="5269892">specialBytes</span><span class="op" id="5269904">,</span>&nbsp;<span class="ident" id="5269906">b</span><span class="op" id="5269907">)</span>&nbsp;<span class="op" id="5269909">&gt;=</span>&nbsp;<span class="num" id="5269912">0</span><br>
<span class="lineno"></span><span class="op" id="5269914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269917">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="5269997">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="5270079">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="5270152">func</span>&nbsp;<span class="ident" id="5270157">QuoteMeta</span><span class="op" id="5270166">(</span><span class="ident" id="5270167">s</span>&nbsp;<span class="builtintype" id="5270169">string</span><span class="op" id="5270175">)</span>&nbsp;<span class="builtintype" id="5270177">string</span>&nbsp;<span class="op" id="5270184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270187">b</span>&nbsp;<span class="op" id="5270189">:=</span>&nbsp;<span class="builtinfunc" id="5270192">make</span><span class="op" id="5270196">(</span><span class="op" id="5270197">[</span><span class="op" id="5270198">]</span><span class="builtintype" id="5270199">byte</span><span class="op" id="5270203">,</span>&nbsp;<span class="num" id="5270205">2</span><span class="op" id="5270206">*</span><span class="builtinfunc" id="5270207">len</span><span class="op" id="5270210">(</span><span class="ident" id="5270211">s</span><span class="op" id="5270212">)</span><span class="op" id="5270213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270217">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270282">j</span>&nbsp;<span class="op" id="5270284">:=</span>&nbsp;<span class="num" id="5270287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270290">for</span>&nbsp;<span class="ident" id="5270294">i</span>&nbsp;<span class="op" id="5270296">:=</span>&nbsp;<span class="num" id="5270299">0</span><span class="op" id="5270300">;</span>&nbsp;<span class="ident" id="5270302">i</span>&nbsp;<span class="op" id="5270304">&lt;</span>&nbsp;<span class="builtinfunc" id="5270306">len</span><span class="op" id="5270309">(</span><span class="ident" id="5270310">s</span><span class="op" id="5270311">)</span><span class="op" id="5270312">;</span>&nbsp;<span class="ident" id="5270314">i</span><span class="op" id="5270315">++</span>&nbsp;<span class="op" id="5270318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270322">if</span>&nbsp;<span class="ident" id="5270325">special</span><span class="op" id="5270332">(</span><span class="ident" id="5270333">s</span><span class="op" id="5270334">[</span><span class="ident" id="5270335">i</span><span class="op" id="5270336">]</span><span class="op" id="5270337">)</span>&nbsp;<span class="op" id="5270339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270344">b</span><span class="op" id="5270345">[</span><span class="ident" id="5270346">j</span><span class="op" id="5270347">]</span>&nbsp;<span class="op" id="5270349">=</span>&nbsp;<span class="string" id="5270351">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270359">j</span><span class="op" id="5270360">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270369">b</span><span class="op" id="5270370">[</span><span class="ident" id="5270371">j</span><span class="op" id="5270372">]</span>&nbsp;<span class="op" id="5270374">=</span>&nbsp;<span class="ident" id="5270376">s</span><span class="op" id="5270377">[</span><span class="ident" id="5270378">i</span><span class="op" id="5270379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270383">j</span><span class="op" id="5270384">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270391">return</span>&nbsp;<span class="builtintype" id="5270398">string</span><span class="op" id="5270404">(</span><span class="ident" id="5270405">b</span><span class="op" id="5270406">[</span><span class="num" id="5270407">0</span><span class="op" id="5270408">:</span><span class="ident" id="5270409">j</span><span class="op" id="5270410">]</span><span class="op" id="5270411">)</span><br>
<span class="lineno">595</span><span class="op" id="5270413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5270416">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5270478">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="5270536">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="5270597">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5270658">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5270726">func</span>&nbsp;<span class="op" id="5270731">(</span><span class="ident" id="5270732">re</span>&nbsp;<span class="op" id="5270735">*</span><span class="ident" id="5270736">Regexp</span><span class="op" id="5270742">)</span>&nbsp;<span class="ident" id="5270744">pad</span><span class="op" id="5270747">(</span><span class="ident" id="5270748">a</span>&nbsp;<span class="op" id="5270750">[</span><span class="op" id="5270751">]</span><span class="builtintype" id="5270752">int</span><span class="op" id="5270755">)</span>&nbsp;<span class="op" id="5270757">[</span><span class="op" id="5270758">]</span><span class="builtintype" id="5270759">int</span>&nbsp;<span class="op" id="5270763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270766">if</span>&nbsp;<span class="ident" id="5270769">a</span>&nbsp;<span class="op" id="5270771">==</span>&nbsp;<span class="ident" id="5270774">nil</span>&nbsp;<span class="op" id="5270778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270782">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270797">return</span>&nbsp;<span class="ident" id="5270804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270812">n</span>&nbsp;<span class="op" id="5270814">:=</span>&nbsp;<span class="op" id="5270817">(</span><span class="num" id="5270818">1</span>&nbsp;<span class="op" id="5270820">+</span>&nbsp;<span class="ident" id="5270822">re</span><span class="op" id="5270824">.</span><span class="ident" id="5270825">numSubexp</span><span class="op" id="5270834">)</span>&nbsp;<span class="op" id="5270836">*</span>&nbsp;<span class="num" id="5270838">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270841">for</span>&nbsp;<span class="builtinfunc" id="5270845">len</span><span class="op" id="5270848">(</span><span class="ident" id="5270849">a</span><span class="op" id="5270850">)</span>&nbsp;<span class="op" id="5270852">&lt;</span>&nbsp;<span class="ident" id="5270854">n</span>&nbsp;<span class="op" id="5270856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270860">a</span>&nbsp;<span class="op" id="5270862">=</span>&nbsp;<span class="builtinfunc" id="5270864">append</span><span class="op" id="5270870">(</span><span class="ident" id="5270871">a</span><span class="op" id="5270872">,</span>&nbsp;<span class="op" id="5270874">-</span><span class="num" id="5270875">1</span><span class="op" id="5270876">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270882">return</span>&nbsp;<span class="ident" id="5270889">a</span><br>
<span class="lineno"></span><span class="op" id="5270891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5270894">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="5270974">func</span>&nbsp;<span class="op" id="5270979">(</span><span class="ident" id="5270980">re</span>&nbsp;<span class="op" id="5270983">*</span><span class="ident" id="5270984">Regexp</span><span class="op" id="5270990">)</span>&nbsp;<span class="ident" id="5270992">allMatches</span><span class="op" id="5271002">(</span><span class="ident" id="5271003">s</span>&nbsp;<span class="builtintype" id="5271005">string</span><span class="op" id="5271011">,</span>&nbsp;<span class="ident" id="5271013">b</span>&nbsp;<span class="op" id="5271015">[</span><span class="op" id="5271016">]</span><span class="builtintype" id="5271017">byte</span><span class="op" id="5271021">,</span>&nbsp;<span class="ident" id="5271023">n</span>&nbsp;<span class="builtintype" id="5271025">int</span><span class="op" id="5271028">,</span>&nbsp;<span class="ident" id="5271030">deliver</span>&nbsp;<span class="keyword" id="5271038">func</span><span class="op" id="5271042">(</span><span class="op" id="5271043">[</span><span class="op" id="5271044">]</span><span class="builtintype" id="5271045">int</span><span class="op" id="5271048">)</span><span class="op" id="5271049">)</span>&nbsp;<span class="op" id="5271051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271054">var</span>&nbsp;<span class="ident" id="5271058">end</span>&nbsp;<span class="builtintype" id="5271062">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271067">if</span>&nbsp;<span class="ident" id="5271070">b</span>&nbsp;<span class="op" id="5271072">==</span>&nbsp;<span class="ident" id="5271075">nil</span>&nbsp;<span class="op" id="5271079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271083">end</span>&nbsp;<span class="op" id="5271087">=</span>&nbsp;<span class="builtinfunc" id="5271089">len</span><span class="op" id="5271092">(</span><span class="ident" id="5271093">s</span><span class="op" id="5271094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271097">}</span>&nbsp;<span class="keyword" id="5271099">else</span>&nbsp;<span class="op" id="5271104">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271108">end</span>&nbsp;<span class="op" id="5271112">=</span>&nbsp;<span class="builtinfunc" id="5271114">len</span><span class="op" id="5271117">(</span><span class="ident" id="5271118">b</span><span class="op" id="5271119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271126">for</span>&nbsp;<span class="ident" id="5271130">pos</span><span class="op" id="5271133">,</span>&nbsp;<span class="ident" id="5271135">i</span><span class="op" id="5271136">,</span>&nbsp;<span class="ident" id="5271138">prevMatchEnd</span>&nbsp;<span class="op" id="5271151">:=</span>&nbsp;<span class="num" id="5271154">0</span><span class="op" id="5271155">,</span>&nbsp;<span class="num" id="5271157">0</span><span class="op" id="5271158">,</span>&nbsp;<span class="op" id="5271160">-</span><span class="num" id="5271161">1</span><span class="op" id="5271162">;</span>&nbsp;<span class="ident" id="5271164">i</span>&nbsp;<span class="op" id="5271166">&lt;</span>&nbsp;<span class="ident" id="5271168">n</span>&nbsp;<span class="op" id="5271170">&amp;&amp;</span>&nbsp;<span class="ident" id="5271173">pos</span>&nbsp;<span class="op" id="5271177">&lt;=</span>&nbsp;<span class="ident" id="5271180">end</span><span class="op" id="5271183">;</span>&nbsp;<span class="op" id="5271185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271189">matches</span>&nbsp;<span class="op" id="5271197">:=</span>&nbsp;<span class="ident" id="5271200">re</span><span class="op" id="5271202">.</span><span class="ident" id="5271203">doExecute</span><span class="op" id="5271212">(</span><span class="ident" id="5271213">nil</span><span class="op" id="5271216">,</span>&nbsp;<span class="ident" id="5271218">b</span><span class="op" id="5271219">,</span>&nbsp;<span class="ident" id="5271221">s</span><span class="op" id="5271222">,</span>&nbsp;<span class="ident" id="5271224">pos</span><span class="op" id="5271227">,</span>&nbsp;<span class="ident" id="5271229">re</span><span class="op" id="5271231">.</span><span class="ident" id="5271232">prog</span><span class="op" id="5271236">.</span><span class="ident" id="5271237">NumCap</span><span class="op" id="5271243">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271247">if</span>&nbsp;<span class="builtinfunc" id="5271250">len</span><span class="op" id="5271253">(</span><span class="ident" id="5271254">matches</span><span class="op" id="5271261">)</span>&nbsp;<span class="op" id="5271263">==</span>&nbsp;<span class="num" id="5271266">0</span>&nbsp;<span class="op" id="5271268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271273">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271286">accept</span>&nbsp;<span class="op" id="5271293">:=</span>&nbsp;<span class="builtintype" id="5271296">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271303">if</span>&nbsp;<span class="ident" id="5271306">matches</span><span class="op" id="5271313">[</span><span class="num" id="5271314">1</span><span class="op" id="5271315">]</span>&nbsp;<span class="op" id="5271317">==</span>&nbsp;<span class="ident" id="5271320">pos</span>&nbsp;<span class="op" id="5271324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271329">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271363">if</span>&nbsp;<span class="ident" id="5271366">matches</span><span class="op" id="5271373">[</span><span class="num" id="5271374">0</span><span class="op" id="5271375">]</span>&nbsp;<span class="op" id="5271377">==</span>&nbsp;<span class="ident" id="5271380">prevMatchEnd</span>&nbsp;<span class="op" id="5271393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271399">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271442">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271487">accept</span>&nbsp;<span class="op" id="5271494">=</span>&nbsp;<span class="builtintype" id="5271496">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271510">var</span>&nbsp;<span class="ident" id="5271514">width</span>&nbsp;<span class="builtintype" id="5271520">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271527">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271550">if</span>&nbsp;<span class="ident" id="5271553">b</span>&nbsp;<span class="op" id="5271555">==</span>&nbsp;<span class="ident" id="5271558">nil</span>&nbsp;<span class="op" id="5271562">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271568">_</span><span class="op" id="5271569">,</span>&nbsp;<span class="ident" id="5271571">width</span>&nbsp;<span class="op" id="5271577">=</span>&nbsp;<span class="ident" id="5271579">utf8</span><span class="op" id="5271583">.</span><span class="ident" id="5271584">DecodeRuneInString</span><span class="op" id="5271602">(</span><span class="ident" id="5271603">s</span><span class="op" id="5271604">[</span><span class="ident" id="5271605">pos</span><span class="op" id="5271608">:</span><span class="ident" id="5271609">end</span><span class="op" id="5271612">]</span><span class="op" id="5271613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271618">}</span>&nbsp;<span class="keyword" id="5271620">else</span>&nbsp;<span class="op" id="5271625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271631">_</span><span class="op" id="5271632">,</span>&nbsp;<span class="ident" id="5271634">width</span>&nbsp;<span class="op" id="5271640">=</span>&nbsp;<span class="ident" id="5271642">utf8</span><span class="op" id="5271646">.</span><span class="ident" id="5271647">DecodeRune</span><span class="op" id="5271657">(</span><span class="ident" id="5271658">b</span><span class="op" id="5271659">[</span><span class="ident" id="5271660">pos</span><span class="op" id="5271663">:</span><span class="ident" id="5271664">end</span><span class="op" id="5271667">]</span><span class="op" id="5271668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271678">if</span>&nbsp;<span class="ident" id="5271681">width</span>&nbsp;<span class="op" id="5271687">&gt;</span>&nbsp;<span class="num" id="5271689">0</span>&nbsp;<span class="op" id="5271691">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271697">pos</span>&nbsp;<span class="op" id="5271701">+=</span>&nbsp;<span class="ident" id="5271704">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271713">}</span>&nbsp;<span class="keyword" id="5271715">else</span>&nbsp;<span class="op" id="5271720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271726">pos</span>&nbsp;<span class="op" id="5271730">=</span>&nbsp;<span class="ident" id="5271732">end</span>&nbsp;<span class="op" id="5271736">+</span>&nbsp;<span class="num" id="5271738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271747">}</span>&nbsp;<span class="keyword" id="5271749">else</span>&nbsp;<span class="op" id="5271754">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271759">pos</span>&nbsp;<span class="op" id="5271763">=</span>&nbsp;<span class="ident" id="5271765">matches</span><span class="op" id="5271772">[</span><span class="num" id="5271773">1</span><span class="op" id="5271774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271782">prevMatchEnd</span>&nbsp;<span class="op" id="5271795">=</span>&nbsp;<span class="ident" id="5271797">matches</span><span class="op" id="5271804">[</span><span class="num" id="5271805">1</span><span class="op" id="5271806">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271811">if</span>&nbsp;<span class="ident" id="5271814">accept</span>&nbsp;<span class="op" id="5271821">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271826">deliver</span><span class="op" id="5271833">(</span><span class="ident" id="5271834">re</span><span class="op" id="5271836">.</span><span class="ident" id="5271837">pad</span><span class="op" id="5271840">(</span><span class="ident" id="5271841">matches</span><span class="op" id="5271848">)</span><span class="op" id="5271849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271854">i</span><span class="op" id="5271855">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271863">}</span><br>
<span class="lineno"></span><span class="op" id="5271865">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5271868">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5271963">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5272008">func</span>&nbsp;<span class="op" id="5272013">(</span><span class="ident" id="5272014">re</span>&nbsp;<span class="op" id="5272017">*</span><span class="ident" id="5272018">Regexp</span><span class="op" id="5272024">)</span>&nbsp;<span class="ident" id="5272026">Find</span><span class="op" id="5272030">(</span><span class="ident" id="5272031">b</span>&nbsp;<span class="op" id="5272033">[</span><span class="op" id="5272034">]</span><span class="builtintype" id="5272035">byte</span><span class="op" id="5272039">)</span>&nbsp;<span class="op" id="5272041">[</span><span class="op" id="5272042">]</span><span class="builtintype" id="5272043">byte</span>&nbsp;<span class="op" id="5272048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272051">a</span>&nbsp;<span class="op" id="5272053">:=</span>&nbsp;<span class="ident" id="5272056">re</span><span class="op" id="5272058">.</span><span class="ident" id="5272059">doExecute</span><span class="op" id="5272068">(</span><span class="ident" id="5272069">nil</span><span class="op" id="5272072">,</span>&nbsp;<span class="ident" id="5272074">b</span><span class="op" id="5272075">,</span>&nbsp;<span class="string" id="5272077">&#34;&#34;</span><span class="op" id="5272079">,</span>&nbsp;<span class="num" id="5272081">0</span><span class="op" id="5272082">,</span>&nbsp;<span class="num" id="5272084">2</span><span class="op" id="5272085">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272088">if</span>&nbsp;<span class="ident" id="5272091">a</span>&nbsp;<span class="op" id="5272093">==</span>&nbsp;<span class="ident" id="5272096">nil</span>&nbsp;<span class="op" id="5272100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272104">return</span>&nbsp;<span class="ident" id="5272111">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272119">return</span>&nbsp;<span class="ident" id="5272126">b</span><span class="op" id="5272127">[</span><span class="ident" id="5272128">a</span><span class="op" id="5272129">[</span><span class="num" id="5272130">0</span><span class="op" id="5272131">]</span><span class="op" id="5272132">:</span><span class="ident" id="5272133">a</span><span class="op" id="5272134">[</span><span class="num" id="5272135">1</span><span class="op" id="5272136">]</span><span class="op" id="5272137">]</span><br>
<span class="lineno"></span><span class="op" id="5272139">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5272142">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5272220">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5272298">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5272319">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="5272364">func</span>&nbsp;<span class="op" id="5272369">(</span><span class="ident" id="5272370">re</span>&nbsp;<span class="op" id="5272373">*</span><span class="ident" id="5272374">Regexp</span><span class="op" id="5272380">)</span>&nbsp;<span class="ident" id="5272382">FindIndex</span><span class="op" id="5272391">(</span><span class="ident" id="5272392">b</span>&nbsp;<span class="op" id="5272394">[</span><span class="op" id="5272395">]</span><span class="builtintype" id="5272396">byte</span><span class="op" id="5272400">)</span>&nbsp;<span class="op" id="5272402">(</span><span class="ident" id="5272403">loc</span>&nbsp;<span class="op" id="5272407">[</span><span class="op" id="5272408">]</span><span class="builtintype" id="5272409">int</span><span class="op" id="5272412">)</span>&nbsp;<span class="op" id="5272414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272417">a</span>&nbsp;<span class="op" id="5272419">:=</span>&nbsp;<span class="ident" id="5272422">re</span><span class="op" id="5272424">.</span><span class="ident" id="5272425">doExecute</span><span class="op" id="5272434">(</span><span class="ident" id="5272435">nil</span><span class="op" id="5272438">,</span>&nbsp;<span class="ident" id="5272440">b</span><span class="op" id="5272441">,</span>&nbsp;<span class="string" id="5272443">&#34;&#34;</span><span class="op" id="5272445">,</span>&nbsp;<span class="num" id="5272447">0</span><span class="op" id="5272448">,</span>&nbsp;<span class="num" id="5272450">2</span><span class="op" id="5272451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272454">if</span>&nbsp;<span class="ident" id="5272457">a</span>&nbsp;<span class="op" id="5272459">==</span>&nbsp;<span class="ident" id="5272462">nil</span>&nbsp;<span class="op" id="5272466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272470">return</span>&nbsp;<span class="ident" id="5272477">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272482">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272485">return</span>&nbsp;<span class="ident" id="5272492">a</span><span class="op" id="5272493">[</span><span class="num" id="5272494">0</span><span class="op" id="5272495">:</span><span class="num" id="5272496">2</span><span class="op" id="5272497">]</span><br>
<span class="lineno"></span><span class="op" id="5272499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5272502">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5272592">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="5272667">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5272743">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5272815">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="5272856">func</span>&nbsp;<span class="op" id="5272861">(</span><span class="ident" id="5272862">re</span>&nbsp;<span class="op" id="5272865">*</span><span class="ident" id="5272866">Regexp</span><span class="op" id="5272872">)</span>&nbsp;<span class="ident" id="5272874">FindString</span><span class="op" id="5272884">(</span><span class="ident" id="5272885">s</span>&nbsp;<span class="builtintype" id="5272887">string</span><span class="op" id="5272893">)</span>&nbsp;<span class="builtintype" id="5272895">string</span>&nbsp;<span class="op" id="5272902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272905">a</span>&nbsp;<span class="op" id="5272907">:=</span>&nbsp;<span class="ident" id="5272910">re</span><span class="op" id="5272912">.</span><span class="ident" id="5272913">doExecute</span><span class="op" id="5272922">(</span><span class="ident" id="5272923">nil</span><span class="op" id="5272926">,</span>&nbsp;<span class="ident" id="5272928">nil</span><span class="op" id="5272931">,</span>&nbsp;<span class="ident" id="5272933">s</span><span class="op" id="5272934">,</span>&nbsp;<span class="num" id="5272936">0</span><span class="op" id="5272937">,</span>&nbsp;<span class="num" id="5272939">2</span><span class="op" id="5272940">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272943">if</span>&nbsp;<span class="ident" id="5272946">a</span>&nbsp;<span class="op" id="5272948">==</span>&nbsp;<span class="ident" id="5272951">nil</span>&nbsp;<span class="op" id="5272955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272959">return</span>&nbsp;<span class="string" id="5272966">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272973">return</span>&nbsp;<span class="ident" id="5272980">s</span><span class="op" id="5272981">[</span><span class="ident" id="5272982">a</span><span class="op" id="5272983">[</span><span class="num" id="5272984">0</span><span class="op" id="5272985">]</span><span class="op" id="5272986">:</span><span class="ident" id="5272987">a</span><span class="op" id="5272988">[</span><span class="num" id="5272989">1</span><span class="op" id="5272990">]</span><span class="op" id="5272991">]</span><br>
<span class="lineno"></span><span class="op" id="5272993">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5272996">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5273068">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5273145">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5273179">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="5273224">func</span>&nbsp;<span class="op" id="5273229">(</span><span class="ident" id="5273230">re</span>&nbsp;<span class="op" id="5273233">*</span><span class="ident" id="5273234">Regexp</span><span class="op" id="5273240">)</span>&nbsp;<span class="ident" id="5273242">FindStringIndex</span><span class="op" id="5273257">(</span><span class="ident" id="5273258">s</span>&nbsp;<span class="builtintype" id="5273260">string</span><span class="op" id="5273266">)</span>&nbsp;<span class="op" id="5273268">(</span><span class="ident" id="5273269">loc</span>&nbsp;<span class="op" id="5273273">[</span><span class="op" id="5273274">]</span><span class="builtintype" id="5273275">int</span><span class="op" id="5273278">)</span>&nbsp;<span class="op" id="5273280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273283">a</span>&nbsp;<span class="op" id="5273285">:=</span>&nbsp;<span class="ident" id="5273288">re</span><span class="op" id="5273290">.</span><span class="ident" id="5273291">doExecute</span><span class="op" id="5273300">(</span><span class="ident" id="5273301">nil</span><span class="op" id="5273304">,</span>&nbsp;<span class="ident" id="5273306">nil</span><span class="op" id="5273309">,</span>&nbsp;<span class="ident" id="5273311">s</span><span class="op" id="5273312">,</span>&nbsp;<span class="num" id="5273314">0</span><span class="op" id="5273315">,</span>&nbsp;<span class="num" id="5273317">2</span><span class="op" id="5273318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273321">if</span>&nbsp;<span class="ident" id="5273324">a</span>&nbsp;<span class="op" id="5273326">==</span>&nbsp;<span class="ident" id="5273329">nil</span>&nbsp;<span class="op" id="5273333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273337">return</span>&nbsp;<span class="ident" id="5273344">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5273349">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273352">return</span>&nbsp;<span class="ident" id="5273359">a</span><span class="op" id="5273360">[</span><span class="num" id="5273361">0</span><span class="op" id="5273362">:</span><span class="num" id="5273363">2</span><span class="op" id="5273364">]</span><br>
<span class="lineno"></span><span class="op" id="5273366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5273369">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5273441">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="5273519">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5273587">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="5273627">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5273672">func</span>&nbsp;<span class="op" id="5273677">(</span><span class="ident" id="5273678">re</span>&nbsp;<span class="op" id="5273681">*</span><span class="ident" id="5273682">Regexp</span><span class="op" id="5273688">)</span>&nbsp;<span class="ident" id="5273690">FindReaderIndex</span><span class="op" id="5273705">(</span><span class="ident" id="5273706">r</span>&nbsp;<span class="ident" id="5273708">io</span><span class="op" id="5273710">.</span><span class="ident" id="5273711">RuneReader</span><span class="op" id="5273721">)</span>&nbsp;<span class="op" id="5273723">(</span><span class="ident" id="5273724">loc</span>&nbsp;<span class="op" id="5273728">[</span><span class="op" id="5273729">]</span><span class="builtintype" id="5273730">int</span><span class="op" id="5273733">)</span>&nbsp;<span class="op" id="5273735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273738">a</span>&nbsp;<span class="op" id="5273740">:=</span>&nbsp;<span class="ident" id="5273743">re</span><span class="op" id="5273745">.</span><span class="ident" id="5273746">doExecute</span><span class="op" id="5273755">(</span><span class="ident" id="5273756">r</span><span class="op" id="5273757">,</span>&nbsp;<span class="ident" id="5273759">nil</span><span class="op" id="5273762">,</span>&nbsp;<span class="string" id="5273764">&#34;&#34;</span><span class="op" id="5273766">,</span>&nbsp;<span class="num" id="5273768">0</span><span class="op" id="5273769">,</span>&nbsp;<span class="num" id="5273771">2</span><span class="op" id="5273772">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273775">if</span>&nbsp;<span class="ident" id="5273778">a</span>&nbsp;<span class="op" id="5273780">==</span>&nbsp;<span class="ident" id="5273783">nil</span>&nbsp;<span class="op" id="5273787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273791">return</span>&nbsp;<span class="ident" id="5273798">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5273803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273806">return</span>&nbsp;<span class="ident" id="5273813">a</span><span class="op" id="5273814">[</span><span class="num" id="5273815">0</span><span class="op" id="5273816">:</span><span class="num" id="5273817">2</span><span class="op" id="5273818">]</span><br>
<span class="lineno"></span><span class="op" id="5273820">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="5273823">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="5273898">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5273970">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5274046">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="5274058">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5274103">func</span>&nbsp;<span class="op" id="5274108">(</span><span class="ident" id="5274109">re</span>&nbsp;<span class="op" id="5274112">*</span><span class="ident" id="5274113">Regexp</span><span class="op" id="5274119">)</span>&nbsp;<span class="ident" id="5274121">FindSubmatch</span><span class="op" id="5274133">(</span><span class="ident" id="5274134">b</span>&nbsp;<span class="op" id="5274136">[</span><span class="op" id="5274137">]</span><span class="builtintype" id="5274138">byte</span><span class="op" id="5274142">)</span>&nbsp;<span class="op" id="5274144">[</span><span class="op" id="5274145">]</span><span class="op" id="5274146">[</span><span class="op" id="5274147">]</span><span class="builtintype" id="5274148">byte</span>&nbsp;<span class="op" id="5274153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274156">a</span>&nbsp;<span class="op" id="5274158">:=</span>&nbsp;<span class="ident" id="5274161">re</span><span class="op" id="5274163">.</span><span class="ident" id="5274164">doExecute</span><span class="op" id="5274173">(</span><span class="ident" id="5274174">nil</span><span class="op" id="5274177">,</span>&nbsp;<span class="ident" id="5274179">b</span><span class="op" id="5274180">,</span>&nbsp;<span class="string" id="5274182">&#34;&#34;</span><span class="op" id="5274184">,</span>&nbsp;<span class="num" id="5274186">0</span><span class="op" id="5274187">,</span>&nbsp;<span class="ident" id="5274189">re</span><span class="op" id="5274191">.</span><span class="ident" id="5274192">prog</span><span class="op" id="5274196">.</span><span class="ident" id="5274197">NumCap</span><span class="op" id="5274203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274206">if</span>&nbsp;<span class="ident" id="5274209">a</span>&nbsp;<span class="op" id="5274211">==</span>&nbsp;<span class="ident" id="5274214">nil</span>&nbsp;<span class="op" id="5274218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274222">return</span>&nbsp;<span class="ident" id="5274229">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5274234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274237">ret</span>&nbsp;<span class="op" id="5274241">:=</span>&nbsp;<span class="builtinfunc" id="5274244">make</span><span class="op" id="5274248">(</span><span class="op" id="5274249">[</span><span class="op" id="5274250">]</span><span class="op" id="5274251">[</span><span class="op" id="5274252">]</span><span class="builtintype" id="5274253">byte</span><span class="op" id="5274257">,</span>&nbsp;<span class="num" id="5274259">1</span><span class="op" id="5274260">+</span><span class="ident" id="5274261">re</span><span class="op" id="5274263">.</span><span class="ident" id="5274264">numSubexp</span><span class="op" id="5274273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274276">for</span>&nbsp;<span class="ident" id="5274280">i</span>&nbsp;<span class="op" id="5274282">:=</span>&nbsp;<span class="keyword" id="5274285">range</span>&nbsp;<span class="ident" id="5274291">ret</span>&nbsp;<span class="op" id="5274295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274299">if</span>&nbsp;<span class="num" id="5274302">2</span><span class="op" id="5274303">*</span><span class="ident" id="5274304">i</span>&nbsp;<span class="op" id="5274306">&lt;</span>&nbsp;<span class="builtinfunc" id="5274308">len</span><span class="op" id="5274311">(</span><span class="ident" id="5274312">a</span><span class="op" id="5274313">)</span>&nbsp;<span class="op" id="5274315">&amp;&amp;</span>&nbsp;<span class="ident" id="5274318">a</span><span class="op" id="5274319">[</span><span class="num" id="5274320">2</span><span class="op" id="5274321">*</span><span class="ident" id="5274322">i</span><span class="op" id="5274323">]</span>&nbsp;<span class="op" id="5274325">&gt;=</span>&nbsp;<span class="num" id="5274328">0</span>&nbsp;<span class="op" id="5274330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5274335">ret</span><span class="op" id="5274338">[</span><span class="ident" id="5274339">i</span><span class="op" id="5274340">]</span>&nbsp;<span class="op" id="5274342">=</span>&nbsp;<span class="ident" id="5274344">b</span><span class="op" id="5274345">[</span><span class="ident" id="5274346">a</span><span class="op" id="5274347">[</span><span class="num" id="5274348">2</span><span class="op" id="5274349">*</span><span class="ident" id="5274350">i</span><span class="op" id="5274351">]</span><span class="op" id="5274352">:</span><span class="ident" id="5274353">a</span><span class="op" id="5274354">[</span><span class="num" id="5274355">2</span><span class="op" id="5274356">*</span><span class="ident" id="5274357">i</span><span class="op" id="5274358">+</span><span class="num" id="5274359">1</span><span class="op" id="5274360">]</span><span class="op" id="5274361">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5274365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5274368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5274371">return</span>&nbsp;<span class="ident" id="5274378">ret</span><br>
<span class="lineno"></span><span class="op" id="5274382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5274385">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5274454">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5274526">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5274599">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="5274621">//</span><br>
<span class="lineno">745</span><span class="comment" id="5274624">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5274693">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="5274761">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5274830">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5274897">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="5274962">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5275035">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="5275105">//</span><br>
<span class="lineno"></span><span class="comment" id="5275108">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5275178">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="5275257">//</span><br>
<span class="lineno"></span><span class="comment" id="5275260">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5275324">func</span>&nbsp;<span class="op" id="5275329">(</span><span class="ident" id="5275330">re</span>&nbsp;<span class="op" id="5275333">*</span><span class="ident" id="5275334">Regexp</span><span class="op" id="5275340">)</span>&nbsp;<span class="ident" id="5275342">Expand</span><span class="op" id="5275348">(</span><span class="ident" id="5275349">dst</span>&nbsp;<span class="op" id="5275353">[</span><span class="op" id="5275354">]</span><span class="builtintype" id="5275355">byte</span><span class="op" id="5275359">,</span>&nbsp;<span class="ident" id="5275361">template</span>&nbsp;<span class="op" id="5275370">[</span><span class="op" id="5275371">]</span><span class="builtintype" id="5275372">byte</span><span class="op" id="5275376">,</span>&nbsp;<span class="ident" id="5275378">src</span>&nbsp;<span class="op" id="5275382">[</span><span class="op" id="5275383">]</span><span class="builtintype" id="5275384">byte</span><span class="op" id="5275388">,</span>&nbsp;<span class="ident" id="5275390">match</span>&nbsp;<span class="op" id="5275396">[</span><span class="op" id="5275397">]</span><span class="builtintype" id="5275398">int</span><span class="op" id="5275401">)</span>&nbsp;<span class="op" id="5275403">[</span><span class="op" id="5275404">]</span><span class="builtintype" id="5275405">byte</span>&nbsp;<span class="op" id="5275410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275413">return</span>&nbsp;<span class="ident" id="5275420">re</span><span class="op" id="5275422">.</span><span class="ident" id="5275423">expand</span><span class="op" id="5275429">(</span><span class="ident" id="5275430">dst</span><span class="op" id="5275433">,</span>&nbsp;<span class="builtintype" id="5275435">string</span><span class="op" id="5275441">(</span><span class="ident" id="5275442">template</span><span class="op" id="5275450">)</span><span class="op" id="5275451">,</span>&nbsp;<span class="ident" id="5275453">src</span><span class="op" id="5275456">,</span>&nbsp;<span class="string" id="5275458">&#34;&#34;</span><span class="op" id="5275460">,</span>&nbsp;<span class="ident" id="5275462">match</span><span class="op" id="5275467">)</span><br>
<span class="lineno"></span><span class="op" id="5275469">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="5275472">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="5275544">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5275615">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5275648">func</span>&nbsp;<span class="op" id="5275653">(</span><span class="ident" id="5275654">re</span>&nbsp;<span class="op" id="5275657">*</span><span class="ident" id="5275658">Regexp</span><span class="op" id="5275664">)</span>&nbsp;<span class="ident" id="5275666">ExpandString</span><span class="op" id="5275678">(</span><span class="ident" id="5275679">dst</span>&nbsp;<span class="op" id="5275683">[</span><span class="op" id="5275684">]</span><span class="builtintype" id="5275685">byte</span><span class="op" id="5275689">,</span>&nbsp;<span class="ident" id="5275691">template</span>&nbsp;<span class="builtintype" id="5275700">string</span><span class="op" id="5275706">,</span>&nbsp;<span class="ident" id="5275708">src</span>&nbsp;<span class="builtintype" id="5275712">string</span><span class="op" id="5275718">,</span>&nbsp;<span class="ident" id="5275720">match</span>&nbsp;<span class="op" id="5275726">[</span><span class="op" id="5275727">]</span><span class="builtintype" id="5275728">int</span><span class="op" id="5275731">)</span>&nbsp;<span class="op" id="5275733">[</span><span class="op" id="5275734">]</span><span class="builtintype" id="5275735">byte</span>&nbsp;<span class="op" id="5275740">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275743">return</span>&nbsp;<span class="ident" id="5275750">re</span><span class="op" id="5275752">.</span><span class="ident" id="5275753">expand</span><span class="op" id="5275759">(</span><span class="ident" id="5275760">dst</span><span class="op" id="5275763">,</span>&nbsp;<span class="ident" id="5275765">template</span><span class="op" id="5275773">,</span>&nbsp;<span class="ident" id="5275775">nil</span><span class="op" id="5275778">,</span>&nbsp;<span class="ident" id="5275780">src</span><span class="op" id="5275783">,</span>&nbsp;<span class="ident" id="5275785">match</span><span class="op" id="5275790">)</span><br>
<span class="lineno"></span><span class="op" id="5275792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5275795">func</span>&nbsp;<span class="op" id="5275800">(</span><span class="ident" id="5275801">re</span>&nbsp;<span class="op" id="5275804">*</span><span class="ident" id="5275805">Regexp</span><span class="op" id="5275811">)</span>&nbsp;<span class="ident" id="5275813">expand</span><span class="op" id="5275819">(</span><span class="ident" id="5275820">dst</span>&nbsp;<span class="op" id="5275824">[</span><span class="op" id="5275825">]</span><span class="builtintype" id="5275826">byte</span><span class="op" id="5275830">,</span>&nbsp;<span class="ident" id="5275832">template</span>&nbsp;<span class="builtintype" id="5275841">string</span><span class="op" id="5275847">,</span>&nbsp;<span class="ident" id="5275849">bsrc</span>&nbsp;<span class="op" id="5275854">[</span><span class="op" id="5275855">]</span><span class="builtintype" id="5275856">byte</span><span class="op" id="5275860">,</span>&nbsp;<span class="ident" id="5275862">src</span>&nbsp;<span class="builtintype" id="5275866">string</span><span class="op" id="5275872">,</span>&nbsp;<span class="ident" id="5275874">match</span>&nbsp;<span class="op" id="5275880">[</span><span class="op" id="5275881">]</span><span class="builtintype" id="5275882">int</span><span class="op" id="5275885">)</span>&nbsp;<span class="op" id="5275887">[</span><span class="op" id="5275888">]</span><span class="builtintype" id="5275889">byte</span>&nbsp;<span class="op" id="5275894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275897">for</span>&nbsp;<span class="builtinfunc" id="5275901">len</span><span class="op" id="5275904">(</span><span class="ident" id="5275905">template</span><span class="op" id="5275913">)</span>&nbsp;<span class="op" id="5275915">&gt;</span>&nbsp;<span class="num" id="5275917">0</span>&nbsp;<span class="op" id="5275919">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275923">i</span>&nbsp;<span class="op" id="5275925">:=</span>&nbsp;<span class="ident" id="5275928">strings</span><span class="op" id="5275935">.</span><span class="ident" id="5275936">Index</span><span class="op" id="5275941">(</span><span class="ident" id="5275942">template</span><span class="op" id="5275950">,</span>&nbsp;<span class="string" id="5275952">&#34;$&#34;</span><span class="op" id="5275955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275959">if</span>&nbsp;<span class="ident" id="5275962">i</span>&nbsp;<span class="op" id="5275964">&lt;</span>&nbsp;<span class="num" id="5275966">0</span>&nbsp;<span class="op" id="5275968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5275973">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5275981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5275985">dst</span>&nbsp;<span class="op" id="5275989">=</span>&nbsp;<span class="builtinfunc" id="5275991">append</span><span class="op" id="5275997">(</span><span class="ident" id="5275998">dst</span><span class="op" id="5276001">,</span>&nbsp;<span class="ident" id="5276003">template</span><span class="op" id="5276011">[</span><span class="op" id="5276012">:</span><span class="ident" id="5276013">i</span><span class="op" id="5276014">]</span><span class="op" id="5276015">...</span><span class="op" id="5276018">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276022">template</span>&nbsp;<span class="op" id="5276031">=</span>&nbsp;<span class="ident" id="5276033">template</span><span class="op" id="5276041">[</span><span class="ident" id="5276042">i</span><span class="op" id="5276043">:</span><span class="op" id="5276044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276048">if</span>&nbsp;<span class="builtinfunc" id="5276051">len</span><span class="op" id="5276054">(</span><span class="ident" id="5276055">template</span><span class="op" id="5276063">)</span>&nbsp;<span class="op" id="5276065">&gt;</span>&nbsp;<span class="num" id="5276067">1</span>&nbsp;<span class="op" id="5276069">&amp;&amp;</span>&nbsp;<span class="ident" id="5276072">template</span><span class="op" id="5276080">[</span><span class="num" id="5276081">1</span><span class="op" id="5276082">]</span>&nbsp;<span class="op" id="5276084">==</span>&nbsp;<span class="string" id="5276087">&#39;$&#39;</span>&nbsp;<span class="op" id="5276091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5276096">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276117">dst</span>&nbsp;<span class="op" id="5276121">=</span>&nbsp;<span class="builtinfunc" id="5276123">append</span><span class="op" id="5276129">(</span><span class="ident" id="5276130">dst</span><span class="op" id="5276133">,</span>&nbsp;<span class="string" id="5276135">&#39;$&#39;</span><span class="op" id="5276138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276143">template</span>&nbsp;<span class="op" id="5276152">=</span>&nbsp;<span class="ident" id="5276154">template</span><span class="op" id="5276162">[</span><span class="num" id="5276163">2</span><span class="op" id="5276164">:</span><span class="op" id="5276165">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276170">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276185">name</span><span class="op" id="5276189">,</span>&nbsp;<span class="ident" id="5276191">num</span><span class="op" id="5276194">,</span>&nbsp;<span class="ident" id="5276196">rest</span><span class="op" id="5276200">,</span>&nbsp;<span class="ident" id="5276202">ok</span>&nbsp;<span class="op" id="5276205">:=</span>&nbsp;<span class="ident" id="5276208">extract</span><span class="op" id="5276215">(</span><span class="ident" id="5276216">template</span><span class="op" id="5276224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276228">if</span>&nbsp;<span class="op" id="5276231">!</span><span class="ident" id="5276232">ok</span>&nbsp;<span class="op" id="5276235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5276240">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276278">dst</span>&nbsp;<span class="op" id="5276282">=</span>&nbsp;<span class="builtinfunc" id="5276284">append</span><span class="op" id="5276290">(</span><span class="ident" id="5276291">dst</span><span class="op" id="5276294">,</span>&nbsp;<span class="string" id="5276296">&#39;$&#39;</span><span class="op" id="5276299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276304">template</span>&nbsp;<span class="op" id="5276313">=</span>&nbsp;<span class="ident" id="5276315">template</span><span class="op" id="5276323">[</span><span class="num" id="5276324">1</span><span class="op" id="5276325">:</span><span class="op" id="5276326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276331">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276346">template</span>&nbsp;<span class="op" id="5276355">=</span>&nbsp;<span class="ident" id="5276357">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276364">if</span>&nbsp;<span class="ident" id="5276367">num</span>&nbsp;<span class="op" id="5276371">&gt;=</span>&nbsp;<span class="num" id="5276374">0</span>&nbsp;<span class="op" id="5276376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276381">if</span>&nbsp;<span class="num" id="5276384">2</span><span class="op" id="5276385">*</span><span class="ident" id="5276386">num</span><span class="op" id="5276389">+</span><span class="num" id="5276390">1</span>&nbsp;<span class="op" id="5276392">&lt;</span>&nbsp;<span class="builtinfunc" id="5276394">len</span><span class="op" id="5276397">(</span><span class="ident" id="5276398">match</span><span class="op" id="5276403">)</span>&nbsp;<span class="op" id="5276405">&amp;&amp;</span>&nbsp;<span class="ident" id="5276408">match</span><span class="op" id="5276413">[</span><span class="num" id="5276414">2</span><span class="op" id="5276415">*</span><span class="ident" id="5276416">num</span><span class="op" id="5276419">]</span>&nbsp;<span class="op" id="5276421">&gt;=</span>&nbsp;<span class="num" id="5276424">0</span>&nbsp;<span class="op" id="5276426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276432">if</span>&nbsp;<span class="ident" id="5276435">bsrc</span>&nbsp;<span class="op" id="5276440">!=</span>&nbsp;<span class="ident" id="5276443">nil</span>&nbsp;<span class="op" id="5276447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276454">dst</span>&nbsp;<span class="op" id="5276458">=</span>&nbsp;<span class="builtinfunc" id="5276460">append</span><span class="op" id="5276466">(</span><span class="ident" id="5276467">dst</span><span class="op" id="5276470">,</span>&nbsp;<span class="ident" id="5276472">bsrc</span><span class="op" id="5276476">[</span><span class="ident" id="5276477">match</span><span class="op" id="5276482">[</span><span class="num" id="5276483">2</span><span class="op" id="5276484">*</span><span class="ident" id="5276485">num</span><span class="op" id="5276488">]</span><span class="op" id="5276489">:</span><span class="ident" id="5276490">match</span><span class="op" id="5276495">[</span><span class="num" id="5276496">2</span><span class="op" id="5276497">*</span><span class="ident" id="5276498">num</span><span class="op" id="5276501">+</span><span class="num" id="5276502">1</span><span class="op" id="5276503">]</span><span class="op" id="5276504">]</span><span class="op" id="5276505">...</span><span class="op" id="5276508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276514">}</span>&nbsp;<span class="keyword" id="5276516">else</span>&nbsp;<span class="op" id="5276521">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276528">dst</span>&nbsp;<span class="op" id="5276532">=</span>&nbsp;<span class="builtinfunc" id="5276534">append</span><span class="op" id="5276540">(</span><span class="ident" id="5276541">dst</span><span class="op" id="5276544">,</span>&nbsp;<span class="ident" id="5276546">src</span><span class="op" id="5276549">[</span><span class="ident" id="5276550">match</span><span class="op" id="5276555">[</span><span class="num" id="5276556">2</span><span class="op" id="5276557">*</span><span class="ident" id="5276558">num</span><span class="op" id="5276561">]</span><span class="op" id="5276562">:</span><span class="ident" id="5276563">match</span><span class="op" id="5276568">[</span><span class="num" id="5276569">2</span><span class="op" id="5276570">*</span><span class="ident" id="5276571">num</span><span class="op" id="5276574">+</span><span class="num" id="5276575">1</span><span class="op" id="5276576">]</span><span class="op" id="5276577">]</span><span class="op" id="5276578">...</span><span class="op" id="5276581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276596">}</span>&nbsp;<span class="keyword" id="5276598">else</span>&nbsp;<span class="op" id="5276603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276608">for</span>&nbsp;<span class="ident" id="5276612">i</span><span class="op" id="5276613">,</span>&nbsp;<span class="ident" id="5276615">namei</span>&nbsp;<span class="op" id="5276621">:=</span>&nbsp;<span class="keyword" id="5276624">range</span>&nbsp;<span class="ident" id="5276630">re</span><span class="op" id="5276632">.</span><span class="ident" id="5276633">subexpNames</span>&nbsp;<span class="op" id="5276645">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276651">if</span>&nbsp;<span class="ident" id="5276654">name</span>&nbsp;<span class="op" id="5276659">==</span>&nbsp;<span class="ident" id="5276662">namei</span>&nbsp;<span class="op" id="5276668">&amp;&amp;</span>&nbsp;<span class="num" id="5276671">2</span><span class="op" id="5276672">*</span><span class="ident" id="5276673">i</span><span class="op" id="5276674">+</span><span class="num" id="5276675">1</span>&nbsp;<span class="op" id="5276677">&lt;</span>&nbsp;<span class="builtinfunc" id="5276679">len</span><span class="op" id="5276682">(</span><span class="ident" id="5276683">match</span><span class="op" id="5276688">)</span>&nbsp;<span class="op" id="5276690">&amp;&amp;</span>&nbsp;<span class="ident" id="5276693">match</span><span class="op" id="5276698">[</span><span class="num" id="5276699">2</span><span class="op" id="5276700">*</span><span class="ident" id="5276701">i</span><span class="op" id="5276702">]</span>&nbsp;<span class="op" id="5276704">&gt;=</span>&nbsp;<span class="num" id="5276707">0</span>&nbsp;<span class="op" id="5276709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276716">if</span>&nbsp;<span class="ident" id="5276719">bsrc</span>&nbsp;<span class="op" id="5276724">!=</span>&nbsp;<span class="ident" id="5276727">nil</span>&nbsp;<span class="op" id="5276731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276739">dst</span>&nbsp;<span class="op" id="5276743">=</span>&nbsp;<span class="builtinfunc" id="5276745">append</span><span class="op" id="5276751">(</span><span class="ident" id="5276752">dst</span><span class="op" id="5276755">,</span>&nbsp;<span class="ident" id="5276757">bsrc</span><span class="op" id="5276761">[</span><span class="ident" id="5276762">match</span><span class="op" id="5276767">[</span><span class="num" id="5276768">2</span><span class="op" id="5276769">*</span><span class="ident" id="5276770">i</span><span class="op" id="5276771">]</span><span class="op" id="5276772">:</span><span class="ident" id="5276773">match</span><span class="op" id="5276778">[</span><span class="num" id="5276779">2</span><span class="op" id="5276780">*</span><span class="ident" id="5276781">i</span><span class="op" id="5276782">+</span><span class="num" id="5276783">1</span><span class="op" id="5276784">]</span><span class="op" id="5276785">]</span><span class="op" id="5276786">...</span><span class="op" id="5276789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276796">}</span>&nbsp;<span class="keyword" id="5276798">else</span>&nbsp;<span class="op" id="5276803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276811">dst</span>&nbsp;<span class="op" id="5276815">=</span>&nbsp;<span class="builtinfunc" id="5276817">append</span><span class="op" id="5276823">(</span><span class="ident" id="5276824">dst</span><span class="op" id="5276827">,</span>&nbsp;<span class="ident" id="5276829">src</span><span class="op" id="5276832">[</span><span class="ident" id="5276833">match</span><span class="op" id="5276838">[</span><span class="num" id="5276839">2</span><span class="op" id="5276840">*</span><span class="ident" id="5276841">i</span><span class="op" id="5276842">]</span><span class="op" id="5276843">:</span><span class="ident" id="5276844">match</span><span class="op" id="5276849">[</span><span class="num" id="5276850">2</span><span class="op" id="5276851">*</span><span class="ident" id="5276852">i</span><span class="op" id="5276853">+</span><span class="num" id="5276854">1</span><span class="op" id="5276855">]</span><span class="op" id="5276856">]</span><span class="op" id="5276857">...</span><span class="op" id="5276860">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276874">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276893">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5276896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5276899">dst</span>&nbsp;<span class="op" id="5276903">=</span>&nbsp;<span class="builtinfunc" id="5276905">append</span><span class="op" id="5276911">(</span><span class="ident" id="5276912">dst</span><span class="op" id="5276915">,</span>&nbsp;<span class="ident" id="5276917">template</span><span class="op" id="5276925">...</span><span class="op" id="5276928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5276931">return</span>&nbsp;<span class="ident" id="5276938">dst</span><br>
<span class="lineno"></span><span class="op" id="5276942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="5276945">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="5277017">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5277099">func</span>&nbsp;<span class="ident" id="5277104">extract</span><span class="op" id="5277111">(</span><span class="ident" id="5277112">str</span>&nbsp;<span class="builtintype" id="5277116">string</span><span class="op" id="5277122">)</span>&nbsp;<span class="op" id="5277124">(</span><span class="ident" id="5277125">name</span>&nbsp;<span class="builtintype" id="5277130">string</span><span class="op" id="5277136">,</span>&nbsp;<span class="ident" id="5277138">num</span>&nbsp;<span class="builtintype" id="5277142">int</span><span class="op" id="5277145">,</span>&nbsp;<span class="ident" id="5277147">rest</span>&nbsp;<span class="builtintype" id="5277152">string</span><span class="op" id="5277158">,</span>&nbsp;<span class="ident" id="5277160">ok</span>&nbsp;<span class="builtintype" id="5277163">bool</span><span class="op" id="5277167">)</span>&nbsp;<span class="op" id="5277169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277172">if</span>&nbsp;<span class="builtinfunc" id="5277175">len</span><span class="op" id="5277178">(</span><span class="ident" id="5277179">str</span><span class="op" id="5277182">)</span>&nbsp;<span class="op" id="5277184">&lt;</span>&nbsp;<span class="num" id="5277186">2</span>&nbsp;<span class="op" id="5277188">||</span>&nbsp;<span class="ident" id="5277191">str</span><span class="op" id="5277194">[</span><span class="num" id="5277195">0</span><span class="op" id="5277196">]</span>&nbsp;<span class="op" id="5277198">!=</span>&nbsp;<span class="string" id="5277201">&#39;$&#39;</span>&nbsp;<span class="op" id="5277205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277209">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277220">brace</span>&nbsp;<span class="op" id="5277226">:=</span>&nbsp;<span class="builtintype" id="5277229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277236">if</span>&nbsp;<span class="ident" id="5277239">str</span><span class="op" id="5277242">[</span><span class="num" id="5277243">1</span><span class="op" id="5277244">]</span>&nbsp;<span class="op" id="5277246">==</span>&nbsp;<span class="string" id="5277249">&#39;{&#39;</span>&nbsp;<span class="op" id="5277253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277257">brace</span>&nbsp;<span class="op" id="5277263">=</span>&nbsp;<span class="builtintype" id="5277265">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277272">str</span>&nbsp;<span class="op" id="5277276">=</span>&nbsp;<span class="ident" id="5277278">str</span><span class="op" id="5277281">[</span><span class="num" id="5277282">2</span><span class="op" id="5277283">:</span><span class="op" id="5277284">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277287">}</span>&nbsp;<span class="keyword" id="5277289">else</span>&nbsp;<span class="op" id="5277294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277298">str</span>&nbsp;<span class="op" id="5277302">=</span>&nbsp;<span class="ident" id="5277304">str</span><span class="op" id="5277307">[</span><span class="num" id="5277308">1</span><span class="op" id="5277309">:</span><span class="op" id="5277310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277316">i</span>&nbsp;<span class="op" id="5277318">:=</span>&nbsp;<span class="num" id="5277321">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277324">for</span>&nbsp;<span class="ident" id="5277328">i</span>&nbsp;<span class="op" id="5277330">&lt;</span>&nbsp;<span class="builtinfunc" id="5277332">len</span><span class="op" id="5277335">(</span><span class="ident" id="5277336">str</span><span class="op" id="5277339">)</span>&nbsp;<span class="op" id="5277341">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5277345">rune</span><span class="op" id="5277349">,</span>&nbsp;<span class="ident" id="5277351">size</span>&nbsp;<span class="op" id="5277356">:=</span>&nbsp;<span class="ident" id="5277359">utf8</span><span class="op" id="5277363">.</span><span class="ident" id="5277364">DecodeRuneInString</span><span class="op" id="5277382">(</span><span class="ident" id="5277383">str</span><span class="op" id="5277386">[</span><span class="ident" id="5277387">i</span><span class="op" id="5277388">:</span><span class="op" id="5277389">]</span><span class="op" id="5277390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277394">if</span>&nbsp;<span class="op" id="5277397">!</span><span class="ident" id="5277398">unicode</span><span class="op" id="5277405">.</span><span class="ident" id="5277406">IsLetter</span><span class="op" id="5277414">(</span><span class="builtintype" id="5277415">rune</span><span class="op" id="5277419">)</span>&nbsp;<span class="op" id="5277421">&amp;&amp;</span>&nbsp;<span class="op" id="5277424">!</span><span class="ident" id="5277425">unicode</span><span class="op" id="5277432">.</span><span class="ident" id="5277433">IsDigit</span><span class="op" id="5277440">(</span><span class="builtintype" id="5277441">rune</span><span class="op" id="5277445">)</span>&nbsp;<span class="op" id="5277447">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5277450">rune</span>&nbsp;<span class="op" id="5277455">!=</span>&nbsp;<span class="string" id="5277458">&#39;_&#39;</span>&nbsp;<span class="op" id="5277462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277467">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277479">i</span>&nbsp;<span class="op" id="5277481">+=</span>&nbsp;<span class="ident" id="5277484">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277493">if</span>&nbsp;<span class="ident" id="5277496">i</span>&nbsp;<span class="op" id="5277498">==</span>&nbsp;<span class="num" id="5277501">0</span>&nbsp;<span class="op" id="5277503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5277507">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277543">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277546">name</span>&nbsp;<span class="op" id="5277551">=</span>&nbsp;<span class="ident" id="5277553">str</span><span class="op" id="5277556">[</span><span class="op" id="5277557">:</span><span class="ident" id="5277558">i</span><span class="op" id="5277559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277562">if</span>&nbsp;<span class="ident" id="5277565">brace</span>&nbsp;<span class="op" id="5277571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277575">if</span>&nbsp;<span class="ident" id="5277578">i</span>&nbsp;<span class="op" id="5277580">&gt;=</span>&nbsp;<span class="builtinfunc" id="5277583">len</span><span class="op" id="5277586">(</span><span class="ident" id="5277587">str</span><span class="op" id="5277590">)</span>&nbsp;<span class="op" id="5277592">||</span>&nbsp;<span class="ident" id="5277595">str</span><span class="op" id="5277598">[</span><span class="ident" id="5277599">i</span><span class="op" id="5277600">]</span>&nbsp;<span class="op" id="5277602">!=</span>&nbsp;<span class="string" id="5277605">&#39;}&#39;</span>&nbsp;<span class="op" id="5277609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5277614">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277642">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277655">i</span><span class="op" id="5277656">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5277664">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277682">num</span>&nbsp;<span class="op" id="5277686">=</span>&nbsp;<span class="num" id="5277688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277691">for</span>&nbsp;<span class="ident" id="5277695">i</span>&nbsp;<span class="op" id="5277697">:=</span>&nbsp;<span class="num" id="5277700">0</span><span class="op" id="5277701">;</span>&nbsp;<span class="ident" id="5277703">i</span>&nbsp;<span class="op" id="5277705">&lt;</span>&nbsp;<span class="builtinfunc" id="5277707">len</span><span class="op" id="5277710">(</span><span class="ident" id="5277711">name</span><span class="op" id="5277715">)</span><span class="op" id="5277716">;</span>&nbsp;<span class="ident" id="5277718">i</span><span class="op" id="5277719">++</span>&nbsp;<span class="op" id="5277722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277726">if</span>&nbsp;<span class="ident" id="5277729">name</span><span class="op" id="5277733">[</span><span class="ident" id="5277734">i</span><span class="op" id="5277735">]</span>&nbsp;<span class="op" id="5277737">&lt;</span>&nbsp;<span class="string" id="5277739">&#39;0&#39;</span>&nbsp;<span class="op" id="5277743">||</span>&nbsp;<span class="string" id="5277746">&#39;9&#39;</span>&nbsp;<span class="op" id="5277750">&lt;</span>&nbsp;<span class="ident" id="5277752">name</span><span class="op" id="5277756">[</span><span class="ident" id="5277757">i</span><span class="op" id="5277758">]</span>&nbsp;<span class="op" id="5277760">||</span>&nbsp;<span class="ident" id="5277763">num</span>&nbsp;<span class="op" id="5277767">&gt;=</span>&nbsp;<span class="num" id="5277770">1e8</span>&nbsp;<span class="op" id="5277774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277779">num</span>&nbsp;<span class="op" id="5277783">=</span>&nbsp;<span class="op" id="5277785">-</span><span class="num" id="5277786">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277791">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277803">num</span>&nbsp;<span class="op" id="5277807">=</span>&nbsp;<span class="ident" id="5277809">num</span><span class="op" id="5277812">*</span><span class="num" id="5277813">10</span>&nbsp;<span class="op" id="5277816">+</span>&nbsp;<span class="builtintype" id="5277818">int</span><span class="op" id="5277821">(</span><span class="ident" id="5277822">name</span><span class="op" id="5277826">[</span><span class="ident" id="5277827">i</span><span class="op" id="5277828">]</span><span class="op" id="5277829">)</span>&nbsp;<span class="op" id="5277831">-</span>&nbsp;<span class="string" id="5277833">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5277841">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277869">if</span>&nbsp;<span class="ident" id="5277872">name</span><span class="op" id="5277876">[</span><span class="num" id="5277877">0</span><span class="op" id="5277878">]</span>&nbsp;<span class="op" id="5277880">==</span>&nbsp;<span class="string" id="5277883">&#39;0&#39;</span>&nbsp;<span class="op" id="5277887">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5277890">len</span><span class="op" id="5277893">(</span><span class="ident" id="5277894">name</span><span class="op" id="5277898">)</span>&nbsp;<span class="op" id="5277900">&gt;</span>&nbsp;<span class="num" id="5277902">1</span>&nbsp;<span class="op" id="5277904">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277908">num</span>&nbsp;<span class="op" id="5277912">=</span>&nbsp;<span class="op" id="5277914">-</span><span class="num" id="5277915">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5277918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277922">rest</span>&nbsp;<span class="op" id="5277927">=</span>&nbsp;<span class="ident" id="5277929">str</span><span class="op" id="5277932">[</span><span class="ident" id="5277933">i</span><span class="op" id="5277934">:</span><span class="op" id="5277935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5277938">ok</span>&nbsp;<span class="op" id="5277941">=</span>&nbsp;<span class="builtintype" id="5277943">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5277949">return</span><br>
<span class="lineno"></span><span class="op" id="5277956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5277959">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5278036">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="5278113">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="5278190">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5278217">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5278262">func</span>&nbsp;<span class="op" id="5278267">(</span><span class="ident" id="5278268">re</span>&nbsp;<span class="op" id="5278271">*</span><span class="ident" id="5278272">Regexp</span><span class="op" id="5278278">)</span>&nbsp;<span class="ident" id="5278280">FindSubmatchIndex</span><span class="op" id="5278297">(</span><span class="ident" id="5278298">b</span>&nbsp;<span class="op" id="5278300">[</span><span class="op" id="5278301">]</span><span class="builtintype" id="5278302">byte</span><span class="op" id="5278306">)</span>&nbsp;<span class="op" id="5278308">[</span><span class="op" id="5278309">]</span><span class="builtintype" id="5278310">int</span>&nbsp;<span class="op" id="5278314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278317">return</span>&nbsp;<span class="ident" id="5278324">re</span><span class="op" id="5278326">.</span><span class="ident" id="5278327">pad</span><span class="op" id="5278330">(</span><span class="ident" id="5278331">re</span><span class="op" id="5278333">.</span><span class="ident" id="5278334">doExecute</span><span class="op" id="5278343">(</span><span class="ident" id="5278344">nil</span><span class="op" id="5278347">,</span>&nbsp;<span class="ident" id="5278349">b</span><span class="op" id="5278350">,</span>&nbsp;<span class="string" id="5278352">&#34;&#34;</span><span class="op" id="5278354">,</span>&nbsp;<span class="num" id="5278356">0</span><span class="op" id="5278357">,</span>&nbsp;<span class="ident" id="5278359">re</span><span class="op" id="5278361">.</span><span class="ident" id="5278362">prog</span><span class="op" id="5278366">.</span><span class="ident" id="5278367">NumCap</span><span class="op" id="5278373">)</span><span class="op" id="5278374">)</span><br>
<span class="lineno">875</span><span class="op" id="5278376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5278379">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5278452">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5278529">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="5278600">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5278620">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5278665">func</span>&nbsp;<span class="op" id="5278670">(</span><span class="ident" id="5278671">re</span>&nbsp;<span class="op" id="5278674">*</span><span class="ident" id="5278675">Regexp</span><span class="op" id="5278681">)</span>&nbsp;<span class="ident" id="5278683">FindStringSubmatch</span><span class="op" id="5278701">(</span><span class="ident" id="5278702">s</span>&nbsp;<span class="builtintype" id="5278704">string</span><span class="op" id="5278710">)</span>&nbsp;<span class="op" id="5278712">[</span><span class="op" id="5278713">]</span><span class="builtintype" id="5278714">string</span>&nbsp;<span class="op" id="5278721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5278724">a</span>&nbsp;<span class="op" id="5278726">:=</span>&nbsp;<span class="ident" id="5278729">re</span><span class="op" id="5278731">.</span><span class="ident" id="5278732">doExecute</span><span class="op" id="5278741">(</span><span class="ident" id="5278742">nil</span><span class="op" id="5278745">,</span>&nbsp;<span class="ident" id="5278747">nil</span><span class="op" id="5278750">,</span>&nbsp;<span class="ident" id="5278752">s</span><span class="op" id="5278753">,</span>&nbsp;<span class="num" id="5278755">0</span><span class="op" id="5278756">,</span>&nbsp;<span class="ident" id="5278758">re</span><span class="op" id="5278760">.</span><span class="ident" id="5278761">prog</span><span class="op" id="5278765">.</span><span class="ident" id="5278766">NumCap</span><span class="op" id="5278772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278775">if</span>&nbsp;<span class="ident" id="5278778">a</span>&nbsp;<span class="op" id="5278780">==</span>&nbsp;<span class="ident" id="5278783">nil</span>&nbsp;<span class="op" id="5278787">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278791">return</span>&nbsp;<span class="ident" id="5278798">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5278803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5278806">ret</span>&nbsp;<span class="op" id="5278810">:=</span>&nbsp;<span class="builtinfunc" id="5278813">make</span><span class="op" id="5278817">(</span><span class="op" id="5278818">[</span><span class="op" id="5278819">]</span><span class="builtintype" id="5278820">string</span><span class="op" id="5278826">,</span>&nbsp;<span class="num" id="5278828">1</span><span class="op" id="5278829">+</span><span class="ident" id="5278830">re</span><span class="op" id="5278832">.</span><span class="ident" id="5278833">numSubexp</span><span class="op" id="5278842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278845">for</span>&nbsp;<span class="ident" id="5278849">i</span>&nbsp;<span class="op" id="5278851">:=</span>&nbsp;<span class="keyword" id="5278854">range</span>&nbsp;<span class="ident" id="5278860">ret</span>&nbsp;<span class="op" id="5278864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278868">if</span>&nbsp;<span class="num" id="5278871">2</span><span class="op" id="5278872">*</span><span class="ident" id="5278873">i</span>&nbsp;<span class="op" id="5278875">&lt;</span>&nbsp;<span class="builtinfunc" id="5278877">len</span><span class="op" id="5278880">(</span><span class="ident" id="5278881">a</span><span class="op" id="5278882">)</span>&nbsp;<span class="op" id="5278884">&amp;&amp;</span>&nbsp;<span class="ident" id="5278887">a</span><span class="op" id="5278888">[</span><span class="num" id="5278889">2</span><span class="op" id="5278890">*</span><span class="ident" id="5278891">i</span><span class="op" id="5278892">]</span>&nbsp;<span class="op" id="5278894">&gt;=</span>&nbsp;<span class="num" id="5278897">0</span>&nbsp;<span class="op" id="5278899">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5278904">ret</span><span class="op" id="5278907">[</span><span class="ident" id="5278908">i</span><span class="op" id="5278909">]</span>&nbsp;<span class="op" id="5278911">=</span>&nbsp;<span class="ident" id="5278913">s</span><span class="op" id="5278914">[</span><span class="ident" id="5278915">a</span><span class="op" id="5278916">[</span><span class="num" id="5278917">2</span><span class="op" id="5278918">*</span><span class="ident" id="5278919">i</span><span class="op" id="5278920">]</span><span class="op" id="5278921">:</span><span class="ident" id="5278922">a</span><span class="op" id="5278923">[</span><span class="num" id="5278924">2</span><span class="op" id="5278925">*</span><span class="ident" id="5278926">i</span><span class="op" id="5278927">+</span><span class="num" id="5278928">1</span><span class="op" id="5278929">]</span><span class="op" id="5278930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5278934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5278937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5278940">return</span>&nbsp;<span class="ident" id="5278947">ret</span><br>
<span class="lineno"></span><span class="op" id="5278951">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="5278954">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5279021">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5279094">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5279170">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="5279218">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5279263">func</span>&nbsp;<span class="op" id="5279268">(</span><span class="ident" id="5279269">re</span>&nbsp;<span class="op" id="5279272">*</span><span class="ident" id="5279273">Regexp</span><span class="op" id="5279279">)</span>&nbsp;<span class="ident" id="5279281">FindStringSubmatchIndex</span><span class="op" id="5279304">(</span><span class="ident" id="5279305">s</span>&nbsp;<span class="builtintype" id="5279307">string</span><span class="op" id="5279313">)</span>&nbsp;<span class="op" id="5279315">[</span><span class="op" id="5279316">]</span><span class="builtintype" id="5279317">int</span>&nbsp;<span class="op" id="5279321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5279324">return</span>&nbsp;<span class="ident" id="5279331">re</span><span class="op" id="5279333">.</span><span class="ident" id="5279334">pad</span><span class="op" id="5279337">(</span><span class="ident" id="5279338">re</span><span class="op" id="5279340">.</span><span class="ident" id="5279341">doExecute</span><span class="op" id="5279350">(</span><span class="ident" id="5279351">nil</span><span class="op" id="5279354">,</span>&nbsp;<span class="ident" id="5279356">nil</span><span class="op" id="5279359">,</span>&nbsp;<span class="ident" id="5279361">s</span><span class="op" id="5279362">,</span>&nbsp;<span class="num" id="5279364">0</span><span class="op" id="5279365">,</span>&nbsp;<span class="ident" id="5279367">re</span><span class="op" id="5279369">.</span><span class="ident" id="5279370">prog</span><span class="op" id="5279374">.</span><span class="ident" id="5279375">NumCap</span><span class="op" id="5279381">)</span><span class="op" id="5279382">)</span><br>
<span class="lineno"></span><span class="op" id="5279384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5279387">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5279454">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5279530">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="5279608">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="5279681">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="5279724">func</span>&nbsp;<span class="op" id="5279729">(</span><span class="ident" id="5279730">re</span>&nbsp;<span class="op" id="5279733">*</span><span class="ident" id="5279734">Regexp</span><span class="op" id="5279740">)</span>&nbsp;<span class="ident" id="5279742">FindReaderSubmatchIndex</span><span class="op" id="5279765">(</span><span class="ident" id="5279766">r</span>&nbsp;<span class="ident" id="5279768">io</span><span class="op" id="5279770">.</span><span class="ident" id="5279771">RuneReader</span><span class="op" id="5279781">)</span>&nbsp;<span class="op" id="5279783">[</span><span class="op" id="5279784">]</span><span class="builtintype" id="5279785">int</span>&nbsp;<span class="op" id="5279789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5279792">return</span>&nbsp;<span class="ident" id="5279799">re</span><span class="op" id="5279801">.</span><span class="ident" id="5279802">pad</span><span class="op" id="5279805">(</span><span class="ident" id="5279806">re</span><span class="op" id="5279808">.</span><span class="ident" id="5279809">doExecute</span><span class="op" id="5279818">(</span><span class="ident" id="5279819">r</span><span class="op" id="5279820">,</span>&nbsp;<span class="ident" id="5279822">nil</span><span class="op" id="5279825">,</span>&nbsp;<span class="string" id="5279827">&#34;&#34;</span><span class="op" id="5279829">,</span>&nbsp;<span class="num" id="5279831">0</span><span class="op" id="5279832">,</span>&nbsp;<span class="ident" id="5279834">re</span><span class="op" id="5279836">.</span><span class="ident" id="5279837">prog</span><span class="op" id="5279841">.</span><span class="ident" id="5279842">NumCap</span><span class="op" id="5279848">)</span><span class="op" id="5279849">)</span><br>
<span class="lineno"></span><span class="op" id="5279851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5279854">const</span>&nbsp;<span class="ident" id="5279860">startSize</span>&nbsp;<span class="op" id="5279870">=</span>&nbsp;<span class="num" id="5279872">10</span>&nbsp;<span class="comment" id="5279875">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="5279937">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5280015">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5280088">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5280108">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="5280153">func</span>&nbsp;<span class="op" id="5280158">(</span><span class="ident" id="5280159">re</span>&nbsp;<span class="op" id="5280162">*</span><span class="ident" id="5280163">Regexp</span><span class="op" id="5280169">)</span>&nbsp;<span class="ident" id="5280171">FindAll</span><span class="op" id="5280178">(</span><span class="ident" id="5280179">b</span>&nbsp;<span class="op" id="5280181">[</span><span class="op" id="5280182">]</span><span class="builtintype" id="5280183">byte</span><span class="op" id="5280187">,</span>&nbsp;<span class="ident" id="5280189">n</span>&nbsp;<span class="builtintype" id="5280191">int</span><span class="op" id="5280194">)</span>&nbsp;<span class="op" id="5280196">[</span><span class="op" id="5280197">]</span><span class="op" id="5280198">[</span><span class="op" id="5280199">]</span><span class="builtintype" id="5280200">byte</span>&nbsp;<span class="op" id="5280205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280208">if</span>&nbsp;<span class="ident" id="5280211">n</span>&nbsp;<span class="op" id="5280213">&lt;</span>&nbsp;<span class="num" id="5280215">0</span>&nbsp;<span class="op" id="5280217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280221">n</span>&nbsp;<span class="op" id="5280223">=</span>&nbsp;<span class="builtinfunc" id="5280225">len</span><span class="op" id="5280228">(</span><span class="ident" id="5280229">b</span><span class="op" id="5280230">)</span>&nbsp;<span class="op" id="5280232">+</span>&nbsp;<span class="num" id="5280234">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280240">result</span>&nbsp;<span class="op" id="5280247">:=</span>&nbsp;<span class="builtinfunc" id="5280250">make</span><span class="op" id="5280254">(</span><span class="op" id="5280255">[</span><span class="op" id="5280256">]</span><span class="op" id="5280257">[</span><span class="op" id="5280258">]</span><span class="builtintype" id="5280259">byte</span><span class="op" id="5280263">,</span>&nbsp;<span class="num" id="5280265">0</span><span class="op" id="5280266">,</span>&nbsp;<span class="ident" id="5280268">startSize</span><span class="op" id="5280277">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280280">re</span><span class="op" id="5280282">.</span><span class="ident" id="5280283">allMatches</span><span class="op" id="5280293">(</span><span class="string" id="5280294">&#34;&#34;</span><span class="op" id="5280296">,</span>&nbsp;<span class="ident" id="5280298">b</span><span class="op" id="5280299">,</span>&nbsp;<span class="ident" id="5280301">n</span><span class="op" id="5280302">,</span>&nbsp;<span class="keyword" id="5280304">func</span><span class="op" id="5280308">(</span><span class="ident" id="5280309">match</span>&nbsp;<span class="op" id="5280315">[</span><span class="op" id="5280316">]</span><span class="builtintype" id="5280317">int</span><span class="op" id="5280320">)</span>&nbsp;<span class="op" id="5280322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280326">result</span>&nbsp;<span class="op" id="5280333">=</span>&nbsp;<span class="builtinfunc" id="5280335">append</span><span class="op" id="5280341">(</span><span class="ident" id="5280342">result</span><span class="op" id="5280348">,</span>&nbsp;<span class="ident" id="5280350">b</span><span class="op" id="5280351">[</span><span class="ident" id="5280352">match</span><span class="op" id="5280357">[</span><span class="num" id="5280358">0</span><span class="op" id="5280359">]</span><span class="op" id="5280360">:</span><span class="ident" id="5280361">match</span><span class="op" id="5280366">[</span><span class="num" id="5280367">1</span><span class="op" id="5280368">]</span><span class="op" id="5280369">]</span><span class="op" id="5280370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280373">}</span><span class="op" id="5280374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280377">if</span>&nbsp;<span class="builtinfunc" id="5280380">len</span><span class="op" id="5280383">(</span><span class="ident" id="5280384">result</span><span class="op" id="5280390">)</span>&nbsp;<span class="op" id="5280392">==</span>&nbsp;<span class="num" id="5280395">0</span>&nbsp;<span class="op" id="5280397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280401">return</span>&nbsp;<span class="ident" id="5280408">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280416">return</span>&nbsp;<span class="ident" id="5280423">result</span><br>
<span class="lineno"></span><span class="op" id="5280430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5280433">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="5280510">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5280587">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5280614">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5280659">func</span>&nbsp;<span class="op" id="5280664">(</span><span class="ident" id="5280665">re</span>&nbsp;<span class="op" id="5280668">*</span><span class="ident" id="5280669">Regexp</span><span class="op" id="5280675">)</span>&nbsp;<span class="ident" id="5280677">FindAllIndex</span><span class="op" id="5280689">(</span><span class="ident" id="5280690">b</span>&nbsp;<span class="op" id="5280692">[</span><span class="op" id="5280693">]</span><span class="builtintype" id="5280694">byte</span><span class="op" id="5280698">,</span>&nbsp;<span class="ident" id="5280700">n</span>&nbsp;<span class="builtintype" id="5280702">int</span><span class="op" id="5280705">)</span>&nbsp;<span class="op" id="5280707">[</span><span class="op" id="5280708">]</span><span class="op" id="5280709">[</span><span class="op" id="5280710">]</span><span class="builtintype" id="5280711">int</span>&nbsp;<span class="op" id="5280715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280718">if</span>&nbsp;<span class="ident" id="5280721">n</span>&nbsp;<span class="op" id="5280723">&lt;</span>&nbsp;<span class="num" id="5280725">0</span>&nbsp;<span class="op" id="5280727">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280731">n</span>&nbsp;<span class="op" id="5280733">=</span>&nbsp;<span class="builtinfunc" id="5280735">len</span><span class="op" id="5280738">(</span><span class="ident" id="5280739">b</span><span class="op" id="5280740">)</span>&nbsp;<span class="op" id="5280742">+</span>&nbsp;<span class="num" id="5280744">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280750">result</span>&nbsp;<span class="op" id="5280757">:=</span>&nbsp;<span class="builtinfunc" id="5280760">make</span><span class="op" id="5280764">(</span><span class="op" id="5280765">[</span><span class="op" id="5280766">]</span><span class="op" id="5280767">[</span><span class="op" id="5280768">]</span><span class="builtintype" id="5280769">int</span><span class="op" id="5280772">,</span>&nbsp;<span class="num" id="5280774">0</span><span class="op" id="5280775">,</span>&nbsp;<span class="ident" id="5280777">startSize</span><span class="op" id="5280786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280789">re</span><span class="op" id="5280791">.</span><span class="ident" id="5280792">allMatches</span><span class="op" id="5280802">(</span><span class="string" id="5280803">&#34;&#34;</span><span class="op" id="5280805">,</span>&nbsp;<span class="ident" id="5280807">b</span><span class="op" id="5280808">,</span>&nbsp;<span class="ident" id="5280810">n</span><span class="op" id="5280811">,</span>&nbsp;<span class="keyword" id="5280813">func</span><span class="op" id="5280817">(</span><span class="ident" id="5280818">match</span>&nbsp;<span class="op" id="5280824">[</span><span class="op" id="5280825">]</span><span class="builtintype" id="5280826">int</span><span class="op" id="5280829">)</span>&nbsp;<span class="op" id="5280831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5280835">result</span>&nbsp;<span class="op" id="5280842">=</span>&nbsp;<span class="builtinfunc" id="5280844">append</span><span class="op" id="5280850">(</span><span class="ident" id="5280851">result</span><span class="op" id="5280857">,</span>&nbsp;<span class="ident" id="5280859">match</span><span class="op" id="5280864">[</span><span class="num" id="5280865">0</span><span class="op" id="5280866">:</span><span class="num" id="5280867">2</span><span class="op" id="5280868">]</span><span class="op" id="5280869">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280872">}</span><span class="op" id="5280873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280876">if</span>&nbsp;<span class="builtinfunc" id="5280879">len</span><span class="op" id="5280882">(</span><span class="ident" id="5280883">result</span><span class="op" id="5280889">)</span>&nbsp;<span class="op" id="5280891">==</span>&nbsp;<span class="num" id="5280894">0</span>&nbsp;<span class="op" id="5280896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280900">return</span>&nbsp;<span class="ident" id="5280907">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5280912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5280915">return</span>&nbsp;<span class="ident" id="5280922">result</span><br>
<span class="lineno">950</span><span class="op" id="5280929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5280932">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5281011">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5281088">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="5281115">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5281160">func</span>&nbsp;<span class="op" id="5281165">(</span><span class="ident" id="5281166">re</span>&nbsp;<span class="op" id="5281169">*</span><span class="ident" id="5281170">Regexp</span><span class="op" id="5281176">)</span>&nbsp;<span class="ident" id="5281178">FindAllString</span><span class="op" id="5281191">(</span><span class="ident" id="5281192">s</span>&nbsp;<span class="builtintype" id="5281194">string</span><span class="op" id="5281200">,</span>&nbsp;<span class="ident" id="5281202">n</span>&nbsp;<span class="builtintype" id="5281204">int</span><span class="op" id="5281207">)</span>&nbsp;<span class="op" id="5281209">[</span><span class="op" id="5281210">]</span><span class="builtintype" id="5281211">string</span>&nbsp;<span class="op" id="5281218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281221">if</span>&nbsp;<span class="ident" id="5281224">n</span>&nbsp;<span class="op" id="5281226">&lt;</span>&nbsp;<span class="num" id="5281228">0</span>&nbsp;<span class="op" id="5281230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281234">n</span>&nbsp;<span class="op" id="5281236">=</span>&nbsp;<span class="builtinfunc" id="5281238">len</span><span class="op" id="5281241">(</span><span class="ident" id="5281242">s</span><span class="op" id="5281243">)</span>&nbsp;<span class="op" id="5281245">+</span>&nbsp;<span class="num" id="5281247">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281250">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281253">result</span>&nbsp;<span class="op" id="5281260">:=</span>&nbsp;<span class="builtinfunc" id="5281263">make</span><span class="op" id="5281267">(</span><span class="op" id="5281268">[</span><span class="op" id="5281269">]</span><span class="builtintype" id="5281270">string</span><span class="op" id="5281276">,</span>&nbsp;<span class="num" id="5281278">0</span><span class="op" id="5281279">,</span>&nbsp;<span class="ident" id="5281281">startSize</span><span class="op" id="5281290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281293">re</span><span class="op" id="5281295">.</span><span class="ident" id="5281296">allMatches</span><span class="op" id="5281306">(</span><span class="ident" id="5281307">s</span><span class="op" id="5281308">,</span>&nbsp;<span class="ident" id="5281310">nil</span><span class="op" id="5281313">,</span>&nbsp;<span class="ident" id="5281315">n</span><span class="op" id="5281316">,</span>&nbsp;<span class="keyword" id="5281318">func</span><span class="op" id="5281322">(</span><span class="ident" id="5281323">match</span>&nbsp;<span class="op" id="5281329">[</span><span class="op" id="5281330">]</span><span class="builtintype" id="5281331">int</span><span class="op" id="5281334">)</span>&nbsp;<span class="op" id="5281336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281340">result</span>&nbsp;<span class="op" id="5281347">=</span>&nbsp;<span class="builtinfunc" id="5281349">append</span><span class="op" id="5281355">(</span><span class="ident" id="5281356">result</span><span class="op" id="5281362">,</span>&nbsp;<span class="ident" id="5281364">s</span><span class="op" id="5281365">[</span><span class="ident" id="5281366">match</span><span class="op" id="5281371">[</span><span class="num" id="5281372">0</span><span class="op" id="5281373">]</span><span class="op" id="5281374">:</span><span class="ident" id="5281375">match</span><span class="op" id="5281380">[</span><span class="num" id="5281381">1</span><span class="op" id="5281382">]</span><span class="op" id="5281383">]</span><span class="op" id="5281384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281387">}</span><span class="op" id="5281388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281391">if</span>&nbsp;<span class="builtinfunc" id="5281394">len</span><span class="op" id="5281397">(</span><span class="ident" id="5281398">result</span><span class="op" id="5281404">)</span>&nbsp;<span class="op" id="5281406">==</span>&nbsp;<span class="num" id="5281409">0</span>&nbsp;<span class="op" id="5281411">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281415">return</span>&nbsp;<span class="ident" id="5281422">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281430">return</span>&nbsp;<span class="ident" id="5281437">result</span><br>
<span class="lineno"></span><span class="op" id="5281444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="5281447">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5281523">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="5281601">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5281640">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5281685">func</span>&nbsp;<span class="op" id="5281690">(</span><span class="ident" id="5281691">re</span>&nbsp;<span class="op" id="5281694">*</span><span class="ident" id="5281695">Regexp</span><span class="op" id="5281701">)</span>&nbsp;<span class="ident" id="5281703">FindAllStringIndex</span><span class="op" id="5281721">(</span><span class="ident" id="5281722">s</span>&nbsp;<span class="builtintype" id="5281724">string</span><span class="op" id="5281730">,</span>&nbsp;<span class="ident" id="5281732">n</span>&nbsp;<span class="builtintype" id="5281734">int</span><span class="op" id="5281737">)</span>&nbsp;<span class="op" id="5281739">[</span><span class="op" id="5281740">]</span><span class="op" id="5281741">[</span><span class="op" id="5281742">]</span><span class="builtintype" id="5281743">int</span>&nbsp;<span class="op" id="5281747">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281750">if</span>&nbsp;<span class="ident" id="5281753">n</span>&nbsp;<span class="op" id="5281755">&lt;</span>&nbsp;<span class="num" id="5281757">0</span>&nbsp;<span class="op" id="5281759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281763">n</span>&nbsp;<span class="op" id="5281765">=</span>&nbsp;<span class="builtinfunc" id="5281767">len</span><span class="op" id="5281770">(</span><span class="ident" id="5281771">s</span><span class="op" id="5281772">)</span>&nbsp;<span class="op" id="5281774">+</span>&nbsp;<span class="num" id="5281776">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281782">result</span>&nbsp;<span class="op" id="5281789">:=</span>&nbsp;<span class="builtinfunc" id="5281792">make</span><span class="op" id="5281796">(</span><span class="op" id="5281797">[</span><span class="op" id="5281798">]</span><span class="op" id="5281799">[</span><span class="op" id="5281800">]</span><span class="builtintype" id="5281801">int</span><span class="op" id="5281804">,</span>&nbsp;<span class="num" id="5281806">0</span><span class="op" id="5281807">,</span>&nbsp;<span class="ident" id="5281809">startSize</span><span class="op" id="5281818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281821">re</span><span class="op" id="5281823">.</span><span class="ident" id="5281824">allMatches</span><span class="op" id="5281834">(</span><span class="ident" id="5281835">s</span><span class="op" id="5281836">,</span>&nbsp;<span class="ident" id="5281838">nil</span><span class="op" id="5281841">,</span>&nbsp;<span class="ident" id="5281843">n</span><span class="op" id="5281844">,</span>&nbsp;<span class="keyword" id="5281846">func</span><span class="op" id="5281850">(</span><span class="ident" id="5281851">match</span>&nbsp;<span class="op" id="5281857">[</span><span class="op" id="5281858">]</span><span class="builtintype" id="5281859">int</span><span class="op" id="5281862">)</span>&nbsp;<span class="op" id="5281864">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5281868">result</span>&nbsp;<span class="op" id="5281875">=</span>&nbsp;<span class="builtinfunc" id="5281877">append</span><span class="op" id="5281883">(</span><span class="ident" id="5281884">result</span><span class="op" id="5281890">,</span>&nbsp;<span class="ident" id="5281892">match</span><span class="op" id="5281897">[</span><span class="num" id="5281898">0</span><span class="op" id="5281899">:</span><span class="num" id="5281900">2</span><span class="op" id="5281901">]</span><span class="op" id="5281902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281905">}</span><span class="op" id="5281906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281909">if</span>&nbsp;<span class="builtinfunc" id="5281912">len</span><span class="op" id="5281915">(</span><span class="ident" id="5281916">result</span><span class="op" id="5281922">)</span>&nbsp;<span class="op" id="5281924">==</span>&nbsp;<span class="num" id="5281927">0</span>&nbsp;<span class="op" id="5281929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281933">return</span>&nbsp;<span class="ident" id="5281940">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5281945">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5281948">return</span>&nbsp;<span class="ident" id="5281955">result</span><br>
<span class="lineno"></span><span class="op" id="5281962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5281965">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5282041">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="5282113">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5282152">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5282197">func</span>&nbsp;<span class="op" id="5282202">(</span><span class="ident" id="5282203">re</span>&nbsp;<span class="op" id="5282206">*</span><span class="ident" id="5282207">Regexp</span><span class="op" id="5282213">)</span>&nbsp;<span class="ident" id="5282215">FindAllSubmatch</span><span class="op" id="5282230">(</span><span class="ident" id="5282231">b</span>&nbsp;<span class="op" id="5282233">[</span><span class="op" id="5282234">]</span><span class="builtintype" id="5282235">byte</span><span class="op" id="5282239">,</span>&nbsp;<span class="ident" id="5282241">n</span>&nbsp;<span class="builtintype" id="5282243">int</span><span class="op" id="5282246">)</span>&nbsp;<span class="op" id="5282248">[</span><span class="op" id="5282249">]</span><span class="op" id="5282250">[</span><span class="op" id="5282251">]</span><span class="op" id="5282252">[</span><span class="op" id="5282253">]</span><span class="builtintype" id="5282254">byte</span>&nbsp;<span class="op" id="5282259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282262">if</span>&nbsp;<span class="ident" id="5282265">n</span>&nbsp;<span class="op" id="5282267">&lt;</span>&nbsp;<span class="num" id="5282269">0</span>&nbsp;<span class="op" id="5282271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282275">n</span>&nbsp;<span class="op" id="5282277">=</span>&nbsp;<span class="builtinfunc" id="5282279">len</span><span class="op" id="5282282">(</span><span class="ident" id="5282283">b</span><span class="op" id="5282284">)</span>&nbsp;<span class="op" id="5282286">+</span>&nbsp;<span class="num" id="5282288">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282294">result</span>&nbsp;<span class="op" id="5282301">:=</span>&nbsp;<span class="builtinfunc" id="5282304">make</span><span class="op" id="5282308">(</span><span class="op" id="5282309">[</span><span class="op" id="5282310">]</span><span class="op" id="5282311">[</span><span class="op" id="5282312">]</span><span class="op" id="5282313">[</span><span class="op" id="5282314">]</span><span class="builtintype" id="5282315">byte</span><span class="op" id="5282319">,</span>&nbsp;<span class="num" id="5282321">0</span><span class="op" id="5282322">,</span>&nbsp;<span class="ident" id="5282324">startSize</span><span class="op" id="5282333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282336">re</span><span class="op" id="5282338">.</span><span class="ident" id="5282339">allMatches</span><span class="op" id="5282349">(</span><span class="string" id="5282350">&#34;&#34;</span><span class="op" id="5282352">,</span>&nbsp;<span class="ident" id="5282354">b</span><span class="op" id="5282355">,</span>&nbsp;<span class="ident" id="5282357">n</span><span class="op" id="5282358">,</span>&nbsp;<span class="keyword" id="5282360">func</span><span class="op" id="5282364">(</span><span class="ident" id="5282365">match</span>&nbsp;<span class="op" id="5282371">[</span><span class="op" id="5282372">]</span><span class="builtintype" id="5282373">int</span><span class="op" id="5282376">)</span>&nbsp;<span class="op" id="5282378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282382">slice</span>&nbsp;<span class="op" id="5282388">:=</span>&nbsp;<span class="builtinfunc" id="5282391">make</span><span class="op" id="5282395">(</span><span class="op" id="5282396">[</span><span class="op" id="5282397">]</span><span class="op" id="5282398">[</span><span class="op" id="5282399">]</span><span class="builtintype" id="5282400">byte</span><span class="op" id="5282404">,</span>&nbsp;<span class="builtinfunc" id="5282406">len</span><span class="op" id="5282409">(</span><span class="ident" id="5282410">match</span><span class="op" id="5282415">)</span><span class="op" id="5282416">/</span><span class="num" id="5282417">2</span><span class="op" id="5282418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282422">for</span>&nbsp;<span class="ident" id="5282426">j</span>&nbsp;<span class="op" id="5282428">:=</span>&nbsp;<span class="keyword" id="5282431">range</span>&nbsp;<span class="ident" id="5282437">slice</span>&nbsp;<span class="op" id="5282443">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282448">if</span>&nbsp;<span class="ident" id="5282451">match</span><span class="op" id="5282456">[</span><span class="num" id="5282457">2</span><span class="op" id="5282458">*</span><span class="ident" id="5282459">j</span><span class="op" id="5282460">]</span>&nbsp;<span class="op" id="5282462">&gt;=</span>&nbsp;<span class="num" id="5282465">0</span>&nbsp;<span class="op" id="5282467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282473">slice</span><span class="op" id="5282478">[</span><span class="ident" id="5282479">j</span><span class="op" id="5282480">]</span>&nbsp;<span class="op" id="5282482">=</span>&nbsp;<span class="ident" id="5282484">b</span><span class="op" id="5282485">[</span><span class="ident" id="5282486">match</span><span class="op" id="5282491">[</span><span class="num" id="5282492">2</span><span class="op" id="5282493">*</span><span class="ident" id="5282494">j</span><span class="op" id="5282495">]</span><span class="op" id="5282496">:</span><span class="ident" id="5282497">match</span><span class="op" id="5282502">[</span><span class="num" id="5282503">2</span><span class="op" id="5282504">*</span><span class="ident" id="5282505">j</span><span class="op" id="5282506">+</span><span class="num" id="5282507">1</span><span class="op" id="5282508">]</span><span class="op" id="5282509">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282522">result</span>&nbsp;<span class="op" id="5282529">=</span>&nbsp;<span class="builtinfunc" id="5282531">append</span><span class="op" id="5282537">(</span><span class="ident" id="5282538">result</span><span class="op" id="5282544">,</span>&nbsp;<span class="ident" id="5282546">slice</span><span class="op" id="5282551">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282554">}</span><span class="op" id="5282555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282558">if</span>&nbsp;<span class="builtinfunc" id="5282561">len</span><span class="op" id="5282564">(</span><span class="ident" id="5282565">result</span><span class="op" id="5282571">)</span>&nbsp;<span class="op" id="5282573">==</span>&nbsp;<span class="num" id="5282576">0</span>&nbsp;<span class="op" id="5282578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282582">return</span>&nbsp;<span class="ident" id="5282589">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282597">return</span>&nbsp;<span class="ident" id="5282604">result</span><br>
<span class="lineno">1010</span><span class="op" id="5282611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5282614">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5282692">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5282766">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="5282811">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5282856">func</span>&nbsp;<span class="op" id="5282861">(</span><span class="ident" id="5282862">re</span>&nbsp;<span class="op" id="5282865">*</span><span class="ident" id="5282866">Regexp</span><span class="op" id="5282872">)</span>&nbsp;<span class="ident" id="5282874">FindAllSubmatchIndex</span><span class="op" id="5282894">(</span><span class="ident" id="5282895">b</span>&nbsp;<span class="op" id="5282897">[</span><span class="op" id="5282898">]</span><span class="builtintype" id="5282899">byte</span><span class="op" id="5282903">,</span>&nbsp;<span class="ident" id="5282905">n</span>&nbsp;<span class="builtintype" id="5282907">int</span><span class="op" id="5282910">)</span>&nbsp;<span class="op" id="5282912">[</span><span class="op" id="5282913">]</span><span class="op" id="5282914">[</span><span class="op" id="5282915">]</span><span class="builtintype" id="5282916">int</span>&nbsp;<span class="op" id="5282920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5282923">if</span>&nbsp;<span class="ident" id="5282926">n</span>&nbsp;<span class="op" id="5282928">&lt;</span>&nbsp;<span class="num" id="5282930">0</span>&nbsp;<span class="op" id="5282932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282936">n</span>&nbsp;<span class="op" id="5282938">=</span>&nbsp;<span class="builtinfunc" id="5282940">len</span><span class="op" id="5282943">(</span><span class="ident" id="5282944">b</span><span class="op" id="5282945">)</span>&nbsp;<span class="op" id="5282947">+</span>&nbsp;<span class="num" id="5282949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5282952">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282955">result</span>&nbsp;<span class="op" id="5282962">:=</span>&nbsp;<span class="builtinfunc" id="5282965">make</span><span class="op" id="5282969">(</span><span class="op" id="5282970">[</span><span class="op" id="5282971">]</span><span class="op" id="5282972">[</span><span class="op" id="5282973">]</span><span class="builtintype" id="5282974">int</span><span class="op" id="5282977">,</span>&nbsp;<span class="num" id="5282979">0</span><span class="op" id="5282980">,</span>&nbsp;<span class="ident" id="5282982">startSize</span><span class="op" id="5282991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5282994">re</span><span class="op" id="5282996">.</span><span class="ident" id="5282997">allMatches</span><span class="op" id="5283007">(</span><span class="string" id="5283008">&#34;&#34;</span><span class="op" id="5283010">,</span>&nbsp;<span class="ident" id="5283012">b</span><span class="op" id="5283013">,</span>&nbsp;<span class="ident" id="5283015">n</span><span class="op" id="5283016">,</span>&nbsp;<span class="keyword" id="5283018">func</span><span class="op" id="5283022">(</span><span class="ident" id="5283023">match</span>&nbsp;<span class="op" id="5283029">[</span><span class="op" id="5283030">]</span><span class="builtintype" id="5283031">int</span><span class="op" id="5283034">)</span>&nbsp;<span class="op" id="5283036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283040">result</span>&nbsp;<span class="op" id="5283047">=</span>&nbsp;<span class="builtinfunc" id="5283049">append</span><span class="op" id="5283055">(</span><span class="ident" id="5283056">result</span><span class="op" id="5283062">,</span>&nbsp;<span class="ident" id="5283064">match</span><span class="op" id="5283069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283072">}</span><span class="op" id="5283073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283076">if</span>&nbsp;<span class="builtinfunc" id="5283079">len</span><span class="op" id="5283082">(</span><span class="ident" id="5283083">result</span><span class="op" id="5283089">)</span>&nbsp;<span class="op" id="5283091">==</span>&nbsp;<span class="num" id="5283094">0</span>&nbsp;<span class="op" id="5283096">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283100">return</span>&nbsp;<span class="ident" id="5283107">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283115">return</span>&nbsp;<span class="ident" id="5283122">result</span><br>
<span class="lineno"></span><span class="op" id="5283129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="5283132">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5283204">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5283282">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5283331">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5283376">func</span>&nbsp;<span class="op" id="5283381">(</span><span class="ident" id="5283382">re</span>&nbsp;<span class="op" id="5283385">*</span><span class="ident" id="5283386">Regexp</span><span class="op" id="5283392">)</span>&nbsp;<span class="ident" id="5283394">FindAllStringSubmatch</span><span class="op" id="5283415">(</span><span class="ident" id="5283416">s</span>&nbsp;<span class="builtintype" id="5283418">string</span><span class="op" id="5283424">,</span>&nbsp;<span class="ident" id="5283426">n</span>&nbsp;<span class="builtintype" id="5283428">int</span><span class="op" id="5283431">)</span>&nbsp;<span class="op" id="5283433">[</span><span class="op" id="5283434">]</span><span class="op" id="5283435">[</span><span class="op" id="5283436">]</span><span class="builtintype" id="5283437">string</span>&nbsp;<span class="op" id="5283444">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283447">if</span>&nbsp;<span class="ident" id="5283450">n</span>&nbsp;<span class="op" id="5283452">&lt;</span>&nbsp;<span class="num" id="5283454">0</span>&nbsp;<span class="op" id="5283456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283460">n</span>&nbsp;<span class="op" id="5283462">=</span>&nbsp;<span class="builtinfunc" id="5283464">len</span><span class="op" id="5283467">(</span><span class="ident" id="5283468">s</span><span class="op" id="5283469">)</span>&nbsp;<span class="op" id="5283471">+</span>&nbsp;<span class="num" id="5283473">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283479">result</span>&nbsp;<span class="op" id="5283486">:=</span>&nbsp;<span class="builtinfunc" id="5283489">make</span><span class="op" id="5283493">(</span><span class="op" id="5283494">[</span><span class="op" id="5283495">]</span><span class="op" id="5283496">[</span><span class="op" id="5283497">]</span><span class="builtintype" id="5283498">string</span><span class="op" id="5283504">,</span>&nbsp;<span class="num" id="5283506">0</span><span class="op" id="5283507">,</span>&nbsp;<span class="ident" id="5283509">startSize</span><span class="op" id="5283518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283521">re</span><span class="op" id="5283523">.</span><span class="ident" id="5283524">allMatches</span><span class="op" id="5283534">(</span><span class="ident" id="5283535">s</span><span class="op" id="5283536">,</span>&nbsp;<span class="ident" id="5283538">nil</span><span class="op" id="5283541">,</span>&nbsp;<span class="ident" id="5283543">n</span><span class="op" id="5283544">,</span>&nbsp;<span class="keyword" id="5283546">func</span><span class="op" id="5283550">(</span><span class="ident" id="5283551">match</span>&nbsp;<span class="op" id="5283557">[</span><span class="op" id="5283558">]</span><span class="builtintype" id="5283559">int</span><span class="op" id="5283562">)</span>&nbsp;<span class="op" id="5283564">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283568">slice</span>&nbsp;<span class="op" id="5283574">:=</span>&nbsp;<span class="builtinfunc" id="5283577">make</span><span class="op" id="5283581">(</span><span class="op" id="5283582">[</span><span class="op" id="5283583">]</span><span class="builtintype" id="5283584">string</span><span class="op" id="5283590">,</span>&nbsp;<span class="builtinfunc" id="5283592">len</span><span class="op" id="5283595">(</span><span class="ident" id="5283596">match</span><span class="op" id="5283601">)</span><span class="op" id="5283602">/</span><span class="num" id="5283603">2</span><span class="op" id="5283604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283608">for</span>&nbsp;<span class="ident" id="5283612">j</span>&nbsp;<span class="op" id="5283614">:=</span>&nbsp;<span class="keyword" id="5283617">range</span>&nbsp;<span class="ident" id="5283623">slice</span>&nbsp;<span class="op" id="5283629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283634">if</span>&nbsp;<span class="ident" id="5283637">match</span><span class="op" id="5283642">[</span><span class="num" id="5283643">2</span><span class="op" id="5283644">*</span><span class="ident" id="5283645">j</span><span class="op" id="5283646">]</span>&nbsp;<span class="op" id="5283648">&gt;=</span>&nbsp;<span class="num" id="5283651">0</span>&nbsp;<span class="op" id="5283653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283659">slice</span><span class="op" id="5283664">[</span><span class="ident" id="5283665">j</span><span class="op" id="5283666">]</span>&nbsp;<span class="op" id="5283668">=</span>&nbsp;<span class="ident" id="5283670">s</span><span class="op" id="5283671">[</span><span class="ident" id="5283672">match</span><span class="op" id="5283677">[</span><span class="num" id="5283678">2</span><span class="op" id="5283679">*</span><span class="ident" id="5283680">j</span><span class="op" id="5283681">]</span><span class="op" id="5283682">:</span><span class="ident" id="5283683">match</span><span class="op" id="5283688">[</span><span class="num" id="5283689">2</span><span class="op" id="5283690">*</span><span class="ident" id="5283691">j</span><span class="op" id="5283692">+</span><span class="num" id="5283693">1</span><span class="op" id="5283694">]</span><span class="op" id="5283695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283700">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5283708">result</span>&nbsp;<span class="op" id="5283715">=</span>&nbsp;<span class="builtinfunc" id="5283717">append</span><span class="op" id="5283723">(</span><span class="ident" id="5283724">result</span><span class="op" id="5283730">,</span>&nbsp;<span class="ident" id="5283732">slice</span><span class="op" id="5283737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283740">}</span><span class="op" id="5283741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283744">if</span>&nbsp;<span class="builtinfunc" id="5283747">len</span><span class="op" id="5283750">(</span><span class="ident" id="5283751">result</span><span class="op" id="5283757">)</span>&nbsp;<span class="op" id="5283759">==</span>&nbsp;<span class="num" id="5283762">0</span>&nbsp;<span class="op" id="5283764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283768">return</span>&nbsp;<span class="ident" id="5283775">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5283780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5283783">return</span>&nbsp;<span class="ident" id="5283790">result</span><br>
<span class="lineno"></span><span class="op" id="5283797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5283800">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="5283854">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5283930">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5284000">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5284012">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5284057">func</span>&nbsp;<span class="op" id="5284062">(</span><span class="ident" id="5284063">re</span>&nbsp;<span class="op" id="5284066">*</span><span class="ident" id="5284067">Regexp</span><span class="op" id="5284073">)</span>&nbsp;<span class="ident" id="5284075">FindAllStringSubmatchIndex</span><span class="op" id="5284101">(</span><span class="ident" id="5284102">s</span>&nbsp;<span class="builtintype" id="5284104">string</span><span class="op" id="5284110">,</span>&nbsp;<span class="ident" id="5284112">n</span>&nbsp;<span class="builtintype" id="5284114">int</span><span class="op" id="5284117">)</span>&nbsp;<span class="op" id="5284119">[</span><span class="op" id="5284120">]</span><span class="op" id="5284121">[</span><span class="op" id="5284122">]</span><span class="builtintype" id="5284123">int</span>&nbsp;<span class="op" id="5284127">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5284130">if</span>&nbsp;<span class="ident" id="5284133">n</span>&nbsp;<span class="op" id="5284135">&lt;</span>&nbsp;<span class="num" id="5284137">0</span>&nbsp;<span class="op" id="5284139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5284143">n</span>&nbsp;<span class="op" id="5284145">=</span>&nbsp;<span class="builtinfunc" id="5284147">len</span><span class="op" id="5284150">(</span><span class="ident" id="5284151">s</span><span class="op" id="5284152">)</span>&nbsp;<span class="op" id="5284154">+</span>&nbsp;<span class="num" id="5284156">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5284159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5284162">result</span>&nbsp;<span class="op" id="5284169">:=</span>&nbsp;<span class="builtinfunc" id="5284172">make</span><span class="op" id="5284176">(</span><span class="op" id="5284177">[</span><span class="op" id="5284178">]</span><span class="op" id="5284179">[</span><span class="op" id="5284180">]</span><span class="builtintype" id="5284181">int</span><span class="op" id="5284184">,</span>&nbsp;<span class="num" id="5284186">0</span><span class="op" id="5284187">,</span>&nbsp;<span class="ident" id="5284189">startSize</span><span class="op" id="5284198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5284201">re</span><span class="op" id="5284203">.</span><span class="ident" id="5284204">allMatches</span><span class="op" id="5284214">(</span><span class="ident" id="5284215">s</span><span class="op" id="5284216">,</span>&nbsp;<span class="ident" id="5284218">nil</span><span class="op" id="5284221">,</span>&nbsp;<span class="ident" id="5284223">n</span><span class="op" id="5284224">,</span>&nbsp;<span class="keyword" id="5284226">func</span><span class="op" id="5284230">(</span><span class="ident" id="5284231">match</span>&nbsp;<span class="op" id="5284237">[</span><span class="op" id="5284238">]</span><span class="builtintype" id="5284239">int</span><span class="op" id="5284242">)</span>&nbsp;<span class="op" id="5284244">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5284248">result</span>&nbsp;<span class="op" id="5284255">=</span>&nbsp;<span class="builtinfunc" id="5284257">append</span><span class="op" id="5284263">(</span><span class="ident" id="5284264">result</span><span class="op" id="5284270">,</span>&nbsp;<span class="ident" id="5284272">match</span><span class="op" id="5284277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5284280">}</span><span class="op" id="5284281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5284284">if</span>&nbsp;<span class="builtinfunc" id="5284287">len</span><span class="op" id="5284290">(</span><span class="ident" id="5284291">result</span><span class="op" id="5284297">)</span>&nbsp;<span class="op" id="5284299">==</span>&nbsp;<span class="num" id="5284302">0</span>&nbsp;<span class="op" id="5284304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5284308">return</span>&nbsp;<span class="ident" id="5284315">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5284320">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5284323">return</span>&nbsp;<span class="ident" id="5284330">result</span><br>
<span class="lineno"></span><span class="op" id="5284337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5284340">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5284425">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="5284477">//</span><br>
<span class="lineno"></span><span class="comment" id="5284480">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5284553">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5284639">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="5284711">//</span><br>
<span class="lineno">1080</span><span class="comment" id="5284714">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="5284726">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="5284788">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="5284830">//</span><br>
<span class="lineno"></span><span class="comment" id="5284833">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="5284893">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="5284977">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="5285026">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="5285053">func</span>&nbsp;<span class="op" id="5285058">(</span><span class="ident" id="5285059">re</span>&nbsp;<span class="op" id="5285062">*</span><span class="ident" id="5285063">Regexp</span><span class="op" id="5285069">)</span>&nbsp;<span class="ident" id="5285071">Split</span><span class="op" id="5285076">(</span><span class="ident" id="5285077">s</span>&nbsp;<span class="builtintype" id="5285079">string</span><span class="op" id="5285085">,</span>&nbsp;<span class="ident" id="5285087">n</span>&nbsp;<span class="builtintype" id="5285089">int</span><span class="op" id="5285092">)</span>&nbsp;<span class="op" id="5285094">[</span><span class="op" id="5285095">]</span><span class="builtintype" id="5285096">string</span>&nbsp;<span class="op" id="5285103">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285107">if</span>&nbsp;<span class="ident" id="5285110">n</span>&nbsp;<span class="op" id="5285112">==</span>&nbsp;<span class="num" id="5285115">0</span>&nbsp;<span class="op" id="5285117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285121">return</span>&nbsp;<span class="ident" id="5285128">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285137">if</span>&nbsp;<span class="builtinfunc" id="5285140">len</span><span class="op" id="5285143">(</span><span class="ident" id="5285144">re</span><span class="op" id="5285146">.</span><span class="ident" id="5285147">expr</span><span class="op" id="5285151">)</span>&nbsp;<span class="op" id="5285153">&gt;</span>&nbsp;<span class="num" id="5285155">0</span>&nbsp;<span class="op" id="5285157">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5285160">len</span><span class="op" id="5285163">(</span><span class="ident" id="5285164">s</span><span class="op" id="5285165">)</span>&nbsp;<span class="op" id="5285167">==</span>&nbsp;<span class="num" id="5285170">0</span>&nbsp;<span class="op" id="5285172">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285176">return</span>&nbsp;<span class="op" id="5285183">[</span><span class="op" id="5285184">]</span><span class="builtintype" id="5285185">string</span><span class="op" id="5285191">{</span><span class="string" id="5285192">&#34;&#34;</span><span class="op" id="5285194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285201">matches</span>&nbsp;<span class="op" id="5285209">:=</span>&nbsp;<span class="ident" id="5285212">re</span><span class="op" id="5285214">.</span><span class="ident" id="5285215">FindAllStringIndex</span><span class="op" id="5285233">(</span><span class="ident" id="5285234">s</span><span class="op" id="5285235">,</span>&nbsp;<span class="ident" id="5285237">n</span><span class="op" id="5285238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285241">strings</span>&nbsp;<span class="op" id="5285249">:=</span>&nbsp;<span class="builtinfunc" id="5285252">make</span><span class="op" id="5285256">(</span><span class="op" id="5285257">[</span><span class="op" id="5285258">]</span><span class="builtintype" id="5285259">string</span><span class="op" id="5285265">,</span>&nbsp;<span class="num" id="5285267">0</span><span class="op" id="5285268">,</span>&nbsp;<span class="builtinfunc" id="5285270">len</span><span class="op" id="5285273">(</span><span class="ident" id="5285274">matches</span><span class="op" id="5285281">)</span><span class="op" id="5285282">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285286">beg</span>&nbsp;<span class="op" id="5285290">:=</span>&nbsp;<span class="num" id="5285293">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285296">end</span>&nbsp;<span class="op" id="5285300">:=</span>&nbsp;<span class="num" id="5285303">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285306">for</span>&nbsp;<span class="ident" id="5285310">_</span><span class="op" id="5285311">,</span>&nbsp;<span class="ident" id="5285313">match</span>&nbsp;<span class="op" id="5285319">:=</span>&nbsp;<span class="keyword" id="5285322">range</span>&nbsp;<span class="ident" id="5285328">matches</span>&nbsp;<span class="op" id="5285336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285340">if</span>&nbsp;<span class="ident" id="5285343">n</span>&nbsp;<span class="op" id="5285345">&gt;</span>&nbsp;<span class="num" id="5285347">0</span>&nbsp;<span class="op" id="5285349">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5285352">len</span><span class="op" id="5285355">(</span><span class="ident" id="5285356">strings</span><span class="op" id="5285363">)</span>&nbsp;<span class="op" id="5285365">&gt;=</span>&nbsp;<span class="ident" id="5285368">n</span><span class="op" id="5285369">-</span><span class="num" id="5285370">1</span>&nbsp;<span class="op" id="5285372">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285377">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285390">end</span>&nbsp;<span class="op" id="5285394">=</span>&nbsp;<span class="ident" id="5285396">match</span><span class="op" id="5285401">[</span><span class="num" id="5285402">0</span><span class="op" id="5285403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285407">if</span>&nbsp;<span class="ident" id="5285410">match</span><span class="op" id="5285415">[</span><span class="num" id="5285416">1</span><span class="op" id="5285417">]</span>&nbsp;<span class="op" id="5285419">!=</span>&nbsp;<span class="num" id="5285422">0</span>&nbsp;<span class="op" id="5285424">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285429">strings</span>&nbsp;<span class="op" id="5285437">=</span>&nbsp;<span class="builtinfunc" id="5285439">append</span><span class="op" id="5285445">(</span><span class="ident" id="5285446">strings</span><span class="op" id="5285453">,</span>&nbsp;<span class="ident" id="5285455">s</span><span class="op" id="5285456">[</span><span class="ident" id="5285457">beg</span><span class="op" id="5285460">:</span><span class="ident" id="5285461">end</span><span class="op" id="5285464">]</span><span class="op" id="5285465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285473">beg</span>&nbsp;<span class="op" id="5285477">=</span>&nbsp;<span class="ident" id="5285479">match</span><span class="op" id="5285484">[</span><span class="num" id="5285485">1</span><span class="op" id="5285486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285493">if</span>&nbsp;<span class="ident" id="5285496">end</span>&nbsp;<span class="op" id="5285500">!=</span>&nbsp;<span class="builtinfunc" id="5285503">len</span><span class="op" id="5285506">(</span><span class="ident" id="5285507">s</span><span class="op" id="5285508">)</span>&nbsp;<span class="op" id="5285510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5285514">strings</span>&nbsp;<span class="op" id="5285522">=</span>&nbsp;<span class="builtinfunc" id="5285524">append</span><span class="op" id="5285530">(</span><span class="ident" id="5285531">strings</span><span class="op" id="5285538">,</span>&nbsp;<span class="ident" id="5285540">s</span><span class="op" id="5285541">[</span><span class="ident" id="5285542">beg</span><span class="op" id="5285545">:</span><span class="op" id="5285546">]</span><span class="op" id="5285547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5285550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5285554">return</span>&nbsp;<span class="ident" id="5285561">strings</span><br>
<span class="lineno">1120</span><span class="op" id="5285569">}</span>
</div>
</body>
</html>
