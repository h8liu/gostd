<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5749513">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5749568">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5749622">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5749673">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5749736">package</span>&nbsp;<span class="ident" id="5749744">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749752">import</span>&nbsp;<span class="op" id="5749759">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749762">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749771">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749778">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749788">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749801">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749815">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749827">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5749833">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5749843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749846">var</span>&nbsp;<span class="ident" id="5749850">config</span>&nbsp;<span class="op" id="5749857">=</span>&nbsp;<span class="ident" id="5749859">printer</span><span class="op" id="5749866">.</span><span class="ident" id="5749867">Config</span><span class="op" id="5749873">{</span><span class="ident" id="5749874">Mode</span><span class="op" id="5749878">:</span>&nbsp;<span class="ident" id="5749880">printer</span><span class="op" id="5749887">.</span><span class="ident" id="5749888">UseSpaces</span>&nbsp;<span class="op" id="5749898">|</span>&nbsp;<span class="ident" id="5749900">printer</span><span class="op" id="5749907">.</span><span class="ident" id="5749908">TabIndent</span><span class="op" id="5749917">,</span>&nbsp;<span class="ident" id="5749919">Tabwidth</span><span class="op" id="5749927">:</span>&nbsp;<span class="num" id="5749929">8</span><span class="op" id="5749930">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5749933">const</span>&nbsp;<span class="ident" id="5749939">parserMode</span>&nbsp;<span class="op" id="5749950">=</span>&nbsp;<span class="ident" id="5749952">parser</span><span class="op" id="5749958">.</span><span class="ident" id="5749959">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5749974">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="5750050">//</span><br>
<span class="lineno">25</span><span class="comment" id="5750053">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="5750125">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="5750198">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5750268">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5750340">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="5750409">//</span><br>
<span class="lineno"></span><span class="comment" id="5750412">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="5750483">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5750555">//</span><br>
<span class="lineno"></span><span class="keyword" id="5750558">func</span>&nbsp;<span class="ident" id="5750563">Node</span><span class="op" id="5750567">(</span><span class="ident" id="5750568">dst</span>&nbsp;<span class="ident" id="5750572">io</span><span class="op" id="5750574">.</span><span class="ident" id="5750575">Writer</span><span class="op" id="5750581">,</span>&nbsp;<span class="ident" id="5750583">fset</span>&nbsp;<span class="op" id="5750588">*</span><span class="ident" id="5750589">token</span><span class="op" id="5750594">.</span><span class="ident" id="5750595">FileSet</span><span class="op" id="5750602">,</span>&nbsp;<span class="ident" id="5750604">node</span>&nbsp;<span class="keyword" id="5750609">interface</span><span class="op" id="5750618">{</span><span class="op" id="5750619">}</span><span class="op" id="5750620">)</span>&nbsp;<span class="builtintype" id="5750622">error</span>&nbsp;<span class="op" id="5750628">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750631">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750694">var</span>&nbsp;<span class="ident" id="5750698">file</span>&nbsp;<span class="op" id="5750703">*</span><span class="ident" id="5750704">ast</span><span class="op" id="5750707">.</span><span class="ident" id="5750708">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750714">var</span>&nbsp;<span class="ident" id="5750718">cnode</span>&nbsp;<span class="op" id="5750724">*</span><span class="ident" id="5750725">printer</span><span class="op" id="5750732">.</span><span class="ident" id="5750733">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750748">switch</span>&nbsp;<span class="ident" id="5750755">n</span>&nbsp;<span class="op" id="5750757">:=</span>&nbsp;<span class="ident" id="5750760">node</span><span class="op" id="5750764">.</span><span class="op" id="5750765">(</span><span class="keyword" id="5750766">type</span><span class="op" id="5750770">)</span>&nbsp;<span class="op" id="5750772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750775">case</span>&nbsp;<span class="op" id="5750780">*</span><span class="ident" id="5750781">ast</span><span class="op" id="5750784">.</span><span class="ident" id="5750785">File</span><span class="op" id="5750789">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750793">file</span>&nbsp;<span class="op" id="5750798">=</span>&nbsp;<span class="ident" id="5750800">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750803">case</span>&nbsp;<span class="op" id="5750808">*</span><span class="ident" id="5750809">printer</span><span class="op" id="5750816">.</span><span class="ident" id="5750817">CommentedNode</span><span class="op" id="5750830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750834">if</span>&nbsp;<span class="ident" id="5750837">f</span><span class="op" id="5750838">,</span>&nbsp;<span class="ident" id="5750840">ok</span>&nbsp;<span class="op" id="5750843">:=</span>&nbsp;<span class="ident" id="5750846">n</span><span class="op" id="5750847">.</span><span class="ident" id="5750848">Node</span><span class="op" id="5750852">.</span><span class="op" id="5750853">(</span><span class="op" id="5750854">*</span><span class="ident" id="5750855">ast</span><span class="op" id="5750858">.</span><span class="ident" id="5750859">File</span><span class="op" id="5750863">)</span><span class="op" id="5750864">;</span>&nbsp;<span class="ident" id="5750866">ok</span>&nbsp;<span class="op" id="5750869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750874">file</span>&nbsp;<span class="op" id="5750879">=</span>&nbsp;<span class="ident" id="5750881">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750886">cnode</span>&nbsp;<span class="op" id="5750892">=</span>&nbsp;<span class="ident" id="5750894">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750905">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750936">if</span>&nbsp;<span class="ident" id="5750939">file</span>&nbsp;<span class="op" id="5750944">!=</span>&nbsp;<span class="ident" id="5750947">nil</span>&nbsp;<span class="op" id="5750951">&amp;&amp;</span>&nbsp;<span class="ident" id="5750954">hasUnsortedImports</span><span class="op" id="5750972">(</span><span class="ident" id="5750973">file</span><span class="op" id="5750977">)</span>&nbsp;<span class="op" id="5750979">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750983">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751051">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751092">var</span>&nbsp;<span class="ident" id="5751096">buf</span>&nbsp;<span class="ident" id="5751100">bytes</span><span class="op" id="5751105">.</span><span class="ident" id="5751106">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751115">err</span>&nbsp;<span class="op" id="5751119">:=</span>&nbsp;<span class="ident" id="5751122">config</span><span class="op" id="5751128">.</span><span class="ident" id="5751129">Fprint</span><span class="op" id="5751135">(</span><span class="op" id="5751136">&amp;</span><span class="ident" id="5751137">buf</span><span class="op" id="5751140">,</span>&nbsp;<span class="ident" id="5751142">fset</span><span class="op" id="5751146">,</span>&nbsp;<span class="ident" id="5751148">file</span><span class="op" id="5751152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751156">if</span>&nbsp;<span class="ident" id="5751159">err</span>&nbsp;<span class="op" id="5751163">!=</span>&nbsp;<span class="ident" id="5751166">nil</span>&nbsp;<span class="op" id="5751170">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751175">return</span>&nbsp;<span class="ident" id="5751182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751192">file</span><span class="op" id="5751196">,</span>&nbsp;<span class="ident" id="5751198">err</span>&nbsp;<span class="op" id="5751202">=</span>&nbsp;<span class="ident" id="5751204">parser</span><span class="op" id="5751210">.</span><span class="ident" id="5751211">ParseFile</span><span class="op" id="5751220">(</span><span class="ident" id="5751221">fset</span><span class="op" id="5751225">,</span>&nbsp;<span class="string" id="5751227">&#34;&#34;</span><span class="op" id="5751229">,</span>&nbsp;<span class="ident" id="5751231">buf</span><span class="op" id="5751234">.</span><span class="ident" id="5751235">Bytes</span><span class="op" id="5751240">(</span><span class="op" id="5751241">)</span><span class="op" id="5751242">,</span>&nbsp;<span class="ident" id="5751244">parserMode</span><span class="op" id="5751254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751258">if</span>&nbsp;<span class="ident" id="5751261">err</span>&nbsp;<span class="op" id="5751265">!=</span>&nbsp;<span class="ident" id="5751268">nil</span>&nbsp;<span class="op" id="5751272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751277">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751344">return</span>&nbsp;<span class="ident" id="5751351">fmt</span><span class="op" id="5751354">.</span><span class="ident" id="5751355">Errorf</span><span class="op" id="5751361">(</span><span class="string" id="5751362">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="5751395">,</span>&nbsp;<span class="ident" id="5751397">err</span><span class="op" id="5751400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751408">ast</span><span class="op" id="5751411">.</span><span class="ident" id="5751412">SortImports</span><span class="op" id="5751423">(</span><span class="ident" id="5751424">fset</span><span class="op" id="5751428">,</span>&nbsp;<span class="ident" id="5751430">file</span><span class="op" id="5751434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751439">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751478">node</span>&nbsp;<span class="op" id="5751483">=</span>&nbsp;<span class="ident" id="5751485">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751492">if</span>&nbsp;<span class="ident" id="5751495">cnode</span>&nbsp;<span class="op" id="5751501">!=</span>&nbsp;<span class="ident" id="5751504">nil</span>&nbsp;<span class="op" id="5751508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751513">node</span>&nbsp;<span class="op" id="5751518">=</span>&nbsp;<span class="op" id="5751520">&amp;</span><span class="ident" id="5751521">printer</span><span class="op" id="5751528">.</span><span class="ident" id="5751529">CommentedNode</span><span class="op" id="5751542">{</span><span class="ident" id="5751543">Node</span><span class="op" id="5751547">:</span>&nbsp;<span class="ident" id="5751549">file</span><span class="op" id="5751553">,</span>&nbsp;<span class="ident" id="5751555">Comments</span><span class="op" id="5751563">:</span>&nbsp;<span class="ident" id="5751565">cnode</span><span class="op" id="5751570">.</span><span class="ident" id="5751571">Comments</span><span class="op" id="5751579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751586">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751590">return</span>&nbsp;<span class="ident" id="5751597">config</span><span class="op" id="5751603">.</span><span class="ident" id="5751604">Fprint</span><span class="op" id="5751610">(</span><span class="ident" id="5751611">dst</span><span class="op" id="5751614">,</span>&nbsp;<span class="ident" id="5751616">fset</span><span class="op" id="5751620">,</span>&nbsp;<span class="ident" id="5751622">node</span><span class="op" id="5751626">)</span><br>
<span class="lineno"></span><span class="op" id="5751628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5751631">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="5751701">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="5751771">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="5751842">//</span><br>
<span class="lineno"></span><span class="comment" id="5751845">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5751919">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="5751995">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5752072">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5752153">//</span><br>
<span class="lineno"></span><span class="keyword" id="5752156">func</span>&nbsp;<span class="ident" id="5752161">Source</span><span class="op" id="5752167">(</span><span class="ident" id="5752168">src</span>&nbsp;<span class="op" id="5752172">[</span><span class="op" id="5752173">]</span><span class="builtintype" id="5752174">byte</span><span class="op" id="5752178">)</span>&nbsp;<span class="op" id="5752180">(</span><span class="op" id="5752181">[</span><span class="op" id="5752182">]</span><span class="builtintype" id="5752183">byte</span><span class="op" id="5752187">,</span>&nbsp;<span class="builtintype" id="5752189">error</span><span class="op" id="5752194">)</span>&nbsp;<span class="op" id="5752196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752199">fset</span>&nbsp;<span class="op" id="5752204">:=</span>&nbsp;<span class="ident" id="5752207">token</span><span class="op" id="5752212">.</span><span class="ident" id="5752213">NewFileSet</span><span class="op" id="5752223">(</span><span class="op" id="5752224">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752227">file</span><span class="op" id="5752231">,</span>&nbsp;<span class="ident" id="5752233">sourceAdj</span><span class="op" id="5752242">,</span>&nbsp;<span class="ident" id="5752244">indentAdj</span><span class="op" id="5752253">,</span>&nbsp;<span class="ident" id="5752255">err</span>&nbsp;<span class="op" id="5752259">:=</span>&nbsp;<span class="ident" id="5752262">parse</span><span class="op" id="5752267">(</span><span class="ident" id="5752268">fset</span><span class="op" id="5752272">,</span>&nbsp;<span class="string" id="5752274">&#34;&#34;</span><span class="op" id="5752276">,</span>&nbsp;<span class="ident" id="5752278">src</span><span class="op" id="5752281">,</span>&nbsp;<span class="builtintype" id="5752283">true</span><span class="op" id="5752287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752290">if</span>&nbsp;<span class="ident" id="5752293">err</span>&nbsp;<span class="op" id="5752297">!=</span>&nbsp;<span class="ident" id="5752300">nil</span>&nbsp;<span class="op" id="5752304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752308">return</span>&nbsp;<span class="ident" id="5752315">nil</span><span class="op" id="5752318">,</span>&nbsp;<span class="ident" id="5752320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752329">if</span>&nbsp;<span class="ident" id="5752332">sourceAdj</span>&nbsp;<span class="op" id="5752342">==</span>&nbsp;<span class="ident" id="5752345">nil</span>&nbsp;<span class="op" id="5752349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752353">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752380">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752423">ast</span><span class="op" id="5752426">.</span><span class="ident" id="5752427">SortImports</span><span class="op" id="5752438">(</span><span class="ident" id="5752439">fset</span><span class="op" id="5752443">,</span>&nbsp;<span class="ident" id="5752445">file</span><span class="op" id="5752449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752452">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752456">return</span>&nbsp;<span class="ident" id="5752463">format</span><span class="op" id="5752469">(</span><span class="ident" id="5752470">fset</span><span class="op" id="5752474">,</span>&nbsp;<span class="ident" id="5752476">file</span><span class="op" id="5752480">,</span>&nbsp;<span class="ident" id="5752482">sourceAdj</span><span class="op" id="5752491">,</span>&nbsp;<span class="ident" id="5752493">indentAdj</span><span class="op" id="5752502">,</span>&nbsp;<span class="ident" id="5752504">src</span><span class="op" id="5752507">,</span>&nbsp;<span class="ident" id="5752509">config</span><span class="op" id="5752515">)</span><br>
<span class="lineno"></span><span class="op" id="5752517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5752520">func</span>&nbsp;<span class="ident" id="5752525">hasUnsortedImports</span><span class="op" id="5752543">(</span><span class="ident" id="5752544">file</span>&nbsp;<span class="op" id="5752549">*</span><span class="ident" id="5752550">ast</span><span class="op" id="5752553">.</span><span class="ident" id="5752554">File</span><span class="op" id="5752558">)</span>&nbsp;<span class="builtintype" id="5752560">bool</span>&nbsp;<span class="op" id="5752565">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752568">for</span>&nbsp;<span class="ident" id="5752572">_</span><span class="op" id="5752573">,</span>&nbsp;<span class="ident" id="5752575">d</span>&nbsp;<span class="op" id="5752577">:=</span>&nbsp;<span class="keyword" id="5752580">range</span>&nbsp;<span class="ident" id="5752586">file</span><span class="op" id="5752590">.</span><span class="ident" id="5752591">Decls</span>&nbsp;<span class="op" id="5752597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752601">d</span><span class="op" id="5752602">,</span>&nbsp;<span class="ident" id="5752604">ok</span>&nbsp;<span class="op" id="5752607">:=</span>&nbsp;<span class="ident" id="5752610">d</span><span class="op" id="5752611">.</span><span class="op" id="5752612">(</span><span class="op" id="5752613">*</span><span class="ident" id="5752614">ast</span><span class="op" id="5752617">.</span><span class="ident" id="5752618">GenDecl</span><span class="op" id="5752625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752629">if</span>&nbsp;<span class="op" id="5752632">!</span><span class="ident" id="5752633">ok</span>&nbsp;<span class="op" id="5752636">||</span>&nbsp;<span class="ident" id="5752639">d</span><span class="op" id="5752640">.</span><span class="ident" id="5752641">Tok</span>&nbsp;<span class="op" id="5752645">!=</span>&nbsp;<span class="ident" id="5752648">token</span><span class="op" id="5752653">.</span><span class="ident" id="5752654">IMPORT</span>&nbsp;<span class="op" id="5752661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752666">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752714">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752746">return</span>&nbsp;<span class="builtintype" id="5752753">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752765">if</span>&nbsp;<span class="ident" id="5752768">d</span><span class="op" id="5752769">.</span><span class="ident" id="5752770">Lparen</span><span class="op" id="5752776">.</span><span class="ident" id="5752777">IsValid</span><span class="op" id="5752784">(</span><span class="op" id="5752785">)</span>&nbsp;<span class="op" id="5752787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752792">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752847">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752904">return</span>&nbsp;<span class="builtintype" id="5752911">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752922">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752970">return</span>&nbsp;<span class="builtintype" id="5752977">false</span><br>
<span class="lineno">115</span><span class="op" id="5752983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5752986">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5753066">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="5753087">//</span><br>
<span class="lineno">120</span><span class="comment" id="5753090">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5753161">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="5753228">//</span><br>
<span class="lineno"></span><span class="comment" id="5753231">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5753288">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="5753345">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5753401">func</span>&nbsp;<span class="ident" id="5753406">parse</span><span class="op" id="5753411">(</span><span class="ident" id="5753412">fset</span>&nbsp;<span class="op" id="5753417">*</span><span class="ident" id="5753418">token</span><span class="op" id="5753423">.</span><span class="ident" id="5753424">FileSet</span><span class="op" id="5753431">,</span>&nbsp;<span class="ident" id="5753433">filename</span>&nbsp;<span class="builtintype" id="5753442">string</span><span class="op" id="5753448">,</span>&nbsp;<span class="ident" id="5753450">src</span>&nbsp;<span class="op" id="5753454">[</span><span class="op" id="5753455">]</span><span class="builtintype" id="5753456">byte</span><span class="op" id="5753460">,</span>&nbsp;<span class="ident" id="5753462">fragmentOk</span>&nbsp;<span class="builtintype" id="5753473">bool</span><span class="op" id="5753477">)</span>&nbsp;<span class="op" id="5753479">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753482">file</span>&nbsp;<span class="op" id="5753487">*</span><span class="ident" id="5753488">ast</span><span class="op" id="5753491">.</span><span class="ident" id="5753492">File</span><span class="op" id="5753496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753499">sourceAdj</span>&nbsp;<span class="keyword" id="5753509">func</span><span class="op" id="5753513">(</span><span class="ident" id="5753514">src</span>&nbsp;<span class="op" id="5753518">[</span><span class="op" id="5753519">]</span><span class="builtintype" id="5753520">byte</span><span class="op" id="5753524">,</span>&nbsp;<span class="ident" id="5753526">indent</span>&nbsp;<span class="builtintype" id="5753533">int</span><span class="op" id="5753536">)</span>&nbsp;<span class="op" id="5753538">[</span><span class="op" id="5753539">]</span><span class="builtintype" id="5753540">byte</span><span class="op" id="5753544">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753547">indentAdj</span>&nbsp;<span class="builtintype" id="5753557">int</span><span class="op" id="5753560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753563">err</span>&nbsp;<span class="builtintype" id="5753567">error</span><span class="op" id="5753572">,</span><br>
<span class="lineno"></span><span class="op" id="5753574">)</span>&nbsp;<span class="op" id="5753576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753579">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753609">file</span><span class="op" id="5753613">,</span>&nbsp;<span class="ident" id="5753615">err</span>&nbsp;<span class="op" id="5753619">=</span>&nbsp;<span class="ident" id="5753621">parser</span><span class="op" id="5753627">.</span><span class="ident" id="5753628">ParseFile</span><span class="op" id="5753637">(</span><span class="ident" id="5753638">fset</span><span class="op" id="5753642">,</span>&nbsp;<span class="ident" id="5753644">filename</span><span class="op" id="5753652">,</span>&nbsp;<span class="ident" id="5753654">src</span><span class="op" id="5753657">,</span>&nbsp;<span class="ident" id="5753659">parserMode</span><span class="op" id="5753669">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753672">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753763">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753825">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753892">if</span>&nbsp;<span class="ident" id="5753895">err</span>&nbsp;<span class="op" id="5753899">==</span>&nbsp;<span class="ident" id="5753902">nil</span>&nbsp;<span class="op" id="5753906">||</span>&nbsp;<span class="op" id="5753909">!</span><span class="ident" id="5753910">fragmentOk</span>&nbsp;<span class="op" id="5753921">||</span>&nbsp;<span class="op" id="5753924">!</span><span class="ident" id="5753925">strings</span><span class="op" id="5753932">.</span><span class="ident" id="5753933">Contains</span><span class="op" id="5753941">(</span><span class="ident" id="5753942">err</span><span class="op" id="5753945">.</span><span class="ident" id="5753946">Error</span><span class="op" id="5753951">(</span><span class="op" id="5753952">)</span><span class="op" id="5753953">,</span>&nbsp;<span class="string" id="5753955">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="5753975">)</span>&nbsp;<span class="op" id="5753977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753981">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753993">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754050">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754085">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754147">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754182">psrc</span>&nbsp;<span class="op" id="5754187">:=</span>&nbsp;<span class="builtinfunc" id="5754190">append</span><span class="op" id="5754196">(</span><span class="op" id="5754197">[</span><span class="op" id="5754198">]</span><span class="builtintype" id="5754199">byte</span><span class="op" id="5754203">(</span><span class="string" id="5754204">&#34;package&nbsp;p;&#34;</span><span class="op" id="5754216">)</span><span class="op" id="5754217">,</span>&nbsp;<span class="ident" id="5754219">src</span><span class="op" id="5754222">...</span><span class="op" id="5754225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754228">file</span><span class="op" id="5754232">,</span>&nbsp;<span class="ident" id="5754234">err</span>&nbsp;<span class="op" id="5754238">=</span>&nbsp;<span class="ident" id="5754240">parser</span><span class="op" id="5754246">.</span><span class="ident" id="5754247">ParseFile</span><span class="op" id="5754256">(</span><span class="ident" id="5754257">fset</span><span class="op" id="5754261">,</span>&nbsp;<span class="ident" id="5754263">filename</span><span class="op" id="5754271">,</span>&nbsp;<span class="ident" id="5754273">psrc</span><span class="op" id="5754277">,</span>&nbsp;<span class="ident" id="5754279">parserMode</span><span class="op" id="5754289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754292">if</span>&nbsp;<span class="ident" id="5754295">err</span>&nbsp;<span class="op" id="5754299">==</span>&nbsp;<span class="ident" id="5754302">nil</span>&nbsp;<span class="op" id="5754306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754310">sourceAdj</span>&nbsp;<span class="op" id="5754320">=</span>&nbsp;<span class="keyword" id="5754322">func</span><span class="op" id="5754326">(</span><span class="ident" id="5754327">src</span>&nbsp;<span class="op" id="5754331">[</span><span class="op" id="5754332">]</span><span class="builtintype" id="5754333">byte</span><span class="op" id="5754337">,</span>&nbsp;<span class="ident" id="5754339">indent</span>&nbsp;<span class="builtintype" id="5754346">int</span><span class="op" id="5754349">)</span>&nbsp;<span class="op" id="5754351">[</span><span class="op" id="5754352">]</span><span class="builtintype" id="5754353">byte</span>&nbsp;<span class="op" id="5754358">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754363">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754396">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754436">src</span>&nbsp;<span class="op" id="5754440">=</span>&nbsp;<span class="ident" id="5754442">src</span><span class="op" id="5754445">[</span><span class="ident" id="5754446">indent</span><span class="op" id="5754452">+</span><span class="builtinfunc" id="5754453">len</span><span class="op" id="5754456">(</span><span class="string" id="5754457">&#34;package&nbsp;p\n&#34;</span><span class="op" id="5754470">)</span><span class="op" id="5754471">:</span><span class="op" id="5754472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754477">return</span>&nbsp;<span class="ident" id="5754484">bytes</span><span class="op" id="5754489">.</span><span class="ident" id="5754490">TrimSpace</span><span class="op" id="5754499">(</span><span class="ident" id="5754500">src</span><span class="op" id="5754503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754507">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754511">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754522">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754583">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754641">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754681">if</span>&nbsp;<span class="op" id="5754684">!</span><span class="ident" id="5754685">strings</span><span class="op" id="5754692">.</span><span class="ident" id="5754693">Contains</span><span class="op" id="5754701">(</span><span class="ident" id="5754702">err</span><span class="op" id="5754705">.</span><span class="ident" id="5754706">Error</span><span class="op" id="5754711">(</span><span class="op" id="5754712">)</span><span class="op" id="5754713">,</span>&nbsp;<span class="string" id="5754715">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="5754737">)</span>&nbsp;<span class="op" id="5754739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754743">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754755">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754810">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754865">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754922">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5754984">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755019">fsrc</span>&nbsp;<span class="op" id="5755024">:=</span>&nbsp;<span class="builtinfunc" id="5755027">append</span><span class="op" id="5755033">(</span><span class="builtinfunc" id="5755034">append</span><span class="op" id="5755040">(</span><span class="op" id="5755041">[</span><span class="op" id="5755042">]</span><span class="builtintype" id="5755043">byte</span><span class="op" id="5755047">(</span><span class="string" id="5755048">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5755071">)</span><span class="op" id="5755072">,</span>&nbsp;<span class="ident" id="5755074">src</span><span class="op" id="5755077">...</span><span class="op" id="5755080">)</span><span class="op" id="5755081">,</span>&nbsp;<span class="string" id="5755083">&#39;\n&#39;</span><span class="op" id="5755087">,</span>&nbsp;<span class="string" id="5755089">&#39;}&#39;</span><span class="op" id="5755092">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755095">file</span><span class="op" id="5755099">,</span>&nbsp;<span class="ident" id="5755101">err</span>&nbsp;<span class="op" id="5755105">=</span>&nbsp;<span class="ident" id="5755107">parser</span><span class="op" id="5755113">.</span><span class="ident" id="5755114">ParseFile</span><span class="op" id="5755123">(</span><span class="ident" id="5755124">fset</span><span class="op" id="5755128">,</span>&nbsp;<span class="ident" id="5755130">filename</span><span class="op" id="5755138">,</span>&nbsp;<span class="ident" id="5755140">fsrc</span><span class="op" id="5755144">,</span>&nbsp;<span class="ident" id="5755146">parserMode</span><span class="op" id="5755156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755159">if</span>&nbsp;<span class="ident" id="5755162">err</span>&nbsp;<span class="op" id="5755166">==</span>&nbsp;<span class="ident" id="5755169">nil</span>&nbsp;<span class="op" id="5755173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755177">sourceAdj</span>&nbsp;<span class="op" id="5755187">=</span>&nbsp;<span class="keyword" id="5755189">func</span><span class="op" id="5755193">(</span><span class="ident" id="5755194">src</span>&nbsp;<span class="op" id="5755198">[</span><span class="op" id="5755199">]</span><span class="builtintype" id="5755200">byte</span><span class="op" id="5755204">,</span>&nbsp;<span class="ident" id="5755206">indent</span>&nbsp;<span class="builtintype" id="5755213">int</span><span class="op" id="5755216">)</span>&nbsp;<span class="op" id="5755218">[</span><span class="op" id="5755219">]</span><span class="builtintype" id="5755220">byte</span>&nbsp;<span class="op" id="5755225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755230">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755265">if</span>&nbsp;<span class="ident" id="5755268">indent</span>&nbsp;<span class="op" id="5755275">&lt;</span>&nbsp;<span class="num" id="5755277">0</span>&nbsp;<span class="op" id="5755279">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755285">indent</span>&nbsp;<span class="op" id="5755292">=</span>&nbsp;<span class="num" id="5755294">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755304">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755331">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755373">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755442">src</span>&nbsp;<span class="op" id="5755446">=</span>&nbsp;<span class="ident" id="5755448">src</span><span class="op" id="5755451">[</span><span class="num" id="5755452">2</span><span class="op" id="5755453">*</span><span class="ident" id="5755454">indent</span><span class="op" id="5755460">+</span><span class="builtinfunc" id="5755461">len</span><span class="op" id="5755464">(</span><span class="string" id="5755465">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5755490">)</span><span class="op" id="5755491">:</span><span class="op" id="5755492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755497">src</span>&nbsp;<span class="op" id="5755501">=</span>&nbsp;<span class="ident" id="5755503">src</span><span class="op" id="5755506">[</span><span class="op" id="5755507">:</span><span class="builtinfunc" id="5755508">len</span><span class="op" id="5755511">(</span><span class="ident" id="5755512">src</span><span class="op" id="5755515">)</span><span class="op" id="5755516">-</span><span class="op" id="5755517">(</span><span class="ident" id="5755518">indent</span><span class="op" id="5755524">+</span><span class="builtinfunc" id="5755525">len</span><span class="op" id="5755528">(</span><span class="string" id="5755529">&#34;\n}\n&#34;</span><span class="op" id="5755536">)</span><span class="op" id="5755537">)</span><span class="op" id="5755538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755543">return</span>&nbsp;<span class="ident" id="5755550">bytes</span><span class="op" id="5755555">.</span><span class="ident" id="5755556">TrimSpace</span><span class="op" id="5755565">(</span><span class="ident" id="5755566">src</span><span class="op" id="5755569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755577">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755635">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755668">indentAdj</span>&nbsp;<span class="op" id="5755678">=</span>&nbsp;<span class="op" id="5755680">-</span><span class="num" id="5755681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755688">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755722">return</span><br>
<span class="lineno"></span><span class="op" id="5755729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5755732">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5755802">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="5755871">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="5755889">func</span>&nbsp;<span class="ident" id="5755894">format</span><span class="op" id="5755900">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755903">fset</span>&nbsp;<span class="op" id="5755908">*</span><span class="ident" id="5755909">token</span><span class="op" id="5755914">.</span><span class="ident" id="5755915">FileSet</span><span class="op" id="5755922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755925">file</span>&nbsp;<span class="op" id="5755930">*</span><span class="ident" id="5755931">ast</span><span class="op" id="5755934">.</span><span class="ident" id="5755935">File</span><span class="op" id="5755939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755942">sourceAdj</span>&nbsp;<span class="keyword" id="5755952">func</span><span class="op" id="5755956">(</span><span class="ident" id="5755957">src</span>&nbsp;<span class="op" id="5755961">[</span><span class="op" id="5755962">]</span><span class="builtintype" id="5755963">byte</span><span class="op" id="5755967">,</span>&nbsp;<span class="ident" id="5755969">indent</span>&nbsp;<span class="builtintype" id="5755976">int</span><span class="op" id="5755979">)</span>&nbsp;<span class="op" id="5755981">[</span><span class="op" id="5755982">]</span><span class="builtintype" id="5755983">byte</span><span class="op" id="5755987">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755990">indentAdj</span>&nbsp;<span class="builtintype" id="5756000">int</span><span class="op" id="5756003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756006">src</span>&nbsp;<span class="op" id="5756010">[</span><span class="op" id="5756011">]</span><span class="builtintype" id="5756012">byte</span><span class="op" id="5756016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756019">cfg</span>&nbsp;<span class="ident" id="5756023">printer</span><span class="op" id="5756030">.</span><span class="ident" id="5756031">Config</span><span class="op" id="5756037">,</span><br>
<span class="lineno"></span><span class="op" id="5756039">)</span>&nbsp;<span class="op" id="5756041">(</span><span class="op" id="5756042">[</span><span class="op" id="5756043">]</span><span class="builtintype" id="5756044">byte</span><span class="op" id="5756048">,</span>&nbsp;<span class="builtintype" id="5756050">error</span><span class="op" id="5756055">)</span>&nbsp;<span class="op" id="5756057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756060">if</span>&nbsp;<span class="ident" id="5756063">sourceAdj</span>&nbsp;<span class="op" id="5756073">==</span>&nbsp;<span class="ident" id="5756076">nil</span>&nbsp;<span class="op" id="5756080">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756084">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756111">var</span>&nbsp;<span class="ident" id="5756115">buf</span>&nbsp;<span class="ident" id="5756119">bytes</span><span class="op" id="5756124">.</span><span class="ident" id="5756125">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756134">err</span>&nbsp;<span class="op" id="5756138">:=</span>&nbsp;<span class="ident" id="5756141">cfg</span><span class="op" id="5756144">.</span><span class="ident" id="5756145">Fprint</span><span class="op" id="5756151">(</span><span class="op" id="5756152">&amp;</span><span class="ident" id="5756153">buf</span><span class="op" id="5756156">,</span>&nbsp;<span class="ident" id="5756158">fset</span><span class="op" id="5756162">,</span>&nbsp;<span class="ident" id="5756164">file</span><span class="op" id="5756168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756172">if</span>&nbsp;<span class="ident" id="5756175">err</span>&nbsp;<span class="op" id="5756179">!=</span>&nbsp;<span class="ident" id="5756182">nil</span>&nbsp;<span class="op" id="5756186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756191">return</span>&nbsp;<span class="ident" id="5756198">nil</span><span class="op" id="5756201">,</span>&nbsp;<span class="ident" id="5756203">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756213">return</span>&nbsp;<span class="ident" id="5756220">buf</span><span class="op" id="5756223">.</span><span class="ident" id="5756224">Bytes</span><span class="op" id="5756229">(</span><span class="op" id="5756230">)</span><span class="op" id="5756231">,</span>&nbsp;<span class="ident" id="5756233">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756242">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756267">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756308">i</span><span class="op" id="5756309">,</span>&nbsp;<span class="ident" id="5756311">j</span>&nbsp;<span class="op" id="5756313">:=</span>&nbsp;<span class="num" id="5756316">0</span><span class="op" id="5756317">,</span>&nbsp;<span class="num" id="5756319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756322">for</span>&nbsp;<span class="ident" id="5756326">j</span>&nbsp;<span class="op" id="5756328">&lt;</span>&nbsp;<span class="builtinfunc" id="5756330">len</span><span class="op" id="5756333">(</span><span class="ident" id="5756334">src</span><span class="op" id="5756337">)</span>&nbsp;<span class="op" id="5756339">&amp;&amp;</span>&nbsp;<span class="ident" id="5756342">isSpace</span><span class="op" id="5756349">(</span><span class="ident" id="5756350">src</span><span class="op" id="5756353">[</span><span class="ident" id="5756354">j</span><span class="op" id="5756355">]</span><span class="op" id="5756356">)</span>&nbsp;<span class="op" id="5756358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756362">if</span>&nbsp;<span class="ident" id="5756365">src</span><span class="op" id="5756368">[</span><span class="ident" id="5756369">j</span><span class="op" id="5756370">]</span>&nbsp;<span class="op" id="5756372">==</span>&nbsp;<span class="string" id="5756375">&#39;\n&#39;</span>&nbsp;<span class="op" id="5756380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756385">i</span>&nbsp;<span class="op" id="5756387">=</span>&nbsp;<span class="ident" id="5756389">j</span>&nbsp;<span class="op" id="5756391">+</span>&nbsp;<span class="num" id="5756393">1</span>&nbsp;<span class="comment" id="5756395">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756446">j</span><span class="op" id="5756447">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756454">var</span>&nbsp;<span class="ident" id="5756458">res</span>&nbsp;<span class="op" id="5756462">[</span><span class="op" id="5756463">]</span><span class="builtintype" id="5756464">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756470">res</span>&nbsp;<span class="op" id="5756474">=</span>&nbsp;<span class="builtinfunc" id="5756476">append</span><span class="op" id="5756482">(</span><span class="ident" id="5756483">res</span><span class="op" id="5756486">,</span>&nbsp;<span class="ident" id="5756488">src</span><span class="op" id="5756491">[</span><span class="op" id="5756492">:</span><span class="ident" id="5756493">i</span><span class="op" id="5756494">]</span><span class="op" id="5756495">...</span><span class="op" id="5756498">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756502">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756560">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756609">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756652">indent</span>&nbsp;<span class="op" id="5756659">:=</span>&nbsp;<span class="num" id="5756662">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756665">hasSpace</span>&nbsp;<span class="op" id="5756674">:=</span>&nbsp;<span class="builtintype" id="5756677">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756684">for</span>&nbsp;<span class="ident" id="5756688">_</span><span class="op" id="5756689">,</span>&nbsp;<span class="ident" id="5756691">b</span>&nbsp;<span class="op" id="5756693">:=</span>&nbsp;<span class="keyword" id="5756696">range</span>&nbsp;<span class="ident" id="5756702">src</span><span class="op" id="5756705">[</span><span class="ident" id="5756706">i</span><span class="op" id="5756707">:</span><span class="ident" id="5756708">j</span><span class="op" id="5756709">]</span>&nbsp;<span class="op" id="5756711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756715">switch</span>&nbsp;<span class="ident" id="5756722">b</span>&nbsp;<span class="op" id="5756724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756728">case</span>&nbsp;<span class="string" id="5756733">&#39;&nbsp;&#39;</span><span class="op" id="5756736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756741">hasSpace</span>&nbsp;<span class="op" id="5756750">=</span>&nbsp;<span class="builtintype" id="5756752">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756759">case</span>&nbsp;<span class="string" id="5756764">&#39;\t&#39;</span><span class="op" id="5756768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756773">indent</span><span class="op" id="5756779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756790">if</span>&nbsp;<span class="ident" id="5756793">indent</span>&nbsp;<span class="op" id="5756800">==</span>&nbsp;<span class="num" id="5756803">0</span>&nbsp;<span class="op" id="5756805">&amp;&amp;</span>&nbsp;<span class="ident" id="5756808">hasSpace</span>&nbsp;<span class="op" id="5756817">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756821">indent</span>&nbsp;<span class="op" id="5756828">=</span>&nbsp;<span class="num" id="5756830">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756836">for</span>&nbsp;<span class="ident" id="5756840">i</span>&nbsp;<span class="op" id="5756842">:=</span>&nbsp;<span class="num" id="5756845">0</span><span class="op" id="5756846">;</span>&nbsp;<span class="ident" id="5756848">i</span>&nbsp;<span class="op" id="5756850">&lt;</span>&nbsp;<span class="ident" id="5756852">indent</span><span class="op" id="5756858">;</span>&nbsp;<span class="ident" id="5756860">i</span><span class="op" id="5756861">++</span>&nbsp;<span class="op" id="5756864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756868">res</span>&nbsp;<span class="op" id="5756872">=</span>&nbsp;<span class="builtinfunc" id="5756874">append</span><span class="op" id="5756880">(</span><span class="ident" id="5756881">res</span><span class="op" id="5756884">,</span>&nbsp;<span class="string" id="5756886">&#39;\t&#39;</span><span class="op" id="5756890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756893">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756897">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756920">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756973">cfg</span><span class="op" id="5756976">.</span><span class="ident" id="5756977">Indent</span>&nbsp;<span class="op" id="5756984">=</span>&nbsp;<span class="ident" id="5756986">indent</span>&nbsp;<span class="op" id="5756993">+</span>&nbsp;<span class="ident" id="5756995">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757006">var</span>&nbsp;<span class="ident" id="5757010">buf</span>&nbsp;<span class="ident" id="5757014">bytes</span><span class="op" id="5757019">.</span><span class="ident" id="5757020">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757028">err</span>&nbsp;<span class="op" id="5757032">:=</span>&nbsp;<span class="ident" id="5757035">cfg</span><span class="op" id="5757038">.</span><span class="ident" id="5757039">Fprint</span><span class="op" id="5757045">(</span><span class="op" id="5757046">&amp;</span><span class="ident" id="5757047">buf</span><span class="op" id="5757050">,</span>&nbsp;<span class="ident" id="5757052">fset</span><span class="op" id="5757056">,</span>&nbsp;<span class="ident" id="5757058">file</span><span class="op" id="5757062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757065">if</span>&nbsp;<span class="ident" id="5757068">err</span>&nbsp;<span class="op" id="5757072">!=</span>&nbsp;<span class="ident" id="5757075">nil</span>&nbsp;<span class="op" id="5757079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757083">return</span>&nbsp;<span class="ident" id="5757090">nil</span><span class="op" id="5757093">,</span>&nbsp;<span class="ident" id="5757095">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757103">res</span>&nbsp;<span class="op" id="5757107">=</span>&nbsp;<span class="builtinfunc" id="5757109">append</span><span class="op" id="5757115">(</span><span class="ident" id="5757116">res</span><span class="op" id="5757119">,</span>&nbsp;<span class="ident" id="5757121">sourceAdj</span><span class="op" id="5757130">(</span><span class="ident" id="5757131">buf</span><span class="op" id="5757134">.</span><span class="ident" id="5757135">Bytes</span><span class="op" id="5757140">(</span><span class="op" id="5757141">)</span><span class="op" id="5757142">,</span>&nbsp;<span class="ident" id="5757144">cfg</span><span class="op" id="5757147">.</span><span class="ident" id="5757148">Indent</span><span class="op" id="5757154">)</span><span class="op" id="5757155">...</span><span class="op" id="5757158">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757162">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757203">i</span>&nbsp;<span class="op" id="5757205">=</span>&nbsp;<span class="builtinfunc" id="5757207">len</span><span class="op" id="5757210">(</span><span class="ident" id="5757211">src</span><span class="op" id="5757214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757217">for</span>&nbsp;<span class="ident" id="5757221">i</span>&nbsp;<span class="op" id="5757223">&gt;</span>&nbsp;<span class="num" id="5757225">0</span>&nbsp;<span class="op" id="5757227">&amp;&amp;</span>&nbsp;<span class="ident" id="5757230">isSpace</span><span class="op" id="5757237">(</span><span class="ident" id="5757238">src</span><span class="op" id="5757241">[</span><span class="ident" id="5757242">i</span><span class="op" id="5757243">-</span><span class="num" id="5757244">1</span><span class="op" id="5757245">]</span><span class="op" id="5757246">)</span>&nbsp;<span class="op" id="5757248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757252">i</span><span class="op" id="5757253">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757260">return</span>&nbsp;<span class="builtinfunc" id="5757267">append</span><span class="op" id="5757273">(</span><span class="ident" id="5757274">res</span><span class="op" id="5757277">,</span>&nbsp;<span class="ident" id="5757279">src</span><span class="op" id="5757282">[</span><span class="ident" id="5757283">i</span><span class="op" id="5757284">:</span><span class="op" id="5757285">]</span><span class="op" id="5757286">...</span><span class="op" id="5757289">)</span><span class="op" id="5757290">,</span>&nbsp;<span class="ident" id="5757292">nil</span><br>
<span class="lineno"></span><span class="op" id="5757296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5757299">func</span>&nbsp;<span class="ident" id="5757304">isSpace</span><span class="op" id="5757311">(</span><span class="ident" id="5757312">b</span>&nbsp;<span class="builtintype" id="5757314">byte</span><span class="op" id="5757318">)</span>&nbsp;<span class="builtintype" id="5757320">bool</span>&nbsp;<span class="op" id="5757325">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757328">return</span>&nbsp;<span class="ident" id="5757335">b</span>&nbsp;<span class="op" id="5757337">==</span>&nbsp;<span class="string" id="5757340">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5757344">||</span>&nbsp;<span class="ident" id="5757347">b</span>&nbsp;<span class="op" id="5757349">==</span>&nbsp;<span class="string" id="5757352">&#39;\t&#39;</span>&nbsp;<span class="op" id="5757357">||</span>&nbsp;<span class="ident" id="5757360">b</span>&nbsp;<span class="op" id="5757362">==</span>&nbsp;<span class="string" id="5757365">&#39;\n&#39;</span>&nbsp;<span class="op" id="5757370">||</span>&nbsp;<span class="ident" id="5757373">b</span>&nbsp;<span class="op" id="5757375">==</span>&nbsp;<span class="string" id="5757378">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="5757383">}</span>
</div>
</body>
</html>
