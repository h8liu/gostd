<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1938612">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1938667">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1938721">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1938772">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;runtime&nbsp;support&nbsp;for&nbsp;signal&nbsp;handling.</span><br>
<span class="lineno"></span><span class="comment" id="1938833">//</span><br>
<span class="lineno"></span><span class="comment" id="1938836">//&nbsp;Most&nbsp;synchronization&nbsp;primitives&nbsp;are&nbsp;not&nbsp;available&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="1938894">//&nbsp;the&nbsp;signal&nbsp;handler&nbsp;(it&nbsp;cannot&nbsp;block,&nbsp;allocate&nbsp;memory,&nbsp;or&nbsp;use&nbsp;locks)</span><br>
<span class="lineno"></span><span class="comment" id="1938965">//&nbsp;so&nbsp;the&nbsp;handler&nbsp;communicates&nbsp;with&nbsp;a&nbsp;processing&nbsp;goroutine</span><br>
<span class="lineno">10</span><span class="comment" id="1939024">//&nbsp;via&nbsp;struct&nbsp;sig,&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="1939050">//</span><br>
<span class="lineno"></span><span class="comment" id="1939053">//&nbsp;sigsend&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;signal&nbsp;handler&nbsp;to&nbsp;queue&nbsp;a&nbsp;new&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1939119">//&nbsp;signal_recv&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;Go&nbsp;program&nbsp;to&nbsp;receive&nbsp;a&nbsp;newly&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1939196">//&nbsp;Synchronization&nbsp;between&nbsp;sigsend&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;sig.state</span><br>
<span class="lineno">15</span><span class="comment" id="1939273">//&nbsp;variable.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;3&nbsp;states:&nbsp;sigIdle,&nbsp;sigReceiving&nbsp;and&nbsp;sigSending.</span><br>
<span class="lineno"></span><span class="comment" id="1939348">//&nbsp;sigReceiving&nbsp;means&nbsp;that&nbsp;signal_recv&nbsp;is&nbsp;blocked&nbsp;on&nbsp;sig.Note&nbsp;and&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="1939427">//&nbsp;new&nbsp;pending&nbsp;signals.</span><br>
<span class="lineno"></span><span class="comment" id="1939451">//&nbsp;sigSending&nbsp;means&nbsp;that&nbsp;sig.mask&nbsp;*may*&nbsp;contain&nbsp;new&nbsp;pending&nbsp;signals,</span><br>
<span class="lineno"></span><span class="comment" id="1939520">//&nbsp;signal_recv&nbsp;can&#39;t&nbsp;be&nbsp;blocked&nbsp;in&nbsp;this&nbsp;state.</span><br>
<span class="lineno">20</span><span class="comment" id="1939567">//&nbsp;sigIdle&nbsp;means&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;new&nbsp;pending&nbsp;signals&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;not&nbsp;blocked.</span><br>
<span class="lineno"></span><span class="comment" id="1939654">//&nbsp;Transitions&nbsp;between&nbsp;states&nbsp;are&nbsp;done&nbsp;atomically&nbsp;with&nbsp;CAS.</span><br>
<span class="lineno"></span><span class="comment" id="1939714">//&nbsp;When&nbsp;signal_recv&nbsp;is&nbsp;unblocked,&nbsp;it&nbsp;resets&nbsp;sig.Note&nbsp;and&nbsp;rechecks&nbsp;sig.mask.</span><br>
<span class="lineno"></span><span class="comment" id="1939790">//&nbsp;If&nbsp;several&nbsp;sigsends&nbsp;and&nbsp;signal_recv&nbsp;execute&nbsp;concurrently,&nbsp;it&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1939866">//&nbsp;unnecessary&nbsp;rechecks&nbsp;of&nbsp;sig.mask,&nbsp;but&nbsp;it&nbsp;cannot&nbsp;lead&nbsp;to&nbsp;missed&nbsp;signals</span><br>
<span class="lineno">25</span><span class="comment" id="1939940">//&nbsp;nor&nbsp;deadlocks.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1939959">package</span>&nbsp;<span class="ident" id="1939967">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1939976">import</span>&nbsp;<span class="string" id="1939983">&#34;unsafe&#34;</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1939993">var</span>&nbsp;<span class="ident" id="1939997">sig</span>&nbsp;<span class="keyword" id="1940001">struct</span>&nbsp;<span class="op" id="1940008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940011">note</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1940018"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016211">note</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940024">mask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1940031">[</span><span class="op" id="1940032">(</span><span class="ident" id="1940033"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2030559">_NSIG</a></span>&nbsp;<span class="op" id="1940039">+</span>&nbsp;<span class="num" id="1940041">31</span><span class="op" id="1940043">)</span>&nbsp;<span class="op" id="1940045">/</span>&nbsp;<span class="num" id="1940047">32</span><span class="op" id="1940049">]</span><span class="builtintype" id="1940050">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940058">wanted</span>&nbsp;<span class="op" id="1940065">[</span><span class="op" id="1940066">(</span><span class="ident" id="1940067"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2030559">_NSIG</a></span>&nbsp;<span class="op" id="1940073">+</span>&nbsp;<span class="num" id="1940075">31</span><span class="op" id="1940077">)</span>&nbsp;<span class="op" id="1940079">/</span>&nbsp;<span class="num" id="1940081">32</span><span class="op" id="1940083">]</span><span class="builtintype" id="1940084">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940092">recv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1940099">[</span><span class="op" id="1940100">(</span><span class="ident" id="1940101"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2030559">_NSIG</a></span>&nbsp;<span class="op" id="1940107">+</span>&nbsp;<span class="num" id="1940109">31</span><span class="op" id="1940111">)</span>&nbsp;<span class="op" id="1940113">/</span>&nbsp;<span class="num" id="1940115">32</span><span class="op" id="1940117">]</span><span class="builtintype" id="1940118">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940126">state</span>&nbsp;&nbsp;<span class="builtintype" id="1940133">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940141">inuse</span>&nbsp;&nbsp;<span class="builtintype" id="1940148">bool</span><br>
<span class="lineno"></span><span class="op" id="1940153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1940156">const</span>&nbsp;<span class="op" id="1940162">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940165">sigIdle</span>&nbsp;<span class="op" id="1940173">=</span>&nbsp;<span class="ident" id="1940175">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940181">sigReceiving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940195">sigSending</span><br>
<span class="lineno"></span><span class="op" id="1940206">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1940209">//&nbsp;Called&nbsp;from&nbsp;sighandler&nbsp;to&nbsp;send&nbsp;a&nbsp;signal&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;signal&nbsp;handling&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1940292">//&nbsp;Reports&nbsp;whether&nbsp;the&nbsp;signal&nbsp;was&nbsp;sent.&nbsp;If&nbsp;not,&nbsp;the&nbsp;caller&nbsp;typically&nbsp;crashes&nbsp;the&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="1940382">func</span>&nbsp;<span class="ident" id="1940387">sigsend</span><span class="op" id="1940394">(</span><span class="ident" id="1940395">s</span>&nbsp;<span class="builtintype" id="1940397">int32</span><span class="op" id="1940402">)</span>&nbsp;<span class="builtintype" id="1940404">bool</span>&nbsp;<span class="op" id="1940409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940412">bit</span>&nbsp;<span class="op" id="1940416">:=</span>&nbsp;<span class="builtintype" id="1940419">uint32</span><span class="op" id="1940425">(</span><span class="num" id="1940426">1</span><span class="op" id="1940427">)</span>&nbsp;<span class="op" id="1940429">&lt;&lt;</span>&nbsp;<span class="builtintype" id="1940432">uint</span><span class="op" id="1940436">(</span><span class="ident" id="1940437"><a href="/runtime/sigqueue.go.html#1940395">s</a></span><span class="op" id="1940438">&amp;</span><span class="num" id="1940439">31</span><span class="op" id="1940441">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940444">if</span>&nbsp;<span class="op" id="1940447">!</span><span class="ident" id="1940448"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940451">.</span><span class="ident" id="1940452">inuse</span>&nbsp;<span class="op" id="1940458">||</span>&nbsp;<span class="ident" id="1940461"><a href="/runtime/sigqueue.go.html#1940395">s</a></span>&nbsp;<span class="op" id="1940463">&lt;</span>&nbsp;<span class="num" id="1940465">0</span>&nbsp;<span class="op" id="1940467">||</span>&nbsp;<span class="builtintype" id="1940470">int</span><span class="op" id="1940473">(</span><span class="ident" id="1940474"><a href="/runtime/sigqueue.go.html#1940395">s</a></span><span class="op" id="1940475">)</span>&nbsp;<span class="op" id="1940477">&gt;=</span>&nbsp;<span class="num" id="1940480">32</span><span class="op" id="1940482">*</span><span class="builtinfunc" id="1940483">len</span><span class="op" id="1940486">(</span><span class="ident" id="1940487"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940490">.</span><span class="ident" id="1940491">wanted</span><span class="op" id="1940497">)</span>&nbsp;<span class="op" id="1940499">||</span>&nbsp;<span class="ident" id="1940502"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940505">.</span><span class="ident" id="1940506">wanted</span><span class="op" id="1940512">[</span><span class="ident" id="1940513"><a href="/runtime/sigqueue.go.html#1940395">s</a></span><span class="op" id="1940514">/</span><span class="num" id="1940515">32</span><span class="op" id="1940517">]</span><span class="op" id="1940518">&amp;</span><span class="ident" id="1940519"><a href="/runtime/sigqueue.go.html#1940412">bit</a></span>&nbsp;<span class="op" id="1940523">==</span>&nbsp;<span class="num" id="1940526">0</span>&nbsp;<span class="op" id="1940528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940532">return</span>&nbsp;<span class="ident" id="1940539">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940550">//&nbsp;Add&nbsp;signal&nbsp;to&nbsp;outgoing&nbsp;queue.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940584">for</span>&nbsp;<span class="op" id="1940588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940592">mask</span>&nbsp;<span class="op" id="1940597">:=</span>&nbsp;<span class="ident" id="1940600"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940603">.</span><span class="ident" id="1940604">mask</span><span class="op" id="1940608">[</span><span class="ident" id="1940609"><a href="/runtime/sigqueue.go.html#1940395">s</a></span><span class="op" id="1940610">/</span><span class="num" id="1940611">32</span><span class="op" id="1940613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940617">if</span>&nbsp;<span class="ident" id="1940620"><a href="/runtime/sigqueue.go.html#1940592">mask</a></span><span class="op" id="1940624">&amp;</span><span class="ident" id="1940625"><a href="/runtime/sigqueue.go.html#1940412">bit</a></span>&nbsp;<span class="op" id="1940629">!=</span>&nbsp;<span class="num" id="1940632">0</span>&nbsp;<span class="op" id="1940634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940639">return</span>&nbsp;<span class="ident" id="1940646">true</span>&nbsp;<span class="comment" id="1940651">//&nbsp;signal&nbsp;already&nbsp;in&nbsp;queue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940680">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940684">if</span>&nbsp;<span class="ident" id="1940687"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1940690">(</span><span class="op" id="1940691">&amp;</span><span class="ident" id="1940692"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940695">.</span><span class="ident" id="1940696">mask</span><span class="op" id="1940700">[</span><span class="ident" id="1940701"><a href="/runtime/sigqueue.go.html#1940395">s</a></span><span class="op" id="1940702">/</span><span class="num" id="1940703">32</span><span class="op" id="1940705">]</span><span class="op" id="1940706">,</span>&nbsp;<span class="ident" id="1940708"><a href="/runtime/sigqueue.go.html#1940592">mask</a></span><span class="op" id="1940712">,</span>&nbsp;<span class="ident" id="1940714"><a href="/runtime/sigqueue.go.html#1940592">mask</a></span><span class="op" id="1940718">|</span><span class="ident" id="1940719"><a href="/runtime/sigqueue.go.html#1940412">bit</a></span><span class="op" id="1940722">)</span>&nbsp;<span class="op" id="1940724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940729">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940744">//&nbsp;Notify&nbsp;receiver&nbsp;that&nbsp;queue&nbsp;has&nbsp;new&nbsp;bit.</span><br>
<span class="lineno"></span><span class="ident" id="1940787">Send</span><span class="op" id="1940791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940794">for</span>&nbsp;<span class="op" id="1940798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940802">switch</span>&nbsp;<span class="ident" id="1940809"><a href="/runtime/atomic.go.html#1711297">atomicload</a></span><span class="op" id="1940819">(</span><span class="op" id="1940820">&amp;</span><span class="ident" id="1940821"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940824">.</span><span class="ident" id="1940825">state</span><span class="op" id="1940830">)</span>&nbsp;<span class="op" id="1940832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940836">default</span><span class="op" id="1940843">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940848"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1940855">(</span><span class="string" id="1940856">&#34;sigsend:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1940885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940889">case</span>&nbsp;<span class="ident" id="1940894"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1940901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940906">if</span>&nbsp;<span class="ident" id="1940909"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1940912">(</span><span class="op" id="1940913">&amp;</span><span class="ident" id="1940914"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1940917">.</span><span class="ident" id="1940918">state</span><span class="op" id="1940923">,</span>&nbsp;<span class="ident" id="1940925"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1940932">,</span>&nbsp;<span class="ident" id="1940934"><a href="/runtime/sigqueue.go.html#1940195">sigSending</a></span><span class="op" id="1940944">)</span>&nbsp;<span class="op" id="1940946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940952">break</span>&nbsp;<span class="ident" id="1940958">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940966">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940970">case</span>&nbsp;<span class="ident" id="1940975"><a href="/runtime/sigqueue.go.html#1940195">sigSending</a></span><span class="op" id="1940985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940990">//&nbsp;notification&nbsp;already&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941025">break</span>&nbsp;<span class="ident" id="1941031">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941038">case</span>&nbsp;<span class="ident" id="1941043"><a href="/runtime/sigqueue.go.html#1940181">sigReceiving</a></span><span class="op" id="1941055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941060">if</span>&nbsp;<span class="ident" id="1941063"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1941066">(</span><span class="op" id="1941067">&amp;</span><span class="ident" id="1941068"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941071">.</span><span class="ident" id="1941072">state</span><span class="op" id="1941077">,</span>&nbsp;<span class="ident" id="1941079"><a href="/runtime/sigqueue.go.html#1940181">sigReceiving</a></span><span class="op" id="1941091">,</span>&nbsp;<span class="ident" id="1941093"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1941100">)</span>&nbsp;<span class="op" id="1941102">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941108"><a href="/runtime/lock_futex.go.html#1817095">notewakeup</a></span><span class="op" id="1941118">(</span><span class="op" id="1941119">&amp;</span><span class="ident" id="1941120"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941123">.</span><span class="ident" id="1941124">note</span><span class="op" id="1941128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941134">break</span>&nbsp;<span class="ident" id="1941140">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941155">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941159">return</span>&nbsp;<span class="ident" id="1941166">true</span><br>
<span class="lineno"></span><span class="op" id="1941171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1941174">//&nbsp;Called&nbsp;to&nbsp;receive&nbsp;the&nbsp;next&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno">90</span><span class="comment" id="1941219">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1941277">func</span>&nbsp;<span class="ident" id="1941282">signal_recv</span><span class="op" id="1941293">(</span><span class="op" id="1941294">)</span>&nbsp;<span class="builtintype" id="1941296">uint32</span>&nbsp;<span class="op" id="1941303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941306">for</span>&nbsp;<span class="op" id="1941310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941314">//&nbsp;Serve&nbsp;any&nbsp;signals&nbsp;from&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941354">for</span>&nbsp;<span class="ident" id="1941358">i</span>&nbsp;<span class="op" id="1941360">:=</span>&nbsp;<span class="builtintype" id="1941363">uint32</span><span class="op" id="1941369">(</span><span class="num" id="1941370">0</span><span class="op" id="1941371">)</span><span class="op" id="1941372">;</span>&nbsp;<span class="ident" id="1941374"><a href="/runtime/sigqueue.go.html#1941358">i</a></span>&nbsp;<span class="op" id="1941376">&lt;</span>&nbsp;<span class="ident" id="1941378"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2030559">_NSIG</a></span><span class="op" id="1941383">;</span>&nbsp;<span class="ident" id="1941385"><a href="/runtime/sigqueue.go.html#1941358">i</a></span><span class="op" id="1941386">++</span>&nbsp;<span class="op" id="1941389">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941394">if</span>&nbsp;<span class="ident" id="1941397"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941400">.</span><span class="ident" id="1941401">recv</span><span class="op" id="1941405">[</span><span class="ident" id="1941406"><a href="/runtime/sigqueue.go.html#1941358">i</a></span><span class="op" id="1941407">/</span><span class="num" id="1941408">32</span><span class="op" id="1941410">]</span><span class="op" id="1941411">&amp;</span><span class="op" id="1941412">(</span><span class="num" id="1941413">1</span><span class="op" id="1941414">&lt;&lt;</span><span class="op" id="1941416">(</span><span class="ident" id="1941417"><a href="/runtime/sigqueue.go.html#1941358">i</a></span><span class="op" id="1941418">&amp;</span><span class="num" id="1941419">31</span><span class="op" id="1941421">)</span><span class="op" id="1941422">)</span>&nbsp;<span class="op" id="1941424">!=</span>&nbsp;<span class="num" id="1941427">0</span>&nbsp;<span class="op" id="1941429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941435"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941438">.</span><span class="ident" id="1941439">recv</span><span class="op" id="1941443">[</span><span class="ident" id="1941444"><a href="/runtime/sigqueue.go.html#1941358">i</a></span><span class="op" id="1941445">/</span><span class="num" id="1941446">32</span><span class="op" id="1941448">]</span>&nbsp;<span class="op" id="1941450">&amp;^=</span>&nbsp;<span class="num" id="1941454">1</span>&nbsp;<span class="op" id="1941456">&lt;&lt;</span>&nbsp;<span class="op" id="1941459">(</span><span class="ident" id="1941460"><a href="/runtime/sigqueue.go.html#1941358">i</a></span>&nbsp;<span class="op" id="1941462">&amp;</span>&nbsp;<span class="num" id="1941464">31</span><span class="op" id="1941466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941472">return</span>&nbsp;<span class="ident" id="1941479"><a href="/runtime/sigqueue.go.html#1941358">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941488">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941493">//&nbsp;Wait&nbsp;for&nbsp;updates&nbsp;to&nbsp;be&nbsp;available&nbsp;from&nbsp;signal&nbsp;sender.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941550">Receive</span><span class="op" id="1941557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941561">for</span>&nbsp;<span class="op" id="1941565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941570">switch</span>&nbsp;<span class="ident" id="1941577"><a href="/runtime/atomic.go.html#1711297">atomicload</a></span><span class="op" id="1941587">(</span><span class="op" id="1941588">&amp;</span><span class="ident" id="1941589"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941592">.</span><span class="ident" id="1941593">state</span><span class="op" id="1941598">)</span>&nbsp;<span class="op" id="1941600">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941605">default</span><span class="op" id="1941612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941618"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1941625">(</span><span class="string" id="1941626">&#34;signal_recv:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1941659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941664">case</span>&nbsp;<span class="ident" id="1941669"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1941676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941682">if</span>&nbsp;<span class="ident" id="1941685"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1941688">(</span><span class="op" id="1941689">&amp;</span><span class="ident" id="1941690"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941693">.</span><span class="ident" id="1941694">state</span><span class="op" id="1941699">,</span>&nbsp;<span class="ident" id="1941701"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1941708">,</span>&nbsp;<span class="ident" id="1941710"><a href="/runtime/sigqueue.go.html#1940181">sigReceiving</a></span><span class="op" id="1941722">)</span>&nbsp;<span class="op" id="1941724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941731"><a href="/runtime/lock_futex.go.html#1818401">notetsleepg</a></span><span class="op" id="1941742">(</span><span class="op" id="1941743">&amp;</span><span class="ident" id="1941744"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941747">.</span><span class="ident" id="1941748">note</span><span class="op" id="1941752">,</span>&nbsp;<span class="op" id="1941754">-</span><span class="num" id="1941755">1</span><span class="op" id="1941756">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941763"><a href="/runtime/lock_futex.go.html#1817055">noteclear</a></span><span class="op" id="1941772">(</span><span class="op" id="1941773">&amp;</span><span class="ident" id="1941774"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941777">.</span><span class="ident" id="1941778">note</span><span class="op" id="1941782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941789">break</span>&nbsp;<span class="ident" id="1941795">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941812">case</span>&nbsp;<span class="ident" id="1941817"><a href="/runtime/sigqueue.go.html#1940195">sigSending</a></span><span class="op" id="1941827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941833">if</span>&nbsp;<span class="ident" id="1941836"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1941839">(</span><span class="op" id="1941840">&amp;</span><span class="ident" id="1941841"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941844">.</span><span class="ident" id="1941845">state</span><span class="op" id="1941850">,</span>&nbsp;<span class="ident" id="1941852"><a href="/runtime/sigqueue.go.html#1940195">sigSending</a></span><span class="op" id="1941862">,</span>&nbsp;<span class="ident" id="1941864"><a href="/runtime/sigqueue.go.html#1940165">sigIdle</a></span><span class="op" id="1941871">)</span>&nbsp;<span class="op" id="1941873">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941880">break</span>&nbsp;<span class="ident" id="1941886">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941912">//&nbsp;Incorporate&nbsp;updates&nbsp;from&nbsp;sender&nbsp;into&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941966">for</span>&nbsp;<span class="ident" id="1941970">i</span>&nbsp;<span class="op" id="1941972">:=</span>&nbsp;<span class="keyword" id="1941975">range</span>&nbsp;<span class="ident" id="1941981"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941984">.</span><span class="ident" id="1941985">mask</span>&nbsp;<span class="op" id="1941990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941995"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1941998">.</span><span class="ident" id="1941999">recv</span><span class="op" id="1942003">[</span><span class="ident" id="1942004"><a href="/runtime/sigqueue.go.html#1941970">i</a></span><span class="op" id="1942005">]</span>&nbsp;<span class="op" id="1942007">=</span>&nbsp;<span class="ident" id="1942009"><a href="/runtime/atomic.go.html#1711033">xchg</a></span><span class="op" id="1942013">(</span><span class="op" id="1942014">&amp;</span><span class="ident" id="1942015"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942018">.</span><span class="ident" id="1942019">mask</span><span class="op" id="1942023">[</span><span class="ident" id="1942024"><a href="/runtime/sigqueue.go.html#1941970">i</a></span><span class="op" id="1942025">]</span><span class="op" id="1942026">,</span>&nbsp;<span class="num" id="1942028">0</span><span class="op" id="1942029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942036">}</span><br>
<span class="lineno">125</span><span class="op" id="1942038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1942041">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1942099">func</span>&nbsp;<span class="ident" id="1942104">signal_enable</span><span class="op" id="1942117">(</span><span class="ident" id="1942118">s</span>&nbsp;<span class="builtintype" id="1942120">uint32</span><span class="op" id="1942126">)</span>&nbsp;<span class="op" id="1942128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942131">if</span>&nbsp;<span class="op" id="1942134">!</span><span class="ident" id="1942135"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942138">.</span><span class="ident" id="1942139">inuse</span>&nbsp;<span class="op" id="1942145">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942149">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;signal_enable&nbsp;is&nbsp;for&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942196">//&nbsp;to&nbsp;use&nbsp;for&nbsp;initialization.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;pass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942246">//&nbsp;signal&nbsp;information&nbsp;in&nbsp;m.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942276"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942279">.</span><span class="ident" id="1942280">inuse</span>&nbsp;<span class="op" id="1942286">=</span>&nbsp;<span class="ident" id="1942288">true</span>&nbsp;<span class="comment" id="1942293">//&nbsp;enable&nbsp;reception&nbsp;of&nbsp;signals;&nbsp;cannot&nbsp;disable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942342"><a href="/runtime/lock_futex.go.html#1817055">noteclear</a></span><span class="op" id="1942351">(</span><span class="op" id="1942352">&amp;</span><span class="ident" id="1942353"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942356">.</span><span class="ident" id="1942357">note</span><span class="op" id="1942361">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942377">if</span>&nbsp;<span class="builtintype" id="1942380">int</span><span class="op" id="1942383">(</span><span class="ident" id="1942384"><a href="/runtime/sigqueue.go.html#1942118">s</a></span><span class="op" id="1942385">)</span>&nbsp;<span class="op" id="1942387">&gt;=</span>&nbsp;<span class="builtinfunc" id="1942390">len</span><span class="op" id="1942393">(</span><span class="ident" id="1942394"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942397">.</span><span class="ident" id="1942398">wanted</span><span class="op" id="1942404">)</span><span class="op" id="1942405">*</span><span class="num" id="1942406">32</span>&nbsp;<span class="op" id="1942409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942413">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942424"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942427">.</span><span class="ident" id="1942428">wanted</span><span class="op" id="1942434">[</span><span class="ident" id="1942435"><a href="/runtime/sigqueue.go.html#1942118">s</a></span><span class="op" id="1942436">/</span><span class="num" id="1942437">32</span><span class="op" id="1942439">]</span>&nbsp;<span class="op" id="1942441">|=</span>&nbsp;<span class="num" id="1942444">1</span>&nbsp;<span class="op" id="1942446">&lt;&lt;</span>&nbsp;<span class="op" id="1942449">(</span><span class="ident" id="1942450"><a href="/runtime/sigqueue.go.html#1942118">s</a></span>&nbsp;<span class="op" id="1942452">&amp;</span>&nbsp;<span class="num" id="1942454">31</span><span class="op" id="1942456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942459"><a href="/runtime/sigqueue.go.html#1942932">sigenable_go</a></span><span class="op" id="1942471">(</span><span class="ident" id="1942472"><a href="/runtime/sigqueue.go.html#1942118">s</a></span><span class="op" id="1942473">)</span><br>
<span class="lineno"></span><span class="op" id="1942475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1942478">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1942536">func</span>&nbsp;<span class="ident" id="1942541">signal_disable</span><span class="op" id="1942555">(</span><span class="ident" id="1942556">s</span>&nbsp;<span class="builtintype" id="1942558">uint32</span><span class="op" id="1942564">)</span>&nbsp;<span class="op" id="1942566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942569">if</span>&nbsp;<span class="builtintype" id="1942572">int</span><span class="op" id="1942575">(</span><span class="ident" id="1942576"><a href="/runtime/sigqueue.go.html#1942556">s</a></span><span class="op" id="1942577">)</span>&nbsp;<span class="op" id="1942579">&gt;=</span>&nbsp;<span class="builtinfunc" id="1942582">len</span><span class="op" id="1942585">(</span><span class="ident" id="1942586"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942589">.</span><span class="ident" id="1942590">wanted</span><span class="op" id="1942596">)</span><span class="op" id="1942597">*</span><span class="num" id="1942598">32</span>&nbsp;<span class="op" id="1942601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942613">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942616"><a href="/runtime/sigqueue.go.html#1939997">sig</a></span><span class="op" id="1942619">.</span><span class="ident" id="1942620">wanted</span><span class="op" id="1942626">[</span><span class="ident" id="1942627"><a href="/runtime/sigqueue.go.html#1942556">s</a></span><span class="op" id="1942628">/</span><span class="num" id="1942629">32</span><span class="op" id="1942631">]</span>&nbsp;<span class="op" id="1942633">&amp;^=</span>&nbsp;<span class="num" id="1942637">1</span>&nbsp;<span class="op" id="1942639">&lt;&lt;</span>&nbsp;<span class="op" id="1942642">(</span><span class="ident" id="1942643"><a href="/runtime/sigqueue.go.html#1942556">s</a></span>&nbsp;<span class="op" id="1942645">&amp;</span>&nbsp;<span class="num" id="1942647">31</span><span class="op" id="1942649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942652"><a href="/runtime/sigqueue.go.html#1943027">sigdisable_go</a></span><span class="op" id="1942665">(</span><span class="ident" id="1942666"><a href="/runtime/sigqueue.go.html#1942556">s</a></span><span class="op" id="1942667">)</span><br>
<span class="lineno"></span><span class="op" id="1942669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1942672">//&nbsp;This&nbsp;runs&nbsp;on&nbsp;a&nbsp;foreign&nbsp;stack,&nbsp;without&nbsp;an&nbsp;m&nbsp;or&nbsp;a&nbsp;g.&nbsp;&nbsp;No&nbsp;stack&nbsp;split.</span><br>
<span class="lineno">155</span><span class="comment" id="1942743">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1942756">func</span>&nbsp;<span class="ident" id="1942761">badsignal</span><span class="op" id="1942770">(</span><span class="ident" id="1942771">sig</span>&nbsp;<span class="builtintype" id="1942775">uintptr</span><span class="op" id="1942782">)</span>&nbsp;<span class="op" id="1942784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942787"><a href="/runtime/stubs.go.html#1973502">cgocallback</a></span><span class="op" id="1942798">(</span><span class="ident" id="1942799"><a href="/runtime/sigqueue.go.html#1939983">unsafe</a></span><span class="op" id="1942805">.</span><span class="ident" id="1942806">Pointer</span><span class="op" id="1942813">(</span><span class="ident" id="1942814"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1942820">(</span><span class="ident" id="1942821"><a href="/runtime/sigqueue.go.html#1940387">sigsend</a></span><span class="op" id="1942828">)</span><span class="op" id="1942829">)</span><span class="op" id="1942830">,</span>&nbsp;<span class="ident" id="1942832"><a href="/runtime/stubs.go.html#1973287">noescape</a></span><span class="op" id="1942840">(</span><span class="ident" id="1942841"><a href="/runtime/sigqueue.go.html#1939983">unsafe</a></span><span class="op" id="1942847">.</span><span class="ident" id="1942848">Pointer</span><span class="op" id="1942855">(</span><span class="op" id="1942856">&amp;</span><span class="ident" id="1942857"><a href="/runtime/sigqueue.go.html#1942771">sig</a></span><span class="op" id="1942860">)</span><span class="op" id="1942861">)</span><span class="op" id="1942862">,</span>&nbsp;<span class="ident" id="1942864"><a href="/runtime/sigqueue.go.html#1939983">unsafe</a></span><span class="op" id="1942870">.</span><span class="ident" id="1942871">Sizeof</span><span class="op" id="1942877">(</span><span class="ident" id="1942878"><a href="/runtime/sigqueue.go.html#1942771">sig</a></span><span class="op" id="1942881">)</span><span class="op" id="1942882">)</span><br>
<span class="lineno"></span><span class="op" id="1942884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1942887">func</span>&nbsp;<span class="ident" id="1942892">sigenable_m</span><span class="op" id="1942903">(</span><span class="op" id="1942904">)</span><br>
<span class="lineno"></span><span class="keyword" id="1942906">func</span>&nbsp;<span class="ident" id="1942911">sigdisable_m</span><span class="op" id="1942923">(</span><span class="op" id="1942924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1942927">func</span>&nbsp;<span class="ident" id="1942932">sigenable_go</span><span class="op" id="1942944">(</span><span class="ident" id="1942945">s</span>&nbsp;<span class="builtintype" id="1942947">uint32</span><span class="op" id="1942953">)</span>&nbsp;<span class="op" id="1942955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942958">g</span>&nbsp;<span class="op" id="1942960">:=</span>&nbsp;<span class="ident" id="1942963"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1942967">(</span><span class="op" id="1942968">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942971"><a href="/runtime/sigqueue.go.html#1942958">g</a></span><span class="op" id="1942972">.</span><span class="ident" id="1942973">m</span><span class="op" id="1942974">.</span><span class="ident" id="1942975">scalararg</span><span class="op" id="1942984">[</span><span class="num" id="1942985">0</span><span class="op" id="1942986">]</span>&nbsp;<span class="op" id="1942988">=</span>&nbsp;<span class="builtintype" id="1942990">uintptr</span><span class="op" id="1942997">(</span><span class="ident" id="1942998"><a href="/runtime/sigqueue.go.html#1942945">s</a></span><span class="op" id="1942999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943002"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1943005">(</span><span class="ident" id="1943006"><a href="/runtime/sigqueue.go.html#1942892">sigenable_m</a></span><span class="op" id="1943017">)</span><br>
<span class="lineno"></span><span class="op" id="1943019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1943022">func</span>&nbsp;<span class="ident" id="1943027">sigdisable_go</span><span class="op" id="1943040">(</span><span class="ident" id="1943041">s</span>&nbsp;<span class="builtintype" id="1943043">uint32</span><span class="op" id="1943049">)</span>&nbsp;<span class="op" id="1943051">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943054">g</span>&nbsp;<span class="op" id="1943056">:=</span>&nbsp;<span class="ident" id="1943059"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1943063">(</span><span class="op" id="1943064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943067"><a href="/runtime/sigqueue.go.html#1943054">g</a></span><span class="op" id="1943068">.</span><span class="ident" id="1943069">m</span><span class="op" id="1943070">.</span><span class="ident" id="1943071">scalararg</span><span class="op" id="1943080">[</span><span class="num" id="1943081">0</span><span class="op" id="1943082">]</span>&nbsp;<span class="op" id="1943084">=</span>&nbsp;<span class="builtintype" id="1943086">uintptr</span><span class="op" id="1943093">(</span><span class="ident" id="1943094"><a href="/runtime/sigqueue.go.html#1943041">s</a></span><span class="op" id="1943095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943098"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1943101">(</span><span class="ident" id="1943102"><a href="/runtime/sigqueue.go.html#1942911">sigdisable_m</a></span><span class="op" id="1943114">)</span><br>
<span class="lineno"></span><span class="op" id="1943116">}</span>
</div>
</body>
</html>
