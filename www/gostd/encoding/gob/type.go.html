<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5573850">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5573905">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5573959">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5574010">package</span>&nbsp;<span class="ident" id="5574018">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5574023">import</span>&nbsp;<span class="op" id="5574030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574033">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574045">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574055">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574062">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574068">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574079">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574087">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574102">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5574113">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5574128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574131">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="5574213">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="5574292">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5574301">type</span>&nbsp;<span class="ident" id="5574306">userTypeInfo</span>&nbsp;<span class="keyword" id="5574319">struct</span>&nbsp;<span class="op" id="5574326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574329">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574341">reflect</span><span class="op" id="5574348">.</span><span class="ident" id="5574349">Type</span>&nbsp;<span class="comment" id="5574354">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574386">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574398">reflect</span><span class="op" id="5574405">.</span><span class="ident" id="5574406">Type</span>&nbsp;<span class="comment" id="5574411">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574452">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5574464">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574477">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574527">externalEnc</span>&nbsp;<span class="builtintype" id="5574539">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574552">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574580">externalDec</span>&nbsp;<span class="builtintype" id="5574592">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574605">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574632">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5574644">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574657">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574728">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5574740">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574753">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="5574823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574826">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="5574851">const</span>&nbsp;<span class="op" id="5574857">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574860">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5574868">=</span>&nbsp;<span class="num" id="5574870">1</span>&nbsp;<span class="op" id="5574872">+</span>&nbsp;<span class="ident" id="5574874">iota</span>&nbsp;<span class="comment" id="5574879">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574908">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5574927">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5574986">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575005">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="5575059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5575062">var</span>&nbsp;<span class="op" id="5575066">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575069">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575132">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575194">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="5575208">sync</span><span class="op" id="5575212">.</span><span class="ident" id="5575213">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575222">userTypeCache</span>&nbsp;<span class="op" id="5575236">=</span>&nbsp;<span class="builtinfunc" id="5575238">make</span><span class="op" id="5575242">(</span><span class="keyword" id="5575243">map</span><span class="op" id="5575246">[</span><span class="ident" id="5575247">reflect</span><span class="op" id="5575254">.</span><span class="ident" id="5575255">Type</span><span class="op" id="5575259">]</span><span class="op" id="5575260">*</span><span class="ident" id="5575261">userTypeInfo</span><span class="op" id="5575273">)</span><br>
<span class="lineno"></span><span class="op" id="5575275">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5575278">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5575366">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="5575456">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="5575474">func</span>&nbsp;<span class="ident" id="5575479">validUserType</span><span class="op" id="5575492">(</span><span class="ident" id="5575493">rt</span>&nbsp;<span class="ident" id="5575496">reflect</span><span class="op" id="5575503">.</span><span class="ident" id="5575504">Type</span><span class="op" id="5575508">)</span>&nbsp;<span class="op" id="5575510">(</span><span class="ident" id="5575511">ut</span>&nbsp;<span class="op" id="5575514">*</span><span class="ident" id="5575515">userTypeInfo</span><span class="op" id="5575527">,</span>&nbsp;<span class="ident" id="5575529">err</span>&nbsp;<span class="builtintype" id="5575533">error</span><span class="op" id="5575538">)</span>&nbsp;<span class="op" id="5575540">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575543">userTypeLock</span><span class="op" id="5575555">.</span><span class="ident" id="5575556">RLock</span><span class="op" id="5575561">(</span><span class="op" id="5575562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575565">ut</span>&nbsp;<span class="op" id="5575568">=</span>&nbsp;<span class="ident" id="5575570">userTypeCache</span><span class="op" id="5575583">[</span><span class="ident" id="5575584">rt</span><span class="op" id="5575586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575589">userTypeLock</span><span class="op" id="5575601">.</span><span class="ident" id="5575602">RUnlock</span><span class="op" id="5575609">(</span><span class="op" id="5575610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575613">if</span>&nbsp;<span class="ident" id="5575616">ut</span>&nbsp;<span class="op" id="5575619">!=</span>&nbsp;<span class="builtintype" id="5575622">nil</span>&nbsp;<span class="op" id="5575626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575630">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5575638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575641">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575685">userTypeLock</span><span class="op" id="5575697">.</span><span class="ident" id="5575698">Lock</span><span class="op" id="5575702">(</span><span class="op" id="5575703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575706">defer</span>&nbsp;<span class="ident" id="5575712">userTypeLock</span><span class="op" id="5575724">.</span><span class="ident" id="5575725">Unlock</span><span class="op" id="5575731">(</span><span class="op" id="5575732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575735">if</span>&nbsp;<span class="ident" id="5575738">ut</span>&nbsp;<span class="op" id="5575741">=</span>&nbsp;<span class="ident" id="5575743">userTypeCache</span><span class="op" id="5575756">[</span><span class="ident" id="5575757">rt</span><span class="op" id="5575759">]</span><span class="op" id="5575760">;</span>&nbsp;<span class="ident" id="5575762">ut</span>&nbsp;<span class="op" id="5575765">!=</span>&nbsp;<span class="builtintype" id="5575768">nil</span>&nbsp;<span class="op" id="5575772">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575776">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5575811">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5575819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575822">ut</span>&nbsp;<span class="op" id="5575825">=</span>&nbsp;<span class="builtinfunc" id="5575827">new</span><span class="op" id="5575830">(</span><span class="ident" id="5575831">userTypeInfo</span><span class="op" id="5575843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575846">ut</span><span class="op" id="5575848">.</span><span class="ident" id="5575849">base</span>&nbsp;<span class="op" id="5575854">=</span>&nbsp;<span class="ident" id="5575856">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5575860">ut</span><span class="op" id="5575862">.</span><span class="ident" id="5575863">user</span>&nbsp;<span class="op" id="5575868">=</span>&nbsp;<span class="ident" id="5575870">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575874">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5575945">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576014">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576082">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576152">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576202">slowpoke</span>&nbsp;<span class="op" id="5576211">:=</span>&nbsp;<span class="ident" id="5576214">ut</span><span class="op" id="5576216">.</span><span class="ident" id="5576217">base</span>&nbsp;<span class="comment" id="5576222">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576256">for</span>&nbsp;<span class="op" id="5576260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576264">pt</span>&nbsp;<span class="op" id="5576267">:=</span>&nbsp;<span class="ident" id="5576270">ut</span><span class="op" id="5576272">.</span><span class="ident" id="5576273">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576280">if</span>&nbsp;<span class="ident" id="5576283">pt</span><span class="op" id="5576285">.</span><span class="ident" id="5576286">Kind</span><span class="op" id="5576290">(</span><span class="op" id="5576291">)</span>&nbsp;<span class="op" id="5576293">!=</span>&nbsp;<span class="ident" id="5576296">reflect</span><span class="op" id="5576303">.</span><span class="ident" id="5576304">Ptr</span>&nbsp;<span class="op" id="5576308">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576313">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576325">ut</span><span class="op" id="5576327">.</span><span class="ident" id="5576328">base</span>&nbsp;<span class="op" id="5576333">=</span>&nbsp;<span class="ident" id="5576335">pt</span><span class="op" id="5576337">.</span><span class="ident" id="5576338">Elem</span><span class="op" id="5576342">(</span><span class="op" id="5576343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576347">if</span>&nbsp;<span class="ident" id="5576350">ut</span><span class="op" id="5576352">.</span><span class="ident" id="5576353">base</span>&nbsp;<span class="op" id="5576358">==</span>&nbsp;<span class="ident" id="5576361">slowpoke</span>&nbsp;<span class="op" id="5576370">{</span>&nbsp;<span class="comment" id="5576372">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576402">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576432">return</span>&nbsp;<span class="builtintype" id="5576439">nil</span><span class="op" id="5576442">,</span>&nbsp;<span class="ident" id="5576444">errors</span><span class="op" id="5576450">.</span><span class="ident" id="5576451">New</span><span class="op" id="5576454">(</span><span class="string" id="5576455">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5576497">+</span>&nbsp;<span class="ident" id="5576499">ut</span><span class="op" id="5576501">.</span><span class="ident" id="5576502">base</span><span class="op" id="5576506">.</span><span class="ident" id="5576507">String</span><span class="op" id="5576513">(</span><span class="op" id="5576514">)</span><span class="op" id="5576515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576523">if</span>&nbsp;<span class="ident" id="5576526">ut</span><span class="op" id="5576528">.</span><span class="ident" id="5576529">indir</span><span class="op" id="5576534">%</span><span class="num" id="5576535">2</span>&nbsp;<span class="op" id="5576537">==</span>&nbsp;<span class="num" id="5576540">0</span>&nbsp;<span class="op" id="5576542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576547">slowpoke</span>&nbsp;<span class="op" id="5576556">=</span>&nbsp;<span class="ident" id="5576558">slowpoke</span><span class="op" id="5576566">.</span><span class="ident" id="5576567">Elem</span><span class="op" id="5576571">(</span><span class="op" id="5576572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576576">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576580">ut</span><span class="op" id="5576582">.</span><span class="ident" id="5576583">indir</span><span class="op" id="5576588">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5576596">if</span>&nbsp;<span class="ident" id="5576599">ok</span><span class="op" id="5576601">,</span>&nbsp;<span class="ident" id="5576603">indir</span>&nbsp;<span class="op" id="5576609">:=</span>&nbsp;<span class="ident" id="5576612">implementsInterface</span><span class="op" id="5576631">(</span><span class="ident" id="5576632">ut</span><span class="op" id="5576634">.</span><span class="ident" id="5576635">user</span><span class="op" id="5576639">,</span>&nbsp;<span class="ident" id="5576641">gobEncoderInterfaceType</span><span class="op" id="5576664">)</span><span class="op" id="5576665">;</span>&nbsp;<span class="ident" id="5576667">ok</span>&nbsp;<span class="op" id="5576670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576674">ut</span><span class="op" id="5576676">.</span><span class="ident" id="5576677">externalEnc</span><span class="op" id="5576688">,</span>&nbsp;<span class="ident" id="5576690">ut</span><span class="op" id="5576692">.</span><span class="ident" id="5576693">encIndir</span>&nbsp;<span class="op" id="5576702">=</span>&nbsp;<span class="ident" id="5576704">xGob</span><span class="op" id="5576708">,</span>&nbsp;<span class="ident" id="5576710">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576717">}</span>&nbsp;<span class="keyword" id="5576719">else</span>&nbsp;<span class="keyword" id="5576724">if</span>&nbsp;<span class="ident" id="5576727">ok</span><span class="op" id="5576729">,</span>&nbsp;<span class="ident" id="5576731">indir</span>&nbsp;<span class="op" id="5576737">:=</span>&nbsp;<span class="ident" id="5576740">implementsInterface</span><span class="op" id="5576759">(</span><span class="ident" id="5576760">ut</span><span class="op" id="5576762">.</span><span class="ident" id="5576763">user</span><span class="op" id="5576767">,</span>&nbsp;<span class="ident" id="5576769">binaryMarshalerInterfaceType</span><span class="op" id="5576797">)</span><span class="op" id="5576798">;</span>&nbsp;<span class="ident" id="5576800">ok</span>&nbsp;<span class="op" id="5576803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5576807">ut</span><span class="op" id="5576809">.</span><span class="ident" id="5576810">externalEnc</span><span class="op" id="5576821">,</span>&nbsp;<span class="ident" id="5576823">ut</span><span class="op" id="5576825">.</span><span class="ident" id="5576826">encIndir</span>&nbsp;<span class="op" id="5576835">=</span>&nbsp;<span class="ident" id="5576837">xBinary</span><span class="op" id="5576844">,</span>&nbsp;<span class="ident" id="5576846">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5576853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576857">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5576941">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577005">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577143">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577150">if</span>&nbsp;<span class="ident" id="5577153">ok</span><span class="op" id="5577155">,</span>&nbsp;<span class="ident" id="5577157">indir</span>&nbsp;<span class="op" id="5577163">:=</span>&nbsp;<span class="ident" id="5577166">implementsInterface</span><span class="op" id="5577185">(</span><span class="ident" id="5577186">ut</span><span class="op" id="5577188">.</span><span class="ident" id="5577189">user</span><span class="op" id="5577193">,</span>&nbsp;<span class="ident" id="5577195">gobDecoderInterfaceType</span><span class="op" id="5577218">)</span><span class="op" id="5577219">;</span>&nbsp;<span class="ident" id="5577221">ok</span>&nbsp;<span class="op" id="5577224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577228">ut</span><span class="op" id="5577230">.</span><span class="ident" id="5577231">externalDec</span><span class="op" id="5577242">,</span>&nbsp;<span class="ident" id="5577244">ut</span><span class="op" id="5577246">.</span><span class="ident" id="5577247">decIndir</span>&nbsp;<span class="op" id="5577256">=</span>&nbsp;<span class="ident" id="5577258">xGob</span><span class="op" id="5577262">,</span>&nbsp;<span class="ident" id="5577264">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577271">}</span>&nbsp;<span class="keyword" id="5577273">else</span>&nbsp;<span class="keyword" id="5577278">if</span>&nbsp;<span class="ident" id="5577281">ok</span><span class="op" id="5577283">,</span>&nbsp;<span class="ident" id="5577285">indir</span>&nbsp;<span class="op" id="5577291">:=</span>&nbsp;<span class="ident" id="5577294">implementsInterface</span><span class="op" id="5577313">(</span><span class="ident" id="5577314">ut</span><span class="op" id="5577316">.</span><span class="ident" id="5577317">user</span><span class="op" id="5577321">,</span>&nbsp;<span class="ident" id="5577323">binaryUnmarshalerInterfaceType</span><span class="op" id="5577353">)</span><span class="op" id="5577354">;</span>&nbsp;<span class="ident" id="5577356">ok</span>&nbsp;<span class="op" id="5577359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577363">ut</span><span class="op" id="5577365">.</span><span class="ident" id="5577366">externalDec</span><span class="op" id="5577377">,</span>&nbsp;<span class="ident" id="5577379">ut</span><span class="op" id="5577381">.</span><span class="ident" id="5577382">decIndir</span>&nbsp;<span class="op" id="5577391">=</span>&nbsp;<span class="ident" id="5577393">xBinary</span><span class="op" id="5577400">,</span>&nbsp;<span class="ident" id="5577402">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577409">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577413">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577433">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577525">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5577573">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577580">userTypeCache</span><span class="op" id="5577593">[</span><span class="ident" id="5577594">rt</span><span class="op" id="5577596">]</span>&nbsp;<span class="op" id="5577598">=</span>&nbsp;<span class="ident" id="5577600">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5577604">return</span><br>
<span class="lineno"></span><span class="op" id="5577611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5577614">var</span>&nbsp;<span class="op" id="5577618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577621">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577652">=</span>&nbsp;<span class="ident" id="5577654">reflect</span><span class="op" id="5577661">.</span><span class="ident" id="5577662">TypeOf</span><span class="op" id="5577668">(</span><span class="op" id="5577669">(</span><span class="op" id="5577670">*</span><span class="ident" id="5577671">GobEncoder</span><span class="op" id="5577681">)</span><span class="op" id="5577682">(</span><span class="builtintype" id="5577683">nil</span><span class="op" id="5577686">)</span><span class="op" id="5577687">)</span><span class="op" id="5577688">.</span><span class="ident" id="5577689">Elem</span><span class="op" id="5577693">(</span><span class="op" id="5577694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577697">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577728">=</span>&nbsp;<span class="ident" id="5577730">reflect</span><span class="op" id="5577737">.</span><span class="ident" id="5577738">TypeOf</span><span class="op" id="5577744">(</span><span class="op" id="5577745">(</span><span class="op" id="5577746">*</span><span class="ident" id="5577747">GobDecoder</span><span class="op" id="5577757">)</span><span class="op" id="5577758">(</span><span class="builtintype" id="5577759">nil</span><span class="op" id="5577762">)</span><span class="op" id="5577763">)</span><span class="op" id="5577764">.</span><span class="ident" id="5577765">Elem</span><span class="op" id="5577769">(</span><span class="op" id="5577770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577773">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5577804">=</span>&nbsp;<span class="ident" id="5577806">reflect</span><span class="op" id="5577813">.</span><span class="ident" id="5577814">TypeOf</span><span class="op" id="5577820">(</span><span class="op" id="5577821">(</span><span class="op" id="5577822">*</span><span class="ident" id="5577823">encoding</span><span class="op" id="5577831">.</span><span class="ident" id="5577832">BinaryMarshaler</span><span class="op" id="5577847">)</span><span class="op" id="5577848">(</span><span class="builtintype" id="5577849">nil</span><span class="op" id="5577852">)</span><span class="op" id="5577853">)</span><span class="op" id="5577854">.</span><span class="ident" id="5577855">Elem</span><span class="op" id="5577859">(</span><span class="op" id="5577860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577863">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="5577894">=</span>&nbsp;<span class="ident" id="5577896">reflect</span><span class="op" id="5577903">.</span><span class="ident" id="5577904">TypeOf</span><span class="op" id="5577910">(</span><span class="op" id="5577911">(</span><span class="op" id="5577912">*</span><span class="ident" id="5577913">encoding</span><span class="op" id="5577921">.</span><span class="ident" id="5577922">BinaryUnmarshaler</span><span class="op" id="5577939">)</span><span class="op" id="5577940">(</span><span class="builtintype" id="5577941">nil</span><span class="op" id="5577944">)</span><span class="op" id="5577945">)</span><span class="op" id="5577946">.</span><span class="ident" id="5577947">Elem</span><span class="op" id="5577951">(</span><span class="op" id="5577952">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577955">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5577986">=</span>&nbsp;<span class="ident" id="5577988">reflect</span><span class="op" id="5577995">.</span><span class="ident" id="5577996">TypeOf</span><span class="op" id="5578002">(</span><span class="op" id="5578003">(</span><span class="op" id="5578004">*</span><span class="ident" id="5578005">encoding</span><span class="op" id="5578013">.</span><span class="ident" id="5578014">TextMarshaler</span><span class="op" id="5578027">)</span><span class="op" id="5578028">(</span><span class="builtintype" id="5578029">nil</span><span class="op" id="5578032">)</span><span class="op" id="5578033">)</span><span class="op" id="5578034">.</span><span class="ident" id="5578035">Elem</span><span class="op" id="5578039">(</span><span class="op" id="5578040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578043">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5578074">=</span>&nbsp;<span class="ident" id="5578076">reflect</span><span class="op" id="5578083">.</span><span class="ident" id="5578084">TypeOf</span><span class="op" id="5578090">(</span><span class="op" id="5578091">(</span><span class="op" id="5578092">*</span><span class="ident" id="5578093">encoding</span><span class="op" id="5578101">.</span><span class="ident" id="5578102">TextUnmarshaler</span><span class="op" id="5578117">)</span><span class="op" id="5578118">(</span><span class="builtintype" id="5578119">nil</span><span class="op" id="5578122">)</span><span class="op" id="5578123">)</span><span class="op" id="5578124">.</span><span class="ident" id="5578125">Elem</span><span class="op" id="5578129">(</span><span class="op" id="5578130">)</span><br>
<span class="lineno"></span><span class="op" id="5578132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5578135">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="5578198">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5578234">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5578303">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5578322">func</span>&nbsp;<span class="ident" id="5578327">implementsInterface</span><span class="op" id="5578346">(</span><span class="ident" id="5578347">typ</span><span class="op" id="5578350">,</span>&nbsp;<span class="ident" id="5578352">gobEncDecType</span>&nbsp;<span class="ident" id="5578366">reflect</span><span class="op" id="5578373">.</span><span class="ident" id="5578374">Type</span><span class="op" id="5578378">)</span>&nbsp;<span class="op" id="5578380">(</span><span class="ident" id="5578381">success</span>&nbsp;<span class="builtintype" id="5578389">bool</span><span class="op" id="5578393">,</span>&nbsp;<span class="ident" id="5578395">indir</span>&nbsp;<span class="builtintype" id="5578401">int8</span><span class="op" id="5578405">)</span>&nbsp;<span class="op" id="5578407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578410">if</span>&nbsp;<span class="ident" id="5578413">typ</span>&nbsp;<span class="op" id="5578417">==</span>&nbsp;<span class="builtintype" id="5578420">nil</span>&nbsp;<span class="op" id="5578424">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578439">rt</span>&nbsp;<span class="op" id="5578442">:=</span>&nbsp;<span class="ident" id="5578445">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5578450">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5578502">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578570">for</span>&nbsp;<span class="op" id="5578574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578578">if</span>&nbsp;<span class="ident" id="5578581">rt</span><span class="op" id="5578583">.</span><span class="ident" id="5578584">Implements</span><span class="op" id="5578594">(</span><span class="ident" id="5578595">gobEncDecType</span><span class="op" id="5578608">)</span>&nbsp;<span class="op" id="5578610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578615">return</span>&nbsp;<span class="builtintype" id="5578622">true</span><span class="op" id="5578626">,</span>&nbsp;<span class="ident" id="5578628">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578640">if</span>&nbsp;<span class="ident" id="5578643">p</span>&nbsp;<span class="op" id="5578645">:=</span>&nbsp;<span class="ident" id="5578648">rt</span><span class="op" id="5578650">;</span>&nbsp;<span class="ident" id="5578652">p</span><span class="op" id="5578653">.</span><span class="ident" id="5578654">Kind</span><span class="op" id="5578658">(</span><span class="op" id="5578659">)</span>&nbsp;<span class="op" id="5578661">==</span>&nbsp;<span class="ident" id="5578664">reflect</span><span class="op" id="5578671">.</span><span class="ident" id="5578672">Ptr</span>&nbsp;<span class="op" id="5578676">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578681">indir</span><span class="op" id="5578686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578692">if</span>&nbsp;<span class="ident" id="5578695">indir</span>&nbsp;<span class="op" id="5578701">&gt;</span>&nbsp;<span class="num" id="5578703">100</span>&nbsp;<span class="op" id="5578707">{</span>&nbsp;<span class="comment" id="5578709">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578746">return</span>&nbsp;<span class="builtintype" id="5578753">false</span><span class="op" id="5578758">,</span>&nbsp;<span class="num" id="5578760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5578770">rt</span>&nbsp;<span class="op" id="5578773">=</span>&nbsp;<span class="ident" id="5578775">p</span><span class="op" id="5578776">.</span><span class="ident" id="5578777">Elem</span><span class="op" id="5578781">(</span><span class="op" id="5578782">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578787">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578802">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5578812">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578898">if</span>&nbsp;<span class="ident" id="5578901">typ</span><span class="op" id="5578904">.</span><span class="ident" id="5578905">Kind</span><span class="op" id="5578909">(</span><span class="op" id="5578910">)</span>&nbsp;<span class="op" id="5578912">!=</span>&nbsp;<span class="ident" id="5578915">reflect</span><span class="op" id="5578922">.</span><span class="ident" id="5578923">Ptr</span>&nbsp;<span class="op" id="5578927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5578931">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5578978">if</span>&nbsp;<span class="ident" id="5578981">reflect</span><span class="op" id="5578988">.</span><span class="ident" id="5578989">PtrTo</span><span class="op" id="5578994">(</span><span class="ident" id="5578995">typ</span><span class="op" id="5578998">)</span><span class="op" id="5578999">.</span><span class="ident" id="5579000">Implements</span><span class="op" id="5579010">(</span><span class="ident" id="5579011">gobEncDecType</span><span class="op" id="5579024">)</span>&nbsp;<span class="op" id="5579026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579031">return</span>&nbsp;<span class="builtintype" id="5579038">true</span><span class="op" id="5579042">,</span>&nbsp;<span class="op" id="5579044">-</span><span class="num" id="5579045">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579049">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579055">return</span>&nbsp;<span class="builtintype" id="5579062">false</span><span class="op" id="5579067">,</span>&nbsp;<span class="num" id="5579069">0</span><br>
<span class="lineno"></span><span class="op" id="5579071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579074">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="5579161">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5579211">func</span>&nbsp;<span class="ident" id="5579216">userType</span><span class="op" id="5579224">(</span><span class="ident" id="5579225">rt</span>&nbsp;<span class="ident" id="5579228">reflect</span><span class="op" id="5579235">.</span><span class="ident" id="5579236">Type</span><span class="op" id="5579240">)</span>&nbsp;<span class="op" id="5579242">*</span><span class="ident" id="5579243">userTypeInfo</span>&nbsp;<span class="op" id="5579256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579259">ut</span><span class="op" id="5579261">,</span>&nbsp;<span class="ident" id="5579263">err</span>&nbsp;<span class="op" id="5579267">:=</span>&nbsp;<span class="ident" id="5579270">validUserType</span><span class="op" id="5579283">(</span><span class="ident" id="5579284">rt</span><span class="op" id="5579286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579289">if</span>&nbsp;<span class="ident" id="5579292">err</span>&nbsp;<span class="op" id="5579296">!=</span>&nbsp;<span class="builtintype" id="5579299">nil</span>&nbsp;<span class="op" id="5579303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579307">error_</span><span class="op" id="5579313">(</span><span class="ident" id="5579314">err</span><span class="op" id="5579317">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5579323">return</span>&nbsp;<span class="ident" id="5579330">ut</span><br>
<span class="lineno"></span><span class="op" id="5579333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579336">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="5579416">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="5579502">type</span>&nbsp;<span class="ident" id="5579507">typeId</span>&nbsp;<span class="builtintype" id="5579514">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579521">var</span>&nbsp;<span class="ident" id="5579525">nextId</span>&nbsp;<span class="ident" id="5579532">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5579545">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="5579587">var</span>&nbsp;<span class="ident" id="5579591">typeLock</span>&nbsp;<span class="ident" id="5579600">sync</span><span class="op" id="5579604">.</span><span class="ident" id="5579605">Mutex</span>&nbsp;<span class="comment" id="5579611">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="5579640">const</span>&nbsp;<span class="ident" id="5579646">firstUserId</span>&nbsp;<span class="op" id="5579658">=</span>&nbsp;<span class="num" id="5579660">64</span>&nbsp;&nbsp;<span class="comment" id="5579664">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579701">type</span>&nbsp;<span class="ident" id="5579706">gobType</span>&nbsp;<span class="keyword" id="5579714">interface</span>&nbsp;<span class="op" id="5579724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579727">id</span><span class="op" id="5579729">(</span><span class="op" id="5579730">)</span>&nbsp;<span class="ident" id="5579732">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579740">setId</span><span class="op" id="5579745">(</span><span class="ident" id="5579746">id</span>&nbsp;<span class="ident" id="5579749">typeId</span><span class="op" id="5579755">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579758">name</span><span class="op" id="5579762">(</span><span class="op" id="5579763">)</span>&nbsp;<span class="builtintype" id="5579765">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579773">string</span><span class="op" id="5579779">(</span><span class="op" id="5579780">)</span>&nbsp;<span class="builtintype" id="5579782">string</span>&nbsp;<span class="comment" id="5579789">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579824">safeString</span><span class="op" id="5579834">(</span><span class="ident" id="5579835">seen</span>&nbsp;<span class="keyword" id="5579840">map</span><span class="op" id="5579843">[</span><span class="ident" id="5579844">typeId</span><span class="op" id="5579850">]</span><span class="builtintype" id="5579851">bool</span><span class="op" id="5579855">)</span>&nbsp;<span class="builtintype" id="5579857">string</span><br>
<span class="lineno"></span><span class="op" id="5579864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5579867">var</span>&nbsp;<span class="ident" id="5579871">types</span>&nbsp;<span class="op" id="5579877">=</span>&nbsp;<span class="builtinfunc" id="5579879">make</span><span class="op" id="5579883">(</span><span class="keyword" id="5579884">map</span><span class="op" id="5579887">[</span><span class="ident" id="5579888">reflect</span><span class="op" id="5579895">.</span><span class="ident" id="5579896">Type</span><span class="op" id="5579900">]</span><span class="ident" id="5579901">gobType</span><span class="op" id="5579908">)</span><br>
<span class="lineno"></span><span class="keyword" id="5579910">var</span>&nbsp;<span class="ident" id="5579914">idToType</span>&nbsp;<span class="op" id="5579923">=</span>&nbsp;<span class="builtinfunc" id="5579925">make</span><span class="op" id="5579929">(</span><span class="keyword" id="5579930">map</span><span class="op" id="5579933">[</span><span class="ident" id="5579934">typeId</span><span class="op" id="5579940">]</span><span class="ident" id="5579941">gobType</span><span class="op" id="5579948">)</span><br>
<span class="lineno"></span><span class="keyword" id="5579950">var</span>&nbsp;<span class="ident" id="5579954">builtinIdToType</span>&nbsp;<span class="keyword" id="5579970">map</span><span class="op" id="5579973">[</span><span class="ident" id="5579974">typeId</span><span class="op" id="5579980">]</span><span class="ident" id="5579981">gobType</span>&nbsp;<span class="comment" id="5579989">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580038">func</span>&nbsp;<span class="ident" id="5580043">setTypeId</span><span class="op" id="5580052">(</span><span class="ident" id="5580053">typ</span>&nbsp;<span class="ident" id="5580057">gobType</span><span class="op" id="5580064">)</span>&nbsp;<span class="op" id="5580066">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5580069">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580137">if</span>&nbsp;<span class="ident" id="5580140">typ</span><span class="op" id="5580143">.</span><span class="ident" id="5580144">id</span><span class="op" id="5580146">(</span><span class="op" id="5580147">)</span>&nbsp;<span class="op" id="5580149">!=</span>&nbsp;<span class="num" id="5580152">0</span>&nbsp;<span class="op" id="5580154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580158">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580169">nextId</span><span class="op" id="5580175">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580179">typ</span><span class="op" id="5580182">.</span><span class="ident" id="5580183">setId</span><span class="op" id="5580188">(</span><span class="ident" id="5580189">nextId</span><span class="op" id="5580195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580198">idToType</span><span class="op" id="5580206">[</span><span class="ident" id="5580207">nextId</span><span class="op" id="5580213">]</span>&nbsp;<span class="op" id="5580215">=</span>&nbsp;<span class="ident" id="5580217">typ</span><br>
<span class="lineno"></span><span class="op" id="5580221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580224">func</span>&nbsp;<span class="op" id="5580229">(</span><span class="ident" id="5580230">t</span>&nbsp;<span class="ident" id="5580232">typeId</span><span class="op" id="5580238">)</span>&nbsp;<span class="ident" id="5580240">gobType</span><span class="op" id="5580247">(</span><span class="op" id="5580248">)</span>&nbsp;<span class="ident" id="5580250">gobType</span>&nbsp;<span class="op" id="5580258">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580261">if</span>&nbsp;<span class="ident" id="5580264">t</span>&nbsp;<span class="op" id="5580266">==</span>&nbsp;<span class="num" id="5580269">0</span>&nbsp;<span class="op" id="5580271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580275">return</span>&nbsp;<span class="builtintype" id="5580282">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580290">return</span>&nbsp;<span class="ident" id="5580297">idToType</span><span class="op" id="5580305">[</span><span class="ident" id="5580306">t</span><span class="op" id="5580307">]</span><br>
<span class="lineno"></span><span class="op" id="5580309">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="5580312">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="5580396">func</span>&nbsp;<span class="op" id="5580401">(</span><span class="ident" id="5580402">t</span>&nbsp;<span class="ident" id="5580404">typeId</span><span class="op" id="5580410">)</span>&nbsp;<span class="builtintype" id="5580412">string</span><span class="op" id="5580418">(</span><span class="op" id="5580419">)</span>&nbsp;<span class="builtintype" id="5580421">string</span>&nbsp;<span class="op" id="5580428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580431">if</span>&nbsp;<span class="ident" id="5580434">t</span><span class="op" id="5580435">.</span><span class="ident" id="5580436">gobType</span><span class="op" id="5580443">(</span><span class="op" id="5580444">)</span>&nbsp;<span class="op" id="5580446">==</span>&nbsp;<span class="builtintype" id="5580449">nil</span>&nbsp;<span class="op" id="5580453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580457">return</span>&nbsp;<span class="string" id="5580464">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580476">return</span>&nbsp;<span class="ident" id="5580483">t</span><span class="op" id="5580484">.</span><span class="ident" id="5580485">gobType</span><span class="op" id="5580492">(</span><span class="op" id="5580493">)</span><span class="op" id="5580494">.</span><span class="builtintype" id="5580495">string</span><span class="op" id="5580501">(</span><span class="op" id="5580502">)</span><br>
<span class="lineno"></span><span class="op" id="5580504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5580507">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="5580572">func</span>&nbsp;<span class="op" id="5580577">(</span><span class="ident" id="5580578">t</span>&nbsp;<span class="ident" id="5580580">typeId</span><span class="op" id="5580586">)</span>&nbsp;<span class="ident" id="5580588">name</span><span class="op" id="5580592">(</span><span class="op" id="5580593">)</span>&nbsp;<span class="builtintype" id="5580595">string</span>&nbsp;<span class="op" id="5580602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580605">if</span>&nbsp;<span class="ident" id="5580608">t</span><span class="op" id="5580609">.</span><span class="ident" id="5580610">gobType</span><span class="op" id="5580617">(</span><span class="op" id="5580618">)</span>&nbsp;<span class="op" id="5580620">==</span>&nbsp;<span class="builtintype" id="5580623">nil</span>&nbsp;<span class="op" id="5580627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580631">return</span>&nbsp;<span class="string" id="5580638">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5580647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5580650">return</span>&nbsp;<span class="ident" id="5580657">t</span><span class="op" id="5580658">.</span><span class="ident" id="5580659">gobType</span><span class="op" id="5580666">(</span><span class="op" id="5580667">)</span><span class="op" id="5580668">.</span><span class="ident" id="5580669">name</span><span class="op" id="5580673">(</span><span class="op" id="5580674">)</span><br>
<span class="lineno">220</span><span class="op" id="5580676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5580679">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="5580722">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5580797">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="5580874">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5580917">type</span>&nbsp;<span class="ident" id="5580922">CommonType</span>&nbsp;<span class="keyword" id="5580933">struct</span>&nbsp;<span class="op" id="5580940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580943">Name</span>&nbsp;<span class="builtintype" id="5580948">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5580956">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5580961">typeId</span><br>
<span class="lineno"></span><span class="op" id="5580968">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5580971">func</span>&nbsp;<span class="op" id="5580976">(</span><span class="ident" id="5580977">t</span>&nbsp;<span class="op" id="5580979">*</span><span class="ident" id="5580980">CommonType</span><span class="op" id="5580990">)</span>&nbsp;<span class="ident" id="5580992">id</span><span class="op" id="5580994">(</span><span class="op" id="5580995">)</span>&nbsp;<span class="ident" id="5580997">typeId</span>&nbsp;<span class="op" id="5581004">{</span>&nbsp;<span class="keyword" id="5581006">return</span>&nbsp;<span class="ident" id="5581013">t</span><span class="op" id="5581014">.</span><span class="ident" id="5581015">Id</span>&nbsp;<span class="op" id="5581018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5581021">func</span>&nbsp;<span class="op" id="5581026">(</span><span class="ident" id="5581027">t</span>&nbsp;<span class="op" id="5581029">*</span><span class="ident" id="5581030">CommonType</span><span class="op" id="5581040">)</span>&nbsp;<span class="ident" id="5581042">setId</span><span class="op" id="5581047">(</span><span class="ident" id="5581048">id</span>&nbsp;<span class="ident" id="5581051">typeId</span><span class="op" id="5581057">)</span>&nbsp;<span class="op" id="5581059">{</span>&nbsp;<span class="ident" id="5581061">t</span><span class="op" id="5581062">.</span><span class="ident" id="5581063">Id</span>&nbsp;<span class="op" id="5581066">=</span>&nbsp;<span class="ident" id="5581068">id</span>&nbsp;<span class="op" id="5581071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5581074">func</span>&nbsp;<span class="op" id="5581079">(</span><span class="ident" id="5581080">t</span>&nbsp;<span class="op" id="5581082">*</span><span class="ident" id="5581083">CommonType</span><span class="op" id="5581093">)</span>&nbsp;<span class="builtintype" id="5581095">string</span><span class="op" id="5581101">(</span><span class="op" id="5581102">)</span>&nbsp;<span class="builtintype" id="5581104">string</span>&nbsp;<span class="op" id="5581111">{</span>&nbsp;<span class="keyword" id="5581113">return</span>&nbsp;<span class="ident" id="5581120">t</span><span class="op" id="5581121">.</span><span class="ident" id="5581122">Name</span>&nbsp;<span class="op" id="5581127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5581130">func</span>&nbsp;<span class="op" id="5581135">(</span><span class="ident" id="5581136">t</span>&nbsp;<span class="op" id="5581138">*</span><span class="ident" id="5581139">CommonType</span><span class="op" id="5581149">)</span>&nbsp;<span class="ident" id="5581151">safeString</span><span class="op" id="5581161">(</span><span class="ident" id="5581162">seen</span>&nbsp;<span class="keyword" id="5581167">map</span><span class="op" id="5581170">[</span><span class="ident" id="5581171">typeId</span><span class="op" id="5581177">]</span><span class="builtintype" id="5581178">bool</span><span class="op" id="5581182">)</span>&nbsp;<span class="builtintype" id="5581184">string</span>&nbsp;<span class="op" id="5581191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5581194">return</span>&nbsp;<span class="ident" id="5581201">t</span><span class="op" id="5581202">.</span><span class="ident" id="5581203">Name</span><br>
<span class="lineno"></span><span class="op" id="5581208">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5581211">func</span>&nbsp;<span class="op" id="5581216">(</span><span class="ident" id="5581217">t</span>&nbsp;<span class="op" id="5581219">*</span><span class="ident" id="5581220">CommonType</span><span class="op" id="5581230">)</span>&nbsp;<span class="ident" id="5581232">name</span><span class="op" id="5581236">(</span><span class="op" id="5581237">)</span>&nbsp;<span class="builtintype" id="5581239">string</span>&nbsp;<span class="op" id="5581246">{</span>&nbsp;<span class="keyword" id="5581248">return</span>&nbsp;<span class="ident" id="5581255">t</span><span class="op" id="5581256">.</span><span class="ident" id="5581257">Name</span>&nbsp;<span class="op" id="5581262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5581265">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="5581302">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5581380">var</span>&nbsp;<span class="op" id="5581384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581387">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581439">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581493">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581544">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581555">=</span>&nbsp;<span class="ident" id="5581557">bootstrapType</span><span class="op" id="5581570">(</span><span class="string" id="5581571">&#34;bool&#34;</span><span class="op" id="5581577">,</span>&nbsp;<span class="op" id="5581579">(</span><span class="op" id="5581580">*</span><span class="builtintype" id="5581581">bool</span><span class="op" id="5581585">)</span><span class="op" id="5581586">(</span><span class="builtintype" id="5581587">nil</span><span class="op" id="5581590">)</span><span class="op" id="5581591">,</span>&nbsp;<span class="num" id="5581593">1</span><span class="op" id="5581594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581597">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581608">=</span>&nbsp;<span class="ident" id="5581610">bootstrapType</span><span class="op" id="5581623">(</span><span class="string" id="5581624">&#34;int&#34;</span><span class="op" id="5581629">,</span>&nbsp;<span class="op" id="5581631">(</span><span class="op" id="5581632">*</span><span class="builtintype" id="5581633">int</span><span class="op" id="5581636">)</span><span class="op" id="5581637">(</span><span class="builtintype" id="5581638">nil</span><span class="op" id="5581641">)</span><span class="op" id="5581642">,</span>&nbsp;<span class="num" id="5581644">2</span><span class="op" id="5581645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581648">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581659">=</span>&nbsp;<span class="ident" id="5581661">bootstrapType</span><span class="op" id="5581674">(</span><span class="string" id="5581675">&#34;uint&#34;</span><span class="op" id="5581681">,</span>&nbsp;<span class="op" id="5581683">(</span><span class="op" id="5581684">*</span><span class="builtintype" id="5581685">uint</span><span class="op" id="5581689">)</span><span class="op" id="5581690">(</span><span class="builtintype" id="5581691">nil</span><span class="op" id="5581694">)</span><span class="op" id="5581695">,</span>&nbsp;<span class="num" id="5581697">3</span><span class="op" id="5581698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581701">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581712">=</span>&nbsp;<span class="ident" id="5581714">bootstrapType</span><span class="op" id="5581727">(</span><span class="string" id="5581728">&#34;float&#34;</span><span class="op" id="5581735">,</span>&nbsp;<span class="op" id="5581737">(</span><span class="op" id="5581738">*</span><span class="builtintype" id="5581739">float64</span><span class="op" id="5581746">)</span><span class="op" id="5581747">(</span><span class="builtintype" id="5581748">nil</span><span class="op" id="5581751">)</span><span class="op" id="5581752">,</span>&nbsp;<span class="num" id="5581754">4</span><span class="op" id="5581755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581758">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581769">=</span>&nbsp;<span class="ident" id="5581771">bootstrapType</span><span class="op" id="5581784">(</span><span class="string" id="5581785">&#34;bytes&#34;</span><span class="op" id="5581792">,</span>&nbsp;<span class="op" id="5581794">(</span><span class="op" id="5581795">*</span><span class="op" id="5581796">[</span><span class="op" id="5581797">]</span><span class="builtintype" id="5581798">byte</span><span class="op" id="5581802">)</span><span class="op" id="5581803">(</span><span class="builtintype" id="5581804">nil</span><span class="op" id="5581807">)</span><span class="op" id="5581808">,</span>&nbsp;<span class="num" id="5581810">5</span><span class="op" id="5581811">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581814">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5581825">=</span>&nbsp;<span class="ident" id="5581827">bootstrapType</span><span class="op" id="5581840">(</span><span class="string" id="5581841">&#34;string&#34;</span><span class="op" id="5581849">,</span>&nbsp;<span class="op" id="5581851">(</span><span class="op" id="5581852">*</span><span class="builtintype" id="5581853">string</span><span class="op" id="5581859">)</span><span class="op" id="5581860">(</span><span class="builtintype" id="5581861">nil</span><span class="op" id="5581864">)</span><span class="op" id="5581865">,</span>&nbsp;<span class="num" id="5581867">6</span><span class="op" id="5581868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581871">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581882">=</span>&nbsp;<span class="ident" id="5581884">bootstrapType</span><span class="op" id="5581897">(</span><span class="string" id="5581898">&#34;complex&#34;</span><span class="op" id="5581907">,</span>&nbsp;<span class="op" id="5581909">(</span><span class="op" id="5581910">*</span><span class="builtintype" id="5581911">complex128</span><span class="op" id="5581921">)</span><span class="op" id="5581922">(</span><span class="builtintype" id="5581923">nil</span><span class="op" id="5581926">)</span><span class="op" id="5581927">,</span>&nbsp;<span class="num" id="5581929">7</span><span class="op" id="5581930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581933">tInterface</span>&nbsp;<span class="op" id="5581944">=</span>&nbsp;<span class="ident" id="5581946">bootstrapType</span><span class="op" id="5581959">(</span><span class="string" id="5581960">&#34;interface&#34;</span><span class="op" id="5581971">,</span>&nbsp;<span class="op" id="5581973">(</span><span class="op" id="5581974">*</span><span class="keyword" id="5581975">interface</span><span class="op" id="5581984">{</span><span class="op" id="5581985">}</span><span class="op" id="5581986">)</span><span class="op" id="5581987">(</span><span class="builtintype" id="5581988">nil</span><span class="op" id="5581991">)</span><span class="op" id="5581992">,</span>&nbsp;<span class="num" id="5581994">8</span><span class="op" id="5581995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581998">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582044">tReserved7</span>&nbsp;<span class="op" id="5582055">=</span>&nbsp;<span class="ident" id="5582057">bootstrapType</span><span class="op" id="5582070">(</span><span class="string" id="5582071">&#34;_reserved1&#34;</span><span class="op" id="5582083">,</span>&nbsp;<span class="op" id="5582085">(</span><span class="op" id="5582086">*</span><span class="keyword" id="5582087">struct</span><span class="op" id="5582093">{</span>&nbsp;<span class="ident" id="5582095">r7</span>&nbsp;<span class="builtintype" id="5582098">int</span>&nbsp;<span class="op" id="5582102">}</span><span class="op" id="5582103">)</span><span class="op" id="5582104">(</span><span class="builtintype" id="5582105">nil</span><span class="op" id="5582108">)</span><span class="op" id="5582109">,</span>&nbsp;<span class="num" id="5582111">9</span><span class="op" id="5582112">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582115">tReserved6</span>&nbsp;<span class="op" id="5582126">=</span>&nbsp;<span class="ident" id="5582128">bootstrapType</span><span class="op" id="5582141">(</span><span class="string" id="5582142">&#34;_reserved1&#34;</span><span class="op" id="5582154">,</span>&nbsp;<span class="op" id="5582156">(</span><span class="op" id="5582157">*</span><span class="keyword" id="5582158">struct</span><span class="op" id="5582164">{</span>&nbsp;<span class="ident" id="5582166">r6</span>&nbsp;<span class="builtintype" id="5582169">int</span>&nbsp;<span class="op" id="5582173">}</span><span class="op" id="5582174">)</span><span class="op" id="5582175">(</span><span class="builtintype" id="5582176">nil</span><span class="op" id="5582179">)</span><span class="op" id="5582180">,</span>&nbsp;<span class="num" id="5582182">10</span><span class="op" id="5582184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582187">tReserved5</span>&nbsp;<span class="op" id="5582198">=</span>&nbsp;<span class="ident" id="5582200">bootstrapType</span><span class="op" id="5582213">(</span><span class="string" id="5582214">&#34;_reserved1&#34;</span><span class="op" id="5582226">,</span>&nbsp;<span class="op" id="5582228">(</span><span class="op" id="5582229">*</span><span class="keyword" id="5582230">struct</span><span class="op" id="5582236">{</span>&nbsp;<span class="ident" id="5582238">r5</span>&nbsp;<span class="builtintype" id="5582241">int</span>&nbsp;<span class="op" id="5582245">}</span><span class="op" id="5582246">)</span><span class="op" id="5582247">(</span><span class="builtintype" id="5582248">nil</span><span class="op" id="5582251">)</span><span class="op" id="5582252">,</span>&nbsp;<span class="num" id="5582254">11</span><span class="op" id="5582256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582259">tReserved4</span>&nbsp;<span class="op" id="5582270">=</span>&nbsp;<span class="ident" id="5582272">bootstrapType</span><span class="op" id="5582285">(</span><span class="string" id="5582286">&#34;_reserved1&#34;</span><span class="op" id="5582298">,</span>&nbsp;<span class="op" id="5582300">(</span><span class="op" id="5582301">*</span><span class="keyword" id="5582302">struct</span><span class="op" id="5582308">{</span>&nbsp;<span class="ident" id="5582310">r4</span>&nbsp;<span class="builtintype" id="5582313">int</span>&nbsp;<span class="op" id="5582317">}</span><span class="op" id="5582318">)</span><span class="op" id="5582319">(</span><span class="builtintype" id="5582320">nil</span><span class="op" id="5582323">)</span><span class="op" id="5582324">,</span>&nbsp;<span class="num" id="5582326">12</span><span class="op" id="5582328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582331">tReserved3</span>&nbsp;<span class="op" id="5582342">=</span>&nbsp;<span class="ident" id="5582344">bootstrapType</span><span class="op" id="5582357">(</span><span class="string" id="5582358">&#34;_reserved1&#34;</span><span class="op" id="5582370">,</span>&nbsp;<span class="op" id="5582372">(</span><span class="op" id="5582373">*</span><span class="keyword" id="5582374">struct</span><span class="op" id="5582380">{</span>&nbsp;<span class="ident" id="5582382">r3</span>&nbsp;<span class="builtintype" id="5582385">int</span>&nbsp;<span class="op" id="5582389">}</span><span class="op" id="5582390">)</span><span class="op" id="5582391">(</span><span class="builtintype" id="5582392">nil</span><span class="op" id="5582395">)</span><span class="op" id="5582396">,</span>&nbsp;<span class="num" id="5582398">13</span><span class="op" id="5582400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582403">tReserved2</span>&nbsp;<span class="op" id="5582414">=</span>&nbsp;<span class="ident" id="5582416">bootstrapType</span><span class="op" id="5582429">(</span><span class="string" id="5582430">&#34;_reserved1&#34;</span><span class="op" id="5582442">,</span>&nbsp;<span class="op" id="5582444">(</span><span class="op" id="5582445">*</span><span class="keyword" id="5582446">struct</span><span class="op" id="5582452">{</span>&nbsp;<span class="ident" id="5582454">r2</span>&nbsp;<span class="builtintype" id="5582457">int</span>&nbsp;<span class="op" id="5582461">}</span><span class="op" id="5582462">)</span><span class="op" id="5582463">(</span><span class="builtintype" id="5582464">nil</span><span class="op" id="5582467">)</span><span class="op" id="5582468">,</span>&nbsp;<span class="num" id="5582470">14</span><span class="op" id="5582472">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582475">tReserved1</span>&nbsp;<span class="op" id="5582486">=</span>&nbsp;<span class="ident" id="5582488">bootstrapType</span><span class="op" id="5582501">(</span><span class="string" id="5582502">&#34;_reserved1&#34;</span><span class="op" id="5582514">,</span>&nbsp;<span class="op" id="5582516">(</span><span class="op" id="5582517">*</span><span class="keyword" id="5582518">struct</span><span class="op" id="5582524">{</span>&nbsp;<span class="ident" id="5582526">r1</span>&nbsp;<span class="builtintype" id="5582529">int</span>&nbsp;<span class="op" id="5582533">}</span><span class="op" id="5582534">)</span><span class="op" id="5582535">(</span><span class="builtintype" id="5582536">nil</span><span class="op" id="5582539">)</span><span class="op" id="5582540">,</span>&nbsp;<span class="num" id="5582542">15</span><span class="op" id="5582544">)</span><br>
<span class="lineno"></span><span class="op" id="5582546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5582549">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="5582598">var</span>&nbsp;<span class="ident" id="5582602">tWireType</span>&nbsp;<span class="op" id="5582612">=</span>&nbsp;<span class="ident" id="5582614">mustGetTypeInfo</span><span class="op" id="5582629">(</span><span class="ident" id="5582630">reflect</span><span class="op" id="5582637">.</span><span class="ident" id="5582638">TypeOf</span><span class="op" id="5582644">(</span><span class="ident" id="5582645">wireType</span><span class="op" id="5582653">{</span><span class="op" id="5582654">}</span><span class="op" id="5582655">)</span><span class="op" id="5582656">)</span><span class="op" id="5582657">.</span><span class="ident" id="5582658">id</span><br>
<span class="lineno">270</span><span class="keyword" id="5582661">var</span>&nbsp;<span class="ident" id="5582665">wireTypeUserInfo</span>&nbsp;<span class="op" id="5582682">*</span><span class="ident" id="5582683">userTypeInfo</span>&nbsp;<span class="comment" id="5582696">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5582728">func</span>&nbsp;<span class="ident" id="5582733">init</span><span class="op" id="5582737">(</span><span class="op" id="5582738">)</span>&nbsp;<span class="op" id="5582740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5582743">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582803">checkId</span><span class="op" id="5582810">(</span><span class="num" id="5582811">16</span><span class="op" id="5582813">,</span>&nbsp;<span class="ident" id="5582815">tWireType</span><span class="op" id="5582824">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582827">checkId</span><span class="op" id="5582834">(</span><span class="num" id="5582835">17</span><span class="op" id="5582837">,</span>&nbsp;<span class="ident" id="5582839">mustGetTypeInfo</span><span class="op" id="5582854">(</span><span class="ident" id="5582855">reflect</span><span class="op" id="5582862">.</span><span class="ident" id="5582863">TypeOf</span><span class="op" id="5582869">(</span><span class="ident" id="5582870">arrayType</span><span class="op" id="5582879">{</span><span class="op" id="5582880">}</span><span class="op" id="5582881">)</span><span class="op" id="5582882">)</span><span class="op" id="5582883">.</span><span class="ident" id="5582884">id</span><span class="op" id="5582886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582889">checkId</span><span class="op" id="5582896">(</span><span class="num" id="5582897">18</span><span class="op" id="5582899">,</span>&nbsp;<span class="ident" id="5582901">mustGetTypeInfo</span><span class="op" id="5582916">(</span><span class="ident" id="5582917">reflect</span><span class="op" id="5582924">.</span><span class="ident" id="5582925">TypeOf</span><span class="op" id="5582931">(</span><span class="ident" id="5582932">CommonType</span><span class="op" id="5582942">{</span><span class="op" id="5582943">}</span><span class="op" id="5582944">)</span><span class="op" id="5582945">)</span><span class="op" id="5582946">.</span><span class="ident" id="5582947">id</span><span class="op" id="5582949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582952">checkId</span><span class="op" id="5582959">(</span><span class="num" id="5582960">19</span><span class="op" id="5582962">,</span>&nbsp;<span class="ident" id="5582964">mustGetTypeInfo</span><span class="op" id="5582979">(</span><span class="ident" id="5582980">reflect</span><span class="op" id="5582987">.</span><span class="ident" id="5582988">TypeOf</span><span class="op" id="5582994">(</span><span class="ident" id="5582995">sliceType</span><span class="op" id="5583004">{</span><span class="op" id="5583005">}</span><span class="op" id="5583006">)</span><span class="op" id="5583007">)</span><span class="op" id="5583008">.</span><span class="ident" id="5583009">id</span><span class="op" id="5583011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583014">checkId</span><span class="op" id="5583021">(</span><span class="num" id="5583022">20</span><span class="op" id="5583024">,</span>&nbsp;<span class="ident" id="5583026">mustGetTypeInfo</span><span class="op" id="5583041">(</span><span class="ident" id="5583042">reflect</span><span class="op" id="5583049">.</span><span class="ident" id="5583050">TypeOf</span><span class="op" id="5583056">(</span><span class="ident" id="5583057">structType</span><span class="op" id="5583067">{</span><span class="op" id="5583068">}</span><span class="op" id="5583069">)</span><span class="op" id="5583070">)</span><span class="op" id="5583071">.</span><span class="ident" id="5583072">id</span><span class="op" id="5583074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583077">checkId</span><span class="op" id="5583084">(</span><span class="num" id="5583085">21</span><span class="op" id="5583087">,</span>&nbsp;<span class="ident" id="5583089">mustGetTypeInfo</span><span class="op" id="5583104">(</span><span class="ident" id="5583105">reflect</span><span class="op" id="5583112">.</span><span class="ident" id="5583113">TypeOf</span><span class="op" id="5583119">(</span><span class="ident" id="5583120">fieldType</span><span class="op" id="5583129">{</span><span class="op" id="5583130">}</span><span class="op" id="5583131">)</span><span class="op" id="5583132">)</span><span class="op" id="5583133">.</span><span class="ident" id="5583134">id</span><span class="op" id="5583136">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583139">checkId</span><span class="op" id="5583146">(</span><span class="num" id="5583147">23</span><span class="op" id="5583149">,</span>&nbsp;<span class="ident" id="5583151">mustGetTypeInfo</span><span class="op" id="5583166">(</span><span class="ident" id="5583167">reflect</span><span class="op" id="5583174">.</span><span class="ident" id="5583175">TypeOf</span><span class="op" id="5583181">(</span><span class="ident" id="5583182">mapType</span><span class="op" id="5583189">{</span><span class="op" id="5583190">}</span><span class="op" id="5583191">)</span><span class="op" id="5583192">)</span><span class="op" id="5583193">.</span><span class="ident" id="5583194">id</span><span class="op" id="5583196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583200">builtinIdToType</span>&nbsp;<span class="op" id="5583216">=</span>&nbsp;<span class="builtinfunc" id="5583218">make</span><span class="op" id="5583222">(</span><span class="keyword" id="5583223">map</span><span class="op" id="5583226">[</span><span class="ident" id="5583227">typeId</span><span class="op" id="5583233">]</span><span class="ident" id="5583234">gobType</span><span class="op" id="5583241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5583244">for</span>&nbsp;<span class="ident" id="5583248">k</span><span class="op" id="5583249">,</span>&nbsp;<span class="ident" id="5583251">v</span>&nbsp;<span class="op" id="5583253">:=</span>&nbsp;<span class="keyword" id="5583256">range</span>&nbsp;<span class="ident" id="5583262">idToType</span>&nbsp;<span class="op" id="5583271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583275">builtinIdToType</span><span class="op" id="5583290">[</span><span class="ident" id="5583291">k</span><span class="op" id="5583292">]</span>&nbsp;<span class="op" id="5583294">=</span>&nbsp;<span class="ident" id="5583296">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583303">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583377">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5583414">if</span>&nbsp;<span class="ident" id="5583417">nextId</span>&nbsp;<span class="op" id="5583424">&gt;</span>&nbsp;<span class="ident" id="5583426">firstUserId</span>&nbsp;<span class="op" id="5583438">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5583442">panic</span><span class="op" id="5583447">(</span><span class="ident" id="5583448">fmt</span><span class="op" id="5583451">.</span><span class="ident" id="5583452">Sprintln</span><span class="op" id="5583460">(</span><span class="string" id="5583461">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="5583480">,</span>&nbsp;<span class="ident" id="5583482">nextId</span><span class="op" id="5583488">)</span><span class="op" id="5583489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583495">nextId</span>&nbsp;<span class="op" id="5583502">=</span>&nbsp;<span class="ident" id="5583504">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583517">registerBasics</span><span class="op" id="5583531">(</span><span class="op" id="5583532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583535">wireTypeUserInfo</span>&nbsp;<span class="op" id="5583552">=</span>&nbsp;<span class="ident" id="5583554">userType</span><span class="op" id="5583562">(</span><span class="ident" id="5583563">reflect</span><span class="op" id="5583570">.</span><span class="ident" id="5583571">TypeOf</span><span class="op" id="5583577">(</span><span class="op" id="5583578">(</span><span class="op" id="5583579">*</span><span class="ident" id="5583580">wireType</span><span class="op" id="5583588">)</span><span class="op" id="5583589">(</span><span class="builtintype" id="5583590">nil</span><span class="op" id="5583593">)</span><span class="op" id="5583594">)</span><span class="op" id="5583595">)</span><br>
<span class="lineno">295</span><span class="op" id="5583597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5583600">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5583614">type</span>&nbsp;<span class="ident" id="5583619">arrayType</span>&nbsp;<span class="keyword" id="5583629">struct</span>&nbsp;<span class="op" id="5583636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583639">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583651">Elem</span>&nbsp;<span class="ident" id="5583656">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583664">Len</span>&nbsp;&nbsp;<span class="builtintype" id="5583669">int</span><br>
<span class="lineno"></span><span class="op" id="5583673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5583676">func</span>&nbsp;<span class="ident" id="5583681">newArrayType</span><span class="op" id="5583693">(</span><span class="ident" id="5583694">name</span>&nbsp;<span class="builtintype" id="5583699">string</span><span class="op" id="5583705">)</span>&nbsp;<span class="op" id="5583707">*</span><span class="ident" id="5583708">arrayType</span>&nbsp;<span class="op" id="5583718">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583721">a</span>&nbsp;<span class="op" id="5583723">:=</span>&nbsp;<span class="op" id="5583726">&amp;</span><span class="ident" id="5583727">arrayType</span><span class="op" id="5583736">{</span><span class="ident" id="5583737">CommonType</span><span class="op" id="5583747">{</span><span class="ident" id="5583748">Name</span><span class="op" id="5583752">:</span>&nbsp;<span class="ident" id="5583754">name</span><span class="op" id="5583758">}</span><span class="op" id="5583759">,</span>&nbsp;<span class="num" id="5583761">0</span><span class="op" id="5583762">,</span>&nbsp;<span class="num" id="5583764">0</span><span class="op" id="5583765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5583768">return</span>&nbsp;<span class="ident" id="5583775">a</span><br>
<span class="lineno"></span><span class="op" id="5583777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5583780">func</span>&nbsp;<span class="op" id="5583785">(</span><span class="ident" id="5583786">a</span>&nbsp;<span class="op" id="5583788">*</span><span class="ident" id="5583789">arrayType</span><span class="op" id="5583798">)</span>&nbsp;<span class="ident" id="5583800">init</span><span class="op" id="5583804">(</span><span class="ident" id="5583805">elem</span>&nbsp;<span class="ident" id="5583810">gobType</span><span class="op" id="5583817">,</span>&nbsp;<span class="builtinfunc" id="5583819">len</span>&nbsp;<span class="builtintype" id="5583823">int</span><span class="op" id="5583826">)</span>&nbsp;<span class="op" id="5583828">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583831">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583906">setTypeId</span><span class="op" id="5583915">(</span><span class="ident" id="5583916">a</span><span class="op" id="5583917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583920">a</span><span class="op" id="5583921">.</span><span class="ident" id="5583922">Elem</span>&nbsp;<span class="op" id="5583927">=</span>&nbsp;<span class="ident" id="5583929">elem</span><span class="op" id="5583933">.</span><span class="ident" id="5583934">id</span><span class="op" id="5583936">(</span><span class="op" id="5583937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583940">a</span><span class="op" id="5583941">.</span><span class="ident" id="5583942">Len</span>&nbsp;<span class="op" id="5583946">=</span>&nbsp;<span class="builtinfunc" id="5583948">len</span><br>
<span class="lineno"></span><span class="op" id="5583952">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5583955">func</span>&nbsp;<span class="op" id="5583960">(</span><span class="ident" id="5583961">a</span>&nbsp;<span class="op" id="5583963">*</span><span class="ident" id="5583964">arrayType</span><span class="op" id="5583973">)</span>&nbsp;<span class="ident" id="5583975">safeString</span><span class="op" id="5583985">(</span><span class="ident" id="5583986">seen</span>&nbsp;<span class="keyword" id="5583991">map</span><span class="op" id="5583994">[</span><span class="ident" id="5583995">typeId</span><span class="op" id="5584001">]</span><span class="builtintype" id="5584002">bool</span><span class="op" id="5584006">)</span>&nbsp;<span class="builtintype" id="5584008">string</span>&nbsp;<span class="op" id="5584015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584018">if</span>&nbsp;<span class="ident" id="5584021">seen</span><span class="op" id="5584025">[</span><span class="ident" id="5584026">a</span><span class="op" id="5584027">.</span><span class="ident" id="5584028">Id</span><span class="op" id="5584030">]</span>&nbsp;<span class="op" id="5584032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584036">return</span>&nbsp;<span class="ident" id="5584043">a</span><span class="op" id="5584044">.</span><span class="ident" id="5584045">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584051">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584054">seen</span><span class="op" id="5584058">[</span><span class="ident" id="5584059">a</span><span class="op" id="5584060">.</span><span class="ident" id="5584061">Id</span><span class="op" id="5584063">]</span>&nbsp;<span class="op" id="5584065">=</span>&nbsp;<span class="builtintype" id="5584067">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584073">return</span>&nbsp;<span class="ident" id="5584080">fmt</span><span class="op" id="5584083">.</span><span class="ident" id="5584084">Sprintf</span><span class="op" id="5584091">(</span><span class="string" id="5584092">&#34;[%d]%s&#34;</span><span class="op" id="5584100">,</span>&nbsp;<span class="ident" id="5584102">a</span><span class="op" id="5584103">.</span><span class="ident" id="5584104">Len</span><span class="op" id="5584107">,</span>&nbsp;<span class="ident" id="5584109">a</span><span class="op" id="5584110">.</span><span class="ident" id="5584111">Elem</span><span class="op" id="5584115">.</span><span class="ident" id="5584116">gobType</span><span class="op" id="5584123">(</span><span class="op" id="5584124">)</span><span class="op" id="5584125">.</span><span class="ident" id="5584126">safeString</span><span class="op" id="5584136">(</span><span class="ident" id="5584137">seen</span><span class="op" id="5584141">)</span><span class="op" id="5584142">)</span><br>
<span class="lineno"></span><span class="op" id="5584144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5584147">func</span>&nbsp;<span class="op" id="5584152">(</span><span class="ident" id="5584153">a</span>&nbsp;<span class="op" id="5584155">*</span><span class="ident" id="5584156">arrayType</span><span class="op" id="5584165">)</span>&nbsp;<span class="builtintype" id="5584167">string</span><span class="op" id="5584173">(</span><span class="op" id="5584174">)</span>&nbsp;<span class="builtintype" id="5584176">string</span>&nbsp;<span class="op" id="5584183">{</span>&nbsp;<span class="keyword" id="5584185">return</span>&nbsp;<span class="ident" id="5584192">a</span><span class="op" id="5584193">.</span><span class="ident" id="5584194">safeString</span><span class="op" id="5584204">(</span><span class="builtinfunc" id="5584205">make</span><span class="op" id="5584209">(</span><span class="keyword" id="5584210">map</span><span class="op" id="5584213">[</span><span class="ident" id="5584214">typeId</span><span class="op" id="5584220">]</span><span class="builtintype" id="5584221">bool</span><span class="op" id="5584225">)</span><span class="op" id="5584226">)</span>&nbsp;<span class="op" id="5584228">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5584231">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="5584303">type</span>&nbsp;<span class="ident" id="5584308">gobEncoderType</span>&nbsp;<span class="keyword" id="5584323">struct</span>&nbsp;<span class="op" id="5584330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584333">CommonType</span><br>
<span class="lineno"></span><span class="op" id="5584344">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5584347">func</span>&nbsp;<span class="ident" id="5584352">newGobEncoderType</span><span class="op" id="5584369">(</span><span class="ident" id="5584370">name</span>&nbsp;<span class="builtintype" id="5584375">string</span><span class="op" id="5584381">)</span>&nbsp;<span class="op" id="5584383">*</span><span class="ident" id="5584384">gobEncoderType</span>&nbsp;<span class="op" id="5584399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584402">g</span>&nbsp;<span class="op" id="5584404">:=</span>&nbsp;<span class="op" id="5584407">&amp;</span><span class="ident" id="5584408">gobEncoderType</span><span class="op" id="5584422">{</span><span class="ident" id="5584423">CommonType</span><span class="op" id="5584433">{</span><span class="ident" id="5584434">Name</span><span class="op" id="5584438">:</span>&nbsp;<span class="ident" id="5584440">name</span><span class="op" id="5584444">}</span><span class="op" id="5584445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584448">setTypeId</span><span class="op" id="5584457">(</span><span class="ident" id="5584458">g</span><span class="op" id="5584459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584462">return</span>&nbsp;<span class="ident" id="5584469">g</span><br>
<span class="lineno">335</span><span class="op" id="5584471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5584474">func</span>&nbsp;<span class="op" id="5584479">(</span><span class="ident" id="5584480">g</span>&nbsp;<span class="op" id="5584482">*</span><span class="ident" id="5584483">gobEncoderType</span><span class="op" id="5584497">)</span>&nbsp;<span class="ident" id="5584499">safeString</span><span class="op" id="5584509">(</span><span class="ident" id="5584510">seen</span>&nbsp;<span class="keyword" id="5584515">map</span><span class="op" id="5584518">[</span><span class="ident" id="5584519">typeId</span><span class="op" id="5584525">]</span><span class="builtintype" id="5584526">bool</span><span class="op" id="5584530">)</span>&nbsp;<span class="builtintype" id="5584532">string</span>&nbsp;<span class="op" id="5584539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584542">return</span>&nbsp;<span class="ident" id="5584549">g</span><span class="op" id="5584550">.</span><span class="ident" id="5584551">Name</span><br>
<span class="lineno"></span><span class="op" id="5584556">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="5584559">func</span>&nbsp;<span class="op" id="5584564">(</span><span class="ident" id="5584565">g</span>&nbsp;<span class="op" id="5584567">*</span><span class="ident" id="5584568">gobEncoderType</span><span class="op" id="5584582">)</span>&nbsp;<span class="builtintype" id="5584584">string</span><span class="op" id="5584590">(</span><span class="op" id="5584591">)</span>&nbsp;<span class="builtintype" id="5584593">string</span>&nbsp;<span class="op" id="5584600">{</span>&nbsp;<span class="keyword" id="5584602">return</span>&nbsp;<span class="ident" id="5584609">g</span><span class="op" id="5584610">.</span><span class="ident" id="5584611">Name</span>&nbsp;<span class="op" id="5584616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5584619">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5584631">type</span>&nbsp;<span class="ident" id="5584636">mapType</span>&nbsp;<span class="keyword" id="5584644">struct</span>&nbsp;<span class="op" id="5584651">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584654">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584666">Key</span>&nbsp;&nbsp;<span class="ident" id="5584671">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584679">Elem</span>&nbsp;<span class="ident" id="5584684">typeId</span><br>
<span class="lineno"></span><span class="op" id="5584691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5584694">func</span>&nbsp;<span class="ident" id="5584699">newMapType</span><span class="op" id="5584709">(</span><span class="ident" id="5584710">name</span>&nbsp;<span class="builtintype" id="5584715">string</span><span class="op" id="5584721">)</span>&nbsp;<span class="op" id="5584723">*</span><span class="ident" id="5584724">mapType</span>&nbsp;<span class="op" id="5584732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584735">m</span>&nbsp;<span class="op" id="5584737">:=</span>&nbsp;<span class="op" id="5584740">&amp;</span><span class="ident" id="5584741">mapType</span><span class="op" id="5584748">{</span><span class="ident" id="5584749">CommonType</span><span class="op" id="5584759">{</span><span class="ident" id="5584760">Name</span><span class="op" id="5584764">:</span>&nbsp;<span class="ident" id="5584766">name</span><span class="op" id="5584770">}</span><span class="op" id="5584771">,</span>&nbsp;<span class="num" id="5584773">0</span><span class="op" id="5584774">,</span>&nbsp;<span class="num" id="5584776">0</span><span class="op" id="5584777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584780">return</span>&nbsp;<span class="ident" id="5584787">m</span><br>
<span class="lineno"></span><span class="op" id="5584789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5584792">func</span>&nbsp;<span class="op" id="5584797">(</span><span class="ident" id="5584798">m</span>&nbsp;<span class="op" id="5584800">*</span><span class="ident" id="5584801">mapType</span><span class="op" id="5584808">)</span>&nbsp;<span class="ident" id="5584810">init</span><span class="op" id="5584814">(</span><span class="ident" id="5584815">key</span><span class="op" id="5584818">,</span>&nbsp;<span class="ident" id="5584820">elem</span>&nbsp;<span class="ident" id="5584825">gobType</span><span class="op" id="5584832">)</span>&nbsp;<span class="op" id="5584834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584837">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584912">setTypeId</span><span class="op" id="5584921">(</span><span class="ident" id="5584922">m</span><span class="op" id="5584923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584926">m</span><span class="op" id="5584927">.</span><span class="ident" id="5584928">Key</span>&nbsp;<span class="op" id="5584932">=</span>&nbsp;<span class="ident" id="5584934">key</span><span class="op" id="5584937">.</span><span class="ident" id="5584938">id</span><span class="op" id="5584940">(</span><span class="op" id="5584941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584944">m</span><span class="op" id="5584945">.</span><span class="ident" id="5584946">Elem</span>&nbsp;<span class="op" id="5584951">=</span>&nbsp;<span class="ident" id="5584953">elem</span><span class="op" id="5584957">.</span><span class="ident" id="5584958">id</span><span class="op" id="5584960">(</span><span class="op" id="5584961">)</span><br>
<span class="lineno">360</span><span class="op" id="5584963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5584966">func</span>&nbsp;<span class="op" id="5584971">(</span><span class="ident" id="5584972">m</span>&nbsp;<span class="op" id="5584974">*</span><span class="ident" id="5584975">mapType</span><span class="op" id="5584982">)</span>&nbsp;<span class="ident" id="5584984">safeString</span><span class="op" id="5584994">(</span><span class="ident" id="5584995">seen</span>&nbsp;<span class="keyword" id="5585000">map</span><span class="op" id="5585003">[</span><span class="ident" id="5585004">typeId</span><span class="op" id="5585010">]</span><span class="builtintype" id="5585011">bool</span><span class="op" id="5585015">)</span>&nbsp;<span class="builtintype" id="5585017">string</span>&nbsp;<span class="op" id="5585024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585027">if</span>&nbsp;<span class="ident" id="5585030">seen</span><span class="op" id="5585034">[</span><span class="ident" id="5585035">m</span><span class="op" id="5585036">.</span><span class="ident" id="5585037">Id</span><span class="op" id="5585039">]</span>&nbsp;<span class="op" id="5585041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585045">return</span>&nbsp;<span class="ident" id="5585052">m</span><span class="op" id="5585053">.</span><span class="ident" id="5585054">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585063">seen</span><span class="op" id="5585067">[</span><span class="ident" id="5585068">m</span><span class="op" id="5585069">.</span><span class="ident" id="5585070">Id</span><span class="op" id="5585072">]</span>&nbsp;<span class="op" id="5585074">=</span>&nbsp;<span class="builtintype" id="5585076">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585082">key</span>&nbsp;<span class="op" id="5585086">:=</span>&nbsp;<span class="ident" id="5585089">m</span><span class="op" id="5585090">.</span><span class="ident" id="5585091">Key</span><span class="op" id="5585094">.</span><span class="ident" id="5585095">gobType</span><span class="op" id="5585102">(</span><span class="op" id="5585103">)</span><span class="op" id="5585104">.</span><span class="ident" id="5585105">safeString</span><span class="op" id="5585115">(</span><span class="ident" id="5585116">seen</span><span class="op" id="5585120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585123">elem</span>&nbsp;<span class="op" id="5585128">:=</span>&nbsp;<span class="ident" id="5585131">m</span><span class="op" id="5585132">.</span><span class="ident" id="5585133">Elem</span><span class="op" id="5585137">.</span><span class="ident" id="5585138">gobType</span><span class="op" id="5585145">(</span><span class="op" id="5585146">)</span><span class="op" id="5585147">.</span><span class="ident" id="5585148">safeString</span><span class="op" id="5585158">(</span><span class="ident" id="5585159">seen</span><span class="op" id="5585163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585166">return</span>&nbsp;<span class="ident" id="5585173">fmt</span><span class="op" id="5585176">.</span><span class="ident" id="5585177">Sprintf</span><span class="op" id="5585184">(</span><span class="string" id="5585185">&#34;map[%s]%s&#34;</span><span class="op" id="5585196">,</span>&nbsp;<span class="ident" id="5585198">key</span><span class="op" id="5585201">,</span>&nbsp;<span class="ident" id="5585203">elem</span><span class="op" id="5585207">)</span><br>
<span class="lineno">370</span><span class="op" id="5585209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5585212">func</span>&nbsp;<span class="op" id="5585217">(</span><span class="ident" id="5585218">m</span>&nbsp;<span class="op" id="5585220">*</span><span class="ident" id="5585221">mapType</span><span class="op" id="5585228">)</span>&nbsp;<span class="builtintype" id="5585230">string</span><span class="op" id="5585236">(</span><span class="op" id="5585237">)</span>&nbsp;<span class="builtintype" id="5585239">string</span>&nbsp;<span class="op" id="5585246">{</span>&nbsp;<span class="keyword" id="5585248">return</span>&nbsp;<span class="ident" id="5585255">m</span><span class="op" id="5585256">.</span><span class="ident" id="5585257">safeString</span><span class="op" id="5585267">(</span><span class="builtinfunc" id="5585268">make</span><span class="op" id="5585272">(</span><span class="keyword" id="5585273">map</span><span class="op" id="5585276">[</span><span class="ident" id="5585277">typeId</span><span class="op" id="5585283">]</span><span class="builtintype" id="5585284">bool</span><span class="op" id="5585288">)</span><span class="op" id="5585289">)</span>&nbsp;<span class="op" id="5585291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585294">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="5585308">type</span>&nbsp;<span class="ident" id="5585313">sliceType</span>&nbsp;<span class="keyword" id="5585323">struct</span>&nbsp;<span class="op" id="5585330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585333">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585345">Elem</span>&nbsp;<span class="ident" id="5585350">typeId</span><br>
<span class="lineno"></span><span class="op" id="5585357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5585360">func</span>&nbsp;<span class="ident" id="5585365">newSliceType</span><span class="op" id="5585377">(</span><span class="ident" id="5585378">name</span>&nbsp;<span class="builtintype" id="5585383">string</span><span class="op" id="5585389">)</span>&nbsp;<span class="op" id="5585391">*</span><span class="ident" id="5585392">sliceType</span>&nbsp;<span class="op" id="5585402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585405">s</span>&nbsp;<span class="op" id="5585407">:=</span>&nbsp;<span class="op" id="5585410">&amp;</span><span class="ident" id="5585411">sliceType</span><span class="op" id="5585420">{</span><span class="ident" id="5585421">CommonType</span><span class="op" id="5585431">{</span><span class="ident" id="5585432">Name</span><span class="op" id="5585436">:</span>&nbsp;<span class="ident" id="5585438">name</span><span class="op" id="5585442">}</span><span class="op" id="5585443">,</span>&nbsp;<span class="num" id="5585445">0</span><span class="op" id="5585446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585449">return</span>&nbsp;<span class="ident" id="5585456">s</span><br>
<span class="lineno"></span><span class="op" id="5585458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5585461">func</span>&nbsp;<span class="op" id="5585466">(</span><span class="ident" id="5585467">s</span>&nbsp;<span class="op" id="5585469">*</span><span class="ident" id="5585470">sliceType</span><span class="op" id="5585479">)</span>&nbsp;<span class="ident" id="5585481">init</span><span class="op" id="5585485">(</span><span class="ident" id="5585486">elem</span>&nbsp;<span class="ident" id="5585491">gobType</span><span class="op" id="5585498">)</span>&nbsp;<span class="op" id="5585500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585503">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585578">setTypeId</span><span class="op" id="5585587">(</span><span class="ident" id="5585588">s</span><span class="op" id="5585589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585592">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5585657">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585692">if</span>&nbsp;<span class="ident" id="5585695">elem</span><span class="op" id="5585699">.</span><span class="ident" id="5585700">id</span><span class="op" id="5585702">(</span><span class="op" id="5585703">)</span>&nbsp;<span class="op" id="5585705">==</span>&nbsp;<span class="num" id="5585708">0</span>&nbsp;<span class="op" id="5585710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585714">setTypeId</span><span class="op" id="5585723">(</span><span class="ident" id="5585724">elem</span><span class="op" id="5585728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585734">s</span><span class="op" id="5585735">.</span><span class="ident" id="5585736">Elem</span>&nbsp;<span class="op" id="5585741">=</span>&nbsp;<span class="ident" id="5585743">elem</span><span class="op" id="5585747">.</span><span class="ident" id="5585748">id</span><span class="op" id="5585750">(</span><span class="op" id="5585751">)</span><br>
<span class="lineno"></span><span class="op" id="5585753">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5585756">func</span>&nbsp;<span class="op" id="5585761">(</span><span class="ident" id="5585762">s</span>&nbsp;<span class="op" id="5585764">*</span><span class="ident" id="5585765">sliceType</span><span class="op" id="5585774">)</span>&nbsp;<span class="ident" id="5585776">safeString</span><span class="op" id="5585786">(</span><span class="ident" id="5585787">seen</span>&nbsp;<span class="keyword" id="5585792">map</span><span class="op" id="5585795">[</span><span class="ident" id="5585796">typeId</span><span class="op" id="5585802">]</span><span class="builtintype" id="5585803">bool</span><span class="op" id="5585807">)</span>&nbsp;<span class="builtintype" id="5585809">string</span>&nbsp;<span class="op" id="5585816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585819">if</span>&nbsp;<span class="ident" id="5585822">seen</span><span class="op" id="5585826">[</span><span class="ident" id="5585827">s</span><span class="op" id="5585828">.</span><span class="ident" id="5585829">Id</span><span class="op" id="5585831">]</span>&nbsp;<span class="op" id="5585833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585837">return</span>&nbsp;<span class="ident" id="5585844">s</span><span class="op" id="5585845">.</span><span class="ident" id="5585846">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585852">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585855">seen</span><span class="op" id="5585859">[</span><span class="ident" id="5585860">s</span><span class="op" id="5585861">.</span><span class="ident" id="5585862">Id</span><span class="op" id="5585864">]</span>&nbsp;<span class="op" id="5585866">=</span>&nbsp;<span class="builtintype" id="5585868">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585874">return</span>&nbsp;<span class="ident" id="5585881">fmt</span><span class="op" id="5585884">.</span><span class="ident" id="5585885">Sprintf</span><span class="op" id="5585892">(</span><span class="string" id="5585893">&#34;[]%s&#34;</span><span class="op" id="5585899">,</span>&nbsp;<span class="ident" id="5585901">s</span><span class="op" id="5585902">.</span><span class="ident" id="5585903">Elem</span><span class="op" id="5585907">.</span><span class="ident" id="5585908">gobType</span><span class="op" id="5585915">(</span><span class="op" id="5585916">)</span><span class="op" id="5585917">.</span><span class="ident" id="5585918">safeString</span><span class="op" id="5585928">(</span><span class="ident" id="5585929">seen</span><span class="op" id="5585933">)</span><span class="op" id="5585934">)</span><br>
<span class="lineno"></span><span class="op" id="5585936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5585939">func</span>&nbsp;<span class="op" id="5585944">(</span><span class="ident" id="5585945">s</span>&nbsp;<span class="op" id="5585947">*</span><span class="ident" id="5585948">sliceType</span><span class="op" id="5585957">)</span>&nbsp;<span class="builtintype" id="5585959">string</span><span class="op" id="5585965">(</span><span class="op" id="5585966">)</span>&nbsp;<span class="builtintype" id="5585968">string</span>&nbsp;<span class="op" id="5585975">{</span>&nbsp;<span class="keyword" id="5585977">return</span>&nbsp;<span class="ident" id="5585984">s</span><span class="op" id="5585985">.</span><span class="ident" id="5585986">safeString</span><span class="op" id="5585996">(</span><span class="builtinfunc" id="5585997">make</span><span class="op" id="5586001">(</span><span class="keyword" id="5586002">map</span><span class="op" id="5586005">[</span><span class="ident" id="5586006">typeId</span><span class="op" id="5586012">]</span><span class="builtintype" id="5586013">bool</span><span class="op" id="5586017">)</span><span class="op" id="5586018">)</span>&nbsp;<span class="op" id="5586020">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5586023">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5586038">type</span>&nbsp;<span class="ident" id="5586043">fieldType</span>&nbsp;<span class="keyword" id="5586053">struct</span>&nbsp;<span class="op" id="5586060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586063">Name</span>&nbsp;<span class="builtintype" id="5586068">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586076">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5586081">typeId</span><br>
<span class="lineno">410</span><span class="op" id="5586088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5586091">type</span>&nbsp;<span class="ident" id="5586096">structType</span>&nbsp;<span class="keyword" id="5586107">struct</span>&nbsp;<span class="op" id="5586114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586117">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586129">Field</span>&nbsp;<span class="op" id="5586135">[</span><span class="op" id="5586136">]</span><span class="op" id="5586137">*</span><span class="ident" id="5586138">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="5586148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5586151">func</span>&nbsp;<span class="op" id="5586156">(</span><span class="ident" id="5586157">s</span>&nbsp;<span class="op" id="5586159">*</span><span class="ident" id="5586160">structType</span><span class="op" id="5586170">)</span>&nbsp;<span class="ident" id="5586172">safeString</span><span class="op" id="5586182">(</span><span class="ident" id="5586183">seen</span>&nbsp;<span class="keyword" id="5586188">map</span><span class="op" id="5586191">[</span><span class="ident" id="5586192">typeId</span><span class="op" id="5586198">]</span><span class="builtintype" id="5586199">bool</span><span class="op" id="5586203">)</span>&nbsp;<span class="builtintype" id="5586205">string</span>&nbsp;<span class="op" id="5586212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586215">if</span>&nbsp;<span class="ident" id="5586218">s</span>&nbsp;<span class="op" id="5586220">==</span>&nbsp;<span class="builtintype" id="5586223">nil</span>&nbsp;<span class="op" id="5586227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586231">return</span>&nbsp;<span class="string" id="5586238">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586250">if</span>&nbsp;<span class="ident" id="5586253">_</span><span class="op" id="5586254">,</span>&nbsp;<span class="ident" id="5586256">ok</span>&nbsp;<span class="op" id="5586259">:=</span>&nbsp;<span class="ident" id="5586262">seen</span><span class="op" id="5586266">[</span><span class="ident" id="5586267">s</span><span class="op" id="5586268">.</span><span class="ident" id="5586269">Id</span><span class="op" id="5586271">]</span><span class="op" id="5586272">;</span>&nbsp;<span class="ident" id="5586274">ok</span>&nbsp;<span class="op" id="5586277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586281">return</span>&nbsp;<span class="ident" id="5586288">s</span><span class="op" id="5586289">.</span><span class="ident" id="5586290">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586299">seen</span><span class="op" id="5586303">[</span><span class="ident" id="5586304">s</span><span class="op" id="5586305">.</span><span class="ident" id="5586306">Id</span><span class="op" id="5586308">]</span>&nbsp;<span class="op" id="5586310">=</span>&nbsp;<span class="builtintype" id="5586312">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586318">str</span>&nbsp;<span class="op" id="5586322">:=</span>&nbsp;<span class="ident" id="5586325">s</span><span class="op" id="5586326">.</span><span class="ident" id="5586327">Name</span>&nbsp;<span class="op" id="5586332">+</span>&nbsp;<span class="string" id="5586334">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586350">for</span>&nbsp;<span class="ident" id="5586354">_</span><span class="op" id="5586355">,</span>&nbsp;<span class="ident" id="5586357">f</span>&nbsp;<span class="op" id="5586359">:=</span>&nbsp;<span class="keyword" id="5586362">range</span>&nbsp;<span class="ident" id="5586368">s</span><span class="op" id="5586369">.</span><span class="ident" id="5586370">Field</span>&nbsp;<span class="op" id="5586376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586380">str</span>&nbsp;<span class="op" id="5586384">+=</span>&nbsp;<span class="ident" id="5586387">fmt</span><span class="op" id="5586390">.</span><span class="ident" id="5586391">Sprintf</span><span class="op" id="5586398">(</span><span class="string" id="5586399">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="5586408">,</span>&nbsp;<span class="ident" id="5586410">f</span><span class="op" id="5586411">.</span><span class="ident" id="5586412">Name</span><span class="op" id="5586416">,</span>&nbsp;<span class="ident" id="5586418">f</span><span class="op" id="5586419">.</span><span class="ident" id="5586420">Id</span><span class="op" id="5586422">.</span><span class="ident" id="5586423">gobType</span><span class="op" id="5586430">(</span><span class="op" id="5586431">)</span><span class="op" id="5586432">.</span><span class="ident" id="5586433">safeString</span><span class="op" id="5586443">(</span><span class="ident" id="5586444">seen</span><span class="op" id="5586448">)</span><span class="op" id="5586449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586455">str</span>&nbsp;<span class="op" id="5586459">+=</span>&nbsp;<span class="string" id="5586462">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586467">return</span>&nbsp;<span class="ident" id="5586474">str</span><br>
<span class="lineno"></span><span class="op" id="5586478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5586481">func</span>&nbsp;<span class="op" id="5586486">(</span><span class="ident" id="5586487">s</span>&nbsp;<span class="op" id="5586489">*</span><span class="ident" id="5586490">structType</span><span class="op" id="5586500">)</span>&nbsp;<span class="builtintype" id="5586502">string</span><span class="op" id="5586508">(</span><span class="op" id="5586509">)</span>&nbsp;<span class="builtintype" id="5586511">string</span>&nbsp;<span class="op" id="5586518">{</span>&nbsp;<span class="keyword" id="5586520">return</span>&nbsp;<span class="ident" id="5586527">s</span><span class="op" id="5586528">.</span><span class="ident" id="5586529">safeString</span><span class="op" id="5586539">(</span><span class="builtinfunc" id="5586540">make</span><span class="op" id="5586544">(</span><span class="keyword" id="5586545">map</span><span class="op" id="5586548">[</span><span class="ident" id="5586549">typeId</span><span class="op" id="5586555">]</span><span class="builtintype" id="5586556">bool</span><span class="op" id="5586560">)</span><span class="op" id="5586561">)</span>&nbsp;<span class="op" id="5586563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5586566">func</span>&nbsp;<span class="ident" id="5586571">newStructType</span><span class="op" id="5586584">(</span><span class="ident" id="5586585">name</span>&nbsp;<span class="builtintype" id="5586590">string</span><span class="op" id="5586596">)</span>&nbsp;<span class="op" id="5586598">*</span><span class="ident" id="5586599">structType</span>&nbsp;<span class="op" id="5586610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586613">s</span>&nbsp;<span class="op" id="5586615">:=</span>&nbsp;<span class="op" id="5586618">&amp;</span><span class="ident" id="5586619">structType</span><span class="op" id="5586629">{</span><span class="ident" id="5586630">CommonType</span><span class="op" id="5586640">{</span><span class="ident" id="5586641">Name</span><span class="op" id="5586645">:</span>&nbsp;<span class="ident" id="5586647">name</span><span class="op" id="5586651">}</span><span class="op" id="5586652">,</span>&nbsp;<span class="builtintype" id="5586654">nil</span><span class="op" id="5586657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586660">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586724">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586774">setTypeId</span><span class="op" id="5586783">(</span><span class="ident" id="5586784">s</span><span class="op" id="5586785">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586788">return</span>&nbsp;<span class="ident" id="5586795">s</span><br>
<span class="lineno"></span><span class="op" id="5586797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586800">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5586865">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="5586930">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="5586940">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="5587005">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="5587055">func</span>&nbsp;<span class="ident" id="5587060">newTypeObject</span><span class="op" id="5587073">(</span><span class="ident" id="5587074">name</span>&nbsp;<span class="builtintype" id="5587079">string</span><span class="op" id="5587085">,</span>&nbsp;<span class="ident" id="5587087">ut</span>&nbsp;<span class="op" id="5587090">*</span><span class="ident" id="5587091">userTypeInfo</span><span class="op" id="5587103">,</span>&nbsp;<span class="ident" id="5587105">rt</span>&nbsp;<span class="ident" id="5587108">reflect</span><span class="op" id="5587115">.</span><span class="ident" id="5587116">Type</span><span class="op" id="5587120">)</span>&nbsp;<span class="op" id="5587122">(</span><span class="ident" id="5587123">gobType</span><span class="op" id="5587130">,</span>&nbsp;<span class="builtintype" id="5587132">error</span><span class="op" id="5587137">)</span>&nbsp;<span class="op" id="5587139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587142">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587183">if</span>&nbsp;<span class="ident" id="5587186">ut</span><span class="op" id="5587188">.</span><span class="ident" id="5587189">externalEnc</span>&nbsp;<span class="op" id="5587201">!=</span>&nbsp;<span class="num" id="5587204">0</span>&nbsp;<span class="op" id="5587206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587210">return</span>&nbsp;<span class="ident" id="5587217">newGobEncoderType</span><span class="op" id="5587234">(</span><span class="ident" id="5587235">name</span><span class="op" id="5587239">)</span><span class="op" id="5587240">,</span>&nbsp;<span class="builtintype" id="5587242">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587250">var</span>&nbsp;<span class="ident" id="5587254">err</span>&nbsp;<span class="builtintype" id="5587258">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587265">var</span>&nbsp;<span class="ident" id="5587269">type0</span><span class="op" id="5587274">,</span>&nbsp;<span class="ident" id="5587276">type1</span>&nbsp;<span class="ident" id="5587282">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587291">defer</span>&nbsp;<span class="keyword" id="5587297">func</span><span class="op" id="5587301">(</span><span class="op" id="5587302">)</span>&nbsp;<span class="op" id="5587304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587308">if</span>&nbsp;<span class="ident" id="5587311">err</span>&nbsp;<span class="op" id="5587315">!=</span>&nbsp;<span class="builtintype" id="5587318">nil</span>&nbsp;<span class="op" id="5587322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5587327">delete</span><span class="op" id="5587333">(</span><span class="ident" id="5587334">types</span><span class="op" id="5587339">,</span>&nbsp;<span class="ident" id="5587341">rt</span><span class="op" id="5587343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587350">}</span><span class="op" id="5587351">(</span><span class="op" id="5587352">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587355">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587426">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587484">switch</span>&nbsp;<span class="ident" id="5587491">t</span>&nbsp;<span class="op" id="5587493">:=</span>&nbsp;<span class="ident" id="5587496">rt</span><span class="op" id="5587498">;</span>&nbsp;<span class="ident" id="5587500">t</span><span class="op" id="5587501">.</span><span class="ident" id="5587502">Kind</span><span class="op" id="5587506">(</span><span class="op" id="5587507">)</span>&nbsp;<span class="op" id="5587509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587512">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587563">case</span>&nbsp;<span class="ident" id="5587568">reflect</span><span class="op" id="5587575">.</span><span class="ident" id="5587576">Bool</span><span class="op" id="5587580">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587584">return</span>&nbsp;<span class="ident" id="5587591">tBool</span><span class="op" id="5587596">.</span><span class="ident" id="5587597">gobType</span><span class="op" id="5587604">(</span><span class="op" id="5587605">)</span><span class="op" id="5587606">,</span>&nbsp;<span class="builtintype" id="5587608">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587614">case</span>&nbsp;<span class="ident" id="5587619">reflect</span><span class="op" id="5587626">.</span><span class="ident" id="5587627">Int</span><span class="op" id="5587630">,</span>&nbsp;<span class="ident" id="5587632">reflect</span><span class="op" id="5587639">.</span><span class="ident" id="5587640">Int8</span><span class="op" id="5587644">,</span>&nbsp;<span class="ident" id="5587646">reflect</span><span class="op" id="5587653">.</span><span class="ident" id="5587654">Int16</span><span class="op" id="5587659">,</span>&nbsp;<span class="ident" id="5587661">reflect</span><span class="op" id="5587668">.</span><span class="ident" id="5587669">Int32</span><span class="op" id="5587674">,</span>&nbsp;<span class="ident" id="5587676">reflect</span><span class="op" id="5587683">.</span><span class="ident" id="5587684">Int64</span><span class="op" id="5587689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587693">return</span>&nbsp;<span class="ident" id="5587700">tInt</span><span class="op" id="5587704">.</span><span class="ident" id="5587705">gobType</span><span class="op" id="5587712">(</span><span class="op" id="5587713">)</span><span class="op" id="5587714">,</span>&nbsp;<span class="builtintype" id="5587716">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587722">case</span>&nbsp;<span class="ident" id="5587727">reflect</span><span class="op" id="5587734">.</span><span class="ident" id="5587735">Uint</span><span class="op" id="5587739">,</span>&nbsp;<span class="ident" id="5587741">reflect</span><span class="op" id="5587748">.</span><span class="ident" id="5587749">Uint8</span><span class="op" id="5587754">,</span>&nbsp;<span class="ident" id="5587756">reflect</span><span class="op" id="5587763">.</span><span class="ident" id="5587764">Uint16</span><span class="op" id="5587770">,</span>&nbsp;<span class="ident" id="5587772">reflect</span><span class="op" id="5587779">.</span><span class="ident" id="5587780">Uint32</span><span class="op" id="5587786">,</span>&nbsp;<span class="ident" id="5587788">reflect</span><span class="op" id="5587795">.</span><span class="ident" id="5587796">Uint64</span><span class="op" id="5587802">,</span>&nbsp;<span class="ident" id="5587804">reflect</span><span class="op" id="5587811">.</span><span class="ident" id="5587812">Uintptr</span><span class="op" id="5587819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587823">return</span>&nbsp;<span class="ident" id="5587830">tUint</span><span class="op" id="5587835">.</span><span class="ident" id="5587836">gobType</span><span class="op" id="5587843">(</span><span class="op" id="5587844">)</span><span class="op" id="5587845">,</span>&nbsp;<span class="builtintype" id="5587847">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587853">case</span>&nbsp;<span class="ident" id="5587858">reflect</span><span class="op" id="5587865">.</span><span class="ident" id="5587866">Float32</span><span class="op" id="5587873">,</span>&nbsp;<span class="ident" id="5587875">reflect</span><span class="op" id="5587882">.</span><span class="ident" id="5587883">Float64</span><span class="op" id="5587890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587894">return</span>&nbsp;<span class="ident" id="5587901">tFloat</span><span class="op" id="5587907">.</span><span class="ident" id="5587908">gobType</span><span class="op" id="5587915">(</span><span class="op" id="5587916">)</span><span class="op" id="5587917">,</span>&nbsp;<span class="builtintype" id="5587919">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587925">case</span>&nbsp;<span class="ident" id="5587930">reflect</span><span class="op" id="5587937">.</span><span class="ident" id="5587938">Complex64</span><span class="op" id="5587947">,</span>&nbsp;<span class="ident" id="5587949">reflect</span><span class="op" id="5587956">.</span><span class="ident" id="5587957">Complex128</span><span class="op" id="5587967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587971">return</span>&nbsp;<span class="ident" id="5587978">tComplex</span><span class="op" id="5587986">.</span><span class="ident" id="5587987">gobType</span><span class="op" id="5587994">(</span><span class="op" id="5587995">)</span><span class="op" id="5587996">,</span>&nbsp;<span class="builtintype" id="5587998">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588004">case</span>&nbsp;<span class="ident" id="5588009">reflect</span><span class="op" id="5588016">.</span><span class="ident" id="5588017">String</span><span class="op" id="5588023">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588027">return</span>&nbsp;<span class="ident" id="5588034">tString</span><span class="op" id="5588041">.</span><span class="ident" id="5588042">gobType</span><span class="op" id="5588049">(</span><span class="op" id="5588050">)</span><span class="op" id="5588051">,</span>&nbsp;<span class="builtintype" id="5588053">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588059">case</span>&nbsp;<span class="ident" id="5588064">reflect</span><span class="op" id="5588071">.</span><span class="ident" id="5588072">Interface</span><span class="op" id="5588081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588085">return</span>&nbsp;<span class="ident" id="5588092">tInterface</span><span class="op" id="5588102">.</span><span class="ident" id="5588103">gobType</span><span class="op" id="5588110">(</span><span class="op" id="5588111">)</span><span class="op" id="5588112">,</span>&nbsp;<span class="builtintype" id="5588114">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588120">case</span>&nbsp;<span class="ident" id="5588125">reflect</span><span class="op" id="5588132">.</span><span class="ident" id="5588133">Array</span><span class="op" id="5588138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588142">at</span>&nbsp;<span class="op" id="5588145">:=</span>&nbsp;<span class="ident" id="5588148">newArrayType</span><span class="op" id="5588160">(</span><span class="ident" id="5588161">name</span><span class="op" id="5588165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588169">types</span><span class="op" id="5588174">[</span><span class="ident" id="5588175">rt</span><span class="op" id="5588177">]</span>&nbsp;<span class="op" id="5588179">=</span>&nbsp;<span class="ident" id="5588181">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588186">type0</span><span class="op" id="5588191">,</span>&nbsp;<span class="ident" id="5588193">err</span>&nbsp;<span class="op" id="5588197">=</span>&nbsp;<span class="ident" id="5588199">getBaseType</span><span class="op" id="5588210">(</span><span class="string" id="5588211">&#34;&#34;</span><span class="op" id="5588213">,</span>&nbsp;<span class="ident" id="5588215">t</span><span class="op" id="5588216">.</span><span class="ident" id="5588217">Elem</span><span class="op" id="5588221">(</span><span class="op" id="5588222">)</span><span class="op" id="5588223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588227">if</span>&nbsp;<span class="ident" id="5588230">err</span>&nbsp;<span class="op" id="5588234">!=</span>&nbsp;<span class="builtintype" id="5588237">nil</span>&nbsp;<span class="op" id="5588241">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588246">return</span>&nbsp;<span class="builtintype" id="5588253">nil</span><span class="op" id="5588256">,</span>&nbsp;<span class="ident" id="5588258">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588268">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588291">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588364">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588442">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588512">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588584">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588655">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588722">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588778">at</span><span class="op" id="5588780">.</span><span class="ident" id="5588781">init</span><span class="op" id="5588785">(</span><span class="ident" id="5588786">type0</span><span class="op" id="5588791">,</span>&nbsp;<span class="ident" id="5588793">t</span><span class="op" id="5588794">.</span><span class="ident" id="5588795">Len</span><span class="op" id="5588798">(</span><span class="op" id="5588799">)</span><span class="op" id="5588800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588804">return</span>&nbsp;<span class="ident" id="5588811">at</span><span class="op" id="5588813">,</span>&nbsp;<span class="builtintype" id="5588815">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588821">case</span>&nbsp;<span class="ident" id="5588826">reflect</span><span class="op" id="5588833">.</span><span class="ident" id="5588834">Map</span><span class="op" id="5588837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588841">mt</span>&nbsp;<span class="op" id="5588844">:=</span>&nbsp;<span class="ident" id="5588847">newMapType</span><span class="op" id="5588857">(</span><span class="ident" id="5588858">name</span><span class="op" id="5588862">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588866">types</span><span class="op" id="5588871">[</span><span class="ident" id="5588872">rt</span><span class="op" id="5588874">]</span>&nbsp;<span class="op" id="5588876">=</span>&nbsp;<span class="ident" id="5588878">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588883">type0</span><span class="op" id="5588888">,</span>&nbsp;<span class="ident" id="5588890">err</span>&nbsp;<span class="op" id="5588894">=</span>&nbsp;<span class="ident" id="5588896">getBaseType</span><span class="op" id="5588907">(</span><span class="string" id="5588908">&#34;&#34;</span><span class="op" id="5588910">,</span>&nbsp;<span class="ident" id="5588912">t</span><span class="op" id="5588913">.</span><span class="ident" id="5588914">Key</span><span class="op" id="5588917">(</span><span class="op" id="5588918">)</span><span class="op" id="5588919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588923">if</span>&nbsp;<span class="ident" id="5588926">err</span>&nbsp;<span class="op" id="5588930">!=</span>&nbsp;<span class="builtintype" id="5588933">nil</span>&nbsp;<span class="op" id="5588937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588942">return</span>&nbsp;<span class="builtintype" id="5588949">nil</span><span class="op" id="5588952">,</span>&nbsp;<span class="ident" id="5588954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588960">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588964">type1</span><span class="op" id="5588969">,</span>&nbsp;<span class="ident" id="5588971">err</span>&nbsp;<span class="op" id="5588975">=</span>&nbsp;<span class="ident" id="5588977">getBaseType</span><span class="op" id="5588988">(</span><span class="string" id="5588989">&#34;&#34;</span><span class="op" id="5588991">,</span>&nbsp;<span class="ident" id="5588993">t</span><span class="op" id="5588994">.</span><span class="ident" id="5588995">Elem</span><span class="op" id="5588999">(</span><span class="op" id="5589000">)</span><span class="op" id="5589001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589005">if</span>&nbsp;<span class="ident" id="5589008">err</span>&nbsp;<span class="op" id="5589012">!=</span>&nbsp;<span class="builtintype" id="5589015">nil</span>&nbsp;<span class="op" id="5589019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589024">return</span>&nbsp;<span class="builtintype" id="5589031">nil</span><span class="op" id="5589034">,</span>&nbsp;<span class="ident" id="5589036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589046">mt</span><span class="op" id="5589048">.</span><span class="ident" id="5589049">init</span><span class="op" id="5589053">(</span><span class="ident" id="5589054">type0</span><span class="op" id="5589059">,</span>&nbsp;<span class="ident" id="5589061">type1</span><span class="op" id="5589066">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589070">return</span>&nbsp;<span class="ident" id="5589077">mt</span><span class="op" id="5589079">,</span>&nbsp;<span class="builtintype" id="5589081">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589087">case</span>&nbsp;<span class="ident" id="5589092">reflect</span><span class="op" id="5589099">.</span><span class="ident" id="5589100">Slice</span><span class="op" id="5589105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589109">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589150">if</span>&nbsp;<span class="ident" id="5589153">t</span><span class="op" id="5589154">.</span><span class="ident" id="5589155">Elem</span><span class="op" id="5589159">(</span><span class="op" id="5589160">)</span><span class="op" id="5589161">.</span><span class="ident" id="5589162">Kind</span><span class="op" id="5589166">(</span><span class="op" id="5589167">)</span>&nbsp;<span class="op" id="5589169">==</span>&nbsp;<span class="ident" id="5589172">reflect</span><span class="op" id="5589179">.</span><span class="ident" id="5589180">Uint8</span>&nbsp;<span class="op" id="5589186">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589191">return</span>&nbsp;<span class="ident" id="5589198">tBytes</span><span class="op" id="5589204">.</span><span class="ident" id="5589205">gobType</span><span class="op" id="5589212">(</span><span class="op" id="5589213">)</span><span class="op" id="5589214">,</span>&nbsp;<span class="builtintype" id="5589216">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589226">st</span>&nbsp;<span class="op" id="5589229">:=</span>&nbsp;<span class="ident" id="5589232">newSliceType</span><span class="op" id="5589244">(</span><span class="ident" id="5589245">name</span><span class="op" id="5589249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589253">types</span><span class="op" id="5589258">[</span><span class="ident" id="5589259">rt</span><span class="op" id="5589261">]</span>&nbsp;<span class="op" id="5589263">=</span>&nbsp;<span class="ident" id="5589265">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589270">type0</span><span class="op" id="5589275">,</span>&nbsp;<span class="ident" id="5589277">err</span>&nbsp;<span class="op" id="5589281">=</span>&nbsp;<span class="ident" id="5589283">getBaseType</span><span class="op" id="5589294">(</span><span class="ident" id="5589295">t</span><span class="op" id="5589296">.</span><span class="ident" id="5589297">Elem</span><span class="op" id="5589301">(</span><span class="op" id="5589302">)</span><span class="op" id="5589303">.</span><span class="ident" id="5589304">Name</span><span class="op" id="5589308">(</span><span class="op" id="5589309">)</span><span class="op" id="5589310">,</span>&nbsp;<span class="ident" id="5589312">t</span><span class="op" id="5589313">.</span><span class="ident" id="5589314">Elem</span><span class="op" id="5589318">(</span><span class="op" id="5589319">)</span><span class="op" id="5589320">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589324">if</span>&nbsp;<span class="ident" id="5589327">err</span>&nbsp;<span class="op" id="5589331">!=</span>&nbsp;<span class="builtintype" id="5589334">nil</span>&nbsp;<span class="op" id="5589338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589343">return</span>&nbsp;<span class="builtintype" id="5589350">nil</span><span class="op" id="5589353">,</span>&nbsp;<span class="ident" id="5589355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589365">st</span><span class="op" id="5589367">.</span><span class="ident" id="5589368">init</span><span class="op" id="5589372">(</span><span class="ident" id="5589373">type0</span><span class="op" id="5589378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589382">return</span>&nbsp;<span class="ident" id="5589389">st</span><span class="op" id="5589391">,</span>&nbsp;<span class="builtintype" id="5589393">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589399">case</span>&nbsp;<span class="ident" id="5589404">reflect</span><span class="op" id="5589411">.</span><span class="ident" id="5589412">Struct</span><span class="op" id="5589418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589422">st</span>&nbsp;<span class="op" id="5589425">:=</span>&nbsp;<span class="ident" id="5589428">newStructType</span><span class="op" id="5589441">(</span><span class="ident" id="5589442">name</span><span class="op" id="5589446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589450">types</span><span class="op" id="5589455">[</span><span class="ident" id="5589456">rt</span><span class="op" id="5589458">]</span>&nbsp;<span class="op" id="5589460">=</span>&nbsp;<span class="ident" id="5589462">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589467">idToType</span><span class="op" id="5589475">[</span><span class="ident" id="5589476">st</span><span class="op" id="5589478">.</span><span class="ident" id="5589479">id</span><span class="op" id="5589481">(</span><span class="op" id="5589482">)</span><span class="op" id="5589483">]</span>&nbsp;<span class="op" id="5589485">=</span>&nbsp;<span class="ident" id="5589487">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589492">for</span>&nbsp;<span class="ident" id="5589496">i</span>&nbsp;<span class="op" id="5589498">:=</span>&nbsp;<span class="num" id="5589501">0</span><span class="op" id="5589502">;</span>&nbsp;<span class="ident" id="5589504">i</span>&nbsp;<span class="op" id="5589506">&lt;</span>&nbsp;<span class="ident" id="5589508">t</span><span class="op" id="5589509">.</span><span class="ident" id="5589510">NumField</span><span class="op" id="5589518">(</span><span class="op" id="5589519">)</span><span class="op" id="5589520">;</span>&nbsp;<span class="ident" id="5589522">i</span><span class="op" id="5589523">++</span>&nbsp;<span class="op" id="5589526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589531">f</span>&nbsp;<span class="op" id="5589533">:=</span>&nbsp;<span class="ident" id="5589536">t</span><span class="op" id="5589537">.</span><span class="ident" id="5589538">Field</span><span class="op" id="5589543">(</span><span class="ident" id="5589544">i</span><span class="op" id="5589545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589550">if</span>&nbsp;<span class="op" id="5589553">!</span><span class="ident" id="5589554">isSent</span><span class="op" id="5589560">(</span><span class="op" id="5589561">&amp;</span><span class="ident" id="5589562">f</span><span class="op" id="5589563">)</span>&nbsp;<span class="op" id="5589565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589571">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589583">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589588">typ</span>&nbsp;<span class="op" id="5589592">:=</span>&nbsp;<span class="ident" id="5589595">userType</span><span class="op" id="5589603">(</span><span class="ident" id="5589604">f</span><span class="op" id="5589605">.</span><span class="ident" id="5589606">Type</span><span class="op" id="5589610">)</span><span class="op" id="5589611">.</span><span class="ident" id="5589612">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589620">tname</span>&nbsp;<span class="op" id="5589626">:=</span>&nbsp;<span class="ident" id="5589629">typ</span><span class="op" id="5589632">.</span><span class="ident" id="5589633">Name</span><span class="op" id="5589637">(</span><span class="op" id="5589638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589643">if</span>&nbsp;<span class="ident" id="5589646">tname</span>&nbsp;<span class="op" id="5589652">==</span>&nbsp;<span class="string" id="5589655">&#34;&#34;</span>&nbsp;<span class="op" id="5589658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589664">t</span>&nbsp;<span class="op" id="5589666">:=</span>&nbsp;<span class="ident" id="5589669">userType</span><span class="op" id="5589677">(</span><span class="ident" id="5589678">f</span><span class="op" id="5589679">.</span><span class="ident" id="5589680">Type</span><span class="op" id="5589684">)</span><span class="op" id="5589685">.</span><span class="ident" id="5589686">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589695">tname</span>&nbsp;<span class="op" id="5589701">=</span>&nbsp;<span class="ident" id="5589703">t</span><span class="op" id="5589704">.</span><span class="ident" id="5589705">String</span><span class="op" id="5589711">(</span><span class="op" id="5589712">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589722">gt</span><span class="op" id="5589724">,</span>&nbsp;<span class="ident" id="5589726">err</span>&nbsp;<span class="op" id="5589730">:=</span>&nbsp;<span class="ident" id="5589733">getBaseType</span><span class="op" id="5589744">(</span><span class="ident" id="5589745">tname</span><span class="op" id="5589750">,</span>&nbsp;<span class="ident" id="5589752">f</span><span class="op" id="5589753">.</span><span class="ident" id="5589754">Type</span><span class="op" id="5589758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589763">if</span>&nbsp;<span class="ident" id="5589766">err</span>&nbsp;<span class="op" id="5589770">!=</span>&nbsp;<span class="builtintype" id="5589773">nil</span>&nbsp;<span class="op" id="5589777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589783">return</span>&nbsp;<span class="builtintype" id="5589790">nil</span><span class="op" id="5589793">,</span>&nbsp;<span class="ident" id="5589795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589802">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589807">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589873">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589937">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5590006">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590076">if</span>&nbsp;<span class="ident" id="5590079">gt</span><span class="op" id="5590081">.</span><span class="ident" id="5590082">id</span><span class="op" id="5590084">(</span><span class="op" id="5590085">)</span>&nbsp;<span class="op" id="5590087">==</span>&nbsp;<span class="num" id="5590090">0</span>&nbsp;<span class="op" id="5590092">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590098">setTypeId</span><span class="op" id="5590107">(</span><span class="ident" id="5590108">gt</span><span class="op" id="5590110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590120">st</span><span class="op" id="5590122">.</span><span class="ident" id="5590123">Field</span>&nbsp;<span class="op" id="5590129">=</span>&nbsp;<span class="builtinfunc" id="5590131">append</span><span class="op" id="5590137">(</span><span class="ident" id="5590138">st</span><span class="op" id="5590140">.</span><span class="ident" id="5590141">Field</span><span class="op" id="5590146">,</span>&nbsp;<span class="op" id="5590148">&amp;</span><span class="ident" id="5590149">fieldType</span><span class="op" id="5590158">{</span><span class="ident" id="5590159">f</span><span class="op" id="5590160">.</span><span class="ident" id="5590161">Name</span><span class="op" id="5590165">,</span>&nbsp;<span class="ident" id="5590167">gt</span><span class="op" id="5590169">.</span><span class="ident" id="5590170">id</span><span class="op" id="5590172">(</span><span class="op" id="5590173">)</span><span class="op" id="5590174">}</span><span class="op" id="5590175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590183">return</span>&nbsp;<span class="ident" id="5590190">st</span><span class="op" id="5590192">,</span>&nbsp;<span class="builtintype" id="5590194">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590200">default</span><span class="op" id="5590207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590211">return</span>&nbsp;<span class="builtintype" id="5590218">nil</span><span class="op" id="5590221">,</span>&nbsp;<span class="ident" id="5590223">errors</span><span class="op" id="5590229">.</span><span class="ident" id="5590230">New</span><span class="op" id="5590233">(</span><span class="string" id="5590234">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5590274">+</span>&nbsp;<span class="ident" id="5590276">rt</span><span class="op" id="5590278">.</span><span class="ident" id="5590279">String</span><span class="op" id="5590285">(</span><span class="op" id="5590286">)</span><span class="op" id="5590287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590290">}</span><br>
<span class="lineno"></span><span class="op" id="5590292">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5590295">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5590366">func</span>&nbsp;<span class="ident" id="5590371">isExported</span><span class="op" id="5590381">(</span><span class="ident" id="5590382">name</span>&nbsp;<span class="builtintype" id="5590387">string</span><span class="op" id="5590393">)</span>&nbsp;<span class="builtintype" id="5590395">bool</span>&nbsp;<span class="op" id="5590400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5590403">rune</span><span class="op" id="5590407">,</span>&nbsp;<span class="ident" id="5590409">_</span>&nbsp;<span class="op" id="5590411">:=</span>&nbsp;<span class="ident" id="5590414">utf8</span><span class="op" id="5590418">.</span><span class="ident" id="5590419">DecodeRuneInString</span><span class="op" id="5590437">(</span><span class="ident" id="5590438">name</span><span class="op" id="5590442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590445">return</span>&nbsp;<span class="ident" id="5590452">unicode</span><span class="op" id="5590459">.</span><span class="ident" id="5590460">IsUpper</span><span class="op" id="5590467">(</span><span class="builtintype" id="5590468">rune</span><span class="op" id="5590472">)</span><br>
<span class="lineno">570</span><span class="op" id="5590474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5590477">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5590543">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5590621">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5590652">func</span>&nbsp;<span class="ident" id="5590657">isSent</span><span class="op" id="5590663">(</span><span class="ident" id="5590664">field</span>&nbsp;<span class="op" id="5590670">*</span><span class="ident" id="5590671">reflect</span><span class="op" id="5590678">.</span><span class="ident" id="5590679">StructField</span><span class="op" id="5590690">)</span>&nbsp;<span class="builtintype" id="5590692">bool</span>&nbsp;<span class="op" id="5590697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590700">if</span>&nbsp;<span class="op" id="5590703">!</span><span class="ident" id="5590704">isExported</span><span class="op" id="5590714">(</span><span class="ident" id="5590715">field</span><span class="op" id="5590720">.</span><span class="ident" id="5590721">Name</span><span class="op" id="5590725">)</span>&nbsp;<span class="op" id="5590727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590731">return</span>&nbsp;<span class="builtintype" id="5590738">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5590748">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5590818">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590866">typ</span>&nbsp;<span class="op" id="5590870">:=</span>&nbsp;<span class="ident" id="5590873">field</span><span class="op" id="5590878">.</span><span class="ident" id="5590879">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590885">for</span>&nbsp;<span class="ident" id="5590889">typ</span><span class="op" id="5590892">.</span><span class="ident" id="5590893">Kind</span><span class="op" id="5590897">(</span><span class="op" id="5590898">)</span>&nbsp;<span class="op" id="5590900">==</span>&nbsp;<span class="ident" id="5590903">reflect</span><span class="op" id="5590910">.</span><span class="ident" id="5590911">Ptr</span>&nbsp;<span class="op" id="5590915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590919">typ</span>&nbsp;<span class="op" id="5590923">=</span>&nbsp;<span class="ident" id="5590925">typ</span><span class="op" id="5590928">.</span><span class="ident" id="5590929">Elem</span><span class="op" id="5590933">(</span><span class="op" id="5590934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590937">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590940">if</span>&nbsp;<span class="ident" id="5590943">typ</span><span class="op" id="5590946">.</span><span class="ident" id="5590947">Kind</span><span class="op" id="5590951">(</span><span class="op" id="5590952">)</span>&nbsp;<span class="op" id="5590954">==</span>&nbsp;<span class="ident" id="5590957">reflect</span><span class="op" id="5590964">.</span><span class="ident" id="5590965">Chan</span>&nbsp;<span class="op" id="5590970">||</span>&nbsp;<span class="ident" id="5590973">typ</span><span class="op" id="5590976">.</span><span class="ident" id="5590977">Kind</span><span class="op" id="5590981">(</span><span class="op" id="5590982">)</span>&nbsp;<span class="op" id="5590984">==</span>&nbsp;<span class="ident" id="5590987">reflect</span><span class="op" id="5590994">.</span><span class="ident" id="5590995">Func</span>&nbsp;<span class="op" id="5591000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591004">return</span>&nbsp;<span class="builtintype" id="5591011">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591021">return</span>&nbsp;<span class="builtintype" id="5591028">true</span><br>
<span class="lineno"></span><span class="op" id="5591033">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5591036">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5591119">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5591145">func</span>&nbsp;<span class="ident" id="5591150">getBaseType</span><span class="op" id="5591161">(</span><span class="ident" id="5591162">name</span>&nbsp;<span class="builtintype" id="5591167">string</span><span class="op" id="5591173">,</span>&nbsp;<span class="ident" id="5591175">rt</span>&nbsp;<span class="ident" id="5591178">reflect</span><span class="op" id="5591185">.</span><span class="ident" id="5591186">Type</span><span class="op" id="5591190">)</span>&nbsp;<span class="op" id="5591192">(</span><span class="ident" id="5591193">gobType</span><span class="op" id="5591200">,</span>&nbsp;<span class="builtintype" id="5591202">error</span><span class="op" id="5591207">)</span>&nbsp;<span class="op" id="5591209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591212">ut</span>&nbsp;<span class="op" id="5591215">:=</span>&nbsp;<span class="ident" id="5591218">userType</span><span class="op" id="5591226">(</span><span class="ident" id="5591227">rt</span><span class="op" id="5591229">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591232">return</span>&nbsp;<span class="ident" id="5591239">getType</span><span class="op" id="5591246">(</span><span class="ident" id="5591247">name</span><span class="op" id="5591251">,</span>&nbsp;<span class="ident" id="5591253">ut</span><span class="op" id="5591255">,</span>&nbsp;<span class="ident" id="5591257">ut</span><span class="op" id="5591259">.</span><span class="ident" id="5591260">base</span><span class="op" id="5591264">)</span><br>
<span class="lineno"></span><span class="op" id="5591266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5591269">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5591336">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5591397">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5591464">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5591495">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5591521">func</span>&nbsp;<span class="ident" id="5591526">getType</span><span class="op" id="5591533">(</span><span class="ident" id="5591534">name</span>&nbsp;<span class="builtintype" id="5591539">string</span><span class="op" id="5591545">,</span>&nbsp;<span class="ident" id="5591547">ut</span>&nbsp;<span class="op" id="5591550">*</span><span class="ident" id="5591551">userTypeInfo</span><span class="op" id="5591563">,</span>&nbsp;<span class="ident" id="5591565">rt</span>&nbsp;<span class="ident" id="5591568">reflect</span><span class="op" id="5591575">.</span><span class="ident" id="5591576">Type</span><span class="op" id="5591580">)</span>&nbsp;<span class="op" id="5591582">(</span><span class="ident" id="5591583">gobType</span><span class="op" id="5591590">,</span>&nbsp;<span class="builtintype" id="5591592">error</span><span class="op" id="5591597">)</span>&nbsp;<span class="op" id="5591599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591602">typ</span><span class="op" id="5591605">,</span>&nbsp;<span class="ident" id="5591607">present</span>&nbsp;<span class="op" id="5591615">:=</span>&nbsp;<span class="ident" id="5591618">types</span><span class="op" id="5591623">[</span><span class="ident" id="5591624">rt</span><span class="op" id="5591626">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591629">if</span>&nbsp;<span class="ident" id="5591632">present</span>&nbsp;<span class="op" id="5591640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591644">return</span>&nbsp;<span class="ident" id="5591651">typ</span><span class="op" id="5591654">,</span>&nbsp;<span class="builtintype" id="5591656">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591664">typ</span><span class="op" id="5591667">,</span>&nbsp;<span class="ident" id="5591669">err</span>&nbsp;<span class="op" id="5591673">:=</span>&nbsp;<span class="ident" id="5591676">newTypeObject</span><span class="op" id="5591689">(</span><span class="ident" id="5591690">name</span><span class="op" id="5591694">,</span>&nbsp;<span class="ident" id="5591696">ut</span><span class="op" id="5591698">,</span>&nbsp;<span class="ident" id="5591700">rt</span><span class="op" id="5591702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591705">if</span>&nbsp;<span class="ident" id="5591708">err</span>&nbsp;<span class="op" id="5591712">==</span>&nbsp;<span class="builtintype" id="5591715">nil</span>&nbsp;<span class="op" id="5591719">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591723">types</span><span class="op" id="5591728">[</span><span class="ident" id="5591729">rt</span><span class="op" id="5591731">]</span>&nbsp;<span class="op" id="5591733">=</span>&nbsp;<span class="ident" id="5591735">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591743">return</span>&nbsp;<span class="ident" id="5591750">typ</span><span class="op" id="5591753">,</span>&nbsp;<span class="ident" id="5591755">err</span><br>
<span class="lineno"></span><span class="op" id="5591759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5591762">func</span>&nbsp;<span class="ident" id="5591767">checkId</span><span class="op" id="5591774">(</span><span class="ident" id="5591775">want</span><span class="op" id="5591779">,</span>&nbsp;<span class="ident" id="5591781">got</span>&nbsp;<span class="ident" id="5591785">typeId</span><span class="op" id="5591791">)</span>&nbsp;<span class="op" id="5591793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591796">if</span>&nbsp;<span class="ident" id="5591799">want</span>&nbsp;<span class="op" id="5591804">!=</span>&nbsp;<span class="ident" id="5591807">got</span>&nbsp;<span class="op" id="5591811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591815">fmt</span><span class="op" id="5591818">.</span><span class="ident" id="5591819">Fprintf</span><span class="op" id="5591826">(</span><span class="ident" id="5591827">os</span><span class="op" id="5591829">.</span><span class="ident" id="5591830">Stderr</span><span class="op" id="5591836">,</span>&nbsp;<span class="string" id="5591838">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5591866">,</span>&nbsp;<span class="builtintype" id="5591868">int</span><span class="op" id="5591871">(</span><span class="ident" id="5591872">got</span><span class="op" id="5591875">)</span><span class="op" id="5591876">,</span>&nbsp;<span class="builtintype" id="5591878">int</span><span class="op" id="5591881">(</span><span class="ident" id="5591882">want</span><span class="op" id="5591886">)</span><span class="op" id="5591887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5591891">panic</span><span class="op" id="5591896">(</span><span class="string" id="5591897">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5591925">+</span>&nbsp;<span class="ident" id="5591927">got</span><span class="op" id="5591930">.</span><span class="ident" id="5591931">name</span><span class="op" id="5591935">(</span><span class="op" id="5591936">)</span>&nbsp;<span class="op" id="5591938">+</span>&nbsp;<span class="string" id="5591940">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5591944">+</span>&nbsp;<span class="ident" id="5591946">got</span><span class="op" id="5591949">.</span><span class="builtintype" id="5591950">string</span><span class="op" id="5591956">(</span><span class="op" id="5591957">)</span>&nbsp;<span class="op" id="5591959">+</span>&nbsp;<span class="string" id="5591961">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5591969">+</span>&nbsp;<span class="ident" id="5591971">want</span><span class="op" id="5591975">.</span><span class="builtintype" id="5591976">string</span><span class="op" id="5591982">(</span><span class="op" id="5591983">)</span><span class="op" id="5591984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591987">}</span><br>
<span class="lineno">620</span><span class="op" id="5591989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5591992">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5592069">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5592110">func</span>&nbsp;<span class="ident" id="5592115">bootstrapType</span><span class="op" id="5592128">(</span><span class="ident" id="5592129">name</span>&nbsp;<span class="builtintype" id="5592134">string</span><span class="op" id="5592140">,</span>&nbsp;<span class="ident" id="5592142">e</span>&nbsp;<span class="keyword" id="5592144">interface</span><span class="op" id="5592153">{</span><span class="op" id="5592154">}</span><span class="op" id="5592155">,</span>&nbsp;<span class="ident" id="5592157">expect</span>&nbsp;<span class="ident" id="5592164">typeId</span><span class="op" id="5592170">)</span>&nbsp;<span class="ident" id="5592172">typeId</span>&nbsp;<span class="op" id="5592179">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592182">rt</span>&nbsp;<span class="op" id="5592185">:=</span>&nbsp;<span class="ident" id="5592188">reflect</span><span class="op" id="5592195">.</span><span class="ident" id="5592196">TypeOf</span><span class="op" id="5592202">(</span><span class="ident" id="5592203">e</span><span class="op" id="5592204">)</span><span class="op" id="5592205">.</span><span class="ident" id="5592206">Elem</span><span class="op" id="5592210">(</span><span class="op" id="5592211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592214">_</span><span class="op" id="5592215">,</span>&nbsp;<span class="ident" id="5592217">present</span>&nbsp;<span class="op" id="5592225">:=</span>&nbsp;<span class="ident" id="5592228">types</span><span class="op" id="5592233">[</span><span class="ident" id="5592234">rt</span><span class="op" id="5592236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592239">if</span>&nbsp;<span class="ident" id="5592242">present</span>&nbsp;<span class="op" id="5592250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5592254">panic</span><span class="op" id="5592259">(</span><span class="string" id="5592260">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5592295">+</span>&nbsp;<span class="ident" id="5592297">name</span>&nbsp;<span class="op" id="5592302">+</span>&nbsp;<span class="string" id="5592304">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5592309">+</span>&nbsp;<span class="ident" id="5592311">rt</span><span class="op" id="5592313">.</span><span class="ident" id="5592314">String</span><span class="op" id="5592320">(</span><span class="op" id="5592321">)</span><span class="op" id="5592322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592325">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592328">typ</span>&nbsp;<span class="op" id="5592332">:=</span>&nbsp;<span class="op" id="5592335">&amp;</span><span class="ident" id="5592336">CommonType</span><span class="op" id="5592346">{</span><span class="ident" id="5592347">Name</span><span class="op" id="5592351">:</span>&nbsp;<span class="ident" id="5592353">name</span><span class="op" id="5592357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592360">types</span><span class="op" id="5592365">[</span><span class="ident" id="5592366">rt</span><span class="op" id="5592368">]</span>&nbsp;<span class="op" id="5592370">=</span>&nbsp;<span class="ident" id="5592372">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592377">setTypeId</span><span class="op" id="5592386">(</span><span class="ident" id="5592387">typ</span><span class="op" id="5592390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592393">checkId</span><span class="op" id="5592400">(</span><span class="ident" id="5592401">expect</span><span class="op" id="5592407">,</span>&nbsp;<span class="ident" id="5592409">nextId</span><span class="op" id="5592415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592418">userType</span><span class="op" id="5592426">(</span><span class="ident" id="5592427">rt</span><span class="op" id="5592429">)</span>&nbsp;<span class="comment" id="5592431">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592462">return</span>&nbsp;<span class="ident" id="5592469">nextId</span><br>
<span class="lineno"></span><span class="op" id="5592476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5592479">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5592553">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5592627">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5592701">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5592721">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5592791">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5592868">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5592942">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5593014">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5593059">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5593132">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5593156">type</span>&nbsp;<span class="ident" id="5593161">wireType</span>&nbsp;<span class="keyword" id="5593170">struct</span>&nbsp;<span class="op" id="5593177">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593180">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593197">*</span><span class="ident" id="5593198">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593209">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593226">*</span><span class="ident" id="5593227">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593238">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593255">*</span><span class="ident" id="5593256">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593268">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593285">*</span><span class="ident" id="5593286">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593295">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593312">*</span><span class="ident" id="5593313">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593329">BinaryMarshalerT</span>&nbsp;<span class="op" id="5593346">*</span><span class="ident" id="5593347">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593363">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5593380">*</span><span class="ident" id="5593381">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5593396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5593399">func</span>&nbsp;<span class="op" id="5593404">(</span><span class="ident" id="5593405">w</span>&nbsp;<span class="op" id="5593407">*</span><span class="ident" id="5593408">wireType</span><span class="op" id="5593416">)</span>&nbsp;<span class="builtintype" id="5593418">string</span><span class="op" id="5593424">(</span><span class="op" id="5593425">)</span>&nbsp;<span class="builtintype" id="5593427">string</span>&nbsp;<span class="op" id="5593434">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593437">const</span>&nbsp;<span class="ident" id="5593443">unknown</span>&nbsp;<span class="op" id="5593451">=</span>&nbsp;<span class="string" id="5593453">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593469">if</span>&nbsp;<span class="ident" id="5593472">w</span>&nbsp;<span class="op" id="5593474">==</span>&nbsp;<span class="builtintype" id="5593477">nil</span>&nbsp;<span class="op" id="5593481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593485">return</span>&nbsp;<span class="ident" id="5593492">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593504">switch</span>&nbsp;<span class="op" id="5593511">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593514">case</span>&nbsp;<span class="ident" id="5593519">w</span><span class="op" id="5593520">.</span><span class="ident" id="5593521">ArrayT</span>&nbsp;<span class="op" id="5593528">!=</span>&nbsp;<span class="builtintype" id="5593531">nil</span><span class="op" id="5593534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593538">return</span>&nbsp;<span class="ident" id="5593545">w</span><span class="op" id="5593546">.</span><span class="ident" id="5593547">ArrayT</span><span class="op" id="5593553">.</span><span class="ident" id="5593554">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593560">case</span>&nbsp;<span class="ident" id="5593565">w</span><span class="op" id="5593566">.</span><span class="ident" id="5593567">SliceT</span>&nbsp;<span class="op" id="5593574">!=</span>&nbsp;<span class="builtintype" id="5593577">nil</span><span class="op" id="5593580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593584">return</span>&nbsp;<span class="ident" id="5593591">w</span><span class="op" id="5593592">.</span><span class="ident" id="5593593">SliceT</span><span class="op" id="5593599">.</span><span class="ident" id="5593600">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593606">case</span>&nbsp;<span class="ident" id="5593611">w</span><span class="op" id="5593612">.</span><span class="ident" id="5593613">StructT</span>&nbsp;<span class="op" id="5593621">!=</span>&nbsp;<span class="builtintype" id="5593624">nil</span><span class="op" id="5593627">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593631">return</span>&nbsp;<span class="ident" id="5593638">w</span><span class="op" id="5593639">.</span><span class="ident" id="5593640">StructT</span><span class="op" id="5593647">.</span><span class="ident" id="5593648">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593654">case</span>&nbsp;<span class="ident" id="5593659">w</span><span class="op" id="5593660">.</span><span class="ident" id="5593661">MapT</span>&nbsp;<span class="op" id="5593666">!=</span>&nbsp;<span class="builtintype" id="5593669">nil</span><span class="op" id="5593672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593676">return</span>&nbsp;<span class="ident" id="5593683">w</span><span class="op" id="5593684">.</span><span class="ident" id="5593685">MapT</span><span class="op" id="5593689">.</span><span class="ident" id="5593690">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593696">case</span>&nbsp;<span class="ident" id="5593701">w</span><span class="op" id="5593702">.</span><span class="ident" id="5593703">GobEncoderT</span>&nbsp;<span class="op" id="5593715">!=</span>&nbsp;<span class="builtintype" id="5593718">nil</span><span class="op" id="5593721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593725">return</span>&nbsp;<span class="ident" id="5593732">w</span><span class="op" id="5593733">.</span><span class="ident" id="5593734">GobEncoderT</span><span class="op" id="5593745">.</span><span class="ident" id="5593746">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593752">case</span>&nbsp;<span class="ident" id="5593757">w</span><span class="op" id="5593758">.</span><span class="ident" id="5593759">BinaryMarshalerT</span>&nbsp;<span class="op" id="5593776">!=</span>&nbsp;<span class="builtintype" id="5593779">nil</span><span class="op" id="5593782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593786">return</span>&nbsp;<span class="ident" id="5593793">w</span><span class="op" id="5593794">.</span><span class="ident" id="5593795">BinaryMarshalerT</span><span class="op" id="5593811">.</span><span class="ident" id="5593812">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593818">case</span>&nbsp;<span class="ident" id="5593823">w</span><span class="op" id="5593824">.</span><span class="ident" id="5593825">TextMarshalerT</span>&nbsp;<span class="op" id="5593840">!=</span>&nbsp;<span class="builtintype" id="5593843">nil</span><span class="op" id="5593846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593850">return</span>&nbsp;<span class="ident" id="5593857">w</span><span class="op" id="5593858">.</span><span class="ident" id="5593859">TextMarshalerT</span><span class="op" id="5593873">.</span><span class="ident" id="5593874">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593880">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593883">return</span>&nbsp;<span class="ident" id="5593890">unknown</span><br>
<span class="lineno"></span><span class="op" id="5593898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5593901">type</span>&nbsp;<span class="ident" id="5593906">typeInfo</span>&nbsp;<span class="keyword" id="5593915">struct</span>&nbsp;<span class="op" id="5593922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593925">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593933">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593941">encInit</span>&nbsp;<span class="ident" id="5593949">sync</span><span class="op" id="5593953">.</span><span class="ident" id="5593954">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5593962">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593995">encoder</span>&nbsp;<span class="ident" id="5594003">atomic</span><span class="op" id="5594009">.</span><span class="ident" id="5594010">Value</span>&nbsp;<span class="comment" id="5594016">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594031">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594039">*</span><span class="ident" id="5594040">wireType</span><br>
<span class="lineno"></span><span class="op" id="5594049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5594052">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5594119">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5594181">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5594251">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5594321">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5594393">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5594418">var</span>&nbsp;<span class="ident" id="5594422">typeInfoMap</span>&nbsp;<span class="ident" id="5594434">atomic</span><span class="op" id="5594440">.</span><span class="ident" id="5594441">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5594448">func</span>&nbsp;<span class="ident" id="5594453">lookupTypeInfo</span><span class="op" id="5594467">(</span><span class="ident" id="5594468">rt</span>&nbsp;<span class="ident" id="5594471">reflect</span><span class="op" id="5594478">.</span><span class="ident" id="5594479">Type</span><span class="op" id="5594483">)</span>&nbsp;<span class="op" id="5594485">*</span><span class="ident" id="5594486">typeInfo</span>&nbsp;<span class="op" id="5594495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594498">m</span><span class="op" id="5594499">,</span>&nbsp;<span class="ident" id="5594501">_</span>&nbsp;<span class="op" id="5594503">:=</span>&nbsp;<span class="ident" id="5594506">typeInfoMap</span><span class="op" id="5594517">.</span><span class="ident" id="5594518">Load</span><span class="op" id="5594522">(</span><span class="op" id="5594523">)</span><span class="op" id="5594524">.</span><span class="op" id="5594525">(</span><span class="keyword" id="5594526">map</span><span class="op" id="5594529">[</span><span class="ident" id="5594530">reflect</span><span class="op" id="5594537">.</span><span class="ident" id="5594538">Type</span><span class="op" id="5594542">]</span><span class="op" id="5594543">*</span><span class="ident" id="5594544">typeInfo</span><span class="op" id="5594552">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594555">return</span>&nbsp;<span class="ident" id="5594562">m</span><span class="op" id="5594563">[</span><span class="ident" id="5594564">rt</span><span class="op" id="5594566">]</span><br>
<span class="lineno"></span><span class="op" id="5594568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5594571">func</span>&nbsp;<span class="ident" id="5594576">getTypeInfo</span><span class="op" id="5594587">(</span><span class="ident" id="5594588">ut</span>&nbsp;<span class="op" id="5594591">*</span><span class="ident" id="5594592">userTypeInfo</span><span class="op" id="5594604">)</span>&nbsp;<span class="op" id="5594606">(</span><span class="op" id="5594607">*</span><span class="ident" id="5594608">typeInfo</span><span class="op" id="5594616">,</span>&nbsp;<span class="builtintype" id="5594618">error</span><span class="op" id="5594623">)</span>&nbsp;<span class="op" id="5594625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594628">rt</span>&nbsp;<span class="op" id="5594631">:=</span>&nbsp;<span class="ident" id="5594634">ut</span><span class="op" id="5594636">.</span><span class="ident" id="5594637">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594643">if</span>&nbsp;<span class="ident" id="5594646">ut</span><span class="op" id="5594648">.</span><span class="ident" id="5594649">externalEnc</span>&nbsp;<span class="op" id="5594661">!=</span>&nbsp;<span class="num" id="5594664">0</span>&nbsp;<span class="op" id="5594666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5594670">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594717">rt</span>&nbsp;<span class="op" id="5594720">=</span>&nbsp;<span class="ident" id="5594722">ut</span><span class="op" id="5594724">.</span><span class="ident" id="5594725">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594734">if</span>&nbsp;<span class="ident" id="5594737">info</span>&nbsp;<span class="op" id="5594742">:=</span>&nbsp;<span class="ident" id="5594745">lookupTypeInfo</span><span class="op" id="5594759">(</span><span class="ident" id="5594760">rt</span><span class="op" id="5594762">)</span><span class="op" id="5594763">;</span>&nbsp;<span class="ident" id="5594765">info</span>&nbsp;<span class="op" id="5594770">!=</span>&nbsp;<span class="builtintype" id="5594773">nil</span>&nbsp;<span class="op" id="5594777">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594781">return</span>&nbsp;<span class="ident" id="5594788">info</span><span class="op" id="5594792">,</span>&nbsp;<span class="builtintype" id="5594794">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594802">return</span>&nbsp;<span class="ident" id="5594809">buildTypeInfo</span><span class="op" id="5594822">(</span><span class="ident" id="5594823">ut</span><span class="op" id="5594825">,</span>&nbsp;<span class="ident" id="5594827">rt</span><span class="op" id="5594829">)</span><br>
<span class="lineno"></span><span class="op" id="5594831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5594834">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5594896">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5594935">func</span>&nbsp;<span class="ident" id="5594940">buildTypeInfo</span><span class="op" id="5594953">(</span><span class="ident" id="5594954">ut</span>&nbsp;<span class="op" id="5594957">*</span><span class="ident" id="5594958">userTypeInfo</span><span class="op" id="5594970">,</span>&nbsp;<span class="ident" id="5594972">rt</span>&nbsp;<span class="ident" id="5594975">reflect</span><span class="op" id="5594982">.</span><span class="ident" id="5594983">Type</span><span class="op" id="5594987">)</span>&nbsp;<span class="op" id="5594989">(</span><span class="op" id="5594990">*</span><span class="ident" id="5594991">typeInfo</span><span class="op" id="5594999">,</span>&nbsp;<span class="builtintype" id="5595001">error</span><span class="op" id="5595006">)</span>&nbsp;<span class="op" id="5595008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595011">typeLock</span><span class="op" id="5595019">.</span><span class="ident" id="5595020">Lock</span><span class="op" id="5595024">(</span><span class="op" id="5595025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595028">defer</span>&nbsp;<span class="ident" id="5595034">typeLock</span><span class="op" id="5595042">.</span><span class="ident" id="5595043">Unlock</span><span class="op" id="5595049">(</span><span class="op" id="5595050">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595054">if</span>&nbsp;<span class="ident" id="5595057">info</span>&nbsp;<span class="op" id="5595062">:=</span>&nbsp;<span class="ident" id="5595065">lookupTypeInfo</span><span class="op" id="5595079">(</span><span class="ident" id="5595080">rt</span><span class="op" id="5595082">)</span><span class="op" id="5595083">;</span>&nbsp;<span class="ident" id="5595085">info</span>&nbsp;<span class="op" id="5595090">!=</span>&nbsp;<span class="builtintype" id="5595093">nil</span>&nbsp;<span class="op" id="5595097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595101">return</span>&nbsp;<span class="ident" id="5595108">info</span><span class="op" id="5595112">,</span>&nbsp;<span class="builtintype" id="5595114">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595123">gt</span><span class="op" id="5595125">,</span>&nbsp;<span class="ident" id="5595127">err</span>&nbsp;<span class="op" id="5595131">:=</span>&nbsp;<span class="ident" id="5595134">getBaseType</span><span class="op" id="5595145">(</span><span class="ident" id="5595146">rt</span><span class="op" id="5595148">.</span><span class="ident" id="5595149">Name</span><span class="op" id="5595153">(</span><span class="op" id="5595154">)</span><span class="op" id="5595155">,</span>&nbsp;<span class="ident" id="5595157">rt</span><span class="op" id="5595159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595162">if</span>&nbsp;<span class="ident" id="5595165">err</span>&nbsp;<span class="op" id="5595169">!=</span>&nbsp;<span class="builtintype" id="5595172">nil</span>&nbsp;<span class="op" id="5595176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595180">return</span>&nbsp;<span class="builtintype" id="5595187">nil</span><span class="op" id="5595190">,</span>&nbsp;<span class="ident" id="5595192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595200">info</span>&nbsp;<span class="op" id="5595205">:=</span>&nbsp;<span class="op" id="5595208">&amp;</span><span class="ident" id="5595209">typeInfo</span><span class="op" id="5595217">{</span><span class="ident" id="5595218">id</span><span class="op" id="5595220">:</span>&nbsp;<span class="ident" id="5595222">gt</span><span class="op" id="5595224">.</span><span class="ident" id="5595225">id</span><span class="op" id="5595227">(</span><span class="op" id="5595228">)</span><span class="op" id="5595229">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595233">if</span>&nbsp;<span class="ident" id="5595236">ut</span><span class="op" id="5595238">.</span><span class="ident" id="5595239">externalEnc</span>&nbsp;<span class="op" id="5595251">!=</span>&nbsp;<span class="num" id="5595254">0</span>&nbsp;<span class="op" id="5595256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595260">userType</span><span class="op" id="5595268">,</span>&nbsp;<span class="ident" id="5595270">err</span>&nbsp;<span class="op" id="5595274">:=</span>&nbsp;<span class="ident" id="5595277">getType</span><span class="op" id="5595284">(</span><span class="ident" id="5595285">rt</span><span class="op" id="5595287">.</span><span class="ident" id="5595288">Name</span><span class="op" id="5595292">(</span><span class="op" id="5595293">)</span><span class="op" id="5595294">,</span>&nbsp;<span class="ident" id="5595296">ut</span><span class="op" id="5595298">,</span>&nbsp;<span class="ident" id="5595300">rt</span><span class="op" id="5595302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595306">if</span>&nbsp;<span class="ident" id="5595309">err</span>&nbsp;<span class="op" id="5595313">!=</span>&nbsp;<span class="builtintype" id="5595316">nil</span>&nbsp;<span class="op" id="5595320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595325">return</span>&nbsp;<span class="builtintype" id="5595332">nil</span><span class="op" id="5595335">,</span>&nbsp;<span class="ident" id="5595337">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595347">gt</span>&nbsp;<span class="op" id="5595350">:=</span>&nbsp;<span class="ident" id="5595353">userType</span><span class="op" id="5595361">.</span><span class="ident" id="5595362">id</span><span class="op" id="5595364">(</span><span class="op" id="5595365">)</span><span class="op" id="5595366">.</span><span class="ident" id="5595367">gobType</span><span class="op" id="5595374">(</span><span class="op" id="5595375">)</span><span class="op" id="5595376">.</span><span class="op" id="5595377">(</span><span class="op" id="5595378">*</span><span class="ident" id="5595379">gobEncoderType</span><span class="op" id="5595393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595397">switch</span>&nbsp;<span class="ident" id="5595404">ut</span><span class="op" id="5595406">.</span><span class="ident" id="5595407">externalEnc</span>&nbsp;<span class="op" id="5595419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595423">case</span>&nbsp;<span class="ident" id="5595428">xGob</span><span class="op" id="5595432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595437">info</span><span class="op" id="5595441">.</span><span class="ident" id="5595442">wire</span>&nbsp;<span class="op" id="5595447">=</span>&nbsp;<span class="op" id="5595449">&amp;</span><span class="ident" id="5595450">wireType</span><span class="op" id="5595458">{</span><span class="ident" id="5595459">GobEncoderT</span><span class="op" id="5595470">:</span>&nbsp;<span class="ident" id="5595472">gt</span><span class="op" id="5595474">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595478">case</span>&nbsp;<span class="ident" id="5595483">xBinary</span><span class="op" id="5595490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595495">info</span><span class="op" id="5595499">.</span><span class="ident" id="5595500">wire</span>&nbsp;<span class="op" id="5595505">=</span>&nbsp;<span class="op" id="5595507">&amp;</span><span class="ident" id="5595508">wireType</span><span class="op" id="5595516">{</span><span class="ident" id="5595517">BinaryMarshalerT</span><span class="op" id="5595533">:</span>&nbsp;<span class="ident" id="5595535">gt</span><span class="op" id="5595537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595541">case</span>&nbsp;<span class="ident" id="5595546">xText</span><span class="op" id="5595551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595556">info</span><span class="op" id="5595560">.</span><span class="ident" id="5595561">wire</span>&nbsp;<span class="op" id="5595566">=</span>&nbsp;<span class="op" id="5595568">&amp;</span><span class="ident" id="5595569">wireType</span><span class="op" id="5595577">{</span><span class="ident" id="5595578">TextMarshalerT</span><span class="op" id="5595592">:</span>&nbsp;<span class="ident" id="5595594">gt</span><span class="op" id="5595596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595600">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595604">rt</span>&nbsp;<span class="op" id="5595607">=</span>&nbsp;<span class="ident" id="5595609">ut</span><span class="op" id="5595611">.</span><span class="ident" id="5595612">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595618">}</span>&nbsp;<span class="keyword" id="5595620">else</span>&nbsp;<span class="op" id="5595625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595629">t</span>&nbsp;<span class="op" id="5595631">:=</span>&nbsp;<span class="ident" id="5595634">info</span><span class="op" id="5595638">.</span><span class="ident" id="5595639">id</span><span class="op" id="5595641">.</span><span class="ident" id="5595642">gobType</span><span class="op" id="5595649">(</span><span class="op" id="5595650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595654">switch</span>&nbsp;<span class="ident" id="5595661">typ</span>&nbsp;<span class="op" id="5595665">:=</span>&nbsp;<span class="ident" id="5595668">rt</span><span class="op" id="5595670">;</span>&nbsp;<span class="ident" id="5595672">typ</span><span class="op" id="5595675">.</span><span class="ident" id="5595676">Kind</span><span class="op" id="5595680">(</span><span class="op" id="5595681">)</span>&nbsp;<span class="op" id="5595683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595687">case</span>&nbsp;<span class="ident" id="5595692">reflect</span><span class="op" id="5595699">.</span><span class="ident" id="5595700">Array</span><span class="op" id="5595705">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595710">info</span><span class="op" id="5595714">.</span><span class="ident" id="5595715">wire</span>&nbsp;<span class="op" id="5595720">=</span>&nbsp;<span class="op" id="5595722">&amp;</span><span class="ident" id="5595723">wireType</span><span class="op" id="5595731">{</span><span class="ident" id="5595732">ArrayT</span><span class="op" id="5595738">:</span>&nbsp;<span class="ident" id="5595740">t</span><span class="op" id="5595741">.</span><span class="op" id="5595742">(</span><span class="op" id="5595743">*</span><span class="ident" id="5595744">arrayType</span><span class="op" id="5595753">)</span><span class="op" id="5595754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595758">case</span>&nbsp;<span class="ident" id="5595763">reflect</span><span class="op" id="5595770">.</span><span class="ident" id="5595771">Map</span><span class="op" id="5595774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595779">info</span><span class="op" id="5595783">.</span><span class="ident" id="5595784">wire</span>&nbsp;<span class="op" id="5595789">=</span>&nbsp;<span class="op" id="5595791">&amp;</span><span class="ident" id="5595792">wireType</span><span class="op" id="5595800">{</span><span class="ident" id="5595801">MapT</span><span class="op" id="5595805">:</span>&nbsp;<span class="ident" id="5595807">t</span><span class="op" id="5595808">.</span><span class="op" id="5595809">(</span><span class="op" id="5595810">*</span><span class="ident" id="5595811">mapType</span><span class="op" id="5595818">)</span><span class="op" id="5595819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595823">case</span>&nbsp;<span class="ident" id="5595828">reflect</span><span class="op" id="5595835">.</span><span class="ident" id="5595836">Slice</span><span class="op" id="5595841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5595846">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595907">if</span>&nbsp;<span class="ident" id="5595910">typ</span><span class="op" id="5595913">.</span><span class="ident" id="5595914">Elem</span><span class="op" id="5595918">(</span><span class="op" id="5595919">)</span><span class="op" id="5595920">.</span><span class="ident" id="5595921">Kind</span><span class="op" id="5595925">(</span><span class="op" id="5595926">)</span>&nbsp;<span class="op" id="5595928">!=</span>&nbsp;<span class="ident" id="5595931">reflect</span><span class="op" id="5595938">.</span><span class="ident" id="5595939">Uint8</span>&nbsp;<span class="op" id="5595945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595951">info</span><span class="op" id="5595955">.</span><span class="ident" id="5595956">wire</span>&nbsp;<span class="op" id="5595961">=</span>&nbsp;<span class="op" id="5595963">&amp;</span><span class="ident" id="5595964">wireType</span><span class="op" id="5595972">{</span><span class="ident" id="5595973">SliceT</span><span class="op" id="5595979">:</span>&nbsp;<span class="ident" id="5595981">t</span><span class="op" id="5595982">.</span><span class="op" id="5595983">(</span><span class="op" id="5595984">*</span><span class="ident" id="5595985">sliceType</span><span class="op" id="5595994">)</span><span class="op" id="5595995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596004">case</span>&nbsp;<span class="ident" id="5596009">reflect</span><span class="op" id="5596016">.</span><span class="ident" id="5596017">Struct</span><span class="op" id="5596023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596028">info</span><span class="op" id="5596032">.</span><span class="ident" id="5596033">wire</span>&nbsp;<span class="op" id="5596038">=</span>&nbsp;<span class="op" id="5596040">&amp;</span><span class="ident" id="5596041">wireType</span><span class="op" id="5596049">{</span><span class="ident" id="5596050">StructT</span><span class="op" id="5596057">:</span>&nbsp;<span class="ident" id="5596059">t</span><span class="op" id="5596060">.</span><span class="op" id="5596061">(</span><span class="op" id="5596062">*</span><span class="ident" id="5596063">structType</span><span class="op" id="5596073">)</span><span class="op" id="5596074">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5596085">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596138">newm</span>&nbsp;<span class="op" id="5596143">:=</span>&nbsp;<span class="builtinfunc" id="5596146">make</span><span class="op" id="5596150">(</span><span class="keyword" id="5596151">map</span><span class="op" id="5596154">[</span><span class="ident" id="5596155">reflect</span><span class="op" id="5596162">.</span><span class="ident" id="5596163">Type</span><span class="op" id="5596167">]</span><span class="op" id="5596168">*</span><span class="ident" id="5596169">typeInfo</span><span class="op" id="5596177">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596180">m</span><span class="op" id="5596181">,</span>&nbsp;<span class="ident" id="5596183">_</span>&nbsp;<span class="op" id="5596185">:=</span>&nbsp;<span class="ident" id="5596188">typeInfoMap</span><span class="op" id="5596199">.</span><span class="ident" id="5596200">Load</span><span class="op" id="5596204">(</span><span class="op" id="5596205">)</span><span class="op" id="5596206">.</span><span class="op" id="5596207">(</span><span class="keyword" id="5596208">map</span><span class="op" id="5596211">[</span><span class="ident" id="5596212">reflect</span><span class="op" id="5596219">.</span><span class="ident" id="5596220">Type</span><span class="op" id="5596224">]</span><span class="op" id="5596225">*</span><span class="ident" id="5596226">typeInfo</span><span class="op" id="5596234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596237">for</span>&nbsp;<span class="ident" id="5596241">k</span><span class="op" id="5596242">,</span>&nbsp;<span class="ident" id="5596244">v</span>&nbsp;<span class="op" id="5596246">:=</span>&nbsp;<span class="keyword" id="5596249">range</span>&nbsp;<span class="ident" id="5596255">m</span>&nbsp;<span class="op" id="5596257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596261">newm</span><span class="op" id="5596265">[</span><span class="ident" id="5596266">k</span><span class="op" id="5596267">]</span>&nbsp;<span class="op" id="5596269">=</span>&nbsp;<span class="ident" id="5596271">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596277">newm</span><span class="op" id="5596281">[</span><span class="ident" id="5596282">rt</span><span class="op" id="5596284">]</span>&nbsp;<span class="op" id="5596286">=</span>&nbsp;<span class="ident" id="5596288">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596294">typeInfoMap</span><span class="op" id="5596305">.</span><span class="ident" id="5596306">Store</span><span class="op" id="5596311">(</span><span class="ident" id="5596312">newm</span><span class="op" id="5596316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596319">return</span>&nbsp;<span class="ident" id="5596326">info</span><span class="op" id="5596330">,</span>&nbsp;<span class="builtintype" id="5596332">nil</span><br>
<span class="lineno"></span><span class="op" id="5596336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596339">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5596397">func</span>&nbsp;<span class="ident" id="5596402">mustGetTypeInfo</span><span class="op" id="5596417">(</span><span class="ident" id="5596418">rt</span>&nbsp;<span class="ident" id="5596421">reflect</span><span class="op" id="5596428">.</span><span class="ident" id="5596429">Type</span><span class="op" id="5596433">)</span>&nbsp;<span class="op" id="5596435">*</span><span class="ident" id="5596436">typeInfo</span>&nbsp;<span class="op" id="5596445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596448">t</span><span class="op" id="5596449">,</span>&nbsp;<span class="ident" id="5596451">err</span>&nbsp;<span class="op" id="5596455">:=</span>&nbsp;<span class="ident" id="5596458">getTypeInfo</span><span class="op" id="5596469">(</span><span class="ident" id="5596470">userType</span><span class="op" id="5596478">(</span><span class="ident" id="5596479">rt</span><span class="op" id="5596481">)</span><span class="op" id="5596482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596485">if</span>&nbsp;<span class="ident" id="5596488">err</span>&nbsp;<span class="op" id="5596492">!=</span>&nbsp;<span class="builtintype" id="5596495">nil</span>&nbsp;<span class="op" id="5596499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5596503">panic</span><span class="op" id="5596508">(</span><span class="string" id="5596509">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5596525">+</span>&nbsp;<span class="ident" id="5596527">err</span><span class="op" id="5596530">.</span><span class="ident" id="5596531">Error</span><span class="op" id="5596536">(</span><span class="op" id="5596537">)</span><span class="op" id="5596538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596541">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596544">return</span>&nbsp;<span class="ident" id="5596551">t</span><br>
<span class="lineno"></span><span class="op" id="5596553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596556">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5596625">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5596697">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5596762">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5596827">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5596894">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5596949">//</span><br>
<span class="lineno">790</span><span class="comment" id="5596952">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5597017">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5597084">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5597154">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5597202">type</span>&nbsp;<span class="ident" id="5597207">GobEncoder</span>&nbsp;<span class="keyword" id="5597218">interface</span>&nbsp;<span class="op" id="5597228">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597231">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597299">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597366">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597385">GobEncode</span><span class="op" id="5597394">(</span><span class="op" id="5597395">)</span>&nbsp;<span class="op" id="5597397">(</span><span class="op" id="5597398">[</span><span class="op" id="5597399">]</span><span class="builtintype" id="5597400">byte</span><span class="op" id="5597404">,</span>&nbsp;<span class="builtintype" id="5597406">error</span><span class="op" id="5597411">)</span><br>
<span class="lineno"></span><span class="op" id="5597413">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5597416">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5597485">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5597550">type</span>&nbsp;<span class="ident" id="5597555">GobDecoder</span>&nbsp;<span class="keyword" id="5597566">interface</span>&nbsp;<span class="op" id="5597576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597579">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597643">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597711">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597765">GobDecode</span><span class="op" id="5597774">(</span><span class="op" id="5597775">[</span><span class="op" id="5597776">]</span><span class="builtintype" id="5597777">byte</span><span class="op" id="5597781">)</span>&nbsp;<span class="builtintype" id="5597783">error</span><br>
<span class="lineno"></span><span class="op" id="5597789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5597792">var</span>&nbsp;<span class="op" id="5597796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597799">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597818">sync</span><span class="op" id="5597822">.</span><span class="ident" id="5597823">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597832">nameToConcreteType</span>&nbsp;<span class="op" id="5597851">=</span>&nbsp;<span class="builtinfunc" id="5597853">make</span><span class="op" id="5597857">(</span><span class="keyword" id="5597858">map</span><span class="op" id="5597861">[</span><span class="builtintype" id="5597862">string</span><span class="op" id="5597868">]</span><span class="ident" id="5597869">reflect</span><span class="op" id="5597876">.</span><span class="ident" id="5597877">Type</span><span class="op" id="5597881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597884">concreteTypeToName</span>&nbsp;<span class="op" id="5597903">=</span>&nbsp;<span class="builtinfunc" id="5597905">make</span><span class="op" id="5597909">(</span><span class="keyword" id="5597910">map</span><span class="op" id="5597913">[</span><span class="ident" id="5597914">reflect</span><span class="op" id="5597921">.</span><span class="ident" id="5597922">Type</span><span class="op" id="5597926">]</span><span class="builtintype" id="5597927">string</span><span class="op" id="5597933">)</span><br>
<span class="lineno"></span><span class="op" id="5597935">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5597938">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5598014">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5598033">func</span>&nbsp;<span class="ident" id="5598038">RegisterName</span><span class="op" id="5598050">(</span><span class="ident" id="5598051">name</span>&nbsp;<span class="builtintype" id="5598056">string</span><span class="op" id="5598062">,</span>&nbsp;<span class="ident" id="5598064">value</span>&nbsp;<span class="keyword" id="5598070">interface</span><span class="op" id="5598079">{</span><span class="op" id="5598080">}</span><span class="op" id="5598081">)</span>&nbsp;<span class="op" id="5598083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598086">if</span>&nbsp;<span class="ident" id="5598089">name</span>&nbsp;<span class="op" id="5598094">==</span>&nbsp;<span class="string" id="5598097">&#34;&#34;</span>&nbsp;<span class="op" id="5598100">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598104">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5598126">panic</span><span class="op" id="5598131">(</span><span class="string" id="5598132">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5598164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598170">registerLock</span><span class="op" id="5598182">.</span><span class="ident" id="5598183">Lock</span><span class="op" id="5598187">(</span><span class="op" id="5598188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598191">defer</span>&nbsp;<span class="ident" id="5598197">registerLock</span><span class="op" id="5598209">.</span><span class="ident" id="5598210">Unlock</span><span class="op" id="5598216">(</span><span class="op" id="5598217">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598220">ut</span>&nbsp;<span class="op" id="5598223">:=</span>&nbsp;<span class="ident" id="5598226">userType</span><span class="op" id="5598234">(</span><span class="ident" id="5598235">reflect</span><span class="op" id="5598242">.</span><span class="ident" id="5598243">TypeOf</span><span class="op" id="5598249">(</span><span class="ident" id="5598250">value</span><span class="op" id="5598255">)</span><span class="op" id="5598256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598259">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598325">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598361">if</span>&nbsp;<span class="ident" id="5598364">t</span><span class="op" id="5598365">,</span>&nbsp;<span class="ident" id="5598367">ok</span>&nbsp;<span class="op" id="5598370">:=</span>&nbsp;<span class="ident" id="5598373">nameToConcreteType</span><span class="op" id="5598391">[</span><span class="ident" id="5598392">name</span><span class="op" id="5598396">]</span><span class="op" id="5598397">;</span>&nbsp;<span class="ident" id="5598399">ok</span>&nbsp;<span class="op" id="5598402">&amp;&amp;</span>&nbsp;<span class="ident" id="5598405">t</span>&nbsp;<span class="op" id="5598407">!=</span>&nbsp;<span class="ident" id="5598410">ut</span><span class="op" id="5598412">.</span><span class="ident" id="5598413">user</span>&nbsp;<span class="op" id="5598418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5598422">panic</span><span class="op" id="5598427">(</span><span class="ident" id="5598428">fmt</span><span class="op" id="5598431">.</span><span class="ident" id="5598432">Sprintf</span><span class="op" id="5598439">(</span><span class="string" id="5598440">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5598491">,</span>&nbsp;<span class="ident" id="5598493">name</span><span class="op" id="5598497">,</span>&nbsp;<span class="ident" id="5598499">t</span><span class="op" id="5598500">,</span>&nbsp;<span class="ident" id="5598502">ut</span><span class="op" id="5598504">.</span><span class="ident" id="5598505">user</span><span class="op" id="5598509">)</span><span class="op" id="5598510">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598516">if</span>&nbsp;<span class="ident" id="5598519">n</span><span class="op" id="5598520">,</span>&nbsp;<span class="ident" id="5598522">ok</span>&nbsp;<span class="op" id="5598525">:=</span>&nbsp;<span class="ident" id="5598528">concreteTypeToName</span><span class="op" id="5598546">[</span><span class="ident" id="5598547">ut</span><span class="op" id="5598549">.</span><span class="ident" id="5598550">base</span><span class="op" id="5598554">]</span><span class="op" id="5598555">;</span>&nbsp;<span class="ident" id="5598557">ok</span>&nbsp;<span class="op" id="5598560">&amp;&amp;</span>&nbsp;<span class="ident" id="5598563">n</span>&nbsp;<span class="op" id="5598565">!=</span>&nbsp;<span class="ident" id="5598568">name</span>&nbsp;<span class="op" id="5598573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5598577">panic</span><span class="op" id="5598582">(</span><span class="ident" id="5598583">fmt</span><span class="op" id="5598586">.</span><span class="ident" id="5598587">Sprintf</span><span class="op" id="5598594">(</span><span class="string" id="5598595">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5598646">,</span>&nbsp;<span class="ident" id="5598648">ut</span><span class="op" id="5598650">.</span><span class="ident" id="5598651">user</span><span class="op" id="5598655">,</span>&nbsp;<span class="ident" id="5598657">n</span><span class="op" id="5598658">,</span>&nbsp;<span class="ident" id="5598660">name</span><span class="op" id="5598664">)</span><span class="op" id="5598665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598671">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598724">nameToConcreteType</span><span class="op" id="5598742">[</span><span class="ident" id="5598743">name</span><span class="op" id="5598747">]</span>&nbsp;<span class="op" id="5598749">=</span>&nbsp;<span class="ident" id="5598751">reflect</span><span class="op" id="5598758">.</span><span class="ident" id="5598759">TypeOf</span><span class="op" id="5598765">(</span><span class="ident" id="5598766">value</span><span class="op" id="5598771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598774">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598852">concreteTypeToName</span><span class="op" id="5598870">[</span><span class="ident" id="5598871">ut</span><span class="op" id="5598873">.</span><span class="ident" id="5598874">base</span><span class="op" id="5598878">]</span>&nbsp;<span class="op" id="5598880">=</span>&nbsp;<span class="ident" id="5598882">name</span><br>
<span class="lineno"></span><span class="op" id="5598887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5598890">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5598965">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5599042">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5599113">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5599190">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5599267">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5599314">func</span>&nbsp;<span class="ident" id="5599319">Register</span><span class="op" id="5599327">(</span><span class="ident" id="5599328">value</span>&nbsp;<span class="keyword" id="5599334">interface</span><span class="op" id="5599343">{</span><span class="op" id="5599344">}</span><span class="op" id="5599345">)</span>&nbsp;<span class="op" id="5599347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599350">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599406">rt</span>&nbsp;<span class="op" id="5599409">:=</span>&nbsp;<span class="ident" id="5599412">reflect</span><span class="op" id="5599419">.</span><span class="ident" id="5599420">TypeOf</span><span class="op" id="5599426">(</span><span class="ident" id="5599427">value</span><span class="op" id="5599432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599435">name</span>&nbsp;<span class="op" id="5599440">:=</span>&nbsp;<span class="ident" id="5599443">rt</span><span class="op" id="5599445">.</span><span class="ident" id="5599446">String</span><span class="op" id="5599452">(</span><span class="op" id="5599453">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599457">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599554">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599608">star</span>&nbsp;<span class="op" id="5599613">:=</span>&nbsp;<span class="string" id="5599616">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599620">if</span>&nbsp;<span class="ident" id="5599623">rt</span><span class="op" id="5599625">.</span><span class="ident" id="5599626">Name</span><span class="op" id="5599630">(</span><span class="op" id="5599631">)</span>&nbsp;<span class="op" id="5599633">==</span>&nbsp;<span class="string" id="5599636">&#34;&#34;</span>&nbsp;<span class="op" id="5599639">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599643">if</span>&nbsp;<span class="ident" id="5599646">pt</span>&nbsp;<span class="op" id="5599649">:=</span>&nbsp;<span class="ident" id="5599652">rt</span><span class="op" id="5599654">;</span>&nbsp;<span class="ident" id="5599656">pt</span><span class="op" id="5599658">.</span><span class="ident" id="5599659">Kind</span><span class="op" id="5599663">(</span><span class="op" id="5599664">)</span>&nbsp;<span class="op" id="5599666">==</span>&nbsp;<span class="ident" id="5599669">reflect</span><span class="op" id="5599676">.</span><span class="ident" id="5599677">Ptr</span>&nbsp;<span class="op" id="5599681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599686">star</span>&nbsp;<span class="op" id="5599691">=</span>&nbsp;<span class="string" id="5599693">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599700">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599769">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599846">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599872">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599878">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599965">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599998">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600068">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600090">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600096">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600145">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600151">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600196">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600237">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600243">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600327">rt</span>&nbsp;<span class="op" id="5600330">=</span>&nbsp;<span class="ident" id="5600332">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600337">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600343">if</span>&nbsp;<span class="ident" id="5600346">rt</span><span class="op" id="5600348">.</span><span class="ident" id="5600349">Name</span><span class="op" id="5600353">(</span><span class="op" id="5600354">)</span>&nbsp;<span class="op" id="5600356">!=</span>&nbsp;<span class="string" id="5600359">&#34;&#34;</span>&nbsp;<span class="op" id="5600362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600366">if</span>&nbsp;<span class="ident" id="5600369">rt</span><span class="op" id="5600371">.</span><span class="ident" id="5600372">PkgPath</span><span class="op" id="5600379">(</span><span class="op" id="5600380">)</span>&nbsp;<span class="op" id="5600382">==</span>&nbsp;<span class="string" id="5600385">&#34;&#34;</span>&nbsp;<span class="op" id="5600388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600393">name</span>&nbsp;<span class="op" id="5600398">=</span>&nbsp;<span class="ident" id="5600400">star</span>&nbsp;<span class="op" id="5600405">+</span>&nbsp;<span class="ident" id="5600407">rt</span><span class="op" id="5600409">.</span><span class="ident" id="5600410">Name</span><span class="op" id="5600414">(</span><span class="op" id="5600415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600419">}</span>&nbsp;<span class="keyword" id="5600421">else</span>&nbsp;<span class="op" id="5600426">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600431">name</span>&nbsp;<span class="op" id="5600436">=</span>&nbsp;<span class="ident" id="5600438">star</span>&nbsp;<span class="op" id="5600443">+</span>&nbsp;<span class="ident" id="5600445">rt</span><span class="op" id="5600447">.</span><span class="ident" id="5600448">PkgPath</span><span class="op" id="5600455">(</span><span class="op" id="5600456">)</span>&nbsp;<span class="op" id="5600458">+</span>&nbsp;<span class="string" id="5600460">&#34;.&#34;</span>&nbsp;<span class="op" id="5600464">+</span>&nbsp;<span class="ident" id="5600466">rt</span><span class="op" id="5600468">.</span><span class="ident" id="5600469">Name</span><span class="op" id="5600473">(</span><span class="op" id="5600474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600485">RegisterName</span><span class="op" id="5600497">(</span><span class="ident" id="5600498">name</span><span class="op" id="5600502">,</span>&nbsp;<span class="ident" id="5600504">value</span><span class="op" id="5600509">)</span><br>
<span class="lineno">885</span><span class="op" id="5600511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600514">func</span>&nbsp;<span class="ident" id="5600519">registerBasics</span><span class="op" id="5600533">(</span><span class="op" id="5600534">)</span>&nbsp;<span class="op" id="5600536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600539">Register</span><span class="op" id="5600547">(</span><span class="builtintype" id="5600548">int</span><span class="op" id="5600551">(</span><span class="num" id="5600552">0</span><span class="op" id="5600553">)</span><span class="op" id="5600554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600557">Register</span><span class="op" id="5600565">(</span><span class="builtintype" id="5600566">int8</span><span class="op" id="5600570">(</span><span class="num" id="5600571">0</span><span class="op" id="5600572">)</span><span class="op" id="5600573">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600576">Register</span><span class="op" id="5600584">(</span><span class="builtintype" id="5600585">int16</span><span class="op" id="5600590">(</span><span class="num" id="5600591">0</span><span class="op" id="5600592">)</span><span class="op" id="5600593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600596">Register</span><span class="op" id="5600604">(</span><span class="builtintype" id="5600605">int32</span><span class="op" id="5600610">(</span><span class="num" id="5600611">0</span><span class="op" id="5600612">)</span><span class="op" id="5600613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600616">Register</span><span class="op" id="5600624">(</span><span class="ident" id="5600625">int64</span><span class="op" id="5600630">(</span><span class="num" id="5600631">0</span><span class="op" id="5600632">)</span><span class="op" id="5600633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600636">Register</span><span class="op" id="5600644">(</span><span class="builtintype" id="5600645">uint</span><span class="op" id="5600649">(</span><span class="num" id="5600650">0</span><span class="op" id="5600651">)</span><span class="op" id="5600652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600655">Register</span><span class="op" id="5600663">(</span><span class="builtintype" id="5600664">uint8</span><span class="op" id="5600669">(</span><span class="num" id="5600670">0</span><span class="op" id="5600671">)</span><span class="op" id="5600672">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600675">Register</span><span class="op" id="5600683">(</span><span class="builtintype" id="5600684">uint16</span><span class="op" id="5600690">(</span><span class="num" id="5600691">0</span><span class="op" id="5600692">)</span><span class="op" id="5600693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600696">Register</span><span class="op" id="5600704">(</span><span class="builtintype" id="5600705">uint32</span><span class="op" id="5600711">(</span><span class="num" id="5600712">0</span><span class="op" id="5600713">)</span><span class="op" id="5600714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600717">Register</span><span class="op" id="5600725">(</span><span class="ident" id="5600726">uint64</span><span class="op" id="5600732">(</span><span class="num" id="5600733">0</span><span class="op" id="5600734">)</span><span class="op" id="5600735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600738">Register</span><span class="op" id="5600746">(</span><span class="builtintype" id="5600747">float32</span><span class="op" id="5600754">(</span><span class="num" id="5600755">0</span><span class="op" id="5600756">)</span><span class="op" id="5600757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600760">Register</span><span class="op" id="5600768">(</span><span class="builtintype" id="5600769">float64</span><span class="op" id="5600776">(</span><span class="num" id="5600777">0</span><span class="op" id="5600778">)</span><span class="op" id="5600779">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600782">Register</span><span class="op" id="5600790">(</span><span class="builtintype" id="5600791">complex64</span><span class="op" id="5600800">(</span><span class="num" id="5600801">0i</span><span class="op" id="5600803">)</span><span class="op" id="5600804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600807">Register</span><span class="op" id="5600815">(</span><span class="builtintype" id="5600816">complex128</span><span class="op" id="5600826">(</span><span class="num" id="5600827">0i</span><span class="op" id="5600829">)</span><span class="op" id="5600830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600833">Register</span><span class="op" id="5600841">(</span><span class="builtintype" id="5600842">uintptr</span><span class="op" id="5600849">(</span><span class="num" id="5600850">0</span><span class="op" id="5600851">)</span><span class="op" id="5600852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600855">Register</span><span class="op" id="5600863">(</span><span class="builtintype" id="5600864">false</span><span class="op" id="5600869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600872">Register</span><span class="op" id="5600880">(</span><span class="string" id="5600881">&#34;&#34;</span><span class="op" id="5600883">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600886">Register</span><span class="op" id="5600894">(</span><span class="op" id="5600895">[</span><span class="op" id="5600896">]</span><span class="builtintype" id="5600897">byte</span><span class="op" id="5600901">(</span><span class="builtintype" id="5600902">nil</span><span class="op" id="5600905">)</span><span class="op" id="5600906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600909">Register</span><span class="op" id="5600917">(</span><span class="op" id="5600918">[</span><span class="op" id="5600919">]</span><span class="builtintype" id="5600920">int</span><span class="op" id="5600923">(</span><span class="builtintype" id="5600924">nil</span><span class="op" id="5600927">)</span><span class="op" id="5600928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600931">Register</span><span class="op" id="5600939">(</span><span class="op" id="5600940">[</span><span class="op" id="5600941">]</span><span class="builtintype" id="5600942">int8</span><span class="op" id="5600946">(</span><span class="builtintype" id="5600947">nil</span><span class="op" id="5600950">)</span><span class="op" id="5600951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600954">Register</span><span class="op" id="5600962">(</span><span class="op" id="5600963">[</span><span class="op" id="5600964">]</span><span class="builtintype" id="5600965">int16</span><span class="op" id="5600970">(</span><span class="builtintype" id="5600971">nil</span><span class="op" id="5600974">)</span><span class="op" id="5600975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600978">Register</span><span class="op" id="5600986">(</span><span class="op" id="5600987">[</span><span class="op" id="5600988">]</span><span class="builtintype" id="5600989">int32</span><span class="op" id="5600994">(</span><span class="builtintype" id="5600995">nil</span><span class="op" id="5600998">)</span><span class="op" id="5600999">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601002">Register</span><span class="op" id="5601010">(</span><span class="op" id="5601011">[</span><span class="op" id="5601012">]</span><span class="ident" id="5601013">int64</span><span class="op" id="5601018">(</span><span class="builtintype" id="5601019">nil</span><span class="op" id="5601022">)</span><span class="op" id="5601023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601026">Register</span><span class="op" id="5601034">(</span><span class="op" id="5601035">[</span><span class="op" id="5601036">]</span><span class="builtintype" id="5601037">uint</span><span class="op" id="5601041">(</span><span class="builtintype" id="5601042">nil</span><span class="op" id="5601045">)</span><span class="op" id="5601046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601049">Register</span><span class="op" id="5601057">(</span><span class="op" id="5601058">[</span><span class="op" id="5601059">]</span><span class="builtintype" id="5601060">uint8</span><span class="op" id="5601065">(</span><span class="builtintype" id="5601066">nil</span><span class="op" id="5601069">)</span><span class="op" id="5601070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601073">Register</span><span class="op" id="5601081">(</span><span class="op" id="5601082">[</span><span class="op" id="5601083">]</span><span class="builtintype" id="5601084">uint16</span><span class="op" id="5601090">(</span><span class="builtintype" id="5601091">nil</span><span class="op" id="5601094">)</span><span class="op" id="5601095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601098">Register</span><span class="op" id="5601106">(</span><span class="op" id="5601107">[</span><span class="op" id="5601108">]</span><span class="builtintype" id="5601109">uint32</span><span class="op" id="5601115">(</span><span class="builtintype" id="5601116">nil</span><span class="op" id="5601119">)</span><span class="op" id="5601120">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601123">Register</span><span class="op" id="5601131">(</span><span class="op" id="5601132">[</span><span class="op" id="5601133">]</span><span class="ident" id="5601134">uint64</span><span class="op" id="5601140">(</span><span class="builtintype" id="5601141">nil</span><span class="op" id="5601144">)</span><span class="op" id="5601145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601148">Register</span><span class="op" id="5601156">(</span><span class="op" id="5601157">[</span><span class="op" id="5601158">]</span><span class="builtintype" id="5601159">float32</span><span class="op" id="5601166">(</span><span class="builtintype" id="5601167">nil</span><span class="op" id="5601170">)</span><span class="op" id="5601171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601174">Register</span><span class="op" id="5601182">(</span><span class="op" id="5601183">[</span><span class="op" id="5601184">]</span><span class="builtintype" id="5601185">float64</span><span class="op" id="5601192">(</span><span class="builtintype" id="5601193">nil</span><span class="op" id="5601196">)</span><span class="op" id="5601197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601200">Register</span><span class="op" id="5601208">(</span><span class="op" id="5601209">[</span><span class="op" id="5601210">]</span><span class="builtintype" id="5601211">complex64</span><span class="op" id="5601220">(</span><span class="builtintype" id="5601221">nil</span><span class="op" id="5601224">)</span><span class="op" id="5601225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601228">Register</span><span class="op" id="5601236">(</span><span class="op" id="5601237">[</span><span class="op" id="5601238">]</span><span class="builtintype" id="5601239">complex128</span><span class="op" id="5601249">(</span><span class="builtintype" id="5601250">nil</span><span class="op" id="5601253">)</span><span class="op" id="5601254">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601257">Register</span><span class="op" id="5601265">(</span><span class="op" id="5601266">[</span><span class="op" id="5601267">]</span><span class="builtintype" id="5601268">uintptr</span><span class="op" id="5601275">(</span><span class="builtintype" id="5601276">nil</span><span class="op" id="5601279">)</span><span class="op" id="5601280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601283">Register</span><span class="op" id="5601291">(</span><span class="op" id="5601292">[</span><span class="op" id="5601293">]</span><span class="builtintype" id="5601294">bool</span><span class="op" id="5601298">(</span><span class="builtintype" id="5601299">nil</span><span class="op" id="5601302">)</span><span class="op" id="5601303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601306">Register</span><span class="op" id="5601314">(</span><span class="op" id="5601315">[</span><span class="op" id="5601316">]</span><span class="builtintype" id="5601317">string</span><span class="op" id="5601323">(</span><span class="builtintype" id="5601324">nil</span><span class="op" id="5601327">)</span><span class="op" id="5601328">)</span><br>
<span class="lineno"></span><span class="op" id="5601330">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
