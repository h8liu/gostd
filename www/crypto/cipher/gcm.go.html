<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3843839">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3843894">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3843948">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3843999">package</span>&nbsp;<span class="ident" id="3844007">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3844015">import</span>&nbsp;<span class="op" id="3844022">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3844025">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3844042">&#34;errors&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3844051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3844054">//&nbsp;AEAD&nbsp;is&nbsp;a&nbsp;cipher&nbsp;mode&nbsp;providing&nbsp;authenticated&nbsp;encryption&nbsp;with&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3844130">//&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3844139">type</span>&nbsp;<span class="ident" id="3844144">AEAD</span>&nbsp;<span class="keyword" id="3844149">interface</span>&nbsp;<span class="op" id="3844159">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844162">//&nbsp;NonceSize&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;nonce&nbsp;that&nbsp;must&nbsp;be&nbsp;passed&nbsp;to&nbsp;Seal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844234">//&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844248">NonceSize</span><span class="op" id="3844257">(</span><span class="op" id="3844258">)</span>&nbsp;<span class="builtintype" id="3844260">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844266">//&nbsp;Overhead&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;difference&nbsp;between&nbsp;the&nbsp;lengths&nbsp;of&nbsp;a</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844335">//&nbsp;plaintext&nbsp;and&nbsp;ciphertext.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844365">Overhead</span><span class="op" id="3844373">(</span><span class="op" id="3844374">)</span>&nbsp;<span class="builtintype" id="3844376">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844382">//&nbsp;Seal&nbsp;encrypts&nbsp;and&nbsp;authenticates&nbsp;plaintext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844447">//&nbsp;additional&nbsp;data&nbsp;and&nbsp;appends&nbsp;the&nbsp;result&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844520">//&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()&nbsp;bytes&nbsp;long&nbsp;and&nbsp;unique&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844591">//&nbsp;time,&nbsp;for&nbsp;a&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844618">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844622">//&nbsp;The&nbsp;plaintext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844681">Seal</span><span class="op" id="3844685">(</span><span class="ident" id="3844686">dst</span><span class="op" id="3844689">,</span>&nbsp;<span class="ident" id="3844691">nonce</span><span class="op" id="3844696">,</span>&nbsp;<span class="ident" id="3844698">plaintext</span><span class="op" id="3844707">,</span>&nbsp;<span class="ident" id="3844709">data</span>&nbsp;<span class="op" id="3844714">[</span><span class="op" id="3844715">]</span><span class="builtintype" id="3844716">byte</span><span class="op" id="3844720">)</span>&nbsp;<span class="op" id="3844722">[</span><span class="op" id="3844723">]</span><span class="builtintype" id="3844724">byte</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844731">//&nbsp;Open&nbsp;decrypts&nbsp;and&nbsp;authenticates&nbsp;ciphertext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844797">//&nbsp;additional&nbsp;data&nbsp;and,&nbsp;if&nbsp;successful,&nbsp;appends&nbsp;the&nbsp;resulting&nbsp;plaintext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844869">//&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844940">//&nbsp;bytes&nbsp;long&nbsp;and&nbsp;both&nbsp;it&nbsp;and&nbsp;the&nbsp;additional&nbsp;data&nbsp;must&nbsp;match&nbsp;the</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845006">//&nbsp;value&nbsp;passed&nbsp;to&nbsp;Seal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845032">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845036">//&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845096">Open</span><span class="op" id="3845100">(</span><span class="ident" id="3845101">dst</span><span class="op" id="3845104">,</span>&nbsp;<span class="ident" id="3845106">nonce</span><span class="op" id="3845111">,</span>&nbsp;<span class="ident" id="3845113">ciphertext</span><span class="op" id="3845123">,</span>&nbsp;<span class="ident" id="3845125">data</span>&nbsp;<span class="op" id="3845130">[</span><span class="op" id="3845131">]</span><span class="builtintype" id="3845132">byte</span><span class="op" id="3845136">)</span>&nbsp;<span class="op" id="3845138">(</span><span class="op" id="3845139">[</span><span class="op" id="3845140">]</span><span class="builtintype" id="3845141">byte</span><span class="op" id="3845145">,</span>&nbsp;<span class="builtintype" id="3845147">error</span><span class="op" id="3845152">)</span><br>
<span class="lineno"></span><span class="op" id="3845154">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3845157">//&nbsp;gcmFieldElement&nbsp;represents&nbsp;a&nbsp;value&nbsp;in&nbsp;GF(2¹²⁸).&nbsp;In&nbsp;order&nbsp;to&nbsp;reflect&nbsp;the&nbsp;GCM</span><br>
<span class="lineno"></span><span class="comment" id="3845240">//&nbsp;standard&nbsp;and&nbsp;make&nbsp;getUint64&nbsp;suitable&nbsp;for&nbsp;marshaling&nbsp;these&nbsp;values,&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3845318">//&nbsp;are&nbsp;stored&nbsp;backwards.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="3845356">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁰&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno">45</span><span class="comment" id="3845417">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶³&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="3845478">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶⁴&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3845543">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x¹²⁷&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3845607">type</span>&nbsp;<span class="ident" id="3845612">gcmFieldElement</span>&nbsp;<span class="keyword" id="3845628">struct</span>&nbsp;<span class="op" id="3845635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845638">low</span><span class="op" id="3845641">,</span>&nbsp;<span class="ident" id="3845643">high</span>&nbsp;<span class="ident" id="3845648">uint64</span><br>
<span class="lineno">50</span><span class="op" id="3845655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3845658">//&nbsp;gcm&nbsp;represents&nbsp;a&nbsp;Galois&nbsp;Counter&nbsp;Mode&nbsp;with&nbsp;a&nbsp;specific&nbsp;key.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3845723">//&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3845818">type</span>&nbsp;<span class="ident" id="3845823">gcm</span>&nbsp;<span class="keyword" id="3845827">struct</span>&nbsp;<span class="op" id="3845834">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845837">cipher</span>&nbsp;<span class="ident" id="3845844">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845851">//&nbsp;productTable&nbsp;contains&nbsp;the&nbsp;first&nbsp;sixteen&nbsp;powers&nbsp;of&nbsp;the&nbsp;key,&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845917">//&nbsp;However,&nbsp;they&nbsp;are&nbsp;in&nbsp;bit&nbsp;reversed&nbsp;order.&nbsp;See&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845974">productTable</span>&nbsp;<span class="op" id="3845987">[</span><span class="num" id="3845988">16</span><span class="op" id="3845990">]</span><span class="ident" id="3845991">gcmFieldElement</span><br>
<span class="lineno"></span><span class="op" id="3846007">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3846010">//&nbsp;NewGCM&nbsp;returns&nbsp;the&nbsp;given&nbsp;128-bit,&nbsp;block&nbsp;cipher&nbsp;wrapped&nbsp;in&nbsp;Galois&nbsp;Counter&nbsp;Mode.</span><br>
<span class="lineno"></span><span class="keyword" id="3846092">func</span>&nbsp;<span class="ident" id="3846097">NewGCM</span><span class="op" id="3846103">(</span><span class="ident" id="3846104">cipher</span>&nbsp;<span class="ident" id="3846111">Block</span><span class="op" id="3846116">)</span>&nbsp;<span class="op" id="3846118">(</span><span class="ident" id="3846119">AEAD</span><span class="op" id="3846123">,</span>&nbsp;<span class="builtintype" id="3846125">error</span><span class="op" id="3846130">)</span>&nbsp;<span class="op" id="3846132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3846135">if</span>&nbsp;<span class="ident" id="3846138">cipher</span><span class="op" id="3846144">.</span><span class="ident" id="3846145">BlockSize</span><span class="op" id="3846154">(</span><span class="op" id="3846155">)</span>&nbsp;<span class="op" id="3846157">!=</span>&nbsp;<span class="ident" id="3846160">gcmBlockSize</span>&nbsp;<span class="op" id="3846173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3846177">return</span>&nbsp;<span class="ident" id="3846184">nil</span><span class="op" id="3846187">,</span>&nbsp;<span class="ident" id="3846189">errors</span><span class="op" id="3846195">.</span><span class="ident" id="3846196">New</span><span class="op" id="3846199">(</span><span class="string" id="3846200">&#34;cipher:&nbsp;NewGCM&nbsp;requires&nbsp;128-bit&nbsp;block&nbsp;cipher&#34;</span><span class="op" id="3846246">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3846249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3846253">var</span>&nbsp;<span class="ident" id="3846257">key</span>&nbsp;<span class="op" id="3846261">[</span><span class="ident" id="3846262">gcmBlockSize</span><span class="op" id="3846274">]</span><span class="builtintype" id="3846275">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846281">cipher</span><span class="op" id="3846287">.</span><span class="ident" id="3846288">Encrypt</span><span class="op" id="3846295">(</span><span class="ident" id="3846296">key</span><span class="op" id="3846299">[</span><span class="op" id="3846300">:</span><span class="op" id="3846301">]</span><span class="op" id="3846302">,</span>&nbsp;<span class="ident" id="3846304">key</span><span class="op" id="3846307">[</span><span class="op" id="3846308">:</span><span class="op" id="3846309">]</span><span class="op" id="3846310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846314">g</span>&nbsp;<span class="op" id="3846316">:=</span>&nbsp;<span class="op" id="3846319">&amp;</span><span class="ident" id="3846320">gcm</span><span class="op" id="3846323">{</span><span class="ident" id="3846324">cipher</span><span class="op" id="3846330">:</span>&nbsp;<span class="ident" id="3846332">cipher</span><span class="op" id="3846338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846342">//&nbsp;We&nbsp;precompute&nbsp;16&nbsp;multiples&nbsp;of&nbsp;|key|.&nbsp;However,&nbsp;when&nbsp;we&nbsp;do&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846411">//&nbsp;into&nbsp;this&nbsp;table&nbsp;we&#39;ll&nbsp;be&nbsp;using&nbsp;bits&nbsp;from&nbsp;a&nbsp;field&nbsp;element&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846476">//&nbsp;therefore&nbsp;the&nbsp;bits&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order.&nbsp;So&nbsp;normally&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846545">//&nbsp;would&nbsp;expect,&nbsp;say,&nbsp;4*key&nbsp;to&nbsp;be&nbsp;in&nbsp;index&nbsp;4&nbsp;of&nbsp;the&nbsp;table&nbsp;but&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846615">//&nbsp;this&nbsp;bit&nbsp;ordering&nbsp;it&nbsp;will&nbsp;actually&nbsp;be&nbsp;in&nbsp;index&nbsp;0010&nbsp;(base&nbsp;2)&nbsp;=&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846685">x</span>&nbsp;<span class="op" id="3846687">:=</span>&nbsp;<span class="ident" id="3846690">gcmFieldElement</span><span class="op" id="3846705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846709">getUint64</span><span class="op" id="3846718">(</span><span class="ident" id="3846719">key</span><span class="op" id="3846722">[</span><span class="op" id="3846723">:</span><span class="num" id="3846724">8</span><span class="op" id="3846725">]</span><span class="op" id="3846726">)</span><span class="op" id="3846727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846731">getUint64</span><span class="op" id="3846740">(</span><span class="ident" id="3846741">key</span><span class="op" id="3846744">[</span><span class="num" id="3846745">8</span><span class="op" id="3846746">:</span><span class="op" id="3846747">]</span><span class="op" id="3846748">)</span><span class="op" id="3846749">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3846752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846755">g</span><span class="op" id="3846756">.</span><span class="ident" id="3846757">productTable</span><span class="op" id="3846769">[</span><span class="ident" id="3846770">reverseBits</span><span class="op" id="3846781">(</span><span class="num" id="3846782">1</span><span class="op" id="3846783">)</span><span class="op" id="3846784">]</span>&nbsp;<span class="op" id="3846786">=</span>&nbsp;<span class="ident" id="3846788">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3846792">for</span>&nbsp;<span class="ident" id="3846796">i</span>&nbsp;<span class="op" id="3846798">:=</span>&nbsp;<span class="num" id="3846801">2</span><span class="op" id="3846802">;</span>&nbsp;<span class="ident" id="3846804">i</span>&nbsp;<span class="op" id="3846806">&lt;</span>&nbsp;<span class="num" id="3846808">16</span><span class="op" id="3846810">;</span>&nbsp;<span class="ident" id="3846812">i</span>&nbsp;<span class="op" id="3846814">+=</span>&nbsp;<span class="num" id="3846817">2</span>&nbsp;<span class="op" id="3846819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846823">g</span><span class="op" id="3846824">.</span><span class="ident" id="3846825">productTable</span><span class="op" id="3846837">[</span><span class="ident" id="3846838">reverseBits</span><span class="op" id="3846849">(</span><span class="ident" id="3846850">i</span><span class="op" id="3846851">)</span><span class="op" id="3846852">]</span>&nbsp;<span class="op" id="3846854">=</span>&nbsp;<span class="ident" id="3846856">gcmDouble</span><span class="op" id="3846865">(</span><span class="op" id="3846866">&amp;</span><span class="ident" id="3846867">g</span><span class="op" id="3846868">.</span><span class="ident" id="3846869">productTable</span><span class="op" id="3846881">[</span><span class="ident" id="3846882">reverseBits</span><span class="op" id="3846893">(</span><span class="ident" id="3846894">i</span><span class="op" id="3846895">/</span><span class="num" id="3846896">2</span><span class="op" id="3846897">)</span><span class="op" id="3846898">]</span><span class="op" id="3846899">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846903">g</span><span class="op" id="3846904">.</span><span class="ident" id="3846905">productTable</span><span class="op" id="3846917">[</span><span class="ident" id="3846918">reverseBits</span><span class="op" id="3846929">(</span><span class="ident" id="3846930">i</span><span class="op" id="3846931">+</span><span class="num" id="3846932">1</span><span class="op" id="3846933">)</span><span class="op" id="3846934">]</span>&nbsp;<span class="op" id="3846936">=</span>&nbsp;<span class="ident" id="3846938">gcmAdd</span><span class="op" id="3846944">(</span><span class="op" id="3846945">&amp;</span><span class="ident" id="3846946">g</span><span class="op" id="3846947">.</span><span class="ident" id="3846948">productTable</span><span class="op" id="3846960">[</span><span class="ident" id="3846961">reverseBits</span><span class="op" id="3846972">(</span><span class="ident" id="3846973">i</span><span class="op" id="3846974">)</span><span class="op" id="3846975">]</span><span class="op" id="3846976">,</span>&nbsp;<span class="op" id="3846978">&amp;</span><span class="ident" id="3846979">x</span><span class="op" id="3846980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3846983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3846987">return</span>&nbsp;<span class="ident" id="3846994">g</span><span class="op" id="3846995">,</span>&nbsp;<span class="ident" id="3846997">nil</span><br>
<span class="lineno"></span><span class="op" id="3847001">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3847004">const</span>&nbsp;<span class="op" id="3847010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847013">gcmBlockSize</span>&nbsp;<span class="op" id="3847026">=</span>&nbsp;<span class="num" id="3847028">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847032">gcmTagSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3847045">=</span>&nbsp;<span class="num" id="3847047">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847051">gcmNonceSize</span>&nbsp;<span class="op" id="3847064">=</span>&nbsp;<span class="num" id="3847066">12</span><br>
<span class="lineno">95</span><span class="op" id="3847069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3847072">func</span>&nbsp;<span class="op" id="3847077">(</span><span class="op" id="3847078">*</span><span class="ident" id="3847079">gcm</span><span class="op" id="3847082">)</span>&nbsp;<span class="ident" id="3847084">NonceSize</span><span class="op" id="3847093">(</span><span class="op" id="3847094">)</span>&nbsp;<span class="builtintype" id="3847096">int</span>&nbsp;<span class="op" id="3847100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847103">return</span>&nbsp;<span class="ident" id="3847110">gcmNonceSize</span><br>
<span class="lineno"></span><span class="op" id="3847123">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3847126">func</span>&nbsp;<span class="op" id="3847131">(</span><span class="op" id="3847132">*</span><span class="ident" id="3847133">gcm</span><span class="op" id="3847136">)</span>&nbsp;<span class="ident" id="3847138">Overhead</span><span class="op" id="3847146">(</span><span class="op" id="3847147">)</span>&nbsp;<span class="builtintype" id="3847149">int</span>&nbsp;<span class="op" id="3847153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847156">return</span>&nbsp;<span class="ident" id="3847163">gcmTagSize</span><br>
<span class="lineno"></span><span class="op" id="3847174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3847177">func</span>&nbsp;<span class="op" id="3847182">(</span><span class="ident" id="3847183">g</span>&nbsp;<span class="op" id="3847185">*</span><span class="ident" id="3847186">gcm</span><span class="op" id="3847189">)</span>&nbsp;<span class="ident" id="3847191">Seal</span><span class="op" id="3847195">(</span><span class="ident" id="3847196">dst</span><span class="op" id="3847199">,</span>&nbsp;<span class="ident" id="3847201">nonce</span><span class="op" id="3847206">,</span>&nbsp;<span class="ident" id="3847208">plaintext</span><span class="op" id="3847217">,</span>&nbsp;<span class="ident" id="3847219">data</span>&nbsp;<span class="op" id="3847224">[</span><span class="op" id="3847225">]</span><span class="builtintype" id="3847226">byte</span><span class="op" id="3847230">)</span>&nbsp;<span class="op" id="3847232">[</span><span class="op" id="3847233">]</span><span class="builtintype" id="3847234">byte</span>&nbsp;<span class="op" id="3847239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847242">if</span>&nbsp;<span class="builtinfunc" id="3847245">len</span><span class="op" id="3847248">(</span><span class="ident" id="3847249">nonce</span><span class="op" id="3847254">)</span>&nbsp;<span class="op" id="3847256">!=</span>&nbsp;<span class="ident" id="3847259">gcmNonceSize</span>&nbsp;<span class="op" id="3847272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3847276">panic</span><span class="op" id="3847281">(</span><span class="string" id="3847282">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3847327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3847330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847334">ret</span><span class="op" id="3847337">,</span>&nbsp;<span class="ident" id="3847339">out</span>&nbsp;<span class="op" id="3847343">:=</span>&nbsp;<span class="ident" id="3847346">sliceForAppend</span><span class="op" id="3847360">(</span><span class="ident" id="3847361">dst</span><span class="op" id="3847364">,</span>&nbsp;<span class="builtinfunc" id="3847366">len</span><span class="op" id="3847369">(</span><span class="ident" id="3847370">plaintext</span><span class="op" id="3847379">)</span><span class="op" id="3847380">+</span><span class="ident" id="3847381">gcmTagSize</span><span class="op" id="3847391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847395">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847426">var</span>&nbsp;<span class="ident" id="3847430">counter</span><span class="op" id="3847437">,</span>&nbsp;<span class="ident" id="3847439">tagMask</span>&nbsp;<span class="op" id="3847447">[</span><span class="ident" id="3847448">gcmBlockSize</span><span class="op" id="3847460">]</span><span class="builtintype" id="3847461">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3847467">copy</span><span class="op" id="3847471">(</span><span class="ident" id="3847472">counter</span><span class="op" id="3847479">[</span><span class="op" id="3847480">:</span><span class="op" id="3847481">]</span><span class="op" id="3847482">,</span>&nbsp;<span class="ident" id="3847484">nonce</span><span class="op" id="3847489">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847492">counter</span><span class="op" id="3847499">[</span><span class="ident" id="3847500">gcmBlockSize</span><span class="op" id="3847512">-</span><span class="num" id="3847513">1</span><span class="op" id="3847514">]</span>&nbsp;<span class="op" id="3847516">=</span>&nbsp;<span class="num" id="3847518">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847522">g</span><span class="op" id="3847523">.</span><span class="ident" id="3847524">cipher</span><span class="op" id="3847530">.</span><span class="ident" id="3847531">Encrypt</span><span class="op" id="3847538">(</span><span class="ident" id="3847539">tagMask</span><span class="op" id="3847546">[</span><span class="op" id="3847547">:</span><span class="op" id="3847548">]</span><span class="op" id="3847549">,</span>&nbsp;<span class="ident" id="3847551">counter</span><span class="op" id="3847558">[</span><span class="op" id="3847559">:</span><span class="op" id="3847560">]</span><span class="op" id="3847561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847564">gcmInc32</span><span class="op" id="3847572">(</span><span class="op" id="3847573">&amp;</span><span class="ident" id="3847574">counter</span><span class="op" id="3847581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847585">g</span><span class="op" id="3847586">.</span><span class="ident" id="3847587">counterCrypt</span><span class="op" id="3847599">(</span><span class="ident" id="3847600">out</span><span class="op" id="3847603">,</span>&nbsp;<span class="ident" id="3847605">plaintext</span><span class="op" id="3847614">,</span>&nbsp;<span class="op" id="3847616">&amp;</span><span class="ident" id="3847617">counter</span><span class="op" id="3847624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847627">g</span><span class="op" id="3847628">.</span><span class="ident" id="3847629">auth</span><span class="op" id="3847633">(</span><span class="ident" id="3847634">out</span><span class="op" id="3847637">[</span><span class="builtinfunc" id="3847638">len</span><span class="op" id="3847641">(</span><span class="ident" id="3847642">plaintext</span><span class="op" id="3847651">)</span><span class="op" id="3847652">:</span><span class="op" id="3847653">]</span><span class="op" id="3847654">,</span>&nbsp;<span class="ident" id="3847656">out</span><span class="op" id="3847659">[</span><span class="op" id="3847660">:</span><span class="builtinfunc" id="3847661">len</span><span class="op" id="3847664">(</span><span class="ident" id="3847665">plaintext</span><span class="op" id="3847674">)</span><span class="op" id="3847675">]</span><span class="op" id="3847676">,</span>&nbsp;<span class="ident" id="3847678">data</span><span class="op" id="3847682">,</span>&nbsp;<span class="op" id="3847684">&amp;</span><span class="ident" id="3847685">tagMask</span><span class="op" id="3847692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847696">return</span>&nbsp;<span class="ident" id="3847703">ret</span><br>
<span class="lineno"></span><span class="op" id="3847707">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3847710">var</span>&nbsp;<span class="ident" id="3847714">errOpen</span>&nbsp;<span class="op" id="3847722">=</span>&nbsp;<span class="ident" id="3847724">errors</span><span class="op" id="3847730">.</span><span class="ident" id="3847731">New</span><span class="op" id="3847734">(</span><span class="string" id="3847735">&#34;cipher:&nbsp;message&nbsp;authentication&nbsp;failed&#34;</span><span class="op" id="3847774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3847777">func</span>&nbsp;<span class="op" id="3847782">(</span><span class="ident" id="3847783">g</span>&nbsp;<span class="op" id="3847785">*</span><span class="ident" id="3847786">gcm</span><span class="op" id="3847789">)</span>&nbsp;<span class="ident" id="3847791">Open</span><span class="op" id="3847795">(</span><span class="ident" id="3847796">dst</span><span class="op" id="3847799">,</span>&nbsp;<span class="ident" id="3847801">nonce</span><span class="op" id="3847806">,</span>&nbsp;<span class="ident" id="3847808">ciphertext</span><span class="op" id="3847818">,</span>&nbsp;<span class="ident" id="3847820">data</span>&nbsp;<span class="op" id="3847825">[</span><span class="op" id="3847826">]</span><span class="builtintype" id="3847827">byte</span><span class="op" id="3847831">)</span>&nbsp;<span class="op" id="3847833">(</span><span class="op" id="3847834">[</span><span class="op" id="3847835">]</span><span class="builtintype" id="3847836">byte</span><span class="op" id="3847840">,</span>&nbsp;<span class="builtintype" id="3847842">error</span><span class="op" id="3847847">)</span>&nbsp;<span class="op" id="3847849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847852">if</span>&nbsp;<span class="builtinfunc" id="3847855">len</span><span class="op" id="3847858">(</span><span class="ident" id="3847859">nonce</span><span class="op" id="3847864">)</span>&nbsp;<span class="op" id="3847866">!=</span>&nbsp;<span class="ident" id="3847869">gcmNonceSize</span>&nbsp;<span class="op" id="3847882">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3847886">panic</span><span class="op" id="3847891">(</span><span class="string" id="3847892">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3847937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3847940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847944">if</span>&nbsp;<span class="builtinfunc" id="3847947">len</span><span class="op" id="3847950">(</span><span class="ident" id="3847951">ciphertext</span><span class="op" id="3847961">)</span>&nbsp;<span class="op" id="3847963">&lt;</span>&nbsp;<span class="ident" id="3847965">gcmTagSize</span>&nbsp;<span class="op" id="3847976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3847980">return</span>&nbsp;<span class="ident" id="3847987">nil</span><span class="op" id="3847990">,</span>&nbsp;<span class="ident" id="3847992">errOpen</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3848001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848004">tag</span>&nbsp;<span class="op" id="3848008">:=</span>&nbsp;<span class="ident" id="3848011">ciphertext</span><span class="op" id="3848021">[</span><span class="builtinfunc" id="3848022">len</span><span class="op" id="3848025">(</span><span class="ident" id="3848026">ciphertext</span><span class="op" id="3848036">)</span><span class="op" id="3848037">-</span><span class="ident" id="3848038">gcmTagSize</span><span class="op" id="3848048">:</span><span class="op" id="3848049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848052">ciphertext</span>&nbsp;<span class="op" id="3848063">=</span>&nbsp;<span class="ident" id="3848065">ciphertext</span><span class="op" id="3848075">[</span><span class="op" id="3848076">:</span><span class="builtinfunc" id="3848077">len</span><span class="op" id="3848080">(</span><span class="ident" id="3848081">ciphertext</span><span class="op" id="3848091">)</span><span class="op" id="3848092">-</span><span class="ident" id="3848093">gcmTagSize</span><span class="op" id="3848103">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848107">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848138">var</span>&nbsp;<span class="ident" id="3848142">counter</span><span class="op" id="3848149">,</span>&nbsp;<span class="ident" id="3848151">tagMask</span>&nbsp;<span class="op" id="3848159">[</span><span class="ident" id="3848160">gcmBlockSize</span><span class="op" id="3848172">]</span><span class="builtintype" id="3848173">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3848179">copy</span><span class="op" id="3848183">(</span><span class="ident" id="3848184">counter</span><span class="op" id="3848191">[</span><span class="op" id="3848192">:</span><span class="op" id="3848193">]</span><span class="op" id="3848194">,</span>&nbsp;<span class="ident" id="3848196">nonce</span><span class="op" id="3848201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848204">counter</span><span class="op" id="3848211">[</span><span class="ident" id="3848212">gcmBlockSize</span><span class="op" id="3848224">-</span><span class="num" id="3848225">1</span><span class="op" id="3848226">]</span>&nbsp;<span class="op" id="3848228">=</span>&nbsp;<span class="num" id="3848230">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848234">g</span><span class="op" id="3848235">.</span><span class="ident" id="3848236">cipher</span><span class="op" id="3848242">.</span><span class="ident" id="3848243">Encrypt</span><span class="op" id="3848250">(</span><span class="ident" id="3848251">tagMask</span><span class="op" id="3848258">[</span><span class="op" id="3848259">:</span><span class="op" id="3848260">]</span><span class="op" id="3848261">,</span>&nbsp;<span class="ident" id="3848263">counter</span><span class="op" id="3848270">[</span><span class="op" id="3848271">:</span><span class="op" id="3848272">]</span><span class="op" id="3848273">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848276">gcmInc32</span><span class="op" id="3848284">(</span><span class="op" id="3848285">&amp;</span><span class="ident" id="3848286">counter</span><span class="op" id="3848293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848297">var</span>&nbsp;<span class="ident" id="3848301">expectedTag</span>&nbsp;<span class="op" id="3848313">[</span><span class="ident" id="3848314">gcmTagSize</span><span class="op" id="3848324">]</span><span class="builtintype" id="3848325">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848331">g</span><span class="op" id="3848332">.</span><span class="ident" id="3848333">auth</span><span class="op" id="3848337">(</span><span class="ident" id="3848338">expectedTag</span><span class="op" id="3848349">[</span><span class="op" id="3848350">:</span><span class="op" id="3848351">]</span><span class="op" id="3848352">,</span>&nbsp;<span class="ident" id="3848354">ciphertext</span><span class="op" id="3848364">,</span>&nbsp;<span class="ident" id="3848366">data</span><span class="op" id="3848370">,</span>&nbsp;<span class="op" id="3848372">&amp;</span><span class="ident" id="3848373">tagMask</span><span class="op" id="3848380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848384">if</span>&nbsp;<span class="ident" id="3848387">subtle</span><span class="op" id="3848393">.</span><span class="ident" id="3848394">ConstantTimeCompare</span><span class="op" id="3848413">(</span><span class="ident" id="3848414">expectedTag</span><span class="op" id="3848425">[</span><span class="op" id="3848426">:</span><span class="op" id="3848427">]</span><span class="op" id="3848428">,</span>&nbsp;<span class="ident" id="3848430">tag</span><span class="op" id="3848433">)</span>&nbsp;<span class="op" id="3848435">!=</span>&nbsp;<span class="num" id="3848438">1</span>&nbsp;<span class="op" id="3848440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848444">return</span>&nbsp;<span class="ident" id="3848451">nil</span><span class="op" id="3848454">,</span>&nbsp;<span class="ident" id="3848456">errOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3848465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848469">ret</span><span class="op" id="3848472">,</span>&nbsp;<span class="ident" id="3848474">out</span>&nbsp;<span class="op" id="3848478">:=</span>&nbsp;<span class="ident" id="3848481">sliceForAppend</span><span class="op" id="3848495">(</span><span class="ident" id="3848496">dst</span><span class="op" id="3848499">,</span>&nbsp;<span class="builtinfunc" id="3848501">len</span><span class="op" id="3848504">(</span><span class="ident" id="3848505">ciphertext</span><span class="op" id="3848515">)</span><span class="op" id="3848516">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848519">g</span><span class="op" id="3848520">.</span><span class="ident" id="3848521">counterCrypt</span><span class="op" id="3848533">(</span><span class="ident" id="3848534">out</span><span class="op" id="3848537">,</span>&nbsp;<span class="ident" id="3848539">ciphertext</span><span class="op" id="3848549">,</span>&nbsp;<span class="op" id="3848551">&amp;</span><span class="ident" id="3848552">counter</span><span class="op" id="3848559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848563">return</span>&nbsp;<span class="ident" id="3848570">ret</span><span class="op" id="3848573">,</span>&nbsp;<span class="ident" id="3848575">nil</span><br>
<span class="lineno"></span><span class="op" id="3848579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3848582">//&nbsp;reverseBits&nbsp;reverses&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;4-bit&nbsp;number&nbsp;in&nbsp;i.</span><br>
<span class="lineno"></span><span class="keyword" id="3848650">func</span>&nbsp;<span class="ident" id="3848655">reverseBits</span><span class="op" id="3848666">(</span><span class="ident" id="3848667">i</span>&nbsp;<span class="builtintype" id="3848669">int</span><span class="op" id="3848672">)</span>&nbsp;<span class="builtintype" id="3848674">int</span>&nbsp;<span class="op" id="3848678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848681">i</span>&nbsp;<span class="op" id="3848683">=</span>&nbsp;<span class="op" id="3848685">(</span><span class="op" id="3848686">(</span><span class="ident" id="3848687">i</span>&nbsp;<span class="op" id="3848689">&lt;&lt;</span>&nbsp;<span class="num" id="3848692">2</span><span class="op" id="3848693">)</span>&nbsp;<span class="op" id="3848695">&amp;</span>&nbsp;<span class="num" id="3848697">0xc</span><span class="op" id="3848700">)</span>&nbsp;<span class="op" id="3848702">|</span>&nbsp;<span class="op" id="3848704">(</span><span class="op" id="3848705">(</span><span class="ident" id="3848706">i</span>&nbsp;<span class="op" id="3848708">&gt;&gt;</span>&nbsp;<span class="num" id="3848711">2</span><span class="op" id="3848712">)</span>&nbsp;<span class="op" id="3848714">&amp;</span>&nbsp;<span class="num" id="3848716">0x3</span><span class="op" id="3848719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848722">i</span>&nbsp;<span class="op" id="3848724">=</span>&nbsp;<span class="op" id="3848726">(</span><span class="op" id="3848727">(</span><span class="ident" id="3848728">i</span>&nbsp;<span class="op" id="3848730">&lt;&lt;</span>&nbsp;<span class="num" id="3848733">1</span><span class="op" id="3848734">)</span>&nbsp;<span class="op" id="3848736">&amp;</span>&nbsp;<span class="num" id="3848738">0xa</span><span class="op" id="3848741">)</span>&nbsp;<span class="op" id="3848743">|</span>&nbsp;<span class="op" id="3848745">(</span><span class="op" id="3848746">(</span><span class="ident" id="3848747">i</span>&nbsp;<span class="op" id="3848749">&gt;&gt;</span>&nbsp;<span class="num" id="3848752">1</span><span class="op" id="3848753">)</span>&nbsp;<span class="op" id="3848755">&amp;</span>&nbsp;<span class="num" id="3848757">0x5</span><span class="op" id="3848760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848763">return</span>&nbsp;<span class="ident" id="3848770">i</span><br>
<span class="lineno">165</span><span class="op" id="3848772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3848775">//&nbsp;gcmAdd&nbsp;adds&nbsp;two&nbsp;elements&nbsp;of&nbsp;GF(2¹²⁸)&nbsp;and&nbsp;returns&nbsp;the&nbsp;sum.</span><br>
<span class="lineno"></span><span class="keyword" id="3848840">func</span>&nbsp;<span class="ident" id="3848845">gcmAdd</span><span class="op" id="3848851">(</span><span class="ident" id="3848852">x</span><span class="op" id="3848853">,</span>&nbsp;<span class="ident" id="3848855">y</span>&nbsp;<span class="op" id="3848857">*</span><span class="ident" id="3848858">gcmFieldElement</span><span class="op" id="3848873">)</span>&nbsp;<span class="ident" id="3848875">gcmFieldElement</span>&nbsp;<span class="op" id="3848891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848894">//&nbsp;Addition&nbsp;in&nbsp;a&nbsp;characteristic&nbsp;2&nbsp;field&nbsp;is&nbsp;just&nbsp;XOR.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848948">return</span>&nbsp;<span class="ident" id="3848955">gcmFieldElement</span><span class="op" id="3848970">{</span><span class="ident" id="3848971">x</span><span class="op" id="3848972">.</span><span class="ident" id="3848973">low</span>&nbsp;<span class="op" id="3848977">^</span>&nbsp;<span class="ident" id="3848979">y</span><span class="op" id="3848980">.</span><span class="ident" id="3848981">low</span><span class="op" id="3848984">,</span>&nbsp;<span class="ident" id="3848986">x</span><span class="op" id="3848987">.</span><span class="ident" id="3848988">high</span>&nbsp;<span class="op" id="3848993">^</span>&nbsp;<span class="ident" id="3848995">y</span><span class="op" id="3848996">.</span><span class="ident" id="3848997">high</span><span class="op" id="3849001">}</span><br>
<span class="lineno"></span><span class="op" id="3849003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3849006">//&nbsp;gcmDouble&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;doubling&nbsp;an&nbsp;element&nbsp;of&nbsp;GF(2¹²⁸).</span><br>
<span class="lineno"></span><span class="keyword" id="3849078">func</span>&nbsp;<span class="ident" id="3849083">gcmDouble</span><span class="op" id="3849092">(</span><span class="ident" id="3849093">x</span>&nbsp;<span class="op" id="3849095">*</span><span class="ident" id="3849096">gcmFieldElement</span><span class="op" id="3849111">)</span>&nbsp;<span class="op" id="3849113">(</span><span class="ident" id="3849114">double</span>&nbsp;<span class="ident" id="3849121">gcmFieldElement</span><span class="op" id="3849136">)</span>&nbsp;<span class="op" id="3849138">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849141">msbSet</span>&nbsp;<span class="op" id="3849148">:=</span>&nbsp;<span class="ident" id="3849151">x</span><span class="op" id="3849152">.</span><span class="ident" id="3849153">high</span><span class="op" id="3849157">&amp;</span><span class="num" id="3849158">1</span>&nbsp;<span class="op" id="3849160">==</span>&nbsp;<span class="num" id="3849163">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849167">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;bit-ordering,&nbsp;doubling&nbsp;is&nbsp;actually&nbsp;a&nbsp;right&nbsp;shift.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849236">double</span><span class="op" id="3849242">.</span><span class="ident" id="3849243">high</span>&nbsp;<span class="op" id="3849248">=</span>&nbsp;<span class="ident" id="3849250">x</span><span class="op" id="3849251">.</span><span class="ident" id="3849252">high</span>&nbsp;<span class="op" id="3849257">&gt;&gt;</span>&nbsp;<span class="num" id="3849260">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849263">double</span><span class="op" id="3849269">.</span><span class="ident" id="3849270">high</span>&nbsp;<span class="op" id="3849275">|=</span>&nbsp;<span class="ident" id="3849278">x</span><span class="op" id="3849279">.</span><span class="ident" id="3849280">low</span>&nbsp;<span class="op" id="3849284">&lt;&lt;</span>&nbsp;<span class="num" id="3849287">63</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849291">double</span><span class="op" id="3849297">.</span><span class="ident" id="3849298">low</span>&nbsp;<span class="op" id="3849302">=</span>&nbsp;<span class="ident" id="3849304">x</span><span class="op" id="3849305">.</span><span class="ident" id="3849306">low</span>&nbsp;<span class="op" id="3849310">&gt;&gt;</span>&nbsp;<span class="num" id="3849313">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849317">//&nbsp;If&nbsp;the&nbsp;most-significant&nbsp;bit&nbsp;was&nbsp;set&nbsp;before&nbsp;shifting&nbsp;then&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849382">//&nbsp;conceptually,&nbsp;becomes&nbsp;a&nbsp;term&nbsp;of&nbsp;x^128.&nbsp;This&nbsp;is&nbsp;greater&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849450">//&nbsp;irreducible&nbsp;polynomial&nbsp;so&nbsp;the&nbsp;result&nbsp;has&nbsp;to&nbsp;be&nbsp;reduced.&nbsp;The</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849514">//&nbsp;irreducible&nbsp;polynomial&nbsp;is&nbsp;1+x+x^2+x^7+x^128.&nbsp;We&nbsp;can&nbsp;subtract&nbsp;that&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849587">//&nbsp;eliminate&nbsp;the&nbsp;term&nbsp;at&nbsp;x^128&nbsp;which&nbsp;also&nbsp;means&nbsp;subtracting&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849658">//&nbsp;four&nbsp;terms.&nbsp;In&nbsp;characteristic&nbsp;2&nbsp;fields,&nbsp;subtraction&nbsp;==&nbsp;addition&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849729">//&nbsp;XOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849738">if</span>&nbsp;<span class="ident" id="3849741">msbSet</span>&nbsp;<span class="op" id="3849748">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849752">double</span><span class="op" id="3849758">.</span><span class="ident" id="3849759">low</span>&nbsp;<span class="op" id="3849763">^=</span>&nbsp;<span class="num" id="3849766">0xe100000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3849786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849790">return</span><br>
<span class="lineno"></span><span class="op" id="3849797">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="3849800">var</span>&nbsp;<span class="ident" id="3849804">gcmReductionTable</span>&nbsp;<span class="op" id="3849822">=</span>&nbsp;<span class="op" id="3849824">[</span><span class="op" id="3849825">]</span><span class="builtintype" id="3849826">uint16</span><span class="op" id="3849832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3849835">0x0000</span><span class="op" id="3849841">,</span>&nbsp;<span class="num" id="3849843">0x1c20</span><span class="op" id="3849849">,</span>&nbsp;<span class="num" id="3849851">0x3840</span><span class="op" id="3849857">,</span>&nbsp;<span class="num" id="3849859">0x2460</span><span class="op" id="3849865">,</span>&nbsp;<span class="num" id="3849867">0x7080</span><span class="op" id="3849873">,</span>&nbsp;<span class="num" id="3849875">0x6ca0</span><span class="op" id="3849881">,</span>&nbsp;<span class="num" id="3849883">0x48c0</span><span class="op" id="3849889">,</span>&nbsp;<span class="num" id="3849891">0x54e0</span><span class="op" id="3849897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3849900">0xe100</span><span class="op" id="3849906">,</span>&nbsp;<span class="num" id="3849908">0xfd20</span><span class="op" id="3849914">,</span>&nbsp;<span class="num" id="3849916">0xd940</span><span class="op" id="3849922">,</span>&nbsp;<span class="num" id="3849924">0xc560</span><span class="op" id="3849930">,</span>&nbsp;<span class="num" id="3849932">0x9180</span><span class="op" id="3849938">,</span>&nbsp;<span class="num" id="3849940">0x8da0</span><span class="op" id="3849946">,</span>&nbsp;<span class="num" id="3849948">0xa9c0</span><span class="op" id="3849954">,</span>&nbsp;<span class="num" id="3849956">0xb5e0</span><span class="op" id="3849962">,</span><br>
<span class="lineno"></span><span class="op" id="3849964">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3849967">//&nbsp;mul&nbsp;sets&nbsp;y&nbsp;to&nbsp;y*H,&nbsp;where&nbsp;H&nbsp;is&nbsp;the&nbsp;GCM&nbsp;key,&nbsp;fixed&nbsp;during&nbsp;NewGCM.</span><br>
<span class="lineno"></span><span class="keyword" id="3850034">func</span>&nbsp;<span class="op" id="3850039">(</span><span class="ident" id="3850040">g</span>&nbsp;<span class="op" id="3850042">*</span><span class="ident" id="3850043">gcm</span><span class="op" id="3850046">)</span>&nbsp;<span class="ident" id="3850048">mul</span><span class="op" id="3850051">(</span><span class="ident" id="3850052">y</span>&nbsp;<span class="op" id="3850054">*</span><span class="ident" id="3850055">gcmFieldElement</span><span class="op" id="3850070">)</span>&nbsp;<span class="op" id="3850072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850075">var</span>&nbsp;<span class="ident" id="3850079">z</span>&nbsp;<span class="ident" id="3850081">gcmFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850099">for</span>&nbsp;<span class="ident" id="3850103">i</span>&nbsp;<span class="op" id="3850105">:=</span>&nbsp;<span class="num" id="3850108">0</span><span class="op" id="3850109">;</span>&nbsp;<span class="ident" id="3850111">i</span>&nbsp;<span class="op" id="3850113">&lt;</span>&nbsp;<span class="num" id="3850115">2</span><span class="op" id="3850116">;</span>&nbsp;<span class="ident" id="3850118">i</span><span class="op" id="3850119">++</span>&nbsp;<span class="op" id="3850122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850126">word</span>&nbsp;<span class="op" id="3850131">:=</span>&nbsp;<span class="ident" id="3850134">y</span><span class="op" id="3850135">.</span><span class="ident" id="3850136">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850143">if</span>&nbsp;<span class="ident" id="3850146">i</span>&nbsp;<span class="op" id="3850148">==</span>&nbsp;<span class="num" id="3850151">1</span>&nbsp;<span class="op" id="3850153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850158">word</span>&nbsp;<span class="op" id="3850163">=</span>&nbsp;<span class="ident" id="3850165">y</span><span class="op" id="3850166">.</span><span class="ident" id="3850167">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850173">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850178">//&nbsp;Multiplication&nbsp;works&nbsp;by&nbsp;multiplying&nbsp;z&nbsp;by&nbsp;16&nbsp;and&nbsp;adding&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850241">//&nbsp;one&nbsp;of&nbsp;the&nbsp;precomputed&nbsp;multiples&nbsp;of&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850285">for</span>&nbsp;<span class="ident" id="3850289">j</span>&nbsp;<span class="op" id="3850291">:=</span>&nbsp;<span class="num" id="3850294">0</span><span class="op" id="3850295">;</span>&nbsp;<span class="ident" id="3850297">j</span>&nbsp;<span class="op" id="3850299">&lt;</span>&nbsp;<span class="num" id="3850301">64</span><span class="op" id="3850303">;</span>&nbsp;<span class="ident" id="3850305">j</span>&nbsp;<span class="op" id="3850307">+=</span>&nbsp;<span class="num" id="3850310">4</span>&nbsp;<span class="op" id="3850312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850317">msw</span>&nbsp;<span class="op" id="3850321">:=</span>&nbsp;<span class="ident" id="3850324">z</span><span class="op" id="3850325">.</span><span class="ident" id="3850326">high</span>&nbsp;<span class="op" id="3850331">&amp;</span>&nbsp;<span class="num" id="3850333">0xf</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850340">z</span><span class="op" id="3850341">.</span><span class="ident" id="3850342">high</span>&nbsp;<span class="op" id="3850347">&gt;&gt;=</span>&nbsp;<span class="num" id="3850351">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850356">z</span><span class="op" id="3850357">.</span><span class="ident" id="3850358">high</span>&nbsp;<span class="op" id="3850363">|=</span>&nbsp;<span class="ident" id="3850366">z</span><span class="op" id="3850367">.</span><span class="ident" id="3850368">low</span>&nbsp;<span class="op" id="3850372">&lt;&lt;</span>&nbsp;<span class="num" id="3850375">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850381">z</span><span class="op" id="3850382">.</span><span class="ident" id="3850383">low</span>&nbsp;<span class="op" id="3850387">&gt;&gt;=</span>&nbsp;<span class="num" id="3850391">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850396">z</span><span class="op" id="3850397">.</span><span class="ident" id="3850398">low</span>&nbsp;<span class="op" id="3850402">^=</span>&nbsp;<span class="ident" id="3850405">uint64</span><span class="op" id="3850411">(</span><span class="ident" id="3850412">gcmReductionTable</span><span class="op" id="3850429">[</span><span class="ident" id="3850430">msw</span><span class="op" id="3850433">]</span><span class="op" id="3850434">)</span>&nbsp;<span class="op" id="3850436">&lt;&lt;</span>&nbsp;<span class="num" id="3850439">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850446">//&nbsp;the&nbsp;values&nbsp;in&nbsp;|table|&nbsp;are&nbsp;ordered&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850490">//&nbsp;little-endian&nbsp;bit&nbsp;positions.&nbsp;See&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850541">//&nbsp;in&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850558">t</span>&nbsp;<span class="op" id="3850560">:=</span>&nbsp;<span class="op" id="3850563">&amp;</span><span class="ident" id="3850564">g</span><span class="op" id="3850565">.</span><span class="ident" id="3850566">productTable</span><span class="op" id="3850578">[</span><span class="ident" id="3850579">word</span><span class="op" id="3850583">&amp;</span><span class="num" id="3850584">0xf</span><span class="op" id="3850587">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850593">z</span><span class="op" id="3850594">.</span><span class="ident" id="3850595">low</span>&nbsp;<span class="op" id="3850599">^=</span>&nbsp;<span class="ident" id="3850602">t</span><span class="op" id="3850603">.</span><span class="ident" id="3850604">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850611">z</span><span class="op" id="3850612">.</span><span class="ident" id="3850613">high</span>&nbsp;<span class="op" id="3850618">^=</span>&nbsp;<span class="ident" id="3850621">t</span><span class="op" id="3850622">.</span><span class="ident" id="3850623">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850631">word</span>&nbsp;<span class="op" id="3850636">&gt;&gt;=</span>&nbsp;<span class="num" id="3850640">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850647">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850651">*</span><span class="ident" id="3850652">y</span>&nbsp;<span class="op" id="3850654">=</span>&nbsp;<span class="ident" id="3850656">z</span><br>
<span class="lineno"></span><span class="op" id="3850658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3850661">//&nbsp;updateBlocks&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;blocks,&nbsp;based&nbsp;on</span><br>
<span class="lineno">235</span><span class="comment" id="3850736">//&nbsp;Horner&#39;s&nbsp;rule.&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;in&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3850812">func</span>&nbsp;<span class="op" id="3850817">(</span><span class="ident" id="3850818">g</span>&nbsp;<span class="op" id="3850820">*</span><span class="ident" id="3850821">gcm</span><span class="op" id="3850824">)</span>&nbsp;<span class="ident" id="3850826">updateBlocks</span><span class="op" id="3850838">(</span><span class="ident" id="3850839">y</span>&nbsp;<span class="op" id="3850841">*</span><span class="ident" id="3850842">gcmFieldElement</span><span class="op" id="3850857">,</span>&nbsp;<span class="ident" id="3850859">blocks</span>&nbsp;<span class="op" id="3850866">[</span><span class="op" id="3850867">]</span><span class="builtintype" id="3850868">byte</span><span class="op" id="3850872">)</span>&nbsp;<span class="op" id="3850874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850877">for</span>&nbsp;<span class="builtinfunc" id="3850881">len</span><span class="op" id="3850884">(</span><span class="ident" id="3850885">blocks</span><span class="op" id="3850891">)</span>&nbsp;<span class="op" id="3850893">&gt;</span>&nbsp;<span class="num" id="3850895">0</span>&nbsp;<span class="op" id="3850897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850901">y</span><span class="op" id="3850902">.</span><span class="ident" id="3850903">low</span>&nbsp;<span class="op" id="3850907">^=</span>&nbsp;<span class="ident" id="3850910">getUint64</span><span class="op" id="3850919">(</span><span class="ident" id="3850920">blocks</span><span class="op" id="3850926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850930">y</span><span class="op" id="3850931">.</span><span class="ident" id="3850932">high</span>&nbsp;<span class="op" id="3850937">^=</span>&nbsp;<span class="ident" id="3850940">getUint64</span><span class="op" id="3850949">(</span><span class="ident" id="3850950">blocks</span><span class="op" id="3850956">[</span><span class="num" id="3850957">8</span><span class="op" id="3850958">:</span><span class="op" id="3850959">]</span><span class="op" id="3850960">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850964">g</span><span class="op" id="3850965">.</span><span class="ident" id="3850966">mul</span><span class="op" id="3850969">(</span><span class="ident" id="3850970">y</span><span class="op" id="3850971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850975">blocks</span>&nbsp;<span class="op" id="3850982">=</span>&nbsp;<span class="ident" id="3850984">blocks</span><span class="op" id="3850990">[</span><span class="ident" id="3850991">gcmBlockSize</span><span class="op" id="3851003">:</span><span class="op" id="3851004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851007">}</span><br>
<span class="lineno"></span><span class="op" id="3851009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3851012">//&nbsp;update&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;data.&nbsp;If&nbsp;data&nbsp;is&nbsp;not&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3851087">//&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;long&nbsp;then&nbsp;the&nbsp;remainder&nbsp;is&nbsp;zero&nbsp;padded.</span><br>
<span class="lineno"></span><span class="keyword" id="3851161">func</span>&nbsp;<span class="op" id="3851166">(</span><span class="ident" id="3851167">g</span>&nbsp;<span class="op" id="3851169">*</span><span class="ident" id="3851170">gcm</span><span class="op" id="3851173">)</span>&nbsp;<span class="ident" id="3851175">update</span><span class="op" id="3851181">(</span><span class="ident" id="3851182">y</span>&nbsp;<span class="op" id="3851184">*</span><span class="ident" id="3851185">gcmFieldElement</span><span class="op" id="3851200">,</span>&nbsp;<span class="ident" id="3851202">data</span>&nbsp;<span class="op" id="3851207">[</span><span class="op" id="3851208">]</span><span class="builtintype" id="3851209">byte</span><span class="op" id="3851213">)</span>&nbsp;<span class="op" id="3851215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851218">fullBlocks</span>&nbsp;<span class="op" id="3851229">:=</span>&nbsp;<span class="op" id="3851232">(</span><span class="builtinfunc" id="3851233">len</span><span class="op" id="3851236">(</span><span class="ident" id="3851237">data</span><span class="op" id="3851241">)</span>&nbsp;<span class="op" id="3851243">&gt;&gt;</span>&nbsp;<span class="num" id="3851246">4</span><span class="op" id="3851247">)</span>&nbsp;<span class="op" id="3851249">&lt;&lt;</span>&nbsp;<span class="num" id="3851252">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851255">g</span><span class="op" id="3851256">.</span><span class="ident" id="3851257">updateBlocks</span><span class="op" id="3851269">(</span><span class="ident" id="3851270">y</span><span class="op" id="3851271">,</span>&nbsp;<span class="ident" id="3851273">data</span><span class="op" id="3851277">[</span><span class="op" id="3851278">:</span><span class="ident" id="3851279">fullBlocks</span><span class="op" id="3851289">]</span><span class="op" id="3851290">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851294">if</span>&nbsp;<span class="builtinfunc" id="3851297">len</span><span class="op" id="3851300">(</span><span class="ident" id="3851301">data</span><span class="op" id="3851305">)</span>&nbsp;<span class="op" id="3851307">!=</span>&nbsp;<span class="ident" id="3851310">fullBlocks</span>&nbsp;<span class="op" id="3851321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851325">var</span>&nbsp;<span class="ident" id="3851329">partialBlock</span>&nbsp;<span class="op" id="3851342">[</span><span class="ident" id="3851343">gcmBlockSize</span><span class="op" id="3851355">]</span><span class="builtintype" id="3851356">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3851363">copy</span><span class="op" id="3851367">(</span><span class="ident" id="3851368">partialBlock</span><span class="op" id="3851380">[</span><span class="op" id="3851381">:</span><span class="op" id="3851382">]</span><span class="op" id="3851383">,</span>&nbsp;<span class="ident" id="3851385">data</span><span class="op" id="3851389">[</span><span class="ident" id="3851390">fullBlocks</span><span class="op" id="3851400">:</span><span class="op" id="3851401">]</span><span class="op" id="3851402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851406">g</span><span class="op" id="3851407">.</span><span class="ident" id="3851408">updateBlocks</span><span class="op" id="3851420">(</span><span class="ident" id="3851421">y</span><span class="op" id="3851422">,</span>&nbsp;<span class="ident" id="3851424">partialBlock</span><span class="op" id="3851436">[</span><span class="op" id="3851437">:</span><span class="op" id="3851438">]</span><span class="op" id="3851439">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851442">}</span><br>
<span class="lineno"></span><span class="op" id="3851444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851447">//&nbsp;gcmInc32&nbsp;treats&nbsp;the&nbsp;final&nbsp;four&nbsp;bytes&nbsp;of&nbsp;counterBlock&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3851525">//&nbsp;and&nbsp;increments&nbsp;it.</span><br>
<span class="lineno">260</span><span class="keyword" id="3851547">func</span>&nbsp;<span class="ident" id="3851552">gcmInc32</span><span class="op" id="3851560">(</span><span class="ident" id="3851561">counterBlock</span>&nbsp;<span class="op" id="3851574">*</span><span class="op" id="3851575">[</span><span class="num" id="3851576">16</span><span class="op" id="3851578">]</span><span class="builtintype" id="3851579">byte</span><span class="op" id="3851583">)</span>&nbsp;<span class="op" id="3851585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851588">for</span>&nbsp;<span class="ident" id="3851592">i</span>&nbsp;<span class="op" id="3851594">:=</span>&nbsp;<span class="ident" id="3851597">gcmBlockSize</span>&nbsp;<span class="op" id="3851610">-</span>&nbsp;<span class="num" id="3851612">1</span><span class="op" id="3851613">;</span>&nbsp;<span class="ident" id="3851615">i</span>&nbsp;<span class="op" id="3851617">&gt;=</span>&nbsp;<span class="ident" id="3851620">gcmBlockSize</span><span class="op" id="3851632">-</span><span class="num" id="3851633">4</span><span class="op" id="3851634">;</span>&nbsp;<span class="ident" id="3851636">i</span><span class="op" id="3851637">--</span>&nbsp;<span class="op" id="3851640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851644">counterBlock</span><span class="op" id="3851656">[</span><span class="ident" id="3851657">i</span><span class="op" id="3851658">]</span><span class="op" id="3851659">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851664">if</span>&nbsp;<span class="ident" id="3851667">counterBlock</span><span class="op" id="3851679">[</span><span class="ident" id="3851680">i</span><span class="op" id="3851681">]</span>&nbsp;<span class="op" id="3851683">!=</span>&nbsp;<span class="num" id="3851686">0</span>&nbsp;<span class="op" id="3851688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851693">break</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851704">}</span><br>
<span class="lineno"></span><span class="op" id="3851706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851709">//&nbsp;sliceForAppend&nbsp;takes&nbsp;a&nbsp;slice&nbsp;and&nbsp;a&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;It&nbsp;returns&nbsp;a</span><br>
<span class="lineno">270</span><span class="comment" id="3851787">//&nbsp;slice&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;given&nbsp;slice&nbsp;followed&nbsp;by&nbsp;that&nbsp;many&nbsp;bytes&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3851867">//&nbsp;second&nbsp;slice&nbsp;that&nbsp;aliases&nbsp;into&nbsp;it&nbsp;and&nbsp;contains&nbsp;only&nbsp;the&nbsp;extra&nbsp;bytes.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3851946">//&nbsp;original&nbsp;slice&nbsp;has&nbsp;sufficient&nbsp;capacity&nbsp;then&nbsp;no&nbsp;allocation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="3852021">func</span>&nbsp;<span class="ident" id="3852026">sliceForAppend</span><span class="op" id="3852040">(</span><span class="ident" id="3852041">in</span>&nbsp;<span class="op" id="3852044">[</span><span class="op" id="3852045">]</span><span class="builtintype" id="3852046">byte</span><span class="op" id="3852050">,</span>&nbsp;<span class="ident" id="3852052">n</span>&nbsp;<span class="builtintype" id="3852054">int</span><span class="op" id="3852057">)</span>&nbsp;<span class="op" id="3852059">(</span><span class="ident" id="3852060">head</span><span class="op" id="3852064">,</span>&nbsp;<span class="ident" id="3852066">tail</span>&nbsp;<span class="op" id="3852071">[</span><span class="op" id="3852072">]</span><span class="builtintype" id="3852073">byte</span><span class="op" id="3852077">)</span>&nbsp;<span class="op" id="3852079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852082">if</span>&nbsp;<span class="ident" id="3852085">total</span>&nbsp;<span class="op" id="3852091">:=</span>&nbsp;<span class="builtinfunc" id="3852094">len</span><span class="op" id="3852097">(</span><span class="ident" id="3852098">in</span><span class="op" id="3852100">)</span>&nbsp;<span class="op" id="3852102">+</span>&nbsp;<span class="ident" id="3852104">n</span><span class="op" id="3852105">;</span>&nbsp;<span class="builtinfunc" id="3852107">cap</span><span class="op" id="3852110">(</span><span class="ident" id="3852111">in</span><span class="op" id="3852113">)</span>&nbsp;<span class="op" id="3852115">&gt;=</span>&nbsp;<span class="ident" id="3852118">total</span>&nbsp;<span class="op" id="3852124">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852128">head</span>&nbsp;<span class="op" id="3852133">=</span>&nbsp;<span class="ident" id="3852135">in</span><span class="op" id="3852137">[</span><span class="op" id="3852138">:</span><span class="ident" id="3852139">total</span><span class="op" id="3852144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852147">}</span>&nbsp;<span class="keyword" id="3852149">else</span>&nbsp;<span class="op" id="3852154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852158">head</span>&nbsp;<span class="op" id="3852163">=</span>&nbsp;<span class="builtinfunc" id="3852165">make</span><span class="op" id="3852169">(</span><span class="op" id="3852170">[</span><span class="op" id="3852171">]</span><span class="builtintype" id="3852172">byte</span><span class="op" id="3852176">,</span>&nbsp;<span class="ident" id="3852178">total</span><span class="op" id="3852183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3852187">copy</span><span class="op" id="3852191">(</span><span class="ident" id="3852192">head</span><span class="op" id="3852196">,</span>&nbsp;<span class="ident" id="3852198">in</span><span class="op" id="3852200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852203">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852206">tail</span>&nbsp;<span class="op" id="3852211">=</span>&nbsp;<span class="ident" id="3852213">head</span><span class="op" id="3852217">[</span><span class="builtinfunc" id="3852218">len</span><span class="op" id="3852221">(</span><span class="ident" id="3852222">in</span><span class="op" id="3852224">)</span><span class="op" id="3852225">:</span><span class="op" id="3852226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852229">return</span><br>
<span class="lineno"></span><span class="op" id="3852236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3852239">//&nbsp;counterCrypt&nbsp;crypts&nbsp;in&nbsp;to&nbsp;out&nbsp;using&nbsp;g.cipher&nbsp;in&nbsp;counter&nbsp;mode.</span><br>
<span class="lineno">285</span><span class="keyword" id="3852304">func</span>&nbsp;<span class="op" id="3852309">(</span><span class="ident" id="3852310">g</span>&nbsp;<span class="op" id="3852312">*</span><span class="ident" id="3852313">gcm</span><span class="op" id="3852316">)</span>&nbsp;<span class="ident" id="3852318">counterCrypt</span><span class="op" id="3852330">(</span><span class="ident" id="3852331">out</span><span class="op" id="3852334">,</span>&nbsp;<span class="ident" id="3852336">in</span>&nbsp;<span class="op" id="3852339">[</span><span class="op" id="3852340">]</span><span class="builtintype" id="3852341">byte</span><span class="op" id="3852345">,</span>&nbsp;<span class="ident" id="3852347">counter</span>&nbsp;<span class="op" id="3852355">*</span><span class="op" id="3852356">[</span><span class="ident" id="3852357">gcmBlockSize</span><span class="op" id="3852369">]</span><span class="builtintype" id="3852370">byte</span><span class="op" id="3852374">)</span>&nbsp;<span class="op" id="3852376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852379">var</span>&nbsp;<span class="ident" id="3852383">mask</span>&nbsp;<span class="op" id="3852388">[</span><span class="ident" id="3852389">gcmBlockSize</span><span class="op" id="3852401">]</span><span class="builtintype" id="3852402">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852409">for</span>&nbsp;<span class="builtinfunc" id="3852413">len</span><span class="op" id="3852416">(</span><span class="ident" id="3852417">in</span><span class="op" id="3852419">)</span>&nbsp;<span class="op" id="3852421">&gt;=</span>&nbsp;<span class="ident" id="3852424">gcmBlockSize</span>&nbsp;<span class="op" id="3852437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852441">g</span><span class="op" id="3852442">.</span><span class="ident" id="3852443">cipher</span><span class="op" id="3852449">.</span><span class="ident" id="3852450">Encrypt</span><span class="op" id="3852457">(</span><span class="ident" id="3852458">mask</span><span class="op" id="3852462">[</span><span class="op" id="3852463">:</span><span class="op" id="3852464">]</span><span class="op" id="3852465">,</span>&nbsp;<span class="ident" id="3852467">counter</span><span class="op" id="3852474">[</span><span class="op" id="3852475">:</span><span class="op" id="3852476">]</span><span class="op" id="3852477">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852481">gcmInc32</span><span class="op" id="3852489">(</span><span class="ident" id="3852490">counter</span><span class="op" id="3852497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852502">xorWords</span><span class="op" id="3852510">(</span><span class="ident" id="3852511">out</span><span class="op" id="3852514">,</span>&nbsp;<span class="ident" id="3852516">in</span><span class="op" id="3852518">,</span>&nbsp;<span class="ident" id="3852520">mask</span><span class="op" id="3852524">[</span><span class="op" id="3852525">:</span><span class="op" id="3852526">]</span><span class="op" id="3852527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852531">out</span>&nbsp;<span class="op" id="3852535">=</span>&nbsp;<span class="ident" id="3852537">out</span><span class="op" id="3852540">[</span><span class="ident" id="3852541">gcmBlockSize</span><span class="op" id="3852553">:</span><span class="op" id="3852554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852558">in</span>&nbsp;<span class="op" id="3852561">=</span>&nbsp;<span class="ident" id="3852563">in</span><span class="op" id="3852565">[</span><span class="ident" id="3852566">gcmBlockSize</span><span class="op" id="3852578">:</span><span class="op" id="3852579">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852586">if</span>&nbsp;<span class="builtinfunc" id="3852589">len</span><span class="op" id="3852592">(</span><span class="ident" id="3852593">in</span><span class="op" id="3852595">)</span>&nbsp;<span class="op" id="3852597">&gt;</span>&nbsp;<span class="num" id="3852599">0</span>&nbsp;<span class="op" id="3852601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852605">g</span><span class="op" id="3852606">.</span><span class="ident" id="3852607">cipher</span><span class="op" id="3852613">.</span><span class="ident" id="3852614">Encrypt</span><span class="op" id="3852621">(</span><span class="ident" id="3852622">mask</span><span class="op" id="3852626">[</span><span class="op" id="3852627">:</span><span class="op" id="3852628">]</span><span class="op" id="3852629">,</span>&nbsp;<span class="ident" id="3852631">counter</span><span class="op" id="3852638">[</span><span class="op" id="3852639">:</span><span class="op" id="3852640">]</span><span class="op" id="3852641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852645">gcmInc32</span><span class="op" id="3852653">(</span><span class="ident" id="3852654">counter</span><span class="op" id="3852661">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852665">xorBytes</span><span class="op" id="3852673">(</span><span class="ident" id="3852674">out</span><span class="op" id="3852677">,</span>&nbsp;<span class="ident" id="3852679">in</span><span class="op" id="3852681">,</span>&nbsp;<span class="ident" id="3852683">mask</span><span class="op" id="3852687">[</span><span class="op" id="3852688">:</span><span class="op" id="3852689">]</span><span class="op" id="3852690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852693">}</span><br>
<span class="lineno"></span><span class="op" id="3852695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3852698">//&nbsp;auth&nbsp;calculates&nbsp;GHASH(ciphertext,&nbsp;additionalData),&nbsp;masks&nbsp;the&nbsp;result&nbsp;with</span><br>
<span class="lineno">305</span><span class="comment" id="3852774">//&nbsp;tagMask&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="3852815">func</span>&nbsp;<span class="op" id="3852820">(</span><span class="ident" id="3852821">g</span>&nbsp;<span class="op" id="3852823">*</span><span class="ident" id="3852824">gcm</span><span class="op" id="3852827">)</span>&nbsp;<span class="ident" id="3852829">auth</span><span class="op" id="3852833">(</span><span class="ident" id="3852834">out</span><span class="op" id="3852837">,</span>&nbsp;<span class="ident" id="3852839">ciphertext</span><span class="op" id="3852849">,</span>&nbsp;<span class="ident" id="3852851">additionalData</span>&nbsp;<span class="op" id="3852866">[</span><span class="op" id="3852867">]</span><span class="builtintype" id="3852868">byte</span><span class="op" id="3852872">,</span>&nbsp;<span class="ident" id="3852874">tagMask</span>&nbsp;<span class="op" id="3852882">*</span><span class="op" id="3852883">[</span><span class="ident" id="3852884">gcmTagSize</span><span class="op" id="3852894">]</span><span class="builtintype" id="3852895">byte</span><span class="op" id="3852899">)</span>&nbsp;<span class="op" id="3852901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852904">var</span>&nbsp;<span class="ident" id="3852908">y</span>&nbsp;<span class="ident" id="3852910">gcmFieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852927">g</span><span class="op" id="3852928">.</span><span class="ident" id="3852929">update</span><span class="op" id="3852935">(</span><span class="op" id="3852936">&amp;</span><span class="ident" id="3852937">y</span><span class="op" id="3852938">,</span>&nbsp;<span class="ident" id="3852940">additionalData</span><span class="op" id="3852954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852957">g</span><span class="op" id="3852958">.</span><span class="ident" id="3852959">update</span><span class="op" id="3852965">(</span><span class="op" id="3852966">&amp;</span><span class="ident" id="3852967">y</span><span class="op" id="3852968">,</span>&nbsp;<span class="ident" id="3852970">ciphertext</span><span class="op" id="3852980">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852984">y</span><span class="op" id="3852985">.</span><span class="ident" id="3852986">low</span>&nbsp;<span class="op" id="3852990">^=</span>&nbsp;<span class="ident" id="3852993">uint64</span><span class="op" id="3852999">(</span><span class="builtinfunc" id="3853000">len</span><span class="op" id="3853003">(</span><span class="ident" id="3853004">additionalData</span><span class="op" id="3853018">)</span><span class="op" id="3853019">)</span>&nbsp;<span class="op" id="3853021">*</span>&nbsp;<span class="num" id="3853023">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853026">y</span><span class="op" id="3853027">.</span><span class="ident" id="3853028">high</span>&nbsp;<span class="op" id="3853033">^=</span>&nbsp;<span class="ident" id="3853036">uint64</span><span class="op" id="3853042">(</span><span class="builtinfunc" id="3853043">len</span><span class="op" id="3853046">(</span><span class="ident" id="3853047">ciphertext</span><span class="op" id="3853057">)</span><span class="op" id="3853058">)</span>&nbsp;<span class="op" id="3853060">*</span>&nbsp;<span class="num" id="3853062">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853066">g</span><span class="op" id="3853067">.</span><span class="ident" id="3853068">mul</span><span class="op" id="3853071">(</span><span class="op" id="3853072">&amp;</span><span class="ident" id="3853073">y</span><span class="op" id="3853074">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853078">putUint64</span><span class="op" id="3853087">(</span><span class="ident" id="3853088">out</span><span class="op" id="3853091">,</span>&nbsp;<span class="ident" id="3853093">y</span><span class="op" id="3853094">.</span><span class="ident" id="3853095">low</span><span class="op" id="3853098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853101">putUint64</span><span class="op" id="3853110">(</span><span class="ident" id="3853111">out</span><span class="op" id="3853114">[</span><span class="num" id="3853115">8</span><span class="op" id="3853116">:</span><span class="op" id="3853117">]</span><span class="op" id="3853118">,</span>&nbsp;<span class="ident" id="3853120">y</span><span class="op" id="3853121">.</span><span class="ident" id="3853122">high</span><span class="op" id="3853126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853130">xorWords</span><span class="op" id="3853138">(</span><span class="ident" id="3853139">out</span><span class="op" id="3853142">,</span>&nbsp;<span class="ident" id="3853144">out</span><span class="op" id="3853147">,</span>&nbsp;<span class="ident" id="3853149">tagMask</span><span class="op" id="3853156">[</span><span class="op" id="3853157">:</span><span class="op" id="3853158">]</span><span class="op" id="3853159">)</span><br>
<span class="lineno">320</span><span class="op" id="3853161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3853164">func</span>&nbsp;<span class="ident" id="3853169">getUint64</span><span class="op" id="3853178">(</span><span class="ident" id="3853179">data</span>&nbsp;<span class="op" id="3853184">[</span><span class="op" id="3853185">]</span><span class="builtintype" id="3853186">byte</span><span class="op" id="3853190">)</span>&nbsp;<span class="ident" id="3853192">uint64</span>&nbsp;<span class="op" id="3853199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853202">r</span>&nbsp;<span class="op" id="3853204">:=</span>&nbsp;<span class="ident" id="3853207">uint64</span><span class="op" id="3853213">(</span><span class="ident" id="3853214">data</span><span class="op" id="3853218">[</span><span class="num" id="3853219">0</span><span class="op" id="3853220">]</span><span class="op" id="3853221">)</span><span class="op" id="3853222">&lt;&lt;</span><span class="num" id="3853224">56</span>&nbsp;<span class="op" id="3853227">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853231">uint64</span><span class="op" id="3853237">(</span><span class="ident" id="3853238">data</span><span class="op" id="3853242">[</span><span class="num" id="3853243">1</span><span class="op" id="3853244">]</span><span class="op" id="3853245">)</span><span class="op" id="3853246">&lt;&lt;</span><span class="num" id="3853248">48</span>&nbsp;<span class="op" id="3853251">|</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853255">uint64</span><span class="op" id="3853261">(</span><span class="ident" id="3853262">data</span><span class="op" id="3853266">[</span><span class="num" id="3853267">2</span><span class="op" id="3853268">]</span><span class="op" id="3853269">)</span><span class="op" id="3853270">&lt;&lt;</span><span class="num" id="3853272">40</span>&nbsp;<span class="op" id="3853275">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853279">uint64</span><span class="op" id="3853285">(</span><span class="ident" id="3853286">data</span><span class="op" id="3853290">[</span><span class="num" id="3853291">3</span><span class="op" id="3853292">]</span><span class="op" id="3853293">)</span><span class="op" id="3853294">&lt;&lt;</span><span class="num" id="3853296">32</span>&nbsp;<span class="op" id="3853299">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853303">uint64</span><span class="op" id="3853309">(</span><span class="ident" id="3853310">data</span><span class="op" id="3853314">[</span><span class="num" id="3853315">4</span><span class="op" id="3853316">]</span><span class="op" id="3853317">)</span><span class="op" id="3853318">&lt;&lt;</span><span class="num" id="3853320">24</span>&nbsp;<span class="op" id="3853323">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853327">uint64</span><span class="op" id="3853333">(</span><span class="ident" id="3853334">data</span><span class="op" id="3853338">[</span><span class="num" id="3853339">5</span><span class="op" id="3853340">]</span><span class="op" id="3853341">)</span><span class="op" id="3853342">&lt;&lt;</span><span class="num" id="3853344">16</span>&nbsp;<span class="op" id="3853347">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853351">uint64</span><span class="op" id="3853357">(</span><span class="ident" id="3853358">data</span><span class="op" id="3853362">[</span><span class="num" id="3853363">6</span><span class="op" id="3853364">]</span><span class="op" id="3853365">)</span><span class="op" id="3853366">&lt;&lt;</span><span class="num" id="3853368">8</span>&nbsp;<span class="op" id="3853370">|</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853374">uint64</span><span class="op" id="3853380">(</span><span class="ident" id="3853381">data</span><span class="op" id="3853385">[</span><span class="num" id="3853386">7</span><span class="op" id="3853387">]</span><span class="op" id="3853388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3853391">return</span>&nbsp;<span class="ident" id="3853398">r</span><br>
<span class="lineno"></span><span class="op" id="3853400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3853403">func</span>&nbsp;<span class="ident" id="3853408">putUint64</span><span class="op" id="3853417">(</span><span class="ident" id="3853418">out</span>&nbsp;<span class="op" id="3853422">[</span><span class="op" id="3853423">]</span><span class="builtintype" id="3853424">byte</span><span class="op" id="3853428">,</span>&nbsp;<span class="ident" id="3853430">v</span>&nbsp;<span class="ident" id="3853432">uint64</span><span class="op" id="3853438">)</span>&nbsp;<span class="op" id="3853440">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853443">out</span><span class="op" id="3853446">[</span><span class="num" id="3853447">0</span><span class="op" id="3853448">]</span>&nbsp;<span class="op" id="3853450">=</span>&nbsp;<span class="builtintype" id="3853452">byte</span><span class="op" id="3853456">(</span><span class="ident" id="3853457">v</span>&nbsp;<span class="op" id="3853459">&gt;&gt;</span>&nbsp;<span class="num" id="3853462">56</span><span class="op" id="3853464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853467">out</span><span class="op" id="3853470">[</span><span class="num" id="3853471">1</span><span class="op" id="3853472">]</span>&nbsp;<span class="op" id="3853474">=</span>&nbsp;<span class="builtintype" id="3853476">byte</span><span class="op" id="3853480">(</span><span class="ident" id="3853481">v</span>&nbsp;<span class="op" id="3853483">&gt;&gt;</span>&nbsp;<span class="num" id="3853486">48</span><span class="op" id="3853488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853491">out</span><span class="op" id="3853494">[</span><span class="num" id="3853495">2</span><span class="op" id="3853496">]</span>&nbsp;<span class="op" id="3853498">=</span>&nbsp;<span class="builtintype" id="3853500">byte</span><span class="op" id="3853504">(</span><span class="ident" id="3853505">v</span>&nbsp;<span class="op" id="3853507">&gt;&gt;</span>&nbsp;<span class="num" id="3853510">40</span><span class="op" id="3853512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853515">out</span><span class="op" id="3853518">[</span><span class="num" id="3853519">3</span><span class="op" id="3853520">]</span>&nbsp;<span class="op" id="3853522">=</span>&nbsp;<span class="builtintype" id="3853524">byte</span><span class="op" id="3853528">(</span><span class="ident" id="3853529">v</span>&nbsp;<span class="op" id="3853531">&gt;&gt;</span>&nbsp;<span class="num" id="3853534">32</span><span class="op" id="3853536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853539">out</span><span class="op" id="3853542">[</span><span class="num" id="3853543">4</span><span class="op" id="3853544">]</span>&nbsp;<span class="op" id="3853546">=</span>&nbsp;<span class="builtintype" id="3853548">byte</span><span class="op" id="3853552">(</span><span class="ident" id="3853553">v</span>&nbsp;<span class="op" id="3853555">&gt;&gt;</span>&nbsp;<span class="num" id="3853558">24</span><span class="op" id="3853560">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853563">out</span><span class="op" id="3853566">[</span><span class="num" id="3853567">5</span><span class="op" id="3853568">]</span>&nbsp;<span class="op" id="3853570">=</span>&nbsp;<span class="builtintype" id="3853572">byte</span><span class="op" id="3853576">(</span><span class="ident" id="3853577">v</span>&nbsp;<span class="op" id="3853579">&gt;&gt;</span>&nbsp;<span class="num" id="3853582">16</span><span class="op" id="3853584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853587">out</span><span class="op" id="3853590">[</span><span class="num" id="3853591">6</span><span class="op" id="3853592">]</span>&nbsp;<span class="op" id="3853594">=</span>&nbsp;<span class="builtintype" id="3853596">byte</span><span class="op" id="3853600">(</span><span class="ident" id="3853601">v</span>&nbsp;<span class="op" id="3853603">&gt;&gt;</span>&nbsp;<span class="num" id="3853606">8</span><span class="op" id="3853607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853610">out</span><span class="op" id="3853613">[</span><span class="num" id="3853614">7</span><span class="op" id="3853615">]</span>&nbsp;<span class="op" id="3853617">=</span>&nbsp;<span class="builtintype" id="3853619">byte</span><span class="op" id="3853623">(</span><span class="ident" id="3853624">v</span><span class="op" id="3853625">)</span><br>
<span class="lineno"></span><span class="op" id="3853627">}</span>
</div>
</body>
</html>
