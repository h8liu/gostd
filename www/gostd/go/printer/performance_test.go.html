<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html" class="current">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7680431">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7680486">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7680540">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7680591">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="7680655">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680689">package</span>&nbsp;<span class="ident" id="7680697">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7680706">import</span>&nbsp;<span class="op" id="7680713">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680716">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680725">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680735">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680748">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680754">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680767">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680774">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7680784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7680787">var</span>&nbsp;<span class="ident" id="7680791">testfile</span>&nbsp;<span class="op" id="7680800">*</span><span class="ident" id="7680801">ast</span><span class="op" id="7680804">.</span><span class="ident" id="7680805">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680811">func</span>&nbsp;<span class="ident" id="7680816">testprint</span><span class="op" id="7680825">(</span><span class="ident" id="7680826">out</span>&nbsp;<span class="ident" id="7680830">io</span><span class="op" id="7680832">.</span><span class="ident" id="7680833">Writer</span><span class="op" id="7680839">,</span>&nbsp;<span class="ident" id="7680841">file</span>&nbsp;<span class="op" id="7680846">*</span><span class="ident" id="7680847">ast</span><span class="op" id="7680850">.</span><span class="ident" id="7680851">File</span><span class="op" id="7680855">)</span>&nbsp;<span class="op" id="7680857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7680860">if</span>&nbsp;<span class="ident" id="7680863">err</span>&nbsp;<span class="op" id="7680867">:=</span>&nbsp;<span class="op" id="7680870">(</span><span class="op" id="7680871">&amp;</span><span class="ident" id="7680872">Config</span><span class="op" id="7680878">{</span><span class="ident" id="7680879">TabIndent</span>&nbsp;<span class="op" id="7680889">|</span>&nbsp;<span class="ident" id="7680891">UseSpaces</span><span class="op" id="7680900">,</span>&nbsp;<span class="num" id="7680902">8</span><span class="op" id="7680903">,</span>&nbsp;<span class="num" id="7680905">0</span><span class="op" id="7680906">}</span><span class="op" id="7680907">)</span><span class="op" id="7680908">.</span><span class="ident" id="7680909">Fprint</span><span class="op" id="7680915">(</span><span class="ident" id="7680916">out</span><span class="op" id="7680919">,</span>&nbsp;<span class="ident" id="7680921">fset</span><span class="op" id="7680925">,</span>&nbsp;<span class="ident" id="7680927">file</span><span class="op" id="7680931">)</span><span class="op" id="7680932">;</span>&nbsp;<span class="ident" id="7680934">err</span>&nbsp;<span class="op" id="7680938">!=</span>&nbsp;<span class="builtintype" id="7680941">nil</span>&nbsp;<span class="op" id="7680945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7680949">log</span><span class="op" id="7680952">.</span><span class="ident" id="7680953">Fatalf</span><span class="op" id="7680959">(</span><span class="string" id="7680960">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7680977">,</span>&nbsp;<span class="ident" id="7680979">err</span><span class="op" id="7680982">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7680985">}</span><br>
<span class="lineno"></span><span class="op" id="7680987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7680990">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="7681065">func</span>&nbsp;<span class="ident" id="7681070">initialize</span><span class="op" id="7681080">(</span><span class="op" id="7681081">)</span>&nbsp;<span class="op" id="7681083">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681086">const</span>&nbsp;<span class="ident" id="7681092">filename</span>&nbsp;<span class="op" id="7681101">=</span>&nbsp;<span class="string" id="7681103">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681126">src</span><span class="op" id="7681129">,</span>&nbsp;<span class="ident" id="7681131">err</span>&nbsp;<span class="op" id="7681135">:=</span>&nbsp;<span class="ident" id="7681138">ioutil</span><span class="op" id="7681144">.</span><span class="ident" id="7681145">ReadFile</span><span class="op" id="7681153">(</span><span class="ident" id="7681154">filename</span><span class="op" id="7681162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681165">if</span>&nbsp;<span class="ident" id="7681168">err</span>&nbsp;<span class="op" id="7681172">!=</span>&nbsp;<span class="builtintype" id="7681175">nil</span>&nbsp;<span class="op" id="7681179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681183">log</span><span class="op" id="7681186">.</span><span class="ident" id="7681187">Fatalf</span><span class="op" id="7681193">(</span><span class="string" id="7681194">&#34;%s&#34;</span><span class="op" id="7681198">,</span>&nbsp;<span class="ident" id="7681200">err</span><span class="op" id="7681203">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681210">file</span><span class="op" id="7681214">,</span>&nbsp;<span class="ident" id="7681216">err</span>&nbsp;<span class="op" id="7681220">:=</span>&nbsp;<span class="ident" id="7681223">parser</span><span class="op" id="7681229">.</span><span class="ident" id="7681230">ParseFile</span><span class="op" id="7681239">(</span><span class="ident" id="7681240">fset</span><span class="op" id="7681244">,</span>&nbsp;<span class="ident" id="7681246">filename</span><span class="op" id="7681254">,</span>&nbsp;<span class="ident" id="7681256">src</span><span class="op" id="7681259">,</span>&nbsp;<span class="ident" id="7681261">parser</span><span class="op" id="7681267">.</span><span class="ident" id="7681268">ParseComments</span><span class="op" id="7681281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681284">if</span>&nbsp;<span class="ident" id="7681287">err</span>&nbsp;<span class="op" id="7681291">!=</span>&nbsp;<span class="builtintype" id="7681294">nil</span>&nbsp;<span class="op" id="7681298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681302">log</span><span class="op" id="7681305">.</span><span class="ident" id="7681306">Fatalf</span><span class="op" id="7681312">(</span><span class="string" id="7681313">&#34;%s&#34;</span><span class="op" id="7681317">,</span>&nbsp;<span class="ident" id="7681319">err</span><span class="op" id="7681322">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681329">var</span>&nbsp;<span class="ident" id="7681333">buf</span>&nbsp;<span class="ident" id="7681337">bytes</span><span class="op" id="7681342">.</span><span class="ident" id="7681343">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681351">testprint</span><span class="op" id="7681360">(</span><span class="op" id="7681361">&amp;</span><span class="ident" id="7681362">buf</span><span class="op" id="7681365">,</span>&nbsp;<span class="ident" id="7681367">file</span><span class="op" id="7681371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681374">if</span>&nbsp;<span class="op" id="7681377">!</span><span class="ident" id="7681378">bytes</span><span class="op" id="7681383">.</span><span class="ident" id="7681384">Equal</span><span class="op" id="7681389">(</span><span class="ident" id="7681390">buf</span><span class="op" id="7681393">.</span><span class="ident" id="7681394">Bytes</span><span class="op" id="7681399">(</span><span class="op" id="7681400">)</span><span class="op" id="7681401">,</span>&nbsp;<span class="ident" id="7681403">src</span><span class="op" id="7681406">)</span>&nbsp;<span class="op" id="7681408">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681412">log</span><span class="op" id="7681415">.</span><span class="ident" id="7681416">Fatalf</span><span class="op" id="7681422">(</span><span class="string" id="7681423">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="7681455">,</span>&nbsp;<span class="ident" id="7681457">filename</span><span class="op" id="7681465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681472">testfile</span>&nbsp;<span class="op" id="7681481">=</span>&nbsp;<span class="ident" id="7681483">file</span><br>
<span class="lineno"></span><span class="op" id="7681488">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="7681491">func</span>&nbsp;<span class="ident" id="7681496">BenchmarkPrint</span><span class="op" id="7681510">(</span><span class="ident" id="7681511">b</span>&nbsp;<span class="op" id="7681513">*</span><span class="ident" id="7681514">testing</span><span class="op" id="7681521">.</span><span class="ident" id="7681522">B</span><span class="op" id="7681523">)</span>&nbsp;<span class="op" id="7681525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681528">if</span>&nbsp;<span class="ident" id="7681531">testfile</span>&nbsp;<span class="op" id="7681540">==</span>&nbsp;<span class="builtintype" id="7681543">nil</span>&nbsp;<span class="op" id="7681547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681551">initialize</span><span class="op" id="7681561">(</span><span class="op" id="7681562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681565">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681568">for</span>&nbsp;<span class="ident" id="7681572">i</span>&nbsp;<span class="op" id="7681574">:=</span>&nbsp;<span class="num" id="7681577">0</span><span class="op" id="7681578">;</span>&nbsp;<span class="ident" id="7681580">i</span>&nbsp;<span class="op" id="7681582">&lt;</span>&nbsp;<span class="ident" id="7681584">b</span><span class="op" id="7681585">.</span><span class="ident" id="7681586">N</span><span class="op" id="7681587">;</span>&nbsp;<span class="ident" id="7681589">i</span><span class="op" id="7681590">++</span>&nbsp;<span class="op" id="7681593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681597">testprint</span><span class="op" id="7681606">(</span><span class="ident" id="7681607">ioutil</span><span class="op" id="7681613">.</span><span class="ident" id="7681614">Discard</span><span class="op" id="7681621">,</span>&nbsp;<span class="ident" id="7681623">testfile</span><span class="op" id="7681631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681634">}</span><br>
<span class="lineno"></span><span class="op" id="7681636">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
