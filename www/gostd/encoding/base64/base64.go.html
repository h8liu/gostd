<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3179328">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3179383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3179437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3179488">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3179559">package</span>&nbsp;<span class="ident" id="3179567">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3179575">import</span>&nbsp;<span class="op" id="3179582">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3179585">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3179594">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3179600">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3179611">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3179621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3179624">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3179645">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3179713">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3179781">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3179849">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3179919">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3179982">type</span>&nbsp;<span class="ident" id="3179987">Encoding</span>&nbsp;<span class="keyword" id="3179996">struct</span>&nbsp;<span class="op" id="3180003">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180006">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3180016">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180024">decodeMap</span>&nbsp;<span class="op" id="3180034">[</span><span class="num" id="3180035">256</span><span class="op" id="3180038">]</span><span class="builtintype" id="3180039">byte</span><br>
<span class="lineno"></span><span class="op" id="3180044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3180047">const</span>&nbsp;<span class="ident" id="3180053">encodeStd</span>&nbsp;<span class="op" id="3180063">=</span>&nbsp;<span class="string" id="3180065">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3180132">const</span>&nbsp;<span class="ident" id="3180138">encodeURL</span>&nbsp;<span class="op" id="3180148">=</span>&nbsp;<span class="string" id="3180150">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3180218">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3180287">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3180322">func</span>&nbsp;<span class="ident" id="3180327">NewEncoding</span><span class="op" id="3180338">(</span><span class="ident" id="3180339">encoder</span>&nbsp;<span class="builtintype" id="3180347">string</span><span class="op" id="3180353">)</span>&nbsp;<span class="op" id="3180355">*</span><span class="ident" id="3180356">Encoding</span>&nbsp;<span class="op" id="3180365">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180368">e</span>&nbsp;<span class="op" id="3180370">:=</span>&nbsp;<span class="builtinfunc" id="3180373">new</span><span class="op" id="3180376">(</span><span class="ident" id="3180377">Encoding</span><span class="op" id="3180385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180388">e</span><span class="op" id="3180389">.</span><span class="ident" id="3180390">encode</span>&nbsp;<span class="op" id="3180397">=</span>&nbsp;<span class="ident" id="3180399">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180408">for</span>&nbsp;<span class="ident" id="3180412">i</span>&nbsp;<span class="op" id="3180414">:=</span>&nbsp;<span class="num" id="3180417">0</span><span class="op" id="3180418">;</span>&nbsp;<span class="ident" id="3180420">i</span>&nbsp;<span class="op" id="3180422">&lt;</span>&nbsp;<span class="builtinfunc" id="3180424">len</span><span class="op" id="3180427">(</span><span class="ident" id="3180428">e</span><span class="op" id="3180429">.</span><span class="ident" id="3180430">decodeMap</span><span class="op" id="3180439">)</span><span class="op" id="3180440">;</span>&nbsp;<span class="ident" id="3180442">i</span><span class="op" id="3180443">++</span>&nbsp;<span class="op" id="3180446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180450">e</span><span class="op" id="3180451">.</span><span class="ident" id="3180452">decodeMap</span><span class="op" id="3180461">[</span><span class="ident" id="3180462">i</span><span class="op" id="3180463">]</span>&nbsp;<span class="op" id="3180465">=</span>&nbsp;<span class="num" id="3180467">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180473">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180476">for</span>&nbsp;<span class="ident" id="3180480">i</span>&nbsp;<span class="op" id="3180482">:=</span>&nbsp;<span class="num" id="3180485">0</span><span class="op" id="3180486">;</span>&nbsp;<span class="ident" id="3180488">i</span>&nbsp;<span class="op" id="3180490">&lt;</span>&nbsp;<span class="builtinfunc" id="3180492">len</span><span class="op" id="3180495">(</span><span class="ident" id="3180496">encoder</span><span class="op" id="3180503">)</span><span class="op" id="3180504">;</span>&nbsp;<span class="ident" id="3180506">i</span><span class="op" id="3180507">++</span>&nbsp;<span class="op" id="3180510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180514">e</span><span class="op" id="3180515">.</span><span class="ident" id="3180516">decodeMap</span><span class="op" id="3180525">[</span><span class="ident" id="3180526">encoder</span><span class="op" id="3180533">[</span><span class="ident" id="3180534">i</span><span class="op" id="3180535">]</span><span class="op" id="3180536">]</span>&nbsp;<span class="op" id="3180538">=</span>&nbsp;<span class="builtintype" id="3180540">byte</span><span class="op" id="3180544">(</span><span class="ident" id="3180545">i</span><span class="op" id="3180546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180552">return</span>&nbsp;<span class="ident" id="3180559">e</span><br>
<span class="lineno"></span><span class="op" id="3180561">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3180564">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3180626">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3180639">var</span>&nbsp;<span class="ident" id="3180643">StdEncoding</span>&nbsp;<span class="op" id="3180655">=</span>&nbsp;<span class="ident" id="3180657">NewEncoding</span><span class="op" id="3180668">(</span><span class="ident" id="3180669">encodeStd</span><span class="op" id="3180678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3180681">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3180750">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3180798">var</span>&nbsp;<span class="ident" id="3180802">URLEncoding</span>&nbsp;<span class="op" id="3180814">=</span>&nbsp;<span class="ident" id="3180816">NewEncoding</span><span class="op" id="3180827">(</span><span class="ident" id="3180828">encodeURL</span><span class="op" id="3180837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3180840">var</span>&nbsp;<span class="ident" id="3180844">removeNewlinesMapper</span>&nbsp;<span class="op" id="3180865">=</span>&nbsp;<span class="keyword" id="3180867">func</span><span class="op" id="3180871">(</span><span class="ident" id="3180872">r</span>&nbsp;<span class="builtintype" id="3180874">rune</span><span class="op" id="3180878">)</span>&nbsp;<span class="builtintype" id="3180880">rune</span>&nbsp;<span class="op" id="3180885">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180888">if</span>&nbsp;<span class="ident" id="3180891">r</span>&nbsp;<span class="op" id="3180893">==</span>&nbsp;<span class="string" id="3180896">&#39;\r&#39;</span>&nbsp;<span class="op" id="3180901">||</span>&nbsp;<span class="ident" id="3180904">r</span>&nbsp;<span class="op" id="3180906">==</span>&nbsp;<span class="string" id="3180909">&#39;\n&#39;</span>&nbsp;<span class="op" id="3180914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180918">return</span>&nbsp;<span class="op" id="3180925">-</span><span class="num" id="3180926">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180932">return</span>&nbsp;<span class="ident" id="3180939">r</span><br>
<span class="lineno"></span><span class="op" id="3180941">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3180944">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3180963">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3181017">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3181055">//</span><br>
<span class="lineno"></span><span class="comment" id="3181058">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3181116">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3181177">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3181231">func</span>&nbsp;<span class="op" id="3181236">(</span><span class="ident" id="3181237">enc</span>&nbsp;<span class="op" id="3181241">*</span><span class="ident" id="3181242">Encoding</span><span class="op" id="3181250">)</span>&nbsp;<span class="ident" id="3181252">Encode</span><span class="op" id="3181258">(</span><span class="ident" id="3181259">dst</span><span class="op" id="3181262">,</span>&nbsp;<span class="ident" id="3181264">src</span>&nbsp;<span class="op" id="3181268">[</span><span class="op" id="3181269">]</span><span class="builtintype" id="3181270">byte</span><span class="op" id="3181274">)</span>&nbsp;<span class="op" id="3181276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181279">if</span>&nbsp;<span class="builtinfunc" id="3181282">len</span><span class="op" id="3181285">(</span><span class="ident" id="3181286">src</span><span class="op" id="3181289">)</span>&nbsp;<span class="op" id="3181291">==</span>&nbsp;<span class="num" id="3181294">0</span>&nbsp;<span class="op" id="3181296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3181308">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181312">for</span>&nbsp;<span class="builtinfunc" id="3181316">len</span><span class="op" id="3181319">(</span><span class="ident" id="3181320">src</span><span class="op" id="3181323">)</span>&nbsp;<span class="op" id="3181325">&gt;</span>&nbsp;<span class="num" id="3181327">0</span>&nbsp;<span class="op" id="3181329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181333">var</span>&nbsp;<span class="ident" id="3181337">b0</span><span class="op" id="3181339">,</span>&nbsp;<span class="ident" id="3181341">b1</span><span class="op" id="3181343">,</span>&nbsp;<span class="ident" id="3181345">b2</span><span class="op" id="3181347">,</span>&nbsp;<span class="ident" id="3181349">b3</span>&nbsp;<span class="builtintype" id="3181352">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3181360">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3181409">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181434">switch</span>&nbsp;<span class="builtinfunc" id="3181441">len</span><span class="op" id="3181444">(</span><span class="ident" id="3181445">src</span><span class="op" id="3181448">)</span>&nbsp;<span class="op" id="3181450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181454">default</span><span class="op" id="3181461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181466">b3</span>&nbsp;<span class="op" id="3181469">=</span>&nbsp;<span class="ident" id="3181471">src</span><span class="op" id="3181474">[</span><span class="num" id="3181475">2</span><span class="op" id="3181476">]</span>&nbsp;<span class="op" id="3181478">&amp;</span>&nbsp;<span class="num" id="3181480">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181488">b2</span>&nbsp;<span class="op" id="3181491">=</span>&nbsp;<span class="ident" id="3181493">src</span><span class="op" id="3181496">[</span><span class="num" id="3181497">2</span><span class="op" id="3181498">]</span>&nbsp;<span class="op" id="3181500">&gt;&gt;</span>&nbsp;<span class="num" id="3181503">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181508">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181522">case</span>&nbsp;<span class="num" id="3181527">2</span><span class="op" id="3181528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181533">b2</span>&nbsp;<span class="op" id="3181536">|=</span>&nbsp;<span class="op" id="3181539">(</span><span class="ident" id="3181540">src</span><span class="op" id="3181543">[</span><span class="num" id="3181544">1</span><span class="op" id="3181545">]</span>&nbsp;<span class="op" id="3181547">&lt;&lt;</span>&nbsp;<span class="num" id="3181550">2</span><span class="op" id="3181551">)</span>&nbsp;<span class="op" id="3181553">&amp;</span>&nbsp;<span class="num" id="3181555">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181563">b1</span>&nbsp;<span class="op" id="3181566">=</span>&nbsp;<span class="ident" id="3181568">src</span><span class="op" id="3181571">[</span><span class="num" id="3181572">1</span><span class="op" id="3181573">]</span>&nbsp;<span class="op" id="3181575">&gt;&gt;</span>&nbsp;<span class="num" id="3181578">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181583">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181597">case</span>&nbsp;<span class="num" id="3181602">1</span><span class="op" id="3181603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181608">b1</span>&nbsp;<span class="op" id="3181611">|=</span>&nbsp;<span class="op" id="3181614">(</span><span class="ident" id="3181615">src</span><span class="op" id="3181618">[</span><span class="num" id="3181619">0</span><span class="op" id="3181620">]</span>&nbsp;<span class="op" id="3181622">&lt;&lt;</span>&nbsp;<span class="num" id="3181625">4</span><span class="op" id="3181626">)</span>&nbsp;<span class="op" id="3181628">&amp;</span>&nbsp;<span class="num" id="3181630">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181638">b0</span>&nbsp;<span class="op" id="3181641">=</span>&nbsp;<span class="ident" id="3181643">src</span><span class="op" id="3181646">[</span><span class="num" id="3181647">0</span><span class="op" id="3181648">]</span>&nbsp;<span class="op" id="3181650">&gt;&gt;</span>&nbsp;<span class="num" id="3181653">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3181657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3181662">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181713">dst</span><span class="op" id="3181716">[</span><span class="num" id="3181717">0</span><span class="op" id="3181718">]</span>&nbsp;<span class="op" id="3181720">=</span>&nbsp;<span class="ident" id="3181722">enc</span><span class="op" id="3181725">.</span><span class="ident" id="3181726">encode</span><span class="op" id="3181732">[</span><span class="ident" id="3181733">b0</span><span class="op" id="3181735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181739">dst</span><span class="op" id="3181742">[</span><span class="num" id="3181743">1</span><span class="op" id="3181744">]</span>&nbsp;<span class="op" id="3181746">=</span>&nbsp;<span class="ident" id="3181748">enc</span><span class="op" id="3181751">.</span><span class="ident" id="3181752">encode</span><span class="op" id="3181758">[</span><span class="ident" id="3181759">b1</span><span class="op" id="3181761">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181765">dst</span><span class="op" id="3181768">[</span><span class="num" id="3181769">2</span><span class="op" id="3181770">]</span>&nbsp;<span class="op" id="3181772">=</span>&nbsp;<span class="ident" id="3181774">enc</span><span class="op" id="3181777">.</span><span class="ident" id="3181778">encode</span><span class="op" id="3181784">[</span><span class="ident" id="3181785">b2</span><span class="op" id="3181787">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181791">dst</span><span class="op" id="3181794">[</span><span class="num" id="3181795">3</span><span class="op" id="3181796">]</span>&nbsp;<span class="op" id="3181798">=</span>&nbsp;<span class="ident" id="3181800">enc</span><span class="op" id="3181803">.</span><span class="ident" id="3181804">encode</span><span class="op" id="3181810">[</span><span class="ident" id="3181811">b3</span><span class="op" id="3181813">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3181818">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181845">if</span>&nbsp;<span class="builtinfunc" id="3181848">len</span><span class="op" id="3181851">(</span><span class="ident" id="3181852">src</span><span class="op" id="3181855">)</span>&nbsp;<span class="op" id="3181857">&lt;</span>&nbsp;<span class="num" id="3181859">3</span>&nbsp;<span class="op" id="3181861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181866">dst</span><span class="op" id="3181869">[</span><span class="num" id="3181870">3</span><span class="op" id="3181871">]</span>&nbsp;<span class="op" id="3181873">=</span>&nbsp;<span class="string" id="3181875">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181882">if</span>&nbsp;<span class="builtinfunc" id="3181885">len</span><span class="op" id="3181888">(</span><span class="ident" id="3181889">src</span><span class="op" id="3181892">)</span>&nbsp;<span class="op" id="3181894">&lt;</span>&nbsp;<span class="num" id="3181896">2</span>&nbsp;<span class="op" id="3181898">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181904">dst</span><span class="op" id="3181907">[</span><span class="num" id="3181908">2</span><span class="op" id="3181909">]</span>&nbsp;<span class="op" id="3181911">=</span>&nbsp;<span class="string" id="3181913">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3181920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3181925">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3181933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181938">src</span>&nbsp;<span class="op" id="3181942">=</span>&nbsp;<span class="ident" id="3181944">src</span><span class="op" id="3181947">[</span><span class="num" id="3181948">3</span><span class="op" id="3181949">:</span><span class="op" id="3181950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181954">dst</span>&nbsp;<span class="op" id="3181958">=</span>&nbsp;<span class="ident" id="3181960">dst</span><span class="op" id="3181963">[</span><span class="num" id="3181964">4</span><span class="op" id="3181965">:</span><span class="op" id="3181966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3181969">}</span><br>
<span class="lineno"></span><span class="op" id="3181971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3181974">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3182028">func</span>&nbsp;<span class="op" id="3182033">(</span><span class="ident" id="3182034">enc</span>&nbsp;<span class="op" id="3182038">*</span><span class="ident" id="3182039">Encoding</span><span class="op" id="3182047">)</span>&nbsp;<span class="ident" id="3182049">EncodeToString</span><span class="op" id="3182063">(</span><span class="ident" id="3182064">src</span>&nbsp;<span class="op" id="3182068">[</span><span class="op" id="3182069">]</span><span class="builtintype" id="3182070">byte</span><span class="op" id="3182074">)</span>&nbsp;<span class="builtintype" id="3182076">string</span>&nbsp;<span class="op" id="3182083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182086">buf</span>&nbsp;<span class="op" id="3182090">:=</span>&nbsp;<span class="builtinfunc" id="3182093">make</span><span class="op" id="3182097">(</span><span class="op" id="3182098">[</span><span class="op" id="3182099">]</span><span class="builtintype" id="3182100">byte</span><span class="op" id="3182104">,</span>&nbsp;<span class="ident" id="3182106">enc</span><span class="op" id="3182109">.</span><span class="ident" id="3182110">EncodedLen</span><span class="op" id="3182120">(</span><span class="builtinfunc" id="3182121">len</span><span class="op" id="3182124">(</span><span class="ident" id="3182125">src</span><span class="op" id="3182128">)</span><span class="op" id="3182129">)</span><span class="op" id="3182130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182133">enc</span><span class="op" id="3182136">.</span><span class="ident" id="3182137">Encode</span><span class="op" id="3182143">(</span><span class="ident" id="3182144">buf</span><span class="op" id="3182147">,</span>&nbsp;<span class="ident" id="3182149">src</span><span class="op" id="3182152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182155">return</span>&nbsp;<span class="builtintype" id="3182162">string</span><span class="op" id="3182168">(</span><span class="ident" id="3182169">buf</span><span class="op" id="3182172">)</span><br>
<span class="lineno">120</span><span class="op" id="3182174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3182177">type</span>&nbsp;<span class="ident" id="3182182">encoder</span>&nbsp;<span class="keyword" id="3182190">struct</span>&nbsp;<span class="op" id="3182197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182200">err</span>&nbsp;&nbsp;<span class="builtintype" id="3182205">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182212">enc</span>&nbsp;&nbsp;<span class="op" id="3182217">*</span><span class="ident" id="3182218">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182228">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182233">io</span><span class="op" id="3182235">.</span><span class="ident" id="3182236">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182244">buf</span>&nbsp;&nbsp;<span class="op" id="3182249">[</span><span class="num" id="3182250">3</span><span class="op" id="3182251">]</span><span class="builtintype" id="3182252">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3182260">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182300">nbuf</span>&nbsp;<span class="builtintype" id="3182305">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3182316">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182343">out</span>&nbsp;&nbsp;<span class="op" id="3182348">[</span><span class="num" id="3182349">1024</span><span class="op" id="3182353">]</span><span class="builtintype" id="3182354">byte</span>&nbsp;<span class="comment" id="3182359">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3182376">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3182379">func</span>&nbsp;<span class="op" id="3182384">(</span><span class="ident" id="3182385">e</span>&nbsp;<span class="op" id="3182387">*</span><span class="ident" id="3182388">encoder</span><span class="op" id="3182395">)</span>&nbsp;<span class="ident" id="3182397">Write</span><span class="op" id="3182402">(</span><span class="ident" id="3182403">p</span>&nbsp;<span class="op" id="3182405">[</span><span class="op" id="3182406">]</span><span class="builtintype" id="3182407">byte</span><span class="op" id="3182411">)</span>&nbsp;<span class="op" id="3182413">(</span><span class="ident" id="3182414">n</span>&nbsp;<span class="builtintype" id="3182416">int</span><span class="op" id="3182419">,</span>&nbsp;<span class="ident" id="3182421">err</span>&nbsp;<span class="builtintype" id="3182425">error</span><span class="op" id="3182430">)</span>&nbsp;<span class="op" id="3182432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182435">if</span>&nbsp;<span class="ident" id="3182438">e</span><span class="op" id="3182439">.</span><span class="ident" id="3182440">err</span>&nbsp;<span class="op" id="3182444">!=</span>&nbsp;<span class="ident" id="3182447">nil</span>&nbsp;<span class="op" id="3182451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182455">return</span>&nbsp;<span class="num" id="3182462">0</span><span class="op" id="3182463">,</span>&nbsp;<span class="ident" id="3182465">e</span><span class="op" id="3182466">.</span><span class="ident" id="3182467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182472">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3182476">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182496">if</span>&nbsp;<span class="ident" id="3182499">e</span><span class="op" id="3182500">.</span><span class="ident" id="3182501">nbuf</span>&nbsp;<span class="op" id="3182506">&gt;</span>&nbsp;<span class="num" id="3182508">0</span>&nbsp;<span class="op" id="3182510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182514">var</span>&nbsp;<span class="ident" id="3182518">i</span>&nbsp;<span class="builtintype" id="3182520">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182526">for</span>&nbsp;<span class="ident" id="3182530">i</span>&nbsp;<span class="op" id="3182532">=</span>&nbsp;<span class="num" id="3182534">0</span><span class="op" id="3182535">;</span>&nbsp;<span class="ident" id="3182537">i</span>&nbsp;<span class="op" id="3182539">&lt;</span>&nbsp;<span class="builtinfunc" id="3182541">len</span><span class="op" id="3182544">(</span><span class="ident" id="3182545">p</span><span class="op" id="3182546">)</span>&nbsp;<span class="op" id="3182548">&amp;&amp;</span>&nbsp;<span class="ident" id="3182551">e</span><span class="op" id="3182552">.</span><span class="ident" id="3182553">nbuf</span>&nbsp;<span class="op" id="3182558">&lt;</span>&nbsp;<span class="num" id="3182560">3</span><span class="op" id="3182561">;</span>&nbsp;<span class="ident" id="3182563">i</span><span class="op" id="3182564">++</span>&nbsp;<span class="op" id="3182567">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182572">e</span><span class="op" id="3182573">.</span><span class="ident" id="3182574">buf</span><span class="op" id="3182577">[</span><span class="ident" id="3182578">e</span><span class="op" id="3182579">.</span><span class="ident" id="3182580">nbuf</span><span class="op" id="3182584">]</span>&nbsp;<span class="op" id="3182586">=</span>&nbsp;<span class="ident" id="3182588">p</span><span class="op" id="3182589">[</span><span class="ident" id="3182590">i</span><span class="op" id="3182591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182596">e</span><span class="op" id="3182597">.</span><span class="ident" id="3182598">nbuf</span><span class="op" id="3182602">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182611">n</span>&nbsp;<span class="op" id="3182613">+=</span>&nbsp;<span class="ident" id="3182616">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182620">p</span>&nbsp;<span class="op" id="3182622">=</span>&nbsp;<span class="ident" id="3182624">p</span><span class="op" id="3182625">[</span><span class="ident" id="3182626">i</span><span class="op" id="3182627">:</span><span class="op" id="3182628">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182632">if</span>&nbsp;<span class="ident" id="3182635">e</span><span class="op" id="3182636">.</span><span class="ident" id="3182637">nbuf</span>&nbsp;<span class="op" id="3182642">&lt;</span>&nbsp;<span class="num" id="3182644">3</span>&nbsp;<span class="op" id="3182646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182651">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182664">e</span><span class="op" id="3182665">.</span><span class="ident" id="3182666">enc</span><span class="op" id="3182669">.</span><span class="ident" id="3182670">Encode</span><span class="op" id="3182676">(</span><span class="ident" id="3182677">e</span><span class="op" id="3182678">.</span><span class="ident" id="3182679">out</span><span class="op" id="3182682">[</span><span class="num" id="3182683">0</span><span class="op" id="3182684">:</span><span class="op" id="3182685">]</span><span class="op" id="3182686">,</span>&nbsp;<span class="ident" id="3182688">e</span><span class="op" id="3182689">.</span><span class="ident" id="3182690">buf</span><span class="op" id="3182693">[</span><span class="num" id="3182694">0</span><span class="op" id="3182695">:</span><span class="op" id="3182696">]</span><span class="op" id="3182697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182701">if</span>&nbsp;<span class="ident" id="3182704">_</span><span class="op" id="3182705">,</span>&nbsp;<span class="ident" id="3182707">e</span><span class="op" id="3182708">.</span><span class="ident" id="3182709">err</span>&nbsp;<span class="op" id="3182713">=</span>&nbsp;<span class="ident" id="3182715">e</span><span class="op" id="3182716">.</span><span class="ident" id="3182717">w</span><span class="op" id="3182718">.</span><span class="ident" id="3182719">Write</span><span class="op" id="3182724">(</span><span class="ident" id="3182725">e</span><span class="op" id="3182726">.</span><span class="ident" id="3182727">out</span><span class="op" id="3182730">[</span><span class="num" id="3182731">0</span><span class="op" id="3182732">:</span><span class="num" id="3182733">4</span><span class="op" id="3182734">]</span><span class="op" id="3182735">)</span><span class="op" id="3182736">;</span>&nbsp;<span class="ident" id="3182738">e</span><span class="op" id="3182739">.</span><span class="ident" id="3182740">err</span>&nbsp;<span class="op" id="3182744">!=</span>&nbsp;<span class="ident" id="3182747">nil</span>&nbsp;<span class="op" id="3182751">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182756">return</span>&nbsp;<span class="ident" id="3182763">n</span><span class="op" id="3182764">,</span>&nbsp;<span class="ident" id="3182766">e</span><span class="op" id="3182767">.</span><span class="ident" id="3182768">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182778">e</span><span class="op" id="3182779">.</span><span class="ident" id="3182780">nbuf</span>&nbsp;<span class="op" id="3182785">=</span>&nbsp;<span class="num" id="3182787">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3182794">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182821">for</span>&nbsp;<span class="builtinfunc" id="3182825">len</span><span class="op" id="3182828">(</span><span class="ident" id="3182829">p</span><span class="op" id="3182830">)</span>&nbsp;<span class="op" id="3182832">&gt;=</span>&nbsp;<span class="num" id="3182835">3</span>&nbsp;<span class="op" id="3182837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182841">nn</span>&nbsp;<span class="op" id="3182844">:=</span>&nbsp;<span class="builtinfunc" id="3182847">len</span><span class="op" id="3182850">(</span><span class="ident" id="3182851">e</span><span class="op" id="3182852">.</span><span class="ident" id="3182853">out</span><span class="op" id="3182856">)</span>&nbsp;<span class="op" id="3182858">/</span>&nbsp;<span class="num" id="3182860">4</span>&nbsp;<span class="op" id="3182862">*</span>&nbsp;<span class="num" id="3182864">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182868">if</span>&nbsp;<span class="ident" id="3182871">nn</span>&nbsp;<span class="op" id="3182874">&gt;</span>&nbsp;<span class="builtinfunc" id="3182876">len</span><span class="op" id="3182879">(</span><span class="ident" id="3182880">p</span><span class="op" id="3182881">)</span>&nbsp;<span class="op" id="3182883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182888">nn</span>&nbsp;<span class="op" id="3182891">=</span>&nbsp;<span class="builtinfunc" id="3182893">len</span><span class="op" id="3182896">(</span><span class="ident" id="3182897">p</span><span class="op" id="3182898">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182903">nn</span>&nbsp;<span class="op" id="3182906">-=</span>&nbsp;<span class="ident" id="3182909">nn</span>&nbsp;<span class="op" id="3182912">%</span>&nbsp;<span class="num" id="3182914">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3182918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3182922">e</span><span class="op" id="3182923">.</span><span class="ident" id="3182924">enc</span><span class="op" id="3182927">.</span><span class="ident" id="3182928">Encode</span><span class="op" id="3182934">(</span><span class="ident" id="3182935">e</span><span class="op" id="3182936">.</span><span class="ident" id="3182937">out</span><span class="op" id="3182940">[</span><span class="num" id="3182941">0</span><span class="op" id="3182942">:</span><span class="op" id="3182943">]</span><span class="op" id="3182944">,</span>&nbsp;<span class="ident" id="3182946">p</span><span class="op" id="3182947">[</span><span class="num" id="3182948">0</span><span class="op" id="3182949">:</span><span class="ident" id="3182950">nn</span><span class="op" id="3182952">]</span><span class="op" id="3182953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3182957">if</span>&nbsp;<span class="ident" id="3182960">_</span><span class="op" id="3182961">,</span>&nbsp;<span class="ident" id="3182963">e</span><span class="op" id="3182964">.</span><span class="ident" id="3182965">err</span>&nbsp;<span class="op" id="3182969">=</span>&nbsp;<span class="ident" id="3182971">e</span><span class="op" id="3182972">.</span><span class="ident" id="3182973">w</span><span class="op" id="3182974">.</span><span class="ident" id="3182975">Write</span><span class="op" id="3182980">(</span><span class="ident" id="3182981">e</span><span class="op" id="3182982">.</span><span class="ident" id="3182983">out</span><span class="op" id="3182986">[</span><span class="num" id="3182987">0</span>&nbsp;<span class="op" id="3182989">:</span>&nbsp;<span class="ident" id="3182991">nn</span><span class="op" id="3182993">/</span><span class="num" id="3182994">3</span><span class="op" id="3182995">*</span><span class="num" id="3182996">4</span><span class="op" id="3182997">]</span><span class="op" id="3182998">)</span><span class="op" id="3182999">;</span>&nbsp;<span class="ident" id="3183001">e</span><span class="op" id="3183002">.</span><span class="ident" id="3183003">err</span>&nbsp;<span class="op" id="3183007">!=</span>&nbsp;<span class="ident" id="3183010">nil</span>&nbsp;<span class="op" id="3183014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183019">return</span>&nbsp;<span class="ident" id="3183026">n</span><span class="op" id="3183027">,</span>&nbsp;<span class="ident" id="3183029">e</span><span class="op" id="3183030">.</span><span class="ident" id="3183031">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3183037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183041">n</span>&nbsp;<span class="op" id="3183043">+=</span>&nbsp;<span class="ident" id="3183046">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183051">p</span>&nbsp;<span class="op" id="3183053">=</span>&nbsp;<span class="ident" id="3183055">p</span><span class="op" id="3183056">[</span><span class="ident" id="3183057">nn</span><span class="op" id="3183059">:</span><span class="op" id="3183060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3183063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3183067">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183088">for</span>&nbsp;<span class="ident" id="3183092">i</span>&nbsp;<span class="op" id="3183094">:=</span>&nbsp;<span class="num" id="3183097">0</span><span class="op" id="3183098">;</span>&nbsp;<span class="ident" id="3183100">i</span>&nbsp;<span class="op" id="3183102">&lt;</span>&nbsp;<span class="builtinfunc" id="3183104">len</span><span class="op" id="3183107">(</span><span class="ident" id="3183108">p</span><span class="op" id="3183109">)</span><span class="op" id="3183110">;</span>&nbsp;<span class="ident" id="3183112">i</span><span class="op" id="3183113">++</span>&nbsp;<span class="op" id="3183116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183120">e</span><span class="op" id="3183121">.</span><span class="ident" id="3183122">buf</span><span class="op" id="3183125">[</span><span class="ident" id="3183126">i</span><span class="op" id="3183127">]</span>&nbsp;<span class="op" id="3183129">=</span>&nbsp;<span class="ident" id="3183131">p</span><span class="op" id="3183132">[</span><span class="ident" id="3183133">i</span><span class="op" id="3183134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3183137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183140">e</span><span class="op" id="3183141">.</span><span class="ident" id="3183142">nbuf</span>&nbsp;<span class="op" id="3183147">=</span>&nbsp;<span class="builtinfunc" id="3183149">len</span><span class="op" id="3183152">(</span><span class="ident" id="3183153">p</span><span class="op" id="3183154">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183157">n</span>&nbsp;<span class="op" id="3183159">+=</span>&nbsp;<span class="builtinfunc" id="3183162">len</span><span class="op" id="3183165">(</span><span class="ident" id="3183166">p</span><span class="op" id="3183167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183170">return</span><br>
<span class="lineno"></span><span class="op" id="3183177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3183180">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3183234">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3183287">func</span>&nbsp;<span class="op" id="3183292">(</span><span class="ident" id="3183293">e</span>&nbsp;<span class="op" id="3183295">*</span><span class="ident" id="3183296">encoder</span><span class="op" id="3183303">)</span>&nbsp;<span class="ident" id="3183305">Close</span><span class="op" id="3183310">(</span><span class="op" id="3183311">)</span>&nbsp;<span class="builtintype" id="3183313">error</span>&nbsp;<span class="op" id="3183319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3183322">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183379">if</span>&nbsp;<span class="ident" id="3183382">e</span><span class="op" id="3183383">.</span><span class="ident" id="3183384">err</span>&nbsp;<span class="op" id="3183388">==</span>&nbsp;<span class="ident" id="3183391">nil</span>&nbsp;<span class="op" id="3183395">&amp;&amp;</span>&nbsp;<span class="ident" id="3183398">e</span><span class="op" id="3183399">.</span><span class="ident" id="3183400">nbuf</span>&nbsp;<span class="op" id="3183405">&gt;</span>&nbsp;<span class="num" id="3183407">0</span>&nbsp;<span class="op" id="3183409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183413">e</span><span class="op" id="3183414">.</span><span class="ident" id="3183415">enc</span><span class="op" id="3183418">.</span><span class="ident" id="3183419">Encode</span><span class="op" id="3183425">(</span><span class="ident" id="3183426">e</span><span class="op" id="3183427">.</span><span class="ident" id="3183428">out</span><span class="op" id="3183431">[</span><span class="num" id="3183432">0</span><span class="op" id="3183433">:</span><span class="op" id="3183434">]</span><span class="op" id="3183435">,</span>&nbsp;<span class="ident" id="3183437">e</span><span class="op" id="3183438">.</span><span class="ident" id="3183439">buf</span><span class="op" id="3183442">[</span><span class="num" id="3183443">0</span><span class="op" id="3183444">:</span><span class="ident" id="3183445">e</span><span class="op" id="3183446">.</span><span class="ident" id="3183447">nbuf</span><span class="op" id="3183451">]</span><span class="op" id="3183452">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183456">e</span><span class="op" id="3183457">.</span><span class="ident" id="3183458">nbuf</span>&nbsp;<span class="op" id="3183463">=</span>&nbsp;<span class="num" id="3183465">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3183469">_</span><span class="op" id="3183470">,</span>&nbsp;<span class="ident" id="3183472">e</span><span class="op" id="3183473">.</span><span class="ident" id="3183474">err</span>&nbsp;<span class="op" id="3183478">=</span>&nbsp;<span class="ident" id="3183480">e</span><span class="op" id="3183481">.</span><span class="ident" id="3183482">w</span><span class="op" id="3183483">.</span><span class="ident" id="3183484">Write</span><span class="op" id="3183489">(</span><span class="ident" id="3183490">e</span><span class="op" id="3183491">.</span><span class="ident" id="3183492">out</span><span class="op" id="3183495">[</span><span class="num" id="3183496">0</span><span class="op" id="3183497">:</span><span class="num" id="3183498">4</span><span class="op" id="3183499">]</span><span class="op" id="3183500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3183503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183506">return</span>&nbsp;<span class="ident" id="3183513">e</span><span class="op" id="3183514">.</span><span class="ident" id="3183515">err</span><br>
<span class="lineno"></span><span class="op" id="3183519">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3183522">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3183590">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3183662">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3183722">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3183790">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3183819">func</span>&nbsp;<span class="ident" id="3183824">NewEncoder</span><span class="op" id="3183834">(</span><span class="ident" id="3183835">enc</span>&nbsp;<span class="op" id="3183839">*</span><span class="ident" id="3183840">Encoding</span><span class="op" id="3183848">,</span>&nbsp;<span class="ident" id="3183850">w</span>&nbsp;<span class="ident" id="3183852">io</span><span class="op" id="3183854">.</span><span class="ident" id="3183855">Writer</span><span class="op" id="3183861">)</span>&nbsp;<span class="ident" id="3183863">io</span><span class="op" id="3183865">.</span><span class="ident" id="3183866">WriteCloser</span>&nbsp;<span class="op" id="3183878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3183881">return</span>&nbsp;<span class="op" id="3183888">&amp;</span><span class="ident" id="3183889">encoder</span><span class="op" id="3183896">{</span><span class="ident" id="3183897">enc</span><span class="op" id="3183900">:</span>&nbsp;<span class="ident" id="3183902">enc</span><span class="op" id="3183905">,</span>&nbsp;<span class="ident" id="3183907">w</span><span class="op" id="3183908">:</span>&nbsp;<span class="ident" id="3183910">w</span><span class="op" id="3183911">}</span><br>
<span class="lineno"></span><span class="op" id="3183913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3183916">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3183981">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3184016">func</span>&nbsp;<span class="op" id="3184021">(</span><span class="ident" id="3184022">enc</span>&nbsp;<span class="op" id="3184026">*</span><span class="ident" id="3184027">Encoding</span><span class="op" id="3184035">)</span>&nbsp;<span class="ident" id="3184037">EncodedLen</span><span class="op" id="3184047">(</span><span class="ident" id="3184048">n</span>&nbsp;<span class="builtintype" id="3184050">int</span><span class="op" id="3184053">)</span>&nbsp;<span class="builtintype" id="3184055">int</span>&nbsp;<span class="op" id="3184059">{</span>&nbsp;<span class="keyword" id="3184061">return</span>&nbsp;<span class="op" id="3184068">(</span><span class="ident" id="3184069">n</span>&nbsp;<span class="op" id="3184071">+</span>&nbsp;<span class="num" id="3184073">2</span><span class="op" id="3184074">)</span>&nbsp;<span class="op" id="3184076">/</span>&nbsp;<span class="num" id="3184078">3</span>&nbsp;<span class="op" id="3184080">*</span>&nbsp;<span class="num" id="3184082">4</span>&nbsp;<span class="op" id="3184084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3184087">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3184106">type</span>&nbsp;<span class="ident" id="3184111">CorruptInputError</span>&nbsp;<span class="ident" id="3184129">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3184136">func</span>&nbsp;<span class="op" id="3184141">(</span><span class="ident" id="3184142">e</span>&nbsp;<span class="ident" id="3184144">CorruptInputError</span><span class="op" id="3184161">)</span>&nbsp;<span class="ident" id="3184163">Error</span><span class="op" id="3184168">(</span><span class="op" id="3184169">)</span>&nbsp;<span class="builtintype" id="3184171">string</span>&nbsp;<span class="op" id="3184178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184181">return</span>&nbsp;<span class="string" id="3184188">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3184225">+</span>&nbsp;<span class="ident" id="3184227">strconv</span><span class="op" id="3184234">.</span><span class="ident" id="3184235">FormatInt</span><span class="op" id="3184244">(</span><span class="ident" id="3184245">int64</span><span class="op" id="3184250">(</span><span class="ident" id="3184251">e</span><span class="op" id="3184252">)</span><span class="op" id="3184253">,</span>&nbsp;<span class="num" id="3184255">10</span><span class="op" id="3184257">)</span><br>
<span class="lineno"></span><span class="op" id="3184259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3184262">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3184332">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3184400">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3184470">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3184527">func</span>&nbsp;<span class="op" id="3184532">(</span><span class="ident" id="3184533">enc</span>&nbsp;<span class="op" id="3184537">*</span><span class="ident" id="3184538">Encoding</span><span class="op" id="3184546">)</span>&nbsp;<span class="ident" id="3184548">decode</span><span class="op" id="3184554">(</span><span class="ident" id="3184555">dst</span><span class="op" id="3184558">,</span>&nbsp;<span class="ident" id="3184560">src</span>&nbsp;<span class="op" id="3184564">[</span><span class="op" id="3184565">]</span><span class="builtintype" id="3184566">byte</span><span class="op" id="3184570">)</span>&nbsp;<span class="op" id="3184572">(</span><span class="ident" id="3184573">n</span>&nbsp;<span class="builtintype" id="3184575">int</span><span class="op" id="3184578">,</span>&nbsp;<span class="ident" id="3184580">end</span>&nbsp;<span class="builtintype" id="3184584">bool</span><span class="op" id="3184588">,</span>&nbsp;<span class="ident" id="3184590">err</span>&nbsp;<span class="builtintype" id="3184594">error</span><span class="op" id="3184599">)</span>&nbsp;<span class="op" id="3184601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3184604">olen</span>&nbsp;<span class="op" id="3184609">:=</span>&nbsp;<span class="builtinfunc" id="3184612">len</span><span class="op" id="3184615">(</span><span class="ident" id="3184616">src</span><span class="op" id="3184619">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184622">for</span>&nbsp;<span class="builtinfunc" id="3184626">len</span><span class="op" id="3184629">(</span><span class="ident" id="3184630">src</span><span class="op" id="3184633">)</span>&nbsp;<span class="op" id="3184635">&gt;</span>&nbsp;<span class="num" id="3184637">0</span>&nbsp;<span class="op" id="3184639">&amp;&amp;</span>&nbsp;<span class="op" id="3184642">!</span><span class="ident" id="3184643">end</span>&nbsp;<span class="op" id="3184647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3184651">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184697">var</span>&nbsp;<span class="ident" id="3184701">dbuf</span>&nbsp;<span class="op" id="3184706">[</span><span class="num" id="3184707">4</span><span class="op" id="3184708">]</span><span class="builtintype" id="3184709">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3184716">dlen</span>&nbsp;<span class="op" id="3184721">:=</span>&nbsp;<span class="num" id="3184724">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184729">for</span>&nbsp;<span class="ident" id="3184733">j</span>&nbsp;<span class="op" id="3184735">:=</span>&nbsp;<span class="keyword" id="3184738">range</span>&nbsp;<span class="ident" id="3184744">dbuf</span>&nbsp;<span class="op" id="3184749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184754">if</span>&nbsp;<span class="builtinfunc" id="3184757">len</span><span class="op" id="3184760">(</span><span class="ident" id="3184761">src</span><span class="op" id="3184764">)</span>&nbsp;<span class="op" id="3184766">==</span>&nbsp;<span class="num" id="3184769">0</span>&nbsp;<span class="op" id="3184771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184777">return</span>&nbsp;<span class="ident" id="3184784">n</span><span class="op" id="3184785">,</span>&nbsp;<span class="builtintype" id="3184787">false</span><span class="op" id="3184792">,</span>&nbsp;<span class="ident" id="3184794">CorruptInputError</span><span class="op" id="3184811">(</span><span class="ident" id="3184812">olen</span>&nbsp;<span class="op" id="3184817">-</span>&nbsp;<span class="builtinfunc" id="3184819">len</span><span class="op" id="3184822">(</span><span class="ident" id="3184823">src</span><span class="op" id="3184826">)</span>&nbsp;<span class="op" id="3184828">-</span>&nbsp;<span class="ident" id="3184830">j</span><span class="op" id="3184831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3184836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3184841">in</span>&nbsp;<span class="op" id="3184844">:=</span>&nbsp;<span class="ident" id="3184847">src</span><span class="op" id="3184850">[</span><span class="num" id="3184851">0</span><span class="op" id="3184852">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3184857">src</span>&nbsp;<span class="op" id="3184861">=</span>&nbsp;<span class="ident" id="3184863">src</span><span class="op" id="3184866">[</span><span class="num" id="3184867">1</span><span class="op" id="3184868">:</span><span class="op" id="3184869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184874">if</span>&nbsp;<span class="ident" id="3184877">in</span>&nbsp;<span class="op" id="3184880">==</span>&nbsp;<span class="string" id="3184883">&#39;=&#39;</span>&nbsp;<span class="op" id="3184887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3184893">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184942">switch</span>&nbsp;<span class="ident" id="3184949">j</span>&nbsp;<span class="op" id="3184951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184957">case</span>&nbsp;<span class="num" id="3184962">0</span><span class="op" id="3184963">,</span>&nbsp;<span class="num" id="3184965">1</span><span class="op" id="3184966">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3184973">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3184999">return</span>&nbsp;<span class="ident" id="3185006">n</span><span class="op" id="3185007">,</span>&nbsp;<span class="builtintype" id="3185009">false</span><span class="op" id="3185014">,</span>&nbsp;<span class="ident" id="3185016">CorruptInputError</span><span class="op" id="3185033">(</span><span class="ident" id="3185034">olen</span>&nbsp;<span class="op" id="3185039">-</span>&nbsp;<span class="builtinfunc" id="3185041">len</span><span class="op" id="3185044">(</span><span class="ident" id="3185045">src</span><span class="op" id="3185048">)</span>&nbsp;<span class="op" id="3185050">-</span>&nbsp;<span class="num" id="3185052">1</span><span class="op" id="3185053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185059">case</span>&nbsp;<span class="num" id="3185064">2</span><span class="op" id="3185065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185072">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185133">if</span>&nbsp;<span class="builtinfunc" id="3185136">len</span><span class="op" id="3185139">(</span><span class="ident" id="3185140">src</span><span class="op" id="3185143">)</span>&nbsp;<span class="op" id="3185145">==</span>&nbsp;<span class="num" id="3185148">0</span>&nbsp;<span class="op" id="3185150">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185158">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185186">return</span>&nbsp;<span class="ident" id="3185193">n</span><span class="op" id="3185194">,</span>&nbsp;<span class="builtintype" id="3185196">false</span><span class="op" id="3185201">,</span>&nbsp;<span class="ident" id="3185203">CorruptInputError</span><span class="op" id="3185220">(</span><span class="ident" id="3185221">olen</span><span class="op" id="3185225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185239">if</span>&nbsp;<span class="ident" id="3185242">src</span><span class="op" id="3185245">[</span><span class="num" id="3185246">0</span><span class="op" id="3185247">]</span>&nbsp;<span class="op" id="3185249">!=</span>&nbsp;<span class="string" id="3185252">&#39;=&#39;</span>&nbsp;<span class="op" id="3185256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185264">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185291">return</span>&nbsp;<span class="ident" id="3185298">n</span><span class="op" id="3185299">,</span>&nbsp;<span class="builtintype" id="3185301">false</span><span class="op" id="3185306">,</span>&nbsp;<span class="ident" id="3185308">CorruptInputError</span><span class="op" id="3185325">(</span><span class="ident" id="3185326">olen</span>&nbsp;<span class="op" id="3185331">-</span>&nbsp;<span class="builtinfunc" id="3185333">len</span><span class="op" id="3185336">(</span><span class="ident" id="3185337">src</span><span class="op" id="3185340">)</span>&nbsp;<span class="op" id="3185342">-</span>&nbsp;<span class="num" id="3185344">1</span><span class="op" id="3185345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185359">src</span>&nbsp;<span class="op" id="3185363">=</span>&nbsp;<span class="ident" id="3185365">src</span><span class="op" id="3185368">[</span><span class="num" id="3185369">1</span><span class="op" id="3185370">:</span><span class="op" id="3185371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185383">if</span>&nbsp;<span class="builtinfunc" id="3185386">len</span><span class="op" id="3185389">(</span><span class="ident" id="3185390">src</span><span class="op" id="3185393">)</span>&nbsp;<span class="op" id="3185395">&gt;</span>&nbsp;<span class="num" id="3185397">0</span>&nbsp;<span class="op" id="3185399">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185406">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185431">err</span>&nbsp;<span class="op" id="3185435">=</span>&nbsp;<span class="ident" id="3185437">CorruptInputError</span><span class="op" id="3185454">(</span><span class="ident" id="3185455">olen</span>&nbsp;<span class="op" id="3185460">-</span>&nbsp;<span class="builtinfunc" id="3185462">len</span><span class="op" id="3185465">(</span><span class="ident" id="3185466">src</span><span class="op" id="3185469">)</span><span class="op" id="3185470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185482">dlen</span><span class="op" id="3185486">,</span>&nbsp;<span class="ident" id="3185488">end</span>&nbsp;<span class="op" id="3185492">=</span>&nbsp;<span class="ident" id="3185494">j</span><span class="op" id="3185495">,</span>&nbsp;<span class="builtintype" id="3185497">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185506">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185520">dbuf</span><span class="op" id="3185524">[</span><span class="ident" id="3185525">j</span><span class="op" id="3185526">]</span>&nbsp;<span class="op" id="3185528">=</span>&nbsp;<span class="ident" id="3185530">enc</span><span class="op" id="3185533">.</span><span class="ident" id="3185534">decodeMap</span><span class="op" id="3185543">[</span><span class="ident" id="3185544">in</span><span class="op" id="3185546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185551">if</span>&nbsp;<span class="ident" id="3185554">dbuf</span><span class="op" id="3185558">[</span><span class="ident" id="3185559">j</span><span class="op" id="3185560">]</span>&nbsp;<span class="op" id="3185562">==</span>&nbsp;<span class="num" id="3185565">0xFF</span>&nbsp;<span class="op" id="3185570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185576">return</span>&nbsp;<span class="ident" id="3185583">n</span><span class="op" id="3185584">,</span>&nbsp;<span class="builtintype" id="3185586">false</span><span class="op" id="3185591">,</span>&nbsp;<span class="ident" id="3185593">CorruptInputError</span><span class="op" id="3185610">(</span><span class="ident" id="3185611">olen</span>&nbsp;<span class="op" id="3185616">-</span>&nbsp;<span class="builtinfunc" id="3185618">len</span><span class="op" id="3185621">(</span><span class="ident" id="3185622">src</span><span class="op" id="3185625">)</span>&nbsp;<span class="op" id="3185627">-</span>&nbsp;<span class="num" id="3185629">1</span><span class="op" id="3185630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185635">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185644">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3185701">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185714">switch</span>&nbsp;<span class="ident" id="3185721">dlen</span>&nbsp;<span class="op" id="3185726">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185730">case</span>&nbsp;<span class="num" id="3185735">4</span><span class="op" id="3185736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185741">dst</span><span class="op" id="3185744">[</span><span class="num" id="3185745">2</span><span class="op" id="3185746">]</span>&nbsp;<span class="op" id="3185748">=</span>&nbsp;<span class="ident" id="3185750">dbuf</span><span class="op" id="3185754">[</span><span class="num" id="3185755">2</span><span class="op" id="3185756">]</span><span class="op" id="3185757">&lt;&lt;</span><span class="num" id="3185759">6</span>&nbsp;<span class="op" id="3185761">|</span>&nbsp;<span class="ident" id="3185763">dbuf</span><span class="op" id="3185767">[</span><span class="num" id="3185768">3</span><span class="op" id="3185769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185774">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185788">case</span>&nbsp;<span class="num" id="3185793">3</span><span class="op" id="3185794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185799">dst</span><span class="op" id="3185802">[</span><span class="num" id="3185803">1</span><span class="op" id="3185804">]</span>&nbsp;<span class="op" id="3185806">=</span>&nbsp;<span class="ident" id="3185808">dbuf</span><span class="op" id="3185812">[</span><span class="num" id="3185813">1</span><span class="op" id="3185814">]</span><span class="op" id="3185815">&lt;&lt;</span><span class="num" id="3185817">4</span>&nbsp;<span class="op" id="3185819">|</span>&nbsp;<span class="ident" id="3185821">dbuf</span><span class="op" id="3185825">[</span><span class="num" id="3185826">2</span><span class="op" id="3185827">]</span><span class="op" id="3185828">&gt;&gt;</span><span class="num" id="3185830">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185835">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185849">case</span>&nbsp;<span class="num" id="3185854">2</span><span class="op" id="3185855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185860">dst</span><span class="op" id="3185863">[</span><span class="num" id="3185864">0</span><span class="op" id="3185865">]</span>&nbsp;<span class="op" id="3185867">=</span>&nbsp;<span class="ident" id="3185869">dbuf</span><span class="op" id="3185873">[</span><span class="num" id="3185874">0</span><span class="op" id="3185875">]</span><span class="op" id="3185876">&lt;&lt;</span><span class="num" id="3185878">2</span>&nbsp;<span class="op" id="3185880">|</span>&nbsp;<span class="ident" id="3185882">dbuf</span><span class="op" id="3185886">[</span><span class="num" id="3185887">1</span><span class="op" id="3185888">]</span><span class="op" id="3185889">&gt;&gt;</span><span class="num" id="3185891">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185899">dst</span>&nbsp;<span class="op" id="3185903">=</span>&nbsp;<span class="ident" id="3185905">dst</span><span class="op" id="3185908">[</span><span class="num" id="3185909">3</span><span class="op" id="3185910">:</span><span class="op" id="3185911">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3185915">n</span>&nbsp;<span class="op" id="3185917">+=</span>&nbsp;<span class="ident" id="3185920">dlen</span>&nbsp;<span class="op" id="3185925">-</span>&nbsp;<span class="num" id="3185927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3185930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3185934">return</span>&nbsp;<span class="ident" id="3185941">n</span><span class="op" id="3185942">,</span>&nbsp;<span class="ident" id="3185944">end</span><span class="op" id="3185947">,</span>&nbsp;<span class="ident" id="3185949">err</span><br>
<span class="lineno"></span><span class="op" id="3185953">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3185956">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3186021">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3186090">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3186159">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3186222">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3186270">func</span>&nbsp;<span class="op" id="3186275">(</span><span class="ident" id="3186276">enc</span>&nbsp;<span class="op" id="3186280">*</span><span class="ident" id="3186281">Encoding</span><span class="op" id="3186289">)</span>&nbsp;<span class="ident" id="3186291">Decode</span><span class="op" id="3186297">(</span><span class="ident" id="3186298">dst</span><span class="op" id="3186301">,</span>&nbsp;<span class="ident" id="3186303">src</span>&nbsp;<span class="op" id="3186307">[</span><span class="op" id="3186308">]</span><span class="builtintype" id="3186309">byte</span><span class="op" id="3186313">)</span>&nbsp;<span class="op" id="3186315">(</span><span class="ident" id="3186316">n</span>&nbsp;<span class="builtintype" id="3186318">int</span><span class="op" id="3186321">,</span>&nbsp;<span class="ident" id="3186323">err</span>&nbsp;<span class="builtintype" id="3186327">error</span><span class="op" id="3186332">)</span>&nbsp;<span class="op" id="3186334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186337">src</span>&nbsp;<span class="op" id="3186341">=</span>&nbsp;<span class="ident" id="3186343">bytes</span><span class="op" id="3186348">.</span><span class="ident" id="3186349">Map</span><span class="op" id="3186352">(</span><span class="ident" id="3186353">removeNewlinesMapper</span><span class="op" id="3186373">,</span>&nbsp;<span class="ident" id="3186375">src</span><span class="op" id="3186378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186381">n</span><span class="op" id="3186382">,</span>&nbsp;<span class="ident" id="3186384">_</span><span class="op" id="3186385">,</span>&nbsp;<span class="ident" id="3186387">err</span>&nbsp;<span class="op" id="3186391">=</span>&nbsp;<span class="ident" id="3186393">enc</span><span class="op" id="3186396">.</span><span class="ident" id="3186397">decode</span><span class="op" id="3186403">(</span><span class="ident" id="3186404">dst</span><span class="op" id="3186407">,</span>&nbsp;<span class="ident" id="3186409">src</span><span class="op" id="3186412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186415">return</span><br>
<span class="lineno">290</span><span class="op" id="3186422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3186425">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3186495">func</span>&nbsp;<span class="op" id="3186500">(</span><span class="ident" id="3186501">enc</span>&nbsp;<span class="op" id="3186505">*</span><span class="ident" id="3186506">Encoding</span><span class="op" id="3186514">)</span>&nbsp;<span class="ident" id="3186516">DecodeString</span><span class="op" id="3186528">(</span><span class="ident" id="3186529">s</span>&nbsp;<span class="builtintype" id="3186531">string</span><span class="op" id="3186537">)</span>&nbsp;<span class="op" id="3186539">(</span><span class="op" id="3186540">[</span><span class="op" id="3186541">]</span><span class="builtintype" id="3186542">byte</span><span class="op" id="3186546">,</span>&nbsp;<span class="builtintype" id="3186548">error</span><span class="op" id="3186553">)</span>&nbsp;<span class="op" id="3186555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186558">s</span>&nbsp;<span class="op" id="3186560">=</span>&nbsp;<span class="ident" id="3186562">strings</span><span class="op" id="3186569">.</span><span class="ident" id="3186570">Map</span><span class="op" id="3186573">(</span><span class="ident" id="3186574">removeNewlinesMapper</span><span class="op" id="3186594">,</span>&nbsp;<span class="ident" id="3186596">s</span><span class="op" id="3186597">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186600">dbuf</span>&nbsp;<span class="op" id="3186605">:=</span>&nbsp;<span class="builtinfunc" id="3186608">make</span><span class="op" id="3186612">(</span><span class="op" id="3186613">[</span><span class="op" id="3186614">]</span><span class="builtintype" id="3186615">byte</span><span class="op" id="3186619">,</span>&nbsp;<span class="ident" id="3186621">enc</span><span class="op" id="3186624">.</span><span class="ident" id="3186625">DecodedLen</span><span class="op" id="3186635">(</span><span class="builtinfunc" id="3186636">len</span><span class="op" id="3186639">(</span><span class="ident" id="3186640">s</span><span class="op" id="3186641">)</span><span class="op" id="3186642">)</span><span class="op" id="3186643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186646">n</span><span class="op" id="3186647">,</span>&nbsp;<span class="ident" id="3186649">_</span><span class="op" id="3186650">,</span>&nbsp;<span class="ident" id="3186652">err</span>&nbsp;<span class="op" id="3186656">:=</span>&nbsp;<span class="ident" id="3186659">enc</span><span class="op" id="3186662">.</span><span class="ident" id="3186663">decode</span><span class="op" id="3186669">(</span><span class="ident" id="3186670">dbuf</span><span class="op" id="3186674">,</span>&nbsp;<span class="op" id="3186676">[</span><span class="op" id="3186677">]</span><span class="builtintype" id="3186678">byte</span><span class="op" id="3186682">(</span><span class="ident" id="3186683">s</span><span class="op" id="3186684">)</span><span class="op" id="3186685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3186688">return</span>&nbsp;<span class="ident" id="3186695">dbuf</span><span class="op" id="3186699">[</span><span class="op" id="3186700">:</span><span class="ident" id="3186701">n</span><span class="op" id="3186702">]</span><span class="op" id="3186703">,</span>&nbsp;<span class="ident" id="3186705">err</span><br>
<span class="lineno"></span><span class="op" id="3186709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3186712">type</span>&nbsp;<span class="ident" id="3186717">decoder</span>&nbsp;<span class="keyword" id="3186725">struct</span>&nbsp;<span class="op" id="3186732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186735">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3186742">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186749">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3186756">*</span><span class="ident" id="3186757">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186767">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3186774">io</span><span class="op" id="3186776">.</span><span class="ident" id="3186777">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186785">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3186792">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3186803">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186826">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3186833">[</span><span class="num" id="3186834">1024</span><span class="op" id="3186838">]</span><span class="builtintype" id="3186839">byte</span>&nbsp;<span class="comment" id="3186844">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186863">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3186870">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186875">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3186882">[</span><span class="op" id="3186883">]</span><span class="builtintype" id="3186884">byte</span>&nbsp;<span class="comment" id="3186889">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3186917">outbuf</span>&nbsp;<span class="op" id="3186924">[</span><span class="num" id="3186925">1024</span>&nbsp;<span class="op" id="3186930">/</span>&nbsp;<span class="num" id="3186932">4</span>&nbsp;<span class="op" id="3186934">*</span>&nbsp;<span class="num" id="3186936">3</span><span class="op" id="3186937">]</span><span class="builtintype" id="3186938">byte</span><br>
<span class="lineno"></span><span class="op" id="3186943">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3186946">func</span>&nbsp;<span class="op" id="3186951">(</span><span class="ident" id="3186952">d</span>&nbsp;<span class="op" id="3186954">*</span><span class="ident" id="3186955">decoder</span><span class="op" id="3186962">)</span>&nbsp;<span class="ident" id="3186964">Read</span><span class="op" id="3186968">(</span><span class="ident" id="3186969">p</span>&nbsp;<span class="op" id="3186971">[</span><span class="op" id="3186972">]</span><span class="builtintype" id="3186973">byte</span><span class="op" id="3186977">)</span>&nbsp;<span class="op" id="3186979">(</span><span class="ident" id="3186980">n</span>&nbsp;<span class="builtintype" id="3186982">int</span><span class="op" id="3186985">,</span>&nbsp;<span class="ident" id="3186987">err</span>&nbsp;<span class="builtintype" id="3186991">error</span><span class="op" id="3186996">)</span>&nbsp;<span class="op" id="3186998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187001">if</span>&nbsp;<span class="ident" id="3187004">d</span><span class="op" id="3187005">.</span><span class="ident" id="3187006">err</span>&nbsp;<span class="op" id="3187010">!=</span>&nbsp;<span class="ident" id="3187013">nil</span>&nbsp;<span class="op" id="3187017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187021">return</span>&nbsp;<span class="num" id="3187028">0</span><span class="op" id="3187029">,</span>&nbsp;<span class="ident" id="3187031">d</span><span class="op" id="3187032">.</span><span class="ident" id="3187033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187038">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187042">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187090">if</span>&nbsp;<span class="builtinfunc" id="3187093">len</span><span class="op" id="3187096">(</span><span class="ident" id="3187097">d</span><span class="op" id="3187098">.</span><span class="ident" id="3187099">out</span><span class="op" id="3187102">)</span>&nbsp;<span class="op" id="3187104">&gt;</span>&nbsp;<span class="num" id="3187106">0</span>&nbsp;<span class="op" id="3187108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187112">n</span>&nbsp;<span class="op" id="3187114">=</span>&nbsp;<span class="builtinfunc" id="3187116">copy</span><span class="op" id="3187120">(</span><span class="ident" id="3187121">p</span><span class="op" id="3187122">,</span>&nbsp;<span class="ident" id="3187124">d</span><span class="op" id="3187125">.</span><span class="ident" id="3187126">out</span><span class="op" id="3187129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187133">d</span><span class="op" id="3187134">.</span><span class="ident" id="3187135">out</span>&nbsp;<span class="op" id="3187139">=</span>&nbsp;<span class="ident" id="3187141">d</span><span class="op" id="3187142">.</span><span class="ident" id="3187143">out</span><span class="op" id="3187146">[</span><span class="ident" id="3187147">n</span><span class="op" id="3187148">:</span><span class="op" id="3187149">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187153">return</span>&nbsp;<span class="ident" id="3187160">n</span><span class="op" id="3187161">,</span>&nbsp;<span class="ident" id="3187163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187172">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187190">nn</span>&nbsp;<span class="op" id="3187193">:=</span>&nbsp;<span class="builtinfunc" id="3187196">len</span><span class="op" id="3187199">(</span><span class="ident" id="3187200">p</span><span class="op" id="3187201">)</span>&nbsp;<span class="op" id="3187203">/</span>&nbsp;<span class="num" id="3187205">3</span>&nbsp;<span class="op" id="3187207">*</span>&nbsp;<span class="num" id="3187209">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187212">if</span>&nbsp;<span class="ident" id="3187215">nn</span>&nbsp;<span class="op" id="3187218">&lt;</span>&nbsp;<span class="num" id="3187220">4</span>&nbsp;<span class="op" id="3187222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187226">nn</span>&nbsp;<span class="op" id="3187229">=</span>&nbsp;<span class="num" id="3187231">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187237">if</span>&nbsp;<span class="ident" id="3187240">nn</span>&nbsp;<span class="op" id="3187243">&gt;</span>&nbsp;<span class="builtinfunc" id="3187245">len</span><span class="op" id="3187248">(</span><span class="ident" id="3187249">d</span><span class="op" id="3187250">.</span><span class="ident" id="3187251">buf</span><span class="op" id="3187254">)</span>&nbsp;<span class="op" id="3187256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187260">nn</span>&nbsp;<span class="op" id="3187263">=</span>&nbsp;<span class="builtinfunc" id="3187265">len</span><span class="op" id="3187268">(</span><span class="ident" id="3187269">d</span><span class="op" id="3187270">.</span><span class="ident" id="3187271">buf</span><span class="op" id="3187274">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187280">nn</span><span class="op" id="3187282">,</span>&nbsp;<span class="ident" id="3187284">d</span><span class="op" id="3187285">.</span><span class="ident" id="3187286">err</span>&nbsp;<span class="op" id="3187290">=</span>&nbsp;<span class="ident" id="3187292">io</span><span class="op" id="3187294">.</span><span class="ident" id="3187295">ReadAtLeast</span><span class="op" id="3187306">(</span><span class="ident" id="3187307">d</span><span class="op" id="3187308">.</span><span class="ident" id="3187309">r</span><span class="op" id="3187310">,</span>&nbsp;<span class="ident" id="3187312">d</span><span class="op" id="3187313">.</span><span class="ident" id="3187314">buf</span><span class="op" id="3187317">[</span><span class="ident" id="3187318">d</span><span class="op" id="3187319">.</span><span class="ident" id="3187320">nbuf</span><span class="op" id="3187324">:</span><span class="ident" id="3187325">nn</span><span class="op" id="3187327">]</span><span class="op" id="3187328">,</span>&nbsp;<span class="num" id="3187330">4</span><span class="op" id="3187331">-</span><span class="ident" id="3187332">d</span><span class="op" id="3187333">.</span><span class="ident" id="3187334">nbuf</span><span class="op" id="3187338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187341">d</span><span class="op" id="3187342">.</span><span class="ident" id="3187343">nbuf</span>&nbsp;<span class="op" id="3187348">+=</span>&nbsp;<span class="ident" id="3187351">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187355">if</span>&nbsp;<span class="ident" id="3187358">d</span><span class="op" id="3187359">.</span><span class="ident" id="3187360">err</span>&nbsp;<span class="op" id="3187364">!=</span>&nbsp;<span class="ident" id="3187367">nil</span>&nbsp;<span class="op" id="3187371">||</span>&nbsp;<span class="ident" id="3187374">d</span><span class="op" id="3187375">.</span><span class="ident" id="3187376">nbuf</span>&nbsp;<span class="op" id="3187381">&lt;</span>&nbsp;<span class="num" id="3187383">4</span>&nbsp;<span class="op" id="3187385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187389">return</span>&nbsp;<span class="num" id="3187396">0</span><span class="op" id="3187397">,</span>&nbsp;<span class="ident" id="3187399">d</span><span class="op" id="3187400">.</span><span class="ident" id="3187401">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3187410">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187474">nr</span>&nbsp;<span class="op" id="3187477">:=</span>&nbsp;<span class="ident" id="3187480">d</span><span class="op" id="3187481">.</span><span class="ident" id="3187482">nbuf</span>&nbsp;<span class="op" id="3187487">/</span>&nbsp;<span class="num" id="3187489">4</span>&nbsp;<span class="op" id="3187491">*</span>&nbsp;<span class="num" id="3187493">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187496">nw</span>&nbsp;<span class="op" id="3187499">:=</span>&nbsp;<span class="ident" id="3187502">d</span><span class="op" id="3187503">.</span><span class="ident" id="3187504">nbuf</span>&nbsp;<span class="op" id="3187509">/</span>&nbsp;<span class="num" id="3187511">4</span>&nbsp;<span class="op" id="3187513">*</span>&nbsp;<span class="num" id="3187515">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187518">if</span>&nbsp;<span class="ident" id="3187521">nw</span>&nbsp;<span class="op" id="3187524">&gt;</span>&nbsp;<span class="builtinfunc" id="3187526">len</span><span class="op" id="3187529">(</span><span class="ident" id="3187530">p</span><span class="op" id="3187531">)</span>&nbsp;<span class="op" id="3187533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187537">nw</span><span class="op" id="3187539">,</span>&nbsp;<span class="ident" id="3187541">d</span><span class="op" id="3187542">.</span><span class="ident" id="3187543">end</span><span class="op" id="3187546">,</span>&nbsp;<span class="ident" id="3187548">d</span><span class="op" id="3187549">.</span><span class="ident" id="3187550">err</span>&nbsp;<span class="op" id="3187554">=</span>&nbsp;<span class="ident" id="3187556">d</span><span class="op" id="3187557">.</span><span class="ident" id="3187558">enc</span><span class="op" id="3187561">.</span><span class="ident" id="3187562">decode</span><span class="op" id="3187568">(</span><span class="ident" id="3187569">d</span><span class="op" id="3187570">.</span><span class="ident" id="3187571">outbuf</span><span class="op" id="3187577">[</span><span class="num" id="3187578">0</span><span class="op" id="3187579">:</span><span class="op" id="3187580">]</span><span class="op" id="3187581">,</span>&nbsp;<span class="ident" id="3187583">d</span><span class="op" id="3187584">.</span><span class="ident" id="3187585">buf</span><span class="op" id="3187588">[</span><span class="num" id="3187589">0</span><span class="op" id="3187590">:</span><span class="ident" id="3187591">nr</span><span class="op" id="3187593">]</span><span class="op" id="3187594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187598">d</span><span class="op" id="3187599">.</span><span class="ident" id="3187600">out</span>&nbsp;<span class="op" id="3187604">=</span>&nbsp;<span class="ident" id="3187606">d</span><span class="op" id="3187607">.</span><span class="ident" id="3187608">outbuf</span><span class="op" id="3187614">[</span><span class="num" id="3187615">0</span><span class="op" id="3187616">:</span><span class="ident" id="3187617">nw</span><span class="op" id="3187619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187623">n</span>&nbsp;<span class="op" id="3187625">=</span>&nbsp;<span class="builtinfunc" id="3187627">copy</span><span class="op" id="3187631">(</span><span class="ident" id="3187632">p</span><span class="op" id="3187633">,</span>&nbsp;<span class="ident" id="3187635">d</span><span class="op" id="3187636">.</span><span class="ident" id="3187637">out</span><span class="op" id="3187640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187644">d</span><span class="op" id="3187645">.</span><span class="ident" id="3187646">out</span>&nbsp;<span class="op" id="3187650">=</span>&nbsp;<span class="ident" id="3187652">d</span><span class="op" id="3187653">.</span><span class="ident" id="3187654">out</span><span class="op" id="3187657">[</span><span class="ident" id="3187658">n</span><span class="op" id="3187659">:</span><span class="op" id="3187660">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187663">}</span>&nbsp;<span class="keyword" id="3187665">else</span>&nbsp;<span class="op" id="3187670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187674">n</span><span class="op" id="3187675">,</span>&nbsp;<span class="ident" id="3187677">d</span><span class="op" id="3187678">.</span><span class="ident" id="3187679">end</span><span class="op" id="3187682">,</span>&nbsp;<span class="ident" id="3187684">d</span><span class="op" id="3187685">.</span><span class="ident" id="3187686">err</span>&nbsp;<span class="op" id="3187690">=</span>&nbsp;<span class="ident" id="3187692">d</span><span class="op" id="3187693">.</span><span class="ident" id="3187694">enc</span><span class="op" id="3187697">.</span><span class="ident" id="3187698">decode</span><span class="op" id="3187704">(</span><span class="ident" id="3187705">p</span><span class="op" id="3187706">,</span>&nbsp;<span class="ident" id="3187708">d</span><span class="op" id="3187709">.</span><span class="ident" id="3187710">buf</span><span class="op" id="3187713">[</span><span class="num" id="3187714">0</span><span class="op" id="3187715">:</span><span class="ident" id="3187716">nr</span><span class="op" id="3187718">]</span><span class="op" id="3187719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187725">d</span><span class="op" id="3187726">.</span><span class="ident" id="3187727">nbuf</span>&nbsp;<span class="op" id="3187732">-=</span>&nbsp;<span class="ident" id="3187735">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187739">for</span>&nbsp;<span class="ident" id="3187743">i</span>&nbsp;<span class="op" id="3187745">:=</span>&nbsp;<span class="num" id="3187748">0</span><span class="op" id="3187749">;</span>&nbsp;<span class="ident" id="3187751">i</span>&nbsp;<span class="op" id="3187753">&lt;</span>&nbsp;<span class="ident" id="3187755">d</span><span class="op" id="3187756">.</span><span class="ident" id="3187757">nbuf</span><span class="op" id="3187761">;</span>&nbsp;<span class="ident" id="3187763">i</span><span class="op" id="3187764">++</span>&nbsp;<span class="op" id="3187767">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187771">d</span><span class="op" id="3187772">.</span><span class="ident" id="3187773">buf</span><span class="op" id="3187776">[</span><span class="ident" id="3187777">i</span><span class="op" id="3187778">]</span>&nbsp;<span class="op" id="3187780">=</span>&nbsp;<span class="ident" id="3187782">d</span><span class="op" id="3187783">.</span><span class="ident" id="3187784">buf</span><span class="op" id="3187787">[</span><span class="ident" id="3187788">i</span><span class="op" id="3187789">+</span><span class="ident" id="3187790">nr</span><span class="op" id="3187792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187799">if</span>&nbsp;<span class="ident" id="3187802">d</span><span class="op" id="3187803">.</span><span class="ident" id="3187804">err</span>&nbsp;<span class="op" id="3187808">==</span>&nbsp;<span class="ident" id="3187811">nil</span>&nbsp;<span class="op" id="3187815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187819">d</span><span class="op" id="3187820">.</span><span class="ident" id="3187821">err</span>&nbsp;<span class="op" id="3187825">=</span>&nbsp;<span class="ident" id="3187827">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3187832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3187835">return</span>&nbsp;<span class="ident" id="3187842">n</span><span class="op" id="3187843">,</span>&nbsp;<span class="ident" id="3187845">d</span><span class="op" id="3187846">.</span><span class="ident" id="3187847">err</span><br>
<span class="lineno"></span><span class="op" id="3187851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187854">type</span>&nbsp;<span class="ident" id="3187859">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3187882">struct</span>&nbsp;<span class="op" id="3187889">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187892">wrapped</span>&nbsp;<span class="ident" id="3187900">io</span><span class="op" id="3187902">.</span><span class="ident" id="3187903">Reader</span><br>
<span class="lineno"></span><span class="op" id="3187910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3187913">func</span>&nbsp;<span class="op" id="3187918">(</span><span class="ident" id="3187919">r</span>&nbsp;<span class="op" id="3187921">*</span><span class="ident" id="3187922">newlineFilteringReader</span><span class="op" id="3187944">)</span>&nbsp;<span class="ident" id="3187946">Read</span><span class="op" id="3187950">(</span><span class="ident" id="3187951">p</span>&nbsp;<span class="op" id="3187953">[</span><span class="op" id="3187954">]</span><span class="builtintype" id="3187955">byte</span><span class="op" id="3187959">)</span>&nbsp;<span class="op" id="3187961">(</span><span class="builtintype" id="3187962">int</span><span class="op" id="3187965">,</span>&nbsp;<span class="builtintype" id="3187967">error</span><span class="op" id="3187972">)</span>&nbsp;<span class="op" id="3187974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3187977">n</span><span class="op" id="3187978">,</span>&nbsp;<span class="ident" id="3187980">err</span>&nbsp;<span class="op" id="3187984">:=</span>&nbsp;<span class="ident" id="3187987">r</span><span class="op" id="3187988">.</span><span class="ident" id="3187989">wrapped</span><span class="op" id="3187996">.</span><span class="ident" id="3187997">Read</span><span class="op" id="3188001">(</span><span class="ident" id="3188002">p</span><span class="op" id="3188003">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188006">for</span>&nbsp;<span class="ident" id="3188010">n</span>&nbsp;<span class="op" id="3188012">&gt;</span>&nbsp;<span class="num" id="3188014">0</span>&nbsp;<span class="op" id="3188016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188020">offset</span>&nbsp;<span class="op" id="3188027">:=</span>&nbsp;<span class="num" id="3188030">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188034">for</span>&nbsp;<span class="ident" id="3188038">i</span><span class="op" id="3188039">,</span>&nbsp;<span class="ident" id="3188041">b</span>&nbsp;<span class="op" id="3188043">:=</span>&nbsp;<span class="keyword" id="3188046">range</span>&nbsp;<span class="ident" id="3188052">p</span><span class="op" id="3188053">[</span><span class="num" id="3188054">0</span><span class="op" id="3188055">:</span><span class="ident" id="3188056">n</span><span class="op" id="3188057">]</span>&nbsp;<span class="op" id="3188059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188064">if</span>&nbsp;<span class="ident" id="3188067">b</span>&nbsp;<span class="op" id="3188069">!=</span>&nbsp;<span class="string" id="3188072">&#39;\r&#39;</span>&nbsp;<span class="op" id="3188077">&amp;&amp;</span>&nbsp;<span class="ident" id="3188080">b</span>&nbsp;<span class="op" id="3188082">!=</span>&nbsp;<span class="string" id="3188085">&#39;\n&#39;</span>&nbsp;<span class="op" id="3188090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188096">if</span>&nbsp;<span class="ident" id="3188099">i</span>&nbsp;<span class="op" id="3188101">!=</span>&nbsp;<span class="ident" id="3188104">offset</span>&nbsp;<span class="op" id="3188111">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188118">p</span><span class="op" id="3188119">[</span><span class="ident" id="3188120">offset</span><span class="op" id="3188126">]</span>&nbsp;<span class="op" id="3188128">=</span>&nbsp;<span class="ident" id="3188130">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188142">offset</span><span class="op" id="3188148">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188158">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188162">if</span>&nbsp;<span class="ident" id="3188165">offset</span>&nbsp;<span class="op" id="3188172">&gt;</span>&nbsp;<span class="num" id="3188174">0</span>&nbsp;<span class="op" id="3188176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188181">return</span>&nbsp;<span class="ident" id="3188188">offset</span><span class="op" id="3188194">,</span>&nbsp;<span class="ident" id="3188196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3188206">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3188259">n</span><span class="op" id="3188260">,</span>&nbsp;<span class="ident" id="3188262">err</span>&nbsp;<span class="op" id="3188266">=</span>&nbsp;<span class="ident" id="3188268">r</span><span class="op" id="3188269">.</span><span class="ident" id="3188270">wrapped</span><span class="op" id="3188277">.</span><span class="ident" id="3188278">Read</span><span class="op" id="3188282">(</span><span class="ident" id="3188283">p</span><span class="op" id="3188284">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3188287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188290">return</span>&nbsp;<span class="ident" id="3188297">n</span><span class="op" id="3188298">,</span>&nbsp;<span class="ident" id="3188300">err</span><br>
<span class="lineno"></span><span class="op" id="3188304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3188307">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3188361">func</span>&nbsp;<span class="ident" id="3188366">NewDecoder</span><span class="op" id="3188376">(</span><span class="ident" id="3188377">enc</span>&nbsp;<span class="op" id="3188381">*</span><span class="ident" id="3188382">Encoding</span><span class="op" id="3188390">,</span>&nbsp;<span class="ident" id="3188392">r</span>&nbsp;<span class="ident" id="3188394">io</span><span class="op" id="3188396">.</span><span class="ident" id="3188397">Reader</span><span class="op" id="3188403">)</span>&nbsp;<span class="ident" id="3188405">io</span><span class="op" id="3188407">.</span><span class="ident" id="3188408">Reader</span>&nbsp;<span class="op" id="3188415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3188418">return</span>&nbsp;<span class="op" id="3188425">&amp;</span><span class="ident" id="3188426">decoder</span><span class="op" id="3188433">{</span><span class="ident" id="3188434">enc</span><span class="op" id="3188437">:</span>&nbsp;<span class="ident" id="3188439">enc</span><span class="op" id="3188442">,</span>&nbsp;<span class="ident" id="3188444">r</span><span class="op" id="3188445">:</span>&nbsp;<span class="op" id="3188447">&amp;</span><span class="ident" id="3188448">newlineFilteringReader</span><span class="op" id="3188470">{</span><span class="ident" id="3188471">r</span><span class="op" id="3188472">}</span><span class="op" id="3188473">}</span><br>
<span class="lineno"></span><span class="op" id="3188475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3188478">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3188548">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3188600">func</span>&nbsp;<span class="op" id="3188605">(</span><span class="ident" id="3188606">enc</span>&nbsp;<span class="op" id="3188610">*</span><span class="ident" id="3188611">Encoding</span><span class="op" id="3188619">)</span>&nbsp;<span class="ident" id="3188621">DecodedLen</span><span class="op" id="3188631">(</span><span class="ident" id="3188632">n</span>&nbsp;<span class="builtintype" id="3188634">int</span><span class="op" id="3188637">)</span>&nbsp;<span class="builtintype" id="3188639">int</span>&nbsp;<span class="op" id="3188643">{</span>&nbsp;<span class="keyword" id="3188645">return</span>&nbsp;<span class="ident" id="3188652">n</span>&nbsp;<span class="op" id="3188654">/</span>&nbsp;<span class="num" id="3188656">4</span>&nbsp;<span class="op" id="3188658">*</span>&nbsp;<span class="num" id="3188660">3</span>&nbsp;<span class="op" id="3188662">}</span>
</div>
</body>
</html>
