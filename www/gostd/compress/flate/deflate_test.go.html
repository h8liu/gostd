<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7136695">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7136750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7136804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7136855">package</span>&nbsp;<span class="ident" id="7136863">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7136870">import</span>&nbsp;<span class="op" id="7136877">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136880">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136889">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136896">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136902">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136915">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136926">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7136934">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7136944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7136947">type</span>&nbsp;<span class="ident" id="7136952">deflateTest</span>&nbsp;<span class="keyword" id="7136964">struct</span>&nbsp;<span class="op" id="7136971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136974">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7136980">[</span><span class="op" id="7136981">]</span><span class="builtintype" id="7136982">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136988">level</span>&nbsp;<span class="builtintype" id="7136994">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136999">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7137005">[</span><span class="op" id="7137006">]</span><span class="builtintype" id="7137007">byte</span><br>
<span class="lineno"></span><span class="op" id="7137012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7137015">type</span>&nbsp;<span class="ident" id="7137020">deflateInflateTest</span>&nbsp;<span class="keyword" id="7137039">struct</span>&nbsp;<span class="op" id="7137046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137049">in</span>&nbsp;<span class="op" id="7137052">[</span><span class="op" id="7137053">]</span><span class="builtintype" id="7137054">byte</span><br>
<span class="lineno">25</span><span class="op" id="7137059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7137062">type</span>&nbsp;<span class="ident" id="7137067">reverseBitsTest</span>&nbsp;<span class="keyword" id="7137083">struct</span>&nbsp;<span class="op" id="7137090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137093">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7137102">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137110">bitCount</span>&nbsp;<span class="builtintype" id="7137119">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137126">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7137135">uint16</span><br>
<span class="lineno"></span><span class="op" id="7137142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7137145">var</span>&nbsp;<span class="ident" id="7137149">deflateTests</span>&nbsp;<span class="op" id="7137162">=</span>&nbsp;<span class="op" id="7137164">[</span><span class="op" id="7137165">]</span><span class="op" id="7137166">*</span><span class="ident" id="7137167">deflateTest</span><span class="op" id="7137178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137181">{</span><span class="op" id="7137182">[</span><span class="op" id="7137183">]</span><span class="builtintype" id="7137184">byte</span><span class="op" id="7137188">{</span><span class="op" id="7137189">}</span><span class="op" id="7137190">,</span>&nbsp;<span class="num" id="7137192">0</span><span class="op" id="7137193">,</span>&nbsp;<span class="op" id="7137195">[</span><span class="op" id="7137196">]</span><span class="builtintype" id="7137197">byte</span><span class="op" id="7137201">{</span><span class="num" id="7137202">1</span><span class="op" id="7137203">,</span>&nbsp;<span class="num" id="7137205">0</span><span class="op" id="7137206">,</span>&nbsp;<span class="num" id="7137208">0</span><span class="op" id="7137209">,</span>&nbsp;<span class="num" id="7137211">255</span><span class="op" id="7137214">,</span>&nbsp;<span class="num" id="7137216">255</span><span class="op" id="7137219">}</span><span class="op" id="7137220">}</span><span class="op" id="7137221">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137224">{</span><span class="op" id="7137225">[</span><span class="op" id="7137226">]</span><span class="builtintype" id="7137227">byte</span><span class="op" id="7137231">{</span><span class="num" id="7137232">0x11</span><span class="op" id="7137236">}</span><span class="op" id="7137237">,</span>&nbsp;<span class="op" id="7137239">-</span><span class="num" id="7137240">1</span><span class="op" id="7137241">,</span>&nbsp;<span class="op" id="7137243">[</span><span class="op" id="7137244">]</span><span class="builtintype" id="7137245">byte</span><span class="op" id="7137249">{</span><span class="num" id="7137250">18</span><span class="op" id="7137252">,</span>&nbsp;<span class="num" id="7137254">4</span><span class="op" id="7137255">,</span>&nbsp;<span class="num" id="7137257">4</span><span class="op" id="7137258">,</span>&nbsp;<span class="num" id="7137260">0</span><span class="op" id="7137261">,</span>&nbsp;<span class="num" id="7137263">0</span><span class="op" id="7137264">,</span>&nbsp;<span class="num" id="7137266">255</span><span class="op" id="7137269">,</span>&nbsp;<span class="num" id="7137271">255</span><span class="op" id="7137274">}</span><span class="op" id="7137275">}</span><span class="op" id="7137276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137279">{</span><span class="op" id="7137280">[</span><span class="op" id="7137281">]</span><span class="builtintype" id="7137282">byte</span><span class="op" id="7137286">{</span><span class="num" id="7137287">0x11</span><span class="op" id="7137291">}</span><span class="op" id="7137292">,</span>&nbsp;<span class="ident" id="7137294">DefaultCompression</span><span class="op" id="7137312">,</span>&nbsp;<span class="op" id="7137314">[</span><span class="op" id="7137315">]</span><span class="builtintype" id="7137316">byte</span><span class="op" id="7137320">{</span><span class="num" id="7137321">18</span><span class="op" id="7137323">,</span>&nbsp;<span class="num" id="7137325">4</span><span class="op" id="7137326">,</span>&nbsp;<span class="num" id="7137328">4</span><span class="op" id="7137329">,</span>&nbsp;<span class="num" id="7137331">0</span><span class="op" id="7137332">,</span>&nbsp;<span class="num" id="7137334">0</span><span class="op" id="7137335">,</span>&nbsp;<span class="num" id="7137337">255</span><span class="op" id="7137340">,</span>&nbsp;<span class="num" id="7137342">255</span><span class="op" id="7137345">}</span><span class="op" id="7137346">}</span><span class="op" id="7137347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137350">{</span><span class="op" id="7137351">[</span><span class="op" id="7137352">]</span><span class="builtintype" id="7137353">byte</span><span class="op" id="7137357">{</span><span class="num" id="7137358">0x11</span><span class="op" id="7137362">}</span><span class="op" id="7137363">,</span>&nbsp;<span class="num" id="7137365">4</span><span class="op" id="7137366">,</span>&nbsp;<span class="op" id="7137368">[</span><span class="op" id="7137369">]</span><span class="builtintype" id="7137370">byte</span><span class="op" id="7137374">{</span><span class="num" id="7137375">18</span><span class="op" id="7137377">,</span>&nbsp;<span class="num" id="7137379">4</span><span class="op" id="7137380">,</span>&nbsp;<span class="num" id="7137382">4</span><span class="op" id="7137383">,</span>&nbsp;<span class="num" id="7137385">0</span><span class="op" id="7137386">,</span>&nbsp;<span class="num" id="7137388">0</span><span class="op" id="7137389">,</span>&nbsp;<span class="num" id="7137391">255</span><span class="op" id="7137394">,</span>&nbsp;<span class="num" id="7137396">255</span><span class="op" id="7137399">}</span><span class="op" id="7137400">}</span><span class="op" id="7137401">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137405">{</span><span class="op" id="7137406">[</span><span class="op" id="7137407">]</span><span class="builtintype" id="7137408">byte</span><span class="op" id="7137412">{</span><span class="num" id="7137413">0x11</span><span class="op" id="7137417">}</span><span class="op" id="7137418">,</span>&nbsp;<span class="num" id="7137420">0</span><span class="op" id="7137421">,</span>&nbsp;<span class="op" id="7137423">[</span><span class="op" id="7137424">]</span><span class="builtintype" id="7137425">byte</span><span class="op" id="7137429">{</span><span class="num" id="7137430">0</span><span class="op" id="7137431">,</span>&nbsp;<span class="num" id="7137433">1</span><span class="op" id="7137434">,</span>&nbsp;<span class="num" id="7137436">0</span><span class="op" id="7137437">,</span>&nbsp;<span class="num" id="7137439">254</span><span class="op" id="7137442">,</span>&nbsp;<span class="num" id="7137444">255</span><span class="op" id="7137447">,</span>&nbsp;<span class="num" id="7137449">17</span><span class="op" id="7137451">,</span>&nbsp;<span class="num" id="7137453">1</span><span class="op" id="7137454">,</span>&nbsp;<span class="num" id="7137456">0</span><span class="op" id="7137457">,</span>&nbsp;<span class="num" id="7137459">0</span><span class="op" id="7137460">,</span>&nbsp;<span class="num" id="7137462">255</span><span class="op" id="7137465">,</span>&nbsp;<span class="num" id="7137467">255</span><span class="op" id="7137470">}</span><span class="op" id="7137471">}</span><span class="op" id="7137472">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137475">{</span><span class="op" id="7137476">[</span><span class="op" id="7137477">]</span><span class="builtintype" id="7137478">byte</span><span class="op" id="7137482">{</span><span class="num" id="7137483">0x11</span><span class="op" id="7137487">,</span>&nbsp;<span class="num" id="7137489">0x12</span><span class="op" id="7137493">}</span><span class="op" id="7137494">,</span>&nbsp;<span class="num" id="7137496">0</span><span class="op" id="7137497">,</span>&nbsp;<span class="op" id="7137499">[</span><span class="op" id="7137500">]</span><span class="builtintype" id="7137501">byte</span><span class="op" id="7137505">{</span><span class="num" id="7137506">0</span><span class="op" id="7137507">,</span>&nbsp;<span class="num" id="7137509">2</span><span class="op" id="7137510">,</span>&nbsp;<span class="num" id="7137512">0</span><span class="op" id="7137513">,</span>&nbsp;<span class="num" id="7137515">253</span><span class="op" id="7137518">,</span>&nbsp;<span class="num" id="7137520">255</span><span class="op" id="7137523">,</span>&nbsp;<span class="num" id="7137525">17</span><span class="op" id="7137527">,</span>&nbsp;<span class="num" id="7137529">18</span><span class="op" id="7137531">,</span>&nbsp;<span class="num" id="7137533">1</span><span class="op" id="7137534">,</span>&nbsp;<span class="num" id="7137536">0</span><span class="op" id="7137537">,</span>&nbsp;<span class="num" id="7137539">0</span><span class="op" id="7137540">,</span>&nbsp;<span class="num" id="7137542">255</span><span class="op" id="7137545">,</span>&nbsp;<span class="num" id="7137547">255</span><span class="op" id="7137550">}</span><span class="op" id="7137551">}</span><span class="op" id="7137552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137555">{</span><span class="op" id="7137556">[</span><span class="op" id="7137557">]</span><span class="builtintype" id="7137558">byte</span><span class="op" id="7137562">{</span><span class="num" id="7137563">0x11</span><span class="op" id="7137567">,</span>&nbsp;<span class="num" id="7137569">0x11</span><span class="op" id="7137573">,</span>&nbsp;<span class="num" id="7137575">0x11</span><span class="op" id="7137579">,</span>&nbsp;<span class="num" id="7137581">0x11</span><span class="op" id="7137585">,</span>&nbsp;<span class="num" id="7137587">0x11</span><span class="op" id="7137591">,</span>&nbsp;<span class="num" id="7137593">0x11</span><span class="op" id="7137597">,</span>&nbsp;<span class="num" id="7137599">0x11</span><span class="op" id="7137603">,</span>&nbsp;<span class="num" id="7137605">0x11</span><span class="op" id="7137609">}</span><span class="op" id="7137610">,</span>&nbsp;<span class="num" id="7137612">0</span><span class="op" id="7137613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137617">[</span><span class="op" id="7137618">]</span><span class="builtintype" id="7137619">byte</span><span class="op" id="7137623">{</span><span class="num" id="7137624">0</span><span class="op" id="7137625">,</span>&nbsp;<span class="num" id="7137627">8</span><span class="op" id="7137628">,</span>&nbsp;<span class="num" id="7137630">0</span><span class="op" id="7137631">,</span>&nbsp;<span class="num" id="7137633">247</span><span class="op" id="7137636">,</span>&nbsp;<span class="num" id="7137638">255</span><span class="op" id="7137641">,</span>&nbsp;<span class="num" id="7137643">17</span><span class="op" id="7137645">,</span>&nbsp;<span class="num" id="7137647">17</span><span class="op" id="7137649">,</span>&nbsp;<span class="num" id="7137651">17</span><span class="op" id="7137653">,</span>&nbsp;<span class="num" id="7137655">17</span><span class="op" id="7137657">,</span>&nbsp;<span class="num" id="7137659">17</span><span class="op" id="7137661">,</span>&nbsp;<span class="num" id="7137663">17</span><span class="op" id="7137665">,</span>&nbsp;<span class="num" id="7137667">17</span><span class="op" id="7137669">,</span>&nbsp;<span class="num" id="7137671">17</span><span class="op" id="7137673">,</span>&nbsp;<span class="num" id="7137675">1</span><span class="op" id="7137676">,</span>&nbsp;<span class="num" id="7137678">0</span><span class="op" id="7137679">,</span>&nbsp;<span class="num" id="7137681">0</span><span class="op" id="7137682">,</span>&nbsp;<span class="num" id="7137684">255</span><span class="op" id="7137687">,</span>&nbsp;<span class="num" id="7137689">255</span><span class="op" id="7137692">}</span><span class="op" id="7137693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137696">}</span><span class="op" id="7137697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137700">{</span><span class="op" id="7137701">[</span><span class="op" id="7137702">]</span><span class="builtintype" id="7137703">byte</span><span class="op" id="7137707">{</span><span class="op" id="7137708">}</span><span class="op" id="7137709">,</span>&nbsp;<span class="num" id="7137711">1</span><span class="op" id="7137712">,</span>&nbsp;<span class="op" id="7137714">[</span><span class="op" id="7137715">]</span><span class="builtintype" id="7137716">byte</span><span class="op" id="7137720">{</span><span class="num" id="7137721">1</span><span class="op" id="7137722">,</span>&nbsp;<span class="num" id="7137724">0</span><span class="op" id="7137725">,</span>&nbsp;<span class="num" id="7137727">0</span><span class="op" id="7137728">,</span>&nbsp;<span class="num" id="7137730">255</span><span class="op" id="7137733">,</span>&nbsp;<span class="num" id="7137735">255</span><span class="op" id="7137738">}</span><span class="op" id="7137739">}</span><span class="op" id="7137740">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137743">{</span><span class="op" id="7137744">[</span><span class="op" id="7137745">]</span><span class="builtintype" id="7137746">byte</span><span class="op" id="7137750">{</span><span class="num" id="7137751">0x11</span><span class="op" id="7137755">}</span><span class="op" id="7137756">,</span>&nbsp;<span class="num" id="7137758">1</span><span class="op" id="7137759">,</span>&nbsp;<span class="op" id="7137761">[</span><span class="op" id="7137762">]</span><span class="builtintype" id="7137763">byte</span><span class="op" id="7137767">{</span><span class="num" id="7137768">18</span><span class="op" id="7137770">,</span>&nbsp;<span class="num" id="7137772">4</span><span class="op" id="7137773">,</span>&nbsp;<span class="num" id="7137775">4</span><span class="op" id="7137776">,</span>&nbsp;<span class="num" id="7137778">0</span><span class="op" id="7137779">,</span>&nbsp;<span class="num" id="7137781">0</span><span class="op" id="7137782">,</span>&nbsp;<span class="num" id="7137784">255</span><span class="op" id="7137787">,</span>&nbsp;<span class="num" id="7137789">255</span><span class="op" id="7137792">}</span><span class="op" id="7137793">}</span><span class="op" id="7137794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137797">{</span><span class="op" id="7137798">[</span><span class="op" id="7137799">]</span><span class="builtintype" id="7137800">byte</span><span class="op" id="7137804">{</span><span class="num" id="7137805">0x11</span><span class="op" id="7137809">,</span>&nbsp;<span class="num" id="7137811">0x12</span><span class="op" id="7137815">}</span><span class="op" id="7137816">,</span>&nbsp;<span class="num" id="7137818">1</span><span class="op" id="7137819">,</span>&nbsp;<span class="op" id="7137821">[</span><span class="op" id="7137822">]</span><span class="builtintype" id="7137823">byte</span><span class="op" id="7137827">{</span><span class="num" id="7137828">18</span><span class="op" id="7137830">,</span>&nbsp;<span class="num" id="7137832">20</span><span class="op" id="7137834">,</span>&nbsp;<span class="num" id="7137836">2</span><span class="op" id="7137837">,</span>&nbsp;<span class="num" id="7137839">4</span><span class="op" id="7137840">,</span>&nbsp;<span class="num" id="7137842">0</span><span class="op" id="7137843">,</span>&nbsp;<span class="num" id="7137845">0</span><span class="op" id="7137846">,</span>&nbsp;<span class="num" id="7137848">255</span><span class="op" id="7137851">,</span>&nbsp;<span class="num" id="7137853">255</span><span class="op" id="7137856">}</span><span class="op" id="7137857">}</span><span class="op" id="7137858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137861">{</span><span class="op" id="7137862">[</span><span class="op" id="7137863">]</span><span class="builtintype" id="7137864">byte</span><span class="op" id="7137868">{</span><span class="num" id="7137869">0x11</span><span class="op" id="7137873">,</span>&nbsp;<span class="num" id="7137875">0x11</span><span class="op" id="7137879">,</span>&nbsp;<span class="num" id="7137881">0x11</span><span class="op" id="7137885">,</span>&nbsp;<span class="num" id="7137887">0x11</span><span class="op" id="7137891">,</span>&nbsp;<span class="num" id="7137893">0x11</span><span class="op" id="7137897">,</span>&nbsp;<span class="num" id="7137899">0x11</span><span class="op" id="7137903">,</span>&nbsp;<span class="num" id="7137905">0x11</span><span class="op" id="7137909">,</span>&nbsp;<span class="num" id="7137911">0x11</span><span class="op" id="7137915">}</span><span class="op" id="7137916">,</span>&nbsp;<span class="num" id="7137918">1</span><span class="op" id="7137919">,</span>&nbsp;<span class="op" id="7137921">[</span><span class="op" id="7137922">]</span><span class="builtintype" id="7137923">byte</span><span class="op" id="7137927">{</span><span class="num" id="7137928">18</span><span class="op" id="7137930">,</span>&nbsp;<span class="num" id="7137932">132</span><span class="op" id="7137935">,</span>&nbsp;<span class="num" id="7137937">2</span><span class="op" id="7137938">,</span>&nbsp;<span class="num" id="7137940">64</span><span class="op" id="7137942">,</span>&nbsp;<span class="num" id="7137944">0</span><span class="op" id="7137945">,</span>&nbsp;<span class="num" id="7137947">0</span><span class="op" id="7137948">,</span>&nbsp;<span class="num" id="7137950">0</span><span class="op" id="7137951">,</span>&nbsp;<span class="num" id="7137953">255</span><span class="op" id="7137956">,</span>&nbsp;<span class="num" id="7137958">255</span><span class="op" id="7137961">}</span><span class="op" id="7137962">}</span><span class="op" id="7137963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137966">{</span><span class="op" id="7137967">[</span><span class="op" id="7137968">]</span><span class="builtintype" id="7137969">byte</span><span class="op" id="7137973">{</span><span class="op" id="7137974">}</span><span class="op" id="7137975">,</span>&nbsp;<span class="num" id="7137977">9</span><span class="op" id="7137978">,</span>&nbsp;<span class="op" id="7137980">[</span><span class="op" id="7137981">]</span><span class="builtintype" id="7137982">byte</span><span class="op" id="7137986">{</span><span class="num" id="7137987">1</span><span class="op" id="7137988">,</span>&nbsp;<span class="num" id="7137990">0</span><span class="op" id="7137991">,</span>&nbsp;<span class="num" id="7137993">0</span><span class="op" id="7137994">,</span>&nbsp;<span class="num" id="7137996">255</span><span class="op" id="7137999">,</span>&nbsp;<span class="num" id="7138001">255</span><span class="op" id="7138004">}</span><span class="op" id="7138005">}</span><span class="op" id="7138006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138009">{</span><span class="op" id="7138010">[</span><span class="op" id="7138011">]</span><span class="builtintype" id="7138012">byte</span><span class="op" id="7138016">{</span><span class="num" id="7138017">0x11</span><span class="op" id="7138021">}</span><span class="op" id="7138022">,</span>&nbsp;<span class="num" id="7138024">9</span><span class="op" id="7138025">,</span>&nbsp;<span class="op" id="7138027">[</span><span class="op" id="7138028">]</span><span class="builtintype" id="7138029">byte</span><span class="op" id="7138033">{</span><span class="num" id="7138034">18</span><span class="op" id="7138036">,</span>&nbsp;<span class="num" id="7138038">4</span><span class="op" id="7138039">,</span>&nbsp;<span class="num" id="7138041">4</span><span class="op" id="7138042">,</span>&nbsp;<span class="num" id="7138044">0</span><span class="op" id="7138045">,</span>&nbsp;<span class="num" id="7138047">0</span><span class="op" id="7138048">,</span>&nbsp;<span class="num" id="7138050">255</span><span class="op" id="7138053">,</span>&nbsp;<span class="num" id="7138055">255</span><span class="op" id="7138058">}</span><span class="op" id="7138059">}</span><span class="op" id="7138060">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138063">{</span><span class="op" id="7138064">[</span><span class="op" id="7138065">]</span><span class="builtintype" id="7138066">byte</span><span class="op" id="7138070">{</span><span class="num" id="7138071">0x11</span><span class="op" id="7138075">,</span>&nbsp;<span class="num" id="7138077">0x12</span><span class="op" id="7138081">}</span><span class="op" id="7138082">,</span>&nbsp;<span class="num" id="7138084">9</span><span class="op" id="7138085">,</span>&nbsp;<span class="op" id="7138087">[</span><span class="op" id="7138088">]</span><span class="builtintype" id="7138089">byte</span><span class="op" id="7138093">{</span><span class="num" id="7138094">18</span><span class="op" id="7138096">,</span>&nbsp;<span class="num" id="7138098">20</span><span class="op" id="7138100">,</span>&nbsp;<span class="num" id="7138102">2</span><span class="op" id="7138103">,</span>&nbsp;<span class="num" id="7138105">4</span><span class="op" id="7138106">,</span>&nbsp;<span class="num" id="7138108">0</span><span class="op" id="7138109">,</span>&nbsp;<span class="num" id="7138111">0</span><span class="op" id="7138112">,</span>&nbsp;<span class="num" id="7138114">255</span><span class="op" id="7138117">,</span>&nbsp;<span class="num" id="7138119">255</span><span class="op" id="7138122">}</span><span class="op" id="7138123">}</span><span class="op" id="7138124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138127">{</span><span class="op" id="7138128">[</span><span class="op" id="7138129">]</span><span class="builtintype" id="7138130">byte</span><span class="op" id="7138134">{</span><span class="num" id="7138135">0x11</span><span class="op" id="7138139">,</span>&nbsp;<span class="num" id="7138141">0x11</span><span class="op" id="7138145">,</span>&nbsp;<span class="num" id="7138147">0x11</span><span class="op" id="7138151">,</span>&nbsp;<span class="num" id="7138153">0x11</span><span class="op" id="7138157">,</span>&nbsp;<span class="num" id="7138159">0x11</span><span class="op" id="7138163">,</span>&nbsp;<span class="num" id="7138165">0x11</span><span class="op" id="7138169">,</span>&nbsp;<span class="num" id="7138171">0x11</span><span class="op" id="7138175">,</span>&nbsp;<span class="num" id="7138177">0x11</span><span class="op" id="7138181">}</span><span class="op" id="7138182">,</span>&nbsp;<span class="num" id="7138184">9</span><span class="op" id="7138185">,</span>&nbsp;<span class="op" id="7138187">[</span><span class="op" id="7138188">]</span><span class="builtintype" id="7138189">byte</span><span class="op" id="7138193">{</span><span class="num" id="7138194">18</span><span class="op" id="7138196">,</span>&nbsp;<span class="num" id="7138198">132</span><span class="op" id="7138201">,</span>&nbsp;<span class="num" id="7138203">2</span><span class="op" id="7138204">,</span>&nbsp;<span class="num" id="7138206">64</span><span class="op" id="7138208">,</span>&nbsp;<span class="num" id="7138210">0</span><span class="op" id="7138211">,</span>&nbsp;<span class="num" id="7138213">0</span><span class="op" id="7138214">,</span>&nbsp;<span class="num" id="7138216">0</span><span class="op" id="7138217">,</span>&nbsp;<span class="num" id="7138219">255</span><span class="op" id="7138222">,</span>&nbsp;<span class="num" id="7138224">255</span><span class="op" id="7138227">}</span><span class="op" id="7138228">}</span><span class="op" id="7138229">,</span><br>
<span class="lineno"></span><span class="op" id="7138231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7138234">var</span>&nbsp;<span class="ident" id="7138238">deflateInflateTests</span>&nbsp;<span class="op" id="7138258">=</span>&nbsp;<span class="op" id="7138260">[</span><span class="op" id="7138261">]</span><span class="op" id="7138262">*</span><span class="ident" id="7138263">deflateInflateTest</span><span class="op" id="7138281">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138284">{</span><span class="op" id="7138285">[</span><span class="op" id="7138286">]</span><span class="builtintype" id="7138287">byte</span><span class="op" id="7138291">{</span><span class="op" id="7138292">}</span><span class="op" id="7138293">}</span><span class="op" id="7138294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138297">{</span><span class="op" id="7138298">[</span><span class="op" id="7138299">]</span><span class="builtintype" id="7138300">byte</span><span class="op" id="7138304">{</span><span class="num" id="7138305">0x11</span><span class="op" id="7138309">}</span><span class="op" id="7138310">}</span><span class="op" id="7138311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138314">{</span><span class="op" id="7138315">[</span><span class="op" id="7138316">]</span><span class="builtintype" id="7138317">byte</span><span class="op" id="7138321">{</span><span class="num" id="7138322">0x11</span><span class="op" id="7138326">,</span>&nbsp;<span class="num" id="7138328">0x12</span><span class="op" id="7138332">}</span><span class="op" id="7138333">}</span><span class="op" id="7138334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138337">{</span><span class="op" id="7138338">[</span><span class="op" id="7138339">]</span><span class="builtintype" id="7138340">byte</span><span class="op" id="7138344">{</span><span class="num" id="7138345">0x11</span><span class="op" id="7138349">,</span>&nbsp;<span class="num" id="7138351">0x11</span><span class="op" id="7138355">,</span>&nbsp;<span class="num" id="7138357">0x11</span><span class="op" id="7138361">,</span>&nbsp;<span class="num" id="7138363">0x11</span><span class="op" id="7138367">,</span>&nbsp;<span class="num" id="7138369">0x11</span><span class="op" id="7138373">,</span>&nbsp;<span class="num" id="7138375">0x11</span><span class="op" id="7138379">,</span>&nbsp;<span class="num" id="7138381">0x11</span><span class="op" id="7138385">,</span>&nbsp;<span class="num" id="7138387">0x11</span><span class="op" id="7138391">}</span><span class="op" id="7138392">}</span><span class="op" id="7138393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138396">{</span><span class="op" id="7138397">[</span><span class="op" id="7138398">]</span><span class="builtintype" id="7138399">byte</span><span class="op" id="7138403">{</span><span class="num" id="7138404">0x11</span><span class="op" id="7138408">,</span>&nbsp;<span class="num" id="7138410">0x10</span><span class="op" id="7138414">,</span>&nbsp;<span class="num" id="7138416">0x13</span><span class="op" id="7138420">,</span>&nbsp;<span class="num" id="7138422">0x41</span><span class="op" id="7138426">,</span>&nbsp;<span class="num" id="7138428">0x21</span><span class="op" id="7138432">,</span>&nbsp;<span class="num" id="7138434">0x21</span><span class="op" id="7138438">,</span>&nbsp;<span class="num" id="7138440">0x41</span><span class="op" id="7138444">,</span>&nbsp;<span class="num" id="7138446">0x13</span><span class="op" id="7138450">,</span>&nbsp;<span class="num" id="7138452">0x87</span><span class="op" id="7138456">,</span>&nbsp;<span class="num" id="7138458">0x78</span><span class="op" id="7138462">,</span>&nbsp;<span class="num" id="7138464">0x13</span><span class="op" id="7138468">}</span><span class="op" id="7138469">}</span><span class="op" id="7138470">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138473">{</span><span class="ident" id="7138474">largeDataChunk</span><span class="op" id="7138488">(</span><span class="op" id="7138489">)</span><span class="op" id="7138490">}</span><span class="op" id="7138491">,</span><br>
<span class="lineno"></span><span class="op" id="7138493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7138496">var</span>&nbsp;<span class="ident" id="7138500">reverseBitsTests</span>&nbsp;<span class="op" id="7138517">=</span>&nbsp;<span class="op" id="7138519">[</span><span class="op" id="7138520">]</span><span class="op" id="7138521">*</span><span class="ident" id="7138522">reverseBitsTest</span><span class="op" id="7138537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138540">{</span><span class="num" id="7138541">1</span><span class="op" id="7138542">,</span>&nbsp;<span class="num" id="7138544">1</span><span class="op" id="7138545">,</span>&nbsp;<span class="num" id="7138547">1</span><span class="op" id="7138548">}</span><span class="op" id="7138549">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138552">{</span><span class="num" id="7138553">1</span><span class="op" id="7138554">,</span>&nbsp;<span class="num" id="7138556">2</span><span class="op" id="7138557">,</span>&nbsp;<span class="num" id="7138559">2</span><span class="op" id="7138560">}</span><span class="op" id="7138561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138564">{</span><span class="num" id="7138565">1</span><span class="op" id="7138566">,</span>&nbsp;<span class="num" id="7138568">3</span><span class="op" id="7138569">,</span>&nbsp;<span class="num" id="7138571">4</span><span class="op" id="7138572">}</span><span class="op" id="7138573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138576">{</span><span class="num" id="7138577">1</span><span class="op" id="7138578">,</span>&nbsp;<span class="num" id="7138580">4</span><span class="op" id="7138581">,</span>&nbsp;<span class="num" id="7138583">8</span><span class="op" id="7138584">}</span><span class="op" id="7138585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138588">{</span><span class="num" id="7138589">1</span><span class="op" id="7138590">,</span>&nbsp;<span class="num" id="7138592">5</span><span class="op" id="7138593">,</span>&nbsp;<span class="num" id="7138595">16</span><span class="op" id="7138597">}</span><span class="op" id="7138598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138601">{</span><span class="num" id="7138602">17</span><span class="op" id="7138604">,</span>&nbsp;<span class="num" id="7138606">5</span><span class="op" id="7138607">,</span>&nbsp;<span class="num" id="7138609">17</span><span class="op" id="7138611">}</span><span class="op" id="7138612">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138615">{</span><span class="num" id="7138616">257</span><span class="op" id="7138619">,</span>&nbsp;<span class="num" id="7138621">9</span><span class="op" id="7138622">,</span>&nbsp;<span class="num" id="7138624">257</span><span class="op" id="7138627">}</span><span class="op" id="7138628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138631">{</span><span class="num" id="7138632">29</span><span class="op" id="7138634">,</span>&nbsp;<span class="num" id="7138636">5</span><span class="op" id="7138637">,</span>&nbsp;<span class="num" id="7138639">23</span><span class="op" id="7138641">}</span><span class="op" id="7138642">,</span><br>
<span class="lineno"></span><span class="op" id="7138644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7138647">func</span>&nbsp;<span class="ident" id="7138652">largeDataChunk</span><span class="op" id="7138666">(</span><span class="op" id="7138667">)</span>&nbsp;<span class="op" id="7138669">[</span><span class="op" id="7138670">]</span><span class="builtintype" id="7138671">byte</span>&nbsp;<span class="op" id="7138676">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138679">result</span>&nbsp;<span class="op" id="7138686">:=</span>&nbsp;<span class="builtinfunc" id="7138689">make</span><span class="op" id="7138693">(</span><span class="op" id="7138694">[</span><span class="op" id="7138695">]</span><span class="builtintype" id="7138696">byte</span><span class="op" id="7138700">,</span>&nbsp;<span class="num" id="7138702">100000</span><span class="op" id="7138708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138711">for</span>&nbsp;<span class="ident" id="7138715">i</span>&nbsp;<span class="op" id="7138717">:=</span>&nbsp;<span class="keyword" id="7138720">range</span>&nbsp;<span class="ident" id="7138726">result</span>&nbsp;<span class="op" id="7138733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138737">result</span><span class="op" id="7138743">[</span><span class="ident" id="7138744">i</span><span class="op" id="7138745">]</span>&nbsp;<span class="op" id="7138747">=</span>&nbsp;<span class="builtintype" id="7138749">byte</span><span class="op" id="7138753">(</span><span class="ident" id="7138754">i</span>&nbsp;<span class="op" id="7138756">*</span>&nbsp;<span class="ident" id="7138758">i</span>&nbsp;<span class="op" id="7138760">&amp;</span>&nbsp;<span class="num" id="7138762">0xFF</span><span class="op" id="7138766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138772">return</span>&nbsp;<span class="ident" id="7138779">result</span><br>
<span class="lineno">80</span><span class="op" id="7138786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7138789">func</span>&nbsp;<span class="ident" id="7138794">TestDeflate</span><span class="op" id="7138805">(</span><span class="ident" id="7138806">t</span>&nbsp;<span class="op" id="7138808">*</span><span class="ident" id="7138809">testing</span><span class="op" id="7138816">.</span><span class="ident" id="7138817">T</span><span class="op" id="7138818">)</span>&nbsp;<span class="op" id="7138820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138823">for</span>&nbsp;<span class="ident" id="7138827">_</span><span class="op" id="7138828">,</span>&nbsp;<span class="ident" id="7138830">h</span>&nbsp;<span class="op" id="7138832">:=</span>&nbsp;<span class="keyword" id="7138835">range</span>&nbsp;<span class="ident" id="7138841">deflateTests</span>&nbsp;<span class="op" id="7138854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138858">var</span>&nbsp;<span class="ident" id="7138862">buf</span>&nbsp;<span class="ident" id="7138866">bytes</span><span class="op" id="7138871">.</span><span class="ident" id="7138872">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138881">w</span><span class="op" id="7138882">,</span>&nbsp;<span class="ident" id="7138884">err</span>&nbsp;<span class="op" id="7138888">:=</span>&nbsp;<span class="ident" id="7138891">NewWriter</span><span class="op" id="7138900">(</span><span class="op" id="7138901">&amp;</span><span class="ident" id="7138902">buf</span><span class="op" id="7138905">,</span>&nbsp;<span class="ident" id="7138907">h</span><span class="op" id="7138908">.</span><span class="ident" id="7138909">level</span><span class="op" id="7138914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138918">if</span>&nbsp;<span class="ident" id="7138921">err</span>&nbsp;<span class="op" id="7138925">!=</span>&nbsp;<span class="ident" id="7138928">nil</span>&nbsp;<span class="op" id="7138932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138937">t</span><span class="op" id="7138938">.</span><span class="ident" id="7138939">Errorf</span><span class="op" id="7138945">(</span><span class="string" id="7138946">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7138961">,</span>&nbsp;<span class="ident" id="7138963">err</span><span class="op" id="7138966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138971">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138982">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138986">w</span><span class="op" id="7138987">.</span><span class="ident" id="7138988">Write</span><span class="op" id="7138993">(</span><span class="ident" id="7138994">h</span><span class="op" id="7138995">.</span><span class="ident" id="7138996">in</span><span class="op" id="7138998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139002">w</span><span class="op" id="7139003">.</span><span class="ident" id="7139004">Close</span><span class="op" id="7139009">(</span><span class="op" id="7139010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139014">if</span>&nbsp;<span class="op" id="7139017">!</span><span class="ident" id="7139018">bytes</span><span class="op" id="7139023">.</span><span class="ident" id="7139024">Equal</span><span class="op" id="7139029">(</span><span class="ident" id="7139030">buf</span><span class="op" id="7139033">.</span><span class="ident" id="7139034">Bytes</span><span class="op" id="7139039">(</span><span class="op" id="7139040">)</span><span class="op" id="7139041">,</span>&nbsp;<span class="ident" id="7139043">h</span><span class="op" id="7139044">.</span><span class="ident" id="7139045">out</span><span class="op" id="7139048">)</span>&nbsp;<span class="op" id="7139050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139055">t</span><span class="op" id="7139056">.</span><span class="ident" id="7139057">Errorf</span><span class="op" id="7139063">(</span><span class="string" id="7139064">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="7139095">,</span>&nbsp;<span class="ident" id="7139097">h</span><span class="op" id="7139098">.</span><span class="ident" id="7139099">level</span><span class="op" id="7139104">,</span>&nbsp;<span class="ident" id="7139106">h</span><span class="op" id="7139107">.</span><span class="ident" id="7139108">in</span><span class="op" id="7139110">,</span>&nbsp;<span class="ident" id="7139112">buf</span><span class="op" id="7139115">.</span><span class="ident" id="7139116">Bytes</span><span class="op" id="7139121">(</span><span class="op" id="7139122">)</span><span class="op" id="7139123">,</span>&nbsp;<span class="ident" id="7139125">h</span><span class="op" id="7139126">.</span><span class="ident" id="7139127">out</span><span class="op" id="7139130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139134">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139137">}</span><br>
<span class="lineno"></span><span class="op" id="7139139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7139142">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="7139216">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="7139277">type</span>&nbsp;<span class="ident" id="7139282">sparseReader</span>&nbsp;<span class="keyword" id="7139295">struct</span>&nbsp;<span class="op" id="7139302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139305">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7139309">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139316">cur</span>&nbsp;<span class="ident" id="7139320">int64</span><br>
<span class="lineno"></span><span class="op" id="7139326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7139329">func</span>&nbsp;<span class="op" id="7139334">(</span><span class="ident" id="7139335">r</span>&nbsp;<span class="op" id="7139337">*</span><span class="ident" id="7139338">sparseReader</span><span class="op" id="7139350">)</span>&nbsp;<span class="ident" id="7139352">Read</span><span class="op" id="7139356">(</span><span class="ident" id="7139357">b</span>&nbsp;<span class="op" id="7139359">[</span><span class="op" id="7139360">]</span><span class="builtintype" id="7139361">byte</span><span class="op" id="7139365">)</span>&nbsp;<span class="op" id="7139367">(</span><span class="ident" id="7139368">n</span>&nbsp;<span class="builtintype" id="7139370">int</span><span class="op" id="7139373">,</span>&nbsp;<span class="ident" id="7139375">err</span>&nbsp;<span class="builtintype" id="7139379">error</span><span class="op" id="7139384">)</span>&nbsp;<span class="op" id="7139386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139389">if</span>&nbsp;<span class="ident" id="7139392">r</span><span class="op" id="7139393">.</span><span class="ident" id="7139394">cur</span>&nbsp;<span class="op" id="7139398">&gt;=</span>&nbsp;<span class="ident" id="7139401">r</span><span class="op" id="7139402">.</span><span class="ident" id="7139403">l</span>&nbsp;<span class="op" id="7139405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139409">return</span>&nbsp;<span class="num" id="7139416">0</span><span class="op" id="7139417">,</span>&nbsp;<span class="ident" id="7139419">io</span><span class="op" id="7139421">.</span><span class="ident" id="7139422">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139430">n</span>&nbsp;<span class="op" id="7139432">=</span>&nbsp;<span class="builtinfunc" id="7139434">len</span><span class="op" id="7139437">(</span><span class="ident" id="7139438">b</span><span class="op" id="7139439">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139442">cur</span>&nbsp;<span class="op" id="7139446">:=</span>&nbsp;<span class="ident" id="7139449">r</span><span class="op" id="7139450">.</span><span class="ident" id="7139451">cur</span>&nbsp;<span class="op" id="7139455">+</span>&nbsp;<span class="ident" id="7139457">int64</span><span class="op" id="7139462">(</span><span class="ident" id="7139463">n</span><span class="op" id="7139464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139467">if</span>&nbsp;<span class="ident" id="7139470">cur</span>&nbsp;<span class="op" id="7139474">&gt;</span>&nbsp;<span class="ident" id="7139476">r</span><span class="op" id="7139477">.</span><span class="ident" id="7139478">l</span>&nbsp;<span class="op" id="7139480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139484">n</span>&nbsp;<span class="op" id="7139486">-=</span>&nbsp;<span class="builtintype" id="7139489">int</span><span class="op" id="7139492">(</span><span class="ident" id="7139493">cur</span>&nbsp;<span class="op" id="7139497">-</span>&nbsp;<span class="ident" id="7139499">r</span><span class="op" id="7139500">.</span><span class="ident" id="7139501">l</span><span class="op" id="7139502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139506">cur</span>&nbsp;<span class="op" id="7139510">=</span>&nbsp;<span class="ident" id="7139512">r</span><span class="op" id="7139513">.</span><span class="ident" id="7139514">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139517">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139520">for</span>&nbsp;<span class="ident" id="7139524">i</span>&nbsp;<span class="op" id="7139526">:=</span>&nbsp;<span class="keyword" id="7139529">range</span>&nbsp;<span class="ident" id="7139535">b</span><span class="op" id="7139536">[</span><span class="num" id="7139537">0</span><span class="op" id="7139538">:</span><span class="ident" id="7139539">n</span><span class="op" id="7139540">]</span>&nbsp;<span class="op" id="7139542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139546">if</span>&nbsp;<span class="ident" id="7139549">r</span><span class="op" id="7139550">.</span><span class="ident" id="7139551">cur</span><span class="op" id="7139554">+</span><span class="ident" id="7139555">int64</span><span class="op" id="7139560">(</span><span class="ident" id="7139561">i</span><span class="op" id="7139562">)</span>&nbsp;<span class="op" id="7139564">&gt;=</span>&nbsp;<span class="ident" id="7139567">r</span><span class="op" id="7139568">.</span><span class="ident" id="7139569">l</span><span class="op" id="7139570">-</span><span class="num" id="7139571">1</span><span class="op" id="7139572">&lt;&lt;</span><span class="num" id="7139574">16</span>&nbsp;<span class="op" id="7139577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139582">b</span><span class="op" id="7139583">[</span><span class="ident" id="7139584">i</span><span class="op" id="7139585">]</span>&nbsp;<span class="op" id="7139587">=</span>&nbsp;<span class="num" id="7139589">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139593">}</span>&nbsp;<span class="keyword" id="7139595">else</span>&nbsp;<span class="op" id="7139600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139605">b</span><span class="op" id="7139606">[</span><span class="ident" id="7139607">i</span><span class="op" id="7139608">]</span>&nbsp;<span class="op" id="7139610">=</span>&nbsp;<span class="num" id="7139612">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139622">r</span><span class="op" id="7139623">.</span><span class="ident" id="7139624">cur</span>&nbsp;<span class="op" id="7139628">=</span>&nbsp;<span class="ident" id="7139630">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139635">return</span><br>
<span class="lineno"></span><span class="op" id="7139642">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7139645">func</span>&nbsp;<span class="ident" id="7139650">TestVeryLongSparseChunk</span><span class="op" id="7139673">(</span><span class="ident" id="7139674">t</span>&nbsp;<span class="op" id="7139676">*</span><span class="ident" id="7139677">testing</span><span class="op" id="7139684">.</span><span class="ident" id="7139685">T</span><span class="op" id="7139686">)</span>&nbsp;<span class="op" id="7139688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139691">if</span>&nbsp;<span class="ident" id="7139694">testing</span><span class="op" id="7139701">.</span><span class="ident" id="7139702">Short</span><span class="op" id="7139707">(</span><span class="op" id="7139708">)</span>&nbsp;<span class="op" id="7139710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139714">t</span><span class="op" id="7139715">.</span><span class="ident" id="7139716">Skip</span><span class="op" id="7139720">(</span><span class="string" id="7139721">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="7139762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139765">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139768">w</span><span class="op" id="7139769">,</span>&nbsp;<span class="ident" id="7139771">err</span>&nbsp;<span class="op" id="7139775">:=</span>&nbsp;<span class="ident" id="7139778">NewWriter</span><span class="op" id="7139787">(</span><span class="ident" id="7139788">ioutil</span><span class="op" id="7139794">.</span><span class="ident" id="7139795">Discard</span><span class="op" id="7139802">,</span>&nbsp;<span class="num" id="7139804">1</span><span class="op" id="7139805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139808">if</span>&nbsp;<span class="ident" id="7139811">err</span>&nbsp;<span class="op" id="7139815">!=</span>&nbsp;<span class="ident" id="7139818">nil</span>&nbsp;<span class="op" id="7139822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139826">t</span><span class="op" id="7139827">.</span><span class="ident" id="7139828">Errorf</span><span class="op" id="7139834">(</span><span class="string" id="7139835">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7139850">,</span>&nbsp;<span class="ident" id="7139852">err</span><span class="op" id="7139855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139859">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139867">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139870">if</span>&nbsp;<span class="ident" id="7139873">_</span><span class="op" id="7139874">,</span>&nbsp;<span class="ident" id="7139876">err</span>&nbsp;<span class="op" id="7139880">=</span>&nbsp;<span class="ident" id="7139882">io</span><span class="op" id="7139884">.</span><span class="ident" id="7139885">Copy</span><span class="op" id="7139889">(</span><span class="ident" id="7139890">w</span><span class="op" id="7139891">,</span>&nbsp;<span class="op" id="7139893">&amp;</span><span class="ident" id="7139894">sparseReader</span><span class="op" id="7139906">{</span><span class="ident" id="7139907">l</span><span class="op" id="7139908">:</span>&nbsp;<span class="num" id="7139910">23E8</span><span class="op" id="7139914">}</span><span class="op" id="7139915">)</span><span class="op" id="7139916">;</span>&nbsp;<span class="ident" id="7139918">err</span>&nbsp;<span class="op" id="7139922">!=</span>&nbsp;<span class="ident" id="7139925">nil</span>&nbsp;<span class="op" id="7139929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139933">t</span><span class="op" id="7139934">.</span><span class="ident" id="7139935">Errorf</span><span class="op" id="7139941">(</span><span class="string" id="7139942">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7139963">,</span>&nbsp;<span class="ident" id="7139965">err</span><span class="op" id="7139968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139972">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139980">}</span><br>
<span class="lineno"></span><span class="op" id="7139982">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7139985">type</span>&nbsp;<span class="ident" id="7139990">syncBuffer</span>&nbsp;<span class="keyword" id="7140001">struct</span>&nbsp;<span class="op" id="7140008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140011">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7140018">bytes</span><span class="op" id="7140023">.</span><span class="ident" id="7140024">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140032">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7140039">sync</span><span class="op" id="7140043">.</span><span class="ident" id="7140044">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140053">closed</span>&nbsp;<span class="builtintype" id="7140060">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140066">ready</span>&nbsp;&nbsp;<span class="keyword" id="7140073">chan</span>&nbsp;<span class="builtintype" id="7140078">bool</span><br>
<span class="lineno"></span><span class="op" id="7140083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140086">func</span>&nbsp;<span class="ident" id="7140091">newSyncBuffer</span><span class="op" id="7140104">(</span><span class="op" id="7140105">)</span>&nbsp;<span class="op" id="7140107">*</span><span class="ident" id="7140108">syncBuffer</span>&nbsp;<span class="op" id="7140119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140122">return</span>&nbsp;<span class="op" id="7140129">&amp;</span><span class="ident" id="7140130">syncBuffer</span><span class="op" id="7140140">{</span><span class="ident" id="7140141">ready</span><span class="op" id="7140146">:</span>&nbsp;<span class="builtinfunc" id="7140148">make</span><span class="op" id="7140152">(</span><span class="keyword" id="7140153">chan</span>&nbsp;<span class="builtintype" id="7140158">bool</span><span class="op" id="7140162">,</span>&nbsp;<span class="num" id="7140164">1</span><span class="op" id="7140165">)</span><span class="op" id="7140166">}</span><br>
<span class="lineno">150</span><span class="op" id="7140168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140171">func</span>&nbsp;<span class="op" id="7140176">(</span><span class="ident" id="7140177">b</span>&nbsp;<span class="op" id="7140179">*</span><span class="ident" id="7140180">syncBuffer</span><span class="op" id="7140190">)</span>&nbsp;<span class="ident" id="7140192">Read</span><span class="op" id="7140196">(</span><span class="ident" id="7140197">p</span>&nbsp;<span class="op" id="7140199">[</span><span class="op" id="7140200">]</span><span class="builtintype" id="7140201">byte</span><span class="op" id="7140205">)</span>&nbsp;<span class="op" id="7140207">(</span><span class="ident" id="7140208">n</span>&nbsp;<span class="builtintype" id="7140210">int</span><span class="op" id="7140213">,</span>&nbsp;<span class="ident" id="7140215">err</span>&nbsp;<span class="builtintype" id="7140219">error</span><span class="op" id="7140224">)</span>&nbsp;<span class="op" id="7140226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140229">for</span>&nbsp;<span class="op" id="7140233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140237">b</span><span class="op" id="7140238">.</span><span class="ident" id="7140239">mu</span><span class="op" id="7140241">.</span><span class="ident" id="7140242">RLock</span><span class="op" id="7140247">(</span><span class="op" id="7140248">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140252">n</span><span class="op" id="7140253">,</span>&nbsp;<span class="ident" id="7140255">err</span>&nbsp;<span class="op" id="7140259">=</span>&nbsp;<span class="ident" id="7140261">b</span><span class="op" id="7140262">.</span><span class="ident" id="7140263">buf</span><span class="op" id="7140266">.</span><span class="ident" id="7140267">Read</span><span class="op" id="7140271">(</span><span class="ident" id="7140272">p</span><span class="op" id="7140273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140277">b</span><span class="op" id="7140278">.</span><span class="ident" id="7140279">mu</span><span class="op" id="7140281">.</span><span class="ident" id="7140282">RUnlock</span><span class="op" id="7140289">(</span><span class="op" id="7140290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140294">if</span>&nbsp;<span class="ident" id="7140297">n</span>&nbsp;<span class="op" id="7140299">&gt;</span>&nbsp;<span class="num" id="7140301">0</span>&nbsp;<span class="op" id="7140303">||</span>&nbsp;<span class="ident" id="7140306">b</span><span class="op" id="7140307">.</span><span class="ident" id="7140308">closed</span>&nbsp;<span class="op" id="7140315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140320">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140329">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140333">&lt;-</span><span class="ident" id="7140335">b</span><span class="op" id="7140336">.</span><span class="ident" id="7140337">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140344">}</span><br>
<span class="lineno"></span><span class="op" id="7140346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140349">func</span>&nbsp;<span class="op" id="7140354">(</span><span class="ident" id="7140355">b</span>&nbsp;<span class="op" id="7140357">*</span><span class="ident" id="7140358">syncBuffer</span><span class="op" id="7140368">)</span>&nbsp;<span class="ident" id="7140370">signal</span><span class="op" id="7140376">(</span><span class="op" id="7140377">)</span>&nbsp;<span class="op" id="7140379">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140382">select</span>&nbsp;<span class="op" id="7140389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140392">case</span>&nbsp;<span class="ident" id="7140397">b</span><span class="op" id="7140398">.</span><span class="ident" id="7140399">ready</span>&nbsp;<span class="op" id="7140405">&lt;-</span>&nbsp;<span class="builtintype" id="7140408">true</span><span class="op" id="7140412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140415">default</span><span class="op" id="7140422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140425">}</span><br>
<span class="lineno"></span><span class="op" id="7140427">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7140430">func</span>&nbsp;<span class="op" id="7140435">(</span><span class="ident" id="7140436">b</span>&nbsp;<span class="op" id="7140438">*</span><span class="ident" id="7140439">syncBuffer</span><span class="op" id="7140449">)</span>&nbsp;<span class="ident" id="7140451">Write</span><span class="op" id="7140456">(</span><span class="ident" id="7140457">p</span>&nbsp;<span class="op" id="7140459">[</span><span class="op" id="7140460">]</span><span class="builtintype" id="7140461">byte</span><span class="op" id="7140465">)</span>&nbsp;<span class="op" id="7140467">(</span><span class="ident" id="7140468">n</span>&nbsp;<span class="builtintype" id="7140470">int</span><span class="op" id="7140473">,</span>&nbsp;<span class="ident" id="7140475">err</span>&nbsp;<span class="builtintype" id="7140479">error</span><span class="op" id="7140484">)</span>&nbsp;<span class="op" id="7140486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140489">n</span><span class="op" id="7140490">,</span>&nbsp;<span class="ident" id="7140492">err</span>&nbsp;<span class="op" id="7140496">=</span>&nbsp;<span class="ident" id="7140498">b</span><span class="op" id="7140499">.</span><span class="ident" id="7140500">buf</span><span class="op" id="7140503">.</span><span class="ident" id="7140504">Write</span><span class="op" id="7140509">(</span><span class="ident" id="7140510">p</span><span class="op" id="7140511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140514">b</span><span class="op" id="7140515">.</span><span class="ident" id="7140516">signal</span><span class="op" id="7140522">(</span><span class="op" id="7140523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140526">return</span><br>
<span class="lineno">175</span><span class="op" id="7140533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140536">func</span>&nbsp;<span class="op" id="7140541">(</span><span class="ident" id="7140542">b</span>&nbsp;<span class="op" id="7140544">*</span><span class="ident" id="7140545">syncBuffer</span><span class="op" id="7140555">)</span>&nbsp;<span class="ident" id="7140557">WriteMode</span><span class="op" id="7140566">(</span><span class="op" id="7140567">)</span>&nbsp;<span class="op" id="7140569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140572">b</span><span class="op" id="7140573">.</span><span class="ident" id="7140574">mu</span><span class="op" id="7140576">.</span><span class="ident" id="7140577">Lock</span><span class="op" id="7140581">(</span><span class="op" id="7140582">)</span><br>
<span class="lineno"></span><span class="op" id="7140584">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="7140587">func</span>&nbsp;<span class="op" id="7140592">(</span><span class="ident" id="7140593">b</span>&nbsp;<span class="op" id="7140595">*</span><span class="ident" id="7140596">syncBuffer</span><span class="op" id="7140606">)</span>&nbsp;<span class="ident" id="7140608">ReadMode</span><span class="op" id="7140616">(</span><span class="op" id="7140617">)</span>&nbsp;<span class="op" id="7140619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140622">b</span><span class="op" id="7140623">.</span><span class="ident" id="7140624">mu</span><span class="op" id="7140626">.</span><span class="ident" id="7140627">Unlock</span><span class="op" id="7140633">(</span><span class="op" id="7140634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140637">b</span><span class="op" id="7140638">.</span><span class="ident" id="7140639">signal</span><span class="op" id="7140645">(</span><span class="op" id="7140646">)</span><br>
<span class="lineno"></span><span class="op" id="7140648">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7140651">func</span>&nbsp;<span class="op" id="7140656">(</span><span class="ident" id="7140657">b</span>&nbsp;<span class="op" id="7140659">*</span><span class="ident" id="7140660">syncBuffer</span><span class="op" id="7140670">)</span>&nbsp;<span class="ident" id="7140672">Close</span><span class="op" id="7140677">(</span><span class="op" id="7140678">)</span>&nbsp;<span class="builtintype" id="7140680">error</span>&nbsp;<span class="op" id="7140686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140689">b</span><span class="op" id="7140690">.</span><span class="ident" id="7140691">closed</span>&nbsp;<span class="op" id="7140698">=</span>&nbsp;<span class="builtintype" id="7140700">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140706">b</span><span class="op" id="7140707">.</span><span class="ident" id="7140708">signal</span><span class="op" id="7140714">(</span><span class="op" id="7140715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140718">return</span>&nbsp;<span class="ident" id="7140725">nil</span><br>
<span class="lineno">190</span><span class="op" id="7140729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140732">func</span>&nbsp;<span class="ident" id="7140737">testSync</span><span class="op" id="7140745">(</span><span class="ident" id="7140746">t</span>&nbsp;<span class="op" id="7140748">*</span><span class="ident" id="7140749">testing</span><span class="op" id="7140756">.</span><span class="ident" id="7140757">T</span><span class="op" id="7140758">,</span>&nbsp;<span class="ident" id="7140760">level</span>&nbsp;<span class="builtintype" id="7140766">int</span><span class="op" id="7140769">,</span>&nbsp;<span class="ident" id="7140771">input</span>&nbsp;<span class="op" id="7140777">[</span><span class="op" id="7140778">]</span><span class="builtintype" id="7140779">byte</span><span class="op" id="7140783">,</span>&nbsp;<span class="ident" id="7140785">name</span>&nbsp;<span class="builtintype" id="7140790">string</span><span class="op" id="7140796">)</span>&nbsp;<span class="op" id="7140798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140801">if</span>&nbsp;<span class="builtinfunc" id="7140804">len</span><span class="op" id="7140807">(</span><span class="ident" id="7140808">input</span><span class="op" id="7140813">)</span>&nbsp;<span class="op" id="7140815">==</span>&nbsp;<span class="num" id="7140818">0</span>&nbsp;<span class="op" id="7140820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140824">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140836">t</span><span class="op" id="7140837">.</span><span class="ident" id="7140838">Logf</span><span class="op" id="7140842">(</span><span class="string" id="7140843">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="7140866">,</span>&nbsp;<span class="ident" id="7140868">level</span><span class="op" id="7140873">,</span>&nbsp;<span class="builtinfunc" id="7140875">len</span><span class="op" id="7140878">(</span><span class="ident" id="7140879">input</span><span class="op" id="7140884">)</span><span class="op" id="7140885">,</span>&nbsp;<span class="ident" id="7140887">name</span><span class="op" id="7140891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140894">buf</span>&nbsp;<span class="op" id="7140898">:=</span>&nbsp;<span class="ident" id="7140901">newSyncBuffer</span><span class="op" id="7140914">(</span><span class="op" id="7140915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140918">buf1</span>&nbsp;<span class="op" id="7140923">:=</span>&nbsp;<span class="builtinfunc" id="7140926">new</span><span class="op" id="7140929">(</span><span class="ident" id="7140930">bytes</span><span class="op" id="7140935">.</span><span class="ident" id="7140936">Buffer</span><span class="op" id="7140942">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140945">buf</span><span class="op" id="7140948">.</span><span class="ident" id="7140949">WriteMode</span><span class="op" id="7140958">(</span><span class="op" id="7140959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140962">w</span><span class="op" id="7140963">,</span>&nbsp;<span class="ident" id="7140965">err</span>&nbsp;<span class="op" id="7140969">:=</span>&nbsp;<span class="ident" id="7140972">NewWriter</span><span class="op" id="7140981">(</span><span class="ident" id="7140982">io</span><span class="op" id="7140984">.</span><span class="ident" id="7140985">MultiWriter</span><span class="op" id="7140996">(</span><span class="ident" id="7140997">buf</span><span class="op" id="7141000">,</span>&nbsp;<span class="ident" id="7141002">buf1</span><span class="op" id="7141006">)</span><span class="op" id="7141007">,</span>&nbsp;<span class="ident" id="7141009">level</span><span class="op" id="7141014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141017">if</span>&nbsp;<span class="ident" id="7141020">err</span>&nbsp;<span class="op" id="7141024">!=</span>&nbsp;<span class="ident" id="7141027">nil</span>&nbsp;<span class="op" id="7141031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141035">t</span><span class="op" id="7141036">.</span><span class="ident" id="7141037">Errorf</span><span class="op" id="7141043">(</span><span class="string" id="7141044">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7141059">,</span>&nbsp;<span class="ident" id="7141061">err</span><span class="op" id="7141064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141068">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141079">r</span>&nbsp;<span class="op" id="7141081">:=</span>&nbsp;<span class="ident" id="7141084">NewReader</span><span class="op" id="7141093">(</span><span class="ident" id="7141094">buf</span><span class="op" id="7141097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7141101">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141141">for</span>&nbsp;<span class="ident" id="7141145">i</span>&nbsp;<span class="op" id="7141147">:=</span>&nbsp;<span class="num" id="7141150">0</span><span class="op" id="7141151">;</span>&nbsp;<span class="ident" id="7141153">i</span>&nbsp;<span class="op" id="7141155">&lt;</span>&nbsp;<span class="num" id="7141157">2</span><span class="op" id="7141158">;</span>&nbsp;<span class="ident" id="7141160">i</span><span class="op" id="7141161">++</span>&nbsp;<span class="op" id="7141164">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141168">var</span>&nbsp;<span class="ident" id="7141172">lo</span><span class="op" id="7141174">,</span>&nbsp;<span class="ident" id="7141176">hi</span>&nbsp;<span class="builtintype" id="7141179">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141185">if</span>&nbsp;<span class="ident" id="7141188">i</span>&nbsp;<span class="op" id="7141190">==</span>&nbsp;<span class="num" id="7141193">0</span>&nbsp;<span class="op" id="7141195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141200">lo</span><span class="op" id="7141202">,</span>&nbsp;<span class="ident" id="7141204">hi</span>&nbsp;<span class="op" id="7141207">=</span>&nbsp;<span class="num" id="7141209">0</span><span class="op" id="7141210">,</span>&nbsp;<span class="op" id="7141212">(</span><span class="builtinfunc" id="7141213">len</span><span class="op" id="7141216">(</span><span class="ident" id="7141217">input</span><span class="op" id="7141222">)</span><span class="op" id="7141223">+</span><span class="num" id="7141224">1</span><span class="op" id="7141225">)</span><span class="op" id="7141226">/</span><span class="num" id="7141227">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141231">}</span>&nbsp;<span class="keyword" id="7141233">else</span>&nbsp;<span class="op" id="7141238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141243">lo</span><span class="op" id="7141245">,</span>&nbsp;<span class="ident" id="7141247">hi</span>&nbsp;<span class="op" id="7141250">=</span>&nbsp;<span class="op" id="7141252">(</span><span class="builtinfunc" id="7141253">len</span><span class="op" id="7141256">(</span><span class="ident" id="7141257">input</span><span class="op" id="7141262">)</span><span class="op" id="7141263">+</span><span class="num" id="7141264">1</span><span class="op" id="7141265">)</span><span class="op" id="7141266">/</span><span class="num" id="7141267">2</span><span class="op" id="7141268">,</span>&nbsp;<span class="builtinfunc" id="7141270">len</span><span class="op" id="7141273">(</span><span class="ident" id="7141274">input</span><span class="op" id="7141279">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141287">t</span><span class="op" id="7141288">.</span><span class="ident" id="7141289">Logf</span><span class="op" id="7141293">(</span><span class="string" id="7141294">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="7141312">,</span>&nbsp;<span class="ident" id="7141314">i</span><span class="op" id="7141315">,</span>&nbsp;<span class="ident" id="7141317">lo</span><span class="op" id="7141319">,</span>&nbsp;<span class="ident" id="7141321">hi</span><span class="op" id="7141323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141327">if</span>&nbsp;<span class="ident" id="7141330">_</span><span class="op" id="7141331">,</span>&nbsp;<span class="ident" id="7141333">err</span>&nbsp;<span class="op" id="7141337">:=</span>&nbsp;<span class="ident" id="7141340">w</span><span class="op" id="7141341">.</span><span class="ident" id="7141342">Write</span><span class="op" id="7141347">(</span><span class="ident" id="7141348">input</span><span class="op" id="7141353">[</span><span class="ident" id="7141354">lo</span><span class="op" id="7141356">:</span><span class="ident" id="7141357">hi</span><span class="op" id="7141359">]</span><span class="op" id="7141360">)</span><span class="op" id="7141361">;</span>&nbsp;<span class="ident" id="7141363">err</span>&nbsp;<span class="op" id="7141367">!=</span>&nbsp;<span class="ident" id="7141370">nil</span>&nbsp;<span class="op" id="7141374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141379">t</span><span class="op" id="7141380">.</span><span class="ident" id="7141381">Errorf</span><span class="op" id="7141387">(</span><span class="string" id="7141388">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="7141409">,</span>&nbsp;<span class="ident" id="7141411">err</span><span class="op" id="7141414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141419">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141432">if</span>&nbsp;<span class="ident" id="7141435">i</span>&nbsp;<span class="op" id="7141437">==</span>&nbsp;<span class="num" id="7141440">0</span>&nbsp;<span class="op" id="7141442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141447">if</span>&nbsp;<span class="ident" id="7141450">err</span>&nbsp;<span class="op" id="7141454">:=</span>&nbsp;<span class="ident" id="7141457">w</span><span class="op" id="7141458">.</span><span class="ident" id="7141459">Flush</span><span class="op" id="7141464">(</span><span class="op" id="7141465">)</span><span class="op" id="7141466">;</span>&nbsp;<span class="ident" id="7141468">err</span>&nbsp;<span class="op" id="7141472">!=</span>&nbsp;<span class="ident" id="7141475">nil</span>&nbsp;<span class="op" id="7141479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141485">t</span><span class="op" id="7141486">.</span><span class="ident" id="7141487">Errorf</span><span class="op" id="7141493">(</span><span class="string" id="7141494">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="7141515">,</span>&nbsp;<span class="ident" id="7141517">err</span><span class="op" id="7141520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141526">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141540">}</span>&nbsp;<span class="keyword" id="7141542">else</span>&nbsp;<span class="op" id="7141547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141552">if</span>&nbsp;<span class="ident" id="7141555">err</span>&nbsp;<span class="op" id="7141559">:=</span>&nbsp;<span class="ident" id="7141562">w</span><span class="op" id="7141563">.</span><span class="ident" id="7141564">Close</span><span class="op" id="7141569">(</span><span class="op" id="7141570">)</span><span class="op" id="7141571">;</span>&nbsp;<span class="ident" id="7141573">err</span>&nbsp;<span class="op" id="7141577">!=</span>&nbsp;<span class="ident" id="7141580">nil</span>&nbsp;<span class="op" id="7141584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141590">t</span><span class="op" id="7141591">.</span><span class="ident" id="7141592">Errorf</span><span class="op" id="7141598">(</span><span class="string" id="7141599">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="7141620">,</span>&nbsp;<span class="ident" id="7141622">err</span><span class="op" id="7141625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141630">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141638">buf</span><span class="op" id="7141641">.</span><span class="ident" id="7141642">ReadMode</span><span class="op" id="7141650">(</span><span class="op" id="7141651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141655">out</span>&nbsp;<span class="op" id="7141659">:=</span>&nbsp;<span class="builtinfunc" id="7141662">make</span><span class="op" id="7141666">(</span><span class="op" id="7141667">[</span><span class="op" id="7141668">]</span><span class="builtintype" id="7141669">byte</span><span class="op" id="7141673">,</span>&nbsp;<span class="ident" id="7141675">hi</span><span class="op" id="7141677">-</span><span class="ident" id="7141678">lo</span><span class="op" id="7141680">+</span><span class="num" id="7141681">1</span><span class="op" id="7141682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141686">m</span><span class="op" id="7141687">,</span>&nbsp;<span class="ident" id="7141689">err</span>&nbsp;<span class="op" id="7141693">:=</span>&nbsp;<span class="ident" id="7141696">io</span><span class="op" id="7141698">.</span><span class="ident" id="7141699">ReadAtLeast</span><span class="op" id="7141710">(</span><span class="ident" id="7141711">r</span><span class="op" id="7141712">,</span>&nbsp;<span class="ident" id="7141714">out</span><span class="op" id="7141717">,</span>&nbsp;<span class="ident" id="7141719">hi</span><span class="op" id="7141721">-</span><span class="ident" id="7141722">lo</span><span class="op" id="7141724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141728">t</span><span class="op" id="7141729">.</span><span class="ident" id="7141730">Logf</span><span class="op" id="7141734">(</span><span class="string" id="7141735">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7141749">,</span>&nbsp;<span class="ident" id="7141751">i</span><span class="op" id="7141752">,</span>&nbsp;<span class="ident" id="7141754">m</span><span class="op" id="7141755">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141759">if</span>&nbsp;<span class="ident" id="7141762">m</span>&nbsp;<span class="op" id="7141764">!=</span>&nbsp;<span class="ident" id="7141767">hi</span><span class="op" id="7141769">-</span><span class="ident" id="7141770">lo</span>&nbsp;<span class="op" id="7141773">||</span>&nbsp;<span class="ident" id="7141776">err</span>&nbsp;<span class="op" id="7141780">!=</span>&nbsp;<span class="ident" id="7141783">nil</span>&nbsp;<span class="op" id="7141787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141792">t</span><span class="op" id="7141793">.</span><span class="ident" id="7141794">Errorf</span><span class="op" id="7141800">(</span><span class="string" id="7141801">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="7141854">,</span>&nbsp;<span class="ident" id="7141856">i</span><span class="op" id="7141857">,</span>&nbsp;<span class="ident" id="7141859">level</span><span class="op" id="7141864">,</span>&nbsp;<span class="builtinfunc" id="7141866">len</span><span class="op" id="7141869">(</span><span class="ident" id="7141870">input</span><span class="op" id="7141875">)</span><span class="op" id="7141876">,</span>&nbsp;<span class="ident" id="7141878">name</span><span class="op" id="7141882">,</span>&nbsp;<span class="ident" id="7141884">hi</span><span class="op" id="7141886">-</span><span class="ident" id="7141887">lo</span><span class="op" id="7141889">,</span>&nbsp;<span class="ident" id="7141891">m</span><span class="op" id="7141892">,</span>&nbsp;<span class="ident" id="7141894">err</span><span class="op" id="7141897">,</span>&nbsp;<span class="ident" id="7141899">buf</span><span class="op" id="7141902">.</span><span class="ident" id="7141903">buf</span><span class="op" id="7141906">.</span><span class="ident" id="7141907">Len</span><span class="op" id="7141910">(</span><span class="op" id="7141911">)</span><span class="op" id="7141912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141930">if</span>&nbsp;<span class="op" id="7141933">!</span><span class="ident" id="7141934">bytes</span><span class="op" id="7141939">.</span><span class="ident" id="7141940">Equal</span><span class="op" id="7141945">(</span><span class="ident" id="7141946">input</span><span class="op" id="7141951">[</span><span class="ident" id="7141952">lo</span><span class="op" id="7141954">:</span><span class="ident" id="7141955">hi</span><span class="op" id="7141957">]</span><span class="op" id="7141958">,</span>&nbsp;<span class="ident" id="7141960">out</span><span class="op" id="7141963">[</span><span class="op" id="7141964">:</span><span class="ident" id="7141965">hi</span><span class="op" id="7141967">-</span><span class="ident" id="7141968">lo</span><span class="op" id="7141970">]</span><span class="op" id="7141971">)</span>&nbsp;<span class="op" id="7141973">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141978">t</span><span class="op" id="7141979">.</span><span class="ident" id="7141980">Errorf</span><span class="op" id="7141986">(</span><span class="string" id="7141987">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="7142028">,</span>&nbsp;<span class="ident" id="7142030">i</span><span class="op" id="7142031">,</span>&nbsp;<span class="ident" id="7142033">input</span><span class="op" id="7142038">[</span><span class="ident" id="7142039">lo</span><span class="op" id="7142041">:</span><span class="ident" id="7142042">hi</span><span class="op" id="7142044">]</span><span class="op" id="7142045">,</span>&nbsp;<span class="ident" id="7142047">out</span><span class="op" id="7142050">[</span><span class="op" id="7142051">:</span><span class="ident" id="7142052">hi</span><span class="op" id="7142054">-</span><span class="ident" id="7142055">lo</span><span class="op" id="7142057">]</span><span class="op" id="7142058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142063">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142076">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142129">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142186">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142243">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142299">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142351">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142412">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142473">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142525">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142586">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142598">buf</span><span class="op" id="7142601">.</span><span class="ident" id="7142602">WriteMode</span><span class="op" id="7142611">(</span><span class="op" id="7142612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142615">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142618">buf</span><span class="op" id="7142621">.</span><span class="ident" id="7142622">ReadMode</span><span class="op" id="7142630">(</span><span class="op" id="7142631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142634">out</span>&nbsp;<span class="op" id="7142638">:=</span>&nbsp;<span class="builtinfunc" id="7142641">make</span><span class="op" id="7142645">(</span><span class="op" id="7142646">[</span><span class="op" id="7142647">]</span><span class="builtintype" id="7142648">byte</span><span class="op" id="7142652">,</span>&nbsp;<span class="num" id="7142654">10</span><span class="op" id="7142656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142659">if</span>&nbsp;<span class="ident" id="7142662">n</span><span class="op" id="7142663">,</span>&nbsp;<span class="ident" id="7142665">err</span>&nbsp;<span class="op" id="7142669">:=</span>&nbsp;<span class="ident" id="7142672">r</span><span class="op" id="7142673">.</span><span class="ident" id="7142674">Read</span><span class="op" id="7142678">(</span><span class="ident" id="7142679">out</span><span class="op" id="7142682">)</span><span class="op" id="7142683">;</span>&nbsp;<span class="ident" id="7142685">n</span>&nbsp;<span class="op" id="7142687">&gt;</span>&nbsp;<span class="num" id="7142689">0</span>&nbsp;<span class="op" id="7142691">||</span>&nbsp;<span class="ident" id="7142694">err</span>&nbsp;<span class="op" id="7142698">!=</span>&nbsp;<span class="ident" id="7142701">io</span><span class="op" id="7142703">.</span><span class="ident" id="7142704">EOF</span>&nbsp;<span class="op" id="7142708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142712">t</span><span class="op" id="7142713">.</span><span class="ident" id="7142714">Errorf</span><span class="op" id="7142720">(</span><span class="string" id="7142721">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="7142774">,</span>&nbsp;<span class="ident" id="7142776">level</span><span class="op" id="7142781">,</span>&nbsp;<span class="builtinfunc" id="7142783">len</span><span class="op" id="7142786">(</span><span class="ident" id="7142787">input</span><span class="op" id="7142792">)</span><span class="op" id="7142793">,</span>&nbsp;<span class="ident" id="7142795">name</span><span class="op" id="7142799">,</span>&nbsp;<span class="ident" id="7142801">n</span><span class="op" id="7142802">,</span>&nbsp;<span class="ident" id="7142804">err</span><span class="op" id="7142807">,</span>&nbsp;<span class="ident" id="7142809">out</span><span class="op" id="7142812">[</span><span class="num" id="7142813">0</span><span class="op" id="7142814">:</span><span class="ident" id="7142815">n</span><span class="op" id="7142816">]</span><span class="op" id="7142817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142820">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142823">if</span>&nbsp;<span class="ident" id="7142826">buf</span><span class="op" id="7142829">.</span><span class="ident" id="7142830">buf</span><span class="op" id="7142833">.</span><span class="ident" id="7142834">Len</span><span class="op" id="7142837">(</span><span class="op" id="7142838">)</span>&nbsp;<span class="op" id="7142840">!=</span>&nbsp;<span class="num" id="7142843">0</span>&nbsp;<span class="op" id="7142845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142849">t</span><span class="op" id="7142850">.</span><span class="ident" id="7142851">Errorf</span><span class="op" id="7142857">(</span><span class="string" id="7142858">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="7142900">,</span>&nbsp;<span class="ident" id="7142902">level</span><span class="op" id="7142907">,</span>&nbsp;<span class="builtinfunc" id="7142909">len</span><span class="op" id="7142912">(</span><span class="ident" id="7142913">input</span><span class="op" id="7142918">)</span><span class="op" id="7142919">,</span>&nbsp;<span class="ident" id="7142921">name</span><span class="op" id="7142925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142931">r</span><span class="op" id="7142932">.</span><span class="ident" id="7142933">Close</span><span class="op" id="7142938">(</span><span class="op" id="7142939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142943">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142990">r</span>&nbsp;<span class="op" id="7142992">=</span>&nbsp;<span class="ident" id="7142994">NewReader</span><span class="op" id="7143003">(</span><span class="ident" id="7143004">buf1</span><span class="op" id="7143008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143011">out</span><span class="op" id="7143014">,</span>&nbsp;<span class="ident" id="7143016">err</span>&nbsp;<span class="op" id="7143020">=</span>&nbsp;<span class="ident" id="7143022">ioutil</span><span class="op" id="7143028">.</span><span class="ident" id="7143029">ReadAll</span><span class="op" id="7143036">(</span><span class="ident" id="7143037">r</span><span class="op" id="7143038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143041">if</span>&nbsp;<span class="ident" id="7143044">err</span>&nbsp;<span class="op" id="7143048">!=</span>&nbsp;<span class="ident" id="7143051">nil</span>&nbsp;<span class="op" id="7143055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143059">t</span><span class="op" id="7143060">.</span><span class="ident" id="7143061">Errorf</span><span class="op" id="7143067">(</span><span class="string" id="7143068">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="7143088">,</span>&nbsp;<span class="ident" id="7143090">err</span><span class="op" id="7143093">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143108">r</span><span class="op" id="7143109">.</span><span class="ident" id="7143110">Close</span><span class="op" id="7143115">(</span><span class="op" id="7143116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143119">if</span>&nbsp;<span class="op" id="7143122">!</span><span class="ident" id="7143123">bytes</span><span class="op" id="7143128">.</span><span class="ident" id="7143129">Equal</span><span class="op" id="7143134">(</span><span class="ident" id="7143135">input</span><span class="op" id="7143140">,</span>&nbsp;<span class="ident" id="7143142">out</span><span class="op" id="7143145">)</span>&nbsp;<span class="op" id="7143147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143151">t</span><span class="op" id="7143152">.</span><span class="ident" id="7143153">Errorf</span><span class="op" id="7143159">(</span><span class="string" id="7143160">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7143225">,</span>&nbsp;<span class="ident" id="7143227">level</span><span class="op" id="7143232">,</span>&nbsp;<span class="ident" id="7143234">name</span><span class="op" id="7143238">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143241">}</span><br>
<span class="lineno"></span><span class="op" id="7143243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7143246">func</span>&nbsp;<span class="ident" id="7143251">testToFromWithLevelAndLimit</span><span class="op" id="7143278">(</span><span class="ident" id="7143279">t</span>&nbsp;<span class="op" id="7143281">*</span><span class="ident" id="7143282">testing</span><span class="op" id="7143289">.</span><span class="ident" id="7143290">T</span><span class="op" id="7143291">,</span>&nbsp;<span class="ident" id="7143293">level</span>&nbsp;<span class="builtintype" id="7143299">int</span><span class="op" id="7143302">,</span>&nbsp;<span class="ident" id="7143304">input</span>&nbsp;<span class="op" id="7143310">[</span><span class="op" id="7143311">]</span><span class="builtintype" id="7143312">byte</span><span class="op" id="7143316">,</span>&nbsp;<span class="ident" id="7143318">name</span>&nbsp;<span class="builtintype" id="7143323">string</span><span class="op" id="7143329">,</span>&nbsp;<span class="ident" id="7143331">limit</span>&nbsp;<span class="builtintype" id="7143337">int</span><span class="op" id="7143340">)</span>&nbsp;<span class="op" id="7143342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143345">var</span>&nbsp;<span class="ident" id="7143349">buffer</span>&nbsp;<span class="ident" id="7143356">bytes</span><span class="op" id="7143361">.</span><span class="ident" id="7143362">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143370">w</span><span class="op" id="7143371">,</span>&nbsp;<span class="ident" id="7143373">err</span>&nbsp;<span class="op" id="7143377">:=</span>&nbsp;<span class="ident" id="7143380">NewWriter</span><span class="op" id="7143389">(</span><span class="op" id="7143390">&amp;</span><span class="ident" id="7143391">buffer</span><span class="op" id="7143397">,</span>&nbsp;<span class="ident" id="7143399">level</span><span class="op" id="7143404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143407">if</span>&nbsp;<span class="ident" id="7143410">err</span>&nbsp;<span class="op" id="7143414">!=</span>&nbsp;<span class="ident" id="7143417">nil</span>&nbsp;<span class="op" id="7143421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143425">t</span><span class="op" id="7143426">.</span><span class="ident" id="7143427">Errorf</span><span class="op" id="7143433">(</span><span class="string" id="7143434">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7143449">,</span>&nbsp;<span class="ident" id="7143451">err</span><span class="op" id="7143454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143466">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143469">w</span><span class="op" id="7143470">.</span><span class="ident" id="7143471">Write</span><span class="op" id="7143476">(</span><span class="ident" id="7143477">input</span><span class="op" id="7143482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143485">w</span><span class="op" id="7143486">.</span><span class="ident" id="7143487">Close</span><span class="op" id="7143492">(</span><span class="op" id="7143493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143496">if</span>&nbsp;<span class="ident" id="7143499">limit</span>&nbsp;<span class="op" id="7143505">&gt;</span>&nbsp;<span class="num" id="7143507">0</span>&nbsp;<span class="op" id="7143509">&amp;&amp;</span>&nbsp;<span class="ident" id="7143512">buffer</span><span class="op" id="7143518">.</span><span class="ident" id="7143519">Len</span><span class="op" id="7143522">(</span><span class="op" id="7143523">)</span>&nbsp;<span class="op" id="7143525">&gt;</span>&nbsp;<span class="ident" id="7143527">limit</span>&nbsp;<span class="op" id="7143533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143537">t</span><span class="op" id="7143538">.</span><span class="ident" id="7143539">Errorf</span><span class="op" id="7143545">(</span><span class="string" id="7143546">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7143596">,</span>&nbsp;<span class="ident" id="7143598">level</span><span class="op" id="7143603">,</span>&nbsp;<span class="ident" id="7143605">buffer</span><span class="op" id="7143611">.</span><span class="ident" id="7143612">Len</span><span class="op" id="7143615">(</span><span class="op" id="7143616">)</span><span class="op" id="7143617">,</span>&nbsp;<span class="ident" id="7143619">limit</span><span class="op" id="7143624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143628">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143639">r</span>&nbsp;<span class="op" id="7143641">:=</span>&nbsp;<span class="ident" id="7143644">NewReader</span><span class="op" id="7143653">(</span><span class="op" id="7143654">&amp;</span><span class="ident" id="7143655">buffer</span><span class="op" id="7143661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143664">out</span><span class="op" id="7143667">,</span>&nbsp;<span class="ident" id="7143669">err</span>&nbsp;<span class="op" id="7143673">:=</span>&nbsp;<span class="ident" id="7143676">ioutil</span><span class="op" id="7143682">.</span><span class="ident" id="7143683">ReadAll</span><span class="op" id="7143690">(</span><span class="ident" id="7143691">r</span><span class="op" id="7143692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143695">if</span>&nbsp;<span class="ident" id="7143698">err</span>&nbsp;<span class="op" id="7143702">!=</span>&nbsp;<span class="ident" id="7143705">nil</span>&nbsp;<span class="op" id="7143709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143713">t</span><span class="op" id="7143714">.</span><span class="ident" id="7143715">Errorf</span><span class="op" id="7143721">(</span><span class="string" id="7143722">&#34;read:&nbsp;%s&#34;</span><span class="op" id="7143732">,</span>&nbsp;<span class="ident" id="7143734">err</span><span class="op" id="7143737">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143741">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143752">r</span><span class="op" id="7143753">.</span><span class="ident" id="7143754">Close</span><span class="op" id="7143759">(</span><span class="op" id="7143760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143763">if</span>&nbsp;<span class="op" id="7143766">!</span><span class="ident" id="7143767">bytes</span><span class="op" id="7143772">.</span><span class="ident" id="7143773">Equal</span><span class="op" id="7143778">(</span><span class="ident" id="7143779">input</span><span class="op" id="7143784">,</span>&nbsp;<span class="ident" id="7143786">out</span><span class="op" id="7143789">)</span>&nbsp;<span class="op" id="7143791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143795">t</span><span class="op" id="7143796">.</span><span class="ident" id="7143797">Errorf</span><span class="op" id="7143803">(</span><span class="string" id="7143804">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7143859">,</span>&nbsp;<span class="ident" id="7143861">level</span><span class="op" id="7143866">,</span>&nbsp;<span class="ident" id="7143868">name</span><span class="op" id="7143872">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143887">testSync</span><span class="op" id="7143895">(</span><span class="ident" id="7143896">t</span><span class="op" id="7143897">,</span>&nbsp;<span class="ident" id="7143899">level</span><span class="op" id="7143904">,</span>&nbsp;<span class="ident" id="7143906">input</span><span class="op" id="7143911">,</span>&nbsp;<span class="ident" id="7143913">name</span><span class="op" id="7143917">)</span><br>
<span class="lineno"></span><span class="op" id="7143919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="7143922">func</span>&nbsp;<span class="ident" id="7143927">testToFromWithLimit</span><span class="op" id="7143946">(</span><span class="ident" id="7143947">t</span>&nbsp;<span class="op" id="7143949">*</span><span class="ident" id="7143950">testing</span><span class="op" id="7143957">.</span><span class="ident" id="7143958">T</span><span class="op" id="7143959">,</span>&nbsp;<span class="ident" id="7143961">input</span>&nbsp;<span class="op" id="7143967">[</span><span class="op" id="7143968">]</span><span class="builtintype" id="7143969">byte</span><span class="op" id="7143973">,</span>&nbsp;<span class="ident" id="7143975">name</span>&nbsp;<span class="builtintype" id="7143980">string</span><span class="op" id="7143986">,</span>&nbsp;<span class="ident" id="7143988">limit</span>&nbsp;<span class="op" id="7143994">[</span><span class="num" id="7143995">10</span><span class="op" id="7143997">]</span><span class="builtintype" id="7143998">int</span><span class="op" id="7144001">)</span>&nbsp;<span class="op" id="7144003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144006">for</span>&nbsp;<span class="ident" id="7144010">i</span>&nbsp;<span class="op" id="7144012">:=</span>&nbsp;<span class="num" id="7144015">0</span><span class="op" id="7144016">;</span>&nbsp;<span class="ident" id="7144018">i</span>&nbsp;<span class="op" id="7144020">&lt;</span>&nbsp;<span class="num" id="7144022">10</span><span class="op" id="7144024">;</span>&nbsp;<span class="ident" id="7144026">i</span><span class="op" id="7144027">++</span>&nbsp;<span class="op" id="7144030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144034">testToFromWithLevelAndLimit</span><span class="op" id="7144061">(</span><span class="ident" id="7144062">t</span><span class="op" id="7144063">,</span>&nbsp;<span class="ident" id="7144065">i</span><span class="op" id="7144066">,</span>&nbsp;<span class="ident" id="7144068">input</span><span class="op" id="7144073">,</span>&nbsp;<span class="ident" id="7144075">name</span><span class="op" id="7144079">,</span>&nbsp;<span class="ident" id="7144081">limit</span><span class="op" id="7144086">[</span><span class="ident" id="7144087">i</span><span class="op" id="7144088">]</span><span class="op" id="7144089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144092">}</span><br>
<span class="lineno"></span><span class="op" id="7144094">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7144097">func</span>&nbsp;<span class="ident" id="7144102">TestDeflateInflate</span><span class="op" id="7144120">(</span><span class="ident" id="7144121">t</span>&nbsp;<span class="op" id="7144123">*</span><span class="ident" id="7144124">testing</span><span class="op" id="7144131">.</span><span class="ident" id="7144132">T</span><span class="op" id="7144133">)</span>&nbsp;<span class="op" id="7144135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144138">for</span>&nbsp;<span class="ident" id="7144142">i</span><span class="op" id="7144143">,</span>&nbsp;<span class="ident" id="7144145">h</span>&nbsp;<span class="op" id="7144147">:=</span>&nbsp;<span class="keyword" id="7144150">range</span>&nbsp;<span class="ident" id="7144156">deflateInflateTests</span>&nbsp;<span class="op" id="7144176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144180">testToFromWithLimit</span><span class="op" id="7144199">(</span><span class="ident" id="7144200">t</span><span class="op" id="7144201">,</span>&nbsp;<span class="ident" id="7144203">h</span><span class="op" id="7144204">.</span><span class="ident" id="7144205">in</span><span class="op" id="7144207">,</span>&nbsp;<span class="ident" id="7144209">fmt</span><span class="op" id="7144212">.</span><span class="ident" id="7144213">Sprintf</span><span class="op" id="7144220">(</span><span class="string" id="7144221">&#34;#%d&#34;</span><span class="op" id="7144226">,</span>&nbsp;<span class="ident" id="7144228">i</span><span class="op" id="7144229">)</span><span class="op" id="7144230">,</span>&nbsp;<span class="op" id="7144232">[</span><span class="num" id="7144233">10</span><span class="op" id="7144235">]</span><span class="builtintype" id="7144236">int</span><span class="op" id="7144239">{</span><span class="op" id="7144240">}</span><span class="op" id="7144241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144244">}</span><br>
<span class="lineno">315</span><span class="op" id="7144246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7144249">func</span>&nbsp;<span class="ident" id="7144254">TestReverseBits</span><span class="op" id="7144269">(</span><span class="ident" id="7144270">t</span>&nbsp;<span class="op" id="7144272">*</span><span class="ident" id="7144273">testing</span><span class="op" id="7144280">.</span><span class="ident" id="7144281">T</span><span class="op" id="7144282">)</span>&nbsp;<span class="op" id="7144284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144287">for</span>&nbsp;<span class="ident" id="7144291">_</span><span class="op" id="7144292">,</span>&nbsp;<span class="ident" id="7144294">h</span>&nbsp;<span class="op" id="7144296">:=</span>&nbsp;<span class="keyword" id="7144299">range</span>&nbsp;<span class="ident" id="7144305">reverseBitsTests</span>&nbsp;<span class="op" id="7144322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144326">if</span>&nbsp;<span class="ident" id="7144329">v</span>&nbsp;<span class="op" id="7144331">:=</span>&nbsp;<span class="ident" id="7144334">reverseBits</span><span class="op" id="7144345">(</span><span class="ident" id="7144346">h</span><span class="op" id="7144347">.</span><span class="ident" id="7144348">in</span><span class="op" id="7144350">,</span>&nbsp;<span class="ident" id="7144352">h</span><span class="op" id="7144353">.</span><span class="ident" id="7144354">bitCount</span><span class="op" id="7144362">)</span><span class="op" id="7144363">;</span>&nbsp;<span class="ident" id="7144365">v</span>&nbsp;<span class="op" id="7144367">!=</span>&nbsp;<span class="ident" id="7144370">h</span><span class="op" id="7144371">.</span><span class="ident" id="7144372">out</span>&nbsp;<span class="op" id="7144376">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144381">t</span><span class="op" id="7144382">.</span><span class="ident" id="7144383">Errorf</span><span class="op" id="7144389">(</span><span class="string" id="7144390">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7144424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144430">h</span><span class="op" id="7144431">.</span><span class="ident" id="7144432">in</span><span class="op" id="7144434">,</span>&nbsp;<span class="ident" id="7144436">h</span><span class="op" id="7144437">.</span><span class="ident" id="7144438">bitCount</span><span class="op" id="7144446">,</span>&nbsp;<span class="ident" id="7144448">v</span><span class="op" id="7144449">,</span>&nbsp;<span class="ident" id="7144451">h</span><span class="op" id="7144452">.</span><span class="ident" id="7144453">out</span><span class="op" id="7144456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144463">}</span><br>
<span class="lineno"></span><span class="op" id="7144465">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7144468">type</span>&nbsp;<span class="ident" id="7144473">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="7144498">struct</span>&nbsp;<span class="op" id="7144505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144508">filename</span>&nbsp;<span class="builtintype" id="7144517">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144525">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7144534">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144542">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7144551">[</span><span class="num" id="7144552">10</span><span class="op" id="7144554">]</span><span class="builtintype" id="7144555">int</span><br>
<span class="lineno">330</span><span class="op" id="7144559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7144562">var</span>&nbsp;<span class="ident" id="7144566">deflateInflateStringTests</span>&nbsp;<span class="op" id="7144592">=</span>&nbsp;<span class="op" id="7144594">[</span><span class="op" id="7144595">]</span><span class="ident" id="7144596">deflateInflateStringTest</span><span class="op" id="7144620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7144627">&#34;../testdata/e.txt&#34;</span><span class="op" id="7144646">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7144650">&#34;2.718281828...&#34;</span><span class="op" id="7144666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144670">[</span><span class="op" id="7144671">...</span><span class="op" id="7144674">]</span><span class="builtintype" id="7144675">int</span><span class="op" id="7144678">{</span><span class="num" id="7144679">100018</span><span class="op" id="7144685">,</span>&nbsp;<span class="num" id="7144687">50650</span><span class="op" id="7144692">,</span>&nbsp;<span class="num" id="7144694">50960</span><span class="op" id="7144699">,</span>&nbsp;<span class="num" id="7144701">51150</span><span class="op" id="7144706">,</span>&nbsp;<span class="num" id="7144708">50930</span><span class="op" id="7144713">,</span>&nbsp;<span class="num" id="7144715">50790</span><span class="op" id="7144720">,</span>&nbsp;<span class="num" id="7144722">50790</span><span class="op" id="7144727">,</span>&nbsp;<span class="num" id="7144729">50790</span><span class="op" id="7144734">,</span>&nbsp;<span class="num" id="7144736">50790</span><span class="op" id="7144741">,</span>&nbsp;<span class="num" id="7144743">50790</span><span class="op" id="7144748">}</span><span class="op" id="7144749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144752">}</span><span class="op" id="7144753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7144760">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="7144799">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7144803">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="7144826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144830">[</span><span class="op" id="7144831">...</span><span class="op" id="7144834">]</span><span class="builtintype" id="7144835">int</span><span class="op" id="7144838">{</span><span class="num" id="7144839">407330</span><span class="op" id="7144845">,</span>&nbsp;<span class="num" id="7144847">187598</span><span class="op" id="7144853">,</span>&nbsp;<span class="num" id="7144855">180361</span><span class="op" id="7144861">,</span>&nbsp;<span class="num" id="7144863">172974</span><span class="op" id="7144869">,</span>&nbsp;<span class="num" id="7144871">169160</span><span class="op" id="7144877">,</span>&nbsp;<span class="num" id="7144879">163476</span><span class="op" id="7144885">,</span>&nbsp;<span class="num" id="7144887">160936</span><span class="op" id="7144893">,</span>&nbsp;<span class="num" id="7144895">160506</span><span class="op" id="7144901">,</span>&nbsp;<span class="num" id="7144903">160295</span><span class="op" id="7144909">,</span>&nbsp;<span class="num" id="7144911">160295</span><span class="op" id="7144917">}</span><span class="op" id="7144918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144921">}</span><span class="op" id="7144922">,</span><br>
<span class="lineno"></span><span class="op" id="7144924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="7144927">func</span>&nbsp;<span class="ident" id="7144932">TestDeflateInflateString</span><span class="op" id="7144956">(</span><span class="ident" id="7144957">t</span>&nbsp;<span class="op" id="7144959">*</span><span class="ident" id="7144960">testing</span><span class="op" id="7144967">.</span><span class="ident" id="7144968">T</span><span class="op" id="7144969">)</span>&nbsp;<span class="op" id="7144971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144974">for</span>&nbsp;<span class="ident" id="7144978">_</span><span class="op" id="7144979">,</span>&nbsp;<span class="ident" id="7144981">test</span>&nbsp;<span class="op" id="7144986">:=</span>&nbsp;<span class="keyword" id="7144989">range</span>&nbsp;<span class="ident" id="7144995">deflateInflateStringTests</span>&nbsp;<span class="op" id="7145021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145025">gold</span><span class="op" id="7145029">,</span>&nbsp;<span class="ident" id="7145031">err</span>&nbsp;<span class="op" id="7145035">:=</span>&nbsp;<span class="ident" id="7145038">ioutil</span><span class="op" id="7145044">.</span><span class="ident" id="7145045">ReadFile</span><span class="op" id="7145053">(</span><span class="ident" id="7145054">test</span><span class="op" id="7145058">.</span><span class="ident" id="7145059">filename</span><span class="op" id="7145067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145071">if</span>&nbsp;<span class="ident" id="7145074">err</span>&nbsp;<span class="op" id="7145078">!=</span>&nbsp;<span class="ident" id="7145081">nil</span>&nbsp;<span class="op" id="7145085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145090">t</span><span class="op" id="7145091">.</span><span class="ident" id="7145092">Error</span><span class="op" id="7145097">(</span><span class="ident" id="7145098">err</span><span class="op" id="7145101">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145109">testToFromWithLimit</span><span class="op" id="7145128">(</span><span class="ident" id="7145129">t</span><span class="op" id="7145130">,</span>&nbsp;<span class="ident" id="7145132">gold</span><span class="op" id="7145136">,</span>&nbsp;<span class="ident" id="7145138">test</span><span class="op" id="7145142">.</span><span class="ident" id="7145143">label</span><span class="op" id="7145148">,</span>&nbsp;<span class="ident" id="7145150">test</span><span class="op" id="7145154">.</span><span class="ident" id="7145155">limit</span><span class="op" id="7145160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145164">if</span>&nbsp;<span class="ident" id="7145167">testing</span><span class="op" id="7145174">.</span><span class="ident" id="7145175">Short</span><span class="op" id="7145180">(</span><span class="op" id="7145181">)</span>&nbsp;<span class="op" id="7145183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145188">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145196">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145199">}</span><br>
<span class="lineno"></span><span class="op" id="7145201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7145204">func</span>&nbsp;<span class="ident" id="7145209">TestReaderDict</span><span class="op" id="7145223">(</span><span class="ident" id="7145224">t</span>&nbsp;<span class="op" id="7145226">*</span><span class="ident" id="7145227">testing</span><span class="op" id="7145234">.</span><span class="ident" id="7145235">T</span><span class="op" id="7145236">)</span>&nbsp;<span class="op" id="7145238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145241">const</span>&nbsp;<span class="op" id="7145247">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145251">dict</span>&nbsp;<span class="op" id="7145256">=</span>&nbsp;<span class="string" id="7145258">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145274">text</span>&nbsp;<span class="op" id="7145279">=</span>&nbsp;<span class="string" id="7145281">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145305">var</span>&nbsp;<span class="ident" id="7145309">b</span>&nbsp;<span class="ident" id="7145311">bytes</span><span class="op" id="7145316">.</span><span class="ident" id="7145317">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145325">w</span><span class="op" id="7145326">,</span>&nbsp;<span class="ident" id="7145328">err</span>&nbsp;<span class="op" id="7145332">:=</span>&nbsp;<span class="ident" id="7145335">NewWriter</span><span class="op" id="7145344">(</span><span class="op" id="7145345">&amp;</span><span class="ident" id="7145346">b</span><span class="op" id="7145347">,</span>&nbsp;<span class="num" id="7145349">5</span><span class="op" id="7145350">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145353">if</span>&nbsp;<span class="ident" id="7145356">err</span>&nbsp;<span class="op" id="7145360">!=</span>&nbsp;<span class="ident" id="7145363">nil</span>&nbsp;<span class="op" id="7145367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145371">t</span><span class="op" id="7145372">.</span><span class="ident" id="7145373">Fatalf</span><span class="op" id="7145379">(</span><span class="string" id="7145380">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7145395">,</span>&nbsp;<span class="ident" id="7145397">err</span><span class="op" id="7145400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145406">w</span><span class="op" id="7145407">.</span><span class="ident" id="7145408">Write</span><span class="op" id="7145413">(</span><span class="op" id="7145414">[</span><span class="op" id="7145415">]</span><span class="builtintype" id="7145416">byte</span><span class="op" id="7145420">(</span><span class="ident" id="7145421">dict</span><span class="op" id="7145425">)</span><span class="op" id="7145426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145429">w</span><span class="op" id="7145430">.</span><span class="ident" id="7145431">Flush</span><span class="op" id="7145436">(</span><span class="op" id="7145437">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145440">b</span><span class="op" id="7145441">.</span><span class="ident" id="7145442">Reset</span><span class="op" id="7145447">(</span><span class="op" id="7145448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145451">w</span><span class="op" id="7145452">.</span><span class="ident" id="7145453">Write</span><span class="op" id="7145458">(</span><span class="op" id="7145459">[</span><span class="op" id="7145460">]</span><span class="builtintype" id="7145461">byte</span><span class="op" id="7145465">(</span><span class="ident" id="7145466">text</span><span class="op" id="7145470">)</span><span class="op" id="7145471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145474">w</span><span class="op" id="7145475">.</span><span class="ident" id="7145476">Close</span><span class="op" id="7145481">(</span><span class="op" id="7145482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145486">r</span>&nbsp;<span class="op" id="7145488">:=</span>&nbsp;<span class="ident" id="7145491">NewReaderDict</span><span class="op" id="7145504">(</span><span class="op" id="7145505">&amp;</span><span class="ident" id="7145506">b</span><span class="op" id="7145507">,</span>&nbsp;<span class="op" id="7145509">[</span><span class="op" id="7145510">]</span><span class="builtintype" id="7145511">byte</span><span class="op" id="7145515">(</span><span class="ident" id="7145516">dict</span><span class="op" id="7145520">)</span><span class="op" id="7145521">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145524">data</span><span class="op" id="7145528">,</span>&nbsp;<span class="ident" id="7145530">err</span>&nbsp;<span class="op" id="7145534">:=</span>&nbsp;<span class="ident" id="7145537">ioutil</span><span class="op" id="7145543">.</span><span class="ident" id="7145544">ReadAll</span><span class="op" id="7145551">(</span><span class="ident" id="7145552">r</span><span class="op" id="7145553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145556">if</span>&nbsp;<span class="ident" id="7145559">err</span>&nbsp;<span class="op" id="7145563">!=</span>&nbsp;<span class="ident" id="7145566">nil</span>&nbsp;<span class="op" id="7145570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145574">t</span><span class="op" id="7145575">.</span><span class="ident" id="7145576">Fatal</span><span class="op" id="7145581">(</span><span class="ident" id="7145582">err</span><span class="op" id="7145585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145591">if</span>&nbsp;<span class="builtintype" id="7145594">string</span><span class="op" id="7145600">(</span><span class="ident" id="7145601">data</span><span class="op" id="7145605">)</span>&nbsp;<span class="op" id="7145607">!=</span>&nbsp;<span class="string" id="7145610">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="7145630">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145634">t</span><span class="op" id="7145635">.</span><span class="ident" id="7145636">Fatalf</span><span class="op" id="7145642">(</span><span class="string" id="7145643">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7145669">,</span>&nbsp;<span class="builtintype" id="7145671">string</span><span class="op" id="7145677">(</span><span class="ident" id="7145678">data</span><span class="op" id="7145682">)</span><span class="op" id="7145683">,</span>&nbsp;<span class="ident" id="7145685">text</span><span class="op" id="7145689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145692">}</span><br>
<span class="lineno"></span><span class="op" id="7145694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7145697">func</span>&nbsp;<span class="ident" id="7145702">TestWriterDict</span><span class="op" id="7145716">(</span><span class="ident" id="7145717">t</span>&nbsp;<span class="op" id="7145719">*</span><span class="ident" id="7145720">testing</span><span class="op" id="7145727">.</span><span class="ident" id="7145728">T</span><span class="op" id="7145729">)</span>&nbsp;<span class="op" id="7145731">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145734">const</span>&nbsp;<span class="op" id="7145740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145744">dict</span>&nbsp;<span class="op" id="7145749">=</span>&nbsp;<span class="string" id="7145751">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145767">text</span>&nbsp;<span class="op" id="7145772">=</span>&nbsp;<span class="string" id="7145774">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145798">var</span>&nbsp;<span class="ident" id="7145802">b</span>&nbsp;<span class="ident" id="7145804">bytes</span><span class="op" id="7145809">.</span><span class="ident" id="7145810">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145818">w</span><span class="op" id="7145819">,</span>&nbsp;<span class="ident" id="7145821">err</span>&nbsp;<span class="op" id="7145825">:=</span>&nbsp;<span class="ident" id="7145828">NewWriter</span><span class="op" id="7145837">(</span><span class="op" id="7145838">&amp;</span><span class="ident" id="7145839">b</span><span class="op" id="7145840">,</span>&nbsp;<span class="num" id="7145842">5</span><span class="op" id="7145843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145846">if</span>&nbsp;<span class="ident" id="7145849">err</span>&nbsp;<span class="op" id="7145853">!=</span>&nbsp;<span class="ident" id="7145856">nil</span>&nbsp;<span class="op" id="7145860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145864">t</span><span class="op" id="7145865">.</span><span class="ident" id="7145866">Fatalf</span><span class="op" id="7145872">(</span><span class="string" id="7145873">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7145888">,</span>&nbsp;<span class="ident" id="7145890">err</span><span class="op" id="7145893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145899">w</span><span class="op" id="7145900">.</span><span class="ident" id="7145901">Write</span><span class="op" id="7145906">(</span><span class="op" id="7145907">[</span><span class="op" id="7145908">]</span><span class="builtintype" id="7145909">byte</span><span class="op" id="7145913">(</span><span class="ident" id="7145914">dict</span><span class="op" id="7145918">)</span><span class="op" id="7145919">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145922">w</span><span class="op" id="7145923">.</span><span class="ident" id="7145924">Flush</span><span class="op" id="7145929">(</span><span class="op" id="7145930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145933">b</span><span class="op" id="7145934">.</span><span class="ident" id="7145935">Reset</span><span class="op" id="7145940">(</span><span class="op" id="7145941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145944">w</span><span class="op" id="7145945">.</span><span class="ident" id="7145946">Write</span><span class="op" id="7145951">(</span><span class="op" id="7145952">[</span><span class="op" id="7145953">]</span><span class="builtintype" id="7145954">byte</span><span class="op" id="7145958">(</span><span class="ident" id="7145959">text</span><span class="op" id="7145963">)</span><span class="op" id="7145964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145967">w</span><span class="op" id="7145968">.</span><span class="ident" id="7145969">Close</span><span class="op" id="7145974">(</span><span class="op" id="7145975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145979">var</span>&nbsp;<span class="ident" id="7145983">b1</span>&nbsp;<span class="ident" id="7145986">bytes</span><span class="op" id="7145991">.</span><span class="ident" id="7145992">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146000">w</span><span class="op" id="7146001">,</span>&nbsp;<span class="ident" id="7146003">_</span>&nbsp;<span class="op" id="7146005">=</span>&nbsp;<span class="ident" id="7146007">NewWriterDict</span><span class="op" id="7146020">(</span><span class="op" id="7146021">&amp;</span><span class="ident" id="7146022">b1</span><span class="op" id="7146024">,</span>&nbsp;<span class="num" id="7146026">5</span><span class="op" id="7146027">,</span>&nbsp;<span class="op" id="7146029">[</span><span class="op" id="7146030">]</span><span class="builtintype" id="7146031">byte</span><span class="op" id="7146035">(</span><span class="ident" id="7146036">dict</span><span class="op" id="7146040">)</span><span class="op" id="7146041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146044">w</span><span class="op" id="7146045">.</span><span class="ident" id="7146046">Write</span><span class="op" id="7146051">(</span><span class="op" id="7146052">[</span><span class="op" id="7146053">]</span><span class="builtintype" id="7146054">byte</span><span class="op" id="7146058">(</span><span class="ident" id="7146059">text</span><span class="op" id="7146063">)</span><span class="op" id="7146064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146067">w</span><span class="op" id="7146068">.</span><span class="ident" id="7146069">Close</span><span class="op" id="7146074">(</span><span class="op" id="7146075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146079">if</span>&nbsp;<span class="op" id="7146082">!</span><span class="ident" id="7146083">bytes</span><span class="op" id="7146088">.</span><span class="ident" id="7146089">Equal</span><span class="op" id="7146094">(</span><span class="ident" id="7146095">b1</span><span class="op" id="7146097">.</span><span class="ident" id="7146098">Bytes</span><span class="op" id="7146103">(</span><span class="op" id="7146104">)</span><span class="op" id="7146105">,</span>&nbsp;<span class="ident" id="7146107">b</span><span class="op" id="7146108">.</span><span class="ident" id="7146109">Bytes</span><span class="op" id="7146114">(</span><span class="op" id="7146115">)</span><span class="op" id="7146116">)</span>&nbsp;<span class="op" id="7146118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146122">t</span><span class="op" id="7146123">.</span><span class="ident" id="7146124">Fatalf</span><span class="op" id="7146130">(</span><span class="string" id="7146131">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7146156">,</span>&nbsp;<span class="ident" id="7146158">b1</span><span class="op" id="7146160">.</span><span class="ident" id="7146161">Bytes</span><span class="op" id="7146166">(</span><span class="op" id="7146167">)</span><span class="op" id="7146168">,</span>&nbsp;<span class="ident" id="7146170">b</span><span class="op" id="7146171">.</span><span class="ident" id="7146172">Bytes</span><span class="op" id="7146177">(</span><span class="op" id="7146178">)</span><span class="op" id="7146179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146182">}</span><br>
<span class="lineno"></span><span class="op" id="7146184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7146187">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="7146244">func</span>&nbsp;<span class="ident" id="7146249">TestRegression2508</span><span class="op" id="7146267">(</span><span class="ident" id="7146268">t</span>&nbsp;<span class="op" id="7146270">*</span><span class="ident" id="7146271">testing</span><span class="op" id="7146278">.</span><span class="ident" id="7146279">T</span><span class="op" id="7146280">)</span>&nbsp;<span class="op" id="7146282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146285">if</span>&nbsp;<span class="ident" id="7146288">testing</span><span class="op" id="7146295">.</span><span class="ident" id="7146296">Short</span><span class="op" id="7146301">(</span><span class="op" id="7146302">)</span>&nbsp;<span class="op" id="7146304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146308">t</span><span class="op" id="7146309">.</span><span class="ident" id="7146310">Logf</span><span class="op" id="7146314">(</span><span class="string" id="7146315">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="7146342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146346">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146357">w</span><span class="op" id="7146358">,</span>&nbsp;<span class="ident" id="7146360">err</span>&nbsp;<span class="op" id="7146364">:=</span>&nbsp;<span class="ident" id="7146367">NewWriter</span><span class="op" id="7146376">(</span><span class="ident" id="7146377">ioutil</span><span class="op" id="7146383">.</span><span class="ident" id="7146384">Discard</span><span class="op" id="7146391">,</span>&nbsp;<span class="num" id="7146393">1</span><span class="op" id="7146394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146397">if</span>&nbsp;<span class="ident" id="7146400">err</span>&nbsp;<span class="op" id="7146404">!=</span>&nbsp;<span class="ident" id="7146407">nil</span>&nbsp;<span class="op" id="7146411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146415">t</span><span class="op" id="7146416">.</span><span class="ident" id="7146417">Fatalf</span><span class="op" id="7146423">(</span><span class="string" id="7146424">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7146439">,</span>&nbsp;<span class="ident" id="7146441">err</span><span class="op" id="7146444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146447">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146450">buf</span>&nbsp;<span class="op" id="7146454">:=</span>&nbsp;<span class="builtinfunc" id="7146457">make</span><span class="op" id="7146461">(</span><span class="op" id="7146462">[</span><span class="op" id="7146463">]</span><span class="builtintype" id="7146464">byte</span><span class="op" id="7146468">,</span>&nbsp;<span class="num" id="7146470">1024</span><span class="op" id="7146474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146477">for</span>&nbsp;<span class="ident" id="7146481">i</span>&nbsp;<span class="op" id="7146483">:=</span>&nbsp;<span class="num" id="7146486">0</span><span class="op" id="7146487">;</span>&nbsp;<span class="ident" id="7146489">i</span>&nbsp;<span class="op" id="7146491">&lt;</span>&nbsp;<span class="num" id="7146493">131072</span><span class="op" id="7146499">;</span>&nbsp;<span class="ident" id="7146501">i</span><span class="op" id="7146502">++</span>&nbsp;<span class="op" id="7146505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146509">if</span>&nbsp;<span class="ident" id="7146512">_</span><span class="op" id="7146513">,</span>&nbsp;<span class="ident" id="7146515">err</span>&nbsp;<span class="op" id="7146519">:=</span>&nbsp;<span class="ident" id="7146522">w</span><span class="op" id="7146523">.</span><span class="ident" id="7146524">Write</span><span class="op" id="7146529">(</span><span class="ident" id="7146530">buf</span><span class="op" id="7146533">)</span><span class="op" id="7146534">;</span>&nbsp;<span class="ident" id="7146536">err</span>&nbsp;<span class="op" id="7146540">!=</span>&nbsp;<span class="ident" id="7146543">nil</span>&nbsp;<span class="op" id="7146547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146552">t</span><span class="op" id="7146553">.</span><span class="ident" id="7146554">Fatalf</span><span class="op" id="7146560">(</span><span class="string" id="7146561">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7146580">,</span>&nbsp;<span class="ident" id="7146582">err</span><span class="op" id="7146585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146589">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146595">w</span><span class="op" id="7146596">.</span><span class="ident" id="7146597">Close</span><span class="op" id="7146602">(</span><span class="op" id="7146603">)</span><br>
<span class="lineno"></span><span class="op" id="7146605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7146608">func</span>&nbsp;<span class="ident" id="7146613">TestWriterReset</span><span class="op" id="7146628">(</span><span class="ident" id="7146629">t</span>&nbsp;<span class="op" id="7146631">*</span><span class="ident" id="7146632">testing</span><span class="op" id="7146639">.</span><span class="ident" id="7146640">T</span><span class="op" id="7146641">)</span>&nbsp;<span class="op" id="7146643">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146646">for</span>&nbsp;<span class="ident" id="7146650">level</span>&nbsp;<span class="op" id="7146656">:=</span>&nbsp;<span class="num" id="7146659">0</span><span class="op" id="7146660">;</span>&nbsp;<span class="ident" id="7146662">level</span>&nbsp;<span class="op" id="7146668">&lt;=</span>&nbsp;<span class="num" id="7146671">9</span><span class="op" id="7146672">;</span>&nbsp;<span class="ident" id="7146674">level</span><span class="op" id="7146679">++</span>&nbsp;<span class="op" id="7146682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146686">if</span>&nbsp;<span class="ident" id="7146689">testing</span><span class="op" id="7146696">.</span><span class="ident" id="7146697">Short</span><span class="op" id="7146702">(</span><span class="op" id="7146703">)</span>&nbsp;<span class="op" id="7146705">&amp;&amp;</span>&nbsp;<span class="ident" id="7146708">level</span>&nbsp;<span class="op" id="7146714">&gt;</span>&nbsp;<span class="num" id="7146716">1</span>&nbsp;<span class="op" id="7146718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146723">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146735">w</span><span class="op" id="7146736">,</span>&nbsp;<span class="ident" id="7146738">err</span>&nbsp;<span class="op" id="7146742">:=</span>&nbsp;<span class="ident" id="7146745">NewWriter</span><span class="op" id="7146754">(</span><span class="ident" id="7146755">ioutil</span><span class="op" id="7146761">.</span><span class="ident" id="7146762">Discard</span><span class="op" id="7146769">,</span>&nbsp;<span class="ident" id="7146771">level</span><span class="op" id="7146776">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146780">if</span>&nbsp;<span class="ident" id="7146783">err</span>&nbsp;<span class="op" id="7146787">!=</span>&nbsp;<span class="ident" id="7146790">nil</span>&nbsp;<span class="op" id="7146794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146799">t</span><span class="op" id="7146800">.</span><span class="ident" id="7146801">Fatalf</span><span class="op" id="7146807">(</span><span class="string" id="7146808">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7146823">,</span>&nbsp;<span class="ident" id="7146825">err</span><span class="op" id="7146828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146836">buf</span>&nbsp;<span class="op" id="7146840">:=</span>&nbsp;<span class="op" id="7146843">[</span><span class="op" id="7146844">]</span><span class="builtintype" id="7146845">byte</span><span class="op" id="7146849">(</span><span class="string" id="7146850">&#34;hello&nbsp;world&#34;</span><span class="op" id="7146863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146867">for</span>&nbsp;<span class="ident" id="7146871">i</span>&nbsp;<span class="op" id="7146873">:=</span>&nbsp;<span class="num" id="7146876">0</span><span class="op" id="7146877">;</span>&nbsp;<span class="ident" id="7146879">i</span>&nbsp;<span class="op" id="7146881">&lt;</span>&nbsp;<span class="num" id="7146883">1024</span><span class="op" id="7146887">;</span>&nbsp;<span class="ident" id="7146889">i</span><span class="op" id="7146890">++</span>&nbsp;<span class="op" id="7146893">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146898">w</span><span class="op" id="7146899">.</span><span class="ident" id="7146900">Write</span><span class="op" id="7146905">(</span><span class="ident" id="7146906">buf</span><span class="op" id="7146909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146917">w</span><span class="op" id="7146918">.</span><span class="ident" id="7146919">Reset</span><span class="op" id="7146924">(</span><span class="ident" id="7146925">ioutil</span><span class="op" id="7146931">.</span><span class="ident" id="7146932">Discard</span><span class="op" id="7146939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146944">wref</span><span class="op" id="7146948">,</span>&nbsp;<span class="ident" id="7146950">err</span>&nbsp;<span class="op" id="7146954">:=</span>&nbsp;<span class="ident" id="7146957">NewWriter</span><span class="op" id="7146966">(</span><span class="ident" id="7146967">ioutil</span><span class="op" id="7146973">.</span><span class="ident" id="7146974">Discard</span><span class="op" id="7146981">,</span>&nbsp;<span class="ident" id="7146983">level</span><span class="op" id="7146988">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7146992">if</span>&nbsp;<span class="ident" id="7146995">err</span>&nbsp;<span class="op" id="7146999">!=</span>&nbsp;<span class="ident" id="7147002">nil</span>&nbsp;<span class="op" id="7147006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147011">t</span><span class="op" id="7147012">.</span><span class="ident" id="7147013">Fatalf</span><span class="op" id="7147019">(</span><span class="string" id="7147020">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7147035">,</span>&nbsp;<span class="ident" id="7147037">err</span><span class="op" id="7147040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7147044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7147049">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147091">w</span><span class="op" id="7147092">.</span><span class="ident" id="7147093">d</span><span class="op" id="7147094">.</span><span class="ident" id="7147095">fill</span><span class="op" id="7147099">,</span>&nbsp;<span class="ident" id="7147101">wref</span><span class="op" id="7147105">.</span><span class="ident" id="7147106">d</span><span class="op" id="7147107">.</span><span class="ident" id="7147108">fill</span>&nbsp;<span class="op" id="7147113">=</span>&nbsp;<span class="ident" id="7147115">nil</span><span class="op" id="7147118">,</span>&nbsp;<span class="ident" id="7147120">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147126">w</span><span class="op" id="7147127">.</span><span class="ident" id="7147128">d</span><span class="op" id="7147129">.</span><span class="ident" id="7147130">step</span><span class="op" id="7147134">,</span>&nbsp;<span class="ident" id="7147136">wref</span><span class="op" id="7147140">.</span><span class="ident" id="7147141">d</span><span class="op" id="7147142">.</span><span class="ident" id="7147143">step</span>&nbsp;<span class="op" id="7147148">=</span>&nbsp;<span class="ident" id="7147150">nil</span><span class="op" id="7147153">,</span>&nbsp;<span class="ident" id="7147155">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7147161">if</span>&nbsp;<span class="op" id="7147164">!</span><span class="ident" id="7147165">reflect</span><span class="op" id="7147172">.</span><span class="ident" id="7147173">DeepEqual</span><span class="op" id="7147182">(</span><span class="ident" id="7147183">w</span><span class="op" id="7147184">,</span>&nbsp;<span class="ident" id="7147186">wref</span><span class="op" id="7147190">)</span>&nbsp;<span class="op" id="7147192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147197">t</span><span class="op" id="7147198">.</span><span class="ident" id="7147199">Errorf</span><span class="op" id="7147205">(</span><span class="string" id="7147206">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="7147245">,</span>&nbsp;<span class="ident" id="7147247">level</span><span class="op" id="7147252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7147256">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7147259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147262">testResetOutput</span><span class="op" id="7147277">(</span><span class="ident" id="7147278">t</span><span class="op" id="7147279">,</span>&nbsp;<span class="keyword" id="7147281">func</span><span class="op" id="7147285">(</span><span class="ident" id="7147286">w</span>&nbsp;<span class="ident" id="7147288">io</span><span class="op" id="7147290">.</span><span class="ident" id="7147291">Writer</span><span class="op" id="7147297">)</span>&nbsp;<span class="op" id="7147299">(</span><span class="op" id="7147300">*</span><span class="ident" id="7147301">Writer</span><span class="op" id="7147307">,</span>&nbsp;<span class="builtintype" id="7147309">error</span><span class="op" id="7147314">)</span>&nbsp;<span class="op" id="7147316">{</span>&nbsp;<span class="keyword" id="7147318">return</span>&nbsp;<span class="ident" id="7147325">NewWriter</span><span class="op" id="7147334">(</span><span class="ident" id="7147335">w</span><span class="op" id="7147336">,</span>&nbsp;<span class="ident" id="7147338">NoCompression</span><span class="op" id="7147351">)</span>&nbsp;<span class="op" id="7147353">}</span><span class="op" id="7147354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147357">testResetOutput</span><span class="op" id="7147372">(</span><span class="ident" id="7147373">t</span><span class="op" id="7147374">,</span>&nbsp;<span class="keyword" id="7147376">func</span><span class="op" id="7147380">(</span><span class="ident" id="7147381">w</span>&nbsp;<span class="ident" id="7147383">io</span><span class="op" id="7147385">.</span><span class="ident" id="7147386">Writer</span><span class="op" id="7147392">)</span>&nbsp;<span class="op" id="7147394">(</span><span class="op" id="7147395">*</span><span class="ident" id="7147396">Writer</span><span class="op" id="7147402">,</span>&nbsp;<span class="builtintype" id="7147404">error</span><span class="op" id="7147409">)</span>&nbsp;<span class="op" id="7147411">{</span>&nbsp;<span class="keyword" id="7147413">return</span>&nbsp;<span class="ident" id="7147420">NewWriter</span><span class="op" id="7147429">(</span><span class="ident" id="7147430">w</span><span class="op" id="7147431">,</span>&nbsp;<span class="ident" id="7147433">DefaultCompression</span><span class="op" id="7147451">)</span>&nbsp;<span class="op" id="7147453">}</span><span class="op" id="7147454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147457">testResetOutput</span><span class="op" id="7147472">(</span><span class="ident" id="7147473">t</span><span class="op" id="7147474">,</span>&nbsp;<span class="keyword" id="7147476">func</span><span class="op" id="7147480">(</span><span class="ident" id="7147481">w</span>&nbsp;<span class="ident" id="7147483">io</span><span class="op" id="7147485">.</span><span class="ident" id="7147486">Writer</span><span class="op" id="7147492">)</span>&nbsp;<span class="op" id="7147494">(</span><span class="op" id="7147495">*</span><span class="ident" id="7147496">Writer</span><span class="op" id="7147502">,</span>&nbsp;<span class="builtintype" id="7147504">error</span><span class="op" id="7147509">)</span>&nbsp;<span class="op" id="7147511">{</span>&nbsp;<span class="keyword" id="7147513">return</span>&nbsp;<span class="ident" id="7147520">NewWriter</span><span class="op" id="7147529">(</span><span class="ident" id="7147530">w</span><span class="op" id="7147531">,</span>&nbsp;<span class="ident" id="7147533">BestCompression</span><span class="op" id="7147548">)</span>&nbsp;<span class="op" id="7147550">}</span><span class="op" id="7147551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147554">dict</span>&nbsp;<span class="op" id="7147559">:=</span>&nbsp;<span class="op" id="7147562">[</span><span class="op" id="7147563">]</span><span class="builtintype" id="7147564">byte</span><span class="op" id="7147568">(</span><span class="string" id="7147569">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="7147587">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147590">testResetOutput</span><span class="op" id="7147605">(</span><span class="ident" id="7147606">t</span><span class="op" id="7147607">,</span>&nbsp;<span class="keyword" id="7147609">func</span><span class="op" id="7147613">(</span><span class="ident" id="7147614">w</span>&nbsp;<span class="ident" id="7147616">io</span><span class="op" id="7147618">.</span><span class="ident" id="7147619">Writer</span><span class="op" id="7147625">)</span>&nbsp;<span class="op" id="7147627">(</span><span class="op" id="7147628">*</span><span class="ident" id="7147629">Writer</span><span class="op" id="7147635">,</span>&nbsp;<span class="builtintype" id="7147637">error</span><span class="op" id="7147642">)</span>&nbsp;<span class="op" id="7147644">{</span>&nbsp;<span class="keyword" id="7147646">return</span>&nbsp;<span class="ident" id="7147653">NewWriterDict</span><span class="op" id="7147666">(</span><span class="ident" id="7147667">w</span><span class="op" id="7147668">,</span>&nbsp;<span class="ident" id="7147670">NoCompression</span><span class="op" id="7147683">,</span>&nbsp;<span class="ident" id="7147685">dict</span><span class="op" id="7147689">)</span>&nbsp;<span class="op" id="7147691">}</span><span class="op" id="7147692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147695">testResetOutput</span><span class="op" id="7147710">(</span><span class="ident" id="7147711">t</span><span class="op" id="7147712">,</span>&nbsp;<span class="keyword" id="7147714">func</span><span class="op" id="7147718">(</span><span class="ident" id="7147719">w</span>&nbsp;<span class="ident" id="7147721">io</span><span class="op" id="7147723">.</span><span class="ident" id="7147724">Writer</span><span class="op" id="7147730">)</span>&nbsp;<span class="op" id="7147732">(</span><span class="op" id="7147733">*</span><span class="ident" id="7147734">Writer</span><span class="op" id="7147740">,</span>&nbsp;<span class="builtintype" id="7147742">error</span><span class="op" id="7147747">)</span>&nbsp;<span class="op" id="7147749">{</span>&nbsp;<span class="keyword" id="7147751">return</span>&nbsp;<span class="ident" id="7147758">NewWriterDict</span><span class="op" id="7147771">(</span><span class="ident" id="7147772">w</span><span class="op" id="7147773">,</span>&nbsp;<span class="ident" id="7147775">DefaultCompression</span><span class="op" id="7147793">,</span>&nbsp;<span class="ident" id="7147795">dict</span><span class="op" id="7147799">)</span>&nbsp;<span class="op" id="7147801">}</span><span class="op" id="7147802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147805">testResetOutput</span><span class="op" id="7147820">(</span><span class="ident" id="7147821">t</span><span class="op" id="7147822">,</span>&nbsp;<span class="keyword" id="7147824">func</span><span class="op" id="7147828">(</span><span class="ident" id="7147829">w</span>&nbsp;<span class="ident" id="7147831">io</span><span class="op" id="7147833">.</span><span class="ident" id="7147834">Writer</span><span class="op" id="7147840">)</span>&nbsp;<span class="op" id="7147842">(</span><span class="op" id="7147843">*</span><span class="ident" id="7147844">Writer</span><span class="op" id="7147850">,</span>&nbsp;<span class="builtintype" id="7147852">error</span><span class="op" id="7147857">)</span>&nbsp;<span class="op" id="7147859">{</span>&nbsp;<span class="keyword" id="7147861">return</span>&nbsp;<span class="ident" id="7147868">NewWriterDict</span><span class="op" id="7147881">(</span><span class="ident" id="7147882">w</span><span class="op" id="7147883">,</span>&nbsp;<span class="ident" id="7147885">BestCompression</span><span class="op" id="7147900">,</span>&nbsp;<span class="ident" id="7147902">dict</span><span class="op" id="7147906">)</span>&nbsp;<span class="op" id="7147908">}</span><span class="op" id="7147909">)</span><br>
<span class="lineno"></span><span class="op" id="7147911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="7147914">func</span>&nbsp;<span class="ident" id="7147919">testResetOutput</span><span class="op" id="7147934">(</span><span class="ident" id="7147935">t</span>&nbsp;<span class="op" id="7147937">*</span><span class="ident" id="7147938">testing</span><span class="op" id="7147945">.</span><span class="ident" id="7147946">T</span><span class="op" id="7147947">,</span>&nbsp;<span class="ident" id="7147949">newWriter</span>&nbsp;<span class="keyword" id="7147959">func</span><span class="op" id="7147963">(</span><span class="ident" id="7147964">w</span>&nbsp;<span class="ident" id="7147966">io</span><span class="op" id="7147968">.</span><span class="ident" id="7147969">Writer</span><span class="op" id="7147975">)</span>&nbsp;<span class="op" id="7147977">(</span><span class="op" id="7147978">*</span><span class="ident" id="7147979">Writer</span><span class="op" id="7147985">,</span>&nbsp;<span class="builtintype" id="7147987">error</span><span class="op" id="7147992">)</span><span class="op" id="7147993">)</span>&nbsp;<span class="op" id="7147995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7147998">buf</span>&nbsp;<span class="op" id="7148002">:=</span>&nbsp;<span class="builtinfunc" id="7148005">new</span><span class="op" id="7148008">(</span><span class="ident" id="7148009">bytes</span><span class="op" id="7148014">.</span><span class="ident" id="7148015">Buffer</span><span class="op" id="7148021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148024">w</span><span class="op" id="7148025">,</span>&nbsp;<span class="ident" id="7148027">err</span>&nbsp;<span class="op" id="7148031">:=</span>&nbsp;<span class="ident" id="7148034">newWriter</span><span class="op" id="7148043">(</span><span class="ident" id="7148044">buf</span><span class="op" id="7148047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7148050">if</span>&nbsp;<span class="ident" id="7148053">err</span>&nbsp;<span class="op" id="7148057">!=</span>&nbsp;<span class="ident" id="7148060">nil</span>&nbsp;<span class="op" id="7148064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148068">t</span><span class="op" id="7148069">.</span><span class="ident" id="7148070">Fatalf</span><span class="op" id="7148076">(</span><span class="string" id="7148077">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7148092">,</span>&nbsp;<span class="ident" id="7148094">err</span><span class="op" id="7148097">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7148100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148103">b</span>&nbsp;<span class="op" id="7148105">:=</span>&nbsp;<span class="op" id="7148108">[</span><span class="op" id="7148109">]</span><span class="builtintype" id="7148110">byte</span><span class="op" id="7148114">(</span><span class="string" id="7148115">&#34;hello&nbsp;world&#34;</span><span class="op" id="7148128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7148131">for</span>&nbsp;<span class="ident" id="7148135">i</span>&nbsp;<span class="op" id="7148137">:=</span>&nbsp;<span class="num" id="7148140">0</span><span class="op" id="7148141">;</span>&nbsp;<span class="ident" id="7148143">i</span>&nbsp;<span class="op" id="7148145">&lt;</span>&nbsp;<span class="num" id="7148147">1024</span><span class="op" id="7148151">;</span>&nbsp;<span class="ident" id="7148153">i</span><span class="op" id="7148154">++</span>&nbsp;<span class="op" id="7148157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148161">w</span><span class="op" id="7148162">.</span><span class="ident" id="7148163">Write</span><span class="op" id="7148168">(</span><span class="ident" id="7148169">b</span><span class="op" id="7148170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7148173">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148176">w</span><span class="op" id="7148177">.</span><span class="ident" id="7148178">Close</span><span class="op" id="7148183">(</span><span class="op" id="7148184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148187">out1</span>&nbsp;<span class="op" id="7148192">:=</span>&nbsp;<span class="ident" id="7148195">buf</span><span class="op" id="7148198">.</span><span class="ident" id="7148199">String</span><span class="op" id="7148205">(</span><span class="op" id="7148206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148210">buf2</span>&nbsp;<span class="op" id="7148215">:=</span>&nbsp;<span class="builtinfunc" id="7148218">new</span><span class="op" id="7148221">(</span><span class="ident" id="7148222">bytes</span><span class="op" id="7148227">.</span><span class="ident" id="7148228">Buffer</span><span class="op" id="7148234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148237">w</span><span class="op" id="7148238">.</span><span class="ident" id="7148239">Reset</span><span class="op" id="7148244">(</span><span class="ident" id="7148245">buf2</span><span class="op" id="7148249">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7148252">for</span>&nbsp;<span class="ident" id="7148256">i</span>&nbsp;<span class="op" id="7148258">:=</span>&nbsp;<span class="num" id="7148261">0</span><span class="op" id="7148262">;</span>&nbsp;<span class="ident" id="7148264">i</span>&nbsp;<span class="op" id="7148266">&lt;</span>&nbsp;<span class="num" id="7148268">1024</span><span class="op" id="7148272">;</span>&nbsp;<span class="ident" id="7148274">i</span><span class="op" id="7148275">++</span>&nbsp;<span class="op" id="7148278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148282">w</span><span class="op" id="7148283">.</span><span class="ident" id="7148284">Write</span><span class="op" id="7148289">(</span><span class="ident" id="7148290">b</span><span class="op" id="7148291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7148294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148297">w</span><span class="op" id="7148298">.</span><span class="ident" id="7148299">Close</span><span class="op" id="7148304">(</span><span class="op" id="7148305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148308">out2</span>&nbsp;<span class="op" id="7148313">:=</span>&nbsp;<span class="ident" id="7148316">buf2</span><span class="op" id="7148320">.</span><span class="ident" id="7148321">String</span><span class="op" id="7148327">(</span><span class="op" id="7148328">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7148332">if</span>&nbsp;<span class="ident" id="7148335">out1</span>&nbsp;<span class="op" id="7148340">!=</span>&nbsp;<span class="ident" id="7148343">out2</span>&nbsp;<span class="op" id="7148348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148352">t</span><span class="op" id="7148353">.</span><span class="ident" id="7148354">Errorf</span><span class="op" id="7148360">(</span><span class="string" id="7148361">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7148382">,</span>&nbsp;<span class="ident" id="7148384">out2</span><span class="op" id="7148388">,</span>&nbsp;<span class="ident" id="7148390">out1</span><span class="op" id="7148394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7148397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7148400">t</span><span class="op" id="7148401">.</span><span class="ident" id="7148402">Logf</span><span class="op" id="7148406">(</span><span class="string" id="7148407">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7148421">,</span>&nbsp;<span class="builtinfunc" id="7148423">len</span><span class="op" id="7148426">(</span><span class="ident" id="7148427">out1</span><span class="op" id="7148431">)</span><span class="op" id="7148432">)</span><br>
<span class="lineno">490</span><span class="op" id="7148434">}</span>
</div>
</body>
</html>
