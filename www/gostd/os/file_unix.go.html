<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2345615">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2345670">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2345724">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2345775">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2345845">package</span>&nbsp;<span class="ident" id="2345853">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2345857">import</span>&nbsp;<span class="op" id="2345864">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2345867">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2345878">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2345893">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2345903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2345906">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2345950">type</span>&nbsp;<span class="ident" id="2345955">File</span>&nbsp;<span class="keyword" id="2345960">struct</span>&nbsp;<span class="op" id="2345967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2345970">*</span><span class="ident" id="2345971">file</span><br>
<span class="lineno"></span><span class="op" id="2345976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2345979">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2346024">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2346088">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2346148">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2346187">type</span>&nbsp;<span class="ident" id="2346192">file</span>&nbsp;<span class="keyword" id="2346197">struct</span>&nbsp;<span class="op" id="2346204">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346207">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2346215">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346220">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2346228">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346236">dirinfo</span>&nbsp;<span class="op" id="2346244">*</span><span class="ident" id="2346245">dirInfo</span>&nbsp;<span class="comment" id="2346253">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346289">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2346297">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2346306">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2346346">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2346349">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2346423">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2346511">func</span>&nbsp;<span class="op" id="2346516">(</span><span class="ident" id="2346517">f</span>&nbsp;<span class="op" id="2346519">*</span><span class="ident" id="2346520">File</span><span class="op" id="2346524">)</span>&nbsp;<span class="ident" id="2346526">Fd</span><span class="op" id="2346528">(</span><span class="op" id="2346529">)</span>&nbsp;<span class="builtintype" id="2346531">uintptr</span>&nbsp;<span class="op" id="2346539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346542">if</span>&nbsp;<span class="ident" id="2346545">f</span>&nbsp;<span class="op" id="2346547">==</span>&nbsp;<span class="builtintype" id="2346550">nil</span>&nbsp;<span class="op" id="2346554">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346558">return</span>&nbsp;<span class="op" id="2346565">^</span><span class="op" id="2346566">(</span><span class="builtintype" id="2346567">uintptr</span><span class="op" id="2346574">(</span><span class="num" id="2346575">0</span><span class="op" id="2346576">)</span><span class="op" id="2346577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2346580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346583">return</span>&nbsp;<span class="builtintype" id="2346590">uintptr</span><span class="op" id="2346597">(</span><span class="ident" id="2346598">f</span><span class="op" id="2346599">.</span><span class="ident" id="2346600">fd</span><span class="op" id="2346602">)</span><br>
<span class="lineno"></span><span class="op" id="2346604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2346607">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2346678">func</span>&nbsp;<span class="ident" id="2346683">NewFile</span><span class="op" id="2346690">(</span><span class="ident" id="2346691">fd</span>&nbsp;<span class="builtintype" id="2346694">uintptr</span><span class="op" id="2346701">,</span>&nbsp;<span class="ident" id="2346703">name</span>&nbsp;<span class="builtintype" id="2346708">string</span><span class="op" id="2346714">)</span>&nbsp;<span class="op" id="2346716">*</span><span class="ident" id="2346717">File</span>&nbsp;<span class="op" id="2346722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346725">fdi</span>&nbsp;<span class="op" id="2346729">:=</span>&nbsp;<span class="builtintype" id="2346732">int</span><span class="op" id="2346735">(</span><span class="ident" id="2346736">fd</span><span class="op" id="2346738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346741">if</span>&nbsp;<span class="ident" id="2346744">fdi</span>&nbsp;<span class="op" id="2346748">&lt;</span>&nbsp;<span class="num" id="2346750">0</span>&nbsp;<span class="op" id="2346752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346756">return</span>&nbsp;<span class="builtintype" id="2346763">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2346768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346771">f</span>&nbsp;<span class="op" id="2346773">:=</span>&nbsp;<span class="op" id="2346776">&amp;</span><span class="ident" id="2346777">File</span><span class="op" id="2346781">{</span><span class="op" id="2346782">&amp;</span><span class="ident" id="2346783">file</span><span class="op" id="2346787">{</span><span class="ident" id="2346788">fd</span><span class="op" id="2346790">:</span>&nbsp;<span class="ident" id="2346792">fdi</span><span class="op" id="2346795">,</span>&nbsp;<span class="ident" id="2346797">name</span><span class="op" id="2346801">:</span>&nbsp;<span class="ident" id="2346803">name</span><span class="op" id="2346807">}</span><span class="op" id="2346808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346811">runtime</span><span class="op" id="2346818">.</span><span class="ident" id="2346819">SetFinalizer</span><span class="op" id="2346831">(</span><span class="ident" id="2346832">f</span><span class="op" id="2346833">.</span><span class="ident" id="2346834">file</span><span class="op" id="2346838">,</span>&nbsp;<span class="op" id="2346840">(</span><span class="op" id="2346841">*</span><span class="ident" id="2346842">file</span><span class="op" id="2346846">)</span><span class="op" id="2346847">.</span><span class="builtinfunc" id="2346848">close</span><span class="op" id="2346853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2346856">return</span>&nbsp;<span class="ident" id="2346863">f</span><br>
<span class="lineno"></span><span class="op" id="2346865">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2346868">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2346927">type</span>&nbsp;<span class="ident" id="2346932">dirInfo</span>&nbsp;<span class="keyword" id="2346940">struct</span>&nbsp;<span class="op" id="2346947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346950">buf</span>&nbsp;&nbsp;<span class="op" id="2346955">[</span><span class="op" id="2346956">]</span><span class="builtintype" id="2346957">byte</span>&nbsp;<span class="comment" id="2346962">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2346991">nbuf</span>&nbsp;<span class="builtintype" id="2346996">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347003">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347054">bufp</span>&nbsp;<span class="builtintype" id="2347059">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347066">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2347101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2347104">func</span>&nbsp;<span class="ident" id="2347109">epipecheck</span><span class="op" id="2347119">(</span><span class="ident" id="2347120">file</span>&nbsp;<span class="op" id="2347125">*</span><span class="ident" id="2347126">File</span><span class="op" id="2347130">,</span>&nbsp;<span class="ident" id="2347132">e</span>&nbsp;<span class="builtintype" id="2347134">error</span><span class="op" id="2347139">)</span>&nbsp;<span class="op" id="2347141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2347144">if</span>&nbsp;<span class="ident" id="2347147">e</span>&nbsp;<span class="op" id="2347149">==</span>&nbsp;<span class="ident" id="2347152">syscall</span><span class="op" id="2347159">.</span><span class="ident" id="2347160">EPIPE</span>&nbsp;<span class="op" id="2347166">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2347170">if</span>&nbsp;<span class="ident" id="2347173">atomic</span><span class="op" id="2347179">.</span><span class="ident" id="2347180">AddInt32</span><span class="op" id="2347188">(</span><span class="op" id="2347189">&amp;</span><span class="ident" id="2347190">file</span><span class="op" id="2347194">.</span><span class="ident" id="2347195">nepipe</span><span class="op" id="2347201">,</span>&nbsp;<span class="num" id="2347203">1</span><span class="op" id="2347204">)</span>&nbsp;<span class="op" id="2347206">&gt;=</span>&nbsp;<span class="num" id="2347209">10</span>&nbsp;<span class="op" id="2347212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347217">sigpipe</span><span class="op" id="2347224">(</span><span class="op" id="2347225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2347229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2347232">}</span>&nbsp;<span class="keyword" id="2347234">else</span>&nbsp;<span class="op" id="2347239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347243">atomic</span><span class="op" id="2347249">.</span><span class="ident" id="2347250">StoreInt32</span><span class="op" id="2347260">(</span><span class="op" id="2347261">&amp;</span><span class="ident" id="2347262">file</span><span class="op" id="2347266">.</span><span class="ident" id="2347267">nepipe</span><span class="op" id="2347273">,</span>&nbsp;<span class="num" id="2347275">0</span><span class="op" id="2347276">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2347279">}</span><br>
<span class="lineno"></span><span class="op" id="2347281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2347284">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2347350">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2347413">const</span>&nbsp;<span class="ident" id="2347419">DevNull</span>&nbsp;<span class="op" id="2347427">=</span>&nbsp;<span class="string" id="2347429">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2347442">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2347509">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2347576">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2347648">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2347701">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2347757">func</span>&nbsp;<span class="ident" id="2347762">OpenFile</span><span class="op" id="2347770">(</span><span class="ident" id="2347771">name</span>&nbsp;<span class="builtintype" id="2347776">string</span><span class="op" id="2347782">,</span>&nbsp;<span class="ident" id="2347784">flag</span>&nbsp;<span class="builtintype" id="2347789">int</span><span class="op" id="2347792">,</span>&nbsp;<span class="ident" id="2347794">perm</span>&nbsp;<span class="ident" id="2347799">FileMode</span><span class="op" id="2347807">)</span>&nbsp;<span class="op" id="2347809">(</span><span class="ident" id="2347810">file</span>&nbsp;<span class="op" id="2347815">*</span><span class="ident" id="2347816">File</span><span class="op" id="2347820">,</span>&nbsp;<span class="ident" id="2347822">err</span>&nbsp;<span class="builtintype" id="2347826">error</span><span class="op" id="2347831">)</span>&nbsp;<span class="op" id="2347833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347836">r</span><span class="op" id="2347837">,</span>&nbsp;<span class="ident" id="2347839">e</span>&nbsp;<span class="op" id="2347841">:=</span>&nbsp;<span class="ident" id="2347844">syscall</span><span class="op" id="2347851">.</span><span class="ident" id="2347852">Open</span><span class="op" id="2347856">(</span><span class="ident" id="2347857">name</span><span class="op" id="2347861">,</span>&nbsp;<span class="ident" id="2347863">flag</span><span class="op" id="2347867">|</span><span class="ident" id="2347868">syscall</span><span class="op" id="2347875">.</span><span class="ident" id="2347876">O_CLOEXEC</span><span class="op" id="2347885">,</span>&nbsp;<span class="ident" id="2347887">syscallMode</span><span class="op" id="2347898">(</span><span class="ident" id="2347899">perm</span><span class="op" id="2347903">)</span><span class="op" id="2347904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2347907">if</span>&nbsp;<span class="ident" id="2347910">e</span>&nbsp;<span class="op" id="2347912">!=</span>&nbsp;<span class="builtintype" id="2347915">nil</span>&nbsp;<span class="op" id="2347919">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2347923">return</span>&nbsp;<span class="builtintype" id="2347930">nil</span><span class="op" id="2347933">,</span>&nbsp;<span class="op" id="2347935">&amp;</span><span class="ident" id="2347936">PathError</span><span class="op" id="2347945">{</span><span class="string" id="2347946">&#34;open&#34;</span><span class="op" id="2347952">,</span>&nbsp;<span class="ident" id="2347954">name</span><span class="op" id="2347958">,</span>&nbsp;<span class="ident" id="2347960">e</span><span class="op" id="2347961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2347964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347968">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348021">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348077">if</span>&nbsp;<span class="op" id="2348080">!</span><span class="ident" id="2348081">supportsCloseOnExec</span>&nbsp;<span class="op" id="2348101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2348105">syscall</span><span class="op" id="2348112">.</span><span class="ident" id="2348113">CloseOnExec</span><span class="op" id="2348124">(</span><span class="ident" id="2348125">r</span><span class="op" id="2348126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2348129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348133">return</span>&nbsp;<span class="ident" id="2348140">NewFile</span><span class="op" id="2348147">(</span><span class="builtintype" id="2348148">uintptr</span><span class="op" id="2348155">(</span><span class="ident" id="2348156">r</span><span class="op" id="2348157">)</span><span class="op" id="2348158">,</span>&nbsp;<span class="ident" id="2348160">name</span><span class="op" id="2348164">)</span><span class="op" id="2348165">,</span>&nbsp;<span class="builtintype" id="2348167">nil</span><br>
<span class="lineno">90</span><span class="op" id="2348171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348174">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2348231">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2348263">func</span>&nbsp;<span class="op" id="2348268">(</span><span class="ident" id="2348269">f</span>&nbsp;<span class="op" id="2348271">*</span><span class="ident" id="2348272">File</span><span class="op" id="2348276">)</span>&nbsp;<span class="ident" id="2348278">Close</span><span class="op" id="2348283">(</span><span class="op" id="2348284">)</span>&nbsp;<span class="builtintype" id="2348286">error</span>&nbsp;<span class="op" id="2348292">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348295">if</span>&nbsp;<span class="ident" id="2348298">f</span>&nbsp;<span class="op" id="2348300">==</span>&nbsp;<span class="builtintype" id="2348303">nil</span>&nbsp;<span class="op" id="2348307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348311">return</span>&nbsp;<span class="ident" id="2348318">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2348330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348333">return</span>&nbsp;<span class="ident" id="2348340">f</span><span class="op" id="2348341">.</span><span class="ident" id="2348342">file</span><span class="op" id="2348346">.</span><span class="builtinfunc" id="2348347">close</span><span class="op" id="2348352">(</span><span class="op" id="2348353">)</span><br>
<span class="lineno"></span><span class="op" id="2348355">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2348358">func</span>&nbsp;<span class="op" id="2348363">(</span><span class="ident" id="2348364">file</span>&nbsp;<span class="op" id="2348369">*</span><span class="ident" id="2348370">file</span><span class="op" id="2348374">)</span>&nbsp;<span class="builtinfunc" id="2348376">close</span><span class="op" id="2348381">(</span><span class="op" id="2348382">)</span>&nbsp;<span class="builtintype" id="2348384">error</span>&nbsp;<span class="op" id="2348390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348393">if</span>&nbsp;<span class="ident" id="2348396">file</span>&nbsp;<span class="op" id="2348401">==</span>&nbsp;<span class="builtintype" id="2348404">nil</span>&nbsp;<span class="op" id="2348408">||</span>&nbsp;<span class="ident" id="2348411">file</span><span class="op" id="2348415">.</span><span class="ident" id="2348416">fd</span>&nbsp;<span class="op" id="2348419">&lt;</span>&nbsp;<span class="num" id="2348421">0</span>&nbsp;<span class="op" id="2348423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348427">return</span>&nbsp;<span class="ident" id="2348434">syscall</span><span class="op" id="2348441">.</span><span class="ident" id="2348442">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2348450">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348453">var</span>&nbsp;<span class="ident" id="2348457">err</span>&nbsp;<span class="builtintype" id="2348461">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348468">if</span>&nbsp;<span class="ident" id="2348471">e</span>&nbsp;<span class="op" id="2348473">:=</span>&nbsp;<span class="ident" id="2348476">syscall</span><span class="op" id="2348483">.</span><span class="ident" id="2348484">Close</span><span class="op" id="2348489">(</span><span class="ident" id="2348490">file</span><span class="op" id="2348494">.</span><span class="ident" id="2348495">fd</span><span class="op" id="2348497">)</span><span class="op" id="2348498">;</span>&nbsp;<span class="ident" id="2348500">e</span>&nbsp;<span class="op" id="2348502">!=</span>&nbsp;<span class="builtintype" id="2348505">nil</span>&nbsp;<span class="op" id="2348509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2348513">err</span>&nbsp;<span class="op" id="2348517">=</span>&nbsp;<span class="op" id="2348519">&amp;</span><span class="ident" id="2348520">PathError</span><span class="op" id="2348529">{</span><span class="string" id="2348530">&#34;close&#34;</span><span class="op" id="2348537">,</span>&nbsp;<span class="ident" id="2348539">file</span><span class="op" id="2348543">.</span><span class="ident" id="2348544">name</span><span class="op" id="2348548">,</span>&nbsp;<span class="ident" id="2348550">e</span><span class="op" id="2348551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2348554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2348557">file</span><span class="op" id="2348561">.</span><span class="ident" id="2348562">fd</span>&nbsp;<span class="op" id="2348565">=</span>&nbsp;<span class="op" id="2348567">-</span><span class="num" id="2348568">1</span>&nbsp;<span class="comment" id="2348570">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348603">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2348639">runtime</span><span class="op" id="2348646">.</span><span class="ident" id="2348647">SetFinalizer</span><span class="op" id="2348659">(</span><span class="ident" id="2348660">file</span><span class="op" id="2348664">,</span>&nbsp;<span class="builtintype" id="2348666">nil</span><span class="op" id="2348669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348672">return</span>&nbsp;<span class="ident" id="2348679">err</span><br>
<span class="lineno"></span><span class="op" id="2348683">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2348686">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2348742">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2348798">func</span>&nbsp;<span class="op" id="2348803">(</span><span class="ident" id="2348804">f</span>&nbsp;<span class="op" id="2348806">*</span><span class="ident" id="2348807">File</span><span class="op" id="2348811">)</span>&nbsp;<span class="ident" id="2348813">Stat</span><span class="op" id="2348817">(</span><span class="op" id="2348818">)</span>&nbsp;<span class="op" id="2348820">(</span><span class="ident" id="2348821">fi</span>&nbsp;<span class="ident" id="2348824">FileInfo</span><span class="op" id="2348832">,</span>&nbsp;<span class="ident" id="2348834">err</span>&nbsp;<span class="builtintype" id="2348838">error</span><span class="op" id="2348843">)</span>&nbsp;<span class="op" id="2348845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348848">if</span>&nbsp;<span class="ident" id="2348851">f</span>&nbsp;<span class="op" id="2348853">==</span>&nbsp;<span class="builtintype" id="2348856">nil</span>&nbsp;<span class="op" id="2348860">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348864">return</span>&nbsp;<span class="builtintype" id="2348871">nil</span><span class="op" id="2348874">,</span>&nbsp;<span class="ident" id="2348876">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2348888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348891">var</span>&nbsp;<span class="ident" id="2348895">stat</span>&nbsp;<span class="ident" id="2348900">syscall</span><span class="op" id="2348907">.</span><span class="ident" id="2348908">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2348916">err</span>&nbsp;<span class="op" id="2348920">=</span>&nbsp;<span class="ident" id="2348922">syscall</span><span class="op" id="2348929">.</span><span class="ident" id="2348930">Fstat</span><span class="op" id="2348935">(</span><span class="ident" id="2348936">f</span><span class="op" id="2348937">.</span><span class="ident" id="2348938">fd</span><span class="op" id="2348940">,</span>&nbsp;<span class="op" id="2348942">&amp;</span><span class="ident" id="2348943">stat</span><span class="op" id="2348947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348950">if</span>&nbsp;<span class="ident" id="2348953">err</span>&nbsp;<span class="op" id="2348957">!=</span>&nbsp;<span class="builtintype" id="2348960">nil</span>&nbsp;<span class="op" id="2348964">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2348968">return</span>&nbsp;<span class="builtintype" id="2348975">nil</span><span class="op" id="2348978">,</span>&nbsp;<span class="op" id="2348980">&amp;</span><span class="ident" id="2348981">PathError</span><span class="op" id="2348990">{</span><span class="string" id="2348991">&#34;stat&#34;</span><span class="op" id="2348997">,</span>&nbsp;<span class="ident" id="2348999">f</span><span class="op" id="2349000">.</span><span class="ident" id="2349001">name</span><span class="op" id="2349005">,</span>&nbsp;<span class="ident" id="2349007">err</span><span class="op" id="2349010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349016">return</span>&nbsp;<span class="ident" id="2349023">fileInfoFromStat</span><span class="op" id="2349039">(</span><span class="op" id="2349040">&amp;</span><span class="ident" id="2349041">stat</span><span class="op" id="2349045">,</span>&nbsp;<span class="ident" id="2349047">f</span><span class="op" id="2349048">.</span><span class="ident" id="2349049">name</span><span class="op" id="2349053">)</span><span class="op" id="2349054">,</span>&nbsp;<span class="builtintype" id="2349056">nil</span><br>
<span class="lineno"></span><span class="op" id="2349060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2349063">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2349117">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2349173">func</span>&nbsp;<span class="ident" id="2349178">Stat</span><span class="op" id="2349182">(</span><span class="ident" id="2349183">name</span>&nbsp;<span class="builtintype" id="2349188">string</span><span class="op" id="2349194">)</span>&nbsp;<span class="op" id="2349196">(</span><span class="ident" id="2349197">fi</span>&nbsp;<span class="ident" id="2349200">FileInfo</span><span class="op" id="2349208">,</span>&nbsp;<span class="ident" id="2349210">err</span>&nbsp;<span class="builtintype" id="2349214">error</span><span class="op" id="2349219">)</span>&nbsp;<span class="op" id="2349221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349224">var</span>&nbsp;<span class="ident" id="2349228">stat</span>&nbsp;<span class="ident" id="2349233">syscall</span><span class="op" id="2349240">.</span><span class="ident" id="2349241">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349249">err</span>&nbsp;<span class="op" id="2349253">=</span>&nbsp;<span class="ident" id="2349255">syscall</span><span class="op" id="2349262">.</span><span class="ident" id="2349263">Stat</span><span class="op" id="2349267">(</span><span class="ident" id="2349268">name</span><span class="op" id="2349272">,</span>&nbsp;<span class="op" id="2349274">&amp;</span><span class="ident" id="2349275">stat</span><span class="op" id="2349279">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349282">if</span>&nbsp;<span class="ident" id="2349285">err</span>&nbsp;<span class="op" id="2349289">!=</span>&nbsp;<span class="builtintype" id="2349292">nil</span>&nbsp;<span class="op" id="2349296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349300">return</span>&nbsp;<span class="builtintype" id="2349307">nil</span><span class="op" id="2349310">,</span>&nbsp;<span class="op" id="2349312">&amp;</span><span class="ident" id="2349313">PathError</span><span class="op" id="2349322">{</span><span class="string" id="2349323">&#34;stat&#34;</span><span class="op" id="2349329">,</span>&nbsp;<span class="ident" id="2349331">name</span><span class="op" id="2349335">,</span>&nbsp;<span class="ident" id="2349337">err</span><span class="op" id="2349340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349346">return</span>&nbsp;<span class="ident" id="2349353">fileInfoFromStat</span><span class="op" id="2349369">(</span><span class="op" id="2349370">&amp;</span><span class="ident" id="2349371">stat</span><span class="op" id="2349375">,</span>&nbsp;<span class="ident" id="2349377">name</span><span class="op" id="2349381">)</span><span class="op" id="2349382">,</span>&nbsp;<span class="builtintype" id="2349384">nil</span><br>
<span class="lineno"></span><span class="op" id="2349388">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2349391">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2349446">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2349503">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2349579">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2349635">func</span>&nbsp;<span class="ident" id="2349640">Lstat</span><span class="op" id="2349645">(</span><span class="ident" id="2349646">name</span>&nbsp;<span class="builtintype" id="2349651">string</span><span class="op" id="2349657">)</span>&nbsp;<span class="op" id="2349659">(</span><span class="ident" id="2349660">fi</span>&nbsp;<span class="ident" id="2349663">FileInfo</span><span class="op" id="2349671">,</span>&nbsp;<span class="ident" id="2349673">err</span>&nbsp;<span class="builtintype" id="2349677">error</span><span class="op" id="2349682">)</span>&nbsp;<span class="op" id="2349684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349687">var</span>&nbsp;<span class="ident" id="2349691">stat</span>&nbsp;<span class="ident" id="2349696">syscall</span><span class="op" id="2349703">.</span><span class="ident" id="2349704">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349712">err</span>&nbsp;<span class="op" id="2349716">=</span>&nbsp;<span class="ident" id="2349718">syscall</span><span class="op" id="2349725">.</span><span class="ident" id="2349726">Lstat</span><span class="op" id="2349731">(</span><span class="ident" id="2349732">name</span><span class="op" id="2349736">,</span>&nbsp;<span class="op" id="2349738">&amp;</span><span class="ident" id="2349739">stat</span><span class="op" id="2349743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349746">if</span>&nbsp;<span class="ident" id="2349749">err</span>&nbsp;<span class="op" id="2349753">!=</span>&nbsp;<span class="builtintype" id="2349756">nil</span>&nbsp;<span class="op" id="2349760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349764">return</span>&nbsp;<span class="builtintype" id="2349771">nil</span><span class="op" id="2349774">,</span>&nbsp;<span class="op" id="2349776">&amp;</span><span class="ident" id="2349777">PathError</span><span class="op" id="2349786">{</span><span class="string" id="2349787">&#34;lstat&#34;</span><span class="op" id="2349794">,</span>&nbsp;<span class="ident" id="2349796">name</span><span class="op" id="2349800">,</span>&nbsp;<span class="ident" id="2349802">err</span><span class="op" id="2349805">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349811">return</span>&nbsp;<span class="ident" id="2349818">fileInfoFromStat</span><span class="op" id="2349834">(</span><span class="op" id="2349835">&amp;</span><span class="ident" id="2349836">stat</span><span class="op" id="2349840">,</span>&nbsp;<span class="ident" id="2349842">name</span><span class="op" id="2349846">)</span><span class="op" id="2349847">,</span>&nbsp;<span class="builtintype" id="2349849">nil</span><br>
<span class="lineno"></span><span class="op" id="2349853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2349856">func</span>&nbsp;<span class="op" id="2349861">(</span><span class="ident" id="2349862">f</span>&nbsp;<span class="op" id="2349864">*</span><span class="ident" id="2349865">File</span><span class="op" id="2349869">)</span>&nbsp;<span class="ident" id="2349871">readdir</span><span class="op" id="2349878">(</span><span class="ident" id="2349879">n</span>&nbsp;<span class="builtintype" id="2349881">int</span><span class="op" id="2349884">)</span>&nbsp;<span class="op" id="2349886">(</span><span class="ident" id="2349887">fi</span>&nbsp;<span class="op" id="2349890">[</span><span class="op" id="2349891">]</span><span class="ident" id="2349892">FileInfo</span><span class="op" id="2349900">,</span>&nbsp;<span class="ident" id="2349902">err</span>&nbsp;<span class="builtintype" id="2349906">error</span><span class="op" id="2349911">)</span>&nbsp;<span class="op" id="2349913">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349916">dirname</span>&nbsp;<span class="op" id="2349924">:=</span>&nbsp;<span class="ident" id="2349927">f</span><span class="op" id="2349928">.</span><span class="ident" id="2349929">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349935">if</span>&nbsp;<span class="ident" id="2349938">dirname</span>&nbsp;<span class="op" id="2349946">==</span>&nbsp;<span class="string" id="2349949">&#34;&#34;</span>&nbsp;<span class="op" id="2349952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349956">dirname</span>&nbsp;<span class="op" id="2349964">=</span>&nbsp;<span class="string" id="2349966">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349974">names</span><span class="op" id="2349979">,</span>&nbsp;<span class="ident" id="2349981">err</span>&nbsp;<span class="op" id="2349985">:=</span>&nbsp;<span class="ident" id="2349988">f</span><span class="op" id="2349989">.</span><span class="ident" id="2349990">Readdirnames</span><span class="op" id="2350002">(</span><span class="ident" id="2350003">n</span><span class="op" id="2350004">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350007">fi</span>&nbsp;<span class="op" id="2350010">=</span>&nbsp;<span class="builtinfunc" id="2350012">make</span><span class="op" id="2350016">(</span><span class="op" id="2350017">[</span><span class="op" id="2350018">]</span><span class="ident" id="2350019">FileInfo</span><span class="op" id="2350027">,</span>&nbsp;<span class="num" id="2350029">0</span><span class="op" id="2350030">,</span>&nbsp;<span class="builtinfunc" id="2350032">len</span><span class="op" id="2350035">(</span><span class="ident" id="2350036">names</span><span class="op" id="2350041">)</span><span class="op" id="2350042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350045">for</span>&nbsp;<span class="ident" id="2350049">_</span><span class="op" id="2350050">,</span>&nbsp;<span class="ident" id="2350052">filename</span>&nbsp;<span class="op" id="2350061">:=</span>&nbsp;<span class="keyword" id="2350064">range</span>&nbsp;<span class="ident" id="2350070">names</span>&nbsp;<span class="op" id="2350076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350080">fip</span><span class="op" id="2350083">,</span>&nbsp;<span class="ident" id="2350085">lerr</span>&nbsp;<span class="op" id="2350090">:=</span>&nbsp;<span class="ident" id="2350093">lstat</span><span class="op" id="2350098">(</span><span class="ident" id="2350099">dirname</span>&nbsp;<span class="op" id="2350107">+</span>&nbsp;<span class="string" id="2350109">&#34;/&#34;</span>&nbsp;<span class="op" id="2350113">+</span>&nbsp;<span class="ident" id="2350115">filename</span><span class="op" id="2350123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350127">if</span>&nbsp;<span class="ident" id="2350130">IsNotExist</span><span class="op" id="2350140">(</span><span class="ident" id="2350141">lerr</span><span class="op" id="2350145">)</span>&nbsp;<span class="op" id="2350147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2350152">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2350199">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350242">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350257">if</span>&nbsp;<span class="ident" id="2350260">lerr</span>&nbsp;<span class="op" id="2350265">!=</span>&nbsp;<span class="builtintype" id="2350268">nil</span>&nbsp;<span class="op" id="2350272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350277">return</span>&nbsp;<span class="ident" id="2350284">fi</span><span class="op" id="2350286">,</span>&nbsp;<span class="ident" id="2350288">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350299">fi</span>&nbsp;<span class="op" id="2350302">=</span>&nbsp;<span class="builtinfunc" id="2350304">append</span><span class="op" id="2350310">(</span><span class="ident" id="2350311">fi</span><span class="op" id="2350313">,</span>&nbsp;<span class="ident" id="2350315">fip</span><span class="op" id="2350318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350324">return</span>&nbsp;<span class="ident" id="2350331">fi</span><span class="op" id="2350333">,</span>&nbsp;<span class="ident" id="2350335">err</span><br>
<span class="lineno"></span><span class="op" id="2350339">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2350342">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2350400">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2350454">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2350508">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2350526">const</span>&nbsp;<span class="op" id="2350532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350535">needsMaxRW</span>&nbsp;<span class="op" id="2350546">=</span>&nbsp;<span class="ident" id="2350548">runtime</span><span class="op" id="2350555">.</span><span class="ident" id="2350556">GOOS</span>&nbsp;<span class="op" id="2350561">==</span>&nbsp;<span class="string" id="2350564">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2350573">||</span>&nbsp;<span class="ident" id="2350576">runtime</span><span class="op" id="2350583">.</span><span class="ident" id="2350584">GOOS</span>&nbsp;<span class="op" id="2350589">==</span>&nbsp;<span class="string" id="2350592">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350603">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350614">=</span>&nbsp;<span class="num" id="2350616">1</span>&nbsp;<span class="op" id="2350618">&lt;&lt;</span>&nbsp;<span class="num" id="2350621">30</span><br>
<span class="lineno"></span><span class="op" id="2350624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2350627">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2350675">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2350736">func</span>&nbsp;<span class="op" id="2350741">(</span><span class="ident" id="2350742">f</span>&nbsp;<span class="op" id="2350744">*</span><span class="ident" id="2350745">File</span><span class="op" id="2350749">)</span>&nbsp;<span class="ident" id="2350751">read</span><span class="op" id="2350755">(</span><span class="ident" id="2350756">b</span>&nbsp;<span class="op" id="2350758">[</span><span class="op" id="2350759">]</span><span class="builtintype" id="2350760">byte</span><span class="op" id="2350764">)</span>&nbsp;<span class="op" id="2350766">(</span><span class="ident" id="2350767">n</span>&nbsp;<span class="builtintype" id="2350769">int</span><span class="op" id="2350772">,</span>&nbsp;<span class="ident" id="2350774">err</span>&nbsp;<span class="builtintype" id="2350778">error</span><span class="op" id="2350783">)</span>&nbsp;<span class="op" id="2350785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350788">if</span>&nbsp;<span class="ident" id="2350791">needsMaxRW</span>&nbsp;<span class="op" id="2350802">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2350805">len</span><span class="op" id="2350808">(</span><span class="ident" id="2350809">b</span><span class="op" id="2350810">)</span>&nbsp;<span class="op" id="2350812">&gt;</span>&nbsp;<span class="ident" id="2350814">maxRW</span>&nbsp;<span class="op" id="2350820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350824">b</span>&nbsp;<span class="op" id="2350826">=</span>&nbsp;<span class="ident" id="2350828">b</span><span class="op" id="2350829">[</span><span class="op" id="2350830">:</span><span class="ident" id="2350831">maxRW</span><span class="op" id="2350836">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350842">return</span>&nbsp;<span class="ident" id="2350849">fixCount</span><span class="op" id="2350857">(</span><span class="ident" id="2350858">syscall</span><span class="op" id="2350865">.</span><span class="ident" id="2350866">Read</span><span class="op" id="2350870">(</span><span class="ident" id="2350871">f</span><span class="op" id="2350872">.</span><span class="ident" id="2350873">fd</span><span class="op" id="2350875">,</span>&nbsp;<span class="ident" id="2350877">b</span><span class="op" id="2350878">)</span><span class="op" id="2350879">)</span><br>
<span class="lineno"></span><span class="op" id="2350881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2350884">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2350955">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2351017">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2351073">func</span>&nbsp;<span class="op" id="2351078">(</span><span class="ident" id="2351079">f</span>&nbsp;<span class="op" id="2351081">*</span><span class="ident" id="2351082">File</span><span class="op" id="2351086">)</span>&nbsp;<span class="ident" id="2351088">pread</span><span class="op" id="2351093">(</span><span class="ident" id="2351094">b</span>&nbsp;<span class="op" id="2351096">[</span><span class="op" id="2351097">]</span><span class="builtintype" id="2351098">byte</span><span class="op" id="2351102">,</span>&nbsp;<span class="ident" id="2351104">off</span>&nbsp;<span class="ident" id="2351108">int64</span><span class="op" id="2351113">)</span>&nbsp;<span class="op" id="2351115">(</span><span class="ident" id="2351116">n</span>&nbsp;<span class="builtintype" id="2351118">int</span><span class="op" id="2351121">,</span>&nbsp;<span class="ident" id="2351123">err</span>&nbsp;<span class="builtintype" id="2351127">error</span><span class="op" id="2351132">)</span>&nbsp;<span class="op" id="2351134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351137">if</span>&nbsp;<span class="ident" id="2351140">needsMaxRW</span>&nbsp;<span class="op" id="2351151">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2351154">len</span><span class="op" id="2351157">(</span><span class="ident" id="2351158">b</span><span class="op" id="2351159">)</span>&nbsp;<span class="op" id="2351161">&gt;</span>&nbsp;<span class="ident" id="2351163">maxRW</span>&nbsp;<span class="op" id="2351169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351173">b</span>&nbsp;<span class="op" id="2351175">=</span>&nbsp;<span class="ident" id="2351177">b</span><span class="op" id="2351178">[</span><span class="op" id="2351179">:</span><span class="ident" id="2351180">maxRW</span><span class="op" id="2351185">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351191">return</span>&nbsp;<span class="ident" id="2351198">fixCount</span><span class="op" id="2351206">(</span><span class="ident" id="2351207">syscall</span><span class="op" id="2351214">.</span><span class="ident" id="2351215">Pread</span><span class="op" id="2351220">(</span><span class="ident" id="2351221">f</span><span class="op" id="2351222">.</span><span class="ident" id="2351223">fd</span><span class="op" id="2351225">,</span>&nbsp;<span class="ident" id="2351227">b</span><span class="op" id="2351228">,</span>&nbsp;<span class="ident" id="2351230">off</span><span class="op" id="2351233">)</span><span class="op" id="2351234">)</span><br>
<span class="lineno"></span><span class="op" id="2351236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2351239">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2351281">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2351345">func</span>&nbsp;<span class="op" id="2351350">(</span><span class="ident" id="2351351">f</span>&nbsp;<span class="op" id="2351353">*</span><span class="ident" id="2351354">File</span><span class="op" id="2351358">)</span>&nbsp;<span class="ident" id="2351360">write</span><span class="op" id="2351365">(</span><span class="ident" id="2351366">b</span>&nbsp;<span class="op" id="2351368">[</span><span class="op" id="2351369">]</span><span class="builtintype" id="2351370">byte</span><span class="op" id="2351374">)</span>&nbsp;<span class="op" id="2351376">(</span><span class="ident" id="2351377">n</span>&nbsp;<span class="builtintype" id="2351379">int</span><span class="op" id="2351382">,</span>&nbsp;<span class="ident" id="2351384">err</span>&nbsp;<span class="builtintype" id="2351388">error</span><span class="op" id="2351393">)</span>&nbsp;<span class="op" id="2351395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351398">for</span>&nbsp;<span class="op" id="2351402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351406">bcap</span>&nbsp;<span class="op" id="2351411">:=</span>&nbsp;<span class="ident" id="2351414">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351418">if</span>&nbsp;<span class="ident" id="2351421">needsMaxRW</span>&nbsp;<span class="op" id="2351432">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2351435">len</span><span class="op" id="2351438">(</span><span class="ident" id="2351439">bcap</span><span class="op" id="2351443">)</span>&nbsp;<span class="op" id="2351445">&gt;</span>&nbsp;<span class="ident" id="2351447">maxRW</span>&nbsp;<span class="op" id="2351453">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351458">bcap</span>&nbsp;<span class="op" id="2351463">=</span>&nbsp;<span class="ident" id="2351465">bcap</span><span class="op" id="2351469">[</span><span class="op" id="2351470">:</span><span class="ident" id="2351471">maxRW</span><span class="op" id="2351476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351484">m</span><span class="op" id="2351485">,</span>&nbsp;<span class="ident" id="2351487">err</span>&nbsp;<span class="op" id="2351491">:=</span>&nbsp;<span class="ident" id="2351494">fixCount</span><span class="op" id="2351502">(</span><span class="ident" id="2351503">syscall</span><span class="op" id="2351510">.</span><span class="ident" id="2351511">Write</span><span class="op" id="2351516">(</span><span class="ident" id="2351517">f</span><span class="op" id="2351518">.</span><span class="ident" id="2351519">fd</span><span class="op" id="2351521">,</span>&nbsp;<span class="ident" id="2351523">bcap</span><span class="op" id="2351527">)</span><span class="op" id="2351528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351532">n</span>&nbsp;<span class="op" id="2351534">+=</span>&nbsp;<span class="ident" id="2351537">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2351542">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2351604">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2351664">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351730">if</span>&nbsp;<span class="num" id="2351733">0</span>&nbsp;<span class="op" id="2351735">&lt;</span>&nbsp;<span class="ident" id="2351737">m</span>&nbsp;<span class="op" id="2351739">&amp;&amp;</span>&nbsp;<span class="ident" id="2351742">m</span>&nbsp;<span class="op" id="2351744">&lt;</span>&nbsp;<span class="builtinfunc" id="2351746">len</span><span class="op" id="2351749">(</span><span class="ident" id="2351750">bcap</span><span class="op" id="2351754">)</span>&nbsp;<span class="op" id="2351756">||</span>&nbsp;<span class="ident" id="2351759">err</span>&nbsp;<span class="op" id="2351763">==</span>&nbsp;<span class="ident" id="2351766">syscall</span><span class="op" id="2351773">.</span><span class="ident" id="2351774">EINTR</span>&nbsp;<span class="op" id="2351780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351785">b</span>&nbsp;<span class="op" id="2351787">=</span>&nbsp;<span class="ident" id="2351789">b</span><span class="op" id="2351790">[</span><span class="ident" id="2351791">m</span><span class="op" id="2351792">:</span><span class="op" id="2351793">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351798">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351814">if</span>&nbsp;<span class="ident" id="2351817">needsMaxRW</span>&nbsp;<span class="op" id="2351828">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2351831">len</span><span class="op" id="2351834">(</span><span class="ident" id="2351835">bcap</span><span class="op" id="2351839">)</span>&nbsp;<span class="op" id="2351841">!=</span>&nbsp;<span class="builtinfunc" id="2351844">len</span><span class="op" id="2351847">(</span><span class="ident" id="2351848">b</span><span class="op" id="2351849">)</span>&nbsp;<span class="op" id="2351851">&amp;&amp;</span>&nbsp;<span class="ident" id="2351854">err</span>&nbsp;<span class="op" id="2351858">==</span>&nbsp;<span class="builtintype" id="2351861">nil</span>&nbsp;<span class="op" id="2351865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2351870">b</span>&nbsp;<span class="op" id="2351872">=</span>&nbsp;<span class="ident" id="2351874">b</span><span class="op" id="2351875">[</span><span class="ident" id="2351876">m</span><span class="op" id="2351877">:</span><span class="op" id="2351878">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351883">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351899">return</span>&nbsp;<span class="ident" id="2351906">n</span><span class="op" id="2351907">,</span>&nbsp;<span class="ident" id="2351909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351914">}</span><br>
<span class="lineno">230</span><span class="op" id="2351916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2351919">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2351990">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2352054">func</span>&nbsp;<span class="op" id="2352059">(</span><span class="ident" id="2352060">f</span>&nbsp;<span class="op" id="2352062">*</span><span class="ident" id="2352063">File</span><span class="op" id="2352067">)</span>&nbsp;<span class="ident" id="2352069">pwrite</span><span class="op" id="2352075">(</span><span class="ident" id="2352076">b</span>&nbsp;<span class="op" id="2352078">[</span><span class="op" id="2352079">]</span><span class="builtintype" id="2352080">byte</span><span class="op" id="2352084">,</span>&nbsp;<span class="ident" id="2352086">off</span>&nbsp;<span class="ident" id="2352090">int64</span><span class="op" id="2352095">)</span>&nbsp;<span class="op" id="2352097">(</span><span class="ident" id="2352098">n</span>&nbsp;<span class="builtintype" id="2352100">int</span><span class="op" id="2352103">,</span>&nbsp;<span class="ident" id="2352105">err</span>&nbsp;<span class="builtintype" id="2352109">error</span><span class="op" id="2352114">)</span>&nbsp;<span class="op" id="2352116">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352119">if</span>&nbsp;<span class="ident" id="2352122">needsMaxRW</span>&nbsp;<span class="op" id="2352133">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2352136">len</span><span class="op" id="2352139">(</span><span class="ident" id="2352140">b</span><span class="op" id="2352141">)</span>&nbsp;<span class="op" id="2352143">&gt;</span>&nbsp;<span class="ident" id="2352145">maxRW</span>&nbsp;<span class="op" id="2352151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2352155">b</span>&nbsp;<span class="op" id="2352157">=</span>&nbsp;<span class="ident" id="2352159">b</span><span class="op" id="2352160">[</span><span class="op" id="2352161">:</span><span class="ident" id="2352162">maxRW</span><span class="op" id="2352167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2352170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352173">return</span>&nbsp;<span class="ident" id="2352180">fixCount</span><span class="op" id="2352188">(</span><span class="ident" id="2352189">syscall</span><span class="op" id="2352196">.</span><span class="ident" id="2352197">Pwrite</span><span class="op" id="2352203">(</span><span class="ident" id="2352204">f</span><span class="op" id="2352205">.</span><span class="ident" id="2352206">fd</span><span class="op" id="2352208">,</span>&nbsp;<span class="ident" id="2352210">b</span><span class="op" id="2352211">,</span>&nbsp;<span class="ident" id="2352213">off</span><span class="op" id="2352216">)</span><span class="op" id="2352217">)</span><br>
<span class="lineno"></span><span class="op" id="2352219">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2352222">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2352304">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2352380">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2352448">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2352499">func</span>&nbsp;<span class="op" id="2352504">(</span><span class="ident" id="2352505">f</span>&nbsp;<span class="op" id="2352507">*</span><span class="ident" id="2352508">File</span><span class="op" id="2352512">)</span>&nbsp;<span class="ident" id="2352514">seek</span><span class="op" id="2352518">(</span><span class="ident" id="2352519">offset</span>&nbsp;<span class="ident" id="2352526">int64</span><span class="op" id="2352531">,</span>&nbsp;<span class="ident" id="2352533">whence</span>&nbsp;<span class="builtintype" id="2352540">int</span><span class="op" id="2352543">)</span>&nbsp;<span class="op" id="2352545">(</span><span class="ident" id="2352546">ret</span>&nbsp;<span class="ident" id="2352550">int64</span><span class="op" id="2352555">,</span>&nbsp;<span class="ident" id="2352557">err</span>&nbsp;<span class="builtintype" id="2352561">error</span><span class="op" id="2352566">)</span>&nbsp;<span class="op" id="2352568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352571">return</span>&nbsp;<span class="ident" id="2352578">syscall</span><span class="op" id="2352585">.</span><span class="ident" id="2352586">Seek</span><span class="op" id="2352590">(</span><span class="ident" id="2352591">f</span><span class="op" id="2352592">.</span><span class="ident" id="2352593">fd</span><span class="op" id="2352595">,</span>&nbsp;<span class="ident" id="2352597">offset</span><span class="op" id="2352603">,</span>&nbsp;<span class="ident" id="2352605">whence</span><span class="op" id="2352611">)</span><br>
<span class="lineno"></span><span class="op" id="2352613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2352616">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2352664">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2352741">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2352797">func</span>&nbsp;<span class="ident" id="2352802">Truncate</span><span class="op" id="2352810">(</span><span class="ident" id="2352811">name</span>&nbsp;<span class="builtintype" id="2352816">string</span><span class="op" id="2352822">,</span>&nbsp;<span class="ident" id="2352824">size</span>&nbsp;<span class="ident" id="2352829">int64</span><span class="op" id="2352834">)</span>&nbsp;<span class="builtintype" id="2352836">error</span>&nbsp;<span class="op" id="2352842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352845">if</span>&nbsp;<span class="ident" id="2352848">e</span>&nbsp;<span class="op" id="2352850">:=</span>&nbsp;<span class="ident" id="2352853">syscall</span><span class="op" id="2352860">.</span><span class="ident" id="2352861">Truncate</span><span class="op" id="2352869">(</span><span class="ident" id="2352870">name</span><span class="op" id="2352874">,</span>&nbsp;<span class="ident" id="2352876">size</span><span class="op" id="2352880">)</span><span class="op" id="2352881">;</span>&nbsp;<span class="ident" id="2352883">e</span>&nbsp;<span class="op" id="2352885">!=</span>&nbsp;<span class="builtintype" id="2352888">nil</span>&nbsp;<span class="op" id="2352892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352896">return</span>&nbsp;<span class="op" id="2352903">&amp;</span><span class="ident" id="2352904">PathError</span><span class="op" id="2352913">{</span><span class="string" id="2352914">&#34;truncate&#34;</span><span class="op" id="2352924">,</span>&nbsp;<span class="ident" id="2352926">name</span><span class="op" id="2352930">,</span>&nbsp;<span class="ident" id="2352932">e</span><span class="op" id="2352933">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2352936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2352939">return</span>&nbsp;<span class="builtintype" id="2352946">nil</span><br>
<span class="lineno"></span><span class="op" id="2352950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2352953">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2353000">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2353056">func</span>&nbsp;<span class="ident" id="2353061">Remove</span><span class="op" id="2353067">(</span><span class="ident" id="2353068">name</span>&nbsp;<span class="builtintype" id="2353073">string</span><span class="op" id="2353079">)</span>&nbsp;<span class="builtintype" id="2353081">error</span>&nbsp;<span class="op" id="2353087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353090">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353134">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353175">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353219">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2353256">e</span>&nbsp;<span class="op" id="2353258">:=</span>&nbsp;<span class="ident" id="2353261">syscall</span><span class="op" id="2353268">.</span><span class="ident" id="2353269">Unlink</span><span class="op" id="2353275">(</span><span class="ident" id="2353276">name</span><span class="op" id="2353280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353283">if</span>&nbsp;<span class="ident" id="2353286">e</span>&nbsp;<span class="op" id="2353288">==</span>&nbsp;<span class="builtintype" id="2353291">nil</span>&nbsp;<span class="op" id="2353295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353299">return</span>&nbsp;<span class="builtintype" id="2353306">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2353311">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2353314">e1</span>&nbsp;<span class="op" id="2353317">:=</span>&nbsp;<span class="ident" id="2353320">syscall</span><span class="op" id="2353327">.</span><span class="ident" id="2353328">Rmdir</span><span class="op" id="2353333">(</span><span class="ident" id="2353334">name</span><span class="op" id="2353338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353341">if</span>&nbsp;<span class="ident" id="2353344">e1</span>&nbsp;<span class="op" id="2353347">==</span>&nbsp;<span class="builtintype" id="2353350">nil</span>&nbsp;<span class="op" id="2353354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353358">return</span>&nbsp;<span class="builtintype" id="2353365">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2353370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353374">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353425">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353474">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353523">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353572">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353626">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353677">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353732">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2353781">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353812">if</span>&nbsp;<span class="ident" id="2353815">e1</span>&nbsp;<span class="op" id="2353818">!=</span>&nbsp;<span class="ident" id="2353821">syscall</span><span class="op" id="2353828">.</span><span class="ident" id="2353829">ENOTDIR</span>&nbsp;<span class="op" id="2353837">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2353841">e</span>&nbsp;<span class="op" id="2353843">=</span>&nbsp;<span class="ident" id="2353845">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2353849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2353852">return</span>&nbsp;<span class="op" id="2353859">&amp;</span><span class="ident" id="2353860">PathError</span><span class="op" id="2353869">{</span><span class="string" id="2353870">&#34;remove&#34;</span><span class="op" id="2353878">,</span>&nbsp;<span class="ident" id="2353880">name</span><span class="op" id="2353884">,</span>&nbsp;<span class="ident" id="2353886">e</span><span class="op" id="2353887">}</span><br>
<span class="lineno"></span><span class="op" id="2353889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2353892">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2353975">func</span>&nbsp;<span class="ident" id="2353980">basename</span><span class="op" id="2353988">(</span><span class="ident" id="2353989">name</span>&nbsp;<span class="builtintype" id="2353994">string</span><span class="op" id="2354000">)</span>&nbsp;<span class="builtintype" id="2354002">string</span>&nbsp;<span class="op" id="2354009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354012">i</span>&nbsp;<span class="op" id="2354014">:=</span>&nbsp;<span class="builtinfunc" id="2354017">len</span><span class="op" id="2354020">(</span><span class="ident" id="2354021">name</span><span class="op" id="2354025">)</span>&nbsp;<span class="op" id="2354027">-</span>&nbsp;<span class="num" id="2354029">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2354032">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354060">for</span>&nbsp;<span class="op" id="2354064">;</span>&nbsp;<span class="ident" id="2354066">i</span>&nbsp;<span class="op" id="2354068">&gt;</span>&nbsp;<span class="num" id="2354070">0</span>&nbsp;<span class="op" id="2354072">&amp;&amp;</span>&nbsp;<span class="ident" id="2354075">name</span><span class="op" id="2354079">[</span><span class="ident" id="2354080">i</span><span class="op" id="2354081">]</span>&nbsp;<span class="op" id="2354083">==</span>&nbsp;<span class="string" id="2354086">&#39;/&#39;</span><span class="op" id="2354089">;</span>&nbsp;<span class="ident" id="2354091">i</span><span class="op" id="2354092">--</span>&nbsp;<span class="op" id="2354095">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354099">name</span>&nbsp;<span class="op" id="2354104">=</span>&nbsp;<span class="ident" id="2354106">name</span><span class="op" id="2354110">[</span><span class="op" id="2354111">:</span><span class="ident" id="2354112">i</span><span class="op" id="2354113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2354119">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354153">for</span>&nbsp;<span class="ident" id="2354157">i</span><span class="op" id="2354158">--</span><span class="op" id="2354160">;</span>&nbsp;<span class="ident" id="2354162">i</span>&nbsp;<span class="op" id="2354164">&gt;=</span>&nbsp;<span class="num" id="2354167">0</span><span class="op" id="2354168">;</span>&nbsp;<span class="ident" id="2354170">i</span><span class="op" id="2354171">--</span>&nbsp;<span class="op" id="2354174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354178">if</span>&nbsp;<span class="ident" id="2354181">name</span><span class="op" id="2354185">[</span><span class="ident" id="2354186">i</span><span class="op" id="2354187">]</span>&nbsp;<span class="op" id="2354189">==</span>&nbsp;<span class="string" id="2354192">&#39;/&#39;</span>&nbsp;<span class="op" id="2354196">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354201">name</span>&nbsp;<span class="op" id="2354206">=</span>&nbsp;<span class="ident" id="2354208">name</span><span class="op" id="2354212">[</span><span class="ident" id="2354213">i</span><span class="op" id="2354214">+</span><span class="num" id="2354215">1</span><span class="op" id="2354216">:</span><span class="op" id="2354217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354222">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354237">return</span>&nbsp;<span class="ident" id="2354244">name</span><br>
<span class="lineno"></span><span class="op" id="2354249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2354252">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2354321">func</span>&nbsp;<span class="ident" id="2354326">TempDir</span><span class="op" id="2354333">(</span><span class="op" id="2354334">)</span>&nbsp;<span class="builtintype" id="2354336">string</span>&nbsp;<span class="op" id="2354343">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354346">dir</span>&nbsp;<span class="op" id="2354350">:=</span>&nbsp;<span class="ident" id="2354353">Getenv</span><span class="op" id="2354359">(</span><span class="string" id="2354360">&#34;TMPDIR&#34;</span><span class="op" id="2354368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354371">if</span>&nbsp;<span class="ident" id="2354374">dir</span>&nbsp;<span class="op" id="2354378">==</span>&nbsp;<span class="string" id="2354381">&#34;&#34;</span>&nbsp;<span class="op" id="2354384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354388">if</span>&nbsp;<span class="ident" id="2354391">runtime</span><span class="op" id="2354398">.</span><span class="ident" id="2354399">GOOS</span>&nbsp;<span class="op" id="2354404">==</span>&nbsp;<span class="string" id="2354407">&#34;android&#34;</span>&nbsp;<span class="op" id="2354417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354422">dir</span>&nbsp;<span class="op" id="2354426">=</span>&nbsp;<span class="string" id="2354428">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354448">}</span>&nbsp;<span class="keyword" id="2354450">else</span>&nbsp;<span class="op" id="2354455">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354460">dir</span>&nbsp;<span class="op" id="2354464">=</span>&nbsp;<span class="string" id="2354466">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354481">return</span>&nbsp;<span class="ident" id="2354488">dir</span><br>
<span class="lineno"></span><span class="op" id="2354492">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2354495">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2354555">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2354611">func</span>&nbsp;<span class="ident" id="2354616">Link</span><span class="op" id="2354620">(</span><span class="ident" id="2354621">oldname</span><span class="op" id="2354628">,</span>&nbsp;<span class="ident" id="2354630">newname</span>&nbsp;<span class="builtintype" id="2354638">string</span><span class="op" id="2354644">)</span>&nbsp;<span class="builtintype" id="2354646">error</span>&nbsp;<span class="op" id="2354652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354655">e</span>&nbsp;<span class="op" id="2354657">:=</span>&nbsp;<span class="ident" id="2354660">syscall</span><span class="op" id="2354667">.</span><span class="ident" id="2354668">Link</span><span class="op" id="2354672">(</span><span class="ident" id="2354673">oldname</span><span class="op" id="2354680">,</span>&nbsp;<span class="ident" id="2354682">newname</span><span class="op" id="2354689">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354692">if</span>&nbsp;<span class="ident" id="2354695">e</span>&nbsp;<span class="op" id="2354697">!=</span>&nbsp;<span class="builtintype" id="2354700">nil</span>&nbsp;<span class="op" id="2354704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354708">return</span>&nbsp;<span class="op" id="2354715">&amp;</span><span class="ident" id="2354716">LinkError</span><span class="op" id="2354725">{</span><span class="string" id="2354726">&#34;link&#34;</span><span class="op" id="2354732">,</span>&nbsp;<span class="ident" id="2354734">oldname</span><span class="op" id="2354741">,</span>&nbsp;<span class="ident" id="2354743">newname</span><span class="op" id="2354750">,</span>&nbsp;<span class="ident" id="2354752">e</span><span class="op" id="2354753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2354756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354759">return</span>&nbsp;<span class="builtintype" id="2354766">nil</span><br>
<span class="lineno"></span><span class="op" id="2354770">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2354773">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2354831">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2354887">func</span>&nbsp;<span class="ident" id="2354892">Symlink</span><span class="op" id="2354899">(</span><span class="ident" id="2354900">oldname</span><span class="op" id="2354907">,</span>&nbsp;<span class="ident" id="2354909">newname</span>&nbsp;<span class="builtintype" id="2354917">string</span><span class="op" id="2354923">)</span>&nbsp;<span class="builtintype" id="2354925">error</span>&nbsp;<span class="op" id="2354931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2354934">e</span>&nbsp;<span class="op" id="2354936">:=</span>&nbsp;<span class="ident" id="2354939">syscall</span><span class="op" id="2354946">.</span><span class="ident" id="2354947">Symlink</span><span class="op" id="2354954">(</span><span class="ident" id="2354955">oldname</span><span class="op" id="2354962">,</span>&nbsp;<span class="ident" id="2354964">newname</span><span class="op" id="2354971">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354974">if</span>&nbsp;<span class="ident" id="2354977">e</span>&nbsp;<span class="op" id="2354979">!=</span>&nbsp;<span class="builtintype" id="2354982">nil</span>&nbsp;<span class="op" id="2354986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2354990">return</span>&nbsp;<span class="op" id="2354997">&amp;</span><span class="ident" id="2354998">LinkError</span><span class="op" id="2355007">{</span><span class="string" id="2355008">&#34;symlink&#34;</span><span class="op" id="2355017">,</span>&nbsp;<span class="ident" id="2355019">oldname</span><span class="op" id="2355026">,</span>&nbsp;<span class="ident" id="2355028">newname</span><span class="op" id="2355035">,</span>&nbsp;<span class="ident" id="2355037">e</span><span class="op" id="2355038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2355041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2355044">return</span>&nbsp;<span class="builtintype" id="2355051">nil</span><br>
<span class="lineno"></span><span class="op" id="2355055">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
