<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html" class="current">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4687711">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4687766">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4687820">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4687871">package</span>&nbsp;<span class="ident" id="4687879">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687885">import</span>&nbsp;<span class="op" id="4687892">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687895">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687909">&#34;encoding/asn1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687926">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687936">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4687947">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4687950">//&nbsp;pkcs1PrivateKey&nbsp;is&nbsp;a&nbsp;structure&nbsp;which&nbsp;mirrors&nbsp;the&nbsp;PKCS#1&nbsp;ASN.1&nbsp;for&nbsp;an&nbsp;RSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4688039">type</span>&nbsp;<span class="ident" id="4688044">pkcs1PrivateKey</span>&nbsp;<span class="keyword" id="4688060">struct</span>&nbsp;<span class="op" id="4688067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688070">Version</span>&nbsp;<span class="builtintype" id="4688078">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688083">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688091">*</span><span class="ident" id="4688092">big</span><span class="op" id="4688095">.</span><span class="ident" id="4688096">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688101">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4688109">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688114">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688122">*</span><span class="ident" id="4688123">big</span><span class="op" id="4688126">.</span><span class="ident" id="4688127">Int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688132">P</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688140">*</span><span class="ident" id="4688141">big</span><span class="op" id="4688144">.</span><span class="ident" id="4688145">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688150">Q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4688158">*</span><span class="ident" id="4688159">big</span><span class="op" id="4688162">.</span><span class="ident" id="4688163">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688168">//&nbsp;We&nbsp;ignore&nbsp;these&nbsp;values,&nbsp;if&nbsp;present,&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688241">Dp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4688246">*</span><span class="ident" id="4688247">big</span><span class="op" id="4688250">.</span><span class="ident" id="4688251">Int</span>&nbsp;<span class="string" id="4688255">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688274">Dq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4688279">*</span><span class="ident" id="4688280">big</span><span class="op" id="4688283">.</span><span class="ident" id="4688284">Int</span>&nbsp;<span class="string" id="4688288">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688307">Qinv</span>&nbsp;<span class="op" id="4688312">*</span><span class="ident" id="4688313">big</span><span class="op" id="4688316">.</span><span class="ident" id="4688317">Int</span>&nbsp;<span class="string" id="4688321">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688341">AdditionalPrimes</span>&nbsp;<span class="op" id="4688358">[</span><span class="op" id="4688359">]</span><span class="ident" id="4688360">pkcs1AdditionalRSAPrime</span>&nbsp;<span class="string" id="4688384">`asn1:&#34;optional,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="op" id="4688412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4688415">type</span>&nbsp;<span class="ident" id="4688420">pkcs1AdditionalRSAPrime</span>&nbsp;<span class="keyword" id="4688444">struct</span>&nbsp;<span class="op" id="4688451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688454">Prime</span>&nbsp;<span class="op" id="4688460">*</span><span class="ident" id="4688461">big</span><span class="op" id="4688464">.</span><span class="ident" id="4688465">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4688471">//&nbsp;We&nbsp;ignore&nbsp;these&nbsp;values&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688531">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4688537">*</span><span class="ident" id="4688538">big</span><span class="op" id="4688541">.</span><span class="ident" id="4688542">Int</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688547">Coeff</span>&nbsp;<span class="op" id="4688553">*</span><span class="ident" id="4688554">big</span><span class="op" id="4688557">.</span><span class="ident" id="4688558">Int</span><br>
<span class="lineno"></span><span class="op" id="4688562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4688565">//&nbsp;ParsePKCS1PrivateKey&nbsp;returns&nbsp;an&nbsp;RSA&nbsp;private&nbsp;key&nbsp;from&nbsp;its&nbsp;ASN.1&nbsp;PKCS#1&nbsp;DER&nbsp;encoded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="4688656">func</span>&nbsp;<span class="ident" id="4688661">ParsePKCS1PrivateKey</span><span class="op" id="4688681">(</span><span class="ident" id="4688682">der</span>&nbsp;<span class="op" id="4688686">[</span><span class="op" id="4688687">]</span><span class="builtintype" id="4688688">byte</span><span class="op" id="4688692">)</span>&nbsp;<span class="op" id="4688694">(</span><span class="ident" id="4688695">key</span>&nbsp;<span class="op" id="4688699">*</span><span class="ident" id="4688700">rsa</span><span class="op" id="4688703">.</span><span class="ident" id="4688704">PrivateKey</span><span class="op" id="4688714">,</span>&nbsp;<span class="ident" id="4688716">err</span>&nbsp;<span class="builtintype" id="4688720">error</span><span class="op" id="4688725">)</span>&nbsp;<span class="op" id="4688727">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688730">var</span>&nbsp;<span class="ident" id="4688734">priv</span>&nbsp;<span class="ident" id="4688739">pkcs1PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688756">rest</span><span class="op" id="4688760">,</span>&nbsp;<span class="ident" id="4688762">err</span>&nbsp;<span class="op" id="4688766">:=</span>&nbsp;<span class="ident" id="4688769">asn1</span><span class="op" id="4688773">.</span><span class="ident" id="4688774">Unmarshal</span><span class="op" id="4688783">(</span><span class="ident" id="4688784">der</span><span class="op" id="4688787">,</span>&nbsp;<span class="op" id="4688789">&amp;</span><span class="ident" id="4688790">priv</span><span class="op" id="4688794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688797">if</span>&nbsp;<span class="builtinfunc" id="4688800">len</span><span class="op" id="4688803">(</span><span class="ident" id="4688804">rest</span><span class="op" id="4688808">)</span>&nbsp;<span class="op" id="4688810">&gt;</span>&nbsp;<span class="num" id="4688812">0</span>&nbsp;<span class="op" id="4688814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4688818">err</span>&nbsp;<span class="op" id="4688822">=</span>&nbsp;<span class="ident" id="4688824">asn1</span><span class="op" id="4688828">.</span><span class="ident" id="4688829">SyntaxError</span><span class="op" id="4688840">{</span><span class="ident" id="4688841">Msg</span><span class="op" id="4688844">:</span>&nbsp;<span class="string" id="4688846">&#34;trailing&nbsp;data&#34;</span><span class="op" id="4688861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688865">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688876">if</span>&nbsp;<span class="ident" id="4688879">err</span>&nbsp;<span class="op" id="4688883">!=</span>&nbsp;<span class="ident" id="4688886">nil</span>&nbsp;<span class="op" id="4688890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688906">if</span>&nbsp;<span class="ident" id="4688909">priv</span><span class="op" id="4688913">.</span><span class="ident" id="4688914">Version</span>&nbsp;<span class="op" id="4688922">&gt;</span>&nbsp;<span class="num" id="4688924">1</span>&nbsp;<span class="op" id="4688926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688930">return</span>&nbsp;<span class="ident" id="4688937">nil</span><span class="op" id="4688940">,</span>&nbsp;<span class="ident" id="4688942">errors</span><span class="op" id="4688948">.</span><span class="ident" id="4688949">New</span><span class="op" id="4688952">(</span><span class="string" id="4688953">&#34;x509:&nbsp;unsupported&nbsp;private&nbsp;key&nbsp;version&#34;</span><span class="op" id="4688992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4688995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4688999">if</span>&nbsp;<span class="ident" id="4689002">priv</span><span class="op" id="4689006">.</span><span class="ident" id="4689007">N</span><span class="op" id="4689008">.</span><span class="ident" id="4689009">Sign</span><span class="op" id="4689013">(</span><span class="op" id="4689014">)</span>&nbsp;<span class="op" id="4689016">&lt;=</span>&nbsp;<span class="num" id="4689019">0</span>&nbsp;<span class="op" id="4689021">||</span>&nbsp;<span class="ident" id="4689024">priv</span><span class="op" id="4689028">.</span><span class="ident" id="4689029">D</span><span class="op" id="4689030">.</span><span class="ident" id="4689031">Sign</span><span class="op" id="4689035">(</span><span class="op" id="4689036">)</span>&nbsp;<span class="op" id="4689038">&lt;=</span>&nbsp;<span class="num" id="4689041">0</span>&nbsp;<span class="op" id="4689043">||</span>&nbsp;<span class="ident" id="4689046">priv</span><span class="op" id="4689050">.</span><span class="ident" id="4689051">P</span><span class="op" id="4689052">.</span><span class="ident" id="4689053">Sign</span><span class="op" id="4689057">(</span><span class="op" id="4689058">)</span>&nbsp;<span class="op" id="4689060">&lt;=</span>&nbsp;<span class="num" id="4689063">0</span>&nbsp;<span class="op" id="4689065">||</span>&nbsp;<span class="ident" id="4689068">priv</span><span class="op" id="4689072">.</span><span class="ident" id="4689073">Q</span><span class="op" id="4689074">.</span><span class="ident" id="4689075">Sign</span><span class="op" id="4689079">(</span><span class="op" id="4689080">)</span>&nbsp;<span class="op" id="4689082">&lt;=</span>&nbsp;<span class="num" id="4689085">0</span>&nbsp;<span class="op" id="4689087">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689091">return</span>&nbsp;<span class="ident" id="4689098">nil</span><span class="op" id="4689101">,</span>&nbsp;<span class="ident" id="4689103">errors</span><span class="op" id="4689109">.</span><span class="ident" id="4689110">New</span><span class="op" id="4689113">(</span><span class="string" id="4689114">&#34;x509:&nbsp;private&nbsp;key&nbsp;contains&nbsp;zero&nbsp;or&nbsp;negative&nbsp;value&#34;</span><span class="op" id="4689165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689172">key</span>&nbsp;<span class="op" id="4689176">=</span>&nbsp;<span class="builtinfunc" id="4689178">new</span><span class="op" id="4689181">(</span><span class="ident" id="4689182">rsa</span><span class="op" id="4689185">.</span><span class="ident" id="4689186">PrivateKey</span><span class="op" id="4689196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689199">key</span><span class="op" id="4689202">.</span><span class="ident" id="4689203">PublicKey</span>&nbsp;<span class="op" id="4689213">=</span>&nbsp;<span class="ident" id="4689215">rsa</span><span class="op" id="4689218">.</span><span class="ident" id="4689219">PublicKey</span><span class="op" id="4689228">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689232">E</span><span class="op" id="4689233">:</span>&nbsp;<span class="ident" id="4689235">priv</span><span class="op" id="4689239">.</span><span class="ident" id="4689240">E</span><span class="op" id="4689241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689245">N</span><span class="op" id="4689246">:</span>&nbsp;<span class="ident" id="4689248">priv</span><span class="op" id="4689252">.</span><span class="ident" id="4689253">N</span><span class="op" id="4689254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689261">key</span><span class="op" id="4689264">.</span><span class="ident" id="4689265">D</span>&nbsp;<span class="op" id="4689267">=</span>&nbsp;<span class="ident" id="4689269">priv</span><span class="op" id="4689273">.</span><span class="ident" id="4689274">D</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689277">key</span><span class="op" id="4689280">.</span><span class="ident" id="4689281">Primes</span>&nbsp;<span class="op" id="4689288">=</span>&nbsp;<span class="builtinfunc" id="4689290">make</span><span class="op" id="4689294">(</span><span class="op" id="4689295">[</span><span class="op" id="4689296">]</span><span class="op" id="4689297">*</span><span class="ident" id="4689298">big</span><span class="op" id="4689301">.</span><span class="ident" id="4689302">Int</span><span class="op" id="4689305">,</span>&nbsp;<span class="num" id="4689307">2</span><span class="op" id="4689308">+</span><span class="builtinfunc" id="4689309">len</span><span class="op" id="4689312">(</span><span class="ident" id="4689313">priv</span><span class="op" id="4689317">.</span><span class="ident" id="4689318">AdditionalPrimes</span><span class="op" id="4689334">)</span><span class="op" id="4689335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689338">key</span><span class="op" id="4689341">.</span><span class="ident" id="4689342">Primes</span><span class="op" id="4689348">[</span><span class="num" id="4689349">0</span><span class="op" id="4689350">]</span>&nbsp;<span class="op" id="4689352">=</span>&nbsp;<span class="ident" id="4689354">priv</span><span class="op" id="4689358">.</span><span class="ident" id="4689359">P</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689362">key</span><span class="op" id="4689365">.</span><span class="ident" id="4689366">Primes</span><span class="op" id="4689372">[</span><span class="num" id="4689373">1</span><span class="op" id="4689374">]</span>&nbsp;<span class="op" id="4689376">=</span>&nbsp;<span class="ident" id="4689378">priv</span><span class="op" id="4689382">.</span><span class="ident" id="4689383">Q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689386">for</span>&nbsp;<span class="ident" id="4689390">i</span><span class="op" id="4689391">,</span>&nbsp;<span class="ident" id="4689393">a</span>&nbsp;<span class="op" id="4689395">:=</span>&nbsp;<span class="keyword" id="4689398">range</span>&nbsp;<span class="ident" id="4689404">priv</span><span class="op" id="4689408">.</span><span class="ident" id="4689409">AdditionalPrimes</span>&nbsp;<span class="op" id="4689426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689430">if</span>&nbsp;<span class="ident" id="4689433">a</span><span class="op" id="4689434">.</span><span class="ident" id="4689435">Prime</span><span class="op" id="4689440">.</span><span class="ident" id="4689441">Sign</span><span class="op" id="4689445">(</span><span class="op" id="4689446">)</span>&nbsp;<span class="op" id="4689448">&lt;=</span>&nbsp;<span class="num" id="4689451">0</span>&nbsp;<span class="op" id="4689453">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689458">return</span>&nbsp;<span class="ident" id="4689465">nil</span><span class="op" id="4689468">,</span>&nbsp;<span class="ident" id="4689470">errors</span><span class="op" id="4689476">.</span><span class="ident" id="4689477">New</span><span class="op" id="4689480">(</span><span class="string" id="4689481">&#34;x509:&nbsp;private&nbsp;key&nbsp;contains&nbsp;zero&nbsp;or&nbsp;negative&nbsp;prime&#34;</span><span class="op" id="4689532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689540">key</span><span class="op" id="4689543">.</span><span class="ident" id="4689544">Primes</span><span class="op" id="4689550">[</span><span class="ident" id="4689551">i</span><span class="op" id="4689552">+</span><span class="num" id="4689553">2</span><span class="op" id="4689554">]</span>&nbsp;<span class="op" id="4689556">=</span>&nbsp;<span class="ident" id="4689558">a</span><span class="op" id="4689559">.</span><span class="ident" id="4689560">Prime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4689568">//&nbsp;We&nbsp;ignore&nbsp;the&nbsp;other&nbsp;two&nbsp;values&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4689631">//&nbsp;them&nbsp;as&nbsp;needed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689655">err</span>&nbsp;<span class="op" id="4689659">=</span>&nbsp;<span class="ident" id="4689661">key</span><span class="op" id="4689664">.</span><span class="ident" id="4689665">Validate</span><span class="op" id="4689673">(</span><span class="op" id="4689674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689677">if</span>&nbsp;<span class="ident" id="4689680">err</span>&nbsp;<span class="op" id="4689684">!=</span>&nbsp;<span class="ident" id="4689687">nil</span>&nbsp;<span class="op" id="4689691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689695">return</span>&nbsp;<span class="ident" id="4689702">nil</span><span class="op" id="4689705">,</span>&nbsp;<span class="ident" id="4689707">err</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689715">key</span><span class="op" id="4689718">.</span><span class="ident" id="4689719">Precompute</span><span class="op" id="4689729">(</span><span class="op" id="4689730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689734">return</span><br>
<span class="lineno"></span><span class="op" id="4689741">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4689744">//&nbsp;MarshalPKCS1PrivateKey&nbsp;converts&nbsp;a&nbsp;private&nbsp;key&nbsp;to&nbsp;ASN.1&nbsp;DER&nbsp;encoded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="4689820">func</span>&nbsp;<span class="ident" id="4689825">MarshalPKCS1PrivateKey</span><span class="op" id="4689847">(</span><span class="ident" id="4689848">key</span>&nbsp;<span class="op" id="4689852">*</span><span class="ident" id="4689853">rsa</span><span class="op" id="4689856">.</span><span class="ident" id="4689857">PrivateKey</span><span class="op" id="4689867">)</span>&nbsp;<span class="op" id="4689869">[</span><span class="op" id="4689870">]</span><span class="builtintype" id="4689871">byte</span>&nbsp;<span class="op" id="4689876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689879">key</span><span class="op" id="4689882">.</span><span class="ident" id="4689883">Precompute</span><span class="op" id="4689893">(</span><span class="op" id="4689894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689898">version</span>&nbsp;<span class="op" id="4689906">:=</span>&nbsp;<span class="num" id="4689909">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4689912">if</span>&nbsp;<span class="builtinfunc" id="4689915">len</span><span class="op" id="4689918">(</span><span class="ident" id="4689919">key</span><span class="op" id="4689922">.</span><span class="ident" id="4689923">Primes</span><span class="op" id="4689929">)</span>&nbsp;<span class="op" id="4689931">&gt;</span>&nbsp;<span class="num" id="4689933">2</span>&nbsp;<span class="op" id="4689935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689939">version</span>&nbsp;<span class="op" id="4689947">=</span>&nbsp;<span class="num" id="4689949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4689952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689956">priv</span>&nbsp;<span class="op" id="4689961">:=</span>&nbsp;<span class="ident" id="4689964">pkcs1PrivateKey</span><span class="op" id="4689979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4689983">Version</span><span class="op" id="4689990">:</span>&nbsp;<span class="ident" id="4689992">version</span><span class="op" id="4689999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690003">N</span><span class="op" id="4690004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690012">key</span><span class="op" id="4690015">.</span><span class="ident" id="4690016">N</span><span class="op" id="4690017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690021">E</span><span class="op" id="4690022">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690030">key</span><span class="op" id="4690033">.</span><span class="ident" id="4690034">PublicKey</span><span class="op" id="4690043">.</span><span class="ident" id="4690044">E</span><span class="op" id="4690045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690049">D</span><span class="op" id="4690050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690058">key</span><span class="op" id="4690061">.</span><span class="ident" id="4690062">D</span><span class="op" id="4690063">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690067">P</span><span class="op" id="4690068">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690076">key</span><span class="op" id="4690079">.</span><span class="ident" id="4690080">Primes</span><span class="op" id="4690086">[</span><span class="num" id="4690087">0</span><span class="op" id="4690088">]</span><span class="op" id="4690089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690093">Q</span><span class="op" id="4690094">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690102">key</span><span class="op" id="4690105">.</span><span class="ident" id="4690106">Primes</span><span class="op" id="4690112">[</span><span class="num" id="4690113">1</span><span class="op" id="4690114">]</span><span class="op" id="4690115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690119">Dp</span><span class="op" id="4690121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690128">key</span><span class="op" id="4690131">.</span><span class="ident" id="4690132">Precomputed</span><span class="op" id="4690143">.</span><span class="ident" id="4690144">Dp</span><span class="op" id="4690146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690150">Dq</span><span class="op" id="4690152">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690159">key</span><span class="op" id="4690162">.</span><span class="ident" id="4690163">Precomputed</span><span class="op" id="4690174">.</span><span class="ident" id="4690175">Dq</span><span class="op" id="4690177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690181">Qinv</span><span class="op" id="4690185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4690190">key</span><span class="op" id="4690193">.</span><span class="ident" id="4690194">Precomputed</span><span class="op" id="4690205">.</span><span class="ident" id="4690206">Qinv</span><span class="op" id="4690210">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690217">priv</span><span class="op" id="4690221">.</span><span class="ident" id="4690222">AdditionalPrimes</span>&nbsp;<span class="op" id="4690239">=</span>&nbsp;<span class="builtinfunc" id="4690241">make</span><span class="op" id="4690245">(</span><span class="op" id="4690246">[</span><span class="op" id="4690247">]</span><span class="ident" id="4690248">pkcs1AdditionalRSAPrime</span><span class="op" id="4690271">,</span>&nbsp;<span class="builtinfunc" id="4690273">len</span><span class="op" id="4690276">(</span><span class="ident" id="4690277">key</span><span class="op" id="4690280">.</span><span class="ident" id="4690281">Precomputed</span><span class="op" id="4690292">.</span><span class="ident" id="4690293">CRTValues</span><span class="op" id="4690302">)</span><span class="op" id="4690303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690306">for</span>&nbsp;<span class="ident" id="4690310">i</span><span class="op" id="4690311">,</span>&nbsp;<span class="ident" id="4690313">values</span>&nbsp;<span class="op" id="4690320">:=</span>&nbsp;<span class="keyword" id="4690323">range</span>&nbsp;<span class="ident" id="4690329">key</span><span class="op" id="4690332">.</span><span class="ident" id="4690333">Precomputed</span><span class="op" id="4690344">.</span><span class="ident" id="4690345">CRTValues</span>&nbsp;<span class="op" id="4690355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690359">priv</span><span class="op" id="4690363">.</span><span class="ident" id="4690364">AdditionalPrimes</span><span class="op" id="4690380">[</span><span class="ident" id="4690381">i</span><span class="op" id="4690382">]</span><span class="op" id="4690383">.</span><span class="ident" id="4690384">Prime</span>&nbsp;<span class="op" id="4690390">=</span>&nbsp;<span class="ident" id="4690392">key</span><span class="op" id="4690395">.</span><span class="ident" id="4690396">Primes</span><span class="op" id="4690402">[</span><span class="num" id="4690403">2</span><span class="op" id="4690404">+</span><span class="ident" id="4690405">i</span><span class="op" id="4690406">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690410">priv</span><span class="op" id="4690414">.</span><span class="ident" id="4690415">AdditionalPrimes</span><span class="op" id="4690431">[</span><span class="ident" id="4690432">i</span><span class="op" id="4690433">]</span><span class="op" id="4690434">.</span><span class="ident" id="4690435">Exp</span>&nbsp;<span class="op" id="4690439">=</span>&nbsp;<span class="ident" id="4690441">values</span><span class="op" id="4690447">.</span><span class="ident" id="4690448">Exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690454">priv</span><span class="op" id="4690458">.</span><span class="ident" id="4690459">AdditionalPrimes</span><span class="op" id="4690475">[</span><span class="ident" id="4690476">i</span><span class="op" id="4690477">]</span><span class="op" id="4690478">.</span><span class="ident" id="4690479">Coeff</span>&nbsp;<span class="op" id="4690485">=</span>&nbsp;<span class="ident" id="4690487">values</span><span class="op" id="4690493">.</span><span class="ident" id="4690494">Coeff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4690501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690505">b</span><span class="op" id="4690506">,</span>&nbsp;<span class="ident" id="4690508">_</span>&nbsp;<span class="op" id="4690510">:=</span>&nbsp;<span class="ident" id="4690513">asn1</span><span class="op" id="4690517">.</span><span class="ident" id="4690518">Marshal</span><span class="op" id="4690525">(</span><span class="ident" id="4690526">priv</span><span class="op" id="4690530">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4690533">return</span>&nbsp;<span class="ident" id="4690540">b</span><br>
<span class="lineno"></span><span class="op" id="4690542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4690545">//&nbsp;rsaPublicKey&nbsp;reflects&nbsp;the&nbsp;ASN.1&nbsp;structure&nbsp;of&nbsp;a&nbsp;PKCS#1&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4690614">type</span>&nbsp;<span class="ident" id="4690619">rsaPublicKey</span>&nbsp;<span class="keyword" id="4690632">struct</span>&nbsp;<span class="op" id="4690639">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690642">N</span>&nbsp;<span class="op" id="4690644">*</span><span class="ident" id="4690645">big</span><span class="op" id="4690648">.</span><span class="ident" id="4690649">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4690654">E</span>&nbsp;<span class="builtintype" id="4690656">int</span><br>
<span class="lineno"></span><span class="op" id="4690660">}</span>
</div>
</body>
</html>
