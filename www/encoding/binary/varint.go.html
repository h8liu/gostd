<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2810440">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2810496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2810550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2810601">package</span>&nbsp;<span class="ident" id="2810609">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2810617">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="2810679">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="2810699">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="2810773">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="2810801">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2810876">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="2810914">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2810983">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="2811056">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="2811131">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2811183">//</span><br>
<span class="lineno"></span><span class="comment" id="2811186">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="2811202">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="2811271">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="2811350">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="2811429">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2811505">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2811584">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="2811662">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2811743">import</span>&nbsp;<span class="op" id="2811750">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2811753">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2811763">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="2811768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2811771">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="2811845">const</span>&nbsp;<span class="op" id="2811851">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2811854">MaxVarintLen16</span>&nbsp;<span class="op" id="2811869">=</span>&nbsp;<span class="num" id="2811871">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2811874">MaxVarintLen32</span>&nbsp;<span class="op" id="2811889">=</span>&nbsp;<span class="num" id="2811891">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2811894">MaxVarintLen64</span>&nbsp;<span class="op" id="2811909">=</span>&nbsp;<span class="num" id="2811911">10</span><br>
<span class="lineno"></span><span class="op" id="2811914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2811917">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="2811998">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2812052">func</span>&nbsp;<span class="ident" id="2812057">PutUvarint</span><span class="op" id="2812067">(</span><span class="ident" id="2812068">buf</span>&nbsp;<span class="op" id="2812072">[</span><span class="op" id="2812073">]</span><span class="builtintype" id="2812074">byte</span><span class="op" id="2812078">,</span>&nbsp;<span class="ident" id="2812080">x</span>&nbsp;<span class="ident" id="2812082">uint64</span><span class="op" id="2812088">)</span>&nbsp;<span class="builtintype" id="2812090">int</span>&nbsp;<span class="op" id="2812094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812097">i</span>&nbsp;<span class="op" id="2812099">:=</span>&nbsp;<span class="num" id="2812102">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812105">for</span>&nbsp;<span class="ident" id="2812109"><a href="/encoding/binary/varint.go.html#2812080">x</a></span>&nbsp;<span class="op" id="2812111">&gt;=</span>&nbsp;<span class="num" id="2812114">0x80</span>&nbsp;<span class="op" id="2812119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812123"><a href="/encoding/binary/varint.go.html#2812068">buf</a></span><span class="op" id="2812126">[</span><span class="ident" id="2812127"><a href="/encoding/binary/varint.go.html#2812097">i</a></span><span class="op" id="2812128">]</span>&nbsp;<span class="op" id="2812130">=</span>&nbsp;<span class="builtintype" id="2812132">byte</span><span class="op" id="2812136">(</span><span class="ident" id="2812137"><a href="/encoding/binary/varint.go.html#2812080">x</a></span><span class="op" id="2812138">)</span>&nbsp;<span class="op" id="2812140">|</span>&nbsp;<span class="num" id="2812142">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812149"><a href="/encoding/binary/varint.go.html#2812080">x</a></span>&nbsp;<span class="op" id="2812151">&gt;&gt;=</span>&nbsp;<span class="num" id="2812155">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812159"><a href="/encoding/binary/varint.go.html#2812097">i</a></span><span class="op" id="2812160">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2812164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812167"><a href="/encoding/binary/varint.go.html#2812068">buf</a></span><span class="op" id="2812170">[</span><span class="ident" id="2812171"><a href="/encoding/binary/varint.go.html#2812097">i</a></span><span class="op" id="2812172">]</span>&nbsp;<span class="op" id="2812174">=</span>&nbsp;<span class="builtintype" id="2812176">byte</span><span class="op" id="2812180">(</span><span class="ident" id="2812181"><a href="/encoding/binary/varint.go.html#2812080">x</a></span><span class="op" id="2812182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812185">return</span>&nbsp;<span class="ident" id="2812192"><a href="/encoding/binary/varint.go.html#2812097">i</a></span>&nbsp;<span class="op" id="2812194">+</span>&nbsp;<span class="num" id="2812196">1</span><br>
<span class="lineno">50</span><span class="op" id="2812198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2812201">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2812269">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2812337">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="2812383">//</span><br>
<span class="lineno"></span><span class="comment" id="2812386">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2812411">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2812459">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2812510">//</span><br>
<span class="lineno">60</span><span class="keyword" id="2812513">func</span>&nbsp;<span class="ident" id="2812518">Uvarint</span><span class="op" id="2812525">(</span><span class="ident" id="2812526">buf</span>&nbsp;<span class="op" id="2812530">[</span><span class="op" id="2812531">]</span><span class="builtintype" id="2812532">byte</span><span class="op" id="2812536">)</span>&nbsp;<span class="op" id="2812538">(</span><span class="ident" id="2812539">uint64</span><span class="op" id="2812545">,</span>&nbsp;<span class="builtintype" id="2812547">int</span><span class="op" id="2812550">)</span>&nbsp;<span class="op" id="2812552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812555">var</span>&nbsp;<span class="ident" id="2812559">x</span>&nbsp;<span class="ident" id="2812561">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812569">var</span>&nbsp;<span class="ident" id="2812573">s</span>&nbsp;<span class="builtintype" id="2812575">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812581">for</span>&nbsp;<span class="ident" id="2812585">i</span><span class="op" id="2812586">,</span>&nbsp;<span class="ident" id="2812588">b</span>&nbsp;<span class="op" id="2812590">:=</span>&nbsp;<span class="keyword" id="2812593">range</span>&nbsp;<span class="ident" id="2812599"><a href="/encoding/binary/varint.go.html#2812526">buf</a></span>&nbsp;<span class="op" id="2812603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812607">if</span>&nbsp;<span class="ident" id="2812610"><a href="/encoding/binary/varint.go.html#2812588">b</a></span>&nbsp;<span class="op" id="2812612">&lt;</span>&nbsp;<span class="num" id="2812614">0x80</span>&nbsp;<span class="op" id="2812619">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812624">if</span>&nbsp;<span class="ident" id="2812627"><a href="/encoding/binary/varint.go.html#2812585">i</a></span>&nbsp;<span class="op" id="2812629">&gt;</span>&nbsp;<span class="num" id="2812631">9</span>&nbsp;<span class="op" id="2812633">||</span>&nbsp;<span class="ident" id="2812636"><a href="/encoding/binary/varint.go.html#2812585">i</a></span>&nbsp;<span class="op" id="2812638">==</span>&nbsp;<span class="num" id="2812641">9</span>&nbsp;<span class="op" id="2812643">&amp;&amp;</span>&nbsp;<span class="ident" id="2812646"><a href="/encoding/binary/varint.go.html#2812588">b</a></span>&nbsp;<span class="op" id="2812648">&gt;</span>&nbsp;<span class="num" id="2812650">1</span>&nbsp;<span class="op" id="2812652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812658">return</span>&nbsp;<span class="num" id="2812665">0</span><span class="op" id="2812666">,</span>&nbsp;<span class="op" id="2812668">-</span><span class="op" id="2812669">(</span><span class="ident" id="2812670"><a href="/encoding/binary/varint.go.html#2812585">i</a></span>&nbsp;<span class="op" id="2812672">+</span>&nbsp;<span class="num" id="2812674">1</span><span class="op" id="2812675">)</span>&nbsp;<span class="comment" id="2812677">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2812692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812697">return</span>&nbsp;<span class="ident" id="2812704"><a href="/encoding/binary/varint.go.html#2812559">x</a></span>&nbsp;<span class="op" id="2812706">|</span>&nbsp;<span class="ident" id="2812708">uint64</span><span class="op" id="2812714">(</span><span class="ident" id="2812715"><a href="/encoding/binary/varint.go.html#2812588">b</a></span><span class="op" id="2812716">)</span><span class="op" id="2812717">&lt;&lt;</span><span class="ident" id="2812719"><a href="/encoding/binary/varint.go.html#2812573">s</a></span><span class="op" id="2812720">,</span>&nbsp;<span class="ident" id="2812722"><a href="/encoding/binary/varint.go.html#2812585">i</a></span>&nbsp;<span class="op" id="2812724">+</span>&nbsp;<span class="num" id="2812726">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2812730">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812734"><a href="/encoding/binary/varint.go.html#2812559">x</a></span>&nbsp;<span class="op" id="2812736">|=</span>&nbsp;<span class="ident" id="2812739">uint64</span><span class="op" id="2812745">(</span><span class="ident" id="2812746"><a href="/encoding/binary/varint.go.html#2812588">b</a></span><span class="op" id="2812747">&amp;</span><span class="num" id="2812748">0x7f</span><span class="op" id="2812752">)</span>&nbsp;<span class="op" id="2812754">&lt;&lt;</span>&nbsp;<span class="ident" id="2812757"><a href="/encoding/binary/varint.go.html#2812573">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812761"><a href="/encoding/binary/varint.go.html#2812573">s</a></span>&nbsp;<span class="op" id="2812763">+=</span>&nbsp;<span class="num" id="2812766">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2812769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812772">return</span>&nbsp;<span class="num" id="2812779">0</span><span class="op" id="2812780">,</span>&nbsp;<span class="num" id="2812782">0</span><br>
<span class="lineno"></span><span class="op" id="2812784">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="2812787">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2812867">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2812920">func</span>&nbsp;<span class="ident" id="2812925">PutVarint</span><span class="op" id="2812934">(</span><span class="ident" id="2812935">buf</span>&nbsp;<span class="op" id="2812939">[</span><span class="op" id="2812940">]</span><span class="builtintype" id="2812941">byte</span><span class="op" id="2812945">,</span>&nbsp;<span class="ident" id="2812947">x</span>&nbsp;<span class="ident" id="2812949">int64</span><span class="op" id="2812954">)</span>&nbsp;<span class="builtintype" id="2812956">int</span>&nbsp;<span class="op" id="2812960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812963">ux</span>&nbsp;<span class="op" id="2812966">:=</span>&nbsp;<span class="ident" id="2812969">uint64</span><span class="op" id="2812975">(</span><span class="ident" id="2812976"><a href="/encoding/binary/varint.go.html#2812947">x</a></span><span class="op" id="2812977">)</span>&nbsp;<span class="op" id="2812979">&lt;&lt;</span>&nbsp;<span class="num" id="2812982">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2812985">if</span>&nbsp;<span class="ident" id="2812988"><a href="/encoding/binary/varint.go.html#2812947">x</a></span>&nbsp;<span class="op" id="2812990">&lt;</span>&nbsp;<span class="num" id="2812992">0</span>&nbsp;<span class="op" id="2812994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2812998"><a href="/encoding/binary/varint.go.html#2812963">ux</a></span>&nbsp;<span class="op" id="2813001">=</span>&nbsp;<span class="op" id="2813003">^</span><span class="ident" id="2813004"><a href="/encoding/binary/varint.go.html#2812963">ux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2813008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813011">return</span>&nbsp;<span class="ident" id="2813018"><a href="/encoding/binary/varint.go.html#2812057">PutUvarint</a></span><span class="op" id="2813028">(</span><span class="ident" id="2813029"><a href="/encoding/binary/varint.go.html#2812935">buf</a></span><span class="op" id="2813032">,</span>&nbsp;<span class="ident" id="2813034"><a href="/encoding/binary/varint.go.html#2812963">ux</a></span><span class="op" id="2813036">)</span><br>
<span class="lineno"></span><span class="op" id="2813038">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="2813041">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2813108">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2813176">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="2813241">//</span><br>
<span class="lineno">90</span><span class="comment" id="2813244">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2813269">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2813317">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2813368">//</span><br>
<span class="lineno"></span><span class="keyword" id="2813371">func</span>&nbsp;<span class="ident" id="2813376">Varint</span><span class="op" id="2813382">(</span><span class="ident" id="2813383">buf</span>&nbsp;<span class="op" id="2813387">[</span><span class="op" id="2813388">]</span><span class="builtintype" id="2813389">byte</span><span class="op" id="2813393">)</span>&nbsp;<span class="op" id="2813395">(</span><span class="ident" id="2813396">int64</span><span class="op" id="2813401">,</span>&nbsp;<span class="builtintype" id="2813403">int</span><span class="op" id="2813406">)</span>&nbsp;<span class="op" id="2813408">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813411">ux</span><span class="op" id="2813413">,</span>&nbsp;<span class="ident" id="2813415">n</span>&nbsp;<span class="op" id="2813417">:=</span>&nbsp;<span class="ident" id="2813420"><a href="/encoding/binary/varint.go.html#2812518">Uvarint</a></span><span class="op" id="2813427">(</span><span class="ident" id="2813428"><a href="/encoding/binary/varint.go.html#2813383">buf</a></span><span class="op" id="2813431">)</span>&nbsp;<span class="comment" id="2813433">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813473">x</span>&nbsp;<span class="op" id="2813475">:=</span>&nbsp;<span class="ident" id="2813478">int64</span><span class="op" id="2813483">(</span><span class="ident" id="2813484"><a href="/encoding/binary/varint.go.html#2813411">ux</a></span>&nbsp;<span class="op" id="2813487">&gt;&gt;</span>&nbsp;<span class="num" id="2813490">1</span><span class="op" id="2813491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813494">if</span>&nbsp;<span class="ident" id="2813497"><a href="/encoding/binary/varint.go.html#2813411">ux</a></span><span class="op" id="2813499">&amp;</span><span class="num" id="2813500">1</span>&nbsp;<span class="op" id="2813502">!=</span>&nbsp;<span class="num" id="2813505">0</span>&nbsp;<span class="op" id="2813507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813511"><a href="/encoding/binary/varint.go.html#2813473">x</a></span>&nbsp;<span class="op" id="2813513">=</span>&nbsp;<span class="op" id="2813515">^</span><span class="ident" id="2813516"><a href="/encoding/binary/varint.go.html#2813473">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2813519">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813522">return</span>&nbsp;<span class="ident" id="2813529"><a href="/encoding/binary/varint.go.html#2813473">x</a></span><span class="op" id="2813530">,</span>&nbsp;<span class="ident" id="2813532"><a href="/encoding/binary/varint.go.html#2813415">n</a></span><br>
<span class="lineno"></span><span class="op" id="2813534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2813537">var</span>&nbsp;<span class="ident" id="2813541">overflow</span>&nbsp;<span class="op" id="2813550">=</span>&nbsp;<span class="ident" id="2813552"><a href="/encoding/binary/varint.go.html#2811753">errors</a></span><span class="op" id="2813558">.</span><span class="ident" id="2813559">New</span><span class="op" id="2813562">(</span><span class="string" id="2813563">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="2813606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2813609">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="2813693">func</span>&nbsp;<span class="ident" id="2813698">ReadUvarint</span><span class="op" id="2813709">(</span><span class="ident" id="2813710">r</span>&nbsp;<span class="ident" id="2813712"><a href="/encoding/binary/varint.go.html#2811763">io</a></span><span class="op" id="2813714">.</span><span class="ident" id="2813715">ByteReader</span><span class="op" id="2813725">)</span>&nbsp;<span class="op" id="2813727">(</span><span class="ident" id="2813728">uint64</span><span class="op" id="2813734">,</span>&nbsp;<span class="builtintype" id="2813736">error</span><span class="op" id="2813741">)</span>&nbsp;<span class="op" id="2813743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813746">var</span>&nbsp;<span class="ident" id="2813750">x</span>&nbsp;<span class="ident" id="2813752">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813760">var</span>&nbsp;<span class="ident" id="2813764">s</span>&nbsp;<span class="builtintype" id="2813766">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813772">for</span>&nbsp;<span class="ident" id="2813776">i</span>&nbsp;<span class="op" id="2813778">:=</span>&nbsp;<span class="num" id="2813781">0</span><span class="op" id="2813782">;</span>&nbsp;<span class="op" id="2813784">;</span>&nbsp;<span class="ident" id="2813786"><a href="/encoding/binary/varint.go.html#2813776">i</a></span><span class="op" id="2813787">++</span>&nbsp;<span class="op" id="2813790">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813794">b</span><span class="op" id="2813795">,</span>&nbsp;<span class="ident" id="2813797">err</span>&nbsp;<span class="op" id="2813801">:=</span>&nbsp;<span class="ident" id="2813804"><a href="/encoding/binary/varint.go.html#2813710">r</a></span><span class="op" id="2813805">.</span><span class="ident" id="2813806">ReadByte</span><span class="op" id="2813814">(</span><span class="op" id="2813815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813819">if</span>&nbsp;<span class="ident" id="2813822"><a href="/encoding/binary/varint.go.html#2813797">err</a></span>&nbsp;<span class="op" id="2813826">!=</span>&nbsp;<span class="ident" id="2813829">nil</span>&nbsp;<span class="op" id="2813833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813838">return</span>&nbsp;<span class="ident" id="2813845"><a href="/encoding/binary/varint.go.html#2813750">x</a></span><span class="op" id="2813846">,</span>&nbsp;<span class="ident" id="2813848"><a href="/encoding/binary/varint.go.html#2813797">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2813854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813858">if</span>&nbsp;<span class="ident" id="2813861"><a href="/encoding/binary/varint.go.html#2813794">b</a></span>&nbsp;<span class="op" id="2813863">&lt;</span>&nbsp;<span class="num" id="2813865">0x80</span>&nbsp;<span class="op" id="2813870">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813875">if</span>&nbsp;<span class="ident" id="2813878"><a href="/encoding/binary/varint.go.html#2813776">i</a></span>&nbsp;<span class="op" id="2813880">&gt;</span>&nbsp;<span class="num" id="2813882">9</span>&nbsp;<span class="op" id="2813884">||</span>&nbsp;<span class="ident" id="2813887"><a href="/encoding/binary/varint.go.html#2813776">i</a></span>&nbsp;<span class="op" id="2813889">==</span>&nbsp;<span class="num" id="2813892">9</span>&nbsp;<span class="op" id="2813894">&amp;&amp;</span>&nbsp;<span class="ident" id="2813897"><a href="/encoding/binary/varint.go.html#2813794">b</a></span>&nbsp;<span class="op" id="2813899">&gt;</span>&nbsp;<span class="num" id="2813901">1</span>&nbsp;<span class="op" id="2813903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813909">return</span>&nbsp;<span class="ident" id="2813916"><a href="/encoding/binary/varint.go.html#2813750">x</a></span><span class="op" id="2813917">,</span>&nbsp;<span class="ident" id="2813919"><a href="/encoding/binary/varint.go.html#2813541">overflow</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2813931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2813936">return</span>&nbsp;<span class="ident" id="2813943"><a href="/encoding/binary/varint.go.html#2813750">x</a></span>&nbsp;<span class="op" id="2813945">|</span>&nbsp;<span class="ident" id="2813947">uint64</span><span class="op" id="2813953">(</span><span class="ident" id="2813954"><a href="/encoding/binary/varint.go.html#2813794">b</a></span><span class="op" id="2813955">)</span><span class="op" id="2813956">&lt;&lt;</span><span class="ident" id="2813958"><a href="/encoding/binary/varint.go.html#2813764">s</a></span><span class="op" id="2813959">,</span>&nbsp;<span class="ident" id="2813961">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2813967">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813971"><a href="/encoding/binary/varint.go.html#2813750">x</a></span>&nbsp;<span class="op" id="2813973">|=</span>&nbsp;<span class="ident" id="2813976">uint64</span><span class="op" id="2813982">(</span><span class="ident" id="2813983"><a href="/encoding/binary/varint.go.html#2813794">b</a></span><span class="op" id="2813984">&amp;</span><span class="num" id="2813985">0x7f</span><span class="op" id="2813989">)</span>&nbsp;<span class="op" id="2813991">&lt;&lt;</span>&nbsp;<span class="ident" id="2813994"><a href="/encoding/binary/varint.go.html#2813764">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813998"><a href="/encoding/binary/varint.go.html#2813764">s</a></span>&nbsp;<span class="op" id="2814000">+=</span>&nbsp;<span class="num" id="2814003">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2814006">}</span><br>
<span class="lineno"></span><span class="op" id="2814008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2814011">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="2814092">func</span>&nbsp;<span class="ident" id="2814097">ReadVarint</span><span class="op" id="2814107">(</span><span class="ident" id="2814108">r</span>&nbsp;<span class="ident" id="2814110"><a href="/encoding/binary/varint.go.html#2811763">io</a></span><span class="op" id="2814112">.</span><span class="ident" id="2814113">ByteReader</span><span class="op" id="2814123">)</span>&nbsp;<span class="op" id="2814125">(</span><span class="ident" id="2814126">int64</span><span class="op" id="2814131">,</span>&nbsp;<span class="builtintype" id="2814133">error</span><span class="op" id="2814138">)</span>&nbsp;<span class="op" id="2814140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814143">ux</span><span class="op" id="2814145">,</span>&nbsp;<span class="ident" id="2814147">err</span>&nbsp;<span class="op" id="2814151">:=</span>&nbsp;<span class="ident" id="2814154"><a href="/encoding/binary/varint.go.html#2813698">ReadUvarint</a></span><span class="op" id="2814165">(</span><span class="ident" id="2814166"><a href="/encoding/binary/varint.go.html#2814108">r</a></span><span class="op" id="2814167">)</span>&nbsp;<span class="comment" id="2814169">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814209">x</span>&nbsp;<span class="op" id="2814211">:=</span>&nbsp;<span class="ident" id="2814214">int64</span><span class="op" id="2814219">(</span><span class="ident" id="2814220"><a href="/encoding/binary/varint.go.html#2814143">ux</a></span>&nbsp;<span class="op" id="2814223">&gt;&gt;</span>&nbsp;<span class="num" id="2814226">1</span><span class="op" id="2814227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2814230">if</span>&nbsp;<span class="ident" id="2814233"><a href="/encoding/binary/varint.go.html#2814143">ux</a></span><span class="op" id="2814235">&amp;</span><span class="num" id="2814236">1</span>&nbsp;<span class="op" id="2814238">!=</span>&nbsp;<span class="num" id="2814241">0</span>&nbsp;<span class="op" id="2814243">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814247"><a href="/encoding/binary/varint.go.html#2814209">x</a></span>&nbsp;<span class="op" id="2814249">=</span>&nbsp;<span class="op" id="2814251">^</span><span class="ident" id="2814252"><a href="/encoding/binary/varint.go.html#2814209">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2814255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2814258">return</span>&nbsp;<span class="ident" id="2814265"><a href="/encoding/binary/varint.go.html#2814209">x</a></span><span class="op" id="2814266">,</span>&nbsp;<span class="ident" id="2814268"><a href="/encoding/binary/varint.go.html#2814147">err</a></span><br>
<span class="lineno"></span><span class="op" id="2814272">}</span>
</div>
</body>
</html>
