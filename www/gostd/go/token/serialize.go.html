<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1425567">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1425622">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1425676">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1425727">package</span>&nbsp;<span class="ident" id="1425735">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1425742">type</span>&nbsp;<span class="ident" id="1425747">serializedFile</span>&nbsp;<span class="keyword" id="1425762">struct</span>&nbsp;<span class="op" id="1425769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425772">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425844">Name</span>&nbsp;&nbsp;<span class="builtintype" id="1425850">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425858">Base</span>&nbsp;&nbsp;<span class="builtintype" id="1425864">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425869">Size</span>&nbsp;&nbsp;<span class="builtintype" id="1425875">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425880">Lines</span>&nbsp;<span class="op" id="1425886">[</span><span class="op" id="1425887">]</span><span class="builtintype" id="1425888">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425893">Infos</span>&nbsp;<span class="op" id="1425899">[</span><span class="op" id="1425900">]</span><span class="ident" id="1425901">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="1425910">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="1425913">type</span>&nbsp;<span class="ident" id="1425918">serializedFileSet</span>&nbsp;<span class="keyword" id="1425936">struct</span>&nbsp;<span class="op" id="1425943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425946">Base</span>&nbsp;&nbsp;<span class="builtintype" id="1425952">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425957">Files</span>&nbsp;<span class="op" id="1425963">[</span><span class="op" id="1425964">]</span><span class="ident" id="1425965">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="1425980">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1425983">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1426057">func</span>&nbsp;<span class="op" id="1426062">(</span><span class="ident" id="1426063">s</span>&nbsp;<span class="op" id="1426065">*</span><span class="ident" id="1426066">FileSet</span><span class="op" id="1426073">)</span>&nbsp;<span class="ident" id="1426075">Read</span><span class="op" id="1426079">(</span><span class="ident" id="1426080">decode</span>&nbsp;<span class="keyword" id="1426087">func</span><span class="op" id="1426091">(</span><span class="keyword" id="1426092">interface</span><span class="op" id="1426101">{</span><span class="op" id="1426102">}</span><span class="op" id="1426103">)</span>&nbsp;<span class="builtintype" id="1426105">error</span><span class="op" id="1426110">)</span>&nbsp;<span class="builtintype" id="1426112">error</span>&nbsp;<span class="op" id="1426118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426121">var</span>&nbsp;<span class="ident" id="1426125">ss</span>&nbsp;<span class="ident" id="1426128">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426147">if</span>&nbsp;<span class="ident" id="1426150">err</span>&nbsp;<span class="op" id="1426154">:=</span>&nbsp;<span class="ident" id="1426157">decode</span><span class="op" id="1426163">(</span><span class="op" id="1426164">&amp;</span><span class="ident" id="1426165">ss</span><span class="op" id="1426167">)</span><span class="op" id="1426168">;</span>&nbsp;<span class="ident" id="1426170">err</span>&nbsp;<span class="op" id="1426174">!=</span>&nbsp;<span class="ident" id="1426177">nil</span>&nbsp;<span class="op" id="1426181">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426185">return</span>&nbsp;<span class="ident" id="1426192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426201">s</span><span class="op" id="1426202">.</span><span class="ident" id="1426203">mutex</span><span class="op" id="1426208">.</span><span class="ident" id="1426209">Lock</span><span class="op" id="1426213">(</span><span class="op" id="1426214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426217">s</span><span class="op" id="1426218">.</span><span class="ident" id="1426219">base</span>&nbsp;<span class="op" id="1426224">=</span>&nbsp;<span class="ident" id="1426226">ss</span><span class="op" id="1426228">.</span><span class="ident" id="1426229">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426235">files</span>&nbsp;<span class="op" id="1426241">:=</span>&nbsp;<span class="builtinfunc" id="1426244">make</span><span class="op" id="1426248">(</span><span class="op" id="1426249">[</span><span class="op" id="1426250">]</span><span class="op" id="1426251">*</span><span class="ident" id="1426252">File</span><span class="op" id="1426256">,</span>&nbsp;<span class="builtinfunc" id="1426258">len</span><span class="op" id="1426261">(</span><span class="ident" id="1426262">ss</span><span class="op" id="1426264">.</span><span class="ident" id="1426265">Files</span><span class="op" id="1426270">)</span><span class="op" id="1426271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426274">for</span>&nbsp;<span class="ident" id="1426278">i</span>&nbsp;<span class="op" id="1426280">:=</span>&nbsp;<span class="num" id="1426283">0</span><span class="op" id="1426284">;</span>&nbsp;<span class="ident" id="1426286">i</span>&nbsp;<span class="op" id="1426288">&lt;</span>&nbsp;<span class="builtinfunc" id="1426290">len</span><span class="op" id="1426293">(</span><span class="ident" id="1426294">ss</span><span class="op" id="1426296">.</span><span class="ident" id="1426297">Files</span><span class="op" id="1426302">)</span><span class="op" id="1426303">;</span>&nbsp;<span class="ident" id="1426305">i</span><span class="op" id="1426306">++</span>&nbsp;<span class="op" id="1426309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426313">f</span>&nbsp;<span class="op" id="1426315">:=</span>&nbsp;<span class="op" id="1426318">&amp;</span><span class="ident" id="1426319">ss</span><span class="op" id="1426321">.</span><span class="ident" id="1426322">Files</span><span class="op" id="1426327">[</span><span class="ident" id="1426328">i</span><span class="op" id="1426329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426333">files</span><span class="op" id="1426338">[</span><span class="ident" id="1426339">i</span><span class="op" id="1426340">]</span>&nbsp;<span class="op" id="1426342">=</span>&nbsp;<span class="op" id="1426344">&amp;</span><span class="ident" id="1426345">File</span><span class="op" id="1426349">{</span><span class="ident" id="1426350">s</span><span class="op" id="1426351">,</span>&nbsp;<span class="ident" id="1426353">f</span><span class="op" id="1426354">.</span><span class="ident" id="1426355">Name</span><span class="op" id="1426359">,</span>&nbsp;<span class="ident" id="1426361">f</span><span class="op" id="1426362">.</span><span class="ident" id="1426363">Base</span><span class="op" id="1426367">,</span>&nbsp;<span class="ident" id="1426369">f</span><span class="op" id="1426370">.</span><span class="ident" id="1426371">Size</span><span class="op" id="1426375">,</span>&nbsp;<span class="ident" id="1426377">f</span><span class="op" id="1426378">.</span><span class="ident" id="1426379">Lines</span><span class="op" id="1426384">,</span>&nbsp;<span class="ident" id="1426386">f</span><span class="op" id="1426387">.</span><span class="ident" id="1426388">Infos</span><span class="op" id="1426393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426396">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426399">s</span><span class="op" id="1426400">.</span><span class="ident" id="1426401">files</span>&nbsp;<span class="op" id="1426407">=</span>&nbsp;<span class="ident" id="1426409">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426416">s</span><span class="op" id="1426417">.</span><span class="ident" id="1426418">last</span>&nbsp;<span class="op" id="1426423">=</span>&nbsp;<span class="ident" id="1426425">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426430">s</span><span class="op" id="1426431">.</span><span class="ident" id="1426432">mutex</span><span class="op" id="1426437">.</span><span class="ident" id="1426438">Unlock</span><span class="op" id="1426444">(</span><span class="op" id="1426445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426449">return</span>&nbsp;<span class="ident" id="1426456">nil</span><br>
<span class="lineno">40</span><span class="op" id="1426460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426463">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1426514">func</span>&nbsp;<span class="op" id="1426519">(</span><span class="ident" id="1426520">s</span>&nbsp;<span class="op" id="1426522">*</span><span class="ident" id="1426523">FileSet</span><span class="op" id="1426530">)</span>&nbsp;<span class="ident" id="1426532">Write</span><span class="op" id="1426537">(</span><span class="ident" id="1426538">encode</span>&nbsp;<span class="keyword" id="1426545">func</span><span class="op" id="1426549">(</span><span class="keyword" id="1426550">interface</span><span class="op" id="1426559">{</span><span class="op" id="1426560">}</span><span class="op" id="1426561">)</span>&nbsp;<span class="builtintype" id="1426563">error</span><span class="op" id="1426568">)</span>&nbsp;<span class="builtintype" id="1426570">error</span>&nbsp;<span class="op" id="1426576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426579">var</span>&nbsp;<span class="ident" id="1426583">ss</span>&nbsp;<span class="ident" id="1426586">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426606">s</span><span class="op" id="1426607">.</span><span class="ident" id="1426608">mutex</span><span class="op" id="1426613">.</span><span class="ident" id="1426614">Lock</span><span class="op" id="1426618">(</span><span class="op" id="1426619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426622">ss</span><span class="op" id="1426624">.</span><span class="ident" id="1426625">Base</span>&nbsp;<span class="op" id="1426630">=</span>&nbsp;<span class="ident" id="1426632">s</span><span class="op" id="1426633">.</span><span class="ident" id="1426634">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426640">files</span>&nbsp;<span class="op" id="1426646">:=</span>&nbsp;<span class="builtinfunc" id="1426649">make</span><span class="op" id="1426653">(</span><span class="op" id="1426654">[</span><span class="op" id="1426655">]</span><span class="ident" id="1426656">serializedFile</span><span class="op" id="1426670">,</span>&nbsp;<span class="builtinfunc" id="1426672">len</span><span class="op" id="1426675">(</span><span class="ident" id="1426676">s</span><span class="op" id="1426677">.</span><span class="ident" id="1426678">files</span><span class="op" id="1426683">)</span><span class="op" id="1426684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426687">for</span>&nbsp;<span class="ident" id="1426691">i</span><span class="op" id="1426692">,</span>&nbsp;<span class="ident" id="1426694">f</span>&nbsp;<span class="op" id="1426696">:=</span>&nbsp;<span class="keyword" id="1426699">range</span>&nbsp;<span class="ident" id="1426705">s</span><span class="op" id="1426706">.</span><span class="ident" id="1426707">files</span>&nbsp;<span class="op" id="1426713">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426717">files</span><span class="op" id="1426722">[</span><span class="ident" id="1426723">i</span><span class="op" id="1426724">]</span>&nbsp;<span class="op" id="1426726">=</span>&nbsp;<span class="ident" id="1426728">serializedFile</span><span class="op" id="1426742">{</span><span class="ident" id="1426743">f</span><span class="op" id="1426744">.</span><span class="ident" id="1426745">name</span><span class="op" id="1426749">,</span>&nbsp;<span class="ident" id="1426751">f</span><span class="op" id="1426752">.</span><span class="ident" id="1426753">base</span><span class="op" id="1426757">,</span>&nbsp;<span class="ident" id="1426759">f</span><span class="op" id="1426760">.</span><span class="ident" id="1426761">size</span><span class="op" id="1426765">,</span>&nbsp;<span class="ident" id="1426767">f</span><span class="op" id="1426768">.</span><span class="ident" id="1426769">lines</span><span class="op" id="1426774">,</span>&nbsp;<span class="ident" id="1426776">f</span><span class="op" id="1426777">.</span><span class="ident" id="1426778">infos</span><span class="op" id="1426783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426789">ss</span><span class="op" id="1426791">.</span><span class="ident" id="1426792">Files</span>&nbsp;<span class="op" id="1426798">=</span>&nbsp;<span class="ident" id="1426800">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426807">s</span><span class="op" id="1426808">.</span><span class="ident" id="1426809">mutex</span><span class="op" id="1426814">.</span><span class="ident" id="1426815">Unlock</span><span class="op" id="1426821">(</span><span class="op" id="1426822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426826">return</span>&nbsp;<span class="ident" id="1426833">encode</span><span class="op" id="1426839">(</span><span class="ident" id="1426840">ss</span><span class="op" id="1426842">)</span><br>
<span class="lineno"></span><span class="op" id="1426844">}</span>
</div>
</body>
</html>
