<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3330922">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3330977">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3331031">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3331082">package</span>&nbsp;<span class="ident" id="3331090">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3331098">import</span>&nbsp;<span class="op" id="3331105">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3331108">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3331114">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3331130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3331133">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="3331202">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="3331287">type</span>&nbsp;<span class="ident" id="3331292">queue</span>&nbsp;<span class="keyword" id="3331298">struct</span>&nbsp;<span class="op" id="3331305">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331308">sparse</span>&nbsp;<span class="op" id="3331315">[</span><span class="op" id="3331316">]</span><span class="builtintype" id="3331317">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331325">dense</span>&nbsp;&nbsp;<span class="op" id="3331332">[</span><span class="op" id="3331333">]</span><span class="ident" id="3331334">entry</span><br>
<span class="lineno"></span><span class="op" id="3331340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3331343">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="3331378">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="3331437">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="3331502">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3331567">type</span>&nbsp;<span class="ident" id="3331572">entry</span>&nbsp;<span class="keyword" id="3331578">struct</span>&nbsp;<span class="op" id="3331585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331588">pc</span>&nbsp;<span class="builtintype" id="3331591">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331599">t</span>&nbsp;&nbsp;<span class="op" id="3331602">*</span><span class="ident" id="3331603">thread</span><br>
<span class="lineno"></span><span class="op" id="3331610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3331613">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="3331676">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="3331729">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="3331778">type</span>&nbsp;<span class="ident" id="3331783">thread</span>&nbsp;<span class="keyword" id="3331790">struct</span>&nbsp;<span class="op" id="3331797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331800">inst</span>&nbsp;<span class="op" id="3331805">*</span><span class="ident" id="3331806">syntax</span><span class="op" id="3331812">.</span><span class="ident" id="3331813">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3331819">cap</span>&nbsp;&nbsp;<span class="op" id="3331824">[</span><span class="op" id="3331825">]</span><span class="builtintype" id="3331826">int</span><br>
<span class="lineno"></span><span class="op" id="3331830">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3331833">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3331898">type</span>&nbsp;<span class="ident" id="3331903">machine</span>&nbsp;<span class="keyword" id="3331911">struct</span>&nbsp;<span class="op" id="3331918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331921">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3331930">*</span><span class="ident" id="3331931">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3331943">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331968">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3331977">*</span><span class="ident" id="3331978">syntax</span><span class="op" id="3331984">.</span><span class="ident" id="3331985">Prog</span>&nbsp;<span class="comment" id="3331990">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332011">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3332020">*</span><span class="ident" id="3332021">onePassProg</span>&nbsp;<span class="comment" id="3332033">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332077">q0</span><span class="op" id="3332079">,</span>&nbsp;<span class="ident" id="3332081">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3332086">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3332099">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332130">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3332139">[</span><span class="op" id="3332140">]</span><span class="op" id="3332141">*</span><span class="ident" id="3332142">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3332152">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332182">matched</span>&nbsp;&nbsp;<span class="builtintype" id="3332191">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3332204">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332234">matchcap</span>&nbsp;<span class="op" id="3332243">[</span><span class="op" id="3332244">]</span><span class="builtintype" id="3332245">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3332256">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3332295">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332334">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="3332346">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332358">inputString</span>&nbsp;<span class="ident" id="3332370">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332383">inputReader</span>&nbsp;<span class="ident" id="3332395">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="3332407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3332410">func</span>&nbsp;<span class="op" id="3332415">(</span><span class="ident" id="3332416">m</span>&nbsp;<span class="op" id="3332418">*</span><span class="ident" id="3332419">machine</span><span class="op" id="3332426">)</span>&nbsp;<span class="ident" id="3332428">newInputBytes</span><span class="op" id="3332441">(</span><span class="ident" id="3332442">b</span>&nbsp;<span class="op" id="3332444">[</span><span class="op" id="3332445">]</span><span class="builtintype" id="3332446">byte</span><span class="op" id="3332450">)</span>&nbsp;<span class="ident" id="3332452">input</span>&nbsp;<span class="op" id="3332458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332461">m</span><span class="op" id="3332462">.</span><span class="ident" id="3332463">inputBytes</span><span class="op" id="3332473">.</span><span class="ident" id="3332474">str</span>&nbsp;<span class="op" id="3332478">=</span>&nbsp;<span class="ident" id="3332480">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332483">return</span>&nbsp;<span class="op" id="3332490">&amp;</span><span class="ident" id="3332491">m</span><span class="op" id="3332492">.</span><span class="ident" id="3332493">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="3332504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3332507">func</span>&nbsp;<span class="op" id="3332512">(</span><span class="ident" id="3332513">m</span>&nbsp;<span class="op" id="3332515">*</span><span class="ident" id="3332516">machine</span><span class="op" id="3332523">)</span>&nbsp;<span class="ident" id="3332525">newInputString</span><span class="op" id="3332539">(</span><span class="ident" id="3332540">s</span>&nbsp;<span class="builtintype" id="3332542">string</span><span class="op" id="3332548">)</span>&nbsp;<span class="ident" id="3332550">input</span>&nbsp;<span class="op" id="3332556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332559">m</span><span class="op" id="3332560">.</span><span class="ident" id="3332561">inputString</span><span class="op" id="3332572">.</span><span class="ident" id="3332573">str</span>&nbsp;<span class="op" id="3332577">=</span>&nbsp;<span class="ident" id="3332579">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332582">return</span>&nbsp;<span class="op" id="3332589">&amp;</span><span class="ident" id="3332590">m</span><span class="op" id="3332591">.</span><span class="ident" id="3332592">inputString</span><br>
<span class="lineno">60</span><span class="op" id="3332604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3332607">func</span>&nbsp;<span class="op" id="3332612">(</span><span class="ident" id="3332613">m</span>&nbsp;<span class="op" id="3332615">*</span><span class="ident" id="3332616">machine</span><span class="op" id="3332623">)</span>&nbsp;<span class="ident" id="3332625">newInputReader</span><span class="op" id="3332639">(</span><span class="ident" id="3332640">r</span>&nbsp;<span class="ident" id="3332642">io</span><span class="op" id="3332644">.</span><span class="ident" id="3332645">RuneReader</span><span class="op" id="3332655">)</span>&nbsp;<span class="ident" id="3332657">input</span>&nbsp;<span class="op" id="3332663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332666">m</span><span class="op" id="3332667">.</span><span class="ident" id="3332668">inputReader</span><span class="op" id="3332679">.</span><span class="ident" id="3332680">r</span>&nbsp;<span class="op" id="3332682">=</span>&nbsp;<span class="ident" id="3332684">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332687">m</span><span class="op" id="3332688">.</span><span class="ident" id="3332689">inputReader</span><span class="op" id="3332700">.</span><span class="ident" id="3332701">atEOT</span>&nbsp;<span class="op" id="3332707">=</span>&nbsp;<span class="builtintype" id="3332709">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332716">m</span><span class="op" id="3332717">.</span><span class="ident" id="3332718">inputReader</span><span class="op" id="3332729">.</span><span class="ident" id="3332730">pos</span>&nbsp;<span class="op" id="3332734">=</span>&nbsp;<span class="num" id="3332736">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332739">return</span>&nbsp;<span class="op" id="3332746">&amp;</span><span class="ident" id="3332747">m</span><span class="op" id="3332748">.</span><span class="ident" id="3332749">inputReader</span><br>
<span class="lineno"></span><span class="op" id="3332761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3332764">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="3332821">func</span>&nbsp;<span class="ident" id="3332826">progMachine</span><span class="op" id="3332837">(</span><span class="ident" id="3332838">p</span>&nbsp;<span class="op" id="3332840">*</span><span class="ident" id="3332841">syntax</span><span class="op" id="3332847">.</span><span class="ident" id="3332848">Prog</span><span class="op" id="3332852">,</span>&nbsp;<span class="ident" id="3332854">op</span>&nbsp;<span class="op" id="3332857">*</span><span class="ident" id="3332858">onePassProg</span><span class="op" id="3332869">)</span>&nbsp;<span class="op" id="3332871">*</span><span class="ident" id="3332872">machine</span>&nbsp;<span class="op" id="3332880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332883">m</span>&nbsp;<span class="op" id="3332885">:=</span>&nbsp;<span class="op" id="3332888">&amp;</span><span class="ident" id="3332889">machine</span><span class="op" id="3332896">{</span><span class="ident" id="3332897">p</span><span class="op" id="3332898">:</span>&nbsp;<span class="ident" id="3332900">p</span><span class="op" id="3332901">,</span>&nbsp;<span class="ident" id="3332903">op</span><span class="op" id="3332905">:</span>&nbsp;<span class="ident" id="3332907">op</span><span class="op" id="3332909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332912">n</span>&nbsp;<span class="op" id="3332914">:=</span>&nbsp;<span class="builtinfunc" id="3332917">len</span><span class="op" id="3332920">(</span><span class="ident" id="3332921">m</span><span class="op" id="3332922">.</span><span class="ident" id="3332923">p</span><span class="op" id="3332924">.</span><span class="ident" id="3332925">Inst</span><span class="op" id="3332929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332932">m</span><span class="op" id="3332933">.</span><span class="ident" id="3332934">q0</span>&nbsp;<span class="op" id="3332937">=</span>&nbsp;<span class="ident" id="3332939">queue</span><span class="op" id="3332944">{</span><span class="builtinfunc" id="3332945">make</span><span class="op" id="3332949">(</span><span class="op" id="3332950">[</span><span class="op" id="3332951">]</span><span class="builtintype" id="3332952">uint32</span><span class="op" id="3332958">,</span>&nbsp;<span class="ident" id="3332960">n</span><span class="op" id="3332961">)</span><span class="op" id="3332962">,</span>&nbsp;<span class="builtinfunc" id="3332964">make</span><span class="op" id="3332968">(</span><span class="op" id="3332969">[</span><span class="op" id="3332970">]</span><span class="ident" id="3332971">entry</span><span class="op" id="3332976">,</span>&nbsp;<span class="num" id="3332978">0</span><span class="op" id="3332979">,</span>&nbsp;<span class="ident" id="3332981">n</span><span class="op" id="3332982">)</span><span class="op" id="3332983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332986">m</span><span class="op" id="3332987">.</span><span class="ident" id="3332988">q1</span>&nbsp;<span class="op" id="3332991">=</span>&nbsp;<span class="ident" id="3332993">queue</span><span class="op" id="3332998">{</span><span class="builtinfunc" id="3332999">make</span><span class="op" id="3333003">(</span><span class="op" id="3333004">[</span><span class="op" id="3333005">]</span><span class="builtintype" id="3333006">uint32</span><span class="op" id="3333012">,</span>&nbsp;<span class="ident" id="3333014">n</span><span class="op" id="3333015">)</span><span class="op" id="3333016">,</span>&nbsp;<span class="builtinfunc" id="3333018">make</span><span class="op" id="3333022">(</span><span class="op" id="3333023">[</span><span class="op" id="3333024">]</span><span class="ident" id="3333025">entry</span><span class="op" id="3333030">,</span>&nbsp;<span class="num" id="3333032">0</span><span class="op" id="3333033">,</span>&nbsp;<span class="ident" id="3333035">n</span><span class="op" id="3333036">)</span><span class="op" id="3333037">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333040">ncap</span>&nbsp;<span class="op" id="3333045">:=</span>&nbsp;<span class="ident" id="3333048">p</span><span class="op" id="3333049">.</span><span class="ident" id="3333050">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333058">if</span>&nbsp;<span class="ident" id="3333061">ncap</span>&nbsp;<span class="op" id="3333066">&lt;</span>&nbsp;<span class="num" id="3333068">2</span>&nbsp;<span class="op" id="3333070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333074">ncap</span>&nbsp;<span class="op" id="3333079">=</span>&nbsp;<span class="num" id="3333081">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333087">m</span><span class="op" id="3333088">.</span><span class="ident" id="3333089">matchcap</span>&nbsp;<span class="op" id="3333098">=</span>&nbsp;<span class="builtinfunc" id="3333100">make</span><span class="op" id="3333104">(</span><span class="op" id="3333105">[</span><span class="op" id="3333106">]</span><span class="builtintype" id="3333107">int</span><span class="op" id="3333110">,</span>&nbsp;<span class="ident" id="3333112">ncap</span><span class="op" id="3333116">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333119">return</span>&nbsp;<span class="ident" id="3333126">m</span><br>
<span class="lineno"></span><span class="op" id="3333128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3333131">func</span>&nbsp;<span class="op" id="3333136">(</span><span class="ident" id="3333137">m</span>&nbsp;<span class="op" id="3333139">*</span><span class="ident" id="3333140">machine</span><span class="op" id="3333147">)</span>&nbsp;<span class="ident" id="3333149">init</span><span class="op" id="3333153">(</span><span class="ident" id="3333154">ncap</span>&nbsp;<span class="builtintype" id="3333159">int</span><span class="op" id="3333162">)</span>&nbsp;<span class="op" id="3333164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333167">for</span>&nbsp;<span class="ident" id="3333171">_</span><span class="op" id="3333172">,</span>&nbsp;<span class="ident" id="3333174">t</span>&nbsp;<span class="op" id="3333176">:=</span>&nbsp;<span class="keyword" id="3333179">range</span>&nbsp;<span class="ident" id="3333185">m</span><span class="op" id="3333186">.</span><span class="ident" id="3333187">pool</span>&nbsp;<span class="op" id="3333192">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333196">t</span><span class="op" id="3333197">.</span><span class="builtinfunc" id="3333198">cap</span>&nbsp;<span class="op" id="3333202">=</span>&nbsp;<span class="ident" id="3333204">t</span><span class="op" id="3333205">.</span><span class="builtinfunc" id="3333206">cap</span><span class="op" id="3333209">[</span><span class="op" id="3333210">:</span><span class="ident" id="3333211">ncap</span><span class="op" id="3333215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333221">m</span><span class="op" id="3333222">.</span><span class="ident" id="3333223">matchcap</span>&nbsp;<span class="op" id="3333232">=</span>&nbsp;<span class="ident" id="3333234">m</span><span class="op" id="3333235">.</span><span class="ident" id="3333236">matchcap</span><span class="op" id="3333244">[</span><span class="op" id="3333245">:</span><span class="ident" id="3333246">ncap</span><span class="op" id="3333250">]</span><br>
<span class="lineno"></span><span class="op" id="3333252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3333255">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3333315">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3333353">func</span>&nbsp;<span class="op" id="3333358">(</span><span class="ident" id="3333359">m</span>&nbsp;<span class="op" id="3333361">*</span><span class="ident" id="3333362">machine</span><span class="op" id="3333369">)</span>&nbsp;<span class="ident" id="3333371">alloc</span><span class="op" id="3333376">(</span><span class="ident" id="3333377">i</span>&nbsp;<span class="op" id="3333379">*</span><span class="ident" id="3333380">syntax</span><span class="op" id="3333386">.</span><span class="ident" id="3333387">Inst</span><span class="op" id="3333391">)</span>&nbsp;<span class="op" id="3333393">*</span><span class="ident" id="3333394">thread</span>&nbsp;<span class="op" id="3333401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333404">var</span>&nbsp;<span class="ident" id="3333408">t</span>&nbsp;<span class="op" id="3333410">*</span><span class="ident" id="3333411">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333419">if</span>&nbsp;<span class="ident" id="3333422">n</span>&nbsp;<span class="op" id="3333424">:=</span>&nbsp;<span class="builtinfunc" id="3333427">len</span><span class="op" id="3333430">(</span><span class="ident" id="3333431">m</span><span class="op" id="3333432">.</span><span class="ident" id="3333433">pool</span><span class="op" id="3333437">)</span><span class="op" id="3333438">;</span>&nbsp;<span class="ident" id="3333440">n</span>&nbsp;<span class="op" id="3333442">&gt;</span>&nbsp;<span class="num" id="3333444">0</span>&nbsp;<span class="op" id="3333446">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333450">t</span>&nbsp;<span class="op" id="3333452">=</span>&nbsp;<span class="ident" id="3333454">m</span><span class="op" id="3333455">.</span><span class="ident" id="3333456">pool</span><span class="op" id="3333460">[</span><span class="ident" id="3333461">n</span><span class="op" id="3333462">-</span><span class="num" id="3333463">1</span><span class="op" id="3333464">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333468">m</span><span class="op" id="3333469">.</span><span class="ident" id="3333470">pool</span>&nbsp;<span class="op" id="3333475">=</span>&nbsp;<span class="ident" id="3333477">m</span><span class="op" id="3333478">.</span><span class="ident" id="3333479">pool</span><span class="op" id="3333483">[</span><span class="op" id="3333484">:</span><span class="ident" id="3333485">n</span><span class="op" id="3333486">-</span><span class="num" id="3333487">1</span><span class="op" id="3333488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333491">}</span>&nbsp;<span class="keyword" id="3333493">else</span>&nbsp;<span class="op" id="3333498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333502">t</span>&nbsp;<span class="op" id="3333504">=</span>&nbsp;<span class="builtinfunc" id="3333506">new</span><span class="op" id="3333509">(</span><span class="ident" id="3333510">thread</span><span class="op" id="3333516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333520">t</span><span class="op" id="3333521">.</span><span class="builtinfunc" id="3333522">cap</span>&nbsp;<span class="op" id="3333526">=</span>&nbsp;<span class="builtinfunc" id="3333528">make</span><span class="op" id="3333532">(</span><span class="op" id="3333533">[</span><span class="op" id="3333534">]</span><span class="builtintype" id="3333535">int</span><span class="op" id="3333538">,</span>&nbsp;<span class="builtinfunc" id="3333540">len</span><span class="op" id="3333543">(</span><span class="ident" id="3333544">m</span><span class="op" id="3333545">.</span><span class="ident" id="3333546">matchcap</span><span class="op" id="3333554">)</span><span class="op" id="3333555">,</span>&nbsp;<span class="builtinfunc" id="3333557">cap</span><span class="op" id="3333560">(</span><span class="ident" id="3333561">m</span><span class="op" id="3333562">.</span><span class="ident" id="3333563">matchcap</span><span class="op" id="3333571">)</span><span class="op" id="3333572">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333578">t</span><span class="op" id="3333579">.</span><span class="ident" id="3333580">inst</span>&nbsp;<span class="op" id="3333585">=</span>&nbsp;<span class="ident" id="3333587">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333590">return</span>&nbsp;<span class="ident" id="3333597">t</span><br>
<span class="lineno"></span><span class="op" id="3333599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3333602">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3333638">func</span>&nbsp;<span class="op" id="3333643">(</span><span class="ident" id="3333644">m</span>&nbsp;<span class="op" id="3333646">*</span><span class="ident" id="3333647">machine</span><span class="op" id="3333654">)</span>&nbsp;<span class="ident" id="3333656">free</span><span class="op" id="3333660">(</span><span class="ident" id="3333661">t</span>&nbsp;<span class="op" id="3333663">*</span><span class="ident" id="3333664">thread</span><span class="op" id="3333670">)</span>&nbsp;<span class="op" id="3333672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333675">m</span><span class="op" id="3333676">.</span><span class="ident" id="3333677">inputBytes</span><span class="op" id="3333687">.</span><span class="ident" id="3333688">str</span>&nbsp;<span class="op" id="3333692">=</span>&nbsp;<span class="ident" id="3333694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333699">m</span><span class="op" id="3333700">.</span><span class="ident" id="3333701">inputString</span><span class="op" id="3333712">.</span><span class="ident" id="3333713">str</span>&nbsp;<span class="op" id="3333717">=</span>&nbsp;<span class="string" id="3333719">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333723">m</span><span class="op" id="3333724">.</span><span class="ident" id="3333725">inputReader</span><span class="op" id="3333736">.</span><span class="ident" id="3333737">r</span>&nbsp;<span class="op" id="3333739">=</span>&nbsp;<span class="ident" id="3333741">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333746">m</span><span class="op" id="3333747">.</span><span class="ident" id="3333748">pool</span>&nbsp;<span class="op" id="3333753">=</span>&nbsp;<span class="builtinfunc" id="3333755">append</span><span class="op" id="3333761">(</span><span class="ident" id="3333762">m</span><span class="op" id="3333763">.</span><span class="ident" id="3333764">pool</span><span class="op" id="3333768">,</span>&nbsp;<span class="ident" id="3333770">t</span><span class="op" id="3333771">)</span><br>
<span class="lineno"></span><span class="op" id="3333773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3333776">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3333834">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="3333875">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3333928">func</span>&nbsp;<span class="op" id="3333933">(</span><span class="ident" id="3333934">m</span>&nbsp;<span class="op" id="3333936">*</span><span class="ident" id="3333937">machine</span><span class="op" id="3333944">)</span>&nbsp;<span class="ident" id="3333946">match</span><span class="op" id="3333951">(</span><span class="ident" id="3333952">i</span>&nbsp;<span class="ident" id="3333954">input</span><span class="op" id="3333959">,</span>&nbsp;<span class="ident" id="3333961">pos</span>&nbsp;<span class="builtintype" id="3333965">int</span><span class="op" id="3333968">)</span>&nbsp;<span class="builtintype" id="3333970">bool</span>&nbsp;<span class="op" id="3333975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333978">startCond</span>&nbsp;<span class="op" id="3333988">:=</span>&nbsp;<span class="ident" id="3333991">m</span><span class="op" id="3333992">.</span><span class="ident" id="3333993">re</span><span class="op" id="3333995">.</span><span class="ident" id="3333996">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334002">if</span>&nbsp;<span class="ident" id="3334005">startCond</span>&nbsp;<span class="op" id="3334015">==</span>&nbsp;<span class="op" id="3334018">^</span><span class="ident" id="3334019">syntax</span><span class="op" id="3334025">.</span><span class="ident" id="3334026">EmptyOp</span><span class="op" id="3334033">(</span><span class="num" id="3334034">0</span><span class="op" id="3334035">)</span>&nbsp;<span class="op" id="3334037">{</span>&nbsp;<span class="comment" id="3334039">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334055">return</span>&nbsp;<span class="builtintype" id="3334062">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334072">m</span><span class="op" id="3334073">.</span><span class="ident" id="3334074">matched</span>&nbsp;<span class="op" id="3334082">=</span>&nbsp;<span class="builtintype" id="3334084">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334091">for</span>&nbsp;<span class="ident" id="3334095">i</span>&nbsp;<span class="op" id="3334097">:=</span>&nbsp;<span class="keyword" id="3334100">range</span>&nbsp;<span class="ident" id="3334106">m</span><span class="op" id="3334107">.</span><span class="ident" id="3334108">matchcap</span>&nbsp;<span class="op" id="3334117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334121">m</span><span class="op" id="3334122">.</span><span class="ident" id="3334123">matchcap</span><span class="op" id="3334131">[</span><span class="ident" id="3334132">i</span><span class="op" id="3334133">]</span>&nbsp;<span class="op" id="3334135">=</span>&nbsp;<span class="op" id="3334137">-</span><span class="num" id="3334138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334141">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334144">runq</span><span class="op" id="3334148">,</span>&nbsp;<span class="ident" id="3334150">nextq</span>&nbsp;<span class="op" id="3334156">:=</span>&nbsp;<span class="op" id="3334159">&amp;</span><span class="ident" id="3334160">m</span><span class="op" id="3334161">.</span><span class="ident" id="3334162">q0</span><span class="op" id="3334164">,</span>&nbsp;<span class="op" id="3334166">&amp;</span><span class="ident" id="3334167">m</span><span class="op" id="3334168">.</span><span class="ident" id="3334169">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334173">r</span><span class="op" id="3334174">,</span>&nbsp;<span class="ident" id="3334176">r1</span>&nbsp;<span class="op" id="3334179">:=</span>&nbsp;<span class="ident" id="3334182">endOfText</span><span class="op" id="3334191">,</span>&nbsp;<span class="ident" id="3334193">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334204">width</span><span class="op" id="3334209">,</span>&nbsp;<span class="ident" id="3334211">width1</span>&nbsp;<span class="op" id="3334218">:=</span>&nbsp;<span class="num" id="3334221">0</span><span class="op" id="3334222">,</span>&nbsp;<span class="num" id="3334224">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334227">r</span><span class="op" id="3334228">,</span>&nbsp;<span class="ident" id="3334230">width</span>&nbsp;<span class="op" id="3334236">=</span>&nbsp;<span class="ident" id="3334238">i</span><span class="op" id="3334239">.</span><span class="ident" id="3334240">step</span><span class="op" id="3334244">(</span><span class="ident" id="3334245">pos</span><span class="op" id="3334248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334251">if</span>&nbsp;<span class="ident" id="3334254">r</span>&nbsp;<span class="op" id="3334256">!=</span>&nbsp;<span class="ident" id="3334259">endOfText</span>&nbsp;<span class="op" id="3334269">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334273">r1</span><span class="op" id="3334275">,</span>&nbsp;<span class="ident" id="3334277">width1</span>&nbsp;<span class="op" id="3334284">=</span>&nbsp;<span class="ident" id="3334286">i</span><span class="op" id="3334287">.</span><span class="ident" id="3334288">step</span><span class="op" id="3334292">(</span><span class="ident" id="3334293">pos</span>&nbsp;<span class="op" id="3334297">+</span>&nbsp;<span class="ident" id="3334299">width</span><span class="op" id="3334304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334310">var</span>&nbsp;<span class="ident" id="3334314">flag</span>&nbsp;<span class="ident" id="3334319">syntax</span><span class="op" id="3334325">.</span><span class="ident" id="3334326">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334335">if</span>&nbsp;<span class="ident" id="3334338">pos</span>&nbsp;<span class="op" id="3334342">==</span>&nbsp;<span class="num" id="3334345">0</span>&nbsp;<span class="op" id="3334347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334351">flag</span>&nbsp;<span class="op" id="3334356">=</span>&nbsp;<span class="ident" id="3334358">syntax</span><span class="op" id="3334364">.</span><span class="ident" id="3334365">EmptyOpContext</span><span class="op" id="3334379">(</span><span class="op" id="3334380">-</span><span class="num" id="3334381">1</span><span class="op" id="3334382">,</span>&nbsp;<span class="ident" id="3334384">r</span><span class="op" id="3334385">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334388">}</span>&nbsp;<span class="keyword" id="3334390">else</span>&nbsp;<span class="op" id="3334395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334399">flag</span>&nbsp;<span class="op" id="3334404">=</span>&nbsp;<span class="ident" id="3334406">i</span><span class="op" id="3334407">.</span><span class="ident" id="3334408">context</span><span class="op" id="3334415">(</span><span class="ident" id="3334416">pos</span><span class="op" id="3334419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334425">for</span>&nbsp;<span class="op" id="3334429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334433">if</span>&nbsp;<span class="builtinfunc" id="3334436">len</span><span class="op" id="3334439">(</span><span class="ident" id="3334440">runq</span><span class="op" id="3334444">.</span><span class="ident" id="3334445">dense</span><span class="op" id="3334450">)</span>&nbsp;<span class="op" id="3334452">==</span>&nbsp;<span class="num" id="3334455">0</span>&nbsp;<span class="op" id="3334457">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334462">if</span>&nbsp;<span class="ident" id="3334465">startCond</span><span class="op" id="3334474">&amp;</span><span class="ident" id="3334475">syntax</span><span class="op" id="3334481">.</span><span class="ident" id="3334482">EmptyBeginText</span>&nbsp;<span class="op" id="3334497">!=</span>&nbsp;<span class="num" id="3334500">0</span>&nbsp;<span class="op" id="3334502">&amp;&amp;</span>&nbsp;<span class="ident" id="3334505">pos</span>&nbsp;<span class="op" id="3334509">!=</span>&nbsp;<span class="num" id="3334512">0</span>&nbsp;<span class="op" id="3334514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334520">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334567">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334581">if</span>&nbsp;<span class="ident" id="3334584">m</span><span class="op" id="3334585">.</span><span class="ident" id="3334586">matched</span>&nbsp;<span class="op" id="3334594">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334600">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334652">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334666">if</span>&nbsp;<span class="builtinfunc" id="3334669">len</span><span class="op" id="3334672">(</span><span class="ident" id="3334673">m</span><span class="op" id="3334674">.</span><span class="ident" id="3334675">re</span><span class="op" id="3334677">.</span><span class="ident" id="3334678">prefix</span><span class="op" id="3334684">)</span>&nbsp;<span class="op" id="3334686">&gt;</span>&nbsp;<span class="num" id="3334688">0</span>&nbsp;<span class="op" id="3334690">&amp;&amp;</span>&nbsp;<span class="ident" id="3334693">r1</span>&nbsp;<span class="op" id="3334696">!=</span>&nbsp;<span class="ident" id="3334699">m</span><span class="op" id="3334700">.</span><span class="ident" id="3334701">re</span><span class="op" id="3334703">.</span><span class="ident" id="3334704">prefixRune</span>&nbsp;<span class="op" id="3334715">&amp;&amp;</span>&nbsp;<span class="ident" id="3334718">i</span><span class="op" id="3334719">.</span><span class="ident" id="3334720">canCheckPrefix</span><span class="op" id="3334734">(</span><span class="op" id="3334735">)</span>&nbsp;<span class="op" id="3334737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3334743">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334801">advance</span>&nbsp;<span class="op" id="3334809">:=</span>&nbsp;<span class="ident" id="3334812">i</span><span class="op" id="3334813">.</span><span class="ident" id="3334814">index</span><span class="op" id="3334819">(</span><span class="ident" id="3334820">m</span><span class="op" id="3334821">.</span><span class="ident" id="3334822">re</span><span class="op" id="3334824">,</span>&nbsp;<span class="ident" id="3334826">pos</span><span class="op" id="3334829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334835">if</span>&nbsp;<span class="ident" id="3334838">advance</span>&nbsp;<span class="op" id="3334846">&lt;</span>&nbsp;<span class="num" id="3334848">0</span>&nbsp;<span class="op" id="3334850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334857">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334873">pos</span>&nbsp;<span class="op" id="3334877">+=</span>&nbsp;<span class="ident" id="3334880">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334892">r</span><span class="op" id="3334893">,</span>&nbsp;<span class="ident" id="3334895">width</span>&nbsp;<span class="op" id="3334901">=</span>&nbsp;<span class="ident" id="3334903">i</span><span class="op" id="3334904">.</span><span class="ident" id="3334905">step</span><span class="op" id="3334909">(</span><span class="ident" id="3334910">pos</span><span class="op" id="3334913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334919">r1</span><span class="op" id="3334921">,</span>&nbsp;<span class="ident" id="3334923">width1</span>&nbsp;<span class="op" id="3334930">=</span>&nbsp;<span class="ident" id="3334932">i</span><span class="op" id="3334933">.</span><span class="ident" id="3334934">step</span><span class="op" id="3334938">(</span><span class="ident" id="3334939">pos</span>&nbsp;<span class="op" id="3334943">+</span>&nbsp;<span class="ident" id="3334945">width</span><span class="op" id="3334950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334963">if</span>&nbsp;<span class="op" id="3334966">!</span><span class="ident" id="3334967">m</span><span class="op" id="3334968">.</span><span class="ident" id="3334969">matched</span>&nbsp;<span class="op" id="3334977">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334982">if</span>&nbsp;<span class="builtinfunc" id="3334985">len</span><span class="op" id="3334988">(</span><span class="ident" id="3334989">m</span><span class="op" id="3334990">.</span><span class="ident" id="3334991">matchcap</span><span class="op" id="3334999">)</span>&nbsp;<span class="op" id="3335001">&gt;</span>&nbsp;<span class="num" id="3335003">0</span>&nbsp;<span class="op" id="3335005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335011">m</span><span class="op" id="3335012">.</span><span class="ident" id="3335013">matchcap</span><span class="op" id="3335021">[</span><span class="num" id="3335022">0</span><span class="op" id="3335023">]</span>&nbsp;<span class="op" id="3335025">=</span>&nbsp;<span class="ident" id="3335027">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335039">m</span><span class="op" id="3335040">.</span><span class="ident" id="3335041">add</span><span class="op" id="3335044">(</span><span class="ident" id="3335045">runq</span><span class="op" id="3335049">,</span>&nbsp;<span class="builtintype" id="3335051">uint32</span><span class="op" id="3335057">(</span><span class="ident" id="3335058">m</span><span class="op" id="3335059">.</span><span class="ident" id="3335060">p</span><span class="op" id="3335061">.</span><span class="ident" id="3335062">Start</span><span class="op" id="3335067">)</span><span class="op" id="3335068">,</span>&nbsp;<span class="ident" id="3335070">pos</span><span class="op" id="3335073">,</span>&nbsp;<span class="ident" id="3335075">m</span><span class="op" id="3335076">.</span><span class="ident" id="3335077">matchcap</span><span class="op" id="3335085">,</span>&nbsp;<span class="ident" id="3335087">flag</span><span class="op" id="3335091">,</span>&nbsp;<span class="ident" id="3335093">nil</span><span class="op" id="3335096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335100">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335104">flag</span>&nbsp;<span class="op" id="3335109">=</span>&nbsp;<span class="ident" id="3335111">syntax</span><span class="op" id="3335117">.</span><span class="ident" id="3335118">EmptyOpContext</span><span class="op" id="3335132">(</span><span class="ident" id="3335133">r</span><span class="op" id="3335134">,</span>&nbsp;<span class="ident" id="3335136">r1</span><span class="op" id="3335138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335142">m</span><span class="op" id="3335143">.</span><span class="ident" id="3335144">step</span><span class="op" id="3335148">(</span><span class="ident" id="3335149">runq</span><span class="op" id="3335153">,</span>&nbsp;<span class="ident" id="3335155">nextq</span><span class="op" id="3335160">,</span>&nbsp;<span class="ident" id="3335162">pos</span><span class="op" id="3335165">,</span>&nbsp;<span class="ident" id="3335167">pos</span><span class="op" id="3335170">+</span><span class="ident" id="3335171">width</span><span class="op" id="3335176">,</span>&nbsp;<span class="ident" id="3335178">r</span><span class="op" id="3335179">,</span>&nbsp;<span class="ident" id="3335181">flag</span><span class="op" id="3335185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335189">if</span>&nbsp;<span class="ident" id="3335192">width</span>&nbsp;<span class="op" id="3335198">==</span>&nbsp;<span class="num" id="3335201">0</span>&nbsp;<span class="op" id="3335203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335208">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335216">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335220">if</span>&nbsp;<span class="builtinfunc" id="3335223">len</span><span class="op" id="3335226">(</span><span class="ident" id="3335227">m</span><span class="op" id="3335228">.</span><span class="ident" id="3335229">matchcap</span><span class="op" id="3335237">)</span>&nbsp;<span class="op" id="3335239">==</span>&nbsp;<span class="num" id="3335242">0</span>&nbsp;<span class="op" id="3335244">&amp;&amp;</span>&nbsp;<span class="ident" id="3335247">m</span><span class="op" id="3335248">.</span><span class="ident" id="3335249">matched</span>&nbsp;<span class="op" id="3335257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335262">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335307">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335351">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335359">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335363">pos</span>&nbsp;<span class="op" id="3335367">+=</span>&nbsp;<span class="ident" id="3335370">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335378">r</span><span class="op" id="3335379">,</span>&nbsp;<span class="ident" id="3335381">width</span>&nbsp;<span class="op" id="3335387">=</span>&nbsp;<span class="ident" id="3335389">r1</span><span class="op" id="3335391">,</span>&nbsp;<span class="ident" id="3335393">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335402">if</span>&nbsp;<span class="ident" id="3335405">r</span>&nbsp;<span class="op" id="3335407">!=</span>&nbsp;<span class="ident" id="3335410">endOfText</span>&nbsp;<span class="op" id="3335420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335425">r1</span><span class="op" id="3335427">,</span>&nbsp;<span class="ident" id="3335429">width1</span>&nbsp;<span class="op" id="3335436">=</span>&nbsp;<span class="ident" id="3335438">i</span><span class="op" id="3335439">.</span><span class="ident" id="3335440">step</span><span class="op" id="3335444">(</span><span class="ident" id="3335445">pos</span>&nbsp;<span class="op" id="3335449">+</span>&nbsp;<span class="ident" id="3335451">width</span><span class="op" id="3335456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335460">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335464">runq</span><span class="op" id="3335468">,</span>&nbsp;<span class="ident" id="3335470">nextq</span>&nbsp;<span class="op" id="3335476">=</span>&nbsp;<span class="ident" id="3335478">nextq</span><span class="op" id="3335483">,</span>&nbsp;<span class="ident" id="3335485">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335494">m</span><span class="op" id="3335495">.</span><span class="ident" id="3335496">clear</span><span class="op" id="3335501">(</span><span class="ident" id="3335502">nextq</span><span class="op" id="3335507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335510">return</span>&nbsp;<span class="ident" id="3335517">m</span><span class="op" id="3335518">.</span><span class="ident" id="3335519">matched</span><br>
<span class="lineno"></span><span class="op" id="3335527">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="3335530">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="3335578">func</span>&nbsp;<span class="op" id="3335583">(</span><span class="ident" id="3335584">m</span>&nbsp;<span class="op" id="3335586">*</span><span class="ident" id="3335587">machine</span><span class="op" id="3335594">)</span>&nbsp;<span class="ident" id="3335596">clear</span><span class="op" id="3335601">(</span><span class="ident" id="3335602">q</span>&nbsp;<span class="op" id="3335604">*</span><span class="ident" id="3335605">queue</span><span class="op" id="3335610">)</span>&nbsp;<span class="op" id="3335612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335615">for</span>&nbsp;<span class="ident" id="3335619">_</span><span class="op" id="3335620">,</span>&nbsp;<span class="ident" id="3335622">d</span>&nbsp;<span class="op" id="3335624">:=</span>&nbsp;<span class="keyword" id="3335627">range</span>&nbsp;<span class="ident" id="3335633">q</span><span class="op" id="3335634">.</span><span class="ident" id="3335635">dense</span>&nbsp;<span class="op" id="3335641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335645">if</span>&nbsp;<span class="ident" id="3335648">d</span><span class="op" id="3335649">.</span><span class="ident" id="3335650">t</span>&nbsp;<span class="op" id="3335652">!=</span>&nbsp;<span class="ident" id="3335655">nil</span>&nbsp;<span class="op" id="3335659">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335664">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335682">m</span><span class="op" id="3335683">.</span><span class="ident" id="3335684">pool</span>&nbsp;<span class="op" id="3335689">=</span>&nbsp;<span class="builtinfunc" id="3335691">append</span><span class="op" id="3335697">(</span><span class="ident" id="3335698">m</span><span class="op" id="3335699">.</span><span class="ident" id="3335700">pool</span><span class="op" id="3335704">,</span>&nbsp;<span class="ident" id="3335706">d</span><span class="op" id="3335707">.</span><span class="ident" id="3335708">t</span><span class="op" id="3335709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335719">q</span><span class="op" id="3335720">.</span><span class="ident" id="3335721">dense</span>&nbsp;<span class="op" id="3335727">=</span>&nbsp;<span class="ident" id="3335729">q</span><span class="op" id="3335730">.</span><span class="ident" id="3335731">dense</span><span class="op" id="3335736">[</span><span class="op" id="3335737">:</span><span class="num" id="3335738">0</span><span class="op" id="3335739">]</span><br>
<span class="lineno">195</span><span class="op" id="3335741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3335744">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="3335814">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="3335861">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="3335920">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="3335973">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3336038">func</span>&nbsp;<span class="op" id="3336043">(</span><span class="ident" id="3336044">m</span>&nbsp;<span class="op" id="3336046">*</span><span class="ident" id="3336047">machine</span><span class="op" id="3336054">)</span>&nbsp;<span class="ident" id="3336056">step</span><span class="op" id="3336060">(</span><span class="ident" id="3336061">runq</span><span class="op" id="3336065">,</span>&nbsp;<span class="ident" id="3336067">nextq</span>&nbsp;<span class="op" id="3336073">*</span><span class="ident" id="3336074">queue</span><span class="op" id="3336079">,</span>&nbsp;<span class="ident" id="3336081">pos</span><span class="op" id="3336084">,</span>&nbsp;<span class="ident" id="3336086">nextPos</span>&nbsp;<span class="builtintype" id="3336094">int</span><span class="op" id="3336097">,</span>&nbsp;<span class="ident" id="3336099">c</span>&nbsp;<span class="builtintype" id="3336101">rune</span><span class="op" id="3336105">,</span>&nbsp;<span class="ident" id="3336107">nextCond</span>&nbsp;<span class="ident" id="3336116">syntax</span><span class="op" id="3336122">.</span><span class="ident" id="3336123">EmptyOp</span><span class="op" id="3336130">)</span>&nbsp;<span class="op" id="3336132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336135">longest</span>&nbsp;<span class="op" id="3336143">:=</span>&nbsp;<span class="ident" id="3336146">m</span><span class="op" id="3336147">.</span><span class="ident" id="3336148">re</span><span class="op" id="3336150">.</span><span class="ident" id="3336151">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336160">for</span>&nbsp;<span class="ident" id="3336164">j</span>&nbsp;<span class="op" id="3336166">:=</span>&nbsp;<span class="num" id="3336169">0</span><span class="op" id="3336170">;</span>&nbsp;<span class="ident" id="3336172">j</span>&nbsp;<span class="op" id="3336174">&lt;</span>&nbsp;<span class="builtinfunc" id="3336176">len</span><span class="op" id="3336179">(</span><span class="ident" id="3336180">runq</span><span class="op" id="3336184">.</span><span class="ident" id="3336185">dense</span><span class="op" id="3336190">)</span><span class="op" id="3336191">;</span>&nbsp;<span class="ident" id="3336193">j</span><span class="op" id="3336194">++</span>&nbsp;<span class="op" id="3336197">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336201">d</span>&nbsp;<span class="op" id="3336203">:=</span>&nbsp;<span class="op" id="3336206">&amp;</span><span class="ident" id="3336207">runq</span><span class="op" id="3336211">.</span><span class="ident" id="3336212">dense</span><span class="op" id="3336217">[</span><span class="ident" id="3336218">j</span><span class="op" id="3336219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336223">t</span>&nbsp;<span class="op" id="3336225">:=</span>&nbsp;<span class="ident" id="3336228">d</span><span class="op" id="3336229">.</span><span class="ident" id="3336230">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336234">if</span>&nbsp;<span class="ident" id="3336237">t</span>&nbsp;<span class="op" id="3336239">==</span>&nbsp;<span class="ident" id="3336242">nil</span>&nbsp;<span class="op" id="3336246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336251">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336262">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336266">if</span>&nbsp;<span class="ident" id="3336269">longest</span>&nbsp;<span class="op" id="3336277">&amp;&amp;</span>&nbsp;<span class="ident" id="3336280">m</span><span class="op" id="3336281">.</span><span class="ident" id="3336282">matched</span>&nbsp;<span class="op" id="3336290">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3336293">len</span><span class="op" id="3336296">(</span><span class="ident" id="3336297">t</span><span class="op" id="3336298">.</span><span class="builtinfunc" id="3336299">cap</span><span class="op" id="3336302">)</span>&nbsp;<span class="op" id="3336304">&gt;</span>&nbsp;<span class="num" id="3336306">0</span>&nbsp;<span class="op" id="3336308">&amp;&amp;</span>&nbsp;<span class="ident" id="3336311">m</span><span class="op" id="3336312">.</span><span class="ident" id="3336313">matchcap</span><span class="op" id="3336321">[</span><span class="num" id="3336322">0</span><span class="op" id="3336323">]</span>&nbsp;<span class="op" id="3336325">&lt;</span>&nbsp;<span class="ident" id="3336327">t</span><span class="op" id="3336328">.</span><span class="builtinfunc" id="3336329">cap</span><span class="op" id="3336332">[</span><span class="num" id="3336333">0</span><span class="op" id="3336334">]</span>&nbsp;<span class="op" id="3336336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336341">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336357">m</span><span class="op" id="3336358">.</span><span class="ident" id="3336359">pool</span>&nbsp;<span class="op" id="3336364">=</span>&nbsp;<span class="builtinfunc" id="3336366">append</span><span class="op" id="3336372">(</span><span class="ident" id="3336373">m</span><span class="op" id="3336374">.</span><span class="ident" id="3336375">pool</span><span class="op" id="3336379">,</span>&nbsp;<span class="ident" id="3336381">t</span><span class="op" id="3336382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336387">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336398">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336402">i</span>&nbsp;<span class="op" id="3336404">:=</span>&nbsp;<span class="ident" id="3336407">t</span><span class="op" id="3336408">.</span><span class="ident" id="3336409">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336416">add</span>&nbsp;<span class="op" id="3336420">:=</span>&nbsp;<span class="builtintype" id="3336423">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336431">switch</span>&nbsp;<span class="ident" id="3336438">i</span><span class="op" id="3336439">.</span><span class="ident" id="3336440">Op</span>&nbsp;<span class="op" id="3336443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336447">default</span><span class="op" id="3336454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3336459">panic</span><span class="op" id="3336464">(</span><span class="string" id="3336465">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3336475">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336480">case</span>&nbsp;<span class="ident" id="3336485">syntax</span><span class="op" id="3336491">.</span><span class="ident" id="3336492">InstMatch</span><span class="op" id="3336501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336506">if</span>&nbsp;<span class="builtinfunc" id="3336509">len</span><span class="op" id="3336512">(</span><span class="ident" id="3336513">t</span><span class="op" id="3336514">.</span><span class="builtinfunc" id="3336515">cap</span><span class="op" id="3336518">)</span>&nbsp;<span class="op" id="3336520">&gt;</span>&nbsp;<span class="num" id="3336522">0</span>&nbsp;<span class="op" id="3336524">&amp;&amp;</span>&nbsp;<span class="op" id="3336527">(</span><span class="op" id="3336528">!</span><span class="ident" id="3336529">longest</span>&nbsp;<span class="op" id="3336537">||</span>&nbsp;<span class="op" id="3336540">!</span><span class="ident" id="3336541">m</span><span class="op" id="3336542">.</span><span class="ident" id="3336543">matched</span>&nbsp;<span class="op" id="3336551">||</span>&nbsp;<span class="ident" id="3336554">m</span><span class="op" id="3336555">.</span><span class="ident" id="3336556">matchcap</span><span class="op" id="3336564">[</span><span class="num" id="3336565">1</span><span class="op" id="3336566">]</span>&nbsp;<span class="op" id="3336568">&lt;</span>&nbsp;<span class="ident" id="3336570">pos</span><span class="op" id="3336573">)</span>&nbsp;<span class="op" id="3336575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336581">t</span><span class="op" id="3336582">.</span><span class="builtinfunc" id="3336583">cap</span><span class="op" id="3336586">[</span><span class="num" id="3336587">1</span><span class="op" id="3336588">]</span>&nbsp;<span class="op" id="3336590">=</span>&nbsp;<span class="ident" id="3336592">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3336600">copy</span><span class="op" id="3336604">(</span><span class="ident" id="3336605">m</span><span class="op" id="3336606">.</span><span class="ident" id="3336607">matchcap</span><span class="op" id="3336615">,</span>&nbsp;<span class="ident" id="3336617">t</span><span class="op" id="3336618">.</span><span class="builtinfunc" id="3336619">cap</span><span class="op" id="3336622">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336632">if</span>&nbsp;<span class="op" id="3336635">!</span><span class="ident" id="3336636">longest</span>&nbsp;<span class="op" id="3336644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336650">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336711">for</span>&nbsp;<span class="ident" id="3336715">_</span><span class="op" id="3336716">,</span>&nbsp;<span class="ident" id="3336718">d</span>&nbsp;<span class="op" id="3336720">:=</span>&nbsp;<span class="keyword" id="3336723">range</span>&nbsp;<span class="ident" id="3336729">runq</span><span class="op" id="3336733">.</span><span class="ident" id="3336734">dense</span><span class="op" id="3336739">[</span><span class="ident" id="3336740">j</span><span class="op" id="3336741">+</span><span class="num" id="3336742">1</span><span class="op" id="3336743">:</span><span class="op" id="3336744">]</span>&nbsp;<span class="op" id="3336746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336753">if</span>&nbsp;<span class="ident" id="3336756">d</span><span class="op" id="3336757">.</span><span class="ident" id="3336758">t</span>&nbsp;<span class="op" id="3336760">!=</span>&nbsp;<span class="ident" id="3336763">nil</span>&nbsp;<span class="op" id="3336767">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336775">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336796">m</span><span class="op" id="3336797">.</span><span class="ident" id="3336798">pool</span>&nbsp;<span class="op" id="3336803">=</span>&nbsp;<span class="builtinfunc" id="3336805">append</span><span class="op" id="3336811">(</span><span class="ident" id="3336812">m</span><span class="op" id="3336813">.</span><span class="ident" id="3336814">pool</span><span class="op" id="3336818">,</span>&nbsp;<span class="ident" id="3336820">d</span><span class="op" id="3336821">.</span><span class="ident" id="3336822">t</span><span class="op" id="3336823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336842">runq</span><span class="op" id="3336846">.</span><span class="ident" id="3336847">dense</span>&nbsp;<span class="op" id="3336853">=</span>&nbsp;<span class="ident" id="3336855">runq</span><span class="op" id="3336859">.</span><span class="ident" id="3336860">dense</span><span class="op" id="3336865">[</span><span class="op" id="3336866">:</span><span class="num" id="3336867">0</span><span class="op" id="3336868">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336878">m</span><span class="op" id="3336879">.</span><span class="ident" id="3336880">matched</span>&nbsp;<span class="op" id="3336888">=</span>&nbsp;<span class="builtintype" id="3336890">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336898">case</span>&nbsp;<span class="ident" id="3336903">syntax</span><span class="op" id="3336909">.</span><span class="ident" id="3336910">InstRune</span><span class="op" id="3336918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336923">add</span>&nbsp;<span class="op" id="3336927">=</span>&nbsp;<span class="ident" id="3336929">i</span><span class="op" id="3336930">.</span><span class="ident" id="3336931">MatchRune</span><span class="op" id="3336940">(</span><span class="ident" id="3336941">c</span><span class="op" id="3336942">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336946">case</span>&nbsp;<span class="ident" id="3336951">syntax</span><span class="op" id="3336957">.</span><span class="ident" id="3336958">InstRune1</span><span class="op" id="3336967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336972">add</span>&nbsp;<span class="op" id="3336976">=</span>&nbsp;<span class="ident" id="3336978">c</span>&nbsp;<span class="op" id="3336980">==</span>&nbsp;<span class="ident" id="3336983">i</span><span class="op" id="3336984">.</span><span class="ident" id="3336985">Rune</span><span class="op" id="3336989">[</span><span class="num" id="3336990">0</span><span class="op" id="3336991">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336995">case</span>&nbsp;<span class="ident" id="3337000">syntax</span><span class="op" id="3337006">.</span><span class="ident" id="3337007">InstRuneAny</span><span class="op" id="3337018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337023">add</span>&nbsp;<span class="op" id="3337027">=</span>&nbsp;<span class="builtintype" id="3337029">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337036">case</span>&nbsp;<span class="ident" id="3337041">syntax</span><span class="op" id="3337047">.</span><span class="ident" id="3337048">InstRuneAnyNotNL</span><span class="op" id="3337064">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337069">add</span>&nbsp;<span class="op" id="3337073">=</span>&nbsp;<span class="ident" id="3337075">c</span>&nbsp;<span class="op" id="3337077">!=</span>&nbsp;<span class="string" id="3337080">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337091">if</span>&nbsp;<span class="ident" id="3337094">add</span>&nbsp;<span class="op" id="3337098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337103">t</span>&nbsp;<span class="op" id="3337105">=</span>&nbsp;<span class="ident" id="3337107">m</span><span class="op" id="3337108">.</span><span class="ident" id="3337109">add</span><span class="op" id="3337112">(</span><span class="ident" id="3337113">nextq</span><span class="op" id="3337118">,</span>&nbsp;<span class="ident" id="3337120">i</span><span class="op" id="3337121">.</span><span class="ident" id="3337122">Out</span><span class="op" id="3337125">,</span>&nbsp;<span class="ident" id="3337127">nextPos</span><span class="op" id="3337134">,</span>&nbsp;<span class="ident" id="3337136">t</span><span class="op" id="3337137">.</span><span class="builtinfunc" id="3337138">cap</span><span class="op" id="3337141">,</span>&nbsp;<span class="ident" id="3337143">nextCond</span><span class="op" id="3337151">,</span>&nbsp;<span class="ident" id="3337153">t</span><span class="op" id="3337154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337158">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337162">if</span>&nbsp;<span class="ident" id="3337165">t</span>&nbsp;<span class="op" id="3337167">!=</span>&nbsp;<span class="ident" id="3337170">nil</span>&nbsp;<span class="op" id="3337174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337179">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337195">m</span><span class="op" id="3337196">.</span><span class="ident" id="3337197">pool</span>&nbsp;<span class="op" id="3337202">=</span>&nbsp;<span class="builtinfunc" id="3337204">append</span><span class="op" id="3337210">(</span><span class="ident" id="3337211">m</span><span class="op" id="3337212">.</span><span class="ident" id="3337213">pool</span><span class="op" id="3337217">,</span>&nbsp;<span class="ident" id="3337219">t</span><span class="op" id="3337220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337227">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337230">runq</span><span class="op" id="3337234">.</span><span class="ident" id="3337235">dense</span>&nbsp;<span class="op" id="3337241">=</span>&nbsp;<span class="ident" id="3337243">runq</span><span class="op" id="3337247">.</span><span class="ident" id="3337248">dense</span><span class="op" id="3337253">[</span><span class="op" id="3337254">:</span><span class="num" id="3337255">0</span><span class="op" id="3337256">]</span><br>
<span class="lineno"></span><span class="op" id="3337258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337261">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="3337335">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3337424">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3337501">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3337518">func</span>&nbsp;<span class="op" id="3337523">(</span><span class="ident" id="3337524">m</span>&nbsp;<span class="op" id="3337526">*</span><span class="ident" id="3337527">machine</span><span class="op" id="3337534">)</span>&nbsp;<span class="ident" id="3337536">add</span><span class="op" id="3337539">(</span><span class="ident" id="3337540">q</span>&nbsp;<span class="op" id="3337542">*</span><span class="ident" id="3337543">queue</span><span class="op" id="3337548">,</span>&nbsp;<span class="ident" id="3337550">pc</span>&nbsp;<span class="builtintype" id="3337553">uint32</span><span class="op" id="3337559">,</span>&nbsp;<span class="ident" id="3337561">pos</span>&nbsp;<span class="builtintype" id="3337565">int</span><span class="op" id="3337568">,</span>&nbsp;<span class="builtinfunc" id="3337570">cap</span>&nbsp;<span class="op" id="3337574">[</span><span class="op" id="3337575">]</span><span class="builtintype" id="3337576">int</span><span class="op" id="3337579">,</span>&nbsp;<span class="ident" id="3337581">cond</span>&nbsp;<span class="ident" id="3337586">syntax</span><span class="op" id="3337592">.</span><span class="ident" id="3337593">EmptyOp</span><span class="op" id="3337600">,</span>&nbsp;<span class="ident" id="3337602">t</span>&nbsp;<span class="op" id="3337604">*</span><span class="ident" id="3337605">thread</span><span class="op" id="3337611">)</span>&nbsp;<span class="op" id="3337613">*</span><span class="ident" id="3337614">thread</span>&nbsp;<span class="op" id="3337621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337624">if</span>&nbsp;<span class="ident" id="3337627">pc</span>&nbsp;<span class="op" id="3337630">==</span>&nbsp;<span class="num" id="3337633">0</span>&nbsp;<span class="op" id="3337635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337639">return</span>&nbsp;<span class="ident" id="3337646">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337652">if</span>&nbsp;<span class="ident" id="3337655">j</span>&nbsp;<span class="op" id="3337657">:=</span>&nbsp;<span class="ident" id="3337660">q</span><span class="op" id="3337661">.</span><span class="ident" id="3337662">sparse</span><span class="op" id="3337668">[</span><span class="ident" id="3337669">pc</span><span class="op" id="3337671">]</span><span class="op" id="3337672">;</span>&nbsp;<span class="ident" id="3337674">j</span>&nbsp;<span class="op" id="3337676">&lt;</span>&nbsp;<span class="builtintype" id="3337678">uint32</span><span class="op" id="3337684">(</span><span class="builtinfunc" id="3337685">len</span><span class="op" id="3337688">(</span><span class="ident" id="3337689">q</span><span class="op" id="3337690">.</span><span class="ident" id="3337691">dense</span><span class="op" id="3337696">)</span><span class="op" id="3337697">)</span>&nbsp;<span class="op" id="3337699">&amp;&amp;</span>&nbsp;<span class="ident" id="3337702">q</span><span class="op" id="3337703">.</span><span class="ident" id="3337704">dense</span><span class="op" id="3337709">[</span><span class="ident" id="3337710">j</span><span class="op" id="3337711">]</span><span class="op" id="3337712">.</span><span class="ident" id="3337713">pc</span>&nbsp;<span class="op" id="3337716">==</span>&nbsp;<span class="ident" id="3337719">pc</span>&nbsp;<span class="op" id="3337722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337726">return</span>&nbsp;<span class="ident" id="3337733">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337740">j</span>&nbsp;<span class="op" id="3337742">:=</span>&nbsp;<span class="builtinfunc" id="3337745">len</span><span class="op" id="3337748">(</span><span class="ident" id="3337749">q</span><span class="op" id="3337750">.</span><span class="ident" id="3337751">dense</span><span class="op" id="3337756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337759">q</span><span class="op" id="3337760">.</span><span class="ident" id="3337761">dense</span>&nbsp;<span class="op" id="3337767">=</span>&nbsp;<span class="ident" id="3337769">q</span><span class="op" id="3337770">.</span><span class="ident" id="3337771">dense</span><span class="op" id="3337776">[</span><span class="op" id="3337777">:</span><span class="ident" id="3337778">j</span><span class="op" id="3337779">+</span><span class="num" id="3337780">1</span><span class="op" id="3337781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337784">d</span>&nbsp;<span class="op" id="3337786">:=</span>&nbsp;<span class="op" id="3337789">&amp;</span><span class="ident" id="3337790">q</span><span class="op" id="3337791">.</span><span class="ident" id="3337792">dense</span><span class="op" id="3337797">[</span><span class="ident" id="3337798">j</span><span class="op" id="3337799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337802">d</span><span class="op" id="3337803">.</span><span class="ident" id="3337804">t</span>&nbsp;<span class="op" id="3337806">=</span>&nbsp;<span class="ident" id="3337808">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337813">d</span><span class="op" id="3337814">.</span><span class="ident" id="3337815">pc</span>&nbsp;<span class="op" id="3337818">=</span>&nbsp;<span class="ident" id="3337820">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337824">q</span><span class="op" id="3337825">.</span><span class="ident" id="3337826">sparse</span><span class="op" id="3337832">[</span><span class="ident" id="3337833">pc</span><span class="op" id="3337835">]</span>&nbsp;<span class="op" id="3337837">=</span>&nbsp;<span class="builtintype" id="3337839">uint32</span><span class="op" id="3337845">(</span><span class="ident" id="3337846">j</span><span class="op" id="3337847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337851">i</span>&nbsp;<span class="op" id="3337853">:=</span>&nbsp;<span class="op" id="3337856">&amp;</span><span class="ident" id="3337857">m</span><span class="op" id="3337858">.</span><span class="ident" id="3337859">p</span><span class="op" id="3337860">.</span><span class="ident" id="3337861">Inst</span><span class="op" id="3337865">[</span><span class="ident" id="3337866">pc</span><span class="op" id="3337868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337871">switch</span>&nbsp;<span class="ident" id="3337878">i</span><span class="op" id="3337879">.</span><span class="ident" id="3337880">Op</span>&nbsp;<span class="op" id="3337883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337886">default</span><span class="op" id="3337893">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3337897">panic</span><span class="op" id="3337902">(</span><span class="string" id="3337903">&#34;unhandled&#34;</span><span class="op" id="3337914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337917">case</span>&nbsp;<span class="ident" id="3337922">syntax</span><span class="op" id="3337928">.</span><span class="ident" id="3337929">InstFail</span><span class="op" id="3337937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337941">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337953">case</span>&nbsp;<span class="ident" id="3337958">syntax</span><span class="op" id="3337964">.</span><span class="ident" id="3337965">InstAlt</span><span class="op" id="3337972">,</span>&nbsp;<span class="ident" id="3337974">syntax</span><span class="op" id="3337980">.</span><span class="ident" id="3337981">InstAltMatch</span><span class="op" id="3337993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337997">t</span>&nbsp;<span class="op" id="3337999">=</span>&nbsp;<span class="ident" id="3338001">m</span><span class="op" id="3338002">.</span><span class="ident" id="3338003">add</span><span class="op" id="3338006">(</span><span class="ident" id="3338007">q</span><span class="op" id="3338008">,</span>&nbsp;<span class="ident" id="3338010">i</span><span class="op" id="3338011">.</span><span class="ident" id="3338012">Out</span><span class="op" id="3338015">,</span>&nbsp;<span class="ident" id="3338017">pos</span><span class="op" id="3338020">,</span>&nbsp;<span class="builtinfunc" id="3338022">cap</span><span class="op" id="3338025">,</span>&nbsp;<span class="ident" id="3338027">cond</span><span class="op" id="3338031">,</span>&nbsp;<span class="ident" id="3338033">t</span><span class="op" id="3338034">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338038">t</span>&nbsp;<span class="op" id="3338040">=</span>&nbsp;<span class="ident" id="3338042">m</span><span class="op" id="3338043">.</span><span class="ident" id="3338044">add</span><span class="op" id="3338047">(</span><span class="ident" id="3338048">q</span><span class="op" id="3338049">,</span>&nbsp;<span class="ident" id="3338051">i</span><span class="op" id="3338052">.</span><span class="ident" id="3338053">Arg</span><span class="op" id="3338056">,</span>&nbsp;<span class="ident" id="3338058">pos</span><span class="op" id="3338061">,</span>&nbsp;<span class="builtinfunc" id="3338063">cap</span><span class="op" id="3338066">,</span>&nbsp;<span class="ident" id="3338068">cond</span><span class="op" id="3338072">,</span>&nbsp;<span class="ident" id="3338074">t</span><span class="op" id="3338075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338078">case</span>&nbsp;<span class="ident" id="3338083">syntax</span><span class="op" id="3338089">.</span><span class="ident" id="3338090">InstEmptyWidth</span><span class="op" id="3338104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338108">if</span>&nbsp;<span class="ident" id="3338111">syntax</span><span class="op" id="3338117">.</span><span class="ident" id="3338118">EmptyOp</span><span class="op" id="3338125">(</span><span class="ident" id="3338126">i</span><span class="op" id="3338127">.</span><span class="ident" id="3338128">Arg</span><span class="op" id="3338131">)</span><span class="op" id="3338132">&amp;^</span><span class="ident" id="3338134">cond</span>&nbsp;<span class="op" id="3338139">==</span>&nbsp;<span class="num" id="3338142">0</span>&nbsp;<span class="op" id="3338144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338149">t</span>&nbsp;<span class="op" id="3338151">=</span>&nbsp;<span class="ident" id="3338153">m</span><span class="op" id="3338154">.</span><span class="ident" id="3338155">add</span><span class="op" id="3338158">(</span><span class="ident" id="3338159">q</span><span class="op" id="3338160">,</span>&nbsp;<span class="ident" id="3338162">i</span><span class="op" id="3338163">.</span><span class="ident" id="3338164">Out</span><span class="op" id="3338167">,</span>&nbsp;<span class="ident" id="3338169">pos</span><span class="op" id="3338172">,</span>&nbsp;<span class="builtinfunc" id="3338174">cap</span><span class="op" id="3338177">,</span>&nbsp;<span class="ident" id="3338179">cond</span><span class="op" id="3338183">,</span>&nbsp;<span class="ident" id="3338185">t</span><span class="op" id="3338186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338190">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338193">case</span>&nbsp;<span class="ident" id="3338198">syntax</span><span class="op" id="3338204">.</span><span class="ident" id="3338205">InstNop</span><span class="op" id="3338212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338216">t</span>&nbsp;<span class="op" id="3338218">=</span>&nbsp;<span class="ident" id="3338220">m</span><span class="op" id="3338221">.</span><span class="ident" id="3338222">add</span><span class="op" id="3338225">(</span><span class="ident" id="3338226">q</span><span class="op" id="3338227">,</span>&nbsp;<span class="ident" id="3338229">i</span><span class="op" id="3338230">.</span><span class="ident" id="3338231">Out</span><span class="op" id="3338234">,</span>&nbsp;<span class="ident" id="3338236">pos</span><span class="op" id="3338239">,</span>&nbsp;<span class="builtinfunc" id="3338241">cap</span><span class="op" id="3338244">,</span>&nbsp;<span class="ident" id="3338246">cond</span><span class="op" id="3338250">,</span>&nbsp;<span class="ident" id="3338252">t</span><span class="op" id="3338253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338256">case</span>&nbsp;<span class="ident" id="3338261">syntax</span><span class="op" id="3338267">.</span><span class="ident" id="3338268">InstCapture</span><span class="op" id="3338279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338283">if</span>&nbsp;<span class="builtintype" id="3338286">int</span><span class="op" id="3338289">(</span><span class="ident" id="3338290">i</span><span class="op" id="3338291">.</span><span class="ident" id="3338292">Arg</span><span class="op" id="3338295">)</span>&nbsp;<span class="op" id="3338297">&lt;</span>&nbsp;<span class="builtinfunc" id="3338299">len</span><span class="op" id="3338302">(</span><span class="builtinfunc" id="3338303">cap</span><span class="op" id="3338306">)</span>&nbsp;<span class="op" id="3338308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338313">opos</span>&nbsp;<span class="op" id="3338318">:=</span>&nbsp;<span class="builtinfunc" id="3338321">cap</span><span class="op" id="3338324">[</span><span class="ident" id="3338325">i</span><span class="op" id="3338326">.</span><span class="ident" id="3338327">Arg</span><span class="op" id="3338330">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3338335">cap</span><span class="op" id="3338338">[</span><span class="ident" id="3338339">i</span><span class="op" id="3338340">.</span><span class="ident" id="3338341">Arg</span><span class="op" id="3338344">]</span>&nbsp;<span class="op" id="3338346">=</span>&nbsp;<span class="ident" id="3338348">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338355">m</span><span class="op" id="3338356">.</span><span class="ident" id="3338357">add</span><span class="op" id="3338360">(</span><span class="ident" id="3338361">q</span><span class="op" id="3338362">,</span>&nbsp;<span class="ident" id="3338364">i</span><span class="op" id="3338365">.</span><span class="ident" id="3338366">Out</span><span class="op" id="3338369">,</span>&nbsp;<span class="ident" id="3338371">pos</span><span class="op" id="3338374">,</span>&nbsp;<span class="builtinfunc" id="3338376">cap</span><span class="op" id="3338379">,</span>&nbsp;<span class="ident" id="3338381">cond</span><span class="op" id="3338385">,</span>&nbsp;<span class="ident" id="3338387">nil</span><span class="op" id="3338390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3338395">cap</span><span class="op" id="3338398">[</span><span class="ident" id="3338399">i</span><span class="op" id="3338400">.</span><span class="ident" id="3338401">Arg</span><span class="op" id="3338404">]</span>&nbsp;<span class="op" id="3338406">=</span>&nbsp;<span class="ident" id="3338408">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338415">}</span>&nbsp;<span class="keyword" id="3338417">else</span>&nbsp;<span class="op" id="3338422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338427">t</span>&nbsp;<span class="op" id="3338429">=</span>&nbsp;<span class="ident" id="3338431">m</span><span class="op" id="3338432">.</span><span class="ident" id="3338433">add</span><span class="op" id="3338436">(</span><span class="ident" id="3338437">q</span><span class="op" id="3338438">,</span>&nbsp;<span class="ident" id="3338440">i</span><span class="op" id="3338441">.</span><span class="ident" id="3338442">Out</span><span class="op" id="3338445">,</span>&nbsp;<span class="ident" id="3338447">pos</span><span class="op" id="3338450">,</span>&nbsp;<span class="builtinfunc" id="3338452">cap</span><span class="op" id="3338455">,</span>&nbsp;<span class="ident" id="3338457">cond</span><span class="op" id="3338461">,</span>&nbsp;<span class="ident" id="3338463">t</span><span class="op" id="3338464">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338471">case</span>&nbsp;<span class="ident" id="3338476">syntax</span><span class="op" id="3338482">.</span><span class="ident" id="3338483">InstMatch</span><span class="op" id="3338492">,</span>&nbsp;<span class="ident" id="3338494">syntax</span><span class="op" id="3338500">.</span><span class="ident" id="3338501">InstRune</span><span class="op" id="3338509">,</span>&nbsp;<span class="ident" id="3338511">syntax</span><span class="op" id="3338517">.</span><span class="ident" id="3338518">InstRune1</span><span class="op" id="3338527">,</span>&nbsp;<span class="ident" id="3338529">syntax</span><span class="op" id="3338535">.</span><span class="ident" id="3338536">InstRuneAny</span><span class="op" id="3338547">,</span>&nbsp;<span class="ident" id="3338549">syntax</span><span class="op" id="3338555">.</span><span class="ident" id="3338556">InstRuneAnyNotNL</span><span class="op" id="3338572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338576">if</span>&nbsp;<span class="ident" id="3338579">t</span>&nbsp;<span class="op" id="3338581">==</span>&nbsp;<span class="ident" id="3338584">nil</span>&nbsp;<span class="op" id="3338588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338593">t</span>&nbsp;<span class="op" id="3338595">=</span>&nbsp;<span class="ident" id="3338597">m</span><span class="op" id="3338598">.</span><span class="ident" id="3338599">alloc</span><span class="op" id="3338604">(</span><span class="ident" id="3338605">i</span><span class="op" id="3338606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338610">}</span>&nbsp;<span class="keyword" id="3338612">else</span>&nbsp;<span class="op" id="3338617">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338622">t</span><span class="op" id="3338623">.</span><span class="ident" id="3338624">inst</span>&nbsp;<span class="op" id="3338629">=</span>&nbsp;<span class="ident" id="3338631">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338639">if</span>&nbsp;<span class="builtinfunc" id="3338642">len</span><span class="op" id="3338645">(</span><span class="builtinfunc" id="3338646">cap</span><span class="op" id="3338649">)</span>&nbsp;<span class="op" id="3338651">&gt;</span>&nbsp;<span class="num" id="3338653">0</span>&nbsp;<span class="op" id="3338655">&amp;&amp;</span>&nbsp;<span class="op" id="3338658">&amp;</span><span class="ident" id="3338659">t</span><span class="op" id="3338660">.</span><span class="builtinfunc" id="3338661">cap</span><span class="op" id="3338664">[</span><span class="num" id="3338665">0</span><span class="op" id="3338666">]</span>&nbsp;<span class="op" id="3338668">!=</span>&nbsp;<span class="op" id="3338671">&amp;</span><span class="builtinfunc" id="3338672">cap</span><span class="op" id="3338675">[</span><span class="num" id="3338676">0</span><span class="op" id="3338677">]</span>&nbsp;<span class="op" id="3338679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3338684">copy</span><span class="op" id="3338688">(</span><span class="ident" id="3338689">t</span><span class="op" id="3338690">.</span><span class="builtinfunc" id="3338691">cap</span><span class="op" id="3338694">,</span>&nbsp;<span class="builtinfunc" id="3338696">cap</span><span class="op" id="3338699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338703">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338707">d</span><span class="op" id="3338708">.</span><span class="ident" id="3338709">t</span>&nbsp;<span class="op" id="3338711">=</span>&nbsp;<span class="ident" id="3338713">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338717">t</span>&nbsp;<span class="op" id="3338719">=</span>&nbsp;<span class="ident" id="3338721">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338729">return</span>&nbsp;<span class="ident" id="3338736">t</span><br>
<span class="lineno"></span><span class="op" id="3338738">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3338741">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3338801">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="3338842">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3338895">func</span>&nbsp;<span class="op" id="3338900">(</span><span class="ident" id="3338901">m</span>&nbsp;<span class="op" id="3338903">*</span><span class="ident" id="3338904">machine</span><span class="op" id="3338911">)</span>&nbsp;<span class="ident" id="3338913">onepass</span><span class="op" id="3338920">(</span><span class="ident" id="3338921">i</span>&nbsp;<span class="ident" id="3338923">input</span><span class="op" id="3338928">,</span>&nbsp;<span class="ident" id="3338930">pos</span>&nbsp;<span class="builtintype" id="3338934">int</span><span class="op" id="3338937">)</span>&nbsp;<span class="builtintype" id="3338939">bool</span>&nbsp;<span class="op" id="3338944">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338947">startCond</span>&nbsp;<span class="op" id="3338957">:=</span>&nbsp;<span class="ident" id="3338960">m</span><span class="op" id="3338961">.</span><span class="ident" id="3338962">re</span><span class="op" id="3338964">.</span><span class="ident" id="3338965">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338971">if</span>&nbsp;<span class="ident" id="3338974">startCond</span>&nbsp;<span class="op" id="3338984">==</span>&nbsp;<span class="op" id="3338987">^</span><span class="ident" id="3338988">syntax</span><span class="op" id="3338994">.</span><span class="ident" id="3338995">EmptyOp</span><span class="op" id="3339002">(</span><span class="num" id="3339003">0</span><span class="op" id="3339004">)</span>&nbsp;<span class="op" id="3339006">{</span>&nbsp;<span class="comment" id="3339008">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339024">return</span>&nbsp;<span class="builtintype" id="3339031">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339041">m</span><span class="op" id="3339042">.</span><span class="ident" id="3339043">matched</span>&nbsp;<span class="op" id="3339051">=</span>&nbsp;<span class="builtintype" id="3339053">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339060">for</span>&nbsp;<span class="ident" id="3339064">i</span>&nbsp;<span class="op" id="3339066">:=</span>&nbsp;<span class="keyword" id="3339069">range</span>&nbsp;<span class="ident" id="3339075">m</span><span class="op" id="3339076">.</span><span class="ident" id="3339077">matchcap</span>&nbsp;<span class="op" id="3339086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339090">m</span><span class="op" id="3339091">.</span><span class="ident" id="3339092">matchcap</span><span class="op" id="3339100">[</span><span class="ident" id="3339101">i</span><span class="op" id="3339102">]</span>&nbsp;<span class="op" id="3339104">=</span>&nbsp;<span class="op" id="3339106">-</span><span class="num" id="3339107">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339113">r</span><span class="op" id="3339114">,</span>&nbsp;<span class="ident" id="3339116">r1</span>&nbsp;<span class="op" id="3339119">:=</span>&nbsp;<span class="ident" id="3339122">endOfText</span><span class="op" id="3339131">,</span>&nbsp;<span class="ident" id="3339133">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339144">width</span><span class="op" id="3339149">,</span>&nbsp;<span class="ident" id="3339151">width1</span>&nbsp;<span class="op" id="3339158">:=</span>&nbsp;<span class="num" id="3339161">0</span><span class="op" id="3339162">,</span>&nbsp;<span class="num" id="3339164">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339167">r</span><span class="op" id="3339168">,</span>&nbsp;<span class="ident" id="3339170">width</span>&nbsp;<span class="op" id="3339176">=</span>&nbsp;<span class="ident" id="3339178">i</span><span class="op" id="3339179">.</span><span class="ident" id="3339180">step</span><span class="op" id="3339184">(</span><span class="ident" id="3339185">pos</span><span class="op" id="3339188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339191">if</span>&nbsp;<span class="ident" id="3339194">r</span>&nbsp;<span class="op" id="3339196">!=</span>&nbsp;<span class="ident" id="3339199">endOfText</span>&nbsp;<span class="op" id="3339209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339213">r1</span><span class="op" id="3339215">,</span>&nbsp;<span class="ident" id="3339217">width1</span>&nbsp;<span class="op" id="3339224">=</span>&nbsp;<span class="ident" id="3339226">i</span><span class="op" id="3339227">.</span><span class="ident" id="3339228">step</span><span class="op" id="3339232">(</span><span class="ident" id="3339233">pos</span>&nbsp;<span class="op" id="3339237">+</span>&nbsp;<span class="ident" id="3339239">width</span><span class="op" id="3339244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339250">var</span>&nbsp;<span class="ident" id="3339254">flag</span>&nbsp;<span class="ident" id="3339259">syntax</span><span class="op" id="3339265">.</span><span class="ident" id="3339266">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339275">if</span>&nbsp;<span class="ident" id="3339278">pos</span>&nbsp;<span class="op" id="3339282">==</span>&nbsp;<span class="num" id="3339285">0</span>&nbsp;<span class="op" id="3339287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339291">flag</span>&nbsp;<span class="op" id="3339296">=</span>&nbsp;<span class="ident" id="3339298">syntax</span><span class="op" id="3339304">.</span><span class="ident" id="3339305">EmptyOpContext</span><span class="op" id="3339319">(</span><span class="op" id="3339320">-</span><span class="num" id="3339321">1</span><span class="op" id="3339322">,</span>&nbsp;<span class="ident" id="3339324">r</span><span class="op" id="3339325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339328">}</span>&nbsp;<span class="keyword" id="3339330">else</span>&nbsp;<span class="op" id="3339335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339339">flag</span>&nbsp;<span class="op" id="3339344">=</span>&nbsp;<span class="ident" id="3339346">i</span><span class="op" id="3339347">.</span><span class="ident" id="3339348">context</span><span class="op" id="3339355">(</span><span class="ident" id="3339356">pos</span><span class="op" id="3339359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339362">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339365">pc</span>&nbsp;<span class="op" id="3339368">:=</span>&nbsp;<span class="ident" id="3339371">m</span><span class="op" id="3339372">.</span><span class="ident" id="3339373">op</span><span class="op" id="3339375">.</span><span class="ident" id="3339376">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339383">inst</span>&nbsp;<span class="op" id="3339388">:=</span>&nbsp;<span class="ident" id="3339391">m</span><span class="op" id="3339392">.</span><span class="ident" id="3339393">op</span><span class="op" id="3339395">.</span><span class="ident" id="3339396">Inst</span><span class="op" id="3339400">[</span><span class="ident" id="3339401">pc</span><span class="op" id="3339403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339406">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339461">if</span>&nbsp;<span class="ident" id="3339464">pos</span>&nbsp;<span class="op" id="3339468">==</span>&nbsp;<span class="num" id="3339471">0</span>&nbsp;<span class="op" id="3339473">&amp;&amp;</span>&nbsp;<span class="ident" id="3339476">syntax</span><span class="op" id="3339482">.</span><span class="ident" id="3339483">EmptyOp</span><span class="op" id="3339490">(</span><span class="ident" id="3339491">inst</span><span class="op" id="3339495">.</span><span class="ident" id="3339496">Arg</span><span class="op" id="3339499">)</span><span class="op" id="3339500">&amp;^</span><span class="ident" id="3339502">flag</span>&nbsp;<span class="op" id="3339507">==</span>&nbsp;<span class="num" id="3339510">0</span>&nbsp;<span class="op" id="3339512">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3339517">len</span><span class="op" id="3339520">(</span><span class="ident" id="3339521">m</span><span class="op" id="3339522">.</span><span class="ident" id="3339523">re</span><span class="op" id="3339525">.</span><span class="ident" id="3339526">prefix</span><span class="op" id="3339532">)</span>&nbsp;<span class="op" id="3339534">&gt;</span>&nbsp;<span class="num" id="3339536">0</span>&nbsp;<span class="op" id="3339538">&amp;&amp;</span>&nbsp;<span class="ident" id="3339541">i</span><span class="op" id="3339542">.</span><span class="ident" id="3339543">canCheckPrefix</span><span class="op" id="3339557">(</span><span class="op" id="3339558">)</span>&nbsp;<span class="op" id="3339560">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3339564">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339620">if</span>&nbsp;<span class="ident" id="3339623">i</span><span class="op" id="3339624">.</span><span class="ident" id="3339625">hasPrefix</span><span class="op" id="3339634">(</span><span class="ident" id="3339635">m</span><span class="op" id="3339636">.</span><span class="ident" id="3339637">re</span><span class="op" id="3339639">)</span>&nbsp;<span class="op" id="3339641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339646">pos</span>&nbsp;<span class="op" id="3339650">+=</span>&nbsp;<span class="builtinfunc" id="3339653">len</span><span class="op" id="3339656">(</span><span class="ident" id="3339657">m</span><span class="op" id="3339658">.</span><span class="ident" id="3339659">re</span><span class="op" id="3339661">.</span><span class="ident" id="3339662">prefix</span><span class="op" id="3339668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339673">r</span><span class="op" id="3339674">,</span>&nbsp;<span class="ident" id="3339676">width</span>&nbsp;<span class="op" id="3339682">=</span>&nbsp;<span class="ident" id="3339684">i</span><span class="op" id="3339685">.</span><span class="ident" id="3339686">step</span><span class="op" id="3339690">(</span><span class="ident" id="3339691">pos</span><span class="op" id="3339694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339699">r1</span><span class="op" id="3339701">,</span>&nbsp;<span class="ident" id="3339703">width1</span>&nbsp;<span class="op" id="3339710">=</span>&nbsp;<span class="ident" id="3339712">i</span><span class="op" id="3339713">.</span><span class="ident" id="3339714">step</span><span class="op" id="3339718">(</span><span class="ident" id="3339719">pos</span>&nbsp;<span class="op" id="3339723">+</span>&nbsp;<span class="ident" id="3339725">width</span><span class="op" id="3339730">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339735">flag</span>&nbsp;<span class="op" id="3339740">=</span>&nbsp;<span class="ident" id="3339742">i</span><span class="op" id="3339743">.</span><span class="ident" id="3339744">context</span><span class="op" id="3339751">(</span><span class="ident" id="3339752">pos</span><span class="op" id="3339755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339760">pc</span>&nbsp;<span class="op" id="3339763">=</span>&nbsp;<span class="builtintype" id="3339765">int</span><span class="op" id="3339768">(</span><span class="ident" id="3339769">m</span><span class="op" id="3339770">.</span><span class="ident" id="3339771">re</span><span class="op" id="3339773">.</span><span class="ident" id="3339774">prefixEnd</span><span class="op" id="3339783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339787">}</span>&nbsp;<span class="keyword" id="3339789">else</span>&nbsp;<span class="op" id="3339794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339799">return</span>&nbsp;<span class="ident" id="3339806">m</span><span class="op" id="3339807">.</span><span class="ident" id="3339808">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339818">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339824">for</span>&nbsp;<span class="op" id="3339828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339832">inst</span>&nbsp;<span class="op" id="3339837">=</span>&nbsp;<span class="ident" id="3339839">m</span><span class="op" id="3339840">.</span><span class="ident" id="3339841">op</span><span class="op" id="3339843">.</span><span class="ident" id="3339844">Inst</span><span class="op" id="3339848">[</span><span class="ident" id="3339849">pc</span><span class="op" id="3339851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339855">pc</span>&nbsp;<span class="op" id="3339858">=</span>&nbsp;<span class="builtintype" id="3339860">int</span><span class="op" id="3339863">(</span><span class="ident" id="3339864">inst</span><span class="op" id="3339868">.</span><span class="ident" id="3339869">Out</span><span class="op" id="3339872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339876">switch</span>&nbsp;<span class="ident" id="3339883">inst</span><span class="op" id="3339887">.</span><span class="ident" id="3339888">Op</span>&nbsp;<span class="op" id="3339891">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339895">default</span><span class="op" id="3339902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3339907">panic</span><span class="op" id="3339912">(</span><span class="string" id="3339913">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3339923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339927">case</span>&nbsp;<span class="ident" id="3339932">syntax</span><span class="op" id="3339938">.</span><span class="ident" id="3339939">InstMatch</span><span class="op" id="3339948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339953">m</span><span class="op" id="3339954">.</span><span class="ident" id="3339955">matched</span>&nbsp;<span class="op" id="3339963">=</span>&nbsp;<span class="builtintype" id="3339965">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339973">if</span>&nbsp;<span class="builtinfunc" id="3339976">len</span><span class="op" id="3339979">(</span><span class="ident" id="3339980">m</span><span class="op" id="3339981">.</span><span class="ident" id="3339982">matchcap</span><span class="op" id="3339990">)</span>&nbsp;<span class="op" id="3339992">&gt;</span>&nbsp;<span class="num" id="3339994">0</span>&nbsp;<span class="op" id="3339996">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340002">m</span><span class="op" id="3340003">.</span><span class="ident" id="3340004">matchcap</span><span class="op" id="3340012">[</span><span class="num" id="3340013">0</span><span class="op" id="3340014">]</span>&nbsp;<span class="op" id="3340016">=</span>&nbsp;<span class="num" id="3340018">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340024">m</span><span class="op" id="3340025">.</span><span class="ident" id="3340026">matchcap</span><span class="op" id="3340034">[</span><span class="num" id="3340035">1</span><span class="op" id="3340036">]</span>&nbsp;<span class="op" id="3340038">=</span>&nbsp;<span class="ident" id="3340040">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340052">return</span>&nbsp;<span class="ident" id="3340059">m</span><span class="op" id="3340060">.</span><span class="ident" id="3340061">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340071">case</span>&nbsp;<span class="ident" id="3340076">syntax</span><span class="op" id="3340082">.</span><span class="ident" id="3340083">InstRune</span><span class="op" id="3340091">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340096">if</span>&nbsp;<span class="op" id="3340099">!</span><span class="ident" id="3340100">inst</span><span class="op" id="3340104">.</span><span class="ident" id="3340105">MatchRune</span><span class="op" id="3340114">(</span><span class="ident" id="3340115">r</span><span class="op" id="3340116">)</span>&nbsp;<span class="op" id="3340118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340124">return</span>&nbsp;<span class="ident" id="3340131">m</span><span class="op" id="3340132">.</span><span class="ident" id="3340133">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340148">case</span>&nbsp;<span class="ident" id="3340153">syntax</span><span class="op" id="3340159">.</span><span class="ident" id="3340160">InstRune1</span><span class="op" id="3340169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340174">if</span>&nbsp;<span class="ident" id="3340177">r</span>&nbsp;<span class="op" id="3340179">!=</span>&nbsp;<span class="ident" id="3340182">inst</span><span class="op" id="3340186">.</span><span class="ident" id="3340187">Rune</span><span class="op" id="3340191">[</span><span class="num" id="3340192">0</span><span class="op" id="3340193">]</span>&nbsp;<span class="op" id="3340195">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340201">return</span>&nbsp;<span class="ident" id="3340208">m</span><span class="op" id="3340209">.</span><span class="ident" id="3340210">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340225">case</span>&nbsp;<span class="ident" id="3340230">syntax</span><span class="op" id="3340236">.</span><span class="ident" id="3340237">InstRuneAny</span><span class="op" id="3340248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340253">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340266">case</span>&nbsp;<span class="ident" id="3340271">syntax</span><span class="op" id="3340277">.</span><span class="ident" id="3340278">InstRuneAnyNotNL</span><span class="op" id="3340294">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340299">if</span>&nbsp;<span class="ident" id="3340302">r</span>&nbsp;<span class="op" id="3340304">==</span>&nbsp;<span class="string" id="3340307">&#39;\n&#39;</span>&nbsp;<span class="op" id="3340312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340318">return</span>&nbsp;<span class="ident" id="3340325">m</span><span class="op" id="3340326">.</span><span class="ident" id="3340327">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340342">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340409">case</span>&nbsp;<span class="ident" id="3340414">syntax</span><span class="op" id="3340420">.</span><span class="ident" id="3340421">InstAlt</span><span class="op" id="3340428">,</span>&nbsp;<span class="ident" id="3340430">syntax</span><span class="op" id="3340436">.</span><span class="ident" id="3340437">InstAltMatch</span><span class="op" id="3340449">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340454">pc</span>&nbsp;<span class="op" id="3340457">=</span>&nbsp;<span class="builtintype" id="3340459">int</span><span class="op" id="3340462">(</span><span class="ident" id="3340463">onePassNext</span><span class="op" id="3340474">(</span><span class="op" id="3340475">&amp;</span><span class="ident" id="3340476">inst</span><span class="op" id="3340480">,</span>&nbsp;<span class="ident" id="3340482">r</span><span class="op" id="3340483">)</span><span class="op" id="3340484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340489">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340500">case</span>&nbsp;<span class="ident" id="3340505">syntax</span><span class="op" id="3340511">.</span><span class="ident" id="3340512">InstFail</span><span class="op" id="3340520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340525">return</span>&nbsp;<span class="ident" id="3340532">m</span><span class="op" id="3340533">.</span><span class="ident" id="3340534">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340544">case</span>&nbsp;<span class="ident" id="3340549">syntax</span><span class="op" id="3340555">.</span><span class="ident" id="3340556">InstNop</span><span class="op" id="3340563">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340568">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340579">case</span>&nbsp;<span class="ident" id="3340584">syntax</span><span class="op" id="3340590">.</span><span class="ident" id="3340591">InstEmptyWidth</span><span class="op" id="3340605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340610">if</span>&nbsp;<span class="ident" id="3340613">syntax</span><span class="op" id="3340619">.</span><span class="ident" id="3340620">EmptyOp</span><span class="op" id="3340627">(</span><span class="ident" id="3340628">inst</span><span class="op" id="3340632">.</span><span class="ident" id="3340633">Arg</span><span class="op" id="3340636">)</span><span class="op" id="3340637">&amp;^</span><span class="ident" id="3340639">flag</span>&nbsp;<span class="op" id="3340644">!=</span>&nbsp;<span class="num" id="3340647">0</span>&nbsp;<span class="op" id="3340649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340655">return</span>&nbsp;<span class="ident" id="3340662">m</span><span class="op" id="3340663">.</span><span class="ident" id="3340664">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340675">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340680">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340691">case</span>&nbsp;<span class="ident" id="3340696">syntax</span><span class="op" id="3340702">.</span><span class="ident" id="3340703">InstCapture</span><span class="op" id="3340714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340719">if</span>&nbsp;<span class="builtintype" id="3340722">int</span><span class="op" id="3340725">(</span><span class="ident" id="3340726">inst</span><span class="op" id="3340730">.</span><span class="ident" id="3340731">Arg</span><span class="op" id="3340734">)</span>&nbsp;<span class="op" id="3340736">&lt;</span>&nbsp;<span class="builtinfunc" id="3340738">len</span><span class="op" id="3340741">(</span><span class="ident" id="3340742">m</span><span class="op" id="3340743">.</span><span class="ident" id="3340744">matchcap</span><span class="op" id="3340752">)</span>&nbsp;<span class="op" id="3340754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340760">m</span><span class="op" id="3340761">.</span><span class="ident" id="3340762">matchcap</span><span class="op" id="3340770">[</span><span class="ident" id="3340771">inst</span><span class="op" id="3340775">.</span><span class="ident" id="3340776">Arg</span><span class="op" id="3340779">]</span>&nbsp;<span class="op" id="3340781">=</span>&nbsp;<span class="ident" id="3340783">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340790">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340795">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340810">if</span>&nbsp;<span class="ident" id="3340813">width</span>&nbsp;<span class="op" id="3340819">==</span>&nbsp;<span class="num" id="3340822">0</span>&nbsp;<span class="op" id="3340824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340829">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340837">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340841">flag</span>&nbsp;<span class="op" id="3340846">=</span>&nbsp;<span class="ident" id="3340848">syntax</span><span class="op" id="3340854">.</span><span class="ident" id="3340855">EmptyOpContext</span><span class="op" id="3340869">(</span><span class="ident" id="3340870">r</span><span class="op" id="3340871">,</span>&nbsp;<span class="ident" id="3340873">r1</span><span class="op" id="3340875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340879">pos</span>&nbsp;<span class="op" id="3340883">+=</span>&nbsp;<span class="ident" id="3340886">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340894">r</span><span class="op" id="3340895">,</span>&nbsp;<span class="ident" id="3340897">width</span>&nbsp;<span class="op" id="3340903">=</span>&nbsp;<span class="ident" id="3340905">r1</span><span class="op" id="3340907">,</span>&nbsp;<span class="ident" id="3340909">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340918">if</span>&nbsp;<span class="ident" id="3340921">r</span>&nbsp;<span class="op" id="3340923">!=</span>&nbsp;<span class="ident" id="3340926">endOfText</span>&nbsp;<span class="op" id="3340936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340941">r1</span><span class="op" id="3340943">,</span>&nbsp;<span class="ident" id="3340945">width1</span>&nbsp;<span class="op" id="3340952">=</span>&nbsp;<span class="ident" id="3340954">i</span><span class="op" id="3340955">.</span><span class="ident" id="3340956">step</span><span class="op" id="3340960">(</span><span class="ident" id="3340961">pos</span>&nbsp;<span class="op" id="3340965">+</span>&nbsp;<span class="ident" id="3340967">width</span><span class="op" id="3340972">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340982">return</span>&nbsp;<span class="ident" id="3340989">m</span><span class="op" id="3340990">.</span><span class="ident" id="3340991">matched</span><br>
<span class="lineno"></span><span class="op" id="3340999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3341002">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="3341041">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="3341081">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3341139">var</span>&nbsp;<span class="ident" id="3341143">empty</span>&nbsp;<span class="op" id="3341149">=</span>&nbsp;<span class="builtinfunc" id="3341151">make</span><span class="op" id="3341155">(</span><span class="op" id="3341156">[</span><span class="op" id="3341157">]</span><span class="builtintype" id="3341158">int</span><span class="op" id="3341161">,</span>&nbsp;<span class="num" id="3341163">0</span><span class="op" id="3341164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3341167">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3341230">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3341269">func</span>&nbsp;<span class="op" id="3341274">(</span><span class="ident" id="3341275">re</span>&nbsp;<span class="op" id="3341278">*</span><span class="ident" id="3341279">Regexp</span><span class="op" id="3341285">)</span>&nbsp;<span class="ident" id="3341287">doExecute</span><span class="op" id="3341296">(</span><span class="ident" id="3341297">r</span>&nbsp;<span class="ident" id="3341299">io</span><span class="op" id="3341301">.</span><span class="ident" id="3341302">RuneReader</span><span class="op" id="3341312">,</span>&nbsp;<span class="ident" id="3341314">b</span>&nbsp;<span class="op" id="3341316">[</span><span class="op" id="3341317">]</span><span class="builtintype" id="3341318">byte</span><span class="op" id="3341322">,</span>&nbsp;<span class="ident" id="3341324">s</span>&nbsp;<span class="builtintype" id="3341326">string</span><span class="op" id="3341332">,</span>&nbsp;<span class="ident" id="3341334">pos</span>&nbsp;<span class="builtintype" id="3341338">int</span><span class="op" id="3341341">,</span>&nbsp;<span class="ident" id="3341343">ncap</span>&nbsp;<span class="builtintype" id="3341348">int</span><span class="op" id="3341351">)</span>&nbsp;<span class="op" id="3341353">[</span><span class="op" id="3341354">]</span><span class="builtintype" id="3341355">int</span>&nbsp;<span class="op" id="3341359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341362">m</span>&nbsp;<span class="op" id="3341364">:=</span>&nbsp;<span class="ident" id="3341367">re</span><span class="op" id="3341369">.</span><span class="ident" id="3341370">get</span><span class="op" id="3341373">(</span><span class="op" id="3341374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341377">var</span>&nbsp;<span class="ident" id="3341381">i</span>&nbsp;<span class="ident" id="3341383">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341390">if</span>&nbsp;<span class="ident" id="3341393">r</span>&nbsp;<span class="op" id="3341395">!=</span>&nbsp;<span class="ident" id="3341398">nil</span>&nbsp;<span class="op" id="3341402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341406">i</span>&nbsp;<span class="op" id="3341408">=</span>&nbsp;<span class="ident" id="3341410">m</span><span class="op" id="3341411">.</span><span class="ident" id="3341412">newInputReader</span><span class="op" id="3341426">(</span><span class="ident" id="3341427">r</span><span class="op" id="3341428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341431">}</span>&nbsp;<span class="keyword" id="3341433">else</span>&nbsp;<span class="keyword" id="3341438">if</span>&nbsp;<span class="ident" id="3341441">b</span>&nbsp;<span class="op" id="3341443">!=</span>&nbsp;<span class="ident" id="3341446">nil</span>&nbsp;<span class="op" id="3341450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341454">i</span>&nbsp;<span class="op" id="3341456">=</span>&nbsp;<span class="ident" id="3341458">m</span><span class="op" id="3341459">.</span><span class="ident" id="3341460">newInputBytes</span><span class="op" id="3341473">(</span><span class="ident" id="3341474">b</span><span class="op" id="3341475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341478">}</span>&nbsp;<span class="keyword" id="3341480">else</span>&nbsp;<span class="op" id="3341485">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341489">i</span>&nbsp;<span class="op" id="3341491">=</span>&nbsp;<span class="ident" id="3341493">m</span><span class="op" id="3341494">.</span><span class="ident" id="3341495">newInputString</span><span class="op" id="3341509">(</span><span class="ident" id="3341510">s</span><span class="op" id="3341511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341517">if</span>&nbsp;<span class="ident" id="3341520">m</span><span class="op" id="3341521">.</span><span class="ident" id="3341522">op</span>&nbsp;<span class="op" id="3341525">!=</span>&nbsp;<span class="ident" id="3341528">notOnePass</span>&nbsp;<span class="op" id="3341539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341543">if</span>&nbsp;<span class="op" id="3341546">!</span><span class="ident" id="3341547">m</span><span class="op" id="3341548">.</span><span class="ident" id="3341549">onepass</span><span class="op" id="3341556">(</span><span class="ident" id="3341557">i</span><span class="op" id="3341558">,</span>&nbsp;<span class="ident" id="3341560">pos</span><span class="op" id="3341563">)</span>&nbsp;<span class="op" id="3341565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341570">re</span><span class="op" id="3341572">.</span><span class="ident" id="3341573">put</span><span class="op" id="3341576">(</span><span class="ident" id="3341577">m</span><span class="op" id="3341578">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341583">return</span>&nbsp;<span class="ident" id="3341590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341599">}</span>&nbsp;<span class="keyword" id="3341601">else</span>&nbsp;<span class="op" id="3341606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341610">m</span><span class="op" id="3341611">.</span><span class="ident" id="3341612">init</span><span class="op" id="3341616">(</span><span class="ident" id="3341617">ncap</span><span class="op" id="3341621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341625">if</span>&nbsp;<span class="op" id="3341628">!</span><span class="ident" id="3341629">m</span><span class="op" id="3341630">.</span><span class="ident" id="3341631">match</span><span class="op" id="3341636">(</span><span class="ident" id="3341637">i</span><span class="op" id="3341638">,</span>&nbsp;<span class="ident" id="3341640">pos</span><span class="op" id="3341643">)</span>&nbsp;<span class="op" id="3341645">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341650">re</span><span class="op" id="3341652">.</span><span class="ident" id="3341653">put</span><span class="op" id="3341656">(</span><span class="ident" id="3341657">m</span><span class="op" id="3341658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341663">return</span>&nbsp;<span class="ident" id="3341670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341682">if</span>&nbsp;<span class="ident" id="3341685">ncap</span>&nbsp;<span class="op" id="3341690">==</span>&nbsp;<span class="num" id="3341693">0</span>&nbsp;<span class="op" id="3341695">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341699">re</span><span class="op" id="3341701">.</span><span class="ident" id="3341702">put</span><span class="op" id="3341705">(</span><span class="ident" id="3341706">m</span><span class="op" id="3341707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341711">return</span>&nbsp;<span class="ident" id="3341718">empty</span>&nbsp;<span class="comment" id="3341724">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3341749">cap</span>&nbsp;<span class="op" id="3341753">:=</span>&nbsp;<span class="builtinfunc" id="3341756">make</span><span class="op" id="3341760">(</span><span class="op" id="3341761">[</span><span class="op" id="3341762">]</span><span class="builtintype" id="3341763">int</span><span class="op" id="3341766">,</span>&nbsp;<span class="builtinfunc" id="3341768">len</span><span class="op" id="3341771">(</span><span class="ident" id="3341772">m</span><span class="op" id="3341773">.</span><span class="ident" id="3341774">matchcap</span><span class="op" id="3341782">)</span><span class="op" id="3341783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3341786">copy</span><span class="op" id="3341790">(</span><span class="builtinfunc" id="3341791">cap</span><span class="op" id="3341794">,</span>&nbsp;<span class="ident" id="3341796">m</span><span class="op" id="3341797">.</span><span class="ident" id="3341798">matchcap</span><span class="op" id="3341806">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3341809">re</span><span class="op" id="3341811">.</span><span class="ident" id="3341812">put</span><span class="op" id="3341815">(</span><span class="ident" id="3341816">m</span><span class="op" id="3341817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341820">return</span>&nbsp;<span class="builtinfunc" id="3341827">cap</span><br>
<span class="lineno"></span><span class="op" id="3341831">}</span>
</div>
</body>
</html>
