<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6014888">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6014944">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6014998">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6015049">package</span>&nbsp;<span class="ident" id="6015057">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6015064">import</span>&nbsp;<span class="op" id="6015071">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6015074">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6015085">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6015093">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6015100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6015103">//&nbsp;GCStats&nbsp;collect&nbsp;information&nbsp;about&nbsp;recent&nbsp;garbage&nbsp;collections.</span><br>
<span class="lineno"></span><span class="keyword" id="6015168">type</span>&nbsp;<span class="ident" id="6015173">GCStats</span>&nbsp;<span class="keyword" id="6015181">struct</span>&nbsp;<span class="op" id="6015188">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015191">LastGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015206"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6015210">.</span><span class="ident" id="6015211">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015222">//&nbsp;time&nbsp;of&nbsp;last&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015250">NumGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015265">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015281">//&nbsp;number&nbsp;of&nbsp;garbage&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015315">PauseTotal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6015330"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6015334">.</span><span class="ident" id="6015335">Duration</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6015346">//&nbsp;total&nbsp;pause&nbsp;for&nbsp;all&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015382">Pause</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015397">[</span><span class="op" id="6015398">]</span><span class="ident" id="6015399"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6015403">.</span><span class="ident" id="6015404">Duration</span>&nbsp;<span class="comment" id="6015413">//&nbsp;pause&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015450">PauseEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6015465">[</span><span class="op" id="6015466">]</span><span class="ident" id="6015467"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6015471">.</span><span class="ident" id="6015472">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6015481">//&nbsp;pause&nbsp;end&nbsp;times&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015528">PauseQuantiles</span>&nbsp;<span class="op" id="6015543">[</span><span class="op" id="6015544">]</span><span class="ident" id="6015545"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6015549">.</span><span class="ident" id="6015550">Duration</span><br>
<span class="lineno"></span><span class="op" id="6015559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6015562">//&nbsp;ReadGCStats&nbsp;reads&nbsp;statistics&nbsp;about&nbsp;garbage&nbsp;collection&nbsp;into&nbsp;stats.</span><br>
<span class="lineno"></span><span class="comment" id="6015631">//&nbsp;The&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;pause&nbsp;history&nbsp;is&nbsp;system-dependent;</span><br>
<span class="lineno">25</span><span class="comment" id="6015698">//&nbsp;stats.Pause&nbsp;slice&nbsp;will&nbsp;be&nbsp;reused&nbsp;if&nbsp;large&nbsp;enough,&nbsp;reallocated&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="6015774">//&nbsp;ReadGCStats&nbsp;may&nbsp;use&nbsp;the&nbsp;full&nbsp;capacity&nbsp;of&nbsp;the&nbsp;stats.Pause&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="6015841">//&nbsp;If&nbsp;stats.PauseQuantiles&nbsp;is&nbsp;non-empty,&nbsp;ReadGCStats&nbsp;fills&nbsp;it&nbsp;with&nbsp;quantiles</span><br>
<span class="lineno"></span><span class="comment" id="6015918">//&nbsp;summarizing&nbsp;the&nbsp;distribution&nbsp;of&nbsp;pause&nbsp;time.&nbsp;For&nbsp;example,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6015981">//&nbsp;len(stats.PauseQuantiles)&nbsp;is&nbsp;5,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with&nbsp;the&nbsp;minimum,</span><br>
<span class="lineno">30</span><span class="comment" id="6016052">//&nbsp;25%,&nbsp;50%,&nbsp;75%,&nbsp;and&nbsp;maximum&nbsp;pause&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="6016095">func</span>&nbsp;<span class="ident" id="6016100">ReadGCStats</span><span class="op" id="6016111">(</span><span class="ident" id="6016112">stats</span>&nbsp;<span class="op" id="6016118">*</span><span class="ident" id="6016119"><a href="/runtime/debug/garbage.go.html#6015173">GCStats</a></span><span class="op" id="6016126">)</span>&nbsp;<span class="op" id="6016128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016131">//&nbsp;Create&nbsp;a&nbsp;buffer&nbsp;with&nbsp;space&nbsp;for&nbsp;at&nbsp;least&nbsp;two&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016193">//&nbsp;pause&nbsp;history&nbsp;tracked&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;One&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016256">//&nbsp;to&nbsp;the&nbsp;caller&nbsp;and&nbsp;the&nbsp;other&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;transfer&nbsp;buffer</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016320">//&nbsp;for&nbsp;end&nbsp;times&nbsp;history&nbsp;and&nbsp;as&nbsp;a&nbsp;temporary&nbsp;buffer&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016376">//&nbsp;computing&nbsp;quantiles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016401">const</span>&nbsp;<span class="ident" id="6016407">maxPause</span>&nbsp;<span class="op" id="6016416">=</span>&nbsp;<span class="builtinfunc" id="6016418">len</span><span class="op" id="6016421">(</span><span class="op" id="6016422">(</span><span class="op" id="6016423">(</span><span class="op" id="6016424">*</span><span class="ident" id="6016425"><a href="/runtime/debug/garbage.go.html#6015074">runtime</a></span><span class="op" id="6016432">.</span><span class="ident" id="6016433">MemStats</span><span class="op" id="6016441">)</span><span class="op" id="6016442">(</span><span class="ident" id="6016443">nil</span><span class="op" id="6016446">)</span><span class="op" id="6016447">)</span><span class="op" id="6016448">.</span><span class="ident" id="6016449">PauseNs</span><span class="op" id="6016456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016459">if</span>&nbsp;<span class="builtinfunc" id="6016462">cap</span><span class="op" id="6016465">(</span><span class="ident" id="6016466"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016471">.</span><span class="ident" id="6016472">Pause</span><span class="op" id="6016477">)</span>&nbsp;<span class="op" id="6016479">&lt;</span>&nbsp;<span class="num" id="6016481">2</span><span class="op" id="6016482">*</span><span class="ident" id="6016483"><a href="/runtime/debug/garbage.go.html#6016407">maxPause</a></span><span class="op" id="6016491">+</span><span class="num" id="6016492">3</span>&nbsp;<span class="op" id="6016494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016498"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016503">.</span><span class="ident" id="6016504">Pause</span>&nbsp;<span class="op" id="6016510">=</span>&nbsp;<span class="builtinfunc" id="6016512">make</span><span class="op" id="6016516">(</span><span class="op" id="6016517">[</span><span class="op" id="6016518">]</span><span class="ident" id="6016519"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6016523">.</span><span class="ident" id="6016524">Duration</span><span class="op" id="6016532">,</span>&nbsp;<span class="num" id="6016534">2</span><span class="op" id="6016535">*</span><span class="ident" id="6016536"><a href="/runtime/debug/garbage.go.html#6016407">maxPause</a></span><span class="op" id="6016544">+</span><span class="num" id="6016545">3</span><span class="op" id="6016546">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016553">//&nbsp;readGCStats&nbsp;fills&nbsp;in&nbsp;the&nbsp;pause&nbsp;and&nbsp;end&nbsp;times&nbsp;histories&nbsp;(up&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016619">//&nbsp;maxPause&nbsp;entries)&nbsp;and&nbsp;then&nbsp;three&nbsp;more:&nbsp;Unix&nbsp;ns&nbsp;time&nbsp;of&nbsp;last&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016687">//&nbsp;number&nbsp;of&nbsp;GC,&nbsp;and&nbsp;total&nbsp;pause&nbsp;time&nbsp;in&nbsp;nanoseconds.&nbsp;Here&nbsp;we</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016750">//&nbsp;depend&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;time.Duration&#39;s&nbsp;native&nbsp;unit&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016809">//&nbsp;nanoseconds,&nbsp;so&nbsp;the&nbsp;pauses&nbsp;and&nbsp;the&nbsp;total&nbsp;pause&nbsp;time&nbsp;do&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016877">//&nbsp;any&nbsp;conversion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016897"><a href="/runtime/debug/stubs.go.html#6024468">readGCStats</a></span><span class="op" id="6016908">(</span><span class="op" id="6016909">&amp;</span><span class="ident" id="6016910"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016915">.</span><span class="ident" id="6016916">Pause</span><span class="op" id="6016921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016924">n</span>&nbsp;<span class="op" id="6016926">:=</span>&nbsp;<span class="builtinfunc" id="6016929">len</span><span class="op" id="6016932">(</span><span class="ident" id="6016933"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016938">.</span><span class="ident" id="6016939">Pause</span><span class="op" id="6016944">)</span>&nbsp;<span class="op" id="6016946">-</span>&nbsp;<span class="num" id="6016948">3</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016951"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016956">.</span><span class="ident" id="6016957">LastGC</span>&nbsp;<span class="op" id="6016964">=</span>&nbsp;<span class="ident" id="6016966"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6016970">.</span><span class="ident" id="6016971">Unix</span><span class="op" id="6016975">(</span><span class="num" id="6016976">0</span><span class="op" id="6016977">,</span>&nbsp;<span class="ident" id="6016979">int64</span><span class="op" id="6016984">(</span><span class="ident" id="6016985"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6016990">.</span><span class="ident" id="6016991">Pause</span><span class="op" id="6016996">[</span><span class="ident" id="6016997"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6016998">]</span><span class="op" id="6016999">)</span><span class="op" id="6017000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017003"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017008">.</span><span class="ident" id="6017009">NumGC</span>&nbsp;<span class="op" id="6017015">=</span>&nbsp;<span class="ident" id="6017017">int64</span><span class="op" id="6017022">(</span><span class="ident" id="6017023"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017028">.</span><span class="ident" id="6017029">Pause</span><span class="op" id="6017034">[</span><span class="ident" id="6017035"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017036">+</span><span class="num" id="6017037">1</span><span class="op" id="6017038">]</span><span class="op" id="6017039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017042"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017047">.</span><span class="ident" id="6017048">PauseTotal</span>&nbsp;<span class="op" id="6017059">=</span>&nbsp;<span class="ident" id="6017061"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017066">.</span><span class="ident" id="6017067">Pause</span><span class="op" id="6017072">[</span><span class="ident" id="6017073"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017074">+</span><span class="num" id="6017075">2</span><span class="op" id="6017076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017079"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span>&nbsp;<span class="op" id="6017081">/=</span>&nbsp;<span class="num" id="6017084">2</span>&nbsp;<span class="comment" id="6017086">//&nbsp;buffer&nbsp;holds&nbsp;pauses&nbsp;and&nbsp;end&nbsp;times</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017124"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017129">.</span><span class="ident" id="6017130">Pause</span>&nbsp;<span class="op" id="6017136">=</span>&nbsp;<span class="ident" id="6017138"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017143">.</span><span class="ident" id="6017144">Pause</span><span class="op" id="6017149">[</span><span class="op" id="6017150">:</span><span class="ident" id="6017151"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017152">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017156">if</span>&nbsp;<span class="builtinfunc" id="6017159">cap</span><span class="op" id="6017162">(</span><span class="ident" id="6017163"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017168">.</span><span class="ident" id="6017169">PauseEnd</span><span class="op" id="6017177">)</span>&nbsp;<span class="op" id="6017179">&lt;</span>&nbsp;<span class="ident" id="6017181"><a href="/runtime/debug/garbage.go.html#6016407">maxPause</a></span>&nbsp;<span class="op" id="6017190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017194"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017199">.</span><span class="ident" id="6017200">PauseEnd</span>&nbsp;<span class="op" id="6017209">=</span>&nbsp;<span class="builtinfunc" id="6017211">make</span><span class="op" id="6017215">(</span><span class="op" id="6017216">[</span><span class="op" id="6017217">]</span><span class="ident" id="6017218"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6017222">.</span><span class="ident" id="6017223">Time</span><span class="op" id="6017227">,</span>&nbsp;<span class="num" id="6017229">0</span><span class="op" id="6017230">,</span>&nbsp;<span class="ident" id="6017232"><a href="/runtime/debug/garbage.go.html#6016407">maxPause</a></span><span class="op" id="6017240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017246"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017251">.</span><span class="ident" id="6017252">PauseEnd</span>&nbsp;<span class="op" id="6017261">=</span>&nbsp;<span class="ident" id="6017263"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017268">.</span><span class="ident" id="6017269">PauseEnd</span><span class="op" id="6017277">[</span><span class="op" id="6017278">:</span><span class="num" id="6017279">0</span><span class="op" id="6017280">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017283">for</span>&nbsp;<span class="ident" id="6017287">_</span><span class="op" id="6017288">,</span>&nbsp;<span class="ident" id="6017290">ns</span>&nbsp;<span class="op" id="6017293">:=</span>&nbsp;<span class="keyword" id="6017296">range</span>&nbsp;<span class="ident" id="6017302"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017307">.</span><span class="ident" id="6017308">Pause</span><span class="op" id="6017313">[</span><span class="ident" id="6017314"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span>&nbsp;<span class="op" id="6017316">:</span>&nbsp;<span class="ident" id="6017318"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017319">+</span><span class="ident" id="6017320"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017321">]</span>&nbsp;<span class="op" id="6017323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017327"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017332">.</span><span class="ident" id="6017333">PauseEnd</span>&nbsp;<span class="op" id="6017342">=</span>&nbsp;<span class="builtinfunc" id="6017344">append</span><span class="op" id="6017350">(</span><span class="ident" id="6017351"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017356">.</span><span class="ident" id="6017357">PauseEnd</span><span class="op" id="6017365">,</span>&nbsp;<span class="ident" id="6017367"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6017371">.</span><span class="ident" id="6017372">Unix</span><span class="op" id="6017376">(</span><span class="num" id="6017377">0</span><span class="op" id="6017378">,</span>&nbsp;<span class="ident" id="6017380">int64</span><span class="op" id="6017385">(</span><span class="ident" id="6017386"><a href="/runtime/debug/garbage.go.html#6017290">ns</a></span><span class="op" id="6017388">)</span><span class="op" id="6017389">)</span><span class="op" id="6017390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017397">if</span>&nbsp;<span class="builtinfunc" id="6017400">len</span><span class="op" id="6017403">(</span><span class="ident" id="6017404"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017409">.</span><span class="ident" id="6017410">PauseQuantiles</span><span class="op" id="6017424">)</span>&nbsp;<span class="op" id="6017426">&gt;</span>&nbsp;<span class="num" id="6017428">0</span>&nbsp;<span class="op" id="6017430">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017434">if</span>&nbsp;<span class="ident" id="6017437"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span>&nbsp;<span class="op" id="6017439">==</span>&nbsp;<span class="num" id="6017442">0</span>&nbsp;<span class="op" id="6017444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017449">for</span>&nbsp;<span class="ident" id="6017453">i</span>&nbsp;<span class="op" id="6017455">:=</span>&nbsp;<span class="keyword" id="6017458">range</span>&nbsp;<span class="ident" id="6017464"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017469">.</span><span class="ident" id="6017470">PauseQuantiles</span>&nbsp;<span class="op" id="6017485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017491"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017496">.</span><span class="ident" id="6017497">PauseQuantiles</span><span class="op" id="6017511">[</span><span class="ident" id="6017512"><a href="/runtime/debug/garbage.go.html#6017453">i</a></span><span class="op" id="6017513">]</span>&nbsp;<span class="op" id="6017515">=</span>&nbsp;<span class="num" id="6017517">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017526">}</span>&nbsp;<span class="keyword" id="6017528">else</span>&nbsp;<span class="op" id="6017533">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017538">//&nbsp;There&#39;s&nbsp;room&nbsp;for&nbsp;a&nbsp;second&nbsp;copy&nbsp;of&nbsp;the&nbsp;data&nbsp;in&nbsp;stats.Pause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017603">//&nbsp;See&nbsp;the&nbsp;allocation&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017656">sorted</span>&nbsp;<span class="op" id="6017663">:=</span>&nbsp;<span class="ident" id="6017666"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017671">.</span><span class="ident" id="6017672">Pause</span><span class="op" id="6017677">[</span><span class="ident" id="6017678"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span>&nbsp;<span class="op" id="6017680">:</span>&nbsp;<span class="ident" id="6017682"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017683">+</span><span class="ident" id="6017684"><a href="/runtime/debug/garbage.go.html#6016924">n</a></span><span class="op" id="6017685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6017690">copy</span><span class="op" id="6017694">(</span><span class="ident" id="6017695"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017701">,</span>&nbsp;<span class="ident" id="6017703"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017708">.</span><span class="ident" id="6017709">Pause</span><span class="op" id="6017714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017719"><a href="/runtime/debug/garbage.go.html#6015085">sort</a></span><span class="op" id="6017723">.</span><span class="ident" id="6017724">Sort</span><span class="op" id="6017728">(</span><span class="ident" id="6017729"><a href="/runtime/debug/garbage.go.html#6017944">byDuration</a></span><span class="op" id="6017739">(</span><span class="ident" id="6017740"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017746">)</span><span class="op" id="6017747">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017752">nq</span>&nbsp;<span class="op" id="6017755">:=</span>&nbsp;<span class="builtinfunc" id="6017758">len</span><span class="op" id="6017761">(</span><span class="ident" id="6017762"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017767">.</span><span class="ident" id="6017768">PauseQuantiles</span><span class="op" id="6017782">)</span>&nbsp;<span class="op" id="6017784">-</span>&nbsp;<span class="num" id="6017786">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017791">for</span>&nbsp;<span class="ident" id="6017795">i</span>&nbsp;<span class="op" id="6017797">:=</span>&nbsp;<span class="num" id="6017800">0</span><span class="op" id="6017801">;</span>&nbsp;<span class="ident" id="6017803"><a href="/runtime/debug/garbage.go.html#6017795">i</a></span>&nbsp;<span class="op" id="6017805">&lt;</span>&nbsp;<span class="ident" id="6017807"><a href="/runtime/debug/garbage.go.html#6017752">nq</a></span><span class="op" id="6017809">;</span>&nbsp;<span class="ident" id="6017811"><a href="/runtime/debug/garbage.go.html#6017795">i</a></span><span class="op" id="6017812">++</span>&nbsp;<span class="op" id="6017815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017821"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017826">.</span><span class="ident" id="6017827">PauseQuantiles</span><span class="op" id="6017841">[</span><span class="ident" id="6017842"><a href="/runtime/debug/garbage.go.html#6017795">i</a></span><span class="op" id="6017843">]</span>&nbsp;<span class="op" id="6017845">=</span>&nbsp;<span class="ident" id="6017847"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017853">[</span><span class="builtinfunc" id="6017854">len</span><span class="op" id="6017857">(</span><span class="ident" id="6017858"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017864">)</span><span class="op" id="6017865">*</span><span class="ident" id="6017866"><a href="/runtime/debug/garbage.go.html#6017795">i</a></span><span class="op" id="6017867">/</span><span class="ident" id="6017868"><a href="/runtime/debug/garbage.go.html#6017752">nq</a></span><span class="op" id="6017870">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017880"><a href="/runtime/debug/garbage.go.html#6016112">stats</a></span><span class="op" id="6017885">.</span><span class="ident" id="6017886">PauseQuantiles</span><span class="op" id="6017900">[</span><span class="ident" id="6017901"><a href="/runtime/debug/garbage.go.html#6017752">nq</a></span><span class="op" id="6017903">]</span>&nbsp;<span class="op" id="6017905">=</span>&nbsp;<span class="ident" id="6017907"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017913">[</span><span class="builtinfunc" id="6017914">len</span><span class="op" id="6017917">(</span><span class="ident" id="6017918"><a href="/runtime/debug/garbage.go.html#6017656">sorted</a></span><span class="op" id="6017924">)</span><span class="op" id="6017925">-</span><span class="num" id="6017926">1</span><span class="op" id="6017927">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017934">}</span><br>
<span class="lineno"></span><span class="op" id="6017936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6017939">type</span>&nbsp;<span class="ident" id="6017944">byDuration</span>&nbsp;<span class="op" id="6017955">[</span><span class="op" id="6017956">]</span><span class="ident" id="6017957"><a href="/runtime/debug/garbage.go.html#6015093">time</a></span><span class="op" id="6017961">.</span><span class="ident" id="6017962">Duration</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6017972">func</span>&nbsp;<span class="op" id="6017977">(</span><span class="ident" id="6017978">x</span>&nbsp;<span class="ident" id="6017980"><a href="/runtime/debug/garbage.go.html#6017944">byDuration</a></span><span class="op" id="6017990">)</span>&nbsp;<span class="ident" id="6017992">Len</span><span class="op" id="6017995">(</span><span class="op" id="6017996">)</span>&nbsp;<span class="builtintype" id="6017998">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018012">{</span>&nbsp;<span class="keyword" id="6018014">return</span>&nbsp;<span class="builtinfunc" id="6018021">len</span><span class="op" id="6018024">(</span><span class="ident" id="6018025"><a href="/runtime/debug/garbage.go.html#6017978">x</a></span><span class="op" id="6018026">)</span>&nbsp;<span class="op" id="6018028">}</span><br>
<span class="lineno"></span><span class="keyword" id="6018030">func</span>&nbsp;<span class="op" id="6018035">(</span><span class="ident" id="6018036">x</span>&nbsp;<span class="ident" id="6018038"><a href="/runtime/debug/garbage.go.html#6017944">byDuration</a></span><span class="op" id="6018048">)</span>&nbsp;<span class="ident" id="6018050">Swap</span><span class="op" id="6018054">(</span><span class="ident" id="6018055">i</span><span class="op" id="6018056">,</span>&nbsp;<span class="ident" id="6018058">j</span>&nbsp;<span class="builtintype" id="6018060">int</span><span class="op" id="6018063">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018070">{</span>&nbsp;<span class="ident" id="6018072"><a href="/runtime/debug/garbage.go.html#6018036">x</a></span><span class="op" id="6018073">[</span><span class="ident" id="6018074"><a href="/runtime/debug/garbage.go.html#6018055">i</a></span><span class="op" id="6018075">]</span><span class="op" id="6018076">,</span>&nbsp;<span class="ident" id="6018078"><a href="/runtime/debug/garbage.go.html#6018036">x</a></span><span class="op" id="6018079">[</span><span class="ident" id="6018080"><a href="/runtime/debug/garbage.go.html#6018058">j</a></span><span class="op" id="6018081">]</span>&nbsp;<span class="op" id="6018083">=</span>&nbsp;<span class="ident" id="6018085"><a href="/runtime/debug/garbage.go.html#6018036">x</a></span><span class="op" id="6018086">[</span><span class="ident" id="6018087"><a href="/runtime/debug/garbage.go.html#6018058">j</a></span><span class="op" id="6018088">]</span><span class="op" id="6018089">,</span>&nbsp;<span class="ident" id="6018091"><a href="/runtime/debug/garbage.go.html#6018036">x</a></span><span class="op" id="6018092">[</span><span class="ident" id="6018093"><a href="/runtime/debug/garbage.go.html#6018055">i</a></span><span class="op" id="6018094">]</span>&nbsp;<span class="op" id="6018096">}</span><br>
<span class="lineno"></span><span class="keyword" id="6018098">func</span>&nbsp;<span class="op" id="6018103">(</span><span class="ident" id="6018104">x</span>&nbsp;<span class="ident" id="6018106"><a href="/runtime/debug/garbage.go.html#6017944">byDuration</a></span><span class="op" id="6018116">)</span>&nbsp;<span class="ident" id="6018118">Less</span><span class="op" id="6018122">(</span><span class="ident" id="6018123">i</span><span class="op" id="6018124">,</span>&nbsp;<span class="ident" id="6018126">j</span>&nbsp;<span class="builtintype" id="6018128">int</span><span class="op" id="6018131">)</span>&nbsp;<span class="builtintype" id="6018133">bool</span>&nbsp;<span class="op" id="6018138">{</span>&nbsp;<span class="keyword" id="6018140">return</span>&nbsp;<span class="ident" id="6018147"><a href="/runtime/debug/garbage.go.html#6018104">x</a></span><span class="op" id="6018148">[</span><span class="ident" id="6018149"><a href="/runtime/debug/garbage.go.html#6018123">i</a></span><span class="op" id="6018150">]</span>&nbsp;<span class="op" id="6018152">&lt;</span>&nbsp;<span class="ident" id="6018154"><a href="/runtime/debug/garbage.go.html#6018104">x</a></span><span class="op" id="6018155">[</span><span class="ident" id="6018156"><a href="/runtime/debug/garbage.go.html#6018126">j</a></span><span class="op" id="6018157">]</span>&nbsp;<span class="op" id="6018159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6018162">//&nbsp;SetGCPercent&nbsp;sets&nbsp;the&nbsp;garbage&nbsp;collection&nbsp;target&nbsp;percentage:</span><br>
<span class="lineno"></span><span class="comment" id="6018225">//&nbsp;a&nbsp;collection&nbsp;is&nbsp;triggered&nbsp;when&nbsp;the&nbsp;ratio&nbsp;of&nbsp;freshly&nbsp;allocated&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6018295">//&nbsp;to&nbsp;live&nbsp;data&nbsp;remaining&nbsp;after&nbsp;the&nbsp;previous&nbsp;collection&nbsp;reaches&nbsp;this&nbsp;percentage.</span><br>
<span class="lineno"></span><span class="comment" id="6018376">//&nbsp;SetGCPercent&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6018422">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;GOGC&nbsp;environment&nbsp;variable</span><br>
<span class="lineno">95</span><span class="comment" id="6018491">//&nbsp;at&nbsp;startup,&nbsp;or&nbsp;100&nbsp;if&nbsp;the&nbsp;variable&nbsp;is&nbsp;not&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="6018541">//&nbsp;A&nbsp;negative&nbsp;percentage&nbsp;disables&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="6018595">func</span>&nbsp;<span class="ident" id="6018600">SetGCPercent</span><span class="op" id="6018612">(</span><span class="ident" id="6018613">percent</span>&nbsp;<span class="builtintype" id="6018621">int</span><span class="op" id="6018624">)</span>&nbsp;<span class="builtintype" id="6018626">int</span>&nbsp;<span class="op" id="6018630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018633">old</span>&nbsp;<span class="op" id="6018637">:=</span>&nbsp;<span class="ident" id="6018640"><a href="/runtime/debug/stubs.go.html#6024341">setGCPercent</a></span><span class="op" id="6018652">(</span><span class="builtintype" id="6018653">int32</span><span class="op" id="6018658">(</span><span class="ident" id="6018659"><a href="/runtime/debug/garbage.go.html#6018613">percent</a></span><span class="op" id="6018666">)</span><span class="op" id="6018667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018670"><a href="/runtime/debug/garbage.go.html#6015074">runtime</a></span><span class="op" id="6018677">.</span><span class="ident" id="6018678">GC</span><span class="op" id="6018680">(</span><span class="op" id="6018681">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018684">return</span>&nbsp;<span class="builtintype" id="6018691">int</span><span class="op" id="6018694">(</span><span class="ident" id="6018695"><a href="/runtime/debug/garbage.go.html#6018633">old</a></span><span class="op" id="6018698">)</span><br>
<span class="lineno"></span><span class="op" id="6018700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018703">//&nbsp;FreeOSMemory&nbsp;forces&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;followed&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6018762">//&nbsp;attempt&nbsp;to&nbsp;return&nbsp;as&nbsp;much&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno">105</span><span class="comment" id="6018822">//&nbsp;as&nbsp;possible.&nbsp;(Even&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;called,&nbsp;the&nbsp;runtime&nbsp;gradually</span><br>
<span class="lineno"></span><span class="comment" id="6018889">//&nbsp;returns&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system&nbsp;in&nbsp;a&nbsp;background&nbsp;task.)</span><br>
<span class="lineno"></span><span class="keyword" id="6018954">func</span>&nbsp;<span class="ident" id="6018959">FreeOSMemory</span><span class="op" id="6018971">(</span><span class="op" id="6018972">)</span>&nbsp;<span class="op" id="6018974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018977"><a href="/runtime/debug/stubs.go.html#6024528">freeOSMemory</a></span><span class="op" id="6018989">(</span><span class="op" id="6018990">)</span><br>
<span class="lineno"></span><span class="op" id="6018992">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="6018995">//&nbsp;SetMaxStack&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;memory&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6019049">//&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="6019093">//&nbsp;If&nbsp;any&nbsp;goroutine&nbsp;exceeds&nbsp;this&nbsp;limit&nbsp;while&nbsp;growing&nbsp;its&nbsp;stack,</span><br>
<span class="lineno"></span><span class="comment" id="6019157">//&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno">115</span><span class="comment" id="6019181">//&nbsp;SetMaxStack&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6019226">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit&nbsp;systems,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit&nbsp;systems.</span><br>
<span class="lineno"></span><span class="comment" id="6019302">//</span><br>
<span class="lineno"></span><span class="comment" id="6019305">//&nbsp;SetMaxStack&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6019369">//&nbsp;goroutines&nbsp;that&nbsp;enter&nbsp;an&nbsp;infinite&nbsp;recursion.&nbsp;It&nbsp;only&nbsp;limits&nbsp;future</span><br>
<span class="lineno">120</span><span class="comment" id="6019439">//&nbsp;stack&nbsp;growth.</span><br>
<span class="lineno"></span><span class="keyword" id="6019456">func</span>&nbsp;<span class="ident" id="6019461">SetMaxStack</span><span class="op" id="6019472">(</span><span class="ident" id="6019473">bytes</span>&nbsp;<span class="builtintype" id="6019479">int</span><span class="op" id="6019482">)</span>&nbsp;<span class="builtintype" id="6019484">int</span>&nbsp;<span class="op" id="6019488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019491">return</span>&nbsp;<span class="ident" id="6019498"><a href="/runtime/debug/stubs.go.html#6024315">setMaxStack</a></span><span class="op" id="6019509">(</span><span class="ident" id="6019510"><a href="/runtime/debug/garbage.go.html#6019473">bytes</a></span><span class="op" id="6019515">)</span><br>
<span class="lineno"></span><span class="op" id="6019517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6019520">//&nbsp;SetMaxThreads&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span><span class="comment" id="6019581">//&nbsp;threads&nbsp;that&nbsp;the&nbsp;Go&nbsp;program&nbsp;can&nbsp;use.&nbsp;If&nbsp;it&nbsp;attempts&nbsp;to&nbsp;use&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="6019653">//&nbsp;this&nbsp;many,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="comment" id="6019688">//&nbsp;SetMaxThreads&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6019735">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;10,000&nbsp;threads.</span><br>
<span class="lineno">130</span><span class="comment" id="6019777">//</span><br>
<span class="lineno"></span><span class="comment" id="6019780">//&nbsp;The&nbsp;limit&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;operating&nbsp;system&nbsp;threads,&nbsp;not&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6019857">//&nbsp;of&nbsp;goroutines.&nbsp;A&nbsp;Go&nbsp;program&nbsp;creates&nbsp;a&nbsp;new&nbsp;thread&nbsp;only&nbsp;when&nbsp;a&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="6019931">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;run&nbsp;but&nbsp;all&nbsp;the&nbsp;existing&nbsp;threads&nbsp;are&nbsp;blocked&nbsp;in&nbsp;system&nbsp;calls,&nbsp;cgo&nbsp;calls,</span><br>
<span class="lineno"></span><span class="comment" id="6020019">//&nbsp;or&nbsp;are&nbsp;locked&nbsp;to&nbsp;other&nbsp;goroutines&nbsp;due&nbsp;to&nbsp;use&nbsp;of&nbsp;runtime.LockOSThread.</span><br>
<span class="lineno">135</span><span class="comment" id="6020092">//</span><br>
<span class="lineno"></span><span class="comment" id="6020095">//&nbsp;SetMaxThreads&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6020161">//&nbsp;programs&nbsp;that&nbsp;create&nbsp;an&nbsp;unbounded&nbsp;number&nbsp;of&nbsp;threads.&nbsp;The&nbsp;idea&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6020229">//&nbsp;to&nbsp;take&nbsp;down&nbsp;the&nbsp;program&nbsp;before&nbsp;it&nbsp;takes&nbsp;down&nbsp;the&nbsp;operating&nbsp;system.</span><br>
<span class="lineno"></span><span class="keyword" id="6020300">func</span>&nbsp;<span class="ident" id="6020305">SetMaxThreads</span><span class="op" id="6020318">(</span><span class="ident" id="6020319">threads</span>&nbsp;<span class="builtintype" id="6020327">int</span><span class="op" id="6020330">)</span>&nbsp;<span class="builtintype" id="6020332">int</span>&nbsp;<span class="op" id="6020336">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020339">return</span>&nbsp;<span class="ident" id="6020346"><a href="/runtime/debug/stubs.go.html#6024404">setMaxThreads</a></span><span class="op" id="6020359">(</span><span class="ident" id="6020360"><a href="/runtime/debug/garbage.go.html#6020319">threads</a></span><span class="op" id="6020367">)</span><br>
<span class="lineno"></span><span class="op" id="6020369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6020372">//&nbsp;SetPanicOnFault&nbsp;controls&nbsp;the&nbsp;runtime&#39;s&nbsp;behavior&nbsp;when&nbsp;a&nbsp;program&nbsp;faults</span><br>
<span class="lineno"></span><span class="comment" id="6020445">//&nbsp;at&nbsp;an&nbsp;unexpected&nbsp;(non-nil)&nbsp;address.&nbsp;Such&nbsp;faults&nbsp;are&nbsp;typically&nbsp;caused&nbsp;by</span><br>
<span class="lineno">145</span><span class="comment" id="6020520">//&nbsp;bugs&nbsp;such&nbsp;as&nbsp;runtime&nbsp;memory&nbsp;corruption,&nbsp;so&nbsp;the&nbsp;default&nbsp;response&nbsp;is&nbsp;to&nbsp;crash</span><br>
<span class="lineno"></span><span class="comment" id="6020599">//&nbsp;the&nbsp;program.&nbsp;Programs&nbsp;working&nbsp;with&nbsp;memory-mapped&nbsp;files&nbsp;or&nbsp;unsafe</span><br>
<span class="lineno"></span><span class="comment" id="6020667">//&nbsp;manipulation&nbsp;of&nbsp;memory&nbsp;may&nbsp;cause&nbsp;faults&nbsp;at&nbsp;non-nil&nbsp;addresses&nbsp;in&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="6020739">//&nbsp;dramatic&nbsp;situations;&nbsp;SetPanicOnFault&nbsp;allows&nbsp;such&nbsp;programs&nbsp;to&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="6020811">//&nbsp;that&nbsp;the&nbsp;runtime&nbsp;trigger&nbsp;only&nbsp;a&nbsp;panic,&nbsp;not&nbsp;a&nbsp;crash.</span><br>
<span class="lineno">150</span><span class="comment" id="6020866">//&nbsp;SetPanicOnFault&nbsp;applies&nbsp;only&nbsp;to&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="comment" id="6020924">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="keyword" id="6020960">func</span>&nbsp;<span class="ident" id="6020965">SetPanicOnFault</span><span class="op" id="6020980">(</span><span class="ident" id="6020981">enabled</span>&nbsp;<span class="builtintype" id="6020989">bool</span><span class="op" id="6020993">)</span>&nbsp;<span class="builtintype" id="6020995">bool</span>&nbsp;<span class="op" id="6021000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021003">return</span>&nbsp;<span class="ident" id="6021010"><a href="/runtime/debug/stubs.go.html#6024372">setPanicOnFault</a></span><span class="op" id="6021025">(</span><span class="ident" id="6021026"><a href="/runtime/debug/garbage.go.html#6020981">enabled</a></span><span class="op" id="6021033">)</span><br>
<span class="lineno"></span><span class="op" id="6021035">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6021038">//&nbsp;WriteHeapDump&nbsp;writes&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;heap&nbsp;and&nbsp;the&nbsp;objects&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6021107">//&nbsp;it&nbsp;to&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="6021143">//&nbsp;The&nbsp;heap&nbsp;dump&nbsp;format&nbsp;is&nbsp;defined&nbsp;at&nbsp;http://golang.org/s/go13heapdump.</span><br>
<span class="lineno"></span><span class="keyword" id="6021215">func</span>&nbsp;<span class="ident" id="6021220">WriteHeapDump</span><span class="op" id="6021233">(</span><span class="ident" id="6021234">fd</span>&nbsp;<span class="builtintype" id="6021237">uintptr</span><span class="op" id="6021244">)</span>
</div>
</body>
</html>
