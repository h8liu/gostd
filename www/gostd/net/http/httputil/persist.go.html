<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httputil</h2>
<ul>
<li><a href="/gostd/net/http/httputil/dump.go.html">dump.go</a></li>
<li><a href="/gostd/net/http/httputil/dump_test.go.html">dump_test.go</a></li>
<li><a href="/gostd/net/http/httputil/httputil.go.html">httputil.go</a></li>
<li><a href="/gostd/net/http/httputil/persist.go.html" class="current">persist.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy.go.html">reverseproxy.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy_test.go.html">reverseproxy_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6387827">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6387882">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6387936">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6387987">package</span>&nbsp;<span class="ident" id="6387995">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388005">import</span>&nbsp;<span class="op" id="6388012">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388015">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388024">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388034">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388040">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388047">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388059">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6388076">&#34;sync&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6388083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388086">var</span>&nbsp;<span class="op" id="6388090">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388093">ErrPersistEOF</span>&nbsp;<span class="op" id="6388107">=</span>&nbsp;<span class="op" id="6388109">&amp;</span><span class="ident" id="6388110"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6388114">.</span><span class="ident" id="6388115"><a href="/gostd/net/http/request.go.html#4134565">ProtocolError</a></span><span class="op" id="6388128">{</span><span class="ident" id="6388129"><a href="/gostd/net/http/request.go.html#4134589">ErrorString</a></span><span class="op" id="6388140">:</span>&nbsp;<span class="string" id="6388142">&#34;persistent&nbsp;connection&nbsp;closed&#34;</span><span class="op" id="6388172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388175">ErrClosed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388189">=</span>&nbsp;<span class="op" id="6388191">&amp;</span><span class="ident" id="6388192"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6388196">.</span><span class="ident" id="6388197"><a href="/gostd/net/http/request.go.html#4134565">ProtocolError</a></span><span class="op" id="6388210">{</span><span class="ident" id="6388211"><a href="/gostd/net/http/request.go.html#4134589">ErrorString</a></span><span class="op" id="6388222">:</span>&nbsp;<span class="string" id="6388224">&#34;connection&nbsp;closed&nbsp;by&nbsp;user&#34;</span><span class="op" id="6388251">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388254">ErrPipeline</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6388268">=</span>&nbsp;<span class="op" id="6388270">&amp;</span><span class="ident" id="6388271"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6388275">.</span><span class="ident" id="6388276"><a href="/gostd/net/http/request.go.html#4134565">ProtocolError</a></span><span class="op" id="6388289">{</span><span class="ident" id="6388290"><a href="/gostd/net/http/request.go.html#4134589">ErrorString</a></span><span class="op" id="6388301">:</span>&nbsp;<span class="string" id="6388303">&#34;pipeline&nbsp;error&#34;</span><span class="op" id="6388319">}</span><br>
<span class="lineno"></span><span class="op" id="6388321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388324">//&nbsp;This&nbsp;is&nbsp;an&nbsp;API&nbsp;usage&nbsp;error&nbsp;-&nbsp;the&nbsp;local&nbsp;side&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="6388382">//&nbsp;ErrPersistEOF&nbsp;(above)&nbsp;reports&nbsp;that&nbsp;the&nbsp;remote&nbsp;side&nbsp;is&nbsp;closed.</span><br>
<span class="lineno">25</span><span class="keyword" id="6388447">var</span>&nbsp;<span class="ident" id="6388451">errClosed</span>&nbsp;<span class="op" id="6388461">=</span>&nbsp;<span class="ident" id="6388463"><a href="/gostd/net/http/httputil/persist.go.html#6388024">errors</a></span><span class="op" id="6388469">.</span><span class="ident" id="6388470"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6388473">(</span><span class="string" id="6388474">&#34;i/o&nbsp;operation&nbsp;on&nbsp;closed&nbsp;connection&#34;</span><span class="op" id="6388510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388513">//&nbsp;A&nbsp;ServerConn&nbsp;reads&nbsp;requests&nbsp;and&nbsp;sends&nbsp;responses&nbsp;over&nbsp;an&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6388583">//&nbsp;connection,&nbsp;until&nbsp;the&nbsp;HTTP&nbsp;keepalive&nbsp;logic&nbsp;commands&nbsp;an&nbsp;end.&nbsp;ServerConn</span><br>
<span class="lineno"></span><span class="comment" id="6388657">//&nbsp;also&nbsp;allows&nbsp;hijacking&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;by&nbsp;calling&nbsp;Hijack</span><br>
<span class="lineno">30</span><span class="comment" id="6388726">//&nbsp;to&nbsp;regain&nbsp;control&nbsp;over&nbsp;the&nbsp;connection.&nbsp;ServerConn&nbsp;supports&nbsp;pipe-lining,</span><br>
<span class="lineno"></span><span class="comment" id="6388801">//&nbsp;i.e.&nbsp;requests&nbsp;can&nbsp;be&nbsp;read&nbsp;out&nbsp;of&nbsp;sync&nbsp;(but&nbsp;in&nbsp;the&nbsp;same&nbsp;order)&nbsp;while&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6388876">//&nbsp;respective&nbsp;responses&nbsp;are&nbsp;sent.</span><br>
<span class="lineno"></span><span class="comment" id="6388910">//</span><br>
<span class="lineno"></span><span class="comment" id="6388913">//&nbsp;ServerConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use&nbsp;Server</span><br>
<span class="lineno">35</span><span class="comment" id="6388988">//&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6389016">type</span>&nbsp;<span class="ident" id="6389021">ServerConn</span>&nbsp;<span class="keyword" id="6389032">struct</span>&nbsp;<span class="op" id="6389039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389042">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389058"><a href="/gostd/net/http/httputil/persist.go.html#6388076">sync</a></span><span class="op" id="6389062">.</span><span class="ident" id="6389063"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="6389069">//&nbsp;read-write&nbsp;protects&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389114">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389130"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6389133">.</span><span class="ident" id="6389134"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389140">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389156">*</span><span class="ident" id="6389157"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6389162">.</span><span class="ident" id="6389163"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389171">re</span><span class="op" id="6389173">,</span>&nbsp;<span class="ident" id="6389175">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6389187">error</span>&nbsp;<span class="comment" id="6389193">//&nbsp;read/write&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389215">lastbody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389231"><a href="/gostd/net/http/httputil/persist.go.html#6388034">io</a></span><span class="op" id="6389233">.</span><span class="ident" id="6389234"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389246">nread</span><span class="op" id="6389251">,</span>&nbsp;<span class="ident" id="6389253">nwritten</span>&nbsp;<span class="builtintype" id="6389262">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389267">pipereq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389283">map</span><span class="op" id="6389286">[</span><span class="op" id="6389287">*</span><span class="ident" id="6389288"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6389292">.</span><span class="ident" id="6389293"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6389300">]</span><span class="builtintype" id="6389301">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389308">pipe</span>&nbsp;<span class="ident" id="6389313"><a href="/gostd/net/http/httputil/persist.go.html#6388059">textproto</a></span><span class="op" id="6389322">.</span><span class="ident" id="6389323"><a href="/gostd/net/textproto/pipeline.go.html#4330440">Pipeline</a></span><br>
<span class="lineno"></span><span class="op" id="6389332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389335">//&nbsp;NewServerConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;ServerConn&nbsp;reading&nbsp;and&nbsp;writing&nbsp;c.&nbsp;If&nbsp;r&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6389412">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;the&nbsp;buffer&nbsp;to&nbsp;use&nbsp;when&nbsp;reading&nbsp;c.</span><br>
<span class="lineno">50</span><span class="comment" id="6389460">//</span><br>
<span class="lineno"></span><span class="comment" id="6389463">//&nbsp;ServerConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use&nbsp;Server</span><br>
<span class="lineno"></span><span class="comment" id="6389538">//&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6389566">func</span>&nbsp;<span class="ident" id="6389571">NewServerConn</span><span class="op" id="6389584">(</span><span class="ident" id="6389585">c</span>&nbsp;<span class="ident" id="6389587"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6389590">.</span><span class="ident" id="6389591"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6389595">,</span>&nbsp;<span class="ident" id="6389597">r</span>&nbsp;<span class="op" id="6389599">*</span><span class="ident" id="6389600"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6389605">.</span><span class="ident" id="6389606"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="6389612">)</span>&nbsp;<span class="op" id="6389614">*</span><span class="ident" id="6389615"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span>&nbsp;<span class="op" id="6389626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389629">if</span>&nbsp;<span class="ident" id="6389632"><a href="/gostd/net/http/httputil/persist.go.html#6389597">r</a></span>&nbsp;<span class="op" id="6389634">==</span>&nbsp;<span class="builtintype" id="6389637">nil</span>&nbsp;<span class="op" id="6389641">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389645"><a href="/gostd/net/http/httputil/persist.go.html#6389597">r</a></span>&nbsp;<span class="op" id="6389647">=</span>&nbsp;<span class="ident" id="6389649"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6389654">.</span><span class="ident" id="6389655"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="6389664">(</span><span class="ident" id="6389665"><a href="/gostd/net/http/httputil/persist.go.html#6389585">c</a></span><span class="op" id="6389666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389672">return</span>&nbsp;<span class="op" id="6389679">&amp;</span><span class="ident" id="6389680"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6389690">{</span><span class="ident" id="6389691"><a href="/gostd/net/http/httputil/persist.go.html#6389114">c</a></span><span class="op" id="6389692">:</span>&nbsp;<span class="ident" id="6389694"><a href="/gostd/net/http/httputil/persist.go.html#6389585">c</a></span><span class="op" id="6389695">,</span>&nbsp;<span class="ident" id="6389697"><a href="/gostd/net/http/httputil/persist.go.html#6389140">r</a></span><span class="op" id="6389698">:</span>&nbsp;<span class="ident" id="6389700"><a href="/gostd/net/http/httputil/persist.go.html#6389597">r</a></span><span class="op" id="6389701">,</span>&nbsp;<span class="ident" id="6389703"><a href="/gostd/net/http/httputil/persist.go.html#6389267">pipereq</a></span><span class="op" id="6389710">:</span>&nbsp;<span class="builtinfunc" id="6389712">make</span><span class="op" id="6389716">(</span><span class="keyword" id="6389717">map</span><span class="op" id="6389720">[</span><span class="op" id="6389721">*</span><span class="ident" id="6389722"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6389726">.</span><span class="ident" id="6389727"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6389734">]</span><span class="builtintype" id="6389735">uint</span><span class="op" id="6389739">)</span><span class="op" id="6389740">}</span><br>
<span class="lineno"></span><span class="op" id="6389742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6389745">//&nbsp;Hijack&nbsp;detaches&nbsp;the&nbsp;ServerConn&nbsp;and&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;as&nbsp;well</span><br>
<span class="lineno"></span><span class="comment" id="6389825">//&nbsp;as&nbsp;the&nbsp;read-side&nbsp;bufio&nbsp;which&nbsp;may&nbsp;have&nbsp;some&nbsp;left&nbsp;over&nbsp;data.&nbsp;Hijack&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6389901">//&nbsp;called&nbsp;before&nbsp;Read&nbsp;has&nbsp;signaled&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;keep-alive&nbsp;logic.&nbsp;The&nbsp;user</span><br>
<span class="lineno"></span><span class="comment" id="6389978">//&nbsp;should&nbsp;not&nbsp;call&nbsp;Hijack&nbsp;while&nbsp;Read&nbsp;or&nbsp;Write&nbsp;is&nbsp;in&nbsp;progress.</span><br>
<span class="lineno"></span><span class="keyword" id="6390040">func</span>&nbsp;<span class="op" id="6390045">(</span><span class="ident" id="6390046">sc</span>&nbsp;<span class="op" id="6390049">*</span><span class="ident" id="6390050"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6390060">)</span>&nbsp;<span class="ident" id="6390062">Hijack</span><span class="op" id="6390068">(</span><span class="op" id="6390069">)</span>&nbsp;<span class="op" id="6390071">(</span><span class="ident" id="6390072">c</span>&nbsp;<span class="ident" id="6390074"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6390077">.</span><span class="ident" id="6390078"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6390082">,</span>&nbsp;<span class="ident" id="6390084">r</span>&nbsp;<span class="op" id="6390086">*</span><span class="ident" id="6390087"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6390092">.</span><span class="ident" id="6390093"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="6390099">)</span>&nbsp;<span class="op" id="6390101">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390104"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390106">.</span><span class="ident" id="6390107"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6390109">.</span><span class="ident" id="6390110"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6390114">(</span><span class="op" id="6390115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390118">defer</span>&nbsp;<span class="ident" id="6390124"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390126">.</span><span class="ident" id="6390127"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6390129">.</span><span class="ident" id="6390130"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6390136">(</span><span class="op" id="6390137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390140"><a href="/gostd/net/http/httputil/persist.go.html#6390072">c</a></span>&nbsp;<span class="op" id="6390142">=</span>&nbsp;<span class="ident" id="6390144"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390146">.</span><span class="ident" id="6390147"><a href="/gostd/net/http/httputil/persist.go.html#6389114">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390150"><a href="/gostd/net/http/httputil/persist.go.html#6390084">r</a></span>&nbsp;<span class="op" id="6390152">=</span>&nbsp;<span class="ident" id="6390154"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390156">.</span><span class="ident" id="6390157"><a href="/gostd/net/http/httputil/persist.go.html#6389140">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390160"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390162">.</span><span class="ident" id="6390163"><a href="/gostd/net/http/httputil/persist.go.html#6389114">c</a></span>&nbsp;<span class="op" id="6390165">=</span>&nbsp;<span class="builtintype" id="6390167">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390172"><a href="/gostd/net/http/httputil/persist.go.html#6390046">sc</a></span><span class="op" id="6390174">.</span><span class="ident" id="6390175"><a href="/gostd/net/http/httputil/persist.go.html#6389140">r</a></span>&nbsp;<span class="op" id="6390177">=</span>&nbsp;<span class="builtintype" id="6390179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390184">return</span><br>
<span class="lineno"></span><span class="op" id="6390191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390194">//&nbsp;Close&nbsp;calls&nbsp;Hijack&nbsp;and&nbsp;then&nbsp;also&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;connection</span><br>
<span class="lineno">75</span><span class="keyword" id="6390263">func</span>&nbsp;<span class="op" id="6390268">(</span><span class="ident" id="6390269">sc</span>&nbsp;<span class="op" id="6390272">*</span><span class="ident" id="6390273"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6390283">)</span>&nbsp;<span class="ident" id="6390285">Close</span><span class="op" id="6390290">(</span><span class="op" id="6390291">)</span>&nbsp;<span class="builtintype" id="6390293">error</span>&nbsp;<span class="op" id="6390299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390302">c</span><span class="op" id="6390303">,</span>&nbsp;<span class="ident" id="6390305">_</span>&nbsp;<span class="op" id="6390307">:=</span>&nbsp;<span class="ident" id="6390310"><a href="/gostd/net/http/httputil/persist.go.html#6390269">sc</a></span><span class="op" id="6390312">.</span><span class="ident" id="6390313"><a href="/gostd/net/http/httputil/persist.go.html#6390062">Hijack</a></span><span class="op" id="6390319">(</span><span class="op" id="6390320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390323">if</span>&nbsp;<span class="ident" id="6390326"><a href="/gostd/net/http/httputil/persist.go.html#6390302">c</a></span>&nbsp;<span class="op" id="6390328">!=</span>&nbsp;<span class="builtintype" id="6390331">nil</span>&nbsp;<span class="op" id="6390335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390339">return</span>&nbsp;<span class="ident" id="6390346"><a href="/gostd/net/http/httputil/persist.go.html#6390302">c</a></span><span class="op" id="6390347">.</span><span class="ident" id="6390348"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6390353">(</span><span class="op" id="6390354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390357">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390360">return</span>&nbsp;<span class="builtintype" id="6390367">nil</span><br>
<span class="lineno"></span><span class="op" id="6390371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390374">//&nbsp;Read&nbsp;returns&nbsp;the&nbsp;next&nbsp;request&nbsp;on&nbsp;the&nbsp;wire.&nbsp;An&nbsp;ErrPersistEOF&nbsp;is&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6390452">//&nbsp;it&nbsp;is&nbsp;gracefully&nbsp;determined&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;requests&nbsp;(e.g.&nbsp;after&nbsp;the</span><br>
<span class="lineno">85</span><span class="comment" id="6390531">//&nbsp;first&nbsp;request&nbsp;on&nbsp;an&nbsp;HTTP/1.0&nbsp;connection,&nbsp;or&nbsp;after&nbsp;a&nbsp;Connection:close&nbsp;on&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6390608">//&nbsp;HTTP/1.1&nbsp;connection).</span><br>
<span class="lineno"></span><span class="keyword" id="6390633">func</span>&nbsp;<span class="op" id="6390638">(</span><span class="ident" id="6390639">sc</span>&nbsp;<span class="op" id="6390642">*</span><span class="ident" id="6390643"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6390653">)</span>&nbsp;<span class="ident" id="6390655">Read</span><span class="op" id="6390659">(</span><span class="op" id="6390660">)</span>&nbsp;<span class="op" id="6390662">(</span><span class="ident" id="6390663">req</span>&nbsp;<span class="op" id="6390667">*</span><span class="ident" id="6390668"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6390672">.</span><span class="ident" id="6390673"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6390680">,</span>&nbsp;<span class="ident" id="6390682">err</span>&nbsp;<span class="builtintype" id="6390686">error</span><span class="op" id="6390691">)</span>&nbsp;<span class="op" id="6390693">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390697">//&nbsp;Ensure&nbsp;ordered&nbsp;execution&nbsp;of&nbsp;Reads&nbsp;and&nbsp;Writes</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390746">id</span>&nbsp;<span class="op" id="6390749">:=</span>&nbsp;<span class="ident" id="6390752"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390754">.</span><span class="ident" id="6390755"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6390759">.</span><span class="ident" id="6390760"><a href="/gostd/net/textproto/pipeline.go.html#4330613">Next</a></span><span class="op" id="6390764">(</span><span class="op" id="6390765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390768"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390770">.</span><span class="ident" id="6390771"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6390775">.</span><span class="ident" id="6390776"><a href="/gostd/net/textproto/pipeline.go.html#4330825">StartRequest</a></span><span class="op" id="6390788">(</span><span class="ident" id="6390789"><a href="/gostd/net/http/httputil/persist.go.html#6390746">id</a></span><span class="op" id="6390791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390794">defer</span>&nbsp;<span class="keyword" id="6390800">func</span><span class="op" id="6390804">(</span><span class="op" id="6390805">)</span>&nbsp;<span class="op" id="6390807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390811"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390813">.</span><span class="ident" id="6390814"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6390818">.</span><span class="ident" id="6390819"><a href="/gostd/net/textproto/pipeline.go.html#4331006">EndRequest</a></span><span class="op" id="6390829">(</span><span class="ident" id="6390830"><a href="/gostd/net/http/httputil/persist.go.html#6390746">id</a></span><span class="op" id="6390832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390836">if</span>&nbsp;<span class="ident" id="6390839"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span>&nbsp;<span class="op" id="6390843">==</span>&nbsp;<span class="builtintype" id="6390846">nil</span>&nbsp;<span class="op" id="6390850">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390855"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390857">.</span><span class="ident" id="6390858"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6390862">.</span><span class="ident" id="6390863"><a href="/gostd/net/textproto/pipeline.go.html#4331187">StartResponse</a></span><span class="op" id="6390876">(</span><span class="ident" id="6390877"><a href="/gostd/net/http/httputil/persist.go.html#6390746">id</a></span><span class="op" id="6390879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390884"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390886">.</span><span class="ident" id="6390887"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6390891">.</span><span class="ident" id="6390892"><a href="/gostd/net/textproto/pipeline.go.html#4331372">EndResponse</a></span><span class="op" id="6390903">(</span><span class="ident" id="6390904"><a href="/gostd/net/http/httputil/persist.go.html#6390746">id</a></span><span class="op" id="6390906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390910">}</span>&nbsp;<span class="keyword" id="6390912">else</span>&nbsp;<span class="op" id="6390917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390922">//&nbsp;Remember&nbsp;the&nbsp;pipeline&nbsp;id&nbsp;of&nbsp;this&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390969"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390971">.</span><span class="ident" id="6390972"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6390974">.</span><span class="ident" id="6390975"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6390979">(</span><span class="op" id="6390980">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390985"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6390987">.</span><span class="ident" id="6390988"><a href="/gostd/net/http/httputil/persist.go.html#6389267">pipereq</a></span><span class="op" id="6390995">[</span><span class="ident" id="6390996"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6390999">]</span>&nbsp;<span class="op" id="6391001">=</span>&nbsp;<span class="ident" id="6391003"><a href="/gostd/net/http/httputil/persist.go.html#6390746">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391009"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391011">.</span><span class="ident" id="6391012"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391014">.</span><span class="ident" id="6391015"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391021">(</span><span class="op" id="6391022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391029">}</span><span class="op" id="6391030">(</span><span class="op" id="6391031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391035"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391037">.</span><span class="ident" id="6391038"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391040">.</span><span class="ident" id="6391041"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6391045">(</span><span class="op" id="6391046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391049">if</span>&nbsp;<span class="ident" id="6391052"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391054">.</span><span class="ident" id="6391055"><a href="/gostd/net/http/httputil/persist.go.html#6389175">we</a></span>&nbsp;<span class="op" id="6391058">!=</span>&nbsp;<span class="builtintype" id="6391061">nil</span>&nbsp;<span class="op" id="6391065">{</span>&nbsp;<span class="comment" id="6391067">//&nbsp;no&nbsp;point&nbsp;receiving&nbsp;if&nbsp;write-side&nbsp;broken&nbsp;or&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391122">defer</span>&nbsp;<span class="ident" id="6391128"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391130">.</span><span class="ident" id="6391131"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391133">.</span><span class="ident" id="6391134"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391140">(</span><span class="op" id="6391141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391145">return</span>&nbsp;<span class="builtintype" id="6391152">nil</span><span class="op" id="6391155">,</span>&nbsp;<span class="ident" id="6391157"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391159">.</span><span class="ident" id="6391160"><a href="/gostd/net/http/httputil/persist.go.html#6389175">we</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391164">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391167">if</span>&nbsp;<span class="ident" id="6391170"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391172">.</span><span class="ident" id="6391173"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6391176">!=</span>&nbsp;<span class="builtintype" id="6391179">nil</span>&nbsp;<span class="op" id="6391183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391187">defer</span>&nbsp;<span class="ident" id="6391193"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391195">.</span><span class="ident" id="6391196"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391198">.</span><span class="ident" id="6391199"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391205">(</span><span class="op" id="6391206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391210">return</span>&nbsp;<span class="builtintype" id="6391217">nil</span><span class="op" id="6391220">,</span>&nbsp;<span class="ident" id="6391222"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391224">.</span><span class="ident" id="6391225"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391232">if</span>&nbsp;<span class="ident" id="6391235"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391237">.</span><span class="ident" id="6391238"><a href="/gostd/net/http/httputil/persist.go.html#6389140">r</a></span>&nbsp;<span class="op" id="6391240">==</span>&nbsp;<span class="builtintype" id="6391243">nil</span>&nbsp;<span class="op" id="6391247">{</span>&nbsp;<span class="comment" id="6391249">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391296">defer</span>&nbsp;<span class="ident" id="6391302"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391304">.</span><span class="ident" id="6391305"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391307">.</span><span class="ident" id="6391308"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391314">(</span><span class="op" id="6391315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391319">return</span>&nbsp;<span class="builtintype" id="6391326">nil</span><span class="op" id="6391329">,</span>&nbsp;<span class="ident" id="6391331"><a href="/gostd/net/http/httputil/persist.go.html#6388451">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391345">r</span>&nbsp;<span class="op" id="6391347">:=</span>&nbsp;<span class="ident" id="6391350"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391352">.</span><span class="ident" id="6391353"><a href="/gostd/net/http/httputil/persist.go.html#6389140">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391356">lastbody</span>&nbsp;<span class="op" id="6391365">:=</span>&nbsp;<span class="ident" id="6391368"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391370">.</span><span class="ident" id="6391371"><a href="/gostd/net/http/httputil/persist.go.html#6389215">lastbody</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391381"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391383">.</span><span class="ident" id="6391384"><a href="/gostd/net/http/httputil/persist.go.html#6389215">lastbody</a></span>&nbsp;<span class="op" id="6391393">=</span>&nbsp;<span class="builtintype" id="6391395">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391400"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391402">.</span><span class="ident" id="6391403"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391405">.</span><span class="ident" id="6391406"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391412">(</span><span class="op" id="6391413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391417">//&nbsp;Make&nbsp;sure&nbsp;body&nbsp;is&nbsp;fully&nbsp;consumed,&nbsp;even&nbsp;if&nbsp;user&nbsp;does&nbsp;not&nbsp;call&nbsp;body.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391493">if</span>&nbsp;<span class="ident" id="6391496"><a href="/gostd/net/http/httputil/persist.go.html#6391356">lastbody</a></span>&nbsp;<span class="op" id="6391505">!=</span>&nbsp;<span class="builtintype" id="6391508">nil</span>&nbsp;<span class="op" id="6391512">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391516">//&nbsp;body.Close&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;idempotent&nbsp;and&nbsp;multiple&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391582">//&nbsp;it&nbsp;should&nbsp;return&nbsp;the&nbsp;error&nbsp;that&nbsp;its&nbsp;first&nbsp;invocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391640">//&nbsp;returned.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391655"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span>&nbsp;<span class="op" id="6391659">=</span>&nbsp;<span class="ident" id="6391661"><a href="/gostd/net/http/httputil/persist.go.html#6391356">lastbody</a></span><span class="op" id="6391669">.</span><span class="ident" id="6391670"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6391675">(</span><span class="op" id="6391676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391680">if</span>&nbsp;<span class="ident" id="6391683"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span>&nbsp;<span class="op" id="6391687">!=</span>&nbsp;<span class="builtintype" id="6391690">nil</span>&nbsp;<span class="op" id="6391694">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391699"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391701">.</span><span class="ident" id="6391702"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391704">.</span><span class="ident" id="6391705"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6391709">(</span><span class="op" id="6391710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391715">defer</span>&nbsp;<span class="ident" id="6391721"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391723">.</span><span class="ident" id="6391724"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391726">.</span><span class="ident" id="6391727"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391733">(</span><span class="op" id="6391734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391739"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391741">.</span><span class="ident" id="6391742"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6391745">=</span>&nbsp;<span class="ident" id="6391747"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391754">return</span>&nbsp;<span class="builtintype" id="6391761">nil</span><span class="op" id="6391764">,</span>&nbsp;<span class="ident" id="6391766"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391772">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391779"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6391782">,</span>&nbsp;<span class="ident" id="6391784"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span>&nbsp;<span class="op" id="6391788">=</span>&nbsp;<span class="ident" id="6391790"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6391794">.</span><span class="ident" id="6391795"><a href="/gostd/net/http/request.go.html#4152095">ReadRequest</a></span><span class="op" id="6391806">(</span><span class="ident" id="6391807"><a href="/gostd/net/http/httputil/persist.go.html#6391345">r</a></span><span class="op" id="6391808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391811"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391813">.</span><span class="ident" id="6391814"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391816">.</span><span class="ident" id="6391817"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6391821">(</span><span class="op" id="6391822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391825">defer</span>&nbsp;<span class="ident" id="6391831"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6391833">.</span><span class="ident" id="6391834"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6391836">.</span><span class="ident" id="6391837"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6391843">(</span><span class="op" id="6391844">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391847">if</span>&nbsp;<span class="ident" id="6391850"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span>&nbsp;<span class="op" id="6391854">!=</span>&nbsp;<span class="builtintype" id="6391857">nil</span>&nbsp;<span class="op" id="6391861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391865">if</span>&nbsp;<span class="ident" id="6391868"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span>&nbsp;<span class="op" id="6391872">==</span>&nbsp;<span class="ident" id="6391875"><a href="/gostd/net/http/httputil/persist.go.html#6388034">io</a></span><span class="op" id="6391877">.</span><span class="ident" id="6391878"><a href="/gostd/io/io.go.html#1420096">ErrUnexpectedEOF</a></span>&nbsp;<span class="op" id="6391895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391900">//&nbsp;A&nbsp;close&nbsp;from&nbsp;the&nbsp;opposing&nbsp;client&nbsp;is&nbsp;treated&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391955">//&nbsp;graceful&nbsp;close,&nbsp;even&nbsp;if&nbsp;there&nbsp;was&nbsp;some&nbsp;unparse-able</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392013">//&nbsp;data&nbsp;before&nbsp;the&nbsp;close.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392042"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392044">.</span><span class="ident" id="6392045"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6392048">=</span>&nbsp;<span class="ident" id="6392050"><a href="/gostd/net/http/httputil/persist.go.html#6388093">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392067">return</span>&nbsp;<span class="builtintype" id="6392074">nil</span><span class="op" id="6392077">,</span>&nbsp;<span class="ident" id="6392079"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392081">.</span><span class="ident" id="6392082"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392087">}</span>&nbsp;<span class="keyword" id="6392089">else</span>&nbsp;<span class="op" id="6392094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392099"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392101">.</span><span class="ident" id="6392102"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6392105">=</span>&nbsp;<span class="ident" id="6392107"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392114">return</span>&nbsp;<span class="ident" id="6392121"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6392124">,</span>&nbsp;<span class="ident" id="6392126"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392138"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392140">.</span><span class="ident" id="6392141"><a href="/gostd/net/http/httputil/persist.go.html#6389215">lastbody</a></span>&nbsp;<span class="op" id="6392150">=</span>&nbsp;<span class="ident" id="6392152"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6392155">.</span><span class="ident" id="6392156"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392162"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392164">.</span><span class="ident" id="6392165"><a href="/gostd/net/http/httputil/persist.go.html#6389246">nread</a></span><span class="op" id="6392170">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392174">if</span>&nbsp;<span class="ident" id="6392177"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6392180">.</span><span class="ident" id="6392181"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6392187">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392191"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392193">.</span><span class="ident" id="6392194"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6392197">=</span>&nbsp;<span class="ident" id="6392199"><a href="/gostd/net/http/httputil/persist.go.html#6388093">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392215">return</span>&nbsp;<span class="ident" id="6392222"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6392225">,</span>&nbsp;<span class="ident" id="6392227"><a href="/gostd/net/http/httputil/persist.go.html#6390639">sc</a></span><span class="op" id="6392229">.</span><span class="ident" id="6392230"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392237">return</span>&nbsp;<span class="ident" id="6392244"><a href="/gostd/net/http/httputil/persist.go.html#6390663">req</a></span><span class="op" id="6392247">,</span>&nbsp;<span class="ident" id="6392249"><a href="/gostd/net/http/httputil/persist.go.html#6390682">err</a></span><br>
<span class="lineno"></span><span class="op" id="6392253">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="6392256">//&nbsp;Pending&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;unanswered&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="6392309">//&nbsp;that&nbsp;have&nbsp;been&nbsp;received&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6392355">func</span>&nbsp;<span class="op" id="6392360">(</span><span class="ident" id="6392361">sc</span>&nbsp;<span class="op" id="6392364">*</span><span class="ident" id="6392365"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6392375">)</span>&nbsp;<span class="ident" id="6392377">Pending</span><span class="op" id="6392384">(</span><span class="op" id="6392385">)</span>&nbsp;<span class="builtintype" id="6392387">int</span>&nbsp;<span class="op" id="6392391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392394"><a href="/gostd/net/http/httputil/persist.go.html#6392361">sc</a></span><span class="op" id="6392396">.</span><span class="ident" id="6392397"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6392399">.</span><span class="ident" id="6392400"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6392404">(</span><span class="op" id="6392405">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392408">defer</span>&nbsp;<span class="ident" id="6392414"><a href="/gostd/net/http/httputil/persist.go.html#6392361">sc</a></span><span class="op" id="6392416">.</span><span class="ident" id="6392417"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6392419">.</span><span class="ident" id="6392420"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6392426">(</span><span class="op" id="6392427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392430">return</span>&nbsp;<span class="ident" id="6392437"><a href="/gostd/net/http/httputil/persist.go.html#6392361">sc</a></span><span class="op" id="6392439">.</span><span class="ident" id="6392440"><a href="/gostd/net/http/httputil/persist.go.html#6389246">nread</a></span>&nbsp;<span class="op" id="6392446">-</span>&nbsp;<span class="ident" id="6392448"><a href="/gostd/net/http/httputil/persist.go.html#6392361">sc</a></span><span class="op" id="6392450">.</span><span class="ident" id="6392451"><a href="/gostd/net/http/httputil/persist.go.html#6389253">nwritten</a></span><br>
<span class="lineno"></span><span class="op" id="6392460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392463">//&nbsp;Write&nbsp;writes&nbsp;resp&nbsp;in&nbsp;response&nbsp;to&nbsp;req.&nbsp;To&nbsp;close&nbsp;the&nbsp;connection&nbsp;gracefully,&nbsp;set&nbsp;the</span><br>
<span class="lineno">170</span><span class="comment" id="6392548">//&nbsp;Response.Close&nbsp;field&nbsp;to&nbsp;true.&nbsp;Write&nbsp;should&nbsp;be&nbsp;considered&nbsp;operational&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="6392626">//&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,&nbsp;regardless&nbsp;of&nbsp;any&nbsp;errors&nbsp;returned&nbsp;on&nbsp;the&nbsp;Read&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="6392702">func</span>&nbsp;<span class="op" id="6392707">(</span><span class="ident" id="6392708">sc</span>&nbsp;<span class="op" id="6392711">*</span><span class="ident" id="6392712"><a href="/gostd/net/http/httputil/persist.go.html#6389021">ServerConn</a></span><span class="op" id="6392722">)</span>&nbsp;<span class="ident" id="6392724">Write</span><span class="op" id="6392729">(</span><span class="ident" id="6392730">req</span>&nbsp;<span class="op" id="6392734">*</span><span class="ident" id="6392735"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6392739">.</span><span class="ident" id="6392740"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6392747">,</span>&nbsp;<span class="ident" id="6392749">resp</span>&nbsp;<span class="op" id="6392754">*</span><span class="ident" id="6392755"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6392759">.</span><span class="ident" id="6392760"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="6392768">)</span>&nbsp;<span class="builtintype" id="6392770">error</span>&nbsp;<span class="op" id="6392776">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392780">//&nbsp;Retrieve&nbsp;the&nbsp;pipeline&nbsp;ID&nbsp;of&nbsp;this&nbsp;request/response&nbsp;pair</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392839"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6392841">.</span><span class="ident" id="6392842"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6392844">.</span><span class="ident" id="6392845"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6392849">(</span><span class="op" id="6392850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392853">id</span><span class="op" id="6392855">,</span>&nbsp;<span class="ident" id="6392857">ok</span>&nbsp;<span class="op" id="6392860">:=</span>&nbsp;<span class="ident" id="6392863"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6392865">.</span><span class="ident" id="6392866"><a href="/gostd/net/http/httputil/persist.go.html#6389267">pipereq</a></span><span class="op" id="6392873">[</span><span class="ident" id="6392874"><a href="/gostd/net/http/httputil/persist.go.html#6392730">req</a></span><span class="op" id="6392877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6392880">delete</span><span class="op" id="6392886">(</span><span class="ident" id="6392887"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6392889">.</span><span class="ident" id="6392890"><a href="/gostd/net/http/httputil/persist.go.html#6389267">pipereq</a></span><span class="op" id="6392897">,</span>&nbsp;<span class="ident" id="6392899"><a href="/gostd/net/http/httputil/persist.go.html#6392730">req</a></span><span class="op" id="6392902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392905">if</span>&nbsp;<span class="op" id="6392908">!</span><span class="ident" id="6392909"><a href="/gostd/net/http/httputil/persist.go.html#6392857">ok</a></span>&nbsp;<span class="op" id="6392912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392916"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6392918">.</span><span class="ident" id="6392919"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6392921">.</span><span class="ident" id="6392922"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6392928">(</span><span class="op" id="6392929">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392933">return</span>&nbsp;<span class="ident" id="6392940"><a href="/gostd/net/http/httputil/persist.go.html#6388254">ErrPipeline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392956"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6392958">.</span><span class="ident" id="6392959"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6392961">.</span><span class="ident" id="6392962"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6392968">(</span><span class="op" id="6392969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392973">//&nbsp;Ensure&nbsp;pipeline&nbsp;order</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392999"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393001">.</span><span class="ident" id="6393002"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6393006">.</span><span class="ident" id="6393007"><a href="/gostd/net/textproto/pipeline.go.html#4331187">StartResponse</a></span><span class="op" id="6393020">(</span><span class="ident" id="6393021"><a href="/gostd/net/http/httputil/persist.go.html#6392853">id</a></span><span class="op" id="6393023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393026">defer</span>&nbsp;<span class="ident" id="6393032"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393034">.</span><span class="ident" id="6393035"><a href="/gostd/net/http/httputil/persist.go.html#6389308">pipe</a></span><span class="op" id="6393039">.</span><span class="ident" id="6393040"><a href="/gostd/net/textproto/pipeline.go.html#4331372">EndResponse</a></span><span class="op" id="6393051">(</span><span class="ident" id="6393052"><a href="/gostd/net/http/httputil/persist.go.html#6392853">id</a></span><span class="op" id="6393054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393058"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393060">.</span><span class="ident" id="6393061"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393063">.</span><span class="ident" id="6393064"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6393068">(</span><span class="op" id="6393069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393072">if</span>&nbsp;<span class="ident" id="6393075"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393077">.</span><span class="ident" id="6393078"><a href="/gostd/net/http/httputil/persist.go.html#6389175">we</a></span>&nbsp;<span class="op" id="6393081">!=</span>&nbsp;<span class="builtintype" id="6393084">nil</span>&nbsp;<span class="op" id="6393088">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393092">defer</span>&nbsp;<span class="ident" id="6393098"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393100">.</span><span class="ident" id="6393101"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393103">.</span><span class="ident" id="6393104"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6393110">(</span><span class="op" id="6393111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393115">return</span>&nbsp;<span class="ident" id="6393122"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393124">.</span><span class="ident" id="6393125"><a href="/gostd/net/http/httputil/persist.go.html#6389175">we</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393132">if</span>&nbsp;<span class="ident" id="6393135"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393137">.</span><span class="ident" id="6393138"><a href="/gostd/net/http/httputil/persist.go.html#6389114">c</a></span>&nbsp;<span class="op" id="6393140">==</span>&nbsp;<span class="builtintype" id="6393143">nil</span>&nbsp;<span class="op" id="6393147">{</span>&nbsp;<span class="comment" id="6393149">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393196">defer</span>&nbsp;<span class="ident" id="6393202"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393204">.</span><span class="ident" id="6393205"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393207">.</span><span class="ident" id="6393208"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6393214">(</span><span class="op" id="6393215">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393219">return</span>&nbsp;<span class="ident" id="6393226"><a href="/gostd/net/http/httputil/persist.go.html#6388175">ErrClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393240">c</span>&nbsp;<span class="op" id="6393242">:=</span>&nbsp;<span class="ident" id="6393245"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393247">.</span><span class="ident" id="6393248"><a href="/gostd/net/http/httputil/persist.go.html#6389114">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393251">if</span>&nbsp;<span class="ident" id="6393254"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393256">.</span><span class="ident" id="6393257"><a href="/gostd/net/http/httputil/persist.go.html#6389246">nread</a></span>&nbsp;<span class="op" id="6393263">&lt;=</span>&nbsp;<span class="ident" id="6393266"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393268">.</span><span class="ident" id="6393269"><a href="/gostd/net/http/httputil/persist.go.html#6389253">nwritten</a></span>&nbsp;<span class="op" id="6393278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393282">defer</span>&nbsp;<span class="ident" id="6393288"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393290">.</span><span class="ident" id="6393291"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393293">.</span><span class="ident" id="6393294"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6393300">(</span><span class="op" id="6393301">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393305">return</span>&nbsp;<span class="ident" id="6393312"><a href="/gostd/net/http/httputil/persist.go.html#6388024">errors</a></span><span class="op" id="6393318">.</span><span class="ident" id="6393319"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6393322">(</span><span class="string" id="6393323">&#34;persist&nbsp;server&nbsp;pipe&nbsp;count&#34;</span><span class="op" id="6393350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393356">if</span>&nbsp;<span class="ident" id="6393359"><a href="/gostd/net/http/httputil/persist.go.html#6392749">resp</a></span><span class="op" id="6393363">.</span><span class="ident" id="6393364"><a href="/gostd/net/http/response.go.html#4163140">Close</a></span>&nbsp;<span class="op" id="6393370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393374">//&nbsp;After&nbsp;signaling&nbsp;a&nbsp;keep-alive&nbsp;close,&nbsp;any&nbsp;pipelined&nbsp;unread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393436">//&nbsp;requests&nbsp;will&nbsp;be&nbsp;lost.&nbsp;It&nbsp;is&nbsp;up&nbsp;to&nbsp;the&nbsp;user&nbsp;to&nbsp;drain&nbsp;them</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393499">//&nbsp;before&nbsp;signaling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393522"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393524">.</span><span class="ident" id="6393525"><a href="/gostd/net/http/httputil/persist.go.html#6389171">re</a></span>&nbsp;<span class="op" id="6393528">=</span>&nbsp;<span class="ident" id="6393530"><a href="/gostd/net/http/httputil/persist.go.html#6388093">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393548"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393550">.</span><span class="ident" id="6393551"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393553">.</span><span class="ident" id="6393554"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6393560">(</span><span class="op" id="6393561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393565">err</span>&nbsp;<span class="op" id="6393569">:=</span>&nbsp;<span class="ident" id="6393572"><a href="/gostd/net/http/httputil/persist.go.html#6392749">resp</a></span><span class="op" id="6393576">.</span><span class="ident" id="6393577"><a href="/gostd/net/http/response.go.html#4166814">Write</a></span><span class="op" id="6393582">(</span><span class="ident" id="6393583"><a href="/gostd/net/http/httputil/persist.go.html#6393240">c</a></span><span class="op" id="6393584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393587"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393589">.</span><span class="ident" id="6393590"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393592">.</span><span class="ident" id="6393593"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6393597">(</span><span class="op" id="6393598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393601">defer</span>&nbsp;<span class="ident" id="6393607"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393609">.</span><span class="ident" id="6393610"><a href="/gostd/net/http/httputil/persist.go.html#6389042">lk</a></span><span class="op" id="6393612">.</span><span class="ident" id="6393613"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6393619">(</span><span class="op" id="6393620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393623">if</span>&nbsp;<span class="ident" id="6393626"><a href="/gostd/net/http/httputil/persist.go.html#6393565">err</a></span>&nbsp;<span class="op" id="6393630">!=</span>&nbsp;<span class="builtintype" id="6393633">nil</span>&nbsp;<span class="op" id="6393637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393641"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393643">.</span><span class="ident" id="6393644"><a href="/gostd/net/http/httputil/persist.go.html#6389175">we</a></span>&nbsp;<span class="op" id="6393647">=</span>&nbsp;<span class="ident" id="6393649"><a href="/gostd/net/http/httputil/persist.go.html#6393565">err</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393655">return</span>&nbsp;<span class="ident" id="6393662"><a href="/gostd/net/http/httputil/persist.go.html#6393565">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393670"><a href="/gostd/net/http/httputil/persist.go.html#6392708">sc</a></span><span class="op" id="6393672">.</span><span class="ident" id="6393673"><a href="/gostd/net/http/httputil/persist.go.html#6389253">nwritten</a></span><span class="op" id="6393681">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393686">return</span>&nbsp;<span class="builtintype" id="6393693">nil</span><br>
<span class="lineno">220</span><span class="op" id="6393697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393700">//&nbsp;A&nbsp;ClientConn&nbsp;sends&nbsp;request&nbsp;and&nbsp;receives&nbsp;headers&nbsp;over&nbsp;an&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6393770">//&nbsp;connection,&nbsp;while&nbsp;respecting&nbsp;the&nbsp;HTTP&nbsp;keepalive&nbsp;logic.&nbsp;ClientConn</span><br>
<span class="lineno"></span><span class="comment" id="6393839">//&nbsp;supports&nbsp;hijacking&nbsp;the&nbsp;connection&nbsp;calling&nbsp;Hijack&nbsp;to</span><br>
<span class="lineno">225</span><span class="comment" id="6393894">//&nbsp;regain&nbsp;control&nbsp;of&nbsp;the&nbsp;underlying&nbsp;net.Conn&nbsp;and&nbsp;deal&nbsp;with&nbsp;it&nbsp;as&nbsp;desired.</span><br>
<span class="lineno"></span><span class="comment" id="6393968">//</span><br>
<span class="lineno"></span><span class="comment" id="6393971">//&nbsp;ClientConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;instead&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6394039">//&nbsp;Client&nbsp;or&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6394087">type</span>&nbsp;<span class="ident" id="6394092">ClientConn</span>&nbsp;<span class="keyword" id="6394103">struct</span>&nbsp;<span class="op" id="6394110">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394113">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394129"><a href="/gostd/net/http/httputil/persist.go.html#6388076">sync</a></span><span class="op" id="6394133">.</span><span class="ident" id="6394134"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="6394140">//&nbsp;read-write&nbsp;protects&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394185">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394201"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6394204">.</span><span class="ident" id="6394205"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394211">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394227">*</span><span class="ident" id="6394228"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6394233">.</span><span class="ident" id="6394234"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394242">re</span><span class="op" id="6394244">,</span>&nbsp;<span class="ident" id="6394246">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6394258">error</span>&nbsp;<span class="comment" id="6394264">//&nbsp;read/write&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394286">lastbody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394302"><a href="/gostd/net/http/httputil/persist.go.html#6388034">io</a></span><span class="op" id="6394304">.</span><span class="ident" id="6394305"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394317">nread</span><span class="op" id="6394322">,</span>&nbsp;<span class="ident" id="6394324">nwritten</span>&nbsp;<span class="builtintype" id="6394333">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394338">pipereq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394354">map</span><span class="op" id="6394357">[</span><span class="op" id="6394358">*</span><span class="ident" id="6394359"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6394363">.</span><span class="ident" id="6394364"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6394371">]</span><span class="builtintype" id="6394372">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394379">pipe</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394388"><a href="/gostd/net/http/httputil/persist.go.html#6388059">textproto</a></span><span class="op" id="6394397">.</span><span class="ident" id="6394398"><a href="/gostd/net/textproto/pipeline.go.html#4330440">Pipeline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394408">writeReq</span>&nbsp;<span class="keyword" id="6394417">func</span><span class="op" id="6394421">(</span><span class="op" id="6394422">*</span><span class="ident" id="6394423"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6394427">.</span><span class="ident" id="6394428"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6394435">,</span>&nbsp;<span class="ident" id="6394437"><a href="/gostd/net/http/httputil/persist.go.html#6388034">io</a></span><span class="op" id="6394439">.</span><span class="ident" id="6394440"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6394446">)</span>&nbsp;<span class="builtintype" id="6394448">error</span><br>
<span class="lineno">240</span><span class="op" id="6394454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394457">//&nbsp;NewClientConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;ClientConn&nbsp;reading&nbsp;and&nbsp;writing&nbsp;c.&nbsp;&nbsp;If&nbsp;r&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6394535">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;the&nbsp;buffer&nbsp;to&nbsp;use&nbsp;when&nbsp;reading&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6394583">//</span><br>
<span class="lineno">245</span><span class="comment" id="6394586">//&nbsp;ClientConn&nbsp;is&nbsp;low-level&nbsp;and&nbsp;old.&nbsp;Applications&nbsp;should&nbsp;use&nbsp;Client&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6394656">//&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6394694">func</span>&nbsp;<span class="ident" id="6394699">NewClientConn</span><span class="op" id="6394712">(</span><span class="ident" id="6394713">c</span>&nbsp;<span class="ident" id="6394715"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6394718">.</span><span class="ident" id="6394719"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6394723">,</span>&nbsp;<span class="ident" id="6394725">r</span>&nbsp;<span class="op" id="6394727">*</span><span class="ident" id="6394728"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6394733">.</span><span class="ident" id="6394734"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="6394740">)</span>&nbsp;<span class="op" id="6394742">*</span><span class="ident" id="6394743"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span>&nbsp;<span class="op" id="6394754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394757">if</span>&nbsp;<span class="ident" id="6394760"><a href="/gostd/net/http/httputil/persist.go.html#6394725">r</a></span>&nbsp;<span class="op" id="6394762">==</span>&nbsp;<span class="builtintype" id="6394765">nil</span>&nbsp;<span class="op" id="6394769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394773"><a href="/gostd/net/http/httputil/persist.go.html#6394725">r</a></span>&nbsp;<span class="op" id="6394775">=</span>&nbsp;<span class="ident" id="6394777"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6394782">.</span><span class="ident" id="6394783"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="6394792">(</span><span class="ident" id="6394793"><a href="/gostd/net/http/httputil/persist.go.html#6394713">c</a></span><span class="op" id="6394794">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394800">return</span>&nbsp;<span class="op" id="6394807">&amp;</span><span class="ident" id="6394808"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6394818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394822"><a href="/gostd/net/http/httputil/persist.go.html#6394185">c</a></span><span class="op" id="6394823">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394832"><a href="/gostd/net/http/httputil/persist.go.html#6394713">c</a></span><span class="op" id="6394833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394837"><a href="/gostd/net/http/httputil/persist.go.html#6394211">r</a></span><span class="op" id="6394838">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394847"><a href="/gostd/net/http/httputil/persist.go.html#6394725">r</a></span><span class="op" id="6394848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394852"><a href="/gostd/net/http/httputil/persist.go.html#6394338">pipereq</a></span><span class="op" id="6394859">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6394862">make</span><span class="op" id="6394866">(</span><span class="keyword" id="6394867">map</span><span class="op" id="6394870">[</span><span class="op" id="6394871">*</span><span class="ident" id="6394872"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6394876">.</span><span class="ident" id="6394877"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6394884">]</span><span class="builtintype" id="6394885">uint</span><span class="op" id="6394889">)</span><span class="op" id="6394890">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394894"><a href="/gostd/net/http/httputil/persist.go.html#6394408">writeReq</a></span><span class="op" id="6394902">:</span>&nbsp;<span class="op" id="6394904">(</span><span class="op" id="6394905">*</span><span class="ident" id="6394906"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6394910">.</span><span class="ident" id="6394911"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6394918">)</span><span class="op" id="6394919">.</span><span class="ident" id="6394920"><a href="/gostd/net/http/request.go.html#4146008">Write</a></span><span class="op" id="6394925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394928">}</span><br>
<span class="lineno"></span><span class="op" id="6394930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394933">//&nbsp;NewProxyClientConn&nbsp;works&nbsp;like&nbsp;NewClientConn&nbsp;but&nbsp;writes&nbsp;Requests</span><br>
<span class="lineno">260</span><span class="comment" id="6395000">//&nbsp;using&nbsp;Request&#39;s&nbsp;WriteProxy&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="6395038">//</span><br>
<span class="lineno"></span><span class="comment" id="6395041">//&nbsp;New&nbsp;code&nbsp;should&nbsp;not&nbsp;use&nbsp;NewProxyClientConn.&nbsp;See&nbsp;Client&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6395102">//&nbsp;Transport&nbsp;in&nbsp;the&nbsp;net/http&nbsp;package&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="6395148">func</span>&nbsp;<span class="ident" id="6395153">NewProxyClientConn</span><span class="op" id="6395171">(</span><span class="ident" id="6395172">c</span>&nbsp;<span class="ident" id="6395174"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6395177">.</span><span class="ident" id="6395178"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6395182">,</span>&nbsp;<span class="ident" id="6395184">r</span>&nbsp;<span class="op" id="6395186">*</span><span class="ident" id="6395187"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6395192">.</span><span class="ident" id="6395193"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="6395199">)</span>&nbsp;<span class="op" id="6395201">*</span><span class="ident" id="6395202"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span>&nbsp;<span class="op" id="6395213">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395216">cc</span>&nbsp;<span class="op" id="6395219">:=</span>&nbsp;<span class="ident" id="6395222"><a href="/gostd/net/http/httputil/persist.go.html#6394699">NewClientConn</a></span><span class="op" id="6395235">(</span><span class="ident" id="6395236"><a href="/gostd/net/http/httputil/persist.go.html#6395172">c</a></span><span class="op" id="6395237">,</span>&nbsp;<span class="ident" id="6395239"><a href="/gostd/net/http/httputil/persist.go.html#6395184">r</a></span><span class="op" id="6395240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395243"><a href="/gostd/net/http/httputil/persist.go.html#6395216">cc</a></span><span class="op" id="6395245">.</span><span class="ident" id="6395246"><a href="/gostd/net/http/httputil/persist.go.html#6394408">writeReq</a></span>&nbsp;<span class="op" id="6395255">=</span>&nbsp;<span class="op" id="6395257">(</span><span class="op" id="6395258">*</span><span class="ident" id="6395259"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6395263">.</span><span class="ident" id="6395264"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6395271">)</span><span class="op" id="6395272">.</span><span class="ident" id="6395273"><a href="/gostd/net/http/request.go.html#4146443">WriteProxy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395285">return</span>&nbsp;<span class="ident" id="6395292"><a href="/gostd/net/http/httputil/persist.go.html#6395216">cc</a></span><br>
<span class="lineno"></span><span class="op" id="6395295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6395298">//&nbsp;Hijack&nbsp;detaches&nbsp;the&nbsp;ClientConn&nbsp;and&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;connection&nbsp;as&nbsp;well</span><br>
<span class="lineno"></span><span class="comment" id="6395378">//&nbsp;as&nbsp;the&nbsp;read-side&nbsp;bufio&nbsp;which&nbsp;may&nbsp;have&nbsp;some&nbsp;left&nbsp;over&nbsp;data.&nbsp;Hijack&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6395454">//&nbsp;called&nbsp;before&nbsp;the&nbsp;user&nbsp;or&nbsp;Read&nbsp;have&nbsp;signaled&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;keep-alive</span><br>
<span class="lineno"></span><span class="comment" id="6395528">//&nbsp;logic.&nbsp;The&nbsp;user&nbsp;should&nbsp;not&nbsp;call&nbsp;Hijack&nbsp;while&nbsp;Read&nbsp;or&nbsp;Write&nbsp;is&nbsp;in&nbsp;progress.</span><br>
<span class="lineno"></span><span class="keyword" id="6395606">func</span>&nbsp;<span class="op" id="6395611">(</span><span class="ident" id="6395612">cc</span>&nbsp;<span class="op" id="6395615">*</span><span class="ident" id="6395616"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6395626">)</span>&nbsp;<span class="ident" id="6395628">Hijack</span><span class="op" id="6395634">(</span><span class="op" id="6395635">)</span>&nbsp;<span class="op" id="6395637">(</span><span class="ident" id="6395638">c</span>&nbsp;<span class="ident" id="6395640"><a href="/gostd/net/http/httputil/persist.go.html#6388040">net</a></span><span class="op" id="6395643">.</span><span class="ident" id="6395644"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6395648">,</span>&nbsp;<span class="ident" id="6395650">r</span>&nbsp;<span class="op" id="6395652">*</span><span class="ident" id="6395653"><a href="/gostd/net/http/httputil/persist.go.html#6388015">bufio</a></span><span class="op" id="6395658">.</span><span class="ident" id="6395659"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="6395665">)</span>&nbsp;<span class="op" id="6395667">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395670"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395672">.</span><span class="ident" id="6395673"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6395675">.</span><span class="ident" id="6395676"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6395680">(</span><span class="op" id="6395681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395684">defer</span>&nbsp;<span class="ident" id="6395690"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395692">.</span><span class="ident" id="6395693"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6395695">.</span><span class="ident" id="6395696"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6395702">(</span><span class="op" id="6395703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395706"><a href="/gostd/net/http/httputil/persist.go.html#6395638">c</a></span>&nbsp;<span class="op" id="6395708">=</span>&nbsp;<span class="ident" id="6395710"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395712">.</span><span class="ident" id="6395713"><a href="/gostd/net/http/httputil/persist.go.html#6394185">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395716"><a href="/gostd/net/http/httputil/persist.go.html#6395650">r</a></span>&nbsp;<span class="op" id="6395718">=</span>&nbsp;<span class="ident" id="6395720"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395722">.</span><span class="ident" id="6395723"><a href="/gostd/net/http/httputil/persist.go.html#6394211">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395726"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395728">.</span><span class="ident" id="6395729"><a href="/gostd/net/http/httputil/persist.go.html#6394185">c</a></span>&nbsp;<span class="op" id="6395731">=</span>&nbsp;<span class="builtintype" id="6395733">nil</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395738"><a href="/gostd/net/http/httputil/persist.go.html#6395612">cc</a></span><span class="op" id="6395740">.</span><span class="ident" id="6395741"><a href="/gostd/net/http/httputil/persist.go.html#6394211">r</a></span>&nbsp;<span class="op" id="6395743">=</span>&nbsp;<span class="builtintype" id="6395745">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395750">return</span><br>
<span class="lineno"></span><span class="op" id="6395757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6395760">//&nbsp;Close&nbsp;calls&nbsp;Hijack&nbsp;and&nbsp;then&nbsp;also&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;connection</span><br>
<span class="lineno">285</span><span class="keyword" id="6395829">func</span>&nbsp;<span class="op" id="6395834">(</span><span class="ident" id="6395835">cc</span>&nbsp;<span class="op" id="6395838">*</span><span class="ident" id="6395839"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6395849">)</span>&nbsp;<span class="ident" id="6395851">Close</span><span class="op" id="6395856">(</span><span class="op" id="6395857">)</span>&nbsp;<span class="builtintype" id="6395859">error</span>&nbsp;<span class="op" id="6395865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395868">c</span><span class="op" id="6395869">,</span>&nbsp;<span class="ident" id="6395871">_</span>&nbsp;<span class="op" id="6395873">:=</span>&nbsp;<span class="ident" id="6395876"><a href="/gostd/net/http/httputil/persist.go.html#6395835">cc</a></span><span class="op" id="6395878">.</span><span class="ident" id="6395879"><a href="/gostd/net/http/httputil/persist.go.html#6395628">Hijack</a></span><span class="op" id="6395885">(</span><span class="op" id="6395886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395889">if</span>&nbsp;<span class="ident" id="6395892"><a href="/gostd/net/http/httputil/persist.go.html#6395868">c</a></span>&nbsp;<span class="op" id="6395894">!=</span>&nbsp;<span class="builtintype" id="6395897">nil</span>&nbsp;<span class="op" id="6395901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395905">return</span>&nbsp;<span class="ident" id="6395912"><a href="/gostd/net/http/httputil/persist.go.html#6395868">c</a></span><span class="op" id="6395913">.</span><span class="ident" id="6395914"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="6395919">(</span><span class="op" id="6395920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395923">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395926">return</span>&nbsp;<span class="builtintype" id="6395933">nil</span><br>
<span class="lineno"></span><span class="op" id="6395937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6395940">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;request.&nbsp;An&nbsp;ErrPersistEOF&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6396020">//&nbsp;has&nbsp;been&nbsp;closed&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;keepalive&nbsp;sense.&nbsp;If&nbsp;req.Close&nbsp;equals&nbsp;true,&nbsp;the</span><br>
<span class="lineno">295</span><span class="comment" id="6396097">//&nbsp;keepalive&nbsp;connection&nbsp;is&nbsp;logically&nbsp;closed&nbsp;after&nbsp;this&nbsp;request&nbsp;and&nbsp;the&nbsp;opposing</span><br>
<span class="lineno"></span><span class="comment" id="6396177">//&nbsp;server&nbsp;is&nbsp;informed.&nbsp;An&nbsp;ErrUnexpectedEOF&nbsp;indicates&nbsp;the&nbsp;remote&nbsp;closed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6396252">//&nbsp;underlying&nbsp;TCP&nbsp;connection,&nbsp;which&nbsp;is&nbsp;usually&nbsp;considered&nbsp;as&nbsp;graceful&nbsp;close.</span><br>
<span class="lineno"></span><span class="keyword" id="6396329">func</span>&nbsp;<span class="op" id="6396334">(</span><span class="ident" id="6396335">cc</span>&nbsp;<span class="op" id="6396338">*</span><span class="ident" id="6396339"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6396349">)</span>&nbsp;<span class="ident" id="6396351">Write</span><span class="op" id="6396356">(</span><span class="ident" id="6396357">req</span>&nbsp;<span class="op" id="6396361">*</span><span class="ident" id="6396362"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6396366">.</span><span class="ident" id="6396367"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6396374">)</span>&nbsp;<span class="op" id="6396376">(</span><span class="ident" id="6396377">err</span>&nbsp;<span class="builtintype" id="6396381">error</span><span class="op" id="6396386">)</span>&nbsp;<span class="op" id="6396388">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6396392">//&nbsp;Ensure&nbsp;ordered&nbsp;execution&nbsp;of&nbsp;Writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396431">id</span>&nbsp;<span class="op" id="6396434">:=</span>&nbsp;<span class="ident" id="6396437"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396439">.</span><span class="ident" id="6396440"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6396444">.</span><span class="ident" id="6396445"><a href="/gostd/net/textproto/pipeline.go.html#4330613">Next</a></span><span class="op" id="6396449">(</span><span class="op" id="6396450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396453"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396455">.</span><span class="ident" id="6396456"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6396460">.</span><span class="ident" id="6396461"><a href="/gostd/net/textproto/pipeline.go.html#4330825">StartRequest</a></span><span class="op" id="6396473">(</span><span class="ident" id="6396474"><a href="/gostd/net/http/httputil/persist.go.html#6396431">id</a></span><span class="op" id="6396476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396479">defer</span>&nbsp;<span class="keyword" id="6396485">func</span><span class="op" id="6396489">(</span><span class="op" id="6396490">)</span>&nbsp;<span class="op" id="6396492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396496"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396498">.</span><span class="ident" id="6396499"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6396503">.</span><span class="ident" id="6396504"><a href="/gostd/net/textproto/pipeline.go.html#4331006">EndRequest</a></span><span class="op" id="6396514">(</span><span class="ident" id="6396515"><a href="/gostd/net/http/httputil/persist.go.html#6396431">id</a></span><span class="op" id="6396517">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396521">if</span>&nbsp;<span class="ident" id="6396524"><a href="/gostd/net/http/httputil/persist.go.html#6396377">err</a></span>&nbsp;<span class="op" id="6396528">!=</span>&nbsp;<span class="builtintype" id="6396531">nil</span>&nbsp;<span class="op" id="6396535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396540"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396542">.</span><span class="ident" id="6396543"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6396547">.</span><span class="ident" id="6396548"><a href="/gostd/net/textproto/pipeline.go.html#4331187">StartResponse</a></span><span class="op" id="6396561">(</span><span class="ident" id="6396562"><a href="/gostd/net/http/httputil/persist.go.html#6396431">id</a></span><span class="op" id="6396564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396569"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396571">.</span><span class="ident" id="6396572"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6396576">.</span><span class="ident" id="6396577"><a href="/gostd/net/textproto/pipeline.go.html#4331372">EndResponse</a></span><span class="op" id="6396588">(</span><span class="ident" id="6396589"><a href="/gostd/net/http/httputil/persist.go.html#6396431">id</a></span><span class="op" id="6396591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396595">}</span>&nbsp;<span class="keyword" id="6396597">else</span>&nbsp;<span class="op" id="6396602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6396607">//&nbsp;Remember&nbsp;the&nbsp;pipeline&nbsp;id&nbsp;of&nbsp;this&nbsp;request</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396654"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396656">.</span><span class="ident" id="6396657"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396659">.</span><span class="ident" id="6396660"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6396664">(</span><span class="op" id="6396665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396670"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396672">.</span><span class="ident" id="6396673"><a href="/gostd/net/http/httputil/persist.go.html#6394338">pipereq</a></span><span class="op" id="6396680">[</span><span class="ident" id="6396681"><a href="/gostd/net/http/httputil/persist.go.html#6396357">req</a></span><span class="op" id="6396684">]</span>&nbsp;<span class="op" id="6396686">=</span>&nbsp;<span class="ident" id="6396688"><a href="/gostd/net/http/httputil/persist.go.html#6396431">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396694"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396696">.</span><span class="ident" id="6396697"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396699">.</span><span class="ident" id="6396700"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6396706">(</span><span class="op" id="6396707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396714">}</span><span class="op" id="6396715">(</span><span class="op" id="6396716">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396720"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396722">.</span><span class="ident" id="6396723"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396725">.</span><span class="ident" id="6396726"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6396730">(</span><span class="op" id="6396731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396734">if</span>&nbsp;<span class="ident" id="6396737"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396739">.</span><span class="ident" id="6396740"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span>&nbsp;<span class="op" id="6396743">!=</span>&nbsp;<span class="builtintype" id="6396746">nil</span>&nbsp;<span class="op" id="6396750">{</span>&nbsp;<span class="comment" id="6396752">//&nbsp;no&nbsp;point&nbsp;sending&nbsp;if&nbsp;read-side&nbsp;closed&nbsp;or&nbsp;broken</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396804">defer</span>&nbsp;<span class="ident" id="6396810"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396812">.</span><span class="ident" id="6396813"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396815">.</span><span class="ident" id="6396816"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6396822">(</span><span class="op" id="6396823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396827">return</span>&nbsp;<span class="ident" id="6396834"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396836">.</span><span class="ident" id="6396837"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396844">if</span>&nbsp;<span class="ident" id="6396847"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396849">.</span><span class="ident" id="6396850"><a href="/gostd/net/http/httputil/persist.go.html#6394246">we</a></span>&nbsp;<span class="op" id="6396853">!=</span>&nbsp;<span class="builtintype" id="6396856">nil</span>&nbsp;<span class="op" id="6396860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396864">defer</span>&nbsp;<span class="ident" id="6396870"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396872">.</span><span class="ident" id="6396873"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396875">.</span><span class="ident" id="6396876"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6396882">(</span><span class="op" id="6396883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396887">return</span>&nbsp;<span class="ident" id="6396894"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396896">.</span><span class="ident" id="6396897"><a href="/gostd/net/http/httputil/persist.go.html#6394246">we</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396901">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396904">if</span>&nbsp;<span class="ident" id="6396907"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396909">.</span><span class="ident" id="6396910"><a href="/gostd/net/http/httputil/persist.go.html#6394185">c</a></span>&nbsp;<span class="op" id="6396912">==</span>&nbsp;<span class="builtintype" id="6396915">nil</span>&nbsp;<span class="op" id="6396919">{</span>&nbsp;<span class="comment" id="6396921">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396968">defer</span>&nbsp;<span class="ident" id="6396974"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6396976">.</span><span class="ident" id="6396977"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6396979">.</span><span class="ident" id="6396980"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6396986">(</span><span class="op" id="6396987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396991">return</span>&nbsp;<span class="ident" id="6396998"><a href="/gostd/net/http/httputil/persist.go.html#6388451">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6397009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397012">c</span>&nbsp;<span class="op" id="6397014">:=</span>&nbsp;<span class="ident" id="6397017"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397019">.</span><span class="ident" id="6397020"><a href="/gostd/net/http/httputil/persist.go.html#6394185">c</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397023">if</span>&nbsp;<span class="ident" id="6397026"><a href="/gostd/net/http/httputil/persist.go.html#6396357">req</a></span><span class="op" id="6397029">.</span><span class="ident" id="6397030"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6397036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6397040">//&nbsp;We&nbsp;write&nbsp;the&nbsp;EOF&nbsp;to&nbsp;the&nbsp;write-side&nbsp;error,&nbsp;because&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6397101">//&nbsp;still&nbsp;might&nbsp;be&nbsp;some&nbsp;pipelined&nbsp;reads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397142"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397144">.</span><span class="ident" id="6397145"><a href="/gostd/net/http/httputil/persist.go.html#6394246">we</a></span>&nbsp;<span class="op" id="6397148">=</span>&nbsp;<span class="ident" id="6397150"><a href="/gostd/net/http/httputil/persist.go.html#6388093">ErrPersistEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6397165">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397168"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397170">.</span><span class="ident" id="6397171"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397173">.</span><span class="ident" id="6397174"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6397180">(</span><span class="op" id="6397181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397185"><a href="/gostd/net/http/httputil/persist.go.html#6396377">err</a></span>&nbsp;<span class="op" id="6397189">=</span>&nbsp;<span class="ident" id="6397191"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397193">.</span><span class="ident" id="6397194"><a href="/gostd/net/http/httputil/persist.go.html#6394408">writeReq</a></span><span class="op" id="6397202">(</span><span class="ident" id="6397203"><a href="/gostd/net/http/httputil/persist.go.html#6396357">req</a></span><span class="op" id="6397206">,</span>&nbsp;<span class="ident" id="6397208"><a href="/gostd/net/http/httputil/persist.go.html#6397012">c</a></span><span class="op" id="6397209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397212"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397214">.</span><span class="ident" id="6397215"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397217">.</span><span class="ident" id="6397218"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6397222">(</span><span class="op" id="6397223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397226">defer</span>&nbsp;<span class="ident" id="6397232"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397234">.</span><span class="ident" id="6397235"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397237">.</span><span class="ident" id="6397238"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6397244">(</span><span class="op" id="6397245">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397248">if</span>&nbsp;<span class="ident" id="6397251"><a href="/gostd/net/http/httputil/persist.go.html#6396377">err</a></span>&nbsp;<span class="op" id="6397255">!=</span>&nbsp;<span class="builtintype" id="6397258">nil</span>&nbsp;<span class="op" id="6397262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397266"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397268">.</span><span class="ident" id="6397269"><a href="/gostd/net/http/httputil/persist.go.html#6394246">we</a></span>&nbsp;<span class="op" id="6397272">=</span>&nbsp;<span class="ident" id="6397274"><a href="/gostd/net/http/httputil/persist.go.html#6396377">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397280">return</span>&nbsp;<span class="ident" id="6397287"><a href="/gostd/net/http/httputil/persist.go.html#6396377">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6397292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397295"><a href="/gostd/net/http/httputil/persist.go.html#6396335">cc</a></span><span class="op" id="6397297">.</span><span class="ident" id="6397298"><a href="/gostd/net/http/httputil/persist.go.html#6394324">nwritten</a></span><span class="op" id="6397306">++</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397311">return</span>&nbsp;<span class="builtintype" id="6397318">nil</span><br>
<span class="lineno"></span><span class="op" id="6397322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6397325">//&nbsp;Pending&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;unanswered&nbsp;requests</span><br>
<span class="lineno">350</span><span class="comment" id="6397378">//&nbsp;that&nbsp;have&nbsp;been&nbsp;sent&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6397420">func</span>&nbsp;<span class="op" id="6397425">(</span><span class="ident" id="6397426">cc</span>&nbsp;<span class="op" id="6397429">*</span><span class="ident" id="6397430"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6397440">)</span>&nbsp;<span class="ident" id="6397442">Pending</span><span class="op" id="6397449">(</span><span class="op" id="6397450">)</span>&nbsp;<span class="builtintype" id="6397452">int</span>&nbsp;<span class="op" id="6397456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397459"><a href="/gostd/net/http/httputil/persist.go.html#6397426">cc</a></span><span class="op" id="6397461">.</span><span class="ident" id="6397462"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397464">.</span><span class="ident" id="6397465"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6397469">(</span><span class="op" id="6397470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397473">defer</span>&nbsp;<span class="ident" id="6397479"><a href="/gostd/net/http/httputil/persist.go.html#6397426">cc</a></span><span class="op" id="6397481">.</span><span class="ident" id="6397482"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397484">.</span><span class="ident" id="6397485"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6397491">(</span><span class="op" id="6397492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397495">return</span>&nbsp;<span class="ident" id="6397502"><a href="/gostd/net/http/httputil/persist.go.html#6397426">cc</a></span><span class="op" id="6397504">.</span><span class="ident" id="6397505"><a href="/gostd/net/http/httputil/persist.go.html#6394324">nwritten</a></span>&nbsp;<span class="op" id="6397514">-</span>&nbsp;<span class="ident" id="6397516"><a href="/gostd/net/http/httputil/persist.go.html#6397426">cc</a></span><span class="op" id="6397518">.</span><span class="ident" id="6397519"><a href="/gostd/net/http/httputil/persist.go.html#6394317">nread</a></span><br>
<span class="lineno">355</span><span class="op" id="6397525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6397528">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;response&nbsp;from&nbsp;the&nbsp;wire.&nbsp;A&nbsp;valid&nbsp;response&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6397601">//&nbsp;returned&nbsp;together&nbsp;with&nbsp;an&nbsp;ErrPersistEOF,&nbsp;which&nbsp;means&nbsp;that&nbsp;the&nbsp;remote</span><br>
<span class="lineno"></span><span class="comment" id="6397673">//&nbsp;requested&nbsp;that&nbsp;this&nbsp;be&nbsp;the&nbsp;last&nbsp;request&nbsp;serviced.&nbsp;Read&nbsp;can&nbsp;be&nbsp;called</span><br>
<span class="lineno">360</span><span class="comment" id="6397745">//&nbsp;concurrently&nbsp;with&nbsp;Write,&nbsp;but&nbsp;not&nbsp;with&nbsp;another&nbsp;Read.</span><br>
<span class="lineno"></span><span class="keyword" id="6397800">func</span>&nbsp;<span class="op" id="6397805">(</span><span class="ident" id="6397806">cc</span>&nbsp;<span class="op" id="6397809">*</span><span class="ident" id="6397810"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6397820">)</span>&nbsp;<span class="ident" id="6397822">Read</span><span class="op" id="6397826">(</span><span class="ident" id="6397827">req</span>&nbsp;<span class="op" id="6397831">*</span><span class="ident" id="6397832"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6397836">.</span><span class="ident" id="6397837"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6397844">)</span>&nbsp;<span class="op" id="6397846">(</span><span class="ident" id="6397847">resp</span>&nbsp;<span class="op" id="6397852">*</span><span class="ident" id="6397853"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6397857">.</span><span class="ident" id="6397858"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="6397866">,</span>&nbsp;<span class="ident" id="6397868">err</span>&nbsp;<span class="builtintype" id="6397872">error</span><span class="op" id="6397877">)</span>&nbsp;<span class="op" id="6397879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6397882">//&nbsp;Retrieve&nbsp;the&nbsp;pipeline&nbsp;ID&nbsp;of&nbsp;this&nbsp;request/response&nbsp;pair</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397941"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6397943">.</span><span class="ident" id="6397944"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6397946">.</span><span class="ident" id="6397947"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6397951">(</span><span class="op" id="6397952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397955">id</span><span class="op" id="6397957">,</span>&nbsp;<span class="ident" id="6397959">ok</span>&nbsp;<span class="op" id="6397962">:=</span>&nbsp;<span class="ident" id="6397965"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6397967">.</span><span class="ident" id="6397968"><a href="/gostd/net/http/httputil/persist.go.html#6394338">pipereq</a></span><span class="op" id="6397975">[</span><span class="ident" id="6397976"><a href="/gostd/net/http/httputil/persist.go.html#6397827">req</a></span><span class="op" id="6397979">]</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6397982">delete</span><span class="op" id="6397988">(</span><span class="ident" id="6397989"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6397991">.</span><span class="ident" id="6397992"><a href="/gostd/net/http/httputil/persist.go.html#6394338">pipereq</a></span><span class="op" id="6397999">,</span>&nbsp;<span class="ident" id="6398001"><a href="/gostd/net/http/httputil/persist.go.html#6397827">req</a></span><span class="op" id="6398004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398007">if</span>&nbsp;<span class="op" id="6398010">!</span><span class="ident" id="6398011"><a href="/gostd/net/http/httputil/persist.go.html#6397959">ok</a></span>&nbsp;<span class="op" id="6398014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398018"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398020">.</span><span class="ident" id="6398021"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398023">.</span><span class="ident" id="6398024"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398030">(</span><span class="op" id="6398031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398035">return</span>&nbsp;<span class="builtintype" id="6398042">nil</span><span class="op" id="6398045">,</span>&nbsp;<span class="ident" id="6398047"><a href="/gostd/net/http/httputil/persist.go.html#6388254">ErrPipeline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398060">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398063"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398065">.</span><span class="ident" id="6398066"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398068">.</span><span class="ident" id="6398069"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398075">(</span><span class="op" id="6398076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398080">//&nbsp;Ensure&nbsp;pipeline&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398106"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398108">.</span><span class="ident" id="6398109"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6398113">.</span><span class="ident" id="6398114"><a href="/gostd/net/textproto/pipeline.go.html#4331187">StartResponse</a></span><span class="op" id="6398127">(</span><span class="ident" id="6398128"><a href="/gostd/net/http/httputil/persist.go.html#6397955">id</a></span><span class="op" id="6398130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398133">defer</span>&nbsp;<span class="ident" id="6398139"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398141">.</span><span class="ident" id="6398142"><a href="/gostd/net/http/httputil/persist.go.html#6394379">pipe</a></span><span class="op" id="6398146">.</span><span class="ident" id="6398147"><a href="/gostd/net/textproto/pipeline.go.html#4331372">EndResponse</a></span><span class="op" id="6398158">(</span><span class="ident" id="6398159"><a href="/gostd/net/http/httputil/persist.go.html#6397955">id</a></span><span class="op" id="6398161">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398165"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398167">.</span><span class="ident" id="6398168"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398170">.</span><span class="ident" id="6398171"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6398175">(</span><span class="op" id="6398176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398179">if</span>&nbsp;<span class="ident" id="6398182"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398184">.</span><span class="ident" id="6398185"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span>&nbsp;<span class="op" id="6398188">!=</span>&nbsp;<span class="builtintype" id="6398191">nil</span>&nbsp;<span class="op" id="6398195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398199">defer</span>&nbsp;<span class="ident" id="6398205"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398207">.</span><span class="ident" id="6398208"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398210">.</span><span class="ident" id="6398211"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398217">(</span><span class="op" id="6398218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398222">return</span>&nbsp;<span class="builtintype" id="6398229">nil</span><span class="op" id="6398232">,</span>&nbsp;<span class="ident" id="6398234"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398236">.</span><span class="ident" id="6398237"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398244">if</span>&nbsp;<span class="ident" id="6398247"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398249">.</span><span class="ident" id="6398250"><a href="/gostd/net/http/httputil/persist.go.html#6394211">r</a></span>&nbsp;<span class="op" id="6398252">==</span>&nbsp;<span class="builtintype" id="6398255">nil</span>&nbsp;<span class="op" id="6398259">{</span>&nbsp;<span class="comment" id="6398261">//&nbsp;connection&nbsp;closed&nbsp;by&nbsp;user&nbsp;in&nbsp;the&nbsp;meantime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398308">defer</span>&nbsp;<span class="ident" id="6398314"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398316">.</span><span class="ident" id="6398317"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398319">.</span><span class="ident" id="6398320"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398326">(</span><span class="op" id="6398327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398331">return</span>&nbsp;<span class="builtintype" id="6398338">nil</span><span class="op" id="6398341">,</span>&nbsp;<span class="ident" id="6398343"><a href="/gostd/net/http/httputil/persist.go.html#6388451">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398354">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398357">r</span>&nbsp;<span class="op" id="6398359">:=</span>&nbsp;<span class="ident" id="6398362"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398364">.</span><span class="ident" id="6398365"><a href="/gostd/net/http/httputil/persist.go.html#6394211">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398368">lastbody</span>&nbsp;<span class="op" id="6398377">:=</span>&nbsp;<span class="ident" id="6398380"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398382">.</span><span class="ident" id="6398383"><a href="/gostd/net/http/httputil/persist.go.html#6394286">lastbody</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398393"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398395">.</span><span class="ident" id="6398396"><a href="/gostd/net/http/httputil/persist.go.html#6394286">lastbody</a></span>&nbsp;<span class="op" id="6398405">=</span>&nbsp;<span class="builtintype" id="6398407">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398412"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398414">.</span><span class="ident" id="6398415"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398417">.</span><span class="ident" id="6398418"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398424">(</span><span class="op" id="6398425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398429">//&nbsp;Make&nbsp;sure&nbsp;body&nbsp;is&nbsp;fully&nbsp;consumed,&nbsp;even&nbsp;if&nbsp;user&nbsp;does&nbsp;not&nbsp;call&nbsp;body.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398505">if</span>&nbsp;<span class="ident" id="6398508"><a href="/gostd/net/http/httputil/persist.go.html#6398368">lastbody</a></span>&nbsp;<span class="op" id="6398517">!=</span>&nbsp;<span class="builtintype" id="6398520">nil</span>&nbsp;<span class="op" id="6398524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398528">//&nbsp;body.Close&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;idempotent&nbsp;and&nbsp;multiple&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398594">//&nbsp;it&nbsp;should&nbsp;return&nbsp;the&nbsp;error&nbsp;that&nbsp;its&nbsp;first&nbsp;invocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6398652">//&nbsp;returned.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398667"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span>&nbsp;<span class="op" id="6398671">=</span>&nbsp;<span class="ident" id="6398673"><a href="/gostd/net/http/httputil/persist.go.html#6398368">lastbody</a></span><span class="op" id="6398681">.</span><span class="ident" id="6398682"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6398687">(</span><span class="op" id="6398688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398692">if</span>&nbsp;<span class="ident" id="6398695"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span>&nbsp;<span class="op" id="6398699">!=</span>&nbsp;<span class="builtintype" id="6398702">nil</span>&nbsp;<span class="op" id="6398706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398711"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398713">.</span><span class="ident" id="6398714"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398716">.</span><span class="ident" id="6398717"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6398721">(</span><span class="op" id="6398722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398727">defer</span>&nbsp;<span class="ident" id="6398733"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398735">.</span><span class="ident" id="6398736"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398738">.</span><span class="ident" id="6398739"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398745">(</span><span class="op" id="6398746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398751"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398753">.</span><span class="ident" id="6398754"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span>&nbsp;<span class="op" id="6398757">=</span>&nbsp;<span class="ident" id="6398759"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398766">return</span>&nbsp;<span class="builtintype" id="6398773">nil</span><span class="op" id="6398776">,</span>&nbsp;<span class="ident" id="6398778"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398791"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6398795">,</span>&nbsp;<span class="ident" id="6398797"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span>&nbsp;<span class="op" id="6398801">=</span>&nbsp;<span class="ident" id="6398803"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6398807">.</span><span class="ident" id="6398808"><a href="/gostd/net/http/response.go.html#4164712">ReadResponse</a></span><span class="op" id="6398820">(</span><span class="ident" id="6398821"><a href="/gostd/net/http/httputil/persist.go.html#6398357">r</a></span><span class="op" id="6398822">,</span>&nbsp;<span class="ident" id="6398824"><a href="/gostd/net/http/httputil/persist.go.html#6397827">req</a></span><span class="op" id="6398827">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398830"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398832">.</span><span class="ident" id="6398833"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398835">.</span><span class="ident" id="6398836"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6398840">(</span><span class="op" id="6398841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398844">defer</span>&nbsp;<span class="ident" id="6398850"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398852">.</span><span class="ident" id="6398853"><a href="/gostd/net/http/httputil/persist.go.html#6394113">lk</a></span><span class="op" id="6398855">.</span><span class="ident" id="6398856"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6398862">(</span><span class="op" id="6398863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398866">if</span>&nbsp;<span class="ident" id="6398869"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span>&nbsp;<span class="op" id="6398873">!=</span>&nbsp;<span class="builtintype" id="6398876">nil</span>&nbsp;<span class="op" id="6398880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398884"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398886">.</span><span class="ident" id="6398887"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span>&nbsp;<span class="op" id="6398890">=</span>&nbsp;<span class="ident" id="6398892"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398898">return</span>&nbsp;<span class="ident" id="6398905"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6398909">,</span>&nbsp;<span class="ident" id="6398911"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6398916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398919"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398921">.</span><span class="ident" id="6398922"><a href="/gostd/net/http/httputil/persist.go.html#6394286">lastbody</a></span>&nbsp;<span class="op" id="6398931">=</span>&nbsp;<span class="ident" id="6398933"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6398937">.</span><span class="ident" id="6398938"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398945"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398947">.</span><span class="ident" id="6398948"><a href="/gostd/net/http/httputil/persist.go.html#6394317">nread</a></span><span class="op" id="6398953">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6398958">if</span>&nbsp;<span class="ident" id="6398961"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6398965">.</span><span class="ident" id="6398966"><a href="/gostd/net/http/response.go.html#4163140">Close</a></span>&nbsp;<span class="op" id="6398972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6398976"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6398978">.</span><span class="ident" id="6398979"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span>&nbsp;<span class="op" id="6398982">=</span>&nbsp;<span class="ident" id="6398984"><a href="/gostd/net/http/httputil/persist.go.html#6388093">ErrPersistEOF</a></span>&nbsp;<span class="comment" id="6398998">//&nbsp;don&#39;t&nbsp;send&nbsp;any&nbsp;more&nbsp;requests</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6399032">return</span>&nbsp;<span class="ident" id="6399039"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6399043">,</span>&nbsp;<span class="ident" id="6399045"><a href="/gostd/net/http/httputil/persist.go.html#6397806">cc</a></span><span class="op" id="6399047">.</span><span class="ident" id="6399048"><a href="/gostd/net/http/httputil/persist.go.html#6394242">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6399052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6399055">return</span>&nbsp;<span class="ident" id="6399062"><a href="/gostd/net/http/httputil/persist.go.html#6397847">resp</a></span><span class="op" id="6399066">,</span>&nbsp;<span class="ident" id="6399068"><a href="/gostd/net/http/httputil/persist.go.html#6397868">err</a></span><br>
<span class="lineno">420</span><span class="op" id="6399072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6399075">//&nbsp;Do&nbsp;is&nbsp;convenience&nbsp;method&nbsp;that&nbsp;writes&nbsp;a&nbsp;request&nbsp;and&nbsp;reads&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="6399147">func</span>&nbsp;<span class="op" id="6399152">(</span><span class="ident" id="6399153">cc</span>&nbsp;<span class="op" id="6399156">*</span><span class="ident" id="6399157"><a href="/gostd/net/http/httputil/persist.go.html#6394092">ClientConn</a></span><span class="op" id="6399167">)</span>&nbsp;<span class="ident" id="6399169">Do</span><span class="op" id="6399171">(</span><span class="ident" id="6399172">req</span>&nbsp;<span class="op" id="6399176">*</span><span class="ident" id="6399177"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6399181">.</span><span class="ident" id="6399182"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6399189">)</span>&nbsp;<span class="op" id="6399191">(</span><span class="ident" id="6399192">resp</span>&nbsp;<span class="op" id="6399197">*</span><span class="ident" id="6399198"><a href="/gostd/net/http/httputil/persist.go.html#6388047">http</a></span><span class="op" id="6399202">.</span><span class="ident" id="6399203"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="6399211">,</span>&nbsp;<span class="ident" id="6399213">err</span>&nbsp;<span class="builtintype" id="6399217">error</span><span class="op" id="6399222">)</span>&nbsp;<span class="op" id="6399224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6399227"><a href="/gostd/net/http/httputil/persist.go.html#6399213">err</a></span>&nbsp;<span class="op" id="6399231">=</span>&nbsp;<span class="ident" id="6399233"><a href="/gostd/net/http/httputil/persist.go.html#6399153">cc</a></span><span class="op" id="6399235">.</span><span class="ident" id="6399236"><a href="/gostd/net/http/httputil/persist.go.html#6396351">Write</a></span><span class="op" id="6399241">(</span><span class="ident" id="6399242"><a href="/gostd/net/http/httputil/persist.go.html#6399172">req</a></span><span class="op" id="6399245">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6399248">if</span>&nbsp;<span class="ident" id="6399251"><a href="/gostd/net/http/httputil/persist.go.html#6399213">err</a></span>&nbsp;<span class="op" id="6399255">!=</span>&nbsp;<span class="builtintype" id="6399258">nil</span>&nbsp;<span class="op" id="6399262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6399266">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6399274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6399277">return</span>&nbsp;<span class="ident" id="6399284"><a href="/gostd/net/http/httputil/persist.go.html#6399153">cc</a></span><span class="op" id="6399286">.</span><span class="ident" id="6399287"><a href="/gostd/net/http/httputil/persist.go.html#6397822">Read</a></span><span class="op" id="6399291">(</span><span class="ident" id="6399292"><a href="/gostd/net/http/httputil/persist.go.html#6399172">req</a></span><span class="op" id="6399295">)</span><br>
<span class="lineno"></span><span class="op" id="6399297">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
