<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2961563">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2961619">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2961673">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2961724">package</span>&nbsp;<span class="ident" id="2961732">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2961740">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="2961802">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="2961822">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="2961896">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="2961924">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2961999">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="2962037">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2962106">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="2962179">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="2962254">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2962306">//</span><br>
<span class="lineno"></span><span class="comment" id="2962309">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="2962325">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="2962394">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="2962473">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="2962552">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2962628">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2962707">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="2962785">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2962866">import</span>&nbsp;<span class="op" id="2962873">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2962876">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2962886">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="2962891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2962894">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="2962968">const</span>&nbsp;<span class="op" id="2962974">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2962977">MaxVarintLen16</span>&nbsp;<span class="op" id="2962992">=</span>&nbsp;<span class="num" id="2962994">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2962997">MaxVarintLen32</span>&nbsp;<span class="op" id="2963012">=</span>&nbsp;<span class="num" id="2963014">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963017">MaxVarintLen64</span>&nbsp;<span class="op" id="2963032">=</span>&nbsp;<span class="num" id="2963034">10</span><br>
<span class="lineno"></span><span class="op" id="2963037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2963040">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="2963121">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2963175">func</span>&nbsp;<span class="ident" id="2963180">PutUvarint</span><span class="op" id="2963190">(</span><span class="ident" id="2963191">buf</span>&nbsp;<span class="op" id="2963195">[</span><span class="op" id="2963196">]</span><span class="builtintype" id="2963197">byte</span><span class="op" id="2963201">,</span>&nbsp;<span class="ident" id="2963203">x</span>&nbsp;<span class="ident" id="2963205">uint64</span><span class="op" id="2963211">)</span>&nbsp;<span class="builtintype" id="2963213">int</span>&nbsp;<span class="op" id="2963217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963220">i</span>&nbsp;<span class="op" id="2963222">:=</span>&nbsp;<span class="num" id="2963225">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963228">for</span>&nbsp;<span class="ident" id="2963232">x</span>&nbsp;<span class="op" id="2963234">&gt;=</span>&nbsp;<span class="num" id="2963237">0x80</span>&nbsp;<span class="op" id="2963242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963246">buf</span><span class="op" id="2963249">[</span><span class="ident" id="2963250">i</span><span class="op" id="2963251">]</span>&nbsp;<span class="op" id="2963253">=</span>&nbsp;<span class="builtintype" id="2963255">byte</span><span class="op" id="2963259">(</span><span class="ident" id="2963260">x</span><span class="op" id="2963261">)</span>&nbsp;<span class="op" id="2963263">|</span>&nbsp;<span class="num" id="2963265">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963272">x</span>&nbsp;<span class="op" id="2963274">&gt;&gt;=</span>&nbsp;<span class="num" id="2963278">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963282">i</span><span class="op" id="2963283">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2963287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963290">buf</span><span class="op" id="2963293">[</span><span class="ident" id="2963294">i</span><span class="op" id="2963295">]</span>&nbsp;<span class="op" id="2963297">=</span>&nbsp;<span class="builtintype" id="2963299">byte</span><span class="op" id="2963303">(</span><span class="ident" id="2963304">x</span><span class="op" id="2963305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963308">return</span>&nbsp;<span class="ident" id="2963315">i</span>&nbsp;<span class="op" id="2963317">+</span>&nbsp;<span class="num" id="2963319">1</span><br>
<span class="lineno">50</span><span class="op" id="2963321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2963324">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2963392">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2963460">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="2963506">//</span><br>
<span class="lineno"></span><span class="comment" id="2963509">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2963534">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2963582">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2963633">//</span><br>
<span class="lineno">60</span><span class="keyword" id="2963636">func</span>&nbsp;<span class="ident" id="2963641">Uvarint</span><span class="op" id="2963648">(</span><span class="ident" id="2963649">buf</span>&nbsp;<span class="op" id="2963653">[</span><span class="op" id="2963654">]</span><span class="builtintype" id="2963655">byte</span><span class="op" id="2963659">)</span>&nbsp;<span class="op" id="2963661">(</span><span class="ident" id="2963662">uint64</span><span class="op" id="2963668">,</span>&nbsp;<span class="builtintype" id="2963670">int</span><span class="op" id="2963673">)</span>&nbsp;<span class="op" id="2963675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963678">var</span>&nbsp;<span class="ident" id="2963682">x</span>&nbsp;<span class="ident" id="2963684">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963692">var</span>&nbsp;<span class="ident" id="2963696">s</span>&nbsp;<span class="builtintype" id="2963698">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963704">for</span>&nbsp;<span class="ident" id="2963708">i</span><span class="op" id="2963709">,</span>&nbsp;<span class="ident" id="2963711">b</span>&nbsp;<span class="op" id="2963713">:=</span>&nbsp;<span class="keyword" id="2963716">range</span>&nbsp;<span class="ident" id="2963722">buf</span>&nbsp;<span class="op" id="2963726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963730">if</span>&nbsp;<span class="ident" id="2963733">b</span>&nbsp;<span class="op" id="2963735">&lt;</span>&nbsp;<span class="num" id="2963737">0x80</span>&nbsp;<span class="op" id="2963742">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963747">if</span>&nbsp;<span class="ident" id="2963750">i</span>&nbsp;<span class="op" id="2963752">&gt;</span>&nbsp;<span class="num" id="2963754">9</span>&nbsp;<span class="op" id="2963756">||</span>&nbsp;<span class="ident" id="2963759">i</span>&nbsp;<span class="op" id="2963761">==</span>&nbsp;<span class="num" id="2963764">9</span>&nbsp;<span class="op" id="2963766">&amp;&amp;</span>&nbsp;<span class="ident" id="2963769">b</span>&nbsp;<span class="op" id="2963771">&gt;</span>&nbsp;<span class="num" id="2963773">1</span>&nbsp;<span class="op" id="2963775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963781">return</span>&nbsp;<span class="num" id="2963788">0</span><span class="op" id="2963789">,</span>&nbsp;<span class="op" id="2963791">-</span><span class="op" id="2963792">(</span><span class="ident" id="2963793">i</span>&nbsp;<span class="op" id="2963795">+</span>&nbsp;<span class="num" id="2963797">1</span><span class="op" id="2963798">)</span>&nbsp;<span class="comment" id="2963800">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2963815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963820">return</span>&nbsp;<span class="ident" id="2963827">x</span>&nbsp;<span class="op" id="2963829">|</span>&nbsp;<span class="ident" id="2963831">uint64</span><span class="op" id="2963837">(</span><span class="ident" id="2963838">b</span><span class="op" id="2963839">)</span><span class="op" id="2963840">&lt;&lt;</span><span class="ident" id="2963842">s</span><span class="op" id="2963843">,</span>&nbsp;<span class="ident" id="2963845">i</span>&nbsp;<span class="op" id="2963847">+</span>&nbsp;<span class="num" id="2963849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2963853">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963857">x</span>&nbsp;<span class="op" id="2963859">|=</span>&nbsp;<span class="ident" id="2963862">uint64</span><span class="op" id="2963868">(</span><span class="ident" id="2963869">b</span><span class="op" id="2963870">&amp;</span><span class="num" id="2963871">0x7f</span><span class="op" id="2963875">)</span>&nbsp;<span class="op" id="2963877">&lt;&lt;</span>&nbsp;<span class="ident" id="2963880">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2963884">s</span>&nbsp;<span class="op" id="2963886">+=</span>&nbsp;<span class="num" id="2963889">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2963892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2963895">return</span>&nbsp;<span class="num" id="2963902">0</span><span class="op" id="2963903">,</span>&nbsp;<span class="num" id="2963905">0</span><br>
<span class="lineno"></span><span class="op" id="2963907">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="2963910">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2963990">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="2964043">func</span>&nbsp;<span class="ident" id="2964048">PutVarint</span><span class="op" id="2964057">(</span><span class="ident" id="2964058">buf</span>&nbsp;<span class="op" id="2964062">[</span><span class="op" id="2964063">]</span><span class="builtintype" id="2964064">byte</span><span class="op" id="2964068">,</span>&nbsp;<span class="ident" id="2964070">x</span>&nbsp;<span class="ident" id="2964072">int64</span><span class="op" id="2964077">)</span>&nbsp;<span class="builtintype" id="2964079">int</span>&nbsp;<span class="op" id="2964083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964086">ux</span>&nbsp;<span class="op" id="2964089">:=</span>&nbsp;<span class="ident" id="2964092">uint64</span><span class="op" id="2964098">(</span><span class="ident" id="2964099">x</span><span class="op" id="2964100">)</span>&nbsp;<span class="op" id="2964102">&lt;&lt;</span>&nbsp;<span class="num" id="2964105">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964108">if</span>&nbsp;<span class="ident" id="2964111">x</span>&nbsp;<span class="op" id="2964113">&lt;</span>&nbsp;<span class="num" id="2964115">0</span>&nbsp;<span class="op" id="2964117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964121">ux</span>&nbsp;<span class="op" id="2964124">=</span>&nbsp;<span class="op" id="2964126">^</span><span class="ident" id="2964127">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2964131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964134">return</span>&nbsp;<span class="ident" id="2964141">PutUvarint</span><span class="op" id="2964151">(</span><span class="ident" id="2964152">buf</span><span class="op" id="2964155">,</span>&nbsp;<span class="ident" id="2964157">ux</span><span class="op" id="2964159">)</span><br>
<span class="lineno"></span><span class="op" id="2964161">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="2964164">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2964231">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="2964299">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="2964364">//</span><br>
<span class="lineno">90</span><span class="comment" id="2964367">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="2964392">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="2964440">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2964491">//</span><br>
<span class="lineno"></span><span class="keyword" id="2964494">func</span>&nbsp;<span class="ident" id="2964499">Varint</span><span class="op" id="2964505">(</span><span class="ident" id="2964506">buf</span>&nbsp;<span class="op" id="2964510">[</span><span class="op" id="2964511">]</span><span class="builtintype" id="2964512">byte</span><span class="op" id="2964516">)</span>&nbsp;<span class="op" id="2964518">(</span><span class="ident" id="2964519">int64</span><span class="op" id="2964524">,</span>&nbsp;<span class="builtintype" id="2964526">int</span><span class="op" id="2964529">)</span>&nbsp;<span class="op" id="2964531">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964534">ux</span><span class="op" id="2964536">,</span>&nbsp;<span class="ident" id="2964538">n</span>&nbsp;<span class="op" id="2964540">:=</span>&nbsp;<span class="ident" id="2964543">Uvarint</span><span class="op" id="2964550">(</span><span class="ident" id="2964551">buf</span><span class="op" id="2964554">)</span>&nbsp;<span class="comment" id="2964556">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964596">x</span>&nbsp;<span class="op" id="2964598">:=</span>&nbsp;<span class="ident" id="2964601">int64</span><span class="op" id="2964606">(</span><span class="ident" id="2964607">ux</span>&nbsp;<span class="op" id="2964610">&gt;&gt;</span>&nbsp;<span class="num" id="2964613">1</span><span class="op" id="2964614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964617">if</span>&nbsp;<span class="ident" id="2964620">ux</span><span class="op" id="2964622">&amp;</span><span class="num" id="2964623">1</span>&nbsp;<span class="op" id="2964625">!=</span>&nbsp;<span class="num" id="2964628">0</span>&nbsp;<span class="op" id="2964630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964634">x</span>&nbsp;<span class="op" id="2964636">=</span>&nbsp;<span class="op" id="2964638">^</span><span class="ident" id="2964639">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2964642">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964645">return</span>&nbsp;<span class="ident" id="2964652">x</span><span class="op" id="2964653">,</span>&nbsp;<span class="ident" id="2964655">n</span><br>
<span class="lineno"></span><span class="op" id="2964657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2964660">var</span>&nbsp;<span class="ident" id="2964664">overflow</span>&nbsp;<span class="op" id="2964673">=</span>&nbsp;<span class="ident" id="2964675">errors</span><span class="op" id="2964681">.</span><span class="ident" id="2964682">New</span><span class="op" id="2964685">(</span><span class="string" id="2964686">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="2964729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2964732">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="2964816">func</span>&nbsp;<span class="ident" id="2964821">ReadUvarint</span><span class="op" id="2964832">(</span><span class="ident" id="2964833">r</span>&nbsp;<span class="ident" id="2964835">io</span><span class="op" id="2964837">.</span><span class="ident" id="2964838">ByteReader</span><span class="op" id="2964848">)</span>&nbsp;<span class="op" id="2964850">(</span><span class="ident" id="2964851">uint64</span><span class="op" id="2964857">,</span>&nbsp;<span class="builtintype" id="2964859">error</span><span class="op" id="2964864">)</span>&nbsp;<span class="op" id="2964866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964869">var</span>&nbsp;<span class="ident" id="2964873">x</span>&nbsp;<span class="ident" id="2964875">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964883">var</span>&nbsp;<span class="ident" id="2964887">s</span>&nbsp;<span class="builtintype" id="2964889">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964895">for</span>&nbsp;<span class="ident" id="2964899">i</span>&nbsp;<span class="op" id="2964901">:=</span>&nbsp;<span class="num" id="2964904">0</span><span class="op" id="2964905">;</span>&nbsp;<span class="op" id="2964907">;</span>&nbsp;<span class="ident" id="2964909">i</span><span class="op" id="2964910">++</span>&nbsp;<span class="op" id="2964913">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2964917">b</span><span class="op" id="2964918">,</span>&nbsp;<span class="ident" id="2964920">err</span>&nbsp;<span class="op" id="2964924">:=</span>&nbsp;<span class="ident" id="2964927">r</span><span class="op" id="2964928">.</span><span class="ident" id="2964929">ReadByte</span><span class="op" id="2964937">(</span><span class="op" id="2964938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964942">if</span>&nbsp;<span class="ident" id="2964945">err</span>&nbsp;<span class="op" id="2964949">!=</span>&nbsp;<span class="ident" id="2964952">nil</span>&nbsp;<span class="op" id="2964956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964961">return</span>&nbsp;<span class="ident" id="2964968">x</span><span class="op" id="2964969">,</span>&nbsp;<span class="ident" id="2964971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2964977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964981">if</span>&nbsp;<span class="ident" id="2964984">b</span>&nbsp;<span class="op" id="2964986">&lt;</span>&nbsp;<span class="num" id="2964988">0x80</span>&nbsp;<span class="op" id="2964993">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2964998">if</span>&nbsp;<span class="ident" id="2965001">i</span>&nbsp;<span class="op" id="2965003">&gt;</span>&nbsp;<span class="num" id="2965005">9</span>&nbsp;<span class="op" id="2965007">||</span>&nbsp;<span class="ident" id="2965010">i</span>&nbsp;<span class="op" id="2965012">==</span>&nbsp;<span class="num" id="2965015">9</span>&nbsp;<span class="op" id="2965017">&amp;&amp;</span>&nbsp;<span class="ident" id="2965020">b</span>&nbsp;<span class="op" id="2965022">&gt;</span>&nbsp;<span class="num" id="2965024">1</span>&nbsp;<span class="op" id="2965026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2965032">return</span>&nbsp;<span class="ident" id="2965039">x</span><span class="op" id="2965040">,</span>&nbsp;<span class="ident" id="2965042">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2965054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2965059">return</span>&nbsp;<span class="ident" id="2965066">x</span>&nbsp;<span class="op" id="2965068">|</span>&nbsp;<span class="ident" id="2965070">uint64</span><span class="op" id="2965076">(</span><span class="ident" id="2965077">b</span><span class="op" id="2965078">)</span><span class="op" id="2965079">&lt;&lt;</span><span class="ident" id="2965081">s</span><span class="op" id="2965082">,</span>&nbsp;<span class="ident" id="2965084">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2965090">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965094">x</span>&nbsp;<span class="op" id="2965096">|=</span>&nbsp;<span class="ident" id="2965099">uint64</span><span class="op" id="2965105">(</span><span class="ident" id="2965106">b</span><span class="op" id="2965107">&amp;</span><span class="num" id="2965108">0x7f</span><span class="op" id="2965112">)</span>&nbsp;<span class="op" id="2965114">&lt;&lt;</span>&nbsp;<span class="ident" id="2965117">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965121">s</span>&nbsp;<span class="op" id="2965123">+=</span>&nbsp;<span class="num" id="2965126">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2965129">}</span><br>
<span class="lineno"></span><span class="op" id="2965131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2965134">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="2965215">func</span>&nbsp;<span class="ident" id="2965220">ReadVarint</span><span class="op" id="2965230">(</span><span class="ident" id="2965231">r</span>&nbsp;<span class="ident" id="2965233">io</span><span class="op" id="2965235">.</span><span class="ident" id="2965236">ByteReader</span><span class="op" id="2965246">)</span>&nbsp;<span class="op" id="2965248">(</span><span class="ident" id="2965249">int64</span><span class="op" id="2965254">,</span>&nbsp;<span class="builtintype" id="2965256">error</span><span class="op" id="2965261">)</span>&nbsp;<span class="op" id="2965263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965266">ux</span><span class="op" id="2965268">,</span>&nbsp;<span class="ident" id="2965270">err</span>&nbsp;<span class="op" id="2965274">:=</span>&nbsp;<span class="ident" id="2965277">ReadUvarint</span><span class="op" id="2965288">(</span><span class="ident" id="2965289">r</span><span class="op" id="2965290">)</span>&nbsp;<span class="comment" id="2965292">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965332">x</span>&nbsp;<span class="op" id="2965334">:=</span>&nbsp;<span class="ident" id="2965337">int64</span><span class="op" id="2965342">(</span><span class="ident" id="2965343">ux</span>&nbsp;<span class="op" id="2965346">&gt;&gt;</span>&nbsp;<span class="num" id="2965349">1</span><span class="op" id="2965350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2965353">if</span>&nbsp;<span class="ident" id="2965356">ux</span><span class="op" id="2965358">&amp;</span><span class="num" id="2965359">1</span>&nbsp;<span class="op" id="2965361">!=</span>&nbsp;<span class="num" id="2965364">0</span>&nbsp;<span class="op" id="2965366">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2965370">x</span>&nbsp;<span class="op" id="2965372">=</span>&nbsp;<span class="op" id="2965374">^</span><span class="ident" id="2965375">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2965378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2965381">return</span>&nbsp;<span class="ident" id="2965388">x</span><span class="op" id="2965389">,</span>&nbsp;<span class="ident" id="2965391">err</span><br>
<span class="lineno"></span><span class="op" id="2965395">}</span>
</div>
</body>
</html>
