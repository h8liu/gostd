<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2509092">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2509147">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2509201">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2509252">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2509322">package</span>&nbsp;<span class="ident" id="2509330">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2509334">import</span>&nbsp;<span class="op" id="2509341">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2509344">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2509355">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2509370">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2509380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2509383">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2509427">type</span>&nbsp;<span class="ident" id="2509432">File</span>&nbsp;<span class="keyword" id="2509437">struct</span>&nbsp;<span class="op" id="2509444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2509447">*</span><span class="ident" id="2509448">file</span><br>
<span class="lineno"></span><span class="op" id="2509453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2509456">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2509501">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2509565">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2509625">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2509664">type</span>&nbsp;<span class="ident" id="2509669">file</span>&nbsp;<span class="keyword" id="2509674">struct</span>&nbsp;<span class="op" id="2509681">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2509684">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2509692">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2509697">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2509705">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2509713">dirinfo</span>&nbsp;<span class="op" id="2509721">*</span><span class="ident" id="2509722">dirInfo</span>&nbsp;<span class="comment" id="2509730">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2509766">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2509774">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2509783">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2509823">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2509826">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2509900">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2509988">func</span>&nbsp;<span class="op" id="2509993">(</span><span class="ident" id="2509994">f</span>&nbsp;<span class="op" id="2509996">*</span><span class="ident" id="2509997">File</span><span class="op" id="2510001">)</span>&nbsp;<span class="ident" id="2510003">Fd</span><span class="op" id="2510005">(</span><span class="op" id="2510006">)</span>&nbsp;<span class="builtintype" id="2510008">uintptr</span>&nbsp;<span class="op" id="2510016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510019">if</span>&nbsp;<span class="ident" id="2510022">f</span>&nbsp;<span class="op" id="2510024">==</span>&nbsp;<span class="ident" id="2510027">nil</span>&nbsp;<span class="op" id="2510031">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510035">return</span>&nbsp;<span class="op" id="2510042">^</span><span class="op" id="2510043">(</span><span class="builtintype" id="2510044">uintptr</span><span class="op" id="2510051">(</span><span class="num" id="2510052">0</span><span class="op" id="2510053">)</span><span class="op" id="2510054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2510057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510060">return</span>&nbsp;<span class="builtintype" id="2510067">uintptr</span><span class="op" id="2510074">(</span><span class="ident" id="2510075">f</span><span class="op" id="2510076">.</span><span class="ident" id="2510077">fd</span><span class="op" id="2510079">)</span><br>
<span class="lineno"></span><span class="op" id="2510081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2510084">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2510155">func</span>&nbsp;<span class="ident" id="2510160">NewFile</span><span class="op" id="2510167">(</span><span class="ident" id="2510168">fd</span>&nbsp;<span class="builtintype" id="2510171">uintptr</span><span class="op" id="2510178">,</span>&nbsp;<span class="ident" id="2510180">name</span>&nbsp;<span class="builtintype" id="2510185">string</span><span class="op" id="2510191">)</span>&nbsp;<span class="op" id="2510193">*</span><span class="ident" id="2510194">File</span>&nbsp;<span class="op" id="2510199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510202">fdi</span>&nbsp;<span class="op" id="2510206">:=</span>&nbsp;<span class="builtintype" id="2510209">int</span><span class="op" id="2510212">(</span><span class="ident" id="2510213">fd</span><span class="op" id="2510215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510218">if</span>&nbsp;<span class="ident" id="2510221">fdi</span>&nbsp;<span class="op" id="2510225">&lt;</span>&nbsp;<span class="num" id="2510227">0</span>&nbsp;<span class="op" id="2510229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510233">return</span>&nbsp;<span class="ident" id="2510240">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2510245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510248">f</span>&nbsp;<span class="op" id="2510250">:=</span>&nbsp;<span class="op" id="2510253">&amp;</span><span class="ident" id="2510254">File</span><span class="op" id="2510258">{</span><span class="op" id="2510259">&amp;</span><span class="ident" id="2510260">file</span><span class="op" id="2510264">{</span><span class="ident" id="2510265">fd</span><span class="op" id="2510267">:</span>&nbsp;<span class="ident" id="2510269">fdi</span><span class="op" id="2510272">,</span>&nbsp;<span class="ident" id="2510274">name</span><span class="op" id="2510278">:</span>&nbsp;<span class="ident" id="2510280">name</span><span class="op" id="2510284">}</span><span class="op" id="2510285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510288">runtime</span><span class="op" id="2510295">.</span><span class="ident" id="2510296">SetFinalizer</span><span class="op" id="2510308">(</span><span class="ident" id="2510309">f</span><span class="op" id="2510310">.</span><span class="ident" id="2510311">file</span><span class="op" id="2510315">,</span>&nbsp;<span class="op" id="2510317">(</span><span class="op" id="2510318">*</span><span class="ident" id="2510319">file</span><span class="op" id="2510323">)</span><span class="op" id="2510324">.</span><span class="builtinfunc" id="2510325">close</span><span class="op" id="2510330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510333">return</span>&nbsp;<span class="ident" id="2510340">f</span><br>
<span class="lineno"></span><span class="op" id="2510342">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2510345">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2510404">type</span>&nbsp;<span class="ident" id="2510409">dirInfo</span>&nbsp;<span class="keyword" id="2510417">struct</span>&nbsp;<span class="op" id="2510424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510427">buf</span>&nbsp;&nbsp;<span class="op" id="2510432">[</span><span class="op" id="2510433">]</span><span class="builtintype" id="2510434">byte</span>&nbsp;<span class="comment" id="2510439">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510468">nbuf</span>&nbsp;<span class="builtintype" id="2510473">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2510480">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510531">bufp</span>&nbsp;<span class="builtintype" id="2510536">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2510543">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2510578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2510581">func</span>&nbsp;<span class="ident" id="2510586">epipecheck</span><span class="op" id="2510596">(</span><span class="ident" id="2510597">file</span>&nbsp;<span class="op" id="2510602">*</span><span class="ident" id="2510603">File</span><span class="op" id="2510607">,</span>&nbsp;<span class="ident" id="2510609">e</span>&nbsp;<span class="builtintype" id="2510611">error</span><span class="op" id="2510616">)</span>&nbsp;<span class="op" id="2510618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510621">if</span>&nbsp;<span class="ident" id="2510624">e</span>&nbsp;<span class="op" id="2510626">==</span>&nbsp;<span class="ident" id="2510629">syscall</span><span class="op" id="2510636">.</span><span class="ident" id="2510637">EPIPE</span>&nbsp;<span class="op" id="2510643">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2510647">if</span>&nbsp;<span class="ident" id="2510650">atomic</span><span class="op" id="2510656">.</span><span class="ident" id="2510657">AddInt32</span><span class="op" id="2510665">(</span><span class="op" id="2510666">&amp;</span><span class="ident" id="2510667">file</span><span class="op" id="2510671">.</span><span class="ident" id="2510672">nepipe</span><span class="op" id="2510678">,</span>&nbsp;<span class="num" id="2510680">1</span><span class="op" id="2510681">)</span>&nbsp;<span class="op" id="2510683">&gt;=</span>&nbsp;<span class="num" id="2510686">10</span>&nbsp;<span class="op" id="2510689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510694">sigpipe</span><span class="op" id="2510701">(</span><span class="op" id="2510702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2510706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2510709">}</span>&nbsp;<span class="keyword" id="2510711">else</span>&nbsp;<span class="op" id="2510716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2510720">atomic</span><span class="op" id="2510726">.</span><span class="ident" id="2510727">StoreInt32</span><span class="op" id="2510737">(</span><span class="op" id="2510738">&amp;</span><span class="ident" id="2510739">file</span><span class="op" id="2510743">.</span><span class="ident" id="2510744">nepipe</span><span class="op" id="2510750">,</span>&nbsp;<span class="num" id="2510752">0</span><span class="op" id="2510753">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2510756">}</span><br>
<span class="lineno"></span><span class="op" id="2510758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2510761">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2510827">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2510890">const</span>&nbsp;<span class="ident" id="2510896">DevNull</span>&nbsp;<span class="op" id="2510904">=</span>&nbsp;<span class="string" id="2510906">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2510919">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2510986">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2511053">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2511125">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2511178">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2511234">func</span>&nbsp;<span class="ident" id="2511239">OpenFile</span><span class="op" id="2511247">(</span><span class="ident" id="2511248">name</span>&nbsp;<span class="builtintype" id="2511253">string</span><span class="op" id="2511259">,</span>&nbsp;<span class="ident" id="2511261">flag</span>&nbsp;<span class="builtintype" id="2511266">int</span><span class="op" id="2511269">,</span>&nbsp;<span class="ident" id="2511271">perm</span>&nbsp;<span class="ident" id="2511276">FileMode</span><span class="op" id="2511284">)</span>&nbsp;<span class="op" id="2511286">(</span><span class="ident" id="2511287">file</span>&nbsp;<span class="op" id="2511292">*</span><span class="ident" id="2511293">File</span><span class="op" id="2511297">,</span>&nbsp;<span class="ident" id="2511299">err</span>&nbsp;<span class="builtintype" id="2511303">error</span><span class="op" id="2511308">)</span>&nbsp;<span class="op" id="2511310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2511313">r</span><span class="op" id="2511314">,</span>&nbsp;<span class="ident" id="2511316">e</span>&nbsp;<span class="op" id="2511318">:=</span>&nbsp;<span class="ident" id="2511321">syscall</span><span class="op" id="2511328">.</span><span class="ident" id="2511329">Open</span><span class="op" id="2511333">(</span><span class="ident" id="2511334">name</span><span class="op" id="2511338">,</span>&nbsp;<span class="ident" id="2511340">flag</span><span class="op" id="2511344">|</span><span class="ident" id="2511345">syscall</span><span class="op" id="2511352">.</span><span class="ident" id="2511353">O_CLOEXEC</span><span class="op" id="2511362">,</span>&nbsp;<span class="ident" id="2511364">syscallMode</span><span class="op" id="2511375">(</span><span class="ident" id="2511376">perm</span><span class="op" id="2511380">)</span><span class="op" id="2511381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511384">if</span>&nbsp;<span class="ident" id="2511387">e</span>&nbsp;<span class="op" id="2511389">!=</span>&nbsp;<span class="ident" id="2511392">nil</span>&nbsp;<span class="op" id="2511396">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511400">return</span>&nbsp;<span class="ident" id="2511407">nil</span><span class="op" id="2511410">,</span>&nbsp;<span class="op" id="2511412">&amp;</span><span class="ident" id="2511413">PathError</span><span class="op" id="2511422">{</span><span class="string" id="2511423">&#34;open&#34;</span><span class="op" id="2511429">,</span>&nbsp;<span class="ident" id="2511431">name</span><span class="op" id="2511435">,</span>&nbsp;<span class="ident" id="2511437">e</span><span class="op" id="2511438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2511441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2511445">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2511498">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511554">if</span>&nbsp;<span class="op" id="2511557">!</span><span class="ident" id="2511558">supportsCloseOnExec</span>&nbsp;<span class="op" id="2511578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2511582">syscall</span><span class="op" id="2511589">.</span><span class="ident" id="2511590">CloseOnExec</span><span class="op" id="2511601">(</span><span class="ident" id="2511602">r</span><span class="op" id="2511603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2511606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511610">return</span>&nbsp;<span class="ident" id="2511617">NewFile</span><span class="op" id="2511624">(</span><span class="builtintype" id="2511625">uintptr</span><span class="op" id="2511632">(</span><span class="ident" id="2511633">r</span><span class="op" id="2511634">)</span><span class="op" id="2511635">,</span>&nbsp;<span class="ident" id="2511637">name</span><span class="op" id="2511641">)</span><span class="op" id="2511642">,</span>&nbsp;<span class="ident" id="2511644">nil</span><br>
<span class="lineno">90</span><span class="op" id="2511648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2511651">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2511708">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2511740">func</span>&nbsp;<span class="op" id="2511745">(</span><span class="ident" id="2511746">f</span>&nbsp;<span class="op" id="2511748">*</span><span class="ident" id="2511749">File</span><span class="op" id="2511753">)</span>&nbsp;<span class="ident" id="2511755">Close</span><span class="op" id="2511760">(</span><span class="op" id="2511761">)</span>&nbsp;<span class="builtintype" id="2511763">error</span>&nbsp;<span class="op" id="2511769">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511772">if</span>&nbsp;<span class="ident" id="2511775">f</span>&nbsp;<span class="op" id="2511777">==</span>&nbsp;<span class="ident" id="2511780">nil</span>&nbsp;<span class="op" id="2511784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511788">return</span>&nbsp;<span class="ident" id="2511795">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2511807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511810">return</span>&nbsp;<span class="ident" id="2511817">f</span><span class="op" id="2511818">.</span><span class="ident" id="2511819">file</span><span class="op" id="2511823">.</span><span class="builtinfunc" id="2511824">close</span><span class="op" id="2511829">(</span><span class="op" id="2511830">)</span><br>
<span class="lineno"></span><span class="op" id="2511832">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2511835">func</span>&nbsp;<span class="op" id="2511840">(</span><span class="ident" id="2511841">file</span>&nbsp;<span class="op" id="2511846">*</span><span class="ident" id="2511847">file</span><span class="op" id="2511851">)</span>&nbsp;<span class="builtinfunc" id="2511853">close</span><span class="op" id="2511858">(</span><span class="op" id="2511859">)</span>&nbsp;<span class="builtintype" id="2511861">error</span>&nbsp;<span class="op" id="2511867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511870">if</span>&nbsp;<span class="ident" id="2511873">file</span>&nbsp;<span class="op" id="2511878">==</span>&nbsp;<span class="ident" id="2511881">nil</span>&nbsp;<span class="op" id="2511885">||</span>&nbsp;<span class="ident" id="2511888">file</span><span class="op" id="2511892">.</span><span class="ident" id="2511893">fd</span>&nbsp;<span class="op" id="2511896">&lt;</span>&nbsp;<span class="num" id="2511898">0</span>&nbsp;<span class="op" id="2511900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511904">return</span>&nbsp;<span class="ident" id="2511911">syscall</span><span class="op" id="2511918">.</span><span class="ident" id="2511919">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2511927">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511930">var</span>&nbsp;<span class="ident" id="2511934">err</span>&nbsp;<span class="builtintype" id="2511938">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2511945">if</span>&nbsp;<span class="ident" id="2511948">e</span>&nbsp;<span class="op" id="2511950">:=</span>&nbsp;<span class="ident" id="2511953">syscall</span><span class="op" id="2511960">.</span><span class="ident" id="2511961">Close</span><span class="op" id="2511966">(</span><span class="ident" id="2511967">file</span><span class="op" id="2511971">.</span><span class="ident" id="2511972">fd</span><span class="op" id="2511974">)</span><span class="op" id="2511975">;</span>&nbsp;<span class="ident" id="2511977">e</span>&nbsp;<span class="op" id="2511979">!=</span>&nbsp;<span class="ident" id="2511982">nil</span>&nbsp;<span class="op" id="2511986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2511990">err</span>&nbsp;<span class="op" id="2511994">=</span>&nbsp;<span class="op" id="2511996">&amp;</span><span class="ident" id="2511997">PathError</span><span class="op" id="2512006">{</span><span class="string" id="2512007">&#34;close&#34;</span><span class="op" id="2512014">,</span>&nbsp;<span class="ident" id="2512016">file</span><span class="op" id="2512020">.</span><span class="ident" id="2512021">name</span><span class="op" id="2512025">,</span>&nbsp;<span class="ident" id="2512027">e</span><span class="op" id="2512028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2512031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512034">file</span><span class="op" id="2512038">.</span><span class="ident" id="2512039">fd</span>&nbsp;<span class="op" id="2512042">=</span>&nbsp;<span class="op" id="2512044">-</span><span class="num" id="2512045">1</span>&nbsp;<span class="comment" id="2512047">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2512080">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512116">runtime</span><span class="op" id="2512123">.</span><span class="ident" id="2512124">SetFinalizer</span><span class="op" id="2512136">(</span><span class="ident" id="2512137">file</span><span class="op" id="2512141">,</span>&nbsp;<span class="ident" id="2512143">nil</span><span class="op" id="2512146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512149">return</span>&nbsp;<span class="ident" id="2512156">err</span><br>
<span class="lineno"></span><span class="op" id="2512160">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2512163">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2512219">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2512275">func</span>&nbsp;<span class="op" id="2512280">(</span><span class="ident" id="2512281">f</span>&nbsp;<span class="op" id="2512283">*</span><span class="ident" id="2512284">File</span><span class="op" id="2512288">)</span>&nbsp;<span class="ident" id="2512290">Stat</span><span class="op" id="2512294">(</span><span class="op" id="2512295">)</span>&nbsp;<span class="op" id="2512297">(</span><span class="ident" id="2512298">fi</span>&nbsp;<span class="ident" id="2512301">FileInfo</span><span class="op" id="2512309">,</span>&nbsp;<span class="ident" id="2512311">err</span>&nbsp;<span class="builtintype" id="2512315">error</span><span class="op" id="2512320">)</span>&nbsp;<span class="op" id="2512322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512325">if</span>&nbsp;<span class="ident" id="2512328">f</span>&nbsp;<span class="op" id="2512330">==</span>&nbsp;<span class="ident" id="2512333">nil</span>&nbsp;<span class="op" id="2512337">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512341">return</span>&nbsp;<span class="ident" id="2512348">nil</span><span class="op" id="2512351">,</span>&nbsp;<span class="ident" id="2512353">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2512365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512368">var</span>&nbsp;<span class="ident" id="2512372">stat</span>&nbsp;<span class="ident" id="2512377">syscall</span><span class="op" id="2512384">.</span><span class="ident" id="2512385">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512393">err</span>&nbsp;<span class="op" id="2512397">=</span>&nbsp;<span class="ident" id="2512399">syscall</span><span class="op" id="2512406">.</span><span class="ident" id="2512407">Fstat</span><span class="op" id="2512412">(</span><span class="ident" id="2512413">f</span><span class="op" id="2512414">.</span><span class="ident" id="2512415">fd</span><span class="op" id="2512417">,</span>&nbsp;<span class="op" id="2512419">&amp;</span><span class="ident" id="2512420">stat</span><span class="op" id="2512424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512427">if</span>&nbsp;<span class="ident" id="2512430">err</span>&nbsp;<span class="op" id="2512434">!=</span>&nbsp;<span class="ident" id="2512437">nil</span>&nbsp;<span class="op" id="2512441">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512445">return</span>&nbsp;<span class="ident" id="2512452">nil</span><span class="op" id="2512455">,</span>&nbsp;<span class="op" id="2512457">&amp;</span><span class="ident" id="2512458">PathError</span><span class="op" id="2512467">{</span><span class="string" id="2512468">&#34;stat&#34;</span><span class="op" id="2512474">,</span>&nbsp;<span class="ident" id="2512476">f</span><span class="op" id="2512477">.</span><span class="ident" id="2512478">name</span><span class="op" id="2512482">,</span>&nbsp;<span class="ident" id="2512484">err</span><span class="op" id="2512487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2512490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512493">return</span>&nbsp;<span class="ident" id="2512500">fileInfoFromStat</span><span class="op" id="2512516">(</span><span class="op" id="2512517">&amp;</span><span class="ident" id="2512518">stat</span><span class="op" id="2512522">,</span>&nbsp;<span class="ident" id="2512524">f</span><span class="op" id="2512525">.</span><span class="ident" id="2512526">name</span><span class="op" id="2512530">)</span><span class="op" id="2512531">,</span>&nbsp;<span class="ident" id="2512533">nil</span><br>
<span class="lineno"></span><span class="op" id="2512537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2512540">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2512594">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2512650">func</span>&nbsp;<span class="ident" id="2512655">Stat</span><span class="op" id="2512659">(</span><span class="ident" id="2512660">name</span>&nbsp;<span class="builtintype" id="2512665">string</span><span class="op" id="2512671">)</span>&nbsp;<span class="op" id="2512673">(</span><span class="ident" id="2512674">fi</span>&nbsp;<span class="ident" id="2512677">FileInfo</span><span class="op" id="2512685">,</span>&nbsp;<span class="ident" id="2512687">err</span>&nbsp;<span class="builtintype" id="2512691">error</span><span class="op" id="2512696">)</span>&nbsp;<span class="op" id="2512698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512701">var</span>&nbsp;<span class="ident" id="2512705">stat</span>&nbsp;<span class="ident" id="2512710">syscall</span><span class="op" id="2512717">.</span><span class="ident" id="2512718">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2512726">err</span>&nbsp;<span class="op" id="2512730">=</span>&nbsp;<span class="ident" id="2512732">syscall</span><span class="op" id="2512739">.</span><span class="ident" id="2512740">Stat</span><span class="op" id="2512744">(</span><span class="ident" id="2512745">name</span><span class="op" id="2512749">,</span>&nbsp;<span class="op" id="2512751">&amp;</span><span class="ident" id="2512752">stat</span><span class="op" id="2512756">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512759">if</span>&nbsp;<span class="ident" id="2512762">err</span>&nbsp;<span class="op" id="2512766">!=</span>&nbsp;<span class="ident" id="2512769">nil</span>&nbsp;<span class="op" id="2512773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512777">return</span>&nbsp;<span class="ident" id="2512784">nil</span><span class="op" id="2512787">,</span>&nbsp;<span class="op" id="2512789">&amp;</span><span class="ident" id="2512790">PathError</span><span class="op" id="2512799">{</span><span class="string" id="2512800">&#34;stat&#34;</span><span class="op" id="2512806">,</span>&nbsp;<span class="ident" id="2512808">name</span><span class="op" id="2512812">,</span>&nbsp;<span class="ident" id="2512814">err</span><span class="op" id="2512817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2512820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2512823">return</span>&nbsp;<span class="ident" id="2512830">fileInfoFromStat</span><span class="op" id="2512846">(</span><span class="op" id="2512847">&amp;</span><span class="ident" id="2512848">stat</span><span class="op" id="2512852">,</span>&nbsp;<span class="ident" id="2512854">name</span><span class="op" id="2512858">)</span><span class="op" id="2512859">,</span>&nbsp;<span class="ident" id="2512861">nil</span><br>
<span class="lineno"></span><span class="op" id="2512865">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2512868">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2512923">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2512980">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2513056">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2513112">func</span>&nbsp;<span class="ident" id="2513117">Lstat</span><span class="op" id="2513122">(</span><span class="ident" id="2513123">name</span>&nbsp;<span class="builtintype" id="2513128">string</span><span class="op" id="2513134">)</span>&nbsp;<span class="op" id="2513136">(</span><span class="ident" id="2513137">fi</span>&nbsp;<span class="ident" id="2513140">FileInfo</span><span class="op" id="2513148">,</span>&nbsp;<span class="ident" id="2513150">err</span>&nbsp;<span class="builtintype" id="2513154">error</span><span class="op" id="2513159">)</span>&nbsp;<span class="op" id="2513161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513164">var</span>&nbsp;<span class="ident" id="2513168">stat</span>&nbsp;<span class="ident" id="2513173">syscall</span><span class="op" id="2513180">.</span><span class="ident" id="2513181">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513189">err</span>&nbsp;<span class="op" id="2513193">=</span>&nbsp;<span class="ident" id="2513195">syscall</span><span class="op" id="2513202">.</span><span class="ident" id="2513203">Lstat</span><span class="op" id="2513208">(</span><span class="ident" id="2513209">name</span><span class="op" id="2513213">,</span>&nbsp;<span class="op" id="2513215">&amp;</span><span class="ident" id="2513216">stat</span><span class="op" id="2513220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513223">if</span>&nbsp;<span class="ident" id="2513226">err</span>&nbsp;<span class="op" id="2513230">!=</span>&nbsp;<span class="ident" id="2513233">nil</span>&nbsp;<span class="op" id="2513237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513241">return</span>&nbsp;<span class="ident" id="2513248">nil</span><span class="op" id="2513251">,</span>&nbsp;<span class="op" id="2513253">&amp;</span><span class="ident" id="2513254">PathError</span><span class="op" id="2513263">{</span><span class="string" id="2513264">&#34;lstat&#34;</span><span class="op" id="2513271">,</span>&nbsp;<span class="ident" id="2513273">name</span><span class="op" id="2513277">,</span>&nbsp;<span class="ident" id="2513279">err</span><span class="op" id="2513282">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513288">return</span>&nbsp;<span class="ident" id="2513295">fileInfoFromStat</span><span class="op" id="2513311">(</span><span class="op" id="2513312">&amp;</span><span class="ident" id="2513313">stat</span><span class="op" id="2513317">,</span>&nbsp;<span class="ident" id="2513319">name</span><span class="op" id="2513323">)</span><span class="op" id="2513324">,</span>&nbsp;<span class="ident" id="2513326">nil</span><br>
<span class="lineno"></span><span class="op" id="2513330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2513333">func</span>&nbsp;<span class="op" id="2513338">(</span><span class="ident" id="2513339">f</span>&nbsp;<span class="op" id="2513341">*</span><span class="ident" id="2513342">File</span><span class="op" id="2513346">)</span>&nbsp;<span class="ident" id="2513348">readdir</span><span class="op" id="2513355">(</span><span class="ident" id="2513356">n</span>&nbsp;<span class="builtintype" id="2513358">int</span><span class="op" id="2513361">)</span>&nbsp;<span class="op" id="2513363">(</span><span class="ident" id="2513364">fi</span>&nbsp;<span class="op" id="2513367">[</span><span class="op" id="2513368">]</span><span class="ident" id="2513369">FileInfo</span><span class="op" id="2513377">,</span>&nbsp;<span class="ident" id="2513379">err</span>&nbsp;<span class="builtintype" id="2513383">error</span><span class="op" id="2513388">)</span>&nbsp;<span class="op" id="2513390">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513393">dirname</span>&nbsp;<span class="op" id="2513401">:=</span>&nbsp;<span class="ident" id="2513404">f</span><span class="op" id="2513405">.</span><span class="ident" id="2513406">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513412">if</span>&nbsp;<span class="ident" id="2513415">dirname</span>&nbsp;<span class="op" id="2513423">==</span>&nbsp;<span class="string" id="2513426">&#34;&#34;</span>&nbsp;<span class="op" id="2513429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513433">dirname</span>&nbsp;<span class="op" id="2513441">=</span>&nbsp;<span class="string" id="2513443">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513451">names</span><span class="op" id="2513456">,</span>&nbsp;<span class="ident" id="2513458">err</span>&nbsp;<span class="op" id="2513462">:=</span>&nbsp;<span class="ident" id="2513465">f</span><span class="op" id="2513466">.</span><span class="ident" id="2513467">Readdirnames</span><span class="op" id="2513479">(</span><span class="ident" id="2513480">n</span><span class="op" id="2513481">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513484">fi</span>&nbsp;<span class="op" id="2513487">=</span>&nbsp;<span class="builtinfunc" id="2513489">make</span><span class="op" id="2513493">(</span><span class="op" id="2513494">[</span><span class="op" id="2513495">]</span><span class="ident" id="2513496">FileInfo</span><span class="op" id="2513504">,</span>&nbsp;<span class="num" id="2513506">0</span><span class="op" id="2513507">,</span>&nbsp;<span class="builtinfunc" id="2513509">len</span><span class="op" id="2513512">(</span><span class="ident" id="2513513">names</span><span class="op" id="2513518">)</span><span class="op" id="2513519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513522">for</span>&nbsp;<span class="ident" id="2513526">_</span><span class="op" id="2513527">,</span>&nbsp;<span class="ident" id="2513529">filename</span>&nbsp;<span class="op" id="2513538">:=</span>&nbsp;<span class="keyword" id="2513541">range</span>&nbsp;<span class="ident" id="2513547">names</span>&nbsp;<span class="op" id="2513553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513557">fip</span><span class="op" id="2513560">,</span>&nbsp;<span class="ident" id="2513562">lerr</span>&nbsp;<span class="op" id="2513567">:=</span>&nbsp;<span class="ident" id="2513570">lstat</span><span class="op" id="2513575">(</span><span class="ident" id="2513576">dirname</span>&nbsp;<span class="op" id="2513584">+</span>&nbsp;<span class="string" id="2513586">&#34;/&#34;</span>&nbsp;<span class="op" id="2513590">+</span>&nbsp;<span class="ident" id="2513592">filename</span><span class="op" id="2513600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513604">if</span>&nbsp;<span class="ident" id="2513607">IsNotExist</span><span class="op" id="2513617">(</span><span class="ident" id="2513618">lerr</span><span class="op" id="2513622">)</span>&nbsp;<span class="op" id="2513624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513629">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2513676">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513719">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513734">if</span>&nbsp;<span class="ident" id="2513737">lerr</span>&nbsp;<span class="op" id="2513742">!=</span>&nbsp;<span class="ident" id="2513745">nil</span>&nbsp;<span class="op" id="2513749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513754">return</span>&nbsp;<span class="ident" id="2513761">fi</span><span class="op" id="2513763">,</span>&nbsp;<span class="ident" id="2513765">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2513776">fi</span>&nbsp;<span class="op" id="2513779">=</span>&nbsp;<span class="builtinfunc" id="2513781">append</span><span class="op" id="2513787">(</span><span class="ident" id="2513788">fi</span><span class="op" id="2513790">,</span>&nbsp;<span class="ident" id="2513792">fip</span><span class="op" id="2513795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2513798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2513801">return</span>&nbsp;<span class="ident" id="2513808">fi</span><span class="op" id="2513810">,</span>&nbsp;<span class="ident" id="2513812">err</span><br>
<span class="lineno"></span><span class="op" id="2513816">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2513819">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2513877">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2513931">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2513985">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2514003">const</span>&nbsp;<span class="op" id="2514009">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514012">needsMaxRW</span>&nbsp;<span class="op" id="2514023">=</span>&nbsp;<span class="ident" id="2514025">runtime</span><span class="op" id="2514032">.</span><span class="ident" id="2514033">GOOS</span>&nbsp;<span class="op" id="2514038">==</span>&nbsp;<span class="string" id="2514041">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2514050">||</span>&nbsp;<span class="ident" id="2514053">runtime</span><span class="op" id="2514060">.</span><span class="ident" id="2514061">GOOS</span>&nbsp;<span class="op" id="2514066">==</span>&nbsp;<span class="string" id="2514069">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514080">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514091">=</span>&nbsp;<span class="num" id="2514093">1</span>&nbsp;<span class="op" id="2514095">&lt;&lt;</span>&nbsp;<span class="num" id="2514098">30</span><br>
<span class="lineno"></span><span class="op" id="2514101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2514104">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2514152">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2514213">func</span>&nbsp;<span class="op" id="2514218">(</span><span class="ident" id="2514219">f</span>&nbsp;<span class="op" id="2514221">*</span><span class="ident" id="2514222">File</span><span class="op" id="2514226">)</span>&nbsp;<span class="ident" id="2514228">read</span><span class="op" id="2514232">(</span><span class="ident" id="2514233">b</span>&nbsp;<span class="op" id="2514235">[</span><span class="op" id="2514236">]</span><span class="builtintype" id="2514237">byte</span><span class="op" id="2514241">)</span>&nbsp;<span class="op" id="2514243">(</span><span class="ident" id="2514244">n</span>&nbsp;<span class="builtintype" id="2514246">int</span><span class="op" id="2514249">,</span>&nbsp;<span class="ident" id="2514251">err</span>&nbsp;<span class="builtintype" id="2514255">error</span><span class="op" id="2514260">)</span>&nbsp;<span class="op" id="2514262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514265">if</span>&nbsp;<span class="ident" id="2514268">needsMaxRW</span>&nbsp;<span class="op" id="2514279">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2514282">len</span><span class="op" id="2514285">(</span><span class="ident" id="2514286">b</span><span class="op" id="2514287">)</span>&nbsp;<span class="op" id="2514289">&gt;</span>&nbsp;<span class="ident" id="2514291">maxRW</span>&nbsp;<span class="op" id="2514297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514301">b</span>&nbsp;<span class="op" id="2514303">=</span>&nbsp;<span class="ident" id="2514305">b</span><span class="op" id="2514306">[</span><span class="op" id="2514307">:</span><span class="ident" id="2514308">maxRW</span><span class="op" id="2514313">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514319">return</span>&nbsp;<span class="ident" id="2514326">fixCount</span><span class="op" id="2514334">(</span><span class="ident" id="2514335">syscall</span><span class="op" id="2514342">.</span><span class="ident" id="2514343">Read</span><span class="op" id="2514347">(</span><span class="ident" id="2514348">f</span><span class="op" id="2514349">.</span><span class="ident" id="2514350">fd</span><span class="op" id="2514352">,</span>&nbsp;<span class="ident" id="2514354">b</span><span class="op" id="2514355">)</span><span class="op" id="2514356">)</span><br>
<span class="lineno"></span><span class="op" id="2514358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2514361">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2514432">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2514494">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2514550">func</span>&nbsp;<span class="op" id="2514555">(</span><span class="ident" id="2514556">f</span>&nbsp;<span class="op" id="2514558">*</span><span class="ident" id="2514559">File</span><span class="op" id="2514563">)</span>&nbsp;<span class="ident" id="2514565">pread</span><span class="op" id="2514570">(</span><span class="ident" id="2514571">b</span>&nbsp;<span class="op" id="2514573">[</span><span class="op" id="2514574">]</span><span class="builtintype" id="2514575">byte</span><span class="op" id="2514579">,</span>&nbsp;<span class="ident" id="2514581">off</span>&nbsp;<span class="ident" id="2514585">int64</span><span class="op" id="2514590">)</span>&nbsp;<span class="op" id="2514592">(</span><span class="ident" id="2514593">n</span>&nbsp;<span class="builtintype" id="2514595">int</span><span class="op" id="2514598">,</span>&nbsp;<span class="ident" id="2514600">err</span>&nbsp;<span class="builtintype" id="2514604">error</span><span class="op" id="2514609">)</span>&nbsp;<span class="op" id="2514611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514614">if</span>&nbsp;<span class="ident" id="2514617">needsMaxRW</span>&nbsp;<span class="op" id="2514628">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2514631">len</span><span class="op" id="2514634">(</span><span class="ident" id="2514635">b</span><span class="op" id="2514636">)</span>&nbsp;<span class="op" id="2514638">&gt;</span>&nbsp;<span class="ident" id="2514640">maxRW</span>&nbsp;<span class="op" id="2514646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514650">b</span>&nbsp;<span class="op" id="2514652">=</span>&nbsp;<span class="ident" id="2514654">b</span><span class="op" id="2514655">[</span><span class="op" id="2514656">:</span><span class="ident" id="2514657">maxRW</span><span class="op" id="2514662">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514668">return</span>&nbsp;<span class="ident" id="2514675">fixCount</span><span class="op" id="2514683">(</span><span class="ident" id="2514684">syscall</span><span class="op" id="2514691">.</span><span class="ident" id="2514692">Pread</span><span class="op" id="2514697">(</span><span class="ident" id="2514698">f</span><span class="op" id="2514699">.</span><span class="ident" id="2514700">fd</span><span class="op" id="2514702">,</span>&nbsp;<span class="ident" id="2514704">b</span><span class="op" id="2514705">,</span>&nbsp;<span class="ident" id="2514707">off</span><span class="op" id="2514710">)</span><span class="op" id="2514711">)</span><br>
<span class="lineno"></span><span class="op" id="2514713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2514716">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2514758">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2514822">func</span>&nbsp;<span class="op" id="2514827">(</span><span class="ident" id="2514828">f</span>&nbsp;<span class="op" id="2514830">*</span><span class="ident" id="2514831">File</span><span class="op" id="2514835">)</span>&nbsp;<span class="ident" id="2514837">write</span><span class="op" id="2514842">(</span><span class="ident" id="2514843">b</span>&nbsp;<span class="op" id="2514845">[</span><span class="op" id="2514846">]</span><span class="builtintype" id="2514847">byte</span><span class="op" id="2514851">)</span>&nbsp;<span class="op" id="2514853">(</span><span class="ident" id="2514854">n</span>&nbsp;<span class="builtintype" id="2514856">int</span><span class="op" id="2514859">,</span>&nbsp;<span class="ident" id="2514861">err</span>&nbsp;<span class="builtintype" id="2514865">error</span><span class="op" id="2514870">)</span>&nbsp;<span class="op" id="2514872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514875">for</span>&nbsp;<span class="op" id="2514879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514883">bcap</span>&nbsp;<span class="op" id="2514888">:=</span>&nbsp;<span class="ident" id="2514891">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2514895">if</span>&nbsp;<span class="ident" id="2514898">needsMaxRW</span>&nbsp;<span class="op" id="2514909">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2514912">len</span><span class="op" id="2514915">(</span><span class="ident" id="2514916">bcap</span><span class="op" id="2514920">)</span>&nbsp;<span class="op" id="2514922">&gt;</span>&nbsp;<span class="ident" id="2514924">maxRW</span>&nbsp;<span class="op" id="2514930">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514935">bcap</span>&nbsp;<span class="op" id="2514940">=</span>&nbsp;<span class="ident" id="2514942">bcap</span><span class="op" id="2514946">[</span><span class="op" id="2514947">:</span><span class="ident" id="2514948">maxRW</span><span class="op" id="2514953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2514957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2514961">m</span><span class="op" id="2514962">,</span>&nbsp;<span class="ident" id="2514964">err</span>&nbsp;<span class="op" id="2514968">:=</span>&nbsp;<span class="ident" id="2514971">fixCount</span><span class="op" id="2514979">(</span><span class="ident" id="2514980">syscall</span><span class="op" id="2514987">.</span><span class="ident" id="2514988">Write</span><span class="op" id="2514993">(</span><span class="ident" id="2514994">f</span><span class="op" id="2514995">.</span><span class="ident" id="2514996">fd</span><span class="op" id="2514998">,</span>&nbsp;<span class="ident" id="2515000">bcap</span><span class="op" id="2515004">)</span><span class="op" id="2515005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2515009">n</span>&nbsp;<span class="op" id="2515011">+=</span>&nbsp;<span class="ident" id="2515014">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2515019">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2515081">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2515141">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515207">if</span>&nbsp;<span class="num" id="2515210">0</span>&nbsp;<span class="op" id="2515212">&lt;</span>&nbsp;<span class="ident" id="2515214">m</span>&nbsp;<span class="op" id="2515216">&amp;&amp;</span>&nbsp;<span class="ident" id="2515219">m</span>&nbsp;<span class="op" id="2515221">&lt;</span>&nbsp;<span class="builtinfunc" id="2515223">len</span><span class="op" id="2515226">(</span><span class="ident" id="2515227">bcap</span><span class="op" id="2515231">)</span>&nbsp;<span class="op" id="2515233">||</span>&nbsp;<span class="ident" id="2515236">err</span>&nbsp;<span class="op" id="2515240">==</span>&nbsp;<span class="ident" id="2515243">syscall</span><span class="op" id="2515250">.</span><span class="ident" id="2515251">EINTR</span>&nbsp;<span class="op" id="2515257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2515262">b</span>&nbsp;<span class="op" id="2515264">=</span>&nbsp;<span class="ident" id="2515266">b</span><span class="op" id="2515267">[</span><span class="ident" id="2515268">m</span><span class="op" id="2515269">:</span><span class="op" id="2515270">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515275">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2515286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515291">if</span>&nbsp;<span class="ident" id="2515294">needsMaxRW</span>&nbsp;<span class="op" id="2515305">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2515308">len</span><span class="op" id="2515311">(</span><span class="ident" id="2515312">bcap</span><span class="op" id="2515316">)</span>&nbsp;<span class="op" id="2515318">!=</span>&nbsp;<span class="builtinfunc" id="2515321">len</span><span class="op" id="2515324">(</span><span class="ident" id="2515325">b</span><span class="op" id="2515326">)</span>&nbsp;<span class="op" id="2515328">&amp;&amp;</span>&nbsp;<span class="ident" id="2515331">err</span>&nbsp;<span class="op" id="2515335">==</span>&nbsp;<span class="ident" id="2515338">nil</span>&nbsp;<span class="op" id="2515342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2515347">b</span>&nbsp;<span class="op" id="2515349">=</span>&nbsp;<span class="ident" id="2515351">b</span><span class="op" id="2515352">[</span><span class="ident" id="2515353">m</span><span class="op" id="2515354">:</span><span class="op" id="2515355">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515360">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2515371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515376">return</span>&nbsp;<span class="ident" id="2515383">n</span><span class="op" id="2515384">,</span>&nbsp;<span class="ident" id="2515386">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2515391">}</span><br>
<span class="lineno">230</span><span class="op" id="2515393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2515396">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2515467">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2515531">func</span>&nbsp;<span class="op" id="2515536">(</span><span class="ident" id="2515537">f</span>&nbsp;<span class="op" id="2515539">*</span><span class="ident" id="2515540">File</span><span class="op" id="2515544">)</span>&nbsp;<span class="ident" id="2515546">pwrite</span><span class="op" id="2515552">(</span><span class="ident" id="2515553">b</span>&nbsp;<span class="op" id="2515555">[</span><span class="op" id="2515556">]</span><span class="builtintype" id="2515557">byte</span><span class="op" id="2515561">,</span>&nbsp;<span class="ident" id="2515563">off</span>&nbsp;<span class="ident" id="2515567">int64</span><span class="op" id="2515572">)</span>&nbsp;<span class="op" id="2515574">(</span><span class="ident" id="2515575">n</span>&nbsp;<span class="builtintype" id="2515577">int</span><span class="op" id="2515580">,</span>&nbsp;<span class="ident" id="2515582">err</span>&nbsp;<span class="builtintype" id="2515586">error</span><span class="op" id="2515591">)</span>&nbsp;<span class="op" id="2515593">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515596">if</span>&nbsp;<span class="ident" id="2515599">needsMaxRW</span>&nbsp;<span class="op" id="2515610">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2515613">len</span><span class="op" id="2515616">(</span><span class="ident" id="2515617">b</span><span class="op" id="2515618">)</span>&nbsp;<span class="op" id="2515620">&gt;</span>&nbsp;<span class="ident" id="2515622">maxRW</span>&nbsp;<span class="op" id="2515628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2515632">b</span>&nbsp;<span class="op" id="2515634">=</span>&nbsp;<span class="ident" id="2515636">b</span><span class="op" id="2515637">[</span><span class="op" id="2515638">:</span><span class="ident" id="2515639">maxRW</span><span class="op" id="2515644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2515647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2515650">return</span>&nbsp;<span class="ident" id="2515657">fixCount</span><span class="op" id="2515665">(</span><span class="ident" id="2515666">syscall</span><span class="op" id="2515673">.</span><span class="ident" id="2515674">Pwrite</span><span class="op" id="2515680">(</span><span class="ident" id="2515681">f</span><span class="op" id="2515682">.</span><span class="ident" id="2515683">fd</span><span class="op" id="2515685">,</span>&nbsp;<span class="ident" id="2515687">b</span><span class="op" id="2515688">,</span>&nbsp;<span class="ident" id="2515690">off</span><span class="op" id="2515693">)</span><span class="op" id="2515694">)</span><br>
<span class="lineno"></span><span class="op" id="2515696">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2515699">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2515781">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2515857">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2515925">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2515976">func</span>&nbsp;<span class="op" id="2515981">(</span><span class="ident" id="2515982">f</span>&nbsp;<span class="op" id="2515984">*</span><span class="ident" id="2515985">File</span><span class="op" id="2515989">)</span>&nbsp;<span class="ident" id="2515991">seek</span><span class="op" id="2515995">(</span><span class="ident" id="2515996">offset</span>&nbsp;<span class="ident" id="2516003">int64</span><span class="op" id="2516008">,</span>&nbsp;<span class="ident" id="2516010">whence</span>&nbsp;<span class="builtintype" id="2516017">int</span><span class="op" id="2516020">)</span>&nbsp;<span class="op" id="2516022">(</span><span class="ident" id="2516023">ret</span>&nbsp;<span class="ident" id="2516027">int64</span><span class="op" id="2516032">,</span>&nbsp;<span class="ident" id="2516034">err</span>&nbsp;<span class="builtintype" id="2516038">error</span><span class="op" id="2516043">)</span>&nbsp;<span class="op" id="2516045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516048">return</span>&nbsp;<span class="ident" id="2516055">syscall</span><span class="op" id="2516062">.</span><span class="ident" id="2516063">Seek</span><span class="op" id="2516067">(</span><span class="ident" id="2516068">f</span><span class="op" id="2516069">.</span><span class="ident" id="2516070">fd</span><span class="op" id="2516072">,</span>&nbsp;<span class="ident" id="2516074">offset</span><span class="op" id="2516080">,</span>&nbsp;<span class="ident" id="2516082">whence</span><span class="op" id="2516088">)</span><br>
<span class="lineno"></span><span class="op" id="2516090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2516093">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2516141">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2516218">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2516274">func</span>&nbsp;<span class="ident" id="2516279">Truncate</span><span class="op" id="2516287">(</span><span class="ident" id="2516288">name</span>&nbsp;<span class="builtintype" id="2516293">string</span><span class="op" id="2516299">,</span>&nbsp;<span class="ident" id="2516301">size</span>&nbsp;<span class="ident" id="2516306">int64</span><span class="op" id="2516311">)</span>&nbsp;<span class="builtintype" id="2516313">error</span>&nbsp;<span class="op" id="2516319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516322">if</span>&nbsp;<span class="ident" id="2516325">e</span>&nbsp;<span class="op" id="2516327">:=</span>&nbsp;<span class="ident" id="2516330">syscall</span><span class="op" id="2516337">.</span><span class="ident" id="2516338">Truncate</span><span class="op" id="2516346">(</span><span class="ident" id="2516347">name</span><span class="op" id="2516351">,</span>&nbsp;<span class="ident" id="2516353">size</span><span class="op" id="2516357">)</span><span class="op" id="2516358">;</span>&nbsp;<span class="ident" id="2516360">e</span>&nbsp;<span class="op" id="2516362">!=</span>&nbsp;<span class="ident" id="2516365">nil</span>&nbsp;<span class="op" id="2516369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516373">return</span>&nbsp;<span class="op" id="2516380">&amp;</span><span class="ident" id="2516381">PathError</span><span class="op" id="2516390">{</span><span class="string" id="2516391">&#34;truncate&#34;</span><span class="op" id="2516401">,</span>&nbsp;<span class="ident" id="2516403">name</span><span class="op" id="2516407">,</span>&nbsp;<span class="ident" id="2516409">e</span><span class="op" id="2516410">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2516413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516416">return</span>&nbsp;<span class="ident" id="2516423">nil</span><br>
<span class="lineno"></span><span class="op" id="2516427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2516430">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2516477">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2516533">func</span>&nbsp;<span class="ident" id="2516538">Remove</span><span class="op" id="2516544">(</span><span class="ident" id="2516545">name</span>&nbsp;<span class="builtintype" id="2516550">string</span><span class="op" id="2516556">)</span>&nbsp;<span class="builtintype" id="2516558">error</span>&nbsp;<span class="op" id="2516564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516567">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516611">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516652">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516696">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2516733">e</span>&nbsp;<span class="op" id="2516735">:=</span>&nbsp;<span class="ident" id="2516738">syscall</span><span class="op" id="2516745">.</span><span class="ident" id="2516746">Unlink</span><span class="op" id="2516752">(</span><span class="ident" id="2516753">name</span><span class="op" id="2516757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516760">if</span>&nbsp;<span class="ident" id="2516763">e</span>&nbsp;<span class="op" id="2516765">==</span>&nbsp;<span class="ident" id="2516768">nil</span>&nbsp;<span class="op" id="2516772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516776">return</span>&nbsp;<span class="ident" id="2516783">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2516788">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2516791">e1</span>&nbsp;<span class="op" id="2516794">:=</span>&nbsp;<span class="ident" id="2516797">syscall</span><span class="op" id="2516804">.</span><span class="ident" id="2516805">Rmdir</span><span class="op" id="2516810">(</span><span class="ident" id="2516811">name</span><span class="op" id="2516815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516818">if</span>&nbsp;<span class="ident" id="2516821">e1</span>&nbsp;<span class="op" id="2516824">==</span>&nbsp;<span class="ident" id="2516827">nil</span>&nbsp;<span class="op" id="2516831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2516835">return</span>&nbsp;<span class="ident" id="2516842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2516847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516851">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516902">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2516951">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517000">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517049">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517103">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517154">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517209">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517258">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517289">if</span>&nbsp;<span class="ident" id="2517292">e1</span>&nbsp;<span class="op" id="2517295">!=</span>&nbsp;<span class="ident" id="2517298">syscall</span><span class="op" id="2517305">.</span><span class="ident" id="2517306">ENOTDIR</span>&nbsp;<span class="op" id="2517314">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517318">e</span>&nbsp;<span class="op" id="2517320">=</span>&nbsp;<span class="ident" id="2517322">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517329">return</span>&nbsp;<span class="op" id="2517336">&amp;</span><span class="ident" id="2517337">PathError</span><span class="op" id="2517346">{</span><span class="string" id="2517347">&#34;remove&#34;</span><span class="op" id="2517355">,</span>&nbsp;<span class="ident" id="2517357">name</span><span class="op" id="2517361">,</span>&nbsp;<span class="ident" id="2517363">e</span><span class="op" id="2517364">}</span><br>
<span class="lineno"></span><span class="op" id="2517366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2517369">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2517452">func</span>&nbsp;<span class="ident" id="2517457">basename</span><span class="op" id="2517465">(</span><span class="ident" id="2517466">name</span>&nbsp;<span class="builtintype" id="2517471">string</span><span class="op" id="2517477">)</span>&nbsp;<span class="builtintype" id="2517479">string</span>&nbsp;<span class="op" id="2517486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517489">i</span>&nbsp;<span class="op" id="2517491">:=</span>&nbsp;<span class="builtinfunc" id="2517494">len</span><span class="op" id="2517497">(</span><span class="ident" id="2517498">name</span><span class="op" id="2517502">)</span>&nbsp;<span class="op" id="2517504">-</span>&nbsp;<span class="num" id="2517506">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517509">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517537">for</span>&nbsp;<span class="op" id="2517541">;</span>&nbsp;<span class="ident" id="2517543">i</span>&nbsp;<span class="op" id="2517545">&gt;</span>&nbsp;<span class="num" id="2517547">0</span>&nbsp;<span class="op" id="2517549">&amp;&amp;</span>&nbsp;<span class="ident" id="2517552">name</span><span class="op" id="2517556">[</span><span class="ident" id="2517557">i</span><span class="op" id="2517558">]</span>&nbsp;<span class="op" id="2517560">==</span>&nbsp;<span class="string" id="2517563">&#39;/&#39;</span><span class="op" id="2517566">;</span>&nbsp;<span class="ident" id="2517568">i</span><span class="op" id="2517569">--</span>&nbsp;<span class="op" id="2517572">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517576">name</span>&nbsp;<span class="op" id="2517581">=</span>&nbsp;<span class="ident" id="2517583">name</span><span class="op" id="2517587">[</span><span class="op" id="2517588">:</span><span class="ident" id="2517589">i</span><span class="op" id="2517590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2517596">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517630">for</span>&nbsp;<span class="ident" id="2517634">i</span><span class="op" id="2517635">--</span><span class="op" id="2517637">;</span>&nbsp;<span class="ident" id="2517639">i</span>&nbsp;<span class="op" id="2517641">&gt;=</span>&nbsp;<span class="num" id="2517644">0</span><span class="op" id="2517645">;</span>&nbsp;<span class="ident" id="2517647">i</span><span class="op" id="2517648">--</span>&nbsp;<span class="op" id="2517651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517655">if</span>&nbsp;<span class="ident" id="2517658">name</span><span class="op" id="2517662">[</span><span class="ident" id="2517663">i</span><span class="op" id="2517664">]</span>&nbsp;<span class="op" id="2517666">==</span>&nbsp;<span class="string" id="2517669">&#39;/&#39;</span>&nbsp;<span class="op" id="2517673">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517678">name</span>&nbsp;<span class="op" id="2517683">=</span>&nbsp;<span class="ident" id="2517685">name</span><span class="op" id="2517689">[</span><span class="ident" id="2517690">i</span><span class="op" id="2517691">+</span><span class="num" id="2517692">1</span><span class="op" id="2517693">:</span><span class="op" id="2517694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517699">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517714">return</span>&nbsp;<span class="ident" id="2517721">name</span><br>
<span class="lineno"></span><span class="op" id="2517726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2517729">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2517798">func</span>&nbsp;<span class="ident" id="2517803">TempDir</span><span class="op" id="2517810">(</span><span class="op" id="2517811">)</span>&nbsp;<span class="builtintype" id="2517813">string</span>&nbsp;<span class="op" id="2517820">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517823">dir</span>&nbsp;<span class="op" id="2517827">:=</span>&nbsp;<span class="ident" id="2517830">Getenv</span><span class="op" id="2517836">(</span><span class="string" id="2517837">&#34;TMPDIR&#34;</span><span class="op" id="2517845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517848">if</span>&nbsp;<span class="ident" id="2517851">dir</span>&nbsp;<span class="op" id="2517855">==</span>&nbsp;<span class="string" id="2517858">&#34;&#34;</span>&nbsp;<span class="op" id="2517861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517865">if</span>&nbsp;<span class="ident" id="2517868">runtime</span><span class="op" id="2517875">.</span><span class="ident" id="2517876">GOOS</span>&nbsp;<span class="op" id="2517881">==</span>&nbsp;<span class="string" id="2517884">&#34;android&#34;</span>&nbsp;<span class="op" id="2517894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517899">dir</span>&nbsp;<span class="op" id="2517903">=</span>&nbsp;<span class="string" id="2517905">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517925">}</span>&nbsp;<span class="keyword" id="2517927">else</span>&nbsp;<span class="op" id="2517932">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2517937">dir</span>&nbsp;<span class="op" id="2517941">=</span>&nbsp;<span class="string" id="2517943">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2517955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2517958">return</span>&nbsp;<span class="ident" id="2517965">dir</span><br>
<span class="lineno"></span><span class="op" id="2517969">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2517972">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2518032">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2518088">func</span>&nbsp;<span class="ident" id="2518093">Link</span><span class="op" id="2518097">(</span><span class="ident" id="2518098">oldname</span><span class="op" id="2518105">,</span>&nbsp;<span class="ident" id="2518107">newname</span>&nbsp;<span class="builtintype" id="2518115">string</span><span class="op" id="2518121">)</span>&nbsp;<span class="builtintype" id="2518123">error</span>&nbsp;<span class="op" id="2518129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2518132">e</span>&nbsp;<span class="op" id="2518134">:=</span>&nbsp;<span class="ident" id="2518137">syscall</span><span class="op" id="2518144">.</span><span class="ident" id="2518145">Link</span><span class="op" id="2518149">(</span><span class="ident" id="2518150">oldname</span><span class="op" id="2518157">,</span>&nbsp;<span class="ident" id="2518159">newname</span><span class="op" id="2518166">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518169">if</span>&nbsp;<span class="ident" id="2518172">e</span>&nbsp;<span class="op" id="2518174">!=</span>&nbsp;<span class="ident" id="2518177">nil</span>&nbsp;<span class="op" id="2518181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518185">return</span>&nbsp;<span class="op" id="2518192">&amp;</span><span class="ident" id="2518193">LinkError</span><span class="op" id="2518202">{</span><span class="string" id="2518203">&#34;link&#34;</span><span class="op" id="2518209">,</span>&nbsp;<span class="ident" id="2518211">oldname</span><span class="op" id="2518218">,</span>&nbsp;<span class="ident" id="2518220">newname</span><span class="op" id="2518227">,</span>&nbsp;<span class="ident" id="2518229">e</span><span class="op" id="2518230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2518233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518236">return</span>&nbsp;<span class="ident" id="2518243">nil</span><br>
<span class="lineno"></span><span class="op" id="2518247">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2518250">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2518308">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2518364">func</span>&nbsp;<span class="ident" id="2518369">Symlink</span><span class="op" id="2518376">(</span><span class="ident" id="2518377">oldname</span><span class="op" id="2518384">,</span>&nbsp;<span class="ident" id="2518386">newname</span>&nbsp;<span class="builtintype" id="2518394">string</span><span class="op" id="2518400">)</span>&nbsp;<span class="builtintype" id="2518402">error</span>&nbsp;<span class="op" id="2518408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2518411">e</span>&nbsp;<span class="op" id="2518413">:=</span>&nbsp;<span class="ident" id="2518416">syscall</span><span class="op" id="2518423">.</span><span class="ident" id="2518424">Symlink</span><span class="op" id="2518431">(</span><span class="ident" id="2518432">oldname</span><span class="op" id="2518439">,</span>&nbsp;<span class="ident" id="2518441">newname</span><span class="op" id="2518448">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518451">if</span>&nbsp;<span class="ident" id="2518454">e</span>&nbsp;<span class="op" id="2518456">!=</span>&nbsp;<span class="ident" id="2518459">nil</span>&nbsp;<span class="op" id="2518463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518467">return</span>&nbsp;<span class="op" id="2518474">&amp;</span><span class="ident" id="2518475">LinkError</span><span class="op" id="2518484">{</span><span class="string" id="2518485">&#34;symlink&#34;</span><span class="op" id="2518494">,</span>&nbsp;<span class="ident" id="2518496">oldname</span><span class="op" id="2518503">,</span>&nbsp;<span class="ident" id="2518505">newname</span><span class="op" id="2518512">,</span>&nbsp;<span class="ident" id="2518514">e</span><span class="op" id="2518515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2518518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2518521">return</span>&nbsp;<span class="ident" id="2518528">nil</span><br>
<span class="lineno"></span><span class="op" id="2518532">}</span>
</div>
</body>
</html>
