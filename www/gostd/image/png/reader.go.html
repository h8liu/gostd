<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4880582">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4880637">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4880691">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4880742">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="4880801">//</span><br>
<span class="lineno"></span><span class="comment" id="4880804">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="4880862">package</span>&nbsp;<span class="ident" id="4880870">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4880875">import</span>&nbsp;<span class="op" id="4880882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880885">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880902">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880921">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880928">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880936">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880950">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880959">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4880974">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4880979">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4880982">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="4881018">const</span>&nbsp;<span class="op" id="4881024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881027">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881044">=</span>&nbsp;<span class="num" id="4881046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881049">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881066">=</span>&nbsp;<span class="num" id="4881068">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881071">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881088">=</span>&nbsp;<span class="num" id="4881090">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881093">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="4881110">=</span>&nbsp;<span class="num" id="4881112">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881115">ctTrueColorAlpha</span>&nbsp;<span class="op" id="4881132">=</span>&nbsp;<span class="num" id="4881134">6</span><br>
<span class="lineno"></span><span class="op" id="4881136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4881139">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4881193">const</span>&nbsp;<span class="op" id="4881199">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881202">cbInvalid</span>&nbsp;<span class="op" id="4881212">=</span>&nbsp;<span class="ident" id="4881214">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881220">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881226">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881232">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881238">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881244">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881251">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881258">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881264">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881270">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881276">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881282">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881290">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881297">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881305">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881313">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="4881321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4881324">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="4881361">const</span>&nbsp;<span class="op" id="4881367">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881370">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881380">=</span>&nbsp;<span class="num" id="4881382">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881385">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881395">=</span>&nbsp;<span class="num" id="4881397">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881400">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4881410">=</span>&nbsp;<span class="num" id="4881412">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881415">ftAverage</span>&nbsp;<span class="op" id="4881425">=</span>&nbsp;<span class="num" id="4881427">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881430">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4881440">=</span>&nbsp;<span class="num" id="4881442">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881445">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4881455">=</span>&nbsp;<span class="num" id="4881457">5</span><br>
<span class="lineno"></span><span class="op" id="4881459">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4881462">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4881481">const</span>&nbsp;<span class="op" id="4881487">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881490">itNone</span>&nbsp;&nbsp;<span class="op" id="4881498">=</span>&nbsp;<span class="num" id="4881500">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881503">itAdam7</span>&nbsp;<span class="op" id="4881511">=</span>&nbsp;<span class="num" id="4881513">1</span><br>
<span class="lineno"></span><span class="op" id="4881515">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4881518">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="4881599">type</span>&nbsp;<span class="ident" id="4881604">interlaceScan</span>&nbsp;<span class="keyword" id="4881618">struct</span>&nbsp;<span class="op" id="4881625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881628">xFactor</span><span class="op" id="4881635">,</span>&nbsp;<span class="ident" id="4881637">yFactor</span><span class="op" id="4881644">,</span>&nbsp;<span class="ident" id="4881646">xOffset</span><span class="op" id="4881653">,</span>&nbsp;<span class="ident" id="4881655">yOffset</span>&nbsp;<span class="builtintype" id="4881663">int</span><br>
<span class="lineno"></span><span class="op" id="4881667">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4881670">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="4881745">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="4881789">var</span>&nbsp;<span class="ident" id="4881793">interlacing</span>&nbsp;<span class="op" id="4881805">=</span>&nbsp;<span class="op" id="4881807">[</span><span class="op" id="4881808">]</span><span class="ident" id="4881809">interlaceScan</span><span class="op" id="4881822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881825">{</span><span class="num" id="4881826">8</span><span class="op" id="4881827">,</span>&nbsp;<span class="num" id="4881829">8</span><span class="op" id="4881830">,</span>&nbsp;<span class="num" id="4881832">0</span><span class="op" id="4881833">,</span>&nbsp;<span class="num" id="4881835">0</span><span class="op" id="4881836">}</span><span class="op" id="4881837">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881840">{</span><span class="num" id="4881841">8</span><span class="op" id="4881842">,</span>&nbsp;<span class="num" id="4881844">8</span><span class="op" id="4881845">,</span>&nbsp;<span class="num" id="4881847">4</span><span class="op" id="4881848">,</span>&nbsp;<span class="num" id="4881850">0</span><span class="op" id="4881851">}</span><span class="op" id="4881852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881855">{</span><span class="num" id="4881856">4</span><span class="op" id="4881857">,</span>&nbsp;<span class="num" id="4881859">8</span><span class="op" id="4881860">,</span>&nbsp;<span class="num" id="4881862">0</span><span class="op" id="4881863">,</span>&nbsp;<span class="num" id="4881865">4</span><span class="op" id="4881866">}</span><span class="op" id="4881867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881870">{</span><span class="num" id="4881871">4</span><span class="op" id="4881872">,</span>&nbsp;<span class="num" id="4881874">4</span><span class="op" id="4881875">,</span>&nbsp;<span class="num" id="4881877">2</span><span class="op" id="4881878">,</span>&nbsp;<span class="num" id="4881880">0</span><span class="op" id="4881881">}</span><span class="op" id="4881882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881885">{</span><span class="num" id="4881886">2</span><span class="op" id="4881887">,</span>&nbsp;<span class="num" id="4881889">4</span><span class="op" id="4881890">,</span>&nbsp;<span class="num" id="4881892">0</span><span class="op" id="4881893">,</span>&nbsp;<span class="num" id="4881895">2</span><span class="op" id="4881896">}</span><span class="op" id="4881897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881900">{</span><span class="num" id="4881901">2</span><span class="op" id="4881902">,</span>&nbsp;<span class="num" id="4881904">2</span><span class="op" id="4881905">,</span>&nbsp;<span class="num" id="4881907">1</span><span class="op" id="4881908">,</span>&nbsp;<span class="num" id="4881910">0</span><span class="op" id="4881911">}</span><span class="op" id="4881912">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881915">{</span><span class="num" id="4881916">1</span><span class="op" id="4881917">,</span>&nbsp;<span class="num" id="4881919">2</span><span class="op" id="4881920">,</span>&nbsp;<span class="num" id="4881922">0</span><span class="op" id="4881923">,</span>&nbsp;<span class="num" id="4881925">1</span><span class="op" id="4881926">}</span><span class="op" id="4881927">,</span><br>
<span class="lineno"></span><span class="op" id="4881929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4881932">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="4881951">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="4882029">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4882105">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="4882180">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="4882198">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="4882242">const</span>&nbsp;<span class="op" id="4882248">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882251">dsStart</span>&nbsp;<span class="op" id="4882259">=</span>&nbsp;<span class="ident" id="4882261">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882267">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882279">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882291">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882303">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="4882314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4882317">const</span>&nbsp;<span class="ident" id="4882323">pngHeader</span>&nbsp;<span class="op" id="4882333">=</span>&nbsp;<span class="string" id="4882335">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4882356">type</span>&nbsp;<span class="ident" id="4882361">decoder</span>&nbsp;<span class="keyword" id="4882369">struct</span>&nbsp;<span class="op" id="4882376">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882379">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4882393">io</span><span class="op" id="4882395">.</span><span class="ident" id="4882396">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882404">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4882418">image</span><span class="op" id="4882423">.</span><span class="ident" id="4882424">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882431">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4882445">hash</span><span class="op" id="4882449">.</span><span class="ident" id="4882450">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882458">width</span><span class="op" id="4882463">,</span>&nbsp;<span class="ident" id="4882465">height</span>&nbsp;<span class="builtintype" id="4882472">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882477">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4882491">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882496">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4882510">color</span><span class="op" id="4882515">.</span><span class="ident" id="4882516">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882525">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4882539">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882544">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4882558">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882563">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4882577">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882585">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4882599">[</span><span class="num" id="4882600">3</span>&nbsp;<span class="op" id="4882602">*</span>&nbsp;<span class="num" id="4882604">256</span><span class="op" id="4882607">]</span><span class="builtintype" id="4882608">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882614">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4882628">int</span><br>
<span class="lineno"></span><span class="op" id="4882632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882635">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="4882695">type</span>&nbsp;<span class="ident" id="4882700">FormatError</span>&nbsp;<span class="builtintype" id="4882712">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="4882720">func</span>&nbsp;<span class="op" id="4882725">(</span><span class="ident" id="4882726">e</span>&nbsp;<span class="ident" id="4882728">FormatError</span><span class="op" id="4882739">)</span>&nbsp;<span class="ident" id="4882741">Error</span><span class="op" id="4882746">(</span><span class="op" id="4882747">)</span>&nbsp;<span class="builtintype" id="4882749">string</span>&nbsp;<span class="op" id="4882756">{</span>&nbsp;<span class="keyword" id="4882758">return</span>&nbsp;<span class="string" id="4882765">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="4882789">+</span>&nbsp;<span class="builtintype" id="4882791">string</span><span class="op" id="4882797">(</span><span class="ident" id="4882798">e</span><span class="op" id="4882799">)</span>&nbsp;<span class="op" id="4882801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4882804">var</span>&nbsp;<span class="ident" id="4882808">chunkOrderError</span>&nbsp;<span class="op" id="4882824">=</span>&nbsp;<span class="ident" id="4882826">FormatError</span><span class="op" id="4882837">(</span><span class="string" id="4882838">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="4882858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="4882861">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="4882951">type</span>&nbsp;<span class="ident" id="4882956">UnsupportedError</span>&nbsp;<span class="builtintype" id="4882973">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4882981">func</span>&nbsp;<span class="op" id="4882986">(</span><span class="ident" id="4882987">e</span>&nbsp;<span class="ident" id="4882989">UnsupportedError</span><span class="op" id="4883005">)</span>&nbsp;<span class="ident" id="4883007">Error</span><span class="op" id="4883012">(</span><span class="op" id="4883013">)</span>&nbsp;<span class="builtintype" id="4883015">string</span>&nbsp;<span class="op" id="4883022">{</span>&nbsp;<span class="keyword" id="4883024">return</span>&nbsp;<span class="string" id="4883031">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="4883060">+</span>&nbsp;<span class="builtintype" id="4883062">string</span><span class="op" id="4883068">(</span><span class="ident" id="4883069">e</span><span class="op" id="4883070">)</span>&nbsp;<span class="op" id="4883072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4883075">func</span>&nbsp;<span class="ident" id="4883080">min</span><span class="op" id="4883083">(</span><span class="ident" id="4883084">a</span><span class="op" id="4883085">,</span>&nbsp;<span class="ident" id="4883087">b</span>&nbsp;<span class="builtintype" id="4883089">int</span><span class="op" id="4883092">)</span>&nbsp;<span class="builtintype" id="4883094">int</span>&nbsp;<span class="op" id="4883098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883101">if</span>&nbsp;<span class="ident" id="4883104">a</span>&nbsp;<span class="op" id="4883106">&lt;</span>&nbsp;<span class="ident" id="4883108">b</span>&nbsp;<span class="op" id="4883110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883114">return</span>&nbsp;<span class="ident" id="4883121">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883127">return</span>&nbsp;<span class="ident" id="4883134">b</span><br>
<span class="lineno">130</span><span class="op" id="4883136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4883139">func</span>&nbsp;<span class="op" id="4883144">(</span><span class="ident" id="4883145">d</span>&nbsp;<span class="op" id="4883147">*</span><span class="ident" id="4883148">decoder</span><span class="op" id="4883155">)</span>&nbsp;<span class="ident" id="4883157">parseIHDR</span><span class="op" id="4883166">(</span><span class="ident" id="4883167">length</span>&nbsp;<span class="builtintype" id="4883174">uint32</span><span class="op" id="4883180">)</span>&nbsp;<span class="builtintype" id="4883182">error</span>&nbsp;<span class="op" id="4883188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883191">if</span>&nbsp;<span class="ident" id="4883194">length</span>&nbsp;<span class="op" id="4883201">!=</span>&nbsp;<span class="num" id="4883204">13</span>&nbsp;<span class="op" id="4883207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883211">return</span>&nbsp;<span class="ident" id="4883218">FormatError</span><span class="op" id="4883229">(</span><span class="string" id="4883230">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="4883247">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883253">if</span>&nbsp;<span class="ident" id="4883256">_</span><span class="op" id="4883257">,</span>&nbsp;<span class="ident" id="4883259">err</span>&nbsp;<span class="op" id="4883263">:=</span>&nbsp;<span class="ident" id="4883266">io</span><span class="op" id="4883268">.</span><span class="ident" id="4883269">ReadFull</span><span class="op" id="4883277">(</span><span class="ident" id="4883278">d</span><span class="op" id="4883279">.</span><span class="ident" id="4883280">r</span><span class="op" id="4883281">,</span>&nbsp;<span class="ident" id="4883283">d</span><span class="op" id="4883284">.</span><span class="ident" id="4883285">tmp</span><span class="op" id="4883288">[</span><span class="op" id="4883289">:</span><span class="num" id="4883290">13</span><span class="op" id="4883292">]</span><span class="op" id="4883293">)</span><span class="op" id="4883294">;</span>&nbsp;<span class="ident" id="4883296">err</span>&nbsp;<span class="op" id="4883300">!=</span>&nbsp;<span class="ident" id="4883303">nil</span>&nbsp;<span class="op" id="4883307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883311">return</span>&nbsp;<span class="ident" id="4883318">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883326">d</span><span class="op" id="4883327">.</span><span class="ident" id="4883328">crc</span><span class="op" id="4883331">.</span><span class="ident" id="4883332">Write</span><span class="op" id="4883337">(</span><span class="ident" id="4883338">d</span><span class="op" id="4883339">.</span><span class="ident" id="4883340">tmp</span><span class="op" id="4883343">[</span><span class="op" id="4883344">:</span><span class="num" id="4883345">13</span><span class="op" id="4883347">]</span><span class="op" id="4883348">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883351">if</span>&nbsp;<span class="ident" id="4883354">d</span><span class="op" id="4883355">.</span><span class="ident" id="4883356">tmp</span><span class="op" id="4883359">[</span><span class="num" id="4883360">10</span><span class="op" id="4883362">]</span>&nbsp;<span class="op" id="4883364">!=</span>&nbsp;<span class="num" id="4883367">0</span>&nbsp;<span class="op" id="4883369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883373">return</span>&nbsp;<span class="ident" id="4883380">UnsupportedError</span><span class="op" id="4883396">(</span><span class="string" id="4883397">&#34;compression&nbsp;method&#34;</span><span class="op" id="4883417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883423">if</span>&nbsp;<span class="ident" id="4883426">d</span><span class="op" id="4883427">.</span><span class="ident" id="4883428">tmp</span><span class="op" id="4883431">[</span><span class="num" id="4883432">11</span><span class="op" id="4883434">]</span>&nbsp;<span class="op" id="4883436">!=</span>&nbsp;<span class="num" id="4883439">0</span>&nbsp;<span class="op" id="4883441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883445">return</span>&nbsp;<span class="ident" id="4883452">UnsupportedError</span><span class="op" id="4883468">(</span><span class="string" id="4883469">&#34;filter&nbsp;method&#34;</span><span class="op" id="4883484">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883490">if</span>&nbsp;<span class="ident" id="4883493">d</span><span class="op" id="4883494">.</span><span class="ident" id="4883495">tmp</span><span class="op" id="4883498">[</span><span class="num" id="4883499">12</span><span class="op" id="4883501">]</span>&nbsp;<span class="op" id="4883503">!=</span>&nbsp;<span class="ident" id="4883506">itNone</span>&nbsp;<span class="op" id="4883513">&amp;&amp;</span>&nbsp;<span class="ident" id="4883516">d</span><span class="op" id="4883517">.</span><span class="ident" id="4883518">tmp</span><span class="op" id="4883521">[</span><span class="num" id="4883522">12</span><span class="op" id="4883524">]</span>&nbsp;<span class="op" id="4883526">!=</span>&nbsp;<span class="ident" id="4883529">itAdam7</span>&nbsp;<span class="op" id="4883537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883541">return</span>&nbsp;<span class="ident" id="4883548">FormatError</span><span class="op" id="4883559">(</span><span class="string" id="4883560">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="4883586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883592">d</span><span class="op" id="4883593">.</span><span class="ident" id="4883594">interlace</span>&nbsp;<span class="op" id="4883604">=</span>&nbsp;<span class="builtintype" id="4883606">int</span><span class="op" id="4883609">(</span><span class="ident" id="4883610">d</span><span class="op" id="4883611">.</span><span class="ident" id="4883612">tmp</span><span class="op" id="4883615">[</span><span class="num" id="4883616">12</span><span class="op" id="4883618">]</span><span class="op" id="4883619">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883622">w</span>&nbsp;<span class="op" id="4883624">:=</span>&nbsp;<span class="builtintype" id="4883627">int32</span><span class="op" id="4883632">(</span><span class="ident" id="4883633">binary</span><span class="op" id="4883639">.</span><span class="ident" id="4883640">BigEndian</span><span class="op" id="4883649">.</span><span class="ident" id="4883650">Uint32</span><span class="op" id="4883656">(</span><span class="ident" id="4883657">d</span><span class="op" id="4883658">.</span><span class="ident" id="4883659">tmp</span><span class="op" id="4883662">[</span><span class="num" id="4883663">0</span><span class="op" id="4883664">:</span><span class="num" id="4883665">4</span><span class="op" id="4883666">]</span><span class="op" id="4883667">)</span><span class="op" id="4883668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883671">h</span>&nbsp;<span class="op" id="4883673">:=</span>&nbsp;<span class="builtintype" id="4883676">int32</span><span class="op" id="4883681">(</span><span class="ident" id="4883682">binary</span><span class="op" id="4883688">.</span><span class="ident" id="4883689">BigEndian</span><span class="op" id="4883698">.</span><span class="ident" id="4883699">Uint32</span><span class="op" id="4883705">(</span><span class="ident" id="4883706">d</span><span class="op" id="4883707">.</span><span class="ident" id="4883708">tmp</span><span class="op" id="4883711">[</span><span class="num" id="4883712">4</span><span class="op" id="4883713">:</span><span class="num" id="4883714">8</span><span class="op" id="4883715">]</span><span class="op" id="4883716">)</span><span class="op" id="4883717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883720">if</span>&nbsp;<span class="ident" id="4883723">w</span>&nbsp;<span class="op" id="4883725">&lt;</span>&nbsp;<span class="num" id="4883727">0</span>&nbsp;<span class="op" id="4883729">||</span>&nbsp;<span class="ident" id="4883732">h</span>&nbsp;<span class="op" id="4883734">&lt;</span>&nbsp;<span class="num" id="4883736">0</span>&nbsp;<span class="op" id="4883738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883742">return</span>&nbsp;<span class="ident" id="4883749">FormatError</span><span class="op" id="4883760">(</span><span class="string" id="4883761">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="4883781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883784">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883787">nPixels</span>&nbsp;<span class="op" id="4883795">:=</span>&nbsp;<span class="ident" id="4883798">int64</span><span class="op" id="4883803">(</span><span class="ident" id="4883804">w</span><span class="op" id="4883805">)</span>&nbsp;<span class="op" id="4883807">*</span>&nbsp;<span class="ident" id="4883809">int64</span><span class="op" id="4883814">(</span><span class="ident" id="4883815">h</span><span class="op" id="4883816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883819">if</span>&nbsp;<span class="ident" id="4883822">nPixels</span>&nbsp;<span class="op" id="4883830">!=</span>&nbsp;<span class="ident" id="4883833">int64</span><span class="op" id="4883838">(</span><span class="builtintype" id="4883839">int</span><span class="op" id="4883842">(</span><span class="ident" id="4883843">nPixels</span><span class="op" id="4883850">)</span><span class="op" id="4883851">)</span>&nbsp;<span class="op" id="4883853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883857">return</span>&nbsp;<span class="ident" id="4883864">UnsupportedError</span><span class="op" id="4883880">(</span><span class="string" id="4883881">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="4883901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883907">d</span><span class="op" id="4883908">.</span><span class="ident" id="4883909">cb</span>&nbsp;<span class="op" id="4883912">=</span>&nbsp;<span class="ident" id="4883914">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883925">d</span><span class="op" id="4883926">.</span><span class="ident" id="4883927">depth</span>&nbsp;<span class="op" id="4883933">=</span>&nbsp;<span class="builtintype" id="4883935">int</span><span class="op" id="4883938">(</span><span class="ident" id="4883939">d</span><span class="op" id="4883940">.</span><span class="ident" id="4883941">tmp</span><span class="op" id="4883944">[</span><span class="num" id="4883945">8</span><span class="op" id="4883946">]</span><span class="op" id="4883947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883950">switch</span>&nbsp;<span class="ident" id="4883957">d</span><span class="op" id="4883958">.</span><span class="ident" id="4883959">depth</span>&nbsp;<span class="op" id="4883965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883968">case</span>&nbsp;<span class="num" id="4883973">1</span><span class="op" id="4883974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883978">switch</span>&nbsp;<span class="ident" id="4883985">d</span><span class="op" id="4883986">.</span><span class="ident" id="4883987">tmp</span><span class="op" id="4883990">[</span><span class="num" id="4883991">9</span><span class="op" id="4883992">]</span>&nbsp;<span class="op" id="4883994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883998">case</span>&nbsp;<span class="ident" id="4884003">ctGrayscale</span><span class="op" id="4884014">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884019">d</span><span class="op" id="4884020">.</span><span class="ident" id="4884021">cb</span>&nbsp;<span class="op" id="4884024">=</span>&nbsp;<span class="ident" id="4884026">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884033">case</span>&nbsp;<span class="ident" id="4884038">ctPaletted</span><span class="op" id="4884048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884053">d</span><span class="op" id="4884054">.</span><span class="ident" id="4884055">cb</span>&nbsp;<span class="op" id="4884058">=</span>&nbsp;<span class="ident" id="4884060">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884070">case</span>&nbsp;<span class="num" id="4884075">2</span><span class="op" id="4884076">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884080">switch</span>&nbsp;<span class="ident" id="4884087">d</span><span class="op" id="4884088">.</span><span class="ident" id="4884089">tmp</span><span class="op" id="4884092">[</span><span class="num" id="4884093">9</span><span class="op" id="4884094">]</span>&nbsp;<span class="op" id="4884096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884100">case</span>&nbsp;<span class="ident" id="4884105">ctGrayscale</span><span class="op" id="4884116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884121">d</span><span class="op" id="4884122">.</span><span class="ident" id="4884123">cb</span>&nbsp;<span class="op" id="4884126">=</span>&nbsp;<span class="ident" id="4884128">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884135">case</span>&nbsp;<span class="ident" id="4884140">ctPaletted</span><span class="op" id="4884150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884155">d</span><span class="op" id="4884156">.</span><span class="ident" id="4884157">cb</span>&nbsp;<span class="op" id="4884160">=</span>&nbsp;<span class="ident" id="4884162">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884172">case</span>&nbsp;<span class="num" id="4884177">4</span><span class="op" id="4884178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884182">switch</span>&nbsp;<span class="ident" id="4884189">d</span><span class="op" id="4884190">.</span><span class="ident" id="4884191">tmp</span><span class="op" id="4884194">[</span><span class="num" id="4884195">9</span><span class="op" id="4884196">]</span>&nbsp;<span class="op" id="4884198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884202">case</span>&nbsp;<span class="ident" id="4884207">ctGrayscale</span><span class="op" id="4884218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884223">d</span><span class="op" id="4884224">.</span><span class="ident" id="4884225">cb</span>&nbsp;<span class="op" id="4884228">=</span>&nbsp;<span class="ident" id="4884230">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884237">case</span>&nbsp;<span class="ident" id="4884242">ctPaletted</span><span class="op" id="4884252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884257">d</span><span class="op" id="4884258">.</span><span class="ident" id="4884259">cb</span>&nbsp;<span class="op" id="4884262">=</span>&nbsp;<span class="ident" id="4884264">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884274">case</span>&nbsp;<span class="num" id="4884279">8</span><span class="op" id="4884280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884284">switch</span>&nbsp;<span class="ident" id="4884291">d</span><span class="op" id="4884292">.</span><span class="ident" id="4884293">tmp</span><span class="op" id="4884296">[</span><span class="num" id="4884297">9</span><span class="op" id="4884298">]</span>&nbsp;<span class="op" id="4884300">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884304">case</span>&nbsp;<span class="ident" id="4884309">ctGrayscale</span><span class="op" id="4884320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884325">d</span><span class="op" id="4884326">.</span><span class="ident" id="4884327">cb</span>&nbsp;<span class="op" id="4884330">=</span>&nbsp;<span class="ident" id="4884332">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884339">case</span>&nbsp;<span class="ident" id="4884344">ctTrueColor</span><span class="op" id="4884355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884360">d</span><span class="op" id="4884361">.</span><span class="ident" id="4884362">cb</span>&nbsp;<span class="op" id="4884365">=</span>&nbsp;<span class="ident" id="4884367">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884375">case</span>&nbsp;<span class="ident" id="4884380">ctPaletted</span><span class="op" id="4884390">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884395">d</span><span class="op" id="4884396">.</span><span class="ident" id="4884397">cb</span>&nbsp;<span class="op" id="4884400">=</span>&nbsp;<span class="ident" id="4884402">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884409">case</span>&nbsp;<span class="ident" id="4884414">ctGrayscaleAlpha</span><span class="op" id="4884430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884435">d</span><span class="op" id="4884436">.</span><span class="ident" id="4884437">cb</span>&nbsp;<span class="op" id="4884440">=</span>&nbsp;<span class="ident" id="4884442">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884450">case</span>&nbsp;<span class="ident" id="4884455">ctTrueColorAlpha</span><span class="op" id="4884471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884476">d</span><span class="op" id="4884477">.</span><span class="ident" id="4884478">cb</span>&nbsp;<span class="op" id="4884481">=</span>&nbsp;<span class="ident" id="4884483">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884495">case</span>&nbsp;<span class="num" id="4884500">16</span><span class="op" id="4884502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884506">switch</span>&nbsp;<span class="ident" id="4884513">d</span><span class="op" id="4884514">.</span><span class="ident" id="4884515">tmp</span><span class="op" id="4884518">[</span><span class="num" id="4884519">9</span><span class="op" id="4884520">]</span>&nbsp;<span class="op" id="4884522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884526">case</span>&nbsp;<span class="ident" id="4884531">ctGrayscale</span><span class="op" id="4884542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884547">d</span><span class="op" id="4884548">.</span><span class="ident" id="4884549">cb</span>&nbsp;<span class="op" id="4884552">=</span>&nbsp;<span class="ident" id="4884554">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884562">case</span>&nbsp;<span class="ident" id="4884567">ctTrueColor</span><span class="op" id="4884578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884583">d</span><span class="op" id="4884584">.</span><span class="ident" id="4884585">cb</span>&nbsp;<span class="op" id="4884588">=</span>&nbsp;<span class="ident" id="4884590">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884599">case</span>&nbsp;<span class="ident" id="4884604">ctGrayscaleAlpha</span><span class="op" id="4884620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884625">d</span><span class="op" id="4884626">.</span><span class="ident" id="4884627">cb</span>&nbsp;<span class="op" id="4884630">=</span>&nbsp;<span class="ident" id="4884632">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884641">case</span>&nbsp;<span class="ident" id="4884646">ctTrueColorAlpha</span><span class="op" id="4884662">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884667">d</span><span class="op" id="4884668">.</span><span class="ident" id="4884669">cb</span>&nbsp;<span class="op" id="4884672">=</span>&nbsp;<span class="ident" id="4884674">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884690">if</span>&nbsp;<span class="ident" id="4884693">d</span><span class="op" id="4884694">.</span><span class="ident" id="4884695">cb</span>&nbsp;<span class="op" id="4884698">==</span>&nbsp;<span class="ident" id="4884701">cbInvalid</span>&nbsp;<span class="op" id="4884711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884715">return</span>&nbsp;<span class="ident" id="4884722">UnsupportedError</span><span class="op" id="4884738">(</span><span class="ident" id="4884739">fmt</span><span class="op" id="4884742">.</span><span class="ident" id="4884743">Sprintf</span><span class="op" id="4884750">(</span><span class="string" id="4884751">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="4884780">,</span>&nbsp;<span class="ident" id="4884782">d</span><span class="op" id="4884783">.</span><span class="ident" id="4884784">tmp</span><span class="op" id="4884787">[</span><span class="num" id="4884788">8</span><span class="op" id="4884789">]</span><span class="op" id="4884790">,</span>&nbsp;<span class="ident" id="4884792">d</span><span class="op" id="4884793">.</span><span class="ident" id="4884794">tmp</span><span class="op" id="4884797">[</span><span class="num" id="4884798">9</span><span class="op" id="4884799">]</span><span class="op" id="4884800">)</span><span class="op" id="4884801">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4884804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884807">d</span><span class="op" id="4884808">.</span><span class="ident" id="4884809">width</span><span class="op" id="4884814">,</span>&nbsp;<span class="ident" id="4884816">d</span><span class="op" id="4884817">.</span><span class="ident" id="4884818">height</span>&nbsp;<span class="op" id="4884825">=</span>&nbsp;<span class="builtintype" id="4884827">int</span><span class="op" id="4884830">(</span><span class="ident" id="4884831">w</span><span class="op" id="4884832">)</span><span class="op" id="4884833">,</span>&nbsp;<span class="builtintype" id="4884835">int</span><span class="op" id="4884838">(</span><span class="ident" id="4884839">h</span><span class="op" id="4884840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884843">return</span>&nbsp;<span class="ident" id="4884850">d</span><span class="op" id="4884851">.</span><span class="ident" id="4884852">verifyChecksum</span><span class="op" id="4884866">(</span><span class="op" id="4884867">)</span><br>
<span class="lineno"></span><span class="op" id="4884869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4884872">func</span>&nbsp;<span class="op" id="4884877">(</span><span class="ident" id="4884878">d</span>&nbsp;<span class="op" id="4884880">*</span><span class="ident" id="4884881">decoder</span><span class="op" id="4884888">)</span>&nbsp;<span class="ident" id="4884890">parsePLTE</span><span class="op" id="4884899">(</span><span class="ident" id="4884900">length</span>&nbsp;<span class="builtintype" id="4884907">uint32</span><span class="op" id="4884913">)</span>&nbsp;<span class="builtintype" id="4884915">error</span>&nbsp;<span class="op" id="4884921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884924">np</span>&nbsp;<span class="op" id="4884927">:=</span>&nbsp;<span class="builtintype" id="4884930">int</span><span class="op" id="4884933">(</span><span class="ident" id="4884934">length</span>&nbsp;<span class="op" id="4884941">/</span>&nbsp;<span class="num" id="4884943">3</span><span class="op" id="4884944">)</span>&nbsp;<span class="comment" id="4884946">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4884981">if</span>&nbsp;<span class="ident" id="4884984">length</span><span class="op" id="4884990">%</span><span class="num" id="4884991">3</span>&nbsp;<span class="op" id="4884993">!=</span>&nbsp;<span class="num" id="4884996">0</span>&nbsp;<span class="op" id="4884998">||</span>&nbsp;<span class="ident" id="4885001">np</span>&nbsp;<span class="op" id="4885004">&lt;=</span>&nbsp;<span class="num" id="4885007">0</span>&nbsp;<span class="op" id="4885009">||</span>&nbsp;<span class="ident" id="4885012">np</span>&nbsp;<span class="op" id="4885015">&gt;</span>&nbsp;<span class="num" id="4885017">256</span>&nbsp;<span class="op" id="4885021">||</span>&nbsp;<span class="ident" id="4885024">np</span>&nbsp;<span class="op" id="4885027">&gt;</span>&nbsp;<span class="num" id="4885029">1</span><span class="op" id="4885030">&lt;&lt;</span><span class="builtintype" id="4885032">uint</span><span class="op" id="4885036">(</span><span class="ident" id="4885037">d</span><span class="op" id="4885038">.</span><span class="ident" id="4885039">depth</span><span class="op" id="4885044">)</span>&nbsp;<span class="op" id="4885046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885050">return</span>&nbsp;<span class="ident" id="4885057">FormatError</span><span class="op" id="4885068">(</span><span class="string" id="4885069">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="4885086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885089">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885092">n</span><span class="op" id="4885093">,</span>&nbsp;<span class="ident" id="4885095">err</span>&nbsp;<span class="op" id="4885099">:=</span>&nbsp;<span class="ident" id="4885102">io</span><span class="op" id="4885104">.</span><span class="ident" id="4885105">ReadFull</span><span class="op" id="4885113">(</span><span class="ident" id="4885114">d</span><span class="op" id="4885115">.</span><span class="ident" id="4885116">r</span><span class="op" id="4885117">,</span>&nbsp;<span class="ident" id="4885119">d</span><span class="op" id="4885120">.</span><span class="ident" id="4885121">tmp</span><span class="op" id="4885124">[</span><span class="op" id="4885125">:</span><span class="num" id="4885126">3</span><span class="op" id="4885127">*</span><span class="ident" id="4885128">np</span><span class="op" id="4885130">]</span><span class="op" id="4885131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885134">if</span>&nbsp;<span class="ident" id="4885137">err</span>&nbsp;<span class="op" id="4885141">!=</span>&nbsp;<span class="ident" id="4885144">nil</span>&nbsp;<span class="op" id="4885148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885152">return</span>&nbsp;<span class="ident" id="4885159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885167">d</span><span class="op" id="4885168">.</span><span class="ident" id="4885169">crc</span><span class="op" id="4885172">.</span><span class="ident" id="4885173">Write</span><span class="op" id="4885178">(</span><span class="ident" id="4885179">d</span><span class="op" id="4885180">.</span><span class="ident" id="4885181">tmp</span><span class="op" id="4885184">[</span><span class="op" id="4885185">:</span><span class="ident" id="4885186">n</span><span class="op" id="4885187">]</span><span class="op" id="4885188">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885191">switch</span>&nbsp;<span class="ident" id="4885198">d</span><span class="op" id="4885199">.</span><span class="ident" id="4885200">cb</span>&nbsp;<span class="op" id="4885203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885206">case</span>&nbsp;<span class="ident" id="4885211">cbP1</span><span class="op" id="4885215">,</span>&nbsp;<span class="ident" id="4885217">cbP2</span><span class="op" id="4885221">,</span>&nbsp;<span class="ident" id="4885223">cbP4</span><span class="op" id="4885227">,</span>&nbsp;<span class="ident" id="4885229">cbP8</span><span class="op" id="4885233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885237">d</span><span class="op" id="4885238">.</span><span class="ident" id="4885239">palette</span>&nbsp;<span class="op" id="4885247">=</span>&nbsp;<span class="builtinfunc" id="4885249">make</span><span class="op" id="4885253">(</span><span class="ident" id="4885254">color</span><span class="op" id="4885259">.</span><span class="ident" id="4885260">Palette</span><span class="op" id="4885267">,</span>&nbsp;<span class="num" id="4885269">256</span><span class="op" id="4885272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885276">for</span>&nbsp;<span class="ident" id="4885280">i</span>&nbsp;<span class="op" id="4885282">:=</span>&nbsp;<span class="num" id="4885285">0</span><span class="op" id="4885286">;</span>&nbsp;<span class="ident" id="4885288">i</span>&nbsp;<span class="op" id="4885290">&lt;</span>&nbsp;<span class="ident" id="4885292">np</span><span class="op" id="4885294">;</span>&nbsp;<span class="ident" id="4885296">i</span><span class="op" id="4885297">++</span>&nbsp;<span class="op" id="4885300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885305">d</span><span class="op" id="4885306">.</span><span class="ident" id="4885307">palette</span><span class="op" id="4885314">[</span><span class="ident" id="4885315">i</span><span class="op" id="4885316">]</span>&nbsp;<span class="op" id="4885318">=</span>&nbsp;<span class="ident" id="4885320">color</span><span class="op" id="4885325">.</span><span class="ident" id="4885326">RGBA</span><span class="op" id="4885330">{</span><span class="ident" id="4885331">d</span><span class="op" id="4885332">.</span><span class="ident" id="4885333">tmp</span><span class="op" id="4885336">[</span><span class="num" id="4885337">3</span><span class="op" id="4885338">*</span><span class="ident" id="4885339">i</span><span class="op" id="4885340">+</span><span class="num" id="4885341">0</span><span class="op" id="4885342">]</span><span class="op" id="4885343">,</span>&nbsp;<span class="ident" id="4885345">d</span><span class="op" id="4885346">.</span><span class="ident" id="4885347">tmp</span><span class="op" id="4885350">[</span><span class="num" id="4885351">3</span><span class="op" id="4885352">*</span><span class="ident" id="4885353">i</span><span class="op" id="4885354">+</span><span class="num" id="4885355">1</span><span class="op" id="4885356">]</span><span class="op" id="4885357">,</span>&nbsp;<span class="ident" id="4885359">d</span><span class="op" id="4885360">.</span><span class="ident" id="4885361">tmp</span><span class="op" id="4885364">[</span><span class="num" id="4885365">3</span><span class="op" id="4885366">*</span><span class="ident" id="4885367">i</span><span class="op" id="4885368">+</span><span class="num" id="4885369">2</span><span class="op" id="4885370">]</span><span class="op" id="4885371">,</span>&nbsp;<span class="num" id="4885373">0xff</span><span class="op" id="4885377">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885385">for</span>&nbsp;<span class="ident" id="4885389">i</span>&nbsp;<span class="op" id="4885391">:=</span>&nbsp;<span class="ident" id="4885394">np</span><span class="op" id="4885396">;</span>&nbsp;<span class="ident" id="4885398">i</span>&nbsp;<span class="op" id="4885400">&lt;</span>&nbsp;<span class="num" id="4885402">256</span><span class="op" id="4885405">;</span>&nbsp;<span class="ident" id="4885407">i</span><span class="op" id="4885408">++</span>&nbsp;<span class="op" id="4885411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885416">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885492">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885570">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885644">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885715">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885757">d</span><span class="op" id="4885758">.</span><span class="ident" id="4885759">palette</span><span class="op" id="4885766">[</span><span class="ident" id="4885767">i</span><span class="op" id="4885768">]</span>&nbsp;<span class="op" id="4885770">=</span>&nbsp;<span class="ident" id="4885772">color</span><span class="op" id="4885777">.</span><span class="ident" id="4885778">RGBA</span><span class="op" id="4885782">{</span><span class="num" id="4885783">0x00</span><span class="op" id="4885787">,</span>&nbsp;<span class="num" id="4885789">0x00</span><span class="op" id="4885793">,</span>&nbsp;<span class="num" id="4885795">0x00</span><span class="op" id="4885799">,</span>&nbsp;<span class="num" id="4885801">0xff</span><span class="op" id="4885805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885813">d</span><span class="op" id="4885814">.</span><span class="ident" id="4885815">palette</span>&nbsp;<span class="op" id="4885823">=</span>&nbsp;<span class="ident" id="4885825">d</span><span class="op" id="4885826">.</span><span class="ident" id="4885827">palette</span><span class="op" id="4885834">[</span><span class="op" id="4885835">:</span><span class="ident" id="4885836">np</span><span class="op" id="4885838">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885841">case</span>&nbsp;<span class="ident" id="4885846">cbTC8</span><span class="op" id="4885851">,</span>&nbsp;<span class="ident" id="4885853">cbTCA8</span><span class="op" id="4885859">,</span>&nbsp;<span class="ident" id="4885861">cbTC16</span><span class="op" id="4885867">,</span>&nbsp;<span class="ident" id="4885869">cbTCA16</span><span class="op" id="4885876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885880">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885960">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886045">default</span><span class="op" id="4886052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886056">return</span>&nbsp;<span class="ident" id="4886063">FormatError</span><span class="op" id="4886074">(</span><span class="string" id="4886075">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="4886102">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886108">return</span>&nbsp;<span class="ident" id="4886115">d</span><span class="op" id="4886116">.</span><span class="ident" id="4886117">verifyChecksum</span><span class="op" id="4886131">(</span><span class="op" id="4886132">)</span><br>
<span class="lineno"></span><span class="op" id="4886134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886137">func</span>&nbsp;<span class="op" id="4886142">(</span><span class="ident" id="4886143">d</span>&nbsp;<span class="op" id="4886145">*</span><span class="ident" id="4886146">decoder</span><span class="op" id="4886153">)</span>&nbsp;<span class="ident" id="4886155">parsetRNS</span><span class="op" id="4886164">(</span><span class="ident" id="4886165">length</span>&nbsp;<span class="builtintype" id="4886172">uint32</span><span class="op" id="4886178">)</span>&nbsp;<span class="builtintype" id="4886180">error</span>&nbsp;<span class="op" id="4886186">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886189">if</span>&nbsp;<span class="ident" id="4886192">length</span>&nbsp;<span class="op" id="4886199">&gt;</span>&nbsp;<span class="num" id="4886201">256</span>&nbsp;<span class="op" id="4886205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886209">return</span>&nbsp;<span class="ident" id="4886216">FormatError</span><span class="op" id="4886227">(</span><span class="string" id="4886228">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="4886245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886251">n</span><span class="op" id="4886252">,</span>&nbsp;<span class="ident" id="4886254">err</span>&nbsp;<span class="op" id="4886258">:=</span>&nbsp;<span class="ident" id="4886261">io</span><span class="op" id="4886263">.</span><span class="ident" id="4886264">ReadFull</span><span class="op" id="4886272">(</span><span class="ident" id="4886273">d</span><span class="op" id="4886274">.</span><span class="ident" id="4886275">r</span><span class="op" id="4886276">,</span>&nbsp;<span class="ident" id="4886278">d</span><span class="op" id="4886279">.</span><span class="ident" id="4886280">tmp</span><span class="op" id="4886283">[</span><span class="op" id="4886284">:</span><span class="ident" id="4886285">length</span><span class="op" id="4886291">]</span><span class="op" id="4886292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886295">if</span>&nbsp;<span class="ident" id="4886298">err</span>&nbsp;<span class="op" id="4886302">!=</span>&nbsp;<span class="ident" id="4886305">nil</span>&nbsp;<span class="op" id="4886309">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886313">return</span>&nbsp;<span class="ident" id="4886320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886328">d</span><span class="op" id="4886329">.</span><span class="ident" id="4886330">crc</span><span class="op" id="4886333">.</span><span class="ident" id="4886334">Write</span><span class="op" id="4886339">(</span><span class="ident" id="4886340">d</span><span class="op" id="4886341">.</span><span class="ident" id="4886342">tmp</span><span class="op" id="4886345">[</span><span class="op" id="4886346">:</span><span class="ident" id="4886347">n</span><span class="op" id="4886348">]</span><span class="op" id="4886349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886352">switch</span>&nbsp;<span class="ident" id="4886359">d</span><span class="op" id="4886360">.</span><span class="ident" id="4886361">cb</span>&nbsp;<span class="op" id="4886364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886367">case</span>&nbsp;<span class="ident" id="4886372">cbG8</span><span class="op" id="4886376">,</span>&nbsp;<span class="ident" id="4886378">cbG16</span><span class="op" id="4886383">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886387">return</span>&nbsp;<span class="ident" id="4886394">UnsupportedError</span><span class="op" id="4886410">(</span><span class="string" id="4886411">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="4886435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886438">case</span>&nbsp;<span class="ident" id="4886443">cbTC8</span><span class="op" id="4886448">,</span>&nbsp;<span class="ident" id="4886450">cbTC16</span><span class="op" id="4886456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886460">return</span>&nbsp;<span class="ident" id="4886467">UnsupportedError</span><span class="op" id="4886483">(</span><span class="string" id="4886484">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="4886508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886511">case</span>&nbsp;<span class="ident" id="4886516">cbP1</span><span class="op" id="4886520">,</span>&nbsp;<span class="ident" id="4886522">cbP2</span><span class="op" id="4886526">,</span>&nbsp;<span class="ident" id="4886528">cbP4</span><span class="op" id="4886532">,</span>&nbsp;<span class="ident" id="4886534">cbP8</span><span class="op" id="4886538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886542">if</span>&nbsp;<span class="builtinfunc" id="4886545">len</span><span class="op" id="4886548">(</span><span class="ident" id="4886549">d</span><span class="op" id="4886550">.</span><span class="ident" id="4886551">palette</span><span class="op" id="4886558">)</span>&nbsp;<span class="op" id="4886560">&lt;</span>&nbsp;<span class="ident" id="4886562">n</span>&nbsp;<span class="op" id="4886564">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886569">d</span><span class="op" id="4886570">.</span><span class="ident" id="4886571">palette</span>&nbsp;<span class="op" id="4886579">=</span>&nbsp;<span class="ident" id="4886581">d</span><span class="op" id="4886582">.</span><span class="ident" id="4886583">palette</span><span class="op" id="4886590">[</span><span class="op" id="4886591">:</span><span class="ident" id="4886592">n</span><span class="op" id="4886593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886601">for</span>&nbsp;<span class="ident" id="4886605">i</span>&nbsp;<span class="op" id="4886607">:=</span>&nbsp;<span class="num" id="4886610">0</span><span class="op" id="4886611">;</span>&nbsp;<span class="ident" id="4886613">i</span>&nbsp;<span class="op" id="4886615">&lt;</span>&nbsp;<span class="ident" id="4886617">n</span><span class="op" id="4886618">;</span>&nbsp;<span class="ident" id="4886620">i</span><span class="op" id="4886621">++</span>&nbsp;<span class="op" id="4886624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886629">rgba</span>&nbsp;<span class="op" id="4886634">:=</span>&nbsp;<span class="ident" id="4886637">d</span><span class="op" id="4886638">.</span><span class="ident" id="4886639">palette</span><span class="op" id="4886646">[</span><span class="ident" id="4886647">i</span><span class="op" id="4886648">]</span><span class="op" id="4886649">.</span><span class="op" id="4886650">(</span><span class="ident" id="4886651">color</span><span class="op" id="4886656">.</span><span class="ident" id="4886657">RGBA</span><span class="op" id="4886661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886666">d</span><span class="op" id="4886667">.</span><span class="ident" id="4886668">palette</span><span class="op" id="4886675">[</span><span class="ident" id="4886676">i</span><span class="op" id="4886677">]</span>&nbsp;<span class="op" id="4886679">=</span>&nbsp;<span class="ident" id="4886681">color</span><span class="op" id="4886686">.</span><span class="ident" id="4886687">NRGBA</span><span class="op" id="4886692">{</span><span class="ident" id="4886693">rgba</span><span class="op" id="4886697">.</span><span class="ident" id="4886698">R</span><span class="op" id="4886699">,</span>&nbsp;<span class="ident" id="4886701">rgba</span><span class="op" id="4886705">.</span><span class="ident" id="4886706">G</span><span class="op" id="4886707">,</span>&nbsp;<span class="ident" id="4886709">rgba</span><span class="op" id="4886713">.</span><span class="ident" id="4886714">B</span><span class="op" id="4886715">,</span>&nbsp;<span class="ident" id="4886717">d</span><span class="op" id="4886718">.</span><span class="ident" id="4886719">tmp</span><span class="op" id="4886722">[</span><span class="ident" id="4886723">i</span><span class="op" id="4886724">]</span><span class="op" id="4886725">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886732">case</span>&nbsp;<span class="ident" id="4886737">cbGA8</span><span class="op" id="4886742">,</span>&nbsp;<span class="ident" id="4886744">cbGA16</span><span class="op" id="4886750">,</span>&nbsp;<span class="ident" id="4886752">cbTCA8</span><span class="op" id="4886758">,</span>&nbsp;<span class="ident" id="4886760">cbTCA16</span><span class="op" id="4886767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886771">return</span>&nbsp;<span class="ident" id="4886778">FormatError</span><span class="op" id="4886789">(</span><span class="string" id="4886790">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="4886817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886823">return</span>&nbsp;<span class="ident" id="4886830">d</span><span class="op" id="4886831">.</span><span class="ident" id="4886832">verifyChecksum</span><span class="op" id="4886846">(</span><span class="op" id="4886847">)</span><br>
<span class="lineno">275</span><span class="op" id="4886849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4886852">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4886929">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="4887002">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="4887063">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4887143">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4887223">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4887300">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="4887355">func</span>&nbsp;<span class="op" id="4887360">(</span><span class="ident" id="4887361">d</span>&nbsp;<span class="op" id="4887363">*</span><span class="ident" id="4887364">decoder</span><span class="op" id="4887371">)</span>&nbsp;<span class="ident" id="4887373">Read</span><span class="op" id="4887377">(</span><span class="ident" id="4887378">p</span>&nbsp;<span class="op" id="4887380">[</span><span class="op" id="4887381">]</span><span class="builtintype" id="4887382">byte</span><span class="op" id="4887386">)</span>&nbsp;<span class="op" id="4887388">(</span><span class="builtintype" id="4887389">int</span><span class="op" id="4887392">,</span>&nbsp;<span class="builtintype" id="4887394">error</span><span class="op" id="4887399">)</span>&nbsp;<span class="op" id="4887401">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887404">if</span>&nbsp;<span class="builtinfunc" id="4887407">len</span><span class="op" id="4887410">(</span><span class="ident" id="4887411">p</span><span class="op" id="4887412">)</span>&nbsp;<span class="op" id="4887414">==</span>&nbsp;<span class="num" id="4887417">0</span>&nbsp;<span class="op" id="4887419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887423">return</span>&nbsp;<span class="num" id="4887430">0</span><span class="op" id="4887431">,</span>&nbsp;<span class="ident" id="4887433">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887441">for</span>&nbsp;<span class="ident" id="4887445">d</span><span class="op" id="4887446">.</span><span class="ident" id="4887447">idatLength</span>&nbsp;<span class="op" id="4887458">==</span>&nbsp;<span class="num" id="4887461">0</span>&nbsp;<span class="op" id="4887463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4887467">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887540">if</span>&nbsp;<span class="ident" id="4887543">err</span>&nbsp;<span class="op" id="4887547">:=</span>&nbsp;<span class="ident" id="4887550">d</span><span class="op" id="4887551">.</span><span class="ident" id="4887552">verifyChecksum</span><span class="op" id="4887566">(</span><span class="op" id="4887567">)</span><span class="op" id="4887568">;</span>&nbsp;<span class="ident" id="4887570">err</span>&nbsp;<span class="op" id="4887574">!=</span>&nbsp;<span class="ident" id="4887577">nil</span>&nbsp;<span class="op" id="4887581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887586">return</span>&nbsp;<span class="num" id="4887593">0</span><span class="op" id="4887594">,</span>&nbsp;<span class="ident" id="4887596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4887606">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4887676">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887702">if</span>&nbsp;<span class="ident" id="4887705">_</span><span class="op" id="4887706">,</span>&nbsp;<span class="ident" id="4887708">err</span>&nbsp;<span class="op" id="4887712">:=</span>&nbsp;<span class="ident" id="4887715">io</span><span class="op" id="4887717">.</span><span class="ident" id="4887718">ReadFull</span><span class="op" id="4887726">(</span><span class="ident" id="4887727">d</span><span class="op" id="4887728">.</span><span class="ident" id="4887729">r</span><span class="op" id="4887730">,</span>&nbsp;<span class="ident" id="4887732">d</span><span class="op" id="4887733">.</span><span class="ident" id="4887734">tmp</span><span class="op" id="4887737">[</span><span class="op" id="4887738">:</span><span class="num" id="4887739">8</span><span class="op" id="4887740">]</span><span class="op" id="4887741">)</span><span class="op" id="4887742">;</span>&nbsp;<span class="ident" id="4887744">err</span>&nbsp;<span class="op" id="4887748">!=</span>&nbsp;<span class="ident" id="4887751">nil</span>&nbsp;<span class="op" id="4887755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887760">return</span>&nbsp;<span class="num" id="4887767">0</span><span class="op" id="4887768">,</span>&nbsp;<span class="ident" id="4887770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887780">d</span><span class="op" id="4887781">.</span><span class="ident" id="4887782">idatLength</span>&nbsp;<span class="op" id="4887793">=</span>&nbsp;<span class="ident" id="4887795">binary</span><span class="op" id="4887801">.</span><span class="ident" id="4887802">BigEndian</span><span class="op" id="4887811">.</span><span class="ident" id="4887812">Uint32</span><span class="op" id="4887818">(</span><span class="ident" id="4887819">d</span><span class="op" id="4887820">.</span><span class="ident" id="4887821">tmp</span><span class="op" id="4887824">[</span><span class="op" id="4887825">:</span><span class="num" id="4887826">4</span><span class="op" id="4887827">]</span><span class="op" id="4887828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887832">if</span>&nbsp;<span class="builtintype" id="4887835">string</span><span class="op" id="4887841">(</span><span class="ident" id="4887842">d</span><span class="op" id="4887843">.</span><span class="ident" id="4887844">tmp</span><span class="op" id="4887847">[</span><span class="num" id="4887848">4</span><span class="op" id="4887849">:</span><span class="num" id="4887850">8</span><span class="op" id="4887851">]</span><span class="op" id="4887852">)</span>&nbsp;<span class="op" id="4887854">!=</span>&nbsp;<span class="string" id="4887857">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="4887864">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887869">return</span>&nbsp;<span class="num" id="4887876">0</span><span class="op" id="4887877">,</span>&nbsp;<span class="ident" id="4887879">FormatError</span><span class="op" id="4887890">(</span><span class="string" id="4887891">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="4887914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887922">d</span><span class="op" id="4887923">.</span><span class="ident" id="4887924">crc</span><span class="op" id="4887927">.</span><span class="ident" id="4887928">Reset</span><span class="op" id="4887933">(</span><span class="op" id="4887934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887938">d</span><span class="op" id="4887939">.</span><span class="ident" id="4887940">crc</span><span class="op" id="4887943">.</span><span class="ident" id="4887944">Write</span><span class="op" id="4887949">(</span><span class="ident" id="4887950">d</span><span class="op" id="4887951">.</span><span class="ident" id="4887952">tmp</span><span class="op" id="4887955">[</span><span class="num" id="4887956">4</span><span class="op" id="4887957">:</span><span class="num" id="4887958">8</span><span class="op" id="4887959">]</span><span class="op" id="4887960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887963">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887966">if</span>&nbsp;<span class="builtintype" id="4887969">int</span><span class="op" id="4887972">(</span><span class="ident" id="4887973">d</span><span class="op" id="4887974">.</span><span class="ident" id="4887975">idatLength</span><span class="op" id="4887985">)</span>&nbsp;<span class="op" id="4887987">&lt;</span>&nbsp;<span class="num" id="4887989">0</span>&nbsp;<span class="op" id="4887991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887995">return</span>&nbsp;<span class="num" id="4888002">0</span><span class="op" id="4888003">,</span>&nbsp;<span class="ident" id="4888005">UnsupportedError</span><span class="op" id="4888021">(</span><span class="string" id="4888022">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="4888050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888056">n</span><span class="op" id="4888057">,</span>&nbsp;<span class="ident" id="4888059">err</span>&nbsp;<span class="op" id="4888063">:=</span>&nbsp;<span class="ident" id="4888066">d</span><span class="op" id="4888067">.</span><span class="ident" id="4888068">r</span><span class="op" id="4888069">.</span><span class="ident" id="4888070">Read</span><span class="op" id="4888074">(</span><span class="ident" id="4888075">p</span><span class="op" id="4888076">[</span><span class="op" id="4888077">:</span><span class="ident" id="4888078">min</span><span class="op" id="4888081">(</span><span class="builtinfunc" id="4888082">len</span><span class="op" id="4888085">(</span><span class="ident" id="4888086">p</span><span class="op" id="4888087">)</span><span class="op" id="4888088">,</span>&nbsp;<span class="builtintype" id="4888090">int</span><span class="op" id="4888093">(</span><span class="ident" id="4888094">d</span><span class="op" id="4888095">.</span><span class="ident" id="4888096">idatLength</span><span class="op" id="4888106">)</span><span class="op" id="4888107">)</span><span class="op" id="4888108">]</span><span class="op" id="4888109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888112">d</span><span class="op" id="4888113">.</span><span class="ident" id="4888114">crc</span><span class="op" id="4888117">.</span><span class="ident" id="4888118">Write</span><span class="op" id="4888123">(</span><span class="ident" id="4888124">p</span><span class="op" id="4888125">[</span><span class="op" id="4888126">:</span><span class="ident" id="4888127">n</span><span class="op" id="4888128">]</span><span class="op" id="4888129">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888132">d</span><span class="op" id="4888133">.</span><span class="ident" id="4888134">idatLength</span>&nbsp;<span class="op" id="4888145">-=</span>&nbsp;<span class="builtintype" id="4888148">uint32</span><span class="op" id="4888154">(</span><span class="ident" id="4888155">n</span><span class="op" id="4888156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888159">return</span>&nbsp;<span class="ident" id="4888166">n</span><span class="op" id="4888167">,</span>&nbsp;<span class="ident" id="4888169">err</span><br>
<span class="lineno"></span><span class="op" id="4888173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4888176">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="4888223">func</span>&nbsp;<span class="op" id="4888228">(</span><span class="ident" id="4888229">d</span>&nbsp;<span class="op" id="4888231">*</span><span class="ident" id="4888232">decoder</span><span class="op" id="4888239">)</span>&nbsp;<span class="ident" id="4888241">decode</span><span class="op" id="4888247">(</span><span class="op" id="4888248">)</span>&nbsp;<span class="op" id="4888250">(</span><span class="ident" id="4888251">image</span><span class="op" id="4888256">.</span><span class="ident" id="4888257">Image</span><span class="op" id="4888262">,</span>&nbsp;<span class="builtintype" id="4888264">error</span><span class="op" id="4888269">)</span>&nbsp;<span class="op" id="4888271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888274">r</span><span class="op" id="4888275">,</span>&nbsp;<span class="ident" id="4888277">err</span>&nbsp;<span class="op" id="4888281">:=</span>&nbsp;<span class="ident" id="4888284">zlib</span><span class="op" id="4888288">.</span><span class="ident" id="4888289">NewReader</span><span class="op" id="4888298">(</span><span class="ident" id="4888299">d</span><span class="op" id="4888300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888303">if</span>&nbsp;<span class="ident" id="4888306">err</span>&nbsp;<span class="op" id="4888310">!=</span>&nbsp;<span class="ident" id="4888313">nil</span>&nbsp;<span class="op" id="4888317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888321">return</span>&nbsp;<span class="ident" id="4888328">nil</span><span class="op" id="4888331">,</span>&nbsp;<span class="ident" id="4888333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888338">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888341">defer</span>&nbsp;<span class="ident" id="4888347">r</span><span class="op" id="4888348">.</span><span class="ident" id="4888349">Close</span><span class="op" id="4888354">(</span><span class="op" id="4888355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888358">var</span>&nbsp;<span class="ident" id="4888362">img</span>&nbsp;<span class="ident" id="4888366">image</span><span class="op" id="4888371">.</span><span class="ident" id="4888372">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888379">if</span>&nbsp;<span class="ident" id="4888382">d</span><span class="op" id="4888383">.</span><span class="ident" id="4888384">interlace</span>&nbsp;<span class="op" id="4888394">==</span>&nbsp;<span class="ident" id="4888397">itNone</span>&nbsp;<span class="op" id="4888404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888408">img</span><span class="op" id="4888411">,</span>&nbsp;<span class="ident" id="4888413">err</span>&nbsp;<span class="op" id="4888417">=</span>&nbsp;<span class="ident" id="4888419">d</span><span class="op" id="4888420">.</span><span class="ident" id="4888421">readImagePass</span><span class="op" id="4888434">(</span><span class="ident" id="4888435">r</span><span class="op" id="4888436">,</span>&nbsp;<span class="num" id="4888438">0</span><span class="op" id="4888439">,</span>&nbsp;<span class="builtintype" id="4888441">false</span><span class="op" id="4888446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888449">}</span>&nbsp;<span class="keyword" id="4888451">else</span>&nbsp;<span class="keyword" id="4888456">if</span>&nbsp;<span class="ident" id="4888459">d</span><span class="op" id="4888460">.</span><span class="ident" id="4888461">interlace</span>&nbsp;<span class="op" id="4888471">==</span>&nbsp;<span class="ident" id="4888474">itAdam7</span>&nbsp;<span class="op" id="4888482">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4888486">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888532">img</span><span class="op" id="4888535">,</span>&nbsp;<span class="ident" id="4888537">err</span>&nbsp;<span class="op" id="4888541">=</span>&nbsp;<span class="ident" id="4888543">d</span><span class="op" id="4888544">.</span><span class="ident" id="4888545">readImagePass</span><span class="op" id="4888558">(</span><span class="ident" id="4888559">nil</span><span class="op" id="4888562">,</span>&nbsp;<span class="num" id="4888564">0</span><span class="op" id="4888565">,</span>&nbsp;<span class="builtintype" id="4888567">true</span><span class="op" id="4888571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888575">for</span>&nbsp;<span class="ident" id="4888579">pass</span>&nbsp;<span class="op" id="4888584">:=</span>&nbsp;<span class="num" id="4888587">0</span><span class="op" id="4888588">;</span>&nbsp;<span class="ident" id="4888590">pass</span>&nbsp;<span class="op" id="4888595">&lt;</span>&nbsp;<span class="num" id="4888597">7</span><span class="op" id="4888598">;</span>&nbsp;<span class="ident" id="4888600">pass</span><span class="op" id="4888604">++</span>&nbsp;<span class="op" id="4888607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888612">imagePass</span><span class="op" id="4888621">,</span>&nbsp;<span class="ident" id="4888623">err</span>&nbsp;<span class="op" id="4888627">:=</span>&nbsp;<span class="ident" id="4888630">d</span><span class="op" id="4888631">.</span><span class="ident" id="4888632">readImagePass</span><span class="op" id="4888645">(</span><span class="ident" id="4888646">r</span><span class="op" id="4888647">,</span>&nbsp;<span class="ident" id="4888649">pass</span><span class="op" id="4888653">,</span>&nbsp;<span class="builtintype" id="4888655">false</span><span class="op" id="4888660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888665">if</span>&nbsp;<span class="ident" id="4888668">err</span>&nbsp;<span class="op" id="4888672">!=</span>&nbsp;<span class="ident" id="4888675">nil</span>&nbsp;<span class="op" id="4888679">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888685">return</span>&nbsp;<span class="ident" id="4888692">nil</span><span class="op" id="4888695">,</span>&nbsp;<span class="ident" id="4888697">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888709">d</span><span class="op" id="4888710">.</span><span class="ident" id="4888711">mergePassInto</span><span class="op" id="4888724">(</span><span class="ident" id="4888725">img</span><span class="op" id="4888728">,</span>&nbsp;<span class="ident" id="4888730">imagePass</span><span class="op" id="4888739">,</span>&nbsp;<span class="ident" id="4888741">pass</span><span class="op" id="4888745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888752">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4888756">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888804">n</span>&nbsp;<span class="op" id="4888806">:=</span>&nbsp;<span class="num" id="4888809">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888812">for</span>&nbsp;<span class="ident" id="4888816">i</span>&nbsp;<span class="op" id="4888818">:=</span>&nbsp;<span class="num" id="4888821">0</span><span class="op" id="4888822">;</span>&nbsp;<span class="ident" id="4888824">n</span>&nbsp;<span class="op" id="4888826">==</span>&nbsp;<span class="num" id="4888829">0</span>&nbsp;<span class="op" id="4888831">&amp;&amp;</span>&nbsp;<span class="ident" id="4888834">err</span>&nbsp;<span class="op" id="4888838">==</span>&nbsp;<span class="ident" id="4888841">nil</span><span class="op" id="4888844">;</span>&nbsp;<span class="ident" id="4888846">i</span><span class="op" id="4888847">++</span>&nbsp;<span class="op" id="4888850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888854">if</span>&nbsp;<span class="ident" id="4888857">i</span>&nbsp;<span class="op" id="4888859">==</span>&nbsp;<span class="num" id="4888862">100</span>&nbsp;<span class="op" id="4888866">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888871">return</span>&nbsp;<span class="ident" id="4888878">nil</span><span class="op" id="4888881">,</span>&nbsp;<span class="ident" id="4888883">io</span><span class="op" id="4888885">.</span><span class="ident" id="4888886">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888906">n</span><span class="op" id="4888907">,</span>&nbsp;<span class="ident" id="4888909">err</span>&nbsp;<span class="op" id="4888913">=</span>&nbsp;<span class="ident" id="4888915">r</span><span class="op" id="4888916">.</span><span class="ident" id="4888917">Read</span><span class="op" id="4888921">(</span><span class="ident" id="4888922">d</span><span class="op" id="4888923">.</span><span class="ident" id="4888924">tmp</span><span class="op" id="4888927">[</span><span class="op" id="4888928">:</span><span class="num" id="4888929">1</span><span class="op" id="4888930">]</span><span class="op" id="4888931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888937">if</span>&nbsp;<span class="ident" id="4888940">err</span>&nbsp;<span class="op" id="4888944">!=</span>&nbsp;<span class="ident" id="4888947">nil</span>&nbsp;<span class="op" id="4888951">&amp;&amp;</span>&nbsp;<span class="ident" id="4888954">err</span>&nbsp;<span class="op" id="4888958">!=</span>&nbsp;<span class="ident" id="4888961">io</span><span class="op" id="4888963">.</span><span class="ident" id="4888964">EOF</span>&nbsp;<span class="op" id="4888968">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888972">return</span>&nbsp;<span class="ident" id="4888979">nil</span><span class="op" id="4888982">,</span>&nbsp;<span class="ident" id="4888984">FormatError</span><span class="op" id="4888995">(</span><span class="ident" id="4888996">err</span><span class="op" id="4888999">.</span><span class="ident" id="4889000">Error</span><span class="op" id="4889005">(</span><span class="op" id="4889006">)</span><span class="op" id="4889007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4889010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889013">if</span>&nbsp;<span class="ident" id="4889016">n</span>&nbsp;<span class="op" id="4889018">!=</span>&nbsp;<span class="num" id="4889021">0</span>&nbsp;<span class="op" id="4889023">||</span>&nbsp;<span class="ident" id="4889026">d</span><span class="op" id="4889027">.</span><span class="ident" id="4889028">idatLength</span>&nbsp;<span class="op" id="4889039">!=</span>&nbsp;<span class="num" id="4889042">0</span>&nbsp;<span class="op" id="4889044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889048">return</span>&nbsp;<span class="ident" id="4889055">nil</span><span class="op" id="4889058">,</span>&nbsp;<span class="ident" id="4889060">FormatError</span><span class="op" id="4889071">(</span><span class="string" id="4889072">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="4889093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4889096">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889100">return</span>&nbsp;<span class="ident" id="4889107">img</span><span class="op" id="4889110">,</span>&nbsp;<span class="ident" id="4889112">nil</span><br>
<span class="lineno"></span><span class="op" id="4889116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4889119">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="4889199">func</span>&nbsp;<span class="op" id="4889204">(</span><span class="ident" id="4889205">d</span>&nbsp;<span class="op" id="4889207">*</span><span class="ident" id="4889208">decoder</span><span class="op" id="4889215">)</span>&nbsp;<span class="ident" id="4889217">readImagePass</span><span class="op" id="4889230">(</span><span class="ident" id="4889231">r</span>&nbsp;<span class="ident" id="4889233">io</span><span class="op" id="4889235">.</span><span class="ident" id="4889236">Reader</span><span class="op" id="4889242">,</span>&nbsp;<span class="ident" id="4889244">pass</span>&nbsp;<span class="builtintype" id="4889249">int</span><span class="op" id="4889252">,</span>&nbsp;<span class="ident" id="4889254">allocateOnly</span>&nbsp;<span class="builtintype" id="4889267">bool</span><span class="op" id="4889271">)</span>&nbsp;<span class="op" id="4889273">(</span><span class="ident" id="4889274">image</span><span class="op" id="4889279">.</span><span class="ident" id="4889280">Image</span><span class="op" id="4889285">,</span>&nbsp;<span class="builtintype" id="4889287">error</span><span class="op" id="4889292">)</span>&nbsp;<span class="op" id="4889294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889297">var</span>&nbsp;<span class="ident" id="4889301">bitsPerPixel</span>&nbsp;<span class="builtintype" id="4889314">int</span>&nbsp;<span class="op" id="4889318">=</span>&nbsp;<span class="num" id="4889320">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889323">pixOffset</span>&nbsp;<span class="op" id="4889333">:=</span>&nbsp;<span class="num" id="4889336">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889339">var</span>&nbsp;<span class="op" id="4889343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889347">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889356">*</span><span class="ident" id="4889357">image</span><span class="op" id="4889362">.</span><span class="ident" id="4889363">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889370">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889379">*</span><span class="ident" id="4889380">image</span><span class="op" id="4889385">.</span><span class="ident" id="4889386">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889393">paletted</span>&nbsp;<span class="op" id="4889402">*</span><span class="ident" id="4889403">image</span><span class="op" id="4889408">.</span><span class="ident" id="4889409">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889420">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4889429">*</span><span class="ident" id="4889430">image</span><span class="op" id="4889435">.</span><span class="ident" id="4889436">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889444">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4889453">*</span><span class="ident" id="4889454">image</span><span class="op" id="4889459">.</span><span class="ident" id="4889460">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889469">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4889478">*</span><span class="ident" id="4889479">image</span><span class="op" id="4889484">.</span><span class="ident" id="4889485">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889494">nrgba64</span>&nbsp;&nbsp;<span class="op" id="4889503">*</span><span class="ident" id="4889504">image</span><span class="op" id="4889509">.</span><span class="ident" id="4889510">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889520">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4889529">image</span><span class="op" id="4889534">.</span><span class="ident" id="4889535">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4889542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889545">width</span><span class="op" id="4889550">,</span>&nbsp;<span class="ident" id="4889552">height</span>&nbsp;<span class="op" id="4889559">:=</span>&nbsp;<span class="ident" id="4889562">d</span><span class="op" id="4889563">.</span><span class="ident" id="4889564">width</span><span class="op" id="4889569">,</span>&nbsp;<span class="ident" id="4889571">d</span><span class="op" id="4889572">.</span><span class="ident" id="4889573">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889581">if</span>&nbsp;<span class="ident" id="4889584">d</span><span class="op" id="4889585">.</span><span class="ident" id="4889586">interlace</span>&nbsp;<span class="op" id="4889596">==</span>&nbsp;<span class="ident" id="4889599">itAdam7</span>&nbsp;<span class="op" id="4889607">&amp;&amp;</span>&nbsp;<span class="op" id="4889610">!</span><span class="ident" id="4889611">allocateOnly</span>&nbsp;<span class="op" id="4889624">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889628">p</span>&nbsp;<span class="op" id="4889630">:=</span>&nbsp;<span class="ident" id="4889633">interlacing</span><span class="op" id="4889644">[</span><span class="ident" id="4889645">pass</span><span class="op" id="4889649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4889653">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889731">width</span>&nbsp;<span class="op" id="4889737">=</span>&nbsp;<span class="op" id="4889739">(</span><span class="ident" id="4889740">width</span>&nbsp;<span class="op" id="4889746">-</span>&nbsp;<span class="ident" id="4889748">p</span><span class="op" id="4889749">.</span><span class="ident" id="4889750">xOffset</span>&nbsp;<span class="op" id="4889758">+</span>&nbsp;<span class="ident" id="4889760">p</span><span class="op" id="4889761">.</span><span class="ident" id="4889762">xFactor</span>&nbsp;<span class="op" id="4889770">-</span>&nbsp;<span class="num" id="4889772">1</span><span class="op" id="4889773">)</span>&nbsp;<span class="op" id="4889775">/</span>&nbsp;<span class="ident" id="4889777">p</span><span class="op" id="4889778">.</span><span class="ident" id="4889779">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889789">height</span>&nbsp;<span class="op" id="4889796">=</span>&nbsp;<span class="op" id="4889798">(</span><span class="ident" id="4889799">height</span>&nbsp;<span class="op" id="4889806">-</span>&nbsp;<span class="ident" id="4889808">p</span><span class="op" id="4889809">.</span><span class="ident" id="4889810">yOffset</span>&nbsp;<span class="op" id="4889818">+</span>&nbsp;<span class="ident" id="4889820">p</span><span class="op" id="4889821">.</span><span class="ident" id="4889822">yFactor</span>&nbsp;<span class="op" id="4889830">-</span>&nbsp;<span class="num" id="4889832">1</span><span class="op" id="4889833">)</span>&nbsp;<span class="op" id="4889835">/</span>&nbsp;<span class="ident" id="4889837">p</span><span class="op" id="4889838">.</span><span class="ident" id="4889839">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4889848">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889851">switch</span>&nbsp;<span class="ident" id="4889858">d</span><span class="op" id="4889859">.</span><span class="ident" id="4889860">cb</span>&nbsp;<span class="op" id="4889863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889866">case</span>&nbsp;<span class="ident" id="4889871">cbG1</span><span class="op" id="4889875">,</span>&nbsp;<span class="ident" id="4889877">cbG2</span><span class="op" id="4889881">,</span>&nbsp;<span class="ident" id="4889883">cbG4</span><span class="op" id="4889887">,</span>&nbsp;<span class="ident" id="4889889">cbG8</span><span class="op" id="4889893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889897">bitsPerPixel</span>&nbsp;<span class="op" id="4889910">=</span>&nbsp;<span class="ident" id="4889912">d</span><span class="op" id="4889913">.</span><span class="ident" id="4889914">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889922">gray</span>&nbsp;<span class="op" id="4889927">=</span>&nbsp;<span class="ident" id="4889929">image</span><span class="op" id="4889934">.</span><span class="ident" id="4889935">NewGray</span><span class="op" id="4889942">(</span><span class="ident" id="4889943">image</span><span class="op" id="4889948">.</span><span class="ident" id="4889949">Rect</span><span class="op" id="4889953">(</span><span class="num" id="4889954">0</span><span class="op" id="4889955">,</span>&nbsp;<span class="num" id="4889957">0</span><span class="op" id="4889958">,</span>&nbsp;<span class="ident" id="4889960">width</span><span class="op" id="4889965">,</span>&nbsp;<span class="ident" id="4889967">height</span><span class="op" id="4889973">)</span><span class="op" id="4889974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4889978">img</span>&nbsp;<span class="op" id="4889982">=</span>&nbsp;<span class="ident" id="4889984">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889990">case</span>&nbsp;<span class="ident" id="4889995">cbGA8</span><span class="op" id="4890000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890004">bitsPerPixel</span>&nbsp;<span class="op" id="4890017">=</span>&nbsp;<span class="num" id="4890019">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890024">nrgba</span>&nbsp;<span class="op" id="4890030">=</span>&nbsp;<span class="ident" id="4890032">image</span><span class="op" id="4890037">.</span><span class="ident" id="4890038">NewNRGBA</span><span class="op" id="4890046">(</span><span class="ident" id="4890047">image</span><span class="op" id="4890052">.</span><span class="ident" id="4890053">Rect</span><span class="op" id="4890057">(</span><span class="num" id="4890058">0</span><span class="op" id="4890059">,</span>&nbsp;<span class="num" id="4890061">0</span><span class="op" id="4890062">,</span>&nbsp;<span class="ident" id="4890064">width</span><span class="op" id="4890069">,</span>&nbsp;<span class="ident" id="4890071">height</span><span class="op" id="4890077">)</span><span class="op" id="4890078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890082">img</span>&nbsp;<span class="op" id="4890086">=</span>&nbsp;<span class="ident" id="4890088">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890095">case</span>&nbsp;<span class="ident" id="4890100">cbTC8</span><span class="op" id="4890105">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890109">bitsPerPixel</span>&nbsp;<span class="op" id="4890122">=</span>&nbsp;<span class="num" id="4890124">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890129">rgba</span>&nbsp;<span class="op" id="4890134">=</span>&nbsp;<span class="ident" id="4890136">image</span><span class="op" id="4890141">.</span><span class="ident" id="4890142">NewRGBA</span><span class="op" id="4890149">(</span><span class="ident" id="4890150">image</span><span class="op" id="4890155">.</span><span class="ident" id="4890156">Rect</span><span class="op" id="4890160">(</span><span class="num" id="4890161">0</span><span class="op" id="4890162">,</span>&nbsp;<span class="num" id="4890164">0</span><span class="op" id="4890165">,</span>&nbsp;<span class="ident" id="4890167">width</span><span class="op" id="4890172">,</span>&nbsp;<span class="ident" id="4890174">height</span><span class="op" id="4890180">)</span><span class="op" id="4890181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890185">img</span>&nbsp;<span class="op" id="4890189">=</span>&nbsp;<span class="ident" id="4890191">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890197">case</span>&nbsp;<span class="ident" id="4890202">cbP1</span><span class="op" id="4890206">,</span>&nbsp;<span class="ident" id="4890208">cbP2</span><span class="op" id="4890212">,</span>&nbsp;<span class="ident" id="4890214">cbP4</span><span class="op" id="4890218">,</span>&nbsp;<span class="ident" id="4890220">cbP8</span><span class="op" id="4890224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890228">bitsPerPixel</span>&nbsp;<span class="op" id="4890241">=</span>&nbsp;<span class="ident" id="4890243">d</span><span class="op" id="4890244">.</span><span class="ident" id="4890245">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890253">paletted</span>&nbsp;<span class="op" id="4890262">=</span>&nbsp;<span class="ident" id="4890264">image</span><span class="op" id="4890269">.</span><span class="ident" id="4890270">NewPaletted</span><span class="op" id="4890281">(</span><span class="ident" id="4890282">image</span><span class="op" id="4890287">.</span><span class="ident" id="4890288">Rect</span><span class="op" id="4890292">(</span><span class="num" id="4890293">0</span><span class="op" id="4890294">,</span>&nbsp;<span class="num" id="4890296">0</span><span class="op" id="4890297">,</span>&nbsp;<span class="ident" id="4890299">width</span><span class="op" id="4890304">,</span>&nbsp;<span class="ident" id="4890306">height</span><span class="op" id="4890312">)</span><span class="op" id="4890313">,</span>&nbsp;<span class="ident" id="4890315">d</span><span class="op" id="4890316">.</span><span class="ident" id="4890317">palette</span><span class="op" id="4890324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890328">img</span>&nbsp;<span class="op" id="4890332">=</span>&nbsp;<span class="ident" id="4890334">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890344">case</span>&nbsp;<span class="ident" id="4890349">cbTCA8</span><span class="op" id="4890355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890359">bitsPerPixel</span>&nbsp;<span class="op" id="4890372">=</span>&nbsp;<span class="num" id="4890374">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890379">nrgba</span>&nbsp;<span class="op" id="4890385">=</span>&nbsp;<span class="ident" id="4890387">image</span><span class="op" id="4890392">.</span><span class="ident" id="4890393">NewNRGBA</span><span class="op" id="4890401">(</span><span class="ident" id="4890402">image</span><span class="op" id="4890407">.</span><span class="ident" id="4890408">Rect</span><span class="op" id="4890412">(</span><span class="num" id="4890413">0</span><span class="op" id="4890414">,</span>&nbsp;<span class="num" id="4890416">0</span><span class="op" id="4890417">,</span>&nbsp;<span class="ident" id="4890419">width</span><span class="op" id="4890424">,</span>&nbsp;<span class="ident" id="4890426">height</span><span class="op" id="4890432">)</span><span class="op" id="4890433">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890437">img</span>&nbsp;<span class="op" id="4890441">=</span>&nbsp;<span class="ident" id="4890443">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890450">case</span>&nbsp;<span class="ident" id="4890455">cbG16</span><span class="op" id="4890460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890464">bitsPerPixel</span>&nbsp;<span class="op" id="4890477">=</span>&nbsp;<span class="num" id="4890479">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890484">gray16</span>&nbsp;<span class="op" id="4890491">=</span>&nbsp;<span class="ident" id="4890493">image</span><span class="op" id="4890498">.</span><span class="ident" id="4890499">NewGray16</span><span class="op" id="4890508">(</span><span class="ident" id="4890509">image</span><span class="op" id="4890514">.</span><span class="ident" id="4890515">Rect</span><span class="op" id="4890519">(</span><span class="num" id="4890520">0</span><span class="op" id="4890521">,</span>&nbsp;<span class="num" id="4890523">0</span><span class="op" id="4890524">,</span>&nbsp;<span class="ident" id="4890526">width</span><span class="op" id="4890531">,</span>&nbsp;<span class="ident" id="4890533">height</span><span class="op" id="4890539">)</span><span class="op" id="4890540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890544">img</span>&nbsp;<span class="op" id="4890548">=</span>&nbsp;<span class="ident" id="4890550">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890558">case</span>&nbsp;<span class="ident" id="4890563">cbGA16</span><span class="op" id="4890569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890573">bitsPerPixel</span>&nbsp;<span class="op" id="4890586">=</span>&nbsp;<span class="num" id="4890588">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890593">nrgba64</span>&nbsp;<span class="op" id="4890601">=</span>&nbsp;<span class="ident" id="4890603">image</span><span class="op" id="4890608">.</span><span class="ident" id="4890609">NewNRGBA64</span><span class="op" id="4890619">(</span><span class="ident" id="4890620">image</span><span class="op" id="4890625">.</span><span class="ident" id="4890626">Rect</span><span class="op" id="4890630">(</span><span class="num" id="4890631">0</span><span class="op" id="4890632">,</span>&nbsp;<span class="num" id="4890634">0</span><span class="op" id="4890635">,</span>&nbsp;<span class="ident" id="4890637">width</span><span class="op" id="4890642">,</span>&nbsp;<span class="ident" id="4890644">height</span><span class="op" id="4890650">)</span><span class="op" id="4890651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890655">img</span>&nbsp;<span class="op" id="4890659">=</span>&nbsp;<span class="ident" id="4890661">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890670">case</span>&nbsp;<span class="ident" id="4890675">cbTC16</span><span class="op" id="4890681">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890685">bitsPerPixel</span>&nbsp;<span class="op" id="4890698">=</span>&nbsp;<span class="num" id="4890700">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890705">rgba64</span>&nbsp;<span class="op" id="4890712">=</span>&nbsp;<span class="ident" id="4890714">image</span><span class="op" id="4890719">.</span><span class="ident" id="4890720">NewRGBA64</span><span class="op" id="4890729">(</span><span class="ident" id="4890730">image</span><span class="op" id="4890735">.</span><span class="ident" id="4890736">Rect</span><span class="op" id="4890740">(</span><span class="num" id="4890741">0</span><span class="op" id="4890742">,</span>&nbsp;<span class="num" id="4890744">0</span><span class="op" id="4890745">,</span>&nbsp;<span class="ident" id="4890747">width</span><span class="op" id="4890752">,</span>&nbsp;<span class="ident" id="4890754">height</span><span class="op" id="4890760">)</span><span class="op" id="4890761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890765">img</span>&nbsp;<span class="op" id="4890769">=</span>&nbsp;<span class="ident" id="4890771">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890779">case</span>&nbsp;<span class="ident" id="4890784">cbTCA16</span><span class="op" id="4890791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890795">bitsPerPixel</span>&nbsp;<span class="op" id="4890808">=</span>&nbsp;<span class="num" id="4890810">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890815">nrgba64</span>&nbsp;<span class="op" id="4890823">=</span>&nbsp;<span class="ident" id="4890825">image</span><span class="op" id="4890830">.</span><span class="ident" id="4890831">NewNRGBA64</span><span class="op" id="4890841">(</span><span class="ident" id="4890842">image</span><span class="op" id="4890847">.</span><span class="ident" id="4890848">Rect</span><span class="op" id="4890852">(</span><span class="num" id="4890853">0</span><span class="op" id="4890854">,</span>&nbsp;<span class="num" id="4890856">0</span><span class="op" id="4890857">,</span>&nbsp;<span class="ident" id="4890859">width</span><span class="op" id="4890864">,</span>&nbsp;<span class="ident" id="4890866">height</span><span class="op" id="4890872">)</span><span class="op" id="4890873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890877">img</span>&nbsp;<span class="op" id="4890881">=</span>&nbsp;<span class="ident" id="4890883">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890895">if</span>&nbsp;<span class="ident" id="4890898">allocateOnly</span>&nbsp;<span class="op" id="4890911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890915">return</span>&nbsp;<span class="ident" id="4890922">img</span><span class="op" id="4890925">,</span>&nbsp;<span class="ident" id="4890927">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890935">bytesPerPixel</span>&nbsp;<span class="op" id="4890949">:=</span>&nbsp;<span class="op" id="4890952">(</span><span class="ident" id="4890953">bitsPerPixel</span>&nbsp;<span class="op" id="4890966">+</span>&nbsp;<span class="num" id="4890968">7</span><span class="op" id="4890969">)</span>&nbsp;<span class="op" id="4890971">/</span>&nbsp;<span class="num" id="4890973">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890977">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891039">rowSize</span>&nbsp;<span class="op" id="4891047">:=</span>&nbsp;<span class="num" id="4891050">1</span>&nbsp;<span class="op" id="4891052">+</span>&nbsp;<span class="op" id="4891054">(</span><span class="ident" id="4891055">bitsPerPixel</span><span class="op" id="4891067">*</span><span class="ident" id="4891068">width</span><span class="op" id="4891073">+</span><span class="num" id="4891074">7</span><span class="op" id="4891075">)</span><span class="op" id="4891076">/</span><span class="num" id="4891077">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891080">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891142">cr</span>&nbsp;<span class="op" id="4891145">:=</span>&nbsp;<span class="builtinfunc" id="4891148">make</span><span class="op" id="4891152">(</span><span class="op" id="4891153">[</span><span class="op" id="4891154">]</span><span class="builtintype" id="4891155">uint8</span><span class="op" id="4891160">,</span>&nbsp;<span class="ident" id="4891162">rowSize</span><span class="op" id="4891169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891172">pr</span>&nbsp;<span class="op" id="4891175">:=</span>&nbsp;<span class="builtinfunc" id="4891178">make</span><span class="op" id="4891182">(</span><span class="op" id="4891183">[</span><span class="op" id="4891184">]</span><span class="builtintype" id="4891185">uint8</span><span class="op" id="4891190">,</span>&nbsp;<span class="ident" id="4891192">rowSize</span><span class="op" id="4891199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891203">for</span>&nbsp;<span class="ident" id="4891207">y</span>&nbsp;<span class="op" id="4891209">:=</span>&nbsp;<span class="num" id="4891212">0</span><span class="op" id="4891213">;</span>&nbsp;<span class="ident" id="4891215">y</span>&nbsp;<span class="op" id="4891217">&lt;</span>&nbsp;<span class="ident" id="4891219">height</span><span class="op" id="4891225">;</span>&nbsp;<span class="ident" id="4891227">y</span><span class="op" id="4891228">++</span>&nbsp;<span class="op" id="4891231">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891235">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891269">_</span><span class="op" id="4891270">,</span>&nbsp;<span class="ident" id="4891272">err</span>&nbsp;<span class="op" id="4891276">:=</span>&nbsp;<span class="ident" id="4891279">io</span><span class="op" id="4891281">.</span><span class="ident" id="4891282">ReadFull</span><span class="op" id="4891290">(</span><span class="ident" id="4891291">r</span><span class="op" id="4891292">,</span>&nbsp;<span class="ident" id="4891294">cr</span><span class="op" id="4891296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891300">if</span>&nbsp;<span class="ident" id="4891303">err</span>&nbsp;<span class="op" id="4891307">!=</span>&nbsp;<span class="ident" id="4891310">nil</span>&nbsp;<span class="op" id="4891314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891319">return</span>&nbsp;<span class="ident" id="4891326">nil</span><span class="op" id="4891329">,</span>&nbsp;<span class="ident" id="4891331">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891337">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891342">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891365">cdat</span>&nbsp;<span class="op" id="4891370">:=</span>&nbsp;<span class="ident" id="4891373">cr</span><span class="op" id="4891375">[</span><span class="num" id="4891376">1</span><span class="op" id="4891377">:</span><span class="op" id="4891378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891382">pdat</span>&nbsp;<span class="op" id="4891387">:=</span>&nbsp;<span class="ident" id="4891390">pr</span><span class="op" id="4891392">[</span><span class="num" id="4891393">1</span><span class="op" id="4891394">:</span><span class="op" id="4891395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891399">switch</span>&nbsp;<span class="ident" id="4891406">cr</span><span class="op" id="4891408">[</span><span class="num" id="4891409">0</span><span class="op" id="4891410">]</span>&nbsp;<span class="op" id="4891412">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891416">case</span>&nbsp;<span class="ident" id="4891421">ftNone</span><span class="op" id="4891427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891432">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891444">case</span>&nbsp;<span class="ident" id="4891449">ftSub</span><span class="op" id="4891454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891459">for</span>&nbsp;<span class="ident" id="4891463">i</span>&nbsp;<span class="op" id="4891465">:=</span>&nbsp;<span class="ident" id="4891468">bytesPerPixel</span><span class="op" id="4891481">;</span>&nbsp;<span class="ident" id="4891483">i</span>&nbsp;<span class="op" id="4891485">&lt;</span>&nbsp;<span class="builtinfunc" id="4891487">len</span><span class="op" id="4891490">(</span><span class="ident" id="4891491">cdat</span><span class="op" id="4891495">)</span><span class="op" id="4891496">;</span>&nbsp;<span class="ident" id="4891498">i</span><span class="op" id="4891499">++</span>&nbsp;<span class="op" id="4891502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891508">cdat</span><span class="op" id="4891512">[</span><span class="ident" id="4891513">i</span><span class="op" id="4891514">]</span>&nbsp;<span class="op" id="4891516">+=</span>&nbsp;<span class="ident" id="4891519">cdat</span><span class="op" id="4891523">[</span><span class="ident" id="4891524">i</span><span class="op" id="4891525">-</span><span class="ident" id="4891526">bytesPerPixel</span><span class="op" id="4891539">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891548">case</span>&nbsp;<span class="ident" id="4891553">ftUp</span><span class="op" id="4891557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891562">for</span>&nbsp;<span class="ident" id="4891566">i</span><span class="op" id="4891567">,</span>&nbsp;<span class="ident" id="4891569">p</span>&nbsp;<span class="op" id="4891571">:=</span>&nbsp;<span class="keyword" id="4891574">range</span>&nbsp;<span class="ident" id="4891580">pdat</span>&nbsp;<span class="op" id="4891585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891591">cdat</span><span class="op" id="4891595">[</span><span class="ident" id="4891596">i</span><span class="op" id="4891597">]</span>&nbsp;<span class="op" id="4891599">+=</span>&nbsp;<span class="ident" id="4891602">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891607">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891611">case</span>&nbsp;<span class="ident" id="4891616">ftAverage</span><span class="op" id="4891625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891630">for</span>&nbsp;<span class="ident" id="4891634">i</span>&nbsp;<span class="op" id="4891636">:=</span>&nbsp;<span class="num" id="4891639">0</span><span class="op" id="4891640">;</span>&nbsp;<span class="ident" id="4891642">i</span>&nbsp;<span class="op" id="4891644">&lt;</span>&nbsp;<span class="ident" id="4891646">bytesPerPixel</span><span class="op" id="4891659">;</span>&nbsp;<span class="ident" id="4891661">i</span><span class="op" id="4891662">++</span>&nbsp;<span class="op" id="4891665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891671">cdat</span><span class="op" id="4891675">[</span><span class="ident" id="4891676">i</span><span class="op" id="4891677">]</span>&nbsp;<span class="op" id="4891679">+=</span>&nbsp;<span class="ident" id="4891682">pdat</span><span class="op" id="4891686">[</span><span class="ident" id="4891687">i</span><span class="op" id="4891688">]</span>&nbsp;<span class="op" id="4891690">/</span>&nbsp;<span class="num" id="4891692">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891702">for</span>&nbsp;<span class="ident" id="4891706">i</span>&nbsp;<span class="op" id="4891708">:=</span>&nbsp;<span class="ident" id="4891711">bytesPerPixel</span><span class="op" id="4891724">;</span>&nbsp;<span class="ident" id="4891726">i</span>&nbsp;<span class="op" id="4891728">&lt;</span>&nbsp;<span class="builtinfunc" id="4891730">len</span><span class="op" id="4891733">(</span><span class="ident" id="4891734">cdat</span><span class="op" id="4891738">)</span><span class="op" id="4891739">;</span>&nbsp;<span class="ident" id="4891741">i</span><span class="op" id="4891742">++</span>&nbsp;<span class="op" id="4891745">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891751">cdat</span><span class="op" id="4891755">[</span><span class="ident" id="4891756">i</span><span class="op" id="4891757">]</span>&nbsp;<span class="op" id="4891759">+=</span>&nbsp;<span class="builtintype" id="4891762">uint8</span><span class="op" id="4891767">(</span><span class="op" id="4891768">(</span><span class="builtintype" id="4891769">int</span><span class="op" id="4891772">(</span><span class="ident" id="4891773">cdat</span><span class="op" id="4891777">[</span><span class="ident" id="4891778">i</span><span class="op" id="4891779">-</span><span class="ident" id="4891780">bytesPerPixel</span><span class="op" id="4891793">]</span><span class="op" id="4891794">)</span>&nbsp;<span class="op" id="4891796">+</span>&nbsp;<span class="builtintype" id="4891798">int</span><span class="op" id="4891801">(</span><span class="ident" id="4891802">pdat</span><span class="op" id="4891806">[</span><span class="ident" id="4891807">i</span><span class="op" id="4891808">]</span><span class="op" id="4891809">)</span><span class="op" id="4891810">)</span>&nbsp;<span class="op" id="4891812">/</span>&nbsp;<span class="num" id="4891814">2</span><span class="op" id="4891815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891824">case</span>&nbsp;<span class="ident" id="4891829">ftPaeth</span><span class="op" id="4891836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891841">filterPaeth</span><span class="op" id="4891852">(</span><span class="ident" id="4891853">cdat</span><span class="op" id="4891857">,</span>&nbsp;<span class="ident" id="4891859">pdat</span><span class="op" id="4891863">,</span>&nbsp;<span class="ident" id="4891865">bytesPerPixel</span><span class="op" id="4891878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891882">default</span><span class="op" id="4891889">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891894">return</span>&nbsp;<span class="ident" id="4891901">nil</span><span class="op" id="4891904">,</span>&nbsp;<span class="ident" id="4891906">FormatError</span><span class="op" id="4891917">(</span><span class="string" id="4891918">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="4891935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891944">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891979">switch</span>&nbsp;<span class="ident" id="4891986">d</span><span class="op" id="4891987">.</span><span class="ident" id="4891988">cb</span>&nbsp;<span class="op" id="4891991">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891995">case</span>&nbsp;<span class="ident" id="4892000">cbG1</span><span class="op" id="4892004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892009">for</span>&nbsp;<span class="ident" id="4892013">x</span>&nbsp;<span class="op" id="4892015">:=</span>&nbsp;<span class="num" id="4892018">0</span><span class="op" id="4892019">;</span>&nbsp;<span class="ident" id="4892021">x</span>&nbsp;<span class="op" id="4892023">&lt;</span>&nbsp;<span class="ident" id="4892025">width</span><span class="op" id="4892030">;</span>&nbsp;<span class="ident" id="4892032">x</span>&nbsp;<span class="op" id="4892034">+=</span>&nbsp;<span class="num" id="4892037">8</span>&nbsp;<span class="op" id="4892039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892045">b</span>&nbsp;<span class="op" id="4892047">:=</span>&nbsp;<span class="ident" id="4892050">cdat</span><span class="op" id="4892054">[</span><span class="ident" id="4892055">x</span><span class="op" id="4892056">/</span><span class="num" id="4892057">8</span><span class="op" id="4892058">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892064">for</span>&nbsp;<span class="ident" id="4892068">x2</span>&nbsp;<span class="op" id="4892071">:=</span>&nbsp;<span class="num" id="4892074">0</span><span class="op" id="4892075">;</span>&nbsp;<span class="ident" id="4892077">x2</span>&nbsp;<span class="op" id="4892080">&lt;</span>&nbsp;<span class="num" id="4892082">8</span>&nbsp;<span class="op" id="4892084">&amp;&amp;</span>&nbsp;<span class="ident" id="4892087">x</span><span class="op" id="4892088">+</span><span class="ident" id="4892089">x2</span>&nbsp;<span class="op" id="4892092">&lt;</span>&nbsp;<span class="ident" id="4892094">width</span><span class="op" id="4892099">;</span>&nbsp;<span class="ident" id="4892101">x2</span><span class="op" id="4892103">++</span>&nbsp;<span class="op" id="4892106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892113">gray</span><span class="op" id="4892117">.</span><span class="ident" id="4892118">SetGray</span><span class="op" id="4892125">(</span><span class="ident" id="4892126">x</span><span class="op" id="4892127">+</span><span class="ident" id="4892128">x2</span><span class="op" id="4892130">,</span>&nbsp;<span class="ident" id="4892132">y</span><span class="op" id="4892133">,</span>&nbsp;<span class="ident" id="4892135">color</span><span class="op" id="4892140">.</span><span class="ident" id="4892141">Gray</span><span class="op" id="4892145">{</span><span class="op" id="4892146">(</span><span class="ident" id="4892147">b</span>&nbsp;<span class="op" id="4892149">&gt;&gt;</span>&nbsp;<span class="num" id="4892152">7</span><span class="op" id="4892153">)</span>&nbsp;<span class="op" id="4892155">*</span>&nbsp;<span class="num" id="4892157">0xff</span><span class="op" id="4892161">}</span><span class="op" id="4892162">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892169">b</span>&nbsp;<span class="op" id="4892171">&lt;&lt;=</span>&nbsp;<span class="num" id="4892175">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892190">case</span>&nbsp;<span class="ident" id="4892195">cbG2</span><span class="op" id="4892199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892204">for</span>&nbsp;<span class="ident" id="4892208">x</span>&nbsp;<span class="op" id="4892210">:=</span>&nbsp;<span class="num" id="4892213">0</span><span class="op" id="4892214">;</span>&nbsp;<span class="ident" id="4892216">x</span>&nbsp;<span class="op" id="4892218">&lt;</span>&nbsp;<span class="ident" id="4892220">width</span><span class="op" id="4892225">;</span>&nbsp;<span class="ident" id="4892227">x</span>&nbsp;<span class="op" id="4892229">+=</span>&nbsp;<span class="num" id="4892232">4</span>&nbsp;<span class="op" id="4892234">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892240">b</span>&nbsp;<span class="op" id="4892242">:=</span>&nbsp;<span class="ident" id="4892245">cdat</span><span class="op" id="4892249">[</span><span class="ident" id="4892250">x</span><span class="op" id="4892251">/</span><span class="num" id="4892252">4</span><span class="op" id="4892253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892259">for</span>&nbsp;<span class="ident" id="4892263">x2</span>&nbsp;<span class="op" id="4892266">:=</span>&nbsp;<span class="num" id="4892269">0</span><span class="op" id="4892270">;</span>&nbsp;<span class="ident" id="4892272">x2</span>&nbsp;<span class="op" id="4892275">&lt;</span>&nbsp;<span class="num" id="4892277">4</span>&nbsp;<span class="op" id="4892279">&amp;&amp;</span>&nbsp;<span class="ident" id="4892282">x</span><span class="op" id="4892283">+</span><span class="ident" id="4892284">x2</span>&nbsp;<span class="op" id="4892287">&lt;</span>&nbsp;<span class="ident" id="4892289">width</span><span class="op" id="4892294">;</span>&nbsp;<span class="ident" id="4892296">x2</span><span class="op" id="4892298">++</span>&nbsp;<span class="op" id="4892301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892308">gray</span><span class="op" id="4892312">.</span><span class="ident" id="4892313">SetGray</span><span class="op" id="4892320">(</span><span class="ident" id="4892321">x</span><span class="op" id="4892322">+</span><span class="ident" id="4892323">x2</span><span class="op" id="4892325">,</span>&nbsp;<span class="ident" id="4892327">y</span><span class="op" id="4892328">,</span>&nbsp;<span class="ident" id="4892330">color</span><span class="op" id="4892335">.</span><span class="ident" id="4892336">Gray</span><span class="op" id="4892340">{</span><span class="op" id="4892341">(</span><span class="ident" id="4892342">b</span>&nbsp;<span class="op" id="4892344">&gt;&gt;</span>&nbsp;<span class="num" id="4892347">6</span><span class="op" id="4892348">)</span>&nbsp;<span class="op" id="4892350">*</span>&nbsp;<span class="num" id="4892352">0x55</span><span class="op" id="4892356">}</span><span class="op" id="4892357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892364">b</span>&nbsp;<span class="op" id="4892366">&lt;&lt;=</span>&nbsp;<span class="num" id="4892370">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892376">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892385">case</span>&nbsp;<span class="ident" id="4892390">cbG4</span><span class="op" id="4892394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892399">for</span>&nbsp;<span class="ident" id="4892403">x</span>&nbsp;<span class="op" id="4892405">:=</span>&nbsp;<span class="num" id="4892408">0</span><span class="op" id="4892409">;</span>&nbsp;<span class="ident" id="4892411">x</span>&nbsp;<span class="op" id="4892413">&lt;</span>&nbsp;<span class="ident" id="4892415">width</span><span class="op" id="4892420">;</span>&nbsp;<span class="ident" id="4892422">x</span>&nbsp;<span class="op" id="4892424">+=</span>&nbsp;<span class="num" id="4892427">2</span>&nbsp;<span class="op" id="4892429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892435">b</span>&nbsp;<span class="op" id="4892437">:=</span>&nbsp;<span class="ident" id="4892440">cdat</span><span class="op" id="4892444">[</span><span class="ident" id="4892445">x</span><span class="op" id="4892446">/</span><span class="num" id="4892447">2</span><span class="op" id="4892448">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892454">for</span>&nbsp;<span class="ident" id="4892458">x2</span>&nbsp;<span class="op" id="4892461">:=</span>&nbsp;<span class="num" id="4892464">0</span><span class="op" id="4892465">;</span>&nbsp;<span class="ident" id="4892467">x2</span>&nbsp;<span class="op" id="4892470">&lt;</span>&nbsp;<span class="num" id="4892472">2</span>&nbsp;<span class="op" id="4892474">&amp;&amp;</span>&nbsp;<span class="ident" id="4892477">x</span><span class="op" id="4892478">+</span><span class="ident" id="4892479">x2</span>&nbsp;<span class="op" id="4892482">&lt;</span>&nbsp;<span class="ident" id="4892484">width</span><span class="op" id="4892489">;</span>&nbsp;<span class="ident" id="4892491">x2</span><span class="op" id="4892493">++</span>&nbsp;<span class="op" id="4892496">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892503">gray</span><span class="op" id="4892507">.</span><span class="ident" id="4892508">SetGray</span><span class="op" id="4892515">(</span><span class="ident" id="4892516">x</span><span class="op" id="4892517">+</span><span class="ident" id="4892518">x2</span><span class="op" id="4892520">,</span>&nbsp;<span class="ident" id="4892522">y</span><span class="op" id="4892523">,</span>&nbsp;<span class="ident" id="4892525">color</span><span class="op" id="4892530">.</span><span class="ident" id="4892531">Gray</span><span class="op" id="4892535">{</span><span class="op" id="4892536">(</span><span class="ident" id="4892537">b</span>&nbsp;<span class="op" id="4892539">&gt;&gt;</span>&nbsp;<span class="num" id="4892542">4</span><span class="op" id="4892543">)</span>&nbsp;<span class="op" id="4892545">*</span>&nbsp;<span class="num" id="4892547">0x11</span><span class="op" id="4892551">}</span><span class="op" id="4892552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892559">b</span>&nbsp;<span class="op" id="4892561">&lt;&lt;=</span>&nbsp;<span class="num" id="4892565">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892580">case</span>&nbsp;<span class="ident" id="4892585">cbG8</span><span class="op" id="4892589">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4892594">copy</span><span class="op" id="4892598">(</span><span class="ident" id="4892599">gray</span><span class="op" id="4892603">.</span><span class="ident" id="4892604">Pix</span><span class="op" id="4892607">[</span><span class="ident" id="4892608">pixOffset</span><span class="op" id="4892617">:</span><span class="op" id="4892618">]</span><span class="op" id="4892619">,</span>&nbsp;<span class="ident" id="4892621">cdat</span><span class="op" id="4892625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892630">pixOffset</span>&nbsp;<span class="op" id="4892640">+=</span>&nbsp;<span class="ident" id="4892643">gray</span><span class="op" id="4892647">.</span><span class="ident" id="4892648">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892657">case</span>&nbsp;<span class="ident" id="4892662">cbGA8</span><span class="op" id="4892667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892672">for</span>&nbsp;<span class="ident" id="4892676">x</span>&nbsp;<span class="op" id="4892678">:=</span>&nbsp;<span class="num" id="4892681">0</span><span class="op" id="4892682">;</span>&nbsp;<span class="ident" id="4892684">x</span>&nbsp;<span class="op" id="4892686">&lt;</span>&nbsp;<span class="ident" id="4892688">width</span><span class="op" id="4892693">;</span>&nbsp;<span class="ident" id="4892695">x</span><span class="op" id="4892696">++</span>&nbsp;<span class="op" id="4892699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892705">ycol</span>&nbsp;<span class="op" id="4892710">:=</span>&nbsp;<span class="ident" id="4892713">cdat</span><span class="op" id="4892717">[</span><span class="num" id="4892718">2</span><span class="op" id="4892719">*</span><span class="ident" id="4892720">x</span><span class="op" id="4892721">+</span><span class="num" id="4892722">0</span><span class="op" id="4892723">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892729">nrgba</span><span class="op" id="4892734">.</span><span class="ident" id="4892735">SetNRGBA</span><span class="op" id="4892743">(</span><span class="ident" id="4892744">x</span><span class="op" id="4892745">,</span>&nbsp;<span class="ident" id="4892747">y</span><span class="op" id="4892748">,</span>&nbsp;<span class="ident" id="4892750">color</span><span class="op" id="4892755">.</span><span class="ident" id="4892756">NRGBA</span><span class="op" id="4892761">{</span><span class="ident" id="4892762">ycol</span><span class="op" id="4892766">,</span>&nbsp;<span class="ident" id="4892768">ycol</span><span class="op" id="4892772">,</span>&nbsp;<span class="ident" id="4892774">ycol</span><span class="op" id="4892778">,</span>&nbsp;<span class="ident" id="4892780">cdat</span><span class="op" id="4892784">[</span><span class="num" id="4892785">2</span><span class="op" id="4892786">*</span><span class="ident" id="4892787">x</span><span class="op" id="4892788">+</span><span class="num" id="4892789">1</span><span class="op" id="4892790">]</span><span class="op" id="4892791">}</span><span class="op" id="4892792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892801">case</span>&nbsp;<span class="ident" id="4892806">cbTC8</span><span class="op" id="4892811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892816">pix</span><span class="op" id="4892819">,</span>&nbsp;<span class="ident" id="4892821">i</span><span class="op" id="4892822">,</span>&nbsp;<span class="ident" id="4892824">j</span>&nbsp;<span class="op" id="4892826">:=</span>&nbsp;<span class="ident" id="4892829">rgba</span><span class="op" id="4892833">.</span><span class="ident" id="4892834">Pix</span><span class="op" id="4892837">,</span>&nbsp;<span class="ident" id="4892839">pixOffset</span><span class="op" id="4892848">,</span>&nbsp;<span class="num" id="4892850">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892855">for</span>&nbsp;<span class="ident" id="4892859">x</span>&nbsp;<span class="op" id="4892861">:=</span>&nbsp;<span class="num" id="4892864">0</span><span class="op" id="4892865">;</span>&nbsp;<span class="ident" id="4892867">x</span>&nbsp;<span class="op" id="4892869">&lt;</span>&nbsp;<span class="ident" id="4892871">width</span><span class="op" id="4892876">;</span>&nbsp;<span class="ident" id="4892878">x</span><span class="op" id="4892879">++</span>&nbsp;<span class="op" id="4892882">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892888">pix</span><span class="op" id="4892891">[</span><span class="ident" id="4892892">i</span><span class="op" id="4892893">+</span><span class="num" id="4892894">0</span><span class="op" id="4892895">]</span>&nbsp;<span class="op" id="4892897">=</span>&nbsp;<span class="ident" id="4892899">cdat</span><span class="op" id="4892903">[</span><span class="ident" id="4892904">j</span><span class="op" id="4892905">+</span><span class="num" id="4892906">0</span><span class="op" id="4892907">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892913">pix</span><span class="op" id="4892916">[</span><span class="ident" id="4892917">i</span><span class="op" id="4892918">+</span><span class="num" id="4892919">1</span><span class="op" id="4892920">]</span>&nbsp;<span class="op" id="4892922">=</span>&nbsp;<span class="ident" id="4892924">cdat</span><span class="op" id="4892928">[</span><span class="ident" id="4892929">j</span><span class="op" id="4892930">+</span><span class="num" id="4892931">1</span><span class="op" id="4892932">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892938">pix</span><span class="op" id="4892941">[</span><span class="ident" id="4892942">i</span><span class="op" id="4892943">+</span><span class="num" id="4892944">2</span><span class="op" id="4892945">]</span>&nbsp;<span class="op" id="4892947">=</span>&nbsp;<span class="ident" id="4892949">cdat</span><span class="op" id="4892953">[</span><span class="ident" id="4892954">j</span><span class="op" id="4892955">+</span><span class="num" id="4892956">2</span><span class="op" id="4892957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892963">pix</span><span class="op" id="4892966">[</span><span class="ident" id="4892967">i</span><span class="op" id="4892968">+</span><span class="num" id="4892969">3</span><span class="op" id="4892970">]</span>&nbsp;<span class="op" id="4892972">=</span>&nbsp;<span class="num" id="4892974">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892983">i</span>&nbsp;<span class="op" id="4892985">+=</span>&nbsp;<span class="num" id="4892988">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892994">j</span>&nbsp;<span class="op" id="4892996">+=</span>&nbsp;<span class="num" id="4892999">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893009">pixOffset</span>&nbsp;<span class="op" id="4893019">+=</span>&nbsp;<span class="ident" id="4893022">rgba</span><span class="op" id="4893026">.</span><span class="ident" id="4893027">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893036">case</span>&nbsp;<span class="ident" id="4893041">cbP1</span><span class="op" id="4893045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893050">for</span>&nbsp;<span class="ident" id="4893054">x</span>&nbsp;<span class="op" id="4893056">:=</span>&nbsp;<span class="num" id="4893059">0</span><span class="op" id="4893060">;</span>&nbsp;<span class="ident" id="4893062">x</span>&nbsp;<span class="op" id="4893064">&lt;</span>&nbsp;<span class="ident" id="4893066">width</span><span class="op" id="4893071">;</span>&nbsp;<span class="ident" id="4893073">x</span>&nbsp;<span class="op" id="4893075">+=</span>&nbsp;<span class="num" id="4893078">8</span>&nbsp;<span class="op" id="4893080">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893086">b</span>&nbsp;<span class="op" id="4893088">:=</span>&nbsp;<span class="ident" id="4893091">cdat</span><span class="op" id="4893095">[</span><span class="ident" id="4893096">x</span><span class="op" id="4893097">/</span><span class="num" id="4893098">8</span><span class="op" id="4893099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893105">for</span>&nbsp;<span class="ident" id="4893109">x2</span>&nbsp;<span class="op" id="4893112">:=</span>&nbsp;<span class="num" id="4893115">0</span><span class="op" id="4893116">;</span>&nbsp;<span class="ident" id="4893118">x2</span>&nbsp;<span class="op" id="4893121">&lt;</span>&nbsp;<span class="num" id="4893123">8</span>&nbsp;<span class="op" id="4893125">&amp;&amp;</span>&nbsp;<span class="ident" id="4893128">x</span><span class="op" id="4893129">+</span><span class="ident" id="4893130">x2</span>&nbsp;<span class="op" id="4893133">&lt;</span>&nbsp;<span class="ident" id="4893135">width</span><span class="op" id="4893140">;</span>&nbsp;<span class="ident" id="4893142">x2</span><span class="op" id="4893144">++</span>&nbsp;<span class="op" id="4893147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893154">idx</span>&nbsp;<span class="op" id="4893158">:=</span>&nbsp;<span class="ident" id="4893161">b</span>&nbsp;<span class="op" id="4893163">&gt;&gt;</span>&nbsp;<span class="num" id="4893166">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893173">if</span>&nbsp;<span class="builtinfunc" id="4893176">len</span><span class="op" id="4893179">(</span><span class="ident" id="4893180">paletted</span><span class="op" id="4893188">.</span><span class="ident" id="4893189">Palette</span><span class="op" id="4893196">)</span>&nbsp;<span class="op" id="4893198">&lt;=</span>&nbsp;<span class="builtintype" id="4893201">int</span><span class="op" id="4893204">(</span><span class="ident" id="4893205">idx</span><span class="op" id="4893208">)</span>&nbsp;<span class="op" id="4893210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893218">paletted</span><span class="op" id="4893226">.</span><span class="ident" id="4893227">Palette</span>&nbsp;<span class="op" id="4893235">=</span>&nbsp;<span class="ident" id="4893237">paletted</span><span class="op" id="4893245">.</span><span class="ident" id="4893246">Palette</span><span class="op" id="4893253">[</span><span class="op" id="4893254">:</span><span class="builtintype" id="4893255">int</span><span class="op" id="4893258">(</span><span class="ident" id="4893259">idx</span><span class="op" id="4893262">)</span><span class="op" id="4893263">+</span><span class="num" id="4893264">1</span><span class="op" id="4893265">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893279">paletted</span><span class="op" id="4893287">.</span><span class="ident" id="4893288">SetColorIndex</span><span class="op" id="4893301">(</span><span class="ident" id="4893302">x</span><span class="op" id="4893303">+</span><span class="ident" id="4893304">x2</span><span class="op" id="4893306">,</span>&nbsp;<span class="ident" id="4893308">y</span><span class="op" id="4893309">,</span>&nbsp;<span class="ident" id="4893311">idx</span><span class="op" id="4893314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893321">b</span>&nbsp;<span class="op" id="4893323">&lt;&lt;=</span>&nbsp;<span class="num" id="4893327">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893338">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893342">case</span>&nbsp;<span class="ident" id="4893347">cbP2</span><span class="op" id="4893351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893356">for</span>&nbsp;<span class="ident" id="4893360">x</span>&nbsp;<span class="op" id="4893362">:=</span>&nbsp;<span class="num" id="4893365">0</span><span class="op" id="4893366">;</span>&nbsp;<span class="ident" id="4893368">x</span>&nbsp;<span class="op" id="4893370">&lt;</span>&nbsp;<span class="ident" id="4893372">width</span><span class="op" id="4893377">;</span>&nbsp;<span class="ident" id="4893379">x</span>&nbsp;<span class="op" id="4893381">+=</span>&nbsp;<span class="num" id="4893384">4</span>&nbsp;<span class="op" id="4893386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893392">b</span>&nbsp;<span class="op" id="4893394">:=</span>&nbsp;<span class="ident" id="4893397">cdat</span><span class="op" id="4893401">[</span><span class="ident" id="4893402">x</span><span class="op" id="4893403">/</span><span class="num" id="4893404">4</span><span class="op" id="4893405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893411">for</span>&nbsp;<span class="ident" id="4893415">x2</span>&nbsp;<span class="op" id="4893418">:=</span>&nbsp;<span class="num" id="4893421">0</span><span class="op" id="4893422">;</span>&nbsp;<span class="ident" id="4893424">x2</span>&nbsp;<span class="op" id="4893427">&lt;</span>&nbsp;<span class="num" id="4893429">4</span>&nbsp;<span class="op" id="4893431">&amp;&amp;</span>&nbsp;<span class="ident" id="4893434">x</span><span class="op" id="4893435">+</span><span class="ident" id="4893436">x2</span>&nbsp;<span class="op" id="4893439">&lt;</span>&nbsp;<span class="ident" id="4893441">width</span><span class="op" id="4893446">;</span>&nbsp;<span class="ident" id="4893448">x2</span><span class="op" id="4893450">++</span>&nbsp;<span class="op" id="4893453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893460">idx</span>&nbsp;<span class="op" id="4893464">:=</span>&nbsp;<span class="ident" id="4893467">b</span>&nbsp;<span class="op" id="4893469">&gt;&gt;</span>&nbsp;<span class="num" id="4893472">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893479">if</span>&nbsp;<span class="builtinfunc" id="4893482">len</span><span class="op" id="4893485">(</span><span class="ident" id="4893486">paletted</span><span class="op" id="4893494">.</span><span class="ident" id="4893495">Palette</span><span class="op" id="4893502">)</span>&nbsp;<span class="op" id="4893504">&lt;=</span>&nbsp;<span class="builtintype" id="4893507">int</span><span class="op" id="4893510">(</span><span class="ident" id="4893511">idx</span><span class="op" id="4893514">)</span>&nbsp;<span class="op" id="4893516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893524">paletted</span><span class="op" id="4893532">.</span><span class="ident" id="4893533">Palette</span>&nbsp;<span class="op" id="4893541">=</span>&nbsp;<span class="ident" id="4893543">paletted</span><span class="op" id="4893551">.</span><span class="ident" id="4893552">Palette</span><span class="op" id="4893559">[</span><span class="op" id="4893560">:</span><span class="builtintype" id="4893561">int</span><span class="op" id="4893564">(</span><span class="ident" id="4893565">idx</span><span class="op" id="4893568">)</span><span class="op" id="4893569">+</span><span class="num" id="4893570">1</span><span class="op" id="4893571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893585">paletted</span><span class="op" id="4893593">.</span><span class="ident" id="4893594">SetColorIndex</span><span class="op" id="4893607">(</span><span class="ident" id="4893608">x</span><span class="op" id="4893609">+</span><span class="ident" id="4893610">x2</span><span class="op" id="4893612">,</span>&nbsp;<span class="ident" id="4893614">y</span><span class="op" id="4893615">,</span>&nbsp;<span class="ident" id="4893617">idx</span><span class="op" id="4893620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893627">b</span>&nbsp;<span class="op" id="4893629">&lt;&lt;=</span>&nbsp;<span class="num" id="4893633">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893648">case</span>&nbsp;<span class="ident" id="4893653">cbP4</span><span class="op" id="4893657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893662">for</span>&nbsp;<span class="ident" id="4893666">x</span>&nbsp;<span class="op" id="4893668">:=</span>&nbsp;<span class="num" id="4893671">0</span><span class="op" id="4893672">;</span>&nbsp;<span class="ident" id="4893674">x</span>&nbsp;<span class="op" id="4893676">&lt;</span>&nbsp;<span class="ident" id="4893678">width</span><span class="op" id="4893683">;</span>&nbsp;<span class="ident" id="4893685">x</span>&nbsp;<span class="op" id="4893687">+=</span>&nbsp;<span class="num" id="4893690">2</span>&nbsp;<span class="op" id="4893692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893698">b</span>&nbsp;<span class="op" id="4893700">:=</span>&nbsp;<span class="ident" id="4893703">cdat</span><span class="op" id="4893707">[</span><span class="ident" id="4893708">x</span><span class="op" id="4893709">/</span><span class="num" id="4893710">2</span><span class="op" id="4893711">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893717">for</span>&nbsp;<span class="ident" id="4893721">x2</span>&nbsp;<span class="op" id="4893724">:=</span>&nbsp;<span class="num" id="4893727">0</span><span class="op" id="4893728">;</span>&nbsp;<span class="ident" id="4893730">x2</span>&nbsp;<span class="op" id="4893733">&lt;</span>&nbsp;<span class="num" id="4893735">2</span>&nbsp;<span class="op" id="4893737">&amp;&amp;</span>&nbsp;<span class="ident" id="4893740">x</span><span class="op" id="4893741">+</span><span class="ident" id="4893742">x2</span>&nbsp;<span class="op" id="4893745">&lt;</span>&nbsp;<span class="ident" id="4893747">width</span><span class="op" id="4893752">;</span>&nbsp;<span class="ident" id="4893754">x2</span><span class="op" id="4893756">++</span>&nbsp;<span class="op" id="4893759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893766">idx</span>&nbsp;<span class="op" id="4893770">:=</span>&nbsp;<span class="ident" id="4893773">b</span>&nbsp;<span class="op" id="4893775">&gt;&gt;</span>&nbsp;<span class="num" id="4893778">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893785">if</span>&nbsp;<span class="builtinfunc" id="4893788">len</span><span class="op" id="4893791">(</span><span class="ident" id="4893792">paletted</span><span class="op" id="4893800">.</span><span class="ident" id="4893801">Palette</span><span class="op" id="4893808">)</span>&nbsp;<span class="op" id="4893810">&lt;=</span>&nbsp;<span class="builtintype" id="4893813">int</span><span class="op" id="4893816">(</span><span class="ident" id="4893817">idx</span><span class="op" id="4893820">)</span>&nbsp;<span class="op" id="4893822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893830">paletted</span><span class="op" id="4893838">.</span><span class="ident" id="4893839">Palette</span>&nbsp;<span class="op" id="4893847">=</span>&nbsp;<span class="ident" id="4893849">paletted</span><span class="op" id="4893857">.</span><span class="ident" id="4893858">Palette</span><span class="op" id="4893865">[</span><span class="op" id="4893866">:</span><span class="builtintype" id="4893867">int</span><span class="op" id="4893870">(</span><span class="ident" id="4893871">idx</span><span class="op" id="4893874">)</span><span class="op" id="4893875">+</span><span class="num" id="4893876">1</span><span class="op" id="4893877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893884">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893891">paletted</span><span class="op" id="4893899">.</span><span class="ident" id="4893900">SetColorIndex</span><span class="op" id="4893913">(</span><span class="ident" id="4893914">x</span><span class="op" id="4893915">+</span><span class="ident" id="4893916">x2</span><span class="op" id="4893918">,</span>&nbsp;<span class="ident" id="4893920">y</span><span class="op" id="4893921">,</span>&nbsp;<span class="ident" id="4893923">idx</span><span class="op" id="4893926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893933">b</span>&nbsp;<span class="op" id="4893935">&lt;&lt;=</span>&nbsp;<span class="num" id="4893939">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893954">case</span>&nbsp;<span class="ident" id="4893959">cbP8</span><span class="op" id="4893963">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893968">if</span>&nbsp;<span class="builtinfunc" id="4893971">len</span><span class="op" id="4893974">(</span><span class="ident" id="4893975">paletted</span><span class="op" id="4893983">.</span><span class="ident" id="4893984">Palette</span><span class="op" id="4893991">)</span>&nbsp;<span class="op" id="4893993">!=</span>&nbsp;<span class="num" id="4893996">255</span>&nbsp;<span class="op" id="4894000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894006">for</span>&nbsp;<span class="ident" id="4894010">x</span>&nbsp;<span class="op" id="4894012">:=</span>&nbsp;<span class="num" id="4894015">0</span><span class="op" id="4894016">;</span>&nbsp;<span class="ident" id="4894018">x</span>&nbsp;<span class="op" id="4894020">&lt;</span>&nbsp;<span class="ident" id="4894022">width</span><span class="op" id="4894027">;</span>&nbsp;<span class="ident" id="4894029">x</span><span class="op" id="4894030">++</span>&nbsp;<span class="op" id="4894033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894040">if</span>&nbsp;<span class="builtinfunc" id="4894043">len</span><span class="op" id="4894046">(</span><span class="ident" id="4894047">paletted</span><span class="op" id="4894055">.</span><span class="ident" id="4894056">Palette</span><span class="op" id="4894063">)</span>&nbsp;<span class="op" id="4894065">&lt;=</span>&nbsp;<span class="builtintype" id="4894068">int</span><span class="op" id="4894071">(</span><span class="ident" id="4894072">cdat</span><span class="op" id="4894076">[</span><span class="ident" id="4894077">x</span><span class="op" id="4894078">]</span><span class="op" id="4894079">)</span>&nbsp;<span class="op" id="4894081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894089">paletted</span><span class="op" id="4894097">.</span><span class="ident" id="4894098">Palette</span>&nbsp;<span class="op" id="4894106">=</span>&nbsp;<span class="ident" id="4894108">paletted</span><span class="op" id="4894116">.</span><span class="ident" id="4894117">Palette</span><span class="op" id="4894124">[</span><span class="op" id="4894125">:</span><span class="builtintype" id="4894126">int</span><span class="op" id="4894129">(</span><span class="ident" id="4894130">cdat</span><span class="op" id="4894134">[</span><span class="ident" id="4894135">x</span><span class="op" id="4894136">]</span><span class="op" id="4894137">)</span><span class="op" id="4894138">+</span><span class="num" id="4894139">1</span><span class="op" id="4894140">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894147">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4894163">copy</span><span class="op" id="4894167">(</span><span class="ident" id="4894168">paletted</span><span class="op" id="4894176">.</span><span class="ident" id="4894177">Pix</span><span class="op" id="4894180">[</span><span class="ident" id="4894181">pixOffset</span><span class="op" id="4894190">:</span><span class="op" id="4894191">]</span><span class="op" id="4894192">,</span>&nbsp;<span class="ident" id="4894194">cdat</span><span class="op" id="4894198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894203">pixOffset</span>&nbsp;<span class="op" id="4894213">+=</span>&nbsp;<span class="ident" id="4894216">paletted</span><span class="op" id="4894224">.</span><span class="ident" id="4894225">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894234">case</span>&nbsp;<span class="ident" id="4894239">cbTCA8</span><span class="op" id="4894245">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4894250">copy</span><span class="op" id="4894254">(</span><span class="ident" id="4894255">nrgba</span><span class="op" id="4894260">.</span><span class="ident" id="4894261">Pix</span><span class="op" id="4894264">[</span><span class="ident" id="4894265">pixOffset</span><span class="op" id="4894274">:</span><span class="op" id="4894275">]</span><span class="op" id="4894276">,</span>&nbsp;<span class="ident" id="4894278">cdat</span><span class="op" id="4894282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894287">pixOffset</span>&nbsp;<span class="op" id="4894297">+=</span>&nbsp;<span class="ident" id="4894300">nrgba</span><span class="op" id="4894305">.</span><span class="ident" id="4894306">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894315">case</span>&nbsp;<span class="ident" id="4894320">cbG16</span><span class="op" id="4894325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894330">for</span>&nbsp;<span class="ident" id="4894334">x</span>&nbsp;<span class="op" id="4894336">:=</span>&nbsp;<span class="num" id="4894339">0</span><span class="op" id="4894340">;</span>&nbsp;<span class="ident" id="4894342">x</span>&nbsp;<span class="op" id="4894344">&lt;</span>&nbsp;<span class="ident" id="4894346">width</span><span class="op" id="4894351">;</span>&nbsp;<span class="ident" id="4894353">x</span><span class="op" id="4894354">++</span>&nbsp;<span class="op" id="4894357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894363">ycol</span>&nbsp;<span class="op" id="4894368">:=</span>&nbsp;<span class="builtintype" id="4894371">uint16</span><span class="op" id="4894377">(</span><span class="ident" id="4894378">cdat</span><span class="op" id="4894382">[</span><span class="num" id="4894383">2</span><span class="op" id="4894384">*</span><span class="ident" id="4894385">x</span><span class="op" id="4894386">+</span><span class="num" id="4894387">0</span><span class="op" id="4894388">]</span><span class="op" id="4894389">)</span><span class="op" id="4894390">&lt;&lt;</span><span class="num" id="4894392">8</span>&nbsp;<span class="op" id="4894394">|</span>&nbsp;<span class="builtintype" id="4894396">uint16</span><span class="op" id="4894402">(</span><span class="ident" id="4894403">cdat</span><span class="op" id="4894407">[</span><span class="num" id="4894408">2</span><span class="op" id="4894409">*</span><span class="ident" id="4894410">x</span><span class="op" id="4894411">+</span><span class="num" id="4894412">1</span><span class="op" id="4894413">]</span><span class="op" id="4894414">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894420">gray16</span><span class="op" id="4894426">.</span><span class="ident" id="4894427">SetGray16</span><span class="op" id="4894436">(</span><span class="ident" id="4894437">x</span><span class="op" id="4894438">,</span>&nbsp;<span class="ident" id="4894440">y</span><span class="op" id="4894441">,</span>&nbsp;<span class="ident" id="4894443">color</span><span class="op" id="4894448">.</span><span class="ident" id="4894449">Gray16</span><span class="op" id="4894455">{</span><span class="ident" id="4894456">ycol</span><span class="op" id="4894460">}</span><span class="op" id="4894461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894470">case</span>&nbsp;<span class="ident" id="4894475">cbGA16</span><span class="op" id="4894481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894486">for</span>&nbsp;<span class="ident" id="4894490">x</span>&nbsp;<span class="op" id="4894492">:=</span>&nbsp;<span class="num" id="4894495">0</span><span class="op" id="4894496">;</span>&nbsp;<span class="ident" id="4894498">x</span>&nbsp;<span class="op" id="4894500">&lt;</span>&nbsp;<span class="ident" id="4894502">width</span><span class="op" id="4894507">;</span>&nbsp;<span class="ident" id="4894509">x</span><span class="op" id="4894510">++</span>&nbsp;<span class="op" id="4894513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894519">ycol</span>&nbsp;<span class="op" id="4894524">:=</span>&nbsp;<span class="builtintype" id="4894527">uint16</span><span class="op" id="4894533">(</span><span class="ident" id="4894534">cdat</span><span class="op" id="4894538">[</span><span class="num" id="4894539">4</span><span class="op" id="4894540">*</span><span class="ident" id="4894541">x</span><span class="op" id="4894542">+</span><span class="num" id="4894543">0</span><span class="op" id="4894544">]</span><span class="op" id="4894545">)</span><span class="op" id="4894546">&lt;&lt;</span><span class="num" id="4894548">8</span>&nbsp;<span class="op" id="4894550">|</span>&nbsp;<span class="builtintype" id="4894552">uint16</span><span class="op" id="4894558">(</span><span class="ident" id="4894559">cdat</span><span class="op" id="4894563">[</span><span class="num" id="4894564">4</span><span class="op" id="4894565">*</span><span class="ident" id="4894566">x</span><span class="op" id="4894567">+</span><span class="num" id="4894568">1</span><span class="op" id="4894569">]</span><span class="op" id="4894570">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894576">acol</span>&nbsp;<span class="op" id="4894581">:=</span>&nbsp;<span class="builtintype" id="4894584">uint16</span><span class="op" id="4894590">(</span><span class="ident" id="4894591">cdat</span><span class="op" id="4894595">[</span><span class="num" id="4894596">4</span><span class="op" id="4894597">*</span><span class="ident" id="4894598">x</span><span class="op" id="4894599">+</span><span class="num" id="4894600">2</span><span class="op" id="4894601">]</span><span class="op" id="4894602">)</span><span class="op" id="4894603">&lt;&lt;</span><span class="num" id="4894605">8</span>&nbsp;<span class="op" id="4894607">|</span>&nbsp;<span class="builtintype" id="4894609">uint16</span><span class="op" id="4894615">(</span><span class="ident" id="4894616">cdat</span><span class="op" id="4894620">[</span><span class="num" id="4894621">4</span><span class="op" id="4894622">*</span><span class="ident" id="4894623">x</span><span class="op" id="4894624">+</span><span class="num" id="4894625">3</span><span class="op" id="4894626">]</span><span class="op" id="4894627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894633">nrgba64</span><span class="op" id="4894640">.</span><span class="ident" id="4894641">SetNRGBA64</span><span class="op" id="4894651">(</span><span class="ident" id="4894652">x</span><span class="op" id="4894653">,</span>&nbsp;<span class="ident" id="4894655">y</span><span class="op" id="4894656">,</span>&nbsp;<span class="ident" id="4894658">color</span><span class="op" id="4894663">.</span><span class="ident" id="4894664">NRGBA64</span><span class="op" id="4894671">{</span><span class="ident" id="4894672">ycol</span><span class="op" id="4894676">,</span>&nbsp;<span class="ident" id="4894678">ycol</span><span class="op" id="4894682">,</span>&nbsp;<span class="ident" id="4894684">ycol</span><span class="op" id="4894688">,</span>&nbsp;<span class="ident" id="4894690">acol</span><span class="op" id="4894694">}</span><span class="op" id="4894695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894704">case</span>&nbsp;<span class="ident" id="4894709">cbTC16</span><span class="op" id="4894715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894720">for</span>&nbsp;<span class="ident" id="4894724">x</span>&nbsp;<span class="op" id="4894726">:=</span>&nbsp;<span class="num" id="4894729">0</span><span class="op" id="4894730">;</span>&nbsp;<span class="ident" id="4894732">x</span>&nbsp;<span class="op" id="4894734">&lt;</span>&nbsp;<span class="ident" id="4894736">width</span><span class="op" id="4894741">;</span>&nbsp;<span class="ident" id="4894743">x</span><span class="op" id="4894744">++</span>&nbsp;<span class="op" id="4894747">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894753">rcol</span>&nbsp;<span class="op" id="4894758">:=</span>&nbsp;<span class="builtintype" id="4894761">uint16</span><span class="op" id="4894767">(</span><span class="ident" id="4894768">cdat</span><span class="op" id="4894772">[</span><span class="num" id="4894773">6</span><span class="op" id="4894774">*</span><span class="ident" id="4894775">x</span><span class="op" id="4894776">+</span><span class="num" id="4894777">0</span><span class="op" id="4894778">]</span><span class="op" id="4894779">)</span><span class="op" id="4894780">&lt;&lt;</span><span class="num" id="4894782">8</span>&nbsp;<span class="op" id="4894784">|</span>&nbsp;<span class="builtintype" id="4894786">uint16</span><span class="op" id="4894792">(</span><span class="ident" id="4894793">cdat</span><span class="op" id="4894797">[</span><span class="num" id="4894798">6</span><span class="op" id="4894799">*</span><span class="ident" id="4894800">x</span><span class="op" id="4894801">+</span><span class="num" id="4894802">1</span><span class="op" id="4894803">]</span><span class="op" id="4894804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894810">gcol</span>&nbsp;<span class="op" id="4894815">:=</span>&nbsp;<span class="builtintype" id="4894818">uint16</span><span class="op" id="4894824">(</span><span class="ident" id="4894825">cdat</span><span class="op" id="4894829">[</span><span class="num" id="4894830">6</span><span class="op" id="4894831">*</span><span class="ident" id="4894832">x</span><span class="op" id="4894833">+</span><span class="num" id="4894834">2</span><span class="op" id="4894835">]</span><span class="op" id="4894836">)</span><span class="op" id="4894837">&lt;&lt;</span><span class="num" id="4894839">8</span>&nbsp;<span class="op" id="4894841">|</span>&nbsp;<span class="builtintype" id="4894843">uint16</span><span class="op" id="4894849">(</span><span class="ident" id="4894850">cdat</span><span class="op" id="4894854">[</span><span class="num" id="4894855">6</span><span class="op" id="4894856">*</span><span class="ident" id="4894857">x</span><span class="op" id="4894858">+</span><span class="num" id="4894859">3</span><span class="op" id="4894860">]</span><span class="op" id="4894861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894867">bcol</span>&nbsp;<span class="op" id="4894872">:=</span>&nbsp;<span class="builtintype" id="4894875">uint16</span><span class="op" id="4894881">(</span><span class="ident" id="4894882">cdat</span><span class="op" id="4894886">[</span><span class="num" id="4894887">6</span><span class="op" id="4894888">*</span><span class="ident" id="4894889">x</span><span class="op" id="4894890">+</span><span class="num" id="4894891">4</span><span class="op" id="4894892">]</span><span class="op" id="4894893">)</span><span class="op" id="4894894">&lt;&lt;</span><span class="num" id="4894896">8</span>&nbsp;<span class="op" id="4894898">|</span>&nbsp;<span class="builtintype" id="4894900">uint16</span><span class="op" id="4894906">(</span><span class="ident" id="4894907">cdat</span><span class="op" id="4894911">[</span><span class="num" id="4894912">6</span><span class="op" id="4894913">*</span><span class="ident" id="4894914">x</span><span class="op" id="4894915">+</span><span class="num" id="4894916">5</span><span class="op" id="4894917">]</span><span class="op" id="4894918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894924">rgba64</span><span class="op" id="4894930">.</span><span class="ident" id="4894931">SetRGBA64</span><span class="op" id="4894940">(</span><span class="ident" id="4894941">x</span><span class="op" id="4894942">,</span>&nbsp;<span class="ident" id="4894944">y</span><span class="op" id="4894945">,</span>&nbsp;<span class="ident" id="4894947">color</span><span class="op" id="4894952">.</span><span class="ident" id="4894953">RGBA64</span><span class="op" id="4894959">{</span><span class="ident" id="4894960">rcol</span><span class="op" id="4894964">,</span>&nbsp;<span class="ident" id="4894966">gcol</span><span class="op" id="4894970">,</span>&nbsp;<span class="ident" id="4894972">bcol</span><span class="op" id="4894976">,</span>&nbsp;<span class="num" id="4894978">0xffff</span><span class="op" id="4894984">}</span><span class="op" id="4894985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894990">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894994">case</span>&nbsp;<span class="ident" id="4894999">cbTCA16</span><span class="op" id="4895006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895011">for</span>&nbsp;<span class="ident" id="4895015">x</span>&nbsp;<span class="op" id="4895017">:=</span>&nbsp;<span class="num" id="4895020">0</span><span class="op" id="4895021">;</span>&nbsp;<span class="ident" id="4895023">x</span>&nbsp;<span class="op" id="4895025">&lt;</span>&nbsp;<span class="ident" id="4895027">width</span><span class="op" id="4895032">;</span>&nbsp;<span class="ident" id="4895034">x</span><span class="op" id="4895035">++</span>&nbsp;<span class="op" id="4895038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895044">rcol</span>&nbsp;<span class="op" id="4895049">:=</span>&nbsp;<span class="builtintype" id="4895052">uint16</span><span class="op" id="4895058">(</span><span class="ident" id="4895059">cdat</span><span class="op" id="4895063">[</span><span class="num" id="4895064">8</span><span class="op" id="4895065">*</span><span class="ident" id="4895066">x</span><span class="op" id="4895067">+</span><span class="num" id="4895068">0</span><span class="op" id="4895069">]</span><span class="op" id="4895070">)</span><span class="op" id="4895071">&lt;&lt;</span><span class="num" id="4895073">8</span>&nbsp;<span class="op" id="4895075">|</span>&nbsp;<span class="builtintype" id="4895077">uint16</span><span class="op" id="4895083">(</span><span class="ident" id="4895084">cdat</span><span class="op" id="4895088">[</span><span class="num" id="4895089">8</span><span class="op" id="4895090">*</span><span class="ident" id="4895091">x</span><span class="op" id="4895092">+</span><span class="num" id="4895093">1</span><span class="op" id="4895094">]</span><span class="op" id="4895095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895101">gcol</span>&nbsp;<span class="op" id="4895106">:=</span>&nbsp;<span class="builtintype" id="4895109">uint16</span><span class="op" id="4895115">(</span><span class="ident" id="4895116">cdat</span><span class="op" id="4895120">[</span><span class="num" id="4895121">8</span><span class="op" id="4895122">*</span><span class="ident" id="4895123">x</span><span class="op" id="4895124">+</span><span class="num" id="4895125">2</span><span class="op" id="4895126">]</span><span class="op" id="4895127">)</span><span class="op" id="4895128">&lt;&lt;</span><span class="num" id="4895130">8</span>&nbsp;<span class="op" id="4895132">|</span>&nbsp;<span class="builtintype" id="4895134">uint16</span><span class="op" id="4895140">(</span><span class="ident" id="4895141">cdat</span><span class="op" id="4895145">[</span><span class="num" id="4895146">8</span><span class="op" id="4895147">*</span><span class="ident" id="4895148">x</span><span class="op" id="4895149">+</span><span class="num" id="4895150">3</span><span class="op" id="4895151">]</span><span class="op" id="4895152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895158">bcol</span>&nbsp;<span class="op" id="4895163">:=</span>&nbsp;<span class="builtintype" id="4895166">uint16</span><span class="op" id="4895172">(</span><span class="ident" id="4895173">cdat</span><span class="op" id="4895177">[</span><span class="num" id="4895178">8</span><span class="op" id="4895179">*</span><span class="ident" id="4895180">x</span><span class="op" id="4895181">+</span><span class="num" id="4895182">4</span><span class="op" id="4895183">]</span><span class="op" id="4895184">)</span><span class="op" id="4895185">&lt;&lt;</span><span class="num" id="4895187">8</span>&nbsp;<span class="op" id="4895189">|</span>&nbsp;<span class="builtintype" id="4895191">uint16</span><span class="op" id="4895197">(</span><span class="ident" id="4895198">cdat</span><span class="op" id="4895202">[</span><span class="num" id="4895203">8</span><span class="op" id="4895204">*</span><span class="ident" id="4895205">x</span><span class="op" id="4895206">+</span><span class="num" id="4895207">5</span><span class="op" id="4895208">]</span><span class="op" id="4895209">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895215">acol</span>&nbsp;<span class="op" id="4895220">:=</span>&nbsp;<span class="builtintype" id="4895223">uint16</span><span class="op" id="4895229">(</span><span class="ident" id="4895230">cdat</span><span class="op" id="4895234">[</span><span class="num" id="4895235">8</span><span class="op" id="4895236">*</span><span class="ident" id="4895237">x</span><span class="op" id="4895238">+</span><span class="num" id="4895239">6</span><span class="op" id="4895240">]</span><span class="op" id="4895241">)</span><span class="op" id="4895242">&lt;&lt;</span><span class="num" id="4895244">8</span>&nbsp;<span class="op" id="4895246">|</span>&nbsp;<span class="builtintype" id="4895248">uint16</span><span class="op" id="4895254">(</span><span class="ident" id="4895255">cdat</span><span class="op" id="4895259">[</span><span class="num" id="4895260">8</span><span class="op" id="4895261">*</span><span class="ident" id="4895262">x</span><span class="op" id="4895263">+</span><span class="num" id="4895264">7</span><span class="op" id="4895265">]</span><span class="op" id="4895266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895272">nrgba64</span><span class="op" id="4895279">.</span><span class="ident" id="4895280">SetNRGBA64</span><span class="op" id="4895290">(</span><span class="ident" id="4895291">x</span><span class="op" id="4895292">,</span>&nbsp;<span class="ident" id="4895294">y</span><span class="op" id="4895295">,</span>&nbsp;<span class="ident" id="4895297">color</span><span class="op" id="4895302">.</span><span class="ident" id="4895303">NRGBA64</span><span class="op" id="4895310">{</span><span class="ident" id="4895311">rcol</span><span class="op" id="4895315">,</span>&nbsp;<span class="ident" id="4895317">gcol</span><span class="op" id="4895321">,</span>&nbsp;<span class="ident" id="4895323">bcol</span><span class="op" id="4895327">,</span>&nbsp;<span class="ident" id="4895329">acol</span><span class="op" id="4895333">}</span><span class="op" id="4895334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4895348">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895404">pr</span><span class="op" id="4895406">,</span>&nbsp;<span class="ident" id="4895408">cr</span>&nbsp;<span class="op" id="4895411">=</span>&nbsp;<span class="ident" id="4895413">cr</span><span class="op" id="4895415">,</span>&nbsp;<span class="ident" id="4895417">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895425">return</span>&nbsp;<span class="ident" id="4895432">img</span><span class="op" id="4895435">,</span>&nbsp;<span class="ident" id="4895437">nil</span><br>
<span class="lineno">585</span><span class="op" id="4895441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4895444">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4895507">func</span>&nbsp;<span class="op" id="4895512">(</span><span class="ident" id="4895513">d</span>&nbsp;<span class="op" id="4895515">*</span><span class="ident" id="4895516">decoder</span><span class="op" id="4895523">)</span>&nbsp;<span class="ident" id="4895525">mergePassInto</span><span class="op" id="4895538">(</span><span class="ident" id="4895539">dst</span>&nbsp;<span class="ident" id="4895543">image</span><span class="op" id="4895548">.</span><span class="ident" id="4895549">Image</span><span class="op" id="4895554">,</span>&nbsp;<span class="ident" id="4895556">src</span>&nbsp;<span class="ident" id="4895560">image</span><span class="op" id="4895565">.</span><span class="ident" id="4895566">Image</span><span class="op" id="4895571">,</span>&nbsp;<span class="ident" id="4895573">pass</span>&nbsp;<span class="builtintype" id="4895578">int</span><span class="op" id="4895581">)</span>&nbsp;<span class="op" id="4895583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895586">p</span>&nbsp;<span class="op" id="4895588">:=</span>&nbsp;<span class="ident" id="4895591">interlacing</span><span class="op" id="4895602">[</span><span class="ident" id="4895603">pass</span><span class="op" id="4895607">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895610">var</span>&nbsp;<span class="op" id="4895614">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895618">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4895632">[</span><span class="op" id="4895633">]</span><span class="builtintype" id="4895634">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895642">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4895656">[</span><span class="op" id="4895657">]</span><span class="builtintype" id="4895658">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895666">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4895680">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895686">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4895700">image</span><span class="op" id="4895705">.</span><span class="ident" id="4895706">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895718">bytesPerPixel</span>&nbsp;<span class="builtintype" id="4895732">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895740">switch</span>&nbsp;<span class="ident" id="4895747">target</span>&nbsp;<span class="op" id="4895754">:=</span>&nbsp;<span class="ident" id="4895757">dst</span><span class="op" id="4895760">.</span><span class="op" id="4895761">(</span><span class="keyword" id="4895762">type</span><span class="op" id="4895766">)</span>&nbsp;<span class="op" id="4895768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895771">case</span>&nbsp;<span class="op" id="4895776">*</span><span class="ident" id="4895777">image</span><span class="op" id="4895782">.</span><span class="ident" id="4895783">Alpha</span><span class="op" id="4895788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895792">srcPix</span>&nbsp;<span class="op" id="4895799">=</span>&nbsp;<span class="ident" id="4895801">src</span><span class="op" id="4895804">.</span><span class="op" id="4895805">(</span><span class="op" id="4895806">*</span><span class="ident" id="4895807">image</span><span class="op" id="4895812">.</span><span class="ident" id="4895813">Alpha</span><span class="op" id="4895818">)</span><span class="op" id="4895819">.</span><span class="ident" id="4895820">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895826">dstPix</span><span class="op" id="4895832">,</span>&nbsp;<span class="ident" id="4895834">stride</span><span class="op" id="4895840">,</span>&nbsp;<span class="ident" id="4895842">rect</span>&nbsp;<span class="op" id="4895847">=</span>&nbsp;<span class="ident" id="4895849">target</span><span class="op" id="4895855">.</span><span class="ident" id="4895856">Pix</span><span class="op" id="4895859">,</span>&nbsp;<span class="ident" id="4895861">target</span><span class="op" id="4895867">.</span><span class="ident" id="4895868">Stride</span><span class="op" id="4895874">,</span>&nbsp;<span class="ident" id="4895876">target</span><span class="op" id="4895882">.</span><span class="ident" id="4895883">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895890">bytesPerPixel</span>&nbsp;<span class="op" id="4895904">=</span>&nbsp;<span class="num" id="4895906">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895909">case</span>&nbsp;<span class="op" id="4895914">*</span><span class="ident" id="4895915">image</span><span class="op" id="4895920">.</span><span class="ident" id="4895921">Alpha16</span><span class="op" id="4895928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895932">srcPix</span>&nbsp;<span class="op" id="4895939">=</span>&nbsp;<span class="ident" id="4895941">src</span><span class="op" id="4895944">.</span><span class="op" id="4895945">(</span><span class="op" id="4895946">*</span><span class="ident" id="4895947">image</span><span class="op" id="4895952">.</span><span class="ident" id="4895953">Alpha16</span><span class="op" id="4895960">)</span><span class="op" id="4895961">.</span><span class="ident" id="4895962">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895968">dstPix</span><span class="op" id="4895974">,</span>&nbsp;<span class="ident" id="4895976">stride</span><span class="op" id="4895982">,</span>&nbsp;<span class="ident" id="4895984">rect</span>&nbsp;<span class="op" id="4895989">=</span>&nbsp;<span class="ident" id="4895991">target</span><span class="op" id="4895997">.</span><span class="ident" id="4895998">Pix</span><span class="op" id="4896001">,</span>&nbsp;<span class="ident" id="4896003">target</span><span class="op" id="4896009">.</span><span class="ident" id="4896010">Stride</span><span class="op" id="4896016">,</span>&nbsp;<span class="ident" id="4896018">target</span><span class="op" id="4896024">.</span><span class="ident" id="4896025">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896032">bytesPerPixel</span>&nbsp;<span class="op" id="4896046">=</span>&nbsp;<span class="num" id="4896048">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896051">case</span>&nbsp;<span class="op" id="4896056">*</span><span class="ident" id="4896057">image</span><span class="op" id="4896062">.</span><span class="ident" id="4896063">Gray</span><span class="op" id="4896067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896071">srcPix</span>&nbsp;<span class="op" id="4896078">=</span>&nbsp;<span class="ident" id="4896080">src</span><span class="op" id="4896083">.</span><span class="op" id="4896084">(</span><span class="op" id="4896085">*</span><span class="ident" id="4896086">image</span><span class="op" id="4896091">.</span><span class="ident" id="4896092">Gray</span><span class="op" id="4896096">)</span><span class="op" id="4896097">.</span><span class="ident" id="4896098">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896104">dstPix</span><span class="op" id="4896110">,</span>&nbsp;<span class="ident" id="4896112">stride</span><span class="op" id="4896118">,</span>&nbsp;<span class="ident" id="4896120">rect</span>&nbsp;<span class="op" id="4896125">=</span>&nbsp;<span class="ident" id="4896127">target</span><span class="op" id="4896133">.</span><span class="ident" id="4896134">Pix</span><span class="op" id="4896137">,</span>&nbsp;<span class="ident" id="4896139">target</span><span class="op" id="4896145">.</span><span class="ident" id="4896146">Stride</span><span class="op" id="4896152">,</span>&nbsp;<span class="ident" id="4896154">target</span><span class="op" id="4896160">.</span><span class="ident" id="4896161">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896168">bytesPerPixel</span>&nbsp;<span class="op" id="4896182">=</span>&nbsp;<span class="num" id="4896184">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896187">case</span>&nbsp;<span class="op" id="4896192">*</span><span class="ident" id="4896193">image</span><span class="op" id="4896198">.</span><span class="ident" id="4896199">Gray16</span><span class="op" id="4896205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896209">srcPix</span>&nbsp;<span class="op" id="4896216">=</span>&nbsp;<span class="ident" id="4896218">src</span><span class="op" id="4896221">.</span><span class="op" id="4896222">(</span><span class="op" id="4896223">*</span><span class="ident" id="4896224">image</span><span class="op" id="4896229">.</span><span class="ident" id="4896230">Gray16</span><span class="op" id="4896236">)</span><span class="op" id="4896237">.</span><span class="ident" id="4896238">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896244">dstPix</span><span class="op" id="4896250">,</span>&nbsp;<span class="ident" id="4896252">stride</span><span class="op" id="4896258">,</span>&nbsp;<span class="ident" id="4896260">rect</span>&nbsp;<span class="op" id="4896265">=</span>&nbsp;<span class="ident" id="4896267">target</span><span class="op" id="4896273">.</span><span class="ident" id="4896274">Pix</span><span class="op" id="4896277">,</span>&nbsp;<span class="ident" id="4896279">target</span><span class="op" id="4896285">.</span><span class="ident" id="4896286">Stride</span><span class="op" id="4896292">,</span>&nbsp;<span class="ident" id="4896294">target</span><span class="op" id="4896300">.</span><span class="ident" id="4896301">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896308">bytesPerPixel</span>&nbsp;<span class="op" id="4896322">=</span>&nbsp;<span class="num" id="4896324">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896327">case</span>&nbsp;<span class="op" id="4896332">*</span><span class="ident" id="4896333">image</span><span class="op" id="4896338">.</span><span class="ident" id="4896339">NRGBA</span><span class="op" id="4896344">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896348">srcPix</span>&nbsp;<span class="op" id="4896355">=</span>&nbsp;<span class="ident" id="4896357">src</span><span class="op" id="4896360">.</span><span class="op" id="4896361">(</span><span class="op" id="4896362">*</span><span class="ident" id="4896363">image</span><span class="op" id="4896368">.</span><span class="ident" id="4896369">NRGBA</span><span class="op" id="4896374">)</span><span class="op" id="4896375">.</span><span class="ident" id="4896376">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896382">dstPix</span><span class="op" id="4896388">,</span>&nbsp;<span class="ident" id="4896390">stride</span><span class="op" id="4896396">,</span>&nbsp;<span class="ident" id="4896398">rect</span>&nbsp;<span class="op" id="4896403">=</span>&nbsp;<span class="ident" id="4896405">target</span><span class="op" id="4896411">.</span><span class="ident" id="4896412">Pix</span><span class="op" id="4896415">,</span>&nbsp;<span class="ident" id="4896417">target</span><span class="op" id="4896423">.</span><span class="ident" id="4896424">Stride</span><span class="op" id="4896430">,</span>&nbsp;<span class="ident" id="4896432">target</span><span class="op" id="4896438">.</span><span class="ident" id="4896439">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896446">bytesPerPixel</span>&nbsp;<span class="op" id="4896460">=</span>&nbsp;<span class="num" id="4896462">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896465">case</span>&nbsp;<span class="op" id="4896470">*</span><span class="ident" id="4896471">image</span><span class="op" id="4896476">.</span><span class="ident" id="4896477">NRGBA64</span><span class="op" id="4896484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896488">srcPix</span>&nbsp;<span class="op" id="4896495">=</span>&nbsp;<span class="ident" id="4896497">src</span><span class="op" id="4896500">.</span><span class="op" id="4896501">(</span><span class="op" id="4896502">*</span><span class="ident" id="4896503">image</span><span class="op" id="4896508">.</span><span class="ident" id="4896509">NRGBA64</span><span class="op" id="4896516">)</span><span class="op" id="4896517">.</span><span class="ident" id="4896518">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896524">dstPix</span><span class="op" id="4896530">,</span>&nbsp;<span class="ident" id="4896532">stride</span><span class="op" id="4896538">,</span>&nbsp;<span class="ident" id="4896540">rect</span>&nbsp;<span class="op" id="4896545">=</span>&nbsp;<span class="ident" id="4896547">target</span><span class="op" id="4896553">.</span><span class="ident" id="4896554">Pix</span><span class="op" id="4896557">,</span>&nbsp;<span class="ident" id="4896559">target</span><span class="op" id="4896565">.</span><span class="ident" id="4896566">Stride</span><span class="op" id="4896572">,</span>&nbsp;<span class="ident" id="4896574">target</span><span class="op" id="4896580">.</span><span class="ident" id="4896581">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896588">bytesPerPixel</span>&nbsp;<span class="op" id="4896602">=</span>&nbsp;<span class="num" id="4896604">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896607">case</span>&nbsp;<span class="op" id="4896612">*</span><span class="ident" id="4896613">image</span><span class="op" id="4896618">.</span><span class="ident" id="4896619">Paletted</span><span class="op" id="4896627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896631">srcPix</span>&nbsp;<span class="op" id="4896638">=</span>&nbsp;<span class="ident" id="4896640">src</span><span class="op" id="4896643">.</span><span class="op" id="4896644">(</span><span class="op" id="4896645">*</span><span class="ident" id="4896646">image</span><span class="op" id="4896651">.</span><span class="ident" id="4896652">Paletted</span><span class="op" id="4896660">)</span><span class="op" id="4896661">.</span><span class="ident" id="4896662">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896668">dstPix</span><span class="op" id="4896674">,</span>&nbsp;<span class="ident" id="4896676">stride</span><span class="op" id="4896682">,</span>&nbsp;<span class="ident" id="4896684">rect</span>&nbsp;<span class="op" id="4896689">=</span>&nbsp;<span class="ident" id="4896691">target</span><span class="op" id="4896697">.</span><span class="ident" id="4896698">Pix</span><span class="op" id="4896701">,</span>&nbsp;<span class="ident" id="4896703">target</span><span class="op" id="4896709">.</span><span class="ident" id="4896710">Stride</span><span class="op" id="4896716">,</span>&nbsp;<span class="ident" id="4896718">target</span><span class="op" id="4896724">.</span><span class="ident" id="4896725">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896732">bytesPerPixel</span>&nbsp;<span class="op" id="4896746">=</span>&nbsp;<span class="num" id="4896748">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896751">case</span>&nbsp;<span class="op" id="4896756">*</span><span class="ident" id="4896757">image</span><span class="op" id="4896762">.</span><span class="ident" id="4896763">RGBA</span><span class="op" id="4896767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896771">srcPix</span>&nbsp;<span class="op" id="4896778">=</span>&nbsp;<span class="ident" id="4896780">src</span><span class="op" id="4896783">.</span><span class="op" id="4896784">(</span><span class="op" id="4896785">*</span><span class="ident" id="4896786">image</span><span class="op" id="4896791">.</span><span class="ident" id="4896792">RGBA</span><span class="op" id="4896796">)</span><span class="op" id="4896797">.</span><span class="ident" id="4896798">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896804">dstPix</span><span class="op" id="4896810">,</span>&nbsp;<span class="ident" id="4896812">stride</span><span class="op" id="4896818">,</span>&nbsp;<span class="ident" id="4896820">rect</span>&nbsp;<span class="op" id="4896825">=</span>&nbsp;<span class="ident" id="4896827">target</span><span class="op" id="4896833">.</span><span class="ident" id="4896834">Pix</span><span class="op" id="4896837">,</span>&nbsp;<span class="ident" id="4896839">target</span><span class="op" id="4896845">.</span><span class="ident" id="4896846">Stride</span><span class="op" id="4896852">,</span>&nbsp;<span class="ident" id="4896854">target</span><span class="op" id="4896860">.</span><span class="ident" id="4896861">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896868">bytesPerPixel</span>&nbsp;<span class="op" id="4896882">=</span>&nbsp;<span class="num" id="4896884">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896887">case</span>&nbsp;<span class="op" id="4896892">*</span><span class="ident" id="4896893">image</span><span class="op" id="4896898">.</span><span class="ident" id="4896899">RGBA64</span><span class="op" id="4896905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896909">srcPix</span>&nbsp;<span class="op" id="4896916">=</span>&nbsp;<span class="ident" id="4896918">src</span><span class="op" id="4896921">.</span><span class="op" id="4896922">(</span><span class="op" id="4896923">*</span><span class="ident" id="4896924">image</span><span class="op" id="4896929">.</span><span class="ident" id="4896930">RGBA64</span><span class="op" id="4896936">)</span><span class="op" id="4896937">.</span><span class="ident" id="4896938">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896944">dstPix</span><span class="op" id="4896950">,</span>&nbsp;<span class="ident" id="4896952">stride</span><span class="op" id="4896958">,</span>&nbsp;<span class="ident" id="4896960">rect</span>&nbsp;<span class="op" id="4896965">=</span>&nbsp;<span class="ident" id="4896967">target</span><span class="op" id="4896973">.</span><span class="ident" id="4896974">Pix</span><span class="op" id="4896977">,</span>&nbsp;<span class="ident" id="4896979">target</span><span class="op" id="4896985">.</span><span class="ident" id="4896986">Stride</span><span class="op" id="4896992">,</span>&nbsp;<span class="ident" id="4896994">target</span><span class="op" id="4897000">.</span><span class="ident" id="4897001">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897008">bytesPerPixel</span>&nbsp;<span class="op" id="4897022">=</span>&nbsp;<span class="num" id="4897024">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897027">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897030">s</span><span class="op" id="4897031">,</span>&nbsp;<span class="ident" id="4897033">bounds</span>&nbsp;<span class="op" id="4897040">:=</span>&nbsp;<span class="num" id="4897043">0</span><span class="op" id="4897044">,</span>&nbsp;<span class="ident" id="4897046">src</span><span class="op" id="4897049">.</span><span class="ident" id="4897050">Bounds</span><span class="op" id="4897056">(</span><span class="op" id="4897057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897060">for</span>&nbsp;<span class="ident" id="4897064">y</span>&nbsp;<span class="op" id="4897066">:=</span>&nbsp;<span class="ident" id="4897069">bounds</span><span class="op" id="4897075">.</span><span class="ident" id="4897076">Min</span><span class="op" id="4897079">.</span><span class="ident" id="4897080">Y</span><span class="op" id="4897081">;</span>&nbsp;<span class="ident" id="4897083">y</span>&nbsp;<span class="op" id="4897085">&lt;</span>&nbsp;<span class="ident" id="4897087">bounds</span><span class="op" id="4897093">.</span><span class="ident" id="4897094">Max</span><span class="op" id="4897097">.</span><span class="ident" id="4897098">Y</span><span class="op" id="4897099">;</span>&nbsp;<span class="ident" id="4897101">y</span><span class="op" id="4897102">++</span>&nbsp;<span class="op" id="4897105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897109">dBase</span>&nbsp;<span class="op" id="4897115">:=</span>&nbsp;<span class="op" id="4897118">(</span><span class="ident" id="4897119">y</span><span class="op" id="4897120">*</span><span class="ident" id="4897121">p</span><span class="op" id="4897122">.</span><span class="ident" id="4897123">yFactor</span><span class="op" id="4897130">+</span><span class="ident" id="4897131">p</span><span class="op" id="4897132">.</span><span class="ident" id="4897133">yOffset</span><span class="op" id="4897140">-</span><span class="ident" id="4897141">rect</span><span class="op" id="4897145">.</span><span class="ident" id="4897146">Min</span><span class="op" id="4897149">.</span><span class="ident" id="4897150">Y</span><span class="op" id="4897151">)</span><span class="op" id="4897152">*</span><span class="ident" id="4897153">stride</span>&nbsp;<span class="op" id="4897160">+</span>&nbsp;<span class="op" id="4897162">(</span><span class="ident" id="4897163">p</span><span class="op" id="4897164">.</span><span class="ident" id="4897165">xOffset</span><span class="op" id="4897172">-</span><span class="ident" id="4897173">rect</span><span class="op" id="4897177">.</span><span class="ident" id="4897178">Min</span><span class="op" id="4897181">.</span><span class="ident" id="4897182">X</span><span class="op" id="4897183">)</span><span class="op" id="4897184">*</span><span class="ident" id="4897185">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897201">for</span>&nbsp;<span class="ident" id="4897205">x</span>&nbsp;<span class="op" id="4897207">:=</span>&nbsp;<span class="ident" id="4897210">bounds</span><span class="op" id="4897216">.</span><span class="ident" id="4897217">Min</span><span class="op" id="4897220">.</span><span class="ident" id="4897221">X</span><span class="op" id="4897222">;</span>&nbsp;<span class="ident" id="4897224">x</span>&nbsp;<span class="op" id="4897226">&lt;</span>&nbsp;<span class="ident" id="4897228">bounds</span><span class="op" id="4897234">.</span><span class="ident" id="4897235">Max</span><span class="op" id="4897238">.</span><span class="ident" id="4897239">X</span><span class="op" id="4897240">;</span>&nbsp;<span class="ident" id="4897242">x</span><span class="op" id="4897243">++</span>&nbsp;<span class="op" id="4897246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897251">d</span>&nbsp;<span class="op" id="4897253">:=</span>&nbsp;<span class="ident" id="4897256">dBase</span>&nbsp;<span class="op" id="4897262">+</span>&nbsp;<span class="ident" id="4897264">x</span><span class="op" id="4897265">*</span><span class="ident" id="4897266">p</span><span class="op" id="4897267">.</span><span class="ident" id="4897268">xFactor</span><span class="op" id="4897275">*</span><span class="ident" id="4897276">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4897293">copy</span><span class="op" id="4897297">(</span><span class="ident" id="4897298">dstPix</span><span class="op" id="4897304">[</span><span class="ident" id="4897305">d</span><span class="op" id="4897306">:</span><span class="op" id="4897307">]</span><span class="op" id="4897308">,</span>&nbsp;<span class="ident" id="4897310">srcPix</span><span class="op" id="4897316">[</span><span class="ident" id="4897317">s</span><span class="op" id="4897318">:</span><span class="ident" id="4897319">s</span><span class="op" id="4897320">+</span><span class="ident" id="4897321">bytesPerPixel</span><span class="op" id="4897334">]</span><span class="op" id="4897335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897340">s</span>&nbsp;<span class="op" id="4897342">+=</span>&nbsp;<span class="ident" id="4897345">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897364">}</span><br>
<span class="lineno"></span><span class="op" id="4897366">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="4897369">func</span>&nbsp;<span class="op" id="4897374">(</span><span class="ident" id="4897375">d</span>&nbsp;<span class="op" id="4897377">*</span><span class="ident" id="4897378">decoder</span><span class="op" id="4897385">)</span>&nbsp;<span class="ident" id="4897387">parseIDAT</span><span class="op" id="4897396">(</span><span class="ident" id="4897397">length</span>&nbsp;<span class="builtintype" id="4897404">uint32</span><span class="op" id="4897410">)</span>&nbsp;<span class="op" id="4897412">(</span><span class="ident" id="4897413">err</span>&nbsp;<span class="builtintype" id="4897417">error</span><span class="op" id="4897422">)</span>&nbsp;<span class="op" id="4897424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897427">d</span><span class="op" id="4897428">.</span><span class="ident" id="4897429">idatLength</span>&nbsp;<span class="op" id="4897440">=</span>&nbsp;<span class="ident" id="4897442">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897450">d</span><span class="op" id="4897451">.</span><span class="ident" id="4897452">img</span><span class="op" id="4897455">,</span>&nbsp;<span class="ident" id="4897457">err</span>&nbsp;<span class="op" id="4897461">=</span>&nbsp;<span class="ident" id="4897463">d</span><span class="op" id="4897464">.</span><span class="ident" id="4897465">decode</span><span class="op" id="4897471">(</span><span class="op" id="4897472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897475">if</span>&nbsp;<span class="ident" id="4897478">err</span>&nbsp;<span class="op" id="4897482">!=</span>&nbsp;<span class="ident" id="4897485">nil</span>&nbsp;<span class="op" id="4897489">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897493">return</span>&nbsp;<span class="ident" id="4897500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897508">return</span>&nbsp;<span class="ident" id="4897515">d</span><span class="op" id="4897516">.</span><span class="ident" id="4897517">verifyChecksum</span><span class="op" id="4897531">(</span><span class="op" id="4897532">)</span><br>
<span class="lineno"></span><span class="op" id="4897534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="4897537">func</span>&nbsp;<span class="op" id="4897542">(</span><span class="ident" id="4897543">d</span>&nbsp;<span class="op" id="4897545">*</span><span class="ident" id="4897546">decoder</span><span class="op" id="4897553">)</span>&nbsp;<span class="ident" id="4897555">parseIEND</span><span class="op" id="4897564">(</span><span class="ident" id="4897565">length</span>&nbsp;<span class="builtintype" id="4897572">uint32</span><span class="op" id="4897578">)</span>&nbsp;<span class="builtintype" id="4897580">error</span>&nbsp;<span class="op" id="4897586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897589">if</span>&nbsp;<span class="ident" id="4897592">length</span>&nbsp;<span class="op" id="4897599">!=</span>&nbsp;<span class="num" id="4897602">0</span>&nbsp;<span class="op" id="4897604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897608">return</span>&nbsp;<span class="ident" id="4897615">FormatError</span><span class="op" id="4897626">(</span><span class="string" id="4897627">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="4897644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897650">return</span>&nbsp;<span class="ident" id="4897657">d</span><span class="op" id="4897658">.</span><span class="ident" id="4897659">verifyChecksum</span><span class="op" id="4897673">(</span><span class="op" id="4897674">)</span><br>
<span class="lineno">660</span><span class="op" id="4897676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4897679">func</span>&nbsp;<span class="op" id="4897684">(</span><span class="ident" id="4897685">d</span>&nbsp;<span class="op" id="4897687">*</span><span class="ident" id="4897688">decoder</span><span class="op" id="4897695">)</span>&nbsp;<span class="ident" id="4897697">parseChunk</span><span class="op" id="4897707">(</span><span class="op" id="4897708">)</span>&nbsp;<span class="builtintype" id="4897710">error</span>&nbsp;<span class="op" id="4897716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897719">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897755">n</span><span class="op" id="4897756">,</span>&nbsp;<span class="ident" id="4897758">err</span>&nbsp;<span class="op" id="4897762">:=</span>&nbsp;<span class="ident" id="4897765">io</span><span class="op" id="4897767">.</span><span class="ident" id="4897768">ReadFull</span><span class="op" id="4897776">(</span><span class="ident" id="4897777">d</span><span class="op" id="4897778">.</span><span class="ident" id="4897779">r</span><span class="op" id="4897780">,</span>&nbsp;<span class="ident" id="4897782">d</span><span class="op" id="4897783">.</span><span class="ident" id="4897784">tmp</span><span class="op" id="4897787">[</span><span class="op" id="4897788">:</span><span class="num" id="4897789">8</span><span class="op" id="4897790">]</span><span class="op" id="4897791">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897794">if</span>&nbsp;<span class="ident" id="4897797">err</span>&nbsp;<span class="op" id="4897801">!=</span>&nbsp;<span class="ident" id="4897804">nil</span>&nbsp;<span class="op" id="4897808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897812">return</span>&nbsp;<span class="ident" id="4897819">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897827">length</span>&nbsp;<span class="op" id="4897834">:=</span>&nbsp;<span class="ident" id="4897837">binary</span><span class="op" id="4897843">.</span><span class="ident" id="4897844">BigEndian</span><span class="op" id="4897853">.</span><span class="ident" id="4897854">Uint32</span><span class="op" id="4897860">(</span><span class="ident" id="4897861">d</span><span class="op" id="4897862">.</span><span class="ident" id="4897863">tmp</span><span class="op" id="4897866">[</span><span class="op" id="4897867">:</span><span class="num" id="4897868">4</span><span class="op" id="4897869">]</span><span class="op" id="4897870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897873">d</span><span class="op" id="4897874">.</span><span class="ident" id="4897875">crc</span><span class="op" id="4897878">.</span><span class="ident" id="4897879">Reset</span><span class="op" id="4897884">(</span><span class="op" id="4897885">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897888">d</span><span class="op" id="4897889">.</span><span class="ident" id="4897890">crc</span><span class="op" id="4897893">.</span><span class="ident" id="4897894">Write</span><span class="op" id="4897899">(</span><span class="ident" id="4897900">d</span><span class="op" id="4897901">.</span><span class="ident" id="4897902">tmp</span><span class="op" id="4897905">[</span><span class="num" id="4897906">4</span><span class="op" id="4897907">:</span><span class="num" id="4897908">8</span><span class="op" id="4897909">]</span><span class="op" id="4897910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897914">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897939">switch</span>&nbsp;<span class="builtintype" id="4897946">string</span><span class="op" id="4897952">(</span><span class="ident" id="4897953">d</span><span class="op" id="4897954">.</span><span class="ident" id="4897955">tmp</span><span class="op" id="4897958">[</span><span class="num" id="4897959">4</span><span class="op" id="4897960">:</span><span class="num" id="4897961">8</span><span class="op" id="4897962">]</span><span class="op" id="4897963">)</span>&nbsp;<span class="op" id="4897965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897968">case</span>&nbsp;<span class="string" id="4897973">&#34;IHDR&#34;</span><span class="op" id="4897979">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897983">if</span>&nbsp;<span class="ident" id="4897986">d</span><span class="op" id="4897987">.</span><span class="ident" id="4897988">stage</span>&nbsp;<span class="op" id="4897994">!=</span>&nbsp;<span class="ident" id="4897997">dsStart</span>&nbsp;<span class="op" id="4898005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898010">return</span>&nbsp;<span class="ident" id="4898017">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898039">d</span><span class="op" id="4898040">.</span><span class="ident" id="4898041">stage</span>&nbsp;<span class="op" id="4898047">=</span>&nbsp;<span class="ident" id="4898049">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898062">return</span>&nbsp;<span class="ident" id="4898069">d</span><span class="op" id="4898070">.</span><span class="ident" id="4898071">parseIHDR</span><span class="op" id="4898080">(</span><span class="ident" id="4898081">length</span><span class="op" id="4898087">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898090">case</span>&nbsp;<span class="string" id="4898095">&#34;PLTE&#34;</span><span class="op" id="4898101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898105">if</span>&nbsp;<span class="ident" id="4898108">d</span><span class="op" id="4898109">.</span><span class="ident" id="4898110">stage</span>&nbsp;<span class="op" id="4898116">!=</span>&nbsp;<span class="ident" id="4898119">dsSeenIHDR</span>&nbsp;<span class="op" id="4898130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898135">return</span>&nbsp;<span class="ident" id="4898142">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898164">d</span><span class="op" id="4898165">.</span><span class="ident" id="4898166">stage</span>&nbsp;<span class="op" id="4898172">=</span>&nbsp;<span class="ident" id="4898174">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898187">return</span>&nbsp;<span class="ident" id="4898194">d</span><span class="op" id="4898195">.</span><span class="ident" id="4898196">parsePLTE</span><span class="op" id="4898205">(</span><span class="ident" id="4898206">length</span><span class="op" id="4898212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898215">case</span>&nbsp;<span class="string" id="4898220">&#34;tRNS&#34;</span><span class="op" id="4898226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898230">if</span>&nbsp;<span class="ident" id="4898233">d</span><span class="op" id="4898234">.</span><span class="ident" id="4898235">stage</span>&nbsp;<span class="op" id="4898241">!=</span>&nbsp;<span class="ident" id="4898244">dsSeenPLTE</span>&nbsp;<span class="op" id="4898255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898260">return</span>&nbsp;<span class="ident" id="4898267">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898285">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898289">return</span>&nbsp;<span class="ident" id="4898296">d</span><span class="op" id="4898297">.</span><span class="ident" id="4898298">parsetRNS</span><span class="op" id="4898307">(</span><span class="ident" id="4898308">length</span><span class="op" id="4898314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898317">case</span>&nbsp;<span class="string" id="4898322">&#34;IDAT&#34;</span><span class="op" id="4898328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898332">if</span>&nbsp;<span class="ident" id="4898335">d</span><span class="op" id="4898336">.</span><span class="ident" id="4898337">stage</span>&nbsp;<span class="op" id="4898343">&lt;</span>&nbsp;<span class="ident" id="4898345">dsSeenIHDR</span>&nbsp;<span class="op" id="4898356">||</span>&nbsp;<span class="ident" id="4898359">d</span><span class="op" id="4898360">.</span><span class="ident" id="4898361">stage</span>&nbsp;<span class="op" id="4898367">&gt;</span>&nbsp;<span class="ident" id="4898369">dsSeenIDAT</span>&nbsp;<span class="op" id="4898380">||</span>&nbsp;<span class="op" id="4898383">(</span><span class="ident" id="4898384">d</span><span class="op" id="4898385">.</span><span class="ident" id="4898386">cb</span>&nbsp;<span class="op" id="4898389">==</span>&nbsp;<span class="ident" id="4898392">cbP8</span>&nbsp;<span class="op" id="4898397">&amp;&amp;</span>&nbsp;<span class="ident" id="4898400">d</span><span class="op" id="4898401">.</span><span class="ident" id="4898402">stage</span>&nbsp;<span class="op" id="4898408">==</span>&nbsp;<span class="ident" id="4898411">dsSeenIHDR</span><span class="op" id="4898421">)</span>&nbsp;<span class="op" id="4898423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898428">return</span>&nbsp;<span class="ident" id="4898435">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898453">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898457">d</span><span class="op" id="4898458">.</span><span class="ident" id="4898459">stage</span>&nbsp;<span class="op" id="4898465">=</span>&nbsp;<span class="ident" id="4898467">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898480">return</span>&nbsp;<span class="ident" id="4898487">d</span><span class="op" id="4898488">.</span><span class="ident" id="4898489">parseIDAT</span><span class="op" id="4898498">(</span><span class="ident" id="4898499">length</span><span class="op" id="4898505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898508">case</span>&nbsp;<span class="string" id="4898513">&#34;IEND&#34;</span><span class="op" id="4898519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898523">if</span>&nbsp;<span class="ident" id="4898526">d</span><span class="op" id="4898527">.</span><span class="ident" id="4898528">stage</span>&nbsp;<span class="op" id="4898534">!=</span>&nbsp;<span class="ident" id="4898537">dsSeenIDAT</span>&nbsp;<span class="op" id="4898548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898553">return</span>&nbsp;<span class="ident" id="4898560">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898582">d</span><span class="op" id="4898583">.</span><span class="ident" id="4898584">stage</span>&nbsp;<span class="op" id="4898590">=</span>&nbsp;<span class="ident" id="4898592">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898605">return</span>&nbsp;<span class="ident" id="4898612">d</span><span class="op" id="4898613">.</span><span class="ident" id="4898614">parseIEND</span><span class="op" id="4898623">(</span><span class="ident" id="4898624">length</span><span class="op" id="4898630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4898636">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898679">var</span>&nbsp;<span class="ident" id="4898683">ignored</span>&nbsp;<span class="op" id="4898691">[</span><span class="num" id="4898692">4096</span><span class="op" id="4898696">]</span><span class="builtintype" id="4898697">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898703">for</span>&nbsp;<span class="ident" id="4898707">length</span>&nbsp;<span class="op" id="4898714">&gt;</span>&nbsp;<span class="num" id="4898716">0</span>&nbsp;<span class="op" id="4898718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898722">n</span><span class="op" id="4898723">,</span>&nbsp;<span class="ident" id="4898725">err</span>&nbsp;<span class="op" id="4898729">=</span>&nbsp;<span class="ident" id="4898731">io</span><span class="op" id="4898733">.</span><span class="ident" id="4898734">ReadFull</span><span class="op" id="4898742">(</span><span class="ident" id="4898743">d</span><span class="op" id="4898744">.</span><span class="ident" id="4898745">r</span><span class="op" id="4898746">,</span>&nbsp;<span class="ident" id="4898748">ignored</span><span class="op" id="4898755">[</span><span class="op" id="4898756">:</span><span class="ident" id="4898757">min</span><span class="op" id="4898760">(</span><span class="builtinfunc" id="4898761">len</span><span class="op" id="4898764">(</span><span class="ident" id="4898765">ignored</span><span class="op" id="4898772">)</span><span class="op" id="4898773">,</span>&nbsp;<span class="builtintype" id="4898775">int</span><span class="op" id="4898778">(</span><span class="ident" id="4898779">length</span><span class="op" id="4898785">)</span><span class="op" id="4898786">)</span><span class="op" id="4898787">]</span><span class="op" id="4898788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898792">if</span>&nbsp;<span class="ident" id="4898795">err</span>&nbsp;<span class="op" id="4898799">!=</span>&nbsp;<span class="ident" id="4898802">nil</span>&nbsp;<span class="op" id="4898806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898811">return</span>&nbsp;<span class="ident" id="4898818">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898828">d</span><span class="op" id="4898829">.</span><span class="ident" id="4898830">crc</span><span class="op" id="4898833">.</span><span class="ident" id="4898834">Write</span><span class="op" id="4898839">(</span><span class="ident" id="4898840">ignored</span><span class="op" id="4898847">[</span><span class="op" id="4898848">:</span><span class="ident" id="4898849">n</span><span class="op" id="4898850">]</span><span class="op" id="4898851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898855">length</span>&nbsp;<span class="op" id="4898862">-=</span>&nbsp;<span class="builtintype" id="4898865">uint32</span><span class="op" id="4898871">(</span><span class="ident" id="4898872">n</span><span class="op" id="4898873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898879">return</span>&nbsp;<span class="ident" id="4898886">d</span><span class="op" id="4898887">.</span><span class="ident" id="4898888">verifyChecksum</span><span class="op" id="4898902">(</span><span class="op" id="4898903">)</span><br>
<span class="lineno">715</span><span class="op" id="4898905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4898908">func</span>&nbsp;<span class="op" id="4898913">(</span><span class="ident" id="4898914">d</span>&nbsp;<span class="op" id="4898916">*</span><span class="ident" id="4898917">decoder</span><span class="op" id="4898924">)</span>&nbsp;<span class="ident" id="4898926">verifyChecksum</span><span class="op" id="4898940">(</span><span class="op" id="4898941">)</span>&nbsp;<span class="builtintype" id="4898943">error</span>&nbsp;<span class="op" id="4898949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898952">if</span>&nbsp;<span class="ident" id="4898955">_</span><span class="op" id="4898956">,</span>&nbsp;<span class="ident" id="4898958">err</span>&nbsp;<span class="op" id="4898962">:=</span>&nbsp;<span class="ident" id="4898965">io</span><span class="op" id="4898967">.</span><span class="ident" id="4898968">ReadFull</span><span class="op" id="4898976">(</span><span class="ident" id="4898977">d</span><span class="op" id="4898978">.</span><span class="ident" id="4898979">r</span><span class="op" id="4898980">,</span>&nbsp;<span class="ident" id="4898982">d</span><span class="op" id="4898983">.</span><span class="ident" id="4898984">tmp</span><span class="op" id="4898987">[</span><span class="op" id="4898988">:</span><span class="num" id="4898989">4</span><span class="op" id="4898990">]</span><span class="op" id="4898991">)</span><span class="op" id="4898992">;</span>&nbsp;<span class="ident" id="4898994">err</span>&nbsp;<span class="op" id="4898998">!=</span>&nbsp;<span class="ident" id="4899001">nil</span>&nbsp;<span class="op" id="4899005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899009">return</span>&nbsp;<span class="ident" id="4899016">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899024">if</span>&nbsp;<span class="ident" id="4899027">binary</span><span class="op" id="4899033">.</span><span class="ident" id="4899034">BigEndian</span><span class="op" id="4899043">.</span><span class="ident" id="4899044">Uint32</span><span class="op" id="4899050">(</span><span class="ident" id="4899051">d</span><span class="op" id="4899052">.</span><span class="ident" id="4899053">tmp</span><span class="op" id="4899056">[</span><span class="op" id="4899057">:</span><span class="num" id="4899058">4</span><span class="op" id="4899059">]</span><span class="op" id="4899060">)</span>&nbsp;<span class="op" id="4899062">!=</span>&nbsp;<span class="ident" id="4899065">d</span><span class="op" id="4899066">.</span><span class="ident" id="4899067">crc</span><span class="op" id="4899070">.</span><span class="ident" id="4899071">Sum32</span><span class="op" id="4899076">(</span><span class="op" id="4899077">)</span>&nbsp;<span class="op" id="4899079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899083">return</span>&nbsp;<span class="ident" id="4899090">FormatError</span><span class="op" id="4899101">(</span><span class="string" id="4899102">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="4899120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899126">return</span>&nbsp;<span class="ident" id="4899133">nil</span><br>
<span class="lineno">725</span><span class="op" id="4899137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4899140">func</span>&nbsp;<span class="op" id="4899145">(</span><span class="ident" id="4899146">d</span>&nbsp;<span class="op" id="4899148">*</span><span class="ident" id="4899149">decoder</span><span class="op" id="4899156">)</span>&nbsp;<span class="ident" id="4899158">checkHeader</span><span class="op" id="4899169">(</span><span class="op" id="4899170">)</span>&nbsp;<span class="builtintype" id="4899172">error</span>&nbsp;<span class="op" id="4899178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899181">_</span><span class="op" id="4899182">,</span>&nbsp;<span class="ident" id="4899184">err</span>&nbsp;<span class="op" id="4899188">:=</span>&nbsp;<span class="ident" id="4899191">io</span><span class="op" id="4899193">.</span><span class="ident" id="4899194">ReadFull</span><span class="op" id="4899202">(</span><span class="ident" id="4899203">d</span><span class="op" id="4899204">.</span><span class="ident" id="4899205">r</span><span class="op" id="4899206">,</span>&nbsp;<span class="ident" id="4899208">d</span><span class="op" id="4899209">.</span><span class="ident" id="4899210">tmp</span><span class="op" id="4899213">[</span><span class="op" id="4899214">:</span><span class="builtinfunc" id="4899215">len</span><span class="op" id="4899218">(</span><span class="ident" id="4899219">pngHeader</span><span class="op" id="4899228">)</span><span class="op" id="4899229">]</span><span class="op" id="4899230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899233">if</span>&nbsp;<span class="ident" id="4899236">err</span>&nbsp;<span class="op" id="4899240">!=</span>&nbsp;<span class="ident" id="4899243">nil</span>&nbsp;<span class="op" id="4899247">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899251">return</span>&nbsp;<span class="ident" id="4899258">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899266">if</span>&nbsp;<span class="builtintype" id="4899269">string</span><span class="op" id="4899275">(</span><span class="ident" id="4899276">d</span><span class="op" id="4899277">.</span><span class="ident" id="4899278">tmp</span><span class="op" id="4899281">[</span><span class="op" id="4899282">:</span><span class="builtinfunc" id="4899283">len</span><span class="op" id="4899286">(</span><span class="ident" id="4899287">pngHeader</span><span class="op" id="4899296">)</span><span class="op" id="4899297">]</span><span class="op" id="4899298">)</span>&nbsp;<span class="op" id="4899300">!=</span>&nbsp;<span class="ident" id="4899303">pngHeader</span>&nbsp;<span class="op" id="4899313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899317">return</span>&nbsp;<span class="ident" id="4899324">FormatError</span><span class="op" id="4899335">(</span><span class="string" id="4899336">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="4899352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899355">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899358">return</span>&nbsp;<span class="ident" id="4899365">nil</span><br>
<span class="lineno"></span><span class="op" id="4899369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4899372">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="4899441">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="4899500">func</span>&nbsp;<span class="ident" id="4899505">Decode</span><span class="op" id="4899511">(</span><span class="ident" id="4899512">r</span>&nbsp;<span class="ident" id="4899514">io</span><span class="op" id="4899516">.</span><span class="ident" id="4899517">Reader</span><span class="op" id="4899523">)</span>&nbsp;<span class="op" id="4899525">(</span><span class="ident" id="4899526">image</span><span class="op" id="4899531">.</span><span class="ident" id="4899532">Image</span><span class="op" id="4899537">,</span>&nbsp;<span class="builtintype" id="4899539">error</span><span class="op" id="4899544">)</span>&nbsp;<span class="op" id="4899546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899549">d</span>&nbsp;<span class="op" id="4899551">:=</span>&nbsp;<span class="op" id="4899554">&amp;</span><span class="ident" id="4899555">decoder</span><span class="op" id="4899562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899566">r</span><span class="op" id="4899567">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4899571">r</span><span class="op" id="4899572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899576">crc</span><span class="op" id="4899579">:</span>&nbsp;<span class="ident" id="4899581">crc32</span><span class="op" id="4899586">.</span><span class="ident" id="4899587">NewIEEE</span><span class="op" id="4899594">(</span><span class="op" id="4899595">)</span><span class="op" id="4899596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899599">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899602">if</span>&nbsp;<span class="ident" id="4899605">err</span>&nbsp;<span class="op" id="4899609">:=</span>&nbsp;<span class="ident" id="4899612">d</span><span class="op" id="4899613">.</span><span class="ident" id="4899614">checkHeader</span><span class="op" id="4899625">(</span><span class="op" id="4899626">)</span><span class="op" id="4899627">;</span>&nbsp;<span class="ident" id="4899629">err</span>&nbsp;<span class="op" id="4899633">!=</span>&nbsp;<span class="ident" id="4899636">nil</span>&nbsp;<span class="op" id="4899640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899644">if</span>&nbsp;<span class="ident" id="4899647">err</span>&nbsp;<span class="op" id="4899651">==</span>&nbsp;<span class="ident" id="4899654">io</span><span class="op" id="4899656">.</span><span class="ident" id="4899657">EOF</span>&nbsp;<span class="op" id="4899661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899666">err</span>&nbsp;<span class="op" id="4899670">=</span>&nbsp;<span class="ident" id="4899672">io</span><span class="op" id="4899674">.</span><span class="ident" id="4899675">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899698">return</span>&nbsp;<span class="ident" id="4899705">nil</span><span class="op" id="4899708">,</span>&nbsp;<span class="ident" id="4899710">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899718">for</span>&nbsp;<span class="ident" id="4899722">d</span><span class="op" id="4899723">.</span><span class="ident" id="4899724">stage</span>&nbsp;<span class="op" id="4899730">!=</span>&nbsp;<span class="ident" id="4899733">dsSeenIEND</span>&nbsp;<span class="op" id="4899744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899748">if</span>&nbsp;<span class="ident" id="4899751">err</span>&nbsp;<span class="op" id="4899755">:=</span>&nbsp;<span class="ident" id="4899758">d</span><span class="op" id="4899759">.</span><span class="ident" id="4899760">parseChunk</span><span class="op" id="4899770">(</span><span class="op" id="4899771">)</span><span class="op" id="4899772">;</span>&nbsp;<span class="ident" id="4899774">err</span>&nbsp;<span class="op" id="4899778">!=</span>&nbsp;<span class="ident" id="4899781">nil</span>&nbsp;<span class="op" id="4899785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899790">if</span>&nbsp;<span class="ident" id="4899793">err</span>&nbsp;<span class="op" id="4899797">==</span>&nbsp;<span class="ident" id="4899800">io</span><span class="op" id="4899802">.</span><span class="ident" id="4899803">EOF</span>&nbsp;<span class="op" id="4899807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899813">err</span>&nbsp;<span class="op" id="4899817">=</span>&nbsp;<span class="ident" id="4899819">io</span><span class="op" id="4899821">.</span><span class="ident" id="4899822">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899847">return</span>&nbsp;<span class="ident" id="4899854">nil</span><span class="op" id="4899857">,</span>&nbsp;<span class="ident" id="4899859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899871">return</span>&nbsp;<span class="ident" id="4899878">d</span><span class="op" id="4899879">.</span><span class="ident" id="4899880">img</span><span class="op" id="4899883">,</span>&nbsp;<span class="ident" id="4899885">nil</span><br>
<span class="lineno">760</span><span class="op" id="4899889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4899892">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4899970">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4900000">func</span>&nbsp;<span class="ident" id="4900005">DecodeConfig</span><span class="op" id="4900017">(</span><span class="ident" id="4900018">r</span>&nbsp;<span class="ident" id="4900020">io</span><span class="op" id="4900022">.</span><span class="ident" id="4900023">Reader</span><span class="op" id="4900029">)</span>&nbsp;<span class="op" id="4900031">(</span><span class="ident" id="4900032">image</span><span class="op" id="4900037">.</span><span class="ident" id="4900038">Config</span><span class="op" id="4900044">,</span>&nbsp;<span class="builtintype" id="4900046">error</span><span class="op" id="4900051">)</span>&nbsp;<span class="op" id="4900053">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900056">d</span>&nbsp;<span class="op" id="4900058">:=</span>&nbsp;<span class="op" id="4900061">&amp;</span><span class="ident" id="4900062">decoder</span><span class="op" id="4900069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900073">r</span><span class="op" id="4900074">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4900078">r</span><span class="op" id="4900079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900083">crc</span><span class="op" id="4900086">:</span>&nbsp;<span class="ident" id="4900088">crc32</span><span class="op" id="4900093">.</span><span class="ident" id="4900094">NewIEEE</span><span class="op" id="4900101">(</span><span class="op" id="4900102">)</span><span class="op" id="4900103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900109">if</span>&nbsp;<span class="ident" id="4900112">err</span>&nbsp;<span class="op" id="4900116">:=</span>&nbsp;<span class="ident" id="4900119">d</span><span class="op" id="4900120">.</span><span class="ident" id="4900121">checkHeader</span><span class="op" id="4900132">(</span><span class="op" id="4900133">)</span><span class="op" id="4900134">;</span>&nbsp;<span class="ident" id="4900136">err</span>&nbsp;<span class="op" id="4900140">!=</span>&nbsp;<span class="ident" id="4900143">nil</span>&nbsp;<span class="op" id="4900147">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900151">if</span>&nbsp;<span class="ident" id="4900154">err</span>&nbsp;<span class="op" id="4900158">==</span>&nbsp;<span class="ident" id="4900161">io</span><span class="op" id="4900163">.</span><span class="ident" id="4900164">EOF</span>&nbsp;<span class="op" id="4900168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900173">err</span>&nbsp;<span class="op" id="4900177">=</span>&nbsp;<span class="ident" id="4900179">io</span><span class="op" id="4900181">.</span><span class="ident" id="4900182">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900205">return</span>&nbsp;<span class="ident" id="4900212">image</span><span class="op" id="4900217">.</span><span class="ident" id="4900218">Config</span><span class="op" id="4900224">{</span><span class="op" id="4900225">}</span><span class="op" id="4900226">,</span>&nbsp;<span class="ident" id="4900228">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900233">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900236">for</span>&nbsp;<span class="op" id="4900240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900244">if</span>&nbsp;<span class="ident" id="4900247">err</span>&nbsp;<span class="op" id="4900251">:=</span>&nbsp;<span class="ident" id="4900254">d</span><span class="op" id="4900255">.</span><span class="ident" id="4900256">parseChunk</span><span class="op" id="4900266">(</span><span class="op" id="4900267">)</span><span class="op" id="4900268">;</span>&nbsp;<span class="ident" id="4900270">err</span>&nbsp;<span class="op" id="4900274">!=</span>&nbsp;<span class="ident" id="4900277">nil</span>&nbsp;<span class="op" id="4900281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900286">if</span>&nbsp;<span class="ident" id="4900289">err</span>&nbsp;<span class="op" id="4900293">==</span>&nbsp;<span class="ident" id="4900296">io</span><span class="op" id="4900298">.</span><span class="ident" id="4900299">EOF</span>&nbsp;<span class="op" id="4900303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900309">err</span>&nbsp;<span class="op" id="4900313">=</span>&nbsp;<span class="ident" id="4900315">io</span><span class="op" id="4900317">.</span><span class="ident" id="4900318">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900338">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900343">return</span>&nbsp;<span class="ident" id="4900350">image</span><span class="op" id="4900355">.</span><span class="ident" id="4900356">Config</span><span class="op" id="4900362">{</span><span class="op" id="4900363">}</span><span class="op" id="4900364">,</span>&nbsp;<span class="ident" id="4900366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900376">paletted</span>&nbsp;<span class="op" id="4900385">:=</span>&nbsp;<span class="ident" id="4900388">d</span><span class="op" id="4900389">.</span><span class="ident" id="4900390">cb</span>&nbsp;<span class="op" id="4900393">==</span>&nbsp;<span class="ident" id="4900396">cbP8</span>&nbsp;<span class="op" id="4900401">||</span>&nbsp;<span class="ident" id="4900404">d</span><span class="op" id="4900405">.</span><span class="ident" id="4900406">cb</span>&nbsp;<span class="op" id="4900409">==</span>&nbsp;<span class="ident" id="4900412">cbP4</span>&nbsp;<span class="op" id="4900417">||</span>&nbsp;<span class="ident" id="4900420">d</span><span class="op" id="4900421">.</span><span class="ident" id="4900422">cb</span>&nbsp;<span class="op" id="4900425">==</span>&nbsp;<span class="ident" id="4900428">cbP2</span>&nbsp;<span class="op" id="4900433">||</span>&nbsp;<span class="ident" id="4900436">d</span><span class="op" id="4900437">.</span><span class="ident" id="4900438">cb</span>&nbsp;<span class="op" id="4900441">==</span>&nbsp;<span class="ident" id="4900444">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900451">if</span>&nbsp;<span class="ident" id="4900454">d</span><span class="op" id="4900455">.</span><span class="ident" id="4900456">stage</span>&nbsp;<span class="op" id="4900462">==</span>&nbsp;<span class="ident" id="4900465">dsSeenIHDR</span>&nbsp;<span class="op" id="4900476">&amp;&amp;</span>&nbsp;<span class="op" id="4900479">!</span><span class="ident" id="4900480">paletted</span>&nbsp;<span class="op" id="4900489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900494">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900506">if</span>&nbsp;<span class="ident" id="4900509">d</span><span class="op" id="4900510">.</span><span class="ident" id="4900511">stage</span>&nbsp;<span class="op" id="4900517">==</span>&nbsp;<span class="ident" id="4900520">dsSeenPLTE</span>&nbsp;<span class="op" id="4900531">&amp;&amp;</span>&nbsp;<span class="ident" id="4900534">paletted</span>&nbsp;<span class="op" id="4900543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900548">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900559">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900562">var</span>&nbsp;<span class="ident" id="4900566">cm</span>&nbsp;<span class="ident" id="4900569">color</span><span class="op" id="4900574">.</span><span class="ident" id="4900575">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900582">switch</span>&nbsp;<span class="ident" id="4900589">d</span><span class="op" id="4900590">.</span><span class="ident" id="4900591">cb</span>&nbsp;<span class="op" id="4900594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900597">case</span>&nbsp;<span class="ident" id="4900602">cbG1</span><span class="op" id="4900606">,</span>&nbsp;<span class="ident" id="4900608">cbG2</span><span class="op" id="4900612">,</span>&nbsp;<span class="ident" id="4900614">cbG4</span><span class="op" id="4900618">,</span>&nbsp;<span class="ident" id="4900620">cbG8</span><span class="op" id="4900624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900628">cm</span>&nbsp;<span class="op" id="4900631">=</span>&nbsp;<span class="ident" id="4900633">color</span><span class="op" id="4900638">.</span><span class="ident" id="4900639">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900650">case</span>&nbsp;<span class="ident" id="4900655">cbGA8</span><span class="op" id="4900660">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900664">cm</span>&nbsp;<span class="op" id="4900667">=</span>&nbsp;<span class="ident" id="4900669">color</span><span class="op" id="4900674">.</span><span class="ident" id="4900675">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900687">case</span>&nbsp;<span class="ident" id="4900692">cbTC8</span><span class="op" id="4900697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900701">cm</span>&nbsp;<span class="op" id="4900704">=</span>&nbsp;<span class="ident" id="4900706">color</span><span class="op" id="4900711">.</span><span class="ident" id="4900712">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900723">case</span>&nbsp;<span class="ident" id="4900728">cbP1</span><span class="op" id="4900732">,</span>&nbsp;<span class="ident" id="4900734">cbP2</span><span class="op" id="4900738">,</span>&nbsp;<span class="ident" id="4900740">cbP4</span><span class="op" id="4900744">,</span>&nbsp;<span class="ident" id="4900746">cbP8</span><span class="op" id="4900750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900754">cm</span>&nbsp;<span class="op" id="4900757">=</span>&nbsp;<span class="ident" id="4900759">d</span><span class="op" id="4900760">.</span><span class="ident" id="4900761">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900770">case</span>&nbsp;<span class="ident" id="4900775">cbTCA8</span><span class="op" id="4900781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900785">cm</span>&nbsp;<span class="op" id="4900788">=</span>&nbsp;<span class="ident" id="4900790">color</span><span class="op" id="4900795">.</span><span class="ident" id="4900796">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900808">case</span>&nbsp;<span class="ident" id="4900813">cbG16</span><span class="op" id="4900818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900822">cm</span>&nbsp;<span class="op" id="4900825">=</span>&nbsp;<span class="ident" id="4900827">color</span><span class="op" id="4900832">.</span><span class="ident" id="4900833">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900846">case</span>&nbsp;<span class="ident" id="4900851">cbGA16</span><span class="op" id="4900857">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900861">cm</span>&nbsp;<span class="op" id="4900864">=</span>&nbsp;<span class="ident" id="4900866">color</span><span class="op" id="4900871">.</span><span class="ident" id="4900872">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900886">case</span>&nbsp;<span class="ident" id="4900891">cbTC16</span><span class="op" id="4900897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900901">cm</span>&nbsp;<span class="op" id="4900904">=</span>&nbsp;<span class="ident" id="4900906">color</span><span class="op" id="4900911">.</span><span class="ident" id="4900912">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900925">case</span>&nbsp;<span class="ident" id="4900930">cbTCA16</span><span class="op" id="4900937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900941">cm</span>&nbsp;<span class="op" id="4900944">=</span>&nbsp;<span class="ident" id="4900946">color</span><span class="op" id="4900951">.</span><span class="ident" id="4900952">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900969">return</span>&nbsp;<span class="ident" id="4900976">image</span><span class="op" id="4900981">.</span><span class="ident" id="4900982">Config</span><span class="op" id="4900988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900992">ColorModel</span><span class="op" id="4901002">:</span>&nbsp;<span class="ident" id="4901004">cm</span><span class="op" id="4901006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901010">Width</span><span class="op" id="4901015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901022">d</span><span class="op" id="4901023">.</span><span class="ident" id="4901024">width</span><span class="op" id="4901029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901033">Height</span><span class="op" id="4901039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4901045">d</span><span class="op" id="4901046">.</span><span class="ident" id="4901047">height</span><span class="op" id="4901053">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901056">}</span><span class="op" id="4901057">,</span>&nbsp;<span class="ident" id="4901059">nil</span><br>
<span class="lineno"></span><span class="op" id="4901063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4901066">func</span>&nbsp;<span class="ident" id="4901071">init</span><span class="op" id="4901075">(</span><span class="op" id="4901076">)</span>&nbsp;<span class="op" id="4901078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901081">image</span><span class="op" id="4901086">.</span><span class="ident" id="4901087">RegisterFormat</span><span class="op" id="4901101">(</span><span class="string" id="4901102">&#34;png&#34;</span><span class="op" id="4901107">,</span>&nbsp;<span class="ident" id="4901109">pngHeader</span><span class="op" id="4901118">,</span>&nbsp;<span class="ident" id="4901120">Decode</span><span class="op" id="4901126">,</span>&nbsp;<span class="ident" id="4901128">DecodeConfig</span><span class="op" id="4901140">)</span><br>
<span class="lineno">820</span><span class="op" id="4901142">}</span>
</div>
</body>
</html>
