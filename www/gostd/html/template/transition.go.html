<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5256206">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5256261">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5256315">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5256366">package</span>&nbsp;<span class="ident" id="5256374">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5256384">import</span>&nbsp;<span class="op" id="5256391">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5256394">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5256403">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5256413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256416">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5256495">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5256573">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5256651">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5256661">var</span>&nbsp;<span class="ident" id="5256665">transitionFunc</span>&nbsp;<span class="op" id="5256680">=</span>&nbsp;<span class="op" id="5256682">[</span><span class="op" id="5256683">...</span><span class="op" id="5256686">]</span><span class="keyword" id="5256687">func</span><span class="op" id="5256691">(</span><span class="ident" id="5256692">context</span><span class="op" id="5256699">,</span>&nbsp;<span class="op" id="5256701">[</span><span class="op" id="5256702">]</span><span class="builtintype" id="5256703">byte</span><span class="op" id="5256707">)</span>&nbsp;<span class="op" id="5256709">(</span><span class="ident" id="5256710">context</span><span class="op" id="5256717">,</span>&nbsp;<span class="builtintype" id="5256719">int</span><span class="op" id="5256722">)</span><span class="op" id="5256723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256726">stateText</span><span class="op" id="5256735">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256744">tText</span><span class="op" id="5256749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256752">stateTag</span><span class="op" id="5256760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256770">tTag</span><span class="op" id="5256774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256777">stateAttrName</span><span class="op" id="5256790">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256795">tAttrName</span><span class="op" id="5256804">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256807">stateAfterName</span><span class="op" id="5256821">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5256825">tAfterName</span><span class="op" id="5256835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256838">stateBeforeValue</span><span class="op" id="5256854">:</span>&nbsp;<span class="ident" id="5256856">tBeforeValue</span><span class="op" id="5256868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256871">stateHTMLCmt</span><span class="op" id="5256883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256889">tHTMLCmt</span><span class="op" id="5256897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256900">stateRCDATA</span><span class="op" id="5256911">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256918">tSpecialTagEnd</span><span class="op" id="5256932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256935">stateAttr</span><span class="op" id="5256944">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256953">tAttr</span><span class="op" id="5256958">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256961">stateURL</span><span class="op" id="5256969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256979">tURL</span><span class="op" id="5256983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256986">stateJS</span><span class="op" id="5256993">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257004">tJS</span><span class="op" id="5257007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257010">stateJSDqStr</span><span class="op" id="5257022">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257028">tJSDelimited</span><span class="op" id="5257040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257043">stateJSSqStr</span><span class="op" id="5257055">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257061">tJSDelimited</span><span class="op" id="5257073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257076">stateJSRegexp</span><span class="op" id="5257089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257094">tJSDelimited</span><span class="op" id="5257106">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257109">stateJSBlockCmt</span><span class="op" id="5257124">:</span>&nbsp;&nbsp;<span class="ident" id="5257127">tBlockCmt</span><span class="op" id="5257136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257139">stateJSLineCmt</span><span class="op" id="5257153">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5257157">tLineCmt</span><span class="op" id="5257165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257168">stateCSS</span><span class="op" id="5257176">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257186">tCSS</span><span class="op" id="5257190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257193">stateCSSDqStr</span><span class="op" id="5257206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257211">tCSSStr</span><span class="op" id="5257218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257221">stateCSSSqStr</span><span class="op" id="5257234">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257239">tCSSStr</span><span class="op" id="5257246">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257249">stateCSSDqURL</span><span class="op" id="5257262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257267">tCSSStr</span><span class="op" id="5257274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257277">stateCSSSqURL</span><span class="op" id="5257290">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257295">tCSSStr</span><span class="op" id="5257302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257305">stateCSSURL</span><span class="op" id="5257316">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257323">tCSSStr</span><span class="op" id="5257330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257333">stateCSSBlockCmt</span><span class="op" id="5257349">:</span>&nbsp;<span class="ident" id="5257351">tBlockCmt</span><span class="op" id="5257360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257363">stateCSSLineCmt</span><span class="op" id="5257378">:</span>&nbsp;&nbsp;<span class="ident" id="5257381">tLineCmt</span><span class="op" id="5257389">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257392">stateError</span><span class="op" id="5257402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257410">tError</span><span class="op" id="5257416">,</span><br>
<span class="lineno"></span><span class="op" id="5257418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5257421">var</span>&nbsp;<span class="ident" id="5257425">commentStart</span>&nbsp;<span class="op" id="5257438">=</span>&nbsp;<span class="op" id="5257440">[</span><span class="op" id="5257441">]</span><span class="builtintype" id="5257442">byte</span><span class="op" id="5257446">(</span><span class="string" id="5257447">&#34;&lt;!--&#34;</span><span class="op" id="5257453">)</span><br>
<span class="lineno"></span><span class="keyword" id="5257455">var</span>&nbsp;<span class="ident" id="5257459">commentEnd</span>&nbsp;<span class="op" id="5257470">=</span>&nbsp;<span class="op" id="5257472">[</span><span class="op" id="5257473">]</span><span class="builtintype" id="5257474">byte</span><span class="op" id="5257478">(</span><span class="string" id="5257479">&#34;--&gt;&#34;</span><span class="op" id="5257484">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5257487">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5257551">func</span>&nbsp;<span class="ident" id="5257556">tText</span><span class="op" id="5257561">(</span><span class="ident" id="5257562">c</span>&nbsp;<span class="ident" id="5257564">context</span><span class="op" id="5257571">,</span>&nbsp;<span class="ident" id="5257573">s</span>&nbsp;<span class="op" id="5257575">[</span><span class="op" id="5257576">]</span><span class="builtintype" id="5257577">byte</span><span class="op" id="5257581">)</span>&nbsp;<span class="op" id="5257583">(</span><span class="ident" id="5257584">context</span><span class="op" id="5257591">,</span>&nbsp;<span class="builtintype" id="5257593">int</span><span class="op" id="5257596">)</span>&nbsp;<span class="op" id="5257598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257601">k</span>&nbsp;<span class="op" id="5257603">:=</span>&nbsp;<span class="num" id="5257606">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257609">for</span>&nbsp;<span class="op" id="5257613">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257617">i</span>&nbsp;<span class="op" id="5257619">:=</span>&nbsp;<span class="ident" id="5257622">k</span>&nbsp;<span class="op" id="5257624">+</span>&nbsp;<span class="ident" id="5257626">bytes</span><span class="op" id="5257631">.</span><span class="ident" id="5257632">IndexByte</span><span class="op" id="5257641">(</span><span class="ident" id="5257642">s</span><span class="op" id="5257643">[</span><span class="ident" id="5257644">k</span><span class="op" id="5257645">:</span><span class="op" id="5257646">]</span><span class="op" id="5257647">,</span>&nbsp;<span class="string" id="5257649">&#39;&lt;&#39;</span><span class="op" id="5257652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257656">if</span>&nbsp;<span class="ident" id="5257659">i</span>&nbsp;<span class="op" id="5257661">&lt;</span>&nbsp;<span class="ident" id="5257663">k</span>&nbsp;<span class="op" id="5257665">||</span>&nbsp;<span class="ident" id="5257668">i</span><span class="op" id="5257669">+</span><span class="num" id="5257670">1</span>&nbsp;<span class="op" id="5257672">==</span>&nbsp;<span class="builtinfunc" id="5257675">len</span><span class="op" id="5257678">(</span><span class="ident" id="5257679">s</span><span class="op" id="5257680">)</span>&nbsp;<span class="op" id="5257682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257687">return</span>&nbsp;<span class="ident" id="5257694">c</span><span class="op" id="5257695">,</span>&nbsp;<span class="builtinfunc" id="5257697">len</span><span class="op" id="5257700">(</span><span class="ident" id="5257701">s</span><span class="op" id="5257702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257706">}</span>&nbsp;<span class="keyword" id="5257708">else</span>&nbsp;<span class="keyword" id="5257713">if</span>&nbsp;<span class="ident" id="5257716">i</span><span class="op" id="5257717">+</span><span class="num" id="5257718">4</span>&nbsp;<span class="op" id="5257720">&lt;=</span>&nbsp;<span class="builtinfunc" id="5257723">len</span><span class="op" id="5257726">(</span><span class="ident" id="5257727">s</span><span class="op" id="5257728">)</span>&nbsp;<span class="op" id="5257730">&amp;&amp;</span>&nbsp;<span class="ident" id="5257733">bytes</span><span class="op" id="5257738">.</span><span class="ident" id="5257739">Equal</span><span class="op" id="5257744">(</span><span class="ident" id="5257745">commentStart</span><span class="op" id="5257757">,</span>&nbsp;<span class="ident" id="5257759">s</span><span class="op" id="5257760">[</span><span class="ident" id="5257761">i</span><span class="op" id="5257762">:</span><span class="ident" id="5257763">i</span><span class="op" id="5257764">+</span><span class="num" id="5257765">4</span><span class="op" id="5257766">]</span><span class="op" id="5257767">)</span>&nbsp;<span class="op" id="5257769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257774">return</span>&nbsp;<span class="ident" id="5257781">context</span><span class="op" id="5257788">{</span><span class="ident" id="5257789">state</span><span class="op" id="5257794">:</span>&nbsp;<span class="ident" id="5257796">stateHTMLCmt</span><span class="op" id="5257808">}</span><span class="op" id="5257809">,</span>&nbsp;<span class="ident" id="5257811">i</span>&nbsp;<span class="op" id="5257813">+</span>&nbsp;<span class="num" id="5257815">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257823">i</span><span class="op" id="5257824">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257829">end</span>&nbsp;<span class="op" id="5257833">:=</span>&nbsp;<span class="builtintype" id="5257836">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257844">if</span>&nbsp;<span class="ident" id="5257847">s</span><span class="op" id="5257848">[</span><span class="ident" id="5257849">i</span><span class="op" id="5257850">]</span>&nbsp;<span class="op" id="5257852">==</span>&nbsp;<span class="string" id="5257855">&#39;/&#39;</span>&nbsp;<span class="op" id="5257859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257864">if</span>&nbsp;<span class="ident" id="5257867">i</span><span class="op" id="5257868">+</span><span class="num" id="5257869">1</span>&nbsp;<span class="op" id="5257871">==</span>&nbsp;<span class="builtinfunc" id="5257874">len</span><span class="op" id="5257877">(</span><span class="ident" id="5257878">s</span><span class="op" id="5257879">)</span>&nbsp;<span class="op" id="5257881">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257887">return</span>&nbsp;<span class="ident" id="5257894">c</span><span class="op" id="5257895">,</span>&nbsp;<span class="builtinfunc" id="5257897">len</span><span class="op" id="5257900">(</span><span class="ident" id="5257901">s</span><span class="op" id="5257902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257912">end</span><span class="op" id="5257915">,</span>&nbsp;<span class="ident" id="5257917">i</span>&nbsp;<span class="op" id="5257919">=</span>&nbsp;<span class="builtintype" id="5257921">true</span><span class="op" id="5257925">,</span>&nbsp;<span class="ident" id="5257927">i</span><span class="op" id="5257928">+</span><span class="num" id="5257929">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257937">j</span><span class="op" id="5257938">,</span>&nbsp;<span class="ident" id="5257940">e</span>&nbsp;<span class="op" id="5257942">:=</span>&nbsp;<span class="ident" id="5257945">eatTagName</span><span class="op" id="5257955">(</span><span class="ident" id="5257956">s</span><span class="op" id="5257957">,</span>&nbsp;<span class="ident" id="5257959">i</span><span class="op" id="5257960">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257964">if</span>&nbsp;<span class="ident" id="5257967">j</span>&nbsp;<span class="op" id="5257969">!=</span>&nbsp;<span class="ident" id="5257972">i</span>&nbsp;<span class="op" id="5257974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257979">if</span>&nbsp;<span class="ident" id="5257982">end</span>&nbsp;<span class="op" id="5257986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257992">e</span>&nbsp;<span class="op" id="5257994">=</span>&nbsp;<span class="ident" id="5257996">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258016">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258047">return</span>&nbsp;<span class="ident" id="5258054">context</span><span class="op" id="5258061">{</span><span class="ident" id="5258062">state</span><span class="op" id="5258067">:</span>&nbsp;<span class="ident" id="5258069">stateTag</span><span class="op" id="5258077">,</span>&nbsp;<span class="ident" id="5258079">element</span><span class="op" id="5258086">:</span>&nbsp;<span class="ident" id="5258088">e</span><span class="op" id="5258089">}</span><span class="op" id="5258090">,</span>&nbsp;<span class="ident" id="5258092">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258100">k</span>&nbsp;<span class="op" id="5258102">=</span>&nbsp;<span class="ident" id="5258104">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258107">}</span><br>
<span class="lineno"></span><span class="op" id="5258109">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5258112">var</span>&nbsp;<span class="ident" id="5258116">elementContentType</span>&nbsp;<span class="op" id="5258135">=</span>&nbsp;<span class="op" id="5258137">[</span><span class="op" id="5258138">...</span><span class="op" id="5258141">]</span><span class="ident" id="5258142">state</span><span class="op" id="5258147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258150">elementNone</span><span class="op" id="5258161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258167">stateText</span><span class="op" id="5258176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258179">elementScript</span><span class="op" id="5258192">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5258196">stateJS</span><span class="op" id="5258203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258206">elementStyle</span><span class="op" id="5258218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258223">stateCSS</span><span class="op" id="5258231">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258234">elementTextarea</span><span class="op" id="5258249">:</span>&nbsp;<span class="ident" id="5258251">stateRCDATA</span><span class="op" id="5258262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258265">elementTitle</span><span class="op" id="5258277">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258282">stateRCDATA</span><span class="op" id="5258293">,</span><br>
<span class="lineno"></span><span class="op" id="5258295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258298">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5258360">func</span>&nbsp;<span class="ident" id="5258365">tTag</span><span class="op" id="5258369">(</span><span class="ident" id="5258370">c</span>&nbsp;<span class="ident" id="5258372">context</span><span class="op" id="5258379">,</span>&nbsp;<span class="ident" id="5258381">s</span>&nbsp;<span class="op" id="5258383">[</span><span class="op" id="5258384">]</span><span class="builtintype" id="5258385">byte</span><span class="op" id="5258389">)</span>&nbsp;<span class="op" id="5258391">(</span><span class="ident" id="5258392">context</span><span class="op" id="5258399">,</span>&nbsp;<span class="builtintype" id="5258401">int</span><span class="op" id="5258404">)</span>&nbsp;<span class="op" id="5258406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258409">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258438">i</span>&nbsp;<span class="op" id="5258440">:=</span>&nbsp;<span class="ident" id="5258443">eatWhiteSpace</span><span class="op" id="5258456">(</span><span class="ident" id="5258457">s</span><span class="op" id="5258458">,</span>&nbsp;<span class="num" id="5258460">0</span><span class="op" id="5258461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258464">if</span>&nbsp;<span class="ident" id="5258467">i</span>&nbsp;<span class="op" id="5258469">==</span>&nbsp;<span class="builtinfunc" id="5258472">len</span><span class="op" id="5258475">(</span><span class="ident" id="5258476">s</span><span class="op" id="5258477">)</span>&nbsp;<span class="op" id="5258479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258483">return</span>&nbsp;<span class="ident" id="5258490">c</span><span class="op" id="5258491">,</span>&nbsp;<span class="builtinfunc" id="5258493">len</span><span class="op" id="5258496">(</span><span class="ident" id="5258497">s</span><span class="op" id="5258498">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258504">if</span>&nbsp;<span class="ident" id="5258507">s</span><span class="op" id="5258508">[</span><span class="ident" id="5258509">i</span><span class="op" id="5258510">]</span>&nbsp;<span class="op" id="5258512">==</span>&nbsp;<span class="string" id="5258515">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5258519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258523">return</span>&nbsp;<span class="ident" id="5258530">context</span><span class="op" id="5258537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258542">state</span><span class="op" id="5258547">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5258551">elementContentType</span><span class="op" id="5258569">[</span><span class="ident" id="5258570">c</span><span class="op" id="5258571">.</span><span class="ident" id="5258572">element</span><span class="op" id="5258579">]</span><span class="op" id="5258580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258585">element</span><span class="op" id="5258592">:</span>&nbsp;<span class="ident" id="5258594">c</span><span class="op" id="5258595">.</span><span class="ident" id="5258596">element</span><span class="op" id="5258603">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258607">}</span><span class="op" id="5258608">,</span>&nbsp;<span class="ident" id="5258610">i</span>&nbsp;<span class="op" id="5258612">+</span>&nbsp;<span class="num" id="5258614">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258620">j</span><span class="op" id="5258621">,</span>&nbsp;<span class="ident" id="5258623">err</span>&nbsp;<span class="op" id="5258627">:=</span>&nbsp;<span class="ident" id="5258630">eatAttrName</span><span class="op" id="5258641">(</span><span class="ident" id="5258642">s</span><span class="op" id="5258643">,</span>&nbsp;<span class="ident" id="5258645">i</span><span class="op" id="5258646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258649">if</span>&nbsp;<span class="ident" id="5258652">err</span>&nbsp;<span class="op" id="5258656">!=</span>&nbsp;<span class="ident" id="5258659">nil</span>&nbsp;<span class="op" id="5258663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258667">return</span>&nbsp;<span class="ident" id="5258674">context</span><span class="op" id="5258681">{</span><span class="ident" id="5258682">state</span><span class="op" id="5258687">:</span>&nbsp;<span class="ident" id="5258689">stateError</span><span class="op" id="5258699">,</span>&nbsp;<span class="ident" id="5258701">err</span><span class="op" id="5258704">:</span>&nbsp;<span class="ident" id="5258706">err</span><span class="op" id="5258709">}</span><span class="op" id="5258710">,</span>&nbsp;<span class="builtinfunc" id="5258712">len</span><span class="op" id="5258715">(</span><span class="ident" id="5258716">s</span><span class="op" id="5258717">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258723">state</span><span class="op" id="5258728">,</span>&nbsp;<span class="ident" id="5258730">attr</span>&nbsp;<span class="op" id="5258735">:=</span>&nbsp;<span class="ident" id="5258738">stateTag</span><span class="op" id="5258746">,</span>&nbsp;<span class="ident" id="5258748">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258758">if</span>&nbsp;<span class="ident" id="5258761">i</span>&nbsp;<span class="op" id="5258763">==</span>&nbsp;<span class="ident" id="5258766">j</span>&nbsp;<span class="op" id="5258768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258772">return</span>&nbsp;<span class="ident" id="5258779">context</span><span class="op" id="5258786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258791">state</span><span class="op" id="5258796">:</span>&nbsp;<span class="ident" id="5258798">stateError</span><span class="op" id="5258808">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258813">err</span><span class="op" id="5258816">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5258820">errorf</span><span class="op" id="5258826">(</span><span class="ident" id="5258827">ErrBadHTML</span><span class="op" id="5258837">,</span>&nbsp;<span class="ident" id="5258839">nil</span><span class="op" id="5258842">,</span>&nbsp;<span class="num" id="5258844">0</span><span class="op" id="5258845">,</span>&nbsp;<span class="string" id="5258847">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5258901">,</span>&nbsp;<span class="ident" id="5258903">s</span><span class="op" id="5258904">[</span><span class="ident" id="5258905">i</span><span class="op" id="5258906">:</span><span class="op" id="5258907">]</span><span class="op" id="5258908">)</span><span class="op" id="5258909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258913">}</span><span class="op" id="5258914">,</span>&nbsp;<span class="builtinfunc" id="5258916">len</span><span class="op" id="5258919">(</span><span class="ident" id="5258920">s</span><span class="op" id="5258921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258927">switch</span>&nbsp;<span class="ident" id="5258934">attrType</span><span class="op" id="5258942">(</span><span class="builtintype" id="5258943">string</span><span class="op" id="5258949">(</span><span class="ident" id="5258950">s</span><span class="op" id="5258951">[</span><span class="ident" id="5258952">i</span><span class="op" id="5258953">:</span><span class="ident" id="5258954">j</span><span class="op" id="5258955">]</span><span class="op" id="5258956">)</span><span class="op" id="5258957">)</span>&nbsp;<span class="op" id="5258959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258962">case</span>&nbsp;<span class="ident" id="5258967">contentTypeURL</span><span class="op" id="5258981">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258985">attr</span>&nbsp;<span class="op" id="5258990">=</span>&nbsp;<span class="ident" id="5258992">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259001">case</span>&nbsp;<span class="ident" id="5259006">contentTypeCSS</span><span class="op" id="5259020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259024">attr</span>&nbsp;<span class="op" id="5259029">=</span>&nbsp;<span class="ident" id="5259031">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259042">case</span>&nbsp;<span class="ident" id="5259047">contentTypeJS</span><span class="op" id="5259060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259064">attr</span>&nbsp;<span class="op" id="5259069">=</span>&nbsp;<span class="ident" id="5259071">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259086">if</span>&nbsp;<span class="ident" id="5259089">j</span>&nbsp;<span class="op" id="5259091">==</span>&nbsp;<span class="builtinfunc" id="5259094">len</span><span class="op" id="5259097">(</span><span class="ident" id="5259098">s</span><span class="op" id="5259099">)</span>&nbsp;<span class="op" id="5259101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259105">state</span>&nbsp;<span class="op" id="5259111">=</span>&nbsp;<span class="ident" id="5259113">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259128">}</span>&nbsp;<span class="keyword" id="5259130">else</span>&nbsp;<span class="op" id="5259135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259139">state</span>&nbsp;<span class="op" id="5259145">=</span>&nbsp;<span class="ident" id="5259147">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259166">return</span>&nbsp;<span class="ident" id="5259173">context</span><span class="op" id="5259180">{</span><span class="ident" id="5259181">state</span><span class="op" id="5259186">:</span>&nbsp;<span class="ident" id="5259188">state</span><span class="op" id="5259193">,</span>&nbsp;<span class="ident" id="5259195">element</span><span class="op" id="5259202">:</span>&nbsp;<span class="ident" id="5259204">c</span><span class="op" id="5259205">.</span><span class="ident" id="5259206">element</span><span class="op" id="5259213">,</span>&nbsp;<span class="ident" id="5259215">attr</span><span class="op" id="5259219">:</span>&nbsp;<span class="ident" id="5259221">attr</span><span class="op" id="5259225">}</span><span class="op" id="5259226">,</span>&nbsp;<span class="ident" id="5259228">j</span><br>
<span class="lineno"></span><span class="op" id="5259230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259233">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5259300">func</span>&nbsp;<span class="ident" id="5259305">tAttrName</span><span class="op" id="5259314">(</span><span class="ident" id="5259315">c</span>&nbsp;<span class="ident" id="5259317">context</span><span class="op" id="5259324">,</span>&nbsp;<span class="ident" id="5259326">s</span>&nbsp;<span class="op" id="5259328">[</span><span class="op" id="5259329">]</span><span class="builtintype" id="5259330">byte</span><span class="op" id="5259334">)</span>&nbsp;<span class="op" id="5259336">(</span><span class="ident" id="5259337">context</span><span class="op" id="5259344">,</span>&nbsp;<span class="builtintype" id="5259346">int</span><span class="op" id="5259349">)</span>&nbsp;<span class="op" id="5259351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259354">i</span><span class="op" id="5259355">,</span>&nbsp;<span class="ident" id="5259357">err</span>&nbsp;<span class="op" id="5259361">:=</span>&nbsp;<span class="ident" id="5259364">eatAttrName</span><span class="op" id="5259375">(</span><span class="ident" id="5259376">s</span><span class="op" id="5259377">,</span>&nbsp;<span class="num" id="5259379">0</span><span class="op" id="5259380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259383">if</span>&nbsp;<span class="ident" id="5259386">err</span>&nbsp;<span class="op" id="5259390">!=</span>&nbsp;<span class="ident" id="5259393">nil</span>&nbsp;<span class="op" id="5259397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259401">return</span>&nbsp;<span class="ident" id="5259408">context</span><span class="op" id="5259415">{</span><span class="ident" id="5259416">state</span><span class="op" id="5259421">:</span>&nbsp;<span class="ident" id="5259423">stateError</span><span class="op" id="5259433">,</span>&nbsp;<span class="ident" id="5259435">err</span><span class="op" id="5259438">:</span>&nbsp;<span class="ident" id="5259440">err</span><span class="op" id="5259443">}</span><span class="op" id="5259444">,</span>&nbsp;<span class="builtinfunc" id="5259446">len</span><span class="op" id="5259449">(</span><span class="ident" id="5259450">s</span><span class="op" id="5259451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259454">}</span>&nbsp;<span class="keyword" id="5259456">else</span>&nbsp;<span class="keyword" id="5259461">if</span>&nbsp;<span class="ident" id="5259464">i</span>&nbsp;<span class="op" id="5259466">!=</span>&nbsp;<span class="builtinfunc" id="5259469">len</span><span class="op" id="5259472">(</span><span class="ident" id="5259473">s</span><span class="op" id="5259474">)</span>&nbsp;<span class="op" id="5259476">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259480">c</span><span class="op" id="5259481">.</span><span class="ident" id="5259482">state</span>&nbsp;<span class="op" id="5259488">=</span>&nbsp;<span class="ident" id="5259490">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259509">return</span>&nbsp;<span class="ident" id="5259516">c</span><span class="op" id="5259517">,</span>&nbsp;<span class="ident" id="5259519">i</span><br>
<span class="lineno"></span><span class="op" id="5259521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5259524">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5259593">func</span>&nbsp;<span class="ident" id="5259598">tAfterName</span><span class="op" id="5259608">(</span><span class="ident" id="5259609">c</span>&nbsp;<span class="ident" id="5259611">context</span><span class="op" id="5259618">,</span>&nbsp;<span class="ident" id="5259620">s</span>&nbsp;<span class="op" id="5259622">[</span><span class="op" id="5259623">]</span><span class="builtintype" id="5259624">byte</span><span class="op" id="5259628">)</span>&nbsp;<span class="op" id="5259630">(</span><span class="ident" id="5259631">context</span><span class="op" id="5259638">,</span>&nbsp;<span class="builtintype" id="5259640">int</span><span class="op" id="5259643">)</span>&nbsp;<span class="op" id="5259645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259648">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259685">i</span>&nbsp;<span class="op" id="5259687">:=</span>&nbsp;<span class="ident" id="5259690">eatWhiteSpace</span><span class="op" id="5259703">(</span><span class="ident" id="5259704">s</span><span class="op" id="5259705">,</span>&nbsp;<span class="num" id="5259707">0</span><span class="op" id="5259708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259711">if</span>&nbsp;<span class="ident" id="5259714">i</span>&nbsp;<span class="op" id="5259716">==</span>&nbsp;<span class="builtinfunc" id="5259719">len</span><span class="op" id="5259722">(</span><span class="ident" id="5259723">s</span><span class="op" id="5259724">)</span>&nbsp;<span class="op" id="5259726">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259730">return</span>&nbsp;<span class="ident" id="5259737">c</span><span class="op" id="5259738">,</span>&nbsp;<span class="builtinfunc" id="5259740">len</span><span class="op" id="5259743">(</span><span class="ident" id="5259744">s</span><span class="op" id="5259745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259748">}</span>&nbsp;<span class="keyword" id="5259750">else</span>&nbsp;<span class="keyword" id="5259755">if</span>&nbsp;<span class="ident" id="5259758">s</span><span class="op" id="5259759">[</span><span class="ident" id="5259760">i</span><span class="op" id="5259761">]</span>&nbsp;<span class="op" id="5259763">!=</span>&nbsp;<span class="string" id="5259766">&#39;=&#39;</span>&nbsp;<span class="op" id="5259770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259774">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259834">c</span><span class="op" id="5259835">.</span><span class="ident" id="5259836">state</span>&nbsp;<span class="op" id="5259842">=</span>&nbsp;<span class="ident" id="5259844">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259855">return</span>&nbsp;<span class="ident" id="5259862">c</span><span class="op" id="5259863">,</span>&nbsp;<span class="ident" id="5259865">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259871">c</span><span class="op" id="5259872">.</span><span class="ident" id="5259873">state</span>&nbsp;<span class="op" id="5259879">=</span>&nbsp;<span class="ident" id="5259881">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259899">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259920">return</span>&nbsp;<span class="ident" id="5259927">c</span><span class="op" id="5259928">,</span>&nbsp;<span class="ident" id="5259930">i</span>&nbsp;<span class="op" id="5259932">+</span>&nbsp;<span class="num" id="5259934">1</span><br>
<span class="lineno"></span><span class="op" id="5259936">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5259939">var</span>&nbsp;<span class="ident" id="5259943">attrStartStates</span>&nbsp;<span class="op" id="5259959">=</span>&nbsp;<span class="op" id="5259961">[</span><span class="op" id="5259962">...</span><span class="op" id="5259965">]</span><span class="ident" id="5259966">state</span><span class="op" id="5259971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259974">attrNone</span><span class="op" id="5259982">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5259986">stateAttr</span><span class="op" id="5259995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259998">attrScript</span><span class="op" id="5260008">:</span>&nbsp;<span class="ident" id="5260010">stateJS</span><span class="op" id="5260017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260020">attrStyle</span><span class="op" id="5260029">:</span>&nbsp;&nbsp;<span class="ident" id="5260032">stateCSS</span><span class="op" id="5260040">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260043">attrURL</span><span class="op" id="5260050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260055">stateURL</span><span class="op" id="5260063">,</span><br>
<span class="lineno"></span><span class="op" id="5260065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260068">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5260141">func</span>&nbsp;<span class="ident" id="5260146">tBeforeValue</span><span class="op" id="5260158">(</span><span class="ident" id="5260159">c</span>&nbsp;<span class="ident" id="5260161">context</span><span class="op" id="5260168">,</span>&nbsp;<span class="ident" id="5260170">s</span>&nbsp;<span class="op" id="5260172">[</span><span class="op" id="5260173">]</span><span class="builtintype" id="5260174">byte</span><span class="op" id="5260178">)</span>&nbsp;<span class="op" id="5260180">(</span><span class="ident" id="5260181">context</span><span class="op" id="5260188">,</span>&nbsp;<span class="builtintype" id="5260190">int</span><span class="op" id="5260193">)</span>&nbsp;<span class="op" id="5260195">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260198">i</span>&nbsp;<span class="op" id="5260200">:=</span>&nbsp;<span class="ident" id="5260203">eatWhiteSpace</span><span class="op" id="5260216">(</span><span class="ident" id="5260217">s</span><span class="op" id="5260218">,</span>&nbsp;<span class="num" id="5260220">0</span><span class="op" id="5260221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260224">if</span>&nbsp;<span class="ident" id="5260227">i</span>&nbsp;<span class="op" id="5260229">==</span>&nbsp;<span class="builtinfunc" id="5260232">len</span><span class="op" id="5260235">(</span><span class="ident" id="5260236">s</span><span class="op" id="5260237">)</span>&nbsp;<span class="op" id="5260239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260243">return</span>&nbsp;<span class="ident" id="5260250">c</span><span class="op" id="5260251">,</span>&nbsp;<span class="builtinfunc" id="5260253">len</span><span class="op" id="5260256">(</span><span class="ident" id="5260257">s</span><span class="op" id="5260258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260264">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260298">delim</span>&nbsp;<span class="op" id="5260304">:=</span>&nbsp;<span class="ident" id="5260307">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260327">switch</span>&nbsp;<span class="ident" id="5260334">s</span><span class="op" id="5260335">[</span><span class="ident" id="5260336">i</span><span class="op" id="5260337">]</span>&nbsp;<span class="op" id="5260339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260342">case</span>&nbsp;<span class="string" id="5260347">&#39;\&#39;&#39;</span><span class="op" id="5260351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260355">delim</span><span class="op" id="5260360">,</span>&nbsp;<span class="ident" id="5260362">i</span>&nbsp;<span class="op" id="5260364">=</span>&nbsp;<span class="ident" id="5260366">delimSingleQuote</span><span class="op" id="5260382">,</span>&nbsp;<span class="ident" id="5260384">i</span><span class="op" id="5260385">+</span><span class="num" id="5260386">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260389">case</span>&nbsp;<span class="string" id="5260394">&#39;&#34;&#39;</span><span class="op" id="5260397">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260401">delim</span><span class="op" id="5260406">,</span>&nbsp;<span class="ident" id="5260408">i</span>&nbsp;<span class="op" id="5260410">=</span>&nbsp;<span class="ident" id="5260412">delimDoubleQuote</span><span class="op" id="5260428">,</span>&nbsp;<span class="ident" id="5260430">i</span><span class="op" id="5260431">+</span><span class="num" id="5260432">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260438">c</span><span class="op" id="5260439">.</span><span class="ident" id="5260440">state</span><span class="op" id="5260445">,</span>&nbsp;<span class="ident" id="5260447">c</span><span class="op" id="5260448">.</span><span class="ident" id="5260449">delim</span><span class="op" id="5260454">,</span>&nbsp;<span class="ident" id="5260456">c</span><span class="op" id="5260457">.</span><span class="ident" id="5260458">attr</span>&nbsp;<span class="op" id="5260463">=</span>&nbsp;<span class="ident" id="5260465">attrStartStates</span><span class="op" id="5260480">[</span><span class="ident" id="5260481">c</span><span class="op" id="5260482">.</span><span class="ident" id="5260483">attr</span><span class="op" id="5260487">]</span><span class="op" id="5260488">,</span>&nbsp;<span class="ident" id="5260490">delim</span><span class="op" id="5260495">,</span>&nbsp;<span class="ident" id="5260497">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260507">return</span>&nbsp;<span class="ident" id="5260514">c</span><span class="op" id="5260515">,</span>&nbsp;<span class="ident" id="5260517">i</span><br>
<span class="lineno"></span><span class="op" id="5260519">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5260522">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5260587">func</span>&nbsp;<span class="ident" id="5260592">tHTMLCmt</span><span class="op" id="5260600">(</span><span class="ident" id="5260601">c</span>&nbsp;<span class="ident" id="5260603">context</span><span class="op" id="5260610">,</span>&nbsp;<span class="ident" id="5260612">s</span>&nbsp;<span class="op" id="5260614">[</span><span class="op" id="5260615">]</span><span class="builtintype" id="5260616">byte</span><span class="op" id="5260620">)</span>&nbsp;<span class="op" id="5260622">(</span><span class="ident" id="5260623">context</span><span class="op" id="5260630">,</span>&nbsp;<span class="builtintype" id="5260632">int</span><span class="op" id="5260635">)</span>&nbsp;<span class="op" id="5260637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260640">if</span>&nbsp;<span class="ident" id="5260643">i</span>&nbsp;<span class="op" id="5260645">:=</span>&nbsp;<span class="ident" id="5260648">bytes</span><span class="op" id="5260653">.</span><span class="ident" id="5260654">Index</span><span class="op" id="5260659">(</span><span class="ident" id="5260660">s</span><span class="op" id="5260661">,</span>&nbsp;<span class="ident" id="5260663">commentEnd</span><span class="op" id="5260673">)</span><span class="op" id="5260674">;</span>&nbsp;<span class="ident" id="5260676">i</span>&nbsp;<span class="op" id="5260678">!=</span>&nbsp;<span class="op" id="5260681">-</span><span class="num" id="5260682">1</span>&nbsp;<span class="op" id="5260684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260688">return</span>&nbsp;<span class="ident" id="5260695">context</span><span class="op" id="5260702">{</span><span class="op" id="5260703">}</span><span class="op" id="5260704">,</span>&nbsp;<span class="ident" id="5260706">i</span>&nbsp;<span class="op" id="5260708">+</span>&nbsp;<span class="num" id="5260710">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260716">return</span>&nbsp;<span class="ident" id="5260723">c</span><span class="op" id="5260724">,</span>&nbsp;<span class="builtinfunc" id="5260726">len</span><span class="op" id="5260729">(</span><span class="ident" id="5260730">s</span><span class="op" id="5260731">)</span><br>
<span class="lineno"></span><span class="op" id="5260733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260736">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5260810">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5260873">var</span>&nbsp;<span class="ident" id="5260877">specialTagEndMarkers</span>&nbsp;<span class="op" id="5260898">=</span>&nbsp;<span class="op" id="5260900">[</span><span class="op" id="5260901">...</span><span class="op" id="5260904">]</span><span class="builtintype" id="5260905">string</span><span class="op" id="5260911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260914">elementScript</span><span class="op" id="5260927">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5260931">&#34;&lt;/script&#34;</span><span class="op" id="5260941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260944">elementStyle</span><span class="op" id="5260956">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5260961">&#34;&lt;/style&#34;</span><span class="op" id="5260970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260973">elementTextarea</span><span class="op" id="5260988">:</span>&nbsp;<span class="string" id="5260990">&#34;&lt;/textarea&#34;</span><span class="op" id="5261002">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261005">elementTitle</span><span class="op" id="5261017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5261022">&#34;&lt;/title&#34;</span><span class="op" id="5261031">,</span><br>
<span class="lineno"></span><span class="op" id="5261033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261036">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5261113">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5261132">func</span>&nbsp;<span class="ident" id="5261137">tSpecialTagEnd</span><span class="op" id="5261151">(</span><span class="ident" id="5261152">c</span>&nbsp;<span class="ident" id="5261154">context</span><span class="op" id="5261161">,</span>&nbsp;<span class="ident" id="5261163">s</span>&nbsp;<span class="op" id="5261165">[</span><span class="op" id="5261166">]</span><span class="builtintype" id="5261167">byte</span><span class="op" id="5261171">)</span>&nbsp;<span class="op" id="5261173">(</span><span class="ident" id="5261174">context</span><span class="op" id="5261181">,</span>&nbsp;<span class="builtintype" id="5261183">int</span><span class="op" id="5261186">)</span>&nbsp;<span class="op" id="5261188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261191">if</span>&nbsp;<span class="ident" id="5261194">c</span><span class="op" id="5261195">.</span><span class="ident" id="5261196">element</span>&nbsp;<span class="op" id="5261204">!=</span>&nbsp;<span class="ident" id="5261207">elementNone</span>&nbsp;<span class="op" id="5261219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261223">if</span>&nbsp;<span class="ident" id="5261226">i</span>&nbsp;<span class="op" id="5261228">:=</span>&nbsp;<span class="ident" id="5261231">strings</span><span class="op" id="5261238">.</span><span class="ident" id="5261239">Index</span><span class="op" id="5261244">(</span><span class="ident" id="5261245">strings</span><span class="op" id="5261252">.</span><span class="ident" id="5261253">ToLower</span><span class="op" id="5261260">(</span><span class="builtintype" id="5261261">string</span><span class="op" id="5261267">(</span><span class="ident" id="5261268">s</span><span class="op" id="5261269">)</span><span class="op" id="5261270">)</span><span class="op" id="5261271">,</span>&nbsp;<span class="ident" id="5261273">specialTagEndMarkers</span><span class="op" id="5261293">[</span><span class="ident" id="5261294">c</span><span class="op" id="5261295">.</span><span class="ident" id="5261296">element</span><span class="op" id="5261303">]</span><span class="op" id="5261304">)</span><span class="op" id="5261305">;</span>&nbsp;<span class="ident" id="5261307">i</span>&nbsp;<span class="op" id="5261309">!=</span>&nbsp;<span class="op" id="5261312">-</span><span class="num" id="5261313">1</span>&nbsp;<span class="op" id="5261315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261320">return</span>&nbsp;<span class="ident" id="5261327">context</span><span class="op" id="5261334">{</span><span class="op" id="5261335">}</span><span class="op" id="5261336">,</span>&nbsp;<span class="ident" id="5261338">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261342">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261348">return</span>&nbsp;<span class="ident" id="5261355">c</span><span class="op" id="5261356">,</span>&nbsp;<span class="builtinfunc" id="5261358">len</span><span class="op" id="5261361">(</span><span class="ident" id="5261362">s</span><span class="op" id="5261363">)</span><br>
<span class="lineno"></span><span class="op" id="5261365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261368">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5261437">func</span>&nbsp;<span class="ident" id="5261442">tAttr</span><span class="op" id="5261447">(</span><span class="ident" id="5261448">c</span>&nbsp;<span class="ident" id="5261450">context</span><span class="op" id="5261457">,</span>&nbsp;<span class="ident" id="5261459">s</span>&nbsp;<span class="op" id="5261461">[</span><span class="op" id="5261462">]</span><span class="builtintype" id="5261463">byte</span><span class="op" id="5261467">)</span>&nbsp;<span class="op" id="5261469">(</span><span class="ident" id="5261470">context</span><span class="op" id="5261477">,</span>&nbsp;<span class="builtintype" id="5261479">int</span><span class="op" id="5261482">)</span>&nbsp;<span class="op" id="5261484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261487">return</span>&nbsp;<span class="ident" id="5261494">c</span><span class="op" id="5261495">,</span>&nbsp;<span class="builtinfunc" id="5261497">len</span><span class="op" id="5261500">(</span><span class="ident" id="5261501">s</span><span class="op" id="5261502">)</span><br>
<span class="lineno"></span><span class="op" id="5261504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261507">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5261569">func</span>&nbsp;<span class="ident" id="5261574">tURL</span><span class="op" id="5261578">(</span><span class="ident" id="5261579">c</span>&nbsp;<span class="ident" id="5261581">context</span><span class="op" id="5261588">,</span>&nbsp;<span class="ident" id="5261590">s</span>&nbsp;<span class="op" id="5261592">[</span><span class="op" id="5261593">]</span><span class="builtintype" id="5261594">byte</span><span class="op" id="5261598">)</span>&nbsp;<span class="op" id="5261600">(</span><span class="ident" id="5261601">context</span><span class="op" id="5261608">,</span>&nbsp;<span class="builtintype" id="5261610">int</span><span class="op" id="5261613">)</span>&nbsp;<span class="op" id="5261615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261618">if</span>&nbsp;<span class="ident" id="5261621">bytes</span><span class="op" id="5261626">.</span><span class="ident" id="5261627">IndexAny</span><span class="op" id="5261635">(</span><span class="ident" id="5261636">s</span><span class="op" id="5261637">,</span>&nbsp;<span class="string" id="5261639">&#34;#?&#34;</span><span class="op" id="5261643">)</span>&nbsp;<span class="op" id="5261645">&gt;=</span>&nbsp;<span class="num" id="5261648">0</span>&nbsp;<span class="op" id="5261650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261654">c</span><span class="op" id="5261655">.</span><span class="ident" id="5261656">urlPart</span>&nbsp;<span class="op" id="5261664">=</span>&nbsp;<span class="ident" id="5261666">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261686">}</span>&nbsp;<span class="keyword" id="5261688">else</span>&nbsp;<span class="keyword" id="5261693">if</span>&nbsp;<span class="builtinfunc" id="5261696">len</span><span class="op" id="5261699">(</span><span class="ident" id="5261700">s</span><span class="op" id="5261701">)</span>&nbsp;<span class="op" id="5261703">!=</span>&nbsp;<span class="ident" id="5261706">eatWhiteSpace</span><span class="op" id="5261719">(</span><span class="ident" id="5261720">s</span><span class="op" id="5261721">,</span>&nbsp;<span class="num" id="5261723">0</span><span class="op" id="5261724">)</span>&nbsp;<span class="op" id="5261726">&amp;&amp;</span>&nbsp;<span class="ident" id="5261729">c</span><span class="op" id="5261730">.</span><span class="ident" id="5261731">urlPart</span>&nbsp;<span class="op" id="5261739">==</span>&nbsp;<span class="ident" id="5261742">urlPartNone</span>&nbsp;<span class="op" id="5261754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261758">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261823">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261886">c</span><span class="op" id="5261887">.</span><span class="ident" id="5261888">urlPart</span>&nbsp;<span class="op" id="5261896">=</span>&nbsp;<span class="ident" id="5261898">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261918">return</span>&nbsp;<span class="ident" id="5261925">c</span><span class="op" id="5261926">,</span>&nbsp;<span class="builtinfunc" id="5261928">len</span><span class="op" id="5261931">(</span><span class="ident" id="5261932">s</span><span class="op" id="5261933">)</span><br>
<span class="lineno"></span><span class="op" id="5261935">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5261938">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5261998">func</span>&nbsp;<span class="ident" id="5262003">tJS</span><span class="op" id="5262006">(</span><span class="ident" id="5262007">c</span>&nbsp;<span class="ident" id="5262009">context</span><span class="op" id="5262016">,</span>&nbsp;<span class="ident" id="5262018">s</span>&nbsp;<span class="op" id="5262020">[</span><span class="op" id="5262021">]</span><span class="builtintype" id="5262022">byte</span><span class="op" id="5262026">)</span>&nbsp;<span class="op" id="5262028">(</span><span class="ident" id="5262029">context</span><span class="op" id="5262036">,</span>&nbsp;<span class="builtintype" id="5262038">int</span><span class="op" id="5262041">)</span>&nbsp;<span class="op" id="5262043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262046">i</span>&nbsp;<span class="op" id="5262048">:=</span>&nbsp;<span class="ident" id="5262051">bytes</span><span class="op" id="5262056">.</span><span class="ident" id="5262057">IndexAny</span><span class="op" id="5262065">(</span><span class="ident" id="5262066">s</span><span class="op" id="5262067">,</span>&nbsp;<span class="string" id="5262069">`&#34;&#39;/`</span><span class="op" id="5262074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262077">if</span>&nbsp;<span class="ident" id="5262080">i</span>&nbsp;<span class="op" id="5262082">==</span>&nbsp;<span class="op" id="5262085">-</span><span class="num" id="5262086">1</span>&nbsp;<span class="op" id="5262088">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262092">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262149">c</span><span class="op" id="5262150">.</span><span class="ident" id="5262151">jsCtx</span>&nbsp;<span class="op" id="5262157">=</span>&nbsp;<span class="ident" id="5262159">nextJSCtx</span><span class="op" id="5262168">(</span><span class="ident" id="5262169">s</span><span class="op" id="5262170">,</span>&nbsp;<span class="ident" id="5262172">c</span><span class="op" id="5262173">.</span><span class="ident" id="5262174">jsCtx</span><span class="op" id="5262179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262183">return</span>&nbsp;<span class="ident" id="5262190">c</span><span class="op" id="5262191">,</span>&nbsp;<span class="builtinfunc" id="5262193">len</span><span class="op" id="5262196">(</span><span class="ident" id="5262197">s</span><span class="op" id="5262198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262204">c</span><span class="op" id="5262205">.</span><span class="ident" id="5262206">jsCtx</span>&nbsp;<span class="op" id="5262212">=</span>&nbsp;<span class="ident" id="5262214">nextJSCtx</span><span class="op" id="5262223">(</span><span class="ident" id="5262224">s</span><span class="op" id="5262225">[</span><span class="op" id="5262226">:</span><span class="ident" id="5262227">i</span><span class="op" id="5262228">]</span><span class="op" id="5262229">,</span>&nbsp;<span class="ident" id="5262231">c</span><span class="op" id="5262232">.</span><span class="ident" id="5262233">jsCtx</span><span class="op" id="5262238">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262241">switch</span>&nbsp;<span class="ident" id="5262248">s</span><span class="op" id="5262249">[</span><span class="ident" id="5262250">i</span><span class="op" id="5262251">]</span>&nbsp;<span class="op" id="5262253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262256">case</span>&nbsp;<span class="string" id="5262261">&#39;&#34;&#39;</span><span class="op" id="5262264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262268">c</span><span class="op" id="5262269">.</span><span class="ident" id="5262270">state</span><span class="op" id="5262275">,</span>&nbsp;<span class="ident" id="5262277">c</span><span class="op" id="5262278">.</span><span class="ident" id="5262279">jsCtx</span>&nbsp;<span class="op" id="5262285">=</span>&nbsp;<span class="ident" id="5262287">stateJSDqStr</span><span class="op" id="5262299">,</span>&nbsp;<span class="ident" id="5262301">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262314">case</span>&nbsp;<span class="string" id="5262319">&#39;\&#39;&#39;</span><span class="op" id="5262323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262327">c</span><span class="op" id="5262328">.</span><span class="ident" id="5262329">state</span><span class="op" id="5262334">,</span>&nbsp;<span class="ident" id="5262336">c</span><span class="op" id="5262337">.</span><span class="ident" id="5262338">jsCtx</span>&nbsp;<span class="op" id="5262344">=</span>&nbsp;<span class="ident" id="5262346">stateJSSqStr</span><span class="op" id="5262358">,</span>&nbsp;<span class="ident" id="5262360">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262373">case</span>&nbsp;<span class="string" id="5262378">&#39;/&#39;</span><span class="op" id="5262381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262385">switch</span>&nbsp;<span class="op" id="5262392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262396">case</span>&nbsp;<span class="ident" id="5262401">i</span><span class="op" id="5262402">+</span><span class="num" id="5262403">1</span>&nbsp;<span class="op" id="5262405">&lt;</span>&nbsp;<span class="builtinfunc" id="5262407">len</span><span class="op" id="5262410">(</span><span class="ident" id="5262411">s</span><span class="op" id="5262412">)</span>&nbsp;<span class="op" id="5262414">&amp;&amp;</span>&nbsp;<span class="ident" id="5262417">s</span><span class="op" id="5262418">[</span><span class="ident" id="5262419">i</span><span class="op" id="5262420">+</span><span class="num" id="5262421">1</span><span class="op" id="5262422">]</span>&nbsp;<span class="op" id="5262424">==</span>&nbsp;<span class="string" id="5262427">&#39;/&#39;</span><span class="op" id="5262430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262435">c</span><span class="op" id="5262436">.</span><span class="ident" id="5262437">state</span><span class="op" id="5262442">,</span>&nbsp;<span class="ident" id="5262444">i</span>&nbsp;<span class="op" id="5262446">=</span>&nbsp;<span class="ident" id="5262448">stateJSLineCmt</span><span class="op" id="5262462">,</span>&nbsp;<span class="ident" id="5262464">i</span><span class="op" id="5262465">+</span><span class="num" id="5262466">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262470">case</span>&nbsp;<span class="ident" id="5262475">i</span><span class="op" id="5262476">+</span><span class="num" id="5262477">1</span>&nbsp;<span class="op" id="5262479">&lt;</span>&nbsp;<span class="builtinfunc" id="5262481">len</span><span class="op" id="5262484">(</span><span class="ident" id="5262485">s</span><span class="op" id="5262486">)</span>&nbsp;<span class="op" id="5262488">&amp;&amp;</span>&nbsp;<span class="ident" id="5262491">s</span><span class="op" id="5262492">[</span><span class="ident" id="5262493">i</span><span class="op" id="5262494">+</span><span class="num" id="5262495">1</span><span class="op" id="5262496">]</span>&nbsp;<span class="op" id="5262498">==</span>&nbsp;<span class="string" id="5262501">&#39;*&#39;</span><span class="op" id="5262504">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262509">c</span><span class="op" id="5262510">.</span><span class="ident" id="5262511">state</span><span class="op" id="5262516">,</span>&nbsp;<span class="ident" id="5262518">i</span>&nbsp;<span class="op" id="5262520">=</span>&nbsp;<span class="ident" id="5262522">stateJSBlockCmt</span><span class="op" id="5262537">,</span>&nbsp;<span class="ident" id="5262539">i</span><span class="op" id="5262540">+</span><span class="num" id="5262541">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262545">case</span>&nbsp;<span class="ident" id="5262550">c</span><span class="op" id="5262551">.</span><span class="ident" id="5262552">jsCtx</span>&nbsp;<span class="op" id="5262558">==</span>&nbsp;<span class="ident" id="5262561">jsCtxRegexp</span><span class="op" id="5262572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262577">c</span><span class="op" id="5262578">.</span><span class="ident" id="5262579">state</span>&nbsp;<span class="op" id="5262585">=</span>&nbsp;<span class="ident" id="5262587">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262603">case</span>&nbsp;<span class="ident" id="5262608">c</span><span class="op" id="5262609">.</span><span class="ident" id="5262610">jsCtx</span>&nbsp;<span class="op" id="5262616">==</span>&nbsp;<span class="ident" id="5262619">jsCtxDivOp</span><span class="op" id="5262629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262634">c</span><span class="op" id="5262635">.</span><span class="ident" id="5262636">jsCtx</span>&nbsp;<span class="op" id="5262642">=</span>&nbsp;<span class="ident" id="5262644">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262658">default</span><span class="op" id="5262665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262670">return</span>&nbsp;<span class="ident" id="5262677">context</span><span class="op" id="5262684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262690">state</span><span class="op" id="5262695">:</span>&nbsp;<span class="ident" id="5262697">stateError</span><span class="op" id="5262707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262713">err</span><span class="op" id="5262716">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5262720">errorf</span><span class="op" id="5262726">(</span><span class="ident" id="5262727">ErrSlashAmbig</span><span class="op" id="5262740">,</span>&nbsp;<span class="ident" id="5262742">nil</span><span class="op" id="5262745">,</span>&nbsp;<span class="num" id="5262747">0</span><span class="op" id="5262748">,</span>&nbsp;<span class="string" id="5262750">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5262795">,</span>&nbsp;<span class="ident" id="5262797">s</span><span class="op" id="5262798">[</span><span class="ident" id="5262799">i</span><span class="op" id="5262800">:</span><span class="op" id="5262801">]</span><span class="op" id="5262802">)</span><span class="op" id="5262803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262808">}</span><span class="op" id="5262809">,</span>&nbsp;<span class="builtinfunc" id="5262811">len</span><span class="op" id="5262814">(</span><span class="ident" id="5262815">s</span><span class="op" id="5262816">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262823">default</span><span class="op" id="5262830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5262834">panic</span><span class="op" id="5262839">(</span><span class="string" id="5262840">&#34;unreachable&#34;</span><span class="op" id="5262853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262859">return</span>&nbsp;<span class="ident" id="5262866">c</span><span class="op" id="5262867">,</span>&nbsp;<span class="ident" id="5262869">i</span>&nbsp;<span class="op" id="5262871">+</span>&nbsp;<span class="num" id="5262873">1</span><br>
<span class="lineno">255</span><span class="op" id="5262875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262878">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5262958">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5262969">func</span>&nbsp;<span class="ident" id="5262974">tJSDelimited</span><span class="op" id="5262986">(</span><span class="ident" id="5262987">c</span>&nbsp;<span class="ident" id="5262989">context</span><span class="op" id="5262996">,</span>&nbsp;<span class="ident" id="5262998">s</span>&nbsp;<span class="op" id="5263000">[</span><span class="op" id="5263001">]</span><span class="builtintype" id="5263002">byte</span><span class="op" id="5263006">)</span>&nbsp;<span class="op" id="5263008">(</span><span class="ident" id="5263009">context</span><span class="op" id="5263016">,</span>&nbsp;<span class="builtintype" id="5263018">int</span><span class="op" id="5263021">)</span>&nbsp;<span class="op" id="5263023">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263026">specials</span>&nbsp;<span class="op" id="5263035">:=</span>&nbsp;<span class="string" id="5263038">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263044">switch</span>&nbsp;<span class="ident" id="5263051">c</span><span class="op" id="5263052">.</span><span class="ident" id="5263053">state</span>&nbsp;<span class="op" id="5263059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263062">case</span>&nbsp;<span class="ident" id="5263067">stateJSSqStr</span><span class="op" id="5263079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263083">specials</span>&nbsp;<span class="op" id="5263092">=</span>&nbsp;<span class="string" id="5263094">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263100">case</span>&nbsp;<span class="ident" id="5263105">stateJSRegexp</span><span class="op" id="5263118">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263122">specials</span>&nbsp;<span class="op" id="5263131">=</span>&nbsp;<span class="string" id="5263133">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263145">k</span><span class="op" id="5263146">,</span>&nbsp;<span class="ident" id="5263148">inCharset</span>&nbsp;<span class="op" id="5263158">:=</span>&nbsp;<span class="num" id="5263161">0</span><span class="op" id="5263162">,</span>&nbsp;<span class="builtintype" id="5263164">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263171">for</span>&nbsp;<span class="op" id="5263175">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263179">i</span>&nbsp;<span class="op" id="5263181">:=</span>&nbsp;<span class="ident" id="5263184">k</span>&nbsp;<span class="op" id="5263186">+</span>&nbsp;<span class="ident" id="5263188">bytes</span><span class="op" id="5263193">.</span><span class="ident" id="5263194">IndexAny</span><span class="op" id="5263202">(</span><span class="ident" id="5263203">s</span><span class="op" id="5263204">[</span><span class="ident" id="5263205">k</span><span class="op" id="5263206">:</span><span class="op" id="5263207">]</span><span class="op" id="5263208">,</span>&nbsp;<span class="ident" id="5263210">specials</span><span class="op" id="5263218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263222">if</span>&nbsp;<span class="ident" id="5263225">i</span>&nbsp;<span class="op" id="5263227">&lt;</span>&nbsp;<span class="ident" id="5263229">k</span>&nbsp;<span class="op" id="5263231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263236">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263248">switch</span>&nbsp;<span class="ident" id="5263255">s</span><span class="op" id="5263256">[</span><span class="ident" id="5263257">i</span><span class="op" id="5263258">]</span>&nbsp;<span class="op" id="5263260">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263264">case</span>&nbsp;<span class="string" id="5263269">&#39;\\&#39;</span><span class="op" id="5263273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263278">i</span><span class="op" id="5263279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263285">if</span>&nbsp;<span class="ident" id="5263288">i</span>&nbsp;<span class="op" id="5263290">==</span>&nbsp;<span class="builtinfunc" id="5263293">len</span><span class="op" id="5263296">(</span><span class="ident" id="5263297">s</span><span class="op" id="5263298">)</span>&nbsp;<span class="op" id="5263300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263306">return</span>&nbsp;<span class="ident" id="5263313">context</span><span class="op" id="5263320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263327">state</span><span class="op" id="5263332">:</span>&nbsp;<span class="ident" id="5263334">stateError</span><span class="op" id="5263344">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263351">err</span><span class="op" id="5263354">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5263358">errorf</span><span class="op" id="5263364">(</span><span class="ident" id="5263365">ErrPartialEscape</span><span class="op" id="5263381">,</span>&nbsp;<span class="ident" id="5263383">nil</span><span class="op" id="5263386">,</span>&nbsp;<span class="num" id="5263388">0</span><span class="op" id="5263389">,</span>&nbsp;<span class="string" id="5263391">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5263436">,</span>&nbsp;<span class="ident" id="5263438">s</span><span class="op" id="5263439">)</span><span class="op" id="5263440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263446">}</span><span class="op" id="5263447">,</span>&nbsp;<span class="builtinfunc" id="5263449">len</span><span class="op" id="5263452">(</span><span class="ident" id="5263453">s</span><span class="op" id="5263454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263463">case</span>&nbsp;<span class="string" id="5263468">&#39;[&#39;</span><span class="op" id="5263471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263476">inCharset</span>&nbsp;<span class="op" id="5263486">=</span>&nbsp;<span class="builtintype" id="5263488">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263495">case</span>&nbsp;<span class="string" id="5263500">&#39;]&#39;</span><span class="op" id="5263503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263508">inCharset</span>&nbsp;<span class="op" id="5263518">=</span>&nbsp;<span class="builtintype" id="5263520">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263528">default</span><span class="op" id="5263535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263540">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263560">if</span>&nbsp;<span class="op" id="5263563">!</span><span class="ident" id="5263564">inCharset</span>&nbsp;<span class="op" id="5263574">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263580">c</span><span class="op" id="5263581">.</span><span class="ident" id="5263582">state</span><span class="op" id="5263587">,</span>&nbsp;<span class="ident" id="5263589">c</span><span class="op" id="5263590">.</span><span class="ident" id="5263591">jsCtx</span>&nbsp;<span class="op" id="5263597">=</span>&nbsp;<span class="ident" id="5263599">stateJS</span><span class="op" id="5263606">,</span>&nbsp;<span class="ident" id="5263608">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263623">return</span>&nbsp;<span class="ident" id="5263630">c</span><span class="op" id="5263631">,</span>&nbsp;<span class="ident" id="5263633">i</span>&nbsp;<span class="op" id="5263635">+</span>&nbsp;<span class="num" id="5263637">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263650">k</span>&nbsp;<span class="op" id="5263652">=</span>&nbsp;<span class="ident" id="5263654">i</span>&nbsp;<span class="op" id="5263656">+</span>&nbsp;<span class="num" id="5263658">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263665">if</span>&nbsp;<span class="ident" id="5263668">inCharset</span>&nbsp;<span class="op" id="5263678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263682">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263747">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263778">return</span>&nbsp;<span class="ident" id="5263785">context</span><span class="op" id="5263792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263797">state</span><span class="op" id="5263802">:</span>&nbsp;<span class="ident" id="5263804">stateError</span><span class="op" id="5263814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263819">err</span><span class="op" id="5263822">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5263826">errorf</span><span class="op" id="5263832">(</span><span class="ident" id="5263833">ErrPartialCharset</span><span class="op" id="5263850">,</span>&nbsp;<span class="ident" id="5263852">nil</span><span class="op" id="5263855">,</span>&nbsp;<span class="num" id="5263857">0</span><span class="op" id="5263858">,</span>&nbsp;<span class="string" id="5263860">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5263894">,</span>&nbsp;<span class="ident" id="5263896">s</span><span class="op" id="5263897">)</span><span class="op" id="5263898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263902">}</span><span class="op" id="5263903">,</span>&nbsp;<span class="builtinfunc" id="5263905">len</span><span class="op" id="5263908">(</span><span class="ident" id="5263909">s</span><span class="op" id="5263910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263913">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263917">return</span>&nbsp;<span class="ident" id="5263924">c</span><span class="op" id="5263925">,</span>&nbsp;<span class="builtinfunc" id="5263927">len</span><span class="op" id="5263930">(</span><span class="ident" id="5263931">s</span><span class="op" id="5263932">)</span><br>
<span class="lineno"></span><span class="op" id="5263934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5263937">var</span>&nbsp;<span class="ident" id="5263941">blockCommentEnd</span>&nbsp;<span class="op" id="5263957">=</span>&nbsp;<span class="op" id="5263959">[</span><span class="op" id="5263960">]</span><span class="builtintype" id="5263961">byte</span><span class="op" id="5263965">(</span><span class="string" id="5263966">&#34;*/&#34;</span><span class="op" id="5263970">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5263973">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5264045">func</span>&nbsp;<span class="ident" id="5264050">tBlockCmt</span><span class="op" id="5264059">(</span><span class="ident" id="5264060">c</span>&nbsp;<span class="ident" id="5264062">context</span><span class="op" id="5264069">,</span>&nbsp;<span class="ident" id="5264071">s</span>&nbsp;<span class="op" id="5264073">[</span><span class="op" id="5264074">]</span><span class="builtintype" id="5264075">byte</span><span class="op" id="5264079">)</span>&nbsp;<span class="op" id="5264081">(</span><span class="ident" id="5264082">context</span><span class="op" id="5264089">,</span>&nbsp;<span class="builtintype" id="5264091">int</span><span class="op" id="5264094">)</span>&nbsp;<span class="op" id="5264096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264099">i</span>&nbsp;<span class="op" id="5264101">:=</span>&nbsp;<span class="ident" id="5264104">bytes</span><span class="op" id="5264109">.</span><span class="ident" id="5264110">Index</span><span class="op" id="5264115">(</span><span class="ident" id="5264116">s</span><span class="op" id="5264117">,</span>&nbsp;<span class="ident" id="5264119">blockCommentEnd</span><span class="op" id="5264134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264137">if</span>&nbsp;<span class="ident" id="5264140">i</span>&nbsp;<span class="op" id="5264142">==</span>&nbsp;<span class="op" id="5264145">-</span><span class="num" id="5264146">1</span>&nbsp;<span class="op" id="5264148">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264152">return</span>&nbsp;<span class="ident" id="5264159">c</span><span class="op" id="5264160">,</span>&nbsp;<span class="builtinfunc" id="5264162">len</span><span class="op" id="5264165">(</span><span class="ident" id="5264166">s</span><span class="op" id="5264167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264173">switch</span>&nbsp;<span class="ident" id="5264180">c</span><span class="op" id="5264181">.</span><span class="ident" id="5264182">state</span>&nbsp;<span class="op" id="5264188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264191">case</span>&nbsp;<span class="ident" id="5264196">stateJSBlockCmt</span><span class="op" id="5264211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264215">c</span><span class="op" id="5264216">.</span><span class="ident" id="5264217">state</span>&nbsp;<span class="op" id="5264223">=</span>&nbsp;<span class="ident" id="5264225">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264234">case</span>&nbsp;<span class="ident" id="5264239">stateCSSBlockCmt</span><span class="op" id="5264255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264259">c</span><span class="op" id="5264260">.</span><span class="ident" id="5264261">state</span>&nbsp;<span class="op" id="5264267">=</span>&nbsp;<span class="ident" id="5264269">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264279">default</span><span class="op" id="5264286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5264290">panic</span><span class="op" id="5264295">(</span><span class="ident" id="5264296">c</span><span class="op" id="5264297">.</span><span class="ident" id="5264298">state</span><span class="op" id="5264303">.</span><span class="ident" id="5264304">String</span><span class="op" id="5264310">(</span><span class="op" id="5264311">)</span><span class="op" id="5264312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264315">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264318">return</span>&nbsp;<span class="ident" id="5264325">c</span><span class="op" id="5264326">,</span>&nbsp;<span class="ident" id="5264328">i</span>&nbsp;<span class="op" id="5264330">+</span>&nbsp;<span class="num" id="5264332">2</span><br>
<span class="lineno"></span><span class="op" id="5264334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264337">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5264406">func</span>&nbsp;<span class="ident" id="5264411">tLineCmt</span><span class="op" id="5264419">(</span><span class="ident" id="5264420">c</span>&nbsp;<span class="ident" id="5264422">context</span><span class="op" id="5264429">,</span>&nbsp;<span class="ident" id="5264431">s</span>&nbsp;<span class="op" id="5264433">[</span><span class="op" id="5264434">]</span><span class="builtintype" id="5264435">byte</span><span class="op" id="5264439">)</span>&nbsp;<span class="op" id="5264441">(</span><span class="ident" id="5264442">context</span><span class="op" id="5264449">,</span>&nbsp;<span class="builtintype" id="5264451">int</span><span class="op" id="5264454">)</span>&nbsp;<span class="op" id="5264456">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264459">var</span>&nbsp;<span class="ident" id="5264463">lineTerminators</span>&nbsp;<span class="builtintype" id="5264479">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264487">var</span>&nbsp;<span class="ident" id="5264491">endState</span>&nbsp;<span class="ident" id="5264500">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264507">switch</span>&nbsp;<span class="ident" id="5264514">c</span><span class="op" id="5264515">.</span><span class="ident" id="5264516">state</span>&nbsp;<span class="op" id="5264522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264525">case</span>&nbsp;<span class="ident" id="5264530">stateJSLineCmt</span><span class="op" id="5264544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264548">lineTerminators</span><span class="op" id="5264563">,</span>&nbsp;<span class="ident" id="5264565">endState</span>&nbsp;<span class="op" id="5264574">=</span>&nbsp;<span class="string" id="5264576">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5264594">,</span>&nbsp;<span class="ident" id="5264596">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264605">case</span>&nbsp;<span class="ident" id="5264610">stateCSSLineCmt</span><span class="op" id="5264625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264629">lineTerminators</span><span class="op" id="5264644">,</span>&nbsp;<span class="ident" id="5264646">endState</span>&nbsp;<span class="op" id="5264655">=</span>&nbsp;<span class="string" id="5264657">&#34;\n\f\r&#34;</span><span class="op" id="5264665">,</span>&nbsp;<span class="ident" id="5264667">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264678">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264744">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264788">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264864">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264927">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264942">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264983">default</span><span class="op" id="5264990">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5264994">panic</span><span class="op" id="5264999">(</span><span class="ident" id="5265000">c</span><span class="op" id="5265001">.</span><span class="ident" id="5265002">state</span><span class="op" id="5265007">.</span><span class="ident" id="5265008">String</span><span class="op" id="5265014">(</span><span class="op" id="5265015">)</span><span class="op" id="5265016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265023">i</span>&nbsp;<span class="op" id="5265025">:=</span>&nbsp;<span class="ident" id="5265028">bytes</span><span class="op" id="5265033">.</span><span class="ident" id="5265034">IndexAny</span><span class="op" id="5265042">(</span><span class="ident" id="5265043">s</span><span class="op" id="5265044">,</span>&nbsp;<span class="ident" id="5265046">lineTerminators</span><span class="op" id="5265061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265064">if</span>&nbsp;<span class="ident" id="5265067">i</span>&nbsp;<span class="op" id="5265069">==</span>&nbsp;<span class="op" id="5265072">-</span><span class="num" id="5265073">1</span>&nbsp;<span class="op" id="5265075">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265079">return</span>&nbsp;<span class="ident" id="5265086">c</span><span class="op" id="5265087">,</span>&nbsp;<span class="builtinfunc" id="5265089">len</span><span class="op" id="5265092">(</span><span class="ident" id="5265093">s</span><span class="op" id="5265094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265100">c</span><span class="op" id="5265101">.</span><span class="ident" id="5265102">state</span>&nbsp;<span class="op" id="5265108">=</span>&nbsp;<span class="ident" id="5265110">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265120">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265186">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265249">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265309">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265375">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265439">return</span>&nbsp;<span class="ident" id="5265446">c</span><span class="op" id="5265447">,</span>&nbsp;<span class="ident" id="5265449">i</span><br>
<span class="lineno"></span><span class="op" id="5265451">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5265454">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5265516">func</span>&nbsp;<span class="ident" id="5265521">tCSS</span><span class="op" id="5265525">(</span><span class="ident" id="5265526">c</span>&nbsp;<span class="ident" id="5265528">context</span><span class="op" id="5265535">,</span>&nbsp;<span class="ident" id="5265537">s</span>&nbsp;<span class="op" id="5265539">[</span><span class="op" id="5265540">]</span><span class="builtintype" id="5265541">byte</span><span class="op" id="5265545">)</span>&nbsp;<span class="op" id="5265547">(</span><span class="ident" id="5265548">context</span><span class="op" id="5265555">,</span>&nbsp;<span class="builtintype" id="5265557">int</span><span class="op" id="5265560">)</span>&nbsp;<span class="op" id="5265562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265565">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265622">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265664">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265730">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265792">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265807">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265860">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265906">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265957">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266018">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266034">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266091">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266161">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266165">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266228">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266263">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266267">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266321">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266390">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266462">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266483">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266551">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266621">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266682">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266753">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266822">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266861">k</span>&nbsp;<span class="op" id="5266863">:=</span>&nbsp;<span class="num" id="5266866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266869">for</span>&nbsp;<span class="op" id="5266873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266877">i</span>&nbsp;<span class="op" id="5266879">:=</span>&nbsp;<span class="ident" id="5266882">k</span>&nbsp;<span class="op" id="5266884">+</span>&nbsp;<span class="ident" id="5266886">bytes</span><span class="op" id="5266891">.</span><span class="ident" id="5266892">IndexAny</span><span class="op" id="5266900">(</span><span class="ident" id="5266901">s</span><span class="op" id="5266902">[</span><span class="ident" id="5266903">k</span><span class="op" id="5266904">:</span><span class="op" id="5266905">]</span><span class="op" id="5266906">,</span>&nbsp;<span class="string" id="5266908">`(&#34;&#39;/`</span><span class="op" id="5266914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266918">if</span>&nbsp;<span class="ident" id="5266921">i</span>&nbsp;<span class="op" id="5266923">&lt;</span>&nbsp;<span class="ident" id="5266925">k</span>&nbsp;<span class="op" id="5266927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266932">return</span>&nbsp;<span class="ident" id="5266939">c</span><span class="op" id="5266940">,</span>&nbsp;<span class="builtinfunc" id="5266942">len</span><span class="op" id="5266945">(</span><span class="ident" id="5266946">s</span><span class="op" id="5266947">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266955">switch</span>&nbsp;<span class="ident" id="5266962">s</span><span class="op" id="5266963">[</span><span class="ident" id="5266964">i</span><span class="op" id="5266965">]</span>&nbsp;<span class="op" id="5266967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266971">case</span>&nbsp;<span class="string" id="5266976">&#39;(&#39;</span><span class="op" id="5266979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266984">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267016">p</span>&nbsp;<span class="op" id="5267018">:=</span>&nbsp;<span class="ident" id="5267021">bytes</span><span class="op" id="5267026">.</span><span class="ident" id="5267027">TrimRight</span><span class="op" id="5267036">(</span><span class="ident" id="5267037">s</span><span class="op" id="5267038">[</span><span class="op" id="5267039">:</span><span class="ident" id="5267040">i</span><span class="op" id="5267041">]</span><span class="op" id="5267042">,</span>&nbsp;<span class="string" id="5267044">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5267055">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267060">if</span>&nbsp;<span class="ident" id="5267063">endsWithCSSKeyword</span><span class="op" id="5267081">(</span><span class="ident" id="5267082">p</span><span class="op" id="5267083">,</span>&nbsp;<span class="string" id="5267085">&#34;url&#34;</span><span class="op" id="5267090">)</span>&nbsp;<span class="op" id="5267092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267098">j</span>&nbsp;<span class="op" id="5267100">:=</span>&nbsp;<span class="builtinfunc" id="5267103">len</span><span class="op" id="5267106">(</span><span class="ident" id="5267107">s</span><span class="op" id="5267108">)</span>&nbsp;<span class="op" id="5267110">-</span>&nbsp;<span class="builtinfunc" id="5267112">len</span><span class="op" id="5267115">(</span><span class="ident" id="5267116">bytes</span><span class="op" id="5267121">.</span><span class="ident" id="5267122">TrimLeft</span><span class="op" id="5267130">(</span><span class="ident" id="5267131">s</span><span class="op" id="5267132">[</span><span class="ident" id="5267133">i</span><span class="op" id="5267134">+</span><span class="num" id="5267135">1</span><span class="op" id="5267136">:</span><span class="op" id="5267137">]</span><span class="op" id="5267138">,</span>&nbsp;<span class="string" id="5267140">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5267151">)</span><span class="op" id="5267152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267158">switch</span>&nbsp;<span class="op" id="5267165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267171">case</span>&nbsp;<span class="ident" id="5267176">j</span>&nbsp;<span class="op" id="5267178">!=</span>&nbsp;<span class="builtinfunc" id="5267181">len</span><span class="op" id="5267184">(</span><span class="ident" id="5267185">s</span><span class="op" id="5267186">)</span>&nbsp;<span class="op" id="5267188">&amp;&amp;</span>&nbsp;<span class="ident" id="5267191">s</span><span class="op" id="5267192">[</span><span class="ident" id="5267193">j</span><span class="op" id="5267194">]</span>&nbsp;<span class="op" id="5267196">==</span>&nbsp;<span class="string" id="5267199">&#39;&#34;&#39;</span><span class="op" id="5267202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267209">c</span><span class="op" id="5267210">.</span><span class="ident" id="5267211">state</span><span class="op" id="5267216">,</span>&nbsp;<span class="ident" id="5267218">j</span>&nbsp;<span class="op" id="5267220">=</span>&nbsp;<span class="ident" id="5267222">stateCSSDqURL</span><span class="op" id="5267235">,</span>&nbsp;<span class="ident" id="5267237">j</span><span class="op" id="5267238">+</span><span class="num" id="5267239">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267245">case</span>&nbsp;<span class="ident" id="5267250">j</span>&nbsp;<span class="op" id="5267252">!=</span>&nbsp;<span class="builtinfunc" id="5267255">len</span><span class="op" id="5267258">(</span><span class="ident" id="5267259">s</span><span class="op" id="5267260">)</span>&nbsp;<span class="op" id="5267262">&amp;&amp;</span>&nbsp;<span class="ident" id="5267265">s</span><span class="op" id="5267266">[</span><span class="ident" id="5267267">j</span><span class="op" id="5267268">]</span>&nbsp;<span class="op" id="5267270">==</span>&nbsp;<span class="string" id="5267273">&#39;\&#39;&#39;</span><span class="op" id="5267277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267284">c</span><span class="op" id="5267285">.</span><span class="ident" id="5267286">state</span><span class="op" id="5267291">,</span>&nbsp;<span class="ident" id="5267293">j</span>&nbsp;<span class="op" id="5267295">=</span>&nbsp;<span class="ident" id="5267297">stateCSSSqURL</span><span class="op" id="5267310">,</span>&nbsp;<span class="ident" id="5267312">j</span><span class="op" id="5267313">+</span><span class="num" id="5267314">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267320">default</span><span class="op" id="5267327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267334">c</span><span class="op" id="5267335">.</span><span class="ident" id="5267336">state</span>&nbsp;<span class="op" id="5267342">=</span>&nbsp;<span class="ident" id="5267344">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267360">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267366">return</span>&nbsp;<span class="ident" id="5267373">c</span><span class="op" id="5267374">,</span>&nbsp;<span class="ident" id="5267376">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267385">case</span>&nbsp;<span class="string" id="5267390">&#39;/&#39;</span><span class="op" id="5267393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267398">if</span>&nbsp;<span class="ident" id="5267401">i</span><span class="op" id="5267402">+</span><span class="num" id="5267403">1</span>&nbsp;<span class="op" id="5267405">&lt;</span>&nbsp;<span class="builtinfunc" id="5267407">len</span><span class="op" id="5267410">(</span><span class="ident" id="5267411">s</span><span class="op" id="5267412">)</span>&nbsp;<span class="op" id="5267414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267420">switch</span>&nbsp;<span class="ident" id="5267427">s</span><span class="op" id="5267428">[</span><span class="ident" id="5267429">i</span><span class="op" id="5267430">+</span><span class="num" id="5267431">1</span><span class="op" id="5267432">]</span>&nbsp;<span class="op" id="5267434">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267440">case</span>&nbsp;<span class="string" id="5267445">&#39;/&#39;</span><span class="op" id="5267448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267455">c</span><span class="op" id="5267456">.</span><span class="ident" id="5267457">state</span>&nbsp;<span class="op" id="5267463">=</span>&nbsp;<span class="ident" id="5267465">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267486">return</span>&nbsp;<span class="ident" id="5267493">c</span><span class="op" id="5267494">,</span>&nbsp;<span class="ident" id="5267496">i</span>&nbsp;<span class="op" id="5267498">+</span>&nbsp;<span class="num" id="5267500">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267506">case</span>&nbsp;<span class="string" id="5267511">&#39;*&#39;</span><span class="op" id="5267514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267521">c</span><span class="op" id="5267522">.</span><span class="ident" id="5267523">state</span>&nbsp;<span class="op" id="5267529">=</span>&nbsp;<span class="ident" id="5267531">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267553">return</span>&nbsp;<span class="ident" id="5267560">c</span><span class="op" id="5267561">,</span>&nbsp;<span class="ident" id="5267563">i</span>&nbsp;<span class="op" id="5267565">+</span>&nbsp;<span class="num" id="5267567">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267582">case</span>&nbsp;<span class="string" id="5267587">&#39;&#34;&#39;</span><span class="op" id="5267590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267595">c</span><span class="op" id="5267596">.</span><span class="ident" id="5267597">state</span>&nbsp;<span class="op" id="5267603">=</span>&nbsp;<span class="ident" id="5267605">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267622">return</span>&nbsp;<span class="ident" id="5267629">c</span><span class="op" id="5267630">,</span>&nbsp;<span class="ident" id="5267632">i</span>&nbsp;<span class="op" id="5267634">+</span>&nbsp;<span class="num" id="5267636">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267640">case</span>&nbsp;<span class="string" id="5267645">&#39;\&#39;&#39;</span><span class="op" id="5267649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267654">c</span><span class="op" id="5267655">.</span><span class="ident" id="5267656">state</span>&nbsp;<span class="op" id="5267662">=</span>&nbsp;<span class="ident" id="5267664">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267681">return</span>&nbsp;<span class="ident" id="5267688">c</span><span class="op" id="5267689">,</span>&nbsp;<span class="ident" id="5267691">i</span>&nbsp;<span class="op" id="5267693">+</span>&nbsp;<span class="num" id="5267695">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267699">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267703">k</span>&nbsp;<span class="op" id="5267705">=</span>&nbsp;<span class="ident" id="5267707">i</span>&nbsp;<span class="op" id="5267709">+</span>&nbsp;<span class="num" id="5267711">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267714">}</span><br>
<span class="lineno"></span><span class="op" id="5267716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5267719">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5267800">func</span>&nbsp;<span class="ident" id="5267805">tCSSStr</span><span class="op" id="5267812">(</span><span class="ident" id="5267813">c</span>&nbsp;<span class="ident" id="5267815">context</span><span class="op" id="5267822">,</span>&nbsp;<span class="ident" id="5267824">s</span>&nbsp;<span class="op" id="5267826">[</span><span class="op" id="5267827">]</span><span class="builtintype" id="5267828">byte</span><span class="op" id="5267832">)</span>&nbsp;<span class="op" id="5267834">(</span><span class="ident" id="5267835">context</span><span class="op" id="5267842">,</span>&nbsp;<span class="builtintype" id="5267844">int</span><span class="op" id="5267847">)</span>&nbsp;<span class="op" id="5267849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267852">var</span>&nbsp;<span class="ident" id="5267856">endAndEsc</span>&nbsp;<span class="builtintype" id="5267866">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267874">switch</span>&nbsp;<span class="ident" id="5267881">c</span><span class="op" id="5267882">.</span><span class="ident" id="5267883">state</span>&nbsp;<span class="op" id="5267889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267892">case</span>&nbsp;<span class="ident" id="5267897">stateCSSDqStr</span><span class="op" id="5267910">,</span>&nbsp;<span class="ident" id="5267912">stateCSSDqURL</span><span class="op" id="5267925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267929">endAndEsc</span>&nbsp;<span class="op" id="5267939">=</span>&nbsp;<span class="string" id="5267941">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267947">case</span>&nbsp;<span class="ident" id="5267952">stateCSSSqStr</span><span class="op" id="5267965">,</span>&nbsp;<span class="ident" id="5267967">stateCSSSqURL</span><span class="op" id="5267980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267984">endAndEsc</span>&nbsp;<span class="op" id="5267994">=</span>&nbsp;<span class="string" id="5267996">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268002">case</span>&nbsp;<span class="ident" id="5268007">stateCSSURL</span><span class="op" id="5268018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268022">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268082">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268144">endAndEsc</span>&nbsp;<span class="op" id="5268154">=</span>&nbsp;<span class="string" id="5268156">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268172">default</span><span class="op" id="5268179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5268183">panic</span><span class="op" id="5268188">(</span><span class="ident" id="5268189">c</span><span class="op" id="5268190">.</span><span class="ident" id="5268191">state</span><span class="op" id="5268196">.</span><span class="ident" id="5268197">String</span><span class="op" id="5268203">(</span><span class="op" id="5268204">)</span><span class="op" id="5268205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268212">k</span>&nbsp;<span class="op" id="5268214">:=</span>&nbsp;<span class="num" id="5268217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268220">for</span>&nbsp;<span class="op" id="5268224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268228">i</span>&nbsp;<span class="op" id="5268230">:=</span>&nbsp;<span class="ident" id="5268233">k</span>&nbsp;<span class="op" id="5268235">+</span>&nbsp;<span class="ident" id="5268237">bytes</span><span class="op" id="5268242">.</span><span class="ident" id="5268243">IndexAny</span><span class="op" id="5268251">(</span><span class="ident" id="5268252">s</span><span class="op" id="5268253">[</span><span class="ident" id="5268254">k</span><span class="op" id="5268255">:</span><span class="op" id="5268256">]</span><span class="op" id="5268257">,</span>&nbsp;<span class="ident" id="5268259">endAndEsc</span><span class="op" id="5268268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268272">if</span>&nbsp;<span class="ident" id="5268275">i</span>&nbsp;<span class="op" id="5268277">&lt;</span>&nbsp;<span class="ident" id="5268279">k</span>&nbsp;<span class="op" id="5268281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268286">c</span><span class="op" id="5268287">,</span>&nbsp;<span class="ident" id="5268289">nread</span>&nbsp;<span class="op" id="5268295">:=</span>&nbsp;<span class="ident" id="5268298">tURL</span><span class="op" id="5268302">(</span><span class="ident" id="5268303">c</span><span class="op" id="5268304">,</span>&nbsp;<span class="ident" id="5268306">decodeCSS</span><span class="op" id="5268315">(</span><span class="ident" id="5268316">s</span><span class="op" id="5268317">[</span><span class="ident" id="5268318">k</span><span class="op" id="5268319">:</span><span class="op" id="5268320">]</span><span class="op" id="5268321">)</span><span class="op" id="5268322">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268327">return</span>&nbsp;<span class="ident" id="5268334">c</span><span class="op" id="5268335">,</span>&nbsp;<span class="ident" id="5268337">k</span>&nbsp;<span class="op" id="5268339">+</span>&nbsp;<span class="ident" id="5268341">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268353">if</span>&nbsp;<span class="ident" id="5268356">s</span><span class="op" id="5268357">[</span><span class="ident" id="5268358">i</span><span class="op" id="5268359">]</span>&nbsp;<span class="op" id="5268361">==</span>&nbsp;<span class="string" id="5268364">&#39;\\&#39;</span>&nbsp;<span class="op" id="5268369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268374">i</span><span class="op" id="5268375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268381">if</span>&nbsp;<span class="ident" id="5268384">i</span>&nbsp;<span class="op" id="5268386">==</span>&nbsp;<span class="builtinfunc" id="5268389">len</span><span class="op" id="5268392">(</span><span class="ident" id="5268393">s</span><span class="op" id="5268394">)</span>&nbsp;<span class="op" id="5268396">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268402">return</span>&nbsp;<span class="ident" id="5268409">context</span><span class="op" id="5268416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268423">state</span><span class="op" id="5268428">:</span>&nbsp;<span class="ident" id="5268430">stateError</span><span class="op" id="5268440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268447">err</span><span class="op" id="5268450">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5268454">errorf</span><span class="op" id="5268460">(</span><span class="ident" id="5268461">ErrPartialEscape</span><span class="op" id="5268477">,</span>&nbsp;<span class="ident" id="5268479">nil</span><span class="op" id="5268482">,</span>&nbsp;<span class="num" id="5268484">0</span><span class="op" id="5268485">,</span>&nbsp;<span class="string" id="5268487">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5268533">,</span>&nbsp;<span class="ident" id="5268535">s</span><span class="op" id="5268536">)</span><span class="op" id="5268537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268543">}</span><span class="op" id="5268544">,</span>&nbsp;<span class="builtinfunc" id="5268546">len</span><span class="op" id="5268549">(</span><span class="ident" id="5268550">s</span><span class="op" id="5268551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268556">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268560">}</span>&nbsp;<span class="keyword" id="5268562">else</span>&nbsp;<span class="op" id="5268567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268572">c</span><span class="op" id="5268573">.</span><span class="ident" id="5268574">state</span>&nbsp;<span class="op" id="5268580">=</span>&nbsp;<span class="ident" id="5268582">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268594">return</span>&nbsp;<span class="ident" id="5268601">c</span><span class="op" id="5268602">,</span>&nbsp;<span class="ident" id="5268604">i</span>&nbsp;<span class="op" id="5268606">+</span>&nbsp;<span class="num" id="5268608">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268616">c</span><span class="op" id="5268617">,</span>&nbsp;<span class="ident" id="5268619">_</span>&nbsp;<span class="op" id="5268621">=</span>&nbsp;<span class="ident" id="5268623">tURL</span><span class="op" id="5268627">(</span><span class="ident" id="5268628">c</span><span class="op" id="5268629">,</span>&nbsp;<span class="ident" id="5268631">decodeCSS</span><span class="op" id="5268640">(</span><span class="ident" id="5268641">s</span><span class="op" id="5268642">[</span><span class="op" id="5268643">:</span><span class="ident" id="5268644">i</span><span class="op" id="5268645">+</span><span class="num" id="5268646">1</span><span class="op" id="5268647">]</span><span class="op" id="5268648">)</span><span class="op" id="5268649">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268653">k</span>&nbsp;<span class="op" id="5268655">=</span>&nbsp;<span class="ident" id="5268657">i</span>&nbsp;<span class="op" id="5268659">+</span>&nbsp;<span class="num" id="5268661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268664">}</span><br>
<span class="lineno"></span><span class="op" id="5268666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5268669">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5268735">func</span>&nbsp;<span class="ident" id="5268740">tError</span><span class="op" id="5268746">(</span><span class="ident" id="5268747">c</span>&nbsp;<span class="ident" id="5268749">context</span><span class="op" id="5268756">,</span>&nbsp;<span class="ident" id="5268758">s</span>&nbsp;<span class="op" id="5268760">[</span><span class="op" id="5268761">]</span><span class="builtintype" id="5268762">byte</span><span class="op" id="5268766">)</span>&nbsp;<span class="op" id="5268768">(</span><span class="ident" id="5268769">context</span><span class="op" id="5268776">,</span>&nbsp;<span class="builtintype" id="5268778">int</span><span class="op" id="5268781">)</span>&nbsp;<span class="op" id="5268783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268786">return</span>&nbsp;<span class="ident" id="5268793">c</span><span class="op" id="5268794">,</span>&nbsp;<span class="builtinfunc" id="5268796">len</span><span class="op" id="5268799">(</span><span class="ident" id="5268800">s</span><span class="op" id="5268801">)</span><br>
<span class="lineno"></span><span class="op" id="5268803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5268806">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5268882">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5268951">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5269024">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5269040">func</span>&nbsp;<span class="ident" id="5269045">eatAttrName</span><span class="op" id="5269056">(</span><span class="ident" id="5269057">s</span>&nbsp;<span class="op" id="5269059">[</span><span class="op" id="5269060">]</span><span class="builtintype" id="5269061">byte</span><span class="op" id="5269065">,</span>&nbsp;<span class="ident" id="5269067">i</span>&nbsp;<span class="builtintype" id="5269069">int</span><span class="op" id="5269072">)</span>&nbsp;<span class="op" id="5269074">(</span><span class="builtintype" id="5269075">int</span><span class="op" id="5269078">,</span>&nbsp;<span class="op" id="5269080">*</span><span class="ident" id="5269081">Error</span><span class="op" id="5269086">)</span>&nbsp;<span class="op" id="5269088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269091">for</span>&nbsp;<span class="ident" id="5269095">j</span>&nbsp;<span class="op" id="5269097">:=</span>&nbsp;<span class="ident" id="5269100">i</span><span class="op" id="5269101">;</span>&nbsp;<span class="ident" id="5269103">j</span>&nbsp;<span class="op" id="5269105">&lt;</span>&nbsp;<span class="builtinfunc" id="5269107">len</span><span class="op" id="5269110">(</span><span class="ident" id="5269111">s</span><span class="op" id="5269112">)</span><span class="op" id="5269113">;</span>&nbsp;<span class="ident" id="5269115">j</span><span class="op" id="5269116">++</span>&nbsp;<span class="op" id="5269119">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269123">switch</span>&nbsp;<span class="ident" id="5269130">s</span><span class="op" id="5269131">[</span><span class="ident" id="5269132">j</span><span class="op" id="5269133">]</span>&nbsp;<span class="op" id="5269135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269139">case</span>&nbsp;<span class="string" id="5269144">&#39;&nbsp;&#39;</span><span class="op" id="5269147">,</span>&nbsp;<span class="string" id="5269149">&#39;\t&#39;</span><span class="op" id="5269153">,</span>&nbsp;<span class="string" id="5269155">&#39;\n&#39;</span><span class="op" id="5269159">,</span>&nbsp;<span class="string" id="5269161">&#39;\f&#39;</span><span class="op" id="5269165">,</span>&nbsp;<span class="string" id="5269167">&#39;\r&#39;</span><span class="op" id="5269171">,</span>&nbsp;<span class="string" id="5269173">&#39;=&#39;</span><span class="op" id="5269176">,</span>&nbsp;<span class="string" id="5269178">&#39;&gt;&#39;</span><span class="op" id="5269181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269186">return</span>&nbsp;<span class="ident" id="5269193">j</span><span class="op" id="5269194">,</span>&nbsp;<span class="ident" id="5269196">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269202">case</span>&nbsp;<span class="string" id="5269207">&#39;\&#39;&#39;</span><span class="op" id="5269211">,</span>&nbsp;<span class="string" id="5269213">&#39;&#34;&#39;</span><span class="op" id="5269216">,</span>&nbsp;<span class="string" id="5269218">&#39;&lt;&#39;</span><span class="op" id="5269221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269226">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269281">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269337">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269363">return</span>&nbsp;<span class="op" id="5269370">-</span><span class="num" id="5269371">1</span><span class="op" id="5269372">,</span>&nbsp;<span class="ident" id="5269374">errorf</span><span class="op" id="5269380">(</span><span class="ident" id="5269381">ErrBadHTML</span><span class="op" id="5269391">,</span>&nbsp;<span class="ident" id="5269393">nil</span><span class="op" id="5269396">,</span>&nbsp;<span class="num" id="5269398">0</span><span class="op" id="5269399">,</span>&nbsp;<span class="string" id="5269401">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5269430">,</span>&nbsp;<span class="ident" id="5269432">s</span><span class="op" id="5269433">[</span><span class="ident" id="5269434">j</span><span class="op" id="5269435">:</span><span class="ident" id="5269436">j</span><span class="op" id="5269437">+</span><span class="num" id="5269438">1</span><span class="op" id="5269439">]</span><span class="op" id="5269440">,</span>&nbsp;<span class="ident" id="5269442">s</span><span class="op" id="5269443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269447">default</span><span class="op" id="5269454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269459">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269477">return</span>&nbsp;<span class="builtinfunc" id="5269484">len</span><span class="op" id="5269487">(</span><span class="ident" id="5269488">s</span><span class="op" id="5269489">)</span><span class="op" id="5269490">,</span>&nbsp;<span class="ident" id="5269492">nil</span><br>
<span class="lineno"></span><span class="op" id="5269496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5269499">var</span>&nbsp;<span class="ident" id="5269503">elementNameMap</span>&nbsp;<span class="op" id="5269518">=</span>&nbsp;<span class="keyword" id="5269520">map</span><span class="op" id="5269523">[</span><span class="builtintype" id="5269524">string</span><span class="op" id="5269530">]</span><span class="ident" id="5269531">element</span><span class="op" id="5269538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5269541">&#34;script&#34;</span><span class="op" id="5269549">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5269553">elementScript</span><span class="op" id="5269566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5269569">&#34;style&#34;</span><span class="op" id="5269576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269581">elementStyle</span><span class="op" id="5269593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5269596">&#34;textarea&#34;</span><span class="op" id="5269606">:</span>&nbsp;<span class="ident" id="5269608">elementTextarea</span><span class="op" id="5269623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5269626">&#34;title&#34;</span><span class="op" id="5269633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269638">elementTitle</span><span class="op" id="5269650">,</span><br>
<span class="lineno">505</span><span class="op" id="5269652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269655">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5269707">func</span>&nbsp;<span class="ident" id="5269712">asciiAlpha</span><span class="op" id="5269722">(</span><span class="ident" id="5269723">c</span>&nbsp;<span class="builtintype" id="5269725">byte</span><span class="op" id="5269729">)</span>&nbsp;<span class="builtintype" id="5269731">bool</span>&nbsp;<span class="op" id="5269736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269739">return</span>&nbsp;<span class="string" id="5269746">&#39;A&#39;</span>&nbsp;<span class="op" id="5269750">&lt;=</span>&nbsp;<span class="ident" id="5269753">c</span>&nbsp;<span class="op" id="5269755">&amp;&amp;</span>&nbsp;<span class="ident" id="5269758">c</span>&nbsp;<span class="op" id="5269760">&lt;=</span>&nbsp;<span class="string" id="5269763">&#39;Z&#39;</span>&nbsp;<span class="op" id="5269767">||</span>&nbsp;<span class="string" id="5269770">&#39;a&#39;</span>&nbsp;<span class="op" id="5269774">&lt;=</span>&nbsp;<span class="ident" id="5269777">c</span>&nbsp;<span class="op" id="5269779">&amp;&amp;</span>&nbsp;<span class="ident" id="5269782">c</span>&nbsp;<span class="op" id="5269784">&lt;=</span>&nbsp;<span class="string" id="5269787">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5269791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269794">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5269858">func</span>&nbsp;<span class="ident" id="5269863">asciiAlphaNum</span><span class="op" id="5269876">(</span><span class="ident" id="5269877">c</span>&nbsp;<span class="builtintype" id="5269879">byte</span><span class="op" id="5269883">)</span>&nbsp;<span class="builtintype" id="5269885">bool</span>&nbsp;<span class="op" id="5269890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269893">return</span>&nbsp;<span class="ident" id="5269900">asciiAlpha</span><span class="op" id="5269910">(</span><span class="ident" id="5269911">c</span><span class="op" id="5269912">)</span>&nbsp;<span class="op" id="5269914">||</span>&nbsp;<span class="string" id="5269917">&#39;0&#39;</span>&nbsp;<span class="op" id="5269921">&lt;=</span>&nbsp;<span class="ident" id="5269924">c</span>&nbsp;<span class="op" id="5269926">&amp;&amp;</span>&nbsp;<span class="ident" id="5269929">c</span>&nbsp;<span class="op" id="5269931">&lt;=</span>&nbsp;<span class="string" id="5269934">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5269938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269941">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5270026">func</span>&nbsp;<span class="ident" id="5270031">eatTagName</span><span class="op" id="5270041">(</span><span class="ident" id="5270042">s</span>&nbsp;<span class="op" id="5270044">[</span><span class="op" id="5270045">]</span><span class="builtintype" id="5270046">byte</span><span class="op" id="5270050">,</span>&nbsp;<span class="ident" id="5270052">i</span>&nbsp;<span class="builtintype" id="5270054">int</span><span class="op" id="5270057">)</span>&nbsp;<span class="op" id="5270059">(</span><span class="builtintype" id="5270060">int</span><span class="op" id="5270063">,</span>&nbsp;<span class="ident" id="5270065">element</span><span class="op" id="5270072">)</span>&nbsp;<span class="op" id="5270074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270077">if</span>&nbsp;<span class="ident" id="5270080">i</span>&nbsp;<span class="op" id="5270082">==</span>&nbsp;<span class="builtinfunc" id="5270085">len</span><span class="op" id="5270088">(</span><span class="ident" id="5270089">s</span><span class="op" id="5270090">)</span>&nbsp;<span class="op" id="5270092">||</span>&nbsp;<span class="op" id="5270095">!</span><span class="ident" id="5270096">asciiAlpha</span><span class="op" id="5270106">(</span><span class="ident" id="5270107">s</span><span class="op" id="5270108">[</span><span class="ident" id="5270109">i</span><span class="op" id="5270110">]</span><span class="op" id="5270111">)</span>&nbsp;<span class="op" id="5270113">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270117">return</span>&nbsp;<span class="ident" id="5270124">i</span><span class="op" id="5270125">,</span>&nbsp;<span class="ident" id="5270127">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270143">j</span>&nbsp;<span class="op" id="5270145">:=</span>&nbsp;<span class="ident" id="5270148">i</span>&nbsp;<span class="op" id="5270150">+</span>&nbsp;<span class="num" id="5270152">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270155">for</span>&nbsp;<span class="ident" id="5270159">j</span>&nbsp;<span class="op" id="5270161">&lt;</span>&nbsp;<span class="builtinfunc" id="5270163">len</span><span class="op" id="5270166">(</span><span class="ident" id="5270167">s</span><span class="op" id="5270168">)</span>&nbsp;<span class="op" id="5270170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270174">x</span>&nbsp;<span class="op" id="5270176">:=</span>&nbsp;<span class="ident" id="5270179">s</span><span class="op" id="5270180">[</span><span class="ident" id="5270181">j</span><span class="op" id="5270182">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270186">if</span>&nbsp;<span class="ident" id="5270189">asciiAlphaNum</span><span class="op" id="5270202">(</span><span class="ident" id="5270203">x</span><span class="op" id="5270204">)</span>&nbsp;<span class="op" id="5270206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270211">j</span><span class="op" id="5270212">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270218">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270233">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270290">if</span>&nbsp;<span class="op" id="5270293">(</span><span class="ident" id="5270294">x</span>&nbsp;<span class="op" id="5270296">==</span>&nbsp;<span class="string" id="5270299">&#39;:&#39;</span>&nbsp;<span class="op" id="5270303">||</span>&nbsp;<span class="ident" id="5270306">x</span>&nbsp;<span class="op" id="5270308">==</span>&nbsp;<span class="string" id="5270311">&#39;-&#39;</span><span class="op" id="5270314">)</span>&nbsp;<span class="op" id="5270316">&amp;&amp;</span>&nbsp;<span class="ident" id="5270319">j</span><span class="op" id="5270320">+</span><span class="num" id="5270321">1</span>&nbsp;<span class="op" id="5270323">&lt;</span>&nbsp;<span class="builtinfunc" id="5270325">len</span><span class="op" id="5270328">(</span><span class="ident" id="5270329">s</span><span class="op" id="5270330">)</span>&nbsp;<span class="op" id="5270332">&amp;&amp;</span>&nbsp;<span class="ident" id="5270335">asciiAlphaNum</span><span class="op" id="5270348">(</span><span class="ident" id="5270349">s</span><span class="op" id="5270350">[</span><span class="ident" id="5270351">j</span><span class="op" id="5270352">+</span><span class="num" id="5270353">1</span><span class="op" id="5270354">]</span><span class="op" id="5270355">)</span>&nbsp;<span class="op" id="5270357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270362">j</span>&nbsp;<span class="op" id="5270364">+=</span>&nbsp;<span class="num" id="5270367">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270372">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270387">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270397">return</span>&nbsp;<span class="ident" id="5270404">j</span><span class="op" id="5270405">,</span>&nbsp;<span class="ident" id="5270407">elementNameMap</span><span class="op" id="5270421">[</span><span class="ident" id="5270422">strings</span><span class="op" id="5270429">.</span><span class="ident" id="5270430">ToLower</span><span class="op" id="5270437">(</span><span class="builtintype" id="5270438">string</span><span class="op" id="5270444">(</span><span class="ident" id="5270445">s</span><span class="op" id="5270446">[</span><span class="ident" id="5270447">i</span><span class="op" id="5270448">:</span><span class="ident" id="5270449">j</span><span class="op" id="5270450">]</span><span class="op" id="5270451">)</span><span class="op" id="5270452">)</span><span class="op" id="5270453">]</span><br>
<span class="lineno"></span><span class="op" id="5270455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5270458">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5270530">func</span>&nbsp;<span class="ident" id="5270535">eatWhiteSpace</span><span class="op" id="5270548">(</span><span class="ident" id="5270549">s</span>&nbsp;<span class="op" id="5270551">[</span><span class="op" id="5270552">]</span><span class="builtintype" id="5270553">byte</span><span class="op" id="5270557">,</span>&nbsp;<span class="ident" id="5270559">i</span>&nbsp;<span class="builtintype" id="5270561">int</span><span class="op" id="5270564">)</span>&nbsp;<span class="builtintype" id="5270566">int</span>&nbsp;<span class="op" id="5270570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270573">for</span>&nbsp;<span class="ident" id="5270577">j</span>&nbsp;<span class="op" id="5270579">:=</span>&nbsp;<span class="ident" id="5270582">i</span><span class="op" id="5270583">;</span>&nbsp;<span class="ident" id="5270585">j</span>&nbsp;<span class="op" id="5270587">&lt;</span>&nbsp;<span class="builtinfunc" id="5270589">len</span><span class="op" id="5270592">(</span><span class="ident" id="5270593">s</span><span class="op" id="5270594">)</span><span class="op" id="5270595">;</span>&nbsp;<span class="ident" id="5270597">j</span><span class="op" id="5270598">++</span>&nbsp;<span class="op" id="5270601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270605">switch</span>&nbsp;<span class="ident" id="5270612">s</span><span class="op" id="5270613">[</span><span class="ident" id="5270614">j</span><span class="op" id="5270615">]</span>&nbsp;<span class="op" id="5270617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270621">case</span>&nbsp;<span class="string" id="5270626">&#39;&nbsp;&#39;</span><span class="op" id="5270629">,</span>&nbsp;<span class="string" id="5270631">&#39;\t&#39;</span><span class="op" id="5270635">,</span>&nbsp;<span class="string" id="5270637">&#39;\n&#39;</span><span class="op" id="5270641">,</span>&nbsp;<span class="string" id="5270643">&#39;\f&#39;</span><span class="op" id="5270647">,</span>&nbsp;<span class="string" id="5270649">&#39;\r&#39;</span><span class="op" id="5270653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270658">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270670">default</span><span class="op" id="5270677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270682">return</span>&nbsp;<span class="ident" id="5270689">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270699">return</span>&nbsp;<span class="builtinfunc" id="5270706">len</span><span class="op" id="5270709">(</span><span class="ident" id="5270710">s</span><span class="op" id="5270711">)</span><br>
<span class="lineno">550</span><span class="op" id="5270713">}</span>
</div>
</body>
</html>
