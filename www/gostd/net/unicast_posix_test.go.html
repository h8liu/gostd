<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6589266">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6589322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6589376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6589427">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589445">package</span>&nbsp;<span class="ident" id="6589453">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589458">import</span>&nbsp;<span class="op" id="6589465">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6589468">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6589479">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6589490">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6589500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6589503">var</span>&nbsp;<span class="ident" id="6589507">listenerTests</span>&nbsp;<span class="op" id="6589521">=</span>&nbsp;<span class="op" id="6589523">[</span><span class="op" id="6589524">]</span><span class="keyword" id="6589525">struct</span>&nbsp;<span class="op" id="6589532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589535">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6589544">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589552">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6589561">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589569">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6589578">bool</span>&nbsp;<span class="comment" id="6589583">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589624">wildcard</span>&nbsp;<span class="builtintype" id="6589633">bool</span>&nbsp;<span class="comment" id="6589638">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="6589668">}</span><span class="op" id="6589669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589672">{</span><span class="ident" id="6589673">net</span><span class="op" id="6589676">:</span>&nbsp;<span class="string" id="6589678">&#34;tcp&#34;</span><span class="op" id="6589683">,</span>&nbsp;<span class="ident" id="6589685">laddr</span><span class="op" id="6589690">:</span>&nbsp;<span class="string" id="6589692">&#34;&#34;</span><span class="op" id="6589694">,</span>&nbsp;<span class="ident" id="6589696">wildcard</span><span class="op" id="6589704">:</span>&nbsp;<span class="builtintype" id="6589706">true</span><span class="op" id="6589710">}</span><span class="op" id="6589711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589714">{</span><span class="ident" id="6589715">net</span><span class="op" id="6589718">:</span>&nbsp;<span class="string" id="6589720">&#34;tcp&#34;</span><span class="op" id="6589725">,</span>&nbsp;<span class="ident" id="6589727">laddr</span><span class="op" id="6589732">:</span>&nbsp;<span class="string" id="6589734">&#34;0.0.0.0&#34;</span><span class="op" id="6589743">,</span>&nbsp;<span class="ident" id="6589745">wildcard</span><span class="op" id="6589753">:</span>&nbsp;<span class="builtintype" id="6589755">true</span><span class="op" id="6589759">}</span><span class="op" id="6589760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589763">{</span><span class="ident" id="6589764">net</span><span class="op" id="6589767">:</span>&nbsp;<span class="string" id="6589769">&#34;tcp&#34;</span><span class="op" id="6589774">,</span>&nbsp;<span class="ident" id="6589776">laddr</span><span class="op" id="6589781">:</span>&nbsp;<span class="string" id="6589783">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6589801">,</span>&nbsp;<span class="ident" id="6589803">wildcard</span><span class="op" id="6589811">:</span>&nbsp;<span class="builtintype" id="6589813">true</span><span class="op" id="6589817">}</span><span class="op" id="6589818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589821">{</span><span class="ident" id="6589822">net</span><span class="op" id="6589825">:</span>&nbsp;<span class="string" id="6589827">&#34;tcp&#34;</span><span class="op" id="6589832">,</span>&nbsp;<span class="ident" id="6589834">laddr</span><span class="op" id="6589839">:</span>&nbsp;<span class="string" id="6589841">&#34;[::]&#34;</span><span class="op" id="6589847">,</span>&nbsp;<span class="ident" id="6589849">ipv6</span><span class="op" id="6589853">:</span>&nbsp;<span class="builtintype" id="6589855">true</span><span class="op" id="6589859">,</span>&nbsp;<span class="ident" id="6589861">wildcard</span><span class="op" id="6589869">:</span>&nbsp;<span class="builtintype" id="6589871">true</span><span class="op" id="6589875">}</span><span class="op" id="6589876">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589880">{</span><span class="ident" id="6589881">net</span><span class="op" id="6589884">:</span>&nbsp;<span class="string" id="6589886">&#34;tcp&#34;</span><span class="op" id="6589891">,</span>&nbsp;<span class="ident" id="6589893">laddr</span><span class="op" id="6589898">:</span>&nbsp;<span class="string" id="6589900">&#34;127.0.0.1&#34;</span><span class="op" id="6589911">}</span><span class="op" id="6589912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589915">{</span><span class="ident" id="6589916">net</span><span class="op" id="6589919">:</span>&nbsp;<span class="string" id="6589921">&#34;tcp&#34;</span><span class="op" id="6589926">,</span>&nbsp;<span class="ident" id="6589928">laddr</span><span class="op" id="6589933">:</span>&nbsp;<span class="string" id="6589935">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6589955">}</span><span class="op" id="6589956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6589959">{</span><span class="ident" id="6589960">net</span><span class="op" id="6589963">:</span>&nbsp;<span class="string" id="6589965">&#34;tcp&#34;</span><span class="op" id="6589970">,</span>&nbsp;<span class="ident" id="6589972">laddr</span><span class="op" id="6589977">:</span>&nbsp;<span class="string" id="6589979">&#34;[::1]&#34;</span><span class="op" id="6589986">,</span>&nbsp;<span class="ident" id="6589988">ipv6</span><span class="op" id="6589992">:</span>&nbsp;<span class="builtintype" id="6589994">true</span><span class="op" id="6589998">}</span><span class="op" id="6589999">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590003">{</span><span class="ident" id="6590004">net</span><span class="op" id="6590007">:</span>&nbsp;<span class="string" id="6590009">&#34;tcp4&#34;</span><span class="op" id="6590015">,</span>&nbsp;<span class="ident" id="6590017">laddr</span><span class="op" id="6590022">:</span>&nbsp;<span class="string" id="6590024">&#34;&#34;</span><span class="op" id="6590026">,</span>&nbsp;<span class="ident" id="6590028">wildcard</span><span class="op" id="6590036">:</span>&nbsp;<span class="builtintype" id="6590038">true</span><span class="op" id="6590042">}</span><span class="op" id="6590043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590046">{</span><span class="ident" id="6590047">net</span><span class="op" id="6590050">:</span>&nbsp;<span class="string" id="6590052">&#34;tcp4&#34;</span><span class="op" id="6590058">,</span>&nbsp;<span class="ident" id="6590060">laddr</span><span class="op" id="6590065">:</span>&nbsp;<span class="string" id="6590067">&#34;0.0.0.0&#34;</span><span class="op" id="6590076">,</span>&nbsp;<span class="ident" id="6590078">wildcard</span><span class="op" id="6590086">:</span>&nbsp;<span class="builtintype" id="6590088">true</span><span class="op" id="6590092">}</span><span class="op" id="6590093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590096">{</span><span class="ident" id="6590097">net</span><span class="op" id="6590100">:</span>&nbsp;<span class="string" id="6590102">&#34;tcp4&#34;</span><span class="op" id="6590108">,</span>&nbsp;<span class="ident" id="6590110">laddr</span><span class="op" id="6590115">:</span>&nbsp;<span class="string" id="6590117">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6590135">,</span>&nbsp;<span class="ident" id="6590137">wildcard</span><span class="op" id="6590145">:</span>&nbsp;<span class="builtintype" id="6590147">true</span><span class="op" id="6590151">}</span><span class="op" id="6590152">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590156">{</span><span class="ident" id="6590157">net</span><span class="op" id="6590160">:</span>&nbsp;<span class="string" id="6590162">&#34;tcp4&#34;</span><span class="op" id="6590168">,</span>&nbsp;<span class="ident" id="6590170">laddr</span><span class="op" id="6590175">:</span>&nbsp;<span class="string" id="6590177">&#34;127.0.0.1&#34;</span><span class="op" id="6590188">}</span><span class="op" id="6590189">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590192">{</span><span class="ident" id="6590193">net</span><span class="op" id="6590196">:</span>&nbsp;<span class="string" id="6590198">&#34;tcp4&#34;</span><span class="op" id="6590204">,</span>&nbsp;<span class="ident" id="6590206">laddr</span><span class="op" id="6590211">:</span>&nbsp;<span class="string" id="6590213">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6590233">}</span><span class="op" id="6590234">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590238">{</span><span class="ident" id="6590239">net</span><span class="op" id="6590242">:</span>&nbsp;<span class="string" id="6590244">&#34;tcp6&#34;</span><span class="op" id="6590250">,</span>&nbsp;<span class="ident" id="6590252">laddr</span><span class="op" id="6590257">:</span>&nbsp;<span class="string" id="6590259">&#34;&#34;</span><span class="op" id="6590261">,</span>&nbsp;<span class="ident" id="6590263">ipv6</span><span class="op" id="6590267">:</span>&nbsp;<span class="builtintype" id="6590269">true</span><span class="op" id="6590273">,</span>&nbsp;<span class="ident" id="6590275">wildcard</span><span class="op" id="6590283">:</span>&nbsp;<span class="builtintype" id="6590285">true</span><span class="op" id="6590289">}</span><span class="op" id="6590290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590293">{</span><span class="ident" id="6590294">net</span><span class="op" id="6590297">:</span>&nbsp;<span class="string" id="6590299">&#34;tcp6&#34;</span><span class="op" id="6590305">,</span>&nbsp;<span class="ident" id="6590307">laddr</span><span class="op" id="6590312">:</span>&nbsp;<span class="string" id="6590314">&#34;[::]&#34;</span><span class="op" id="6590320">,</span>&nbsp;<span class="ident" id="6590322">ipv6</span><span class="op" id="6590326">:</span>&nbsp;<span class="builtintype" id="6590328">true</span><span class="op" id="6590332">,</span>&nbsp;<span class="ident" id="6590334">wildcard</span><span class="op" id="6590342">:</span>&nbsp;<span class="builtintype" id="6590344">true</span><span class="op" id="6590348">}</span><span class="op" id="6590349">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590353">{</span><span class="ident" id="6590354">net</span><span class="op" id="6590357">:</span>&nbsp;<span class="string" id="6590359">&#34;tcp6&#34;</span><span class="op" id="6590365">,</span>&nbsp;<span class="ident" id="6590367">laddr</span><span class="op" id="6590372">:</span>&nbsp;<span class="string" id="6590374">&#34;[::1]&#34;</span><span class="op" id="6590381">,</span>&nbsp;<span class="ident" id="6590383">ipv6</span><span class="op" id="6590387">:</span>&nbsp;<span class="builtintype" id="6590389">true</span><span class="op" id="6590393">}</span><span class="op" id="6590394">,</span><br>
<span class="lineno"></span><span class="op" id="6590396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6590399">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6590464">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="6590529">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6590543">func</span>&nbsp;<span class="ident" id="6590548">TestTCPListener</span><span class="op" id="6590563">(</span><span class="ident" id="6590564">t</span>&nbsp;<span class="op" id="6590566">*</span><span class="ident" id="6590567">testing</span><span class="op" id="6590574">.</span><span class="ident" id="6590575">T</span><span class="op" id="6590576">)</span>&nbsp;<span class="op" id="6590578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590581">switch</span>&nbsp;<span class="ident" id="6590588">runtime</span><span class="op" id="6590595">.</span><span class="ident" id="6590596">GOOS</span>&nbsp;<span class="op" id="6590601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590604">case</span>&nbsp;<span class="string" id="6590609">&#34;plan9&#34;</span><span class="op" id="6590616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590620">t</span><span class="op" id="6590621">.</span><span class="ident" id="6590622">Skipf</span><span class="op" id="6590627">(</span><span class="string" id="6590628">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6590649">,</span>&nbsp;<span class="ident" id="6590651">runtime</span><span class="op" id="6590658">.</span><span class="ident" id="6590659">GOOS</span><span class="op" id="6590663">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590670">for</span>&nbsp;<span class="ident" id="6590674">_</span><span class="op" id="6590675">,</span>&nbsp;<span class="ident" id="6590677">tt</span>&nbsp;<span class="op" id="6590680">:=</span>&nbsp;<span class="keyword" id="6590683">range</span>&nbsp;<span class="ident" id="6590689">listenerTests</span>&nbsp;<span class="op" id="6590703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590707">if</span>&nbsp;<span class="ident" id="6590710">tt</span><span class="op" id="6590712">.</span><span class="ident" id="6590713">wildcard</span>&nbsp;<span class="op" id="6590722">&amp;&amp;</span>&nbsp;<span class="op" id="6590725">(</span><span class="ident" id="6590726">testing</span><span class="op" id="6590733">.</span><span class="ident" id="6590734">Short</span><span class="op" id="6590739">(</span><span class="op" id="6590740">)</span>&nbsp;<span class="op" id="6590742">||</span>&nbsp;<span class="op" id="6590745">!</span><span class="op" id="6590746">*</span><span class="ident" id="6590747">testExternal</span><span class="op" id="6590759">)</span>&nbsp;<span class="op" id="6590761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590766">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590781">if</span>&nbsp;<span class="ident" id="6590784">tt</span><span class="op" id="6590786">.</span><span class="ident" id="6590787">ipv6</span>&nbsp;<span class="op" id="6590792">&amp;&amp;</span>&nbsp;<span class="op" id="6590795">!</span><span class="ident" id="6590796">supportsIPv6</span>&nbsp;<span class="op" id="6590809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6590814">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6590825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590829">l1</span><span class="op" id="6590831">,</span>&nbsp;<span class="ident" id="6590833">port</span>&nbsp;<span class="op" id="6590838">:=</span>&nbsp;<span class="ident" id="6590841">usableListenPort</span><span class="op" id="6590857">(</span><span class="ident" id="6590858">t</span><span class="op" id="6590859">,</span>&nbsp;<span class="ident" id="6590861">tt</span><span class="op" id="6590863">.</span><span class="ident" id="6590864">net</span><span class="op" id="6590867">,</span>&nbsp;<span class="ident" id="6590869">tt</span><span class="op" id="6590871">.</span><span class="ident" id="6590872">laddr</span><span class="op" id="6590877">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590881">checkFirstListener</span><span class="op" id="6590899">(</span><span class="ident" id="6590900">t</span><span class="op" id="6590901">,</span>&nbsp;<span class="ident" id="6590903">tt</span><span class="op" id="6590905">.</span><span class="ident" id="6590906">net</span><span class="op" id="6590909">,</span>&nbsp;<span class="ident" id="6590911">tt</span><span class="op" id="6590913">.</span><span class="ident" id="6590914">laddr</span><span class="op" id="6590919">+</span><span class="string" id="6590920">&#34;:&#34;</span><span class="op" id="6590923">+</span><span class="ident" id="6590924">port</span><span class="op" id="6590928">,</span>&nbsp;<span class="ident" id="6590930">l1</span><span class="op" id="6590932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590936">l2</span><span class="op" id="6590938">,</span>&nbsp;<span class="ident" id="6590940">err</span>&nbsp;<span class="op" id="6590944">:=</span>&nbsp;<span class="ident" id="6590947">Listen</span><span class="op" id="6590953">(</span><span class="ident" id="6590954">tt</span><span class="op" id="6590956">.</span><span class="ident" id="6590957">net</span><span class="op" id="6590960">,</span>&nbsp;<span class="ident" id="6590962">tt</span><span class="op" id="6590964">.</span><span class="ident" id="6590965">laddr</span><span class="op" id="6590970">+</span><span class="string" id="6590971">&#34;:&#34;</span><span class="op" id="6590974">+</span><span class="ident" id="6590975">port</span><span class="op" id="6590979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6590983">checkSecondListener</span><span class="op" id="6591002">(</span><span class="ident" id="6591003">t</span><span class="op" id="6591004">,</span>&nbsp;<span class="ident" id="6591006">tt</span><span class="op" id="6591008">.</span><span class="ident" id="6591009">net</span><span class="op" id="6591012">,</span>&nbsp;<span class="ident" id="6591014">tt</span><span class="op" id="6591016">.</span><span class="ident" id="6591017">laddr</span><span class="op" id="6591022">+</span><span class="string" id="6591023">&#34;:&#34;</span><span class="op" id="6591026">+</span><span class="ident" id="6591027">port</span><span class="op" id="6591031">,</span>&nbsp;<span class="ident" id="6591033">err</span><span class="op" id="6591036">,</span>&nbsp;<span class="ident" id="6591038">l2</span><span class="op" id="6591040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591044">l1</span><span class="op" id="6591046">.</span><span class="ident" id="6591047">Close</span><span class="op" id="6591052">(</span><span class="op" id="6591053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591056">}</span><br>
<span class="lineno">65</span><span class="op" id="6591058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6591061">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6591126">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6591191">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="6591205">func</span>&nbsp;<span class="ident" id="6591210">TestUDPListener</span><span class="op" id="6591225">(</span><span class="ident" id="6591226">t</span>&nbsp;<span class="op" id="6591228">*</span><span class="ident" id="6591229">testing</span><span class="op" id="6591236">.</span><span class="ident" id="6591237">T</span><span class="op" id="6591238">)</span>&nbsp;<span class="op" id="6591240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591243">switch</span>&nbsp;<span class="ident" id="6591250">runtime</span><span class="op" id="6591257">.</span><span class="ident" id="6591258">GOOS</span>&nbsp;<span class="op" id="6591263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591266">case</span>&nbsp;<span class="string" id="6591271">&#34;plan9&#34;</span><span class="op" id="6591278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591282">t</span><span class="op" id="6591283">.</span><span class="ident" id="6591284">Skipf</span><span class="op" id="6591289">(</span><span class="string" id="6591290">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6591311">,</span>&nbsp;<span class="ident" id="6591313">runtime</span><span class="op" id="6591320">.</span><span class="ident" id="6591321">GOOS</span><span class="op" id="6591325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591328">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591332">toudpnet</span>&nbsp;<span class="op" id="6591341">:=</span>&nbsp;<span class="keyword" id="6591344">func</span><span class="op" id="6591348">(</span><span class="ident" id="6591349">net</span>&nbsp;<span class="builtintype" id="6591353">string</span><span class="op" id="6591359">)</span>&nbsp;<span class="builtintype" id="6591361">string</span>&nbsp;<span class="op" id="6591368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591372">switch</span>&nbsp;<span class="ident" id="6591379">net</span>&nbsp;<span class="op" id="6591383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591387">case</span>&nbsp;<span class="string" id="6591392">&#34;tcp&#34;</span><span class="op" id="6591397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591402">return</span>&nbsp;<span class="string" id="6591409">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591417">case</span>&nbsp;<span class="string" id="6591422">&#34;tcp4&#34;</span><span class="op" id="6591428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591433">return</span>&nbsp;<span class="string" id="6591440">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591449">case</span>&nbsp;<span class="string" id="6591454">&#34;tcp6&#34;</span><span class="op" id="6591460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591465">return</span>&nbsp;<span class="string" id="6591472">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591481">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591485">return</span>&nbsp;<span class="string" id="6591492">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591505">for</span>&nbsp;<span class="ident" id="6591509">_</span><span class="op" id="6591510">,</span>&nbsp;<span class="ident" id="6591512">tt</span>&nbsp;<span class="op" id="6591515">:=</span>&nbsp;<span class="keyword" id="6591518">range</span>&nbsp;<span class="ident" id="6591524">listenerTests</span>&nbsp;<span class="op" id="6591538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591542">if</span>&nbsp;<span class="ident" id="6591545">tt</span><span class="op" id="6591547">.</span><span class="ident" id="6591548">wildcard</span>&nbsp;<span class="op" id="6591557">&amp;&amp;</span>&nbsp;<span class="op" id="6591560">(</span><span class="ident" id="6591561">testing</span><span class="op" id="6591568">.</span><span class="ident" id="6591569">Short</span><span class="op" id="6591574">(</span><span class="op" id="6591575">)</span>&nbsp;<span class="op" id="6591577">||</span>&nbsp;<span class="op" id="6591580">!</span><span class="op" id="6591581">*</span><span class="ident" id="6591582">testExternal</span><span class="op" id="6591594">)</span>&nbsp;<span class="op" id="6591596">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591601">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591616">if</span>&nbsp;<span class="ident" id="6591619">tt</span><span class="op" id="6591621">.</span><span class="ident" id="6591622">ipv6</span>&nbsp;<span class="op" id="6591627">&amp;&amp;</span>&nbsp;<span class="op" id="6591630">!</span><span class="ident" id="6591631">supportsIPv6</span>&nbsp;<span class="op" id="6591644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6591649">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591660">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591664">tt</span><span class="op" id="6591666">.</span><span class="ident" id="6591667">net</span>&nbsp;<span class="op" id="6591671">=</span>&nbsp;<span class="ident" id="6591673">toudpnet</span><span class="op" id="6591681">(</span><span class="ident" id="6591682">tt</span><span class="op" id="6591684">.</span><span class="ident" id="6591685">net</span><span class="op" id="6591688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591692">l1</span><span class="op" id="6591694">,</span>&nbsp;<span class="ident" id="6591696">port</span>&nbsp;<span class="op" id="6591701">:=</span>&nbsp;<span class="ident" id="6591704">usableListenPacketPort</span><span class="op" id="6591726">(</span><span class="ident" id="6591727">t</span><span class="op" id="6591728">,</span>&nbsp;<span class="ident" id="6591730">tt</span><span class="op" id="6591732">.</span><span class="ident" id="6591733">net</span><span class="op" id="6591736">,</span>&nbsp;<span class="ident" id="6591738">tt</span><span class="op" id="6591740">.</span><span class="ident" id="6591741">laddr</span><span class="op" id="6591746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591750">checkFirstListener</span><span class="op" id="6591768">(</span><span class="ident" id="6591769">t</span><span class="op" id="6591770">,</span>&nbsp;<span class="ident" id="6591772">tt</span><span class="op" id="6591774">.</span><span class="ident" id="6591775">net</span><span class="op" id="6591778">,</span>&nbsp;<span class="ident" id="6591780">tt</span><span class="op" id="6591782">.</span><span class="ident" id="6591783">laddr</span><span class="op" id="6591788">+</span><span class="string" id="6591789">&#34;:&#34;</span><span class="op" id="6591792">+</span><span class="ident" id="6591793">port</span><span class="op" id="6591797">,</span>&nbsp;<span class="ident" id="6591799">l1</span><span class="op" id="6591801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591805">l2</span><span class="op" id="6591807">,</span>&nbsp;<span class="ident" id="6591809">err</span>&nbsp;<span class="op" id="6591813">:=</span>&nbsp;<span class="ident" id="6591816">ListenPacket</span><span class="op" id="6591828">(</span><span class="ident" id="6591829">tt</span><span class="op" id="6591831">.</span><span class="ident" id="6591832">net</span><span class="op" id="6591835">,</span>&nbsp;<span class="ident" id="6591837">tt</span><span class="op" id="6591839">.</span><span class="ident" id="6591840">laddr</span><span class="op" id="6591845">+</span><span class="string" id="6591846">&#34;:&#34;</span><span class="op" id="6591849">+</span><span class="ident" id="6591850">port</span><span class="op" id="6591854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591858">checkSecondListener</span><span class="op" id="6591877">(</span><span class="ident" id="6591878">t</span><span class="op" id="6591879">,</span>&nbsp;<span class="ident" id="6591881">tt</span><span class="op" id="6591883">.</span><span class="ident" id="6591884">net</span><span class="op" id="6591887">,</span>&nbsp;<span class="ident" id="6591889">tt</span><span class="op" id="6591891">.</span><span class="ident" id="6591892">laddr</span><span class="op" id="6591897">+</span><span class="string" id="6591898">&#34;:&#34;</span><span class="op" id="6591901">+</span><span class="ident" id="6591902">port</span><span class="op" id="6591906">,</span>&nbsp;<span class="ident" id="6591908">err</span><span class="op" id="6591911">,</span>&nbsp;<span class="ident" id="6591913">l2</span><span class="op" id="6591915">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591919">l1</span><span class="op" id="6591921">.</span><span class="ident" id="6591922">Close</span><span class="op" id="6591927">(</span><span class="op" id="6591928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6591931">}</span><br>
<span class="lineno"></span><span class="op" id="6591933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6591936">var</span>&nbsp;<span class="ident" id="6591940">dualStackListenerTests</span>&nbsp;<span class="op" id="6591963">=</span>&nbsp;<span class="op" id="6591965">[</span><span class="op" id="6591966">]</span><span class="keyword" id="6591967">struct</span>&nbsp;<span class="op" id="6591974">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6591977">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6591986">string</span>&nbsp;<span class="comment" id="6591993">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592012">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592021">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592029">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592038">string</span>&nbsp;<span class="comment" id="6592045">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592065">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592074">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592082">wildcard</span>&nbsp;<span class="builtintype" id="6592091">bool</span>&nbsp;&nbsp;<span class="comment" id="6592097">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592128">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592137">error</span>&nbsp;<span class="comment" id="6592143">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="6592181">}</span><span class="op" id="6592182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592185">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592267">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592356">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592445">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592531">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592617">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592703">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592792">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592879">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6592966">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593053">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593140">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593227">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593314">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593403">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593490">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593577">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593664">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593751">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593840">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6593927">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594014">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594101">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594188">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594192">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594229">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594263">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594336">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594368">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594441">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594473">//&nbsp;&nbsp;&nbsp;&nbsp;net.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594545">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6594577">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594632">{</span><span class="ident" id="6594633">net1</span><span class="op" id="6594637">:</span>&nbsp;<span class="string" id="6594639">&#34;tcp&#34;</span><span class="op" id="6594644">,</span>&nbsp;<span class="ident" id="6594646">laddr1</span><span class="op" id="6594652">:</span>&nbsp;<span class="string" id="6594654">&#34;&#34;</span><span class="op" id="6594656">,</span>&nbsp;<span class="ident" id="6594658">net2</span><span class="op" id="6594662">:</span>&nbsp;<span class="string" id="6594664">&#34;tcp&#34;</span><span class="op" id="6594669">,</span>&nbsp;<span class="ident" id="6594671">laddr2</span><span class="op" id="6594677">:</span>&nbsp;<span class="string" id="6594679">&#34;&#34;</span><span class="op" id="6594681">,</span>&nbsp;<span class="ident" id="6594683">wildcard</span><span class="op" id="6594691">:</span>&nbsp;<span class="builtintype" id="6594693">true</span><span class="op" id="6594697">,</span>&nbsp;<span class="ident" id="6594699">xerr</span><span class="op" id="6594703">:</span>&nbsp;<span class="ident" id="6594705">syscall</span><span class="op" id="6594712">.</span><span class="ident" id="6594713">EADDRINUSE</span><span class="op" id="6594723">}</span><span class="op" id="6594724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594727">{</span><span class="ident" id="6594728">net1</span><span class="op" id="6594732">:</span>&nbsp;<span class="string" id="6594734">&#34;tcp&#34;</span><span class="op" id="6594739">,</span>&nbsp;<span class="ident" id="6594741">laddr1</span><span class="op" id="6594747">:</span>&nbsp;<span class="string" id="6594749">&#34;&#34;</span><span class="op" id="6594751">,</span>&nbsp;<span class="ident" id="6594753">net2</span><span class="op" id="6594757">:</span>&nbsp;<span class="string" id="6594759">&#34;tcp&#34;</span><span class="op" id="6594764">,</span>&nbsp;<span class="ident" id="6594766">laddr2</span><span class="op" id="6594772">:</span>&nbsp;<span class="string" id="6594774">&#34;0.0.0.0&#34;</span><span class="op" id="6594783">,</span>&nbsp;<span class="ident" id="6594785">wildcard</span><span class="op" id="6594793">:</span>&nbsp;<span class="builtintype" id="6594795">true</span><span class="op" id="6594799">,</span>&nbsp;<span class="ident" id="6594801">xerr</span><span class="op" id="6594805">:</span>&nbsp;<span class="ident" id="6594807">syscall</span><span class="op" id="6594814">.</span><span class="ident" id="6594815">EADDRINUSE</span><span class="op" id="6594825">}</span><span class="op" id="6594826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594829">{</span><span class="ident" id="6594830">net1</span><span class="op" id="6594834">:</span>&nbsp;<span class="string" id="6594836">&#34;tcp&#34;</span><span class="op" id="6594841">,</span>&nbsp;<span class="ident" id="6594843">laddr1</span><span class="op" id="6594849">:</span>&nbsp;<span class="string" id="6594851">&#34;0.0.0.0&#34;</span><span class="op" id="6594860">,</span>&nbsp;<span class="ident" id="6594862">net2</span><span class="op" id="6594866">:</span>&nbsp;<span class="string" id="6594868">&#34;tcp&#34;</span><span class="op" id="6594873">,</span>&nbsp;<span class="ident" id="6594875">laddr2</span><span class="op" id="6594881">:</span>&nbsp;<span class="string" id="6594883">&#34;&#34;</span><span class="op" id="6594885">,</span>&nbsp;<span class="ident" id="6594887">wildcard</span><span class="op" id="6594895">:</span>&nbsp;<span class="builtintype" id="6594897">true</span><span class="op" id="6594901">,</span>&nbsp;<span class="ident" id="6594903">xerr</span><span class="op" id="6594907">:</span>&nbsp;<span class="ident" id="6594909">syscall</span><span class="op" id="6594916">.</span><span class="ident" id="6594917">EADDRINUSE</span><span class="op" id="6594927">}</span><span class="op" id="6594928">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594932">{</span><span class="ident" id="6594933">net1</span><span class="op" id="6594937">:</span>&nbsp;<span class="string" id="6594939">&#34;tcp&#34;</span><span class="op" id="6594944">,</span>&nbsp;<span class="ident" id="6594946">laddr1</span><span class="op" id="6594952">:</span>&nbsp;<span class="string" id="6594954">&#34;&#34;</span><span class="op" id="6594956">,</span>&nbsp;<span class="ident" id="6594958">net2</span><span class="op" id="6594962">:</span>&nbsp;<span class="string" id="6594964">&#34;tcp&#34;</span><span class="op" id="6594969">,</span>&nbsp;<span class="ident" id="6594971">laddr2</span><span class="op" id="6594977">:</span>&nbsp;<span class="string" id="6594979">&#34;[::]&#34;</span><span class="op" id="6594985">,</span>&nbsp;<span class="ident" id="6594987">wildcard</span><span class="op" id="6594995">:</span>&nbsp;<span class="builtintype" id="6594997">true</span><span class="op" id="6595001">,</span>&nbsp;<span class="ident" id="6595003">xerr</span><span class="op" id="6595007">:</span>&nbsp;<span class="ident" id="6595009">syscall</span><span class="op" id="6595016">.</span><span class="ident" id="6595017">EADDRINUSE</span><span class="op" id="6595027">}</span><span class="op" id="6595028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595031">{</span><span class="ident" id="6595032">net1</span><span class="op" id="6595036">:</span>&nbsp;<span class="string" id="6595038">&#34;tcp&#34;</span><span class="op" id="6595043">,</span>&nbsp;<span class="ident" id="6595045">laddr1</span><span class="op" id="6595051">:</span>&nbsp;<span class="string" id="6595053">&#34;[::]&#34;</span><span class="op" id="6595059">,</span>&nbsp;<span class="ident" id="6595061">net2</span><span class="op" id="6595065">:</span>&nbsp;<span class="string" id="6595067">&#34;tcp&#34;</span><span class="op" id="6595072">,</span>&nbsp;<span class="ident" id="6595074">laddr2</span><span class="op" id="6595080">:</span>&nbsp;<span class="string" id="6595082">&#34;&#34;</span><span class="op" id="6595084">,</span>&nbsp;<span class="ident" id="6595086">wildcard</span><span class="op" id="6595094">:</span>&nbsp;<span class="builtintype" id="6595096">true</span><span class="op" id="6595100">,</span>&nbsp;<span class="ident" id="6595102">xerr</span><span class="op" id="6595106">:</span>&nbsp;<span class="ident" id="6595108">syscall</span><span class="op" id="6595115">.</span><span class="ident" id="6595116">EADDRINUSE</span><span class="op" id="6595126">}</span><span class="op" id="6595127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595130">{</span><span class="ident" id="6595131">net1</span><span class="op" id="6595135">:</span>&nbsp;<span class="string" id="6595137">&#34;tcp&#34;</span><span class="op" id="6595142">,</span>&nbsp;<span class="ident" id="6595144">laddr1</span><span class="op" id="6595150">:</span>&nbsp;<span class="string" id="6595152">&#34;0.0.0.0&#34;</span><span class="op" id="6595161">,</span>&nbsp;<span class="ident" id="6595163">net2</span><span class="op" id="6595167">:</span>&nbsp;<span class="string" id="6595169">&#34;tcp&#34;</span><span class="op" id="6595174">,</span>&nbsp;<span class="ident" id="6595176">laddr2</span><span class="op" id="6595182">:</span>&nbsp;<span class="string" id="6595184">&#34;[::]&#34;</span><span class="op" id="6595190">,</span>&nbsp;<span class="ident" id="6595192">wildcard</span><span class="op" id="6595200">:</span>&nbsp;<span class="builtintype" id="6595202">true</span><span class="op" id="6595206">,</span>&nbsp;<span class="ident" id="6595208">xerr</span><span class="op" id="6595212">:</span>&nbsp;<span class="ident" id="6595214">syscall</span><span class="op" id="6595221">.</span><span class="ident" id="6595222">EADDRINUSE</span><span class="op" id="6595232">}</span><span class="op" id="6595233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595236">{</span><span class="ident" id="6595237">net1</span><span class="op" id="6595241">:</span>&nbsp;<span class="string" id="6595243">&#34;tcp&#34;</span><span class="op" id="6595248">,</span>&nbsp;<span class="ident" id="6595250">laddr1</span><span class="op" id="6595256">:</span>&nbsp;<span class="string" id="6595258">&#34;[::]&#34;</span><span class="op" id="6595264">,</span>&nbsp;<span class="ident" id="6595266">net2</span><span class="op" id="6595270">:</span>&nbsp;<span class="string" id="6595272">&#34;tcp&#34;</span><span class="op" id="6595277">,</span>&nbsp;<span class="ident" id="6595279">laddr2</span><span class="op" id="6595285">:</span>&nbsp;<span class="string" id="6595287">&#34;0.0.0.0&#34;</span><span class="op" id="6595296">,</span>&nbsp;<span class="ident" id="6595298">wildcard</span><span class="op" id="6595306">:</span>&nbsp;<span class="builtintype" id="6595308">true</span><span class="op" id="6595312">,</span>&nbsp;<span class="ident" id="6595314">xerr</span><span class="op" id="6595318">:</span>&nbsp;<span class="ident" id="6595320">syscall</span><span class="op" id="6595327">.</span><span class="ident" id="6595328">EADDRINUSE</span><span class="op" id="6595338">}</span><span class="op" id="6595339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595342">{</span><span class="ident" id="6595343">net1</span><span class="op" id="6595347">:</span>&nbsp;<span class="string" id="6595349">&#34;tcp&#34;</span><span class="op" id="6595354">,</span>&nbsp;<span class="ident" id="6595356">laddr1</span><span class="op" id="6595362">:</span>&nbsp;<span class="string" id="6595364">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6595382">,</span>&nbsp;<span class="ident" id="6595384">net2</span><span class="op" id="6595388">:</span>&nbsp;<span class="string" id="6595390">&#34;tcp&#34;</span><span class="op" id="6595395">,</span>&nbsp;<span class="ident" id="6595397">laddr2</span><span class="op" id="6595403">:</span>&nbsp;<span class="string" id="6595405">&#34;[::]&#34;</span><span class="op" id="6595411">,</span>&nbsp;<span class="ident" id="6595413">wildcard</span><span class="op" id="6595421">:</span>&nbsp;<span class="builtintype" id="6595423">true</span><span class="op" id="6595427">,</span>&nbsp;<span class="ident" id="6595429">xerr</span><span class="op" id="6595433">:</span>&nbsp;<span class="ident" id="6595435">syscall</span><span class="op" id="6595442">.</span><span class="ident" id="6595443">EADDRINUSE</span><span class="op" id="6595453">}</span><span class="op" id="6595454">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595457">{</span><span class="ident" id="6595458">net1</span><span class="op" id="6595462">:</span>&nbsp;<span class="string" id="6595464">&#34;tcp&#34;</span><span class="op" id="6595469">,</span>&nbsp;<span class="ident" id="6595471">laddr1</span><span class="op" id="6595477">:</span>&nbsp;<span class="string" id="6595479">&#34;[::]&#34;</span><span class="op" id="6595485">,</span>&nbsp;<span class="ident" id="6595487">net2</span><span class="op" id="6595491">:</span>&nbsp;<span class="string" id="6595493">&#34;tcp&#34;</span><span class="op" id="6595498">,</span>&nbsp;<span class="ident" id="6595500">laddr2</span><span class="op" id="6595506">:</span>&nbsp;<span class="string" id="6595508">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6595526">,</span>&nbsp;<span class="ident" id="6595528">wildcard</span><span class="op" id="6595536">:</span>&nbsp;<span class="builtintype" id="6595538">true</span><span class="op" id="6595542">,</span>&nbsp;<span class="ident" id="6595544">xerr</span><span class="op" id="6595548">:</span>&nbsp;<span class="ident" id="6595550">syscall</span><span class="op" id="6595557">.</span><span class="ident" id="6595558">EADDRINUSE</span><span class="op" id="6595568">}</span><span class="op" id="6595569">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595573">{</span><span class="ident" id="6595574">net1</span><span class="op" id="6595578">:</span>&nbsp;<span class="string" id="6595580">&#34;tcp4&#34;</span><span class="op" id="6595586">,</span>&nbsp;<span class="ident" id="6595588">laddr1</span><span class="op" id="6595594">:</span>&nbsp;<span class="string" id="6595596">&#34;&#34;</span><span class="op" id="6595598">,</span>&nbsp;<span class="ident" id="6595600">net2</span><span class="op" id="6595604">:</span>&nbsp;<span class="string" id="6595606">&#34;tcp6&#34;</span><span class="op" id="6595612">,</span>&nbsp;<span class="ident" id="6595614">laddr2</span><span class="op" id="6595620">:</span>&nbsp;<span class="string" id="6595622">&#34;&#34;</span><span class="op" id="6595624">,</span>&nbsp;<span class="ident" id="6595626">wildcard</span><span class="op" id="6595634">:</span>&nbsp;<span class="builtintype" id="6595636">true</span><span class="op" id="6595640">}</span><span class="op" id="6595641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595644">{</span><span class="ident" id="6595645">net1</span><span class="op" id="6595649">:</span>&nbsp;<span class="string" id="6595651">&#34;tcp6&#34;</span><span class="op" id="6595657">,</span>&nbsp;<span class="ident" id="6595659">laddr1</span><span class="op" id="6595665">:</span>&nbsp;<span class="string" id="6595667">&#34;&#34;</span><span class="op" id="6595669">,</span>&nbsp;<span class="ident" id="6595671">net2</span><span class="op" id="6595675">:</span>&nbsp;<span class="string" id="6595677">&#34;tcp4&#34;</span><span class="op" id="6595683">,</span>&nbsp;<span class="ident" id="6595685">laddr2</span><span class="op" id="6595691">:</span>&nbsp;<span class="string" id="6595693">&#34;&#34;</span><span class="op" id="6595695">,</span>&nbsp;<span class="ident" id="6595697">wildcard</span><span class="op" id="6595705">:</span>&nbsp;<span class="builtintype" id="6595707">true</span><span class="op" id="6595711">}</span><span class="op" id="6595712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595715">{</span><span class="ident" id="6595716">net1</span><span class="op" id="6595720">:</span>&nbsp;<span class="string" id="6595722">&#34;tcp4&#34;</span><span class="op" id="6595728">,</span>&nbsp;<span class="ident" id="6595730">laddr1</span><span class="op" id="6595736">:</span>&nbsp;<span class="string" id="6595738">&#34;0.0.0.0&#34;</span><span class="op" id="6595747">,</span>&nbsp;<span class="ident" id="6595749">net2</span><span class="op" id="6595753">:</span>&nbsp;<span class="string" id="6595755">&#34;tcp6&#34;</span><span class="op" id="6595761">,</span>&nbsp;<span class="ident" id="6595763">laddr2</span><span class="op" id="6595769">:</span>&nbsp;<span class="string" id="6595771">&#34;[::]&#34;</span><span class="op" id="6595777">,</span>&nbsp;<span class="ident" id="6595779">wildcard</span><span class="op" id="6595787">:</span>&nbsp;<span class="builtintype" id="6595789">true</span><span class="op" id="6595793">}</span><span class="op" id="6595794">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595797">{</span><span class="ident" id="6595798">net1</span><span class="op" id="6595802">:</span>&nbsp;<span class="string" id="6595804">&#34;tcp6&#34;</span><span class="op" id="6595810">,</span>&nbsp;<span class="ident" id="6595812">laddr1</span><span class="op" id="6595818">:</span>&nbsp;<span class="string" id="6595820">&#34;[::]&#34;</span><span class="op" id="6595826">,</span>&nbsp;<span class="ident" id="6595828">net2</span><span class="op" id="6595832">:</span>&nbsp;<span class="string" id="6595834">&#34;tcp4&#34;</span><span class="op" id="6595840">,</span>&nbsp;<span class="ident" id="6595842">laddr2</span><span class="op" id="6595848">:</span>&nbsp;<span class="string" id="6595850">&#34;0.0.0.0&#34;</span><span class="op" id="6595859">,</span>&nbsp;<span class="ident" id="6595861">wildcard</span><span class="op" id="6595869">:</span>&nbsp;<span class="builtintype" id="6595871">true</span><span class="op" id="6595875">}</span><span class="op" id="6595876">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595880">{</span><span class="ident" id="6595881">net1</span><span class="op" id="6595885">:</span>&nbsp;<span class="string" id="6595887">&#34;tcp&#34;</span><span class="op" id="6595892">,</span>&nbsp;<span class="ident" id="6595894">laddr1</span><span class="op" id="6595900">:</span>&nbsp;<span class="string" id="6595902">&#34;127.0.0.1&#34;</span><span class="op" id="6595913">,</span>&nbsp;<span class="ident" id="6595915">net2</span><span class="op" id="6595919">:</span>&nbsp;<span class="string" id="6595921">&#34;tcp&#34;</span><span class="op" id="6595926">,</span>&nbsp;<span class="ident" id="6595928">laddr2</span><span class="op" id="6595934">:</span>&nbsp;<span class="string" id="6595936">&#34;[::1]&#34;</span><span class="op" id="6595943">}</span><span class="op" id="6595944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6595947">{</span><span class="ident" id="6595948">net1</span><span class="op" id="6595952">:</span>&nbsp;<span class="string" id="6595954">&#34;tcp&#34;</span><span class="op" id="6595959">,</span>&nbsp;<span class="ident" id="6595961">laddr1</span><span class="op" id="6595967">:</span>&nbsp;<span class="string" id="6595969">&#34;[::1]&#34;</span><span class="op" id="6595976">,</span>&nbsp;<span class="ident" id="6595978">net2</span><span class="op" id="6595982">:</span>&nbsp;<span class="string" id="6595984">&#34;tcp&#34;</span><span class="op" id="6595989">,</span>&nbsp;<span class="ident" id="6595991">laddr2</span><span class="op" id="6595997">:</span>&nbsp;<span class="string" id="6595999">&#34;127.0.0.1&#34;</span><span class="op" id="6596010">}</span><span class="op" id="6596011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596014">{</span><span class="ident" id="6596015">net1</span><span class="op" id="6596019">:</span>&nbsp;<span class="string" id="6596021">&#34;tcp4&#34;</span><span class="op" id="6596027">,</span>&nbsp;<span class="ident" id="6596029">laddr1</span><span class="op" id="6596035">:</span>&nbsp;<span class="string" id="6596037">&#34;127.0.0.1&#34;</span><span class="op" id="6596048">,</span>&nbsp;<span class="ident" id="6596050">net2</span><span class="op" id="6596054">:</span>&nbsp;<span class="string" id="6596056">&#34;tcp6&#34;</span><span class="op" id="6596062">,</span>&nbsp;<span class="ident" id="6596064">laddr2</span><span class="op" id="6596070">:</span>&nbsp;<span class="string" id="6596072">&#34;[::1]&#34;</span><span class="op" id="6596079">}</span><span class="op" id="6596080">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596083">{</span><span class="ident" id="6596084">net1</span><span class="op" id="6596088">:</span>&nbsp;<span class="string" id="6596090">&#34;tcp6&#34;</span><span class="op" id="6596096">,</span>&nbsp;<span class="ident" id="6596098">laddr1</span><span class="op" id="6596104">:</span>&nbsp;<span class="string" id="6596106">&#34;[::1]&#34;</span><span class="op" id="6596113">,</span>&nbsp;<span class="ident" id="6596115">net2</span><span class="op" id="6596119">:</span>&nbsp;<span class="string" id="6596121">&#34;tcp4&#34;</span><span class="op" id="6596127">,</span>&nbsp;<span class="ident" id="6596129">laddr2</span><span class="op" id="6596135">:</span>&nbsp;<span class="string" id="6596137">&#34;127.0.0.1&#34;</span><span class="op" id="6596148">}</span><span class="op" id="6596149">,</span><br>
<span class="lineno"></span><span class="op" id="6596151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6596154">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6596218">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="6596281">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6596317">func</span>&nbsp;<span class="ident" id="6596322">TestDualStackTCPListener</span><span class="op" id="6596346">(</span><span class="ident" id="6596347">t</span>&nbsp;<span class="op" id="6596349">*</span><span class="ident" id="6596350">testing</span><span class="op" id="6596357">.</span><span class="ident" id="6596358">T</span><span class="op" id="6596359">)</span>&nbsp;<span class="op" id="6596361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596364">if</span>&nbsp;<span class="ident" id="6596367">testing</span><span class="op" id="6596374">.</span><span class="ident" id="6596375">Short</span><span class="op" id="6596380">(</span><span class="op" id="6596381">)</span>&nbsp;<span class="op" id="6596383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596387">t</span><span class="op" id="6596388">.</span><span class="ident" id="6596389">Skip</span><span class="op" id="6596393">(</span><span class="string" id="6596394">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6596435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596438">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596441">switch</span>&nbsp;<span class="ident" id="6596448">runtime</span><span class="op" id="6596455">.</span><span class="ident" id="6596456">GOOS</span>&nbsp;<span class="op" id="6596461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596464">case</span>&nbsp;<span class="string" id="6596469">&#34;plan9&#34;</span><span class="op" id="6596476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596480">t</span><span class="op" id="6596481">.</span><span class="ident" id="6596482">Skipf</span><span class="op" id="6596487">(</span><span class="string" id="6596488">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6596509">,</span>&nbsp;<span class="ident" id="6596511">runtime</span><span class="op" id="6596518">.</span><span class="ident" id="6596519">GOOS</span><span class="op" id="6596523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596529">if</span>&nbsp;<span class="op" id="6596532">!</span><span class="ident" id="6596533">supportsIPv6</span>&nbsp;<span class="op" id="6596546">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596550">t</span><span class="op" id="6596551">.</span><span class="ident" id="6596552">Skip</span><span class="op" id="6596556">(</span><span class="string" id="6596557">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6596580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596587">for</span>&nbsp;<span class="ident" id="6596591">_</span><span class="op" id="6596592">,</span>&nbsp;<span class="ident" id="6596594">tt</span>&nbsp;<span class="op" id="6596597">:=</span>&nbsp;<span class="keyword" id="6596600">range</span>&nbsp;<span class="ident" id="6596606">dualStackListenerTests</span>&nbsp;<span class="op" id="6596629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596633">if</span>&nbsp;<span class="ident" id="6596636">tt</span><span class="op" id="6596638">.</span><span class="ident" id="6596639">wildcard</span>&nbsp;<span class="op" id="6596648">&amp;&amp;</span>&nbsp;<span class="op" id="6596651">!</span><span class="op" id="6596652">*</span><span class="ident" id="6596653">testExternal</span>&nbsp;<span class="op" id="6596666">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596671">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596686">switch</span>&nbsp;<span class="ident" id="6596693">runtime</span><span class="op" id="6596700">.</span><span class="ident" id="6596701">GOOS</span>&nbsp;<span class="op" id="6596706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596710">case</span>&nbsp;<span class="string" id="6596715">&#34;openbsd&#34;</span><span class="op" id="6596724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6596729">if</span>&nbsp;<span class="ident" id="6596732">tt</span><span class="op" id="6596734">.</span><span class="ident" id="6596735">wildcard</span>&nbsp;<span class="op" id="6596744">&amp;&amp;</span>&nbsp;<span class="ident" id="6596747">differentWildcardAddr</span><span class="op" id="6596768">(</span><span class="ident" id="6596769">tt</span><span class="op" id="6596771">.</span><span class="ident" id="6596772">laddr1</span><span class="op" id="6596778">,</span>&nbsp;<span class="ident" id="6596780">tt</span><span class="op" id="6596782">.</span><span class="ident" id="6596783">laddr2</span><span class="op" id="6596789">)</span>&nbsp;<span class="op" id="6596791">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596797">tt</span><span class="op" id="6596799">.</span><span class="ident" id="6596800">xerr</span>&nbsp;<span class="op" id="6596805">=</span>&nbsp;<span class="builtintype" id="6596807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6596818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596822">l1</span><span class="op" id="6596824">,</span>&nbsp;<span class="ident" id="6596826">port</span>&nbsp;<span class="op" id="6596831">:=</span>&nbsp;<span class="ident" id="6596834">usableListenPort</span><span class="op" id="6596850">(</span><span class="ident" id="6596851">t</span><span class="op" id="6596852">,</span>&nbsp;<span class="ident" id="6596854">tt</span><span class="op" id="6596856">.</span><span class="ident" id="6596857">net1</span><span class="op" id="6596861">,</span>&nbsp;<span class="ident" id="6596863">tt</span><span class="op" id="6596865">.</span><span class="ident" id="6596866">laddr1</span><span class="op" id="6596872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596876">laddr</span>&nbsp;<span class="op" id="6596882">:=</span>&nbsp;<span class="ident" id="6596885">tt</span><span class="op" id="6596887">.</span><span class="ident" id="6596888">laddr1</span>&nbsp;<span class="op" id="6596895">+</span>&nbsp;<span class="string" id="6596897">&#34;:&#34;</span>&nbsp;<span class="op" id="6596901">+</span>&nbsp;<span class="ident" id="6596903">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596910">checkFirstListener</span><span class="op" id="6596928">(</span><span class="ident" id="6596929">t</span><span class="op" id="6596930">,</span>&nbsp;<span class="ident" id="6596932">tt</span><span class="op" id="6596934">.</span><span class="ident" id="6596935">net1</span><span class="op" id="6596939">,</span>&nbsp;<span class="ident" id="6596941">laddr</span><span class="op" id="6596946">,</span>&nbsp;<span class="ident" id="6596948">l1</span><span class="op" id="6596950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596954">laddr</span>&nbsp;<span class="op" id="6596960">=</span>&nbsp;<span class="ident" id="6596962">tt</span><span class="op" id="6596964">.</span><span class="ident" id="6596965">laddr2</span>&nbsp;<span class="op" id="6596972">+</span>&nbsp;<span class="string" id="6596974">&#34;:&#34;</span>&nbsp;<span class="op" id="6596978">+</span>&nbsp;<span class="ident" id="6596980">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596987">l2</span><span class="op" id="6596989">,</span>&nbsp;<span class="ident" id="6596991">err</span>&nbsp;<span class="op" id="6596995">:=</span>&nbsp;<span class="ident" id="6596998">Listen</span><span class="op" id="6597004">(</span><span class="ident" id="6597005">tt</span><span class="op" id="6597007">.</span><span class="ident" id="6597008">net2</span><span class="op" id="6597012">,</span>&nbsp;<span class="ident" id="6597014">laddr</span><span class="op" id="6597019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597023">checkDualStackSecondListener</span><span class="op" id="6597051">(</span><span class="ident" id="6597052">t</span><span class="op" id="6597053">,</span>&nbsp;<span class="ident" id="6597055">tt</span><span class="op" id="6597057">.</span><span class="ident" id="6597058">net2</span><span class="op" id="6597062">,</span>&nbsp;<span class="ident" id="6597064">laddr</span><span class="op" id="6597069">,</span>&nbsp;<span class="ident" id="6597071">tt</span><span class="op" id="6597073">.</span><span class="ident" id="6597074">xerr</span><span class="op" id="6597078">,</span>&nbsp;<span class="ident" id="6597080">err</span><span class="op" id="6597083">,</span>&nbsp;<span class="ident" id="6597085">l2</span><span class="op" id="6597087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597091">l1</span><span class="op" id="6597093">.</span><span class="ident" id="6597094">Close</span><span class="op" id="6597099">(</span><span class="op" id="6597100">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597103">}</span><br>
<span class="lineno"></span><span class="op" id="6597105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6597108">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6597172">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="6597235">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6597271">func</span>&nbsp;<span class="ident" id="6597276">TestDualStackUDPListener</span><span class="op" id="6597300">(</span><span class="ident" id="6597301">t</span>&nbsp;<span class="op" id="6597303">*</span><span class="ident" id="6597304">testing</span><span class="op" id="6597311">.</span><span class="ident" id="6597312">T</span><span class="op" id="6597313">)</span>&nbsp;<span class="op" id="6597315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597318">if</span>&nbsp;<span class="ident" id="6597321">testing</span><span class="op" id="6597328">.</span><span class="ident" id="6597329">Short</span><span class="op" id="6597334">(</span><span class="op" id="6597335">)</span>&nbsp;<span class="op" id="6597337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597341">t</span><span class="op" id="6597342">.</span><span class="ident" id="6597343">Skip</span><span class="op" id="6597347">(</span><span class="string" id="6597348">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6597389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597392">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597395">switch</span>&nbsp;<span class="ident" id="6597402">runtime</span><span class="op" id="6597409">.</span><span class="ident" id="6597410">GOOS</span>&nbsp;<span class="op" id="6597415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597418">case</span>&nbsp;<span class="string" id="6597423">&#34;plan9&#34;</span><span class="op" id="6597430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597434">t</span><span class="op" id="6597435">.</span><span class="ident" id="6597436">Skipf</span><span class="op" id="6597441">(</span><span class="string" id="6597442">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6597463">,</span>&nbsp;<span class="ident" id="6597465">runtime</span><span class="op" id="6597472">.</span><span class="ident" id="6597473">GOOS</span><span class="op" id="6597477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597483">if</span>&nbsp;<span class="op" id="6597486">!</span><span class="ident" id="6597487">supportsIPv6</span>&nbsp;<span class="op" id="6597500">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597504">t</span><span class="op" id="6597505">.</span><span class="ident" id="6597506">Skip</span><span class="op" id="6597510">(</span><span class="string" id="6597511">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6597534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597541">toudpnet</span>&nbsp;<span class="op" id="6597550">:=</span>&nbsp;<span class="keyword" id="6597553">func</span><span class="op" id="6597557">(</span><span class="ident" id="6597558">net</span>&nbsp;<span class="builtintype" id="6597562">string</span><span class="op" id="6597568">)</span>&nbsp;<span class="builtintype" id="6597570">string</span>&nbsp;<span class="op" id="6597577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597581">switch</span>&nbsp;<span class="ident" id="6597588">net</span>&nbsp;<span class="op" id="6597592">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597596">case</span>&nbsp;<span class="string" id="6597601">&#34;tcp&#34;</span><span class="op" id="6597606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597611">return</span>&nbsp;<span class="string" id="6597618">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597626">case</span>&nbsp;<span class="string" id="6597631">&#34;tcp4&#34;</span><span class="op" id="6597637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597642">return</span>&nbsp;<span class="string" id="6597649">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597658">case</span>&nbsp;<span class="string" id="6597663">&#34;tcp6&#34;</span><span class="op" id="6597669">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597674">return</span>&nbsp;<span class="string" id="6597681">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597694">return</span>&nbsp;<span class="string" id="6597701">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597714">for</span>&nbsp;<span class="ident" id="6597718">_</span><span class="op" id="6597719">,</span>&nbsp;<span class="ident" id="6597721">tt</span>&nbsp;<span class="op" id="6597724">:=</span>&nbsp;<span class="keyword" id="6597727">range</span>&nbsp;<span class="ident" id="6597733">dualStackListenerTests</span>&nbsp;<span class="op" id="6597756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597760">if</span>&nbsp;<span class="ident" id="6597763">tt</span><span class="op" id="6597765">.</span><span class="ident" id="6597766">wildcard</span>&nbsp;<span class="op" id="6597775">&amp;&amp;</span>&nbsp;<span class="op" id="6597778">(</span><span class="ident" id="6597779">testing</span><span class="op" id="6597786">.</span><span class="ident" id="6597787">Short</span><span class="op" id="6597792">(</span><span class="op" id="6597793">)</span>&nbsp;<span class="op" id="6597795">||</span>&nbsp;<span class="op" id="6597798">!</span><span class="op" id="6597799">*</span><span class="ident" id="6597800">testExternal</span><span class="op" id="6597812">)</span>&nbsp;<span class="op" id="6597814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597819">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6597830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597834">tt</span><span class="op" id="6597836">.</span><span class="ident" id="6597837">net1</span>&nbsp;<span class="op" id="6597842">=</span>&nbsp;<span class="ident" id="6597844">toudpnet</span><span class="op" id="6597852">(</span><span class="ident" id="6597853">tt</span><span class="op" id="6597855">.</span><span class="ident" id="6597856">net1</span><span class="op" id="6597860">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597864">tt</span><span class="op" id="6597866">.</span><span class="ident" id="6597867">net2</span>&nbsp;<span class="op" id="6597872">=</span>&nbsp;<span class="ident" id="6597874">toudpnet</span><span class="op" id="6597882">(</span><span class="ident" id="6597883">tt</span><span class="op" id="6597885">.</span><span class="ident" id="6597886">net2</span><span class="op" id="6597890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597894">switch</span>&nbsp;<span class="ident" id="6597901">runtime</span><span class="op" id="6597908">.</span><span class="ident" id="6597909">GOOS</span>&nbsp;<span class="op" id="6597914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597918">case</span>&nbsp;<span class="string" id="6597923">&#34;openbsd&#34;</span><span class="op" id="6597932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6597937">if</span>&nbsp;<span class="ident" id="6597940">tt</span><span class="op" id="6597942">.</span><span class="ident" id="6597943">wildcard</span>&nbsp;<span class="op" id="6597952">&amp;&amp;</span>&nbsp;<span class="ident" id="6597955">differentWildcardAddr</span><span class="op" id="6597976">(</span><span class="ident" id="6597977">tt</span><span class="op" id="6597979">.</span><span class="ident" id="6597980">laddr1</span><span class="op" id="6597986">,</span>&nbsp;<span class="ident" id="6597988">tt</span><span class="op" id="6597990">.</span><span class="ident" id="6597991">laddr2</span><span class="op" id="6597997">)</span>&nbsp;<span class="op" id="6597999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598005">tt</span><span class="op" id="6598007">.</span><span class="ident" id="6598008">xerr</span>&nbsp;<span class="op" id="6598013">=</span>&nbsp;<span class="builtintype" id="6598015">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598030">l1</span><span class="op" id="6598032">,</span>&nbsp;<span class="ident" id="6598034">port</span>&nbsp;<span class="op" id="6598039">:=</span>&nbsp;<span class="ident" id="6598042">usableListenPacketPort</span><span class="op" id="6598064">(</span><span class="ident" id="6598065">t</span><span class="op" id="6598066">,</span>&nbsp;<span class="ident" id="6598068">tt</span><span class="op" id="6598070">.</span><span class="ident" id="6598071">net1</span><span class="op" id="6598075">,</span>&nbsp;<span class="ident" id="6598077">tt</span><span class="op" id="6598079">.</span><span class="ident" id="6598080">laddr1</span><span class="op" id="6598086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598090">laddr</span>&nbsp;<span class="op" id="6598096">:=</span>&nbsp;<span class="ident" id="6598099">tt</span><span class="op" id="6598101">.</span><span class="ident" id="6598102">laddr1</span>&nbsp;<span class="op" id="6598109">+</span>&nbsp;<span class="string" id="6598111">&#34;:&#34;</span>&nbsp;<span class="op" id="6598115">+</span>&nbsp;<span class="ident" id="6598117">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598124">checkFirstListener</span><span class="op" id="6598142">(</span><span class="ident" id="6598143">t</span><span class="op" id="6598144">,</span>&nbsp;<span class="ident" id="6598146">tt</span><span class="op" id="6598148">.</span><span class="ident" id="6598149">net1</span><span class="op" id="6598153">,</span>&nbsp;<span class="ident" id="6598155">laddr</span><span class="op" id="6598160">,</span>&nbsp;<span class="ident" id="6598162">l1</span><span class="op" id="6598164">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598168">laddr</span>&nbsp;<span class="op" id="6598174">=</span>&nbsp;<span class="ident" id="6598176">tt</span><span class="op" id="6598178">.</span><span class="ident" id="6598179">laddr2</span>&nbsp;<span class="op" id="6598186">+</span>&nbsp;<span class="string" id="6598188">&#34;:&#34;</span>&nbsp;<span class="op" id="6598192">+</span>&nbsp;<span class="ident" id="6598194">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598201">l2</span><span class="op" id="6598203">,</span>&nbsp;<span class="ident" id="6598205">err</span>&nbsp;<span class="op" id="6598209">:=</span>&nbsp;<span class="ident" id="6598212">ListenPacket</span><span class="op" id="6598224">(</span><span class="ident" id="6598225">tt</span><span class="op" id="6598227">.</span><span class="ident" id="6598228">net2</span><span class="op" id="6598232">,</span>&nbsp;<span class="ident" id="6598234">laddr</span><span class="op" id="6598239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598243">checkDualStackSecondListener</span><span class="op" id="6598271">(</span><span class="ident" id="6598272">t</span><span class="op" id="6598273">,</span>&nbsp;<span class="ident" id="6598275">tt</span><span class="op" id="6598277">.</span><span class="ident" id="6598278">net2</span><span class="op" id="6598282">,</span>&nbsp;<span class="ident" id="6598284">laddr</span><span class="op" id="6598289">,</span>&nbsp;<span class="ident" id="6598291">tt</span><span class="op" id="6598293">.</span><span class="ident" id="6598294">xerr</span><span class="op" id="6598298">,</span>&nbsp;<span class="ident" id="6598300">err</span><span class="op" id="6598303">,</span>&nbsp;<span class="ident" id="6598305">l2</span><span class="op" id="6598307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598311">l1</span><span class="op" id="6598313">.</span><span class="ident" id="6598314">Close</span><span class="op" id="6598319">(</span><span class="op" id="6598320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598323">}</span><br>
<span class="lineno">250</span><span class="op" id="6598325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6598328">func</span>&nbsp;<span class="ident" id="6598333">usableListenPort</span><span class="op" id="6598349">(</span><span class="ident" id="6598350">t</span>&nbsp;<span class="op" id="6598352">*</span><span class="ident" id="6598353">testing</span><span class="op" id="6598360">.</span><span class="ident" id="6598361">T</span><span class="op" id="6598362">,</span>&nbsp;<span class="ident" id="6598364">net</span><span class="op" id="6598367">,</span>&nbsp;<span class="ident" id="6598369">laddr</span>&nbsp;<span class="builtintype" id="6598375">string</span><span class="op" id="6598381">)</span>&nbsp;<span class="op" id="6598383">(</span><span class="ident" id="6598384">l</span>&nbsp;<span class="ident" id="6598386">Listener</span><span class="op" id="6598394">,</span>&nbsp;<span class="ident" id="6598396">port</span>&nbsp;<span class="builtintype" id="6598401">string</span><span class="op" id="6598407">)</span>&nbsp;<span class="op" id="6598409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598412">var</span>&nbsp;<span class="ident" id="6598416">nladdr</span>&nbsp;<span class="builtintype" id="6598423">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598431">var</span>&nbsp;<span class="ident" id="6598435">err</span>&nbsp;<span class="builtintype" id="6598439">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598446">switch</span>&nbsp;<span class="ident" id="6598453">net</span>&nbsp;<span class="op" id="6598457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598460">default</span><span class="op" id="6598467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6598471">panic</span><span class="op" id="6598476">(</span><span class="string" id="6598477">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6598501">+</span>&nbsp;<span class="ident" id="6598503">net</span><span class="op" id="6598506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598509">case</span>&nbsp;<span class="string" id="6598514">&#34;tcp&#34;</span><span class="op" id="6598519">,</span>&nbsp;<span class="string" id="6598521">&#34;tcp4&#34;</span><span class="op" id="6598527">,</span>&nbsp;<span class="string" id="6598529">&#34;tcp6&#34;</span><span class="op" id="6598535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598539">l</span><span class="op" id="6598540">,</span>&nbsp;<span class="ident" id="6598542">err</span>&nbsp;<span class="op" id="6598546">=</span>&nbsp;<span class="ident" id="6598548">Listen</span><span class="op" id="6598554">(</span><span class="ident" id="6598555">net</span><span class="op" id="6598558">,</span>&nbsp;<span class="ident" id="6598560">laddr</span><span class="op" id="6598565">+</span><span class="string" id="6598566">&#34;:0&#34;</span><span class="op" id="6598570">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598574">if</span>&nbsp;<span class="ident" id="6598577">err</span>&nbsp;<span class="op" id="6598581">!=</span>&nbsp;<span class="builtintype" id="6598584">nil</span>&nbsp;<span class="op" id="6598588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598593">t</span><span class="op" id="6598594">.</span><span class="ident" id="6598595">Fatalf</span><span class="op" id="6598601">(</span><span class="string" id="6598602">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598635">,</span>&nbsp;<span class="ident" id="6598637">net</span><span class="op" id="6598640">,</span>&nbsp;<span class="ident" id="6598642">laddr</span><span class="op" id="6598647">,</span>&nbsp;<span class="ident" id="6598649">err</span><span class="op" id="6598652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598660">nladdr</span>&nbsp;<span class="op" id="6598667">=</span>&nbsp;<span class="ident" id="6598669">l</span><span class="op" id="6598670">.</span><span class="op" id="6598671">(</span><span class="op" id="6598672">*</span><span class="ident" id="6598673">TCPListener</span><span class="op" id="6598684">)</span><span class="op" id="6598685">.</span><span class="ident" id="6598686">Addr</span><span class="op" id="6598690">(</span><span class="op" id="6598691">)</span><span class="op" id="6598692">.</span><span class="ident" id="6598693">String</span><span class="op" id="6598699">(</span><span class="op" id="6598700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598703">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598706">_</span><span class="op" id="6598707">,</span>&nbsp;<span class="ident" id="6598709">port</span><span class="op" id="6598713">,</span>&nbsp;<span class="ident" id="6598715">err</span>&nbsp;<span class="op" id="6598719">=</span>&nbsp;<span class="ident" id="6598721">SplitHostPort</span><span class="op" id="6598734">(</span><span class="ident" id="6598735">nladdr</span><span class="op" id="6598741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598744">if</span>&nbsp;<span class="ident" id="6598747">err</span>&nbsp;<span class="op" id="6598751">!=</span>&nbsp;<span class="builtintype" id="6598754">nil</span>&nbsp;<span class="op" id="6598758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6598762">t</span><span class="op" id="6598763">.</span><span class="ident" id="6598764">Fatalf</span><span class="op" id="6598770">(</span><span class="string" id="6598771">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598797">,</span>&nbsp;<span class="ident" id="6598799">err</span><span class="op" id="6598802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6598805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598808">return</span>&nbsp;<span class="ident" id="6598815">l</span><span class="op" id="6598816">,</span>&nbsp;<span class="ident" id="6598818">port</span><br>
<span class="lineno">270</span><span class="op" id="6598823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6598826">func</span>&nbsp;<span class="ident" id="6598831">usableListenPacketPort</span><span class="op" id="6598853">(</span><span class="ident" id="6598854">t</span>&nbsp;<span class="op" id="6598856">*</span><span class="ident" id="6598857">testing</span><span class="op" id="6598864">.</span><span class="ident" id="6598865">T</span><span class="op" id="6598866">,</span>&nbsp;<span class="ident" id="6598868">net</span><span class="op" id="6598871">,</span>&nbsp;<span class="ident" id="6598873">laddr</span>&nbsp;<span class="builtintype" id="6598879">string</span><span class="op" id="6598885">)</span>&nbsp;<span class="op" id="6598887">(</span><span class="ident" id="6598888">l</span>&nbsp;<span class="ident" id="6598890">PacketConn</span><span class="op" id="6598900">,</span>&nbsp;<span class="ident" id="6598902">port</span>&nbsp;<span class="builtintype" id="6598907">string</span><span class="op" id="6598913">)</span>&nbsp;<span class="op" id="6598915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598918">var</span>&nbsp;<span class="ident" id="6598922">nladdr</span>&nbsp;<span class="builtintype" id="6598929">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598937">var</span>&nbsp;<span class="ident" id="6598941">err</span>&nbsp;<span class="builtintype" id="6598945">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598952">switch</span>&nbsp;<span class="ident" id="6598959">net</span>&nbsp;<span class="op" id="6598963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6598966">default</span><span class="op" id="6598973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6598977">panic</span><span class="op" id="6598982">(</span><span class="string" id="6598983">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6599013">+</span>&nbsp;<span class="ident" id="6599015">net</span><span class="op" id="6599018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599021">case</span>&nbsp;<span class="string" id="6599026">&#34;udp&#34;</span><span class="op" id="6599031">,</span>&nbsp;<span class="string" id="6599033">&#34;udp4&#34;</span><span class="op" id="6599039">,</span>&nbsp;<span class="string" id="6599041">&#34;udp6&#34;</span><span class="op" id="6599047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599051">l</span><span class="op" id="6599052">,</span>&nbsp;<span class="ident" id="6599054">err</span>&nbsp;<span class="op" id="6599058">=</span>&nbsp;<span class="ident" id="6599060">ListenPacket</span><span class="op" id="6599072">(</span><span class="ident" id="6599073">net</span><span class="op" id="6599076">,</span>&nbsp;<span class="ident" id="6599078">laddr</span><span class="op" id="6599083">+</span><span class="string" id="6599084">&#34;:0&#34;</span><span class="op" id="6599088">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599092">if</span>&nbsp;<span class="ident" id="6599095">err</span>&nbsp;<span class="op" id="6599099">!=</span>&nbsp;<span class="builtintype" id="6599102">nil</span>&nbsp;<span class="op" id="6599106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599111">t</span><span class="op" id="6599112">.</span><span class="ident" id="6599113">Fatalf</span><span class="op" id="6599119">(</span><span class="string" id="6599120">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6599159">,</span>&nbsp;<span class="ident" id="6599161">net</span><span class="op" id="6599164">,</span>&nbsp;<span class="ident" id="6599166">laddr</span><span class="op" id="6599171">,</span>&nbsp;<span class="ident" id="6599173">err</span><span class="op" id="6599176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599184">nladdr</span>&nbsp;<span class="op" id="6599191">=</span>&nbsp;<span class="ident" id="6599193">l</span><span class="op" id="6599194">.</span><span class="op" id="6599195">(</span><span class="op" id="6599196">*</span><span class="ident" id="6599197">UDPConn</span><span class="op" id="6599204">)</span><span class="op" id="6599205">.</span><span class="ident" id="6599206">LocalAddr</span><span class="op" id="6599215">(</span><span class="op" id="6599216">)</span><span class="op" id="6599217">.</span><span class="ident" id="6599218">String</span><span class="op" id="6599224">(</span><span class="op" id="6599225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599228">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599231">_</span><span class="op" id="6599232">,</span>&nbsp;<span class="ident" id="6599234">port</span><span class="op" id="6599238">,</span>&nbsp;<span class="ident" id="6599240">err</span>&nbsp;<span class="op" id="6599244">=</span>&nbsp;<span class="ident" id="6599246">SplitHostPort</span><span class="op" id="6599259">(</span><span class="ident" id="6599260">nladdr</span><span class="op" id="6599266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599269">if</span>&nbsp;<span class="ident" id="6599272">err</span>&nbsp;<span class="op" id="6599276">!=</span>&nbsp;<span class="builtintype" id="6599279">nil</span>&nbsp;<span class="op" id="6599283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599287">t</span><span class="op" id="6599288">.</span><span class="ident" id="6599289">Fatalf</span><span class="op" id="6599295">(</span><span class="string" id="6599296">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6599322">,</span>&nbsp;<span class="ident" id="6599324">err</span><span class="op" id="6599327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599333">return</span>&nbsp;<span class="ident" id="6599340">l</span><span class="op" id="6599341">,</span>&nbsp;<span class="ident" id="6599343">port</span><br>
<span class="lineno">290</span><span class="op" id="6599348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6599351">func</span>&nbsp;<span class="ident" id="6599356">differentWildcardAddr</span><span class="op" id="6599377">(</span><span class="ident" id="6599378">i</span><span class="op" id="6599379">,</span>&nbsp;<span class="ident" id="6599381">j</span>&nbsp;<span class="builtintype" id="6599383">string</span><span class="op" id="6599389">)</span>&nbsp;<span class="builtintype" id="6599391">bool</span>&nbsp;<span class="op" id="6599396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599399">if</span>&nbsp;<span class="op" id="6599402">(</span><span class="ident" id="6599403">i</span>&nbsp;<span class="op" id="6599405">==</span>&nbsp;<span class="string" id="6599408">&#34;&#34;</span>&nbsp;<span class="op" id="6599411">||</span>&nbsp;<span class="ident" id="6599414">i</span>&nbsp;<span class="op" id="6599416">==</span>&nbsp;<span class="string" id="6599419">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6599429">||</span>&nbsp;<span class="ident" id="6599432">i</span>&nbsp;<span class="op" id="6599434">==</span>&nbsp;<span class="string" id="6599437">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6599453">)</span>&nbsp;<span class="op" id="6599455">&amp;&amp;</span>&nbsp;<span class="op" id="6599458">(</span><span class="ident" id="6599459">j</span>&nbsp;<span class="op" id="6599461">==</span>&nbsp;<span class="string" id="6599464">&#34;&#34;</span>&nbsp;<span class="op" id="6599467">||</span>&nbsp;<span class="ident" id="6599470">j</span>&nbsp;<span class="op" id="6599472">==</span>&nbsp;<span class="string" id="6599475">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6599485">||</span>&nbsp;<span class="ident" id="6599488">j</span>&nbsp;<span class="op" id="6599490">==</span>&nbsp;<span class="string" id="6599493">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6599509">)</span>&nbsp;<span class="op" id="6599511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599515">return</span>&nbsp;<span class="builtintype" id="6599522">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599532">if</span>&nbsp;<span class="ident" id="6599535">i</span>&nbsp;<span class="op" id="6599537">==</span>&nbsp;<span class="string" id="6599540">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6599547">&amp;&amp;</span>&nbsp;<span class="ident" id="6599550">j</span>&nbsp;<span class="op" id="6599552">==</span>&nbsp;<span class="string" id="6599555">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6599562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599566">return</span>&nbsp;<span class="builtintype" id="6599573">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599583">return</span>&nbsp;<span class="builtintype" id="6599590">true</span><br>
<span class="lineno">300</span><span class="op" id="6599595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6599598">func</span>&nbsp;<span class="ident" id="6599603">checkFirstListener</span><span class="op" id="6599621">(</span><span class="ident" id="6599622">t</span>&nbsp;<span class="op" id="6599624">*</span><span class="ident" id="6599625">testing</span><span class="op" id="6599632">.</span><span class="ident" id="6599633">T</span><span class="op" id="6599634">,</span>&nbsp;<span class="ident" id="6599636">net</span><span class="op" id="6599639">,</span>&nbsp;<span class="ident" id="6599641">laddr</span>&nbsp;<span class="builtintype" id="6599647">string</span><span class="op" id="6599653">,</span>&nbsp;<span class="ident" id="6599655">l</span>&nbsp;<span class="keyword" id="6599657">interface</span><span class="op" id="6599666">{</span><span class="op" id="6599667">}</span><span class="op" id="6599668">)</span>&nbsp;<span class="op" id="6599670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599673">switch</span>&nbsp;<span class="ident" id="6599680">net</span>&nbsp;<span class="op" id="6599684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599687">case</span>&nbsp;<span class="string" id="6599692">&#34;tcp&#34;</span><span class="op" id="6599697">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599701">fd</span>&nbsp;<span class="op" id="6599704">:=</span>&nbsp;<span class="ident" id="6599707">l</span><span class="op" id="6599708">.</span><span class="op" id="6599709">(</span><span class="op" id="6599710">*</span><span class="ident" id="6599711">TCPListener</span><span class="op" id="6599722">)</span><span class="op" id="6599723">.</span><span class="ident" id="6599724">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599729">checkDualStackAddrFamily</span><span class="op" id="6599753">(</span><span class="ident" id="6599754">t</span><span class="op" id="6599755">,</span>&nbsp;<span class="ident" id="6599757">net</span><span class="op" id="6599760">,</span>&nbsp;<span class="ident" id="6599762">laddr</span><span class="op" id="6599767">,</span>&nbsp;<span class="ident" id="6599769">fd</span><span class="op" id="6599771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599774">case</span>&nbsp;<span class="string" id="6599779">&#34;tcp4&#34;</span><span class="op" id="6599785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599789">fd</span>&nbsp;<span class="op" id="6599792">:=</span>&nbsp;<span class="ident" id="6599795">l</span><span class="op" id="6599796">.</span><span class="op" id="6599797">(</span><span class="op" id="6599798">*</span><span class="ident" id="6599799">TCPListener</span><span class="op" id="6599810">)</span><span class="op" id="6599811">.</span><span class="ident" id="6599812">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599817">if</span>&nbsp;<span class="ident" id="6599820">fd</span><span class="op" id="6599822">.</span><span class="ident" id="6599823">family</span>&nbsp;<span class="op" id="6599830">!=</span>&nbsp;<span class="ident" id="6599833">syscall</span><span class="op" id="6599840">.</span><span class="ident" id="6599841">AF_INET</span>&nbsp;<span class="op" id="6599849">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599854">t</span><span class="op" id="6599855">.</span><span class="ident" id="6599856">Fatalf</span><span class="op" id="6599862">(</span><span class="string" id="6599863">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6599924">,</span>&nbsp;<span class="ident" id="6599926">net</span><span class="op" id="6599929">,</span>&nbsp;<span class="ident" id="6599931">laddr</span><span class="op" id="6599936">,</span>&nbsp;<span class="ident" id="6599938">fd</span><span class="op" id="6599940">.</span><span class="ident" id="6599941">family</span><span class="op" id="6599947">,</span>&nbsp;<span class="ident" id="6599949">syscall</span><span class="op" id="6599956">.</span><span class="ident" id="6599957">AF_INET</span><span class="op" id="6599964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6599968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6599971">case</span>&nbsp;<span class="string" id="6599976">&#34;tcp6&#34;</span><span class="op" id="6599982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6599986">fd</span>&nbsp;<span class="op" id="6599989">:=</span>&nbsp;<span class="ident" id="6599992">l</span><span class="op" id="6599993">.</span><span class="op" id="6599994">(</span><span class="op" id="6599995">*</span><span class="ident" id="6599996">TCPListener</span><span class="op" id="6600007">)</span><span class="op" id="6600008">.</span><span class="ident" id="6600009">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600014">if</span>&nbsp;<span class="ident" id="6600017">fd</span><span class="op" id="6600019">.</span><span class="ident" id="6600020">family</span>&nbsp;<span class="op" id="6600027">!=</span>&nbsp;<span class="ident" id="6600030">syscall</span><span class="op" id="6600037">.</span><span class="ident" id="6600038">AF_INET6</span>&nbsp;<span class="op" id="6600047">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600052">t</span><span class="op" id="6600053">.</span><span class="ident" id="6600054">Fatalf</span><span class="op" id="6600060">(</span><span class="string" id="6600061">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6600122">,</span>&nbsp;<span class="ident" id="6600124">net</span><span class="op" id="6600127">,</span>&nbsp;<span class="ident" id="6600129">laddr</span><span class="op" id="6600134">,</span>&nbsp;<span class="ident" id="6600136">fd</span><span class="op" id="6600138">.</span><span class="ident" id="6600139">family</span><span class="op" id="6600145">,</span>&nbsp;<span class="ident" id="6600147">syscall</span><span class="op" id="6600154">.</span><span class="ident" id="6600155">AF_INET6</span><span class="op" id="6600163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600170">case</span>&nbsp;<span class="string" id="6600175">&#34;udp&#34;</span><span class="op" id="6600180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600184">fd</span>&nbsp;<span class="op" id="6600187">:=</span>&nbsp;<span class="ident" id="6600190">l</span><span class="op" id="6600191">.</span><span class="op" id="6600192">(</span><span class="op" id="6600193">*</span><span class="ident" id="6600194">UDPConn</span><span class="op" id="6600201">)</span><span class="op" id="6600202">.</span><span class="ident" id="6600203">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600208">checkDualStackAddrFamily</span><span class="op" id="6600232">(</span><span class="ident" id="6600233">t</span><span class="op" id="6600234">,</span>&nbsp;<span class="ident" id="6600236">net</span><span class="op" id="6600239">,</span>&nbsp;<span class="ident" id="6600241">laddr</span><span class="op" id="6600246">,</span>&nbsp;<span class="ident" id="6600248">fd</span><span class="op" id="6600250">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600253">case</span>&nbsp;<span class="string" id="6600258">&#34;udp4&#34;</span><span class="op" id="6600264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600268">fd</span>&nbsp;<span class="op" id="6600271">:=</span>&nbsp;<span class="ident" id="6600274">l</span><span class="op" id="6600275">.</span><span class="op" id="6600276">(</span><span class="op" id="6600277">*</span><span class="ident" id="6600278">UDPConn</span><span class="op" id="6600285">)</span><span class="op" id="6600286">.</span><span class="ident" id="6600287">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600292">if</span>&nbsp;<span class="ident" id="6600295">fd</span><span class="op" id="6600297">.</span><span class="ident" id="6600298">family</span>&nbsp;<span class="op" id="6600305">!=</span>&nbsp;<span class="ident" id="6600308">syscall</span><span class="op" id="6600315">.</span><span class="ident" id="6600316">AF_INET</span>&nbsp;<span class="op" id="6600324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600329">t</span><span class="op" id="6600330">.</span><span class="ident" id="6600331">Fatalf</span><span class="op" id="6600337">(</span><span class="string" id="6600338">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6600405">,</span>&nbsp;<span class="ident" id="6600407">net</span><span class="op" id="6600410">,</span>&nbsp;<span class="ident" id="6600412">laddr</span><span class="op" id="6600417">,</span>&nbsp;<span class="ident" id="6600419">fd</span><span class="op" id="6600421">.</span><span class="ident" id="6600422">family</span><span class="op" id="6600428">,</span>&nbsp;<span class="ident" id="6600430">syscall</span><span class="op" id="6600437">.</span><span class="ident" id="6600438">AF_INET</span><span class="op" id="6600445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600449">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600452">case</span>&nbsp;<span class="string" id="6600457">&#34;udp6&#34;</span><span class="op" id="6600463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600467">fd</span>&nbsp;<span class="op" id="6600470">:=</span>&nbsp;<span class="ident" id="6600473">l</span><span class="op" id="6600474">.</span><span class="op" id="6600475">(</span><span class="op" id="6600476">*</span><span class="ident" id="6600477">UDPConn</span><span class="op" id="6600484">)</span><span class="op" id="6600485">.</span><span class="ident" id="6600486">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600491">if</span>&nbsp;<span class="ident" id="6600494">fd</span><span class="op" id="6600496">.</span><span class="ident" id="6600497">family</span>&nbsp;<span class="op" id="6600504">!=</span>&nbsp;<span class="ident" id="6600507">syscall</span><span class="op" id="6600514">.</span><span class="ident" id="6600515">AF_INET6</span>&nbsp;<span class="op" id="6600524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600529">t</span><span class="op" id="6600530">.</span><span class="ident" id="6600531">Fatalf</span><span class="op" id="6600537">(</span><span class="string" id="6600538">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6600605">,</span>&nbsp;<span class="ident" id="6600607">net</span><span class="op" id="6600610">,</span>&nbsp;<span class="ident" id="6600612">laddr</span><span class="op" id="6600617">,</span>&nbsp;<span class="ident" id="6600619">fd</span><span class="op" id="6600621">.</span><span class="ident" id="6600622">family</span><span class="op" id="6600628">,</span>&nbsp;<span class="ident" id="6600630">syscall</span><span class="op" id="6600637">.</span><span class="ident" id="6600638">AF_INET6</span><span class="op" id="6600646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600650">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600653">default</span><span class="op" id="6600660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600664">t</span><span class="op" id="6600665">.</span><span class="ident" id="6600666">Fatalf</span><span class="op" id="6600672">(</span><span class="string" id="6600673">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6600697">,</span>&nbsp;<span class="ident" id="6600699">net</span><span class="op" id="6600702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600705">}</span><br>
<span class="lineno"></span><span class="op" id="6600707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6600710">func</span>&nbsp;<span class="ident" id="6600715">checkSecondListener</span><span class="op" id="6600734">(</span><span class="ident" id="6600735">t</span>&nbsp;<span class="op" id="6600737">*</span><span class="ident" id="6600738">testing</span><span class="op" id="6600745">.</span><span class="ident" id="6600746">T</span><span class="op" id="6600747">,</span>&nbsp;<span class="ident" id="6600749">net</span><span class="op" id="6600752">,</span>&nbsp;<span class="ident" id="6600754">laddr</span>&nbsp;<span class="builtintype" id="6600760">string</span><span class="op" id="6600766">,</span>&nbsp;<span class="ident" id="6600768">err</span>&nbsp;<span class="builtintype" id="6600772">error</span><span class="op" id="6600777">,</span>&nbsp;<span class="ident" id="6600779">l</span>&nbsp;<span class="keyword" id="6600781">interface</span><span class="op" id="6600790">{</span><span class="op" id="6600791">}</span><span class="op" id="6600792">)</span>&nbsp;<span class="op" id="6600794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600797">switch</span>&nbsp;<span class="ident" id="6600804">net</span>&nbsp;<span class="op" id="6600808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600811">case</span>&nbsp;<span class="string" id="6600816">&#34;tcp&#34;</span><span class="op" id="6600821">,</span>&nbsp;<span class="string" id="6600823">&#34;tcp4&#34;</span><span class="op" id="6600829">,</span>&nbsp;<span class="string" id="6600831">&#34;tcp6&#34;</span><span class="op" id="6600837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600841">if</span>&nbsp;<span class="ident" id="6600844">err</span>&nbsp;<span class="op" id="6600848">==</span>&nbsp;<span class="builtintype" id="6600851">nil</span>&nbsp;<span class="op" id="6600855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600860">l</span><span class="op" id="6600861">.</span><span class="op" id="6600862">(</span><span class="op" id="6600863">*</span><span class="ident" id="6600864">TCPListener</span><span class="op" id="6600875">)</span><span class="op" id="6600876">.</span><span class="ident" id="6600877">Close</span><span class="op" id="6600882">(</span><span class="op" id="6600883">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6600888">t</span><span class="op" id="6600889">.</span><span class="ident" id="6600890">Fatalf</span><span class="op" id="6600896">(</span><span class="string" id="6600897">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6600932">,</span>&nbsp;<span class="ident" id="6600934">net</span><span class="op" id="6600937">,</span>&nbsp;<span class="ident" id="6600939">laddr</span><span class="op" id="6600944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6600948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600951">case</span>&nbsp;<span class="string" id="6600956">&#34;udp&#34;</span><span class="op" id="6600961">,</span>&nbsp;<span class="string" id="6600963">&#34;udp4&#34;</span><span class="op" id="6600969">,</span>&nbsp;<span class="string" id="6600971">&#34;udp6&#34;</span><span class="op" id="6600977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6600981">if</span>&nbsp;<span class="ident" id="6600984">err</span>&nbsp;<span class="op" id="6600988">==</span>&nbsp;<span class="builtintype" id="6600991">nil</span>&nbsp;<span class="op" id="6600995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601000">l</span><span class="op" id="6601001">.</span><span class="op" id="6601002">(</span><span class="op" id="6601003">*</span><span class="ident" id="6601004">UDPConn</span><span class="op" id="6601011">)</span><span class="op" id="6601012">.</span><span class="ident" id="6601013">Close</span><span class="op" id="6601018">(</span><span class="op" id="6601019">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601024">t</span><span class="op" id="6601025">.</span><span class="ident" id="6601026">Fatalf</span><span class="op" id="6601032">(</span><span class="string" id="6601033">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6601074">,</span>&nbsp;<span class="ident" id="6601076">net</span><span class="op" id="6601079">,</span>&nbsp;<span class="ident" id="6601081">laddr</span><span class="op" id="6601086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601093">default</span><span class="op" id="6601100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601104">t</span><span class="op" id="6601105">.</span><span class="ident" id="6601106">Fatalf</span><span class="op" id="6601112">(</span><span class="string" id="6601113">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6601137">,</span>&nbsp;<span class="ident" id="6601139">net</span><span class="op" id="6601142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601145">}</span><br>
<span class="lineno">350</span><span class="op" id="6601147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6601150">func</span>&nbsp;<span class="ident" id="6601155">checkDualStackSecondListener</span><span class="op" id="6601183">(</span><span class="ident" id="6601184">t</span>&nbsp;<span class="op" id="6601186">*</span><span class="ident" id="6601187">testing</span><span class="op" id="6601194">.</span><span class="ident" id="6601195">T</span><span class="op" id="6601196">,</span>&nbsp;<span class="ident" id="6601198">net</span><span class="op" id="6601201">,</span>&nbsp;<span class="ident" id="6601203">laddr</span>&nbsp;<span class="builtintype" id="6601209">string</span><span class="op" id="6601215">,</span>&nbsp;<span class="ident" id="6601217">xerr</span><span class="op" id="6601221">,</span>&nbsp;<span class="ident" id="6601223">err</span>&nbsp;<span class="builtintype" id="6601227">error</span><span class="op" id="6601232">,</span>&nbsp;<span class="ident" id="6601234">l</span>&nbsp;<span class="keyword" id="6601236">interface</span><span class="op" id="6601245">{</span><span class="op" id="6601246">}</span><span class="op" id="6601247">)</span>&nbsp;<span class="op" id="6601249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601252">switch</span>&nbsp;<span class="ident" id="6601259">net</span>&nbsp;<span class="op" id="6601263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601266">case</span>&nbsp;<span class="string" id="6601271">&#34;tcp&#34;</span><span class="op" id="6601276">,</span>&nbsp;<span class="string" id="6601278">&#34;tcp4&#34;</span><span class="op" id="6601284">,</span>&nbsp;<span class="string" id="6601286">&#34;tcp6&#34;</span><span class="op" id="6601292">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601296">if</span>&nbsp;<span class="ident" id="6601299">xerr</span>&nbsp;<span class="op" id="6601304">==</span>&nbsp;<span class="builtintype" id="6601307">nil</span>&nbsp;<span class="op" id="6601311">&amp;&amp;</span>&nbsp;<span class="ident" id="6601314">err</span>&nbsp;<span class="op" id="6601318">!=</span>&nbsp;<span class="builtintype" id="6601321">nil</span>&nbsp;<span class="op" id="6601325">||</span>&nbsp;<span class="ident" id="6601328">xerr</span>&nbsp;<span class="op" id="6601333">!=</span>&nbsp;<span class="builtintype" id="6601336">nil</span>&nbsp;<span class="op" id="6601340">&amp;&amp;</span>&nbsp;<span class="ident" id="6601343">err</span>&nbsp;<span class="op" id="6601347">==</span>&nbsp;<span class="builtintype" id="6601350">nil</span>&nbsp;<span class="op" id="6601354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601359">t</span><span class="op" id="6601360">.</span><span class="ident" id="6601361">Fatalf</span><span class="op" id="6601367">(</span><span class="string" id="6601368">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6601415">,</span>&nbsp;<span class="ident" id="6601417">net</span><span class="op" id="6601420">,</span>&nbsp;<span class="ident" id="6601422">laddr</span><span class="op" id="6601427">,</span>&nbsp;<span class="ident" id="6601429">err</span><span class="op" id="6601432">,</span>&nbsp;<span class="ident" id="6601434">xerr</span><span class="op" id="6601438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601446">if</span>&nbsp;<span class="ident" id="6601449">err</span>&nbsp;<span class="op" id="6601453">==</span>&nbsp;<span class="builtintype" id="6601456">nil</span>&nbsp;<span class="op" id="6601460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601465">l</span><span class="op" id="6601466">.</span><span class="op" id="6601467">(</span><span class="op" id="6601468">*</span><span class="ident" id="6601469">TCPListener</span><span class="op" id="6601480">)</span><span class="op" id="6601481">.</span><span class="ident" id="6601482">Close</span><span class="op" id="6601487">(</span><span class="op" id="6601488">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601495">case</span>&nbsp;<span class="string" id="6601500">&#34;udp&#34;</span><span class="op" id="6601505">,</span>&nbsp;<span class="string" id="6601507">&#34;udp4&#34;</span><span class="op" id="6601513">,</span>&nbsp;<span class="string" id="6601515">&#34;udp6&#34;</span><span class="op" id="6601521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601525">if</span>&nbsp;<span class="ident" id="6601528">xerr</span>&nbsp;<span class="op" id="6601533">==</span>&nbsp;<span class="builtintype" id="6601536">nil</span>&nbsp;<span class="op" id="6601540">&amp;&amp;</span>&nbsp;<span class="ident" id="6601543">err</span>&nbsp;<span class="op" id="6601547">!=</span>&nbsp;<span class="builtintype" id="6601550">nil</span>&nbsp;<span class="op" id="6601554">||</span>&nbsp;<span class="ident" id="6601557">xerr</span>&nbsp;<span class="op" id="6601562">!=</span>&nbsp;<span class="builtintype" id="6601565">nil</span>&nbsp;<span class="op" id="6601569">&amp;&amp;</span>&nbsp;<span class="ident" id="6601572">err</span>&nbsp;<span class="op" id="6601576">==</span>&nbsp;<span class="builtintype" id="6601579">nil</span>&nbsp;<span class="op" id="6601583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601588">t</span><span class="op" id="6601589">.</span><span class="ident" id="6601590">Fatalf</span><span class="op" id="6601596">(</span><span class="string" id="6601597">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6601650">,</span>&nbsp;<span class="ident" id="6601652">net</span><span class="op" id="6601655">,</span>&nbsp;<span class="ident" id="6601657">laddr</span><span class="op" id="6601662">,</span>&nbsp;<span class="ident" id="6601664">err</span><span class="op" id="6601667">,</span>&nbsp;<span class="ident" id="6601669">xerr</span><span class="op" id="6601673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601677">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601681">if</span>&nbsp;<span class="ident" id="6601684">err</span>&nbsp;<span class="op" id="6601688">==</span>&nbsp;<span class="builtintype" id="6601691">nil</span>&nbsp;<span class="op" id="6601695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601700">l</span><span class="op" id="6601701">.</span><span class="op" id="6601702">(</span><span class="op" id="6601703">*</span><span class="ident" id="6601704">UDPConn</span><span class="op" id="6601711">)</span><span class="op" id="6601712">.</span><span class="ident" id="6601713">Close</span><span class="op" id="6601718">(</span><span class="op" id="6601719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601726">default</span><span class="op" id="6601733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6601737">t</span><span class="op" id="6601738">.</span><span class="ident" id="6601739">Fatalf</span><span class="op" id="6601745">(</span><span class="string" id="6601746">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6601770">,</span>&nbsp;<span class="ident" id="6601772">net</span><span class="op" id="6601775">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6601778">}</span><br>
<span class="lineno"></span><span class="op" id="6601780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6601783">func</span>&nbsp;<span class="ident" id="6601788">checkDualStackAddrFamily</span><span class="op" id="6601812">(</span><span class="ident" id="6601813">t</span>&nbsp;<span class="op" id="6601815">*</span><span class="ident" id="6601816">testing</span><span class="op" id="6601823">.</span><span class="ident" id="6601824">T</span><span class="op" id="6601825">,</span>&nbsp;<span class="ident" id="6601827">net</span><span class="op" id="6601830">,</span>&nbsp;<span class="ident" id="6601832">laddr</span>&nbsp;<span class="builtintype" id="6601838">string</span><span class="op" id="6601844">,</span>&nbsp;<span class="ident" id="6601846">fd</span>&nbsp;<span class="op" id="6601849">*</span><span class="ident" id="6601850">netFD</span><span class="op" id="6601855">)</span>&nbsp;<span class="op" id="6601857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601860">switch</span>&nbsp;<span class="ident" id="6601867">a</span>&nbsp;<span class="op" id="6601869">:=</span>&nbsp;<span class="ident" id="6601872">fd</span><span class="op" id="6601874">.</span><span class="ident" id="6601875">laddr</span><span class="op" id="6601880">.</span><span class="op" id="6601881">(</span><span class="keyword" id="6601882">type</span><span class="op" id="6601886">)</span>&nbsp;<span class="op" id="6601888">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6601891">case</span>&nbsp;<span class="op" id="6601896">*</span><span class="ident" id="6601897">TCPAddr</span><span class="op" id="6601904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6601908">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6601964">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602017">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602074">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602096">if</span>&nbsp;<span class="ident" id="6602099">supportsIPv4map</span>&nbsp;<span class="op" id="6602115">&amp;&amp;</span>&nbsp;<span class="ident" id="6602118">fd</span><span class="op" id="6602120">.</span><span class="ident" id="6602121">laddr</span><span class="op" id="6602126">.</span><span class="op" id="6602127">(</span><span class="op" id="6602128">*</span><span class="ident" id="6602129">TCPAddr</span><span class="op" id="6602136">)</span><span class="op" id="6602137">.</span><span class="ident" id="6602138">isWildcard</span><span class="op" id="6602148">(</span><span class="op" id="6602149">)</span>&nbsp;<span class="op" id="6602151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602156">if</span>&nbsp;<span class="ident" id="6602159">fd</span><span class="op" id="6602161">.</span><span class="ident" id="6602162">family</span>&nbsp;<span class="op" id="6602169">!=</span>&nbsp;<span class="ident" id="6602172">syscall</span><span class="op" id="6602179">.</span><span class="ident" id="6602180">AF_INET6</span>&nbsp;<span class="op" id="6602189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602195">t</span><span class="op" id="6602196">.</span><span class="ident" id="6602197">Fatalf</span><span class="op" id="6602203">(</span><span class="string" id="6602204">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6602259">,</span>&nbsp;<span class="ident" id="6602261">net</span><span class="op" id="6602264">,</span>&nbsp;<span class="ident" id="6602266">laddr</span><span class="op" id="6602271">,</span>&nbsp;<span class="ident" id="6602273">fd</span><span class="op" id="6602275">.</span><span class="ident" id="6602276">family</span><span class="op" id="6602282">,</span>&nbsp;<span class="ident" id="6602284">syscall</span><span class="op" id="6602291">.</span><span class="ident" id="6602292">AF_INET6</span><span class="op" id="6602300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602309">}</span>&nbsp;<span class="keyword" id="6602311">else</span>&nbsp;<span class="op" id="6602316">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602321">if</span>&nbsp;<span class="ident" id="6602324">fd</span><span class="op" id="6602326">.</span><span class="ident" id="6602327">family</span>&nbsp;<span class="op" id="6602334">!=</span>&nbsp;<span class="ident" id="6602337">a</span><span class="op" id="6602338">.</span><span class="ident" id="6602339">family</span><span class="op" id="6602345">(</span><span class="op" id="6602346">)</span>&nbsp;<span class="op" id="6602348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602354">t</span><span class="op" id="6602355">.</span><span class="ident" id="6602356">Fatalf</span><span class="op" id="6602362">(</span><span class="string" id="6602363">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6602418">,</span>&nbsp;<span class="ident" id="6602420">net</span><span class="op" id="6602423">,</span>&nbsp;<span class="ident" id="6602425">laddr</span><span class="op" id="6602430">,</span>&nbsp;<span class="ident" id="6602432">fd</span><span class="op" id="6602434">.</span><span class="ident" id="6602435">family</span><span class="op" id="6602441">,</span>&nbsp;<span class="ident" id="6602443">a</span><span class="op" id="6602444">.</span><span class="ident" id="6602445">family</span><span class="op" id="6602451">(</span><span class="op" id="6602452">)</span><span class="op" id="6602453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602465">case</span>&nbsp;<span class="op" id="6602470">*</span><span class="ident" id="6602471">UDPAddr</span><span class="op" id="6602478">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602482">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602538">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602591">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6602648">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602670">if</span>&nbsp;<span class="ident" id="6602673">supportsIPv4map</span>&nbsp;<span class="op" id="6602689">&amp;&amp;</span>&nbsp;<span class="ident" id="6602692">fd</span><span class="op" id="6602694">.</span><span class="ident" id="6602695">laddr</span><span class="op" id="6602700">.</span><span class="op" id="6602701">(</span><span class="op" id="6602702">*</span><span class="ident" id="6602703">UDPAddr</span><span class="op" id="6602710">)</span><span class="op" id="6602711">.</span><span class="ident" id="6602712">isWildcard</span><span class="op" id="6602722">(</span><span class="op" id="6602723">)</span>&nbsp;<span class="op" id="6602725">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602730">if</span>&nbsp;<span class="ident" id="6602733">fd</span><span class="op" id="6602735">.</span><span class="ident" id="6602736">family</span>&nbsp;<span class="op" id="6602743">!=</span>&nbsp;<span class="ident" id="6602746">syscall</span><span class="op" id="6602753">.</span><span class="ident" id="6602754">AF_INET6</span>&nbsp;<span class="op" id="6602763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602769">t</span><span class="op" id="6602770">.</span><span class="ident" id="6602771">Fatalf</span><span class="op" id="6602777">(</span><span class="string" id="6602778">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6602839">,</span>&nbsp;<span class="ident" id="6602841">net</span><span class="op" id="6602844">,</span>&nbsp;<span class="ident" id="6602846">laddr</span><span class="op" id="6602851">,</span>&nbsp;<span class="ident" id="6602853">fd</span><span class="op" id="6602855">.</span><span class="ident" id="6602856">family</span><span class="op" id="6602862">,</span>&nbsp;<span class="ident" id="6602864">syscall</span><span class="op" id="6602871">.</span><span class="ident" id="6602872">AF_INET6</span><span class="op" id="6602880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6602889">}</span>&nbsp;<span class="keyword" id="6602891">else</span>&nbsp;<span class="op" id="6602896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6602901">if</span>&nbsp;<span class="ident" id="6602904">fd</span><span class="op" id="6602906">.</span><span class="ident" id="6602907">family</span>&nbsp;<span class="op" id="6602914">!=</span>&nbsp;<span class="ident" id="6602917">a</span><span class="op" id="6602918">.</span><span class="ident" id="6602919">family</span><span class="op" id="6602925">(</span><span class="op" id="6602926">)</span>&nbsp;<span class="op" id="6602928">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6602934">t</span><span class="op" id="6602935">.</span><span class="ident" id="6602936">Fatalf</span><span class="op" id="6602942">(</span><span class="string" id="6602943">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6603004">,</span>&nbsp;<span class="ident" id="6603006">net</span><span class="op" id="6603009">,</span>&nbsp;<span class="ident" id="6603011">laddr</span><span class="op" id="6603016">,</span>&nbsp;<span class="ident" id="6603018">fd</span><span class="op" id="6603020">.</span><span class="ident" id="6603021">family</span><span class="op" id="6603027">,</span>&nbsp;<span class="ident" id="6603029">a</span><span class="op" id="6603030">.</span><span class="ident" id="6603031">family</span><span class="op" id="6603037">(</span><span class="op" id="6603038">)</span><span class="op" id="6603039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603051">default</span><span class="op" id="6603058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603062">t</span><span class="op" id="6603063">.</span><span class="ident" id="6603064">Fatalf</span><span class="op" id="6603070">(</span><span class="string" id="6603071">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="6603109">,</span>&nbsp;<span class="ident" id="6603111">a</span><span class="op" id="6603112">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603115">}</span><br>
<span class="lineno"></span><span class="op" id="6603117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603120">var</span>&nbsp;<span class="ident" id="6603124">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6603151">=</span>&nbsp;<span class="op" id="6603153">[</span><span class="op" id="6603154">]</span><span class="keyword" id="6603155">struct</span>&nbsp;<span class="op" id="6603162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603165">net</span>&nbsp;&nbsp;<span class="builtintype" id="6603170">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603178">addr</span>&nbsp;<span class="builtintype" id="6603183">string</span><br>
<span class="lineno"></span><span class="op" id="6603190">}</span><span class="op" id="6603191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603194">{</span><span class="string" id="6603195">&#34;tcp6&#34;</span><span class="op" id="6603201">,</span>&nbsp;<span class="string" id="6603203">&#34;127.0.0.1&#34;</span><span class="op" id="6603214">}</span><span class="op" id="6603215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603218">{</span><span class="string" id="6603219">&#34;tcp6&#34;</span><span class="op" id="6603225">,</span>&nbsp;<span class="string" id="6603227">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6603247">}</span><span class="op" id="6603248">,</span><br>
<span class="lineno"></span><span class="op" id="6603250">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="6603253">func</span>&nbsp;<span class="ident" id="6603258">TestProhibitionaryDialArgs</span><span class="op" id="6603284">(</span><span class="ident" id="6603285">t</span>&nbsp;<span class="op" id="6603287">*</span><span class="ident" id="6603288">testing</span><span class="op" id="6603295">.</span><span class="ident" id="6603296">T</span><span class="op" id="6603297">)</span>&nbsp;<span class="op" id="6603299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603302">switch</span>&nbsp;<span class="ident" id="6603309">runtime</span><span class="op" id="6603316">.</span><span class="ident" id="6603317">GOOS</span>&nbsp;<span class="op" id="6603322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603325">case</span>&nbsp;<span class="string" id="6603330">&#34;plan9&#34;</span><span class="op" id="6603337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603341">t</span><span class="op" id="6603342">.</span><span class="ident" id="6603343">Skipf</span><span class="op" id="6603348">(</span><span class="string" id="6603349">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6603370">,</span>&nbsp;<span class="ident" id="6603372">runtime</span><span class="op" id="6603379">.</span><span class="ident" id="6603380">GOOS</span><span class="op" id="6603384">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6603390">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603460">if</span>&nbsp;<span class="op" id="6603463">!</span><span class="ident" id="6603464">supportsIPv4map</span>&nbsp;<span class="op" id="6603480">||</span>&nbsp;<span class="ident" id="6603483">testing</span><span class="op" id="6603490">.</span><span class="ident" id="6603491">Short</span><span class="op" id="6603496">(</span><span class="op" id="6603497">)</span>&nbsp;<span class="op" id="6603499">||</span>&nbsp;<span class="op" id="6603502">!</span><span class="op" id="6603503">*</span><span class="ident" id="6603504">testExternal</span>&nbsp;<span class="op" id="6603517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603521">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603529">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603533">l</span><span class="op" id="6603534">,</span>&nbsp;<span class="ident" id="6603536">port</span>&nbsp;<span class="op" id="6603541">:=</span>&nbsp;<span class="ident" id="6603544">usableListenPort</span><span class="op" id="6603560">(</span><span class="ident" id="6603561">t</span><span class="op" id="6603562">,</span>&nbsp;<span class="string" id="6603564">&#34;tcp&#34;</span><span class="op" id="6603569">,</span>&nbsp;<span class="string" id="6603571">&#34;[::]&#34;</span><span class="op" id="6603577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603580">defer</span>&nbsp;<span class="ident" id="6603586">l</span><span class="op" id="6603587">.</span><span class="ident" id="6603588">Close</span><span class="op" id="6603593">(</span><span class="op" id="6603594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603598">for</span>&nbsp;<span class="ident" id="6603602">_</span><span class="op" id="6603603">,</span>&nbsp;<span class="ident" id="6603605">tt</span>&nbsp;<span class="op" id="6603608">:=</span>&nbsp;<span class="keyword" id="6603611">range</span>&nbsp;<span class="ident" id="6603617">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6603644">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603648">c</span><span class="op" id="6603649">,</span>&nbsp;<span class="ident" id="6603651">err</span>&nbsp;<span class="op" id="6603655">:=</span>&nbsp;<span class="ident" id="6603658">Dial</span><span class="op" id="6603662">(</span><span class="ident" id="6603663">tt</span><span class="op" id="6603665">.</span><span class="ident" id="6603666">net</span><span class="op" id="6603669">,</span>&nbsp;<span class="ident" id="6603671">tt</span><span class="op" id="6603673">.</span><span class="ident" id="6603674">addr</span><span class="op" id="6603678">+</span><span class="string" id="6603679">&#34;:&#34;</span><span class="op" id="6603682">+</span><span class="ident" id="6603683">port</span><span class="op" id="6603687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603691">if</span>&nbsp;<span class="ident" id="6603694">err</span>&nbsp;<span class="op" id="6603698">==</span>&nbsp;<span class="builtintype" id="6603701">nil</span>&nbsp;<span class="op" id="6603705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603710">c</span><span class="op" id="6603711">.</span><span class="ident" id="6603712">Close</span><span class="op" id="6603717">(</span><span class="op" id="6603718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603723">t</span><span class="op" id="6603724">.</span><span class="ident" id="6603725">Fatalf</span><span class="op" id="6603731">(</span><span class="string" id="6603732">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6603758">,</span>&nbsp;<span class="ident" id="6603760">tt</span><span class="op" id="6603762">.</span><span class="ident" id="6603763">net</span><span class="op" id="6603766">,</span>&nbsp;<span class="ident" id="6603768">tt</span><span class="op" id="6603770">.</span><span class="ident" id="6603771">addr</span><span class="op" id="6603775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603779">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603782">}</span><br>
<span class="lineno"></span><span class="op" id="6603784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6603787">func</span>&nbsp;<span class="ident" id="6603792">TestWildWildcardListener</span><span class="op" id="6603816">(</span><span class="ident" id="6603817">t</span>&nbsp;<span class="op" id="6603819">*</span><span class="ident" id="6603820">testing</span><span class="op" id="6603827">.</span><span class="ident" id="6603828">T</span><span class="op" id="6603829">)</span>&nbsp;<span class="op" id="6603831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603834">switch</span>&nbsp;<span class="ident" id="6603841">runtime</span><span class="op" id="6603848">.</span><span class="ident" id="6603849">GOOS</span>&nbsp;<span class="op" id="6603854">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603857">case</span>&nbsp;<span class="string" id="6603862">&#34;plan9&#34;</span><span class="op" id="6603869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603873">t</span><span class="op" id="6603874">.</span><span class="ident" id="6603875">Skipf</span><span class="op" id="6603880">(</span><span class="string" id="6603881">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6603902">,</span>&nbsp;<span class="ident" id="6603904">runtime</span><span class="op" id="6603911">.</span><span class="ident" id="6603912">GOOS</span><span class="op" id="6603916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6603919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6603923">if</span>&nbsp;<span class="ident" id="6603926">testing</span><span class="op" id="6603933">.</span><span class="ident" id="6603934">Short</span><span class="op" id="6603939">(</span><span class="op" id="6603940">)</span>&nbsp;<span class="op" id="6603942">||</span>&nbsp;<span class="op" id="6603945">!</span><span class="op" id="6603946">*</span><span class="ident" id="6603947">testExternal</span>&nbsp;<span class="op" id="6603960">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6603964">t</span><span class="op" id="6603965">.</span><span class="ident" id="6603966">Skip</span><span class="op" id="6603970">(</span><span class="string" id="6603971">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6604012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604019">defer</span>&nbsp;<span class="keyword" id="6604025">func</span><span class="op" id="6604029">(</span><span class="op" id="6604030">)</span>&nbsp;<span class="op" id="6604032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604036">if</span>&nbsp;<span class="ident" id="6604039">p</span>&nbsp;<span class="op" id="6604041">:=</span>&nbsp;<span class="builtinfunc" id="6604044">recover</span><span class="op" id="6604051">(</span><span class="op" id="6604052">)</span><span class="op" id="6604053">;</span>&nbsp;<span class="ident" id="6604055">p</span>&nbsp;<span class="op" id="6604057">!=</span>&nbsp;<span class="builtintype" id="6604060">nil</span>&nbsp;<span class="op" id="6604064">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604069">t</span><span class="op" id="6604070">.</span><span class="ident" id="6604071">Fatalf</span><span class="op" id="6604077">(</span><span class="string" id="6604078">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6604141">,</span>&nbsp;<span class="ident" id="6604143">p</span><span class="op" id="6604144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604151">}</span><span class="op" id="6604152">(</span><span class="op" id="6604153">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604157">if</span>&nbsp;<span class="ident" id="6604160">ln</span><span class="op" id="6604162">,</span>&nbsp;<span class="ident" id="6604164">err</span>&nbsp;<span class="op" id="6604168">:=</span>&nbsp;<span class="ident" id="6604171">Listen</span><span class="op" id="6604177">(</span><span class="string" id="6604178">&#34;tcp&#34;</span><span class="op" id="6604183">,</span>&nbsp;<span class="string" id="6604185">&#34;&#34;</span><span class="op" id="6604187">)</span><span class="op" id="6604188">;</span>&nbsp;<span class="ident" id="6604190">err</span>&nbsp;<span class="op" id="6604194">==</span>&nbsp;<span class="builtintype" id="6604197">nil</span>&nbsp;<span class="op" id="6604201">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604205">ln</span><span class="op" id="6604207">.</span><span class="ident" id="6604208">Close</span><span class="op" id="6604213">(</span><span class="op" id="6604214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604220">if</span>&nbsp;<span class="ident" id="6604223">ln</span><span class="op" id="6604225">,</span>&nbsp;<span class="ident" id="6604227">err</span>&nbsp;<span class="op" id="6604231">:=</span>&nbsp;<span class="ident" id="6604234">ListenPacket</span><span class="op" id="6604246">(</span><span class="string" id="6604247">&#34;udp&#34;</span><span class="op" id="6604252">,</span>&nbsp;<span class="string" id="6604254">&#34;&#34;</span><span class="op" id="6604256">)</span><span class="op" id="6604257">;</span>&nbsp;<span class="ident" id="6604259">err</span>&nbsp;<span class="op" id="6604263">==</span>&nbsp;<span class="builtintype" id="6604266">nil</span>&nbsp;<span class="op" id="6604270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604274">ln</span><span class="op" id="6604276">.</span><span class="ident" id="6604277">Close</span><span class="op" id="6604282">(</span><span class="op" id="6604283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604286">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604289">if</span>&nbsp;<span class="ident" id="6604292">ln</span><span class="op" id="6604294">,</span>&nbsp;<span class="ident" id="6604296">err</span>&nbsp;<span class="op" id="6604300">:=</span>&nbsp;<span class="ident" id="6604303">ListenTCP</span><span class="op" id="6604312">(</span><span class="string" id="6604313">&#34;tcp&#34;</span><span class="op" id="6604318">,</span>&nbsp;<span class="builtintype" id="6604320">nil</span><span class="op" id="6604323">)</span><span class="op" id="6604324">;</span>&nbsp;<span class="ident" id="6604326">err</span>&nbsp;<span class="op" id="6604330">==</span>&nbsp;<span class="builtintype" id="6604333">nil</span>&nbsp;<span class="op" id="6604337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604341">ln</span><span class="op" id="6604343">.</span><span class="ident" id="6604344">Close</span><span class="op" id="6604349">(</span><span class="op" id="6604350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604356">if</span>&nbsp;<span class="ident" id="6604359">ln</span><span class="op" id="6604361">,</span>&nbsp;<span class="ident" id="6604363">err</span>&nbsp;<span class="op" id="6604367">:=</span>&nbsp;<span class="ident" id="6604370">ListenUDP</span><span class="op" id="6604379">(</span><span class="string" id="6604380">&#34;udp&#34;</span><span class="op" id="6604385">,</span>&nbsp;<span class="builtintype" id="6604387">nil</span><span class="op" id="6604390">)</span><span class="op" id="6604391">;</span>&nbsp;<span class="ident" id="6604393">err</span>&nbsp;<span class="op" id="6604397">==</span>&nbsp;<span class="builtintype" id="6604400">nil</span>&nbsp;<span class="op" id="6604404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604408">ln</span><span class="op" id="6604410">.</span><span class="ident" id="6604411">Close</span><span class="op" id="6604416">(</span><span class="op" id="6604417">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6604423">if</span>&nbsp;<span class="ident" id="6604426">ln</span><span class="op" id="6604428">,</span>&nbsp;<span class="ident" id="6604430">err</span>&nbsp;<span class="op" id="6604434">:=</span>&nbsp;<span class="ident" id="6604437">ListenIP</span><span class="op" id="6604445">(</span><span class="string" id="6604446">&#34;ip:icmp&#34;</span><span class="op" id="6604455">,</span>&nbsp;<span class="builtintype" id="6604457">nil</span><span class="op" id="6604460">)</span><span class="op" id="6604461">;</span>&nbsp;<span class="ident" id="6604463">err</span>&nbsp;<span class="op" id="6604467">==</span>&nbsp;<span class="builtintype" id="6604470">nil</span>&nbsp;<span class="op" id="6604474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6604478">ln</span><span class="op" id="6604480">.</span><span class="ident" id="6604481">Close</span><span class="op" id="6604486">(</span><span class="op" id="6604487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6604490">}</span><br>
<span class="lineno"></span><span class="op" id="6604492">}</span>
</div>
</body>
</html>
