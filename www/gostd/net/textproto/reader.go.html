<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3950317">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3950373">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3950427">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3950478">package</span>&nbsp;<span class="ident" id="3950486">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3950497">import</span>&nbsp;<span class="op" id="3950504">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950507">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950516">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950525">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950531">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950544">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3950555">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3950565">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3950568">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3950633">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3950698">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3950748">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3950812">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3950869">type</span>&nbsp;<span class="ident" id="3950874">Reader</span>&nbsp;<span class="keyword" id="3950881">struct</span>&nbsp;<span class="op" id="3950888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950891">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3950895">*</span><span class="ident" id="3950896">bufio</span><span class="op" id="3950901">.</span><span class="ident" id="3950902">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950910">dot</span>&nbsp;<span class="op" id="3950914">*</span><span class="ident" id="3950915">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3950926">buf</span>&nbsp;<span class="op" id="3950930">[</span><span class="op" id="3950931">]</span><span class="builtintype" id="3950932">byte</span>&nbsp;<span class="comment" id="3950937">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3950986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3950989">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3951039">func</span>&nbsp;<span class="ident" id="3951044">NewReader</span><span class="op" id="3951053">(</span><span class="ident" id="3951054">r</span>&nbsp;<span class="op" id="3951056">*</span><span class="ident" id="3951057">bufio</span><span class="op" id="3951062">.</span><span class="ident" id="3951063">Reader</span><span class="op" id="3951069">)</span>&nbsp;<span class="op" id="3951071">*</span><span class="ident" id="3951072">Reader</span>&nbsp;<span class="op" id="3951079">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951082">return</span>&nbsp;<span class="op" id="3951089">&amp;</span><span class="ident" id="3951090">Reader</span><span class="op" id="3951096">{</span><span class="ident" id="3951097">R</span><span class="op" id="3951098">:</span>&nbsp;<span class="ident" id="3951100">r</span><span class="op" id="3951101">}</span><br>
<span class="lineno"></span><span class="op" id="3951103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3951106">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3951146">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3951204">func</span>&nbsp;<span class="op" id="3951209">(</span><span class="ident" id="3951210">r</span>&nbsp;<span class="op" id="3951212">*</span><span class="ident" id="3951213">Reader</span><span class="op" id="3951219">)</span>&nbsp;<span class="ident" id="3951221">ReadLine</span><span class="op" id="3951229">(</span><span class="op" id="3951230">)</span>&nbsp;<span class="op" id="3951232">(</span><span class="builtintype" id="3951233">string</span><span class="op" id="3951239">,</span>&nbsp;<span class="builtintype" id="3951241">error</span><span class="op" id="3951246">)</span>&nbsp;<span class="op" id="3951248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951251">line</span><span class="op" id="3951255">,</span>&nbsp;<span class="ident" id="3951257">err</span>&nbsp;<span class="op" id="3951261">:=</span>&nbsp;<span class="ident" id="3951264">r</span><span class="op" id="3951265">.</span><span class="ident" id="3951266">readLineSlice</span><span class="op" id="3951279">(</span><span class="op" id="3951280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951283">return</span>&nbsp;<span class="builtintype" id="3951290">string</span><span class="op" id="3951296">(</span><span class="ident" id="3951297">line</span><span class="op" id="3951301">)</span><span class="op" id="3951302">,</span>&nbsp;<span class="ident" id="3951304">err</span><br>
<span class="lineno"></span><span class="op" id="3951308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3951311">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3951387">func</span>&nbsp;<span class="op" id="3951392">(</span><span class="ident" id="3951393">r</span>&nbsp;<span class="op" id="3951395">*</span><span class="ident" id="3951396">Reader</span><span class="op" id="3951402">)</span>&nbsp;<span class="ident" id="3951404">ReadLineBytes</span><span class="op" id="3951417">(</span><span class="op" id="3951418">)</span>&nbsp;<span class="op" id="3951420">(</span><span class="op" id="3951421">[</span><span class="op" id="3951422">]</span><span class="builtintype" id="3951423">byte</span><span class="op" id="3951427">,</span>&nbsp;<span class="builtintype" id="3951429">error</span><span class="op" id="3951434">)</span>&nbsp;<span class="op" id="3951436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951439">line</span><span class="op" id="3951443">,</span>&nbsp;<span class="ident" id="3951445">err</span>&nbsp;<span class="op" id="3951449">:=</span>&nbsp;<span class="ident" id="3951452">r</span><span class="op" id="3951453">.</span><span class="ident" id="3951454">readLineSlice</span><span class="op" id="3951467">(</span><span class="op" id="3951468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951471">if</span>&nbsp;<span class="ident" id="3951474">line</span>&nbsp;<span class="op" id="3951479">!=</span>&nbsp;<span class="builtintype" id="3951482">nil</span>&nbsp;<span class="op" id="3951486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951490">buf</span>&nbsp;<span class="op" id="3951494">:=</span>&nbsp;<span class="builtinfunc" id="3951497">make</span><span class="op" id="3951501">(</span><span class="op" id="3951502">[</span><span class="op" id="3951503">]</span><span class="builtintype" id="3951504">byte</span><span class="op" id="3951508">,</span>&nbsp;<span class="builtinfunc" id="3951510">len</span><span class="op" id="3951513">(</span><span class="ident" id="3951514">line</span><span class="op" id="3951518">)</span><span class="op" id="3951519">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3951523">copy</span><span class="op" id="3951527">(</span><span class="ident" id="3951528">buf</span><span class="op" id="3951531">,</span>&nbsp;<span class="ident" id="3951533">line</span><span class="op" id="3951537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951541">line</span>&nbsp;<span class="op" id="3951546">=</span>&nbsp;<span class="ident" id="3951548">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951556">return</span>&nbsp;<span class="ident" id="3951563">line</span><span class="op" id="3951567">,</span>&nbsp;<span class="ident" id="3951569">err</span><br>
<span class="lineno"></span><span class="op" id="3951573">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3951576">func</span>&nbsp;<span class="op" id="3951581">(</span><span class="ident" id="3951582">r</span>&nbsp;<span class="op" id="3951584">*</span><span class="ident" id="3951585">Reader</span><span class="op" id="3951591">)</span>&nbsp;<span class="ident" id="3951593">readLineSlice</span><span class="op" id="3951606">(</span><span class="op" id="3951607">)</span>&nbsp;<span class="op" id="3951609">(</span><span class="op" id="3951610">[</span><span class="op" id="3951611">]</span><span class="builtintype" id="3951612">byte</span><span class="op" id="3951616">,</span>&nbsp;<span class="builtintype" id="3951618">error</span><span class="op" id="3951623">)</span>&nbsp;<span class="op" id="3951625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951628">r</span><span class="op" id="3951629">.</span><span class="ident" id="3951630">closeDot</span><span class="op" id="3951638">(</span><span class="op" id="3951639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951642">var</span>&nbsp;<span class="ident" id="3951646">line</span>&nbsp;<span class="op" id="3951651">[</span><span class="op" id="3951652">]</span><span class="builtintype" id="3951653">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951659">for</span>&nbsp;<span class="op" id="3951663">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951667">l</span><span class="op" id="3951668">,</span>&nbsp;<span class="ident" id="3951670">more</span><span class="op" id="3951674">,</span>&nbsp;<span class="ident" id="3951676">err</span>&nbsp;<span class="op" id="3951680">:=</span>&nbsp;<span class="ident" id="3951683">r</span><span class="op" id="3951684">.</span><span class="ident" id="3951685">R</span><span class="op" id="3951686">.</span><span class="ident" id="3951687">ReadLine</span><span class="op" id="3951695">(</span><span class="op" id="3951696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951700">if</span>&nbsp;<span class="ident" id="3951703">err</span>&nbsp;<span class="op" id="3951707">!=</span>&nbsp;<span class="builtintype" id="3951710">nil</span>&nbsp;<span class="op" id="3951714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951719">return</span>&nbsp;<span class="builtintype" id="3951726">nil</span><span class="op" id="3951729">,</span>&nbsp;<span class="ident" id="3951731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3951741">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951801">if</span>&nbsp;<span class="ident" id="3951804">line</span>&nbsp;<span class="op" id="3951809">==</span>&nbsp;<span class="builtintype" id="3951812">nil</span>&nbsp;<span class="op" id="3951816">&amp;&amp;</span>&nbsp;<span class="op" id="3951819">!</span><span class="ident" id="3951820">more</span>&nbsp;<span class="op" id="3951825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951830">return</span>&nbsp;<span class="ident" id="3951837">l</span><span class="op" id="3951838">,</span>&nbsp;<span class="builtintype" id="3951840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3951850">line</span>&nbsp;<span class="op" id="3951855">=</span>&nbsp;<span class="builtinfunc" id="3951857">append</span><span class="op" id="3951863">(</span><span class="ident" id="3951864">line</span><span class="op" id="3951868">,</span>&nbsp;<span class="ident" id="3951870">l</span><span class="op" id="3951871">...</span><span class="op" id="3951874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951878">if</span>&nbsp;<span class="op" id="3951881">!</span><span class="ident" id="3951882">more</span>&nbsp;<span class="op" id="3951887">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951892">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3951903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3951906">return</span>&nbsp;<span class="ident" id="3951913">line</span><span class="op" id="3951917">,</span>&nbsp;<span class="builtintype" id="3951919">nil</span><br>
<span class="lineno"></span><span class="op" id="3951923">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3951926">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3951987">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3952036">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3952098">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3952161">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3952220">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3952283">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3952299">//</span><br>
<span class="lineno"></span><span class="comment" id="3952302">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3952339">//</span><br>
<span class="lineno"></span><span class="comment" id="3952342">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3952352">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3952370">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3952380">//</span><br>
<span class="lineno">85</span><span class="comment" id="3952383">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3952456">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3952496">//</span><br>
<span class="lineno"></span><span class="comment" id="3952499">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3952560">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3952563">func</span>&nbsp;<span class="op" id="3952568">(</span><span class="ident" id="3952569">r</span>&nbsp;<span class="op" id="3952571">*</span><span class="ident" id="3952572">Reader</span><span class="op" id="3952578">)</span>&nbsp;<span class="ident" id="3952580">ReadContinuedLine</span><span class="op" id="3952597">(</span><span class="op" id="3952598">)</span>&nbsp;<span class="op" id="3952600">(</span><span class="builtintype" id="3952601">string</span><span class="op" id="3952607">,</span>&nbsp;<span class="builtintype" id="3952609">error</span><span class="op" id="3952614">)</span>&nbsp;<span class="op" id="3952616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952619">line</span><span class="op" id="3952623">,</span>&nbsp;<span class="ident" id="3952625">err</span>&nbsp;<span class="op" id="3952629">:=</span>&nbsp;<span class="ident" id="3952632">r</span><span class="op" id="3952633">.</span><span class="ident" id="3952634">readContinuedLineSlice</span><span class="op" id="3952656">(</span><span class="op" id="3952657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952660">return</span>&nbsp;<span class="builtintype" id="3952667">string</span><span class="op" id="3952673">(</span><span class="ident" id="3952674">line</span><span class="op" id="3952678">)</span><span class="op" id="3952679">,</span>&nbsp;<span class="ident" id="3952681">err</span><br>
<span class="lineno"></span><span class="op" id="3952685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3952688">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3952757">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3952797">func</span>&nbsp;<span class="ident" id="3952802">trim</span><span class="op" id="3952806">(</span><span class="ident" id="3952807">s</span>&nbsp;<span class="op" id="3952809">[</span><span class="op" id="3952810">]</span><span class="builtintype" id="3952811">byte</span><span class="op" id="3952815">)</span>&nbsp;<span class="op" id="3952817">[</span><span class="op" id="3952818">]</span><span class="builtintype" id="3952819">byte</span>&nbsp;<span class="op" id="3952824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952827">i</span>&nbsp;<span class="op" id="3952829">:=</span>&nbsp;<span class="num" id="3952832">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952835">for</span>&nbsp;<span class="ident" id="3952839">i</span>&nbsp;<span class="op" id="3952841">&lt;</span>&nbsp;<span class="builtinfunc" id="3952843">len</span><span class="op" id="3952846">(</span><span class="ident" id="3952847">s</span><span class="op" id="3952848">)</span>&nbsp;<span class="op" id="3952850">&amp;&amp;</span>&nbsp;<span class="op" id="3952853">(</span><span class="ident" id="3952854">s</span><span class="op" id="3952855">[</span><span class="ident" id="3952856">i</span><span class="op" id="3952857">]</span>&nbsp;<span class="op" id="3952859">==</span>&nbsp;<span class="string" id="3952862">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3952866">||</span>&nbsp;<span class="ident" id="3952869">s</span><span class="op" id="3952870">[</span><span class="ident" id="3952871">i</span><span class="op" id="3952872">]</span>&nbsp;<span class="op" id="3952874">==</span>&nbsp;<span class="string" id="3952877">&#39;\t&#39;</span><span class="op" id="3952881">)</span>&nbsp;<span class="op" id="3952883">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952887">i</span><span class="op" id="3952888">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952895">n</span>&nbsp;<span class="op" id="3952897">:=</span>&nbsp;<span class="builtinfunc" id="3952900">len</span><span class="op" id="3952903">(</span><span class="ident" id="3952904">s</span><span class="op" id="3952905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952908">for</span>&nbsp;<span class="ident" id="3952912">n</span>&nbsp;<span class="op" id="3952914">&gt;</span>&nbsp;<span class="ident" id="3952916">i</span>&nbsp;<span class="op" id="3952918">&amp;&amp;</span>&nbsp;<span class="op" id="3952921">(</span><span class="ident" id="3952922">s</span><span class="op" id="3952923">[</span><span class="ident" id="3952924">n</span><span class="op" id="3952925">-</span><span class="num" id="3952926">1</span><span class="op" id="3952927">]</span>&nbsp;<span class="op" id="3952929">==</span>&nbsp;<span class="string" id="3952932">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3952936">||</span>&nbsp;<span class="ident" id="3952939">s</span><span class="op" id="3952940">[</span><span class="ident" id="3952941">n</span><span class="op" id="3952942">-</span><span class="num" id="3952943">1</span><span class="op" id="3952944">]</span>&nbsp;<span class="op" id="3952946">==</span>&nbsp;<span class="string" id="3952949">&#39;\t&#39;</span><span class="op" id="3952953">)</span>&nbsp;<span class="op" id="3952955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3952959">n</span><span class="op" id="3952960">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3952964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3952967">return</span>&nbsp;<span class="ident" id="3952974">s</span><span class="op" id="3952975">[</span><span class="ident" id="3952976">i</span><span class="op" id="3952977">:</span><span class="ident" id="3952978">n</span><span class="op" id="3952979">]</span><br>
<span class="lineno"></span><span class="op" id="3952981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3952984">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3953040">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3953081">func</span>&nbsp;<span class="op" id="3953086">(</span><span class="ident" id="3953087">r</span>&nbsp;<span class="op" id="3953089">*</span><span class="ident" id="3953090">Reader</span><span class="op" id="3953096">)</span>&nbsp;<span class="ident" id="3953098">ReadContinuedLineBytes</span><span class="op" id="3953120">(</span><span class="op" id="3953121">)</span>&nbsp;<span class="op" id="3953123">(</span><span class="op" id="3953124">[</span><span class="op" id="3953125">]</span><span class="builtintype" id="3953126">byte</span><span class="op" id="3953130">,</span>&nbsp;<span class="builtintype" id="3953132">error</span><span class="op" id="3953137">)</span>&nbsp;<span class="op" id="3953139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953142">line</span><span class="op" id="3953146">,</span>&nbsp;<span class="ident" id="3953148">err</span>&nbsp;<span class="op" id="3953152">:=</span>&nbsp;<span class="ident" id="3953155">r</span><span class="op" id="3953156">.</span><span class="ident" id="3953157">readContinuedLineSlice</span><span class="op" id="3953179">(</span><span class="op" id="3953180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953183">if</span>&nbsp;<span class="ident" id="3953186">line</span>&nbsp;<span class="op" id="3953191">!=</span>&nbsp;<span class="builtintype" id="3953194">nil</span>&nbsp;<span class="op" id="3953198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953202">buf</span>&nbsp;<span class="op" id="3953206">:=</span>&nbsp;<span class="builtinfunc" id="3953209">make</span><span class="op" id="3953213">(</span><span class="op" id="3953214">[</span><span class="op" id="3953215">]</span><span class="builtintype" id="3953216">byte</span><span class="op" id="3953220">,</span>&nbsp;<span class="builtinfunc" id="3953222">len</span><span class="op" id="3953225">(</span><span class="ident" id="3953226">line</span><span class="op" id="3953230">)</span><span class="op" id="3953231">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3953235">copy</span><span class="op" id="3953239">(</span><span class="ident" id="3953240">buf</span><span class="op" id="3953243">,</span>&nbsp;<span class="ident" id="3953245">line</span><span class="op" id="3953249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953253">line</span>&nbsp;<span class="op" id="3953258">=</span>&nbsp;<span class="ident" id="3953260">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3953265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953268">return</span>&nbsp;<span class="ident" id="3953275">line</span><span class="op" id="3953279">,</span>&nbsp;<span class="ident" id="3953281">err</span><br>
<span class="lineno"></span><span class="op" id="3953285">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3953288">func</span>&nbsp;<span class="op" id="3953293">(</span><span class="ident" id="3953294">r</span>&nbsp;<span class="op" id="3953296">*</span><span class="ident" id="3953297">Reader</span><span class="op" id="3953303">)</span>&nbsp;<span class="ident" id="3953305">readContinuedLineSlice</span><span class="op" id="3953327">(</span><span class="op" id="3953328">)</span>&nbsp;<span class="op" id="3953330">(</span><span class="op" id="3953331">[</span><span class="op" id="3953332">]</span><span class="builtintype" id="3953333">byte</span><span class="op" id="3953337">,</span>&nbsp;<span class="builtintype" id="3953339">error</span><span class="op" id="3953344">)</span>&nbsp;<span class="op" id="3953346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953349">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953374">line</span><span class="op" id="3953378">,</span>&nbsp;<span class="ident" id="3953380">err</span>&nbsp;<span class="op" id="3953384">:=</span>&nbsp;<span class="ident" id="3953387">r</span><span class="op" id="3953388">.</span><span class="ident" id="3953389">readLineSlice</span><span class="op" id="3953402">(</span><span class="op" id="3953403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953406">if</span>&nbsp;<span class="ident" id="3953409">err</span>&nbsp;<span class="op" id="3953413">!=</span>&nbsp;<span class="builtintype" id="3953416">nil</span>&nbsp;<span class="op" id="3953420">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953424">return</span>&nbsp;<span class="builtintype" id="3953431">nil</span><span class="op" id="3953434">,</span>&nbsp;<span class="ident" id="3953436">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3953441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953444">if</span>&nbsp;<span class="builtinfunc" id="3953447">len</span><span class="op" id="3953450">(</span><span class="ident" id="3953451">line</span><span class="op" id="3953455">)</span>&nbsp;<span class="op" id="3953457">==</span>&nbsp;<span class="num" id="3953460">0</span>&nbsp;<span class="op" id="3953462">{</span>&nbsp;<span class="comment" id="3953464">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953498">return</span>&nbsp;<span class="ident" id="3953505">line</span><span class="op" id="3953509">,</span>&nbsp;<span class="builtintype" id="3953511">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3953516">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953520">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953591">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953663">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953735">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953764">if</span>&nbsp;<span class="ident" id="3953767">r</span><span class="op" id="3953768">.</span><span class="ident" id="3953769">R</span><span class="op" id="3953770">.</span><span class="ident" id="3953771">Buffered</span><span class="op" id="3953779">(</span><span class="op" id="3953780">)</span>&nbsp;<span class="op" id="3953782">&gt;</span>&nbsp;<span class="num" id="3953784">1</span>&nbsp;<span class="op" id="3953786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953790">peek</span><span class="op" id="3953794">,</span>&nbsp;<span class="ident" id="3953796">err</span>&nbsp;<span class="op" id="3953800">:=</span>&nbsp;<span class="ident" id="3953803">r</span><span class="op" id="3953804">.</span><span class="ident" id="3953805">R</span><span class="op" id="3953806">.</span><span class="ident" id="3953807">Peek</span><span class="op" id="3953811">(</span><span class="num" id="3953812">1</span><span class="op" id="3953813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953817">if</span>&nbsp;<span class="ident" id="3953820">err</span>&nbsp;<span class="op" id="3953824">==</span>&nbsp;<span class="builtintype" id="3953827">nil</span>&nbsp;<span class="op" id="3953831">&amp;&amp;</span>&nbsp;<span class="ident" id="3953834">isASCIILetter</span><span class="op" id="3953847">(</span><span class="ident" id="3953848">peek</span><span class="op" id="3953852">[</span><span class="num" id="3953853">0</span><span class="op" id="3953854">]</span><span class="op" id="3953855">)</span>&nbsp;<span class="op" id="3953857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3953862">return</span>&nbsp;<span class="ident" id="3953869">trim</span><span class="op" id="3953873">(</span><span class="ident" id="3953874">line</span><span class="op" id="3953878">)</span><span class="op" id="3953879">,</span>&nbsp;<span class="builtintype" id="3953881">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3953887">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3953890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953894">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953961">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3953990">r</span><span class="op" id="3953991">.</span><span class="ident" id="3953992">buf</span>&nbsp;<span class="op" id="3953996">=</span>&nbsp;<span class="builtinfunc" id="3953998">append</span><span class="op" id="3954004">(</span><span class="ident" id="3954005">r</span><span class="op" id="3954006">.</span><span class="ident" id="3954007">buf</span><span class="op" id="3954010">[</span><span class="op" id="3954011">:</span><span class="num" id="3954012">0</span><span class="op" id="3954013">]</span><span class="op" id="3954014">,</span>&nbsp;<span class="ident" id="3954016">trim</span><span class="op" id="3954020">(</span><span class="ident" id="3954021">line</span><span class="op" id="3954025">)</span><span class="op" id="3954026">...</span><span class="op" id="3954029">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3954033">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954062">for</span>&nbsp;<span class="ident" id="3954066">r</span><span class="op" id="3954067">.</span><span class="ident" id="3954068">skipSpace</span><span class="op" id="3954077">(</span><span class="op" id="3954078">)</span>&nbsp;<span class="op" id="3954080">&gt;</span>&nbsp;<span class="num" id="3954082">0</span>&nbsp;<span class="op" id="3954084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954088">line</span><span class="op" id="3954092">,</span>&nbsp;<span class="ident" id="3954094">err</span>&nbsp;<span class="op" id="3954098">:=</span>&nbsp;<span class="ident" id="3954101">r</span><span class="op" id="3954102">.</span><span class="ident" id="3954103">readLineSlice</span><span class="op" id="3954116">(</span><span class="op" id="3954117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954121">if</span>&nbsp;<span class="ident" id="3954124">err</span>&nbsp;<span class="op" id="3954128">!=</span>&nbsp;<span class="builtintype" id="3954131">nil</span>&nbsp;<span class="op" id="3954135">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954140">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954152">r</span><span class="op" id="3954153">.</span><span class="ident" id="3954154">buf</span>&nbsp;<span class="op" id="3954158">=</span>&nbsp;<span class="builtinfunc" id="3954160">append</span><span class="op" id="3954166">(</span><span class="ident" id="3954167">r</span><span class="op" id="3954168">.</span><span class="ident" id="3954169">buf</span><span class="op" id="3954172">,</span>&nbsp;<span class="string" id="3954174">&#39;&nbsp;&#39;</span><span class="op" id="3954177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954181">r</span><span class="op" id="3954182">.</span><span class="ident" id="3954183">buf</span>&nbsp;<span class="op" id="3954187">=</span>&nbsp;<span class="builtinfunc" id="3954189">append</span><span class="op" id="3954195">(</span><span class="ident" id="3954196">r</span><span class="op" id="3954197">.</span><span class="ident" id="3954198">buf</span><span class="op" id="3954201">,</span>&nbsp;<span class="ident" id="3954203">line</span><span class="op" id="3954207">...</span><span class="op" id="3954210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954213">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954216">return</span>&nbsp;<span class="ident" id="3954223">r</span><span class="op" id="3954224">.</span><span class="ident" id="3954225">buf</span><span class="op" id="3954228">,</span>&nbsp;<span class="builtintype" id="3954230">nil</span><br>
<span class="lineno"></span><span class="op" id="3954234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3954237">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3954315">func</span>&nbsp;<span class="op" id="3954320">(</span><span class="ident" id="3954321">r</span>&nbsp;<span class="op" id="3954323">*</span><span class="ident" id="3954324">Reader</span><span class="op" id="3954330">)</span>&nbsp;<span class="ident" id="3954332">skipSpace</span><span class="op" id="3954341">(</span><span class="op" id="3954342">)</span>&nbsp;<span class="builtintype" id="3954344">int</span>&nbsp;<span class="op" id="3954348">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954351">n</span>&nbsp;<span class="op" id="3954353">:=</span>&nbsp;<span class="num" id="3954356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954359">for</span>&nbsp;<span class="op" id="3954363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954367">c</span><span class="op" id="3954368">,</span>&nbsp;<span class="ident" id="3954370">err</span>&nbsp;<span class="op" id="3954374">:=</span>&nbsp;<span class="ident" id="3954377">r</span><span class="op" id="3954378">.</span><span class="ident" id="3954379">R</span><span class="op" id="3954380">.</span><span class="ident" id="3954381">ReadByte</span><span class="op" id="3954389">(</span><span class="op" id="3954390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954394">if</span>&nbsp;<span class="ident" id="3954397">err</span>&nbsp;<span class="op" id="3954401">!=</span>&nbsp;<span class="builtintype" id="3954404">nil</span>&nbsp;<span class="op" id="3954408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3954413">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954456">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954468">if</span>&nbsp;<span class="ident" id="3954471">c</span>&nbsp;<span class="op" id="3954473">!=</span>&nbsp;<span class="string" id="3954476">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3954480">&amp;&amp;</span>&nbsp;<span class="ident" id="3954483">c</span>&nbsp;<span class="op" id="3954485">!=</span>&nbsp;<span class="string" id="3954488">&#39;\t&#39;</span>&nbsp;<span class="op" id="3954493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954498">r</span><span class="op" id="3954499">.</span><span class="ident" id="3954500">R</span><span class="op" id="3954501">.</span><span class="ident" id="3954502">UnreadByte</span><span class="op" id="3954512">(</span><span class="op" id="3954513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954518">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954530">n</span><span class="op" id="3954531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954538">return</span>&nbsp;<span class="ident" id="3954545">n</span><br>
<span class="lineno"></span><span class="op" id="3954547">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3954550">func</span>&nbsp;<span class="op" id="3954555">(</span><span class="ident" id="3954556">r</span>&nbsp;<span class="op" id="3954558">*</span><span class="ident" id="3954559">Reader</span><span class="op" id="3954565">)</span>&nbsp;<span class="ident" id="3954567">readCodeLine</span><span class="op" id="3954579">(</span><span class="ident" id="3954580">expectCode</span>&nbsp;<span class="builtintype" id="3954591">int</span><span class="op" id="3954594">)</span>&nbsp;<span class="op" id="3954596">(</span><span class="ident" id="3954597">code</span>&nbsp;<span class="builtintype" id="3954602">int</span><span class="op" id="3954605">,</span>&nbsp;<span class="ident" id="3954607">continued</span>&nbsp;<span class="builtintype" id="3954617">bool</span><span class="op" id="3954621">,</span>&nbsp;<span class="ident" id="3954623">message</span>&nbsp;<span class="builtintype" id="3954631">string</span><span class="op" id="3954637">,</span>&nbsp;<span class="ident" id="3954639">err</span>&nbsp;<span class="builtintype" id="3954643">error</span><span class="op" id="3954648">)</span>&nbsp;<span class="op" id="3954650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954653">line</span><span class="op" id="3954657">,</span>&nbsp;<span class="ident" id="3954659">err</span>&nbsp;<span class="op" id="3954663">:=</span>&nbsp;<span class="ident" id="3954666">r</span><span class="op" id="3954667">.</span><span class="ident" id="3954668">ReadLine</span><span class="op" id="3954676">(</span><span class="op" id="3954677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954680">if</span>&nbsp;<span class="ident" id="3954683">err</span>&nbsp;<span class="op" id="3954687">!=</span>&nbsp;<span class="builtintype" id="3954690">nil</span>&nbsp;<span class="op" id="3954694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954698">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954709">return</span>&nbsp;<span class="ident" id="3954716">parseCodeLine</span><span class="op" id="3954729">(</span><span class="ident" id="3954730">line</span><span class="op" id="3954734">,</span>&nbsp;<span class="ident" id="3954736">expectCode</span><span class="op" id="3954746">)</span><br>
<span class="lineno"></span><span class="op" id="3954748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3954751">func</span>&nbsp;<span class="ident" id="3954756">parseCodeLine</span><span class="op" id="3954769">(</span><span class="ident" id="3954770">line</span>&nbsp;<span class="builtintype" id="3954775">string</span><span class="op" id="3954781">,</span>&nbsp;<span class="ident" id="3954783">expectCode</span>&nbsp;<span class="builtintype" id="3954794">int</span><span class="op" id="3954797">)</span>&nbsp;<span class="op" id="3954799">(</span><span class="ident" id="3954800">code</span>&nbsp;<span class="builtintype" id="3954805">int</span><span class="op" id="3954808">,</span>&nbsp;<span class="ident" id="3954810">continued</span>&nbsp;<span class="builtintype" id="3954820">bool</span><span class="op" id="3954824">,</span>&nbsp;<span class="ident" id="3954826">message</span>&nbsp;<span class="builtintype" id="3954834">string</span><span class="op" id="3954840">,</span>&nbsp;<span class="ident" id="3954842">err</span>&nbsp;<span class="builtintype" id="3954846">error</span><span class="op" id="3954851">)</span>&nbsp;<span class="op" id="3954853">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954856">if</span>&nbsp;<span class="builtinfunc" id="3954859">len</span><span class="op" id="3954862">(</span><span class="ident" id="3954863">line</span><span class="op" id="3954867">)</span>&nbsp;<span class="op" id="3954869">&lt;</span>&nbsp;<span class="num" id="3954871">4</span>&nbsp;<span class="op" id="3954873">||</span>&nbsp;<span class="ident" id="3954876">line</span><span class="op" id="3954880">[</span><span class="num" id="3954881">3</span><span class="op" id="3954882">]</span>&nbsp;<span class="op" id="3954884">!=</span>&nbsp;<span class="string" id="3954887">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3954891">&amp;&amp;</span>&nbsp;<span class="ident" id="3954894">line</span><span class="op" id="3954898">[</span><span class="num" id="3954899">3</span><span class="op" id="3954900">]</span>&nbsp;<span class="op" id="3954902">!=</span>&nbsp;<span class="string" id="3954905">&#39;-&#39;</span>&nbsp;<span class="op" id="3954909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954913">err</span>&nbsp;<span class="op" id="3954917">=</span>&nbsp;<span class="ident" id="3954919">ProtocolError</span><span class="op" id="3954932">(</span><span class="string" id="3954933">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3954952">+</span>&nbsp;<span class="ident" id="3954954">line</span><span class="op" id="3954958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3954962">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3954970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3954973">continued</span>&nbsp;<span class="op" id="3954983">=</span>&nbsp;<span class="ident" id="3954985">line</span><span class="op" id="3954989">[</span><span class="num" id="3954990">3</span><span class="op" id="3954991">]</span>&nbsp;<span class="op" id="3954993">==</span>&nbsp;<span class="string" id="3954996">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3955001">code</span><span class="op" id="3955005">,</span>&nbsp;<span class="ident" id="3955007">err</span>&nbsp;<span class="op" id="3955011">=</span>&nbsp;<span class="ident" id="3955013">strconv</span><span class="op" id="3955020">.</span><span class="ident" id="3955021">Atoi</span><span class="op" id="3955025">(</span><span class="ident" id="3955026">line</span><span class="op" id="3955030">[</span><span class="num" id="3955031">0</span><span class="op" id="3955032">:</span><span class="num" id="3955033">3</span><span class="op" id="3955034">]</span><span class="op" id="3955035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3955038">if</span>&nbsp;<span class="ident" id="3955041">err</span>&nbsp;<span class="op" id="3955045">!=</span>&nbsp;<span class="builtintype" id="3955048">nil</span>&nbsp;<span class="op" id="3955052">||</span>&nbsp;<span class="ident" id="3955055">code</span>&nbsp;<span class="op" id="3955060">&lt;</span>&nbsp;<span class="num" id="3955062">100</span>&nbsp;<span class="op" id="3955066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3955070">err</span>&nbsp;<span class="op" id="3955074">=</span>&nbsp;<span class="ident" id="3955076">ProtocolError</span><span class="op" id="3955089">(</span><span class="string" id="3955090">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3955116">+</span>&nbsp;<span class="ident" id="3955118">line</span><span class="op" id="3955122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3955126">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3955134">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3955137">message</span>&nbsp;<span class="op" id="3955145">=</span>&nbsp;<span class="ident" id="3955147">line</span><span class="op" id="3955151">[</span><span class="num" id="3955152">4</span><span class="op" id="3955153">:</span><span class="op" id="3955154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3955157">if</span>&nbsp;<span class="num" id="3955160">1</span>&nbsp;<span class="op" id="3955162">&lt;=</span>&nbsp;<span class="ident" id="3955165">expectCode</span>&nbsp;<span class="op" id="3955176">&amp;&amp;</span>&nbsp;<span class="ident" id="3955179">expectCode</span>&nbsp;<span class="op" id="3955190">&lt;</span>&nbsp;<span class="num" id="3955192">10</span>&nbsp;<span class="op" id="3955195">&amp;&amp;</span>&nbsp;<span class="ident" id="3955198">code</span><span class="op" id="3955202">/</span><span class="num" id="3955203">100</span>&nbsp;<span class="op" id="3955207">!=</span>&nbsp;<span class="ident" id="3955210">expectCode</span>&nbsp;<span class="op" id="3955221">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3955226">10</span>&nbsp;<span class="op" id="3955229">&lt;=</span>&nbsp;<span class="ident" id="3955232">expectCode</span>&nbsp;<span class="op" id="3955243">&amp;&amp;</span>&nbsp;<span class="ident" id="3955246">expectCode</span>&nbsp;<span class="op" id="3955257">&lt;</span>&nbsp;<span class="num" id="3955259">100</span>&nbsp;<span class="op" id="3955263">&amp;&amp;</span>&nbsp;<span class="ident" id="3955266">code</span><span class="op" id="3955270">/</span><span class="num" id="3955271">10</span>&nbsp;<span class="op" id="3955274">!=</span>&nbsp;<span class="ident" id="3955277">expectCode</span>&nbsp;<span class="op" id="3955288">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3955293">100</span>&nbsp;<span class="op" id="3955297">&lt;=</span>&nbsp;<span class="ident" id="3955300">expectCode</span>&nbsp;<span class="op" id="3955311">&amp;&amp;</span>&nbsp;<span class="ident" id="3955314">expectCode</span>&nbsp;<span class="op" id="3955325">&lt;</span>&nbsp;<span class="num" id="3955327">1000</span>&nbsp;<span class="op" id="3955332">&amp;&amp;</span>&nbsp;<span class="ident" id="3955335">code</span>&nbsp;<span class="op" id="3955340">!=</span>&nbsp;<span class="ident" id="3955343">expectCode</span>&nbsp;<span class="op" id="3955354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3955358">err</span>&nbsp;<span class="op" id="3955362">=</span>&nbsp;<span class="op" id="3955364">&amp;</span><span class="ident" id="3955365">Error</span><span class="op" id="3955370">{</span><span class="ident" id="3955371">code</span><span class="op" id="3955375">,</span>&nbsp;<span class="ident" id="3955377">message</span><span class="op" id="3955384">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3955387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3955390">return</span><br>
<span class="lineno"></span><span class="op" id="3955397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3955400">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3955455">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3955471">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3955530">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3955597">//&nbsp;&nbsp;&nbsp;&nbsp;220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3955630">//</span><br>
<span class="lineno">210</span><span class="comment" id="3955633">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3955705">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3955768">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3955834">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3955879">//</span><br>
<span class="lineno">215</span><span class="comment" id="3955882">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3955947">//</span><br>
<span class="lineno"></span><span class="comment" id="3955950">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3956011">//</span><br>
<span class="lineno"></span><span class="keyword" id="3956014">func</span>&nbsp;<span class="op" id="3956019">(</span><span class="ident" id="3956020">r</span>&nbsp;<span class="op" id="3956022">*</span><span class="ident" id="3956023">Reader</span><span class="op" id="3956029">)</span>&nbsp;<span class="ident" id="3956031">ReadCodeLine</span><span class="op" id="3956043">(</span><span class="ident" id="3956044">expectCode</span>&nbsp;<span class="builtintype" id="3956055">int</span><span class="op" id="3956058">)</span>&nbsp;<span class="op" id="3956060">(</span><span class="ident" id="3956061">code</span>&nbsp;<span class="builtintype" id="3956066">int</span><span class="op" id="3956069">,</span>&nbsp;<span class="ident" id="3956071">message</span>&nbsp;<span class="builtintype" id="3956079">string</span><span class="op" id="3956085">,</span>&nbsp;<span class="ident" id="3956087">err</span>&nbsp;<span class="builtintype" id="3956091">error</span><span class="op" id="3956096">)</span>&nbsp;<span class="op" id="3956098">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3956101">code</span><span class="op" id="3956105">,</span>&nbsp;<span class="ident" id="3956107">continued</span><span class="op" id="3956116">,</span>&nbsp;<span class="ident" id="3956118">message</span><span class="op" id="3956125">,</span>&nbsp;<span class="ident" id="3956127">err</span>&nbsp;<span class="op" id="3956131">:=</span>&nbsp;<span class="ident" id="3956134">r</span><span class="op" id="3956135">.</span><span class="ident" id="3956136">readCodeLine</span><span class="op" id="3956148">(</span><span class="ident" id="3956149">expectCode</span><span class="op" id="3956159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3956162">if</span>&nbsp;<span class="ident" id="3956165">err</span>&nbsp;<span class="op" id="3956169">==</span>&nbsp;<span class="builtintype" id="3956172">nil</span>&nbsp;<span class="op" id="3956176">&amp;&amp;</span>&nbsp;<span class="ident" id="3956179">continued</span>&nbsp;<span class="op" id="3956189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3956193">err</span>&nbsp;<span class="op" id="3956197">=</span>&nbsp;<span class="ident" id="3956199">ProtocolError</span><span class="op" id="3956212">(</span><span class="string" id="3956213">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3956248">+</span>&nbsp;<span class="ident" id="3956250">message</span><span class="op" id="3956257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3956260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3956263">return</span><br>
<span class="lineno">225</span><span class="op" id="3956270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3956273">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3956330">//</span><br>
<span class="lineno"></span><span class="comment" id="3956333">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3956356">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3956379">//&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="3956386">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3956409">//</span><br>
<span class="lineno"></span><span class="comment" id="3956412">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3956487">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3956558">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3956625">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3956657">//</span><br>
<span class="lineno"></span><span class="comment" id="3956660">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3956727">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3956739">//</span><br>
<span class="lineno"></span><span class="comment" id="3956742">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3956814">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3956877">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3956943">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3956988">//</span><br>
<span class="lineno"></span><span class="comment" id="3956991">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3957052">//</span><br>
<span class="lineno"></span><span class="keyword" id="3957055">func</span>&nbsp;<span class="op" id="3957060">(</span><span class="ident" id="3957061">r</span>&nbsp;<span class="op" id="3957063">*</span><span class="ident" id="3957064">Reader</span><span class="op" id="3957070">)</span>&nbsp;<span class="ident" id="3957072">ReadResponse</span><span class="op" id="3957084">(</span><span class="ident" id="3957085">expectCode</span>&nbsp;<span class="builtintype" id="3957096">int</span><span class="op" id="3957099">)</span>&nbsp;<span class="op" id="3957101">(</span><span class="ident" id="3957102">code</span>&nbsp;<span class="builtintype" id="3957107">int</span><span class="op" id="3957110">,</span>&nbsp;<span class="ident" id="3957112">message</span>&nbsp;<span class="builtintype" id="3957120">string</span><span class="op" id="3957126">,</span>&nbsp;<span class="ident" id="3957128">err</span>&nbsp;<span class="builtintype" id="3957132">error</span><span class="op" id="3957137">)</span>&nbsp;<span class="op" id="3957139">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957142">code</span><span class="op" id="3957146">,</span>&nbsp;<span class="ident" id="3957148">continued</span><span class="op" id="3957157">,</span>&nbsp;<span class="ident" id="3957159">message</span><span class="op" id="3957166">,</span>&nbsp;<span class="ident" id="3957168">err</span>&nbsp;<span class="op" id="3957172">:=</span>&nbsp;<span class="ident" id="3957175">r</span><span class="op" id="3957176">.</span><span class="ident" id="3957177">readCodeLine</span><span class="op" id="3957189">(</span><span class="ident" id="3957190">expectCode</span><span class="op" id="3957200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957203">for</span>&nbsp;<span class="ident" id="3957207">err</span>&nbsp;<span class="op" id="3957211">==</span>&nbsp;<span class="builtintype" id="3957214">nil</span>&nbsp;<span class="op" id="3957218">&amp;&amp;</span>&nbsp;<span class="ident" id="3957221">continued</span>&nbsp;<span class="op" id="3957231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957235">line</span><span class="op" id="3957239">,</span>&nbsp;<span class="ident" id="3957241">err</span>&nbsp;<span class="op" id="3957245">:=</span>&nbsp;<span class="ident" id="3957248">r</span><span class="op" id="3957249">.</span><span class="ident" id="3957250">ReadLine</span><span class="op" id="3957258">(</span><span class="op" id="3957259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957263">if</span>&nbsp;<span class="ident" id="3957266">err</span>&nbsp;<span class="op" id="3957270">!=</span>&nbsp;<span class="builtintype" id="3957273">nil</span>&nbsp;<span class="op" id="3957277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957282">return</span>&nbsp;<span class="num" id="3957289">0</span><span class="op" id="3957290">,</span>&nbsp;<span class="string" id="3957292">&#34;&#34;</span><span class="op" id="3957294">,</span>&nbsp;<span class="ident" id="3957296">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3957302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957307">var</span>&nbsp;<span class="ident" id="3957311">code2</span>&nbsp;<span class="builtintype" id="3957317">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957323">var</span>&nbsp;<span class="ident" id="3957327">moreMessage</span>&nbsp;<span class="builtintype" id="3957339">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957348">code2</span><span class="op" id="3957353">,</span>&nbsp;<span class="ident" id="3957355">continued</span><span class="op" id="3957364">,</span>&nbsp;<span class="ident" id="3957366">moreMessage</span><span class="op" id="3957377">,</span>&nbsp;<span class="ident" id="3957379">err</span>&nbsp;<span class="op" id="3957383">=</span>&nbsp;<span class="ident" id="3957385">parseCodeLine</span><span class="op" id="3957398">(</span><span class="ident" id="3957399">line</span><span class="op" id="3957403">,</span>&nbsp;<span class="ident" id="3957405">expectCode</span><span class="op" id="3957415">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957419">if</span>&nbsp;<span class="ident" id="3957422">err</span>&nbsp;<span class="op" id="3957426">!=</span>&nbsp;<span class="builtintype" id="3957429">nil</span>&nbsp;<span class="op" id="3957433">||</span>&nbsp;<span class="ident" id="3957436">code2</span>&nbsp;<span class="op" id="3957442">!=</span>&nbsp;<span class="ident" id="3957445">code</span>&nbsp;<span class="op" id="3957450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957455">message</span>&nbsp;<span class="op" id="3957463">+=</span>&nbsp;<span class="string" id="3957466">&#34;\n&#34;</span>&nbsp;<span class="op" id="3957471">+</span>&nbsp;<span class="ident" id="3957473">strings</span><span class="op" id="3957480">.</span><span class="ident" id="3957481">TrimRight</span><span class="op" id="3957490">(</span><span class="ident" id="3957491">line</span><span class="op" id="3957495">,</span>&nbsp;<span class="string" id="3957497">&#34;\r\n&#34;</span><span class="op" id="3957503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957508">continued</span>&nbsp;<span class="op" id="3957518">=</span>&nbsp;<span class="builtintype" id="3957520">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957528">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3957539">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3957543">message</span>&nbsp;<span class="op" id="3957551">+=</span>&nbsp;<span class="string" id="3957554">&#34;\n&#34;</span>&nbsp;<span class="op" id="3957559">+</span>&nbsp;<span class="ident" id="3957561">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3957574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3957577">return</span><br>
<span class="lineno"></span><span class="op" id="3957584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3957587">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3957652">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3957704">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3957761">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3957782">//</span><br>
<span class="lineno">275</span><span class="comment" id="3957785">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3957842">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3957910">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3957974">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3958041">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3958099">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3958140">//</span><br>
<span class="lineno"></span><span class="comment" id="3958143">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3958200">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3958259">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3958330">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3958392">func</span>&nbsp;<span class="op" id="3958397">(</span><span class="ident" id="3958398">r</span>&nbsp;<span class="op" id="3958400">*</span><span class="ident" id="3958401">Reader</span><span class="op" id="3958407">)</span>&nbsp;<span class="ident" id="3958409">DotReader</span><span class="op" id="3958418">(</span><span class="op" id="3958419">)</span>&nbsp;<span class="ident" id="3958421">io</span><span class="op" id="3958423">.</span><span class="ident" id="3958424">Reader</span>&nbsp;<span class="op" id="3958431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958434">r</span><span class="op" id="3958435">.</span><span class="ident" id="3958436">closeDot</span><span class="op" id="3958444">(</span><span class="op" id="3958445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958448">r</span><span class="op" id="3958449">.</span><span class="ident" id="3958450">dot</span>&nbsp;<span class="op" id="3958454">=</span>&nbsp;<span class="op" id="3958456">&amp;</span><span class="ident" id="3958457">dotReader</span><span class="op" id="3958466">{</span><span class="ident" id="3958467">r</span><span class="op" id="3958468">:</span>&nbsp;<span class="ident" id="3958470">r</span><span class="op" id="3958471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3958474">return</span>&nbsp;<span class="ident" id="3958481">r</span><span class="op" id="3958482">.</span><span class="ident" id="3958483">dot</span><br>
<span class="lineno">290</span><span class="op" id="3958487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3958490">type</span>&nbsp;<span class="ident" id="3958495">dotReader</span>&nbsp;<span class="keyword" id="3958505">struct</span>&nbsp;<span class="op" id="3958512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958515">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3958521">*</span><span class="ident" id="3958522">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958530">state</span>&nbsp;<span class="builtintype" id="3958536">int</span><br>
<span class="lineno">295</span><span class="op" id="3958540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3958543">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3958611">func</span>&nbsp;<span class="op" id="3958616">(</span><span class="ident" id="3958617">d</span>&nbsp;<span class="op" id="3958619">*</span><span class="ident" id="3958620">dotReader</span><span class="op" id="3958629">)</span>&nbsp;<span class="ident" id="3958631">Read</span><span class="op" id="3958635">(</span><span class="ident" id="3958636">b</span>&nbsp;<span class="op" id="3958638">[</span><span class="op" id="3958639">]</span><span class="builtintype" id="3958640">byte</span><span class="op" id="3958644">)</span>&nbsp;<span class="op" id="3958646">(</span><span class="ident" id="3958647">n</span>&nbsp;<span class="builtintype" id="3958649">int</span><span class="op" id="3958652">,</span>&nbsp;<span class="ident" id="3958654">err</span>&nbsp;<span class="builtintype" id="3958658">error</span><span class="op" id="3958663">)</span>&nbsp;<span class="op" id="3958665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3958668">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3958715">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3958770">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3958804">const</span>&nbsp;<span class="op" id="3958810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958814">stateBeginLine</span>&nbsp;<span class="op" id="3958829">=</span>&nbsp;<span class="ident" id="3958831">iota</span>&nbsp;<span class="comment" id="3958836">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958888">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3958910">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3958943">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3958965">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959000">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959022">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959061">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959083">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959119">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959141">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959175">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959178">br</span>&nbsp;<span class="op" id="3959181">:=</span>&nbsp;<span class="ident" id="3959184">d</span><span class="op" id="3959185">.</span><span class="ident" id="3959186">r</span><span class="op" id="3959187">.</span><span class="ident" id="3959188">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959191">for</span>&nbsp;<span class="ident" id="3959195">n</span>&nbsp;<span class="op" id="3959197">&lt;</span>&nbsp;<span class="builtinfunc" id="3959199">len</span><span class="op" id="3959202">(</span><span class="ident" id="3959203">b</span><span class="op" id="3959204">)</span>&nbsp;<span class="op" id="3959206">&amp;&amp;</span>&nbsp;<span class="ident" id="3959209">d</span><span class="op" id="3959210">.</span><span class="ident" id="3959211">state</span>&nbsp;<span class="op" id="3959217">!=</span>&nbsp;<span class="ident" id="3959220">stateEOF</span>&nbsp;<span class="op" id="3959229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959233">var</span>&nbsp;<span class="ident" id="3959237">c</span>&nbsp;<span class="builtintype" id="3959239">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959246">c</span><span class="op" id="3959247">,</span>&nbsp;<span class="ident" id="3959249">err</span>&nbsp;<span class="op" id="3959253">=</span>&nbsp;<span class="ident" id="3959255">br</span><span class="op" id="3959257">.</span><span class="ident" id="3959258">ReadByte</span><span class="op" id="3959266">(</span><span class="op" id="3959267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959271">if</span>&nbsp;<span class="ident" id="3959274">err</span>&nbsp;<span class="op" id="3959278">!=</span>&nbsp;<span class="builtintype" id="3959281">nil</span>&nbsp;<span class="op" id="3959285">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959290">if</span>&nbsp;<span class="ident" id="3959293">err</span>&nbsp;<span class="op" id="3959297">==</span>&nbsp;<span class="ident" id="3959300">io</span><span class="op" id="3959302">.</span><span class="ident" id="3959303">EOF</span>&nbsp;<span class="op" id="3959307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959313">err</span>&nbsp;<span class="op" id="3959317">=</span>&nbsp;<span class="ident" id="3959319">io</span><span class="op" id="3959321">.</span><span class="ident" id="3959322">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959347">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959355">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959359">switch</span>&nbsp;<span class="ident" id="3959366">d</span><span class="op" id="3959367">.</span><span class="ident" id="3959368">state</span>&nbsp;<span class="op" id="3959374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959378">case</span>&nbsp;<span class="ident" id="3959383">stateBeginLine</span><span class="op" id="3959397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959402">if</span>&nbsp;<span class="ident" id="3959405">c</span>&nbsp;<span class="op" id="3959407">==</span>&nbsp;<span class="string" id="3959410">&#39;.&#39;</span>&nbsp;<span class="op" id="3959414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959420">d</span><span class="op" id="3959421">.</span><span class="ident" id="3959422">state</span>&nbsp;<span class="op" id="3959428">=</span>&nbsp;<span class="ident" id="3959430">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959443">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959460">if</span>&nbsp;<span class="ident" id="3959463">c</span>&nbsp;<span class="op" id="3959465">==</span>&nbsp;<span class="string" id="3959468">&#39;\r&#39;</span>&nbsp;<span class="op" id="3959473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959479">d</span><span class="op" id="3959480">.</span><span class="ident" id="3959481">state</span>&nbsp;<span class="op" id="3959487">=</span>&nbsp;<span class="ident" id="3959489">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959501">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959513">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959518">d</span><span class="op" id="3959519">.</span><span class="ident" id="3959520">state</span>&nbsp;<span class="op" id="3959526">=</span>&nbsp;<span class="ident" id="3959528">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959541">case</span>&nbsp;<span class="ident" id="3959546">stateDot</span><span class="op" id="3959554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959559">if</span>&nbsp;<span class="ident" id="3959562">c</span>&nbsp;<span class="op" id="3959564">==</span>&nbsp;<span class="string" id="3959567">&#39;\r&#39;</span>&nbsp;<span class="op" id="3959572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959578">d</span><span class="op" id="3959579">.</span><span class="ident" id="3959580">state</span>&nbsp;<span class="op" id="3959586">=</span>&nbsp;<span class="ident" id="3959588">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959603">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959620">if</span>&nbsp;<span class="ident" id="3959623">c</span>&nbsp;<span class="op" id="3959625">==</span>&nbsp;<span class="string" id="3959628">&#39;\n&#39;</span>&nbsp;<span class="op" id="3959633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959639">d</span><span class="op" id="3959640">.</span><span class="ident" id="3959641">state</span>&nbsp;<span class="op" id="3959647">=</span>&nbsp;<span class="ident" id="3959649">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959662">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959679">d</span><span class="op" id="3959680">.</span><span class="ident" id="3959681">state</span>&nbsp;<span class="op" id="3959687">=</span>&nbsp;<span class="ident" id="3959689">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959702">case</span>&nbsp;<span class="ident" id="3959707">stateDotCR</span><span class="op" id="3959717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959722">if</span>&nbsp;<span class="ident" id="3959725">c</span>&nbsp;<span class="op" id="3959727">==</span>&nbsp;<span class="string" id="3959730">&#39;\n&#39;</span>&nbsp;<span class="op" id="3959735">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959741">d</span><span class="op" id="3959742">.</span><span class="ident" id="3959743">state</span>&nbsp;<span class="op" id="3959749">=</span>&nbsp;<span class="ident" id="3959751">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959764">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959781">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959806">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959851">br</span><span class="op" id="3959853">.</span><span class="ident" id="3959854">UnreadByte</span><span class="op" id="3959864">(</span><span class="op" id="3959865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959870">c</span>&nbsp;<span class="op" id="3959872">=</span>&nbsp;<span class="string" id="3959874">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959882">d</span><span class="op" id="3959883">.</span><span class="ident" id="3959884">state</span>&nbsp;<span class="op" id="3959890">=</span>&nbsp;<span class="ident" id="3959892">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959905">case</span>&nbsp;<span class="ident" id="3959910">stateCR</span><span class="op" id="3959917">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959922">if</span>&nbsp;<span class="ident" id="3959925">c</span>&nbsp;<span class="op" id="3959927">==</span>&nbsp;<span class="string" id="3959930">&#39;\n&#39;</span>&nbsp;<span class="op" id="3959935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3959941">d</span><span class="op" id="3959942">.</span><span class="ident" id="3959943">state</span>&nbsp;<span class="op" id="3959949">=</span>&nbsp;<span class="ident" id="3959951">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3959970">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3959979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3959984">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960023">br</span><span class="op" id="3960025">.</span><span class="ident" id="3960026">UnreadByte</span><span class="op" id="3960036">(</span><span class="op" id="3960037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960042">c</span>&nbsp;<span class="op" id="3960044">=</span>&nbsp;<span class="string" id="3960046">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960054">d</span><span class="op" id="3960055">.</span><span class="ident" id="3960056">state</span>&nbsp;<span class="op" id="3960062">=</span>&nbsp;<span class="ident" id="3960064">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960077">case</span>&nbsp;<span class="ident" id="3960082">stateData</span><span class="op" id="3960091">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960096">if</span>&nbsp;<span class="ident" id="3960099">c</span>&nbsp;<span class="op" id="3960101">==</span>&nbsp;<span class="string" id="3960104">&#39;\r&#39;</span>&nbsp;<span class="op" id="3960109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960115">d</span><span class="op" id="3960116">.</span><span class="ident" id="3960117">state</span>&nbsp;<span class="op" id="3960123">=</span>&nbsp;<span class="ident" id="3960125">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960137">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960154">if</span>&nbsp;<span class="ident" id="3960157">c</span>&nbsp;<span class="op" id="3960159">==</span>&nbsp;<span class="string" id="3960162">&#39;\n&#39;</span>&nbsp;<span class="op" id="3960167">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960173">d</span><span class="op" id="3960174">.</span><span class="ident" id="3960175">state</span>&nbsp;<span class="op" id="3960181">=</span>&nbsp;<span class="ident" id="3960183">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960209">b</span><span class="op" id="3960210">[</span><span class="ident" id="3960211">n</span><span class="op" id="3960212">]</span>&nbsp;<span class="op" id="3960214">=</span>&nbsp;<span class="ident" id="3960216">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960220">n</span><span class="op" id="3960221">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960228">if</span>&nbsp;<span class="ident" id="3960231">err</span>&nbsp;<span class="op" id="3960235">==</span>&nbsp;<span class="builtintype" id="3960238">nil</span>&nbsp;<span class="op" id="3960242">&amp;&amp;</span>&nbsp;<span class="ident" id="3960245">d</span><span class="op" id="3960246">.</span><span class="ident" id="3960247">state</span>&nbsp;<span class="op" id="3960253">==</span>&nbsp;<span class="ident" id="3960256">stateEOF</span>&nbsp;<span class="op" id="3960265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960269">err</span>&nbsp;<span class="op" id="3960273">=</span>&nbsp;<span class="ident" id="3960275">io</span><span class="op" id="3960277">.</span><span class="ident" id="3960278">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960286">if</span>&nbsp;<span class="ident" id="3960289">err</span>&nbsp;<span class="op" id="3960293">!=</span>&nbsp;<span class="builtintype" id="3960296">nil</span>&nbsp;<span class="op" id="3960300">&amp;&amp;</span>&nbsp;<span class="ident" id="3960303">d</span><span class="op" id="3960304">.</span><span class="ident" id="3960305">r</span><span class="op" id="3960306">.</span><span class="ident" id="3960307">dot</span>&nbsp;<span class="op" id="3960311">==</span>&nbsp;<span class="ident" id="3960314">d</span>&nbsp;<span class="op" id="3960316">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960320">d</span><span class="op" id="3960321">.</span><span class="ident" id="3960322">r</span><span class="op" id="3960323">.</span><span class="ident" id="3960324">dot</span>&nbsp;<span class="op" id="3960328">=</span>&nbsp;<span class="builtintype" id="3960330">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960338">return</span><br>
<span class="lineno"></span><span class="op" id="3960345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3960348">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3960397">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3960453">func</span>&nbsp;<span class="op" id="3960458">(</span><span class="ident" id="3960459">r</span>&nbsp;<span class="op" id="3960461">*</span><span class="ident" id="3960462">Reader</span><span class="op" id="3960468">)</span>&nbsp;<span class="ident" id="3960470">closeDot</span><span class="op" id="3960478">(</span><span class="op" id="3960479">)</span>&nbsp;<span class="op" id="3960481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960484">if</span>&nbsp;<span class="ident" id="3960487">r</span><span class="op" id="3960488">.</span><span class="ident" id="3960489">dot</span>&nbsp;<span class="op" id="3960493">==</span>&nbsp;<span class="builtintype" id="3960496">nil</span>&nbsp;<span class="op" id="3960500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960504">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960515">buf</span>&nbsp;<span class="op" id="3960519">:=</span>&nbsp;<span class="builtinfunc" id="3960522">make</span><span class="op" id="3960526">(</span><span class="op" id="3960527">[</span><span class="op" id="3960528">]</span><span class="builtintype" id="3960529">byte</span><span class="op" id="3960533">,</span>&nbsp;<span class="num" id="3960535">128</span><span class="op" id="3960538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960541">for</span>&nbsp;<span class="ident" id="3960545">r</span><span class="op" id="3960546">.</span><span class="ident" id="3960547">dot</span>&nbsp;<span class="op" id="3960551">!=</span>&nbsp;<span class="builtintype" id="3960554">nil</span>&nbsp;<span class="op" id="3960558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3960562">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3960602">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3960633">r</span><span class="op" id="3960634">.</span><span class="ident" id="3960635">dot</span><span class="op" id="3960638">.</span><span class="ident" id="3960639">Read</span><span class="op" id="3960643">(</span><span class="ident" id="3960644">buf</span><span class="op" id="3960647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3960650">}</span><br>
<span class="lineno"></span><span class="op" id="3960652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3960655">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3960722">//</span><br>
<span class="lineno"></span><span class="comment" id="3960725">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3960807">func</span>&nbsp;<span class="op" id="3960812">(</span><span class="ident" id="3960813">r</span>&nbsp;<span class="op" id="3960815">*</span><span class="ident" id="3960816">Reader</span><span class="op" id="3960822">)</span>&nbsp;<span class="ident" id="3960824">ReadDotBytes</span><span class="op" id="3960836">(</span><span class="op" id="3960837">)</span>&nbsp;<span class="op" id="3960839">(</span><span class="op" id="3960840">[</span><span class="op" id="3960841">]</span><span class="builtintype" id="3960842">byte</span><span class="op" id="3960846">,</span>&nbsp;<span class="builtintype" id="3960848">error</span><span class="op" id="3960853">)</span>&nbsp;<span class="op" id="3960855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3960858">return</span>&nbsp;<span class="ident" id="3960865">ioutil</span><span class="op" id="3960871">.</span><span class="ident" id="3960872">ReadAll</span><span class="op" id="3960879">(</span><span class="ident" id="3960880">r</span><span class="op" id="3960881">.</span><span class="ident" id="3960882">DotReader</span><span class="op" id="3960891">(</span><span class="op" id="3960892">)</span><span class="op" id="3960893">)</span><br>
<span class="lineno"></span><span class="op" id="3960895">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3960898">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3960955">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3961032">//</span><br>
<span class="lineno"></span><span class="comment" id="3961035">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3961117">func</span>&nbsp;<span class="op" id="3961122">(</span><span class="ident" id="3961123">r</span>&nbsp;<span class="op" id="3961125">*</span><span class="ident" id="3961126">Reader</span><span class="op" id="3961132">)</span>&nbsp;<span class="ident" id="3961134">ReadDotLines</span><span class="op" id="3961146">(</span><span class="op" id="3961147">)</span>&nbsp;<span class="op" id="3961149">(</span><span class="op" id="3961150">[</span><span class="op" id="3961151">]</span><span class="builtintype" id="3961152">string</span><span class="op" id="3961158">,</span>&nbsp;<span class="builtintype" id="3961160">error</span><span class="op" id="3961165">)</span>&nbsp;<span class="op" id="3961167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3961170">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3961219">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3961269">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961322">var</span>&nbsp;<span class="ident" id="3961326">v</span>&nbsp;<span class="op" id="3961328">[</span><span class="op" id="3961329">]</span><span class="builtintype" id="3961330">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961338">var</span>&nbsp;<span class="ident" id="3961342">err</span>&nbsp;<span class="builtintype" id="3961346">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961353">for</span>&nbsp;<span class="op" id="3961357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961361">var</span>&nbsp;<span class="ident" id="3961365">line</span>&nbsp;<span class="builtintype" id="3961370">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3961379">line</span><span class="op" id="3961383">,</span>&nbsp;<span class="ident" id="3961385">err</span>&nbsp;<span class="op" id="3961389">=</span>&nbsp;<span class="ident" id="3961391">r</span><span class="op" id="3961392">.</span><span class="ident" id="3961393">ReadLine</span><span class="op" id="3961401">(</span><span class="op" id="3961402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961406">if</span>&nbsp;<span class="ident" id="3961409">err</span>&nbsp;<span class="op" id="3961413">!=</span>&nbsp;<span class="builtintype" id="3961416">nil</span>&nbsp;<span class="op" id="3961420">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961425">if</span>&nbsp;<span class="ident" id="3961428">err</span>&nbsp;<span class="op" id="3961432">==</span>&nbsp;<span class="ident" id="3961435">io</span><span class="op" id="3961437">.</span><span class="ident" id="3961438">EOF</span>&nbsp;<span class="op" id="3961442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3961448">err</span>&nbsp;<span class="op" id="3961452">=</span>&nbsp;<span class="ident" id="3961454">io</span><span class="op" id="3961456">.</span><span class="ident" id="3961457">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3961477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3961490">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3961495">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961548">if</span>&nbsp;<span class="builtinfunc" id="3961551">len</span><span class="op" id="3961554">(</span><span class="ident" id="3961555">line</span><span class="op" id="3961559">)</span>&nbsp;<span class="op" id="3961561">&gt;</span>&nbsp;<span class="num" id="3961563">0</span>&nbsp;<span class="op" id="3961565">&amp;&amp;</span>&nbsp;<span class="ident" id="3961568">line</span><span class="op" id="3961572">[</span><span class="num" id="3961573">0</span><span class="op" id="3961574">]</span>&nbsp;<span class="op" id="3961576">==</span>&nbsp;<span class="string" id="3961579">&#39;.&#39;</span>&nbsp;<span class="op" id="3961583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961588">if</span>&nbsp;<span class="builtinfunc" id="3961591">len</span><span class="op" id="3961594">(</span><span class="ident" id="3961595">line</span><span class="op" id="3961599">)</span>&nbsp;<span class="op" id="3961601">==</span>&nbsp;<span class="num" id="3961604">1</span>&nbsp;<span class="op" id="3961606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961612">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3961621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3961626">line</span>&nbsp;<span class="op" id="3961631">=</span>&nbsp;<span class="ident" id="3961633">line</span><span class="op" id="3961637">[</span><span class="num" id="3961638">1</span><span class="op" id="3961639">:</span><span class="op" id="3961640">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3961644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3961648">v</span>&nbsp;<span class="op" id="3961650">=</span>&nbsp;<span class="builtinfunc" id="3961652">append</span><span class="op" id="3961658">(</span><span class="ident" id="3961659">v</span><span class="op" id="3961660">,</span>&nbsp;<span class="ident" id="3961662">line</span><span class="op" id="3961666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3961669">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3961672">return</span>&nbsp;<span class="ident" id="3961679">v</span><span class="op" id="3961680">,</span>&nbsp;<span class="ident" id="3961682">err</span><br>
<span class="lineno"></span><span class="op" id="3961686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3961689">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3961741">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3961808">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3961835">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3961895">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3961961">//</span><br>
<span class="lineno"></span><span class="comment" id="3961964">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3962001">//</span><br>
<span class="lineno"></span><span class="comment" id="3962004">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3962023">//&nbsp;&nbsp;&nbsp;&nbsp;Long-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3962041">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3962064">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3962083">//</span><br>
<span class="lineno"></span><span class="comment" id="3962086">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3962139">//</span><br>
<span class="lineno"></span><span class="comment" id="3962142">//&nbsp;&nbsp;&nbsp;&nbsp;map[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3962166">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3962204">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3962243">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3962248">//</span><br>
<span class="lineno"></span><span class="keyword" id="3962251">func</span>&nbsp;<span class="op" id="3962256">(</span><span class="ident" id="3962257">r</span>&nbsp;<span class="op" id="3962259">*</span><span class="ident" id="3962260">Reader</span><span class="op" id="3962266">)</span>&nbsp;<span class="ident" id="3962268">ReadMIMEHeader</span><span class="op" id="3962282">(</span><span class="op" id="3962283">)</span>&nbsp;<span class="op" id="3962285">(</span><span class="ident" id="3962286">MIMEHeader</span><span class="op" id="3962296">,</span>&nbsp;<span class="builtintype" id="3962298">error</span><span class="op" id="3962303">)</span>&nbsp;<span class="op" id="3962305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962308">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962374">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962434">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962502">var</span>&nbsp;<span class="ident" id="3962506">strs</span>&nbsp;<span class="op" id="3962511">[</span><span class="op" id="3962512">]</span><span class="builtintype" id="3962513">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962521">hint</span>&nbsp;<span class="op" id="3962526">:=</span>&nbsp;<span class="ident" id="3962529">r</span><span class="op" id="3962530">.</span><span class="ident" id="3962531">upcomingHeaderNewlines</span><span class="op" id="3962553">(</span><span class="op" id="3962554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962557">if</span>&nbsp;<span class="ident" id="3962560">hint</span>&nbsp;<span class="op" id="3962565">&gt;</span>&nbsp;<span class="num" id="3962567">0</span>&nbsp;<span class="op" id="3962569">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962573">strs</span>&nbsp;<span class="op" id="3962578">=</span>&nbsp;<span class="builtinfunc" id="3962580">make</span><span class="op" id="3962584">(</span><span class="op" id="3962585">[</span><span class="op" id="3962586">]</span><span class="builtintype" id="3962587">string</span><span class="op" id="3962593">,</span>&nbsp;<span class="ident" id="3962595">hint</span><span class="op" id="3962599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3962602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962606">m</span>&nbsp;<span class="op" id="3962608">:=</span>&nbsp;<span class="builtinfunc" id="3962611">make</span><span class="op" id="3962615">(</span><span class="ident" id="3962616">MIMEHeader</span><span class="op" id="3962626">,</span>&nbsp;<span class="ident" id="3962628">hint</span><span class="op" id="3962632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962635">for</span>&nbsp;<span class="op" id="3962639">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962643">kv</span><span class="op" id="3962645">,</span>&nbsp;<span class="ident" id="3962647">err</span>&nbsp;<span class="op" id="3962651">:=</span>&nbsp;<span class="ident" id="3962654">r</span><span class="op" id="3962655">.</span><span class="ident" id="3962656">readContinuedLineSlice</span><span class="op" id="3962678">(</span><span class="op" id="3962679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962683">if</span>&nbsp;<span class="builtinfunc" id="3962686">len</span><span class="op" id="3962689">(</span><span class="ident" id="3962690">kv</span><span class="op" id="3962692">)</span>&nbsp;<span class="op" id="3962694">==</span>&nbsp;<span class="num" id="3962697">0</span>&nbsp;<span class="op" id="3962699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962704">return</span>&nbsp;<span class="ident" id="3962711">m</span><span class="op" id="3962712">,</span>&nbsp;<span class="ident" id="3962714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3962720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962725">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962782">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3962835">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962864">i</span>&nbsp;<span class="op" id="3962866">:=</span>&nbsp;<span class="ident" id="3962869">bytes</span><span class="op" id="3962874">.</span><span class="ident" id="3962875">IndexByte</span><span class="op" id="3962884">(</span><span class="ident" id="3962885">kv</span><span class="op" id="3962887">,</span>&nbsp;<span class="string" id="3962889">&#39;:&#39;</span><span class="op" id="3962892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962896">if</span>&nbsp;<span class="ident" id="3962899">i</span>&nbsp;<span class="op" id="3962901">&lt;</span>&nbsp;<span class="num" id="3962903">0</span>&nbsp;<span class="op" id="3962905">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962910">return</span>&nbsp;<span class="ident" id="3962917">m</span><span class="op" id="3962918">,</span>&nbsp;<span class="ident" id="3962920">ProtocolError</span><span class="op" id="3962933">(</span><span class="string" id="3962934">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3962965">+</span>&nbsp;<span class="builtintype" id="3962967">string</span><span class="op" id="3962973">(</span><span class="ident" id="3962974">kv</span><span class="op" id="3962976">)</span><span class="op" id="3962977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3962981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3962985">endKey</span>&nbsp;<span class="op" id="3962992">:=</span>&nbsp;<span class="ident" id="3962995">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3962999">for</span>&nbsp;<span class="ident" id="3963003">endKey</span>&nbsp;<span class="op" id="3963010">&gt;</span>&nbsp;<span class="num" id="3963012">0</span>&nbsp;<span class="op" id="3963014">&amp;&amp;</span>&nbsp;<span class="ident" id="3963017">kv</span><span class="op" id="3963019">[</span><span class="ident" id="3963020">endKey</span><span class="op" id="3963026">-</span><span class="num" id="3963027">1</span><span class="op" id="3963028">]</span>&nbsp;<span class="op" id="3963030">==</span>&nbsp;<span class="string" id="3963033">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3963037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963042">endKey</span><span class="op" id="3963048">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963057">key</span>&nbsp;<span class="op" id="3963061">:=</span>&nbsp;<span class="ident" id="3963064">canonicalMIMEHeaderKey</span><span class="op" id="3963086">(</span><span class="ident" id="3963087">kv</span><span class="op" id="3963089">[</span><span class="op" id="3963090">:</span><span class="ident" id="3963091">endKey</span><span class="op" id="3963097">]</span><span class="op" id="3963098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963103">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963138">i</span><span class="op" id="3963139">++</span>&nbsp;<span class="comment" id="3963142">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963158">for</span>&nbsp;<span class="ident" id="3963162">i</span>&nbsp;<span class="op" id="3963164">&lt;</span>&nbsp;<span class="builtinfunc" id="3963166">len</span><span class="op" id="3963169">(</span><span class="ident" id="3963170">kv</span><span class="op" id="3963172">)</span>&nbsp;<span class="op" id="3963174">&amp;&amp;</span>&nbsp;<span class="op" id="3963177">(</span><span class="ident" id="3963178">kv</span><span class="op" id="3963180">[</span><span class="ident" id="3963181">i</span><span class="op" id="3963182">]</span>&nbsp;<span class="op" id="3963184">==</span>&nbsp;<span class="string" id="3963187">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3963191">||</span>&nbsp;<span class="ident" id="3963194">kv</span><span class="op" id="3963196">[</span><span class="ident" id="3963197">i</span><span class="op" id="3963198">]</span>&nbsp;<span class="op" id="3963200">==</span>&nbsp;<span class="string" id="3963203">&#39;\t&#39;</span><span class="op" id="3963207">)</span>&nbsp;<span class="op" id="3963209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963214">i</span><span class="op" id="3963215">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963224">value</span>&nbsp;<span class="op" id="3963230">:=</span>&nbsp;<span class="builtintype" id="3963233">string</span><span class="op" id="3963239">(</span><span class="ident" id="3963240">kv</span><span class="op" id="3963242">[</span><span class="ident" id="3963243">i</span><span class="op" id="3963244">:</span><span class="op" id="3963245">]</span><span class="op" id="3963246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963251">vv</span>&nbsp;<span class="op" id="3963254">:=</span>&nbsp;<span class="ident" id="3963257">m</span><span class="op" id="3963258">[</span><span class="ident" id="3963259">key</span><span class="op" id="3963262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963266">if</span>&nbsp;<span class="ident" id="3963269">vv</span>&nbsp;<span class="op" id="3963272">==</span>&nbsp;<span class="builtintype" id="3963275">nil</span>&nbsp;<span class="op" id="3963279">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3963282">len</span><span class="op" id="3963285">(</span><span class="ident" id="3963286">strs</span><span class="op" id="3963290">)</span>&nbsp;<span class="op" id="3963292">&gt;</span>&nbsp;<span class="num" id="3963294">0</span>&nbsp;<span class="op" id="3963296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963301">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963359">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963399">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963460">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963513">vv</span><span class="op" id="3963515">,</span>&nbsp;<span class="ident" id="3963517">strs</span>&nbsp;<span class="op" id="3963522">=</span>&nbsp;<span class="ident" id="3963524">strs</span><span class="op" id="3963528">[</span><span class="op" id="3963529">:</span><span class="num" id="3963530">1</span><span class="op" id="3963531">:</span><span class="num" id="3963532">1</span><span class="op" id="3963533">]</span><span class="op" id="3963534">,</span>&nbsp;<span class="ident" id="3963536">strs</span><span class="op" id="3963540">[</span><span class="num" id="3963541">1</span><span class="op" id="3963542">:</span><span class="op" id="3963543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963548">vv</span><span class="op" id="3963550">[</span><span class="num" id="3963551">0</span><span class="op" id="3963552">]</span>&nbsp;<span class="op" id="3963554">=</span>&nbsp;<span class="ident" id="3963556">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963565">m</span><span class="op" id="3963566">[</span><span class="ident" id="3963567">key</span><span class="op" id="3963570">]</span>&nbsp;<span class="op" id="3963572">=</span>&nbsp;<span class="ident" id="3963574">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963579">}</span>&nbsp;<span class="keyword" id="3963581">else</span>&nbsp;<span class="op" id="3963586">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963591">m</span><span class="op" id="3963592">[</span><span class="ident" id="3963593">key</span><span class="op" id="3963596">]</span>&nbsp;<span class="op" id="3963598">=</span>&nbsp;<span class="builtinfunc" id="3963600">append</span><span class="op" id="3963606">(</span><span class="ident" id="3963607">vv</span><span class="op" id="3963609">,</span>&nbsp;<span class="ident" id="3963611">value</span><span class="op" id="3963616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963625">if</span>&nbsp;<span class="ident" id="3963628">err</span>&nbsp;<span class="op" id="3963632">!=</span>&nbsp;<span class="builtintype" id="3963635">nil</span>&nbsp;<span class="op" id="3963639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963644">return</span>&nbsp;<span class="ident" id="3963651">m</span><span class="op" id="3963652">,</span>&nbsp;<span class="ident" id="3963654">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963663">}</span><br>
<span class="lineno"></span><span class="op" id="3963665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3963668">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3963745">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3963812">func</span>&nbsp;<span class="op" id="3963817">(</span><span class="ident" id="3963818">r</span>&nbsp;<span class="op" id="3963820">*</span><span class="ident" id="3963821">Reader</span><span class="op" id="3963827">)</span>&nbsp;<span class="ident" id="3963829">upcomingHeaderNewlines</span><span class="op" id="3963851">(</span><span class="op" id="3963852">)</span>&nbsp;<span class="op" id="3963854">(</span><span class="ident" id="3963855">n</span>&nbsp;<span class="builtintype" id="3963857">int</span><span class="op" id="3963860">)</span>&nbsp;<span class="op" id="3963862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3963865">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963903">r</span><span class="op" id="3963904">.</span><span class="ident" id="3963905">R</span><span class="op" id="3963906">.</span><span class="ident" id="3963907">Peek</span><span class="op" id="3963911">(</span><span class="num" id="3963912">1</span><span class="op" id="3963913">)</span>&nbsp;<span class="comment" id="3963915">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963948">s</span>&nbsp;<span class="op" id="3963950">:=</span>&nbsp;<span class="ident" id="3963953">r</span><span class="op" id="3963954">.</span><span class="ident" id="3963955">R</span><span class="op" id="3963956">.</span><span class="ident" id="3963957">Buffered</span><span class="op" id="3963965">(</span><span class="op" id="3963966">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963969">if</span>&nbsp;<span class="ident" id="3963972">s</span>&nbsp;<span class="op" id="3963974">==</span>&nbsp;<span class="num" id="3963977">0</span>&nbsp;<span class="op" id="3963979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3963983">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3963991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3963994">peek</span><span class="op" id="3963998">,</span>&nbsp;<span class="ident" id="3964000">_</span>&nbsp;<span class="op" id="3964002">:=</span>&nbsp;<span class="ident" id="3964005">r</span><span class="op" id="3964006">.</span><span class="ident" id="3964007">R</span><span class="op" id="3964008">.</span><span class="ident" id="3964009">Peek</span><span class="op" id="3964013">(</span><span class="ident" id="3964014">s</span><span class="op" id="3964015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964018">for</span>&nbsp;<span class="builtinfunc" id="3964022">len</span><span class="op" id="3964025">(</span><span class="ident" id="3964026">peek</span><span class="op" id="3964030">)</span>&nbsp;<span class="op" id="3964032">&gt;</span>&nbsp;<span class="num" id="3964034">0</span>&nbsp;<span class="op" id="3964036">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964040">i</span>&nbsp;<span class="op" id="3964042">:=</span>&nbsp;<span class="ident" id="3964045">bytes</span><span class="op" id="3964050">.</span><span class="ident" id="3964051">IndexByte</span><span class="op" id="3964060">(</span><span class="ident" id="3964061">peek</span><span class="op" id="3964065">,</span>&nbsp;<span class="string" id="3964067">&#39;\n&#39;</span><span class="op" id="3964071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964075">if</span>&nbsp;<span class="ident" id="3964078">i</span>&nbsp;<span class="op" id="3964080">&lt;</span>&nbsp;<span class="num" id="3964082">3</span>&nbsp;<span class="op" id="3964084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3964089">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3964148">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964203">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3964212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964216">n</span><span class="op" id="3964217">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964222">peek</span>&nbsp;<span class="op" id="3964227">=</span>&nbsp;<span class="ident" id="3964229">peek</span><span class="op" id="3964233">[</span><span class="ident" id="3964234">i</span><span class="op" id="3964235">+</span><span class="num" id="3964236">1</span><span class="op" id="3964237">:</span><span class="op" id="3964238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3964241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964244">return</span><br>
<span class="lineno">535</span><span class="op" id="3964251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3964254">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3964316">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3964379">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3964438">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3964496">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3964557">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3964607">func</span>&nbsp;<span class="ident" id="3964612">CanonicalMIMEHeaderKey</span><span class="op" id="3964634">(</span><span class="ident" id="3964635">s</span>&nbsp;<span class="builtintype" id="3964637">string</span><span class="op" id="3964643">)</span>&nbsp;<span class="builtintype" id="3964645">string</span>&nbsp;<span class="op" id="3964652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3964655">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964695">upper</span>&nbsp;<span class="op" id="3964701">:=</span>&nbsp;<span class="builtintype" id="3964704">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964710">for</span>&nbsp;<span class="ident" id="3964714">i</span>&nbsp;<span class="op" id="3964716">:=</span>&nbsp;<span class="num" id="3964719">0</span><span class="op" id="3964720">;</span>&nbsp;<span class="ident" id="3964722">i</span>&nbsp;<span class="op" id="3964724">&lt;</span>&nbsp;<span class="builtinfunc" id="3964726">len</span><span class="op" id="3964729">(</span><span class="ident" id="3964730">s</span><span class="op" id="3964731">)</span><span class="op" id="3964732">;</span>&nbsp;<span class="ident" id="3964734">i</span><span class="op" id="3964735">++</span>&nbsp;<span class="op" id="3964738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964742">c</span>&nbsp;<span class="op" id="3964744">:=</span>&nbsp;<span class="ident" id="3964747">s</span><span class="op" id="3964748">[</span><span class="ident" id="3964749">i</span><span class="op" id="3964750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964754">if</span>&nbsp;<span class="ident" id="3964757">upper</span>&nbsp;<span class="op" id="3964763">&amp;&amp;</span>&nbsp;<span class="string" id="3964766">&#39;a&#39;</span>&nbsp;<span class="op" id="3964770">&lt;=</span>&nbsp;<span class="ident" id="3964773">c</span>&nbsp;<span class="op" id="3964775">&amp;&amp;</span>&nbsp;<span class="ident" id="3964778">c</span>&nbsp;<span class="op" id="3964780">&lt;=</span>&nbsp;<span class="string" id="3964783">&#39;z&#39;</span>&nbsp;<span class="op" id="3964787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964792">return</span>&nbsp;<span class="ident" id="3964799">canonicalMIMEHeaderKey</span><span class="op" id="3964821">(</span><span class="op" id="3964822">[</span><span class="op" id="3964823">]</span><span class="builtintype" id="3964824">byte</span><span class="op" id="3964828">(</span><span class="ident" id="3964829">s</span><span class="op" id="3964830">)</span><span class="op" id="3964831">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3964835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964839">if</span>&nbsp;<span class="op" id="3964842">!</span><span class="ident" id="3964843">upper</span>&nbsp;<span class="op" id="3964849">&amp;&amp;</span>&nbsp;<span class="string" id="3964852">&#39;A&#39;</span>&nbsp;<span class="op" id="3964856">&lt;=</span>&nbsp;<span class="ident" id="3964859">c</span>&nbsp;<span class="op" id="3964861">&amp;&amp;</span>&nbsp;<span class="ident" id="3964864">c</span>&nbsp;<span class="op" id="3964866">&lt;=</span>&nbsp;<span class="string" id="3964869">&#39;Z&#39;</span>&nbsp;<span class="op" id="3964873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964878">return</span>&nbsp;<span class="ident" id="3964885">canonicalMIMEHeaderKey</span><span class="op" id="3964907">(</span><span class="op" id="3964908">[</span><span class="op" id="3964909">]</span><span class="builtintype" id="3964910">byte</span><span class="op" id="3964914">(</span><span class="ident" id="3964915">s</span><span class="op" id="3964916">)</span><span class="op" id="3964917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3964921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3964925">upper</span>&nbsp;<span class="op" id="3964931">=</span>&nbsp;<span class="ident" id="3964933">c</span>&nbsp;<span class="op" id="3964935">==</span>&nbsp;<span class="string" id="3964938">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3964943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3964946">return</span>&nbsp;<span class="ident" id="3964953">s</span><br>
<span class="lineno"></span><span class="op" id="3964955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3964958">const</span>&nbsp;<span class="ident" id="3964964">toLower</span>&nbsp;<span class="op" id="3964972">=</span>&nbsp;<span class="string" id="3964974">&#39;a&#39;</span>&nbsp;<span class="op" id="3964978">-</span>&nbsp;<span class="string" id="3964980">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3964985">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3965049">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3965115">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3965126">func</span>&nbsp;<span class="ident" id="3965131">canonicalMIMEHeaderKey</span><span class="op" id="3965153">(</span><span class="ident" id="3965154">a</span>&nbsp;<span class="op" id="3965156">[</span><span class="op" id="3965157">]</span><span class="builtintype" id="3965158">byte</span><span class="op" id="3965162">)</span>&nbsp;<span class="builtintype" id="3965164">string</span>&nbsp;<span class="op" id="3965171">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965174">upper</span>&nbsp;<span class="op" id="3965180">:=</span>&nbsp;<span class="builtintype" id="3965183">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965189">for</span>&nbsp;<span class="ident" id="3965193">i</span><span class="op" id="3965194">,</span>&nbsp;<span class="ident" id="3965196">c</span>&nbsp;<span class="op" id="3965198">:=</span>&nbsp;<span class="keyword" id="3965201">range</span>&nbsp;<span class="ident" id="3965207">a</span>&nbsp;<span class="op" id="3965209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965213">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965256">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965293">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965337">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965393">if</span>&nbsp;<span class="ident" id="3965396">c</span>&nbsp;<span class="op" id="3965398">==</span>&nbsp;<span class="string" id="3965401">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3965405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965410">c</span>&nbsp;<span class="op" id="3965412">=</span>&nbsp;<span class="string" id="3965414">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3965420">}</span>&nbsp;<span class="keyword" id="3965422">else</span>&nbsp;<span class="keyword" id="3965427">if</span>&nbsp;<span class="ident" id="3965430">upper</span>&nbsp;<span class="op" id="3965436">&amp;&amp;</span>&nbsp;<span class="string" id="3965439">&#39;a&#39;</span>&nbsp;<span class="op" id="3965443">&lt;=</span>&nbsp;<span class="ident" id="3965446">c</span>&nbsp;<span class="op" id="3965448">&amp;&amp;</span>&nbsp;<span class="ident" id="3965451">c</span>&nbsp;<span class="op" id="3965453">&lt;=</span>&nbsp;<span class="string" id="3965456">&#39;z&#39;</span>&nbsp;<span class="op" id="3965460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965465">c</span>&nbsp;<span class="op" id="3965467">-=</span>&nbsp;<span class="ident" id="3965470">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3965480">}</span>&nbsp;<span class="keyword" id="3965482">else</span>&nbsp;<span class="keyword" id="3965487">if</span>&nbsp;<span class="op" id="3965490">!</span><span class="ident" id="3965491">upper</span>&nbsp;<span class="op" id="3965497">&amp;&amp;</span>&nbsp;<span class="string" id="3965500">&#39;A&#39;</span>&nbsp;<span class="op" id="3965504">&lt;=</span>&nbsp;<span class="ident" id="3965507">c</span>&nbsp;<span class="op" id="3965509">&amp;&amp;</span>&nbsp;<span class="ident" id="3965512">c</span>&nbsp;<span class="op" id="3965514">&lt;=</span>&nbsp;<span class="string" id="3965517">&#39;Z&#39;</span>&nbsp;<span class="op" id="3965521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965526">c</span>&nbsp;<span class="op" id="3965528">+=</span>&nbsp;<span class="ident" id="3965531">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3965541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965545">a</span><span class="op" id="3965546">[</span><span class="ident" id="3965547">i</span><span class="op" id="3965548">]</span>&nbsp;<span class="op" id="3965550">=</span>&nbsp;<span class="ident" id="3965552">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3965556">upper</span>&nbsp;<span class="op" id="3965562">=</span>&nbsp;<span class="ident" id="3965564">c</span>&nbsp;<span class="op" id="3965566">==</span>&nbsp;<span class="string" id="3965569">&#39;-&#39;</span>&nbsp;<span class="comment" id="3965573">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3965591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965594">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965656">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3965716">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965747">if</span>&nbsp;<span class="ident" id="3965750">v</span>&nbsp;<span class="op" id="3965752">:=</span>&nbsp;<span class="ident" id="3965755">commonHeader</span><span class="op" id="3965767">[</span><span class="builtintype" id="3965768">string</span><span class="op" id="3965774">(</span><span class="ident" id="3965775">a</span><span class="op" id="3965776">)</span><span class="op" id="3965777">]</span><span class="op" id="3965778">;</span>&nbsp;<span class="ident" id="3965780">v</span>&nbsp;<span class="op" id="3965782">!=</span>&nbsp;<span class="string" id="3965785">&#34;&#34;</span>&nbsp;<span class="op" id="3965788">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965792">return</span>&nbsp;<span class="ident" id="3965799">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3965802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965805">return</span>&nbsp;<span class="builtintype" id="3965812">string</span><span class="op" id="3965818">(</span><span class="ident" id="3965819">a</span><span class="op" id="3965820">)</span><br>
<span class="lineno"></span><span class="op" id="3965822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3965825">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3965872">var</span>&nbsp;<span class="ident" id="3965876">commonHeader</span>&nbsp;<span class="op" id="3965889">=</span>&nbsp;<span class="builtinfunc" id="3965891">make</span><span class="op" id="3965895">(</span><span class="keyword" id="3965896">map</span><span class="op" id="3965899">[</span><span class="builtintype" id="3965900">string</span><span class="op" id="3965906">]</span><span class="builtintype" id="3965907">string</span><span class="op" id="3965913">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3965916">func</span>&nbsp;<span class="ident" id="3965921">init</span><span class="op" id="3965925">(</span><span class="op" id="3965926">)</span>&nbsp;<span class="op" id="3965928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3965931">for</span>&nbsp;<span class="ident" id="3965935">_</span><span class="op" id="3965936">,</span>&nbsp;<span class="ident" id="3965938">v</span>&nbsp;<span class="op" id="3965940">:=</span>&nbsp;<span class="keyword" id="3965943">range</span>&nbsp;<span class="op" id="3965949">[</span><span class="op" id="3965950">]</span><span class="builtintype" id="3965951">string</span><span class="op" id="3965957">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3965961">&#34;Accept&#34;</span><span class="op" id="3965969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3965973">&#34;Accept-Charset&#34;</span><span class="op" id="3965989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3965993">&#34;Accept-Encoding&#34;</span><span class="op" id="3966010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966014">&#34;Accept-Language&#34;</span><span class="op" id="3966031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966035">&#34;Accept-Ranges&#34;</span><span class="op" id="3966050">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966054">&#34;Cache-Control&#34;</span><span class="op" id="3966069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966073">&#34;Cc&#34;</span><span class="op" id="3966077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966081">&#34;Connection&#34;</span><span class="op" id="3966093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966097">&#34;Content-Id&#34;</span><span class="op" id="3966109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966113">&#34;Content-Language&#34;</span><span class="op" id="3966131">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966135">&#34;Content-Length&#34;</span><span class="op" id="3966151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966155">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3966182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966186">&#34;Content-Type&#34;</span><span class="op" id="3966200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966204">&#34;Cookie&#34;</span><span class="op" id="3966212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966216">&#34;Date&#34;</span><span class="op" id="3966222">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966226">&#34;Dkim-Signature&#34;</span><span class="op" id="3966242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966246">&#34;Etag&#34;</span><span class="op" id="3966252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966256">&#34;Expires&#34;</span><span class="op" id="3966265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966269">&#34;From&#34;</span><span class="op" id="3966275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966279">&#34;Host&#34;</span><span class="op" id="3966285">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966289">&#34;If-Modified-Since&#34;</span><span class="op" id="3966308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966312">&#34;If-None-Match&#34;</span><span class="op" id="3966327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966331">&#34;In-Reply-To&#34;</span><span class="op" id="3966344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966348">&#34;Last-Modified&#34;</span><span class="op" id="3966363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966367">&#34;Location&#34;</span><span class="op" id="3966377">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966381">&#34;Message-Id&#34;</span><span class="op" id="3966393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966397">&#34;Mime-Version&#34;</span><span class="op" id="3966411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966415">&#34;Pragma&#34;</span><span class="op" id="3966423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966427">&#34;Received&#34;</span><span class="op" id="3966437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966441">&#34;Return-Path&#34;</span><span class="op" id="3966454">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966458">&#34;Server&#34;</span><span class="op" id="3966466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966470">&#34;Set-Cookie&#34;</span><span class="op" id="3966482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966486">&#34;Subject&#34;</span><span class="op" id="3966495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966499">&#34;To&#34;</span><span class="op" id="3966503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966507">&#34;User-Agent&#34;</span><span class="op" id="3966519">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966523">&#34;Via&#34;</span><span class="op" id="3966528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966532">&#34;X-Forwarded-For&#34;</span><span class="op" id="3966549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966553">&#34;X-Imforwards&#34;</span><span class="op" id="3966567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3966571">&#34;X-Powered-By&#34;</span><span class="op" id="3966585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3966588">}</span>&nbsp;<span class="op" id="3966590">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3966594">commonHeader</span><span class="op" id="3966606">[</span><span class="ident" id="3966607">v</span><span class="op" id="3966608">]</span>&nbsp;<span class="op" id="3966610">=</span>&nbsp;<span class="ident" id="3966612">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3966615">}</span><br>
<span class="lineno"></span><span class="op" id="3966617">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
