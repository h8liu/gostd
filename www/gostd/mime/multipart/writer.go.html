<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3390569">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3390624">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3390678">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3390729">package</span>&nbsp;<span class="ident" id="3390737">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3390748">import</span>&nbsp;<span class="op" id="3390755">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390758">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390767">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390782">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390792">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390799">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390805">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3390822">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3390832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390835">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3390877">type</span>&nbsp;<span class="ident" id="3390882">Writer</span>&nbsp;<span class="keyword" id="3390889">struct</span>&nbsp;<span class="op" id="3390896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390899">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390908">io</span><span class="op" id="3390910">.</span><span class="ident" id="3390911">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390919">boundary</span>&nbsp;<span class="builtintype" id="3390928">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390936">lastpart</span>&nbsp;<span class="op" id="3390945">*</span><span class="ident" id="3390946">part</span><br>
<span class="lineno"></span><span class="op" id="3390951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390954">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3391022">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3391039">func</span>&nbsp;<span class="ident" id="3391044">NewWriter</span><span class="op" id="3391053">(</span><span class="ident" id="3391054">w</span>&nbsp;<span class="ident" id="3391056">io</span><span class="op" id="3391058">.</span><span class="ident" id="3391059">Writer</span><span class="op" id="3391065">)</span>&nbsp;<span class="op" id="3391067">*</span><span class="ident" id="3391068">Writer</span>&nbsp;<span class="op" id="3391075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391078">return</span>&nbsp;<span class="op" id="3391085">&amp;</span><span class="ident" id="3391086">Writer</span><span class="op" id="3391092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391096">w</span><span class="op" id="3391097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391106">w</span><span class="op" id="3391107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391111">boundary</span><span class="op" id="3391119">:</span>&nbsp;<span class="ident" id="3391121">randomBoundary</span><span class="op" id="3391135">(</span><span class="op" id="3391136">)</span><span class="op" id="3391137">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391140">}</span><br>
<span class="lineno"></span><span class="op" id="3391142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391145">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3391188">func</span>&nbsp;<span class="op" id="3391193">(</span><span class="ident" id="3391194">w</span>&nbsp;<span class="op" id="3391196">*</span><span class="ident" id="3391197">Writer</span><span class="op" id="3391203">)</span>&nbsp;<span class="ident" id="3391205">Boundary</span><span class="op" id="3391213">(</span><span class="op" id="3391214">)</span>&nbsp;<span class="builtintype" id="3391216">string</span>&nbsp;<span class="op" id="3391223">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391226">return</span>&nbsp;<span class="ident" id="3391233">w</span><span class="op" id="3391234">.</span><span class="ident" id="3391235">boundary</span><br>
<span class="lineno"></span><span class="op" id="3391244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391247">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3391312">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3391358">//</span><br>
<span class="lineno"></span><span class="comment" id="3391361">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3391430">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3391496">func</span>&nbsp;<span class="op" id="3391501">(</span><span class="ident" id="3391502">w</span>&nbsp;<span class="op" id="3391504">*</span><span class="ident" id="3391505">Writer</span><span class="op" id="3391511">)</span>&nbsp;<span class="ident" id="3391513">SetBoundary</span><span class="op" id="3391524">(</span><span class="ident" id="3391525">boundary</span>&nbsp;<span class="builtintype" id="3391534">string</span><span class="op" id="3391540">)</span>&nbsp;<span class="builtintype" id="3391542">error</span>&nbsp;<span class="op" id="3391548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391551">if</span>&nbsp;<span class="ident" id="3391554">w</span><span class="op" id="3391555">.</span><span class="ident" id="3391556">lastpart</span>&nbsp;<span class="op" id="3391565">!=</span>&nbsp;<span class="ident" id="3391568">nil</span>&nbsp;<span class="op" id="3391572">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391576">return</span>&nbsp;<span class="ident" id="3391583">errors</span><span class="op" id="3391589">.</span><span class="ident" id="3391590">New</span><span class="op" id="3391593">(</span><span class="string" id="3391594">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3391632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391638">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391664">if</span>&nbsp;<span class="builtinfunc" id="3391667">len</span><span class="op" id="3391670">(</span><span class="ident" id="3391671">boundary</span><span class="op" id="3391679">)</span>&nbsp;<span class="op" id="3391681">&lt;</span>&nbsp;<span class="num" id="3391683">1</span>&nbsp;<span class="op" id="3391685">||</span>&nbsp;<span class="builtinfunc" id="3391688">len</span><span class="op" id="3391691">(</span><span class="ident" id="3391692">boundary</span><span class="op" id="3391700">)</span>&nbsp;<span class="op" id="3391702">&gt;</span>&nbsp;<span class="num" id="3391704">69</span>&nbsp;<span class="op" id="3391707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391711">return</span>&nbsp;<span class="ident" id="3391718">errors</span><span class="op" id="3391724">.</span><span class="ident" id="3391725">New</span><span class="op" id="3391728">(</span><span class="string" id="3391729">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3391760">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391766">for</span>&nbsp;<span class="ident" id="3391770">_</span><span class="op" id="3391771">,</span>&nbsp;<span class="ident" id="3391773">b</span>&nbsp;<span class="op" id="3391775">:=</span>&nbsp;<span class="keyword" id="3391778">range</span>&nbsp;<span class="ident" id="3391784">boundary</span>&nbsp;<span class="op" id="3391793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391797">if</span>&nbsp;<span class="string" id="3391800">&#39;A&#39;</span>&nbsp;<span class="op" id="3391804">&lt;=</span>&nbsp;<span class="ident" id="3391807">b</span>&nbsp;<span class="op" id="3391809">&amp;&amp;</span>&nbsp;<span class="ident" id="3391812">b</span>&nbsp;<span class="op" id="3391814">&lt;=</span>&nbsp;<span class="string" id="3391817">&#39;Z&#39;</span>&nbsp;<span class="op" id="3391821">||</span>&nbsp;<span class="string" id="3391824">&#39;a&#39;</span>&nbsp;<span class="op" id="3391828">&lt;=</span>&nbsp;<span class="ident" id="3391831">b</span>&nbsp;<span class="op" id="3391833">&amp;&amp;</span>&nbsp;<span class="ident" id="3391836">b</span>&nbsp;<span class="op" id="3391838">&lt;=</span>&nbsp;<span class="string" id="3391841">&#39;z&#39;</span>&nbsp;<span class="op" id="3391845">||</span>&nbsp;<span class="string" id="3391848">&#39;0&#39;</span>&nbsp;<span class="op" id="3391852">&lt;=</span>&nbsp;<span class="ident" id="3391855">b</span>&nbsp;<span class="op" id="3391857">&amp;&amp;</span>&nbsp;<span class="ident" id="3391860">b</span>&nbsp;<span class="op" id="3391862">&lt;=</span>&nbsp;<span class="string" id="3391865">&#39;9&#39;</span>&nbsp;<span class="op" id="3391869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391874">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391885">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391889">switch</span>&nbsp;<span class="ident" id="3391896">b</span>&nbsp;<span class="op" id="3391898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391902">case</span>&nbsp;<span class="string" id="3391907">&#39;\&#39;&#39;</span><span class="op" id="3391911">,</span>&nbsp;<span class="string" id="3391913">&#39;(&#39;</span><span class="op" id="3391916">,</span>&nbsp;<span class="string" id="3391918">&#39;)&#39;</span><span class="op" id="3391921">,</span>&nbsp;<span class="string" id="3391923">&#39;+&#39;</span><span class="op" id="3391926">,</span>&nbsp;<span class="string" id="3391928">&#39;_&#39;</span><span class="op" id="3391931">,</span>&nbsp;<span class="string" id="3391933">&#39;,&#39;</span><span class="op" id="3391936">,</span>&nbsp;<span class="string" id="3391938">&#39;-&#39;</span><span class="op" id="3391941">,</span>&nbsp;<span class="string" id="3391943">&#39;.&#39;</span><span class="op" id="3391946">,</span>&nbsp;<span class="string" id="3391948">&#39;/&#39;</span><span class="op" id="3391951">,</span>&nbsp;<span class="string" id="3391953">&#39;:&#39;</span><span class="op" id="3391956">,</span>&nbsp;<span class="string" id="3391958">&#39;=&#39;</span><span class="op" id="3391961">,</span>&nbsp;<span class="string" id="3391963">&#39;?&#39;</span><span class="op" id="3391966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391971">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391986">return</span>&nbsp;<span class="ident" id="3391993">errors</span><span class="op" id="3391999">.</span><span class="ident" id="3392000">New</span><span class="op" id="3392003">(</span><span class="string" id="3392004">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3392038">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392044">w</span><span class="op" id="3392045">.</span><span class="ident" id="3392046">boundary</span>&nbsp;<span class="op" id="3392055">=</span>&nbsp;<span class="ident" id="3392057">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392067">return</span>&nbsp;<span class="ident" id="3392074">nil</span><br>
<span class="lineno"></span><span class="op" id="3392078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3392081">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3392141">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3392193">func</span>&nbsp;<span class="op" id="3392198">(</span><span class="ident" id="3392199">w</span>&nbsp;<span class="op" id="3392201">*</span><span class="ident" id="3392202">Writer</span><span class="op" id="3392208">)</span>&nbsp;<span class="ident" id="3392210">FormDataContentType</span><span class="op" id="3392229">(</span><span class="op" id="3392230">)</span>&nbsp;<span class="builtintype" id="3392232">string</span>&nbsp;<span class="op" id="3392239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392242">return</span>&nbsp;<span class="string" id="3392249">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3392282">+</span>&nbsp;<span class="ident" id="3392284">w</span><span class="op" id="3392285">.</span><span class="ident" id="3392286">boundary</span><br>
<span class="lineno"></span><span class="op" id="3392295">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3392298">func</span>&nbsp;<span class="ident" id="3392303">randomBoundary</span><span class="op" id="3392317">(</span><span class="op" id="3392318">)</span>&nbsp;<span class="builtintype" id="3392320">string</span>&nbsp;<span class="op" id="3392327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392330">var</span>&nbsp;<span class="ident" id="3392334">buf</span>&nbsp;<span class="op" id="3392338">[</span><span class="num" id="3392339">30</span><span class="op" id="3392341">]</span><span class="builtintype" id="3392342">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392348">_</span><span class="op" id="3392349">,</span>&nbsp;<span class="ident" id="3392351">err</span>&nbsp;<span class="op" id="3392355">:=</span>&nbsp;<span class="ident" id="3392358">io</span><span class="op" id="3392360">.</span><span class="ident" id="3392361">ReadFull</span><span class="op" id="3392369">(</span><span class="ident" id="3392370">rand</span><span class="op" id="3392374">.</span><span class="ident" id="3392375">Reader</span><span class="op" id="3392381">,</span>&nbsp;<span class="ident" id="3392383">buf</span><span class="op" id="3392386">[</span><span class="op" id="3392387">:</span><span class="op" id="3392388">]</span><span class="op" id="3392389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392392">if</span>&nbsp;<span class="ident" id="3392395">err</span>&nbsp;<span class="op" id="3392399">!=</span>&nbsp;<span class="ident" id="3392402">nil</span>&nbsp;<span class="op" id="3392406">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3392410">panic</span><span class="op" id="3392415">(</span><span class="ident" id="3392416">err</span><span class="op" id="3392419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392425">return</span>&nbsp;<span class="ident" id="3392432">fmt</span><span class="op" id="3392435">.</span><span class="ident" id="3392436">Sprintf</span><span class="op" id="3392443">(</span><span class="string" id="3392444">&#34;%x&#34;</span><span class="op" id="3392448">,</span>&nbsp;<span class="ident" id="3392450">buf</span><span class="op" id="3392453">[</span><span class="op" id="3392454">:</span><span class="op" id="3392455">]</span><span class="op" id="3392456">)</span><br>
<span class="lineno"></span><span class="op" id="3392458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3392461">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3392525">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3392591">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3392660">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3392678">func</span>&nbsp;<span class="op" id="3392683">(</span><span class="ident" id="3392684">w</span>&nbsp;<span class="op" id="3392686">*</span><span class="ident" id="3392687">Writer</span><span class="op" id="3392693">)</span>&nbsp;<span class="ident" id="3392695">CreatePart</span><span class="op" id="3392705">(</span><span class="ident" id="3392706">header</span>&nbsp;<span class="ident" id="3392713">textproto</span><span class="op" id="3392722">.</span><span class="ident" id="3392723">MIMEHeader</span><span class="op" id="3392733">)</span>&nbsp;<span class="op" id="3392735">(</span><span class="ident" id="3392736">io</span><span class="op" id="3392738">.</span><span class="ident" id="3392739">Writer</span><span class="op" id="3392745">,</span>&nbsp;<span class="builtintype" id="3392747">error</span><span class="op" id="3392752">)</span>&nbsp;<span class="op" id="3392754">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392757">if</span>&nbsp;<span class="ident" id="3392760">w</span><span class="op" id="3392761">.</span><span class="ident" id="3392762">lastpart</span>&nbsp;<span class="op" id="3392771">!=</span>&nbsp;<span class="ident" id="3392774">nil</span>&nbsp;<span class="op" id="3392778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392782">if</span>&nbsp;<span class="ident" id="3392785">err</span>&nbsp;<span class="op" id="3392789">:=</span>&nbsp;<span class="ident" id="3392792">w</span><span class="op" id="3392793">.</span><span class="ident" id="3392794">lastpart</span><span class="op" id="3392802">.</span><span class="builtinfunc" id="3392803">close</span><span class="op" id="3392808">(</span><span class="op" id="3392809">)</span><span class="op" id="3392810">;</span>&nbsp;<span class="ident" id="3392812">err</span>&nbsp;<span class="op" id="3392816">!=</span>&nbsp;<span class="ident" id="3392819">nil</span>&nbsp;<span class="op" id="3392823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392828">return</span>&nbsp;<span class="ident" id="3392835">nil</span><span class="op" id="3392838">,</span>&nbsp;<span class="ident" id="3392840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392849">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392852">var</span>&nbsp;<span class="ident" id="3392856">b</span>&nbsp;<span class="ident" id="3392858">bytes</span><span class="op" id="3392863">.</span><span class="ident" id="3392864">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392872">if</span>&nbsp;<span class="ident" id="3392875">w</span><span class="op" id="3392876">.</span><span class="ident" id="3392877">lastpart</span>&nbsp;<span class="op" id="3392886">!=</span>&nbsp;<span class="ident" id="3392889">nil</span>&nbsp;<span class="op" id="3392893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392897">fmt</span><span class="op" id="3392900">.</span><span class="ident" id="3392901">Fprintf</span><span class="op" id="3392908">(</span><span class="op" id="3392909">&amp;</span><span class="ident" id="3392910">b</span><span class="op" id="3392911">,</span>&nbsp;<span class="string" id="3392913">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3392927">,</span>&nbsp;<span class="ident" id="3392929">w</span><span class="op" id="3392930">.</span><span class="ident" id="3392931">boundary</span><span class="op" id="3392939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392942">}</span>&nbsp;<span class="keyword" id="3392944">else</span>&nbsp;<span class="op" id="3392949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392953">fmt</span><span class="op" id="3392956">.</span><span class="ident" id="3392957">Fprintf</span><span class="op" id="3392964">(</span><span class="op" id="3392965">&amp;</span><span class="ident" id="3392966">b</span><span class="op" id="3392967">,</span>&nbsp;<span class="string" id="3392969">&#34;--%s\r\n&#34;</span><span class="op" id="3392979">,</span>&nbsp;<span class="ident" id="3392981">w</span><span class="op" id="3392982">.</span><span class="ident" id="3392983">boundary</span><span class="op" id="3392991">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392997">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393074">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393121">for</span>&nbsp;<span class="ident" id="3393125">k</span><span class="op" id="3393126">,</span>&nbsp;<span class="ident" id="3393128">vv</span>&nbsp;<span class="op" id="3393131">:=</span>&nbsp;<span class="keyword" id="3393134">range</span>&nbsp;<span class="ident" id="3393140">header</span>&nbsp;<span class="op" id="3393147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393151">for</span>&nbsp;<span class="ident" id="3393155">_</span><span class="op" id="3393156">,</span>&nbsp;<span class="ident" id="3393158">v</span>&nbsp;<span class="op" id="3393160">:=</span>&nbsp;<span class="keyword" id="3393163">range</span>&nbsp;<span class="ident" id="3393169">vv</span>&nbsp;<span class="op" id="3393172">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393177">fmt</span><span class="op" id="3393180">.</span><span class="ident" id="3393181">Fprintf</span><span class="op" id="3393188">(</span><span class="op" id="3393189">&amp;</span><span class="ident" id="3393190">b</span><span class="op" id="3393191">,</span>&nbsp;<span class="string" id="3393193">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3393205">,</span>&nbsp;<span class="ident" id="3393207">k</span><span class="op" id="3393208">,</span>&nbsp;<span class="ident" id="3393210">v</span><span class="op" id="3393211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393221">fmt</span><span class="op" id="3393224">.</span><span class="ident" id="3393225">Fprintf</span><span class="op" id="3393232">(</span><span class="op" id="3393233">&amp;</span><span class="ident" id="3393234">b</span><span class="op" id="3393235">,</span>&nbsp;<span class="string" id="3393237">&#34;\r\n&#34;</span><span class="op" id="3393243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393246">_</span><span class="op" id="3393247">,</span>&nbsp;<span class="ident" id="3393249">err</span>&nbsp;<span class="op" id="3393253">:=</span>&nbsp;<span class="ident" id="3393256">io</span><span class="op" id="3393258">.</span><span class="ident" id="3393259">Copy</span><span class="op" id="3393263">(</span><span class="ident" id="3393264">w</span><span class="op" id="3393265">.</span><span class="ident" id="3393266">w</span><span class="op" id="3393267">,</span>&nbsp;<span class="op" id="3393269">&amp;</span><span class="ident" id="3393270">b</span><span class="op" id="3393271">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393274">if</span>&nbsp;<span class="ident" id="3393277">err</span>&nbsp;<span class="op" id="3393281">!=</span>&nbsp;<span class="ident" id="3393284">nil</span>&nbsp;<span class="op" id="3393288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393292">return</span>&nbsp;<span class="ident" id="3393299">nil</span><span class="op" id="3393302">,</span>&nbsp;<span class="ident" id="3393304">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393312">p</span>&nbsp;<span class="op" id="3393314">:=</span>&nbsp;<span class="op" id="3393317">&amp;</span><span class="ident" id="3393318">part</span><span class="op" id="3393322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393326">mw</span><span class="op" id="3393328">:</span>&nbsp;<span class="ident" id="3393330">w</span><span class="op" id="3393331">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393337">w</span><span class="op" id="3393338">.</span><span class="ident" id="3393339">lastpart</span>&nbsp;<span class="op" id="3393348">=</span>&nbsp;<span class="ident" id="3393350">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393353">return</span>&nbsp;<span class="ident" id="3393360">p</span><span class="op" id="3393361">,</span>&nbsp;<span class="ident" id="3393363">nil</span><br>
<span class="lineno"></span><span class="op" id="3393367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3393370">var</span>&nbsp;<span class="ident" id="3393374">quoteEscaper</span>&nbsp;<span class="op" id="3393387">=</span>&nbsp;<span class="ident" id="3393389">strings</span><span class="op" id="3393396">.</span><span class="ident" id="3393397">NewReplacer</span><span class="op" id="3393408">(</span><span class="string" id="3393409">&#34;\\&#34;</span><span class="op" id="3393413">,</span>&nbsp;<span class="string" id="3393415">&#34;\\\\&#34;</span><span class="op" id="3393421">,</span>&nbsp;<span class="string" id="3393423">`&#34;`</span><span class="op" id="3393426">,</span>&nbsp;<span class="string" id="3393428">&#34;\\\&#34;&#34;</span><span class="op" id="3393434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393437">func</span>&nbsp;<span class="ident" id="3393442">escapeQuotes</span><span class="op" id="3393454">(</span><span class="ident" id="3393455">s</span>&nbsp;<span class="builtintype" id="3393457">string</span><span class="op" id="3393463">)</span>&nbsp;<span class="builtintype" id="3393465">string</span>&nbsp;<span class="op" id="3393472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393475">return</span>&nbsp;<span class="ident" id="3393482">quoteEscaper</span><span class="op" id="3393494">.</span><span class="ident" id="3393495">Replace</span><span class="op" id="3393502">(</span><span class="ident" id="3393503">s</span><span class="op" id="3393504">)</span><br>
<span class="lineno"></span><span class="op" id="3393506">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3393509">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3393582">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3393652">func</span>&nbsp;<span class="op" id="3393657">(</span><span class="ident" id="3393658">w</span>&nbsp;<span class="op" id="3393660">*</span><span class="ident" id="3393661">Writer</span><span class="op" id="3393667">)</span>&nbsp;<span class="ident" id="3393669">CreateFormFile</span><span class="op" id="3393683">(</span><span class="ident" id="3393684">fieldname</span><span class="op" id="3393693">,</span>&nbsp;<span class="ident" id="3393695">filename</span>&nbsp;<span class="builtintype" id="3393704">string</span><span class="op" id="3393710">)</span>&nbsp;<span class="op" id="3393712">(</span><span class="ident" id="3393713">io</span><span class="op" id="3393715">.</span><span class="ident" id="3393716">Writer</span><span class="op" id="3393722">,</span>&nbsp;<span class="builtintype" id="3393724">error</span><span class="op" id="3393729">)</span>&nbsp;<span class="op" id="3393731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393734">h</span>&nbsp;<span class="op" id="3393736">:=</span>&nbsp;<span class="builtinfunc" id="3393739">make</span><span class="op" id="3393743">(</span><span class="ident" id="3393744">textproto</span><span class="op" id="3393753">.</span><span class="ident" id="3393754">MIMEHeader</span><span class="op" id="3393764">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393767">h</span><span class="op" id="3393768">.</span><span class="ident" id="3393769">Set</span><span class="op" id="3393772">(</span><span class="string" id="3393773">&#34;Content-Disposition&#34;</span><span class="op" id="3393794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393798">fmt</span><span class="op" id="3393801">.</span><span class="ident" id="3393802">Sprintf</span><span class="op" id="3393809">(</span><span class="string" id="3393810">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3393847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393852">escapeQuotes</span><span class="op" id="3393864">(</span><span class="ident" id="3393865">fieldname</span><span class="op" id="3393874">)</span><span class="op" id="3393875">,</span>&nbsp;<span class="ident" id="3393877">escapeQuotes</span><span class="op" id="3393889">(</span><span class="ident" id="3393890">filename</span><span class="op" id="3393898">)</span><span class="op" id="3393899">)</span><span class="op" id="3393900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393903">h</span><span class="op" id="3393904">.</span><span class="ident" id="3393905">Set</span><span class="op" id="3393908">(</span><span class="string" id="3393909">&#34;Content-Type&#34;</span><span class="op" id="3393923">,</span>&nbsp;<span class="string" id="3393925">&#34;application/octet-stream&#34;</span><span class="op" id="3393951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393954">return</span>&nbsp;<span class="ident" id="3393961">w</span><span class="op" id="3393962">.</span><span class="ident" id="3393963">CreatePart</span><span class="op" id="3393973">(</span><span class="ident" id="3393974">h</span><span class="op" id="3393975">)</span><br>
<span class="lineno">130</span><span class="op" id="3393977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3393980">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3394040">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3394061">func</span>&nbsp;<span class="op" id="3394066">(</span><span class="ident" id="3394067">w</span>&nbsp;<span class="op" id="3394069">*</span><span class="ident" id="3394070">Writer</span><span class="op" id="3394076">)</span>&nbsp;<span class="ident" id="3394078">CreateFormField</span><span class="op" id="3394093">(</span><span class="ident" id="3394094">fieldname</span>&nbsp;<span class="builtintype" id="3394104">string</span><span class="op" id="3394110">)</span>&nbsp;<span class="op" id="3394112">(</span><span class="ident" id="3394113">io</span><span class="op" id="3394115">.</span><span class="ident" id="3394116">Writer</span><span class="op" id="3394122">,</span>&nbsp;<span class="builtintype" id="3394124">error</span><span class="op" id="3394129">)</span>&nbsp;<span class="op" id="3394131">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394134">h</span>&nbsp;<span class="op" id="3394136">:=</span>&nbsp;<span class="builtinfunc" id="3394139">make</span><span class="op" id="3394143">(</span><span class="ident" id="3394144">textproto</span><span class="op" id="3394153">.</span><span class="ident" id="3394154">MIMEHeader</span><span class="op" id="3394164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394167">h</span><span class="op" id="3394168">.</span><span class="ident" id="3394169">Set</span><span class="op" id="3394172">(</span><span class="string" id="3394173">&#34;Content-Disposition&#34;</span><span class="op" id="3394194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394198">fmt</span><span class="op" id="3394201">.</span><span class="ident" id="3394202">Sprintf</span><span class="op" id="3394209">(</span><span class="string" id="3394210">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3394232">,</span>&nbsp;<span class="ident" id="3394234">escapeQuotes</span><span class="op" id="3394246">(</span><span class="ident" id="3394247">fieldname</span><span class="op" id="3394256">)</span><span class="op" id="3394257">)</span><span class="op" id="3394258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394261">return</span>&nbsp;<span class="ident" id="3394268">w</span><span class="op" id="3394269">.</span><span class="ident" id="3394270">CreatePart</span><span class="op" id="3394280">(</span><span class="ident" id="3394281">h</span><span class="op" id="3394282">)</span><br>
<span class="lineno"></span><span class="op" id="3394284">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3394287">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3394356">func</span>&nbsp;<span class="op" id="3394361">(</span><span class="ident" id="3394362">w</span>&nbsp;<span class="op" id="3394364">*</span><span class="ident" id="3394365">Writer</span><span class="op" id="3394371">)</span>&nbsp;<span class="ident" id="3394373">WriteField</span><span class="op" id="3394383">(</span><span class="ident" id="3394384">fieldname</span><span class="op" id="3394393">,</span>&nbsp;<span class="ident" id="3394395">value</span>&nbsp;<span class="builtintype" id="3394401">string</span><span class="op" id="3394407">)</span>&nbsp;<span class="builtintype" id="3394409">error</span>&nbsp;<span class="op" id="3394415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394418">p</span><span class="op" id="3394419">,</span>&nbsp;<span class="ident" id="3394421">err</span>&nbsp;<span class="op" id="3394425">:=</span>&nbsp;<span class="ident" id="3394428">w</span><span class="op" id="3394429">.</span><span class="ident" id="3394430">CreateFormField</span><span class="op" id="3394445">(</span><span class="ident" id="3394446">fieldname</span><span class="op" id="3394455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394458">if</span>&nbsp;<span class="ident" id="3394461">err</span>&nbsp;<span class="op" id="3394465">!=</span>&nbsp;<span class="ident" id="3394468">nil</span>&nbsp;<span class="op" id="3394472">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394476">return</span>&nbsp;<span class="ident" id="3394483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394491">_</span><span class="op" id="3394492">,</span>&nbsp;<span class="ident" id="3394494">err</span>&nbsp;<span class="op" id="3394498">=</span>&nbsp;<span class="ident" id="3394500">p</span><span class="op" id="3394501">.</span><span class="ident" id="3394502">Write</span><span class="op" id="3394507">(</span><span class="op" id="3394508">[</span><span class="op" id="3394509">]</span><span class="builtintype" id="3394510">byte</span><span class="op" id="3394514">(</span><span class="ident" id="3394515">value</span><span class="op" id="3394520">)</span><span class="op" id="3394521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394524">return</span>&nbsp;<span class="ident" id="3394531">err</span><br>
<span class="lineno"></span><span class="op" id="3394535">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3394538">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3394602">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3394638">func</span>&nbsp;<span class="op" id="3394643">(</span><span class="ident" id="3394644">w</span>&nbsp;<span class="op" id="3394646">*</span><span class="ident" id="3394647">Writer</span><span class="op" id="3394653">)</span>&nbsp;<span class="ident" id="3394655">Close</span><span class="op" id="3394660">(</span><span class="op" id="3394661">)</span>&nbsp;<span class="builtintype" id="3394663">error</span>&nbsp;<span class="op" id="3394669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394672">if</span>&nbsp;<span class="ident" id="3394675">w</span><span class="op" id="3394676">.</span><span class="ident" id="3394677">lastpart</span>&nbsp;<span class="op" id="3394686">!=</span>&nbsp;<span class="ident" id="3394689">nil</span>&nbsp;<span class="op" id="3394693">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394697">if</span>&nbsp;<span class="ident" id="3394700">err</span>&nbsp;<span class="op" id="3394704">:=</span>&nbsp;<span class="ident" id="3394707">w</span><span class="op" id="3394708">.</span><span class="ident" id="3394709">lastpart</span><span class="op" id="3394717">.</span><span class="builtinfunc" id="3394718">close</span><span class="op" id="3394723">(</span><span class="op" id="3394724">)</span><span class="op" id="3394725">;</span>&nbsp;<span class="ident" id="3394727">err</span>&nbsp;<span class="op" id="3394731">!=</span>&nbsp;<span class="ident" id="3394734">nil</span>&nbsp;<span class="op" id="3394738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394743">return</span>&nbsp;<span class="ident" id="3394750">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394760">w</span><span class="op" id="3394761">.</span><span class="ident" id="3394762">lastpart</span>&nbsp;<span class="op" id="3394771">=</span>&nbsp;<span class="ident" id="3394773">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394778">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394781">_</span><span class="op" id="3394782">,</span>&nbsp;<span class="ident" id="3394784">err</span>&nbsp;<span class="op" id="3394788">:=</span>&nbsp;<span class="ident" id="3394791">fmt</span><span class="op" id="3394794">.</span><span class="ident" id="3394795">Fprintf</span><span class="op" id="3394802">(</span><span class="ident" id="3394803">w</span><span class="op" id="3394804">.</span><span class="ident" id="3394805">w</span><span class="op" id="3394806">,</span>&nbsp;<span class="string" id="3394808">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3394824">,</span>&nbsp;<span class="ident" id="3394826">w</span><span class="op" id="3394827">.</span><span class="ident" id="3394828">boundary</span><span class="op" id="3394836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394839">return</span>&nbsp;<span class="ident" id="3394846">err</span><br>
<span class="lineno"></span><span class="op" id="3394850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3394853">type</span>&nbsp;<span class="ident" id="3394858">part</span>&nbsp;<span class="keyword" id="3394863">struct</span>&nbsp;<span class="op" id="3394870">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394873">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394880">*</span><span class="ident" id="3394881">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394889">closed</span>&nbsp;<span class="builtintype" id="3394896">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394902">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3394909">error</span>&nbsp;<span class="comment" id="3394915">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3394951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3394954">func</span>&nbsp;<span class="op" id="3394959">(</span><span class="ident" id="3394960">p</span>&nbsp;<span class="op" id="3394962">*</span><span class="ident" id="3394963">part</span><span class="op" id="3394967">)</span>&nbsp;<span class="builtinfunc" id="3394969">close</span><span class="op" id="3394974">(</span><span class="op" id="3394975">)</span>&nbsp;<span class="builtintype" id="3394977">error</span>&nbsp;<span class="op" id="3394983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394986">p</span><span class="op" id="3394987">.</span><span class="ident" id="3394988">closed</span>&nbsp;<span class="op" id="3394995">=</span>&nbsp;<span class="builtintype" id="3394997">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395003">return</span>&nbsp;<span class="ident" id="3395010">p</span><span class="op" id="3395011">.</span><span class="ident" id="3395012">we</span><br>
<span class="lineno"></span><span class="op" id="3395015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3395018">func</span>&nbsp;<span class="op" id="3395023">(</span><span class="ident" id="3395024">p</span>&nbsp;<span class="op" id="3395026">*</span><span class="ident" id="3395027">part</span><span class="op" id="3395031">)</span>&nbsp;<span class="ident" id="3395033">Write</span><span class="op" id="3395038">(</span><span class="ident" id="3395039">d</span>&nbsp;<span class="op" id="3395041">[</span><span class="op" id="3395042">]</span><span class="builtintype" id="3395043">byte</span><span class="op" id="3395047">)</span>&nbsp;<span class="op" id="3395049">(</span><span class="ident" id="3395050">n</span>&nbsp;<span class="builtintype" id="3395052">int</span><span class="op" id="3395055">,</span>&nbsp;<span class="ident" id="3395057">err</span>&nbsp;<span class="builtintype" id="3395061">error</span><span class="op" id="3395066">)</span>&nbsp;<span class="op" id="3395068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395071">if</span>&nbsp;<span class="ident" id="3395074">p</span><span class="op" id="3395075">.</span><span class="ident" id="3395076">closed</span>&nbsp;<span class="op" id="3395083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395087">return</span>&nbsp;<span class="num" id="3395094">0</span><span class="op" id="3395095">,</span>&nbsp;<span class="ident" id="3395097">errors</span><span class="op" id="3395103">.</span><span class="ident" id="3395104">New</span><span class="op" id="3395107">(</span><span class="string" id="3395108">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3395149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395155">n</span><span class="op" id="3395156">,</span>&nbsp;<span class="ident" id="3395158">err</span>&nbsp;<span class="op" id="3395162">=</span>&nbsp;<span class="ident" id="3395164">p</span><span class="op" id="3395165">.</span><span class="ident" id="3395166">mw</span><span class="op" id="3395168">.</span><span class="ident" id="3395169">w</span><span class="op" id="3395170">.</span><span class="ident" id="3395171">Write</span><span class="op" id="3395176">(</span><span class="ident" id="3395177">d</span><span class="op" id="3395178">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395181">if</span>&nbsp;<span class="ident" id="3395184">err</span>&nbsp;<span class="op" id="3395188">!=</span>&nbsp;<span class="ident" id="3395191">nil</span>&nbsp;<span class="op" id="3395195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395199">p</span><span class="op" id="3395200">.</span><span class="ident" id="3395201">we</span>&nbsp;<span class="op" id="3395204">=</span>&nbsp;<span class="ident" id="3395206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395214">return</span><br>
<span class="lineno"></span><span class="op" id="3395221">}</span>
</div>
</body>
</html>
