<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6637687">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6637742">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6637796">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6637847">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="6637911">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6637945">package</span>&nbsp;<span class="ident" id="6637953">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6637962">import</span>&nbsp;<span class="op" id="6637969">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6637972">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6637981">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6637991">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6638004">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6638010">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6638023">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6638030">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6638040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6638043">var</span>&nbsp;<span class="ident" id="6638047">testfile</span>&nbsp;<span class="op" id="6638056">*</span><span class="ident" id="6638057">ast</span><span class="op" id="6638060">.</span><span class="ident" id="6638061">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6638067">func</span>&nbsp;<span class="ident" id="6638072">testprint</span><span class="op" id="6638081">(</span><span class="ident" id="6638082">out</span>&nbsp;<span class="ident" id="6638086">io</span><span class="op" id="6638088">.</span><span class="ident" id="6638089">Writer</span><span class="op" id="6638095">,</span>&nbsp;<span class="ident" id="6638097">file</span>&nbsp;<span class="op" id="6638102">*</span><span class="ident" id="6638103">ast</span><span class="op" id="6638106">.</span><span class="ident" id="6638107">File</span><span class="op" id="6638111">)</span>&nbsp;<span class="op" id="6638113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638116">if</span>&nbsp;<span class="ident" id="6638119">err</span>&nbsp;<span class="op" id="6638123">:=</span>&nbsp;<span class="op" id="6638126">(</span><span class="op" id="6638127">&amp;</span><span class="ident" id="6638128">Config</span><span class="op" id="6638134">{</span><span class="ident" id="6638135">TabIndent</span>&nbsp;<span class="op" id="6638145">|</span>&nbsp;<span class="ident" id="6638147">UseSpaces</span><span class="op" id="6638156">,</span>&nbsp;<span class="num" id="6638158">8</span><span class="op" id="6638159">,</span>&nbsp;<span class="num" id="6638161">0</span><span class="op" id="6638162">}</span><span class="op" id="6638163">)</span><span class="op" id="6638164">.</span><span class="ident" id="6638165">Fprint</span><span class="op" id="6638171">(</span><span class="ident" id="6638172">out</span><span class="op" id="6638175">,</span>&nbsp;<span class="ident" id="6638177">fset</span><span class="op" id="6638181">,</span>&nbsp;<span class="ident" id="6638183">file</span><span class="op" id="6638187">)</span><span class="op" id="6638188">;</span>&nbsp;<span class="ident" id="6638190">err</span>&nbsp;<span class="op" id="6638194">!=</span>&nbsp;<span class="ident" id="6638197">nil</span>&nbsp;<span class="op" id="6638201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638205">log</span><span class="op" id="6638208">.</span><span class="ident" id="6638209">Fatalf</span><span class="op" id="6638215">(</span><span class="string" id="6638216">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6638233">,</span>&nbsp;<span class="ident" id="6638235">err</span><span class="op" id="6638238">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638241">}</span><br>
<span class="lineno"></span><span class="op" id="6638243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6638246">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6638321">func</span>&nbsp;<span class="ident" id="6638326">initialize</span><span class="op" id="6638336">(</span><span class="op" id="6638337">)</span>&nbsp;<span class="op" id="6638339">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638342">const</span>&nbsp;<span class="ident" id="6638348">filename</span>&nbsp;<span class="op" id="6638357">=</span>&nbsp;<span class="string" id="6638359">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638382">src</span><span class="op" id="6638385">,</span>&nbsp;<span class="ident" id="6638387">err</span>&nbsp;<span class="op" id="6638391">:=</span>&nbsp;<span class="ident" id="6638394">ioutil</span><span class="op" id="6638400">.</span><span class="ident" id="6638401">ReadFile</span><span class="op" id="6638409">(</span><span class="ident" id="6638410">filename</span><span class="op" id="6638418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638421">if</span>&nbsp;<span class="ident" id="6638424">err</span>&nbsp;<span class="op" id="6638428">!=</span>&nbsp;<span class="ident" id="6638431">nil</span>&nbsp;<span class="op" id="6638435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638439">log</span><span class="op" id="6638442">.</span><span class="ident" id="6638443">Fatalf</span><span class="op" id="6638449">(</span><span class="string" id="6638450">&#34;%s&#34;</span><span class="op" id="6638454">,</span>&nbsp;<span class="ident" id="6638456">err</span><span class="op" id="6638459">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638466">file</span><span class="op" id="6638470">,</span>&nbsp;<span class="ident" id="6638472">err</span>&nbsp;<span class="op" id="6638476">:=</span>&nbsp;<span class="ident" id="6638479">parser</span><span class="op" id="6638485">.</span><span class="ident" id="6638486">ParseFile</span><span class="op" id="6638495">(</span><span class="ident" id="6638496">fset</span><span class="op" id="6638500">,</span>&nbsp;<span class="ident" id="6638502">filename</span><span class="op" id="6638510">,</span>&nbsp;<span class="ident" id="6638512">src</span><span class="op" id="6638515">,</span>&nbsp;<span class="ident" id="6638517">parser</span><span class="op" id="6638523">.</span><span class="ident" id="6638524">ParseComments</span><span class="op" id="6638537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638540">if</span>&nbsp;<span class="ident" id="6638543">err</span>&nbsp;<span class="op" id="6638547">!=</span>&nbsp;<span class="ident" id="6638550">nil</span>&nbsp;<span class="op" id="6638554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638558">log</span><span class="op" id="6638561">.</span><span class="ident" id="6638562">Fatalf</span><span class="op" id="6638568">(</span><span class="string" id="6638569">&#34;%s&#34;</span><span class="op" id="6638573">,</span>&nbsp;<span class="ident" id="6638575">err</span><span class="op" id="6638578">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638585">var</span>&nbsp;<span class="ident" id="6638589">buf</span>&nbsp;<span class="ident" id="6638593">bytes</span><span class="op" id="6638598">.</span><span class="ident" id="6638599">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638607">testprint</span><span class="op" id="6638616">(</span><span class="op" id="6638617">&amp;</span><span class="ident" id="6638618">buf</span><span class="op" id="6638621">,</span>&nbsp;<span class="ident" id="6638623">file</span><span class="op" id="6638627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638630">if</span>&nbsp;<span class="op" id="6638633">!</span><span class="ident" id="6638634">bytes</span><span class="op" id="6638639">.</span><span class="ident" id="6638640">Equal</span><span class="op" id="6638645">(</span><span class="ident" id="6638646">buf</span><span class="op" id="6638649">.</span><span class="ident" id="6638650">Bytes</span><span class="op" id="6638655">(</span><span class="op" id="6638656">)</span><span class="op" id="6638657">,</span>&nbsp;<span class="ident" id="6638659">src</span><span class="op" id="6638662">)</span>&nbsp;<span class="op" id="6638664">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638668">log</span><span class="op" id="6638671">.</span><span class="ident" id="6638672">Fatalf</span><span class="op" id="6638678">(</span><span class="string" id="6638679">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="6638711">,</span>&nbsp;<span class="ident" id="6638713">filename</span><span class="op" id="6638721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638728">testfile</span>&nbsp;<span class="op" id="6638737">=</span>&nbsp;<span class="ident" id="6638739">file</span><br>
<span class="lineno"></span><span class="op" id="6638744">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6638747">func</span>&nbsp;<span class="ident" id="6638752">BenchmarkPrint</span><span class="op" id="6638766">(</span><span class="ident" id="6638767">b</span>&nbsp;<span class="op" id="6638769">*</span><span class="ident" id="6638770">testing</span><span class="op" id="6638777">.</span><span class="ident" id="6638778">B</span><span class="op" id="6638779">)</span>&nbsp;<span class="op" id="6638781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638784">if</span>&nbsp;<span class="ident" id="6638787">testfile</span>&nbsp;<span class="op" id="6638796">==</span>&nbsp;<span class="ident" id="6638799">nil</span>&nbsp;<span class="op" id="6638803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638807">initialize</span><span class="op" id="6638817">(</span><span class="op" id="6638818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638821">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6638824">for</span>&nbsp;<span class="ident" id="6638828">i</span>&nbsp;<span class="op" id="6638830">:=</span>&nbsp;<span class="num" id="6638833">0</span><span class="op" id="6638834">;</span>&nbsp;<span class="ident" id="6638836">i</span>&nbsp;<span class="op" id="6638838">&lt;</span>&nbsp;<span class="ident" id="6638840">b</span><span class="op" id="6638841">.</span><span class="ident" id="6638842">N</span><span class="op" id="6638843">;</span>&nbsp;<span class="ident" id="6638845">i</span><span class="op" id="6638846">++</span>&nbsp;<span class="op" id="6638849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6638853">testprint</span><span class="op" id="6638862">(</span><span class="ident" id="6638863">ioutil</span><span class="op" id="6638869">.</span><span class="ident" id="6638870">Discard</span><span class="op" id="6638877">,</span>&nbsp;<span class="ident" id="6638879">testfile</span><span class="op" id="6638887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6638890">}</span><br>
<span class="lineno"></span><span class="op" id="6638892">}</span>
</div>
</body>
</html>
