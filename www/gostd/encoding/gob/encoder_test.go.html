<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html" class="current">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8453822">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8453877">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8453931">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8453982">package</span>&nbsp;<span class="ident" id="8453990">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8453995">import</span>&nbsp;<span class="op" id="8454002">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454005">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454014">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454021">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454027">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454038">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454049">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8454059">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8454062">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="8454105">func</span>&nbsp;<span class="ident" id="8454110">TestBasicEncoderDecoder</span><span class="op" id="8454133">(</span><span class="ident" id="8454134">t</span>&nbsp;<span class="op" id="8454136">*</span><span class="ident" id="8454137">testing</span><span class="op" id="8454144">.</span><span class="ident" id="8454145">T</span><span class="op" id="8454146">)</span>&nbsp;<span class="op" id="8454148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454151">var</span>&nbsp;<span class="ident" id="8454155">values</span>&nbsp;<span class="op" id="8454162">=</span>&nbsp;<span class="op" id="8454164">[</span><span class="op" id="8454165">]</span><span class="keyword" id="8454166">interface</span><span class="op" id="8454175">{</span><span class="op" id="8454176">}</span><span class="op" id="8454177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454181">true</span><span class="op" id="8454185">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454189">int</span><span class="op" id="8454192">(</span><span class="num" id="8454193">123</span><span class="op" id="8454196">)</span><span class="op" id="8454197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454201">int8</span><span class="op" id="8454205">(</span><span class="num" id="8454206">123</span><span class="op" id="8454209">)</span><span class="op" id="8454210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454214">int16</span><span class="op" id="8454219">(</span><span class="op" id="8454220">-</span><span class="num" id="8454221">12345</span><span class="op" id="8454226">)</span><span class="op" id="8454227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454231">int32</span><span class="op" id="8454236">(</span><span class="num" id="8454237">123456</span><span class="op" id="8454243">)</span><span class="op" id="8454244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454248">int64</span><span class="op" id="8454253">(</span><span class="op" id="8454254">-</span><span class="num" id="8454255">1234567</span><span class="op" id="8454262">)</span><span class="op" id="8454263">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454267">uint</span><span class="op" id="8454271">(</span><span class="num" id="8454272">123</span><span class="op" id="8454275">)</span><span class="op" id="8454276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454280">uint8</span><span class="op" id="8454285">(</span><span class="num" id="8454286">123</span><span class="op" id="8454289">)</span><span class="op" id="8454290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454294">uint16</span><span class="op" id="8454300">(</span><span class="num" id="8454301">12345</span><span class="op" id="8454306">)</span><span class="op" id="8454307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454311">uint32</span><span class="op" id="8454317">(</span><span class="num" id="8454318">123456</span><span class="op" id="8454324">)</span><span class="op" id="8454325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454329">uint64</span><span class="op" id="8454335">(</span><span class="num" id="8454336">1234567</span><span class="op" id="8454343">)</span><span class="op" id="8454344">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454348">uintptr</span><span class="op" id="8454355">(</span><span class="num" id="8454356">12345678</span><span class="op" id="8454364">)</span><span class="op" id="8454365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454369">float32</span><span class="op" id="8454376">(</span><span class="num" id="8454377">1.2345</span><span class="op" id="8454383">)</span><span class="op" id="8454384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454388">float64</span><span class="op" id="8454395">(</span><span class="num" id="8454396">1.2345678</span><span class="op" id="8454405">)</span><span class="op" id="8454406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454410">complex64</span><span class="op" id="8454419">(</span><span class="num" id="8454420">1.2345</span>&nbsp;<span class="op" id="8454427">+</span>&nbsp;<span class="num" id="8454429">2.3456i</span><span class="op" id="8454436">)</span><span class="op" id="8454437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454441">complex128</span><span class="op" id="8454451">(</span><span class="num" id="8454452">1.2345678</span>&nbsp;<span class="op" id="8454462">+</span>&nbsp;<span class="num" id="8454464">2.3456789i</span><span class="op" id="8454474">)</span><span class="op" id="8454475">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454479">[</span><span class="op" id="8454480">]</span><span class="builtintype" id="8454481">byte</span><span class="op" id="8454485">(</span><span class="string" id="8454486">&#34;hello&#34;</span><span class="op" id="8454493">)</span><span class="op" id="8454494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8454498">string</span><span class="op" id="8454504">(</span><span class="string" id="8454505">&#34;hello&#34;</span><span class="op" id="8454512">)</span><span class="op" id="8454513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454519">for</span>&nbsp;<span class="ident" id="8454523">_</span><span class="op" id="8454524">,</span>&nbsp;<span class="ident" id="8454526">value</span>&nbsp;<span class="op" id="8454532">:=</span>&nbsp;<span class="keyword" id="8454535">range</span>&nbsp;<span class="ident" id="8454541">values</span>&nbsp;<span class="op" id="8454548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454552">b</span>&nbsp;<span class="op" id="8454554">:=</span>&nbsp;<span class="builtinfunc" id="8454557">new</span><span class="op" id="8454560">(</span><span class="ident" id="8454561">bytes</span><span class="op" id="8454566">.</span><span class="ident" id="8454567">Buffer</span><span class="op" id="8454573">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454577">enc</span>&nbsp;<span class="op" id="8454581">:=</span>&nbsp;<span class="ident" id="8454584">NewEncoder</span><span class="op" id="8454594">(</span><span class="ident" id="8454595">b</span><span class="op" id="8454596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454600">err</span>&nbsp;<span class="op" id="8454604">:=</span>&nbsp;<span class="ident" id="8454607">enc</span><span class="op" id="8454610">.</span><span class="ident" id="8454611">Encode</span><span class="op" id="8454617">(</span><span class="ident" id="8454618">value</span><span class="op" id="8454623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454627">if</span>&nbsp;<span class="ident" id="8454630">err</span>&nbsp;<span class="op" id="8454634">!=</span>&nbsp;<span class="ident" id="8454637">nil</span>&nbsp;<span class="op" id="8454641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454646">t</span><span class="op" id="8454647">.</span><span class="ident" id="8454648">Error</span><span class="op" id="8454653">(</span><span class="string" id="8454654">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8454669">,</span>&nbsp;<span class="ident" id="8454671">err</span><span class="op" id="8454674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454678">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454682">dec</span>&nbsp;<span class="op" id="8454686">:=</span>&nbsp;<span class="ident" id="8454689">NewDecoder</span><span class="op" id="8454699">(</span><span class="ident" id="8454700">b</span><span class="op" id="8454701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454705">result</span>&nbsp;<span class="op" id="8454712">:=</span>&nbsp;<span class="ident" id="8454715">reflect</span><span class="op" id="8454722">.</span><span class="ident" id="8454723">New</span><span class="op" id="8454726">(</span><span class="ident" id="8454727">reflect</span><span class="op" id="8454734">.</span><span class="ident" id="8454735">TypeOf</span><span class="op" id="8454741">(</span><span class="ident" id="8454742">value</span><span class="op" id="8454747">)</span><span class="op" id="8454748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454752">err</span>&nbsp;<span class="op" id="8454756">=</span>&nbsp;<span class="ident" id="8454758">dec</span><span class="op" id="8454761">.</span><span class="ident" id="8454762">Decode</span><span class="op" id="8454768">(</span><span class="ident" id="8454769">result</span><span class="op" id="8454775">.</span><span class="ident" id="8454776">Interface</span><span class="op" id="8454785">(</span><span class="op" id="8454786">)</span><span class="op" id="8454787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454791">if</span>&nbsp;<span class="ident" id="8454794">err</span>&nbsp;<span class="op" id="8454798">!=</span>&nbsp;<span class="ident" id="8454801">nil</span>&nbsp;<span class="op" id="8454805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454810">t</span><span class="op" id="8454811">.</span><span class="ident" id="8454812">Fatalf</span><span class="op" id="8454818">(</span><span class="string" id="8454819">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="8454843">,</span>&nbsp;<span class="ident" id="8454845">reflect</span><span class="op" id="8454852">.</span><span class="ident" id="8454853">TypeOf</span><span class="op" id="8454859">(</span><span class="ident" id="8454860">value</span><span class="op" id="8454865">)</span><span class="op" id="8454866">,</span>&nbsp;<span class="ident" id="8454868">err</span><span class="op" id="8454871">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454879">if</span>&nbsp;<span class="op" id="8454882">!</span><span class="ident" id="8454883">reflect</span><span class="op" id="8454890">.</span><span class="ident" id="8454891">DeepEqual</span><span class="op" id="8454900">(</span><span class="ident" id="8454901">value</span><span class="op" id="8454906">,</span>&nbsp;<span class="ident" id="8454908">result</span><span class="op" id="8454914">.</span><span class="ident" id="8454915">Elem</span><span class="op" id="8454919">(</span><span class="op" id="8454920">)</span><span class="op" id="8454921">.</span><span class="ident" id="8454922">Interface</span><span class="op" id="8454931">(</span><span class="op" id="8454932">)</span><span class="op" id="8454933">)</span>&nbsp;<span class="op" id="8454935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454940">t</span><span class="op" id="8454941">.</span><span class="ident" id="8454942">Fatalf</span><span class="op" id="8454948">(</span><span class="string" id="8454949">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8454973">,</span>&nbsp;<span class="ident" id="8454975">value</span><span class="op" id="8454980">,</span>&nbsp;<span class="ident" id="8454982">value</span><span class="op" id="8454987">,</span>&nbsp;<span class="ident" id="8454989">result</span><span class="op" id="8454995">.</span><span class="ident" id="8454996">Elem</span><span class="op" id="8455000">(</span><span class="op" id="8455001">)</span><span class="op" id="8455002">.</span><span class="ident" id="8455003">Interface</span><span class="op" id="8455012">(</span><span class="op" id="8455013">)</span><span class="op" id="8455014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455021">}</span><br>
<span class="lineno">55</span><span class="op" id="8455023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8455026">type</span>&nbsp;<span class="ident" id="8455031">ET0</span>&nbsp;<span class="keyword" id="8455035">struct</span>&nbsp;<span class="op" id="8455042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455045">A</span>&nbsp;<span class="builtintype" id="8455047">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455052">B</span>&nbsp;<span class="builtintype" id="8455054">string</span><br>
<span class="lineno">60</span><span class="op" id="8455061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8455064">type</span>&nbsp;<span class="ident" id="8455069">ET2</span>&nbsp;<span class="keyword" id="8455073">struct</span>&nbsp;<span class="op" id="8455080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455083">X</span>&nbsp;<span class="builtintype" id="8455085">string</span><br>
<span class="lineno"></span><span class="op" id="8455092">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8455095">type</span>&nbsp;<span class="ident" id="8455100">ET1</span>&nbsp;<span class="keyword" id="8455104">struct</span>&nbsp;<span class="op" id="8455111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455114">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8455119">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455124">Et2</span>&nbsp;&nbsp;<span class="op" id="8455129">*</span><span class="ident" id="8455130">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455135">Next</span>&nbsp;<span class="op" id="8455140">*</span><span class="ident" id="8455141">ET1</span><br>
<span class="lineno">70</span><span class="op" id="8455145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8455148">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="8455198">type</span>&nbsp;<span class="ident" id="8455203">ET3</span>&nbsp;<span class="keyword" id="8455207">struct</span>&nbsp;<span class="op" id="8455214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455217">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8455231">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455236">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455250">*</span><span class="ident" id="8455251">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455256">DifferentNext</span>&nbsp;<span class="op" id="8455270">*</span><span class="ident" id="8455271">ET1</span><br>
<span class="lineno"></span><span class="op" id="8455275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8455278">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="8455328">type</span>&nbsp;<span class="ident" id="8455333">ET4</span>&nbsp;<span class="keyword" id="8455337">struct</span>&nbsp;<span class="op" id="8455344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455347">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8455352">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455357">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="8455362">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455371">Next</span>&nbsp;<span class="builtintype" id="8455376">int</span><br>
<span class="lineno"></span><span class="op" id="8455380">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8455383">func</span>&nbsp;<span class="ident" id="8455388">TestEncoderDecoder</span><span class="op" id="8455406">(</span><span class="ident" id="8455407">t</span>&nbsp;<span class="op" id="8455409">*</span><span class="ident" id="8455410">testing</span><span class="op" id="8455417">.</span><span class="ident" id="8455418">T</span><span class="op" id="8455419">)</span>&nbsp;<span class="op" id="8455421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455424">b</span>&nbsp;<span class="op" id="8455426">:=</span>&nbsp;<span class="builtinfunc" id="8455429">new</span><span class="op" id="8455432">(</span><span class="ident" id="8455433">bytes</span><span class="op" id="8455438">.</span><span class="ident" id="8455439">Buffer</span><span class="op" id="8455445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455448">enc</span>&nbsp;<span class="op" id="8455452">:=</span>&nbsp;<span class="ident" id="8455455">NewEncoder</span><span class="op" id="8455465">(</span><span class="ident" id="8455466">b</span><span class="op" id="8455467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455470">et0</span>&nbsp;<span class="op" id="8455474">:=</span>&nbsp;<span class="builtinfunc" id="8455477">new</span><span class="op" id="8455480">(</span><span class="ident" id="8455481">ET0</span><span class="op" id="8455484">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455487">et0</span><span class="op" id="8455490">.</span><span class="ident" id="8455491">A</span>&nbsp;<span class="op" id="8455493">=</span>&nbsp;<span class="num" id="8455495">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455498">et0</span><span class="op" id="8455501">.</span><span class="ident" id="8455502">B</span>&nbsp;<span class="op" id="8455504">=</span>&nbsp;<span class="string" id="8455506">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455521">err</span>&nbsp;<span class="op" id="8455525">:=</span>&nbsp;<span class="ident" id="8455528">enc</span><span class="op" id="8455531">.</span><span class="ident" id="8455532">Encode</span><span class="op" id="8455538">(</span><span class="ident" id="8455539">et0</span><span class="op" id="8455542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455545">if</span>&nbsp;<span class="ident" id="8455548">err</span>&nbsp;<span class="op" id="8455552">!=</span>&nbsp;<span class="ident" id="8455555">nil</span>&nbsp;<span class="op" id="8455559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455563">t</span><span class="op" id="8455564">.</span><span class="ident" id="8455565">Error</span><span class="op" id="8455570">(</span><span class="string" id="8455571">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8455586">,</span>&nbsp;<span class="ident" id="8455588">err</span><span class="op" id="8455591">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455597">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455629">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455641">dec</span>&nbsp;<span class="op" id="8455645">:=</span>&nbsp;<span class="ident" id="8455648">NewDecoder</span><span class="op" id="8455658">(</span><span class="ident" id="8455659">b</span><span class="op" id="8455660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455663">newEt0</span>&nbsp;<span class="op" id="8455670">:=</span>&nbsp;<span class="builtinfunc" id="8455673">new</span><span class="op" id="8455676">(</span><span class="ident" id="8455677">ET0</span><span class="op" id="8455680">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455683">err</span>&nbsp;<span class="op" id="8455687">=</span>&nbsp;<span class="ident" id="8455689">dec</span><span class="op" id="8455692">.</span><span class="ident" id="8455693">Decode</span><span class="op" id="8455699">(</span><span class="ident" id="8455700">newEt0</span><span class="op" id="8455706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455709">if</span>&nbsp;<span class="ident" id="8455712">err</span>&nbsp;<span class="op" id="8455716">!=</span>&nbsp;<span class="ident" id="8455719">nil</span>&nbsp;<span class="op" id="8455723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455727">t</span><span class="op" id="8455728">.</span><span class="ident" id="8455729">Fatal</span><span class="op" id="8455734">(</span><span class="string" id="8455735">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="8455756">,</span>&nbsp;<span class="ident" id="8455758">err</span><span class="op" id="8455761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455768">if</span>&nbsp;<span class="op" id="8455771">!</span><span class="ident" id="8455772">reflect</span><span class="op" id="8455779">.</span><span class="ident" id="8455780">DeepEqual</span><span class="op" id="8455789">(</span><span class="ident" id="8455790">et0</span><span class="op" id="8455793">,</span>&nbsp;<span class="ident" id="8455795">newEt0</span><span class="op" id="8455801">)</span>&nbsp;<span class="op" id="8455803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455807">t</span><span class="op" id="8455808">.</span><span class="ident" id="8455809">Fatalf</span><span class="op" id="8455815">(</span><span class="string" id="8455816">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8455861">,</span>&nbsp;<span class="op" id="8455863">*</span><span class="ident" id="8455864">et0</span><span class="op" id="8455867">,</span>&nbsp;<span class="op" id="8455869">*</span><span class="ident" id="8455870">newEt0</span><span class="op" id="8455876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455882">if</span>&nbsp;<span class="ident" id="8455885">b</span><span class="op" id="8455886">.</span><span class="ident" id="8455887">Len</span><span class="op" id="8455890">(</span><span class="op" id="8455891">)</span>&nbsp;<span class="op" id="8455893">!=</span>&nbsp;<span class="num" id="8455896">0</span>&nbsp;<span class="op" id="8455898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455902">t</span><span class="op" id="8455903">.</span><span class="ident" id="8455904">Error</span><span class="op" id="8455909">(</span><span class="string" id="8455910">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8455923">,</span>&nbsp;<span class="ident" id="8455925">b</span><span class="op" id="8455926">.</span><span class="ident" id="8455927">Len</span><span class="op" id="8455930">(</span><span class="op" id="8455931">)</span><span class="op" id="8455932">,</span>&nbsp;<span class="string" id="8455934">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8455946">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455952">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455969">b</span>&nbsp;<span class="op" id="8455971">=</span>&nbsp;<span class="builtinfunc" id="8455973">new</span><span class="op" id="8455976">(</span><span class="ident" id="8455977">bytes</span><span class="op" id="8455982">.</span><span class="ident" id="8455983">Buffer</span><span class="op" id="8455989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455992">enc</span>&nbsp;<span class="op" id="8455996">=</span>&nbsp;<span class="ident" id="8455998">NewEncoder</span><span class="op" id="8456008">(</span><span class="ident" id="8456009">b</span><span class="op" id="8456010">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456013">et1</span>&nbsp;<span class="op" id="8456017">:=</span>&nbsp;<span class="builtinfunc" id="8456020">new</span><span class="op" id="8456023">(</span><span class="ident" id="8456024">ET1</span><span class="op" id="8456027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456030">et1</span><span class="op" id="8456033">.</span><span class="ident" id="8456034">A</span>&nbsp;<span class="op" id="8456036">=</span>&nbsp;<span class="num" id="8456038">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456041">et1</span><span class="op" id="8456044">.</span><span class="ident" id="8456045">Et2</span>&nbsp;<span class="op" id="8456049">=</span>&nbsp;<span class="builtinfunc" id="8456051">new</span><span class="op" id="8456054">(</span><span class="ident" id="8456055">ET2</span><span class="op" id="8456058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456061">err</span>&nbsp;<span class="op" id="8456065">=</span>&nbsp;<span class="ident" id="8456067">enc</span><span class="op" id="8456070">.</span><span class="ident" id="8456071">Encode</span><span class="op" id="8456077">(</span><span class="ident" id="8456078">et1</span><span class="op" id="8456081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456084">if</span>&nbsp;<span class="ident" id="8456087">err</span>&nbsp;<span class="op" id="8456091">!=</span>&nbsp;<span class="ident" id="8456094">nil</span>&nbsp;<span class="op" id="8456098">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456102">t</span><span class="op" id="8456103">.</span><span class="ident" id="8456104">Error</span><span class="op" id="8456109">(</span><span class="string" id="8456110">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8456125">,</span>&nbsp;<span class="ident" id="8456127">err</span><span class="op" id="8456130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456136">dec</span>&nbsp;<span class="op" id="8456140">=</span>&nbsp;<span class="ident" id="8456142">NewDecoder</span><span class="op" id="8456152">(</span><span class="ident" id="8456153">b</span><span class="op" id="8456154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456157">newEt1</span>&nbsp;<span class="op" id="8456164">:=</span>&nbsp;<span class="builtinfunc" id="8456167">new</span><span class="op" id="8456170">(</span><span class="ident" id="8456171">ET1</span><span class="op" id="8456174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456177">err</span>&nbsp;<span class="op" id="8456181">=</span>&nbsp;<span class="ident" id="8456183">dec</span><span class="op" id="8456186">.</span><span class="ident" id="8456187">Decode</span><span class="op" id="8456193">(</span><span class="ident" id="8456194">newEt1</span><span class="op" id="8456200">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456203">if</span>&nbsp;<span class="ident" id="8456206">err</span>&nbsp;<span class="op" id="8456210">!=</span>&nbsp;<span class="ident" id="8456213">nil</span>&nbsp;<span class="op" id="8456217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456221">t</span><span class="op" id="8456222">.</span><span class="ident" id="8456223">Fatal</span><span class="op" id="8456228">(</span><span class="string" id="8456229">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8456250">,</span>&nbsp;<span class="ident" id="8456252">err</span><span class="op" id="8456255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456262">if</span>&nbsp;<span class="op" id="8456265">!</span><span class="ident" id="8456266">reflect</span><span class="op" id="8456273">.</span><span class="ident" id="8456274">DeepEqual</span><span class="op" id="8456283">(</span><span class="ident" id="8456284">et1</span><span class="op" id="8456287">,</span>&nbsp;<span class="ident" id="8456289">newEt1</span><span class="op" id="8456295">)</span>&nbsp;<span class="op" id="8456297">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456301">t</span><span class="op" id="8456302">.</span><span class="ident" id="8456303">Fatalf</span><span class="op" id="8456309">(</span><span class="string" id="8456310">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8456355">,</span>&nbsp;<span class="op" id="8456357">*</span><span class="ident" id="8456358">et1</span><span class="op" id="8456361">,</span>&nbsp;<span class="op" id="8456363">*</span><span class="ident" id="8456364">newEt1</span><span class="op" id="8456370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456376">if</span>&nbsp;<span class="ident" id="8456379">b</span><span class="op" id="8456380">.</span><span class="ident" id="8456381">Len</span><span class="op" id="8456384">(</span><span class="op" id="8456385">)</span>&nbsp;<span class="op" id="8456387">!=</span>&nbsp;<span class="num" id="8456390">0</span>&nbsp;<span class="op" id="8456392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456396">t</span><span class="op" id="8456397">.</span><span class="ident" id="8456398">Error</span><span class="op" id="8456403">(</span><span class="string" id="8456404">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8456417">,</span>&nbsp;<span class="ident" id="8456419">b</span><span class="op" id="8456420">.</span><span class="ident" id="8456421">Len</span><span class="op" id="8456424">(</span><span class="op" id="8456425">)</span><span class="op" id="8456426">,</span>&nbsp;<span class="string" id="8456428">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8456440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456443">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456447">enc</span><span class="op" id="8456450">.</span><span class="ident" id="8456451">Encode</span><span class="op" id="8456457">(</span><span class="ident" id="8456458">et1</span><span class="op" id="8456461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456464">newEt1</span>&nbsp;<span class="op" id="8456471">=</span>&nbsp;<span class="builtinfunc" id="8456473">new</span><span class="op" id="8456476">(</span><span class="ident" id="8456477">ET1</span><span class="op" id="8456480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456483">err</span>&nbsp;<span class="op" id="8456487">=</span>&nbsp;<span class="ident" id="8456489">dec</span><span class="op" id="8456492">.</span><span class="ident" id="8456493">Decode</span><span class="op" id="8456499">(</span><span class="ident" id="8456500">newEt1</span><span class="op" id="8456506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456509">if</span>&nbsp;<span class="ident" id="8456512">err</span>&nbsp;<span class="op" id="8456516">!=</span>&nbsp;<span class="ident" id="8456519">nil</span>&nbsp;<span class="op" id="8456523">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456527">t</span><span class="op" id="8456528">.</span><span class="ident" id="8456529">Fatal</span><span class="op" id="8456534">(</span><span class="string" id="8456535">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8456565">,</span>&nbsp;<span class="ident" id="8456567">err</span><span class="op" id="8456570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456576">if</span>&nbsp;<span class="op" id="8456579">!</span><span class="ident" id="8456580">reflect</span><span class="op" id="8456587">.</span><span class="ident" id="8456588">DeepEqual</span><span class="op" id="8456597">(</span><span class="ident" id="8456598">et1</span><span class="op" id="8456601">,</span>&nbsp;<span class="ident" id="8456603">newEt1</span><span class="op" id="8456609">)</span>&nbsp;<span class="op" id="8456611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456615">t</span><span class="op" id="8456616">.</span><span class="ident" id="8456617">Fatalf</span><span class="op" id="8456623">(</span><span class="string" id="8456624">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8456678">,</span>&nbsp;<span class="op" id="8456680">*</span><span class="ident" id="8456681">et1</span><span class="op" id="8456684">,</span>&nbsp;<span class="op" id="8456686">*</span><span class="ident" id="8456687">newEt1</span><span class="op" id="8456693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456696">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456699">if</span>&nbsp;<span class="ident" id="8456702">b</span><span class="op" id="8456703">.</span><span class="ident" id="8456704">Len</span><span class="op" id="8456707">(</span><span class="op" id="8456708">)</span>&nbsp;<span class="op" id="8456710">!=</span>&nbsp;<span class="num" id="8456713">0</span>&nbsp;<span class="op" id="8456715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456719">t</span><span class="op" id="8456720">.</span><span class="ident" id="8456721">Error</span><span class="op" id="8456726">(</span><span class="string" id="8456727">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8456749">,</span>&nbsp;<span class="ident" id="8456751">b</span><span class="op" id="8456752">.</span><span class="ident" id="8456753">Len</span><span class="op" id="8456756">(</span><span class="op" id="8456757">)</span><span class="op" id="8456758">,</span>&nbsp;<span class="string" id="8456760">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8456772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456779">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456863">err</span>&nbsp;<span class="op" id="8456867">=</span>&nbsp;<span class="ident" id="8456869">enc</span><span class="op" id="8456872">.</span><span class="ident" id="8456873">Encode</span><span class="op" id="8456879">(</span><span class="ident" id="8456880">et1</span><span class="op" id="8456883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456886">if</span>&nbsp;<span class="ident" id="8456889">err</span>&nbsp;<span class="op" id="8456893">!=</span>&nbsp;<span class="ident" id="8456896">nil</span>&nbsp;<span class="op" id="8456900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456904">t</span><span class="op" id="8456905">.</span><span class="ident" id="8456906">Error</span><span class="op" id="8456911">(</span><span class="string" id="8456912">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="8456936">,</span>&nbsp;<span class="ident" id="8456938">err</span><span class="op" id="8456941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456947">newEt2</span>&nbsp;<span class="op" id="8456954">:=</span>&nbsp;<span class="builtinfunc" id="8456957">new</span><span class="op" id="8456960">(</span><span class="ident" id="8456961">ET2</span><span class="op" id="8456964">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456967">err</span>&nbsp;<span class="op" id="8456971">=</span>&nbsp;<span class="ident" id="8456973">dec</span><span class="op" id="8456976">.</span><span class="ident" id="8456977">Decode</span><span class="op" id="8456983">(</span><span class="ident" id="8456984">newEt2</span><span class="op" id="8456990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456993">if</span>&nbsp;<span class="ident" id="8456996">err</span>&nbsp;<span class="op" id="8457000">==</span>&nbsp;<span class="ident" id="8457003">nil</span>&nbsp;<span class="op" id="8457007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457011">t</span><span class="op" id="8457012">.</span><span class="ident" id="8457013">Fatal</span><span class="op" id="8457018">(</span><span class="string" id="8457019">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="8457068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457071">}</span><br>
<span class="lineno"></span><span class="op" id="8457073">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8457076">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="8457146">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="8457213">func</span>&nbsp;<span class="ident" id="8457218">badTypeCheck</span><span class="op" id="8457230">(</span><span class="ident" id="8457231">e</span>&nbsp;<span class="keyword" id="8457233">interface</span><span class="op" id="8457242">{</span><span class="op" id="8457243">}</span><span class="op" id="8457244">,</span>&nbsp;<span class="ident" id="8457246">shouldFail</span>&nbsp;<span class="builtintype" id="8457257">bool</span><span class="op" id="8457261">,</span>&nbsp;<span class="ident" id="8457263">msg</span>&nbsp;<span class="builtintype" id="8457267">string</span><span class="op" id="8457273">,</span>&nbsp;<span class="ident" id="8457275">t</span>&nbsp;<span class="op" id="8457277">*</span><span class="ident" id="8457278">testing</span><span class="op" id="8457285">.</span><span class="ident" id="8457286">T</span><span class="op" id="8457287">)</span>&nbsp;<span class="op" id="8457289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457292">b</span>&nbsp;<span class="op" id="8457294">:=</span>&nbsp;<span class="builtinfunc" id="8457297">new</span><span class="op" id="8457300">(</span><span class="ident" id="8457301">bytes</span><span class="op" id="8457306">.</span><span class="ident" id="8457307">Buffer</span><span class="op" id="8457313">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457316">enc</span>&nbsp;<span class="op" id="8457320">:=</span>&nbsp;<span class="ident" id="8457323">NewEncoder</span><span class="op" id="8457333">(</span><span class="ident" id="8457334">b</span><span class="op" id="8457335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457338">et1</span>&nbsp;<span class="op" id="8457342">:=</span>&nbsp;<span class="builtinfunc" id="8457345">new</span><span class="op" id="8457348">(</span><span class="ident" id="8457349">ET1</span><span class="op" id="8457352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457355">et1</span><span class="op" id="8457358">.</span><span class="ident" id="8457359">A</span>&nbsp;<span class="op" id="8457361">=</span>&nbsp;<span class="num" id="8457363">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457366">et1</span><span class="op" id="8457369">.</span><span class="ident" id="8457370">Et2</span>&nbsp;<span class="op" id="8457374">=</span>&nbsp;<span class="builtinfunc" id="8457376">new</span><span class="op" id="8457379">(</span><span class="ident" id="8457380">ET2</span><span class="op" id="8457383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457386">err</span>&nbsp;<span class="op" id="8457390">:=</span>&nbsp;<span class="ident" id="8457393">enc</span><span class="op" id="8457396">.</span><span class="ident" id="8457397">Encode</span><span class="op" id="8457403">(</span><span class="ident" id="8457404">et1</span><span class="op" id="8457407">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457410">if</span>&nbsp;<span class="ident" id="8457413">err</span>&nbsp;<span class="op" id="8457417">!=</span>&nbsp;<span class="ident" id="8457420">nil</span>&nbsp;<span class="op" id="8457424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457428">t</span><span class="op" id="8457429">.</span><span class="ident" id="8457430">Error</span><span class="op" id="8457435">(</span><span class="string" id="8457436">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8457451">,</span>&nbsp;<span class="ident" id="8457453">err</span><span class="op" id="8457456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457462">dec</span>&nbsp;<span class="op" id="8457466">:=</span>&nbsp;<span class="ident" id="8457469">NewDecoder</span><span class="op" id="8457479">(</span><span class="ident" id="8457480">b</span><span class="op" id="8457481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457484">err</span>&nbsp;<span class="op" id="8457488">=</span>&nbsp;<span class="ident" id="8457490">dec</span><span class="op" id="8457493">.</span><span class="ident" id="8457494">Decode</span><span class="op" id="8457500">(</span><span class="ident" id="8457501">e</span><span class="op" id="8457502">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457505">if</span>&nbsp;<span class="ident" id="8457508">shouldFail</span>&nbsp;<span class="op" id="8457519">&amp;&amp;</span>&nbsp;<span class="ident" id="8457522">err</span>&nbsp;<span class="op" id="8457526">==</span>&nbsp;<span class="ident" id="8457529">nil</span>&nbsp;<span class="op" id="8457533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457537">t</span><span class="op" id="8457538">.</span><span class="ident" id="8457539">Error</span><span class="op" id="8457544">(</span><span class="string" id="8457545">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8457565">,</span>&nbsp;<span class="ident" id="8457567">msg</span><span class="op" id="8457570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457576">if</span>&nbsp;<span class="op" id="8457579">!</span><span class="ident" id="8457580">shouldFail</span>&nbsp;<span class="op" id="8457591">&amp;&amp;</span>&nbsp;<span class="ident" id="8457594">err</span>&nbsp;<span class="op" id="8457598">!=</span>&nbsp;<span class="ident" id="8457601">nil</span>&nbsp;<span class="op" id="8457605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457609">t</span><span class="op" id="8457610">.</span><span class="ident" id="8457611">Error</span><span class="op" id="8457616">(</span><span class="string" id="8457617">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8457639">,</span>&nbsp;<span class="ident" id="8457641">msg</span><span class="op" id="8457644">,</span>&nbsp;<span class="ident" id="8457646">err</span><span class="op" id="8457649">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457652">}</span><br>
<span class="lineno"></span><span class="op" id="8457654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8457657">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="8457710">func</span>&nbsp;<span class="ident" id="8457715">TestWrongTypeDecoder</span><span class="op" id="8457735">(</span><span class="ident" id="8457736">t</span>&nbsp;<span class="op" id="8457738">*</span><span class="ident" id="8457739">testing</span><span class="op" id="8457746">.</span><span class="ident" id="8457747">T</span><span class="op" id="8457748">)</span>&nbsp;<span class="op" id="8457750">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457753">badTypeCheck</span><span class="op" id="8457765">(</span><span class="builtinfunc" id="8457766">new</span><span class="op" id="8457769">(</span><span class="ident" id="8457770">ET2</span><span class="op" id="8457773">)</span><span class="op" id="8457774">,</span>&nbsp;<span class="builtintype" id="8457776">true</span><span class="op" id="8457780">,</span>&nbsp;<span class="string" id="8457782">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="8457803">,</span>&nbsp;<span class="ident" id="8457805">t</span><span class="op" id="8457806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457809">badTypeCheck</span><span class="op" id="8457821">(</span><span class="builtinfunc" id="8457822">new</span><span class="op" id="8457825">(</span><span class="ident" id="8457826">ET3</span><span class="op" id="8457829">)</span><span class="op" id="8457830">,</span>&nbsp;<span class="builtintype" id="8457832">false</span><span class="op" id="8457837">,</span>&nbsp;<span class="string" id="8457839">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="8457864">,</span>&nbsp;<span class="ident" id="8457866">t</span><span class="op" id="8457867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457870">badTypeCheck</span><span class="op" id="8457882">(</span><span class="builtinfunc" id="8457883">new</span><span class="op" id="8457886">(</span><span class="ident" id="8457887">ET4</span><span class="op" id="8457890">)</span><span class="op" id="8457891">,</span>&nbsp;<span class="builtintype" id="8457893">true</span><span class="op" id="8457897">,</span>&nbsp;<span class="string" id="8457899">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="8457924">,</span>&nbsp;<span class="ident" id="8457926">t</span><span class="op" id="8457927">)</span><br>
<span class="lineno"></span><span class="op" id="8457929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8457932">func</span>&nbsp;<span class="ident" id="8457937">corruptDataCheck</span><span class="op" id="8457953">(</span><span class="ident" id="8457954">s</span>&nbsp;<span class="builtintype" id="8457956">string</span><span class="op" id="8457962">,</span>&nbsp;<span class="ident" id="8457964">err</span>&nbsp;<span class="builtintype" id="8457968">error</span><span class="op" id="8457973">,</span>&nbsp;<span class="ident" id="8457975">t</span>&nbsp;<span class="op" id="8457977">*</span><span class="ident" id="8457978">testing</span><span class="op" id="8457985">.</span><span class="ident" id="8457986">T</span><span class="op" id="8457987">)</span>&nbsp;<span class="op" id="8457989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457992">b</span>&nbsp;<span class="op" id="8457994">:=</span>&nbsp;<span class="ident" id="8457997">bytes</span><span class="op" id="8458002">.</span><span class="ident" id="8458003">NewBufferString</span><span class="op" id="8458018">(</span><span class="ident" id="8458019">s</span><span class="op" id="8458020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458023">dec</span>&nbsp;<span class="op" id="8458027">:=</span>&nbsp;<span class="ident" id="8458030">NewDecoder</span><span class="op" id="8458040">(</span><span class="ident" id="8458041">b</span><span class="op" id="8458042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458045">err1</span>&nbsp;<span class="op" id="8458050">:=</span>&nbsp;<span class="ident" id="8458053">dec</span><span class="op" id="8458056">.</span><span class="ident" id="8458057">Decode</span><span class="op" id="8458063">(</span><span class="builtinfunc" id="8458064">new</span><span class="op" id="8458067">(</span><span class="ident" id="8458068">ET2</span><span class="op" id="8458071">)</span><span class="op" id="8458072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458075">if</span>&nbsp;<span class="ident" id="8458078">err1</span>&nbsp;<span class="op" id="8458083">!=</span>&nbsp;<span class="ident" id="8458086">err</span>&nbsp;<span class="op" id="8458090">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458094">t</span><span class="op" id="8458095">.</span><span class="ident" id="8458096">Errorf</span><span class="op" id="8458102">(</span><span class="string" id="8458103">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8458138">,</span>&nbsp;<span class="ident" id="8458140">s</span><span class="op" id="8458141">,</span>&nbsp;<span class="ident" id="8458143">err</span><span class="op" id="8458146">,</span>&nbsp;<span class="ident" id="8458148">err1</span><span class="op" id="8458152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458155">}</span><br>
<span class="lineno"></span><span class="op" id="8458157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8458160">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="8458195">func</span>&nbsp;<span class="ident" id="8458200">TestBadData</span><span class="op" id="8458211">(</span><span class="ident" id="8458212">t</span>&nbsp;<span class="op" id="8458214">*</span><span class="ident" id="8458215">testing</span><span class="op" id="8458222">.</span><span class="ident" id="8458223">T</span><span class="op" id="8458224">)</span>&nbsp;<span class="op" id="8458226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458229">corruptDataCheck</span><span class="op" id="8458245">(</span><span class="string" id="8458246">&#34;&#34;</span><span class="op" id="8458248">,</span>&nbsp;<span class="ident" id="8458250">io</span><span class="op" id="8458252">.</span><span class="ident" id="8458253">EOF</span><span class="op" id="8458256">,</span>&nbsp;<span class="ident" id="8458258">t</span><span class="op" id="8458259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458262">corruptDataCheck</span><span class="op" id="8458278">(</span><span class="string" id="8458279">&#34;\x7Fhi&#34;</span><span class="op" id="8458287">,</span>&nbsp;<span class="ident" id="8458289">io</span><span class="op" id="8458291">.</span><span class="ident" id="8458292">ErrUnexpectedEOF</span><span class="op" id="8458308">,</span>&nbsp;<span class="ident" id="8458310">t</span><span class="op" id="8458311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458314">corruptDataCheck</span><span class="op" id="8458330">(</span><span class="string" id="8458331">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="8458369">,</span>&nbsp;<span class="ident" id="8458371">errBadType</span><span class="op" id="8458381">,</span>&nbsp;<span class="ident" id="8458383">t</span><span class="op" id="8458384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8458387">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458403">corruptDataCheck</span><span class="op" id="8458419">(</span><span class="string" id="8458420">&#34;\x04\x24foo&#34;</span><span class="op" id="8458433">,</span>&nbsp;<span class="ident" id="8458435">errRange</span><span class="op" id="8458443">,</span>&nbsp;<span class="ident" id="8458445">t</span><span class="op" id="8458446">)</span><br>
<span class="lineno"></span><span class="op" id="8458448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8458451">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="8458503">var</span>&nbsp;<span class="ident" id="8458507">unsupportedValues</span>&nbsp;<span class="op" id="8458525">=</span>&nbsp;<span class="op" id="8458527">[</span><span class="op" id="8458528">]</span><span class="keyword" id="8458529">interface</span><span class="op" id="8458538">{</span><span class="op" id="8458539">}</span><span class="op" id="8458540">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8458543">make</span><span class="op" id="8458547">(</span><span class="keyword" id="8458548">chan</span>&nbsp;<span class="builtintype" id="8458553">int</span><span class="op" id="8458556">)</span><span class="op" id="8458557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458560">func</span><span class="op" id="8458564">(</span><span class="ident" id="8458565">a</span>&nbsp;<span class="builtintype" id="8458567">int</span><span class="op" id="8458570">)</span>&nbsp;<span class="builtintype" id="8458572">bool</span>&nbsp;<span class="op" id="8458577">{</span>&nbsp;<span class="keyword" id="8458579">return</span>&nbsp;<span class="builtintype" id="8458586">true</span>&nbsp;<span class="op" id="8458591">}</span><span class="op" id="8458592">,</span><br>
<span class="lineno"></span><span class="op" id="8458594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8458597">func</span>&nbsp;<span class="ident" id="8458602">TestUnsupported</span><span class="op" id="8458617">(</span><span class="ident" id="8458618">t</span>&nbsp;<span class="op" id="8458620">*</span><span class="ident" id="8458621">testing</span><span class="op" id="8458628">.</span><span class="ident" id="8458629">T</span><span class="op" id="8458630">)</span>&nbsp;<span class="op" id="8458632">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458635">var</span>&nbsp;<span class="ident" id="8458639">b</span>&nbsp;<span class="ident" id="8458641">bytes</span><span class="op" id="8458646">.</span><span class="ident" id="8458647">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458655">enc</span>&nbsp;<span class="op" id="8458659">:=</span>&nbsp;<span class="ident" id="8458662">NewEncoder</span><span class="op" id="8458672">(</span><span class="op" id="8458673">&amp;</span><span class="ident" id="8458674">b</span><span class="op" id="8458675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458678">for</span>&nbsp;<span class="ident" id="8458682">_</span><span class="op" id="8458683">,</span>&nbsp;<span class="ident" id="8458685">v</span>&nbsp;<span class="op" id="8458687">:=</span>&nbsp;<span class="keyword" id="8458690">range</span>&nbsp;<span class="ident" id="8458696">unsupportedValues</span>&nbsp;<span class="op" id="8458714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458718">err</span>&nbsp;<span class="op" id="8458722">:=</span>&nbsp;<span class="ident" id="8458725">enc</span><span class="op" id="8458728">.</span><span class="ident" id="8458729">Encode</span><span class="op" id="8458735">(</span><span class="ident" id="8458736">v</span><span class="op" id="8458737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458741">if</span>&nbsp;<span class="ident" id="8458744">err</span>&nbsp;<span class="op" id="8458748">==</span>&nbsp;<span class="ident" id="8458751">nil</span>&nbsp;<span class="op" id="8458755">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458760">t</span><span class="op" id="8458761">.</span><span class="ident" id="8458762">Errorf</span><span class="op" id="8458768">(</span><span class="string" id="8458769">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="8458802">,</span>&nbsp;<span class="ident" id="8458804">v</span><span class="op" id="8458805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458812">}</span><br>
<span class="lineno"></span><span class="op" id="8458814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8458817">func</span>&nbsp;<span class="ident" id="8458822">encAndDec</span><span class="op" id="8458831">(</span><span class="ident" id="8458832">in</span><span class="op" id="8458834">,</span>&nbsp;<span class="ident" id="8458836">out</span>&nbsp;<span class="keyword" id="8458840">interface</span><span class="op" id="8458849">{</span><span class="op" id="8458850">}</span><span class="op" id="8458851">)</span>&nbsp;<span class="builtintype" id="8458853">error</span>&nbsp;<span class="op" id="8458859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458862">b</span>&nbsp;<span class="op" id="8458864">:=</span>&nbsp;<span class="builtinfunc" id="8458867">new</span><span class="op" id="8458870">(</span><span class="ident" id="8458871">bytes</span><span class="op" id="8458876">.</span><span class="ident" id="8458877">Buffer</span><span class="op" id="8458883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458886">enc</span>&nbsp;<span class="op" id="8458890">:=</span>&nbsp;<span class="ident" id="8458893">NewEncoder</span><span class="op" id="8458903">(</span><span class="ident" id="8458904">b</span><span class="op" id="8458905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458908">err</span>&nbsp;<span class="op" id="8458912">:=</span>&nbsp;<span class="ident" id="8458915">enc</span><span class="op" id="8458918">.</span><span class="ident" id="8458919">Encode</span><span class="op" id="8458925">(</span><span class="ident" id="8458926">in</span><span class="op" id="8458928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458931">if</span>&nbsp;<span class="ident" id="8458934">err</span>&nbsp;<span class="op" id="8458938">!=</span>&nbsp;<span class="ident" id="8458941">nil</span>&nbsp;<span class="op" id="8458945">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458949">return</span>&nbsp;<span class="ident" id="8458956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458964">dec</span>&nbsp;<span class="op" id="8458968">:=</span>&nbsp;<span class="ident" id="8458971">NewDecoder</span><span class="op" id="8458981">(</span><span class="ident" id="8458982">b</span><span class="op" id="8458983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458986">err</span>&nbsp;<span class="op" id="8458990">=</span>&nbsp;<span class="ident" id="8458992">dec</span><span class="op" id="8458995">.</span><span class="ident" id="8458996">Decode</span><span class="op" id="8459002">(</span><span class="ident" id="8459003">out</span><span class="op" id="8459006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459009">if</span>&nbsp;<span class="ident" id="8459012">err</span>&nbsp;<span class="op" id="8459016">!=</span>&nbsp;<span class="ident" id="8459019">nil</span>&nbsp;<span class="op" id="8459023">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459027">return</span>&nbsp;<span class="ident" id="8459034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459042">return</span>&nbsp;<span class="ident" id="8459049">nil</span><br>
<span class="lineno"></span><span class="op" id="8459053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8459056">func</span>&nbsp;<span class="ident" id="8459061">TestTypeToPtrType</span><span class="op" id="8459078">(</span><span class="ident" id="8459079">t</span>&nbsp;<span class="op" id="8459081">*</span><span class="ident" id="8459082">testing</span><span class="op" id="8459089">.</span><span class="ident" id="8459090">T</span><span class="op" id="8459091">)</span>&nbsp;<span class="op" id="8459093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8459096">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459124">type</span>&nbsp;<span class="ident" id="8459129">Type0</span>&nbsp;<span class="keyword" id="8459135">struct</span>&nbsp;<span class="op" id="8459142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459146">A</span>&nbsp;<span class="builtintype" id="8459148">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459153">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459156">t0</span>&nbsp;<span class="op" id="8459159">:=</span>&nbsp;<span class="ident" id="8459162">Type0</span><span class="op" id="8459167">{</span><span class="num" id="8459168">7</span><span class="op" id="8459169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459172">t0p</span>&nbsp;<span class="op" id="8459176">:=</span>&nbsp;<span class="builtinfunc" id="8459179">new</span><span class="op" id="8459182">(</span><span class="ident" id="8459183">Type0</span><span class="op" id="8459188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459191">if</span>&nbsp;<span class="ident" id="8459194">err</span>&nbsp;<span class="op" id="8459198">:=</span>&nbsp;<span class="ident" id="8459201">encAndDec</span><span class="op" id="8459210">(</span><span class="ident" id="8459211">t0</span><span class="op" id="8459213">,</span>&nbsp;<span class="ident" id="8459215">t0p</span><span class="op" id="8459218">)</span><span class="op" id="8459219">;</span>&nbsp;<span class="ident" id="8459221">err</span>&nbsp;<span class="op" id="8459225">!=</span>&nbsp;<span class="ident" id="8459228">nil</span>&nbsp;<span class="op" id="8459232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459236">t</span><span class="op" id="8459237">.</span><span class="ident" id="8459238">Error</span><span class="op" id="8459243">(</span><span class="ident" id="8459244">err</span><span class="op" id="8459247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459250">}</span><br>
<span class="lineno">250</span><span class="op" id="8459252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459255">func</span>&nbsp;<span class="ident" id="8459260">TestPtrTypeToType</span><span class="op" id="8459277">(</span><span class="ident" id="8459278">t</span>&nbsp;<span class="op" id="8459280">*</span><span class="ident" id="8459281">testing</span><span class="op" id="8459288">.</span><span class="ident" id="8459289">T</span><span class="op" id="8459290">)</span>&nbsp;<span class="op" id="8459292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8459295">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459323">type</span>&nbsp;<span class="ident" id="8459328">Type1</span>&nbsp;<span class="keyword" id="8459334">struct</span>&nbsp;<span class="op" id="8459341">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459345">A</span>&nbsp;<span class="builtintype" id="8459347">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459356">t1p</span>&nbsp;<span class="op" id="8459360">:=</span>&nbsp;<span class="op" id="8459363">&amp;</span><span class="ident" id="8459364">Type1</span><span class="op" id="8459369">{</span><span class="num" id="8459370">17</span><span class="op" id="8459372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459375">var</span>&nbsp;<span class="ident" id="8459379">t1</span>&nbsp;<span class="ident" id="8459382">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459389">if</span>&nbsp;<span class="ident" id="8459392">err</span>&nbsp;<span class="op" id="8459396">:=</span>&nbsp;<span class="ident" id="8459399">encAndDec</span><span class="op" id="8459408">(</span><span class="ident" id="8459409">t1</span><span class="op" id="8459411">,</span>&nbsp;<span class="ident" id="8459413">t1p</span><span class="op" id="8459416">)</span><span class="op" id="8459417">;</span>&nbsp;<span class="ident" id="8459419">err</span>&nbsp;<span class="op" id="8459423">!=</span>&nbsp;<span class="ident" id="8459426">nil</span>&nbsp;<span class="op" id="8459430">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459434">t</span><span class="op" id="8459435">.</span><span class="ident" id="8459436">Error</span><span class="op" id="8459441">(</span><span class="ident" id="8459442">err</span><span class="op" id="8459445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459448">}</span><br>
<span class="lineno"></span><span class="op" id="8459450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459453">func</span>&nbsp;<span class="ident" id="8459458">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="8459484">(</span><span class="ident" id="8459485">t</span>&nbsp;<span class="op" id="8459487">*</span><span class="ident" id="8459488">testing</span><span class="op" id="8459495">.</span><span class="ident" id="8459496">T</span><span class="op" id="8459497">)</span>&nbsp;<span class="op" id="8459499">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459502">type</span>&nbsp;<span class="ident" id="8459507">Type2</span>&nbsp;<span class="keyword" id="8459513">struct</span>&nbsp;<span class="op" id="8459520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459524">A</span>&nbsp;<span class="op" id="8459526">*</span><span class="op" id="8459527">*</span><span class="op" id="8459528">*</span><span class="op" id="8459529">*</span><span class="builtintype" id="8459530">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459542">t2</span>&nbsp;<span class="op" id="8459545">:=</span>&nbsp;<span class="ident" id="8459548">Type2</span><span class="op" id="8459553">{</span><span class="op" id="8459554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459557">t2</span><span class="op" id="8459559">.</span><span class="ident" id="8459560">A</span>&nbsp;<span class="op" id="8459562">=</span>&nbsp;<span class="builtinfunc" id="8459564">new</span><span class="op" id="8459567">(</span><span class="op" id="8459568">*</span><span class="op" id="8459569">*</span><span class="op" id="8459570">*</span><span class="builtintype" id="8459571">float64</span><span class="op" id="8459578">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459581">*</span><span class="ident" id="8459582">t2</span><span class="op" id="8459584">.</span><span class="ident" id="8459585">A</span>&nbsp;<span class="op" id="8459587">=</span>&nbsp;<span class="builtinfunc" id="8459589">new</span><span class="op" id="8459592">(</span><span class="op" id="8459593">*</span><span class="op" id="8459594">*</span><span class="builtintype" id="8459595">float64</span><span class="op" id="8459602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459605">*</span><span class="op" id="8459606">*</span><span class="ident" id="8459607">t2</span><span class="op" id="8459609">.</span><span class="ident" id="8459610">A</span>&nbsp;<span class="op" id="8459612">=</span>&nbsp;<span class="builtinfunc" id="8459614">new</span><span class="op" id="8459617">(</span><span class="op" id="8459618">*</span><span class="builtintype" id="8459619">float64</span><span class="op" id="8459626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459629">*</span><span class="op" id="8459630">*</span><span class="op" id="8459631">*</span><span class="ident" id="8459632">t2</span><span class="op" id="8459634">.</span><span class="ident" id="8459635">A</span>&nbsp;<span class="op" id="8459637">=</span>&nbsp;<span class="builtinfunc" id="8459639">new</span><span class="op" id="8459642">(</span><span class="builtintype" id="8459643">float64</span><span class="op" id="8459650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459653">*</span><span class="op" id="8459654">*</span><span class="op" id="8459655">*</span><span class="op" id="8459656">*</span><span class="ident" id="8459657">t2</span><span class="op" id="8459659">.</span><span class="ident" id="8459660">A</span>&nbsp;<span class="op" id="8459662">=</span>&nbsp;<span class="num" id="8459664">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459670">t2pppp</span>&nbsp;<span class="op" id="8459677">:=</span>&nbsp;<span class="builtinfunc" id="8459680">new</span><span class="op" id="8459683">(</span><span class="op" id="8459684">*</span><span class="op" id="8459685">*</span><span class="op" id="8459686">*</span><span class="ident" id="8459687">Type2</span><span class="op" id="8459692">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459695">if</span>&nbsp;<span class="ident" id="8459698">err</span>&nbsp;<span class="op" id="8459702">:=</span>&nbsp;<span class="ident" id="8459705">encAndDec</span><span class="op" id="8459714">(</span><span class="ident" id="8459715">t2</span><span class="op" id="8459717">,</span>&nbsp;<span class="ident" id="8459719">t2pppp</span><span class="op" id="8459725">)</span><span class="op" id="8459726">;</span>&nbsp;<span class="ident" id="8459728">err</span>&nbsp;<span class="op" id="8459732">!=</span>&nbsp;<span class="ident" id="8459735">nil</span>&nbsp;<span class="op" id="8459739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459743">t</span><span class="op" id="8459744">.</span><span class="ident" id="8459745">Fatal</span><span class="op" id="8459750">(</span><span class="ident" id="8459751">err</span><span class="op" id="8459754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459760">if</span>&nbsp;<span class="op" id="8459763">*</span><span class="op" id="8459764">*</span><span class="op" id="8459765">*</span><span class="op" id="8459766">*</span><span class="op" id="8459767">(</span><span class="op" id="8459768">*</span><span class="op" id="8459769">*</span><span class="op" id="8459770">*</span><span class="op" id="8459771">*</span><span class="ident" id="8459772">t2pppp</span><span class="op" id="8459778">)</span><span class="op" id="8459779">.</span><span class="ident" id="8459780">A</span>&nbsp;<span class="op" id="8459782">!=</span>&nbsp;<span class="op" id="8459785">*</span><span class="op" id="8459786">*</span><span class="op" id="8459787">*</span><span class="op" id="8459788">*</span><span class="ident" id="8459789">t2</span><span class="op" id="8459791">.</span><span class="ident" id="8459792">A</span>&nbsp;<span class="op" id="8459794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459798">t</span><span class="op" id="8459799">.</span><span class="ident" id="8459800">Errorf</span><span class="op" id="8459806">(</span><span class="string" id="8459807">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="8459844">,</span>&nbsp;<span class="op" id="8459846">*</span><span class="op" id="8459847">*</span><span class="op" id="8459848">*</span><span class="op" id="8459849">*</span><span class="op" id="8459850">(</span><span class="op" id="8459851">*</span><span class="op" id="8459852">*</span><span class="op" id="8459853">*</span><span class="op" id="8459854">*</span><span class="ident" id="8459855">t2pppp</span><span class="op" id="8459861">)</span><span class="op" id="8459862">.</span><span class="ident" id="8459863">A</span><span class="op" id="8459864">,</span>&nbsp;<span class="op" id="8459866">*</span><span class="op" id="8459867">*</span><span class="op" id="8459868">*</span><span class="op" id="8459869">*</span><span class="ident" id="8459870">t2</span><span class="op" id="8459872">.</span><span class="ident" id="8459873">A</span><span class="op" id="8459874">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459877">}</span><br>
<span class="lineno"></span><span class="op" id="8459879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459882">func</span>&nbsp;<span class="ident" id="8459887">TestSlice</span><span class="op" id="8459896">(</span><span class="ident" id="8459897">t</span>&nbsp;<span class="op" id="8459899">*</span><span class="ident" id="8459900">testing</span><span class="op" id="8459907">.</span><span class="ident" id="8459908">T</span><span class="op" id="8459909">)</span>&nbsp;<span class="op" id="8459911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459914">type</span>&nbsp;<span class="ident" id="8459919">Type3</span>&nbsp;<span class="keyword" id="8459925">struct</span>&nbsp;<span class="op" id="8459932">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459936">A</span>&nbsp;<span class="op" id="8459938">[</span><span class="op" id="8459939">]</span><span class="builtintype" id="8459940">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459951">t3p</span>&nbsp;<span class="op" id="8459955">:=</span>&nbsp;<span class="op" id="8459958">&amp;</span><span class="ident" id="8459959">Type3</span><span class="op" id="8459964">{</span><span class="op" id="8459965">[</span><span class="op" id="8459966">]</span><span class="builtintype" id="8459967">string</span><span class="op" id="8459973">{</span><span class="string" id="8459974">&#34;hello&#34;</span><span class="op" id="8459981">,</span>&nbsp;<span class="string" id="8459983">&#34;world&#34;</span><span class="op" id="8459990">}</span><span class="op" id="8459991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459994">var</span>&nbsp;<span class="ident" id="8459998">t3</span>&nbsp;<span class="ident" id="8460001">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460008">if</span>&nbsp;<span class="ident" id="8460011">err</span>&nbsp;<span class="op" id="8460015">:=</span>&nbsp;<span class="ident" id="8460018">encAndDec</span><span class="op" id="8460027">(</span><span class="ident" id="8460028">t3</span><span class="op" id="8460030">,</span>&nbsp;<span class="ident" id="8460032">t3p</span><span class="op" id="8460035">)</span><span class="op" id="8460036">;</span>&nbsp;<span class="ident" id="8460038">err</span>&nbsp;<span class="op" id="8460042">!=</span>&nbsp;<span class="ident" id="8460045">nil</span>&nbsp;<span class="op" id="8460049">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460053">t</span><span class="op" id="8460054">.</span><span class="ident" id="8460055">Error</span><span class="op" id="8460060">(</span><span class="ident" id="8460061">err</span><span class="op" id="8460064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460067">}</span><br>
<span class="lineno"></span><span class="op" id="8460069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8460072">func</span>&nbsp;<span class="ident" id="8460077">TestValueError</span><span class="op" id="8460091">(</span><span class="ident" id="8460092">t</span>&nbsp;<span class="op" id="8460094">*</span><span class="ident" id="8460095">testing</span><span class="op" id="8460102">.</span><span class="ident" id="8460103">T</span><span class="op" id="8460104">)</span>&nbsp;<span class="op" id="8460106">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8460109">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460137">type</span>&nbsp;<span class="ident" id="8460142">Type4</span>&nbsp;<span class="keyword" id="8460148">struct</span>&nbsp;<span class="op" id="8460155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460159">A</span>&nbsp;<span class="builtintype" id="8460161">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460169">t4p</span>&nbsp;<span class="op" id="8460173">:=</span>&nbsp;<span class="op" id="8460176">&amp;</span><span class="ident" id="8460177">Type4</span><span class="op" id="8460182">{</span><span class="num" id="8460183">3</span><span class="op" id="8460184">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460187">var</span>&nbsp;<span class="ident" id="8460191">t4</span>&nbsp;<span class="ident" id="8460194">Type4</span>&nbsp;<span class="comment" id="8460200">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460225">if</span>&nbsp;<span class="ident" id="8460228">err</span>&nbsp;<span class="op" id="8460232">:=</span>&nbsp;<span class="ident" id="8460235">encAndDec</span><span class="op" id="8460244">(</span><span class="ident" id="8460245">t4p</span><span class="op" id="8460248">,</span>&nbsp;<span class="ident" id="8460250">t4</span><span class="op" id="8460252">)</span><span class="op" id="8460253">;</span>&nbsp;<span class="ident" id="8460255">err</span>&nbsp;<span class="op" id="8460259">==</span>&nbsp;<span class="ident" id="8460262">nil</span>&nbsp;<span class="op" id="8460266">||</span>&nbsp;<span class="ident" id="8460269">strings</span><span class="op" id="8460276">.</span><span class="ident" id="8460277">Index</span><span class="op" id="8460282">(</span><span class="ident" id="8460283">err</span><span class="op" id="8460286">.</span><span class="ident" id="8460287">Error</span><span class="op" id="8460292">(</span><span class="op" id="8460293">)</span><span class="op" id="8460294">,</span>&nbsp;<span class="string" id="8460296">&#34;pointer&#34;</span><span class="op" id="8460305">)</span>&nbsp;<span class="op" id="8460307">&lt;</span>&nbsp;<span class="num" id="8460309">0</span>&nbsp;<span class="op" id="8460311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460315">t</span><span class="op" id="8460316">.</span><span class="ident" id="8460317">Error</span><span class="op" id="8460322">(</span><span class="string" id="8460323">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="8460358">,</span>&nbsp;<span class="ident" id="8460360">err</span><span class="op" id="8460363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460366">}</span><br>
<span class="lineno"></span><span class="op" id="8460368">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="8460371">func</span>&nbsp;<span class="ident" id="8460376">TestArray</span><span class="op" id="8460385">(</span><span class="ident" id="8460386">t</span>&nbsp;<span class="op" id="8460388">*</span><span class="ident" id="8460389">testing</span><span class="op" id="8460396">.</span><span class="ident" id="8460397">T</span><span class="op" id="8460398">)</span>&nbsp;<span class="op" id="8460400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460403">type</span>&nbsp;<span class="ident" id="8460408">Type5</span>&nbsp;<span class="keyword" id="8460414">struct</span>&nbsp;<span class="op" id="8460421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460425">A</span>&nbsp;<span class="op" id="8460427">[</span><span class="num" id="8460428">3</span><span class="op" id="8460429">]</span><span class="builtintype" id="8460430">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460439">B</span>&nbsp;<span class="op" id="8460441">[</span><span class="num" id="8460442">3</span><span class="op" id="8460443">]</span><span class="builtintype" id="8460444">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460453">type</span>&nbsp;<span class="ident" id="8460458">Type6</span>&nbsp;<span class="keyword" id="8460464">struct</span>&nbsp;<span class="op" id="8460471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460475">A</span>&nbsp;<span class="op" id="8460477">[</span><span class="num" id="8460478">2</span><span class="op" id="8460479">]</span><span class="builtintype" id="8460480">string</span>&nbsp;<span class="comment" id="8460487">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460510">t5</span>&nbsp;<span class="op" id="8460513">:=</span>&nbsp;<span class="ident" id="8460516">Type5</span><span class="op" id="8460521">{</span><span class="op" id="8460522">[</span><span class="num" id="8460523">3</span><span class="op" id="8460524">]</span><span class="builtintype" id="8460525">string</span><span class="op" id="8460531">{</span><span class="string" id="8460532">&#34;hello&#34;</span><span class="op" id="8460539">,</span>&nbsp;<span class="string" id="8460541">&#34;,&#34;</span><span class="op" id="8460544">,</span>&nbsp;<span class="string" id="8460546">&#34;world&#34;</span><span class="op" id="8460553">}</span><span class="op" id="8460554">,</span>&nbsp;<span class="op" id="8460556">[</span><span class="num" id="8460557">3</span><span class="op" id="8460558">]</span><span class="builtintype" id="8460559">byte</span><span class="op" id="8460563">{</span><span class="num" id="8460564">1</span><span class="op" id="8460565">,</span>&nbsp;<span class="num" id="8460567">2</span><span class="op" id="8460568">,</span>&nbsp;<span class="num" id="8460570">3</span><span class="op" id="8460571">}</span><span class="op" id="8460572">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460575">var</span>&nbsp;<span class="ident" id="8460579">t5p</span>&nbsp;<span class="ident" id="8460583">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460590">if</span>&nbsp;<span class="ident" id="8460593">err</span>&nbsp;<span class="op" id="8460597">:=</span>&nbsp;<span class="ident" id="8460600">encAndDec</span><span class="op" id="8460609">(</span><span class="ident" id="8460610">t5</span><span class="op" id="8460612">,</span>&nbsp;<span class="op" id="8460614">&amp;</span><span class="ident" id="8460615">t5p</span><span class="op" id="8460618">)</span><span class="op" id="8460619">;</span>&nbsp;<span class="ident" id="8460621">err</span>&nbsp;<span class="op" id="8460625">!=</span>&nbsp;<span class="ident" id="8460628">nil</span>&nbsp;<span class="op" id="8460632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460636">t</span><span class="op" id="8460637">.</span><span class="ident" id="8460638">Error</span><span class="op" id="8460643">(</span><span class="ident" id="8460644">err</span><span class="op" id="8460647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460653">var</span>&nbsp;<span class="ident" id="8460657">t6</span>&nbsp;<span class="ident" id="8460660">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460667">if</span>&nbsp;<span class="ident" id="8460670">err</span>&nbsp;<span class="op" id="8460674">:=</span>&nbsp;<span class="ident" id="8460677">encAndDec</span><span class="op" id="8460686">(</span><span class="ident" id="8460687">t5</span><span class="op" id="8460689">,</span>&nbsp;<span class="op" id="8460691">&amp;</span><span class="ident" id="8460692">t6</span><span class="op" id="8460694">)</span><span class="op" id="8460695">;</span>&nbsp;<span class="ident" id="8460697">err</span>&nbsp;<span class="op" id="8460701">==</span>&nbsp;<span class="ident" id="8460704">nil</span>&nbsp;<span class="op" id="8460708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460712">t</span><span class="op" id="8460713">.</span><span class="ident" id="8460714">Error</span><span class="op" id="8460719">(</span><span class="string" id="8460720">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="8460761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460764">}</span><br>
<span class="lineno"></span><span class="op" id="8460766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8460769">func</span>&nbsp;<span class="ident" id="8460774">TestRecursiveMapType</span><span class="op" id="8460794">(</span><span class="ident" id="8460795">t</span>&nbsp;<span class="op" id="8460797">*</span><span class="ident" id="8460798">testing</span><span class="op" id="8460805">.</span><span class="ident" id="8460806">T</span><span class="op" id="8460807">)</span>&nbsp;<span class="op" id="8460809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460812">type</span>&nbsp;<span class="ident" id="8460817">recursiveMap</span>&nbsp;<span class="keyword" id="8460830">map</span><span class="op" id="8460833">[</span><span class="builtintype" id="8460834">string</span><span class="op" id="8460840">]</span><span class="ident" id="8460841">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460855">r1</span>&nbsp;<span class="op" id="8460858">:=</span>&nbsp;<span class="ident" id="8460861">recursiveMap</span><span class="op" id="8460873">{</span><span class="string" id="8460874">&#34;A&#34;</span><span class="op" id="8460877">:</span>&nbsp;<span class="ident" id="8460879">recursiveMap</span><span class="op" id="8460891">{</span><span class="string" id="8460892">&#34;B&#34;</span><span class="op" id="8460895">:</span>&nbsp;<span class="ident" id="8460897">nil</span><span class="op" id="8460900">,</span>&nbsp;<span class="string" id="8460902">&#34;C&#34;</span><span class="op" id="8460905">:</span>&nbsp;<span class="ident" id="8460907">nil</span><span class="op" id="8460910">}</span><span class="op" id="8460911">,</span>&nbsp;<span class="string" id="8460913">&#34;D&#34;</span><span class="op" id="8460916">:</span>&nbsp;<span class="ident" id="8460918">nil</span><span class="op" id="8460921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460924">r2</span>&nbsp;<span class="op" id="8460927">:=</span>&nbsp;<span class="builtinfunc" id="8460930">make</span><span class="op" id="8460934">(</span><span class="ident" id="8460935">recursiveMap</span><span class="op" id="8460947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460950">if</span>&nbsp;<span class="ident" id="8460953">err</span>&nbsp;<span class="op" id="8460957">:=</span>&nbsp;<span class="ident" id="8460960">encAndDec</span><span class="op" id="8460969">(</span><span class="ident" id="8460970">r1</span><span class="op" id="8460972">,</span>&nbsp;<span class="op" id="8460974">&amp;</span><span class="ident" id="8460975">r2</span><span class="op" id="8460977">)</span><span class="op" id="8460978">;</span>&nbsp;<span class="ident" id="8460980">err</span>&nbsp;<span class="op" id="8460984">!=</span>&nbsp;<span class="ident" id="8460987">nil</span>&nbsp;<span class="op" id="8460991">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460995">t</span><span class="op" id="8460996">.</span><span class="ident" id="8460997">Error</span><span class="op" id="8461002">(</span><span class="ident" id="8461003">err</span><span class="op" id="8461006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461009">}</span><br>
<span class="lineno"></span><span class="op" id="8461011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461014">func</span>&nbsp;<span class="ident" id="8461019">TestRecursiveSliceType</span><span class="op" id="8461041">(</span><span class="ident" id="8461042">t</span>&nbsp;<span class="op" id="8461044">*</span><span class="ident" id="8461045">testing</span><span class="op" id="8461052">.</span><span class="ident" id="8461053">T</span><span class="op" id="8461054">)</span>&nbsp;<span class="op" id="8461056">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461059">type</span>&nbsp;<span class="ident" id="8461064">recursiveSlice</span>&nbsp;<span class="op" id="8461079">[</span><span class="op" id="8461080">]</span><span class="ident" id="8461081">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461097">r1</span>&nbsp;<span class="op" id="8461100">:=</span>&nbsp;<span class="ident" id="8461103">recursiveSlice</span><span class="op" id="8461117">{</span><span class="num" id="8461118">0</span><span class="op" id="8461119">:</span>&nbsp;<span class="ident" id="8461121">recursiveSlice</span><span class="op" id="8461135">{</span><span class="num" id="8461136">0</span><span class="op" id="8461137">:</span>&nbsp;<span class="ident" id="8461139">nil</span><span class="op" id="8461142">}</span><span class="op" id="8461143">,</span>&nbsp;<span class="num" id="8461145">1</span><span class="op" id="8461146">:</span>&nbsp;<span class="ident" id="8461148">nil</span><span class="op" id="8461151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461154">r2</span>&nbsp;<span class="op" id="8461157">:=</span>&nbsp;<span class="builtinfunc" id="8461160">make</span><span class="op" id="8461164">(</span><span class="ident" id="8461165">recursiveSlice</span><span class="op" id="8461179">,</span>&nbsp;<span class="num" id="8461181">0</span><span class="op" id="8461182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461185">if</span>&nbsp;<span class="ident" id="8461188">err</span>&nbsp;<span class="op" id="8461192">:=</span>&nbsp;<span class="ident" id="8461195">encAndDec</span><span class="op" id="8461204">(</span><span class="ident" id="8461205">r1</span><span class="op" id="8461207">,</span>&nbsp;<span class="op" id="8461209">&amp;</span><span class="ident" id="8461210">r2</span><span class="op" id="8461212">)</span><span class="op" id="8461213">;</span>&nbsp;<span class="ident" id="8461215">err</span>&nbsp;<span class="op" id="8461219">!=</span>&nbsp;<span class="ident" id="8461222">nil</span>&nbsp;<span class="op" id="8461226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461230">t</span><span class="op" id="8461231">.</span><span class="ident" id="8461232">Error</span><span class="op" id="8461237">(</span><span class="ident" id="8461238">err</span><span class="op" id="8461241">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461244">}</span><br>
<span class="lineno"></span><span class="op" id="8461246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8461249">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="8461313">func</span>&nbsp;<span class="ident" id="8461318">TestDefaultsInArray</span><span class="op" id="8461337">(</span><span class="ident" id="8461338">t</span>&nbsp;<span class="op" id="8461340">*</span><span class="ident" id="8461341">testing</span><span class="op" id="8461348">.</span><span class="ident" id="8461349">T</span><span class="op" id="8461350">)</span>&nbsp;<span class="op" id="8461352">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461355">type</span>&nbsp;<span class="ident" id="8461360">Type7</span>&nbsp;<span class="keyword" id="8461366">struct</span>&nbsp;<span class="op" id="8461373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461377">B</span>&nbsp;<span class="op" id="8461379">[</span><span class="op" id="8461380">]</span><span class="builtintype" id="8461381">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461388">I</span>&nbsp;<span class="op" id="8461390">[</span><span class="op" id="8461391">]</span><span class="builtintype" id="8461392">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461398">S</span>&nbsp;<span class="op" id="8461400">[</span><span class="op" id="8461401">]</span><span class="builtintype" id="8461402">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461411">F</span>&nbsp;<span class="op" id="8461413">[</span><span class="op" id="8461414">]</span><span class="builtintype" id="8461415">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461427">t7</span>&nbsp;<span class="op" id="8461430">:=</span>&nbsp;<span class="ident" id="8461433">Type7</span><span class="op" id="8461438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461442">[</span><span class="op" id="8461443">]</span><span class="builtintype" id="8461444">bool</span><span class="op" id="8461448">{</span><span class="builtintype" id="8461449">false</span><span class="op" id="8461454">,</span>&nbsp;<span class="builtintype" id="8461456">false</span><span class="op" id="8461461">,</span>&nbsp;<span class="builtintype" id="8461463">true</span><span class="op" id="8461467">}</span><span class="op" id="8461468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461472">[</span><span class="op" id="8461473">]</span><span class="builtintype" id="8461474">int</span><span class="op" id="8461477">{</span><span class="num" id="8461478">0</span><span class="op" id="8461479">,</span>&nbsp;<span class="num" id="8461481">0</span><span class="op" id="8461482">,</span>&nbsp;<span class="num" id="8461484">1</span><span class="op" id="8461485">}</span><span class="op" id="8461486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461490">[</span><span class="op" id="8461491">]</span><span class="builtintype" id="8461492">string</span><span class="op" id="8461498">{</span><span class="string" id="8461499">&#34;hi&#34;</span><span class="op" id="8461503">,</span>&nbsp;<span class="string" id="8461505">&#34;&#34;</span><span class="op" id="8461507">,</span>&nbsp;<span class="string" id="8461509">&#34;there&#34;</span><span class="op" id="8461516">}</span><span class="op" id="8461517">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461521">[</span><span class="op" id="8461522">]</span><span class="builtintype" id="8461523">float64</span><span class="op" id="8461530">{</span><span class="num" id="8461531">0</span><span class="op" id="8461532">,</span>&nbsp;<span class="num" id="8461534">0</span><span class="op" id="8461535">,</span>&nbsp;<span class="num" id="8461537">1</span><span class="op" id="8461538">}</span><span class="op" id="8461539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461545">var</span>&nbsp;<span class="ident" id="8461549">t7p</span>&nbsp;<span class="ident" id="8461553">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461560">if</span>&nbsp;<span class="ident" id="8461563">err</span>&nbsp;<span class="op" id="8461567">:=</span>&nbsp;<span class="ident" id="8461570">encAndDec</span><span class="op" id="8461579">(</span><span class="ident" id="8461580">t7</span><span class="op" id="8461582">,</span>&nbsp;<span class="op" id="8461584">&amp;</span><span class="ident" id="8461585">t7p</span><span class="op" id="8461588">)</span><span class="op" id="8461589">;</span>&nbsp;<span class="ident" id="8461591">err</span>&nbsp;<span class="op" id="8461595">!=</span>&nbsp;<span class="ident" id="8461598">nil</span>&nbsp;<span class="op" id="8461602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461606">t</span><span class="op" id="8461607">.</span><span class="ident" id="8461608">Error</span><span class="op" id="8461613">(</span><span class="ident" id="8461614">err</span><span class="op" id="8461617">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461620">}</span><br>
<span class="lineno"></span><span class="op" id="8461622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461625">var</span>&nbsp;<span class="ident" id="8461629">testInt</span>&nbsp;<span class="builtintype" id="8461637">int</span><br>
<span class="lineno"></span><span class="keyword" id="8461641">var</span>&nbsp;<span class="ident" id="8461645">testFloat32</span>&nbsp;<span class="builtintype" id="8461657">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="8461665">var</span>&nbsp;<span class="ident" id="8461669">testString</span>&nbsp;<span class="builtintype" id="8461680">string</span><br>
<span class="lineno"></span><span class="keyword" id="8461687">var</span>&nbsp;<span class="ident" id="8461691">testSlice</span>&nbsp;<span class="op" id="8461701">[</span><span class="op" id="8461702">]</span><span class="builtintype" id="8461703">string</span><br>
<span class="lineno"></span><span class="keyword" id="8461710">var</span>&nbsp;<span class="ident" id="8461714">testMap</span>&nbsp;<span class="keyword" id="8461722">map</span><span class="op" id="8461725">[</span><span class="builtintype" id="8461726">string</span><span class="op" id="8461732">]</span><span class="builtintype" id="8461733">int</span><br>
<span class="lineno"></span><span class="keyword" id="8461737">var</span>&nbsp;<span class="ident" id="8461741">testArray</span>&nbsp;<span class="op" id="8461751">[</span><span class="num" id="8461752">7</span><span class="op" id="8461753">]</span><span class="builtintype" id="8461754">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="8461759">type</span>&nbsp;<span class="ident" id="8461764">SingleTest</span>&nbsp;<span class="keyword" id="8461775">struct</span>&nbsp;<span class="op" id="8461782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461785">in</span>&nbsp;&nbsp;<span class="keyword" id="8461789">interface</span><span class="op" id="8461798">{</span><span class="op" id="8461799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461802">out</span>&nbsp;<span class="keyword" id="8461806">interface</span><span class="op" id="8461815">{</span><span class="op" id="8461816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461819">err</span>&nbsp;<span class="builtintype" id="8461823">string</span><br>
<span class="lineno"></span><span class="op" id="8461830">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8461833">var</span>&nbsp;<span class="ident" id="8461837">singleTests</span>&nbsp;<span class="op" id="8461849">=</span>&nbsp;<span class="op" id="8461851">[</span><span class="op" id="8461852">]</span><span class="ident" id="8461853">SingleTest</span><span class="op" id="8461863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461866">{</span><span class="num" id="8461867">17</span><span class="op" id="8461869">,</span>&nbsp;<span class="op" id="8461871">&amp;</span><span class="ident" id="8461872">testInt</span><span class="op" id="8461879">,</span>&nbsp;<span class="string" id="8461881">&#34;&#34;</span><span class="op" id="8461883">}</span><span class="op" id="8461884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461887">{</span><span class="builtintype" id="8461888">float32</span><span class="op" id="8461895">(</span><span class="num" id="8461896">17.5</span><span class="op" id="8461900">)</span><span class="op" id="8461901">,</span>&nbsp;<span class="op" id="8461903">&amp;</span><span class="ident" id="8461904">testFloat32</span><span class="op" id="8461915">,</span>&nbsp;<span class="string" id="8461917">&#34;&#34;</span><span class="op" id="8461919">}</span><span class="op" id="8461920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461923">{</span><span class="string" id="8461924">&#34;bike&nbsp;shed&#34;</span><span class="op" id="8461935">,</span>&nbsp;<span class="op" id="8461937">&amp;</span><span class="ident" id="8461938">testString</span><span class="op" id="8461948">,</span>&nbsp;<span class="string" id="8461950">&#34;&#34;</span><span class="op" id="8461952">}</span><span class="op" id="8461953">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461956">{</span><span class="op" id="8461957">[</span><span class="op" id="8461958">]</span><span class="builtintype" id="8461959">string</span><span class="op" id="8461965">{</span><span class="string" id="8461966">&#34;bike&#34;</span><span class="op" id="8461972">,</span>&nbsp;<span class="string" id="8461974">&#34;shed&#34;</span><span class="op" id="8461980">,</span>&nbsp;<span class="string" id="8461982">&#34;paint&#34;</span><span class="op" id="8461989">,</span>&nbsp;<span class="string" id="8461991">&#34;color&#34;</span><span class="op" id="8461998">}</span><span class="op" id="8461999">,</span>&nbsp;<span class="op" id="8462001">&amp;</span><span class="ident" id="8462002">testSlice</span><span class="op" id="8462011">,</span>&nbsp;<span class="string" id="8462013">&#34;&#34;</span><span class="op" id="8462015">}</span><span class="op" id="8462016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462019">{</span><span class="keyword" id="8462020">map</span><span class="op" id="8462023">[</span><span class="builtintype" id="8462024">string</span><span class="op" id="8462030">]</span><span class="builtintype" id="8462031">int</span><span class="op" id="8462034">{</span><span class="string" id="8462035">&#34;seven&#34;</span><span class="op" id="8462042">:</span>&nbsp;<span class="num" id="8462044">7</span><span class="op" id="8462045">,</span>&nbsp;<span class="string" id="8462047">&#34;twelve&#34;</span><span class="op" id="8462055">:</span>&nbsp;<span class="num" id="8462057">12</span><span class="op" id="8462059">}</span><span class="op" id="8462060">,</span>&nbsp;<span class="op" id="8462062">&amp;</span><span class="ident" id="8462063">testMap</span><span class="op" id="8462070">,</span>&nbsp;<span class="string" id="8462072">&#34;&#34;</span><span class="op" id="8462074">}</span><span class="op" id="8462075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462078">{</span><span class="op" id="8462079">[</span><span class="num" id="8462080">7</span><span class="op" id="8462081">]</span><span class="builtintype" id="8462082">int</span><span class="op" id="8462085">{</span><span class="num" id="8462086">4</span><span class="op" id="8462087">,</span>&nbsp;<span class="num" id="8462089">55</span><span class="op" id="8462091">,</span>&nbsp;<span class="num" id="8462093">0</span><span class="op" id="8462094">,</span>&nbsp;<span class="num" id="8462096">0</span><span class="op" id="8462097">,</span>&nbsp;<span class="num" id="8462099">0</span><span class="op" id="8462100">,</span>&nbsp;<span class="num" id="8462102">0</span><span class="op" id="8462103">,</span>&nbsp;<span class="num" id="8462105">0</span><span class="op" id="8462106">}</span><span class="op" id="8462107">,</span>&nbsp;<span class="op" id="8462109">&amp;</span><span class="ident" id="8462110">testArray</span><span class="op" id="8462119">,</span>&nbsp;<span class="string" id="8462121">&#34;&#34;</span><span class="op" id="8462123">}</span><span class="op" id="8462124">,</span>&nbsp;<span class="comment" id="8462126">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462161">{</span><span class="op" id="8462162">[</span><span class="num" id="8462163">7</span><span class="op" id="8462164">]</span><span class="builtintype" id="8462165">int</span><span class="op" id="8462168">{</span><span class="num" id="8462169">4</span><span class="op" id="8462170">,</span>&nbsp;<span class="num" id="8462172">55</span><span class="op" id="8462174">,</span>&nbsp;<span class="num" id="8462176">1</span><span class="op" id="8462177">,</span>&nbsp;<span class="num" id="8462179">44</span><span class="op" id="8462181">,</span>&nbsp;<span class="num" id="8462183">22</span><span class="op" id="8462185">,</span>&nbsp;<span class="num" id="8462187">66</span><span class="op" id="8462189">,</span>&nbsp;<span class="num" id="8462191">1234</span><span class="op" id="8462195">}</span><span class="op" id="8462196">,</span>&nbsp;<span class="op" id="8462198">&amp;</span><span class="ident" id="8462199">testArray</span><span class="op" id="8462208">,</span>&nbsp;<span class="string" id="8462210">&#34;&#34;</span><span class="op" id="8462212">}</span><span class="op" id="8462213">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8462217">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462235">{</span><span class="num" id="8462236">172</span><span class="op" id="8462239">,</span>&nbsp;<span class="op" id="8462241">&amp;</span><span class="ident" id="8462242">testFloat32</span><span class="op" id="8462253">,</span>&nbsp;<span class="string" id="8462255">&#34;type&#34;</span><span class="op" id="8462261">}</span><span class="op" id="8462262">,</span><br>
<span class="lineno"></span><span class="op" id="8462264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462267">func</span>&nbsp;<span class="ident" id="8462272">TestSingletons</span><span class="op" id="8462286">(</span><span class="ident" id="8462287">t</span>&nbsp;<span class="op" id="8462289">*</span><span class="ident" id="8462290">testing</span><span class="op" id="8462297">.</span><span class="ident" id="8462298">T</span><span class="op" id="8462299">)</span>&nbsp;<span class="op" id="8462301">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462304">b</span>&nbsp;<span class="op" id="8462306">:=</span>&nbsp;<span class="builtinfunc" id="8462309">new</span><span class="op" id="8462312">(</span><span class="ident" id="8462313">bytes</span><span class="op" id="8462318">.</span><span class="ident" id="8462319">Buffer</span><span class="op" id="8462325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462328">enc</span>&nbsp;<span class="op" id="8462332">:=</span>&nbsp;<span class="ident" id="8462335">NewEncoder</span><span class="op" id="8462345">(</span><span class="ident" id="8462346">b</span><span class="op" id="8462347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462350">dec</span>&nbsp;<span class="op" id="8462354">:=</span>&nbsp;<span class="ident" id="8462357">NewDecoder</span><span class="op" id="8462367">(</span><span class="ident" id="8462368">b</span><span class="op" id="8462369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462372">for</span>&nbsp;<span class="ident" id="8462376">_</span><span class="op" id="8462377">,</span>&nbsp;<span class="ident" id="8462379">test</span>&nbsp;<span class="op" id="8462384">:=</span>&nbsp;<span class="keyword" id="8462387">range</span>&nbsp;<span class="ident" id="8462393">singleTests</span>&nbsp;<span class="op" id="8462405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462409">b</span><span class="op" id="8462410">.</span><span class="ident" id="8462411">Reset</span><span class="op" id="8462416">(</span><span class="op" id="8462417">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462421">err</span>&nbsp;<span class="op" id="8462425">:=</span>&nbsp;<span class="ident" id="8462428">enc</span><span class="op" id="8462431">.</span><span class="ident" id="8462432">Encode</span><span class="op" id="8462438">(</span><span class="ident" id="8462439">test</span><span class="op" id="8462443">.</span><span class="ident" id="8462444">in</span><span class="op" id="8462446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462450">if</span>&nbsp;<span class="ident" id="8462453">err</span>&nbsp;<span class="op" id="8462457">!=</span>&nbsp;<span class="ident" id="8462460">nil</span>&nbsp;<span class="op" id="8462464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462469">t</span><span class="op" id="8462470">.</span><span class="ident" id="8462471">Errorf</span><span class="op" id="8462477">(</span><span class="string" id="8462478">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8462501">,</span>&nbsp;<span class="ident" id="8462503">test</span><span class="op" id="8462507">.</span><span class="ident" id="8462508">in</span><span class="op" id="8462510">,</span>&nbsp;<span class="ident" id="8462512">err</span><span class="op" id="8462515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462520">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462531">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462535">err</span>&nbsp;<span class="op" id="8462539">=</span>&nbsp;<span class="ident" id="8462541">dec</span><span class="op" id="8462544">.</span><span class="ident" id="8462545">Decode</span><span class="op" id="8462551">(</span><span class="ident" id="8462552">test</span><span class="op" id="8462556">.</span><span class="ident" id="8462557">out</span><span class="op" id="8462560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462564">switch</span>&nbsp;<span class="op" id="8462571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462575">case</span>&nbsp;<span class="ident" id="8462580">err</span>&nbsp;<span class="op" id="8462584">!=</span>&nbsp;<span class="ident" id="8462587">nil</span>&nbsp;<span class="op" id="8462591">&amp;&amp;</span>&nbsp;<span class="ident" id="8462594">test</span><span class="op" id="8462598">.</span><span class="ident" id="8462599">err</span>&nbsp;<span class="op" id="8462603">==</span>&nbsp;<span class="string" id="8462606">&#34;&#34;</span><span class="op" id="8462608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462613">t</span><span class="op" id="8462614">.</span><span class="ident" id="8462615">Errorf</span><span class="op" id="8462621">(</span><span class="string" id="8462622">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8462645">,</span>&nbsp;<span class="ident" id="8462647">test</span><span class="op" id="8462651">.</span><span class="ident" id="8462652">in</span><span class="op" id="8462654">,</span>&nbsp;<span class="ident" id="8462656">err</span><span class="op" id="8462659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462664">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462675">case</span>&nbsp;<span class="ident" id="8462680">err</span>&nbsp;<span class="op" id="8462684">==</span>&nbsp;<span class="ident" id="8462687">nil</span>&nbsp;<span class="op" id="8462691">&amp;&amp;</span>&nbsp;<span class="ident" id="8462694">test</span><span class="op" id="8462698">.</span><span class="ident" id="8462699">err</span>&nbsp;<span class="op" id="8462703">!=</span>&nbsp;<span class="string" id="8462706">&#34;&#34;</span><span class="op" id="8462708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462713">t</span><span class="op" id="8462714">.</span><span class="ident" id="8462715">Errorf</span><span class="op" id="8462721">(</span><span class="string" id="8462722">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8462754">,</span>&nbsp;<span class="ident" id="8462756">test</span><span class="op" id="8462760">.</span><span class="ident" id="8462761">in</span><span class="op" id="8462763">,</span>&nbsp;<span class="ident" id="8462765">test</span><span class="op" id="8462769">.</span><span class="ident" id="8462770">err</span><span class="op" id="8462773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462778">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462789">case</span>&nbsp;<span class="ident" id="8462794">err</span>&nbsp;<span class="op" id="8462798">!=</span>&nbsp;<span class="ident" id="8462801">nil</span>&nbsp;<span class="op" id="8462805">&amp;&amp;</span>&nbsp;<span class="ident" id="8462808">test</span><span class="op" id="8462812">.</span><span class="ident" id="8462813">err</span>&nbsp;<span class="op" id="8462817">!=</span>&nbsp;<span class="string" id="8462820">&#34;&#34;</span><span class="op" id="8462822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462827">if</span>&nbsp;<span class="ident" id="8462830">strings</span><span class="op" id="8462837">.</span><span class="ident" id="8462838">Index</span><span class="op" id="8462843">(</span><span class="ident" id="8462844">err</span><span class="op" id="8462847">.</span><span class="ident" id="8462848">Error</span><span class="op" id="8462853">(</span><span class="op" id="8462854">)</span><span class="op" id="8462855">,</span>&nbsp;<span class="ident" id="8462857">test</span><span class="op" id="8462861">.</span><span class="ident" id="8462862">err</span><span class="op" id="8462865">)</span>&nbsp;<span class="op" id="8462867">&lt;</span>&nbsp;<span class="num" id="8462869">0</span>&nbsp;<span class="op" id="8462871">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462877">t</span><span class="op" id="8462878">.</span><span class="ident" id="8462879">Errorf</span><span class="op" id="8462885">(</span><span class="string" id="8462886">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8462930">,</span>&nbsp;<span class="ident" id="8462932">test</span><span class="op" id="8462936">.</span><span class="ident" id="8462937">in</span><span class="op" id="8462939">,</span>&nbsp;<span class="ident" id="8462941">test</span><span class="op" id="8462945">.</span><span class="ident" id="8462946">err</span><span class="op" id="8462949">,</span>&nbsp;<span class="ident" id="8462951">err</span><span class="op" id="8462954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462964">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8462979">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463018">val</span>&nbsp;<span class="op" id="8463022">:=</span>&nbsp;<span class="ident" id="8463025">reflect</span><span class="op" id="8463032">.</span><span class="ident" id="8463033">ValueOf</span><span class="op" id="8463040">(</span><span class="ident" id="8463041">test</span><span class="op" id="8463045">.</span><span class="ident" id="8463046">out</span><span class="op" id="8463049">)</span><span class="op" id="8463050">.</span><span class="ident" id="8463051">Elem</span><span class="op" id="8463055">(</span><span class="op" id="8463056">)</span><span class="op" id="8463057">.</span><span class="ident" id="8463058">Interface</span><span class="op" id="8463067">(</span><span class="op" id="8463068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463072">if</span>&nbsp;<span class="op" id="8463075">!</span><span class="ident" id="8463076">reflect</span><span class="op" id="8463083">.</span><span class="ident" id="8463084">DeepEqual</span><span class="op" id="8463093">(</span><span class="ident" id="8463094">test</span><span class="op" id="8463098">.</span><span class="ident" id="8463099">in</span><span class="op" id="8463101">,</span>&nbsp;<span class="ident" id="8463103">val</span><span class="op" id="8463106">)</span>&nbsp;<span class="op" id="8463108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463113">t</span><span class="op" id="8463114">.</span><span class="ident" id="8463115">Errorf</span><span class="op" id="8463121">(</span><span class="string" id="8463122">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8463162">,</span>&nbsp;<span class="ident" id="8463164">test</span><span class="op" id="8463168">.</span><span class="ident" id="8463169">in</span><span class="op" id="8463171">,</span>&nbsp;<span class="ident" id="8463173">val</span><span class="op" id="8463176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463183">}</span><br>
<span class="lineno">420</span><span class="op" id="8463185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8463188">func</span>&nbsp;<span class="ident" id="8463193">TestStructNonStruct</span><span class="op" id="8463212">(</span><span class="ident" id="8463213">t</span>&nbsp;<span class="op" id="8463215">*</span><span class="ident" id="8463216">testing</span><span class="op" id="8463223">.</span><span class="ident" id="8463224">T</span><span class="op" id="8463225">)</span>&nbsp;<span class="op" id="8463227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463230">type</span>&nbsp;<span class="ident" id="8463235">Struct</span>&nbsp;<span class="keyword" id="8463242">struct</span>&nbsp;<span class="op" id="8463249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463253">A</span>&nbsp;<span class="builtintype" id="8463255">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463266">type</span>&nbsp;<span class="ident" id="8463271">NonStruct</span>&nbsp;<span class="builtintype" id="8463281">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463289">s</span>&nbsp;<span class="op" id="8463291">:=</span>&nbsp;<span class="ident" id="8463294">Struct</span><span class="op" id="8463300">{</span><span class="string" id="8463301">&#34;hello&#34;</span><span class="op" id="8463308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463311">var</span>&nbsp;<span class="ident" id="8463315">sp</span>&nbsp;<span class="ident" id="8463318">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463326">if</span>&nbsp;<span class="ident" id="8463329">err</span>&nbsp;<span class="op" id="8463333">:=</span>&nbsp;<span class="ident" id="8463336">encAndDec</span><span class="op" id="8463345">(</span><span class="ident" id="8463346">s</span><span class="op" id="8463347">,</span>&nbsp;<span class="op" id="8463349">&amp;</span><span class="ident" id="8463350">sp</span><span class="op" id="8463352">)</span><span class="op" id="8463353">;</span>&nbsp;<span class="ident" id="8463355">err</span>&nbsp;<span class="op" id="8463359">!=</span>&nbsp;<span class="ident" id="8463362">nil</span>&nbsp;<span class="op" id="8463366">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463370">t</span><span class="op" id="8463371">.</span><span class="ident" id="8463372">Error</span><span class="op" id="8463377">(</span><span class="ident" id="8463378">err</span><span class="op" id="8463381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463387">var</span>&nbsp;<span class="ident" id="8463391">ns</span>&nbsp;<span class="ident" id="8463394">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463405">if</span>&nbsp;<span class="ident" id="8463408">err</span>&nbsp;<span class="op" id="8463412">:=</span>&nbsp;<span class="ident" id="8463415">encAndDec</span><span class="op" id="8463424">(</span><span class="ident" id="8463425">s</span><span class="op" id="8463426">,</span>&nbsp;<span class="op" id="8463428">&amp;</span><span class="ident" id="8463429">ns</span><span class="op" id="8463431">)</span><span class="op" id="8463432">;</span>&nbsp;<span class="ident" id="8463434">err</span>&nbsp;<span class="op" id="8463438">==</span>&nbsp;<span class="ident" id="8463441">nil</span>&nbsp;<span class="op" id="8463445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463449">t</span><span class="op" id="8463450">.</span><span class="ident" id="8463451">Error</span><span class="op" id="8463456">(</span><span class="string" id="8463457">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="8463497">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463500">}</span>&nbsp;<span class="keyword" id="8463502">else</span>&nbsp;<span class="keyword" id="8463507">if</span>&nbsp;<span class="ident" id="8463510">strings</span><span class="op" id="8463517">.</span><span class="ident" id="8463518">Index</span><span class="op" id="8463523">(</span><span class="ident" id="8463524">err</span><span class="op" id="8463527">.</span><span class="ident" id="8463528">Error</span><span class="op" id="8463533">(</span><span class="op" id="8463534">)</span><span class="op" id="8463535">,</span>&nbsp;<span class="string" id="8463537">&#34;type&#34;</span><span class="op" id="8463543">)</span>&nbsp;<span class="op" id="8463545">&lt;</span>&nbsp;<span class="num" id="8463547">0</span>&nbsp;<span class="op" id="8463549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463553">t</span><span class="op" id="8463554">.</span><span class="ident" id="8463555">Error</span><span class="op" id="8463560">(</span><span class="string" id="8463561">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8463609">,</span>&nbsp;<span class="ident" id="8463611">err</span><span class="op" id="8463614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8463620">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463646">var</span>&nbsp;<span class="ident" id="8463650">nsp</span>&nbsp;<span class="ident" id="8463654">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463665">if</span>&nbsp;<span class="ident" id="8463668">err</span>&nbsp;<span class="op" id="8463672">:=</span>&nbsp;<span class="ident" id="8463675">encAndDec</span><span class="op" id="8463684">(</span><span class="ident" id="8463685">ns</span><span class="op" id="8463687">,</span>&nbsp;<span class="op" id="8463689">&amp;</span><span class="ident" id="8463690">nsp</span><span class="op" id="8463693">)</span><span class="op" id="8463694">;</span>&nbsp;<span class="ident" id="8463696">err</span>&nbsp;<span class="op" id="8463700">!=</span>&nbsp;<span class="ident" id="8463703">nil</span>&nbsp;<span class="op" id="8463707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463711">t</span><span class="op" id="8463712">.</span><span class="ident" id="8463713">Error</span><span class="op" id="8463718">(</span><span class="ident" id="8463719">err</span><span class="op" id="8463722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463728">if</span>&nbsp;<span class="ident" id="8463731">err</span>&nbsp;<span class="op" id="8463735">:=</span>&nbsp;<span class="ident" id="8463738">encAndDec</span><span class="op" id="8463747">(</span><span class="ident" id="8463748">ns</span><span class="op" id="8463750">,</span>&nbsp;<span class="op" id="8463752">&amp;</span><span class="ident" id="8463753">s</span><span class="op" id="8463754">)</span><span class="op" id="8463755">;</span>&nbsp;<span class="ident" id="8463757">err</span>&nbsp;<span class="op" id="8463761">==</span>&nbsp;<span class="ident" id="8463764">nil</span>&nbsp;<span class="op" id="8463768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463772">t</span><span class="op" id="8463773">.</span><span class="ident" id="8463774">Error</span><span class="op" id="8463779">(</span><span class="string" id="8463780">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="8463820">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463823">}</span>&nbsp;<span class="keyword" id="8463825">else</span>&nbsp;<span class="keyword" id="8463830">if</span>&nbsp;<span class="ident" id="8463833">strings</span><span class="op" id="8463840">.</span><span class="ident" id="8463841">Index</span><span class="op" id="8463846">(</span><span class="ident" id="8463847">err</span><span class="op" id="8463850">.</span><span class="ident" id="8463851">Error</span><span class="op" id="8463856">(</span><span class="op" id="8463857">)</span><span class="op" id="8463858">,</span>&nbsp;<span class="string" id="8463860">&#34;type&#34;</span><span class="op" id="8463866">)</span>&nbsp;<span class="op" id="8463868">&lt;</span>&nbsp;<span class="num" id="8463870">0</span>&nbsp;<span class="op" id="8463872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463876">t</span><span class="op" id="8463877">.</span><span class="ident" id="8463878">Error</span><span class="op" id="8463883">(</span><span class="string" id="8463884">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8463932">,</span>&nbsp;<span class="ident" id="8463934">err</span><span class="op" id="8463937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463940">}</span><br>
<span class="lineno"></span><span class="op" id="8463942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8463945">type</span>&nbsp;<span class="ident" id="8463950">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="8463973">interface</span>&nbsp;<span class="op" id="8463983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463986">F</span><span class="op" id="8463987">(</span><span class="op" id="8463988">)</span>&nbsp;<span class="builtintype" id="8463990">bool</span><br>
<span class="lineno"></span><span class="op" id="8463995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8463998">type</span>&nbsp;<span class="ident" id="8464003">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="8464026">struct</span><span class="op" id="8464032">{</span><span class="op" id="8464033">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8464036">func</span>&nbsp;<span class="op" id="8464041">(</span><span class="ident" id="8464042">this</span>&nbsp;<span class="op" id="8464047">*</span><span class="ident" id="8464048">interfaceIndirectTestT</span><span class="op" id="8464070">)</span>&nbsp;<span class="ident" id="8464072">F</span><span class="op" id="8464073">(</span><span class="op" id="8464074">)</span>&nbsp;<span class="builtintype" id="8464076">bool</span>&nbsp;<span class="op" id="8464081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464084">return</span>&nbsp;<span class="builtintype" id="8464091">true</span><br>
<span class="lineno"></span><span class="op" id="8464096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="8464099">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="8464168">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="8464237">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="8464269">func</span>&nbsp;<span class="ident" id="8464274">TestInterfaceIndirect</span><span class="op" id="8464295">(</span><span class="ident" id="8464296">t</span>&nbsp;<span class="op" id="8464298">*</span><span class="ident" id="8464299">testing</span><span class="op" id="8464306">.</span><span class="ident" id="8464307">T</span><span class="op" id="8464308">)</span>&nbsp;<span class="op" id="8464310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464313">Register</span><span class="op" id="8464321">(</span><span class="op" id="8464322">&amp;</span><span class="ident" id="8464323">interfaceIndirectTestT</span><span class="op" id="8464345">{</span><span class="op" id="8464346">}</span><span class="op" id="8464347">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464350">b</span>&nbsp;<span class="op" id="8464352">:=</span>&nbsp;<span class="builtinfunc" id="8464355">new</span><span class="op" id="8464358">(</span><span class="ident" id="8464359">bytes</span><span class="op" id="8464364">.</span><span class="ident" id="8464365">Buffer</span><span class="op" id="8464371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464374">w</span>&nbsp;<span class="op" id="8464376">:=</span>&nbsp;<span class="op" id="8464379">[</span><span class="op" id="8464380">]</span><span class="ident" id="8464381">interfaceIndirectTestI</span><span class="op" id="8464403">{</span><span class="op" id="8464404">&amp;</span><span class="ident" id="8464405">interfaceIndirectTestT</span><span class="op" id="8464427">{</span><span class="op" id="8464428">}</span><span class="op" id="8464429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464432">err</span>&nbsp;<span class="op" id="8464436">:=</span>&nbsp;<span class="ident" id="8464439">NewEncoder</span><span class="op" id="8464449">(</span><span class="ident" id="8464450">b</span><span class="op" id="8464451">)</span><span class="op" id="8464452">.</span><span class="ident" id="8464453">Encode</span><span class="op" id="8464459">(</span><span class="ident" id="8464460">w</span><span class="op" id="8464461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464464">if</span>&nbsp;<span class="ident" id="8464467">err</span>&nbsp;<span class="op" id="8464471">!=</span>&nbsp;<span class="ident" id="8464474">nil</span>&nbsp;<span class="op" id="8464478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464482">t</span><span class="op" id="8464483">.</span><span class="ident" id="8464484">Fatal</span><span class="op" id="8464489">(</span><span class="string" id="8464490">&#34;encode&nbsp;error:&#34;</span><span class="op" id="8464505">,</span>&nbsp;<span class="ident" id="8464507">err</span><span class="op" id="8464510">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464517">var</span>&nbsp;<span class="ident" id="8464521">r</span>&nbsp;<span class="op" id="8464523">[</span><span class="op" id="8464524">]</span><span class="ident" id="8464525">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464549">err</span>&nbsp;<span class="op" id="8464553">=</span>&nbsp;<span class="ident" id="8464555">NewDecoder</span><span class="op" id="8464565">(</span><span class="ident" id="8464566">b</span><span class="op" id="8464567">)</span><span class="op" id="8464568">.</span><span class="ident" id="8464569">Decode</span><span class="op" id="8464575">(</span><span class="op" id="8464576">&amp;</span><span class="ident" id="8464577">r</span><span class="op" id="8464578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464581">if</span>&nbsp;<span class="ident" id="8464584">err</span>&nbsp;<span class="op" id="8464588">!=</span>&nbsp;<span class="ident" id="8464591">nil</span>&nbsp;<span class="op" id="8464595">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464599">t</span><span class="op" id="8464600">.</span><span class="ident" id="8464601">Fatal</span><span class="op" id="8464606">(</span><span class="string" id="8464607">&#34;decode&nbsp;error:&#34;</span><span class="op" id="8464622">,</span>&nbsp;<span class="ident" id="8464624">err</span><span class="op" id="8464627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464630">}</span><br>
<span class="lineno"></span><span class="op" id="8464632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8464635">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="8464712">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8464761">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="8464837">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="8464914">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="8464987">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8465064">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465133">type</span>&nbsp;<span class="ident" id="8465138">Struct0</span>&nbsp;<span class="keyword" id="8465146">struct</span>&nbsp;<span class="op" id="8465153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465156">I</span>&nbsp;<span class="keyword" id="8465158">interface</span><span class="op" id="8465167">{</span><span class="op" id="8465168">}</span><br>
<span class="lineno">490</span><span class="op" id="8465170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465173">type</span>&nbsp;<span class="ident" id="8465178">NewType0</span>&nbsp;<span class="keyword" id="8465187">struct</span>&nbsp;<span class="op" id="8465194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465197">S</span>&nbsp;<span class="builtintype" id="8465199">string</span><br>
<span class="lineno"></span><span class="op" id="8465206">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="8465209">type</span>&nbsp;<span class="ident" id="8465214">ignoreTest</span>&nbsp;<span class="keyword" id="8465225">struct</span>&nbsp;<span class="op" id="8465232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465235">in</span><span class="op" id="8465237">,</span>&nbsp;<span class="ident" id="8465239">out</span>&nbsp;<span class="keyword" id="8465243">interface</span><span class="op" id="8465252">{</span><span class="op" id="8465253">}</span><br>
<span class="lineno"></span><span class="op" id="8465255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="8465258">var</span>&nbsp;<span class="ident" id="8465262">ignoreTests</span>&nbsp;<span class="op" id="8465274">=</span>&nbsp;<span class="op" id="8465276">[</span><span class="op" id="8465277">]</span><span class="ident" id="8465278">ignoreTest</span><span class="op" id="8465288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465291">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465337">{</span><span class="op" id="8465338">&amp;</span><span class="keyword" id="8465339">struct</span><span class="op" id="8465345">{</span>&nbsp;<span class="ident" id="8465347">A</span>&nbsp;<span class="builtintype" id="8465349">int</span>&nbsp;<span class="op" id="8465353">}</span><span class="op" id="8465354">{</span><span class="num" id="8465355">23</span><span class="op" id="8465357">}</span><span class="op" id="8465358">,</span>&nbsp;<span class="op" id="8465360">&amp;</span><span class="keyword" id="8465361">struct</span><span class="op" id="8465367">{</span><span class="op" id="8465368">}</span><span class="op" id="8465369">{</span><span class="op" id="8465370">}</span><span class="op" id="8465371">}</span><span class="op" id="8465372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465375">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465412">{</span><span class="op" id="8465413">&amp;</span><span class="keyword" id="8465414">struct</span><span class="op" id="8465420">{</span>&nbsp;<span class="ident" id="8465422">A</span>&nbsp;<span class="builtintype" id="8465424">int</span>&nbsp;<span class="op" id="8465428">}</span><span class="op" id="8465429">{</span><span class="num" id="8465430">23</span><span class="op" id="8465432">}</span><span class="op" id="8465433">,</span>&nbsp;<span class="ident" id="8465435">nil</span><span class="op" id="8465438">}</span><span class="op" id="8465439">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465442">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465482">{</span><span class="string" id="8465483">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8465497">,</span>&nbsp;<span class="ident" id="8465499">nil</span><span class="op" id="8465502">}</span><span class="op" id="8465503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465506">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465545">{</span><span class="op" id="8465546">[</span><span class="op" id="8465547">]</span><span class="builtintype" id="8465548">int</span><span class="op" id="8465551">{</span><span class="num" id="8465552">1</span><span class="op" id="8465553">,</span>&nbsp;<span class="num" id="8465555">2</span><span class="op" id="8465556">,</span>&nbsp;<span class="num" id="8465558">3</span><span class="op" id="8465559">,</span>&nbsp;<span class="num" id="8465561">4</span><span class="op" id="8465562">}</span><span class="op" id="8465563">,</span>&nbsp;<span class="ident" id="8465565">nil</span><span class="op" id="8465568">}</span><span class="op" id="8465569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465572">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465626">{</span><span class="op" id="8465627">&amp;</span><span class="ident" id="8465628">Struct0</span><span class="op" id="8465635">{</span><span class="op" id="8465636">&amp;</span><span class="ident" id="8465637">NewType0</span><span class="op" id="8465645">{</span><span class="string" id="8465646">&#34;value0&#34;</span><span class="op" id="8465654">}</span><span class="op" id="8465655">}</span><span class="op" id="8465656">,</span>&nbsp;<span class="ident" id="8465658">nil</span><span class="op" id="8465661">}</span><span class="op" id="8465662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465665">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465718">{</span><span class="op" id="8465719">[</span><span class="op" id="8465720">]</span><span class="keyword" id="8465721">interface</span><span class="op" id="8465730">{</span><span class="op" id="8465731">}</span><span class="op" id="8465732">{</span><span class="string" id="8465733">&#34;hi&#34;</span><span class="op" id="8465737">,</span>&nbsp;<span class="op" id="8465739">&amp;</span><span class="ident" id="8465740">NewType0</span><span class="op" id="8465748">{</span><span class="string" id="8465749">&#34;value1&#34;</span><span class="op" id="8465757">}</span><span class="op" id="8465758">,</span>&nbsp;<span class="num" id="8465760">23</span><span class="op" id="8465762">}</span><span class="op" id="8465763">,</span>&nbsp;<span class="ident" id="8465765">nil</span><span class="op" id="8465768">}</span><span class="op" id="8465769">,</span><br>
<span class="lineno"></span><span class="op" id="8465771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8465774">func</span>&nbsp;<span class="ident" id="8465779">TestDecodeIntoNothing</span><span class="op" id="8465800">(</span><span class="ident" id="8465801">t</span>&nbsp;<span class="op" id="8465803">*</span><span class="ident" id="8465804">testing</span><span class="op" id="8465811">.</span><span class="ident" id="8465812">T</span><span class="op" id="8465813">)</span>&nbsp;<span class="op" id="8465815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465818">Register</span><span class="op" id="8465826">(</span><span class="builtinfunc" id="8465827">new</span><span class="op" id="8465830">(</span><span class="ident" id="8465831">NewType0</span><span class="op" id="8465839">)</span><span class="op" id="8465840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465843">for</span>&nbsp;<span class="ident" id="8465847">i</span><span class="op" id="8465848">,</span>&nbsp;<span class="ident" id="8465850">test</span>&nbsp;<span class="op" id="8465855">:=</span>&nbsp;<span class="keyword" id="8465858">range</span>&nbsp;<span class="ident" id="8465864">ignoreTests</span>&nbsp;<span class="op" id="8465876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465880">b</span>&nbsp;<span class="op" id="8465882">:=</span>&nbsp;<span class="builtinfunc" id="8465885">new</span><span class="op" id="8465888">(</span><span class="ident" id="8465889">bytes</span><span class="op" id="8465894">.</span><span class="ident" id="8465895">Buffer</span><span class="op" id="8465901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465905">enc</span>&nbsp;<span class="op" id="8465909">:=</span>&nbsp;<span class="ident" id="8465912">NewEncoder</span><span class="op" id="8465922">(</span><span class="ident" id="8465923">b</span><span class="op" id="8465924">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465928">err</span>&nbsp;<span class="op" id="8465932">:=</span>&nbsp;<span class="ident" id="8465935">enc</span><span class="op" id="8465938">.</span><span class="ident" id="8465939">Encode</span><span class="op" id="8465945">(</span><span class="ident" id="8465946">test</span><span class="op" id="8465950">.</span><span class="ident" id="8465951">in</span><span class="op" id="8465953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465957">if</span>&nbsp;<span class="ident" id="8465960">err</span>&nbsp;<span class="op" id="8465964">!=</span>&nbsp;<span class="ident" id="8465967">nil</span>&nbsp;<span class="op" id="8465971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465976">t</span><span class="op" id="8465977">.</span><span class="ident" id="8465978">Errorf</span><span class="op" id="8465984">(</span><span class="string" id="8465985">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="8466007">,</span>&nbsp;<span class="ident" id="8466009">i</span><span class="op" id="8466010">,</span>&nbsp;<span class="ident" id="8466012">err</span><span class="op" id="8466015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466020">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466031">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466035">dec</span>&nbsp;<span class="op" id="8466039">:=</span>&nbsp;<span class="ident" id="8466042">NewDecoder</span><span class="op" id="8466052">(</span><span class="ident" id="8466053">b</span><span class="op" id="8466054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466058">err</span>&nbsp;<span class="op" id="8466062">=</span>&nbsp;<span class="ident" id="8466064">dec</span><span class="op" id="8466067">.</span><span class="ident" id="8466068">Decode</span><span class="op" id="8466074">(</span><span class="ident" id="8466075">test</span><span class="op" id="8466079">.</span><span class="ident" id="8466080">out</span><span class="op" id="8466083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466087">if</span>&nbsp;<span class="ident" id="8466090">err</span>&nbsp;<span class="op" id="8466094">!=</span>&nbsp;<span class="ident" id="8466097">nil</span>&nbsp;<span class="op" id="8466101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466106">t</span><span class="op" id="8466107">.</span><span class="ident" id="8466108">Errorf</span><span class="op" id="8466114">(</span><span class="string" id="8466115">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8466137">,</span>&nbsp;<span class="ident" id="8466139">i</span><span class="op" id="8466140">,</span>&nbsp;<span class="ident" id="8466142">err</span><span class="op" id="8466145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466150">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8466165">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466232">str</span>&nbsp;<span class="op" id="8466236">:=</span>&nbsp;<span class="ident" id="8466239">fmt</span><span class="op" id="8466242">.</span><span class="ident" id="8466243">Sprintf</span><span class="op" id="8466250">(</span><span class="string" id="8466251">&#34;Value&nbsp;%d&#34;</span><span class="op" id="8466261">,</span>&nbsp;<span class="ident" id="8466263">i</span><span class="op" id="8466264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466268">err</span>&nbsp;<span class="op" id="8466272">=</span>&nbsp;<span class="ident" id="8466274">enc</span><span class="op" id="8466277">.</span><span class="ident" id="8466278">Encode</span><span class="op" id="8466284">(</span><span class="op" id="8466285">&amp;</span><span class="ident" id="8466286">NewType0</span><span class="op" id="8466294">{</span><span class="ident" id="8466295">str</span><span class="op" id="8466298">}</span><span class="op" id="8466299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466303">if</span>&nbsp;<span class="ident" id="8466306">err</span>&nbsp;<span class="op" id="8466310">!=</span>&nbsp;<span class="ident" id="8466313">nil</span>&nbsp;<span class="op" id="8466317">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466322">t</span><span class="op" id="8466323">.</span><span class="ident" id="8466324">Fatalf</span><span class="op" id="8466330">(</span><span class="string" id="8466331">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8466362">,</span>&nbsp;<span class="ident" id="8466364">i</span><span class="op" id="8466365">,</span>&nbsp;<span class="ident" id="8466367">err</span><span class="op" id="8466370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466378">ns</span>&nbsp;<span class="op" id="8466381">:=</span>&nbsp;<span class="builtinfunc" id="8466384">new</span><span class="op" id="8466387">(</span><span class="ident" id="8466388">NewType0</span><span class="op" id="8466396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466400">err</span>&nbsp;<span class="op" id="8466404">=</span>&nbsp;<span class="ident" id="8466406">dec</span><span class="op" id="8466409">.</span><span class="ident" id="8466410">Decode</span><span class="op" id="8466416">(</span><span class="ident" id="8466417">ns</span><span class="op" id="8466419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466423">if</span>&nbsp;<span class="ident" id="8466426">err</span>&nbsp;<span class="op" id="8466430">!=</span>&nbsp;<span class="ident" id="8466433">nil</span>&nbsp;<span class="op" id="8466437">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466442">t</span><span class="op" id="8466443">.</span><span class="ident" id="8466444">Fatalf</span><span class="op" id="8466450">(</span><span class="string" id="8466451">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8466482">,</span>&nbsp;<span class="ident" id="8466484">i</span><span class="op" id="8466485">,</span>&nbsp;<span class="ident" id="8466487">err</span><span class="op" id="8466490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466498">if</span>&nbsp;<span class="ident" id="8466501">ns</span><span class="op" id="8466503">.</span><span class="ident" id="8466504">S</span>&nbsp;<span class="op" id="8466506">!=</span>&nbsp;<span class="ident" id="8466509">str</span>&nbsp;<span class="op" id="8466513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466518">t</span><span class="op" id="8466519">.</span><span class="ident" id="8466520">Fatalf</span><span class="op" id="8466526">(</span><span class="string" id="8466527">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8466551">,</span>&nbsp;<span class="ident" id="8466553">i</span><span class="op" id="8466554">,</span>&nbsp;<span class="ident" id="8466556">str</span><span class="op" id="8466559">,</span>&nbsp;<span class="ident" id="8466561">ns</span><span class="op" id="8466563">.</span><span class="ident" id="8466564">S</span><span class="op" id="8466565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466569">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466572">}</span><br>
<span class="lineno"></span><span class="op" id="8466574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8466577">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="8466639">type</span>&nbsp;<span class="ident" id="8466644">Bug0Outer</span>&nbsp;<span class="keyword" id="8466654">struct</span>&nbsp;<span class="op" id="8466661">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466664">Bug0Field</span>&nbsp;<span class="keyword" id="8466674">interface</span><span class="op" id="8466683">{</span><span class="op" id="8466684">}</span><br>
<span class="lineno"></span><span class="op" id="8466686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8466689">type</span>&nbsp;<span class="ident" id="8466694">Bug0Inner</span>&nbsp;<span class="keyword" id="8466704">struct</span>&nbsp;<span class="op" id="8466711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466714">A</span>&nbsp;<span class="builtintype" id="8466716">int</span><br>
<span class="lineno">555</span><span class="op" id="8466720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8466723">func</span>&nbsp;<span class="ident" id="8466728">TestNestedInterfaces</span><span class="op" id="8466748">(</span><span class="ident" id="8466749">t</span>&nbsp;<span class="op" id="8466751">*</span><span class="ident" id="8466752">testing</span><span class="op" id="8466759">.</span><span class="ident" id="8466760">T</span><span class="op" id="8466761">)</span>&nbsp;<span class="op" id="8466763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466766">var</span>&nbsp;<span class="ident" id="8466770">buf</span>&nbsp;<span class="ident" id="8466774">bytes</span><span class="op" id="8466779">.</span><span class="ident" id="8466780">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466788">e</span>&nbsp;<span class="op" id="8466790">:=</span>&nbsp;<span class="ident" id="8466793">NewEncoder</span><span class="op" id="8466803">(</span><span class="op" id="8466804">&amp;</span><span class="ident" id="8466805">buf</span><span class="op" id="8466808">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466811">d</span>&nbsp;<span class="op" id="8466813">:=</span>&nbsp;<span class="ident" id="8466816">NewDecoder</span><span class="op" id="8466826">(</span><span class="op" id="8466827">&amp;</span><span class="ident" id="8466828">buf</span><span class="op" id="8466831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466834">Register</span><span class="op" id="8466842">(</span><span class="builtinfunc" id="8466843">new</span><span class="op" id="8466846">(</span><span class="ident" id="8466847">Bug0Outer</span><span class="op" id="8466856">)</span><span class="op" id="8466857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466860">Register</span><span class="op" id="8466868">(</span><span class="builtinfunc" id="8466869">new</span><span class="op" id="8466872">(</span><span class="ident" id="8466873">Bug0Inner</span><span class="op" id="8466882">)</span><span class="op" id="8466883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466886">f</span>&nbsp;<span class="op" id="8466888">:=</span>&nbsp;<span class="op" id="8466891">&amp;</span><span class="ident" id="8466892">Bug0Outer</span><span class="op" id="8466901">{</span><span class="op" id="8466902">&amp;</span><span class="ident" id="8466903">Bug0Outer</span><span class="op" id="8466912">{</span><span class="op" id="8466913">&amp;</span><span class="ident" id="8466914">Bug0Inner</span><span class="op" id="8466923">{</span><span class="num" id="8466924">7</span><span class="op" id="8466925">}</span><span class="op" id="8466926">}</span><span class="op" id="8466927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466930">var</span>&nbsp;<span class="ident" id="8466934">v</span>&nbsp;<span class="keyword" id="8466936">interface</span><span class="op" id="8466945">{</span><span class="op" id="8466946">}</span>&nbsp;<span class="op" id="8466948">=</span>&nbsp;<span class="ident" id="8466950">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466953">err</span>&nbsp;<span class="op" id="8466957">:=</span>&nbsp;<span class="ident" id="8466960">e</span><span class="op" id="8466961">.</span><span class="ident" id="8466962">Encode</span><span class="op" id="8466968">(</span><span class="op" id="8466969">&amp;</span><span class="ident" id="8466970">v</span><span class="op" id="8466971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466974">if</span>&nbsp;<span class="ident" id="8466977">err</span>&nbsp;<span class="op" id="8466981">!=</span>&nbsp;<span class="ident" id="8466984">nil</span>&nbsp;<span class="op" id="8466988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466992">t</span><span class="op" id="8466993">.</span><span class="ident" id="8466994">Fatal</span><span class="op" id="8466999">(</span><span class="string" id="8467000">&#34;Encode:&#34;</span><span class="op" id="8467009">,</span>&nbsp;<span class="ident" id="8467011">err</span><span class="op" id="8467014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467020">err</span>&nbsp;<span class="op" id="8467024">=</span>&nbsp;<span class="ident" id="8467026">d</span><span class="op" id="8467027">.</span><span class="ident" id="8467028">Decode</span><span class="op" id="8467034">(</span><span class="op" id="8467035">&amp;</span><span class="ident" id="8467036">v</span><span class="op" id="8467037">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467040">if</span>&nbsp;<span class="ident" id="8467043">err</span>&nbsp;<span class="op" id="8467047">!=</span>&nbsp;<span class="ident" id="8467050">nil</span>&nbsp;<span class="op" id="8467054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467058">t</span><span class="op" id="8467059">.</span><span class="ident" id="8467060">Fatal</span><span class="op" id="8467065">(</span><span class="string" id="8467066">&#34;Decode:&#34;</span><span class="op" id="8467075">,</span>&nbsp;<span class="ident" id="8467077">err</span><span class="op" id="8467080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467086">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467122">outer1</span><span class="op" id="8467128">,</span>&nbsp;<span class="ident" id="8467130">ok</span>&nbsp;<span class="op" id="8467133">:=</span>&nbsp;<span class="ident" id="8467136">v</span><span class="op" id="8467137">.</span><span class="op" id="8467138">(</span><span class="op" id="8467139">*</span><span class="ident" id="8467140">Bug0Outer</span><span class="op" id="8467149">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467152">if</span>&nbsp;<span class="op" id="8467155">!</span><span class="ident" id="8467156">ok</span>&nbsp;<span class="op" id="8467159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467163">t</span><span class="op" id="8467164">.</span><span class="ident" id="8467165">Fatalf</span><span class="op" id="8467171">(</span><span class="string" id="8467172">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8467193">,</span>&nbsp;<span class="ident" id="8467195">v</span><span class="op" id="8467196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467202">outer2</span><span class="op" id="8467208">,</span>&nbsp;<span class="ident" id="8467210">ok</span>&nbsp;<span class="op" id="8467213">:=</span>&nbsp;<span class="ident" id="8467216">outer1</span><span class="op" id="8467222">.</span><span class="ident" id="8467223">Bug0Field</span><span class="op" id="8467232">.</span><span class="op" id="8467233">(</span><span class="op" id="8467234">*</span><span class="ident" id="8467235">Bug0Outer</span><span class="op" id="8467244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467247">if</span>&nbsp;<span class="op" id="8467250">!</span><span class="ident" id="8467251">ok</span>&nbsp;<span class="op" id="8467254">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467258">t</span><span class="op" id="8467259">.</span><span class="ident" id="8467260">Fatalf</span><span class="op" id="8467266">(</span><span class="string" id="8467267">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8467298">,</span>&nbsp;<span class="ident" id="8467300">outer1</span><span class="op" id="8467306">.</span><span class="ident" id="8467307">Bug0Field</span><span class="op" id="8467316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467322">inner</span><span class="op" id="8467327">,</span>&nbsp;<span class="ident" id="8467329">ok</span>&nbsp;<span class="op" id="8467332">:=</span>&nbsp;<span class="ident" id="8467335">outer2</span><span class="op" id="8467341">.</span><span class="ident" id="8467342">Bug0Field</span><span class="op" id="8467351">.</span><span class="op" id="8467352">(</span><span class="op" id="8467353">*</span><span class="ident" id="8467354">Bug0Inner</span><span class="op" id="8467363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467366">if</span>&nbsp;<span class="op" id="8467369">!</span><span class="ident" id="8467370">ok</span>&nbsp;<span class="op" id="8467373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467377">t</span><span class="op" id="8467378">.</span><span class="ident" id="8467379">Fatalf</span><span class="op" id="8467385">(</span><span class="string" id="8467386">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="8467427">,</span>&nbsp;<span class="ident" id="8467429">outer2</span><span class="op" id="8467435">.</span><span class="ident" id="8467436">Bug0Field</span><span class="op" id="8467445">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467451">if</span>&nbsp;<span class="ident" id="8467454">inner</span><span class="op" id="8467459">.</span><span class="ident" id="8467460">A</span>&nbsp;<span class="op" id="8467462">!=</span>&nbsp;<span class="num" id="8467465">7</span>&nbsp;<span class="op" id="8467467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467471">t</span><span class="op" id="8467472">.</span><span class="ident" id="8467473">Fatalf</span><span class="op" id="8467479">(</span><span class="string" id="8467480">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8467509">,</span>&nbsp;<span class="ident" id="8467511">inner</span><span class="op" id="8467516">.</span><span class="ident" id="8467517">A</span><span class="op" id="8467518">,</span>&nbsp;<span class="num" id="8467520">7</span><span class="op" id="8467521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467524">}</span><br>
<span class="lineno"></span><span class="op" id="8467526">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="8467529">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8467602">type</span>&nbsp;<span class="ident" id="8467607">Bug1Elem</span>&nbsp;<span class="keyword" id="8467616">struct</span>&nbsp;<span class="op" id="8467623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467626">Name</span>&nbsp;<span class="builtintype" id="8467631">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467639">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8467644">int</span><br>
<span class="lineno"></span><span class="op" id="8467648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8467651">type</span>&nbsp;<span class="ident" id="8467656">Bug1StructMap</span>&nbsp;<span class="keyword" id="8467670">map</span><span class="op" id="8467673">[</span><span class="builtintype" id="8467674">string</span><span class="op" id="8467680">]</span><span class="ident" id="8467681">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="8467691">func</span>&nbsp;<span class="ident" id="8467696">bug1EncDec</span><span class="op" id="8467706">(</span><span class="ident" id="8467707">in</span>&nbsp;<span class="ident" id="8467710">Bug1StructMap</span><span class="op" id="8467723">,</span>&nbsp;<span class="ident" id="8467725">out</span>&nbsp;<span class="op" id="8467729">*</span><span class="ident" id="8467730">Bug1StructMap</span><span class="op" id="8467743">)</span>&nbsp;<span class="builtintype" id="8467745">error</span>&nbsp;<span class="op" id="8467751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467754">return</span>&nbsp;<span class="ident" id="8467761">nil</span><br>
<span class="lineno"></span><span class="op" id="8467765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8467768">func</span>&nbsp;<span class="ident" id="8467773">TestMapBug1</span><span class="op" id="8467784">(</span><span class="ident" id="8467785">t</span>&nbsp;<span class="op" id="8467787">*</span><span class="ident" id="8467788">testing</span><span class="op" id="8467795">.</span><span class="ident" id="8467796">T</span><span class="op" id="8467797">)</span>&nbsp;<span class="op" id="8467799">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467802">in</span>&nbsp;<span class="op" id="8467805">:=</span>&nbsp;<span class="builtinfunc" id="8467808">make</span><span class="op" id="8467812">(</span><span class="ident" id="8467813">Bug1StructMap</span><span class="op" id="8467826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467829">in</span><span class="op" id="8467831">[</span><span class="string" id="8467832">&#34;val1&#34;</span><span class="op" id="8467838">]</span>&nbsp;<span class="op" id="8467840">=</span>&nbsp;<span class="ident" id="8467842">Bug1Elem</span><span class="op" id="8467850">{</span><span class="string" id="8467851">&#34;elem1&#34;</span><span class="op" id="8467858">,</span>&nbsp;<span class="num" id="8467860">1</span><span class="op" id="8467861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467864">in</span><span class="op" id="8467866">[</span><span class="string" id="8467867">&#34;val2&#34;</span><span class="op" id="8467873">]</span>&nbsp;<span class="op" id="8467875">=</span>&nbsp;<span class="ident" id="8467877">Bug1Elem</span><span class="op" id="8467885">{</span><span class="string" id="8467886">&#34;elem2&#34;</span><span class="op" id="8467893">,</span>&nbsp;<span class="num" id="8467895">2</span><span class="op" id="8467896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467900">b</span>&nbsp;<span class="op" id="8467902">:=</span>&nbsp;<span class="builtinfunc" id="8467905">new</span><span class="op" id="8467908">(</span><span class="ident" id="8467909">bytes</span><span class="op" id="8467914">.</span><span class="ident" id="8467915">Buffer</span><span class="op" id="8467921">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467924">enc</span>&nbsp;<span class="op" id="8467928">:=</span>&nbsp;<span class="ident" id="8467931">NewEncoder</span><span class="op" id="8467941">(</span><span class="ident" id="8467942">b</span><span class="op" id="8467943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467946">err</span>&nbsp;<span class="op" id="8467950">:=</span>&nbsp;<span class="ident" id="8467953">enc</span><span class="op" id="8467956">.</span><span class="ident" id="8467957">Encode</span><span class="op" id="8467963">(</span><span class="ident" id="8467964">in</span><span class="op" id="8467966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467969">if</span>&nbsp;<span class="ident" id="8467972">err</span>&nbsp;<span class="op" id="8467976">!=</span>&nbsp;<span class="ident" id="8467979">nil</span>&nbsp;<span class="op" id="8467983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467987">t</span><span class="op" id="8467988">.</span><span class="ident" id="8467989">Fatal</span><span class="op" id="8467994">(</span><span class="string" id="8467995">&#34;encode:&#34;</span><span class="op" id="8468004">,</span>&nbsp;<span class="ident" id="8468006">err</span><span class="op" id="8468009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468012">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468015">dec</span>&nbsp;<span class="op" id="8468019">:=</span>&nbsp;<span class="ident" id="8468022">NewDecoder</span><span class="op" id="8468032">(</span><span class="ident" id="8468033">b</span><span class="op" id="8468034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468037">out</span>&nbsp;<span class="op" id="8468041">:=</span>&nbsp;<span class="builtinfunc" id="8468044">make</span><span class="op" id="8468048">(</span><span class="ident" id="8468049">Bug1StructMap</span><span class="op" id="8468062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468065">err</span>&nbsp;<span class="op" id="8468069">=</span>&nbsp;<span class="ident" id="8468071">dec</span><span class="op" id="8468074">.</span><span class="ident" id="8468075">Decode</span><span class="op" id="8468081">(</span><span class="op" id="8468082">&amp;</span><span class="ident" id="8468083">out</span><span class="op" id="8468086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468089">if</span>&nbsp;<span class="ident" id="8468092">err</span>&nbsp;<span class="op" id="8468096">!=</span>&nbsp;<span class="ident" id="8468099">nil</span>&nbsp;<span class="op" id="8468103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468107">t</span><span class="op" id="8468108">.</span><span class="ident" id="8468109">Fatal</span><span class="op" id="8468114">(</span><span class="string" id="8468115">&#34;decode:&#34;</span><span class="op" id="8468124">,</span>&nbsp;<span class="ident" id="8468126">err</span><span class="op" id="8468129">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468135">if</span>&nbsp;<span class="op" id="8468138">!</span><span class="ident" id="8468139">reflect</span><span class="op" id="8468146">.</span><span class="ident" id="8468147">DeepEqual</span><span class="op" id="8468156">(</span><span class="ident" id="8468157">in</span><span class="op" id="8468159">,</span>&nbsp;<span class="ident" id="8468161">out</span><span class="op" id="8468164">)</span>&nbsp;<span class="op" id="8468166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468170">t</span><span class="op" id="8468171">.</span><span class="ident" id="8468172">Errorf</span><span class="op" id="8468178">(</span><span class="string" id="8468179">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="8468196">,</span>&nbsp;<span class="ident" id="8468198">in</span><span class="op" id="8468200">,</span>&nbsp;<span class="ident" id="8468202">out</span><span class="op" id="8468205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468208">}</span><br>
<span class="lineno"></span><span class="op" id="8468210">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="8468213">func</span>&nbsp;<span class="ident" id="8468218">TestGobMapInterfaceEncode</span><span class="op" id="8468243">(</span><span class="ident" id="8468244">t</span>&nbsp;<span class="op" id="8468246">*</span><span class="ident" id="8468247">testing</span><span class="op" id="8468254">.</span><span class="ident" id="8468255">T</span><span class="op" id="8468256">)</span>&nbsp;<span class="op" id="8468258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468261">m</span>&nbsp;<span class="op" id="8468263">:=</span>&nbsp;<span class="keyword" id="8468266">map</span><span class="op" id="8468269">[</span><span class="builtintype" id="8468270">string</span><span class="op" id="8468276">]</span><span class="keyword" id="8468277">interface</span><span class="op" id="8468286">{</span><span class="op" id="8468287">}</span><span class="op" id="8468288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468292">&#34;up&#34;</span><span class="op" id="8468296">:</span>&nbsp;<span class="builtintype" id="8468298">uintptr</span><span class="op" id="8468305">(</span><span class="num" id="8468306">0</span><span class="op" id="8468307">)</span><span class="op" id="8468308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468312">&#34;i0&#34;</span><span class="op" id="8468316">:</span>&nbsp;<span class="op" id="8468318">[</span><span class="op" id="8468319">]</span><span class="builtintype" id="8468320">int</span><span class="op" id="8468323">{</span><span class="op" id="8468324">-</span><span class="num" id="8468325">1</span><span class="op" id="8468326">}</span><span class="op" id="8468327">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468331">&#34;i1&#34;</span><span class="op" id="8468335">:</span>&nbsp;<span class="op" id="8468337">[</span><span class="op" id="8468338">]</span><span class="builtintype" id="8468339">int8</span><span class="op" id="8468343">{</span><span class="op" id="8468344">-</span><span class="num" id="8468345">1</span><span class="op" id="8468346">}</span><span class="op" id="8468347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468351">&#34;i2&#34;</span><span class="op" id="8468355">:</span>&nbsp;<span class="op" id="8468357">[</span><span class="op" id="8468358">]</span><span class="builtintype" id="8468359">int16</span><span class="op" id="8468364">{</span><span class="op" id="8468365">-</span><span class="num" id="8468366">1</span><span class="op" id="8468367">}</span><span class="op" id="8468368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468372">&#34;i3&#34;</span><span class="op" id="8468376">:</span>&nbsp;<span class="op" id="8468378">[</span><span class="op" id="8468379">]</span><span class="builtintype" id="8468380">int32</span><span class="op" id="8468385">{</span><span class="op" id="8468386">-</span><span class="num" id="8468387">1</span><span class="op" id="8468388">}</span><span class="op" id="8468389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468393">&#34;i4&#34;</span><span class="op" id="8468397">:</span>&nbsp;<span class="op" id="8468399">[</span><span class="op" id="8468400">]</span><span class="ident" id="8468401">int64</span><span class="op" id="8468406">{</span><span class="op" id="8468407">-</span><span class="num" id="8468408">1</span><span class="op" id="8468409">}</span><span class="op" id="8468410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468414">&#34;u0&#34;</span><span class="op" id="8468418">:</span>&nbsp;<span class="op" id="8468420">[</span><span class="op" id="8468421">]</span><span class="builtintype" id="8468422">uint</span><span class="op" id="8468426">{</span><span class="num" id="8468427">1</span><span class="op" id="8468428">}</span><span class="op" id="8468429">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468433">&#34;u1&#34;</span><span class="op" id="8468437">:</span>&nbsp;<span class="op" id="8468439">[</span><span class="op" id="8468440">]</span><span class="builtintype" id="8468441">uint8</span><span class="op" id="8468446">{</span><span class="num" id="8468447">1</span><span class="op" id="8468448">}</span><span class="op" id="8468449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468453">&#34;u2&#34;</span><span class="op" id="8468457">:</span>&nbsp;<span class="op" id="8468459">[</span><span class="op" id="8468460">]</span><span class="builtintype" id="8468461">uint16</span><span class="op" id="8468467">{</span><span class="num" id="8468468">1</span><span class="op" id="8468469">}</span><span class="op" id="8468470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468474">&#34;u3&#34;</span><span class="op" id="8468478">:</span>&nbsp;<span class="op" id="8468480">[</span><span class="op" id="8468481">]</span><span class="builtintype" id="8468482">uint32</span><span class="op" id="8468488">{</span><span class="num" id="8468489">1</span><span class="op" id="8468490">}</span><span class="op" id="8468491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468495">&#34;u4&#34;</span><span class="op" id="8468499">:</span>&nbsp;<span class="op" id="8468501">[</span><span class="op" id="8468502">]</span><span class="ident" id="8468503">uint64</span><span class="op" id="8468509">{</span><span class="num" id="8468510">1</span><span class="op" id="8468511">}</span><span class="op" id="8468512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468516">&#34;f0&#34;</span><span class="op" id="8468520">:</span>&nbsp;<span class="op" id="8468522">[</span><span class="op" id="8468523">]</span><span class="builtintype" id="8468524">float32</span><span class="op" id="8468531">{</span><span class="num" id="8468532">1</span><span class="op" id="8468533">}</span><span class="op" id="8468534">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468538">&#34;f1&#34;</span><span class="op" id="8468542">:</span>&nbsp;<span class="op" id="8468544">[</span><span class="op" id="8468545">]</span><span class="builtintype" id="8468546">float64</span><span class="op" id="8468553">{</span><span class="num" id="8468554">1</span><span class="op" id="8468555">}</span><span class="op" id="8468556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468560">&#34;c0&#34;</span><span class="op" id="8468564">:</span>&nbsp;<span class="op" id="8468566">[</span><span class="op" id="8468567">]</span><span class="builtintype" id="8468568">complex64</span><span class="op" id="8468577">{</span><span class="builtinfunc" id="8468578">complex</span><span class="op" id="8468585">(</span><span class="num" id="8468586">2</span><span class="op" id="8468587">,</span>&nbsp;<span class="op" id="8468589">-</span><span class="num" id="8468590">2</span><span class="op" id="8468591">)</span><span class="op" id="8468592">}</span><span class="op" id="8468593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468597">&#34;c1&#34;</span><span class="op" id="8468601">:</span>&nbsp;<span class="op" id="8468603">[</span><span class="op" id="8468604">]</span><span class="builtintype" id="8468605">complex128</span><span class="op" id="8468615">{</span><span class="builtinfunc" id="8468616">complex</span><span class="op" id="8468623">(</span><span class="num" id="8468624">2</span><span class="op" id="8468625">,</span>&nbsp;<span class="builtintype" id="8468627">float64</span><span class="op" id="8468634">(</span><span class="op" id="8468635">-</span><span class="num" id="8468636">2</span><span class="op" id="8468637">)</span><span class="op" id="8468638">)</span><span class="op" id="8468639">}</span><span class="op" id="8468640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468644">&#34;us&#34;</span><span class="op" id="8468648">:</span>&nbsp;<span class="op" id="8468650">[</span><span class="op" id="8468651">]</span><span class="builtintype" id="8468652">uintptr</span><span class="op" id="8468659">{</span><span class="num" id="8468660">0</span><span class="op" id="8468661">}</span><span class="op" id="8468662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468666">&#34;bo&#34;</span><span class="op" id="8468670">:</span>&nbsp;<span class="op" id="8468672">[</span><span class="op" id="8468673">]</span><span class="builtintype" id="8468674">bool</span><span class="op" id="8468678">{</span><span class="builtintype" id="8468679">false</span><span class="op" id="8468684">}</span><span class="op" id="8468685">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8468689">&#34;st&#34;</span><span class="op" id="8468693">:</span>&nbsp;<span class="op" id="8468695">[</span><span class="op" id="8468696">]</span><span class="builtintype" id="8468697">string</span><span class="op" id="8468703">{</span><span class="string" id="8468704">&#34;s&#34;</span><span class="op" id="8468707">}</span><span class="op" id="8468708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468714">enc</span>&nbsp;<span class="op" id="8468718">:=</span>&nbsp;<span class="ident" id="8468721">NewEncoder</span><span class="op" id="8468731">(</span><span class="builtinfunc" id="8468732">new</span><span class="op" id="8468735">(</span><span class="ident" id="8468736">bytes</span><span class="op" id="8468741">.</span><span class="ident" id="8468742">Buffer</span><span class="op" id="8468748">)</span><span class="op" id="8468749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468752">err</span>&nbsp;<span class="op" id="8468756">:=</span>&nbsp;<span class="ident" id="8468759">enc</span><span class="op" id="8468762">.</span><span class="ident" id="8468763">Encode</span><span class="op" id="8468769">(</span><span class="ident" id="8468770">m</span><span class="op" id="8468771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468774">if</span>&nbsp;<span class="ident" id="8468777">err</span>&nbsp;<span class="op" id="8468781">!=</span>&nbsp;<span class="ident" id="8468784">nil</span>&nbsp;<span class="op" id="8468788">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468792">t</span><span class="op" id="8468793">.</span><span class="ident" id="8468794">Errorf</span><span class="op" id="8468800">(</span><span class="string" id="8468801">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="8468817">,</span>&nbsp;<span class="ident" id="8468819">err</span><span class="op" id="8468822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468825">}</span><br>
<span class="lineno"></span><span class="op" id="8468827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8468830">func</span>&nbsp;<span class="ident" id="8468835">TestSliceReusesMemory</span><span class="op" id="8468856">(</span><span class="ident" id="8468857">t</span>&nbsp;<span class="op" id="8468859">*</span><span class="ident" id="8468860">testing</span><span class="op" id="8468867">.</span><span class="ident" id="8468868">T</span><span class="op" id="8468869">)</span>&nbsp;<span class="op" id="8468871">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468874">buf</span>&nbsp;<span class="op" id="8468878">:=</span>&nbsp;<span class="builtinfunc" id="8468881">new</span><span class="op" id="8468884">(</span><span class="ident" id="8468885">bytes</span><span class="op" id="8468890">.</span><span class="ident" id="8468891">Buffer</span><span class="op" id="8468897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8468900">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468914">x</span>&nbsp;<span class="op" id="8468916">:=</span>&nbsp;<span class="op" id="8468919">[</span><span class="op" id="8468920">]</span><span class="builtintype" id="8468921">byte</span><span class="op" id="8468925">(</span><span class="string" id="8468926">&#34;abcd&#34;</span><span class="op" id="8468932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468936">enc</span>&nbsp;<span class="op" id="8468940">:=</span>&nbsp;<span class="ident" id="8468943">NewEncoder</span><span class="op" id="8468953">(</span><span class="ident" id="8468954">buf</span><span class="op" id="8468957">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468961">err</span>&nbsp;<span class="op" id="8468965">:=</span>&nbsp;<span class="ident" id="8468968">enc</span><span class="op" id="8468971">.</span><span class="ident" id="8468972">Encode</span><span class="op" id="8468978">(</span><span class="ident" id="8468979">x</span><span class="op" id="8468980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468984">if</span>&nbsp;<span class="ident" id="8468987">err</span>&nbsp;<span class="op" id="8468991">!=</span>&nbsp;<span class="ident" id="8468994">nil</span>&nbsp;<span class="op" id="8468998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469003">t</span><span class="op" id="8469004">.</span><span class="ident" id="8469005">Errorf</span><span class="op" id="8469011">(</span><span class="string" id="8469012">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8469031">,</span>&nbsp;<span class="ident" id="8469033">err</span><span class="op" id="8469036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8469044">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469085">y</span>&nbsp;<span class="op" id="8469087">:=</span>&nbsp;<span class="op" id="8469090">[</span><span class="op" id="8469091">]</span><span class="builtintype" id="8469092">byte</span><span class="op" id="8469096">(</span><span class="string" id="8469097">&#34;ABCDE&#34;</span><span class="op" id="8469104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469108">addr</span>&nbsp;<span class="op" id="8469113">:=</span>&nbsp;<span class="op" id="8469116">&amp;</span><span class="ident" id="8469117">y</span><span class="op" id="8469118">[</span><span class="num" id="8469119">0</span><span class="op" id="8469120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469124">dec</span>&nbsp;<span class="op" id="8469128">:=</span>&nbsp;<span class="ident" id="8469131">NewDecoder</span><span class="op" id="8469141">(</span><span class="ident" id="8469142">buf</span><span class="op" id="8469145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469149">err</span>&nbsp;<span class="op" id="8469153">=</span>&nbsp;<span class="ident" id="8469155">dec</span><span class="op" id="8469158">.</span><span class="ident" id="8469159">Decode</span><span class="op" id="8469165">(</span><span class="op" id="8469166">&amp;</span><span class="ident" id="8469167">y</span><span class="op" id="8469168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469172">if</span>&nbsp;<span class="ident" id="8469175">err</span>&nbsp;<span class="op" id="8469179">!=</span>&nbsp;<span class="ident" id="8469182">nil</span>&nbsp;<span class="op" id="8469186">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469191">t</span><span class="op" id="8469192">.</span><span class="ident" id="8469193">Fatal</span><span class="op" id="8469198">(</span><span class="string" id="8469199">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="8469215">,</span>&nbsp;<span class="ident" id="8469217">err</span><span class="op" id="8469220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469228">if</span>&nbsp;<span class="op" id="8469231">!</span><span class="ident" id="8469232">bytes</span><span class="op" id="8469237">.</span><span class="ident" id="8469238">Equal</span><span class="op" id="8469243">(</span><span class="ident" id="8469244">x</span><span class="op" id="8469245">,</span>&nbsp;<span class="ident" id="8469247">y</span><span class="op" id="8469248">)</span>&nbsp;<span class="op" id="8469250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469255">t</span><span class="op" id="8469256">.</span><span class="ident" id="8469257">Errorf</span><span class="op" id="8469263">(</span><span class="string" id="8469264">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8469293">,</span>&nbsp;<span class="ident" id="8469295">x</span><span class="op" id="8469296">,</span>&nbsp;<span class="ident" id="8469298">y</span><span class="op" id="8469299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469303">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469307">if</span>&nbsp;<span class="ident" id="8469310">addr</span>&nbsp;<span class="op" id="8469315">!=</span>&nbsp;<span class="op" id="8469318">&amp;</span><span class="ident" id="8469319">y</span><span class="op" id="8469320">[</span><span class="num" id="8469321">0</span><span class="op" id="8469322">]</span>&nbsp;<span class="op" id="8469324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469329">t</span><span class="op" id="8469330">.</span><span class="ident" id="8469331">Errorf</span><span class="op" id="8469337">(</span><span class="string" id="8469338">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8469371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8469381">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469403">x</span>&nbsp;<span class="op" id="8469405">:=</span>&nbsp;<span class="op" id="8469408">[</span><span class="op" id="8469409">]</span><span class="builtintype" id="8469410">rune</span><span class="op" id="8469414">(</span><span class="string" id="8469415">&#34;abcd&#34;</span><span class="op" id="8469421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469425">enc</span>&nbsp;<span class="op" id="8469429">:=</span>&nbsp;<span class="ident" id="8469432">NewEncoder</span><span class="op" id="8469442">(</span><span class="ident" id="8469443">buf</span><span class="op" id="8469446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469450">err</span>&nbsp;<span class="op" id="8469454">:=</span>&nbsp;<span class="ident" id="8469457">enc</span><span class="op" id="8469460">.</span><span class="ident" id="8469461">Encode</span><span class="op" id="8469467">(</span><span class="ident" id="8469468">x</span><span class="op" id="8469469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469473">if</span>&nbsp;<span class="ident" id="8469476">err</span>&nbsp;<span class="op" id="8469480">!=</span>&nbsp;<span class="ident" id="8469483">nil</span>&nbsp;<span class="op" id="8469487">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469492">t</span><span class="op" id="8469493">.</span><span class="ident" id="8469494">Errorf</span><span class="op" id="8469500">(</span><span class="string" id="8469501">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8469519">,</span>&nbsp;<span class="ident" id="8469521">err</span><span class="op" id="8469524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8469532">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469573">y</span>&nbsp;<span class="op" id="8469575">:=</span>&nbsp;<span class="op" id="8469578">[</span><span class="op" id="8469579">]</span><span class="builtintype" id="8469580">rune</span><span class="op" id="8469584">(</span><span class="string" id="8469585">&#34;ABCDE&#34;</span><span class="op" id="8469592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469596">addr</span>&nbsp;<span class="op" id="8469601">:=</span>&nbsp;<span class="op" id="8469604">&amp;</span><span class="ident" id="8469605">y</span><span class="op" id="8469606">[</span><span class="num" id="8469607">0</span><span class="op" id="8469608">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469612">dec</span>&nbsp;<span class="op" id="8469616">:=</span>&nbsp;<span class="ident" id="8469619">NewDecoder</span><span class="op" id="8469629">(</span><span class="ident" id="8469630">buf</span><span class="op" id="8469633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469637">err</span>&nbsp;<span class="op" id="8469641">=</span>&nbsp;<span class="ident" id="8469643">dec</span><span class="op" id="8469646">.</span><span class="ident" id="8469647">Decode</span><span class="op" id="8469653">(</span><span class="op" id="8469654">&amp;</span><span class="ident" id="8469655">y</span><span class="op" id="8469656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469660">if</span>&nbsp;<span class="ident" id="8469663">err</span>&nbsp;<span class="op" id="8469667">!=</span>&nbsp;<span class="ident" id="8469670">nil</span>&nbsp;<span class="op" id="8469674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469679">t</span><span class="op" id="8469680">.</span><span class="ident" id="8469681">Fatal</span><span class="op" id="8469686">(</span><span class="string" id="8469687">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="8469702">,</span>&nbsp;<span class="ident" id="8469704">err</span><span class="op" id="8469707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469711">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469715">if</span>&nbsp;<span class="op" id="8469718">!</span><span class="ident" id="8469719">reflect</span><span class="op" id="8469726">.</span><span class="ident" id="8469727">DeepEqual</span><span class="op" id="8469736">(</span><span class="ident" id="8469737">x</span><span class="op" id="8469738">,</span>&nbsp;<span class="ident" id="8469740">y</span><span class="op" id="8469741">)</span>&nbsp;<span class="op" id="8469743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469748">t</span><span class="op" id="8469749">.</span><span class="ident" id="8469750">Errorf</span><span class="op" id="8469756">(</span><span class="string" id="8469757">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8469785">,</span>&nbsp;<span class="ident" id="8469787">x</span><span class="op" id="8469788">,</span>&nbsp;<span class="ident" id="8469790">y</span><span class="op" id="8469791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8469799">if</span>&nbsp;<span class="ident" id="8469802">addr</span>&nbsp;<span class="op" id="8469807">!=</span>&nbsp;<span class="op" id="8469810">&amp;</span><span class="ident" id="8469811">y</span><span class="op" id="8469812">[</span><span class="num" id="8469813">0</span><span class="op" id="8469814">]</span>&nbsp;<span class="op" id="8469816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469821">t</span><span class="op" id="8469822">.</span><span class="ident" id="8469823">Errorf</span><span class="op" id="8469829">(</span><span class="string" id="8469830">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8469862">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8469869">}</span><br>
<span class="lineno"></span><span class="op" id="8469871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8469874">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="8469923">func</span>&nbsp;<span class="ident" id="8469928">TestBadCount</span><span class="op" id="8469940">(</span><span class="ident" id="8469941">t</span>&nbsp;<span class="op" id="8469943">*</span><span class="ident" id="8469944">testing</span><span class="op" id="8469951">.</span><span class="ident" id="8469952">T</span><span class="op" id="8469953">)</span>&nbsp;<span class="op" id="8469955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8469958">b</span>&nbsp;<span class="op" id="8469960">:=</span>&nbsp;<span class="op" id="8469963">[</span><span class="op" id="8469964">]</span><span class="builtintype" id="8469965">byte</span><span class="op" id="8469969">{</span><span class="num" id="8469970">0xfb</span><span class="op" id="8469974">,</span>&nbsp;<span class="num" id="8469976">0xa5</span><span class="op" id="8469980">,</span>&nbsp;<span class="num" id="8469982">0x82</span><span class="op" id="8469986">,</span>&nbsp;<span class="num" id="8469988">0x2f</span><span class="op" id="8469992">,</span>&nbsp;<span class="num" id="8469994">0xca</span><span class="op" id="8469998">,</span>&nbsp;<span class="num" id="8470000">0x1</span><span class="op" id="8470003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470006">if</span>&nbsp;<span class="ident" id="8470009">err</span>&nbsp;<span class="op" id="8470013">:=</span>&nbsp;<span class="ident" id="8470016">NewDecoder</span><span class="op" id="8470026">(</span><span class="ident" id="8470027">bytes</span><span class="op" id="8470032">.</span><span class="ident" id="8470033">NewReader</span><span class="op" id="8470042">(</span><span class="ident" id="8470043">b</span><span class="op" id="8470044">)</span><span class="op" id="8470045">)</span><span class="op" id="8470046">.</span><span class="ident" id="8470047">Decode</span><span class="op" id="8470053">(</span><span class="ident" id="8470054">nil</span><span class="op" id="8470057">)</span><span class="op" id="8470058">;</span>&nbsp;<span class="ident" id="8470060">err</span>&nbsp;<span class="op" id="8470064">==</span>&nbsp;<span class="ident" id="8470067">nil</span>&nbsp;<span class="op" id="8470071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470075">t</span><span class="op" id="8470076">.</span><span class="ident" id="8470077">Error</span><span class="op" id="8470082">(</span><span class="string" id="8470083">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="8470114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470117">}</span>&nbsp;<span class="keyword" id="8470119">else</span>&nbsp;<span class="keyword" id="8470124">if</span>&nbsp;<span class="ident" id="8470127">err</span><span class="op" id="8470130">.</span><span class="ident" id="8470131">Error</span><span class="op" id="8470136">(</span><span class="op" id="8470137">)</span>&nbsp;<span class="op" id="8470139">!=</span>&nbsp;<span class="ident" id="8470142">errBadCount</span><span class="op" id="8470153">.</span><span class="ident" id="8470154">Error</span><span class="op" id="8470159">(</span><span class="op" id="8470160">)</span>&nbsp;<span class="op" id="8470162">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470166">t</span><span class="op" id="8470167">.</span><span class="ident" id="8470168">Error</span><span class="op" id="8470173">(</span><span class="string" id="8470174">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8470205">,</span>&nbsp;<span class="ident" id="8470207">err</span><span class="op" id="8470210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470213">}</span><br>
<span class="lineno"></span><span class="op" id="8470215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8470218">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="8470282">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="8470342">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8470377">func</span>&nbsp;<span class="ident" id="8470382">TestSequentialDecoder</span><span class="op" id="8470403">(</span><span class="ident" id="8470404">t</span>&nbsp;<span class="op" id="8470406">*</span><span class="ident" id="8470407">testing</span><span class="op" id="8470414">.</span><span class="ident" id="8470415">T</span><span class="op" id="8470416">)</span>&nbsp;<span class="op" id="8470418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470421">b</span>&nbsp;<span class="op" id="8470423">:=</span>&nbsp;<span class="builtinfunc" id="8470426">new</span><span class="op" id="8470429">(</span><span class="ident" id="8470430">bytes</span><span class="op" id="8470435">.</span><span class="ident" id="8470436">Buffer</span><span class="op" id="8470442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470445">enc</span>&nbsp;<span class="op" id="8470449">:=</span>&nbsp;<span class="ident" id="8470452">NewEncoder</span><span class="op" id="8470462">(</span><span class="ident" id="8470463">b</span><span class="op" id="8470464">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470467">const</span>&nbsp;<span class="ident" id="8470473">count</span>&nbsp;<span class="op" id="8470479">=</span>&nbsp;<span class="num" id="8470481">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470485">for</span>&nbsp;<span class="ident" id="8470489">i</span>&nbsp;<span class="op" id="8470491">:=</span>&nbsp;<span class="num" id="8470494">0</span><span class="op" id="8470495">;</span>&nbsp;<span class="ident" id="8470497">i</span>&nbsp;<span class="op" id="8470499">&lt;</span>&nbsp;<span class="ident" id="8470501">count</span><span class="op" id="8470506">;</span>&nbsp;<span class="ident" id="8470508">i</span><span class="op" id="8470509">++</span>&nbsp;<span class="op" id="8470512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470516">s</span>&nbsp;<span class="op" id="8470518">:=</span>&nbsp;<span class="ident" id="8470521">fmt</span><span class="op" id="8470524">.</span><span class="ident" id="8470525">Sprintf</span><span class="op" id="8470532">(</span><span class="string" id="8470533">&#34;%d&#34;</span><span class="op" id="8470537">,</span>&nbsp;<span class="ident" id="8470539">i</span><span class="op" id="8470540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470544">if</span>&nbsp;<span class="ident" id="8470547">err</span>&nbsp;<span class="op" id="8470551">:=</span>&nbsp;<span class="ident" id="8470554">enc</span><span class="op" id="8470557">.</span><span class="ident" id="8470558">Encode</span><span class="op" id="8470564">(</span><span class="ident" id="8470565">s</span><span class="op" id="8470566">)</span><span class="op" id="8470567">;</span>&nbsp;<span class="ident" id="8470569">err</span>&nbsp;<span class="op" id="8470573">!=</span>&nbsp;<span class="ident" id="8470576">nil</span>&nbsp;<span class="op" id="8470580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470585">t</span><span class="op" id="8470586">.</span><span class="ident" id="8470587">Error</span><span class="op" id="8470592">(</span><span class="string" id="8470593">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8470608">,</span>&nbsp;<span class="ident" id="8470610">err</span><span class="op" id="8470613">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470623">for</span>&nbsp;<span class="ident" id="8470627">i</span>&nbsp;<span class="op" id="8470629">:=</span>&nbsp;<span class="num" id="8470632">0</span><span class="op" id="8470633">;</span>&nbsp;<span class="ident" id="8470635">i</span>&nbsp;<span class="op" id="8470637">&lt;</span>&nbsp;<span class="ident" id="8470639">count</span><span class="op" id="8470644">;</span>&nbsp;<span class="ident" id="8470646">i</span><span class="op" id="8470647">++</span>&nbsp;<span class="op" id="8470650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470654">dec</span>&nbsp;<span class="op" id="8470658">:=</span>&nbsp;<span class="ident" id="8470661">NewDecoder</span><span class="op" id="8470671">(</span><span class="ident" id="8470672">b</span><span class="op" id="8470673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470677">var</span>&nbsp;<span class="ident" id="8470681">s</span>&nbsp;<span class="builtintype" id="8470683">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470692">if</span>&nbsp;<span class="ident" id="8470695">err</span>&nbsp;<span class="op" id="8470699">:=</span>&nbsp;<span class="ident" id="8470702">dec</span><span class="op" id="8470705">.</span><span class="ident" id="8470706">Decode</span><span class="op" id="8470712">(</span><span class="op" id="8470713">&amp;</span><span class="ident" id="8470714">s</span><span class="op" id="8470715">)</span><span class="op" id="8470716">;</span>&nbsp;<span class="ident" id="8470718">err</span>&nbsp;<span class="op" id="8470722">!=</span>&nbsp;<span class="ident" id="8470725">nil</span>&nbsp;<span class="op" id="8470729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470734">t</span><span class="op" id="8470735">.</span><span class="ident" id="8470736">Fatal</span><span class="op" id="8470741">(</span><span class="string" id="8470742">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="8470757">,</span>&nbsp;<span class="ident" id="8470759">err</span><span class="op" id="8470762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8470770">if</span>&nbsp;<span class="ident" id="8470773">s</span>&nbsp;<span class="op" id="8470775">!=</span>&nbsp;<span class="ident" id="8470778">fmt</span><span class="op" id="8470781">.</span><span class="ident" id="8470782">Sprintf</span><span class="op" id="8470789">(</span><span class="string" id="8470790">&#34;%d&#34;</span><span class="op" id="8470794">,</span>&nbsp;<span class="ident" id="8470796">i</span><span class="op" id="8470797">)</span>&nbsp;<span class="op" id="8470799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470804">t</span><span class="op" id="8470805">.</span><span class="ident" id="8470806">Fatalf</span><span class="op" id="8470812">(</span><span class="string" id="8470813">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8470840">,</span>&nbsp;<span class="ident" id="8470842">i</span><span class="op" id="8470843">,</span>&nbsp;<span class="ident" id="8470845">s</span><span class="op" id="8470846">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8470853">}</span><br>
<span class="lineno"></span><span class="op" id="8470855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8470858">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="8470954">type</span>&nbsp;<span class="ident" id="8470959">Bug2</span>&nbsp;<span class="keyword" id="8470964">struct</span>&nbsp;<span class="op" id="8470971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470974">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8470978">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470983">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8470987">chan</span>&nbsp;<span class="builtintype" id="8470992">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8470997">CP</span>&nbsp;&nbsp;<span class="op" id="8471001">*</span><span class="keyword" id="8471002">chan</span>&nbsp;<span class="builtintype" id="8471007">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471012">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8471016">func</span><span class="op" id="8471020">(</span><span class="op" id="8471021">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471024">FPP</span>&nbsp;<span class="op" id="8471028">*</span><span class="op" id="8471029">*</span><span class="keyword" id="8471030">func</span><span class="op" id="8471034">(</span><span class="op" id="8471035">)</span><br>
<span class="lineno"></span><span class="op" id="8471037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8471040">func</span>&nbsp;<span class="ident" id="8471045">TestChanFuncIgnored</span><span class="op" id="8471064">(</span><span class="ident" id="8471065">t</span>&nbsp;<span class="op" id="8471067">*</span><span class="ident" id="8471068">testing</span><span class="op" id="8471075">.</span><span class="ident" id="8471076">T</span><span class="op" id="8471077">)</span>&nbsp;<span class="op" id="8471079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471082">c</span>&nbsp;<span class="op" id="8471084">:=</span>&nbsp;<span class="builtinfunc" id="8471087">make</span><span class="op" id="8471091">(</span><span class="keyword" id="8471092">chan</span>&nbsp;<span class="builtintype" id="8471097">int</span><span class="op" id="8471100">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471103">f</span>&nbsp;<span class="op" id="8471105">:=</span>&nbsp;<span class="keyword" id="8471108">func</span><span class="op" id="8471112">(</span><span class="op" id="8471113">)</span>&nbsp;<span class="op" id="8471115">{</span><span class="op" id="8471116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471119">fp</span>&nbsp;<span class="op" id="8471122">:=</span>&nbsp;<span class="op" id="8471125">&amp;</span><span class="ident" id="8471126">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471129">b0</span>&nbsp;<span class="op" id="8471132">:=</span>&nbsp;<span class="ident" id="8471135">Bug2</span><span class="op" id="8471139">{</span><span class="num" id="8471140">23</span><span class="op" id="8471142">,</span>&nbsp;<span class="ident" id="8471144">c</span><span class="op" id="8471145">,</span>&nbsp;<span class="op" id="8471147">&amp;</span><span class="ident" id="8471148">c</span><span class="op" id="8471149">,</span>&nbsp;<span class="ident" id="8471151">f</span><span class="op" id="8471152">,</span>&nbsp;<span class="op" id="8471154">&amp;</span><span class="ident" id="8471155">fp</span><span class="op" id="8471157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471160">var</span>&nbsp;<span class="ident" id="8471164">buf</span>&nbsp;<span class="ident" id="8471168">bytes</span><span class="op" id="8471173">.</span><span class="ident" id="8471174">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471182">enc</span>&nbsp;<span class="op" id="8471186">:=</span>&nbsp;<span class="ident" id="8471189">NewEncoder</span><span class="op" id="8471199">(</span><span class="op" id="8471200">&amp;</span><span class="ident" id="8471201">buf</span><span class="op" id="8471204">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471207">if</span>&nbsp;<span class="ident" id="8471210">err</span>&nbsp;<span class="op" id="8471214">:=</span>&nbsp;<span class="ident" id="8471217">enc</span><span class="op" id="8471220">.</span><span class="ident" id="8471221">Encode</span><span class="op" id="8471227">(</span><span class="ident" id="8471228">b0</span><span class="op" id="8471230">)</span><span class="op" id="8471231">;</span>&nbsp;<span class="ident" id="8471233">err</span>&nbsp;<span class="op" id="8471237">!=</span>&nbsp;<span class="ident" id="8471240">nil</span>&nbsp;<span class="op" id="8471244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471248">t</span><span class="op" id="8471249">.</span><span class="ident" id="8471250">Fatal</span><span class="op" id="8471255">(</span><span class="string" id="8471256">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="8471273">,</span>&nbsp;<span class="ident" id="8471275">err</span><span class="op" id="8471278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471284">var</span>&nbsp;<span class="ident" id="8471288">b1</span>&nbsp;<span class="ident" id="8471291">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471297">err</span>&nbsp;<span class="op" id="8471301">:=</span>&nbsp;<span class="ident" id="8471304">NewDecoder</span><span class="op" id="8471314">(</span><span class="op" id="8471315">&amp;</span><span class="ident" id="8471316">buf</span><span class="op" id="8471319">)</span><span class="op" id="8471320">.</span><span class="ident" id="8471321">Decode</span><span class="op" id="8471327">(</span><span class="op" id="8471328">&amp;</span><span class="ident" id="8471329">b1</span><span class="op" id="8471331">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471334">if</span>&nbsp;<span class="ident" id="8471337">err</span>&nbsp;<span class="op" id="8471341">!=</span>&nbsp;<span class="ident" id="8471344">nil</span>&nbsp;<span class="op" id="8471348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471352">t</span><span class="op" id="8471353">.</span><span class="ident" id="8471354">Fatal</span><span class="op" id="8471359">(</span><span class="string" id="8471360">&#34;decode:&#34;</span><span class="op" id="8471369">,</span>&nbsp;<span class="ident" id="8471371">err</span><span class="op" id="8471374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471380">if</span>&nbsp;<span class="ident" id="8471383">b1</span><span class="op" id="8471385">.</span><span class="ident" id="8471386">A</span>&nbsp;<span class="op" id="8471388">!=</span>&nbsp;<span class="ident" id="8471391">b0</span><span class="op" id="8471393">.</span><span class="ident" id="8471394">A</span>&nbsp;<span class="op" id="8471396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471400">t</span><span class="op" id="8471401">.</span><span class="ident" id="8471402">Fatalf</span><span class="op" id="8471408">(</span><span class="string" id="8471409">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8471425">,</span>&nbsp;<span class="ident" id="8471427">b1</span><span class="op" id="8471429">.</span><span class="ident" id="8471430">A</span><span class="op" id="8471431">,</span>&nbsp;<span class="ident" id="8471433">b0</span><span class="op" id="8471435">.</span><span class="ident" id="8471436">A</span><span class="op" id="8471437">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471443">if</span>&nbsp;<span class="ident" id="8471446">b1</span><span class="op" id="8471448">.</span><span class="ident" id="8471449">C</span>&nbsp;<span class="op" id="8471451">!=</span>&nbsp;<span class="ident" id="8471454">nil</span>&nbsp;<span class="op" id="8471458">||</span>&nbsp;<span class="ident" id="8471461">b1</span><span class="op" id="8471463">.</span><span class="ident" id="8471464">CP</span>&nbsp;<span class="op" id="8471467">!=</span>&nbsp;<span class="ident" id="8471470">nil</span>&nbsp;<span class="op" id="8471474">||</span>&nbsp;<span class="ident" id="8471477">b1</span><span class="op" id="8471479">.</span><span class="ident" id="8471480">F</span>&nbsp;<span class="op" id="8471482">!=</span>&nbsp;<span class="ident" id="8471485">nil</span>&nbsp;<span class="op" id="8471489">||</span>&nbsp;<span class="ident" id="8471492">b1</span><span class="op" id="8471494">.</span><span class="ident" id="8471495">FPP</span>&nbsp;<span class="op" id="8471499">!=</span>&nbsp;<span class="ident" id="8471502">nil</span>&nbsp;<span class="op" id="8471506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471510">t</span><span class="op" id="8471511">.</span><span class="ident" id="8471512">Fatal</span><span class="op" id="8471517">(</span><span class="string" id="8471518">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="8471553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471556">}</span><br>
<span class="lineno"></span><span class="op" id="8471558">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="8471561">func</span>&nbsp;<span class="ident" id="8471566">TestSliceIncompatibility</span><span class="op" id="8471590">(</span><span class="ident" id="8471591">t</span>&nbsp;<span class="op" id="8471593">*</span><span class="ident" id="8471594">testing</span><span class="op" id="8471601">.</span><span class="ident" id="8471602">T</span><span class="op" id="8471603">)</span>&nbsp;<span class="op" id="8471605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471608">var</span>&nbsp;<span class="ident" id="8471612">in</span>&nbsp;<span class="op" id="8471615">=</span>&nbsp;<span class="op" id="8471617">[</span><span class="op" id="8471618">]</span><span class="builtintype" id="8471619">byte</span><span class="op" id="8471623">{</span><span class="num" id="8471624">1</span><span class="op" id="8471625">,</span>&nbsp;<span class="num" id="8471627">2</span><span class="op" id="8471628">,</span>&nbsp;<span class="num" id="8471630">3</span><span class="op" id="8471631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471634">var</span>&nbsp;<span class="ident" id="8471638">out</span>&nbsp;<span class="op" id="8471642">[</span><span class="op" id="8471643">]</span><span class="builtintype" id="8471644">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471649">if</span>&nbsp;<span class="ident" id="8471652">err</span>&nbsp;<span class="op" id="8471656">:=</span>&nbsp;<span class="ident" id="8471659">encAndDec</span><span class="op" id="8471668">(</span><span class="ident" id="8471669">in</span><span class="op" id="8471671">,</span>&nbsp;<span class="op" id="8471673">&amp;</span><span class="ident" id="8471674">out</span><span class="op" id="8471677">)</span><span class="op" id="8471678">;</span>&nbsp;<span class="ident" id="8471680">err</span>&nbsp;<span class="op" id="8471684">==</span>&nbsp;<span class="ident" id="8471687">nil</span>&nbsp;<span class="op" id="8471691">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471695">t</span><span class="op" id="8471696">.</span><span class="ident" id="8471697">Error</span><span class="op" id="8471702">(</span><span class="string" id="8471703">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="8471733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471736">}</span><br>
<span class="lineno"></span><span class="op" id="8471738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8471741">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="8471798">type</span>&nbsp;<span class="ident" id="8471803">Bug3</span>&nbsp;<span class="keyword" id="8471808">struct</span>&nbsp;<span class="op" id="8471815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471818">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8471827">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471832">Children</span>&nbsp;<span class="op" id="8471841">[</span><span class="op" id="8471842">]</span><span class="op" id="8471843">*</span><span class="ident" id="8471844">Bug3</span><br>
<span class="lineno"></span><span class="op" id="8471849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="8471852">func</span>&nbsp;<span class="ident" id="8471857">TestGobPtrSlices</span><span class="op" id="8471873">(</span><span class="ident" id="8471874">t</span>&nbsp;<span class="op" id="8471876">*</span><span class="ident" id="8471877">testing</span><span class="op" id="8471884">.</span><span class="ident" id="8471885">T</span><span class="op" id="8471886">)</span>&nbsp;<span class="op" id="8471888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471891">in</span>&nbsp;<span class="op" id="8471894">:=</span>&nbsp;<span class="op" id="8471897">[</span><span class="op" id="8471898">]</span><span class="op" id="8471899">*</span><span class="ident" id="8471900">Bug3</span><span class="op" id="8471904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471908">{</span><span class="num" id="8471909">1</span><span class="op" id="8471910">,</span>&nbsp;<span class="ident" id="8471912">nil</span><span class="op" id="8471915">}</span><span class="op" id="8471916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471920">{</span><span class="num" id="8471921">2</span><span class="op" id="8471922">,</span>&nbsp;<span class="ident" id="8471924">nil</span><span class="op" id="8471927">}</span><span class="op" id="8471928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8471931">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471934">b</span>&nbsp;<span class="op" id="8471936">:=</span>&nbsp;<span class="builtinfunc" id="8471939">new</span><span class="op" id="8471942">(</span><span class="ident" id="8471943">bytes</span><span class="op" id="8471948">.</span><span class="ident" id="8471949">Buffer</span><span class="op" id="8471955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8471958">err</span>&nbsp;<span class="op" id="8471962">:=</span>&nbsp;<span class="ident" id="8471965">NewEncoder</span><span class="op" id="8471975">(</span><span class="ident" id="8471976">b</span><span class="op" id="8471977">)</span><span class="op" id="8471978">.</span><span class="ident" id="8471979">Encode</span><span class="op" id="8471985">(</span><span class="op" id="8471986">&amp;</span><span class="ident" id="8471987">in</span><span class="op" id="8471989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8471992">if</span>&nbsp;<span class="ident" id="8471995">err</span>&nbsp;<span class="op" id="8471999">!=</span>&nbsp;<span class="ident" id="8472002">nil</span>&nbsp;<span class="op" id="8472006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472010">t</span><span class="op" id="8472011">.</span><span class="ident" id="8472012">Fatal</span><span class="op" id="8472017">(</span><span class="string" id="8472018">&#34;encode:&#34;</span><span class="op" id="8472027">,</span>&nbsp;<span class="ident" id="8472029">err</span><span class="op" id="8472032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472035">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472039">var</span>&nbsp;<span class="ident" id="8472043">out</span>&nbsp;<span class="op" id="8472047">[</span><span class="op" id="8472048">]</span><span class="op" id="8472049">*</span><span class="ident" id="8472050">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472056">err</span>&nbsp;<span class="op" id="8472060">=</span>&nbsp;<span class="ident" id="8472062">NewDecoder</span><span class="op" id="8472072">(</span><span class="ident" id="8472073">b</span><span class="op" id="8472074">)</span><span class="op" id="8472075">.</span><span class="ident" id="8472076">Decode</span><span class="op" id="8472082">(</span><span class="op" id="8472083">&amp;</span><span class="ident" id="8472084">out</span><span class="op" id="8472087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472090">if</span>&nbsp;<span class="ident" id="8472093">err</span>&nbsp;<span class="op" id="8472097">!=</span>&nbsp;<span class="ident" id="8472100">nil</span>&nbsp;<span class="op" id="8472104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472108">t</span><span class="op" id="8472109">.</span><span class="ident" id="8472110">Fatal</span><span class="op" id="8472115">(</span><span class="string" id="8472116">&#34;decode:&#34;</span><span class="op" id="8472125">,</span>&nbsp;<span class="ident" id="8472127">err</span><span class="op" id="8472130">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472136">if</span>&nbsp;<span class="op" id="8472139">!</span><span class="ident" id="8472140">reflect</span><span class="op" id="8472147">.</span><span class="ident" id="8472148">DeepEqual</span><span class="op" id="8472157">(</span><span class="ident" id="8472158">in</span><span class="op" id="8472160">,</span>&nbsp;<span class="ident" id="8472162">out</span><span class="op" id="8472165">)</span>&nbsp;<span class="op" id="8472167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472171">t</span><span class="op" id="8472172">.</span><span class="ident" id="8472173">Fatalf</span><span class="op" id="8472179">(</span><span class="string" id="8472180">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="8472199">,</span>&nbsp;<span class="ident" id="8472201">out</span><span class="op" id="8472204">,</span>&nbsp;<span class="ident" id="8472206">in</span><span class="op" id="8472208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472211">}</span><br>
<span class="lineno"></span><span class="op" id="8472213">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="8472216">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="8472293">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8472363">func</span>&nbsp;<span class="ident" id="8472368">TestPtrToMapOfMap</span><span class="op" id="8472385">(</span><span class="ident" id="8472386">t</span>&nbsp;<span class="op" id="8472388">*</span><span class="ident" id="8472389">testing</span><span class="op" id="8472396">.</span><span class="ident" id="8472397">T</span><span class="op" id="8472398">)</span>&nbsp;<span class="op" id="8472400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472403">Register</span><span class="op" id="8472411">(</span><span class="builtinfunc" id="8472412">make</span><span class="op" id="8472416">(</span><span class="keyword" id="8472417">map</span><span class="op" id="8472420">[</span><span class="builtintype" id="8472421">string</span><span class="op" id="8472427">]</span><span class="keyword" id="8472428">interface</span><span class="op" id="8472437">{</span><span class="op" id="8472438">}</span><span class="op" id="8472439">)</span><span class="op" id="8472440">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472443">subdata</span>&nbsp;<span class="op" id="8472451">:=</span>&nbsp;<span class="builtinfunc" id="8472454">make</span><span class="op" id="8472458">(</span><span class="keyword" id="8472459">map</span><span class="op" id="8472462">[</span><span class="builtintype" id="8472463">string</span><span class="op" id="8472469">]</span><span class="keyword" id="8472470">interface</span><span class="op" id="8472479">{</span><span class="op" id="8472480">}</span><span class="op" id="8472481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472484">subdata</span><span class="op" id="8472491">[</span><span class="string" id="8472492">&#34;bar&#34;</span><span class="op" id="8472497">]</span>&nbsp;<span class="op" id="8472499">=</span>&nbsp;<span class="string" id="8472501">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472508">data</span>&nbsp;<span class="op" id="8472513">:=</span>&nbsp;<span class="builtinfunc" id="8472516">make</span><span class="op" id="8472520">(</span><span class="keyword" id="8472521">map</span><span class="op" id="8472524">[</span><span class="builtintype" id="8472525">string</span><span class="op" id="8472531">]</span><span class="keyword" id="8472532">interface</span><span class="op" id="8472541">{</span><span class="op" id="8472542">}</span><span class="op" id="8472543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472546">data</span><span class="op" id="8472550">[</span><span class="string" id="8472551">&#34;foo&#34;</span><span class="op" id="8472556">]</span>&nbsp;<span class="op" id="8472558">=</span>&nbsp;<span class="ident" id="8472560">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472570">b</span>&nbsp;<span class="op" id="8472572">:=</span>&nbsp;<span class="builtinfunc" id="8472575">new</span><span class="op" id="8472578">(</span><span class="ident" id="8472579">bytes</span><span class="op" id="8472584">.</span><span class="ident" id="8472585">Buffer</span><span class="op" id="8472591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472594">err</span>&nbsp;<span class="op" id="8472598">:=</span>&nbsp;<span class="ident" id="8472601">NewEncoder</span><span class="op" id="8472611">(</span><span class="ident" id="8472612">b</span><span class="op" id="8472613">)</span><span class="op" id="8472614">.</span><span class="ident" id="8472615">Encode</span><span class="op" id="8472621">(</span><span class="ident" id="8472622">data</span><span class="op" id="8472626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472629">if</span>&nbsp;<span class="ident" id="8472632">err</span>&nbsp;<span class="op" id="8472636">!=</span>&nbsp;<span class="ident" id="8472639">nil</span>&nbsp;<span class="op" id="8472643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472647">t</span><span class="op" id="8472648">.</span><span class="ident" id="8472649">Fatal</span><span class="op" id="8472654">(</span><span class="string" id="8472655">&#34;encode:&#34;</span><span class="op" id="8472664">,</span>&nbsp;<span class="ident" id="8472666">err</span><span class="op" id="8472669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472672">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472675">var</span>&nbsp;<span class="ident" id="8472679">newData</span>&nbsp;<span class="keyword" id="8472687">map</span><span class="op" id="8472690">[</span><span class="builtintype" id="8472691">string</span><span class="op" id="8472697">]</span><span class="keyword" id="8472698">interface</span><span class="op" id="8472707">{</span><span class="op" id="8472708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472711">err</span>&nbsp;<span class="op" id="8472715">=</span>&nbsp;<span class="ident" id="8472717">NewDecoder</span><span class="op" id="8472727">(</span><span class="ident" id="8472728">b</span><span class="op" id="8472729">)</span><span class="op" id="8472730">.</span><span class="ident" id="8472731">Decode</span><span class="op" id="8472737">(</span><span class="op" id="8472738">&amp;</span><span class="ident" id="8472739">newData</span><span class="op" id="8472746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472749">if</span>&nbsp;<span class="ident" id="8472752">err</span>&nbsp;<span class="op" id="8472756">!=</span>&nbsp;<span class="ident" id="8472759">nil</span>&nbsp;<span class="op" id="8472763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472767">t</span><span class="op" id="8472768">.</span><span class="ident" id="8472769">Fatal</span><span class="op" id="8472774">(</span><span class="string" id="8472775">&#34;decode:&#34;</span><span class="op" id="8472784">,</span>&nbsp;<span class="ident" id="8472786">err</span><span class="op" id="8472789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472792">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8472795">if</span>&nbsp;<span class="op" id="8472798">!</span><span class="ident" id="8472799">reflect</span><span class="op" id="8472806">.</span><span class="ident" id="8472807">DeepEqual</span><span class="op" id="8472816">(</span><span class="ident" id="8472817">data</span><span class="op" id="8472821">,</span>&nbsp;<span class="ident" id="8472823">newData</span><span class="op" id="8472830">)</span>&nbsp;<span class="op" id="8472832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8472836">t</span><span class="op" id="8472837">.</span><span class="ident" id="8472838">Fatalf</span><span class="op" id="8472844">(</span><span class="string" id="8472845">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8472865">,</span>&nbsp;<span class="ident" id="8472867">data</span><span class="op" id="8472871">,</span>&nbsp;<span class="ident" id="8472873">newData</span><span class="op" id="8472880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8472883">}</span><br>
<span class="lineno"></span><span class="op" id="8472885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="8472888">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8472971">func</span>&nbsp;<span class="ident" id="8472976">TestTopLevelNilPointer</span><span class="op" id="8472998">(</span><span class="ident" id="8472999">t</span>&nbsp;<span class="op" id="8473001">*</span><span class="ident" id="8473002">testing</span><span class="op" id="8473009">.</span><span class="ident" id="8473010">T</span><span class="op" id="8473011">)</span>&nbsp;<span class="op" id="8473013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473016">errMsg</span>&nbsp;<span class="op" id="8473023">:=</span>&nbsp;<span class="ident" id="8473026">topLevelNilPanic</span><span class="op" id="8473042">(</span><span class="ident" id="8473043">t</span><span class="op" id="8473044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473047">if</span>&nbsp;<span class="ident" id="8473050">errMsg</span>&nbsp;<span class="op" id="8473057">==</span>&nbsp;<span class="string" id="8473060">&#34;&#34;</span>&nbsp;<span class="op" id="8473063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473067">t</span><span class="op" id="8473068">.</span><span class="ident" id="8473069">Fatal</span><span class="op" id="8473074">(</span><span class="string" id="8473075">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8473112">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473118">if</span>&nbsp;<span class="op" id="8473121">!</span><span class="ident" id="8473122">strings</span><span class="op" id="8473129">.</span><span class="ident" id="8473130">Contains</span><span class="op" id="8473138">(</span><span class="ident" id="8473139">errMsg</span><span class="op" id="8473145">,</span>&nbsp;<span class="string" id="8473147">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8473160">)</span>&nbsp;<span class="op" id="8473162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473166">t</span><span class="op" id="8473167">.</span><span class="ident" id="8473168">Fatal</span><span class="op" id="8473173">(</span><span class="string" id="8473174">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="8473208">,</span>&nbsp;<span class="ident" id="8473210">errMsg</span><span class="op" id="8473216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473219">}</span><br>
<span class="lineno"></span><span class="op" id="8473221">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="8473224">func</span>&nbsp;<span class="ident" id="8473229">topLevelNilPanic</span><span class="op" id="8473245">(</span><span class="ident" id="8473246">t</span>&nbsp;<span class="op" id="8473248">*</span><span class="ident" id="8473249">testing</span><span class="op" id="8473256">.</span><span class="ident" id="8473257">T</span><span class="op" id="8473258">)</span>&nbsp;<span class="op" id="8473260">(</span><span class="ident" id="8473261">panicErr</span>&nbsp;<span class="builtintype" id="8473270">string</span><span class="op" id="8473276">)</span>&nbsp;<span class="op" id="8473278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473281">defer</span>&nbsp;<span class="keyword" id="8473287">func</span><span class="op" id="8473291">(</span><span class="op" id="8473292">)</span>&nbsp;<span class="op" id="8473294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473298">e</span>&nbsp;<span class="op" id="8473300">:=</span>&nbsp;<span class="builtinfunc" id="8473303">recover</span><span class="op" id="8473310">(</span><span class="op" id="8473311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473315">if</span>&nbsp;<span class="ident" id="8473318">err</span><span class="op" id="8473321">,</span>&nbsp;<span class="ident" id="8473323">ok</span>&nbsp;<span class="op" id="8473326">:=</span>&nbsp;<span class="ident" id="8473329">e</span><span class="op" id="8473330">.</span><span class="op" id="8473331">(</span><span class="builtintype" id="8473332">string</span><span class="op" id="8473338">)</span><span class="op" id="8473339">;</span>&nbsp;<span class="ident" id="8473341">ok</span>&nbsp;<span class="op" id="8473344">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473349">panicErr</span>&nbsp;<span class="op" id="8473358">=</span>&nbsp;<span class="ident" id="8473360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473369">}</span><span class="op" id="8473370">(</span><span class="op" id="8473371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473374">var</span>&nbsp;<span class="ident" id="8473378">ip</span>&nbsp;<span class="op" id="8473381">*</span><span class="builtintype" id="8473382">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473387">buf</span>&nbsp;<span class="op" id="8473391">:=</span>&nbsp;<span class="builtinfunc" id="8473394">new</span><span class="op" id="8473397">(</span><span class="ident" id="8473398">bytes</span><span class="op" id="8473403">.</span><span class="ident" id="8473404">Buffer</span><span class="op" id="8473410">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473413">if</span>&nbsp;<span class="ident" id="8473416">err</span>&nbsp;<span class="op" id="8473420">:=</span>&nbsp;<span class="ident" id="8473423">NewEncoder</span><span class="op" id="8473433">(</span><span class="ident" id="8473434">buf</span><span class="op" id="8473437">)</span><span class="op" id="8473438">.</span><span class="ident" id="8473439">Encode</span><span class="op" id="8473445">(</span><span class="ident" id="8473446">ip</span><span class="op" id="8473448">)</span><span class="op" id="8473449">;</span>&nbsp;<span class="ident" id="8473451">err</span>&nbsp;<span class="op" id="8473455">!=</span>&nbsp;<span class="ident" id="8473458">nil</span>&nbsp;<span class="op" id="8473462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473466">t</span><span class="op" id="8473467">.</span><span class="ident" id="8473468">Fatal</span><span class="op" id="8473473">(</span><span class="string" id="8473474">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="8473492">,</span>&nbsp;<span class="ident" id="8473494">err</span><span class="op" id="8473497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473503">return</span><br>
<span class="lineno"></span><span class="op" id="8473510">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="8473513">func</span>&nbsp;<span class="ident" id="8473518">TestNilPointerInsideInterface</span><span class="op" id="8473547">(</span><span class="ident" id="8473548">t</span>&nbsp;<span class="op" id="8473550">*</span><span class="ident" id="8473551">testing</span><span class="op" id="8473558">.</span><span class="ident" id="8473559">T</span><span class="op" id="8473560">)</span>&nbsp;<span class="op" id="8473562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473565">var</span>&nbsp;<span class="ident" id="8473569">ip</span>&nbsp;<span class="op" id="8473572">*</span><span class="builtintype" id="8473573">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473578">si</span>&nbsp;<span class="op" id="8473581">:=</span>&nbsp;<span class="keyword" id="8473584">struct</span>&nbsp;<span class="op" id="8473591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473595">I</span>&nbsp;<span class="keyword" id="8473597">interface</span><span class="op" id="8473606">{</span><span class="op" id="8473607">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473610">}</span><span class="op" id="8473611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473615">I</span><span class="op" id="8473616">:</span>&nbsp;<span class="ident" id="8473618">ip</span><span class="op" id="8473620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473626">buf</span>&nbsp;<span class="op" id="8473630">:=</span>&nbsp;<span class="builtinfunc" id="8473633">new</span><span class="op" id="8473636">(</span><span class="ident" id="8473637">bytes</span><span class="op" id="8473642">.</span><span class="ident" id="8473643">Buffer</span><span class="op" id="8473649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473652">err</span>&nbsp;<span class="op" id="8473656">:=</span>&nbsp;<span class="ident" id="8473659">NewEncoder</span><span class="op" id="8473669">(</span><span class="ident" id="8473670">buf</span><span class="op" id="8473673">)</span><span class="op" id="8473674">.</span><span class="ident" id="8473675">Encode</span><span class="op" id="8473681">(</span><span class="ident" id="8473682">si</span><span class="op" id="8473684">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473687">if</span>&nbsp;<span class="ident" id="8473690">err</span>&nbsp;<span class="op" id="8473694">==</span>&nbsp;<span class="ident" id="8473697">nil</span>&nbsp;<span class="op" id="8473701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473705">t</span><span class="op" id="8473706">.</span><span class="ident" id="8473707">Fatal</span><span class="op" id="8473712">(</span><span class="string" id="8473713">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="8473739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473745">errMsg</span>&nbsp;<span class="op" id="8473752">:=</span>&nbsp;<span class="ident" id="8473755">err</span><span class="op" id="8473758">.</span><span class="ident" id="8473759">Error</span><span class="op" id="8473764">(</span><span class="op" id="8473765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8473768">if</span>&nbsp;<span class="op" id="8473771">!</span><span class="ident" id="8473772">strings</span><span class="op" id="8473779">.</span><span class="ident" id="8473780">Contains</span><span class="op" id="8473788">(</span><span class="ident" id="8473789">errMsg</span><span class="op" id="8473795">,</span>&nbsp;<span class="string" id="8473797">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8473810">)</span>&nbsp;<span class="op" id="8473812">||</span>&nbsp;<span class="op" id="8473815">!</span><span class="ident" id="8473816">strings</span><span class="op" id="8473823">.</span><span class="ident" id="8473824">Contains</span><span class="op" id="8473832">(</span><span class="ident" id="8473833">errMsg</span><span class="op" id="8473839">,</span>&nbsp;<span class="string" id="8473841">&#34;interface&#34;</span><span class="op" id="8473852">)</span>&nbsp;<span class="op" id="8473854">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473858">t</span><span class="op" id="8473859">.</span><span class="ident" id="8473860">Fatal</span><span class="op" id="8473865">(</span><span class="string" id="8473866">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="8473920">,</span>&nbsp;<span class="ident" id="8473922">errMsg</span><span class="op" id="8473928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8473931">}</span><br>
<span class="lineno"></span><span class="op" id="8473933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8473936">type</span>&nbsp;<span class="ident" id="8473941">Bug4Public</span>&nbsp;<span class="keyword" id="8473952">struct</span>&nbsp;<span class="op" id="8473959">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473962">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8473969">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8473977">Secret</span>&nbsp;<span class="ident" id="8473984">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="8473995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8473998">type</span>&nbsp;<span class="ident" id="8474003">Bug4Secret</span>&nbsp;<span class="keyword" id="8474014">struct</span>&nbsp;<span class="op" id="8474021">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474024">a</span>&nbsp;<span class="builtintype" id="8474026">int</span>&nbsp;<span class="comment" id="8474030">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="8474060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8474063">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="8474141">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="8474156">func</span>&nbsp;<span class="ident" id="8474161">TestMutipleEncodingsOfBadType</span><span class="op" id="8474190">(</span><span class="ident" id="8474191">t</span>&nbsp;<span class="op" id="8474193">*</span><span class="ident" id="8474194">testing</span><span class="op" id="8474201">.</span><span class="ident" id="8474202">T</span><span class="op" id="8474203">)</span>&nbsp;<span class="op" id="8474205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474208">x</span>&nbsp;<span class="op" id="8474210">:=</span>&nbsp;<span class="ident" id="8474213">Bug4Public</span><span class="op" id="8474223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474227">Name</span><span class="op" id="8474231">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8474235">&#34;name&#34;</span><span class="op" id="8474241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474245">Secret</span><span class="op" id="8474251">:</span>&nbsp;<span class="ident" id="8474253">Bug4Secret</span><span class="op" id="8474263">{</span><span class="num" id="8474264">1</span><span class="op" id="8474265">}</span><span class="op" id="8474266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8474269">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474272">buf</span>&nbsp;<span class="op" id="8474276">:=</span>&nbsp;<span class="builtinfunc" id="8474279">new</span><span class="op" id="8474282">(</span><span class="ident" id="8474283">bytes</span><span class="op" id="8474288">.</span><span class="ident" id="8474289">Buffer</span><span class="op" id="8474295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474298">enc</span>&nbsp;<span class="op" id="8474302">:=</span>&nbsp;<span class="ident" id="8474305">NewEncoder</span><span class="op" id="8474315">(</span><span class="ident" id="8474316">buf</span><span class="op" id="8474319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474322">err</span>&nbsp;<span class="op" id="8474326">:=</span>&nbsp;<span class="ident" id="8474329">enc</span><span class="op" id="8474332">.</span><span class="ident" id="8474333">Encode</span><span class="op" id="8474339">(</span><span class="ident" id="8474340">x</span><span class="op" id="8474341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8474344">if</span>&nbsp;<span class="ident" id="8474347">err</span>&nbsp;<span class="op" id="8474351">==</span>&nbsp;<span class="ident" id="8474354">nil</span>&nbsp;<span class="op" id="8474358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474362">t</span><span class="op" id="8474363">.</span><span class="ident" id="8474364">Fatal</span><span class="op" id="8474369">(</span><span class="string" id="8474370">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8474402">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8474405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474408">buf</span><span class="op" id="8474411">.</span><span class="ident" id="8474412">Reset</span><span class="op" id="8474417">(</span><span class="op" id="8474418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474421">enc</span>&nbsp;<span class="op" id="8474425">=</span>&nbsp;<span class="ident" id="8474427">NewEncoder</span><span class="op" id="8474437">(</span><span class="ident" id="8474438">buf</span><span class="op" id="8474441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474444">err</span>&nbsp;<span class="op" id="8474448">=</span>&nbsp;<span class="ident" id="8474450">enc</span><span class="op" id="8474453">.</span><span class="ident" id="8474454">Encode</span><span class="op" id="8474460">(</span><span class="ident" id="8474461">x</span><span class="op" id="8474462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8474465">if</span>&nbsp;<span class="ident" id="8474468">err</span>&nbsp;<span class="op" id="8474472">==</span>&nbsp;<span class="ident" id="8474475">nil</span>&nbsp;<span class="op" id="8474479">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474483">t</span><span class="op" id="8474484">.</span><span class="ident" id="8474485">Fatal</span><span class="op" id="8474490">(</span><span class="string" id="8474491">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8474524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8474527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8474530">if</span>&nbsp;<span class="op" id="8474533">!</span><span class="ident" id="8474534">strings</span><span class="op" id="8474541">.</span><span class="ident" id="8474542">Contains</span><span class="op" id="8474550">(</span><span class="ident" id="8474551">err</span><span class="op" id="8474554">.</span><span class="ident" id="8474555">Error</span><span class="op" id="8474560">(</span><span class="op" id="8474561">)</span><span class="op" id="8474562">,</span>&nbsp;<span class="string" id="8474564">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="8474584">)</span>&nbsp;<span class="op" id="8474586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8474590">t</span><span class="op" id="8474591">.</span><span class="ident" id="8474592">Errorf</span><span class="op" id="8474598">(</span><span class="string" id="8474599">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8474648">,</span>&nbsp;<span class="ident" id="8474650">err</span><span class="op" id="8474653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8474656">}</span><br>
<span class="lineno">905</span><span class="op" id="8474658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8474661">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8474732">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="8474800">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="8474870">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8474940">type</span>&nbsp;<span class="ident" id="8474945">Z</span>&nbsp;<span class="keyword" id="8474947">struct</span>&nbsp;<span class="op" id="8474954">{</span><br>
<span class="lineno"></span><span class="op" id="8474956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="8474959">func</span>&nbsp;<span class="ident" id="8474964">Test29ElementSlice</span><span class="op" id="8474982">(</span><span class="ident" id="8474983">t</span>&nbsp;<span class="op" id="8474985">*</span><span class="ident" id="8474986">testing</span><span class="op" id="8474993">.</span><span class="ident" id="8474994">T</span><span class="op" id="8474995">)</span>&nbsp;<span class="op" id="8474997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475000">Register</span><span class="op" id="8475008">(</span><span class="ident" id="8475009">Z</span><span class="op" id="8475010">{</span><span class="op" id="8475011">}</span><span class="op" id="8475012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475015">src</span>&nbsp;<span class="op" id="8475019">:=</span>&nbsp;<span class="builtinfunc" id="8475022">make</span><span class="op" id="8475026">(</span><span class="op" id="8475027">[</span><span class="op" id="8475028">]</span><span class="keyword" id="8475029">interface</span><span class="op" id="8475038">{</span><span class="op" id="8475039">}</span><span class="op" id="8475040">,</span>&nbsp;<span class="num" id="8475042">100</span><span class="op" id="8475045">)</span>&nbsp;<span class="comment" id="8475047">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475105">for</span>&nbsp;<span class="ident" id="8475109">i</span>&nbsp;<span class="op" id="8475111">:=</span>&nbsp;<span class="keyword" id="8475114">range</span>&nbsp;<span class="ident" id="8475120">src</span>&nbsp;<span class="op" id="8475124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475128">src</span><span class="op" id="8475131">[</span><span class="ident" id="8475132">i</span><span class="op" id="8475133">]</span>&nbsp;<span class="op" id="8475135">=</span>&nbsp;<span class="ident" id="8475137">Z</span><span class="op" id="8475138">{</span><span class="op" id="8475139">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475145">buf</span>&nbsp;<span class="op" id="8475149">:=</span>&nbsp;<span class="builtinfunc" id="8475152">new</span><span class="op" id="8475155">(</span><span class="ident" id="8475156">bytes</span><span class="op" id="8475161">.</span><span class="ident" id="8475162">Buffer</span><span class="op" id="8475168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475171">err</span>&nbsp;<span class="op" id="8475175">:=</span>&nbsp;<span class="ident" id="8475178">NewEncoder</span><span class="op" id="8475188">(</span><span class="ident" id="8475189">buf</span><span class="op" id="8475192">)</span><span class="op" id="8475193">.</span><span class="ident" id="8475194">Encode</span><span class="op" id="8475200">(</span><span class="ident" id="8475201">src</span><span class="op" id="8475204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475207">if</span>&nbsp;<span class="ident" id="8475210">err</span>&nbsp;<span class="op" id="8475214">!=</span>&nbsp;<span class="ident" id="8475217">nil</span>&nbsp;<span class="op" id="8475221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475225">t</span><span class="op" id="8475226">.</span><span class="ident" id="8475227">Fatalf</span><span class="op" id="8475233">(</span><span class="string" id="8475234">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8475246">,</span>&nbsp;<span class="ident" id="8475248">err</span><span class="op" id="8475251">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475255">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475267">var</span>&nbsp;<span class="ident" id="8475271">dst</span>&nbsp;<span class="op" id="8475275">[</span><span class="op" id="8475276">]</span><span class="keyword" id="8475277">interface</span><span class="op" id="8475286">{</span><span class="op" id="8475287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475290">err</span>&nbsp;<span class="op" id="8475294">=</span>&nbsp;<span class="ident" id="8475296">NewDecoder</span><span class="op" id="8475306">(</span><span class="ident" id="8475307">buf</span><span class="op" id="8475310">)</span><span class="op" id="8475311">.</span><span class="ident" id="8475312">Decode</span><span class="op" id="8475318">(</span><span class="op" id="8475319">&amp;</span><span class="ident" id="8475320">dst</span><span class="op" id="8475323">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475326">if</span>&nbsp;<span class="ident" id="8475329">err</span>&nbsp;<span class="op" id="8475333">!=</span>&nbsp;<span class="ident" id="8475336">nil</span>&nbsp;<span class="op" id="8475340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475344">t</span><span class="op" id="8475345">.</span><span class="ident" id="8475346">Errorf</span><span class="op" id="8475352">(</span><span class="string" id="8475353">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="8475365">,</span>&nbsp;<span class="ident" id="8475367">err</span><span class="op" id="8475370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475382">}</span><br>
<span class="lineno"></span><span class="op" id="8475384">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="8475387">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="8475449">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="8475464">func</span>&nbsp;<span class="ident" id="8475469">TestErrorForHugeSlice</span><span class="op" id="8475490">(</span><span class="ident" id="8475491">t</span>&nbsp;<span class="op" id="8475493">*</span><span class="ident" id="8475494">testing</span><span class="op" id="8475501">.</span><span class="ident" id="8475502">T</span><span class="op" id="8475503">)</span>&nbsp;<span class="op" id="8475505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8475508">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475533">buf</span>&nbsp;<span class="op" id="8475537">:=</span>&nbsp;<span class="builtinfunc" id="8475540">new</span><span class="op" id="8475543">(</span><span class="ident" id="8475544">bytes</span><span class="op" id="8475549">.</span><span class="ident" id="8475550">Buffer</span><span class="op" id="8475556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475559">slice</span>&nbsp;<span class="op" id="8475565">:=</span>&nbsp;<span class="op" id="8475568">[</span><span class="op" id="8475569">]</span><span class="builtintype" id="8475570">int</span><span class="op" id="8475573">{</span><span class="num" id="8475574">1</span><span class="op" id="8475575">,</span>&nbsp;<span class="num" id="8475577">1</span><span class="op" id="8475578">,</span>&nbsp;<span class="num" id="8475580">1</span><span class="op" id="8475581">,</span>&nbsp;<span class="num" id="8475583">1</span><span class="op" id="8475584">,</span>&nbsp;<span class="num" id="8475586">1</span><span class="op" id="8475587">,</span>&nbsp;<span class="num" id="8475589">1</span><span class="op" id="8475590">,</span>&nbsp;<span class="num" id="8475592">1</span><span class="op" id="8475593">,</span>&nbsp;<span class="num" id="8475595">1</span><span class="op" id="8475596">,</span>&nbsp;<span class="num" id="8475598">1</span><span class="op" id="8475599">,</span>&nbsp;<span class="num" id="8475601">1</span><span class="op" id="8475602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475605">err</span>&nbsp;<span class="op" id="8475609">:=</span>&nbsp;<span class="ident" id="8475612">NewEncoder</span><span class="op" id="8475622">(</span><span class="ident" id="8475623">buf</span><span class="op" id="8475626">)</span><span class="op" id="8475627">.</span><span class="ident" id="8475628">Encode</span><span class="op" id="8475634">(</span><span class="ident" id="8475635">slice</span><span class="op" id="8475640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475643">if</span>&nbsp;<span class="ident" id="8475646">err</span>&nbsp;<span class="op" id="8475650">!=</span>&nbsp;<span class="ident" id="8475653">nil</span>&nbsp;<span class="op" id="8475657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475661">t</span><span class="op" id="8475662">.</span><span class="ident" id="8475663">Fatal</span><span class="op" id="8475668">(</span><span class="string" id="8475669">&#34;encode:&#34;</span><span class="op" id="8475678">,</span>&nbsp;<span class="ident" id="8475680">err</span><span class="op" id="8475683">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8475689">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475772">buf</span><span class="op" id="8475775">.</span><span class="ident" id="8475776">Bytes</span><span class="op" id="8475781">(</span><span class="op" id="8475782">)</span><span class="op" id="8475783">[</span><span class="ident" id="8475784">buf</span><span class="op" id="8475787">.</span><span class="ident" id="8475788">Len</span><span class="op" id="8475791">(</span><span class="op" id="8475792">)</span><span class="op" id="8475793">-</span><span class="builtinfunc" id="8475794">len</span><span class="op" id="8475797">(</span><span class="ident" id="8475798">slice</span><span class="op" id="8475803">)</span><span class="op" id="8475804">-</span><span class="num" id="8475805">1</span><span class="op" id="8475806">]</span>&nbsp;<span class="op" id="8475808">=</span>&nbsp;<span class="num" id="8475810">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8475816">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475842">err</span>&nbsp;<span class="op" id="8475846">=</span>&nbsp;<span class="ident" id="8475848">NewDecoder</span><span class="op" id="8475858">(</span><span class="ident" id="8475859">buf</span><span class="op" id="8475862">)</span><span class="op" id="8475863">.</span><span class="ident" id="8475864">Decode</span><span class="op" id="8475870">(</span><span class="op" id="8475871">&amp;</span><span class="ident" id="8475872">slice</span><span class="op" id="8475877">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475880">if</span>&nbsp;<span class="ident" id="8475883">err</span>&nbsp;<span class="op" id="8475887">==</span>&nbsp;<span class="ident" id="8475890">nil</span>&nbsp;<span class="op" id="8475894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475898">t</span><span class="op" id="8475899">.</span><span class="ident" id="8475900">Fatal</span><span class="op" id="8475905">(</span><span class="string" id="8475906">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="8475924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475930">if</span>&nbsp;<span class="op" id="8475933">!</span><span class="ident" id="8475934">strings</span><span class="op" id="8475941">.</span><span class="ident" id="8475942">Contains</span><span class="op" id="8475950">(</span><span class="ident" id="8475951">err</span><span class="op" id="8475954">.</span><span class="ident" id="8475955">Error</span><span class="op" id="8475960">(</span><span class="op" id="8475961">)</span><span class="op" id="8475962">,</span>&nbsp;<span class="string" id="8475964">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="8475979">)</span>&nbsp;<span class="op" id="8475981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475985">t</span><span class="op" id="8475986">.</span><span class="ident" id="8475987">Fatal</span><span class="op" id="8475992">(</span><span class="string" id="8475993">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8476039">,</span>&nbsp;<span class="ident" id="8476041">err</span><span class="op" id="8476044">.</span><span class="ident" id="8476045">Error</span><span class="op" id="8476050">(</span><span class="op" id="8476051">)</span><span class="op" id="8476052">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8476055">}</span><br>
<span class="lineno"></span><span class="op" id="8476057">}</span>
</div>
</body>
</html>
