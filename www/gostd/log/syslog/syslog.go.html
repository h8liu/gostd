<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6042744">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6042799">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6042853">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6042904">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6042937">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6043001">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6043066">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6043097">//</span><br>
<span class="lineno"></span><span class="comment" id="6043100">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6043158">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6043219">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6043239">package</span>&nbsp;<span class="ident" id="6043247">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6043255">import</span>&nbsp;<span class="op" id="6043262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043265">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043275">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043282">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043289">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043296">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043302">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043313">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6043321">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6043328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6043331">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6043391">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6043461">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6043530">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6043567">type</span>&nbsp;<span class="ident" id="6043572">Priority</span>&nbsp;<span class="builtintype" id="6043581">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043586">const</span>&nbsp;<span class="ident" id="6043592">severityMask</span>&nbsp;<span class="op" id="6043605">=</span>&nbsp;<span class="num" id="6043607">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6043612">const</span>&nbsp;<span class="ident" id="6043618">facilityMask</span>&nbsp;<span class="op" id="6043631">=</span>&nbsp;<span class="num" id="6043633">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6043639">const</span>&nbsp;<span class="op" id="6043645">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043648">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043663">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043699">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043747">LOG_EMERG</span>&nbsp;<span class="ident" id="6043757">Priority</span>&nbsp;<span class="op" id="6043766">=</span>&nbsp;<span class="ident" id="6043768">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043774">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043785">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043795">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043804">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043817">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043829">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043839">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6043849">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6043852">const</span>&nbsp;<span class="op" id="6043858">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043861">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043876">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043912">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043974">LOG_KERN</span>&nbsp;<span class="ident" id="6043983">Priority</span>&nbsp;<span class="op" id="6043992">=</span>&nbsp;<span class="ident" id="6043994">iota</span>&nbsp;<span class="op" id="6043999">&lt;&lt;</span>&nbsp;<span class="num" id="6044002">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044005">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044015">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044025">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044037">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044047">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044059">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044068">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044078">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044088">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044098">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044112">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044121">_</span>&nbsp;<span class="comment" id="6044123">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044134">_</span>&nbsp;<span class="comment" id="6044136">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044147">_</span>&nbsp;<span class="comment" id="6044149">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044160">_</span>&nbsp;<span class="comment" id="6044162">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044173">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044185">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044197">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044209">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044221">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044233">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044245">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044257">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6044268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6044271">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6044319">type</span>&nbsp;<span class="ident" id="6044324">Writer</span>&nbsp;<span class="keyword" id="6044331">struct</span>&nbsp;<span class="op" id="6044338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044341">priority</span>&nbsp;<span class="ident" id="6044350">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044360">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6044369">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044377">hostname</span>&nbsp;<span class="builtintype" id="6044386">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044394">network</span>&nbsp;&nbsp;<span class="builtintype" id="6044403">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044411">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6044420">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044429">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6044434">sync</span><span class="op" id="6044438">.</span><span class="ident" id="6044439">Mutex</span>&nbsp;<span class="comment" id="6044445">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044461">conn</span>&nbsp;<span class="ident" id="6044466">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6044477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6044480">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6044545">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6044613">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6044678">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6044749">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6044819">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6044847">type</span>&nbsp;<span class="ident" id="6044852">serverConn</span>&nbsp;<span class="keyword" id="6044863">interface</span>&nbsp;<span class="op" id="6044873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044876">writeString</span><span class="op" id="6044887">(</span><span class="ident" id="6044888">p</span>&nbsp;<span class="ident" id="6044890">Priority</span><span class="op" id="6044898">,</span>&nbsp;<span class="ident" id="6044900">hostname</span><span class="op" id="6044908">,</span>&nbsp;<span class="ident" id="6044910">tag</span><span class="op" id="6044913">,</span>&nbsp;<span class="ident" id="6044915">s</span><span class="op" id="6044916">,</span>&nbsp;<span class="ident" id="6044918">nl</span>&nbsp;<span class="builtintype" id="6044921">string</span><span class="op" id="6044927">)</span>&nbsp;<span class="builtintype" id="6044929">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6044936">close</span><span class="op" id="6044941">(</span><span class="op" id="6044942">)</span>&nbsp;<span class="builtintype" id="6044944">error</span><br>
<span class="lineno"></span><span class="op" id="6044950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6044953">type</span>&nbsp;<span class="ident" id="6044958">netConn</span>&nbsp;<span class="keyword" id="6044966">struct</span>&nbsp;<span class="op" id="6044973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044976">local</span>&nbsp;<span class="builtintype" id="6044982">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044988">conn</span>&nbsp;&nbsp;<span class="ident" id="6044994">net</span><span class="op" id="6044997">.</span><span class="ident" id="6044998">Conn</span><br>
<span class="lineno"></span><span class="op" id="6045003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6045006">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6045074">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6045141">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6045165">func</span>&nbsp;<span class="ident" id="6045170">New</span><span class="op" id="6045173">(</span><span class="ident" id="6045174">priority</span>&nbsp;<span class="ident" id="6045183">Priority</span><span class="op" id="6045191">,</span>&nbsp;<span class="ident" id="6045193">tag</span>&nbsp;<span class="builtintype" id="6045197">string</span><span class="op" id="6045203">)</span>&nbsp;<span class="op" id="6045205">(</span><span class="ident" id="6045206">w</span>&nbsp;<span class="op" id="6045208">*</span><span class="ident" id="6045209">Writer</span><span class="op" id="6045215">,</span>&nbsp;<span class="ident" id="6045217">err</span>&nbsp;<span class="builtintype" id="6045221">error</span><span class="op" id="6045226">)</span>&nbsp;<span class="op" id="6045228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045231">return</span>&nbsp;<span class="ident" id="6045238">Dial</span><span class="op" id="6045242">(</span><span class="string" id="6045243">&#34;&#34;</span><span class="op" id="6045245">,</span>&nbsp;<span class="string" id="6045247">&#34;&#34;</span><span class="op" id="6045249">,</span>&nbsp;<span class="ident" id="6045251">priority</span><span class="op" id="6045259">,</span>&nbsp;<span class="ident" id="6045261">tag</span><span class="op" id="6045264">)</span><br>
<span class="lineno">115</span><span class="op" id="6045266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6045269">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6045335">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6045406">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6045474">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6045482">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6045552">func</span>&nbsp;<span class="ident" id="6045557">Dial</span><span class="op" id="6045561">(</span><span class="ident" id="6045562">network</span><span class="op" id="6045569">,</span>&nbsp;<span class="ident" id="6045571">raddr</span>&nbsp;<span class="builtintype" id="6045577">string</span><span class="op" id="6045583">,</span>&nbsp;<span class="ident" id="6045585">priority</span>&nbsp;<span class="ident" id="6045594">Priority</span><span class="op" id="6045602">,</span>&nbsp;<span class="ident" id="6045604">tag</span>&nbsp;<span class="builtintype" id="6045608">string</span><span class="op" id="6045614">)</span>&nbsp;<span class="op" id="6045616">(</span><span class="op" id="6045617">*</span><span class="ident" id="6045618">Writer</span><span class="op" id="6045624">,</span>&nbsp;<span class="builtintype" id="6045626">error</span><span class="op" id="6045631">)</span>&nbsp;<span class="op" id="6045633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045636">if</span>&nbsp;<span class="ident" id="6045639">priority</span>&nbsp;<span class="op" id="6045648">&lt;</span>&nbsp;<span class="num" id="6045650">0</span>&nbsp;<span class="op" id="6045652">||</span>&nbsp;<span class="ident" id="6045655">priority</span>&nbsp;<span class="op" id="6045664">&gt;</span>&nbsp;<span class="ident" id="6045666">LOG_LOCAL7</span><span class="op" id="6045676">|</span><span class="ident" id="6045677">LOG_DEBUG</span>&nbsp;<span class="op" id="6045687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045691">return</span>&nbsp;<span class="builtintype" id="6045698">nil</span><span class="op" id="6045701">,</span>&nbsp;<span class="ident" id="6045703">errors</span><span class="op" id="6045709">.</span><span class="ident" id="6045710">New</span><span class="op" id="6045713">(</span><span class="string" id="6045714">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6045744">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045751">if</span>&nbsp;<span class="ident" id="6045754">tag</span>&nbsp;<span class="op" id="6045758">==</span>&nbsp;<span class="string" id="6045761">&#34;&#34;</span>&nbsp;<span class="op" id="6045764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045768">tag</span>&nbsp;<span class="op" id="6045772">=</span>&nbsp;<span class="ident" id="6045774">os</span><span class="op" id="6045776">.</span><span class="ident" id="6045777">Args</span><span class="op" id="6045781">[</span><span class="num" id="6045782">0</span><span class="op" id="6045783">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045786">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045789">hostname</span><span class="op" id="6045797">,</span>&nbsp;<span class="ident" id="6045799">_</span>&nbsp;<span class="op" id="6045801">:=</span>&nbsp;<span class="ident" id="6045804">os</span><span class="op" id="6045806">.</span><span class="ident" id="6045807">Hostname</span><span class="op" id="6045815">(</span><span class="op" id="6045816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045820">w</span>&nbsp;<span class="op" id="6045822">:=</span>&nbsp;<span class="op" id="6045825">&amp;</span><span class="ident" id="6045826">Writer</span><span class="op" id="6045832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045836">priority</span><span class="op" id="6045844">:</span>&nbsp;<span class="ident" id="6045846">priority</span><span class="op" id="6045854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045858">tag</span><span class="op" id="6045861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045868">tag</span><span class="op" id="6045871">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045875">hostname</span><span class="op" id="6045883">:</span>&nbsp;<span class="ident" id="6045885">hostname</span><span class="op" id="6045893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045897">network</span><span class="op" id="6045904">:</span>&nbsp;&nbsp;<span class="ident" id="6045907">network</span><span class="op" id="6045914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045918">raddr</span><span class="op" id="6045923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045928">raddr</span><span class="op" id="6045933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045940">w</span><span class="op" id="6045941">.</span><span class="ident" id="6045942">mu</span><span class="op" id="6045944">.</span><span class="ident" id="6045945">Lock</span><span class="op" id="6045949">(</span><span class="op" id="6045950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045953">defer</span>&nbsp;<span class="ident" id="6045959">w</span><span class="op" id="6045960">.</span><span class="ident" id="6045961">mu</span><span class="op" id="6045963">.</span><span class="ident" id="6045964">Unlock</span><span class="op" id="6045970">(</span><span class="op" id="6045971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045975">err</span>&nbsp;<span class="op" id="6045979">:=</span>&nbsp;<span class="ident" id="6045982">w</span><span class="op" id="6045983">.</span><span class="ident" id="6045984">connect</span><span class="op" id="6045991">(</span><span class="op" id="6045992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045995">if</span>&nbsp;<span class="ident" id="6045998">err</span>&nbsp;<span class="op" id="6046002">!=</span>&nbsp;<span class="builtintype" id="6046005">nil</span>&nbsp;<span class="op" id="6046009">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046013">return</span>&nbsp;<span class="builtintype" id="6046020">nil</span><span class="op" id="6046023">,</span>&nbsp;<span class="ident" id="6046025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046033">return</span>&nbsp;<span class="ident" id="6046040">w</span><span class="op" id="6046041">,</span>&nbsp;<span class="ident" id="6046043">err</span><br>
<span class="lineno"></span><span class="op" id="6046047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6046050">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6046102">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6046139">func</span>&nbsp;<span class="op" id="6046144">(</span><span class="ident" id="6046145">w</span>&nbsp;<span class="op" id="6046147">*</span><span class="ident" id="6046148">Writer</span><span class="op" id="6046154">)</span>&nbsp;<span class="ident" id="6046156">connect</span><span class="op" id="6046163">(</span><span class="op" id="6046164">)</span>&nbsp;<span class="op" id="6046166">(</span><span class="ident" id="6046167">err</span>&nbsp;<span class="builtintype" id="6046171">error</span><span class="op" id="6046176">)</span>&nbsp;<span class="op" id="6046178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046181">if</span>&nbsp;<span class="ident" id="6046184">w</span><span class="op" id="6046185">.</span><span class="ident" id="6046186">conn</span>&nbsp;<span class="op" id="6046191">!=</span>&nbsp;<span class="builtintype" id="6046194">nil</span>&nbsp;<span class="op" id="6046198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046202">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046264">w</span><span class="op" id="6046265">.</span><span class="ident" id="6046266">conn</span><span class="op" id="6046270">.</span><span class="builtinfunc" id="6046271">close</span><span class="op" id="6046276">(</span><span class="op" id="6046277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046281">w</span><span class="op" id="6046282">.</span><span class="ident" id="6046283">conn</span>&nbsp;<span class="op" id="6046288">=</span>&nbsp;<span class="builtintype" id="6046290">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046299">if</span>&nbsp;<span class="ident" id="6046302">w</span><span class="op" id="6046303">.</span><span class="ident" id="6046304">network</span>&nbsp;<span class="op" id="6046312">==</span>&nbsp;<span class="string" id="6046315">&#34;&#34;</span>&nbsp;<span class="op" id="6046318">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046322">w</span><span class="op" id="6046323">.</span><span class="ident" id="6046324">conn</span><span class="op" id="6046328">,</span>&nbsp;<span class="ident" id="6046330">err</span>&nbsp;<span class="op" id="6046334">=</span>&nbsp;<span class="ident" id="6046336">unixSyslog</span><span class="op" id="6046346">(</span><span class="op" id="6046347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046351">if</span>&nbsp;<span class="ident" id="6046354">w</span><span class="op" id="6046355">.</span><span class="ident" id="6046356">hostname</span>&nbsp;<span class="op" id="6046365">==</span>&nbsp;<span class="string" id="6046368">&#34;&#34;</span>&nbsp;<span class="op" id="6046371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046376">w</span><span class="op" id="6046377">.</span><span class="ident" id="6046378">hostname</span>&nbsp;<span class="op" id="6046387">=</span>&nbsp;<span class="string" id="6046389">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046406">}</span>&nbsp;<span class="keyword" id="6046408">else</span>&nbsp;<span class="op" id="6046413">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046417">var</span>&nbsp;<span class="ident" id="6046421">c</span>&nbsp;<span class="ident" id="6046423">net</span><span class="op" id="6046426">.</span><span class="ident" id="6046427">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046434">c</span><span class="op" id="6046435">,</span>&nbsp;<span class="ident" id="6046437">err</span>&nbsp;<span class="op" id="6046441">=</span>&nbsp;<span class="ident" id="6046443">net</span><span class="op" id="6046446">.</span><span class="ident" id="6046447">Dial</span><span class="op" id="6046451">(</span><span class="ident" id="6046452">w</span><span class="op" id="6046453">.</span><span class="ident" id="6046454">network</span><span class="op" id="6046461">,</span>&nbsp;<span class="ident" id="6046463">w</span><span class="op" id="6046464">.</span><span class="ident" id="6046465">raddr</span><span class="op" id="6046470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046474">if</span>&nbsp;<span class="ident" id="6046477">err</span>&nbsp;<span class="op" id="6046481">==</span>&nbsp;<span class="builtintype" id="6046484">nil</span>&nbsp;<span class="op" id="6046488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046493">w</span><span class="op" id="6046494">.</span><span class="ident" id="6046495">conn</span>&nbsp;<span class="op" id="6046500">=</span>&nbsp;<span class="op" id="6046502">&amp;</span><span class="ident" id="6046503">netConn</span><span class="op" id="6046510">{</span><span class="ident" id="6046511">conn</span><span class="op" id="6046515">:</span>&nbsp;<span class="ident" id="6046517">c</span><span class="op" id="6046518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046523">if</span>&nbsp;<span class="ident" id="6046526">w</span><span class="op" id="6046527">.</span><span class="ident" id="6046528">hostname</span>&nbsp;<span class="op" id="6046537">==</span>&nbsp;<span class="string" id="6046540">&#34;&#34;</span>&nbsp;<span class="op" id="6046543">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046549">w</span><span class="op" id="6046550">.</span><span class="ident" id="6046551">hostname</span>&nbsp;<span class="op" id="6046560">=</span>&nbsp;<span class="ident" id="6046562">c</span><span class="op" id="6046563">.</span><span class="ident" id="6046564">LocalAddr</span><span class="op" id="6046573">(</span><span class="op" id="6046574">)</span><span class="op" id="6046575">.</span><span class="ident" id="6046576">String</span><span class="op" id="6046582">(</span><span class="op" id="6046583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046598">return</span><br>
<span class="lineno">175</span><span class="op" id="6046605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6046608">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6046659">func</span>&nbsp;<span class="op" id="6046664">(</span><span class="ident" id="6046665">w</span>&nbsp;<span class="op" id="6046667">*</span><span class="ident" id="6046668">Writer</span><span class="op" id="6046674">)</span>&nbsp;<span class="ident" id="6046676">Write</span><span class="op" id="6046681">(</span><span class="ident" id="6046682">b</span>&nbsp;<span class="op" id="6046684">[</span><span class="op" id="6046685">]</span><span class="builtintype" id="6046686">byte</span><span class="op" id="6046690">)</span>&nbsp;<span class="op" id="6046692">(</span><span class="builtintype" id="6046693">int</span><span class="op" id="6046696">,</span>&nbsp;<span class="builtintype" id="6046698">error</span><span class="op" id="6046703">)</span>&nbsp;<span class="op" id="6046705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046708">return</span>&nbsp;<span class="ident" id="6046715">w</span><span class="op" id="6046716">.</span><span class="ident" id="6046717">writeAndRetry</span><span class="op" id="6046730">(</span><span class="ident" id="6046731">w</span><span class="op" id="6046732">.</span><span class="ident" id="6046733">priority</span><span class="op" id="6046741">,</span>&nbsp;<span class="builtintype" id="6046743">string</span><span class="op" id="6046749">(</span><span class="ident" id="6046750">b</span><span class="op" id="6046751">)</span><span class="op" id="6046752">)</span><br>
<span class="lineno">180</span><span class="op" id="6046754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6046757">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6046808">func</span>&nbsp;<span class="op" id="6046813">(</span><span class="ident" id="6046814">w</span>&nbsp;<span class="op" id="6046816">*</span><span class="ident" id="6046817">Writer</span><span class="op" id="6046823">)</span>&nbsp;<span class="ident" id="6046825">Close</span><span class="op" id="6046830">(</span><span class="op" id="6046831">)</span>&nbsp;<span class="builtintype" id="6046833">error</span>&nbsp;<span class="op" id="6046839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046842">w</span><span class="op" id="6046843">.</span><span class="ident" id="6046844">mu</span><span class="op" id="6046846">.</span><span class="ident" id="6046847">Lock</span><span class="op" id="6046851">(</span><span class="op" id="6046852">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046855">defer</span>&nbsp;<span class="ident" id="6046861">w</span><span class="op" id="6046862">.</span><span class="ident" id="6046863">mu</span><span class="op" id="6046865">.</span><span class="ident" id="6046866">Unlock</span><span class="op" id="6046872">(</span><span class="op" id="6046873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046877">if</span>&nbsp;<span class="ident" id="6046880">w</span><span class="op" id="6046881">.</span><span class="ident" id="6046882">conn</span>&nbsp;<span class="op" id="6046887">!=</span>&nbsp;<span class="builtintype" id="6046890">nil</span>&nbsp;<span class="op" id="6046894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046898">err</span>&nbsp;<span class="op" id="6046902">:=</span>&nbsp;<span class="ident" id="6046905">w</span><span class="op" id="6046906">.</span><span class="ident" id="6046907">conn</span><span class="op" id="6046911">.</span><span class="builtinfunc" id="6046912">close</span><span class="op" id="6046917">(</span><span class="op" id="6046918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046922">w</span><span class="op" id="6046923">.</span><span class="ident" id="6046924">conn</span>&nbsp;<span class="op" id="6046929">=</span>&nbsp;<span class="builtintype" id="6046931">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046937">return</span>&nbsp;<span class="ident" id="6046944">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046952">return</span>&nbsp;<span class="builtintype" id="6046959">nil</span><br>
<span class="lineno"></span><span class="op" id="6046963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6046966">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6047037">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6047055">func</span>&nbsp;<span class="op" id="6047060">(</span><span class="ident" id="6047061">w</span>&nbsp;<span class="op" id="6047063">*</span><span class="ident" id="6047064">Writer</span><span class="op" id="6047070">)</span>&nbsp;<span class="ident" id="6047072">Emerg</span><span class="op" id="6047077">(</span><span class="ident" id="6047078">m</span>&nbsp;<span class="builtintype" id="6047080">string</span><span class="op" id="6047086">)</span>&nbsp;<span class="op" id="6047088">(</span><span class="ident" id="6047089">err</span>&nbsp;<span class="builtintype" id="6047093">error</span><span class="op" id="6047098">)</span>&nbsp;<span class="op" id="6047100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047103">_</span><span class="op" id="6047104">,</span>&nbsp;<span class="ident" id="6047106">err</span>&nbsp;<span class="op" id="6047110">=</span>&nbsp;<span class="ident" id="6047112">w</span><span class="op" id="6047113">.</span><span class="ident" id="6047114">writeAndRetry</span><span class="op" id="6047127">(</span><span class="ident" id="6047128">LOG_EMERG</span><span class="op" id="6047137">,</span>&nbsp;<span class="ident" id="6047139">m</span><span class="op" id="6047140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047143">return</span>&nbsp;<span class="ident" id="6047150">err</span><br>
<span class="lineno">200</span><span class="op" id="6047154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6047157">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6047228">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6047246">func</span>&nbsp;<span class="op" id="6047251">(</span><span class="ident" id="6047252">w</span>&nbsp;<span class="op" id="6047254">*</span><span class="ident" id="6047255">Writer</span><span class="op" id="6047261">)</span>&nbsp;<span class="ident" id="6047263">Alert</span><span class="op" id="6047268">(</span><span class="ident" id="6047269">m</span>&nbsp;<span class="builtintype" id="6047271">string</span><span class="op" id="6047277">)</span>&nbsp;<span class="op" id="6047279">(</span><span class="ident" id="6047280">err</span>&nbsp;<span class="builtintype" id="6047284">error</span><span class="op" id="6047289">)</span>&nbsp;<span class="op" id="6047291">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047294">_</span><span class="op" id="6047295">,</span>&nbsp;<span class="ident" id="6047297">err</span>&nbsp;<span class="op" id="6047301">=</span>&nbsp;<span class="ident" id="6047303">w</span><span class="op" id="6047304">.</span><span class="ident" id="6047305">writeAndRetry</span><span class="op" id="6047318">(</span><span class="ident" id="6047319">LOG_ALERT</span><span class="op" id="6047328">,</span>&nbsp;<span class="ident" id="6047330">m</span><span class="op" id="6047331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047334">return</span>&nbsp;<span class="ident" id="6047341">err</span><br>
<span class="lineno"></span><span class="op" id="6047345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6047348">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6047417">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6047435">func</span>&nbsp;<span class="op" id="6047440">(</span><span class="ident" id="6047441">w</span>&nbsp;<span class="op" id="6047443">*</span><span class="ident" id="6047444">Writer</span><span class="op" id="6047450">)</span>&nbsp;<span class="ident" id="6047452">Crit</span><span class="op" id="6047456">(</span><span class="ident" id="6047457">m</span>&nbsp;<span class="builtintype" id="6047459">string</span><span class="op" id="6047465">)</span>&nbsp;<span class="op" id="6047467">(</span><span class="ident" id="6047468">err</span>&nbsp;<span class="builtintype" id="6047472">error</span><span class="op" id="6047477">)</span>&nbsp;<span class="op" id="6047479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047482">_</span><span class="op" id="6047483">,</span>&nbsp;<span class="ident" id="6047485">err</span>&nbsp;<span class="op" id="6047489">=</span>&nbsp;<span class="ident" id="6047491">w</span><span class="op" id="6047492">.</span><span class="ident" id="6047493">writeAndRetry</span><span class="op" id="6047506">(</span><span class="ident" id="6047507">LOG_CRIT</span><span class="op" id="6047515">,</span>&nbsp;<span class="ident" id="6047517">m</span><span class="op" id="6047518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047521">return</span>&nbsp;<span class="ident" id="6047528">err</span><br>
<span class="lineno"></span><span class="op" id="6047532">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6047535">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6047602">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6047620">func</span>&nbsp;<span class="op" id="6047625">(</span><span class="ident" id="6047626">w</span>&nbsp;<span class="op" id="6047628">*</span><span class="ident" id="6047629">Writer</span><span class="op" id="6047635">)</span>&nbsp;<span class="ident" id="6047637">Err</span><span class="op" id="6047640">(</span><span class="ident" id="6047641">m</span>&nbsp;<span class="builtintype" id="6047643">string</span><span class="op" id="6047649">)</span>&nbsp;<span class="op" id="6047651">(</span><span class="ident" id="6047652">err</span>&nbsp;<span class="builtintype" id="6047656">error</span><span class="op" id="6047661">)</span>&nbsp;<span class="op" id="6047663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047666">_</span><span class="op" id="6047667">,</span>&nbsp;<span class="ident" id="6047669">err</span>&nbsp;<span class="op" id="6047673">=</span>&nbsp;<span class="ident" id="6047675">w</span><span class="op" id="6047676">.</span><span class="ident" id="6047677">writeAndRetry</span><span class="op" id="6047690">(</span><span class="ident" id="6047691">LOG_ERR</span><span class="op" id="6047698">,</span>&nbsp;<span class="ident" id="6047700">m</span><span class="op" id="6047701">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047704">return</span>&nbsp;<span class="ident" id="6047711">err</span><br>
<span class="lineno"></span><span class="op" id="6047715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6047718">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6047784">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6047811">func</span>&nbsp;<span class="op" id="6047816">(</span><span class="ident" id="6047817">w</span>&nbsp;<span class="op" id="6047819">*</span><span class="ident" id="6047820">Writer</span><span class="op" id="6047826">)</span>&nbsp;<span class="ident" id="6047828">Warning</span><span class="op" id="6047835">(</span><span class="ident" id="6047836">m</span>&nbsp;<span class="builtintype" id="6047838">string</span><span class="op" id="6047844">)</span>&nbsp;<span class="op" id="6047846">(</span><span class="ident" id="6047847">err</span>&nbsp;<span class="builtintype" id="6047851">error</span><span class="op" id="6047856">)</span>&nbsp;<span class="op" id="6047858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047861">_</span><span class="op" id="6047862">,</span>&nbsp;<span class="ident" id="6047864">err</span>&nbsp;<span class="op" id="6047868">=</span>&nbsp;<span class="ident" id="6047870">w</span><span class="op" id="6047871">.</span><span class="ident" id="6047872">writeAndRetry</span><span class="op" id="6047885">(</span><span class="ident" id="6047886">LOG_WARNING</span><span class="op" id="6047897">,</span>&nbsp;<span class="ident" id="6047899">m</span><span class="op" id="6047900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047903">return</span>&nbsp;<span class="ident" id="6047910">err</span><br>
<span class="lineno"></span><span class="op" id="6047914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6047917">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6047981">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6048008">func</span>&nbsp;<span class="op" id="6048013">(</span><span class="ident" id="6048014">w</span>&nbsp;<span class="op" id="6048016">*</span><span class="ident" id="6048017">Writer</span><span class="op" id="6048023">)</span>&nbsp;<span class="ident" id="6048025">Notice</span><span class="op" id="6048031">(</span><span class="ident" id="6048032">m</span>&nbsp;<span class="builtintype" id="6048034">string</span><span class="op" id="6048040">)</span>&nbsp;<span class="op" id="6048042">(</span><span class="ident" id="6048043">err</span>&nbsp;<span class="builtintype" id="6048047">error</span><span class="op" id="6048052">)</span>&nbsp;<span class="op" id="6048054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048057">_</span><span class="op" id="6048058">,</span>&nbsp;<span class="ident" id="6048060">err</span>&nbsp;<span class="op" id="6048064">=</span>&nbsp;<span class="ident" id="6048066">w</span><span class="op" id="6048067">.</span><span class="ident" id="6048068">writeAndRetry</span><span class="op" id="6048081">(</span><span class="ident" id="6048082">LOG_NOTICE</span><span class="op" id="6048092">,</span>&nbsp;<span class="ident" id="6048094">m</span><span class="op" id="6048095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048098">return</span>&nbsp;<span class="ident" id="6048105">err</span><br>
<span class="lineno">235</span><span class="op" id="6048109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6048112">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6048181">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6048199">func</span>&nbsp;<span class="op" id="6048204">(</span><span class="ident" id="6048205">w</span>&nbsp;<span class="op" id="6048207">*</span><span class="ident" id="6048208">Writer</span><span class="op" id="6048214">)</span>&nbsp;<span class="ident" id="6048216">Info</span><span class="op" id="6048220">(</span><span class="ident" id="6048221">m</span>&nbsp;<span class="builtintype" id="6048223">string</span><span class="op" id="6048229">)</span>&nbsp;<span class="op" id="6048231">(</span><span class="ident" id="6048232">err</span>&nbsp;<span class="builtintype" id="6048236">error</span><span class="op" id="6048241">)</span>&nbsp;<span class="op" id="6048243">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048246">_</span><span class="op" id="6048247">,</span>&nbsp;<span class="ident" id="6048249">err</span>&nbsp;<span class="op" id="6048253">=</span>&nbsp;<span class="ident" id="6048255">w</span><span class="op" id="6048256">.</span><span class="ident" id="6048257">writeAndRetry</span><span class="op" id="6048270">(</span><span class="ident" id="6048271">LOG_INFO</span><span class="op" id="6048279">,</span>&nbsp;<span class="ident" id="6048281">m</span><span class="op" id="6048282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048285">return</span>&nbsp;<span class="ident" id="6048292">err</span><br>
<span class="lineno"></span><span class="op" id="6048296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6048299">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6048370">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6048388">func</span>&nbsp;<span class="op" id="6048393">(</span><span class="ident" id="6048394">w</span>&nbsp;<span class="op" id="6048396">*</span><span class="ident" id="6048397">Writer</span><span class="op" id="6048403">)</span>&nbsp;<span class="ident" id="6048405">Debug</span><span class="op" id="6048410">(</span><span class="ident" id="6048411">m</span>&nbsp;<span class="builtintype" id="6048413">string</span><span class="op" id="6048419">)</span>&nbsp;<span class="op" id="6048421">(</span><span class="ident" id="6048422">err</span>&nbsp;<span class="builtintype" id="6048426">error</span><span class="op" id="6048431">)</span>&nbsp;<span class="op" id="6048433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048436">_</span><span class="op" id="6048437">,</span>&nbsp;<span class="ident" id="6048439">err</span>&nbsp;<span class="op" id="6048443">=</span>&nbsp;<span class="ident" id="6048445">w</span><span class="op" id="6048446">.</span><span class="ident" id="6048447">writeAndRetry</span><span class="op" id="6048460">(</span><span class="ident" id="6048461">LOG_DEBUG</span><span class="op" id="6048470">,</span>&nbsp;<span class="ident" id="6048472">m</span><span class="op" id="6048473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048476">return</span>&nbsp;<span class="ident" id="6048483">err</span><br>
<span class="lineno"></span><span class="op" id="6048487">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6048490">func</span>&nbsp;<span class="op" id="6048495">(</span><span class="ident" id="6048496">w</span>&nbsp;<span class="op" id="6048498">*</span><span class="ident" id="6048499">Writer</span><span class="op" id="6048505">)</span>&nbsp;<span class="ident" id="6048507">writeAndRetry</span><span class="op" id="6048520">(</span><span class="ident" id="6048521">p</span>&nbsp;<span class="ident" id="6048523">Priority</span><span class="op" id="6048531">,</span>&nbsp;<span class="ident" id="6048533">s</span>&nbsp;<span class="builtintype" id="6048535">string</span><span class="op" id="6048541">)</span>&nbsp;<span class="op" id="6048543">(</span><span class="builtintype" id="6048544">int</span><span class="op" id="6048547">,</span>&nbsp;<span class="builtintype" id="6048549">error</span><span class="op" id="6048554">)</span>&nbsp;<span class="op" id="6048556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048559">pr</span>&nbsp;<span class="op" id="6048562">:=</span>&nbsp;<span class="op" id="6048565">(</span><span class="ident" id="6048566">w</span><span class="op" id="6048567">.</span><span class="ident" id="6048568">priority</span>&nbsp;<span class="op" id="6048577">&amp;</span>&nbsp;<span class="ident" id="6048579">facilityMask</span><span class="op" id="6048591">)</span>&nbsp;<span class="op" id="6048593">|</span>&nbsp;<span class="op" id="6048595">(</span><span class="ident" id="6048596">p</span>&nbsp;<span class="op" id="6048598">&amp;</span>&nbsp;<span class="ident" id="6048600">severityMask</span><span class="op" id="6048612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048616">w</span><span class="op" id="6048617">.</span><span class="ident" id="6048618">mu</span><span class="op" id="6048620">.</span><span class="ident" id="6048621">Lock</span><span class="op" id="6048625">(</span><span class="op" id="6048626">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048629">defer</span>&nbsp;<span class="ident" id="6048635">w</span><span class="op" id="6048636">.</span><span class="ident" id="6048637">mu</span><span class="op" id="6048639">.</span><span class="ident" id="6048640">Unlock</span><span class="op" id="6048646">(</span><span class="op" id="6048647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048651">if</span>&nbsp;<span class="ident" id="6048654">w</span><span class="op" id="6048655">.</span><span class="ident" id="6048656">conn</span>&nbsp;<span class="op" id="6048661">!=</span>&nbsp;<span class="builtintype" id="6048664">nil</span>&nbsp;<span class="op" id="6048668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048672">if</span>&nbsp;<span class="ident" id="6048675">n</span><span class="op" id="6048676">,</span>&nbsp;<span class="ident" id="6048678">err</span>&nbsp;<span class="op" id="6048682">:=</span>&nbsp;<span class="ident" id="6048685">w</span><span class="op" id="6048686">.</span><span class="ident" id="6048687">write</span><span class="op" id="6048692">(</span><span class="ident" id="6048693">pr</span><span class="op" id="6048695">,</span>&nbsp;<span class="ident" id="6048697">s</span><span class="op" id="6048698">)</span><span class="op" id="6048699">;</span>&nbsp;<span class="ident" id="6048701">err</span>&nbsp;<span class="op" id="6048705">==</span>&nbsp;<span class="builtintype" id="6048708">nil</span>&nbsp;<span class="op" id="6048712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048717">return</span>&nbsp;<span class="ident" id="6048724">n</span><span class="op" id="6048725">,</span>&nbsp;<span class="ident" id="6048727">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048739">if</span>&nbsp;<span class="ident" id="6048742">err</span>&nbsp;<span class="op" id="6048746">:=</span>&nbsp;<span class="ident" id="6048749">w</span><span class="op" id="6048750">.</span><span class="ident" id="6048751">connect</span><span class="op" id="6048758">(</span><span class="op" id="6048759">)</span><span class="op" id="6048760">;</span>&nbsp;<span class="ident" id="6048762">err</span>&nbsp;<span class="op" id="6048766">!=</span>&nbsp;<span class="builtintype" id="6048769">nil</span>&nbsp;<span class="op" id="6048773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048777">return</span>&nbsp;<span class="num" id="6048784">0</span><span class="op" id="6048785">,</span>&nbsp;<span class="ident" id="6048787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048792">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048795">return</span>&nbsp;<span class="ident" id="6048802">w</span><span class="op" id="6048803">.</span><span class="ident" id="6048804">write</span><span class="op" id="6048809">(</span><span class="ident" id="6048810">pr</span><span class="op" id="6048812">,</span>&nbsp;<span class="ident" id="6048814">s</span><span class="op" id="6048815">)</span><br>
<span class="lineno"></span><span class="op" id="6048817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6048820">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6048881">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6048944">func</span>&nbsp;<span class="op" id="6048949">(</span><span class="ident" id="6048950">w</span>&nbsp;<span class="op" id="6048952">*</span><span class="ident" id="6048953">Writer</span><span class="op" id="6048959">)</span>&nbsp;<span class="ident" id="6048961">write</span><span class="op" id="6048966">(</span><span class="ident" id="6048967">p</span>&nbsp;<span class="ident" id="6048969">Priority</span><span class="op" id="6048977">,</span>&nbsp;<span class="ident" id="6048979">msg</span>&nbsp;<span class="builtintype" id="6048983">string</span><span class="op" id="6048989">)</span>&nbsp;<span class="op" id="6048991">(</span><span class="builtintype" id="6048992">int</span><span class="op" id="6048995">,</span>&nbsp;<span class="builtintype" id="6048997">error</span><span class="op" id="6049002">)</span>&nbsp;<span class="op" id="6049004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049007">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049034">nl</span>&nbsp;<span class="op" id="6049037">:=</span>&nbsp;<span class="string" id="6049040">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049044">if</span>&nbsp;<span class="op" id="6049047">!</span><span class="ident" id="6049048">strings</span><span class="op" id="6049055">.</span><span class="ident" id="6049056">HasSuffix</span><span class="op" id="6049065">(</span><span class="ident" id="6049066">msg</span><span class="op" id="6049069">,</span>&nbsp;<span class="string" id="6049071">&#34;\n&#34;</span><span class="op" id="6049075">)</span>&nbsp;<span class="op" id="6049077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049081">nl</span>&nbsp;<span class="op" id="6049084">=</span>&nbsp;<span class="string" id="6049086">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049096">err</span>&nbsp;<span class="op" id="6049100">:=</span>&nbsp;<span class="ident" id="6049103">w</span><span class="op" id="6049104">.</span><span class="ident" id="6049105">conn</span><span class="op" id="6049109">.</span><span class="ident" id="6049110">writeString</span><span class="op" id="6049121">(</span><span class="ident" id="6049122">p</span><span class="op" id="6049123">,</span>&nbsp;<span class="ident" id="6049125">w</span><span class="op" id="6049126">.</span><span class="ident" id="6049127">hostname</span><span class="op" id="6049135">,</span>&nbsp;<span class="ident" id="6049137">w</span><span class="op" id="6049138">.</span><span class="ident" id="6049139">tag</span><span class="op" id="6049142">,</span>&nbsp;<span class="ident" id="6049144">msg</span><span class="op" id="6049147">,</span>&nbsp;<span class="ident" id="6049149">nl</span><span class="op" id="6049151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049154">if</span>&nbsp;<span class="ident" id="6049157">err</span>&nbsp;<span class="op" id="6049161">!=</span>&nbsp;<span class="builtintype" id="6049164">nil</span>&nbsp;<span class="op" id="6049168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049172">return</span>&nbsp;<span class="num" id="6049179">0</span><span class="op" id="6049180">,</span>&nbsp;<span class="ident" id="6049182">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049190">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049250">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049310">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049328">return</span>&nbsp;<span class="builtinfunc" id="6049335">len</span><span class="op" id="6049338">(</span><span class="ident" id="6049339">msg</span><span class="op" id="6049342">)</span><span class="op" id="6049343">,</span>&nbsp;<span class="builtintype" id="6049345">nil</span><br>
<span class="lineno">285</span><span class="op" id="6049349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6049352">func</span>&nbsp;<span class="op" id="6049357">(</span><span class="ident" id="6049358">n</span>&nbsp;<span class="op" id="6049360">*</span><span class="ident" id="6049361">netConn</span><span class="op" id="6049368">)</span>&nbsp;<span class="ident" id="6049370">writeString</span><span class="op" id="6049381">(</span><span class="ident" id="6049382">p</span>&nbsp;<span class="ident" id="6049384">Priority</span><span class="op" id="6049392">,</span>&nbsp;<span class="ident" id="6049394">hostname</span><span class="op" id="6049402">,</span>&nbsp;<span class="ident" id="6049404">tag</span><span class="op" id="6049407">,</span>&nbsp;<span class="ident" id="6049409">msg</span><span class="op" id="6049412">,</span>&nbsp;<span class="ident" id="6049414">nl</span>&nbsp;<span class="builtintype" id="6049417">string</span><span class="op" id="6049423">)</span>&nbsp;<span class="builtintype" id="6049425">error</span>&nbsp;<span class="op" id="6049431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049434">if</span>&nbsp;<span class="ident" id="6049437">n</span><span class="op" id="6049438">.</span><span class="ident" id="6049439">local</span>&nbsp;<span class="op" id="6049445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049449">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049507">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049555">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049605">timestamp</span>&nbsp;<span class="op" id="6049615">:=</span>&nbsp;<span class="ident" id="6049618">time</span><span class="op" id="6049622">.</span><span class="ident" id="6049623">Now</span><span class="op" id="6049626">(</span><span class="op" id="6049627">)</span><span class="op" id="6049628">.</span><span class="ident" id="6049629">Format</span><span class="op" id="6049635">(</span><span class="ident" id="6049636">time</span><span class="op" id="6049640">.</span><span class="ident" id="6049641">Stamp</span><span class="op" id="6049646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049650">_</span><span class="op" id="6049651">,</span>&nbsp;<span class="ident" id="6049653">err</span>&nbsp;<span class="op" id="6049657">:=</span>&nbsp;<span class="ident" id="6049660">fmt</span><span class="op" id="6049663">.</span><span class="ident" id="6049664">Fprintf</span><span class="op" id="6049671">(</span><span class="ident" id="6049672">n</span><span class="op" id="6049673">.</span><span class="ident" id="6049674">conn</span><span class="op" id="6049678">,</span>&nbsp;<span class="string" id="6049680">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6049701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049706">p</span><span class="op" id="6049707">,</span>&nbsp;<span class="ident" id="6049709">timestamp</span><span class="op" id="6049718">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049723">tag</span><span class="op" id="6049726">,</span>&nbsp;<span class="ident" id="6049728">os</span><span class="op" id="6049730">.</span><span class="ident" id="6049731">Getpid</span><span class="op" id="6049737">(</span><span class="op" id="6049738">)</span><span class="op" id="6049739">,</span>&nbsp;<span class="ident" id="6049741">msg</span><span class="op" id="6049744">,</span>&nbsp;<span class="ident" id="6049746">nl</span><span class="op" id="6049748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049752">return</span>&nbsp;<span class="ident" id="6049759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049767">timestamp</span>&nbsp;<span class="op" id="6049777">:=</span>&nbsp;<span class="ident" id="6049780">time</span><span class="op" id="6049784">.</span><span class="ident" id="6049785">Now</span><span class="op" id="6049788">(</span><span class="op" id="6049789">)</span><span class="op" id="6049790">.</span><span class="ident" id="6049791">Format</span><span class="op" id="6049797">(</span><span class="ident" id="6049798">time</span><span class="op" id="6049802">.</span><span class="ident" id="6049803">RFC3339</span><span class="op" id="6049810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049813">_</span><span class="op" id="6049814">,</span>&nbsp;<span class="ident" id="6049816">err</span>&nbsp;<span class="op" id="6049820">:=</span>&nbsp;<span class="ident" id="6049823">fmt</span><span class="op" id="6049826">.</span><span class="ident" id="6049827">Fprintf</span><span class="op" id="6049834">(</span><span class="ident" id="6049835">n</span><span class="op" id="6049836">.</span><span class="ident" id="6049837">conn</span><span class="op" id="6049841">,</span>&nbsp;<span class="string" id="6049843">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6049867">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049871">p</span><span class="op" id="6049872">,</span>&nbsp;<span class="ident" id="6049874">timestamp</span><span class="op" id="6049883">,</span>&nbsp;<span class="ident" id="6049885">hostname</span><span class="op" id="6049893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049897">tag</span><span class="op" id="6049900">,</span>&nbsp;<span class="ident" id="6049902">os</span><span class="op" id="6049904">.</span><span class="ident" id="6049905">Getpid</span><span class="op" id="6049911">(</span><span class="op" id="6049912">)</span><span class="op" id="6049913">,</span>&nbsp;<span class="ident" id="6049915">msg</span><span class="op" id="6049918">,</span>&nbsp;<span class="ident" id="6049920">nl</span><span class="op" id="6049922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049925">return</span>&nbsp;<span class="ident" id="6049932">err</span><br>
<span class="lineno"></span><span class="op" id="6049936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6049939">func</span>&nbsp;<span class="op" id="6049944">(</span><span class="ident" id="6049945">n</span>&nbsp;<span class="op" id="6049947">*</span><span class="ident" id="6049948">netConn</span><span class="op" id="6049955">)</span>&nbsp;<span class="builtinfunc" id="6049957">close</span><span class="op" id="6049962">(</span><span class="op" id="6049963">)</span>&nbsp;<span class="builtintype" id="6049965">error</span>&nbsp;<span class="op" id="6049971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049974">return</span>&nbsp;<span class="ident" id="6049981">n</span><span class="op" id="6049982">.</span><span class="ident" id="6049983">conn</span><span class="op" id="6049987">.</span><span class="ident" id="6049988">Close</span><span class="op" id="6049993">(</span><span class="op" id="6049994">)</span><br>
<span class="lineno"></span><span class="op" id="6049996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6049999">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6050060">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6050127">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6050191">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6050206">func</span>&nbsp;<span class="ident" id="6050211">NewLogger</span><span class="op" id="6050220">(</span><span class="ident" id="6050221">p</span>&nbsp;<span class="ident" id="6050223">Priority</span><span class="op" id="6050231">,</span>&nbsp;<span class="ident" id="6050233">logFlag</span>&nbsp;<span class="builtintype" id="6050241">int</span><span class="op" id="6050244">)</span>&nbsp;<span class="op" id="6050246">(</span><span class="op" id="6050247">*</span><span class="ident" id="6050248">log</span><span class="op" id="6050251">.</span><span class="ident" id="6050252">Logger</span><span class="op" id="6050258">,</span>&nbsp;<span class="builtintype" id="6050260">error</span><span class="op" id="6050265">)</span>&nbsp;<span class="op" id="6050267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050270">s</span><span class="op" id="6050271">,</span>&nbsp;<span class="ident" id="6050273">err</span>&nbsp;<span class="op" id="6050277">:=</span>&nbsp;<span class="ident" id="6050280">New</span><span class="op" id="6050283">(</span><span class="ident" id="6050284">p</span><span class="op" id="6050285">,</span>&nbsp;<span class="string" id="6050287">&#34;&#34;</span><span class="op" id="6050289">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6050292">if</span>&nbsp;<span class="ident" id="6050295">err</span>&nbsp;<span class="op" id="6050299">!=</span>&nbsp;<span class="builtintype" id="6050302">nil</span>&nbsp;<span class="op" id="6050306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6050310">return</span>&nbsp;<span class="builtintype" id="6050317">nil</span><span class="op" id="6050320">,</span>&nbsp;<span class="ident" id="6050322">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6050330">return</span>&nbsp;<span class="ident" id="6050337">log</span><span class="op" id="6050340">.</span><span class="ident" id="6050341">New</span><span class="op" id="6050344">(</span><span class="ident" id="6050345">s</span><span class="op" id="6050346">,</span>&nbsp;<span class="string" id="6050348">&#34;&#34;</span><span class="op" id="6050350">,</span>&nbsp;<span class="ident" id="6050352">logFlag</span><span class="op" id="6050359">)</span><span class="op" id="6050360">,</span>&nbsp;<span class="builtintype" id="6050362">nil</span><br>
<span class="lineno"></span><span class="op" id="6050366">}</span>
</div>
</body>
</html>
