<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3452501">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3452556">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3452610">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3452661">package</span>&nbsp;<span class="ident" id="3452669">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3452677">import</span>&nbsp;<span class="string" id="3452684">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3452695">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="3452781">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="3452860">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="3452931">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="3452997">//</span><br>
<span class="lineno"></span><span class="comment" id="3453000">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="3453078">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="3453139">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="3453186">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="3453256">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3453333">type</span>&nbsp;<span class="ident" id="3453338">patchList</span>&nbsp;<span class="builtintype" id="3453348">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3453356">func</span>&nbsp;<span class="op" id="3453361">(</span><span class="ident" id="3453362">l</span>&nbsp;<span class="ident" id="3453364">patchList</span><span class="op" id="3453373">)</span>&nbsp;<span class="ident" id="3453375">next</span><span class="op" id="3453379">(</span><span class="ident" id="3453380">p</span>&nbsp;<span class="op" id="3453382">*</span><span class="ident" id="3453383">Prog</span><span class="op" id="3453387">)</span>&nbsp;<span class="ident" id="3453389">patchList</span>&nbsp;<span class="op" id="3453399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453402">i</span>&nbsp;<span class="op" id="3453404">:=</span>&nbsp;<span class="op" id="3453407">&amp;</span><span class="ident" id="3453408">p</span><span class="op" id="3453409">.</span><span class="ident" id="3453410">Inst</span><span class="op" id="3453414">[</span><span class="ident" id="3453415">l</span><span class="op" id="3453416">&gt;&gt;</span><span class="num" id="3453418">1</span><span class="op" id="3453419">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453422">if</span>&nbsp;<span class="ident" id="3453425">l</span><span class="op" id="3453426">&amp;</span><span class="num" id="3453427">1</span>&nbsp;<span class="op" id="3453429">==</span>&nbsp;<span class="num" id="3453432">0</span>&nbsp;<span class="op" id="3453434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453438">return</span>&nbsp;<span class="ident" id="3453445">patchList</span><span class="op" id="3453454">(</span><span class="ident" id="3453455">i</span><span class="op" id="3453456">.</span><span class="ident" id="3453457">Out</span><span class="op" id="3453460">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453466">return</span>&nbsp;<span class="ident" id="3453473">patchList</span><span class="op" id="3453482">(</span><span class="ident" id="3453483">i</span><span class="op" id="3453484">.</span><span class="ident" id="3453485">Arg</span><span class="op" id="3453488">)</span><br>
<span class="lineno"></span><span class="op" id="3453490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3453493">func</span>&nbsp;<span class="op" id="3453498">(</span><span class="ident" id="3453499">l</span>&nbsp;<span class="ident" id="3453501">patchList</span><span class="op" id="3453510">)</span>&nbsp;<span class="ident" id="3453512">patch</span><span class="op" id="3453517">(</span><span class="ident" id="3453518">p</span>&nbsp;<span class="op" id="3453520">*</span><span class="ident" id="3453521">Prog</span><span class="op" id="3453525">,</span>&nbsp;<span class="ident" id="3453527">val</span>&nbsp;<span class="builtintype" id="3453531">uint32</span><span class="op" id="3453537">)</span>&nbsp;<span class="op" id="3453539">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453542">for</span>&nbsp;<span class="ident" id="3453546">l</span>&nbsp;<span class="op" id="3453548">!=</span>&nbsp;<span class="num" id="3453551">0</span>&nbsp;<span class="op" id="3453553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453557">i</span>&nbsp;<span class="op" id="3453559">:=</span>&nbsp;<span class="op" id="3453562">&amp;</span><span class="ident" id="3453563">p</span><span class="op" id="3453564">.</span><span class="ident" id="3453565">Inst</span><span class="op" id="3453569">[</span><span class="ident" id="3453570">l</span><span class="op" id="3453571">&gt;&gt;</span><span class="num" id="3453573">1</span><span class="op" id="3453574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453578">if</span>&nbsp;<span class="ident" id="3453581">l</span><span class="op" id="3453582">&amp;</span><span class="num" id="3453583">1</span>&nbsp;<span class="op" id="3453585">==</span>&nbsp;<span class="num" id="3453588">0</span>&nbsp;<span class="op" id="3453590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453595">l</span>&nbsp;<span class="op" id="3453597">=</span>&nbsp;<span class="ident" id="3453599">patchList</span><span class="op" id="3453608">(</span><span class="ident" id="3453609">i</span><span class="op" id="3453610">.</span><span class="ident" id="3453611">Out</span><span class="op" id="3453614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453619">i</span><span class="op" id="3453620">.</span><span class="ident" id="3453621">Out</span>&nbsp;<span class="op" id="3453625">=</span>&nbsp;<span class="ident" id="3453627">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453633">}</span>&nbsp;<span class="keyword" id="3453635">else</span>&nbsp;<span class="op" id="3453640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453645">l</span>&nbsp;<span class="op" id="3453647">=</span>&nbsp;<span class="ident" id="3453649">patchList</span><span class="op" id="3453658">(</span><span class="ident" id="3453659">i</span><span class="op" id="3453660">.</span><span class="ident" id="3453661">Arg</span><span class="op" id="3453664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453669">i</span><span class="op" id="3453670">.</span><span class="ident" id="3453671">Arg</span>&nbsp;<span class="op" id="3453675">=</span>&nbsp;<span class="ident" id="3453677">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453686">}</span><br>
<span class="lineno">40</span><span class="op" id="3453688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3453691">func</span>&nbsp;<span class="op" id="3453696">(</span><span class="ident" id="3453697">l1</span>&nbsp;<span class="ident" id="3453700">patchList</span><span class="op" id="3453709">)</span>&nbsp;<span class="builtinfunc" id="3453711">append</span><span class="op" id="3453717">(</span><span class="ident" id="3453718">p</span>&nbsp;<span class="op" id="3453720">*</span><span class="ident" id="3453721">Prog</span><span class="op" id="3453725">,</span>&nbsp;<span class="ident" id="3453727">l2</span>&nbsp;<span class="ident" id="3453730">patchList</span><span class="op" id="3453739">)</span>&nbsp;<span class="ident" id="3453741">patchList</span>&nbsp;<span class="op" id="3453751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453754">if</span>&nbsp;<span class="ident" id="3453757">l1</span>&nbsp;<span class="op" id="3453760">==</span>&nbsp;<span class="num" id="3453763">0</span>&nbsp;<span class="op" id="3453765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453769">return</span>&nbsp;<span class="ident" id="3453776">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453783">if</span>&nbsp;<span class="ident" id="3453786">l2</span>&nbsp;<span class="op" id="3453789">==</span>&nbsp;<span class="num" id="3453792">0</span>&nbsp;<span class="op" id="3453794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453798">return</span>&nbsp;<span class="ident" id="3453805">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453813">last</span>&nbsp;<span class="op" id="3453818">:=</span>&nbsp;<span class="ident" id="3453821">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453825">for</span>&nbsp;<span class="op" id="3453829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453833">next</span>&nbsp;<span class="op" id="3453838">:=</span>&nbsp;<span class="ident" id="3453841">last</span><span class="op" id="3453845">.</span><span class="ident" id="3453846">next</span><span class="op" id="3453850">(</span><span class="ident" id="3453851">p</span><span class="op" id="3453852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453856">if</span>&nbsp;<span class="ident" id="3453859">next</span>&nbsp;<span class="op" id="3453864">==</span>&nbsp;<span class="num" id="3453867">0</span>&nbsp;<span class="op" id="3453869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453874">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453886">last</span>&nbsp;<span class="op" id="3453891">=</span>&nbsp;<span class="ident" id="3453893">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453903">i</span>&nbsp;<span class="op" id="3453905">:=</span>&nbsp;<span class="op" id="3453908">&amp;</span><span class="ident" id="3453909">p</span><span class="op" id="3453910">.</span><span class="ident" id="3453911">Inst</span><span class="op" id="3453915">[</span><span class="ident" id="3453916">last</span><span class="op" id="3453920">&gt;&gt;</span><span class="num" id="3453922">1</span><span class="op" id="3453923">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453926">if</span>&nbsp;<span class="ident" id="3453929">last</span><span class="op" id="3453933">&amp;</span><span class="num" id="3453934">1</span>&nbsp;<span class="op" id="3453936">==</span>&nbsp;<span class="num" id="3453939">0</span>&nbsp;<span class="op" id="3453941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453945">i</span><span class="op" id="3453946">.</span><span class="ident" id="3453947">Out</span>&nbsp;<span class="op" id="3453951">=</span>&nbsp;<span class="builtintype" id="3453953">uint32</span><span class="op" id="3453959">(</span><span class="ident" id="3453960">l2</span><span class="op" id="3453962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453965">}</span>&nbsp;<span class="keyword" id="3453967">else</span>&nbsp;<span class="op" id="3453972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453976">i</span><span class="op" id="3453977">.</span><span class="ident" id="3453978">Arg</span>&nbsp;<span class="op" id="3453982">=</span>&nbsp;<span class="builtintype" id="3453984">uint32</span><span class="op" id="3453990">(</span><span class="ident" id="3453991">l2</span><span class="op" id="3453993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453996">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453999">return</span>&nbsp;<span class="ident" id="3454006">l1</span><br>
<span class="lineno"></span><span class="op" id="3454009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3454012">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="3454062">type</span>&nbsp;<span class="ident" id="3454067">frag</span>&nbsp;<span class="keyword" id="3454072">struct</span>&nbsp;<span class="op" id="3454079">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454082">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3454086">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3454096">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454127">out</span>&nbsp;<span class="ident" id="3454131">patchList</span>&nbsp;<span class="comment" id="3454141">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="3454176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3454179">type</span>&nbsp;<span class="ident" id="3454184">compiler</span>&nbsp;<span class="keyword" id="3454193">struct</span>&nbsp;<span class="op" id="3454200">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454203">p</span>&nbsp;<span class="op" id="3454205">*</span><span class="ident" id="3454206">Prog</span><br>
<span class="lineno"></span><span class="op" id="3454211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3454214">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="3454276">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="3454355">func</span>&nbsp;<span class="ident" id="3454360">Compile</span><span class="op" id="3454367">(</span><span class="ident" id="3454368">re</span>&nbsp;<span class="op" id="3454371">*</span><span class="ident" id="3454372">Regexp</span><span class="op" id="3454378">)</span>&nbsp;<span class="op" id="3454380">(</span><span class="op" id="3454381">*</span><span class="ident" id="3454382">Prog</span><span class="op" id="3454386">,</span>&nbsp;<span class="builtintype" id="3454388">error</span><span class="op" id="3454393">)</span>&nbsp;<span class="op" id="3454395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454398">var</span>&nbsp;<span class="ident" id="3454402">c</span>&nbsp;<span class="ident" id="3454404">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454414">c</span><span class="op" id="3454415">.</span><span class="ident" id="3454416">init</span><span class="op" id="3454420">(</span><span class="op" id="3454421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454424">f</span>&nbsp;<span class="op" id="3454426">:=</span>&nbsp;<span class="ident" id="3454429">c</span><span class="op" id="3454430">.</span><span class="ident" id="3454431">compile</span><span class="op" id="3454438">(</span><span class="ident" id="3454439">re</span><span class="op" id="3454441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454444">f</span><span class="op" id="3454445">.</span><span class="ident" id="3454446">out</span><span class="op" id="3454449">.</span><span class="ident" id="3454450">patch</span><span class="op" id="3454455">(</span><span class="ident" id="3454456">c</span><span class="op" id="3454457">.</span><span class="ident" id="3454458">p</span><span class="op" id="3454459">,</span>&nbsp;<span class="ident" id="3454461">c</span><span class="op" id="3454462">.</span><span class="ident" id="3454463">inst</span><span class="op" id="3454467">(</span><span class="ident" id="3454468">InstMatch</span><span class="op" id="3454477">)</span><span class="op" id="3454478">.</span><span class="ident" id="3454479">i</span><span class="op" id="3454480">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454483">c</span><span class="op" id="3454484">.</span><span class="ident" id="3454485">p</span><span class="op" id="3454486">.</span><span class="ident" id="3454487">Start</span>&nbsp;<span class="op" id="3454493">=</span>&nbsp;<span class="builtintype" id="3454495">int</span><span class="op" id="3454498">(</span><span class="ident" id="3454499">f</span><span class="op" id="3454500">.</span><span class="ident" id="3454501">i</span><span class="op" id="3454502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454505">return</span>&nbsp;<span class="ident" id="3454512">c</span><span class="op" id="3454513">.</span><span class="ident" id="3454514">p</span><span class="op" id="3454515">,</span>&nbsp;<span class="builtintype" id="3454517">nil</span><br>
<span class="lineno"></span><span class="op" id="3454521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3454524">func</span>&nbsp;<span class="op" id="3454529">(</span><span class="ident" id="3454530">c</span>&nbsp;<span class="op" id="3454532">*</span><span class="ident" id="3454533">compiler</span><span class="op" id="3454541">)</span>&nbsp;<span class="ident" id="3454543">init</span><span class="op" id="3454547">(</span><span class="op" id="3454548">)</span>&nbsp;<span class="op" id="3454550">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454553">c</span><span class="op" id="3454554">.</span><span class="ident" id="3454555">p</span>&nbsp;<span class="op" id="3454557">=</span>&nbsp;<span class="builtinfunc" id="3454559">new</span><span class="op" id="3454562">(</span><span class="ident" id="3454563">Prog</span><span class="op" id="3454567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454570">c</span><span class="op" id="3454571">.</span><span class="ident" id="3454572">p</span><span class="op" id="3454573">.</span><span class="ident" id="3454574">NumCap</span>&nbsp;<span class="op" id="3454581">=</span>&nbsp;<span class="num" id="3454583">2</span>&nbsp;<span class="comment" id="3454585">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454625">c</span><span class="op" id="3454626">.</span><span class="ident" id="3454627">inst</span><span class="op" id="3454631">(</span><span class="ident" id="3454632">InstFail</span><span class="op" id="3454640">)</span><br>
<span class="lineno"></span><span class="op" id="3454642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3454645">var</span>&nbsp;<span class="ident" id="3454649">anyRuneNotNL</span>&nbsp;<span class="op" id="3454662">=</span>&nbsp;<span class="op" id="3454664">[</span><span class="op" id="3454665">]</span><span class="builtintype" id="3454666">rune</span><span class="op" id="3454670">{</span><span class="num" id="3454671">0</span><span class="op" id="3454672">,</span>&nbsp;<span class="string" id="3454674">&#39;\n&#39;</span>&nbsp;<span class="op" id="3454679">-</span>&nbsp;<span class="num" id="3454681">1</span><span class="op" id="3454682">,</span>&nbsp;<span class="string" id="3454684">&#39;\n&#39;</span>&nbsp;<span class="op" id="3454689">+</span>&nbsp;<span class="num" id="3454691">1</span><span class="op" id="3454692">,</span>&nbsp;<span class="ident" id="3454694">unicode</span><span class="op" id="3454701">.</span><span class="ident" id="3454702">MaxRune</span><span class="op" id="3454709">}</span><br>
<span class="lineno"></span><span class="keyword" id="3454711">var</span>&nbsp;<span class="ident" id="3454715">anyRune</span>&nbsp;<span class="op" id="3454723">=</span>&nbsp;<span class="op" id="3454725">[</span><span class="op" id="3454726">]</span><span class="builtintype" id="3454727">rune</span><span class="op" id="3454731">{</span><span class="num" id="3454732">0</span><span class="op" id="3454733">,</span>&nbsp;<span class="ident" id="3454735">unicode</span><span class="op" id="3454742">.</span><span class="ident" id="3454743">MaxRune</span><span class="op" id="3454750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3454753">func</span>&nbsp;<span class="op" id="3454758">(</span><span class="ident" id="3454759">c</span>&nbsp;<span class="op" id="3454761">*</span><span class="ident" id="3454762">compiler</span><span class="op" id="3454770">)</span>&nbsp;<span class="ident" id="3454772">compile</span><span class="op" id="3454779">(</span><span class="ident" id="3454780">re</span>&nbsp;<span class="op" id="3454783">*</span><span class="ident" id="3454784">Regexp</span><span class="op" id="3454790">)</span>&nbsp;<span class="ident" id="3454792">frag</span>&nbsp;<span class="op" id="3454797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454800">switch</span>&nbsp;<span class="ident" id="3454807">re</span><span class="op" id="3454809">.</span><span class="ident" id="3454810">Op</span>&nbsp;<span class="op" id="3454813">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454816">case</span>&nbsp;<span class="ident" id="3454821">OpNoMatch</span><span class="op" id="3454830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454834">return</span>&nbsp;<span class="ident" id="3454841">c</span><span class="op" id="3454842">.</span><span class="ident" id="3454843">fail</span><span class="op" id="3454847">(</span><span class="op" id="3454848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454851">case</span>&nbsp;<span class="ident" id="3454856">OpEmptyMatch</span><span class="op" id="3454868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454872">return</span>&nbsp;<span class="ident" id="3454879">c</span><span class="op" id="3454880">.</span><span class="ident" id="3454881">nop</span><span class="op" id="3454884">(</span><span class="op" id="3454885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454888">case</span>&nbsp;<span class="ident" id="3454893">OpLiteral</span><span class="op" id="3454902">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454906">if</span>&nbsp;<span class="builtinfunc" id="3454909">len</span><span class="op" id="3454912">(</span><span class="ident" id="3454913">re</span><span class="op" id="3454915">.</span><span class="ident" id="3454916">Rune</span><span class="op" id="3454920">)</span>&nbsp;<span class="op" id="3454922">==</span>&nbsp;<span class="num" id="3454925">0</span>&nbsp;<span class="op" id="3454927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454932">return</span>&nbsp;<span class="ident" id="3454939">c</span><span class="op" id="3454940">.</span><span class="ident" id="3454941">nop</span><span class="op" id="3454944">(</span><span class="op" id="3454945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454953">var</span>&nbsp;<span class="ident" id="3454957">f</span>&nbsp;<span class="ident" id="3454959">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454966">for</span>&nbsp;<span class="ident" id="3454970">j</span>&nbsp;<span class="op" id="3454972">:=</span>&nbsp;<span class="keyword" id="3454975">range</span>&nbsp;<span class="ident" id="3454981">re</span><span class="op" id="3454983">.</span><span class="ident" id="3454984">Rune</span>&nbsp;<span class="op" id="3454989">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454994">f1</span>&nbsp;<span class="op" id="3454997">:=</span>&nbsp;<span class="ident" id="3455000">c</span><span class="op" id="3455001">.</span><span class="builtintype" id="3455002">rune</span><span class="op" id="3455006">(</span><span class="ident" id="3455007">re</span><span class="op" id="3455009">.</span><span class="ident" id="3455010">Rune</span><span class="op" id="3455014">[</span><span class="ident" id="3455015">j</span><span class="op" id="3455016">:</span><span class="ident" id="3455017">j</span><span class="op" id="3455018">+</span><span class="num" id="3455019">1</span><span class="op" id="3455020">]</span><span class="op" id="3455021">,</span>&nbsp;<span class="ident" id="3455023">re</span><span class="op" id="3455025">.</span><span class="ident" id="3455026">Flags</span><span class="op" id="3455031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455036">if</span>&nbsp;<span class="ident" id="3455039">j</span>&nbsp;<span class="op" id="3455041">==</span>&nbsp;<span class="num" id="3455044">0</span>&nbsp;<span class="op" id="3455046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455052">f</span>&nbsp;<span class="op" id="3455054">=</span>&nbsp;<span class="ident" id="3455056">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455062">}</span>&nbsp;<span class="keyword" id="3455064">else</span>&nbsp;<span class="op" id="3455069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455075">f</span>&nbsp;<span class="op" id="3455077">=</span>&nbsp;<span class="ident" id="3455079">c</span><span class="op" id="3455080">.</span><span class="ident" id="3455081">cat</span><span class="op" id="3455084">(</span><span class="ident" id="3455085">f</span><span class="op" id="3455086">,</span>&nbsp;<span class="ident" id="3455088">f1</span><span class="op" id="3455090">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455103">return</span>&nbsp;<span class="ident" id="3455110">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455113">case</span>&nbsp;<span class="ident" id="3455118">OpCharClass</span><span class="op" id="3455129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455133">return</span>&nbsp;<span class="ident" id="3455140">c</span><span class="op" id="3455141">.</span><span class="builtintype" id="3455142">rune</span><span class="op" id="3455146">(</span><span class="ident" id="3455147">re</span><span class="op" id="3455149">.</span><span class="ident" id="3455150">Rune</span><span class="op" id="3455154">,</span>&nbsp;<span class="ident" id="3455156">re</span><span class="op" id="3455158">.</span><span class="ident" id="3455159">Flags</span><span class="op" id="3455164">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455167">case</span>&nbsp;<span class="ident" id="3455172">OpAnyCharNotNL</span><span class="op" id="3455186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455190">return</span>&nbsp;<span class="ident" id="3455197">c</span><span class="op" id="3455198">.</span><span class="builtintype" id="3455199">rune</span><span class="op" id="3455203">(</span><span class="ident" id="3455204">anyRuneNotNL</span><span class="op" id="3455216">,</span>&nbsp;<span class="num" id="3455218">0</span><span class="op" id="3455219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455222">case</span>&nbsp;<span class="ident" id="3455227">OpAnyChar</span><span class="op" id="3455236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455240">return</span>&nbsp;<span class="ident" id="3455247">c</span><span class="op" id="3455248">.</span><span class="builtintype" id="3455249">rune</span><span class="op" id="3455253">(</span><span class="ident" id="3455254">anyRune</span><span class="op" id="3455261">,</span>&nbsp;<span class="num" id="3455263">0</span><span class="op" id="3455264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455267">case</span>&nbsp;<span class="ident" id="3455272">OpBeginLine</span><span class="op" id="3455283">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455287">return</span>&nbsp;<span class="ident" id="3455294">c</span><span class="op" id="3455295">.</span><span class="ident" id="3455296">empty</span><span class="op" id="3455301">(</span><span class="ident" id="3455302">EmptyBeginLine</span><span class="op" id="3455316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455319">case</span>&nbsp;<span class="ident" id="3455324">OpEndLine</span><span class="op" id="3455333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455337">return</span>&nbsp;<span class="ident" id="3455344">c</span><span class="op" id="3455345">.</span><span class="ident" id="3455346">empty</span><span class="op" id="3455351">(</span><span class="ident" id="3455352">EmptyEndLine</span><span class="op" id="3455364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455367">case</span>&nbsp;<span class="ident" id="3455372">OpBeginText</span><span class="op" id="3455383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455387">return</span>&nbsp;<span class="ident" id="3455394">c</span><span class="op" id="3455395">.</span><span class="ident" id="3455396">empty</span><span class="op" id="3455401">(</span><span class="ident" id="3455402">EmptyBeginText</span><span class="op" id="3455416">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455419">case</span>&nbsp;<span class="ident" id="3455424">OpEndText</span><span class="op" id="3455433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455437">return</span>&nbsp;<span class="ident" id="3455444">c</span><span class="op" id="3455445">.</span><span class="ident" id="3455446">empty</span><span class="op" id="3455451">(</span><span class="ident" id="3455452">EmptyEndText</span><span class="op" id="3455464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455467">case</span>&nbsp;<span class="ident" id="3455472">OpWordBoundary</span><span class="op" id="3455486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455490">return</span>&nbsp;<span class="ident" id="3455497">c</span><span class="op" id="3455498">.</span><span class="ident" id="3455499">empty</span><span class="op" id="3455504">(</span><span class="ident" id="3455505">EmptyWordBoundary</span><span class="op" id="3455522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455525">case</span>&nbsp;<span class="ident" id="3455530">OpNoWordBoundary</span><span class="op" id="3455546">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455550">return</span>&nbsp;<span class="ident" id="3455557">c</span><span class="op" id="3455558">.</span><span class="ident" id="3455559">empty</span><span class="op" id="3455564">(</span><span class="ident" id="3455565">EmptyNoWordBoundary</span><span class="op" id="3455584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455587">case</span>&nbsp;<span class="ident" id="3455592">OpCapture</span><span class="op" id="3455601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455605">bra</span>&nbsp;<span class="op" id="3455609">:=</span>&nbsp;<span class="ident" id="3455612">c</span><span class="op" id="3455613">.</span><span class="builtinfunc" id="3455614">cap</span><span class="op" id="3455617">(</span><span class="builtintype" id="3455618">uint32</span><span class="op" id="3455624">(</span><span class="ident" id="3455625">re</span><span class="op" id="3455627">.</span><span class="ident" id="3455628">Cap</span>&nbsp;<span class="op" id="3455632">&lt;&lt;</span>&nbsp;<span class="num" id="3455635">1</span><span class="op" id="3455636">)</span><span class="op" id="3455637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455641">sub</span>&nbsp;<span class="op" id="3455645">:=</span>&nbsp;<span class="ident" id="3455648">c</span><span class="op" id="3455649">.</span><span class="ident" id="3455650">compile</span><span class="op" id="3455657">(</span><span class="ident" id="3455658">re</span><span class="op" id="3455660">.</span><span class="ident" id="3455661">Sub</span><span class="op" id="3455664">[</span><span class="num" id="3455665">0</span><span class="op" id="3455666">]</span><span class="op" id="3455667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455671">ket</span>&nbsp;<span class="op" id="3455675">:=</span>&nbsp;<span class="ident" id="3455678">c</span><span class="op" id="3455679">.</span><span class="builtinfunc" id="3455680">cap</span><span class="op" id="3455683">(</span><span class="builtintype" id="3455684">uint32</span><span class="op" id="3455690">(</span><span class="ident" id="3455691">re</span><span class="op" id="3455693">.</span><span class="ident" id="3455694">Cap</span><span class="op" id="3455697">&lt;&lt;</span><span class="num" id="3455699">1</span>&nbsp;<span class="op" id="3455701">|</span>&nbsp;<span class="num" id="3455703">1</span><span class="op" id="3455704">)</span><span class="op" id="3455705">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455709">return</span>&nbsp;<span class="ident" id="3455716">c</span><span class="op" id="3455717">.</span><span class="ident" id="3455718">cat</span><span class="op" id="3455721">(</span><span class="ident" id="3455722">c</span><span class="op" id="3455723">.</span><span class="ident" id="3455724">cat</span><span class="op" id="3455727">(</span><span class="ident" id="3455728">bra</span><span class="op" id="3455731">,</span>&nbsp;<span class="ident" id="3455733">sub</span><span class="op" id="3455736">)</span><span class="op" id="3455737">,</span>&nbsp;<span class="ident" id="3455739">ket</span><span class="op" id="3455742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455745">case</span>&nbsp;<span class="ident" id="3455750">OpStar</span><span class="op" id="3455756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455760">return</span>&nbsp;<span class="ident" id="3455767">c</span><span class="op" id="3455768">.</span><span class="ident" id="3455769">star</span><span class="op" id="3455773">(</span><span class="ident" id="3455774">c</span><span class="op" id="3455775">.</span><span class="ident" id="3455776">compile</span><span class="op" id="3455783">(</span><span class="ident" id="3455784">re</span><span class="op" id="3455786">.</span><span class="ident" id="3455787">Sub</span><span class="op" id="3455790">[</span><span class="num" id="3455791">0</span><span class="op" id="3455792">]</span><span class="op" id="3455793">)</span><span class="op" id="3455794">,</span>&nbsp;<span class="ident" id="3455796">re</span><span class="op" id="3455798">.</span><span class="ident" id="3455799">Flags</span><span class="op" id="3455804">&amp;</span><span class="ident" id="3455805">NonGreedy</span>&nbsp;<span class="op" id="3455815">!=</span>&nbsp;<span class="num" id="3455818">0</span><span class="op" id="3455819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455822">case</span>&nbsp;<span class="ident" id="3455827">OpPlus</span><span class="op" id="3455833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455837">return</span>&nbsp;<span class="ident" id="3455844">c</span><span class="op" id="3455845">.</span><span class="ident" id="3455846">plus</span><span class="op" id="3455850">(</span><span class="ident" id="3455851">c</span><span class="op" id="3455852">.</span><span class="ident" id="3455853">compile</span><span class="op" id="3455860">(</span><span class="ident" id="3455861">re</span><span class="op" id="3455863">.</span><span class="ident" id="3455864">Sub</span><span class="op" id="3455867">[</span><span class="num" id="3455868">0</span><span class="op" id="3455869">]</span><span class="op" id="3455870">)</span><span class="op" id="3455871">,</span>&nbsp;<span class="ident" id="3455873">re</span><span class="op" id="3455875">.</span><span class="ident" id="3455876">Flags</span><span class="op" id="3455881">&amp;</span><span class="ident" id="3455882">NonGreedy</span>&nbsp;<span class="op" id="3455892">!=</span>&nbsp;<span class="num" id="3455895">0</span><span class="op" id="3455896">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455899">case</span>&nbsp;<span class="ident" id="3455904">OpQuest</span><span class="op" id="3455911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455915">return</span>&nbsp;<span class="ident" id="3455922">c</span><span class="op" id="3455923">.</span><span class="ident" id="3455924">quest</span><span class="op" id="3455929">(</span><span class="ident" id="3455930">c</span><span class="op" id="3455931">.</span><span class="ident" id="3455932">compile</span><span class="op" id="3455939">(</span><span class="ident" id="3455940">re</span><span class="op" id="3455942">.</span><span class="ident" id="3455943">Sub</span><span class="op" id="3455946">[</span><span class="num" id="3455947">0</span><span class="op" id="3455948">]</span><span class="op" id="3455949">)</span><span class="op" id="3455950">,</span>&nbsp;<span class="ident" id="3455952">re</span><span class="op" id="3455954">.</span><span class="ident" id="3455955">Flags</span><span class="op" id="3455960">&amp;</span><span class="ident" id="3455961">NonGreedy</span>&nbsp;<span class="op" id="3455971">!=</span>&nbsp;<span class="num" id="3455974">0</span><span class="op" id="3455975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455978">case</span>&nbsp;<span class="ident" id="3455983">OpConcat</span><span class="op" id="3455991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455995">if</span>&nbsp;<span class="builtinfunc" id="3455998">len</span><span class="op" id="3456001">(</span><span class="ident" id="3456002">re</span><span class="op" id="3456004">.</span><span class="ident" id="3456005">Sub</span><span class="op" id="3456008">)</span>&nbsp;<span class="op" id="3456010">==</span>&nbsp;<span class="num" id="3456013">0</span>&nbsp;<span class="op" id="3456015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456020">return</span>&nbsp;<span class="ident" id="3456027">c</span><span class="op" id="3456028">.</span><span class="ident" id="3456029">nop</span><span class="op" id="3456032">(</span><span class="op" id="3456033">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456041">var</span>&nbsp;<span class="ident" id="3456045">f</span>&nbsp;<span class="ident" id="3456047">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456054">for</span>&nbsp;<span class="ident" id="3456058">i</span><span class="op" id="3456059">,</span>&nbsp;<span class="ident" id="3456061">sub</span>&nbsp;<span class="op" id="3456065">:=</span>&nbsp;<span class="keyword" id="3456068">range</span>&nbsp;<span class="ident" id="3456074">re</span><span class="op" id="3456076">.</span><span class="ident" id="3456077">Sub</span>&nbsp;<span class="op" id="3456081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456086">if</span>&nbsp;<span class="ident" id="3456089">i</span>&nbsp;<span class="op" id="3456091">==</span>&nbsp;<span class="num" id="3456094">0</span>&nbsp;<span class="op" id="3456096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456102">f</span>&nbsp;<span class="op" id="3456104">=</span>&nbsp;<span class="ident" id="3456106">c</span><span class="op" id="3456107">.</span><span class="ident" id="3456108">compile</span><span class="op" id="3456115">(</span><span class="ident" id="3456116">sub</span><span class="op" id="3456119">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456124">}</span>&nbsp;<span class="keyword" id="3456126">else</span>&nbsp;<span class="op" id="3456131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456137">f</span>&nbsp;<span class="op" id="3456139">=</span>&nbsp;<span class="ident" id="3456141">c</span><span class="op" id="3456142">.</span><span class="ident" id="3456143">cat</span><span class="op" id="3456146">(</span><span class="ident" id="3456147">f</span><span class="op" id="3456148">,</span>&nbsp;<span class="ident" id="3456150">c</span><span class="op" id="3456151">.</span><span class="ident" id="3456152">compile</span><span class="op" id="3456159">(</span><span class="ident" id="3456160">sub</span><span class="op" id="3456163">)</span><span class="op" id="3456164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456177">return</span>&nbsp;<span class="ident" id="3456184">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456187">case</span>&nbsp;<span class="ident" id="3456192">OpAlternate</span><span class="op" id="3456203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456207">var</span>&nbsp;<span class="ident" id="3456211">f</span>&nbsp;<span class="ident" id="3456213">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456220">for</span>&nbsp;<span class="ident" id="3456224">_</span><span class="op" id="3456225">,</span>&nbsp;<span class="ident" id="3456227">sub</span>&nbsp;<span class="op" id="3456231">:=</span>&nbsp;<span class="keyword" id="3456234">range</span>&nbsp;<span class="ident" id="3456240">re</span><span class="op" id="3456242">.</span><span class="ident" id="3456243">Sub</span>&nbsp;<span class="op" id="3456247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456252">f</span>&nbsp;<span class="op" id="3456254">=</span>&nbsp;<span class="ident" id="3456256">c</span><span class="op" id="3456257">.</span><span class="ident" id="3456258">alt</span><span class="op" id="3456261">(</span><span class="ident" id="3456262">f</span><span class="op" id="3456263">,</span>&nbsp;<span class="ident" id="3456265">c</span><span class="op" id="3456266">.</span><span class="ident" id="3456267">compile</span><span class="op" id="3456274">(</span><span class="ident" id="3456275">sub</span><span class="op" id="3456278">)</span><span class="op" id="3456279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456283">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456287">return</span>&nbsp;<span class="ident" id="3456294">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3456300">panic</span><span class="op" id="3456305">(</span><span class="string" id="3456306">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="3456341">)</span><br>
<span class="lineno"></span><span class="op" id="3456343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3456346">func</span>&nbsp;<span class="op" id="3456351">(</span><span class="ident" id="3456352">c</span>&nbsp;<span class="op" id="3456354">*</span><span class="ident" id="3456355">compiler</span><span class="op" id="3456363">)</span>&nbsp;<span class="ident" id="3456365">inst</span><span class="op" id="3456369">(</span><span class="ident" id="3456370">op</span>&nbsp;<span class="ident" id="3456373">InstOp</span><span class="op" id="3456379">)</span>&nbsp;<span class="ident" id="3456381">frag</span>&nbsp;<span class="op" id="3456386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456389">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456419">f</span>&nbsp;<span class="op" id="3456421">:=</span>&nbsp;<span class="ident" id="3456424">frag</span><span class="op" id="3456428">{</span><span class="ident" id="3456429">i</span><span class="op" id="3456430">:</span>&nbsp;<span class="builtintype" id="3456432">uint32</span><span class="op" id="3456438">(</span><span class="builtinfunc" id="3456439">len</span><span class="op" id="3456442">(</span><span class="ident" id="3456443">c</span><span class="op" id="3456444">.</span><span class="ident" id="3456445">p</span><span class="op" id="3456446">.</span><span class="ident" id="3456447">Inst</span><span class="op" id="3456451">)</span><span class="op" id="3456452">)</span><span class="op" id="3456453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456456">c</span><span class="op" id="3456457">.</span><span class="ident" id="3456458">p</span><span class="op" id="3456459">.</span><span class="ident" id="3456460">Inst</span>&nbsp;<span class="op" id="3456465">=</span>&nbsp;<span class="builtinfunc" id="3456467">append</span><span class="op" id="3456473">(</span><span class="ident" id="3456474">c</span><span class="op" id="3456475">.</span><span class="ident" id="3456476">p</span><span class="op" id="3456477">.</span><span class="ident" id="3456478">Inst</span><span class="op" id="3456482">,</span>&nbsp;<span class="ident" id="3456484">Inst</span><span class="op" id="3456488">{</span><span class="ident" id="3456489">Op</span><span class="op" id="3456491">:</span>&nbsp;<span class="ident" id="3456493">op</span><span class="op" id="3456495">}</span><span class="op" id="3456496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456499">return</span>&nbsp;<span class="ident" id="3456506">f</span><br>
<span class="lineno">175</span><span class="op" id="3456508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3456511">func</span>&nbsp;<span class="op" id="3456516">(</span><span class="ident" id="3456517">c</span>&nbsp;<span class="op" id="3456519">*</span><span class="ident" id="3456520">compiler</span><span class="op" id="3456528">)</span>&nbsp;<span class="ident" id="3456530">nop</span><span class="op" id="3456533">(</span><span class="op" id="3456534">)</span>&nbsp;<span class="ident" id="3456536">frag</span>&nbsp;<span class="op" id="3456541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456544">f</span>&nbsp;<span class="op" id="3456546">:=</span>&nbsp;<span class="ident" id="3456549">c</span><span class="op" id="3456550">.</span><span class="ident" id="3456551">inst</span><span class="op" id="3456555">(</span><span class="ident" id="3456556">InstNop</span><span class="op" id="3456563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456566">f</span><span class="op" id="3456567">.</span><span class="ident" id="3456568">out</span>&nbsp;<span class="op" id="3456572">=</span>&nbsp;<span class="ident" id="3456574">patchList</span><span class="op" id="3456583">(</span><span class="ident" id="3456584">f</span><span class="op" id="3456585">.</span><span class="ident" id="3456586">i</span>&nbsp;<span class="op" id="3456588">&lt;&lt;</span>&nbsp;<span class="num" id="3456591">1</span><span class="op" id="3456592">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456595">return</span>&nbsp;<span class="ident" id="3456602">f</span><br>
<span class="lineno"></span><span class="op" id="3456604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3456607">func</span>&nbsp;<span class="op" id="3456612">(</span><span class="ident" id="3456613">c</span>&nbsp;<span class="op" id="3456615">*</span><span class="ident" id="3456616">compiler</span><span class="op" id="3456624">)</span>&nbsp;<span class="ident" id="3456626">fail</span><span class="op" id="3456630">(</span><span class="op" id="3456631">)</span>&nbsp;<span class="ident" id="3456633">frag</span>&nbsp;<span class="op" id="3456638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456641">return</span>&nbsp;<span class="ident" id="3456648">frag</span><span class="op" id="3456652">{</span><span class="op" id="3456653">}</span><br>
<span class="lineno">185</span><span class="op" id="3456655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3456658">func</span>&nbsp;<span class="op" id="3456663">(</span><span class="ident" id="3456664">c</span>&nbsp;<span class="op" id="3456666">*</span><span class="ident" id="3456667">compiler</span><span class="op" id="3456675">)</span>&nbsp;<span class="builtinfunc" id="3456677">cap</span><span class="op" id="3456680">(</span><span class="ident" id="3456681">arg</span>&nbsp;<span class="builtintype" id="3456685">uint32</span><span class="op" id="3456691">)</span>&nbsp;<span class="ident" id="3456693">frag</span>&nbsp;<span class="op" id="3456698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456701">f</span>&nbsp;<span class="op" id="3456703">:=</span>&nbsp;<span class="ident" id="3456706">c</span><span class="op" id="3456707">.</span><span class="ident" id="3456708">inst</span><span class="op" id="3456712">(</span><span class="ident" id="3456713">InstCapture</span><span class="op" id="3456724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456727">f</span><span class="op" id="3456728">.</span><span class="ident" id="3456729">out</span>&nbsp;<span class="op" id="3456733">=</span>&nbsp;<span class="ident" id="3456735">patchList</span><span class="op" id="3456744">(</span><span class="ident" id="3456745">f</span><span class="op" id="3456746">.</span><span class="ident" id="3456747">i</span>&nbsp;<span class="op" id="3456749">&lt;&lt;</span>&nbsp;<span class="num" id="3456752">1</span><span class="op" id="3456753">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456756">c</span><span class="op" id="3456757">.</span><span class="ident" id="3456758">p</span><span class="op" id="3456759">.</span><span class="ident" id="3456760">Inst</span><span class="op" id="3456764">[</span><span class="ident" id="3456765">f</span><span class="op" id="3456766">.</span><span class="ident" id="3456767">i</span><span class="op" id="3456768">]</span><span class="op" id="3456769">.</span><span class="ident" id="3456770">Arg</span>&nbsp;<span class="op" id="3456774">=</span>&nbsp;<span class="ident" id="3456776">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456782">if</span>&nbsp;<span class="ident" id="3456785">c</span><span class="op" id="3456786">.</span><span class="ident" id="3456787">p</span><span class="op" id="3456788">.</span><span class="ident" id="3456789">NumCap</span>&nbsp;<span class="op" id="3456796">&lt;</span>&nbsp;<span class="builtintype" id="3456798">int</span><span class="op" id="3456801">(</span><span class="ident" id="3456802">arg</span><span class="op" id="3456805">)</span><span class="op" id="3456806">+</span><span class="num" id="3456807">1</span>&nbsp;<span class="op" id="3456809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456813">c</span><span class="op" id="3456814">.</span><span class="ident" id="3456815">p</span><span class="op" id="3456816">.</span><span class="ident" id="3456817">NumCap</span>&nbsp;<span class="op" id="3456824">=</span>&nbsp;<span class="builtintype" id="3456826">int</span><span class="op" id="3456829">(</span><span class="ident" id="3456830">arg</span><span class="op" id="3456833">)</span>&nbsp;<span class="op" id="3456835">+</span>&nbsp;<span class="num" id="3456837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456840">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456843">return</span>&nbsp;<span class="ident" id="3456850">f</span><br>
<span class="lineno"></span><span class="op" id="3456852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3456855">func</span>&nbsp;<span class="op" id="3456860">(</span><span class="ident" id="3456861">c</span>&nbsp;<span class="op" id="3456863">*</span><span class="ident" id="3456864">compiler</span><span class="op" id="3456872">)</span>&nbsp;<span class="ident" id="3456874">cat</span><span class="op" id="3456877">(</span><span class="ident" id="3456878">f1</span><span class="op" id="3456880">,</span>&nbsp;<span class="ident" id="3456882">f2</span>&nbsp;<span class="ident" id="3456885">frag</span><span class="op" id="3456889">)</span>&nbsp;<span class="ident" id="3456891">frag</span>&nbsp;<span class="op" id="3456896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456899">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456932">if</span>&nbsp;<span class="ident" id="3456935">f1</span><span class="op" id="3456937">.</span><span class="ident" id="3456938">i</span>&nbsp;<span class="op" id="3456940">==</span>&nbsp;<span class="num" id="3456943">0</span>&nbsp;<span class="op" id="3456945">||</span>&nbsp;<span class="ident" id="3456948">f2</span><span class="op" id="3456950">.</span><span class="ident" id="3456951">i</span>&nbsp;<span class="op" id="3456953">==</span>&nbsp;<span class="num" id="3456956">0</span>&nbsp;<span class="op" id="3456958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456962">return</span>&nbsp;<span class="ident" id="3456969">frag</span><span class="op" id="3456973">{</span><span class="op" id="3456974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456981">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457002">f1</span><span class="op" id="3457004">.</span><span class="ident" id="3457005">out</span><span class="op" id="3457008">.</span><span class="ident" id="3457009">patch</span><span class="op" id="3457014">(</span><span class="ident" id="3457015">c</span><span class="op" id="3457016">.</span><span class="ident" id="3457017">p</span><span class="op" id="3457018">,</span>&nbsp;<span class="ident" id="3457020">f2</span><span class="op" id="3457022">.</span><span class="ident" id="3457023">i</span><span class="op" id="3457024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457027">return</span>&nbsp;<span class="ident" id="3457034">frag</span><span class="op" id="3457038">{</span><span class="ident" id="3457039">f1</span><span class="op" id="3457041">.</span><span class="ident" id="3457042">i</span><span class="op" id="3457043">,</span>&nbsp;<span class="ident" id="3457045">f2</span><span class="op" id="3457047">.</span><span class="ident" id="3457048">out</span><span class="op" id="3457051">}</span><br>
<span class="lineno"></span><span class="op" id="3457053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3457056">func</span>&nbsp;<span class="op" id="3457061">(</span><span class="ident" id="3457062">c</span>&nbsp;<span class="op" id="3457064">*</span><span class="ident" id="3457065">compiler</span><span class="op" id="3457073">)</span>&nbsp;<span class="ident" id="3457075">alt</span><span class="op" id="3457078">(</span><span class="ident" id="3457079">f1</span><span class="op" id="3457081">,</span>&nbsp;<span class="ident" id="3457083">f2</span>&nbsp;<span class="ident" id="3457086">frag</span><span class="op" id="3457090">)</span>&nbsp;<span class="ident" id="3457092">frag</span>&nbsp;<span class="op" id="3457097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3457100">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457128">if</span>&nbsp;<span class="ident" id="3457131">f1</span><span class="op" id="3457133">.</span><span class="ident" id="3457134">i</span>&nbsp;<span class="op" id="3457136">==</span>&nbsp;<span class="num" id="3457139">0</span>&nbsp;<span class="op" id="3457141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457145">return</span>&nbsp;<span class="ident" id="3457152">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457156">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457159">if</span>&nbsp;<span class="ident" id="3457162">f2</span><span class="op" id="3457164">.</span><span class="ident" id="3457165">i</span>&nbsp;<span class="op" id="3457167">==</span>&nbsp;<span class="num" id="3457170">0</span>&nbsp;<span class="op" id="3457172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457176">return</span>&nbsp;<span class="ident" id="3457183">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457191">f</span>&nbsp;<span class="op" id="3457193">:=</span>&nbsp;<span class="ident" id="3457196">c</span><span class="op" id="3457197">.</span><span class="ident" id="3457198">inst</span><span class="op" id="3457202">(</span><span class="ident" id="3457203">InstAlt</span><span class="op" id="3457210">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457213">i</span>&nbsp;<span class="op" id="3457215">:=</span>&nbsp;<span class="op" id="3457218">&amp;</span><span class="ident" id="3457219">c</span><span class="op" id="3457220">.</span><span class="ident" id="3457221">p</span><span class="op" id="3457222">.</span><span class="ident" id="3457223">Inst</span><span class="op" id="3457227">[</span><span class="ident" id="3457228">f</span><span class="op" id="3457229">.</span><span class="ident" id="3457230">i</span><span class="op" id="3457231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457234">i</span><span class="op" id="3457235">.</span><span class="ident" id="3457236">Out</span>&nbsp;<span class="op" id="3457240">=</span>&nbsp;<span class="ident" id="3457242">f1</span><span class="op" id="3457244">.</span><span class="ident" id="3457245">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457248">i</span><span class="op" id="3457249">.</span><span class="ident" id="3457250">Arg</span>&nbsp;<span class="op" id="3457254">=</span>&nbsp;<span class="ident" id="3457256">f2</span><span class="op" id="3457258">.</span><span class="ident" id="3457259">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457262">f</span><span class="op" id="3457263">.</span><span class="ident" id="3457264">out</span>&nbsp;<span class="op" id="3457268">=</span>&nbsp;<span class="ident" id="3457270">f1</span><span class="op" id="3457272">.</span><span class="ident" id="3457273">out</span><span class="op" id="3457276">.</span><span class="builtinfunc" id="3457277">append</span><span class="op" id="3457283">(</span><span class="ident" id="3457284">c</span><span class="op" id="3457285">.</span><span class="ident" id="3457286">p</span><span class="op" id="3457287">,</span>&nbsp;<span class="ident" id="3457289">f2</span><span class="op" id="3457291">.</span><span class="ident" id="3457292">out</span><span class="op" id="3457295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457298">return</span>&nbsp;<span class="ident" id="3457305">f</span><br>
<span class="lineno">225</span><span class="op" id="3457307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3457310">func</span>&nbsp;<span class="op" id="3457315">(</span><span class="ident" id="3457316">c</span>&nbsp;<span class="op" id="3457318">*</span><span class="ident" id="3457319">compiler</span><span class="op" id="3457327">)</span>&nbsp;<span class="ident" id="3457329">quest</span><span class="op" id="3457334">(</span><span class="ident" id="3457335">f1</span>&nbsp;<span class="ident" id="3457338">frag</span><span class="op" id="3457342">,</span>&nbsp;<span class="ident" id="3457344">nongreedy</span>&nbsp;<span class="builtintype" id="3457354">bool</span><span class="op" id="3457358">)</span>&nbsp;<span class="ident" id="3457360">frag</span>&nbsp;<span class="op" id="3457365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457368">f</span>&nbsp;<span class="op" id="3457370">:=</span>&nbsp;<span class="ident" id="3457373">c</span><span class="op" id="3457374">.</span><span class="ident" id="3457375">inst</span><span class="op" id="3457379">(</span><span class="ident" id="3457380">InstAlt</span><span class="op" id="3457387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457390">i</span>&nbsp;<span class="op" id="3457392">:=</span>&nbsp;<span class="op" id="3457395">&amp;</span><span class="ident" id="3457396">c</span><span class="op" id="3457397">.</span><span class="ident" id="3457398">p</span><span class="op" id="3457399">.</span><span class="ident" id="3457400">Inst</span><span class="op" id="3457404">[</span><span class="ident" id="3457405">f</span><span class="op" id="3457406">.</span><span class="ident" id="3457407">i</span><span class="op" id="3457408">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457411">if</span>&nbsp;<span class="ident" id="3457414">nongreedy</span>&nbsp;<span class="op" id="3457424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457428">i</span><span class="op" id="3457429">.</span><span class="ident" id="3457430">Arg</span>&nbsp;<span class="op" id="3457434">=</span>&nbsp;<span class="ident" id="3457436">f1</span><span class="op" id="3457438">.</span><span class="ident" id="3457439">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457443">f</span><span class="op" id="3457444">.</span><span class="ident" id="3457445">out</span>&nbsp;<span class="op" id="3457449">=</span>&nbsp;<span class="ident" id="3457451">patchList</span><span class="op" id="3457460">(</span><span class="ident" id="3457461">f</span><span class="op" id="3457462">.</span><span class="ident" id="3457463">i</span>&nbsp;<span class="op" id="3457465">&lt;&lt;</span>&nbsp;<span class="num" id="3457468">1</span><span class="op" id="3457469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457472">}</span>&nbsp;<span class="keyword" id="3457474">else</span>&nbsp;<span class="op" id="3457479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457483">i</span><span class="op" id="3457484">.</span><span class="ident" id="3457485">Out</span>&nbsp;<span class="op" id="3457489">=</span>&nbsp;<span class="ident" id="3457491">f1</span><span class="op" id="3457493">.</span><span class="ident" id="3457494">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457498">f</span><span class="op" id="3457499">.</span><span class="ident" id="3457500">out</span>&nbsp;<span class="op" id="3457504">=</span>&nbsp;<span class="ident" id="3457506">patchList</span><span class="op" id="3457515">(</span><span class="ident" id="3457516">f</span><span class="op" id="3457517">.</span><span class="ident" id="3457518">i</span><span class="op" id="3457519">&lt;&lt;</span><span class="num" id="3457521">1</span>&nbsp;<span class="op" id="3457523">|</span>&nbsp;<span class="num" id="3457525">1</span><span class="op" id="3457526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457532">f</span><span class="op" id="3457533">.</span><span class="ident" id="3457534">out</span>&nbsp;<span class="op" id="3457538">=</span>&nbsp;<span class="ident" id="3457540">f</span><span class="op" id="3457541">.</span><span class="ident" id="3457542">out</span><span class="op" id="3457545">.</span><span class="builtinfunc" id="3457546">append</span><span class="op" id="3457552">(</span><span class="ident" id="3457553">c</span><span class="op" id="3457554">.</span><span class="ident" id="3457555">p</span><span class="op" id="3457556">,</span>&nbsp;<span class="ident" id="3457558">f1</span><span class="op" id="3457560">.</span><span class="ident" id="3457561">out</span><span class="op" id="3457564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457567">return</span>&nbsp;<span class="ident" id="3457574">f</span><br>
<span class="lineno"></span><span class="op" id="3457576">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="3457579">func</span>&nbsp;<span class="op" id="3457584">(</span><span class="ident" id="3457585">c</span>&nbsp;<span class="op" id="3457587">*</span><span class="ident" id="3457588">compiler</span><span class="op" id="3457596">)</span>&nbsp;<span class="ident" id="3457598">star</span><span class="op" id="3457602">(</span><span class="ident" id="3457603">f1</span>&nbsp;<span class="ident" id="3457606">frag</span><span class="op" id="3457610">,</span>&nbsp;<span class="ident" id="3457612">nongreedy</span>&nbsp;<span class="builtintype" id="3457622">bool</span><span class="op" id="3457626">)</span>&nbsp;<span class="ident" id="3457628">frag</span>&nbsp;<span class="op" id="3457633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457636">f</span>&nbsp;<span class="op" id="3457638">:=</span>&nbsp;<span class="ident" id="3457641">c</span><span class="op" id="3457642">.</span><span class="ident" id="3457643">inst</span><span class="op" id="3457647">(</span><span class="ident" id="3457648">InstAlt</span><span class="op" id="3457655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457658">i</span>&nbsp;<span class="op" id="3457660">:=</span>&nbsp;<span class="op" id="3457663">&amp;</span><span class="ident" id="3457664">c</span><span class="op" id="3457665">.</span><span class="ident" id="3457666">p</span><span class="op" id="3457667">.</span><span class="ident" id="3457668">Inst</span><span class="op" id="3457672">[</span><span class="ident" id="3457673">f</span><span class="op" id="3457674">.</span><span class="ident" id="3457675">i</span><span class="op" id="3457676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457679">if</span>&nbsp;<span class="ident" id="3457682">nongreedy</span>&nbsp;<span class="op" id="3457692">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457696">i</span><span class="op" id="3457697">.</span><span class="ident" id="3457698">Arg</span>&nbsp;<span class="op" id="3457702">=</span>&nbsp;<span class="ident" id="3457704">f1</span><span class="op" id="3457706">.</span><span class="ident" id="3457707">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457711">f</span><span class="op" id="3457712">.</span><span class="ident" id="3457713">out</span>&nbsp;<span class="op" id="3457717">=</span>&nbsp;<span class="ident" id="3457719">patchList</span><span class="op" id="3457728">(</span><span class="ident" id="3457729">f</span><span class="op" id="3457730">.</span><span class="ident" id="3457731">i</span>&nbsp;<span class="op" id="3457733">&lt;&lt;</span>&nbsp;<span class="num" id="3457736">1</span><span class="op" id="3457737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457740">}</span>&nbsp;<span class="keyword" id="3457742">else</span>&nbsp;<span class="op" id="3457747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457751">i</span><span class="op" id="3457752">.</span><span class="ident" id="3457753">Out</span>&nbsp;<span class="op" id="3457757">=</span>&nbsp;<span class="ident" id="3457759">f1</span><span class="op" id="3457761">.</span><span class="ident" id="3457762">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457766">f</span><span class="op" id="3457767">.</span><span class="ident" id="3457768">out</span>&nbsp;<span class="op" id="3457772">=</span>&nbsp;<span class="ident" id="3457774">patchList</span><span class="op" id="3457783">(</span><span class="ident" id="3457784">f</span><span class="op" id="3457785">.</span><span class="ident" id="3457786">i</span><span class="op" id="3457787">&lt;&lt;</span><span class="num" id="3457789">1</span>&nbsp;<span class="op" id="3457791">|</span>&nbsp;<span class="num" id="3457793">1</span><span class="op" id="3457794">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457800">f1</span><span class="op" id="3457802">.</span><span class="ident" id="3457803">out</span><span class="op" id="3457806">.</span><span class="ident" id="3457807">patch</span><span class="op" id="3457812">(</span><span class="ident" id="3457813">c</span><span class="op" id="3457814">.</span><span class="ident" id="3457815">p</span><span class="op" id="3457816">,</span>&nbsp;<span class="ident" id="3457818">f</span><span class="op" id="3457819">.</span><span class="ident" id="3457820">i</span><span class="op" id="3457821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457824">return</span>&nbsp;<span class="ident" id="3457831">f</span><br>
<span class="lineno"></span><span class="op" id="3457833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3457836">func</span>&nbsp;<span class="op" id="3457841">(</span><span class="ident" id="3457842">c</span>&nbsp;<span class="op" id="3457844">*</span><span class="ident" id="3457845">compiler</span><span class="op" id="3457853">)</span>&nbsp;<span class="ident" id="3457855">plus</span><span class="op" id="3457859">(</span><span class="ident" id="3457860">f1</span>&nbsp;<span class="ident" id="3457863">frag</span><span class="op" id="3457867">,</span>&nbsp;<span class="ident" id="3457869">nongreedy</span>&nbsp;<span class="builtintype" id="3457879">bool</span><span class="op" id="3457883">)</span>&nbsp;<span class="ident" id="3457885">frag</span>&nbsp;<span class="op" id="3457890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457893">return</span>&nbsp;<span class="ident" id="3457900">frag</span><span class="op" id="3457904">{</span><span class="ident" id="3457905">f1</span><span class="op" id="3457907">.</span><span class="ident" id="3457908">i</span><span class="op" id="3457909">,</span>&nbsp;<span class="ident" id="3457911">c</span><span class="op" id="3457912">.</span><span class="ident" id="3457913">star</span><span class="op" id="3457917">(</span><span class="ident" id="3457918">f1</span><span class="op" id="3457920">,</span>&nbsp;<span class="ident" id="3457922">nongreedy</span><span class="op" id="3457931">)</span><span class="op" id="3457932">.</span><span class="ident" id="3457933">out</span><span class="op" id="3457936">}</span><br>
<span class="lineno"></span><span class="op" id="3457938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3457941">func</span>&nbsp;<span class="op" id="3457946">(</span><span class="ident" id="3457947">c</span>&nbsp;<span class="op" id="3457949">*</span><span class="ident" id="3457950">compiler</span><span class="op" id="3457958">)</span>&nbsp;<span class="ident" id="3457960">empty</span><span class="op" id="3457965">(</span><span class="ident" id="3457966">op</span>&nbsp;<span class="ident" id="3457969">EmptyOp</span><span class="op" id="3457976">)</span>&nbsp;<span class="ident" id="3457978">frag</span>&nbsp;<span class="op" id="3457983">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457986">f</span>&nbsp;<span class="op" id="3457988">:=</span>&nbsp;<span class="ident" id="3457991">c</span><span class="op" id="3457992">.</span><span class="ident" id="3457993">inst</span><span class="op" id="3457997">(</span><span class="ident" id="3457998">InstEmptyWidth</span><span class="op" id="3458012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458015">c</span><span class="op" id="3458016">.</span><span class="ident" id="3458017">p</span><span class="op" id="3458018">.</span><span class="ident" id="3458019">Inst</span><span class="op" id="3458023">[</span><span class="ident" id="3458024">f</span><span class="op" id="3458025">.</span><span class="ident" id="3458026">i</span><span class="op" id="3458027">]</span><span class="op" id="3458028">.</span><span class="ident" id="3458029">Arg</span>&nbsp;<span class="op" id="3458033">=</span>&nbsp;<span class="builtintype" id="3458035">uint32</span><span class="op" id="3458041">(</span><span class="ident" id="3458042">op</span><span class="op" id="3458044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458047">f</span><span class="op" id="3458048">.</span><span class="ident" id="3458049">out</span>&nbsp;<span class="op" id="3458053">=</span>&nbsp;<span class="ident" id="3458055">patchList</span><span class="op" id="3458064">(</span><span class="ident" id="3458065">f</span><span class="op" id="3458066">.</span><span class="ident" id="3458067">i</span>&nbsp;<span class="op" id="3458069">&lt;&lt;</span>&nbsp;<span class="num" id="3458072">1</span><span class="op" id="3458073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458076">return</span>&nbsp;<span class="ident" id="3458083">f</span><br>
<span class="lineno"></span><span class="op" id="3458085">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="3458088">func</span>&nbsp;<span class="op" id="3458093">(</span><span class="ident" id="3458094">c</span>&nbsp;<span class="op" id="3458096">*</span><span class="ident" id="3458097">compiler</span><span class="op" id="3458105">)</span>&nbsp;<span class="builtintype" id="3458107">rune</span><span class="op" id="3458111">(</span><span class="ident" id="3458112">r</span>&nbsp;<span class="op" id="3458114">[</span><span class="op" id="3458115">]</span><span class="builtintype" id="3458116">rune</span><span class="op" id="3458120">,</span>&nbsp;<span class="ident" id="3458122">flags</span>&nbsp;<span class="ident" id="3458128">Flags</span><span class="op" id="3458133">)</span>&nbsp;<span class="ident" id="3458135">frag</span>&nbsp;<span class="op" id="3458140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458143">f</span>&nbsp;<span class="op" id="3458145">:=</span>&nbsp;<span class="ident" id="3458148">c</span><span class="op" id="3458149">.</span><span class="ident" id="3458150">inst</span><span class="op" id="3458154">(</span><span class="ident" id="3458155">InstRune</span><span class="op" id="3458163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458166">i</span>&nbsp;<span class="op" id="3458168">:=</span>&nbsp;<span class="op" id="3458171">&amp;</span><span class="ident" id="3458172">c</span><span class="op" id="3458173">.</span><span class="ident" id="3458174">p</span><span class="op" id="3458175">.</span><span class="ident" id="3458176">Inst</span><span class="op" id="3458180">[</span><span class="ident" id="3458181">f</span><span class="op" id="3458182">.</span><span class="ident" id="3458183">i</span><span class="op" id="3458184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458187">i</span><span class="op" id="3458188">.</span><span class="ident" id="3458189">Rune</span>&nbsp;<span class="op" id="3458194">=</span>&nbsp;<span class="ident" id="3458196">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458199">flags</span>&nbsp;<span class="op" id="3458205">&amp;=</span>&nbsp;<span class="ident" id="3458208">FoldCase</span>&nbsp;<span class="comment" id="3458217">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458252">if</span>&nbsp;<span class="builtinfunc" id="3458255">len</span><span class="op" id="3458258">(</span><span class="ident" id="3458259">r</span><span class="op" id="3458260">)</span>&nbsp;<span class="op" id="3458262">!=</span>&nbsp;<span class="num" id="3458265">1</span>&nbsp;<span class="op" id="3458267">||</span>&nbsp;<span class="ident" id="3458270">unicode</span><span class="op" id="3458277">.</span><span class="ident" id="3458278">SimpleFold</span><span class="op" id="3458288">(</span><span class="ident" id="3458289">r</span><span class="op" id="3458290">[</span><span class="num" id="3458291">0</span><span class="op" id="3458292">]</span><span class="op" id="3458293">)</span>&nbsp;<span class="op" id="3458295">==</span>&nbsp;<span class="ident" id="3458298">r</span><span class="op" id="3458299">[</span><span class="num" id="3458300">0</span><span class="op" id="3458301">]</span>&nbsp;<span class="op" id="3458303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458307">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458340">flags</span>&nbsp;<span class="op" id="3458346">&amp;^=</span>&nbsp;<span class="ident" id="3458350">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458360">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458363">i</span><span class="op" id="3458364">.</span><span class="ident" id="3458365">Arg</span>&nbsp;<span class="op" id="3458369">=</span>&nbsp;<span class="builtintype" id="3458371">uint32</span><span class="op" id="3458377">(</span><span class="ident" id="3458378">flags</span><span class="op" id="3458383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458386">f</span><span class="op" id="3458387">.</span><span class="ident" id="3458388">out</span>&nbsp;<span class="op" id="3458392">=</span>&nbsp;<span class="ident" id="3458394">patchList</span><span class="op" id="3458403">(</span><span class="ident" id="3458404">f</span><span class="op" id="3458405">.</span><span class="ident" id="3458406">i</span>&nbsp;<span class="op" id="3458408">&lt;&lt;</span>&nbsp;<span class="num" id="3458411">1</span><span class="op" id="3458412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458416">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458452">switch</span>&nbsp;<span class="op" id="3458459">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458462">case</span>&nbsp;<span class="ident" id="3458467">flags</span><span class="op" id="3458472">&amp;</span><span class="ident" id="3458473">FoldCase</span>&nbsp;<span class="op" id="3458482">==</span>&nbsp;<span class="num" id="3458485">0</span>&nbsp;<span class="op" id="3458487">&amp;&amp;</span>&nbsp;<span class="op" id="3458490">(</span><span class="builtinfunc" id="3458491">len</span><span class="op" id="3458494">(</span><span class="ident" id="3458495">r</span><span class="op" id="3458496">)</span>&nbsp;<span class="op" id="3458498">==</span>&nbsp;<span class="num" id="3458501">1</span>&nbsp;<span class="op" id="3458503">||</span>&nbsp;<span class="builtinfunc" id="3458506">len</span><span class="op" id="3458509">(</span><span class="ident" id="3458510">r</span><span class="op" id="3458511">)</span>&nbsp;<span class="op" id="3458513">==</span>&nbsp;<span class="num" id="3458516">2</span>&nbsp;<span class="op" id="3458518">&amp;&amp;</span>&nbsp;<span class="ident" id="3458521">r</span><span class="op" id="3458522">[</span><span class="num" id="3458523">0</span><span class="op" id="3458524">]</span>&nbsp;<span class="op" id="3458526">==</span>&nbsp;<span class="ident" id="3458529">r</span><span class="op" id="3458530">[</span><span class="num" id="3458531">1</span><span class="op" id="3458532">]</span><span class="op" id="3458533">)</span><span class="op" id="3458534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458538">i</span><span class="op" id="3458539">.</span><span class="ident" id="3458540">Op</span>&nbsp;<span class="op" id="3458543">=</span>&nbsp;<span class="ident" id="3458545">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458556">case</span>&nbsp;<span class="builtinfunc" id="3458561">len</span><span class="op" id="3458564">(</span><span class="ident" id="3458565">r</span><span class="op" id="3458566">)</span>&nbsp;<span class="op" id="3458568">==</span>&nbsp;<span class="num" id="3458571">2</span>&nbsp;<span class="op" id="3458573">&amp;&amp;</span>&nbsp;<span class="ident" id="3458576">r</span><span class="op" id="3458577">[</span><span class="num" id="3458578">0</span><span class="op" id="3458579">]</span>&nbsp;<span class="op" id="3458581">==</span>&nbsp;<span class="num" id="3458584">0</span>&nbsp;<span class="op" id="3458586">&amp;&amp;</span>&nbsp;<span class="ident" id="3458589">r</span><span class="op" id="3458590">[</span><span class="num" id="3458591">1</span><span class="op" id="3458592">]</span>&nbsp;<span class="op" id="3458594">==</span>&nbsp;<span class="ident" id="3458597">unicode</span><span class="op" id="3458604">.</span><span class="ident" id="3458605">MaxRune</span><span class="op" id="3458612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458616">i</span><span class="op" id="3458617">.</span><span class="ident" id="3458618">Op</span>&nbsp;<span class="op" id="3458621">=</span>&nbsp;<span class="ident" id="3458623">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458636">case</span>&nbsp;<span class="builtinfunc" id="3458641">len</span><span class="op" id="3458644">(</span><span class="ident" id="3458645">r</span><span class="op" id="3458646">)</span>&nbsp;<span class="op" id="3458648">==</span>&nbsp;<span class="num" id="3458651">4</span>&nbsp;<span class="op" id="3458653">&amp;&amp;</span>&nbsp;<span class="ident" id="3458656">r</span><span class="op" id="3458657">[</span><span class="num" id="3458658">0</span><span class="op" id="3458659">]</span>&nbsp;<span class="op" id="3458661">==</span>&nbsp;<span class="num" id="3458664">0</span>&nbsp;<span class="op" id="3458666">&amp;&amp;</span>&nbsp;<span class="ident" id="3458669">r</span><span class="op" id="3458670">[</span><span class="num" id="3458671">1</span><span class="op" id="3458672">]</span>&nbsp;<span class="op" id="3458674">==</span>&nbsp;<span class="string" id="3458677">&#39;\n&#39;</span><span class="op" id="3458681">-</span><span class="num" id="3458682">1</span>&nbsp;<span class="op" id="3458684">&amp;&amp;</span>&nbsp;<span class="ident" id="3458687">r</span><span class="op" id="3458688">[</span><span class="num" id="3458689">2</span><span class="op" id="3458690">]</span>&nbsp;<span class="op" id="3458692">==</span>&nbsp;<span class="string" id="3458695">&#39;\n&#39;</span><span class="op" id="3458699">+</span><span class="num" id="3458700">1</span>&nbsp;<span class="op" id="3458702">&amp;&amp;</span>&nbsp;<span class="ident" id="3458705">r</span><span class="op" id="3458706">[</span><span class="num" id="3458707">3</span><span class="op" id="3458708">]</span>&nbsp;<span class="op" id="3458710">==</span>&nbsp;<span class="ident" id="3458713">unicode</span><span class="op" id="3458720">.</span><span class="ident" id="3458721">MaxRune</span><span class="op" id="3458728">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458732">i</span><span class="op" id="3458733">.</span><span class="ident" id="3458734">Op</span>&nbsp;<span class="op" id="3458737">=</span>&nbsp;<span class="ident" id="3458739">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458761">return</span>&nbsp;<span class="ident" id="3458768">f</span><br>
<span class="lineno"></span><span class="op" id="3458770">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
