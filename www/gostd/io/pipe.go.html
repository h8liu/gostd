<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html" class="current">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1435908">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1435963">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1436017">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1436068">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1436123">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1436161">package</span>&nbsp;<span class="ident" id="1436169">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1436173">import</span>&nbsp;<span class="op" id="1436180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1436183">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1436193">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1436200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1436203">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1436285">var</span>&nbsp;<span class="ident" id="1436289">ErrClosedPipe</span>&nbsp;<span class="op" id="1436303">=</span>&nbsp;<span class="ident" id="1436305"><a href="/gostd/io/pipe.go.html#1436183">errors</a></span><span class="op" id="1436311">.</span><span class="ident" id="1436312"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="1436315">(</span><span class="string" id="1436316">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1436347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1436350">type</span>&nbsp;<span class="ident" id="1436355">pipeResult</span>&nbsp;<span class="keyword" id="1436366">struct</span>&nbsp;<span class="op" id="1436373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436376">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1436380">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436385">err</span>&nbsp;<span class="builtintype" id="1436389">error</span><br>
<span class="lineno"></span><span class="op" id="1436395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1436398">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1436475">type</span>&nbsp;<span class="ident" id="1436480">pipe</span>&nbsp;<span class="keyword" id="1436485">struct</span>&nbsp;<span class="op" id="1436492">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436495">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436501"><a href="/gostd/io/pipe.go.html#1436193">sync</a></span><span class="op" id="1436505">.</span><span class="ident" id="1436506"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="1436512">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436544">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436550"><a href="/gostd/io/pipe.go.html#1436193">sync</a></span><span class="op" id="1436554">.</span><span class="ident" id="1436555"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="1436561">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436593">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436599"><a href="/gostd/io/pipe.go.html#1436193">sync</a></span><span class="op" id="1436603">.</span><span class="ident" id="1436604"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="1436610">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436640">data</span>&nbsp;&nbsp;<span class="op" id="1436646">[</span><span class="op" id="1436647">]</span><span class="builtintype" id="1436648">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436657">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436693">rwait</span>&nbsp;<span class="ident" id="1436699"><a href="/gostd/io/pipe.go.html#1436193">sync</a></span><span class="op" id="1436703">.</span><span class="ident" id="1436704"><a href="/gostd/sync/cond.go.html#1441093">Cond</a></span>&nbsp;&nbsp;<span class="comment" id="1436710">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436729">wwait</span>&nbsp;<span class="ident" id="1436735"><a href="/gostd/io/pipe.go.html#1436193">sync</a></span><span class="op" id="1436739">.</span><span class="ident" id="1436740"><a href="/gostd/sync/cond.go.html#1441093">Cond</a></span>&nbsp;&nbsp;<span class="comment" id="1436746">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436765">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1436771">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436782">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436825">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1436831">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436842">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1436883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1436886">func</span>&nbsp;<span class="op" id="1436891">(</span><span class="ident" id="1436892">p</span>&nbsp;<span class="op" id="1436894">*</span><span class="ident" id="1436895"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><span class="op" id="1436899">)</span>&nbsp;<span class="ident" id="1436901">read</span><span class="op" id="1436905">(</span><span class="ident" id="1436906">b</span>&nbsp;<span class="op" id="1436908">[</span><span class="op" id="1436909">]</span><span class="builtintype" id="1436910">byte</span><span class="op" id="1436914">)</span>&nbsp;<span class="op" id="1436916">(</span><span class="ident" id="1436917">n</span>&nbsp;<span class="builtintype" id="1436919">int</span><span class="op" id="1436922">,</span>&nbsp;<span class="ident" id="1436924">err</span>&nbsp;<span class="builtintype" id="1436928">error</span><span class="op" id="1436933">)</span>&nbsp;<span class="op" id="1436935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436938">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436964"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1436965">.</span><span class="ident" id="1436966"><a href="/gostd/io/pipe.go.html#1436495">rl</a></span><span class="op" id="1436968">.</span><span class="ident" id="1436969"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1436973">(</span><span class="op" id="1436974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436977">defer</span>&nbsp;<span class="ident" id="1436983"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1436984">.</span><span class="ident" id="1436985"><a href="/gostd/io/pipe.go.html#1436495">rl</a></span><span class="op" id="1436987">.</span><span class="ident" id="1436988"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1436994">(</span><span class="op" id="1436995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436999"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437000">.</span><span class="ident" id="1437001"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437002">.</span><span class="ident" id="1437003"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1437007">(</span><span class="op" id="1437008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437011">defer</span>&nbsp;<span class="ident" id="1437017"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437018">.</span><span class="ident" id="1437019"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437020">.</span><span class="ident" id="1437021"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1437027">(</span><span class="op" id="1437028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437031">for</span>&nbsp;<span class="op" id="1437035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437039">if</span>&nbsp;<span class="ident" id="1437042"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437043">.</span><span class="ident" id="1437044"><a href="/gostd/io/pipe.go.html#1436765">rerr</a></span>&nbsp;<span class="op" id="1437049">!=</span>&nbsp;<span class="builtintype" id="1437052">nil</span>&nbsp;<span class="op" id="1437056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437061">return</span>&nbsp;<span class="num" id="1437068">0</span><span class="op" id="1437069">,</span>&nbsp;<span class="ident" id="1437071"><a href="/gostd/io/pipe.go.html#1436289">ErrClosedPipe</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437091">if</span>&nbsp;<span class="ident" id="1437094"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437095">.</span><span class="ident" id="1437096"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437101">!=</span>&nbsp;<span class="builtintype" id="1437104">nil</span>&nbsp;<span class="op" id="1437108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437113">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437125">if</span>&nbsp;<span class="ident" id="1437128"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437129">.</span><span class="ident" id="1437130"><a href="/gostd/io/pipe.go.html#1436825">werr</a></span>&nbsp;<span class="op" id="1437135">!=</span>&nbsp;<span class="builtintype" id="1437138">nil</span>&nbsp;<span class="op" id="1437142">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437147">return</span>&nbsp;<span class="num" id="1437154">0</span><span class="op" id="1437155">,</span>&nbsp;<span class="ident" id="1437157"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437158">.</span><span class="ident" id="1437159"><a href="/gostd/io/pipe.go.html#1436825">werr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437170"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437171">.</span><span class="ident" id="1437172"><a href="/gostd/io/pipe.go.html#1436693">rwait</a></span><span class="op" id="1437177">.</span><span class="ident" id="1437178"><a href="/gostd/sync/cond.go.html#1441923">Wait</a></span><span class="op" id="1437182">(</span><span class="op" id="1437183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437189"><a href="/gostd/io/pipe.go.html#1436917">n</a></span>&nbsp;<span class="op" id="1437191">=</span>&nbsp;<span class="builtinfunc" id="1437193">copy</span><span class="op" id="1437197">(</span><span class="ident" id="1437198"><a href="/gostd/io/pipe.go.html#1436906">b</a></span><span class="op" id="1437199">,</span>&nbsp;<span class="ident" id="1437201"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437202">.</span><span class="ident" id="1437203"><a href="/gostd/io/pipe.go.html#1436640">data</a></span><span class="op" id="1437207">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437210"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437211">.</span><span class="ident" id="1437212"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437217">=</span>&nbsp;<span class="ident" id="1437219"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437220">.</span><span class="ident" id="1437221"><a href="/gostd/io/pipe.go.html#1436640">data</a></span><span class="op" id="1437225">[</span><span class="ident" id="1437226"><a href="/gostd/io/pipe.go.html#1436917">n</a></span><span class="op" id="1437227">:</span><span class="op" id="1437228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437231">if</span>&nbsp;<span class="builtinfunc" id="1437234">len</span><span class="op" id="1437237">(</span><span class="ident" id="1437238"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437239">.</span><span class="ident" id="1437240"><a href="/gostd/io/pipe.go.html#1436640">data</a></span><span class="op" id="1437244">)</span>&nbsp;<span class="op" id="1437246">==</span>&nbsp;<span class="num" id="1437249">0</span>&nbsp;<span class="op" id="1437251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437255"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437256">.</span><span class="ident" id="1437257"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437262">=</span>&nbsp;<span class="builtintype" id="1437264">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437270"><a href="/gostd/io/pipe.go.html#1436892">p</a></span><span class="op" id="1437271">.</span><span class="ident" id="1437272"><a href="/gostd/io/pipe.go.html#1436729">wwait</a></span><span class="op" id="1437277">.</span><span class="ident" id="1437278"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1437284">(</span><span class="op" id="1437285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437288">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437291">return</span><br>
<span class="lineno"></span><span class="op" id="1437298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1437301">var</span>&nbsp;<span class="ident" id="1437305">zero</span>&nbsp;<span class="op" id="1437310">[</span><span class="num" id="1437311">0</span><span class="op" id="1437312">]</span><span class="builtintype" id="1437313">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1437319">func</span>&nbsp;<span class="op" id="1437324">(</span><span class="ident" id="1437325">p</span>&nbsp;<span class="op" id="1437327">*</span><span class="ident" id="1437328"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><span class="op" id="1437332">)</span>&nbsp;<span class="ident" id="1437334">write</span><span class="op" id="1437339">(</span><span class="ident" id="1437340">b</span>&nbsp;<span class="op" id="1437342">[</span><span class="op" id="1437343">]</span><span class="builtintype" id="1437344">byte</span><span class="op" id="1437348">)</span>&nbsp;<span class="op" id="1437350">(</span><span class="ident" id="1437351">n</span>&nbsp;<span class="builtintype" id="1437353">int</span><span class="op" id="1437356">,</span>&nbsp;<span class="ident" id="1437358">err</span>&nbsp;<span class="builtintype" id="1437362">error</span><span class="op" id="1437367">)</span>&nbsp;<span class="op" id="1437369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1437372">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437412">if</span>&nbsp;<span class="ident" id="1437415"><a href="/gostd/io/pipe.go.html#1437340">b</a></span>&nbsp;<span class="op" id="1437417">==</span>&nbsp;<span class="builtintype" id="1437420">nil</span>&nbsp;<span class="op" id="1437424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437428"><a href="/gostd/io/pipe.go.html#1437340">b</a></span>&nbsp;<span class="op" id="1437430">=</span>&nbsp;<span class="ident" id="1437432"><a href="/gostd/io/pipe.go.html#1437305">zero</a></span><span class="op" id="1437436">[</span><span class="op" id="1437437">:</span><span class="op" id="1437438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437441">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1437445">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437471"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437472">.</span><span class="ident" id="1437473"><a href="/gostd/io/pipe.go.html#1436544">wl</a></span><span class="op" id="1437475">.</span><span class="ident" id="1437476"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1437480">(</span><span class="op" id="1437481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437484">defer</span>&nbsp;<span class="ident" id="1437490"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437491">.</span><span class="ident" id="1437492"><a href="/gostd/io/pipe.go.html#1436544">wl</a></span><span class="op" id="1437494">.</span><span class="ident" id="1437495"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1437501">(</span><span class="op" id="1437502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437506"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437507">.</span><span class="ident" id="1437508"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437509">.</span><span class="ident" id="1437510"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1437514">(</span><span class="op" id="1437515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437518">defer</span>&nbsp;<span class="ident" id="1437524"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437525">.</span><span class="ident" id="1437526"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437527">.</span><span class="ident" id="1437528"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1437534">(</span><span class="op" id="1437535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437538">if</span>&nbsp;<span class="ident" id="1437541"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437542">.</span><span class="ident" id="1437543"><a href="/gostd/io/pipe.go.html#1436825">werr</a></span>&nbsp;<span class="op" id="1437548">!=</span>&nbsp;<span class="builtintype" id="1437551">nil</span>&nbsp;<span class="op" id="1437555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437559"><a href="/gostd/io/pipe.go.html#1437358">err</a></span>&nbsp;<span class="op" id="1437563">=</span>&nbsp;<span class="ident" id="1437565"><a href="/gostd/io/pipe.go.html#1436289">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437581">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437592"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437593">.</span><span class="ident" id="1437594"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437599">=</span>&nbsp;<span class="ident" id="1437601"><a href="/gostd/io/pipe.go.html#1437340">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437604"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437605">.</span><span class="ident" id="1437606"><a href="/gostd/io/pipe.go.html#1436693">rwait</a></span><span class="op" id="1437611">.</span><span class="ident" id="1437612"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1437618">(</span><span class="op" id="1437619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437622">for</span>&nbsp;<span class="op" id="1437626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437630">if</span>&nbsp;<span class="ident" id="1437633"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437634">.</span><span class="ident" id="1437635"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437640">==</span>&nbsp;<span class="builtintype" id="1437643">nil</span>&nbsp;<span class="op" id="1437647">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437652">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437664">if</span>&nbsp;<span class="ident" id="1437667"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437668">.</span><span class="ident" id="1437669"><a href="/gostd/io/pipe.go.html#1436765">rerr</a></span>&nbsp;<span class="op" id="1437674">!=</span>&nbsp;<span class="builtintype" id="1437677">nil</span>&nbsp;<span class="op" id="1437681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437686"><a href="/gostd/io/pipe.go.html#1437358">err</a></span>&nbsp;<span class="op" id="1437690">=</span>&nbsp;<span class="ident" id="1437692"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437693">.</span><span class="ident" id="1437694"><a href="/gostd/io/pipe.go.html#1436765">rerr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437702">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437714">if</span>&nbsp;<span class="ident" id="1437717"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437718">.</span><span class="ident" id="1437719"><a href="/gostd/io/pipe.go.html#1436825">werr</a></span>&nbsp;<span class="op" id="1437724">!=</span>&nbsp;<span class="builtintype" id="1437727">nil</span>&nbsp;<span class="op" id="1437731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437736"><a href="/gostd/io/pipe.go.html#1437358">err</a></span>&nbsp;<span class="op" id="1437740">=</span>&nbsp;<span class="ident" id="1437742"><a href="/gostd/io/pipe.go.html#1436289">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437762"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437763">.</span><span class="ident" id="1437764"><a href="/gostd/io/pipe.go.html#1436729">wwait</a></span><span class="op" id="1437769">.</span><span class="ident" id="1437770"><a href="/gostd/sync/cond.go.html#1441923">Wait</a></span><span class="op" id="1437774">(</span><span class="op" id="1437775">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437781"><a href="/gostd/io/pipe.go.html#1437351">n</a></span>&nbsp;<span class="op" id="1437783">=</span>&nbsp;<span class="builtinfunc" id="1437785">len</span><span class="op" id="1437788">(</span><span class="ident" id="1437789"><a href="/gostd/io/pipe.go.html#1437340">b</a></span><span class="op" id="1437790">)</span>&nbsp;<span class="op" id="1437792">-</span>&nbsp;<span class="builtinfunc" id="1437794">len</span><span class="op" id="1437797">(</span><span class="ident" id="1437798"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437799">.</span><span class="ident" id="1437800"><a href="/gostd/io/pipe.go.html#1436640">data</a></span><span class="op" id="1437804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437807"><a href="/gostd/io/pipe.go.html#1437325">p</a></span><span class="op" id="1437808">.</span><span class="ident" id="1437809"><a href="/gostd/io/pipe.go.html#1436640">data</a></span>&nbsp;<span class="op" id="1437814">=</span>&nbsp;<span class="builtintype" id="1437816">nil</span>&nbsp;<span class="comment" id="1437820">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437848">return</span><br>
<span class="lineno"></span><span class="op" id="1437855">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1437858">func</span>&nbsp;<span class="op" id="1437863">(</span><span class="ident" id="1437864">p</span>&nbsp;<span class="op" id="1437866">*</span><span class="ident" id="1437867"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><span class="op" id="1437871">)</span>&nbsp;<span class="ident" id="1437873">rclose</span><span class="op" id="1437879">(</span><span class="ident" id="1437880">err</span>&nbsp;<span class="builtintype" id="1437884">error</span><span class="op" id="1437889">)</span>&nbsp;<span class="op" id="1437891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437894">if</span>&nbsp;<span class="ident" id="1437897"><a href="/gostd/io/pipe.go.html#1437880">err</a></span>&nbsp;<span class="op" id="1437901">==</span>&nbsp;<span class="builtintype" id="1437904">nil</span>&nbsp;<span class="op" id="1437908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437912"><a href="/gostd/io/pipe.go.html#1437880">err</a></span>&nbsp;<span class="op" id="1437916">=</span>&nbsp;<span class="ident" id="1437918"><a href="/gostd/io/pipe.go.html#1436289">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1437933">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437936"><a href="/gostd/io/pipe.go.html#1437864">p</a></span><span class="op" id="1437937">.</span><span class="ident" id="1437938"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437939">.</span><span class="ident" id="1437940"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1437944">(</span><span class="op" id="1437945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1437948">defer</span>&nbsp;<span class="ident" id="1437954"><a href="/gostd/io/pipe.go.html#1437864">p</a></span><span class="op" id="1437955">.</span><span class="ident" id="1437956"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1437957">.</span><span class="ident" id="1437958"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1437964">(</span><span class="op" id="1437965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437968"><a href="/gostd/io/pipe.go.html#1437864">p</a></span><span class="op" id="1437969">.</span><span class="ident" id="1437970"><a href="/gostd/io/pipe.go.html#1436765">rerr</a></span>&nbsp;<span class="op" id="1437975">=</span>&nbsp;<span class="ident" id="1437977"><a href="/gostd/io/pipe.go.html#1437880">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1437982"><a href="/gostd/io/pipe.go.html#1437864">p</a></span><span class="op" id="1437983">.</span><span class="ident" id="1437984"><a href="/gostd/io/pipe.go.html#1436693">rwait</a></span><span class="op" id="1437989">.</span><span class="ident" id="1437990"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1437996">(</span><span class="op" id="1437997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438000"><a href="/gostd/io/pipe.go.html#1437864">p</a></span><span class="op" id="1438001">.</span><span class="ident" id="1438002"><a href="/gostd/io/pipe.go.html#1436729">wwait</a></span><span class="op" id="1438007">.</span><span class="ident" id="1438008"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1438014">(</span><span class="op" id="1438015">)</span><br>
<span class="lineno">110</span><span class="op" id="1438017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1438020">func</span>&nbsp;<span class="op" id="1438025">(</span><span class="ident" id="1438026">p</span>&nbsp;<span class="op" id="1438028">*</span><span class="ident" id="1438029"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><span class="op" id="1438033">)</span>&nbsp;<span class="ident" id="1438035">wclose</span><span class="op" id="1438041">(</span><span class="ident" id="1438042">err</span>&nbsp;<span class="builtintype" id="1438046">error</span><span class="op" id="1438051">)</span>&nbsp;<span class="op" id="1438053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1438056">if</span>&nbsp;<span class="ident" id="1438059"><a href="/gostd/io/pipe.go.html#1438042">err</a></span>&nbsp;<span class="op" id="1438063">==</span>&nbsp;<span class="builtintype" id="1438066">nil</span>&nbsp;<span class="op" id="1438070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438074"><a href="/gostd/io/pipe.go.html#1438042">err</a></span>&nbsp;<span class="op" id="1438078">=</span>&nbsp;<span class="ident" id="1438080"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1438085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438088"><a href="/gostd/io/pipe.go.html#1438026">p</a></span><span class="op" id="1438089">.</span><span class="ident" id="1438090"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1438091">.</span><span class="ident" id="1438092"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1438096">(</span><span class="op" id="1438097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1438100">defer</span>&nbsp;<span class="ident" id="1438106"><a href="/gostd/io/pipe.go.html#1438026">p</a></span><span class="op" id="1438107">.</span><span class="ident" id="1438108"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><span class="op" id="1438109">.</span><span class="ident" id="1438110"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1438116">(</span><span class="op" id="1438117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438120"><a href="/gostd/io/pipe.go.html#1438026">p</a></span><span class="op" id="1438121">.</span><span class="ident" id="1438122"><a href="/gostd/io/pipe.go.html#1436825">werr</a></span>&nbsp;<span class="op" id="1438127">=</span>&nbsp;<span class="ident" id="1438129"><a href="/gostd/io/pipe.go.html#1438042">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438134"><a href="/gostd/io/pipe.go.html#1438026">p</a></span><span class="op" id="1438135">.</span><span class="ident" id="1438136"><a href="/gostd/io/pipe.go.html#1436693">rwait</a></span><span class="op" id="1438141">.</span><span class="ident" id="1438142"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1438148">(</span><span class="op" id="1438149">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438152"><a href="/gostd/io/pipe.go.html#1438026">p</a></span><span class="op" id="1438153">.</span><span class="ident" id="1438154"><a href="/gostd/io/pipe.go.html#1436729">wwait</a></span><span class="op" id="1438159">.</span><span class="ident" id="1438160"><a href="/gostd/sync/cond.go.html#1442279">Signal</a></span><span class="op" id="1438166">(</span><span class="op" id="1438167">)</span><br>
<span class="lineno"></span><span class="op" id="1438169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1438172">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1438216">type</span>&nbsp;<span class="ident" id="1438221">PipeReader</span>&nbsp;<span class="keyword" id="1438232">struct</span>&nbsp;<span class="op" id="1438239">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438242">p</span>&nbsp;<span class="op" id="1438244">*</span><span class="ident" id="1438245"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="1438250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1438253">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1438301">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1438357">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1438396">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1438455">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1438497">func</span>&nbsp;<span class="op" id="1438502">(</span><span class="ident" id="1438503">r</span>&nbsp;<span class="op" id="1438505">*</span><span class="ident" id="1438506"><a href="/gostd/io/pipe.go.html#1438221">PipeReader</a></span><span class="op" id="1438516">)</span>&nbsp;<span class="ident" id="1438518">Read</span><span class="op" id="1438522">(</span><span class="ident" id="1438523">data</span>&nbsp;<span class="op" id="1438528">[</span><span class="op" id="1438529">]</span><span class="builtintype" id="1438530">byte</span><span class="op" id="1438534">)</span>&nbsp;<span class="op" id="1438536">(</span><span class="ident" id="1438537">n</span>&nbsp;<span class="builtintype" id="1438539">int</span><span class="op" id="1438542">,</span>&nbsp;<span class="ident" id="1438544">err</span>&nbsp;<span class="builtintype" id="1438548">error</span><span class="op" id="1438553">)</span>&nbsp;<span class="op" id="1438555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1438558">return</span>&nbsp;<span class="ident" id="1438565"><a href="/gostd/io/pipe.go.html#1438503">r</a></span><span class="op" id="1438566">.</span><span class="ident" id="1438567"><a href="/gostd/io/pipe.go.html#1438242">p</a></span><span class="op" id="1438568">.</span><span class="ident" id="1438569"><a href="/gostd/io/pipe.go.html#1436901">read</a></span><span class="op" id="1438573">(</span><span class="ident" id="1438574"><a href="/gostd/io/pipe.go.html#1438523">data</a></span><span class="op" id="1438578">)</span><br>
<span class="lineno">135</span><span class="op" id="1438580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1438583">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1438636">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1438699">func</span>&nbsp;<span class="op" id="1438704">(</span><span class="ident" id="1438705">r</span>&nbsp;<span class="op" id="1438707">*</span><span class="ident" id="1438708"><a href="/gostd/io/pipe.go.html#1438221">PipeReader</a></span><span class="op" id="1438718">)</span>&nbsp;<span class="ident" id="1438720">Close</span><span class="op" id="1438725">(</span><span class="op" id="1438726">)</span>&nbsp;<span class="builtintype" id="1438728">error</span>&nbsp;<span class="op" id="1438734">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1438737">return</span>&nbsp;<span class="ident" id="1438744"><a href="/gostd/io/pipe.go.html#1438705">r</a></span><span class="op" id="1438745">.</span><span class="ident" id="1438746"><a href="/gostd/io/pipe.go.html#1438905">CloseWithError</a></span><span class="op" id="1438760">(</span><span class="builtintype" id="1438761">nil</span><span class="op" id="1438764">)</span><br>
<span class="lineno"></span><span class="op" id="1438766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1438769">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1438824">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1438884">func</span>&nbsp;<span class="op" id="1438889">(</span><span class="ident" id="1438890">r</span>&nbsp;<span class="op" id="1438892">*</span><span class="ident" id="1438893"><a href="/gostd/io/pipe.go.html#1438221">PipeReader</a></span><span class="op" id="1438903">)</span>&nbsp;<span class="ident" id="1438905">CloseWithError</span><span class="op" id="1438919">(</span><span class="ident" id="1438920">err</span>&nbsp;<span class="builtintype" id="1438924">error</span><span class="op" id="1438929">)</span>&nbsp;<span class="builtintype" id="1438931">error</span>&nbsp;<span class="op" id="1438937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1438940"><a href="/gostd/io/pipe.go.html#1438890">r</a></span><span class="op" id="1438941">.</span><span class="ident" id="1438942"><a href="/gostd/io/pipe.go.html#1438242">p</a></span><span class="op" id="1438943">.</span><span class="ident" id="1438944"><a href="/gostd/io/pipe.go.html#1437873">rclose</a></span><span class="op" id="1438950">(</span><span class="ident" id="1438951"><a href="/gostd/io/pipe.go.html#1438920">err</a></span><span class="op" id="1438954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1438957">return</span>&nbsp;<span class="builtintype" id="1438964">nil</span><br>
<span class="lineno"></span><span class="op" id="1438968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1438971">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1439016">type</span>&nbsp;<span class="ident" id="1439021">PipeWriter</span>&nbsp;<span class="keyword" id="1439032">struct</span>&nbsp;<span class="op" id="1439039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1439042">p</span>&nbsp;<span class="op" id="1439044">*</span><span class="ident" id="1439045"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="1439050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1439053">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1439103">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1439157">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1439214">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1439270">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1439322">func</span>&nbsp;<span class="op" id="1439327">(</span><span class="ident" id="1439328">w</span>&nbsp;<span class="op" id="1439330">*</span><span class="ident" id="1439331"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><span class="op" id="1439341">)</span>&nbsp;<span class="ident" id="1439343">Write</span><span class="op" id="1439348">(</span><span class="ident" id="1439349">data</span>&nbsp;<span class="op" id="1439354">[</span><span class="op" id="1439355">]</span><span class="builtintype" id="1439356">byte</span><span class="op" id="1439360">)</span>&nbsp;<span class="op" id="1439362">(</span><span class="ident" id="1439363">n</span>&nbsp;<span class="builtintype" id="1439365">int</span><span class="op" id="1439368">,</span>&nbsp;<span class="ident" id="1439370">err</span>&nbsp;<span class="builtintype" id="1439374">error</span><span class="op" id="1439379">)</span>&nbsp;<span class="op" id="1439381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1439384">return</span>&nbsp;<span class="ident" id="1439391"><a href="/gostd/io/pipe.go.html#1439328">w</a></span><span class="op" id="1439392">.</span><span class="ident" id="1439393"><a href="/gostd/io/pipe.go.html#1439042">p</a></span><span class="op" id="1439394">.</span><span class="ident" id="1439395"><a href="/gostd/io/pipe.go.html#1437334">write</a></span><span class="op" id="1439400">(</span><span class="ident" id="1439401"><a href="/gostd/io/pipe.go.html#1439349">data</a></span><span class="op" id="1439405">)</span><br>
<span class="lineno"></span><span class="op" id="1439407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1439410">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1439464">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1439519">func</span>&nbsp;<span class="op" id="1439524">(</span><span class="ident" id="1439525">w</span>&nbsp;<span class="op" id="1439527">*</span><span class="ident" id="1439528"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><span class="op" id="1439538">)</span>&nbsp;<span class="ident" id="1439540">Close</span><span class="op" id="1439545">(</span><span class="op" id="1439546">)</span>&nbsp;<span class="builtintype" id="1439548">error</span>&nbsp;<span class="op" id="1439554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1439557">return</span>&nbsp;<span class="ident" id="1439564"><a href="/gostd/io/pipe.go.html#1439525">w</a></span><span class="op" id="1439565">.</span><span class="ident" id="1439566"><a href="/gostd/io/pipe.go.html#1439738">CloseWithError</a></span><span class="op" id="1439580">(</span><span class="builtintype" id="1439581">nil</span><span class="op" id="1439584">)</span><br>
<span class="lineno"></span><span class="op" id="1439586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1439589">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1439652">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1439717">func</span>&nbsp;<span class="op" id="1439722">(</span><span class="ident" id="1439723">w</span>&nbsp;<span class="op" id="1439725">*</span><span class="ident" id="1439726"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><span class="op" id="1439736">)</span>&nbsp;<span class="ident" id="1439738">CloseWithError</span><span class="op" id="1439752">(</span><span class="ident" id="1439753">err</span>&nbsp;<span class="builtintype" id="1439757">error</span><span class="op" id="1439762">)</span>&nbsp;<span class="builtintype" id="1439764">error</span>&nbsp;<span class="op" id="1439770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1439773"><a href="/gostd/io/pipe.go.html#1439723">w</a></span><span class="op" id="1439774">.</span><span class="ident" id="1439775"><a href="/gostd/io/pipe.go.html#1439042">p</a></span><span class="op" id="1439776">.</span><span class="ident" id="1439777"><a href="/gostd/io/pipe.go.html#1438035">wclose</a></span><span class="op" id="1439783">(</span><span class="ident" id="1439784"><a href="/gostd/io/pipe.go.html#1439753">err</a></span><span class="op" id="1439787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1439790">return</span>&nbsp;<span class="builtintype" id="1439797">nil</span><br>
<span class="lineno">175</span><span class="op" id="1439801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1439804">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1439850">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1439907">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1439944">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1440002">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1440076">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1440149">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1440223">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1440276">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1440328">func</span>&nbsp;<span class="ident" id="1440333">Pipe</span><span class="op" id="1440337">(</span><span class="op" id="1440338">)</span>&nbsp;<span class="op" id="1440340">(</span><span class="op" id="1440341">*</span><span class="ident" id="1440342"><a href="/gostd/io/pipe.go.html#1438221">PipeReader</a></span><span class="op" id="1440352">,</span>&nbsp;<span class="op" id="1440354">*</span><span class="ident" id="1440355"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><span class="op" id="1440365">)</span>&nbsp;<span class="op" id="1440367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1440370">p</span>&nbsp;<span class="op" id="1440372">:=</span>&nbsp;<span class="builtinfunc" id="1440375">new</span><span class="op" id="1440378">(</span><span class="ident" id="1440379"><a href="/gostd/io/pipe.go.html#1436480">pipe</a></span><span class="op" id="1440383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1440386"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440387">.</span><span class="ident" id="1440388"><a href="/gostd/io/pipe.go.html#1436693">rwait</a></span><span class="op" id="1440393">.</span><span class="ident" id="1440394"><a href="/gostd/sync/cond.go.html#1441164">L</a></span>&nbsp;<span class="op" id="1440396">=</span>&nbsp;<span class="op" id="1440398">&amp;</span><span class="ident" id="1440399"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440400">.</span><span class="ident" id="1440401"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1440404"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440405">.</span><span class="ident" id="1440406"><a href="/gostd/io/pipe.go.html#1436729">wwait</a></span><span class="op" id="1440411">.</span><span class="ident" id="1440412"><a href="/gostd/sync/cond.go.html#1441164">L</a></span>&nbsp;<span class="op" id="1440414">=</span>&nbsp;<span class="op" id="1440416">&amp;</span><span class="ident" id="1440417"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440418">.</span><span class="ident" id="1440419"><a href="/gostd/io/pipe.go.html#1436593">l</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1440422">r</span>&nbsp;<span class="op" id="1440424">:=</span>&nbsp;<span class="op" id="1440427">&amp;</span><span class="ident" id="1440428"><a href="/gostd/io/pipe.go.html#1438221">PipeReader</a></span><span class="op" id="1440438">{</span><span class="ident" id="1440439"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1440443">w</span>&nbsp;<span class="op" id="1440445">:=</span>&nbsp;<span class="op" id="1440448">&amp;</span><span class="ident" id="1440449"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><span class="op" id="1440459">{</span><span class="ident" id="1440460"><a href="/gostd/io/pipe.go.html#1440370">p</a></span><span class="op" id="1440461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1440464">return</span>&nbsp;<span class="ident" id="1440471"><a href="/gostd/io/pipe.go.html#1440422">r</a></span><span class="op" id="1440472">,</span>&nbsp;<span class="ident" id="1440474"><a href="/gostd/io/pipe.go.html#1440443">w</a></span><br>
<span class="lineno"></span><span class="op" id="1440476">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
